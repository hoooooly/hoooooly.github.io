

<!DOCTYPE html>
<html lang="Zh" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Holy Chan">
  <meta name="keywords" content="">
  
  <title>requests库的基本使用 - Holy的个人站点</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"e0b23de316904d07fb7110bd99d69a80","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"5nl8DQfwVmV1EVq02TMrVpLl-gzGzoHsz","app_key":"RbsmRlFYbVuACVohRTd4N6Cr","server_url":"https://5nl8dqfw.lc-cn-n1-shared.com"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Holy</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                主页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于我
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="requests库的基本使用">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-05-18 15:44" pubdate>
        May 18, 2021 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      6.4k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      89
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">requests库的基本使用</h1>
            
            <div class="markdown-body">
              <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><code>requests</code>是一个第三方库，使用<code>pip</code>下载安装。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip3 install requests<br></code></pre></td></tr></table></figure>

<h2 id="实例引入"><a href="#实例引入" class="headerlink" title="实例引入"></a>实例引入</h2><p>用<code>Python</code>写爬虫的第一步就是模拟发起一个请求，把网页的源代码获取下来。</p>
<p>在浏览器中输入一个<code>URL</code>并回车，实际上就是让浏览器帮我们发起一个<code>GET</code>类型的<code>HTTP</code>请求，浏览器得到源代码后，把它渲染出来就可以看到网页内容了。</p>
<p>那如果想用<code>requests</code>来获取源代码，应该怎么办呢？很简单，<code>requests</code>这个库提供了一个<code>get</code>方法，调用这个方法，并传入对应的<code>URL</code>就能得到网页的源代码。</p>
<p>比如这里有一个示例网站:<a target="_blank" rel="noopener" href="https://static1.scrape.cuiqingcai.com/">https://static1.scrape.cuiqingcai.com/</a>，其内容如下：</p>
<p><img src="Screenshot_2.webp" srcset="/img/loading.gif" lazyload alt="示列网站"></p>
<p>这个网站展示了一些电影数据，如果想要把这个网页里面的数据爬下来，比如获取各个电影的名称、上映时间等信息，然后把它存下来的话，该怎么做呢？</p>
<p>第一步当然就是获取它的网页源代码了。</p>
<p>可以用<code>requests</code>这个库轻松地完成这个过程，代码的写法是这样的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>r = requests.get(url=<span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class="hljs-literal">False</span>)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>

<p>输出结果如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>  <br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width,initial-scale=1&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;icon&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/static/img/favicon.ico&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Scrape | Movie<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/static/css/app.css&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span>&gt;</span><br>  <br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/static/css/index.css&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">data-v-74e8b908</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;el-row&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;header&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">data-v-74e8b908</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container el-col el-col-18 el-col-offset-3&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">data-v-74e8b908</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;el-row&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">data-v-74e8b908</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;logo el-col el-col-4&quot;</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">data-v-74e8b908</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;router-link-exact-active router-link-active&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">data-v-74e8b908</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/logo.png&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;logo-image&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">data-v-74e8b908</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;logo-title&quot;</span>&gt;</span>Scrape<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <br>...<br><br>         <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;number&quot;</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/page/7&quot;</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <br>            <br>            <br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;number&quot;</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/page/8&quot;</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <br>            <br>            <br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;number&quot;</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/page/9&quot;</span>&gt;</span>9<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <br>            <br>            <br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;number&quot;</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/page/10&quot;</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <br>            <br>          <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>          <br>          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/page/2&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;next&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-next&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;el-icon el-icon-arrow-right&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>          <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br>Process finished with exit code 0<br><br></code></pre></td></tr></table></figure>

<p>由于网页内容比较多，这里省略了大部分内容。</p>
<p>不过看运行结果，我们已经成功获取网页的<code>HTML</code>源代码，里面包含了电影的标题、类型、上映时间，等等。</p>
<p>把网页源代码获取下来之后，下一步我们把想要的数据提取出来，数据的爬取就完成了。</p>
<h2 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h2><p><code>HTTP</code>中最常见的请求之一就是<code>GET</code>请求。</p>
<h3 id="GET请求"><a href="#GET请求" class="headerlink" title="GET请求"></a><code>GET</code>请求</h3><p>换一个示例网站，其<code>URL</code>为<a target="_blank" rel="noopener" href="http://httpbin.org/get">http://httpbin.org/get</a>，如果客户端发起的是<code>GET</code>请求的话，该网站会判断并返回相应的请求信息，包括 <code>Headers</code>、<code>IP</code>等。 我们还是用相同的方法来发起一个<code>GET请求</code>，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>r = requests.get(url=<span class="hljs-string">&#x27;http://httpbin.org/get&#x27;</span>, verify=<span class="hljs-literal">False</span>)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>

<p>返回结果：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html">&#123;<br>  &quot;args&quot;: &#123;&#125;, <br>  &quot;headers&quot;: &#123;<br>    &quot;Accept&quot;: &quot;*/*&quot;,<br>    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,<br>    &quot;Host&quot;: &quot;httpbin.org&quot;,<br>    &quot;User-Agent&quot;: &quot;python-requests/2.25.1&quot;,<br>    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-60a3a8ad-070f8b95711f7821709e24ed&quot;<br>  &#125;,<br>  &quot;origin&quot;: &quot;202.62.113.207&quot;,<br>  &quot;url&quot;: &quot;http://httpbin.org/get&quot;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以发现，成功发起了<code>GET</code>请求，也通过这个网站的返回结果得到了请求所携带的信息，包括<code>Headers</code>、<code>URL</code>、<code>IP</code>，等等。</p>
<p>对于<code>GET</code>请求，我们知道<code>URL</code>后面是可以跟上一些参数的，如果我们现在想添加两个参数，其中<code>name</code>是<code>germey</code>，<code>age</code>是<code>25</code>，<code>URL</code>就可以写成如下内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">http://httpbin.org/get?name=germey&amp;age=<span class="hljs-number">25</span><br></code></pre></td></tr></table></figure>

<p>要构造这个请求链接，是不是要直接写成这样呢？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">r = requests.get(<span class="hljs-string">&#x27;http://httpbin.org/get?name=germey&amp;age=25&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>这样也可以，但如果这些参数还需要手动拼接，未免有点不人性化。</p>
<p>一般情况下，这种信息我们利用<code>params</code>这个参数就可以直接传递了，示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>data = &#123;<br>    <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;holy&#x27;</span>,<br>    <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-number">25</span><br>&#125;<br><br>r = requests.get(url=<span class="hljs-string">&#x27;http://httpbin.org/get&#x27;</span>, params=data, verify=<span class="hljs-literal">False</span>)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>

<p>返回结果：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html">&#123;<br>  &quot;args&quot;: &#123;<br>    &quot;age&quot;: &quot;25&quot;,<br>    &quot;name&quot;: &quot;holy&quot;<br>  &#125;,<br>  &quot;headers&quot;: &#123;<br>    &quot;Accept&quot;: &quot;*/*&quot;,<br>    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,<br>    &quot;Host&quot;: &quot;httpbin.org&quot;,<br>    &quot;User-Agent&quot;: &quot;python-requests/2.25.1&quot;,<br>    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-60a3ab05-51321f5c7eeb7b0573bb5510&quot;<br>  &#125;,<br>  &quot;origin&quot;: &quot;202.62.113.207&quot;,<br>  &quot;url&quot;: &quot;http://httpbin.org/get?name=holy&amp;age=25&quot;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>把<code>URL</code>参数通过字典的形式传给<code>get</code>方法的<code>params</code>参数，通过返回信息可以判断，请求的链接自动被构造成了：<em><a target="_blank" rel="noopener" href="http://httpbin.org/get?age=22&amp;name=germey">http://httpbin.org/get?age=22&amp;name=germey</a></em>。</p>
<p>网页的返回类型实际上是<code>str</code>类型，但是它很特殊，是<code>JSON</code>格式的。所以，如果想直接解析返回结果，得到一个<code>JSON</code>格式的数据的话，可以直接调用<code>json</code>方法。</p>
<p>示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>data = &#123;<br>    <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;holy&#x27;</span>,<br>    <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-number">25</span><br>&#125;<br><br>r = requests.get(url=<span class="hljs-string">&#x27;http://httpbin.org/get&#x27;</span>, params=data, verify=<span class="hljs-literal">False</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(r.text))<br><span class="hljs-built_in">print</span>(r.json())<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(r.json()))<br></code></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">&lt;class &#x27;str&#x27;&gt;<br>&#123;&#x27;args&#x27;: &#123;&#x27;age&#x27;: &#x27;25&#x27;, &#x27;name&#x27;: &#x27;holy&#x27;&#125;, &#x27;headers&#x27;: &#123;&#x27;Accept&#x27;: &#x27;*/*&#x27;, &#x27;Accept-Encoding&#x27;: &#x27;gzip, deflate&#x27;, &#x27;Host&#x27;: &#x27;httpbin.org&#x27;, &#x27;User-Agent&#x27;: &#x27;python-requests/2.25.1&#x27;, &#x27;X-Amzn-Trace-Id&#x27;: &#x27;Root=1-60a3ac52-425e713a2907d0302f298070&#x27;&#125;, &#x27;origin&#x27;: &#x27;202.62.113.207&#x27;, &#x27;url&#x27;: &#x27;http://httpbin.org/get?name=holy&amp;age=25&#x27;&#125;<br>&lt;class &#x27;dict&#x27;&gt;<br></code></pre></td></tr></table></figure>

<p>调用<code>json</code>方法，就可以将返回结果是<code>JSON</code>格式的字符串转化为字典。 但需要注意的是，如果返回结果不是<code>JSON</code>格式，便会出现解析错误，抛出<code>json.decoder.JSONDecodeError</code>异常。</p>
<h3 id="抓取网页"><a href="#抓取网页" class="headerlink" title="抓取网页"></a>抓取网页</h3><p>上面的请求链接返回的是<code>JSON</code>形式的字符串，那么如果请求普通的网页，则肯定能获得相应的内容。下面以本课时最初的实例页面为例，我们再加上一点提取信息的逻辑，将代码完善成如下的样子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><br>r = requests.get(<span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class="hljs-literal">False</span>)<br>pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">&#x27;&lt;h2.*?&gt;(.*?)&lt;/h2&gt;&#x27;</span>, re.S)<br>titles = re.findall(pattern, r.text)<br><span class="hljs-built_in">print</span>(titles)<br></code></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">[<span class="hljs-string">&#x27;霸王别姬 - Farewell My Concubine&#x27;</span>, <span class="hljs-string">&#x27;这个杀手不太冷 - Léon&#x27;</span>, <span class="hljs-string">&#x27;肖申克的救赎 - The Shawshank Redemption&#x27;</span>, <span class="hljs-string">&#x27;泰坦尼克号 - Titanic&#x27;</span>, <span class="hljs-string">&#x27;罗马假日 - Roman Holiday&#x27;</span>, <span class="hljs-string">&#x27;唐伯虎点秋香 - Flirting Scholar&#x27;</span>, <span class="hljs-string">&#x27;乱世佳人 - Gone with the Wind&#x27;</span>, <span class="hljs-string">&#x27;喜剧之王 - The King of Comedy&#x27;</span>, <span class="hljs-string">&#x27; 楚门的世界 - The Truman Show&#x27;</span>, <span class="hljs-string">&#x27;狮子王 - The Lion King&#x27;</span>]<br></code></pre></td></tr></table></figure>

<h3 id="抓取二进制数据"><a href="#抓取二进制数据" class="headerlink" title="抓取二进制数据"></a>抓取二进制数据</h3><p>抓取的是网站的一个页面，实际上它返回的是一个<code>HTML</code>文档。如果想抓取图片、音频、视频等文件，应该怎么办呢？</p>
<p>图片、音频、视频这些文件本质上都是由<strong>二进制码</strong>组成的，由于有特定的保存格式和对应的解析方式，我们才可以看到这些形形色色的多媒体。所以，想要抓取它们，就要拿到它们的二进制数据。</p>
<p>下面以 GitHub 的站点图标为例来看一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>r = requests.get(<span class="hljs-string">&#x27;https://github.com/favicon.ico&#x27;</span>)<br><span class="hljs-built_in">print</span>(r.text)<br><span class="hljs-built_in">print</span>(r.content)<br></code></pre></td></tr></table></figure>

<p>这里抓取的内容是站点图标，也就是在浏览器每一个标签上显示的小图标。</p>
<p>前者出现了乱码，后者结果前带有一个<code>b</code>，这代表是<code>bytes</code>类型的数据。</p>
<p>由于图片是二进制数据，所以前者在打印时转化为<code>str</code>类型，也就是图片直接转化为字符串，这当然会出现乱码。</p>
<p>上面返回的结果我们并不能看懂，它实际上是图片的二进制数据，没关系，将刚才提取到的信息保存下来就好了，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests <br><br>r = requests.get(<span class="hljs-string">&#x27;https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png&#x27;</span>, verify=<span class="hljs-literal">False</span>) <br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;baidu.png&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f: <br>    f.write(r.content)<br></code></pre></td></tr></table></figure>

<p>这里用了<code>open</code>方法，它的第一个参数是文件名称，第二个参数代表以二进制的形式打开，可以向文件里写入二进制数据。</p>
<p>运行结束之后，可以发现在文件夹中出现了名为<code>baidu.png</code>的图标。</p>
<h3 id="添加添headers"><a href="#添加添headers" class="headerlink" title="添加添headers"></a>添加添headers</h3><p>在发起一个<code>HTTP</code>请求的时候，会有一个请求头<code>Request Headers</code>，那么这个怎么来设置呢？</p>
<p>很简单，使用<code>headers</code>参数就可以完成了。</p>
<p>在刚才的实例中，是没有设置<code>Request Headers</code>信息的，如果不设置，某些网站会发现这不是一个正常的浏览器发起的请求，网站可能会返回异常的结果，导致网页抓取失败。</p>
<p>要添加<code>Headers</code>信息，比如添加一个<code>User-Agent</code>字段，可以这么写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>headers = &#123; <br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36&#x27;</span><br>&#125;<br><br>r = requests.get(<span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, headers=headers, verify=<span class="hljs-literal">False</span>) <br><br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>

<p>当然，我们可以在<code>headers</code>这个参数中任意添加其他的字段信息。</p>
<h3 id="POST请求"><a href="#POST请求" class="headerlink" title="POST请求"></a>POST请求</h3><p>使用<code>requests</code>实现<code>post</code>请求，示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>data = &#123;<span class="hljs-string">&#x27;name&#x27;</span>:<span class="hljs-string">&#x27;germey&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>:<span class="hljs-string">&#x27;25&#x27;</span>&#125;<br>r = requests.post(<span class="hljs-string">&quot;http://httpbin.org/post&quot;</span>, data=data)<br><br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>

<p>这里还是请求<a target="_blank" rel="noopener" href="http://httpbin.org/post">http://httpbin.org/post</a>，该网站可以判断如果请求是<code>POST</code>方式，就把相关请求信息返回。</p>
<p>运行结果如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<br>  <span class="hljs-string">&quot;args&quot;</span>: &#123;&#125;,<br>  <span class="hljs-string">&quot;data&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-string">&quot;files&quot;</span>: &#123;&#125;,<br>  <span class="hljs-string">&quot;form&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-string">&quot;25&quot;</span>,<br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;germey&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;headers&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;*/*&quot;</span>,<br>    <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>,<br>    <span class="hljs-string">&quot;Content-Length&quot;</span>: <span class="hljs-string">&quot;18&quot;</span>,<br>    <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>,<br>    <span class="hljs-string">&quot;Host&quot;</span>: <span class="hljs-string">&quot;httpbin.org&quot;</span>,<br>    <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;python-requests/2.25.1&quot;</span>,<br>    <span class="hljs-string">&quot;X-Amzn-Trace-Id&quot;</span>: <span class="hljs-string">&quot;Root=1-60a402c2-68a523624a9ca353207a3a5e&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;json&quot;</span>: null,<br>  <span class="hljs-string">&quot;origin&quot;</span>: <span class="hljs-string">&quot;202.62.113.207&quot;</span>,<br>  <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;http://httpbin.org/post&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h3><p>发送请求后，得到的就是响应，即<code>Response</code>。</p>
<p>在上面的实例中，使用<code>text</code>和<code>content</code>获取了响应的内容。此外，还有很多属性和方法可以用来获取其他信息，比如<code>状态码</code>、<code>响应头</code>、<code>Cookies</code>等。示例如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>r = requests.get(<span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class="hljs-literal">False</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(r.status_code), r.status_code)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(r.headers), r.headers)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(r.cookies), r.cookies)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(r.url), r.url)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(r.history), r.history)<br></code></pre></td></tr></table></figure>

<p>这里分别打印输出<code>status_code</code>属性得到状态码，输出<code>headers</code>属性得到响应头，输出<code>cookies</code>属性得到<code>Cookies</code>，输出<code>url</code>属性得到<code>URL</code>，输出<code>history</code>属性得到请求历史。</p>
<p>运行结果如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">int</span>&#x27;&gt; 200</span><br><span class="hljs-class">&lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">requests</span>.<span class="hljs-title">structures</span>.<span class="hljs-title">CaseInsensitiveDict</span>&#x27;&gt; &#123;&#x27;<span class="hljs-title">Date</span>&#x27;:</span> <span class="hljs-string">&#x27;Wed, 19 May 2021 12:52:03 GMT&#x27;</span>, <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html; charset=utf-8&#x27;</span>, <span class="hljs-string">&#x27;Content-Length&#x27;</span>: <span class="hljs-string">&#x27;41538&#x27;</span>, <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>, <span class="hljs-string">&#x27;X-Frame-Options&#x27;</span>: <span class="hljs-string">&#x27;DENY&#x27;</span>, <span class="hljs-string">&#x27;X-Content-Type-Options&#x27;</span>: <span class="hljs-string">&#x27;nosniff&#x27;</span>, <span class="hljs-string">&#x27;Expires&#x27;</span>: <span class="hljs-string">&#x27;Wed, 19 May 2021 13:01:46 GMT&#x27;</span>, <span class="hljs-string">&#x27;Cache-Control&#x27;</span>: <span class="hljs-string">&#x27;max-age=600&#x27;</span>, <span class="hljs-string">&#x27;Strict-Transport-Security&#x27;</span>: <span class="hljs-string">&#x27;max-age=15724800; includeSubDomains&#x27;</span>&#125;<br>&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">requests</span>.<span class="hljs-title">cookies</span>.<span class="hljs-title">RequestsCookieJar</span>&#x27;&gt; &lt;<span class="hljs-title">RequestsCookieJar</span>[]&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">str</span>&#x27;&gt; <span class="hljs-title">https</span>:</span>//static1.scrape.cuiqingcai.com/<br>&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">list</span>&#x27;&gt; []</span><br></code></pre></td></tr></table></figure>

<p><code>headers</code>和<code>cookies</code>这两个属性得到的结果分别是<code>CaseInsensitiveDict</code>和<code>RequestsCookieJar</code>类型。</p>
<p>状态码是用来表示响应状态的，比如返回<code>200</code>代表我们得到的响应是没问题的，上面的例子正好输出的结果也是<code>200</code>，所以可以通过判断<code>Response</code>的状态码来确认是否爬取成功。</p>
<p><code>requests</code>还提供了一个内置的状态码查询对象<code>requests.codes</code>，用法示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>r = requests.get(<span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class="hljs-literal">False</span>)<br>exit() <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> r.status_code == requests.codes.ok <span class="hljs-keyword">else</span> <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Request successfully&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>这里通过比较返回码和内置的成功的返回码，来保证请求得到了正常响应，输出成功请求的消息，否则程序终止，这里我们用<code>requests.codes.ok</code>得到的是成功的状态码<code>200</code>。</p>
<p>这样的话，我们就不用再在程序里面写状态码对应的数字了，用字符串表示状态码会显得更加直观。</p>
<p>下面列出了返回码和相应的查询条件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 信息性状态码</span><br><span class="hljs-number">100</span>: (<span class="hljs-string">&#x27;continue&#x27;</span>,),<br><span class="hljs-number">101</span>: (<span class="hljs-string">&#x27;switching_protocols&#x27;</span>,),<br><span class="hljs-number">102</span>: (<span class="hljs-string">&#x27;processing&#x27;</span>,),<br><span class="hljs-number">103</span>: (<span class="hljs-string">&#x27;checkpoint&#x27;</span>,),<br><span class="hljs-number">122</span>: (<span class="hljs-string">&#x27;uri_too_long&#x27;</span>, <span class="hljs-string">&#x27;request_uri_too_long&#x27;</span>),<br><br><span class="hljs-comment"># 成功状态码</span><br><span class="hljs-number">200</span>: (<span class="hljs-string">&#x27;ok&#x27;</span>, <span class="hljs-string">&#x27;okay&#x27;</span>, <span class="hljs-string">&#x27;all_ok&#x27;</span>, <span class="hljs-string">&#x27;all_okay&#x27;</span>, <span class="hljs-string">&#x27;all_good&#x27;</span>, <span class="hljs-string">&#x27;\\o/&#x27;</span>, <span class="hljs-string">&#x27;✓&#x27;</span>),<br><span class="hljs-number">201</span>: (<span class="hljs-string">&#x27;created&#x27;</span>,),<br><span class="hljs-number">202</span>: (<span class="hljs-string">&#x27;accepted&#x27;</span>,),<br><span class="hljs-number">203</span>: (<span class="hljs-string">&#x27;non_authoritative_info&#x27;</span>, <span class="hljs-string">&#x27;non_authoritative_information&#x27;</span>),<br><span class="hljs-number">204</span>: (<span class="hljs-string">&#x27;no_content&#x27;</span>,),<br><span class="hljs-number">205</span>: (<span class="hljs-string">&#x27;reset_content&#x27;</span>, <span class="hljs-string">&#x27;reset&#x27;</span>),<br><span class="hljs-number">206</span>: (<span class="hljs-string">&#x27;partial_content&#x27;</span>, <span class="hljs-string">&#x27;partial&#x27;</span>),<br><span class="hljs-number">207</span>: (<span class="hljs-string">&#x27;multi_status&#x27;</span>, <span class="hljs-string">&#x27;multiple_status&#x27;</span>, <span class="hljs-string">&#x27;multi_stati&#x27;</span>, <span class="hljs-string">&#x27;multiple_stati&#x27;</span>),<br><span class="hljs-number">208</span>: (<span class="hljs-string">&#x27;already_reported&#x27;</span>,),<br><span class="hljs-number">226</span>: (<span class="hljs-string">&#x27;im_used&#x27;</span>,),<br><br><span class="hljs-comment"># 重定向状态码</span><br><span class="hljs-number">300</span>: (<span class="hljs-string">&#x27;multiple_choices&#x27;</span>,),<br><span class="hljs-number">301</span>: (<span class="hljs-string">&#x27;moved_permanently&#x27;</span>, <span class="hljs-string">&#x27;moved&#x27;</span>, <span class="hljs-string">&#x27;\\o-&#x27;</span>),<br><span class="hljs-number">302</span>: (<span class="hljs-string">&#x27;found&#x27;</span>,),<br><span class="hljs-number">303</span>: (<span class="hljs-string">&#x27;see_other&#x27;</span>, <span class="hljs-string">&#x27;other&#x27;</span>),<br><span class="hljs-number">304</span>: (<span class="hljs-string">&#x27;not_modified&#x27;</span>,),<br><span class="hljs-number">305</span>: (<span class="hljs-string">&#x27;use_proxy&#x27;</span>,),<br><span class="hljs-number">306</span>: (<span class="hljs-string">&#x27;switch_proxy&#x27;</span>,),<br><span class="hljs-number">307</span>: (<span class="hljs-string">&#x27;temporary_redirect&#x27;</span>, <span class="hljs-string">&#x27;temporary_moved&#x27;</span>, <span class="hljs-string">&#x27;temporary&#x27;</span>),<br><span class="hljs-number">308</span>: (<span class="hljs-string">&#x27;permanent_redirect&#x27;</span>, <span class="hljs-string">&#x27;resume_incomplete&#x27;</span>, <span class="hljs-string">&#x27;resume&#x27;</span>,), <span class="hljs-comment"># These 2 to be removed in 3.0 </span><br><br><span class="hljs-comment"># 客户端错误状态码 </span><br><span class="hljs-number">400</span>: (<span class="hljs-string">&#x27;bad_request&#x27;</span>, <span class="hljs-string">&#x27;bad&#x27;</span>), <br><span class="hljs-number">401</span>: (<span class="hljs-string">&#x27;unauthorized&#x27;</span>,), <br><span class="hljs-number">402</span>: (<span class="hljs-string">&#x27;payment_required&#x27;</span>, <span class="hljs-string">&#x27;payment&#x27;</span>), <br><span class="hljs-number">403</span>: (<span class="hljs-string">&#x27;forbidden&#x27;</span>,), <br><span class="hljs-number">404</span>: (<span class="hljs-string">&#x27;not_found&#x27;</span>, <span class="hljs-string">&#x27;-o-&#x27;</span>), <br><span class="hljs-number">405</span>: (<span class="hljs-string">&#x27;method_not_allowed&#x27;</span>, <span class="hljs-string">&#x27;not_allowed&#x27;</span>), <br><span class="hljs-number">406</span>: (<span class="hljs-string">&#x27;not_acceptable&#x27;</span>,), <br><span class="hljs-number">407</span>: (<span class="hljs-string">&#x27;proxy_authentication_required&#x27;</span>, <span class="hljs-string">&#x27;proxy_auth&#x27;</span>, <span class="hljs-string">&#x27;proxy_authentication&#x27;</span>),<br><span class="hljs-number">408</span>: (<span class="hljs-string">&#x27;request_timeout&#x27;</span>, <span class="hljs-string">&#x27;timeout&#x27;</span>), <br><span class="hljs-number">409</span>: (<span class="hljs-string">&#x27;conflict&#x27;</span>,),<br><span class="hljs-number">410</span>: (<span class="hljs-string">&#x27;gone&#x27;</span>,),<br><span class="hljs-number">411</span>: (<span class="hljs-string">&#x27;length_required&#x27;</span>,),<br><span class="hljs-number">412</span>: (<span class="hljs-string">&#x27;precondition_failed&#x27;</span>, <span class="hljs-string">&#x27;precondition&#x27;</span>),<br><span class="hljs-number">413</span>: (<span class="hljs-string">&#x27;request_entity_too_large&#x27;</span>,),<br><span class="hljs-number">414</span>: (<span class="hljs-string">&#x27;request_uri_too_large&#x27;</span>,),<br><span class="hljs-number">415</span>: (<span class="hljs-string">&#x27;unsupported_media_type&#x27;</span>, <span class="hljs-string">&#x27;unsupported_media&#x27;</span>, <span class="hljs-string">&#x27;media_type&#x27;</span>),<br><span class="hljs-number">416</span>: (<span class="hljs-string">&#x27;requested_range_not_satisfiable&#x27;</span>, <span class="hljs-string">&#x27;requested_range&#x27;</span>, <span class="hljs-string">&#x27;range_not_satisfiable&#x27;</span>),<br><span class="hljs-number">417</span>: (<span class="hljs-string">&#x27;expectation_failed&#x27;</span>,),<br><span class="hljs-number">418</span>: (<span class="hljs-string">&#x27;im_a_teapot&#x27;</span>, <span class="hljs-string">&#x27;teapot&#x27;</span>, <span class="hljs-string">&#x27;i_am_a_teapot&#x27;</span>),<br><span class="hljs-number">421</span>: (<span class="hljs-string">&#x27;misdirected_request&#x27;</span>,),<br><span class="hljs-number">422</span>: (<span class="hljs-string">&#x27;unprocessable_entity&#x27;</span>, <span class="hljs-string">&#x27;unprocessable&#x27;</span>),<br><span class="hljs-number">423</span>: (<span class="hljs-string">&#x27;locked&#x27;</span>,),<br><span class="hljs-number">424</span>: (<span class="hljs-string">&#x27;failed_dependency&#x27;</span>, <span class="hljs-string">&#x27;dependency&#x27;</span>),<br><span class="hljs-number">425</span>: (<span class="hljs-string">&#x27;unordered_collection&#x27;</span>, <span class="hljs-string">&#x27;unordered&#x27;</span>),<br><span class="hljs-number">426</span>: (<span class="hljs-string">&#x27;upgrade_required&#x27;</span>, <span class="hljs-string">&#x27;upgrade&#x27;</span>),<br><span class="hljs-number">428</span>: (<span class="hljs-string">&#x27;precondition_required&#x27;</span>, <span class="hljs-string">&#x27;precondition&#x27;</span>),<br><span class="hljs-number">429</span>: (<span class="hljs-string">&#x27;too_many_requests&#x27;</span>, <span class="hljs-string">&#x27;too_many&#x27;</span>),<br><span class="hljs-number">431</span>: (<span class="hljs-string">&#x27;header_fields_too_large&#x27;</span>, <span class="hljs-string">&#x27;fields_too_large&#x27;</span>),<br><span class="hljs-number">444</span>: (<span class="hljs-string">&#x27;no_response&#x27;</span>, <span class="hljs-string">&#x27;none&#x27;</span>),<br><span class="hljs-number">449</span>: (<span class="hljs-string">&#x27;retry_with&#x27;</span>, <span class="hljs-string">&#x27;retry&#x27;</span>),<br><span class="hljs-number">450</span>: (<span class="hljs-string">&#x27;blocked_by_windows_parental_controls&#x27;</span>, <span class="hljs-string">&#x27;parental_controls&#x27;</span>),<br><span class="hljs-number">451</span>: (<span class="hljs-string">&#x27;unavailable_for_legal_reasons&#x27;</span>, <span class="hljs-string">&#x27;legal_reasons&#x27;</span>),<br><span class="hljs-number">499</span>: (<span class="hljs-string">&#x27;client_closed_request&#x27;</span>,), <br><br><span class="hljs-comment"># 服务端错误状态码</span><br><span class="hljs-number">500</span>: (<span class="hljs-string">&#x27;internal_server_error&#x27;</span>, <span class="hljs-string">&#x27;server_error&#x27;</span>, <span class="hljs-string">&#x27;/o\\&#x27;</span>, <span class="hljs-string">&#x27;✗&#x27;</span>),<br><span class="hljs-number">501</span>: (<span class="hljs-string">&#x27;not_implemented&#x27;</span>,),<br><span class="hljs-number">502</span>: (<span class="hljs-string">&#x27;bad_gateway&#x27;</span>,),<br><span class="hljs-number">503</span>: (<span class="hljs-string">&#x27;service_unavailable&#x27;</span>, <span class="hljs-string">&#x27;unavailable&#x27;</span>),<br><span class="hljs-number">504</span>: (<span class="hljs-string">&#x27;gateway_timeout&#x27;</span>,),<br><span class="hljs-number">505</span>: (<span class="hljs-string">&#x27;http_version_not_supported&#x27;</span>, <span class="hljs-string">&#x27;http_version&#x27;</span>),<br><span class="hljs-number">506</span>: (<span class="hljs-string">&#x27;variant_also_negotiates&#x27;</span>,),<br><span class="hljs-number">507</span>: (<span class="hljs-string">&#x27;insufficient_storage&#x27;</span>,),<br><span class="hljs-number">509</span>: (<span class="hljs-string">&#x27;bandwidth_limit_exceeded&#x27;</span>, <span class="hljs-string">&#x27;bandwidth&#x27;</span>),<br><span class="hljs-number">510</span>: (<span class="hljs-string">&#x27;not_extended&#x27;</span>,),<br><span class="hljs-number">511</span>: (<span class="hljs-string">&#x27;network_authentication_required&#x27;</span>, <span class="hljs-string">&#x27;network_auth&#x27;</span>, <span class="hljs-string">&#x27;network_authentication&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>比如，如果想判断结果是不是<code>404</code>状态，可以用<code>requests.codes.not_found</code>来比对。</p>
<h2 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h2><p>刚才，了解<code>requests</code>的基本用法，如基本的<code>GET、POST</code>请求以及<code>Response</code>对象。当然<code>requests</code>能做到的不仅这些，它几乎可以完成<code>HTTP</code>的所有操作。</p>
<p>下面来了解下<code>requests</code>的一些高级用法，如文件上传、<code>Cookies</code>设置、代理设置等。</p>
<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p><code>requests</code>可以模拟提交一些数据。假如有的网站需要上传文件，也可以用它来实现，示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>files = &#123;<span class="hljs-string">&#x27;file&#x27;</span>:<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;baidu.png&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>)&#125;<br>r = requests.post(<span class="hljs-string">&#x27;http://httpbin.org/post&#x27;</span>, files=files)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>

<p>要注意的是，<code>baidu.png</code>需要和当前脚本在同一目录下。如果有其他文件，当然也可以使用其他文件来上传，更改下代码即可。运行结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">&#123;<br>  &quot;args&quot;: &#123;&#125;, <br>  &quot;data&quot;: &quot;&quot;, <br>  &quot;files&quot;: &#123;<br>    &quot;file&quot;: &quot;data:application/octet-stream;base64,iVBORw0KGgoAAAANSU......&quot;<br>  &#125;,<br>  &quot;form&quot;: &#123;&#125;,<br>  &quot;headers&quot;: &#123;<br>    &quot;Accept&quot;: &quot;*/*&quot;,<br>    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,<br>    &quot;Content-Length&quot;: &quot;15589&quot;,<br>    &quot;Content-Type&quot;: &quot;multipart/form-data; boundary=7e0556b094615781fff3b0ed4316dccd&quot;,<br>    &quot;Host&quot;: &quot;httpbin.org&quot;,<br>    &quot;User-Agent&quot;: &quot;python-requests/2.25.1&quot;,<br>    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-60a72501-36f606570785cb9d4356df71&quot;<br>  &#125;,<br>  &quot;json&quot;: null,<br>  &quot;origin&quot;: &quot;202.62.112.143&quot;,<br>  &quot;url&quot;: &quot;http://httpbin.org/post&quot;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>以上省略部分内容，这个网站会返回响应，里面包含<code>files</code>这个字段，而<code>form</code>字段是空的，这证明文件上传部分会单独有一个<code>files</code>字段来标识。</p>
<h3 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h3><p>获取<code>Cookies</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>r = requests.get(<span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span>)<br><span class="hljs-built_in">print</span>(r.cookies)<br><span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> r.cookies.items():<br>    <span class="hljs-built_in">print</span>(key + <span class="hljs-string">&#x27;=&#x27;</span> + value)<br></code></pre></td></tr></table></figure>

<p>运行结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">&lt;RequestsCookieJar[&lt;Cookie BDORZ=27315 for .baidu.com/&gt;]&gt;<br>BDORZ=27315<br></code></pre></td></tr></table></figure>

<p>调用<code>cookies</code>属性即可成功得到<code>Cookies</code>，可以发现它是<code>RequestCookieJar</code>类型。然后用<code>items</code> 方法将其转化为元组组成的列表，遍历输出每一个<code>Cookie</code>的名称和值，实现<code>Cookie</code>的遍历解析。</p>
<p>可以直接用<code>Cookie</code>来维持登录状态，下面我们以<code>GitHub</code>为例来说明一下，首先我们登录<code>GitHub</code>，然后将<code>Headers</code>中的<code>Cookie</code>内容复制下来，如图所示：</p>
<p><img src="Screenshot_1.webp" srcset="/img/loading.gif" lazyload></p>
<p>可以替换成你自己的<code>Cookie</code>，将其设置到<code>Headers</code>里面，然后发送请求。</p>
<h3 id="Session维持"><a href="#Session维持" class="headerlink" title="Session维持"></a>Session维持</h3><p>在<code>requests</code>中，如果直接利用<code>get</code>或<code>post</code>等方法的确可以做到模拟网页的请求，但是这实际上是相当于不同的<code>Session</code>，相当于你用两个浏览器打开了不同的页面。</p>
<p>设想这样一个场景，第一个请求利用<code>post</code>方法登录了某个网站，第二次想获取成功登录后的自己的个人信息，又用了一次<code>get</code>方法去请求个人信息页面。实际上，这相当于打开了两个浏览器，是两个完全不相关的<code>Session</code>，能成功获取个人信息吗？当然不能。</p>
<p>解决这个问题的主要方法就是维持同一个<code>Session</code>，相当于打开一个新的浏览器选项卡而不是新开一个浏览器。但我又不想每次设置<code>Cookies</code>，那该怎么办呢？这时候就有了新的利器——**<code>Session</code>对象**。 利用它，可以方便地维护一个<code>Session</code>，而且不用担心<code>Cookies</code>的问题，它会帮我们自动处理好。示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>requests.get(<span class="hljs-string">&#x27;http://httpbin.org/cookies/set/number/123456789&#x27;</span>, verify=<span class="hljs-literal">False</span>)<br>r = requests.get(<span class="hljs-string">&#x27;http://httpbin.org/cookies&#x27;</span>, verify=<span class="hljs-literal">False</span>)<br><br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>

<p>运行结果如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<br>  <span class="hljs-string">&quot;cookies&quot;</span>: &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这并不行。再用 Session试试看：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>s = requests.Session()<br>s.get(<span class="hljs-string">&#x27;http://httpbin.org/cookies/set/number/123456789&#x27;</span>)<br>r = s.get(<span class="hljs-string">&#x27;http://httpbin.org/cookies&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>

<p>运行结果如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<br>  <span class="hljs-string">&quot;cookies&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;number&quot;</span>: <span class="hljs-string">&quot;123456789&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>利用<code>Session</code>，可以做到模拟同一个<code>Session</code>而不用担心<code>Cookies</code>的问题。它通常用于模拟登录成功之后再进行下一步的操作。</p>
<h3 id="SSL证书验证"><a href="#SSL证书验证" class="headerlink" title="SSL证书验证"></a>SSL证书验证</h3><p>现在很多网站都要求使用<code>HTTPS</code>协议，但是有些网站可能并没有设置好<code>HTTPS</code>证书，或者网站的<code>HTTPS</code>证书不被<code>CA</code>机构认可，这时候，这些网站可能就会出现<code>SSL</code>证书错误的提示。</p>
<p>比如示例网站：<a target="_blank" rel="noopener" href="https://static2.scrape.cuiqingcai.com/">https://static2.scrape.cuiqingcai.com/</a>。 用浏览器打开这个<code>URL</code>，则会提示<strong>「您的连接不是私密连接」</strong>这样的错误，如图所示：</p>
<p><img src="Screenshot_3.webp" srcset="/img/loading.gif" lazyload alt="示例网站"></p>
<p>那如果我们一定要爬取这个网站怎么办呢？我们可以使用<code>verify</code>参数控制是否验证证书，如果将其设置为<code>False</code>，在请求时就不会再验证证书是否有效。如果不加<code>verify</code>参数的话，默认值是<code>True</code>，会自动验证。</p>
<p>改写代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>response = requests.get(<span class="hljs-string">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class="hljs-literal">False</span>) <br><span class="hljs-built_in">print</span>(response.status_code) <br></code></pre></td></tr></table></figure>

<p>这样就会打印出请求成功的状态码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">/usr/local/lib/python3<span class="hljs-number">.7</span>/site-packages/urllib3/connectionpool.py:<span class="hljs-number">857</span>: InsecureRequestWarning: Unverified HTTPS request <span class="hljs-keyword">is</span> being made. Adding certificate verification <span class="hljs-keyword">is</span> strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html<br>InsecureRequestWarning) <span class="hljs-number">200</span> <br></code></pre></td></tr></table></figure>

<p>不过发现报了一个警告，它建议我们给它指定证书。可以通过设置忽略警告的方式来屏蔽这个警告：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests <span class="hljs-keyword">from</span> requests.packages <br><span class="hljs-keyword">import</span> urllib3 <br><br>urllib3.disable_warnings() <br>response = requests.get(<span class="hljs-string">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class="hljs-literal">False</span>) <br><span class="hljs-built_in">print</span>(response.status_code)<br></code></pre></td></tr></table></figure>

<p>或者通过捕获警告到日志的方式忽略警告：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging <br><span class="hljs-keyword">import</span> requests <br><br>logging.captureWarnings(<span class="hljs-literal">True</span>) <br>response = requests.get(<span class="hljs-string">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class="hljs-literal">False</span>) <br><span class="hljs-built_in">print</span>(response.status_code)<br></code></pre></td></tr></table></figure>

<p>当然，也可以指定一个本地证书用作客户端证书，这可以是单个文件（包含密钥和证书）或一个包含两个文件路径的元组： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests response = requests.get(<span class="hljs-string">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, cert=(<span class="hljs-string">&#x27;/path/server.crt&#x27;</span>, <span class="hljs-string">&#x27;/path/server.key&#x27;</span>)) <br><span class="hljs-built_in">print</span>(response.status_code)<br></code></pre></td></tr></table></figure>

<p>上面的代码是演示实例，要有<code>crt</code>和<code>key</code>文件，并且指定它们的路径。另外注意，本地私有证书的<code>key</code>必须是解密状态，加密状态的<code>key</code>是不支持的。</p>
<h3 id="超时时间"><a href="#超时时间" class="headerlink" title="超时时间"></a>超时时间</h3><p>在本机网络状况不好或者服务器网络响应延迟甚至无响应时，可能会等待很久才能收到响应，甚至到最后收不到响应而报错。为了防止服务器不能及时响应，应该设置一个超时时间，即超过了这个时间还没有得到响应，那就报错。这需要用到<code>timeout</code>参数。这个时间的计算是发出请求到服务器返回响应的时间。示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests <br>r = requests.get(<span class="hljs-string">&#x27;https://httpbin.org/get&#x27;</span>, timeout=<span class="hljs-number">1</span>) <br><span class="hljs-built_in">print</span>(r.status_code)<br></code></pre></td></tr></table></figure>

<p>通过这样的方式将超时时间设置为<code>1</code>秒，如果<code>1</code>秒内没有响应，那就抛出异常。</p>
<p>实际上，请求分为两个阶段，即连接<code>（connect）</code>和读取<code>（read）</code>。 上面设置的<code>timeout</code>将用作连接和读取这二者的<code>timeout</code>总和。</p>
<p>如果要分别指定，就可以传入一个元组：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">r = requests.get(<span class="hljs-string">&#x27;https://httpbin.org/get&#x27;</span>, timeout=(<span class="hljs-number">5</span>, <span class="hljs-number">30</span>))<br></code></pre></td></tr></table></figure>

<p>如果想永久等待，可以直接将<code>timeout</code>设置为<code>None</code>，或者不设置直接留空，因为默认是<code>None</code>。这样的话，如果服务器还在运行，但是响应特别慢，那就慢慢等吧，它永远不会返回超时错误的。其用法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">r = requests.get(<span class="hljs-string">&#x27;https://httpbin.org/get&#x27;</span>, timeout=<span class="hljs-literal">None</span>) <br></code></pre></td></tr></table></figure>

<p>或直接不加参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">r = requests.get(<span class="hljs-string">&#x27;https://httpbin.org/get&#x27;</span>)<br></code></pre></td></tr></table></figure>

<h3 id="身份认证"><a href="#身份认证" class="headerlink" title="身份认证"></a>身份认证</h3><p>在访问某些设置了身份认证的网站时，例如：<a target="_blank" rel="noopener" href="https://static3.scrape.cuiqingcai.com/">https://static3.scrape.cuiqingcai.com/</a>，我们可能会遇到这样的认证窗口，如图所示：</p>
<p><img src="Screenshot_4.webp" srcset="/img/loading.gif" lazyload alt="认证"></p>
<p>如果遇到了这种情况，那就是这个网站启用了基本身份认证，英文叫作<code>HTTP Basic Access Authentication</code>，它是一种用来允许网页浏览器或其他客户端程序在请求时提供<strong>用户名</strong>和<strong>口令形式</strong>的身份凭证的一种登录验证方式。 如果遇到了这种情况，怎么用<code>reqeusts</code>来爬取呢，当然也有办法。</p>
<p>可以使用<code>requests</code>自带的身份认证功能，通过<code>auth</code>参数即可设置，示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> requests.auth <span class="hljs-keyword">import</span> HTTPBasicAuth<br><br>r = requests.get(<span class="hljs-string">&#x27;https://static3.scrape.cuiqingcai.com/&#x27;</span>, auth=HTTPBasicAuth(<span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;admin&#x27;</span>), verify=<span class="hljs-literal">False</span>)<br><span class="hljs-built_in">print</span>(r.status_code)<br></code></pre></td></tr></table></figure>

<p>成功的话，返回状态码<code>200</code>。</p>
<p>如果参数都传一个<code>HTTPBasicAuth</code>类，就显得有点烦琐了，所以<code>requests</code>提供了一个更简单的写法，可以直接传一个元组，它会默认使用<code>HTTPBasicAuth</code>这个类来认证。</p>
<p>上面的代码可以直接简写如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>r = requests.get(<span class="hljs-string">&#x27;https://static3.scrape.cuiqingcai.com/&#x27;</span>, auth=(<span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;admin&#x27;</span>))<br><span class="hljs-built_in">print</span>(r.status_code)<br></code></pre></td></tr></table></figure>

<p>此外，<code>requests</code>还提供了其他认证方式，如<code>OAuth</code>认证，不过此时需要安装<code>oauth</code>包，安装命令如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip3 install requests_oauthlib<br></code></pre></td></tr></table></figure>

<p>使用<code>OAuth1</code>认证的方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests <span class="hljs-keyword">from</span> requests_oauthlib <br><span class="hljs-keyword">import</span> OAuth1 <br>url = <span class="hljs-string">&#x27;https://api.twitter.com/1.1/account/verify_credentials.json&#x27;</span> <br>auth = OAuth1(<span class="hljs-string">&#x27;YOUR_APP_KEY&#x27;</span>, <span class="hljs-string">&#x27;YOUR_APP_SECRET&#x27;</span>, <span class="hljs-string">&#x27;USER_OAUTH_TOKEN&#x27;</span>, <span class="hljs-string">&#x27;USER_OAUTH_TOKEN_SECRET&#x27;</span>)<br>requests.get(url, auth=auth) <br></code></pre></td></tr></table></figure>

<p>更多详细的功能就可以参考<code>requests_oauthlib</code>的官方文档：<a target="_blank" rel="noopener" href="https://requests-oauthlib.readthedocs.org/">https://requests-oauthlib.readthedocs.org/</a>，不再赘述。</p>
<h3 id="代理设置"><a href="#代理设置" class="headerlink" title="代理设置"></a>代理设置</h3><p>某些网站在测试的时候请求几次，能正常获取内容。但是对于大规模且频繁的请求，网站可能会弹出验证码，或者跳转到登录认证页面，更甚者可能会直接封禁客户端的<code>IP</code>，导致一定时间段内无法访问。</p>
<p>为了防止这种情况发生，我们需要设置代理来解决这个问题，这就需要用到<code>proxies</code>参数。可以用这样的方式设置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>proxies = &#123; <br>  <span class="hljs-string">&#x27;http&#x27;</span>: <span class="hljs-string">&#x27;http://10.10.10.10:1080&#x27;</span>, <br>  <span class="hljs-string">&#x27;https&#x27;</span>: <span class="hljs-string">&#x27;http://10.10.10.10:1080&#x27;</span>, <br>&#125;<br>requests.get(<span class="hljs-string">&#x27;https://httpbin.org/get&#x27;</span>, proxies=proxies) <br></code></pre></td></tr></table></figure>

<p>当然，直接运行这个实例或许行不通，因为这个代理可能是无效的，可以直接搜索寻找有效的代理并替换试验一下。</p>
<p>若代理需要使用上文所述的身份认证，可以使用类似<code>ttp://user:password@host:port</code>这样的语法来设置代理，示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>proxies = &#123;<span class="hljs-string">&#x27;https&#x27;</span>: <span class="hljs-string">&#x27;http://user:password@10.10.10.10:1080/&#x27;</span>,&#125; <br>requests.get(<span class="hljs-string">&#x27;https://httpbin.org/get&#x27;</span>, proxies=proxies)<br></code></pre></td></tr></table></figure>

<p>除了基本的<code>HTTP</code>代理外，<code>requests</code>还支持<code>SOCKS</code>协议的代理。</p>
<p>首先，需要安装<code>socks</code>这个库：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip3 install <span class="hljs-string">&quot;requests[socks]&quot;</span><br></code></pre></td></tr></table></figure>

<p>然后就可以使用<code>SOCKS</code>协议代理了，示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>proxies = &#123; <br>  <span class="hljs-string">&#x27;http&#x27;</span>: <span class="hljs-string">&#x27;socks5://user:password@host:port&#x27;</span>, <br>  <span class="hljs-string">&#x27;https&#x27;</span>: <span class="hljs-string">&#x27;socks5://user:password@host:port&#x27;</span> <br>&#125;<br>requests.get(<span class="hljs-string">&#x27;https://httpbin.org/get&#x27;</span>, proxies=proxies)<br></code></pre></td></tr></table></figure>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/python/">python</a>
                    
                      <a class="hover-with-bg" href="/tags/requests/">requests</a>
                    
                      <a class="hover-with-bg" href="/tags/%E7%88%AC%E8%99%AB/">爬虫</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/05/20/%E5%9F%BA%E4%BA%8Ecentos%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%9B%98/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">基于NextCloud搭建个人网盘</span>
                        <span class="visible-mobile">Vorheriger</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/05/18/Nginx%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/">
                        <span class="hidden-mobile">Nginx配置详解</span>
                        <span class="visible-mobile">Nächster</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Suchen</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">Stichwort</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud 统计PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            总访问量 
            <span id="leancloud-site-pv"></span>
             次
          </span>
      
      
        <!-- LeanCloud 统计UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            总访客数 
            <span id="leancloud-site-uv"></span>
             人
          </span>
      

    
  </div>


  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        鄂ICP备2021008617号-1
      </a>
    </span>
    
  </div>


  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>




  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?e0b23de316904d07fb7110bd99d69a80";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
