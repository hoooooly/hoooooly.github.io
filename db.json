{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/kr-dark.min.css","path":"css/kr-dark.min.css","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/kratosr.min.css","path":"css/kratosr.min.css","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/prismjs.min.css","path":"css/prismjs.min.css","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/404.webp","path":"images/404.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/about.webp","path":"images/about.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/alipay.webp","path":"images/alipay.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/avatar.webp","path":"images/avatar.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/banner.webp","path":"images/banner.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/banner_dark.webp","path":"images/banner_dark.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/bg.webp","path":"images/bg.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/failure.ico","path":"images/failure.ico","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/logo.webp","path":"images/logo.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/my.webp","path":"images/my.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/psr.webp","path":"images/psr.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/wechat.webp","path":"images/wechat.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/js/candy.min.js","path":"js/candy.min.js","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/js/kr-dark.min.js","path":"js/kr-dark.min.js","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/js/kratosr.min.js","path":"js/kratosr.min.js","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/js/local-search.min.js","path":"js/local-search.min.js","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/js/pjax.min.js","path":"js/pjax.min.js","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/js/snow.min.js","path":"js/snow.min.js","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/candy.min.js.map","path":"maps/candy.min.js.map","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/kr-dark.min.css.map","path":"maps/kr-dark.min.css.map","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/kr-dark.min.js.map","path":"maps/kr-dark.min.js.map","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/kratosr.min.css.map","path":"maps/kratosr.min.css.map","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/kratosr.min.js.map","path":"maps/kratosr.min.js.map","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/light.min.css.map","path":"maps/light.min.css.map","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/local-search.min.js.map","path":"maps/local-search.min.js.map","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/night-blue.min.css.map","path":"maps/night-blue.min.css.map","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/night-bright.min.css.map","path":"maps/night-bright.min.css.map","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/night-eighties.min.css.map","path":"maps/night-eighties.min.css.map","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/night.min.css.map","path":"maps/night.min.css.map","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/pjax.min.js.map","path":"maps/pjax.min.js.map","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/prismjs.min.css.map","path":"maps/prismjs.min.css.map","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/snow.min.js.map","path":"maps/snow.min.js.map","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/highlight/light.min.css","path":"css/highlight/light.min.css","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/highlight/night-blue.min.css","path":"css/highlight/night-blue.min.css","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/highlight/night-eighties.min.css","path":"css/highlight/night-eighties.min.css","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/highlight/night-bright.min.css","path":"css/highlight/night-bright.min.css","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/highlight/night.min.css","path":"css/highlight/night.min.css","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_10.webp","path":"images/thumb/thumb_10.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_1.webp","path":"images/thumb/thumb_1.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_11.webp","path":"images/thumb/thumb_11.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_12.webp","path":"images/thumb/thumb_12.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_13.webp","path":"images/thumb/thumb_13.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_14.webp","path":"images/thumb/thumb_14.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_15.webp","path":"images/thumb/thumb_15.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_16.webp","path":"images/thumb/thumb_16.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_17.webp","path":"images/thumb/thumb_17.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_18.webp","path":"images/thumb/thumb_18.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_19.webp","path":"images/thumb/thumb_19.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_2.webp","path":"images/thumb/thumb_2.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_20.webp","path":"images/thumb/thumb_20.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_3.webp","path":"images/thumb/thumb_3.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_4.webp","path":"images/thumb/thumb_4.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_5.webp","path":"images/thumb/thumb_5.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_6.webp","path":"images/thumb/thumb_6.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_7.webp","path":"images/thumb/thumb_7.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_8.webp","path":"images/thumb/thumb_8.webp","modified":1,"renderable":1},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_9.webp","path":"images/thumb/thumb_9.webp","modified":1,"renderable":1}],"Cache":[{"_id":"source/_posts/Django入门-Django-Admin.md","hash":"257de5076992c12b90cc4f0b6b1118d4176586e8","modified":1623835753755},{"_id":"source/_posts/Beautiful-Soup库.md","hash":"3c7726dac5f52bcc3ad95e71464878cf67e8e37c","modified":1623930477184},{"_id":"source/_posts/Django入门-URL分发.md","hash":"6c9583d3f2c862d379ffb3d6c096ba6dbf734ab1","modified":1623835760551},{"_id":"source/_posts/Django入门-模型设计.md","hash":"f00572bcc3dc068b63cb683311d5d06304d075bf","modified":1623835746007},{"_id":"source/_posts/Django入门-视图函数.md","hash":"ee6c197734f3fc9378a43b034c9f6d3562494831","modified":1623772051593},{"_id":"source/_posts/Django入门-静态文件设置.md","hash":"32d6f929fd52abfe02bb77ae0c6d11d92fe69a85","modified":1623835791799},{"_id":"source/_posts/Django入门-系统设计.md","hash":"8def4e11ee85e9ea0354b858847e9b923f812658","modified":1623772051580},{"_id":"source/_posts/FastAPI安装和使用.md","hash":"47a126f8b304b186c86096d3f32ca71e17536a47","modified":1623772051593},{"_id":"source/_posts/Flask安装.md","hash":"187efb3adc1d4c22754a5a6b57c57f38697d14d2","modified":1623772051601},{"_id":"source/_posts/FastAPI教程-用户指南.md","hash":"a118caa7fceb28384cfd2d3984552bad76bcc92d","modified":1623772051601},{"_id":"source/_posts/FastAPI教程-路径参数.md","hash":"b0c99aa0e12d9a672a10d13cb88188167943519d","modified":1623772051601},{"_id":"source/_posts/Flask快速上手.md","hash":"5399c4a90e3515c6c20be02c56ad9ca97e6c6ae8","modified":1623772051601},{"_id":"source/about/index.md","hash":"64c858e66a35966a026142a0135f1f45ffe59716","modified":1623772051641},{"_id":"source/_posts/Hexo在腾讯云的部署.md","hash":"c359cdfc520565ee06b574ca1438e3bedcd0e186","modified":1623727451461},{"_id":"source/_posts/HTTP基本原理.md","hash":"9af756c40867902147fda856a40260ddf8bdc631","modified":1623727451442},{"_id":"source/_posts/MongoDB数据库的使用.md","hash":"dad1070c5b7335643cdcf230b2ed5088d8d16b74","modified":1623727451461},{"_id":"source/_posts/Hexo创建博客.md","hash":"8db5187c9ea50fc851ac59531030e0fa4b716996","modified":1623727451460},{"_id":"source/_posts/Pyppeteer的使用.md","hash":"a16b912444bf103b0b5c84eb81b872b2af7aacc7","modified":1623772051601},{"_id":"source/_posts/Requests库的使用.md","hash":"d29adad6f0040f1fc155fe044f5eff01a43da806","modified":1623946391503},{"_id":"source/_posts/Nginx配置详解.md","hash":"283ef858a7ce86d8003c91024860ddc34228baa4","modified":1623727451462},{"_id":"source/_posts/Pyquery的使用.md","hash":"acd799f76a0d3649ddbb968cd840cc3d0eb71406","modified":1623727451474},{"_id":"source/_posts/Session和Cookies.md","hash":"3d0b1adda8912408aaf24bc105a0ac8a4116df75","modified":1623727451487},{"_id":"source/_posts/Selenium的基本使用.md","hash":"bbbb8c0dc7e9c265115b548318f1ed7625f4d535","modified":1623727451475},{"_id":"source/_posts/XPath库解析.md","hash":"5d474d38c0c178006e956ca11a5d560bfa44d92d","modified":1623930461880},{"_id":"source/_posts/asyncio异步I-O模块.md","hash":"66d9fa8a0f235d3bae67fbd0ef37bc10e2c6d42a","modified":1623930520225},{"_id":"source/_posts/django入门及环境搭建.md","hash":"759ebbc6d0836e7c1c6437c0da791075d88cb713","modified":1623835744091},{"_id":"source/_posts/go语言的下载和安装.md","hash":"247de876ffd5fe4caa2f3fdf35716d3fd02b2c71","modified":1623727451489},{"_id":"source/_posts/Ajax爬取案例实战.md","hash":"162e733be2c18b7497994462409e2760b0f634af","modified":1623727451420},{"_id":"source/_posts/docker的安装.md","hash":"e9a0ec277facfe58ae7f4252471d107d5fd0a545","modified":1623727451488},{"_id":"source/_posts/python多线程基本原理.md","hash":"dcf4ec8fa3453d17d6ff8d8cb8d83c255e2074d1","modified":1623727451492},{"_id":"source/_posts/git常用命令.md","hash":"102c6c7f510e706d38dff6657467df081c3d348c","modified":1623727451488},{"_id":"source/_posts/logging日志模块.md","hash":"fa134c6b4fbce7d39d687a5324fd4cb321f3b17e","modified":1623930533905},{"_id":"source/_posts/Ajax的原理和解析.md","hash":"6edfc2c572aa9fced21049f592c1adf46e3d7679","modified":1623727451428},{"_id":"source/_posts/python的内置类型.md","hash":"5dc53375cd4cb0f0e38fe6c595fb4ea4bb1988f1","modified":1623727451493},{"_id":"source/_posts/python多进程基本原理.md","hash":"9b5a5939766734cc95b7ff71b728e3aca964975c","modified":1623727451492},{"_id":"source/_posts/scrapy框架介绍.md","hash":"875fd4f20540b0d3fd9eb08f7ba8588be09d9bf1","modified":1623727451518},{"_id":"source/_posts/request、pyquest和pymongodb案例实战.md","hash":"3795f2051355c62ac045c4aa3799cf806d23d54f","modified":1623727451503},{"_id":"source/_posts/requests库的基本使用.md","hash":"d1afb97e68860434273e1b94ba7858d02072c17d","modified":1623727451496},{"_id":"source/_posts/re正则表达式操作.md","hash":"ca0385afa6c96841266bd13224b24234d557c922","modified":1623930489717},{"_id":"source/_posts/scrapy的基本使用.md","hash":"ee31cbc9eddf581855e560ca4f0099b25aeadb6d","modified":1623727451519},{"_id":"source/_posts/web网页基础.md","hash":"26a93872792c2840cc55a365f73813381ae9c580","modified":1623727451529},{"_id":"source/_posts/spider的用法.md","hash":"04bfff5df23abff21bb90060d118a5169ba7c02f","modified":1623772051601},{"_id":"source/_posts/在Hexo博客中嵌入外链视频.md","hash":"3cab8feaf710e34ed508ad8b1da1ef00844b61b9","modified":1623727451544},{"_id":"source/_posts/基于centos搭建个人网盘.md","hash":"fdf25cbdff219f2d942747904da5e3574d43ff54","modified":1623727451545},{"_id":"source/_posts/优美图库抓取.md","hash":"fec1470f7f7b438f834efcbda95048598ec19603","modified":1623772051609},{"_id":"source/_posts/南瑞103协议详解.md","hash":"78213c5f7852555c108dc77b7acc49f8bbafa380","modified":1623772051609},{"_id":"source/_posts/基于docker部署code-server.md","hash":"efe6de336152a8548d51e7dfd00251f6316ac0ba","modified":1623727451545},{"_id":"source/_posts/异步爬虫的原理和解析.md","hash":"48a5b6ed9f5ea551854b9302fec9020832be4654","modified":1623772051617},{"_id":"source/_posts/深度优先和广度优先算法.md","hash":"e229cdf993b7c588ee0e177756f4feb2a8c1d673","modified":1623926400996},{"_id":"source/_posts/基于docker安装redis.md","hash":"ee1ef4480c64847461ec3392c37962447d64a861","modified":1623772051609},{"_id":"source/_posts/爬虫去重策略.md","hash":"6a0aa38f1f56700ed3af4d2529e5244b96e01325","modified":1623939390997},{"_id":"source/_posts/爬虫的基本原理.md","hash":"98a73788d56e55ff5c04b578e3f9c93043f2a35a","modified":1623727451551},{"_id":"source/_posts/抓取网易云音乐热评.md","hash":"9d9153fcd8b00cdaf44dfcf6d64b8e325e8ef68d","modified":1623772051617},{"_id":"source/_posts/正则表达式.md","hash":"32ac052d6f8d04160aba8af9481ca0d77672ecc1","modified":1623772051641},{"_id":"source/_posts/腾讯云主机CPU占用百分百.md","hash":"d54ed3cdd0687dec15acbf2927e072c5efe2684f","modified":1623727451551},{"_id":"source/_posts/腾讯云配置ssl证书.md","hash":"272f5edbc3da736a58da9d6e90fa3d728aebc344","modified":1623727451557},{"_id":"source/_posts/经典豆瓣TOP250爬取.md","hash":"440712d6d5ecdf79be7a041698b46853080bbc9a","modified":1623772051641},{"_id":"source/_posts/Ajax爬取案例实战/Screenshot_4.webp","hash":"c2575022523ef6572d0c5325af42f8df21100be8","modified":1623727451427},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_2.webp","hash":"4deffbe63abf667eb7deab992e6fd5f5d8f19658","modified":1623727451431},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_6.webp","hash":"74fe29c473536bc554b6f2f7e75f9f81f11f8ac4","modified":1623727451437},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_5.webp","hash":"c593a73651cc83f71afd2ec983070f834ab00bec","modified":1623727451436},{"_id":"source/_posts/Django入门-Django-Admin/1.PNG","hash":"35a22a299db080425cfd667b7c7b27a48ccfbb1c","modified":1623819524404},{"_id":"source/_posts/Django入门-Django-Admin/3.PNG","hash":"26cfd6a3bd159c5bff29605d07dfe76f7d6f6f1c","modified":1623820140414},{"_id":"source/_posts/Django入门-URL分发/Screenshot_8.webp","hash":"dd1278eded19b37e6de1dbcaca1cd1a44463c1d8","modified":1623772051580},{"_id":"source/_posts/Django入门-Django-Admin/Screenshot_8.webp","hash":"dd1278eded19b37e6de1dbcaca1cd1a44463c1d8","modified":1623772051580},{"_id":"source/_posts/Django入门-Django-Admin/4.PNG","hash":"1ecc472bf902d7b74ee1898cd279f1d69e466a80","modified":1623820299387},{"_id":"source/_posts/Django入门-URL分发/1.PNG","hash":"9d35abb1f87d6ec28fe49d6ba9023154b937f1ef","modified":1623835373864},{"_id":"source/_posts/Django入门-模型设计/Screenshot_8.webp","hash":"dd1278eded19b37e6de1dbcaca1cd1a44463c1d8","modified":1623772051580},{"_id":"source/_posts/Django入门-Django-Admin/2.PNG","hash":"4f72bd3e6952640eff07a8738bf101a9b884104f","modified":1623819597090},{"_id":"source/_posts/Django入门-Django-Admin/5.PNG","hash":"39f05822dcf0e3d96400ff375e55ec37ee38c3a4","modified":1623820319432},{"_id":"source/_posts/Django入门-系统设计/Screenshot_1.webp","hash":"4df62f18261768a9384cba46a0856c0d6736312a","modified":1623772051580},{"_id":"source/_posts/Django入门-系统设计/Screenshot_2.webp","hash":"4fb93d3381fb39ac012e47359adb5412855f6f45","modified":1623772051580},{"_id":"source/_posts/Django入门-系统设计/Screenshot_3.webp","hash":"b9376412947efa5e601502db21bbc59f6a41fc27","modified":1623772051580},{"_id":"source/_posts/Django入门-系统设计/Screenshot_5.webp","hash":"b1ea174116b106bee96615b510c110d875003397","modified":1623772051588},{"_id":"source/_posts/Django入门-系统设计/Screenshot_4.webp","hash":"a3a9dae7a0657fea148815651158aab04ae26999","modified":1623772051580},{"_id":"source/_posts/Django入门-系统设计/Screenshot_6.webp","hash":"b697c29ebf3a9be2d6dddefeeffc57487b52f12b","modified":1623772051593},{"_id":"source/_posts/Django入门-视图函数/Screenshot_1.webp","hash":"8588869c67deb52313a494ce90b2180824267e29","modified":1623772051593},{"_id":"source/_posts/Django入门-视图函数/Screenshot_8.webp","hash":"dd1278eded19b37e6de1dbcaca1cd1a44463c1d8","modified":1623772051593},{"_id":"source/_posts/Django入门-系统设计/Screenshot_8.webp","hash":"dd1278eded19b37e6de1dbcaca1cd1a44463c1d8","modified":1623772051593},{"_id":"source/_posts/Django入门-视图函数/Screenshot_3.webp","hash":"35d86c6e3c7cd5a1fe9260e5bb6046bd93b76d5c","modified":1623772051593},{"_id":"source/_posts/Django入门-视图函数/Screenshot_2.webp","hash":"c27073a292ddd036a96733912453169f1044194f","modified":1623772051593},{"_id":"source/_posts/FastAPI安装和使用/Screenshot_2.webp","hash":"952d0820f1bbb154445365436899230e5925b082","modified":1623772051593},{"_id":"source/_posts/Django入门-静态文件设置/Screenshot_8.webp","hash":"dd1278eded19b37e6de1dbcaca1cd1a44463c1d8","modified":1623772051580},{"_id":"source/_posts/FastAPI教程-路径参数/Screenshot_1.webp","hash":"4aa671b775d8c3c8a639d207e79751adfd4ac72e","modified":1623772051601},{"_id":"source/_posts/Django入门-静态文件设置/2.PNG","hash":"76c7e74ebd4576588e42f2302e2495c5bc0152fd","modified":1623813825243},{"_id":"source/_posts/FastAPI安装和使用/Screenshot_1.webp","hash":"74986affc73b38808c459a6bce07b42d89d7b7fa","modified":1623772051593},{"_id":"source/_posts/HTTP基本原理/webp_0.webp","hash":"5cda1aef076a1f77cacb4ed2a194e2834394de31","modified":1623727451459},{"_id":"source/_posts/Pyppeteer的使用/example.webp","hash":"19d2d652eff072b9f8ed24d7cbdca411d44b211e","modified":1623772051601},{"_id":"source/_posts/Pyppeteer的使用/example1.webp","hash":"81efddc3c37d6878e14c009c3d8742829384e2a2","modified":1623772051601},{"_id":"source/_posts/Selenium的基本使用/Screenshot_3.webp","hash":"5714174e2273c7a9d85bc4d00a279f81d10f2d7b","modified":1623727451479},{"_id":"source/_posts/Selenium的基本使用/Screenshot_8.webp","hash":"684d8530802e1ce1d5109860337382795a98b148","modified":1623727451487},{"_id":"source/_posts/django入门及环境搭建/Screenshot_1.webp","hash":"512f09471a1ffda6a2ac10c4073c8af997cb8fb9","modified":1623772051601},{"_id":"source/_posts/django入门及环境搭建/Screenshot_8.webp","hash":"dd1278eded19b37e6de1dbcaca1cd1a44463c1d8","modified":1623772051580},{"_id":"source/_posts/go语言的下载和安装/Screenshot_2.webp","hash":"9ab82c434734f49b00fa9907ba03aa0c961ea67b","modified":1623727451491},{"_id":"source/_posts/go语言的下载和安装/Screenshot_1.webp","hash":"bb9781574494804cecbeaf411b9eab8e978b39a6","modified":1623727451490},{"_id":"source/_posts/python的内置类型/Screenshot_1.webp","hash":"61f8bfd7758ad8815e38fd4af73bbb51d02e5624","modified":1623727451494},{"_id":"source/_posts/requests库的基本使用/Screenshot_3.webp","hash":"c352952ce59a50999f2edd69707460e4ea0ef415","modified":1623727451502},{"_id":"source/_posts/requests库的基本使用/Screenshot_4.webp","hash":"9a8d44d9355d48fea9a16b85db6f94741b194ec7","modified":1623727451502},{"_id":"source/_posts/scrapy框架介绍/Screenshot_1.webp","hash":"b75a099cb7f90ef9be9f8079c762c5871b2910f5","modified":1623727451519},{"_id":"source/_posts/南瑞103协议详解/Screenshot_1.webp","hash":"1d3f9bd083581039de295612401f3b73a3b79a57","modified":1623772051609},{"_id":"source/_posts/南瑞103协议详解/Screenshot_3.webp","hash":"11d275072c9bb2cefce4043c4732bf257718f8ab","modified":1623772051609},{"_id":"source/_posts/南瑞103协议详解/Screenshot_2.webp","hash":"e602f54cdccfd7c7e4a6b18c20af0c5578d7b596","modified":1623772051609},{"_id":"source/_posts/南瑞103协议详解/Screenshot_4.webp","hash":"b4df0b06e348dd373559f59922412f2cb281c089","modified":1623772051609},{"_id":"source/_posts/南瑞103协议详解/Screenshot_5.webp","hash":"676109c880d0aa8f60f47fc017474a63f80b9420","modified":1623772051609},{"_id":"source/_posts/深度优先和广度优先算法/1.PNG","hash":"9a4efff4f84300499e39fd794a70d67075f32042","modified":1623913016468},{"_id":"source/_posts/深度优先和广度优先算法/1.gif","hash":"c086bccc36e8eebe670abf67d4f18080a4302247","modified":1623915490176},{"_id":"source/_posts/深度优先和广度优先算法/2.PNG","hash":"71b669a174676b7437bcb542a97ed860d5675945","modified":1623913085462},{"_id":"source/_posts/深度优先和广度优先算法/3.PNG","hash":"d880fb8fc86f1939478d0181c661653382615986","modified":1623915186096},{"_id":"source/_posts/深度优先和广度优先算法/4.PNG","hash":"8f961a2a7f93f7ae47e7193b26d15d67aeb09bcd","modified":1623915191713},{"_id":"source/_posts/深度优先和广度优先算法/5.png","hash":"606bc77bf07e8e263e8ad4e1727ae295fba7a906","modified":1623915270496},{"_id":"source/_posts/深度优先和广度优先算法/6.png","hash":"f0b745d6cfb6db3eb3d16544d01de702347ac527","modified":1623915519396},{"_id":"source/_posts/Ajax爬取案例实战/Screenshot_1.webp","hash":"6f8eb27774d4a5f4182842151beacc2819c15096","modified":1623727451422},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_7.webp","hash":"e5d673561d5370a49d9f89e48a528f3786ef0f76","modified":1623727451439},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_4.webp","hash":"d7e798aa6b3b6ad7a22298853c9f234137d38145","modified":1623727451435},{"_id":"source/_posts/Django入门-模型设计/Screenshot_1.webp","hash":"8c81324b088cbde184597537f971503049e7582a","modified":1623772051580},{"_id":"source/_posts/Django入门-系统设计/Screenshot_7.webp","hash":"5c90402d68322a99277a9c62fe91521e0b9c4df3","modified":1623772051593},{"_id":"source/_posts/Selenium的基本使用/Screenshot_1.webp","hash":"4c1dbd186f6472603d353c031b02181215d740e5","modified":1623727451476},{"_id":"source/_posts/Selenium的基本使用/Screenshot_2.webp","hash":"1df3e2110351c6d598a414347d2d715b7ac4b3a9","modified":1623727451478},{"_id":"source/_posts/Selenium的基本使用/Screenshot_4.webp","hash":"6c9be21e922b1cb4099f8ed5a34707d7286005b3","modified":1623727451481},{"_id":"source/_posts/Selenium的基本使用/Screenshot_5.webp","hash":"728868e8a29dd0a1dea0427c8d244e0de4e7aa70","modified":1623727451482},{"_id":"source/_posts/Selenium的基本使用/Screenshot_7.webp","hash":"3d9f705648fa9375ae9143fc280082f493aa0f3c","modified":1623727451486},{"_id":"source/_posts/requests库的基本使用/Screenshot_2.webp","hash":"1a421421def18043cc6bb9583929f0c4c8813c73","modified":1623727451501},{"_id":"source/_posts/request、pyquest和pymongodb案例实战/Screenshot_3.webp","hash":"bca12af16f5833c7f371dfc3c3eca274820bd8a5","modified":1623727451509},{"_id":"source/_posts/request、pyquest和pymongodb案例实战/Screenshot_4.webp","hash":"bc77d73a8f74763fac132af7223e56986c3b5fb3","modified":1623727451511},{"_id":"source/_posts/scrapy的基本使用/Screenshot_2.webp","hash":"b92ca60213e79ed1efc641db00d2a4c0113074b7","modified":1623727451524},{"_id":"source/_posts/基于docker部署code-server/Screenshot_1.webp","hash":"b6358b7ac75a45bce36592548e5c732f41be2aa1","modified":1623727451547},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_4.webp","hash":"21e30d4a3f410cd97b8fafc96e024303762c465f","modified":1623772051633},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_6.webp","hash":"333851195da35d52b191446f3e5935aca93a96aa","modified":1623772051633},{"_id":"source/_posts/正则表达式/Screenshot_1.webp","hash":"e1c8833a8026b1e8c0255be14f3cef05117f8611","modified":1623727451550},{"_id":"source/_posts/Ajax爬取案例实战/Screenshot_2.webp","hash":"703e0f2823f2a8359bec3058626043ce79c90fac","modified":1623727451424},{"_id":"source/_posts/Ajax爬取案例实战/Screenshot_3.webp","hash":"0673e9e7afc64082d4ae24e1a2bb6a63ea40d89a","modified":1623727451426},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_1.webp","hash":"3b76c1cd462a5d790ee6ee6913a4fe0ea9939e4b","modified":1623727451431},{"_id":"source/_posts/HTTP基本原理/1.png","hash":"c7b40fc10675514ee4a907cd6ed5b451b2c84491","modified":1623727451445},{"_id":"source/_posts/Nginx配置详解/1.jpg","hash":"9a45816cf19b79bf32997741a5411fff7f414714","modified":1623727451466},{"_id":"source/_posts/Selenium的基本使用/Screenshot_6.webp","hash":"222603f02ca72672ef9b37b58272aa7c40c319fc","modified":1623727451485},{"_id":"source/_posts/request、pyquest和pymongodb案例实战/Screenshot_2.webp","hash":"bc928e85f843d46e64bfc84c71ec5e36f02e8a86","modified":1623727451509},{"_id":"source/_posts/scrapy的基本使用/Screenshot_1.webp","hash":"e7b29693fcdb1ad13eb3f70c2c273913f282254f","modified":1623727451522},{"_id":"source/_posts/异步爬虫的原理和解析/Screenshot_1.webp","hash":"9a8f4a8b8cd06aabb110931a4c1bddac4f3c5d59","modified":1623772051617},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_3.webp","hash":"d0c7831c000456b317fb257dd027611090e17ccd","modified":1623772051625},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_3.webp","hash":"05806abf32ac862c1fc0bd6d951a52cec43bc402","modified":1623727451434},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_8.webp","hash":"75a2ce77a19e6b163c2721ac000f6b304c1d1a4e","modified":1623727451441},{"_id":"source/_posts/HTTP基本原理/Screenshot_1.png","hash":"5adb41c8f84a13e121fc0f1c528dd40bbb856deb","modified":1623727451449},{"_id":"source/_posts/HTTP基本原理/Screenshot_2.png","hash":"ace6846527b33bf22c4956655f0bd6e3c73ae24f","modified":1623727451454},{"_id":"source/_posts/HTTP基本原理/Screenshot_3.png","hash":"378fabca423cb07c62e41766928483465e65f9a2","modified":1623727451459},{"_id":"source/_posts/Nginx配置详解/2.jpg","hash":"b607fc3234184e21036463e44ed62842734a0854","modified":1623727451469},{"_id":"source/_posts/requests库的基本使用/Screenshot_1.webp","hash":"467c01f42023d9f2a9aa0f6a2ff0ef6debc90862","modified":1623727451499},{"_id":"source/_posts/request、pyquest和pymongodb案例实战/Screenshot_5.webp","hash":"6ae5131d70f9c23ab81202483fc457b9b19c2142","modified":1623727451514},{"_id":"source/_posts/request、pyquest和pymongodb案例实战/Screenshot_6.webp","hash":"d8e5dbb2beadb295313a5f276e03b78c500e7287","modified":1623727451517},{"_id":"source/_posts/优美图库抓取/Screenshot_1.webp","hash":"e90c2f8f0ffe5d677e25f9b8f201dbfedaadda93","modified":1623772051609},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_11.webp","hash":"54450c8e3204e56328ac162ae10d79ae7fb33406","modified":1623772051625},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_10.webp","hash":"0b6c60824cf49a86858fd16931527dc50041137d","modified":1623772051617},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_12.webp","hash":"2fa67b97be4fcbd11cda6fabda14aa3fa4c831c3","modified":1623772051625},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_2.webp","hash":"282ca7461aa0a99f2172d93d1a140e0251a4957d","modified":1623772051625},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_5.webp","hash":"d85502b26203820adfff9e344d491c4db47c07d3","modified":1623772051633},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_9.webp","hash":"c7991072413ef8d5d7a94ae415a049be661c6aef","modified":1623772051641},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_7.webp","hash":"3fde7026f9905d09b7c8cf809c36e8be1fc5ac08","modified":1623772051633},{"_id":"source/_posts/深度优先和广度优先算法/2.gif","hash":"053900c1ac0fcf77509d2a4bed3020c01011d8e7","modified":1623915568454},{"_id":"source/_posts/经典豆瓣TOP250爬取/Screenshot_1.webp","hash":"81f036e2f4aa66b0443ac7da9548cf2b63857219","modified":1623772051641},{"_id":"source/_posts/Django入门-静态文件设置/1.PNG","hash":"4652cbbae0c92426786a3465ce764f33b1e5cb88","modified":1623797804768},{"_id":"source/_posts/Requests库的使用/requests-sidebar.png","hash":"84c5b03f4858f79036cc6c873e2d977abfc58ce2","modified":1623930907553},{"_id":"source/_posts/Nginx配置详解/3.jpg","hash":"5f1a30aceb878b36ec04bbe54d0bd5b821ebab9b","modified":1623727451473},{"_id":"source/_posts/request、pyquest和pymongodb案例实战/Screenshot_1.webp","hash":"6219480dd4f7f473bcdfaae8209a8d10766d9044","modified":1623727451506},{"_id":"source/_posts/scrapy的基本使用/Screenshot_3.webp","hash":"48195fa4642554448c4ffa0e3274ba28776ef1d1","modified":1623727451528},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_1.webp","hash":"684dcd8903da1ffc7cd0aae367e381d91d65a7fc","modified":1623772051617},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_8.webp","hash":"15f0db579f2dbe29dcb1f28c778d3771dc78c87b","modified":1623772051633},{"_id":"source/_posts/腾讯云主机CPU占用百分百/Screenshot_1.webp","hash":"d5834d609c49df60661bd4c708b36ccd54cd272c","modified":1623727451557},{"_id":"themes/Kratos-Rebirth-1.6.3/Kratos-Rebirth-Manual.md","hash":"f121d1cbaec49b0dbffbb6443c887d431f7ee841","modified":1623727451559},{"_id":"themes/Kratos-Rebirth-1.6.3/ReadMe.md","hash":"56b024e036d5eb1b3411130bdc5b586c7042104b","modified":1623727451561},{"_id":"themes/Kratos-Rebirth-1.6.3/_config.yml","hash":"90a9d12f43f7f5b5ffe5fb7bc59cc4ad6e20e3b3","modified":1623772051641},{"_id":"themes/Kratos-Rebirth-1.6.3/package.json","hash":"4a008c56af87b2c63d329b3872e17a44529556d5","modified":1623727451580},{"_id":"themes/Kratos-Rebirth-1.6.3/gulpfile.js","hash":"711430d4be505a3674cc530540a48c112b3f42be","modified":1623727451563},{"_id":"themes/Kratos-Rebirth-1.6.3/_config.yml.example","hash":"d1fc4d9403617602cacd268000fc3b8fff87f067","modified":1623727451562},{"_id":"themes/Kratos-Rebirth-1.6.3/LICENSE","hash":"1eba7caf09a39110ad2f542e3ed8700d1a69c6d3","modified":1623727451560},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/category.ejs","hash":"5677b70953e6a33038a0e03eaa06e45c10ec7d73","modified":1623727451577},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/layout.ejs","hash":"b5ee6bc72a4b0499f0044aabc20a7866d7304a2e","modified":1623727451578},{"_id":"themes/Kratos-Rebirth-1.6.3/languages/zh-CN.yml","hash":"08638ac462cbd495b612d4b131cb2a34180229cb","modified":1623727451564},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/archive.ejs","hash":"8de88e53b499322599025da6395b6b4a8c489bad","modified":1623727451577},{"_id":"themes/Kratos-Rebirth-1.6.3/scripts/404.js","hash":"c8c2775fb0afe8b5d010a36dd50eaf6b72a36f77","modified":1623727451581},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/index.ejs","hash":"554282c0cb749b397b12ab5855117015eb44e1dc","modified":1623727451578},{"_id":"themes/Kratos-Rebirth-1.6.3/scripts/cdn-optimize-helpers.js","hash":"063a81cb5d2888f52c8190aae25c29e6de41172b","modified":1623727451582},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/tag.ejs","hash":"5677b70953e6a33038a0e03eaa06e45c10ec7d73","modified":1623727451580},{"_id":"themes/Kratos-Rebirth-1.6.3/scripts/check-update.js","hash":"645a1f30fa21237b256d5fa7c0a0923032728901","modified":1623727451582},{"_id":"themes/Kratos-Rebirth-1.6.3/scripts/friends.js","hash":"2d9395526e74bfcdb46eaf3aac2dc0be748ff0b8","modified":1623727451583},{"_id":"themes/Kratos-Rebirth-1.6.3/scripts/search.js","hash":"e477a7e9a0ae009056120d4fd2040a296c28adad","modified":1623727451584},{"_id":"themes/Kratos-Rebirth-1.6.3/scripts/genconfig.js","hash":"bc3a7d5dd918fe1e4da17098e2f60a34e9cbbe50","modified":1623727451584},{"_id":"themes/Kratos-Rebirth-1.6.3/scripts/tag-widgets.js","hash":"0dda6634cbfb60594ba06b16d30532f9fe358339","modified":1623727451585},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/post.ejs","hash":"7baed15e1fbce4585bc5e3bd940ec1edf114b5d2","modified":1623727451579},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_comments/twikoo.ejs","hash":"cf4659ba38d851c114c91e63f4e465538fe7b75a","modified":1623727451566},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/page.ejs","hash":"e7d5671d342ac7c594b493d30cddcc15206cd5e6","modified":1623727451579},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_comments/disqus.ejs","hash":"e107a146259123fe3c1bdde4d6a33836efdcd36c","modified":1623727451565},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_comments/disqusjs.ejs","hash":"be784505c370fa683189a5220c51119e0afb57d5","modified":1623727451566},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_comments/waline.ejs","hash":"ed05efb5c1a13b23e3fc50a4061434e82b82bdaf","modified":1623727451567},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_comments/valine.ejs","hash":"30942c85e9e8471e2885237b0589cf3ecf8cc0dc","modified":1623727451567},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_partial/after-footer.ejs","hash":"d7e2ebcd3763d233f8335caef6dc5e55d54ea952","modified":1623727451569},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_pages/search-page.ejs","hash":"7a3fd8ceddd14dadf4e419b453bf799273430b75","modified":1623727451568},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_pages/404.ejs","hash":"0769195fc28d4153607bfd1ff78efdcd8f907710","modified":1623727451568},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_partial/footer.ejs","hash":"825a989ffe78fc18327a62801b6dccb580f9b2f6","modified":1623727451570},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_partial/sidebar.ejs","hash":"33395d7d7dcfdbf7d451b320ed778ddc9409cbc3","modified":1623727451571},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_partial/head.ejs","hash":"d8ae70df82dfa6948cd6a7be5405986713476bd6","modified":1623727451570},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_plugins/mermaid.ejs","hash":"3f7ed41957dda08d4e185b177685f3201bb7af60","modified":1623727451572},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_partial/header.ejs","hash":"f54adfdbd4341cd25d4b0941a97c225eed6f69e5","modified":1623727451571},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_widget/about.ejs","hash":"f355b8e8e1e9f2c912c77796ff616940cc34acba","modified":1623727451574},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_tools/player.ejs","hash":"5c3ad00ab73158d9c2a5f94a637369ffba676131","modified":1623727451573},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_widget/category.ejs","hash":"7141cc95eeb460f016d5cb16ce1121423a680f64","modified":1623727451575},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_widget/tagcloud.ejs","hash":"463a1e41aeaaff8b30fc4cff961181a73e007b60","modified":1623727451575},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_widget/posts.ejs","hash":"a95e8afadec17d644d590769ccf6a82911a544f9","modified":1623727451575},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_widget/toc.ejs","hash":"3f605d61df121f80b101eaf6ff6031d3dad5320e","modified":1623727451576},{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/kr-dark.min.css","hash":"f7b46640737a826b1a9e47f2e01cd594ea2d9bef","modified":1623727451589},{"_id":"themes/Kratos-Rebirth-1.6.3/layout/_tools/share.ejs","hash":"0384875f82a28bc4ab3fa3383f9471da16e37c27","modified":1623727451573},{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/kratosr.min.css","hash":"5e346823c3171f6c91d00de969801442e3429599","modified":1623727451589},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/about.webp","hash":"ca0fb739ab4426e7895742c1d8d52df1e14468e8","modified":1623727451592},{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/prismjs.min.css","hash":"897b51649b0557cf3c018b378b680897a76d991f","modified":1623727451590},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/avatar.webp","hash":"3ed6e4e1e08e9c2700aa149d1f9e068fb02947cd","modified":1623727451593},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/banner.webp","hash":"7c5093243bfd581a633ba8a905e2d379cfa78c00","modified":1623727451595},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/bg.webp","hash":"f232b442b64eaa90f45a48ff04d8e7d352caf212","modified":1623727451597},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/404.webp","hash":"d2e2bd5cc2627a2b04d5e449a67949a2605ae13e","modified":1623727451591},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/alipay.webp","hash":"01fa6151d2122f0470ee6f38ac8e4ced6c81912e","modified":1623727451593},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/logo.webp","hash":"ad57efa7bf7cfe2b55857a5e1c917d67e268801d","modified":1623727451599},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/failure.ico","hash":"5eec5c163400d8ece74286da49130da1ead3f6f6","modified":1623727451598},{"_id":"themes/Kratos-Rebirth-1.6.3/source/js/candy.min.js","hash":"498e898190d24fc715c3ea9dd4daf671b88356c2","modified":1623727451619},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/banner_dark.webp","hash":"5589986444825e2b75c369d419ff736d3a396bac","modified":1623727451596},{"_id":"themes/Kratos-Rebirth-1.6.3/source/js/kr-dark.min.js","hash":"88c53d1b213f43e00f29007f0af8ceeba862a792","modified":1623727451619},{"_id":"themes/Kratos-Rebirth-1.6.3/source/js/kratosr.min.js","hash":"ab52ef5e952d6f011aff6cef0643f204eb5d8189","modified":1623727451620},{"_id":"themes/Kratos-Rebirth-1.6.3/source/js/pjax.min.js","hash":"9e019ddcca0e5fad1728c577ea53d9df27ba3153","modified":1623727451622},{"_id":"themes/Kratos-Rebirth-1.6.3/source/js/snow.min.js","hash":"da76343827179b60fb0ff37f5e174e0d1a942715","modified":1623727451622},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/wechat.webp","hash":"06f3997bf554768c04cb588198c7b3d68c21b8e9","modified":1623727451618},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/psr.webp","hash":"bf457bf84bca767bac1bd2b960d91c53ba3fbdee","modified":1623727451602},{"_id":"themes/Kratos-Rebirth-1.6.3/source/js/local-search.min.js","hash":"b64846254b2ab9f4582d896f01803c20460425f6","modified":1623727451621},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/candy.min.js.map","hash":"6665b21a65483d2344c471dc5c756c4d387d568b","modified":1623727451623},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/kr-dark.min.css.map","hash":"80ee66d1f262f9aa4a9b6960b0f8ff2fec14eb34","modified":1623727451624},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/kr-dark.min.js.map","hash":"d021646d1ea23cb79c169ce84799e85e7d19540e","modified":1623727451624},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/local-search.min.js.map","hash":"b831de42d16beb1d8dd9a2d548422cbf1ee04314","modified":1623727451628},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/night-blue.min.css.map","hash":"311ec6106ef1523d8725b5e2b73203adefce0599","modified":1623727451629},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/light.min.css.map","hash":"b32142f58c42be8f25909a5c212364bb5c6fc804","modified":1623727451627},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/night-eighties.min.css.map","hash":"e283eba0a0ce4f94234d725b13d018898ecad8d7","modified":1623727451630},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/kratosr.min.js.map","hash":"b0d79ecf02c98ceecc14b9fa64160d186f20662c","modified":1623727451627},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/night-bright.min.css.map","hash":"dd0d8c53d2794a7f64a48beaefc818ad37b74a76","modified":1623727451629},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/pjax.min.js.map","hash":"99e4cc9e361aeca9faf20a01b673e81d8fa4b895","modified":1623727451631},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/snow.min.js.map","hash":"7c02278b2e50e5df0b19404baee1d31c2b6c0f76","modified":1623727451632},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/prismjs.min.css.map","hash":"0c8ce3221dc6e6c95ae2a31f26d5c90bf090077c","modified":1623727451632},{"_id":"themes/Kratos-Rebirth-1.6.3/src/js/candy.js","hash":"92f106471f1b446226da12e2f407cd9c71beb6d8","modified":1623727451633},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/night.min.css.map","hash":"98d68627b48700be8632f377bbe23adc2fa1c664","modified":1623727451631},{"_id":"themes/Kratos-Rebirth-1.6.3/src/js/kr-dark.js","hash":"2f5c290e7cce5dd8e4aa0c8492fc9111064bd7c3","modified":1623727451634},{"_id":"themes/Kratos-Rebirth-1.6.3/src/js/local-search.js","hash":"8e5f05a61c195f5e5ffcf0834ac83dc154eb34c7","modified":1623727451636},{"_id":"themes/Kratos-Rebirth-1.6.3/src/js/kratosr.js","hash":"a7e77063e17551aec088110a627a792cd3a08a85","modified":1623727451635},{"_id":"themes/Kratos-Rebirth-1.6.3/src/js/pjax.js","hash":"466805aedd764376d4bd94edfc05d38d9213f956","modified":1623727451636},{"_id":"themes/Kratos-Rebirth-1.6.3/src/js/snow.js","hash":"f38cf6daf376da460d8bf58506dce37789500d68","modified":1623727451637},{"_id":"themes/Kratos-Rebirth-1.6.3/src/scss/prismjs.scss","hash":"2575922312729ec354d5889e28f4860917a9cac6","modified":1623727451643},{"_id":"themes/Kratos-Rebirth-1.6.3/src/scss/kratosr.scss","hash":"bed24d526511014d8b15b983d2410e25b3a6b00e","modified":1623727451643},{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/highlight/night-eighties.min.css","hash":"f39c1205e030454e5724ff98b1703a1fddfe91f2","modified":1623727451588},{"_id":"themes/Kratos-Rebirth-1.6.3/src/scss/kr-dark.scss","hash":"d9056a938776f64f25b9ca47c7c30ff514c5768a","modified":1623727451641},{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/highlight/light.min.css","hash":"233726caed5966fd44bda443410a40e305c35b47","modified":1623727451586},{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/highlight/night-blue.min.css","hash":"b7163c860fe4becb4bb4c5804f0c43b8bd1f18b7","modified":1623727451587},{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/highlight/night-bright.min.css","hash":"a8f6dfe093e5f802fb531cc1177207ce8c6fce27","modified":1623727451587},{"_id":"themes/Kratos-Rebirth-1.6.3/source/css/highlight/night.min.css","hash":"12b41d97f274bc1be0c487f0f6c1d443a4cf7d60","modified":1623727451588},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_10.webp","hash":"4983eeca7886bbe7c09b0c79f4774302fdfa1315","modified":1623727451603},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_1.webp","hash":"a818f050112ceb75e3a60dc1673a10783b254595","modified":1623727451603},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_11.webp","hash":"08d8d91e2b01768842abb47cd48a0f07d22d070c","modified":1623727451604},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_12.webp","hash":"b6b8e1281f9146925e45e937cb4d5b28bcabe957","modified":1623727451605},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_13.webp","hash":"c4c9050637f4ffa3cb7d782f59dadc993ac3a6de","modified":1623727451606},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_14.webp","hash":"f9300e2b45c1f061ec8cc21527142dafc558a9e6","modified":1623727451607},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_16.webp","hash":"61714ccffd55d6fa74cf94bcdd5a464da04ce891","modified":1623727451608},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_15.webp","hash":"8629f2a7d3b0192549f809e6b7479159af0222da","modified":1623727451608},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_17.webp","hash":"b5a036ec234a23c820a89d1c640b1f2e8dd3dfa4","modified":1623727451609},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_18.webp","hash":"5bc78b9d6cb0a0cf6daa3a35b93e575777a49ddd","modified":1623727451610},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_19.webp","hash":"15e0cd0cbe5c7166915a4b68680681beccc2afef","modified":1623727451610},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_2.webp","hash":"1bcf7461c2b9408b8a893013fa425eb46701faf6","modified":1623727451611},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_20.webp","hash":"4ab961d94a0d3abbefc7f6d9188a889ec2225e7a","modified":1623727451612},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_4.webp","hash":"1d0f136590632e7ba31f5510d24891ba443f1f33","modified":1623727451613},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_5.webp","hash":"ba384ada1c2a17b67036addd68ffa1f604ab5a41","modified":1623727451614},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_7.webp","hash":"4be8fe8ea1b3563b78924062e3aa013cd5c4e82b","modified":1623727451616},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_6.webp","hash":"c2d8b68971dacd111566526f64d94932f5c6f076","modified":1623727451615},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_9.webp","hash":"bca69e7d56982b43c52e9ffa17c8d5bb268834d8","modified":1623727451617},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_3.webp","hash":"3faffd2575e0751526249c5c56a2a5045a21363b","modified":1623727451613},{"_id":"themes/Kratos-Rebirth-1.6.3/src/scss/highlight/theme/night-blue.scss","hash":"9d7b9690331b850e6b92da10e57254e2bd9d294d","modified":1623727451639},{"_id":"themes/Kratos-Rebirth-1.6.3/src/scss/highlight/theme/light.scss","hash":"1fa05c806415127e3833315adb10443ca128b927","modified":1623727451639},{"_id":"themes/Kratos-Rebirth-1.6.3/src/scss/highlight/theme/night-bright.scss","hash":"8c1a12a963c0ff01d46f4e452b2c8ac7419465bd","modified":1623727451640},{"_id":"themes/Kratos-Rebirth-1.6.3/src/scss/highlight/style.scss","hash":"6b9174d41d9d397e7498309eb16af5bb86ebb2ed","modified":1623727451638},{"_id":"themes/Kratos-Rebirth-1.6.3/src/scss/highlight/theme/night-eighties.scss","hash":"770bf47845991ce76ccb87e02ea63e1158b74b39","modified":1623727451640},{"_id":"themes/Kratos-Rebirth-1.6.3/src/scss/highlight/theme/night.scss","hash":"3bad0f8ac6be471a6d290f8b72a8ece8ca52f13e","modified":1623727451641},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/thumb/thumb_8.webp","hash":"9e6d74786d8459440d68c409eb654364dd279f8a","modified":1623727451617},{"_id":"themes/Kratos-Rebirth-1.6.3/source/maps/kratosr.min.css.map","hash":"79db71048315b161ee4bd150c02f74bcf2afa6cc","modified":1623727451626},{"_id":"themes/Kratos-Rebirth-1.6.3/source/images/my.webp","hash":"4ca18265439440b696893bbd8af9501511903a77","modified":1623727451601},{"_id":"source/_posts/web网页基础/Screenshot_1.png","hash":"4466945441b85dc63432a583c23eec13419f8a5d","modified":1623727451541},{"_id":"public/search.json","hash":"1bfdf10c83f7e03c4379be6197671793aeaab06d","modified":1623948109345},{"_id":"public/config/main.json","hash":"65767c0374f3753e6c22ca74a99805eef7d7b163","modified":1623948109345},{"_id":"public/404.html","hash":"16a15b9a1242b1f71f469861522655e979af5ac6","modified":1623948109345},{"_id":"public/2021/06/17/Requests库的使用/index.html","hash":"c0e589afb18bc7e1566f61f6ad443352fa9dcade","modified":1623948109345},{"_id":"public/about/index.html","hash":"4fa368f4d24cfaa9cf7438e5bee5b65e9e77d358","modified":1623948109345},{"_id":"public/2021/06/17/爬虫去重策略/index.html","hash":"cc322d3c112cffc5b030a545e100e85e38bdda6a","modified":1623948109345},{"_id":"public/2021/06/16/深度优先和广度优先算法/index.html","hash":"d04d2881d78e25b6e7be2b35fa569ebfa6281c24","modified":1623948109345},{"_id":"public/2021/06/16/Django入门-URL分发/index.html","hash":"aefcbeb3270bdb990fd01d124c8e0624a78f7e54","modified":1623948109345},{"_id":"public/2021/06/16/Django入门-Django-Admin/index.html","hash":"155f9e98bf3787b51e9a7bd6b1ba8861e1d61b09","modified":1623948109345},{"_id":"public/2021/06/16/Django入门-静态文件设置/index.html","hash":"126515aaf2e3a0177212d74aae242be3eabe0bde","modified":1623948109345},{"_id":"public/2021/06/15/python多线程基本原理/index.html","hash":"8d9c6aae4660565eb7a19dfa3b88d9250a46f44f","modified":1623948109345},{"_id":"public/2021/06/11/Django入门-视图函数/index.html","hash":"93d2f5699f5e7f36b5fb50cf526ab7d01837378e","modified":1623948109345},{"_id":"public/2021/06/10/抓取网易云音乐热评/index.html","hash":"8798e5cc5982f17582cab24d3efe284f91257239","modified":1623948109345},{"_id":"public/2021/06/09/Django入门-模型设计/index.html","hash":"02b2bd4e7911209860757b4222fa0dd393e541d0","modified":1623948109345},{"_id":"public/2021/06/09/Django入门-系统设计/index.html","hash":"4b034859b57dc2452b73abdf146d7cbda87e3027","modified":1623948109345},{"_id":"public/2021/06/08/spider的用法/index.html","hash":"dfe934db894521016727238456f5614566d8be07","modified":1623948109345},{"_id":"public/2021/06/07/django入门及环境搭建/index.html","hash":"d51f49355b4e6bb2bf7e5fa1a70bc7739b47574d","modified":1623948109345},{"_id":"public/2021/06/06/XPath库解析/index.html","hash":"802c4937b3c26747504bc4a38c3603f3c973f082","modified":1623948109345},{"_id":"public/2021/06/06/优美图库抓取/index.html","hash":"7c78094401c6081edd0a6c265f52500bdbcaab4f","modified":1623948109345},{"_id":"public/2021/06/05/Beautiful-Soup库/index.html","hash":"b21d4670b6c91bdb2d13ca4e197dd4ac3542fd95","modified":1623948109345},{"_id":"public/2021/06/04/re正则表达式操作/index.html","hash":"9714c8a26c9f5fc6f4195a60d48218466005e0fd","modified":1623948109345},{"_id":"public/2021/06/04/经典豆瓣TOP250爬取/index.html","hash":"8600a94cbf95f9e979ccc87edc0543375f31ab7e","modified":1623948109345},{"_id":"public/2021/06/04/基于docker安装redis/index.html","hash":"5b51dcbe2bfd1379481259671572335b1129a0f9","modified":1623948109345},{"_id":"public/2021/06/03/asyncio异步I-O模块/index.html","hash":"49063ea4bd77cbf101b8df15343c7bccf2e12a0f","modified":1623948109345},{"_id":"public/2021/06/02/Pyppeteer的使用/index.html","hash":"0d545f63bbc77b0df7bce482c330e31acc8359f1","modified":1623948109345},{"_id":"public/2021/06/02/logging日志模块/index.html","hash":"7764731aecf8ab56202d590857e3172d5e8bc4b8","modified":1623948109345},{"_id":"public/2021/06/01/南瑞103协议详解/index.html","hash":"d9620315710ab0c0e9698299b071fed2ee906170","modified":1623948109345},{"_id":"public/2021/05/31/异步爬虫的原理和解析/index.html","hash":"20545f6f018de3c237ad4dcfa06a33a762a8febd","modified":1623948109345},{"_id":"public/2021/05/30/FastAPI教程-路径参数/index.html","hash":"038b8861f88a52ad807d7e70000765b566fe582b","modified":1623948109345},{"_id":"public/2021/05/30/FastAPI教程-用户指南/index.html","hash":"cf4a18ee471f3190a6bb748579f0a61a87a9fb52","modified":1623948109345},{"_id":"public/2021/05/30/FastAPI安装和使用/index.html","hash":"949a8447fbc5c986d4491b279b5e865642dca07a","modified":1623948109345},{"_id":"public/2021/05/30/Flask快速上手/index.html","hash":"ad1400a0d4379e20cde0aaf5222ba822d8cbf7f2","modified":1623948109345},{"_id":"public/2021/05/30/Flask安装/index.html","hash":"8b92350160aed9cafe40df8c22794dbf89841892","modified":1623948109345},{"_id":"public/2021/05/29/scrapy的基本使用/index.html","hash":"0d0dd51c347c4cbd40877bb9932ace96fc5b6f48","modified":1623948109345},{"_id":"public/2021/05/29/scrapy框架介绍/index.html","hash":"36710bfeff350cfb0618b76c146cf8d2c7099f0f","modified":1623948109345},{"_id":"public/2021/05/28/python的内置类型/index.html","hash":"953e8051e1a0d64a536c94ac8e89d05e03514853","modified":1623948109345},{"_id":"public/2021/05/26/go语言的下载和安装/index.html","hash":"520ca5d2c2e076871eff3aa65dc20da08eaba0a2","modified":1623948109345},{"_id":"public/2021/05/25/Selenium的基本使用/index.html","hash":"968c420f5a718666d8fda5062f59f613ee89385a","modified":1623948109345},{"_id":"public/2021/05/25/基于docker部署code-server/index.html","hash":"54e3d6c8de9aec49877a75de45dc28c8310c3a96","modified":1623948109345},{"_id":"public/2021/05/25/腾讯云主机CPU占用百分百/index.html","hash":"104ed3e58ec989080affba1b2de7609b8c69ff8e","modified":1623948109345},{"_id":"public/2021/05/24/Ajax爬取案例实战/index.html","hash":"6e0b74d9c769d008486f538d01641ab99535bca3","modified":1623948109345},{"_id":"public/2021/05/24/Ajax的原理和解析/index.html","hash":"c1a693ce63a2ccd85e59341b54ad0376744e5c28","modified":1623948109345},{"_id":"public/2021/05/23/request、pyquest和pymongodb案例实战/index.html","hash":"3ce1da758cc0d6e9a70e82e2ef7e237e3c97c92b","modified":1623948109345},{"_id":"public/2021/05/23/MongoDB数据库的使用/index.html","hash":"e3175e841a004c02d2249c9e670d346fc444325c","modified":1623948109345},{"_id":"public/2021/05/23/Pyquery的使用/index.html","hash":"ef87e61f5e498e6f7a68ead6f465d90ecf21cbb5","modified":1623948109345},{"_id":"public/2021/05/21/正则表达式/index.html","hash":"56b92e05a538f278285b8ce54bf02d558d1d4ba4","modified":1623948109345},{"_id":"public/2021/05/20/docker的安装/index.html","hash":"e358ed2b83337dedbb915c21a3205b01333a9087","modified":1623948109345},{"_id":"public/2021/05/18/requests库的基本使用/index.html","hash":"18e268febe460e9dc73c221c16e090e0d3af122f","modified":1623948109345},{"_id":"public/2021/05/20/基于centos搭建个人网盘/index.html","hash":"1ee46b0aabdefa13a7d237b209bcf22d69efa6c8","modified":1623948109345},{"_id":"public/2021/05/18/Nginx配置详解/index.html","hash":"5c19306c8c31f1362ee8a45ce9209fc2d4ccb7a2","modified":1623948109345},{"_id":"public/2021/05/17/python多进程基本原理/index.html","hash":"d974239606d6c3a4b211bc0c26a7c702b3d29dbc","modified":1623948109345},{"_id":"public/2021/05/12/Session和Cookies/index.html","hash":"2d2c23579da836c6a86ebe9499778f126b52ed65","modified":1623948109345},{"_id":"public/2021/05/12/爬虫的基本原理/index.html","hash":"009b96b6bf2cffdc476c942017276ab2523aa84e","modified":1623948109345},{"_id":"public/2021/05/11/web网页基础/index.html","hash":"4f3751e9deeb35830cd775a5d96522534d32f0f2","modified":1623948109345},{"_id":"public/2021/05/11/在Hexo博客中嵌入外链视频/index.html","hash":"56df116d1688e923cabbd58901cacc34f499615a","modified":1623948109345},{"_id":"public/2021/05/10/腾讯云配置ssl证书/index.html","hash":"7fe3934bb8983099daf3f8ce9b1a11864b8bed8f","modified":1623948109345},{"_id":"public/2021/05/10/Hexo在腾讯云的部署/index.html","hash":"f2db049b246a558054a74f8e4e4ebae12cbee897","modified":1623948109345},{"_id":"public/2021/05/09/HTTP基本原理/index.html","hash":"2a30fb27a3af47778ce6a821a73cca0cbe2c69f4","modified":1623948109345},{"_id":"public/2021/05/08/git常用命令/index.html","hash":"f478fcc9c7f9ba5f085b3e46a44a107331480fb4","modified":1623948109345},{"_id":"public/2021/05/08/Hexo创建博客/index.html","hash":"8de14460b17b5c9ee613e1724a3fc5d474029b6a","modified":1623948109345},{"_id":"public/archives/index.html","hash":"32b062dfc579fe50822635991d03eedb48bd79f6","modified":1623948109345},{"_id":"public/archives/page/2/index.html","hash":"f90f2386e86c3dea4d9093540b2726ce86e8edbf","modified":1623948109345},{"_id":"public/archives/page/3/index.html","hash":"11278e9479a075bd3630e16dfaa229a68611bf70","modified":1623948109345},{"_id":"public/archives/page/4/index.html","hash":"f6087099d12e704558bd49ccaacf31e67d7b7ca9","modified":1623948109345},{"_id":"public/archives/page/5/index.html","hash":"665853921ddedc030cdb1f1fe9188db489b27e6a","modified":1623948109345},{"_id":"public/archives/page/6/index.html","hash":"af6d1476a50f7eff08ede2cf5598c77a117a0048","modified":1623948109345},{"_id":"public/archives/2021/index.html","hash":"524426885fc75b2c59e7906e8fcd78fe345ce746","modified":1623948109345},{"_id":"public/archives/2021/page/2/index.html","hash":"e2040f841007b99ce580aae216bb8de507d2296c","modified":1623948109345},{"_id":"public/archives/2021/page/3/index.html","hash":"1467675fac9ff5c43002d26070aa070a546ac144","modified":1623948109345},{"_id":"public/archives/2021/page/4/index.html","hash":"defd388ce1af47be0004b464bde503b657fdc756","modified":1623948109345},{"_id":"public/archives/2021/page/5/index.html","hash":"f4f0d90dca80901af1ae9fabb1ddec6269d872fd","modified":1623948109345},{"_id":"public/archives/2021/page/6/index.html","hash":"938e267c93457bd6c4f4ace95be72d4b04da4218","modified":1623948109345},{"_id":"public/archives/2021/05/index.html","hash":"9dd748faae06f2331ef5ecbda66cf5ff1b4198ae","modified":1623948109345},{"_id":"public/archives/2021/05/page/2/index.html","hash":"d479a6ae0e6737ebc114389459e6f770a26c854a","modified":1623948109345},{"_id":"public/archives/2021/05/page/3/index.html","hash":"35c0838e3016baf798c278efdbfbf029327b02a7","modified":1623948109345},{"_id":"public/archives/2021/05/page/4/index.html","hash":"01d2250e1cd2bc924dab30932943f0767b54df19","modified":1623948109345},{"_id":"public/archives/2021/06/index.html","hash":"164efc297108a8c77d6714643f4cfe836510b362","modified":1623948109345},{"_id":"public/archives/2021/06/page/2/index.html","hash":"40bc0ff396b9082b10d742fbc16aa2ff6beb803b","modified":1623948109345},{"_id":"public/archives/2021/06/page/3/index.html","hash":"f75c15666029fc18531f50d00d96dd371679f240","modified":1623948109345},{"_id":"public/categories/爬虫/index.html","hash":"3994a89011e0fed8cec5a72125dd8be04b358470","modified":1623948109345},{"_id":"public/categories/爬虫/page/2/index.html","hash":"d7df8a8cbf789ce162faea2aa22560d0801d7b1e","modified":1623948109345},{"_id":"public/categories/爬虫/page/3/index.html","hash":"2846e7a972822c1ac55327968f71599663b2b11f","modified":1623948109345},{"_id":"public/categories/Python库/index.html","hash":"50353082e9c2d49093cbb65a5d24f40e735a9afd","modified":1623948109345},{"_id":"public/categories/Django/index.html","hash":"90766dad2ca361bc0b815cac4efa5f7af2cca376","modified":1623948109345},{"_id":"public/categories/FastAPI/index.html","hash":"d0601249a429074ec7130f03018ff99c4b9af7f9","modified":1623948109345},{"_id":"public/categories/Flask/index.html","hash":"2478d5061d4b5755f8ba2ab09200fea38a65e73b","modified":1623948109345},{"_id":"public/categories/博客教程/index.html","hash":"40e6291869b0b9b8ed432d53d226b4a11ecf9f9f","modified":1623948109345},{"_id":"public/categories/Nginx/index.html","hash":"e5986b567616e43a707a2eceeb96a20ba3724d77","modified":1623948109345},{"_id":"public/categories/Linux/index.html","hash":"3fffe9d5cf2344078ce5088ce1307753112ce3a4","modified":1623948109345},{"_id":"public/categories/Git/index.html","hash":"6aaf24c5677242f7dc786e9769d49b69e9e522a2","modified":1623948109345},{"_id":"public/categories/Go/index.html","hash":"92403c1f9f04d9c701259a64e2bbb2b801009bb4","modified":1623948109345},{"_id":"public/categories/Python/index.html","hash":"4c57cbd55d33e1275a4f5209696b5df9942a51e5","modified":1623948109345},{"_id":"public/categories/自动化/index.html","hash":"484a26c4a14e0f622d86c3900d15c4764519f7c2","modified":1623948109345},{"_id":"public/categories/Docker/index.html","hash":"956f0f523d1f7cb1e4a37a8be6d697f361090506","modified":1623948109345},{"_id":"public/categories/算法/index.html","hash":"b76c93e3833bfdcd12a0598411018902e2dcc447","modified":1623948109345},{"_id":"public/index.html","hash":"2aeb61104e9d1ba31ac4ce87501679425f2f2ceb","modified":1623948109345},{"_id":"public/page/2/index.html","hash":"db4d1a1aa7a12f82d68bca1f6dd9be2be8b6b85a","modified":1623948109345},{"_id":"public/page/3/index.html","hash":"ee420213f8c2ec43440d38c11e7a12554415cd2e","modified":1623948109345},{"_id":"public/page/4/index.html","hash":"f1150c2bcc9111ad926587c2f4cfa11d32e8e62f","modified":1623948109345},{"_id":"public/page/5/index.html","hash":"84fa4abba33d1f9fada2df1ea50ebc8569c444e8","modified":1623948109345},{"_id":"public/page/6/index.html","hash":"33b6d8b90b8966a11d1d774e82510b11ee84c04e","modified":1623948109345},{"_id":"public/tags/ajax/index.html","hash":"ac94f55fd74e2ef6c021261e12073764fd7eac93","modified":1623948109345},{"_id":"public/tags/python/index.html","hash":"85371ef7e5c0914635bb552e8b29f7aa264f47df","modified":1623948109345},{"_id":"public/tags/python/page/2/index.html","hash":"71e7018f16c0d6066762fe7a81239b5397e480ae","modified":1623948109345},{"_id":"public/tags/python/page/3/index.html","hash":"9389cb39cbe2a2b301f5174a8233d53300abc595","modified":1623948109345},{"_id":"public/tags/javascript/index.html","hash":"204ca4ad60beae9a7e166d8d46905d428eba3bb2","modified":1623948109345},{"_id":"public/tags/bs4/index.html","hash":"7ea2e7a3cfd724bdd90a728d206755011ed428a8","modified":1623948109345},{"_id":"public/tags/django/index.html","hash":"66f5870e1f1431793b73eccf401e0df2c933d45f","modified":1623948109345},{"_id":"public/tags/fastapi/index.html","hash":"d597719421f853b88627a8eb44ce0952961e922b","modified":1623948109345},{"_id":"public/tags/flask/index.html","hash":"b5c7127342c2a97c140b5b522cdff4cf0a068543","modified":1623948109345},{"_id":"public/tags/Hexo/index.html","hash":"5c3135090b3166d53e237837db095ca731d00fcc","modified":1623948109345},{"_id":"public/tags/mongodb/index.html","hash":"813306c812ebc79f274d991c277ea7bab4a0b79c","modified":1623948109345},{"_id":"public/tags/Nginx/index.html","hash":"7026860e1a2e571e1c71ba1e21c4c414cffbbf6d","modified":1623948109345},{"_id":"public/tags/负载均衡/index.html","hash":"10ce6fb648efcb04e46296821b88b02bb03d95cf","modified":1623948109345},{"_id":"public/tags/http/index.html","hash":"41797bec4093770d2504b0ea40b3996b85dd8948","modified":1623948109345},{"_id":"public/tags/pypprteer/index.html","hash":"bfc86162c8b73b9fff75c284db1692821475f0f2","modified":1623948109345},{"_id":"public/tags/web/index.html","hash":"29b1a2b09ce6d7ac0b7ba3d27295686bb4376199","modified":1623948109345},{"_id":"public/tags/xpath/index.html","hash":"12b09f86ca9282a3495000fd06e673ac11339f9c","modified":1623948109345},{"_id":"public/tags/lxml/index.html","hash":"1160634a71ff394fc7716d600afcd97739816275","modified":1623948109345},{"_id":"public/tags/asyncio/index.html","hash":"29e2da42f361ddc4f4ce59b3af1134cf37395bed","modified":1623948109345},{"_id":"public/tags/linux/index.html","hash":"bae473799b7007445df5532955c53565a5fc2a94","modified":1623948109345},{"_id":"public/tags/docker/index.html","hash":"f98000287e57b297080fdd2c04efb75003f0e0cf","modified":1623948109345},{"_id":"public/tags/Git/index.html","hash":"b308f73625a93f2dc2388ff4696af6fd94a37719","modified":1623948109345},{"_id":"public/tags/go/index.html","hash":"6a8f6c96176d9ee7d9eca27baee9b9748be0b9df","modified":1623948109345},{"_id":"public/tags/logging/index.html","hash":"b1fbebb7e80540c5abbc775ae228df5a569b836a","modified":1623948109345},{"_id":"public/tags/多线程/index.html","hash":"77bbe84ee797fd21d71cd69f99ef43fda3a10941","modified":1623948109345},{"_id":"public/tags/threading/index.html","hash":"e15f56ff0e321eaae42e24cd55cfc4e6f678ec7d","modified":1623948109345},{"_id":"public/tags/re/index.html","hash":"5396a1855bb0726c05a3e1345d3c3866ba900867","modified":1623948109345},{"_id":"public/tags/scrapy/index.html","hash":"53525be3821abe7bb5b6467f0847db959ec8633d","modified":1623948109345},{"_id":"public/tags/html/index.html","hash":"b696f7bb9a3d36b453f07d6bb6f9189802ea032c","modified":1623948109345},{"_id":"public/tags/css/index.html","hash":"1ed65432023a1a818d87a9ef619b39cdf02a434e","modified":1623948109345},{"_id":"public/tags/requests/index.html","hash":"ab814f64994dd0e4c949d00e5c9fd9663d1db807","modified":1623948109345},{"_id":"public/tags/pscada/index.html","hash":"11eff242576b713172e1d13cf2822a9a9b3a1989","modified":1623948109345},{"_id":"public/tags/nextCloud/index.html","hash":"b26a6d2ed8c17b93c23c07e8893c23a5775793f3","modified":1623948109345},{"_id":"public/tags/redis/index.html","hash":"13334e271268e1ea659d762f8bb09173012c2b3b","modified":1623948109345},{"_id":"public/tags/vscode/index.html","hash":"f80985847d36fcc3138e8a3bda39b5d042529afb","modified":1623948109345},{"_id":"public/tags/MD5/index.html","hash":"a514e667ab3a332e972f5862c9c6b7a6e2344be5","modified":1623948109345},{"_id":"public/tags/爬虫/index.html","hash":"7dad3bac9897453fa825b863d65670dfbc742997","modified":1623948109345},{"_id":"public/tags/git/index.html","hash":"56ead031c7c2bf2a2c861e207bb1351837949c4e","modified":1623948109345},{"_id":"public/tags/病毒/index.html","hash":"efe9c782fd620e1ea17118e7e54593596260b41b","modified":1623948109345},{"_id":"public/tags/nginx/index.html","hash":"eea7c170b70fc3b380e61410da49cd254c187a51","modified":1623948109345},{"_id":"public/tags/https/index.html","hash":"941a624d9706e0c367a7c0cf12f44e888b01a43c","modified":1623948109345},{"_id":"public/tags/pyquery/index.html","hash":"810aca542298195524deef1902addcc5e75cc8d3","modified":1623948109345},{"_id":"public/tags/selenium/index.html","hash":"748fc4d2214eab2236cc808002f01adfa392ae50","modified":1623948109345},{"_id":"public/tags/multiprocessing/index.html","hash":"5fc898f1d8801ea7d7f122886c92e82d78a4b1ba","modified":1623948109345},{"_id":"public/tags/request/index.html","hash":"f2f48305684c46d291cf2a37bcbd2ede8335dd82","modified":1623948109345},{"_id":"public/tags/pyquest/index.html","hash":"1631302fa88d83cddca36d708e44aa60a6254149","modified":1623948109345},{"_id":"public/tags/pymongodb/index.html","hash":"be60a24e8eda558cff85dcc5f3c0fbb4d990a030","modified":1623948109345},{"_id":"public/tags/scarpy/index.html","hash":"5d1741d410f75b823bf55c72dcda5b9b68186543","modified":1623948109345},{"_id":"public/friends/index.html","hash":"7432f37c9221aa00684b10f35ead4b8200e1b32e","modified":1623948109345},{"_id":"public/search/index.html","hash":"b9685fa5f41619211a4a6e9bfd6e119ca45fe924","modified":1623948109345},{"_id":"public/images/about.webp","hash":"ca0fb739ab4426e7895742c1d8d52df1e14468e8","modified":1623948109345},{"_id":"public/images/avatar.webp","hash":"3ed6e4e1e08e9c2700aa149d1f9e068fb02947cd","modified":1623948109345},{"_id":"public/images/banner.webp","hash":"7c5093243bfd581a633ba8a905e2d379cfa78c00","modified":1623948109345},{"_id":"public/images/banner_dark.webp","hash":"5589986444825e2b75c369d419ff736d3a396bac","modified":1623948109345},{"_id":"public/images/bg.webp","hash":"f232b442b64eaa90f45a48ff04d8e7d352caf212","modified":1623948109345},{"_id":"public/images/failure.ico","hash":"5eec5c163400d8ece74286da49130da1ead3f6f6","modified":1623948109345},{"_id":"public/images/logo.webp","hash":"ad57efa7bf7cfe2b55857a5e1c917d67e268801d","modified":1623948109345},{"_id":"public/images/wechat.webp","hash":"06f3997bf554768c04cb588198c7b3d68c21b8e9","modified":1623948109345},{"_id":"public/images/psr.webp","hash":"bf457bf84bca767bac1bd2b960d91c53ba3fbdee","modified":1623948109345},{"_id":"public/maps/candy.min.js.map","hash":"6665b21a65483d2344c471dc5c756c4d387d568b","modified":1623948109345},{"_id":"public/images/404.webp","hash":"d2e2bd5cc2627a2b04d5e449a67949a2605ae13e","modified":1623948109345},{"_id":"public/maps/kr-dark.min.css.map","hash":"80ee66d1f262f9aa4a9b6960b0f8ff2fec14eb34","modified":1623948109345},{"_id":"public/maps/kr-dark.min.js.map","hash":"d021646d1ea23cb79c169ce84799e85e7d19540e","modified":1623948109345},{"_id":"public/maps/kratosr.min.js.map","hash":"b0d79ecf02c98ceecc14b9fa64160d186f20662c","modified":1623948109345},{"_id":"public/maps/light.min.css.map","hash":"b32142f58c42be8f25909a5c212364bb5c6fc804","modified":1623948109345},{"_id":"public/maps/local-search.min.js.map","hash":"b831de42d16beb1d8dd9a2d548422cbf1ee04314","modified":1623948109345},{"_id":"public/maps/night-blue.min.css.map","hash":"311ec6106ef1523d8725b5e2b73203adefce0599","modified":1623948109345},{"_id":"public/maps/night-bright.min.css.map","hash":"dd0d8c53d2794a7f64a48beaefc818ad37b74a76","modified":1623948109345},{"_id":"public/maps/night-eighties.min.css.map","hash":"e283eba0a0ce4f94234d725b13d018898ecad8d7","modified":1623948109345},{"_id":"public/maps/night.min.css.map","hash":"98d68627b48700be8632f377bbe23adc2fa1c664","modified":1623948109345},{"_id":"public/maps/pjax.min.js.map","hash":"99e4cc9e361aeca9faf20a01b673e81d8fa4b895","modified":1623948109345},{"_id":"public/maps/prismjs.min.css.map","hash":"0c8ce3221dc6e6c95ae2a31f26d5c90bf090077c","modified":1623948109345},{"_id":"public/maps/snow.min.js.map","hash":"7c02278b2e50e5df0b19404baee1d31c2b6c0f76","modified":1623948109345},{"_id":"public/images/thumb/thumb_1.webp","hash":"a818f050112ceb75e3a60dc1673a10783b254595","modified":1623948109345},{"_id":"public/images/thumb/thumb_10.webp","hash":"4983eeca7886bbe7c09b0c79f4774302fdfa1315","modified":1623948109345},{"_id":"public/images/thumb/thumb_11.webp","hash":"08d8d91e2b01768842abb47cd48a0f07d22d070c","modified":1623948109345},{"_id":"public/images/thumb/thumb_12.webp","hash":"b6b8e1281f9146925e45e937cb4d5b28bcabe957","modified":1623948109345},{"_id":"public/images/thumb/thumb_13.webp","hash":"c4c9050637f4ffa3cb7d782f59dadc993ac3a6de","modified":1623948109345},{"_id":"public/images/thumb/thumb_15.webp","hash":"8629f2a7d3b0192549f809e6b7479159af0222da","modified":1623948109345},{"_id":"public/images/thumb/thumb_14.webp","hash":"f9300e2b45c1f061ec8cc21527142dafc558a9e6","modified":1623948109345},{"_id":"public/images/thumb/thumb_16.webp","hash":"61714ccffd55d6fa74cf94bcdd5a464da04ce891","modified":1623948109345},{"_id":"public/images/thumb/thumb_17.webp","hash":"b5a036ec234a23c820a89d1c640b1f2e8dd3dfa4","modified":1623948109345},{"_id":"public/images/thumb/thumb_18.webp","hash":"5bc78b9d6cb0a0cf6daa3a35b93e575777a49ddd","modified":1623948109345},{"_id":"public/images/thumb/thumb_19.webp","hash":"15e0cd0cbe5c7166915a4b68680681beccc2afef","modified":1623948109345},{"_id":"public/images/thumb/thumb_2.webp","hash":"1bcf7461c2b9408b8a893013fa425eb46701faf6","modified":1623948109345},{"_id":"public/images/thumb/thumb_20.webp","hash":"4ab961d94a0d3abbefc7f6d9188a889ec2225e7a","modified":1623948109345},{"_id":"public/images/thumb/thumb_3.webp","hash":"3faffd2575e0751526249c5c56a2a5045a21363b","modified":1623948109345},{"_id":"public/images/thumb/thumb_4.webp","hash":"1d0f136590632e7ba31f5510d24891ba443f1f33","modified":1623948109345},{"_id":"public/images/thumb/thumb_6.webp","hash":"c2d8b68971dacd111566526f64d94932f5c6f076","modified":1623948109345},{"_id":"public/images/thumb/thumb_5.webp","hash":"ba384ada1c2a17b67036addd68ffa1f604ab5a41","modified":1623948109345},{"_id":"public/images/alipay.webp","hash":"01fa6151d2122f0470ee6f38ac8e4ced6c81912e","modified":1623948109345},{"_id":"public/images/thumb/thumb_7.webp","hash":"4be8fe8ea1b3563b78924062e3aa013cd5c4e82b","modified":1623948109345},{"_id":"public/images/thumb/thumb_8.webp","hash":"9e6d74786d8459440d68c409eb654364dd279f8a","modified":1623948109345},{"_id":"public/2021/05/24/Ajax爬取案例实战/Screenshot_4.webp","hash":"c2575022523ef6572d0c5325af42f8df21100be8","modified":1623948109345},{"_id":"public/images/thumb/thumb_9.webp","hash":"bca69e7d56982b43c52e9ffa17c8d5bb268834d8","modified":1623948109345},{"_id":"public/2021/05/24/Ajax的原理和解析/Screenshot_2.webp","hash":"4deffbe63abf667eb7deab992e6fd5f5d8f19658","modified":1623948109345},{"_id":"public/2021/05/24/Ajax的原理和解析/Screenshot_5.webp","hash":"c593a73651cc83f71afd2ec983070f834ab00bec","modified":1623948109345},{"_id":"public/2021/05/24/Ajax的原理和解析/Screenshot_6.webp","hash":"74fe29c473536bc554b6f2f7e75f9f81f11f8ac4","modified":1623948109345},{"_id":"public/2021/06/16/Django入门-Django-Admin/2.PNG","hash":"4f72bd3e6952640eff07a8738bf101a9b884104f","modified":1623948109345},{"_id":"public/2021/06/16/Django入门-Django-Admin/3.PNG","hash":"26cfd6a3bd159c5bff29605d07dfe76f7d6f6f1c","modified":1623948109345},{"_id":"public/2021/06/16/Django入门-Django-Admin/1.PNG","hash":"35a22a299db080425cfd667b7c7b27a48ccfbb1c","modified":1623948109345},{"_id":"public/2021/06/16/Django入门-Django-Admin/5.PNG","hash":"39f05822dcf0e3d96400ff375e55ec37ee38c3a4","modified":1623948109345},{"_id":"public/2021/06/16/Django入门-Django-Admin/4.PNG","hash":"1ecc472bf902d7b74ee1898cd279f1d69e466a80","modified":1623948109345},{"_id":"public/2021/06/16/Django入门-Django-Admin/Screenshot_8.webp","hash":"dd1278eded19b37e6de1dbcaca1cd1a44463c1d8","modified":1623948109345},{"_id":"public/2021/06/09/Django入门-模型设计/Screenshot_8.webp","hash":"dd1278eded19b37e6de1dbcaca1cd1a44463c1d8","modified":1623948109345},{"_id":"public/2021/06/16/Django入门-URL分发/1.PNG","hash":"9d35abb1f87d6ec28fe49d6ba9023154b937f1ef","modified":1623948109345},{"_id":"public/2021/06/09/Django入门-系统设计/Screenshot_1.webp","hash":"4df62f18261768a9384cba46a0856c0d6736312a","modified":1623948109345},{"_id":"public/2021/06/16/Django入门-URL分发/Screenshot_8.webp","hash":"dd1278eded19b37e6de1dbcaca1cd1a44463c1d8","modified":1623948109345},{"_id":"public/2021/06/09/Django入门-系统设计/Screenshot_3.webp","hash":"b9376412947efa5e601502db21bbc59f6a41fc27","modified":1623948109345},{"_id":"public/2021/06/09/Django入门-系统设计/Screenshot_2.webp","hash":"4fb93d3381fb39ac012e47359adb5412855f6f45","modified":1623948109345},{"_id":"public/2021/06/09/Django入门-系统设计/Screenshot_5.webp","hash":"b1ea174116b106bee96615b510c110d875003397","modified":1623948109345},{"_id":"public/2021/06/09/Django入门-系统设计/Screenshot_4.webp","hash":"a3a9dae7a0657fea148815651158aab04ae26999","modified":1623948109345},{"_id":"public/2021/06/09/Django入门-系统设计/Screenshot_6.webp","hash":"b697c29ebf3a9be2d6dddefeeffc57487b52f12b","modified":1623948109345},{"_id":"public/2021/06/11/Django入门-视图函数/Screenshot_1.webp","hash":"8588869c67deb52313a494ce90b2180824267e29","modified":1623948109345},{"_id":"public/2021/06/09/Django入门-系统设计/Screenshot_8.webp","hash":"dd1278eded19b37e6de1dbcaca1cd1a44463c1d8","modified":1623948109345},{"_id":"public/2021/06/11/Django入门-视图函数/Screenshot_2.webp","hash":"c27073a292ddd036a96733912453169f1044194f","modified":1623948109345},{"_id":"public/2021/06/11/Django入门-视图函数/Screenshot_8.webp","hash":"dd1278eded19b37e6de1dbcaca1cd1a44463c1d8","modified":1623948109345},{"_id":"public/2021/06/11/Django入门-视图函数/Screenshot_3.webp","hash":"35d86c6e3c7cd5a1fe9260e5bb6046bd93b76d5c","modified":1623948109345},{"_id":"public/2021/06/16/Django入门-静态文件设置/Screenshot_8.webp","hash":"dd1278eded19b37e6de1dbcaca1cd1a44463c1d8","modified":1623948109345},{"_id":"public/2021/06/16/Django入门-静态文件设置/2.PNG","hash":"76c7e74ebd4576588e42f2302e2495c5bc0152fd","modified":1623948109345},{"_id":"public/2021/05/30/FastAPI安装和使用/Screenshot_2.webp","hash":"952d0820f1bbb154445365436899230e5925b082","modified":1623948109345},{"_id":"public/2021/05/30/FastAPI安装和使用/Screenshot_1.webp","hash":"74986affc73b38808c459a6bce07b42d89d7b7fa","modified":1623948109345},{"_id":"public/2021/05/30/FastAPI教程-路径参数/Screenshot_1.webp","hash":"4aa671b775d8c3c8a639d207e79751adfd4ac72e","modified":1623948109345},{"_id":"public/2021/06/02/Pyppeteer的使用/example.webp","hash":"19d2d652eff072b9f8ed24d7cbdca411d44b211e","modified":1623948109345},{"_id":"public/2021/06/02/Pyppeteer的使用/example1.webp","hash":"81efddc3c37d6878e14c009c3d8742829384e2a2","modified":1623948109345},{"_id":"public/2021/06/07/django入门及环境搭建/Screenshot_8.webp","hash":"dd1278eded19b37e6de1dbcaca1cd1a44463c1d8","modified":1623948109345},{"_id":"public/2021/05/26/go语言的下载和安装/Screenshot_1.webp","hash":"bb9781574494804cecbeaf411b9eab8e978b39a6","modified":1623948109345},{"_id":"public/2021/06/07/django入门及环境搭建/Screenshot_1.webp","hash":"512f09471a1ffda6a2ac10c4073c8af997cb8fb9","modified":1623948109345},{"_id":"public/2021/05/26/go语言的下载和安装/Screenshot_2.webp","hash":"9ab82c434734f49b00fa9907ba03aa0c961ea67b","modified":1623948109345},{"_id":"public/2021/05/28/python的内置类型/Screenshot_1.webp","hash":"61f8bfd7758ad8815e38fd4af73bbb51d02e5624","modified":1623948109345},{"_id":"public/2021/05/29/scrapy框架介绍/Screenshot_1.webp","hash":"b75a099cb7f90ef9be9f8079c762c5871b2910f5","modified":1623948109345},{"_id":"public/2021/06/01/南瑞103协议详解/Screenshot_1.webp","hash":"1d3f9bd083581039de295612401f3b73a3b79a57","modified":1623948109345},{"_id":"public/2021/06/01/南瑞103协议详解/Screenshot_2.webp","hash":"e602f54cdccfd7c7e4a6b18c20af0c5578d7b596","modified":1623948109345},{"_id":"public/2021/06/01/南瑞103协议详解/Screenshot_3.webp","hash":"11d275072c9bb2cefce4043c4732bf257718f8ab","modified":1623948109345},{"_id":"public/2021/06/01/南瑞103协议详解/Screenshot_4.webp","hash":"b4df0b06e348dd373559f59922412f2cb281c089","modified":1623948109345},{"_id":"public/2021/06/01/南瑞103协议详解/Screenshot_5.webp","hash":"676109c880d0aa8f60f47fc017474a63f80b9420","modified":1623948109345},{"_id":"public/2021/06/16/深度优先和广度优先算法/1.gif","hash":"c086bccc36e8eebe670abf67d4f18080a4302247","modified":1623948109345},{"_id":"public/2021/06/16/深度优先和广度优先算法/1.PNG","hash":"9a4efff4f84300499e39fd794a70d67075f32042","modified":1623948109345},{"_id":"public/2021/06/16/深度优先和广度优先算法/2.PNG","hash":"71b669a174676b7437bcb542a97ed860d5675945","modified":1623948109345},{"_id":"public/2021/06/16/深度优先和广度优先算法/3.PNG","hash":"d880fb8fc86f1939478d0181c661653382615986","modified":1623948109345},{"_id":"public/2021/06/16/深度优先和广度优先算法/4.PNG","hash":"8f961a2a7f93f7ae47e7193b26d15d67aeb09bcd","modified":1623948109345},{"_id":"public/2021/06/16/深度优先和广度优先算法/5.png","hash":"606bc77bf07e8e263e8ad4e1727ae295fba7a906","modified":1623948109345},{"_id":"public/2021/06/16/深度优先和广度优先算法/6.png","hash":"f0b745d6cfb6db3eb3d16544d01de702347ac527","modified":1623948109345},{"_id":"public/2021/05/09/HTTP基本原理/webp_0.webp","hash":"5cda1aef076a1f77cacb4ed2a194e2834394de31","modified":1623948109345},{"_id":"public/2021/05/25/Selenium的基本使用/Screenshot_3.webp","hash":"5714174e2273c7a9d85bc4d00a279f81d10f2d7b","modified":1623948109345},{"_id":"public/2021/05/25/Selenium的基本使用/Screenshot_8.webp","hash":"684d8530802e1ce1d5109860337382795a98b148","modified":1623948109345},{"_id":"public/2021/05/18/requests库的基本使用/Screenshot_3.webp","hash":"c352952ce59a50999f2edd69707460e4ea0ef415","modified":1623948109345},{"_id":"public/2021/05/18/requests库的基本使用/Screenshot_4.webp","hash":"9a8d44d9355d48fea9a16b85db6f94741b194ec7","modified":1623948109345},{"_id":"public/2021/05/24/Ajax爬取案例实战/Screenshot_1.webp","hash":"6f8eb27774d4a5f4182842151beacc2819c15096","modified":1623948109345},{"_id":"public/2021/05/24/Ajax的原理和解析/Screenshot_4.webp","hash":"d7e798aa6b3b6ad7a22298853c9f234137d38145","modified":1623948109345},{"_id":"public/2021/05/24/Ajax的原理和解析/Screenshot_7.webp","hash":"e5d673561d5370a49d9f89e48a528f3786ef0f76","modified":1623948109345},{"_id":"public/2021/06/09/Django入门-模型设计/Screenshot_1.webp","hash":"8c81324b088cbde184597537f971503049e7582a","modified":1623948109345},{"_id":"public/2021/06/09/Django入门-系统设计/Screenshot_7.webp","hash":"5c90402d68322a99277a9c62fe91521e0b9c4df3","modified":1623948109345},{"_id":"public/2021/05/29/scrapy的基本使用/Screenshot_2.webp","hash":"b92ca60213e79ed1efc641db00d2a4c0113074b7","modified":1623948109345},{"_id":"public/2021/05/25/基于docker部署code-server/Screenshot_1.webp","hash":"b6358b7ac75a45bce36592548e5c732f41be2aa1","modified":1623948109345},{"_id":"public/2021/06/10/抓取网易云音乐热评/Screenshot_4.webp","hash":"21e30d4a3f410cd97b8fafc96e024303762c465f","modified":1623948109345},{"_id":"public/2021/06/10/抓取网易云音乐热评/Screenshot_6.webp","hash":"333851195da35d52b191446f3e5935aca93a96aa","modified":1623948109345},{"_id":"public/2021/05/21/正则表达式/Screenshot_1.webp","hash":"e1c8833a8026b1e8c0255be14f3cef05117f8611","modified":1623948109345},{"_id":"public/2021/05/25/Selenium的基本使用/Screenshot_1.webp","hash":"4c1dbd186f6472603d353c031b02181215d740e5","modified":1623948109345},{"_id":"public/2021/05/25/Selenium的基本使用/Screenshot_2.webp","hash":"1df3e2110351c6d598a414347d2d715b7ac4b3a9","modified":1623948109345},{"_id":"public/2021/05/25/Selenium的基本使用/Screenshot_4.webp","hash":"6c9be21e922b1cb4099f8ed5a34707d7286005b3","modified":1623948109345},{"_id":"public/2021/05/25/Selenium的基本使用/Screenshot_5.webp","hash":"728868e8a29dd0a1dea0427c8d244e0de4e7aa70","modified":1623948109345},{"_id":"public/2021/05/25/Selenium的基本使用/Screenshot_7.webp","hash":"3d9f705648fa9375ae9143fc280082f493aa0f3c","modified":1623948109345},{"_id":"public/2021/05/18/requests库的基本使用/Screenshot_2.webp","hash":"1a421421def18043cc6bb9583929f0c4c8813c73","modified":1623948109345},{"_id":"public/2021/05/23/request、pyquest和pymongodb案例实战/Screenshot_3.webp","hash":"bca12af16f5833c7f371dfc3c3eca274820bd8a5","modified":1623948109345},{"_id":"public/2021/05/23/request、pyquest和pymongodb案例实战/Screenshot_4.webp","hash":"bc77d73a8f74763fac132af7223e56986c3b5fb3","modified":1623948109345},{"_id":"public/maps/kratosr.min.css.map","hash":"79db71048315b161ee4bd150c02f74bcf2afa6cc","modified":1623948109345},{"_id":"public/2021/05/24/Ajax爬取案例实战/Screenshot_2.webp","hash":"703e0f2823f2a8359bec3058626043ce79c90fac","modified":1623948109345},{"_id":"public/2021/05/24/Ajax爬取案例实战/Screenshot_3.webp","hash":"0673e9e7afc64082d4ae24e1a2bb6a63ea40d89a","modified":1623948109345},{"_id":"public/2021/05/24/Ajax的原理和解析/Screenshot_1.webp","hash":"3b76c1cd462a5d790ee6ee6913a4fe0ea9939e4b","modified":1623948109345},{"_id":"public/2021/05/18/Nginx配置详解/1.jpg","hash":"9a45816cf19b79bf32997741a5411fff7f414714","modified":1623948109345},{"_id":"public/2021/05/29/scrapy的基本使用/Screenshot_1.webp","hash":"e7b29693fcdb1ad13eb3f70c2c273913f282254f","modified":1623948109345},{"_id":"public/2021/06/10/抓取网易云音乐热评/Screenshot_3.webp","hash":"d0c7831c000456b317fb257dd027611090e17ccd","modified":1623948109345},{"_id":"public/2021/05/09/HTTP基本原理/1.png","hash":"c7b40fc10675514ee4a907cd6ed5b451b2c84491","modified":1623948109345},{"_id":"public/2021/05/25/Selenium的基本使用/Screenshot_6.webp","hash":"222603f02ca72672ef9b37b58272aa7c40c319fc","modified":1623948109345},{"_id":"public/2021/05/23/request、pyquest和pymongodb案例实战/Screenshot_2.webp","hash":"bc928e85f843d46e64bfc84c71ec5e36f02e8a86","modified":1623948109345},{"_id":"public/2021/05/31/异步爬虫的原理和解析/Screenshot_1.webp","hash":"9a8f4a8b8cd06aabb110931a4c1bddac4f3c5d59","modified":1623948109345},{"_id":"public/css/prismjs.min.css","hash":"94df0fe6c26d18a094c54c30283d65c3659ccf7a","modified":1623948109345},{"_id":"public/css/kr-dark.min.css","hash":"f0c733d82a86863b20cf68ec2231bb7e8843c61b","modified":1623948109345},{"_id":"public/js/candy.min.js","hash":"68557657a90856086aaeaeeeeed768aa1e27d73e","modified":1623948109345},{"_id":"public/js/kr-dark.min.js","hash":"b7d0488063224809bc9eac061627cc4ca96abfef","modified":1623948109345},{"_id":"public/js/kratosr.min.js","hash":"89656e74e417267f3d8fbaf8b6d369d0cdb84f1b","modified":1623948109345},{"_id":"public/js/local-search.min.js","hash":"9e60a349fe6bc9b0046f99f31aac125d0d66c1c3","modified":1623948109345},{"_id":"public/js/pjax.min.js","hash":"23fa40cb7ad123bb99e921d487447c195a6dadf3","modified":1623948109345},{"_id":"public/js/snow.min.js","hash":"c9f82a74501568aa42bada0becf766f45f309dbb","modified":1623948109345},{"_id":"public/css/highlight/light.min.css","hash":"c42fa620f43eaafa550bc68a7e69e6e34ada0032","modified":1623948109345},{"_id":"public/css/highlight/night-blue.min.css","hash":"3a02ca54dd6a7ca6a8deb10012b5604653e398c6","modified":1623948109345},{"_id":"public/css/highlight/night.min.css","hash":"6413d0664d104edd739554011c75b5a02b9f5fde","modified":1623948109345},{"_id":"public/css/highlight/night-bright.min.css","hash":"9a3a66fa13f93d5196b67e8cac24b2aac4165a2c","modified":1623948109345},{"_id":"public/css/highlight/night-eighties.min.css","hash":"c3731f78911a97ed001500796a6e8d4ee9a78ab5","modified":1623948109345},{"_id":"public/images/my.webp","hash":"4ca18265439440b696893bbd8af9501511903a77","modified":1623948109345},{"_id":"public/2021/05/24/Ajax的原理和解析/Screenshot_3.webp","hash":"05806abf32ac862c1fc0bd6d951a52cec43bc402","modified":1623948109345},{"_id":"public/2021/05/24/Ajax的原理和解析/Screenshot_8.webp","hash":"75a2ce77a19e6b163c2721ac000f6b304c1d1a4e","modified":1623948109345},{"_id":"public/2021/05/18/Nginx配置详解/2.jpg","hash":"b607fc3234184e21036463e44ed62842734a0854","modified":1623948109345},{"_id":"public/2021/06/06/优美图库抓取/Screenshot_1.webp","hash":"e90c2f8f0ffe5d677e25f9b8f201dbfedaadda93","modified":1623948109345},{"_id":"public/2021/06/10/抓取网易云音乐热评/Screenshot_10.webp","hash":"0b6c60824cf49a86858fd16931527dc50041137d","modified":1623948109345},{"_id":"public/2021/06/10/抓取网易云音乐热评/Screenshot_11.webp","hash":"54450c8e3204e56328ac162ae10d79ae7fb33406","modified":1623948109345},{"_id":"public/2021/06/10/抓取网易云音乐热评/Screenshot_12.webp","hash":"2fa67b97be4fcbd11cda6fabda14aa3fa4c831c3","modified":1623948109345},{"_id":"public/2021/06/10/抓取网易云音乐热评/Screenshot_2.webp","hash":"282ca7461aa0a99f2172d93d1a140e0251a4957d","modified":1623948109345},{"_id":"public/2021/06/10/抓取网易云音乐热评/Screenshot_5.webp","hash":"d85502b26203820adfff9e344d491c4db47c07d3","modified":1623948109345},{"_id":"public/2021/06/10/抓取网易云音乐热评/Screenshot_7.webp","hash":"3fde7026f9905d09b7c8cf809c36e8be1fc5ac08","modified":1623948109345},{"_id":"public/2021/06/10/抓取网易云音乐热评/Screenshot_9.webp","hash":"c7991072413ef8d5d7a94ae415a049be661c6aef","modified":1623948109345},{"_id":"public/2021/06/16/深度优先和广度优先算法/2.gif","hash":"053900c1ac0fcf77509d2a4bed3020c01011d8e7","modified":1623948109345},{"_id":"public/2021/05/09/HTTP基本原理/Screenshot_1.png","hash":"5adb41c8f84a13e121fc0f1c528dd40bbb856deb","modified":1623948109345},{"_id":"public/2021/05/09/HTTP基本原理/Screenshot_3.png","hash":"378fabca423cb07c62e41766928483465e65f9a2","modified":1623948109345},{"_id":"public/2021/05/09/HTTP基本原理/Screenshot_2.png","hash":"ace6846527b33bf22c4956655f0bd6e3c73ae24f","modified":1623948109345},{"_id":"public/2021/05/18/requests库的基本使用/Screenshot_1.webp","hash":"467c01f42023d9f2a9aa0f6a2ff0ef6debc90862","modified":1623948109345},{"_id":"public/2021/05/23/request、pyquest和pymongodb案例实战/Screenshot_5.webp","hash":"6ae5131d70f9c23ab81202483fc457b9b19c2142","modified":1623948109345},{"_id":"public/2021/05/23/request、pyquest和pymongodb案例实战/Screenshot_6.webp","hash":"d8e5dbb2beadb295313a5f276e03b78c500e7287","modified":1623948109345},{"_id":"public/2021/06/04/经典豆瓣TOP250爬取/Screenshot_1.webp","hash":"81f036e2f4aa66b0443ac7da9548cf2b63857219","modified":1623948109345},{"_id":"public/2021/06/16/Django入门-静态文件设置/1.PNG","hash":"4652cbbae0c92426786a3465ce764f33b1e5cb88","modified":1623948109345},{"_id":"public/2021/05/18/Nginx配置详解/3.jpg","hash":"5f1a30aceb878b36ec04bbe54d0bd5b821ebab9b","modified":1623948109345},{"_id":"public/2021/06/17/Requests库的使用/requests-sidebar.png","hash":"84c5b03f4858f79036cc6c873e2d977abfc58ce2","modified":1623948109345},{"_id":"public/2021/05/23/request、pyquest和pymongodb案例实战/Screenshot_1.webp","hash":"6219480dd4f7f473bcdfaae8209a8d10766d9044","modified":1623948109345},{"_id":"public/css/kratosr.min.css","hash":"0d4d8e5d5c5f631b6b8dbb03ecbbb7adc7c5b00f","modified":1623948109345},{"_id":"public/2021/05/29/scrapy的基本使用/Screenshot_3.webp","hash":"48195fa4642554448c4ffa0e3274ba28776ef1d1","modified":1623948109345},{"_id":"public/2021/06/10/抓取网易云音乐热评/Screenshot_1.webp","hash":"684dcd8903da1ffc7cd0aae367e381d91d65a7fc","modified":1623948109345},{"_id":"public/2021/06/10/抓取网易云音乐热评/Screenshot_8.webp","hash":"15f0db579f2dbe29dcb1f28c778d3771dc78c87b","modified":1623948109345},{"_id":"public/2021/05/25/腾讯云主机CPU占用百分百/Screenshot_1.webp","hash":"d5834d609c49df60661bd4c708b36ccd54cd272c","modified":1623948109345},{"_id":"public/2021/05/11/web网页基础/Screenshot_1.png","hash":"4466945441b85dc63432a583c23eec13419f8a5d","modified":1623948109345}],"Category":[{"name":"爬虫","_id":"ckq14rx1q000344udc1k119cg"},{"name":"Python库","_id":"ckq14rx1y000c44ud8jga9xix"},{"name":"Django","_id":"ckq14rx20000k44udgpeg6as5"},{"name":"FastAPI","_id":"ckq14rx2c001j44udc6y48fnd"},{"name":"Flask","_id":"ckq14rx2k002744ud5pr69hjb"},{"name":"博客教程","_id":"ckq14rx2o002o44udgwswc3zs"},{"name":"Nginx","_id":"ckq14rx2t003444ud2g08gl0v"},{"name":"Linux","_id":"ckq14rx2v003d44ud3fojfuk8"},{"name":"Git","_id":"ckq14rx2x003m44ud2x6af9gp"},{"name":"Go","_id":"ckq14rx30003v44udc6jz64nc"},{"name":"Python","_id":"ckq14rx31004244ud0taw4tcg"},{"name":"自动化","_id":"ckq14rx33004d44udbh755d59"},{"name":"Docker","_id":"ckq14rx33004k44ud3x2zb5eb"},{"name":"算法","_id":"ckq14rx34004q44uddy738q0y"}],"Data":[],"Page":[{"title":"关于我","date":"2021-05-10T09:35:50.000Z","_content":"\n苦逼的工科生，学电子的却爱鼓捣计算机的东西。\n\n目前从事城市轨道交通的自动化行业，和PLC和Modscan打交道比较多，还有各种奇怪的网络设备，服务器和软件。半个网络工程师、半个运维工程师，啥都会干啥都感觉不太精通（╮(╯▽╰)╭）。\n\n工作之余专心学习`python`和`go`语言，专注爬虫方向，**爬天，爬地，爬空气**。\n\n愿世界和平，大家都发财！\n","source":"about/index.md","raw":"---\ntitle: 关于我\ndate: 2021-05-10 17:35:50\n---\n\n苦逼的工科生，学电子的却爱鼓捣计算机的东西。\n\n目前从事城市轨道交通的自动化行业，和PLC和Modscan打交道比较多，还有各种奇怪的网络设备，服务器和软件。半个网络工程师、半个运维工程师，啥都会干啥都感觉不太精通（╮(╯▽╰)╭）。\n\n工作之余专心学习`python`和`go`语言，专注爬虫方向，**爬天，爬地，爬空气**。\n\n愿世界和平，大家都发财！\n","updated":"2021-06-15T15:47:31.641Z","path":"about/index.html","comments":1,"layout":"page","_id":"ckq14rx1j000044ud2tx35d54","content":"<p>苦逼的工科生，学电子的却爱鼓捣计算机的东西。</p>\n<p>目前从事城市轨道交通的自动化行业，和PLC和Modscan打交道比较多，还有各种奇怪的网络设备，服务器和软件。半个网络工程师、半个运维工程师，啥都会干啥都感觉不太精通（╮(╯▽╰)╭）。</p>\n<p>工作之余专心学习<code>python</code>和<code>go</code>语言，专注爬虫方向，<strong>爬天，爬地，爬空气</strong>。</p>\n<p>愿世界和平，大家都发财！</p>\n","site":{"data":{}},"excerpt":"","more":"<p>苦逼的工科生，学电子的却爱鼓捣计算机的东西。</p>\n<p>目前从事城市轨道交通的自动化行业，和PLC和Modscan打交道比较多，还有各种奇怪的网络设备，服务器和软件。半个网络工程师、半个运维工程师，啥都会干啥都感觉不太精通（╮(╯▽╰)╭）。</p>\n<p>工作之余专心学习<code>python</code>和<code>go</code>语言，专注爬虫方向，<strong>爬天，爬地，爬空气</strong>。</p>\n<p>愿世界和平，大家都发财！</p>\n"}],"Post":[{"title":"Ajax爬取案例实战","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-24T12:13:23.000Z","pic":null,"_content":"\n## 准备工作\n\n- 安装好`Python 3`（最低为 3.6 版本），并能成功运行`Python 3`程序。\n- 了解`PythonHTTP`请求库`requests`的基本用法。\n- 了解`Ajax`的基础知识和分析`Ajax`的基本方法。\n\n## 爬取目标\n\n其链接为：[https://dynamic1.scrape.cuiqingcai.com/](https://dynamic1.scrape.cuiqingcai.com/)，页面如图所示。\n\n![](Screenshot_1.webp)\n\n需要完成的目标有：\n\n- 分析页面数据的加载逻辑。\n- 用`requests`实现`Ajax`数据的爬取。\n- 将每部电影的数据保存成一个`JSON`数据文件。\n\n## 爬取列表页\n\n打开浏览器开发者工具，切换到`Network`面板，勾选上`「Preserve Log」`并切换到`「XHR」`选项卡，如图所示。\n\n![](Screenshot_2.webp)\n\n点开第`2`个结果，观察到其`Ajax`接口请求的`URL`地址为：`https://dynamic1.scrape.cuiqingcai.com/api/movie/?limit=10&offset=10`，这里有两个参数，一个是`limit`，其值为`10`，一个是`offset`，它的值也是`10`。\n\n切换到`Preview`选项卡，结果如图所示。\n\n![](Screenshot_3.webp)\n\n可以看到结果是一些`JSON`数据，它有一个`results`字段，这是一个列表，列表的每一个元素都是一个字典。观察一下字典的内容，可以看到对应的电影数据的字段了，如`name`、`alias`、`cover`、 `categories`，对比下浏览器中的真实数据，各个内容是完全一致的，而且这个数据已经非常结构化了，完全就是我们想要爬取的数据。\n\n导入一些所需的库并定义一些配置，代码如下：\n\n```python\nimport requests\nimport logging\n\nlogging.basicConfig(level=logging.INFO,\n                    format='%(asctime)s-%(levelname)s:%(message)s')\n\nINDEX_URL = 'https://dynamic1.scrape.cuiqingcai.com/api/movie/?limit={limit}&offset={offset}'\n```\n\n引入了`requests`和`logging`库，并定义了`logging`的基本配置，接着定义`INDEX_URL`，这里把`limit`和`offset`预留出来变成占位符，可以动态传入参数构造成一个完整的列表页`URL`。\n\n下面来实现一下列表页的爬取，先定义一个通用的爬取方法，代码如下：\n\n```python\ndef scrape_api(url):\n    logging.info('scraping %s...', url)\n    try:\n        response = requests.get(url, verify=False)\n        if response.status_code == 200:\n            return response.json()\n        logging.error('get invalid status code %s while scraping %s',\n                      response.status_code, url)\n    except requests.RequestException:\n        logging.error('error occurred while scraping %s', url, exc_info=True)\n```\n\n定义一个`scrape_api`方法，和之前不同的是，这个方法专门用来处理`JSON`接口，最后的`response`调用的是`json`方法，它可以解析响应的内容并将其转化成`JSON`字符串。\n\n在这个基础之上，定义一个爬取列表页的方法，代码如下：\n\n```python\nLIMIT = 10\n\ndef scrape_index(page):\n    url = INDEX_URL.format(limit=LIMIT, offset=LIMIT*(page-1))\n    return scrape_api(url)\n```\n\n定义了一个`scrape_index`方法，用来接收参数`page`，`page`代表列表页的页码。\n\n先构造了一个`URL`，通过字符串的`format`方法，传入`limit`和`offset`的值。这里的`limit`直接使用了全局变量`LIMIT`的值，`offset`则是动态计算的，计算方法是页码数减1再乘以`limit`，比如第1页的`offset`值就是`0`，第2页的`offset`值就是`10`，以此类推。构造好`URL`之后，直接调用`scrape_api`方法并返回结果即可。\n\n这样就完成了列表页的爬取，每次请求都会得到一页`10`部的电影数据。\n\n由于这时爬取到的数据已经是`JSON`类型了，所以不用像之前一样去解析`HTML`代码来提取数据，爬到的数据就是想要的结构化数据，因此解析这一步这里就可以直接省略。\n\n## 爬取详情页\n\n这时候已经可以拿到每一页的电影数据了，但是实际上这些数据还缺少一些想要的信息，如剧情简介等，所以需要进一步进入到详情页来获取这些内容。\n\n这时候点击任意一部电影，如《教父》，进入到其详情页面，这时候可以发现页面的`URL`已经变成了[](https://dynamic1.scrape.cuiqingcai.com/detail/40)，页面也成功展示了详情页的信息\n\n先定义一个详情页的爬取逻辑吧，代码如下：\n\n```python\nDETAIL_URL = 'https://dynamic1.scrape.cuiqingcai.com/api/movie/{id}'\n\ndef scrape_detail(id):\n    url = DETAIL_URL.format(id=id)\n    return scrape_api(url)\n```\n\n定义了一个`scrape_detail`方法，它接收参数`id`。这里的实现也非常简单，先根据定义好的`DETAIL_UR`L加上`id`，构造一个真实的详情页`Ajax`请求的`URL`，然后直接调用`scrape_api`方法传入这个`URL`即可。接着，定义一个总的调用方法，将以上的方法串联调用起来，代码如下：\n\n```python\ndef main():\n    for page in range(1, TOTAL_PAGE+1):\n        index_data = scrape_index(page)\n        for item in index_data.get('results'):\n            id = item.get('id')\n            print(id)\n            detail_data = scrape_detail(id)\n            logging.info('detail data %s', detail_data)\n```\n\n定义了一个`main`方法，首先遍历获取页码`page`，然后把`page`当成参数传递给`scrape_index`方法，得到列表页的数据。接着我遍历所有列表页的结果，获取每部电影的`id`，然后把`id`当作参数传递给`scrape_detail`方法，来爬取每部电影的详情数据，赋值为`detail_data`，输出即可。\n\n## 保存数据\n\n定义一个数据保存的方法，代码如下：\n\n```python\nimport json\nfrom os import makedirs\nfrom os.path import exists\n\nRESULT_DIR = 'results'\n\nexists(RESULT_DIR) or makedirs(RESULT_DIR)\n\ndef save_data(data):\n    name = data.get('name')\n    data_path = f'{RESULT_DIR}/{name}.json'\n    json.dump(data, open(data_path, 'w', encoding='utf-8'), ensure_ascii=False, indent=2)\n```\n\n首先定义了数据保存的文件夹`RESULTS_DIR`，注意，先要判断这个文件夹是否存在，如果不存在则需要创建。\n\n接着，定义了保存数据的方法`save_data`，首先获取数据的`name`字段，即电影的名称，把电影名称作为`JSON`文件的名称，接着构造`JSON`文件的路径，然后用`json`的`dump`方法将数据保存成文本格式。`dump`的方法设置了两个参数，一个是`ensure_ascii`，将其设置为`False`，它可以保证中文字符在文件中能以正常的中文文本呈现，而不是`unicode`字符；另一个是`indent`，它的数值为2，这代表生成的`JSON`数据结果有两个空格缩进，让它的格式显得更加美观。\n\n最后，`main`方法再调用下`save_data`方法即可，实现如下：\n\n```python\ndef main():\n    for page in range(1, TOTAL_PAGE+1):\n        index_data = scrape_index(page)\n        for item in index_data.get('results'):\n            id = item.get('id')\n            print(id)\n            detail_data = scrape_detail(id)\n            logging.info('detail data %s', detail_data)\n            save_data(detail_data)\n```\n\n本地`results`文件夹下出现了各个电影的`JSON`文件，如图所示。\n\n![](Screenshot_4.webp)\n","source":"_posts/Ajax爬取案例实战.md","raw":"---\ntitle: Ajax爬取案例实战\ntags:\n  - ajax\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-24 20:13:23\ncategories: 爬虫\npic:\n---\n\n## 准备工作\n\n- 安装好`Python 3`（最低为 3.6 版本），并能成功运行`Python 3`程序。\n- 了解`PythonHTTP`请求库`requests`的基本用法。\n- 了解`Ajax`的基础知识和分析`Ajax`的基本方法。\n\n## 爬取目标\n\n其链接为：[https://dynamic1.scrape.cuiqingcai.com/](https://dynamic1.scrape.cuiqingcai.com/)，页面如图所示。\n\n![](Screenshot_1.webp)\n\n需要完成的目标有：\n\n- 分析页面数据的加载逻辑。\n- 用`requests`实现`Ajax`数据的爬取。\n- 将每部电影的数据保存成一个`JSON`数据文件。\n\n## 爬取列表页\n\n打开浏览器开发者工具，切换到`Network`面板，勾选上`「Preserve Log」`并切换到`「XHR」`选项卡，如图所示。\n\n![](Screenshot_2.webp)\n\n点开第`2`个结果，观察到其`Ajax`接口请求的`URL`地址为：`https://dynamic1.scrape.cuiqingcai.com/api/movie/?limit=10&offset=10`，这里有两个参数，一个是`limit`，其值为`10`，一个是`offset`，它的值也是`10`。\n\n切换到`Preview`选项卡，结果如图所示。\n\n![](Screenshot_3.webp)\n\n可以看到结果是一些`JSON`数据，它有一个`results`字段，这是一个列表，列表的每一个元素都是一个字典。观察一下字典的内容，可以看到对应的电影数据的字段了，如`name`、`alias`、`cover`、 `categories`，对比下浏览器中的真实数据，各个内容是完全一致的，而且这个数据已经非常结构化了，完全就是我们想要爬取的数据。\n\n导入一些所需的库并定义一些配置，代码如下：\n\n```python\nimport requests\nimport logging\n\nlogging.basicConfig(level=logging.INFO,\n                    format='%(asctime)s-%(levelname)s:%(message)s')\n\nINDEX_URL = 'https://dynamic1.scrape.cuiqingcai.com/api/movie/?limit={limit}&offset={offset}'\n```\n\n引入了`requests`和`logging`库，并定义了`logging`的基本配置，接着定义`INDEX_URL`，这里把`limit`和`offset`预留出来变成占位符，可以动态传入参数构造成一个完整的列表页`URL`。\n\n下面来实现一下列表页的爬取，先定义一个通用的爬取方法，代码如下：\n\n```python\ndef scrape_api(url):\n    logging.info('scraping %s...', url)\n    try:\n        response = requests.get(url, verify=False)\n        if response.status_code == 200:\n            return response.json()\n        logging.error('get invalid status code %s while scraping %s',\n                      response.status_code, url)\n    except requests.RequestException:\n        logging.error('error occurred while scraping %s', url, exc_info=True)\n```\n\n定义一个`scrape_api`方法，和之前不同的是，这个方法专门用来处理`JSON`接口，最后的`response`调用的是`json`方法，它可以解析响应的内容并将其转化成`JSON`字符串。\n\n在这个基础之上，定义一个爬取列表页的方法，代码如下：\n\n```python\nLIMIT = 10\n\ndef scrape_index(page):\n    url = INDEX_URL.format(limit=LIMIT, offset=LIMIT*(page-1))\n    return scrape_api(url)\n```\n\n定义了一个`scrape_index`方法，用来接收参数`page`，`page`代表列表页的页码。\n\n先构造了一个`URL`，通过字符串的`format`方法，传入`limit`和`offset`的值。这里的`limit`直接使用了全局变量`LIMIT`的值，`offset`则是动态计算的，计算方法是页码数减1再乘以`limit`，比如第1页的`offset`值就是`0`，第2页的`offset`值就是`10`，以此类推。构造好`URL`之后，直接调用`scrape_api`方法并返回结果即可。\n\n这样就完成了列表页的爬取，每次请求都会得到一页`10`部的电影数据。\n\n由于这时爬取到的数据已经是`JSON`类型了，所以不用像之前一样去解析`HTML`代码来提取数据，爬到的数据就是想要的结构化数据，因此解析这一步这里就可以直接省略。\n\n## 爬取详情页\n\n这时候已经可以拿到每一页的电影数据了，但是实际上这些数据还缺少一些想要的信息，如剧情简介等，所以需要进一步进入到详情页来获取这些内容。\n\n这时候点击任意一部电影，如《教父》，进入到其详情页面，这时候可以发现页面的`URL`已经变成了[](https://dynamic1.scrape.cuiqingcai.com/detail/40)，页面也成功展示了详情页的信息\n\n先定义一个详情页的爬取逻辑吧，代码如下：\n\n```python\nDETAIL_URL = 'https://dynamic1.scrape.cuiqingcai.com/api/movie/{id}'\n\ndef scrape_detail(id):\n    url = DETAIL_URL.format(id=id)\n    return scrape_api(url)\n```\n\n定义了一个`scrape_detail`方法，它接收参数`id`。这里的实现也非常简单，先根据定义好的`DETAIL_UR`L加上`id`，构造一个真实的详情页`Ajax`请求的`URL`，然后直接调用`scrape_api`方法传入这个`URL`即可。接着，定义一个总的调用方法，将以上的方法串联调用起来，代码如下：\n\n```python\ndef main():\n    for page in range(1, TOTAL_PAGE+1):\n        index_data = scrape_index(page)\n        for item in index_data.get('results'):\n            id = item.get('id')\n            print(id)\n            detail_data = scrape_detail(id)\n            logging.info('detail data %s', detail_data)\n```\n\n定义了一个`main`方法，首先遍历获取页码`page`，然后把`page`当成参数传递给`scrape_index`方法，得到列表页的数据。接着我遍历所有列表页的结果，获取每部电影的`id`，然后把`id`当作参数传递给`scrape_detail`方法，来爬取每部电影的详情数据，赋值为`detail_data`，输出即可。\n\n## 保存数据\n\n定义一个数据保存的方法，代码如下：\n\n```python\nimport json\nfrom os import makedirs\nfrom os.path import exists\n\nRESULT_DIR = 'results'\n\nexists(RESULT_DIR) or makedirs(RESULT_DIR)\n\ndef save_data(data):\n    name = data.get('name')\n    data_path = f'{RESULT_DIR}/{name}.json'\n    json.dump(data, open(data_path, 'w', encoding='utf-8'), ensure_ascii=False, indent=2)\n```\n\n首先定义了数据保存的文件夹`RESULTS_DIR`，注意，先要判断这个文件夹是否存在，如果不存在则需要创建。\n\n接着，定义了保存数据的方法`save_data`，首先获取数据的`name`字段，即电影的名称，把电影名称作为`JSON`文件的名称，接着构造`JSON`文件的路径，然后用`json`的`dump`方法将数据保存成文本格式。`dump`的方法设置了两个参数，一个是`ensure_ascii`，将其设置为`False`，它可以保证中文字符在文件中能以正常的中文文本呈现，而不是`unicode`字符；另一个是`indent`，它的数值为2，这代表生成的`JSON`数据结果有两个空格缩进，让它的格式显得更加美观。\n\n最后，`main`方法再调用下`save_data`方法即可，实现如下：\n\n```python\ndef main():\n    for page in range(1, TOTAL_PAGE+1):\n        index_data = scrape_index(page)\n        for item in index_data.get('results'):\n            id = item.get('id')\n            print(id)\n            detail_data = scrape_detail(id)\n            logging.info('detail data %s', detail_data)\n            save_data(detail_data)\n```\n\n本地`results`文件夹下出现了各个电影的`JSON`文件，如图所示。\n\n![](Screenshot_4.webp)\n","slug":"Ajax爬取案例实战","published":1,"updated":"2021-06-15T03:24:11.420Z","layout":"post","photos":[],"link":"","_id":"ckq14rx1m000144ud120ngx2k","content":"<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><ul>\n<li>安装好<code>Python 3</code>（最低为 3.6 版本），并能成功运行<code>Python 3</code>程序。</li>\n<li>了解<code>PythonHTTP</code>请求库<code>requests</code>的基本用法。</li>\n<li>了解<code>Ajax</code>的基础知识和分析<code>Ajax</code>的基本方法。</li>\n</ul>\n<h2 id=\"爬取目标\"><a href=\"#爬取目标\" class=\"headerlink\" title=\"爬取目标\"></a>爬取目标</h2><p>其链接为：<a href=\"https://dynamic1.scrape.cuiqingcai.com/\">https://dynamic1.scrape.cuiqingcai.com/</a>，页面如图所示。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>需要完成的目标有：</p>\n<ul>\n<li>分析页面数据的加载逻辑。</li>\n<li>用<code>requests</code>实现<code>Ajax</code>数据的爬取。</li>\n<li>将每部电影的数据保存成一个<code>JSON</code>数据文件。</li>\n</ul>\n<h2 id=\"爬取列表页\"><a href=\"#爬取列表页\" class=\"headerlink\" title=\"爬取列表页\"></a>爬取列表页</h2><p>打开浏览器开发者工具，切换到<code>Network</code>面板，勾选上<code>「Preserve Log」</code>并切换到<code>「XHR」</code>选项卡，如图所示。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>点开第<code>2</code>个结果，观察到其<code>Ajax</code>接口请求的<code>URL</code>地址为：<code>https://dynamic1.scrape.cuiqingcai.com/api/movie/?limit=10&amp;offset=10</code>，这里有两个参数，一个是<code>limit</code>，其值为<code>10</code>，一个是<code>offset</code>，它的值也是<code>10</code>。</p>\n<p>切换到<code>Preview</code>选项卡，结果如图所示。</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<p>可以看到结果是一些<code>JSON</code>数据，它有一个<code>results</code>字段，这是一个列表，列表的每一个元素都是一个字典。观察一下字典的内容，可以看到对应的电影数据的字段了，如<code>name</code>、<code>alias</code>、<code>cover</code>、 <code>categories</code>，对比下浏览器中的真实数据，各个内容是完全一致的，而且这个数据已经非常结构化了，完全就是我们想要爬取的数据。</p>\n<p>导入一些所需的库并定义一些配置，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"></span><br><span class=\"line\">logging.basicConfig(level=logging.INFO,</span><br><span class=\"line\">                    <span class=\"built_in\">format</span>=<span class=\"string\">&#x27;%(asctime)s-%(levelname)s:%(message)s&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">INDEX_URL = <span class=\"string\">&#x27;https://dynamic1.scrape.cuiqingcai.com/api/movie/?limit=&#123;limit&#125;&amp;offset=&#123;offset&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>引入了<code>requests</code>和<code>logging</code>库，并定义了<code>logging</code>的基本配置，接着定义<code>INDEX_URL</code>，这里把<code>limit</code>和<code>offset</code>预留出来变成占位符，可以动态传入参数构造成一个完整的列表页<code>URL</code>。</p>\n<p>下面来实现一下列表页的爬取，先定义一个通用的爬取方法，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scrape_api</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    logging.info(<span class=\"string\">&#x27;scraping %s...&#x27;</span>, url)</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        response = requests.get(url, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> response.status_code == <span class=\"number\">200</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> response.json()</span><br><span class=\"line\">        logging.error(<span class=\"string\">&#x27;get invalid status code %s while scraping %s&#x27;</span>,</span><br><span class=\"line\">                      response.status_code, url)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> requests.RequestException:</span><br><span class=\"line\">        logging.error(<span class=\"string\">&#x27;error occurred while scraping %s&#x27;</span>, url, exc_info=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n<p>定义一个<code>scrape_api</code>方法，和之前不同的是，这个方法专门用来处理<code>JSON</code>接口，最后的<code>response</code>调用的是<code>json</code>方法，它可以解析响应的内容并将其转化成<code>JSON</code>字符串。</p>\n<p>在这个基础之上，定义一个爬取列表页的方法，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LIMIT = <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scrape_index</span>(<span class=\"params\">page</span>):</span></span><br><span class=\"line\">    url = INDEX_URL.<span class=\"built_in\">format</span>(limit=LIMIT, offset=LIMIT*(page-<span class=\"number\">1</span>))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> scrape_api(url)</span><br></pre></td></tr></table></figure>\n\n<p>定义了一个<code>scrape_index</code>方法，用来接收参数<code>page</code>，<code>page</code>代表列表页的页码。</p>\n<p>先构造了一个<code>URL</code>，通过字符串的<code>format</code>方法，传入<code>limit</code>和<code>offset</code>的值。这里的<code>limit</code>直接使用了全局变量<code>LIMIT</code>的值，<code>offset</code>则是动态计算的，计算方法是页码数减1再乘以<code>limit</code>，比如第1页的<code>offset</code>值就是<code>0</code>，第2页的<code>offset</code>值就是<code>10</code>，以此类推。构造好<code>URL</code>之后，直接调用<code>scrape_api</code>方法并返回结果即可。</p>\n<p>这样就完成了列表页的爬取，每次请求都会得到一页<code>10</code>部的电影数据。</p>\n<p>由于这时爬取到的数据已经是<code>JSON</code>类型了，所以不用像之前一样去解析<code>HTML</code>代码来提取数据，爬到的数据就是想要的结构化数据，因此解析这一步这里就可以直接省略。</p>\n<h2 id=\"爬取详情页\"><a href=\"#爬取详情页\" class=\"headerlink\" title=\"爬取详情页\"></a>爬取详情页</h2><p>这时候已经可以拿到每一页的电影数据了，但是实际上这些数据还缺少一些想要的信息，如剧情简介等，所以需要进一步进入到详情页来获取这些内容。</p>\n<p>这时候点击任意一部电影，如《教父》，进入到其详情页面，这时候可以发现页面的<code>URL</code>已经变成了<a href=\"https://dynamic1.scrape.cuiqingcai.com/detail/40\"></a>，页面也成功展示了详情页的信息</p>\n<p>先定义一个详情页的爬取逻辑吧，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DETAIL_URL = <span class=\"string\">&#x27;https://dynamic1.scrape.cuiqingcai.com/api/movie/&#123;id&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scrape_detail</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span></span><br><span class=\"line\">    url = DETAIL_URL.<span class=\"built_in\">format</span>(<span class=\"built_in\">id</span>=<span class=\"built_in\">id</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> scrape_api(url)</span><br></pre></td></tr></table></figure>\n\n<p>定义了一个<code>scrape_detail</code>方法，它接收参数<code>id</code>。这里的实现也非常简单，先根据定义好的<code>DETAIL_UR</code>L加上<code>id</code>，构造一个真实的详情页<code>Ajax</code>请求的<code>URL</code>，然后直接调用<code>scrape_api</code>方法传入这个<code>URL</code>即可。接着，定义一个总的调用方法，将以上的方法串联调用起来，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_PAGE+<span class=\"number\">1</span>):</span><br><span class=\"line\">        index_data = scrape_index(page)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> index_data.get(<span class=\"string\">&#x27;results&#x27;</span>):</span><br><span class=\"line\">            <span class=\"built_in\">id</span> = item.get(<span class=\"string\">&#x27;id&#x27;</span>)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"built_in\">id</span>)</span><br><span class=\"line\">            detail_data = scrape_detail(<span class=\"built_in\">id</span>)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;detail data %s&#x27;</span>, detail_data)</span><br></pre></td></tr></table></figure>\n\n<p>定义了一个<code>main</code>方法，首先遍历获取页码<code>page</code>，然后把<code>page</code>当成参数传递给<code>scrape_index</code>方法，得到列表页的数据。接着我遍历所有列表页的结果，获取每部电影的<code>id</code>，然后把<code>id</code>当作参数传递给<code>scrape_detail</code>方法，来爬取每部电影的详情数据，赋值为<code>detail_data</code>，输出即可。</p>\n<h2 id=\"保存数据\"><a href=\"#保存数据\" class=\"headerlink\" title=\"保存数据\"></a>保存数据</h2><p>定义一个数据保存的方法，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">from</span> os <span class=\"keyword\">import</span> makedirs</span><br><span class=\"line\"><span class=\"keyword\">from</span> os.path <span class=\"keyword\">import</span> exists</span><br><span class=\"line\"></span><br><span class=\"line\">RESULT_DIR = <span class=\"string\">&#x27;results&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">exists(RESULT_DIR) <span class=\"keyword\">or</span> makedirs(RESULT_DIR)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">save_data</span>(<span class=\"params\">data</span>):</span></span><br><span class=\"line\">    name = data.get(<span class=\"string\">&#x27;name&#x27;</span>)</span><br><span class=\"line\">    data_path = <span class=\"string\">f&#x27;<span class=\"subst\">&#123;RESULT_DIR&#125;</span>/<span class=\"subst\">&#123;name&#125;</span>.json&#x27;</span></span><br><span class=\"line\">    json.dump(data, <span class=\"built_in\">open</span>(data_path, <span class=\"string\">&#x27;w&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>), ensure_ascii=<span class=\"literal\">False</span>, indent=<span class=\"number\">2</span>)</span><br></pre></td></tr></table></figure>\n\n<p>首先定义了数据保存的文件夹<code>RESULTS_DIR</code>，注意，先要判断这个文件夹是否存在，如果不存在则需要创建。</p>\n<p>接着，定义了保存数据的方法<code>save_data</code>，首先获取数据的<code>name</code>字段，即电影的名称，把电影名称作为<code>JSON</code>文件的名称，接着构造<code>JSON</code>文件的路径，然后用<code>json</code>的<code>dump</code>方法将数据保存成文本格式。<code>dump</code>的方法设置了两个参数，一个是<code>ensure_ascii</code>，将其设置为<code>False</code>，它可以保证中文字符在文件中能以正常的中文文本呈现，而不是<code>unicode</code>字符；另一个是<code>indent</code>，它的数值为2，这代表生成的<code>JSON</code>数据结果有两个空格缩进，让它的格式显得更加美观。</p>\n<p>最后，<code>main</code>方法再调用下<code>save_data</code>方法即可，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_PAGE+<span class=\"number\">1</span>):</span><br><span class=\"line\">        index_data = scrape_index(page)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> index_data.get(<span class=\"string\">&#x27;results&#x27;</span>):</span><br><span class=\"line\">            <span class=\"built_in\">id</span> = item.get(<span class=\"string\">&#x27;id&#x27;</span>)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"built_in\">id</span>)</span><br><span class=\"line\">            detail_data = scrape_detail(<span class=\"built_in\">id</span>)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;detail data %s&#x27;</span>, detail_data)</span><br><span class=\"line\">            save_data(detail_data)</span><br></pre></td></tr></table></figure>\n\n<p>本地<code>results</code>文件夹下出现了各个电影的<code>JSON</code>文件，如图所示。</p>\n<p><img src=\"Screenshot_4.webp\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><ul>\n<li>安装好<code>Python 3</code>（最低为 3.6 版本），并能成功运行<code>Python 3</code>程序。</li>\n<li>了解<code>PythonHTTP</code>请求库<code>requests</code>的基本用法。</li>\n<li>了解<code>Ajax</code>的基础知识和分析<code>Ajax</code>的基本方法。</li>\n</ul>\n<h2 id=\"爬取目标\"><a href=\"#爬取目标\" class=\"headerlink\" title=\"爬取目标\"></a>爬取目标</h2><p>其链接为：<a href=\"https://dynamic1.scrape.cuiqingcai.com/\">https://dynamic1.scrape.cuiqingcai.com/</a>，页面如图所示。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>需要完成的目标有：</p>\n<ul>\n<li>分析页面数据的加载逻辑。</li>\n<li>用<code>requests</code>实现<code>Ajax</code>数据的爬取。</li>\n<li>将每部电影的数据保存成一个<code>JSON</code>数据文件。</li>\n</ul>\n<h2 id=\"爬取列表页\"><a href=\"#爬取列表页\" class=\"headerlink\" title=\"爬取列表页\"></a>爬取列表页</h2><p>打开浏览器开发者工具，切换到<code>Network</code>面板，勾选上<code>「Preserve Log」</code>并切换到<code>「XHR」</code>选项卡，如图所示。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>点开第<code>2</code>个结果，观察到其<code>Ajax</code>接口请求的<code>URL</code>地址为：<code>https://dynamic1.scrape.cuiqingcai.com/api/movie/?limit=10&amp;offset=10</code>，这里有两个参数，一个是<code>limit</code>，其值为<code>10</code>，一个是<code>offset</code>，它的值也是<code>10</code>。</p>\n<p>切换到<code>Preview</code>选项卡，结果如图所示。</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<p>可以看到结果是一些<code>JSON</code>数据，它有一个<code>results</code>字段，这是一个列表，列表的每一个元素都是一个字典。观察一下字典的内容，可以看到对应的电影数据的字段了，如<code>name</code>、<code>alias</code>、<code>cover</code>、 <code>categories</code>，对比下浏览器中的真实数据，各个内容是完全一致的，而且这个数据已经非常结构化了，完全就是我们想要爬取的数据。</p>\n<p>导入一些所需的库并定义一些配置，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"></span><br><span class=\"line\">logging.basicConfig(level=logging.INFO,</span><br><span class=\"line\">                    <span class=\"built_in\">format</span>=<span class=\"string\">&#x27;%(asctime)s-%(levelname)s:%(message)s&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">INDEX_URL = <span class=\"string\">&#x27;https://dynamic1.scrape.cuiqingcai.com/api/movie/?limit=&#123;limit&#125;&amp;offset=&#123;offset&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>引入了<code>requests</code>和<code>logging</code>库，并定义了<code>logging</code>的基本配置，接着定义<code>INDEX_URL</code>，这里把<code>limit</code>和<code>offset</code>预留出来变成占位符，可以动态传入参数构造成一个完整的列表页<code>URL</code>。</p>\n<p>下面来实现一下列表页的爬取，先定义一个通用的爬取方法，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scrape_api</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    logging.info(<span class=\"string\">&#x27;scraping %s...&#x27;</span>, url)</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        response = requests.get(url, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> response.status_code == <span class=\"number\">200</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> response.json()</span><br><span class=\"line\">        logging.error(<span class=\"string\">&#x27;get invalid status code %s while scraping %s&#x27;</span>,</span><br><span class=\"line\">                      response.status_code, url)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> requests.RequestException:</span><br><span class=\"line\">        logging.error(<span class=\"string\">&#x27;error occurred while scraping %s&#x27;</span>, url, exc_info=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n<p>定义一个<code>scrape_api</code>方法，和之前不同的是，这个方法专门用来处理<code>JSON</code>接口，最后的<code>response</code>调用的是<code>json</code>方法，它可以解析响应的内容并将其转化成<code>JSON</code>字符串。</p>\n<p>在这个基础之上，定义一个爬取列表页的方法，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LIMIT = <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scrape_index</span>(<span class=\"params\">page</span>):</span></span><br><span class=\"line\">    url = INDEX_URL.<span class=\"built_in\">format</span>(limit=LIMIT, offset=LIMIT*(page-<span class=\"number\">1</span>))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> scrape_api(url)</span><br></pre></td></tr></table></figure>\n\n<p>定义了一个<code>scrape_index</code>方法，用来接收参数<code>page</code>，<code>page</code>代表列表页的页码。</p>\n<p>先构造了一个<code>URL</code>，通过字符串的<code>format</code>方法，传入<code>limit</code>和<code>offset</code>的值。这里的<code>limit</code>直接使用了全局变量<code>LIMIT</code>的值，<code>offset</code>则是动态计算的，计算方法是页码数减1再乘以<code>limit</code>，比如第1页的<code>offset</code>值就是<code>0</code>，第2页的<code>offset</code>值就是<code>10</code>，以此类推。构造好<code>URL</code>之后，直接调用<code>scrape_api</code>方法并返回结果即可。</p>\n<p>这样就完成了列表页的爬取，每次请求都会得到一页<code>10</code>部的电影数据。</p>\n<p>由于这时爬取到的数据已经是<code>JSON</code>类型了，所以不用像之前一样去解析<code>HTML</code>代码来提取数据，爬到的数据就是想要的结构化数据，因此解析这一步这里就可以直接省略。</p>\n<h2 id=\"爬取详情页\"><a href=\"#爬取详情页\" class=\"headerlink\" title=\"爬取详情页\"></a>爬取详情页</h2><p>这时候已经可以拿到每一页的电影数据了，但是实际上这些数据还缺少一些想要的信息，如剧情简介等，所以需要进一步进入到详情页来获取这些内容。</p>\n<p>这时候点击任意一部电影，如《教父》，进入到其详情页面，这时候可以发现页面的<code>URL</code>已经变成了<a href=\"https://dynamic1.scrape.cuiqingcai.com/detail/40\"></a>，页面也成功展示了详情页的信息</p>\n<p>先定义一个详情页的爬取逻辑吧，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DETAIL_URL = <span class=\"string\">&#x27;https://dynamic1.scrape.cuiqingcai.com/api/movie/&#123;id&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scrape_detail</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span></span><br><span class=\"line\">    url = DETAIL_URL.<span class=\"built_in\">format</span>(<span class=\"built_in\">id</span>=<span class=\"built_in\">id</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> scrape_api(url)</span><br></pre></td></tr></table></figure>\n\n<p>定义了一个<code>scrape_detail</code>方法，它接收参数<code>id</code>。这里的实现也非常简单，先根据定义好的<code>DETAIL_UR</code>L加上<code>id</code>，构造一个真实的详情页<code>Ajax</code>请求的<code>URL</code>，然后直接调用<code>scrape_api</code>方法传入这个<code>URL</code>即可。接着，定义一个总的调用方法，将以上的方法串联调用起来，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_PAGE+<span class=\"number\">1</span>):</span><br><span class=\"line\">        index_data = scrape_index(page)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> index_data.get(<span class=\"string\">&#x27;results&#x27;</span>):</span><br><span class=\"line\">            <span class=\"built_in\">id</span> = item.get(<span class=\"string\">&#x27;id&#x27;</span>)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"built_in\">id</span>)</span><br><span class=\"line\">            detail_data = scrape_detail(<span class=\"built_in\">id</span>)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;detail data %s&#x27;</span>, detail_data)</span><br></pre></td></tr></table></figure>\n\n<p>定义了一个<code>main</code>方法，首先遍历获取页码<code>page</code>，然后把<code>page</code>当成参数传递给<code>scrape_index</code>方法，得到列表页的数据。接着我遍历所有列表页的结果，获取每部电影的<code>id</code>，然后把<code>id</code>当作参数传递给<code>scrape_detail</code>方法，来爬取每部电影的详情数据，赋值为<code>detail_data</code>，输出即可。</p>\n<h2 id=\"保存数据\"><a href=\"#保存数据\" class=\"headerlink\" title=\"保存数据\"></a>保存数据</h2><p>定义一个数据保存的方法，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">from</span> os <span class=\"keyword\">import</span> makedirs</span><br><span class=\"line\"><span class=\"keyword\">from</span> os.path <span class=\"keyword\">import</span> exists</span><br><span class=\"line\"></span><br><span class=\"line\">RESULT_DIR = <span class=\"string\">&#x27;results&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">exists(RESULT_DIR) <span class=\"keyword\">or</span> makedirs(RESULT_DIR)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">save_data</span>(<span class=\"params\">data</span>):</span></span><br><span class=\"line\">    name = data.get(<span class=\"string\">&#x27;name&#x27;</span>)</span><br><span class=\"line\">    data_path = <span class=\"string\">f&#x27;<span class=\"subst\">&#123;RESULT_DIR&#125;</span>/<span class=\"subst\">&#123;name&#125;</span>.json&#x27;</span></span><br><span class=\"line\">    json.dump(data, <span class=\"built_in\">open</span>(data_path, <span class=\"string\">&#x27;w&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>), ensure_ascii=<span class=\"literal\">False</span>, indent=<span class=\"number\">2</span>)</span><br></pre></td></tr></table></figure>\n\n<p>首先定义了数据保存的文件夹<code>RESULTS_DIR</code>，注意，先要判断这个文件夹是否存在，如果不存在则需要创建。</p>\n<p>接着，定义了保存数据的方法<code>save_data</code>，首先获取数据的<code>name</code>字段，即电影的名称，把电影名称作为<code>JSON</code>文件的名称，接着构造<code>JSON</code>文件的路径，然后用<code>json</code>的<code>dump</code>方法将数据保存成文本格式。<code>dump</code>的方法设置了两个参数，一个是<code>ensure_ascii</code>，将其设置为<code>False</code>，它可以保证中文字符在文件中能以正常的中文文本呈现，而不是<code>unicode</code>字符；另一个是<code>indent</code>，它的数值为2，这代表生成的<code>JSON</code>数据结果有两个空格缩进，让它的格式显得更加美观。</p>\n<p>最后，<code>main</code>方法再调用下<code>save_data</code>方法即可，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_PAGE+<span class=\"number\">1</span>):</span><br><span class=\"line\">        index_data = scrape_index(page)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> index_data.get(<span class=\"string\">&#x27;results&#x27;</span>):</span><br><span class=\"line\">            <span class=\"built_in\">id</span> = item.get(<span class=\"string\">&#x27;id&#x27;</span>)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"built_in\">id</span>)</span><br><span class=\"line\">            detail_data = scrape_detail(<span class=\"built_in\">id</span>)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;detail data %s&#x27;</span>, detail_data)</span><br><span class=\"line\">            save_data(detail_data)</span><br></pre></td></tr></table></figure>\n\n<p>本地<code>results</code>文件夹下出现了各个电影的<code>JSON</code>文件，如图所示。</p>\n<p><img src=\"Screenshot_4.webp\"></p>\n"},{"title":"Ajax的原理和解析","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-24T08:33:38.000Z","pic":null,"_content":"\n## 什么是Ajax？\n\n`Ajax`，全称为`Asynchronous JavaScriptand XML`，即异步的`JavaScript`和`XML`。它不是一门编程语言，而是利用`JavaScript`在保证页面不被刷新、页面链接不改变的情况下与服务器交换数据并更新部分网页的技术。\n\n传统的网页，如果你想更新其内容，那么必须要刷新整个页面。有了`Ajax`，便可以在页面不被全部刷新的情况下更新其内容。在这个过程中，页面实际上在后台与服务器进行了数据交互，获取到数据之后，再 利用`JavaScript`改变网页，这样网页内容就会更新了。\n\n到`W3School`上体验几个`Demo`来感受一下：[http://www.w3school.com.cn/ajax/ajax_xmlhttprequest_send.asp](http://www.w3school.com.cn/ajax/ajax_xmlhttprequest_send.asp)。\n\n## 基本原理\n\n初步了解了`Ajax`之后，来详细了解它的基本原理。发送`Ajax`请求到网页更新的过程可以简单分为以下3步：\n\n- 发送请求\n- 解析内容\n- 渲染网页\n\n### 发送请求\n\n`JavaScript`可以实现页面的各种交互功能，`Ajax`也不例外，它是由`JavaScript`实现的，实际上执行了如下代码：\n\n```javascript\nvar xmlhttp;\nif (window.XMLHttpRequest)\n  {// code for IE7+, Firefox, Chrome, Opera, Safari\n  xmlhttp=new XMLHttpRequest();\n  }\nelse\n  {// code for IE6, IE5\n  xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\");\n  }\nxmlhttp.onreadystatechange=function()\n  {\n  if (xmlhttp.readyState==4 && xmlhttp.status==200)\n    {\n    document.getElementById(\"myDiv\").innerHTML=xmlhttp.responseText;\n    }\n  }\nxmlhttp.open(\"GET\",\"/ajax/demo_get.asp\",true);\nxmlhttp.send();\n```\n\n这是`JavaScript`对`Ajax`最底层的实现，这个过程实际上是新建了`XMLHttpRequest`对象，然后调用`onreadystatechange`属性设置监听，最后调用`open()`和`send()`方法向某个链接（也就是服务器）发送请求。\n\n用`Python`实现请求发送之后，可以得到响应结果，但这里请求的发送由`JavaScript`来完成。由于设置了监听，所以当服务器返回响应时，`onreadystatechange`对应的方法便会被触发，在这个方法里面 解析响应内容即可。\n\n### 解析内容\n\n解得到响应之后，`onreadystatechange`属性对应的方法会被触发，此时利用`xmlhttp`的`responseText`属性便可取到响应内容。这类似于`Python`中利用`requests`向服务器发起请求，然后得到响应的过程。\n\n返回的内容可能是`HTML`，也可能是`JSON`，接下来只需要在方法中用`JavaScript`进一步处理即可。比如，如果返回的内容是`JSON`的话，可以对它进行解析和转化。\n\n### 渲染网页\n\n`JavaScript`有改变网页内容的能力，解析完响应内容之后，就可以调用`JavaScript`针对解析完的内容对网页进行下一步处理。比如，通过`document.getElementById().innerHTML`这样的操作，对某个元素内的源代码进行更改，这样网页显示的内容就改变了，这种对`Document`网页文档进行如更改、删除等操作也被称作**`DOM`操作**。\n\n上例中，`document.getElementById(\"myDiv\").innerHTML=xmlhttp.responseText`这个操作便将`ID`为`myDiv`的节点内部的`HTML`代码更改为服务器返回的内容，这样`myDiv`元素内部便会呈现出服务器返回的新数据，网页的部分内容看上去就更新了。\n\n可以看到，**发送请求**、**解析内容**和**渲染网页**这3个步骤其实都是由`JavaScript`完成的。\n\n## Ajax分析\n\n用浏览器打开微博链接[https://weibo.com/u/5902654742](https://weibo.com/u/5902654742)，随后在页面中点击鼠标右键，从弹出的快捷菜单中选择“检查”选项，此时便会弹出开发者工具，如图所示：\n\n![](Screenshot_1.webp)\n\n```python\n\n```\n\n`Ajax`有其特殊的请求类型，它叫作`xhr`。在图中我们可以发现一个以`getIndex`开头的请求，其`Type`为`xhr`，这就是一个`Ajax`请求。用鼠标点击这个请求，可以查看这个请求的详细信息。\n\n![](Screenshot_2.webp)\n\n在右侧可以观察到`Request Headers`、`URL`和`Response Headers`等信息。`Request Headers`中有一个信息为`X-Requested-With:XMLHttpRequest`，这就标记了此请求是`Ajax`请求，如图所示：\n\n![](Screenshot_3.webp)\n\n![](Screenshot_4.webp)\n\n点击`Preview`，即可看到响应的内容，它是`JSON`格式的。这里`Chrome`为我们自动做了解析，点击箭头即可展开和收起相应内容。\n\n可以观察到，返回结果是我的个人信息，包括昵称、简介、头像等，这也是用来渲染个人主页所使用的数据。`JavaScript`接收到这些数据之后，再执行相应的渲染方法，整个页面就渲染出来了。\n\n![](Screenshot_5.webp)\n\n切换到`Response`选项卡，从中观察到真实的返回数据，如图所示：\n\n![](Screenshot_6.webp)\n\n所以说，我们看到的微博页面的真实数据并不是最原始的页面返回的，而是在执行 JavaScript 后再次向后台发送 Ajax请求，浏览器拿到数据后进一步渲染出来的。\n\n## 过滤请求\n\n利用`Chrome`开发者工具的筛选功能筛选出所有的`Ajax`请求。在请求的上方有一层筛选栏，直接点击`XHR`，此时在下方显示的所有请求便都是`Ajax`请求了，如图所示：\n\n![](Screenshot_7.webp)\n\n接下来，不断滑动页面，可以看到页面底部有一条条新的微博被刷出，而开发者工具下方也不断地出现`Ajax`请求，这样我们就可以捕获到所有的`Ajax`请求了。 随意点开一个条目，都可以清楚地看到其`Request URL、Request Headers、Response Headers、Response Body`等内容，此时想要模拟请求和提取就非常简单了。\n\n![](Screenshot_8.webp)\n\n","source":"_posts/Ajax的原理和解析.md","raw":"---\ntitle: Ajax的原理和解析\ntags:\n  - ajax\n  - javascript\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-24 16:33:38\ncategories: 爬虫\npic:\n---\n\n## 什么是Ajax？\n\n`Ajax`，全称为`Asynchronous JavaScriptand XML`，即异步的`JavaScript`和`XML`。它不是一门编程语言，而是利用`JavaScript`在保证页面不被刷新、页面链接不改变的情况下与服务器交换数据并更新部分网页的技术。\n\n传统的网页，如果你想更新其内容，那么必须要刷新整个页面。有了`Ajax`，便可以在页面不被全部刷新的情况下更新其内容。在这个过程中，页面实际上在后台与服务器进行了数据交互，获取到数据之后，再 利用`JavaScript`改变网页，这样网页内容就会更新了。\n\n到`W3School`上体验几个`Demo`来感受一下：[http://www.w3school.com.cn/ajax/ajax_xmlhttprequest_send.asp](http://www.w3school.com.cn/ajax/ajax_xmlhttprequest_send.asp)。\n\n## 基本原理\n\n初步了解了`Ajax`之后，来详细了解它的基本原理。发送`Ajax`请求到网页更新的过程可以简单分为以下3步：\n\n- 发送请求\n- 解析内容\n- 渲染网页\n\n### 发送请求\n\n`JavaScript`可以实现页面的各种交互功能，`Ajax`也不例外，它是由`JavaScript`实现的，实际上执行了如下代码：\n\n```javascript\nvar xmlhttp;\nif (window.XMLHttpRequest)\n  {// code for IE7+, Firefox, Chrome, Opera, Safari\n  xmlhttp=new XMLHttpRequest();\n  }\nelse\n  {// code for IE6, IE5\n  xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\");\n  }\nxmlhttp.onreadystatechange=function()\n  {\n  if (xmlhttp.readyState==4 && xmlhttp.status==200)\n    {\n    document.getElementById(\"myDiv\").innerHTML=xmlhttp.responseText;\n    }\n  }\nxmlhttp.open(\"GET\",\"/ajax/demo_get.asp\",true);\nxmlhttp.send();\n```\n\n这是`JavaScript`对`Ajax`最底层的实现，这个过程实际上是新建了`XMLHttpRequest`对象，然后调用`onreadystatechange`属性设置监听，最后调用`open()`和`send()`方法向某个链接（也就是服务器）发送请求。\n\n用`Python`实现请求发送之后，可以得到响应结果，但这里请求的发送由`JavaScript`来完成。由于设置了监听，所以当服务器返回响应时，`onreadystatechange`对应的方法便会被触发，在这个方法里面 解析响应内容即可。\n\n### 解析内容\n\n解得到响应之后，`onreadystatechange`属性对应的方法会被触发，此时利用`xmlhttp`的`responseText`属性便可取到响应内容。这类似于`Python`中利用`requests`向服务器发起请求，然后得到响应的过程。\n\n返回的内容可能是`HTML`，也可能是`JSON`，接下来只需要在方法中用`JavaScript`进一步处理即可。比如，如果返回的内容是`JSON`的话，可以对它进行解析和转化。\n\n### 渲染网页\n\n`JavaScript`有改变网页内容的能力，解析完响应内容之后，就可以调用`JavaScript`针对解析完的内容对网页进行下一步处理。比如，通过`document.getElementById().innerHTML`这样的操作，对某个元素内的源代码进行更改，这样网页显示的内容就改变了，这种对`Document`网页文档进行如更改、删除等操作也被称作**`DOM`操作**。\n\n上例中，`document.getElementById(\"myDiv\").innerHTML=xmlhttp.responseText`这个操作便将`ID`为`myDiv`的节点内部的`HTML`代码更改为服务器返回的内容，这样`myDiv`元素内部便会呈现出服务器返回的新数据，网页的部分内容看上去就更新了。\n\n可以看到，**发送请求**、**解析内容**和**渲染网页**这3个步骤其实都是由`JavaScript`完成的。\n\n## Ajax分析\n\n用浏览器打开微博链接[https://weibo.com/u/5902654742](https://weibo.com/u/5902654742)，随后在页面中点击鼠标右键，从弹出的快捷菜单中选择“检查”选项，此时便会弹出开发者工具，如图所示：\n\n![](Screenshot_1.webp)\n\n```python\n\n```\n\n`Ajax`有其特殊的请求类型，它叫作`xhr`。在图中我们可以发现一个以`getIndex`开头的请求，其`Type`为`xhr`，这就是一个`Ajax`请求。用鼠标点击这个请求，可以查看这个请求的详细信息。\n\n![](Screenshot_2.webp)\n\n在右侧可以观察到`Request Headers`、`URL`和`Response Headers`等信息。`Request Headers`中有一个信息为`X-Requested-With:XMLHttpRequest`，这就标记了此请求是`Ajax`请求，如图所示：\n\n![](Screenshot_3.webp)\n\n![](Screenshot_4.webp)\n\n点击`Preview`，即可看到响应的内容，它是`JSON`格式的。这里`Chrome`为我们自动做了解析，点击箭头即可展开和收起相应内容。\n\n可以观察到，返回结果是我的个人信息，包括昵称、简介、头像等，这也是用来渲染个人主页所使用的数据。`JavaScript`接收到这些数据之后，再执行相应的渲染方法，整个页面就渲染出来了。\n\n![](Screenshot_5.webp)\n\n切换到`Response`选项卡，从中观察到真实的返回数据，如图所示：\n\n![](Screenshot_6.webp)\n\n所以说，我们看到的微博页面的真实数据并不是最原始的页面返回的，而是在执行 JavaScript 后再次向后台发送 Ajax请求，浏览器拿到数据后进一步渲染出来的。\n\n## 过滤请求\n\n利用`Chrome`开发者工具的筛选功能筛选出所有的`Ajax`请求。在请求的上方有一层筛选栏，直接点击`XHR`，此时在下方显示的所有请求便都是`Ajax`请求了，如图所示：\n\n![](Screenshot_7.webp)\n\n接下来，不断滑动页面，可以看到页面底部有一条条新的微博被刷出，而开发者工具下方也不断地出现`Ajax`请求，这样我们就可以捕获到所有的`Ajax`请求了。 随意点开一个条目，都可以清楚地看到其`Request URL、Request Headers、Response Headers、Response Body`等内容，此时想要模拟请求和提取就非常简单了。\n\n![](Screenshot_8.webp)\n\n","slug":"Ajax的原理和解析","published":1,"updated":"2021-06-15T03:24:11.428Z","layout":"post","photos":[],"link":"","_id":"ckq14rx1p000244ud8p7lapr2","content":"<h2 id=\"什么是Ajax？\"><a href=\"#什么是Ajax？\" class=\"headerlink\" title=\"什么是Ajax？\"></a>什么是Ajax？</h2><p><code>Ajax</code>，全称为<code>Asynchronous JavaScriptand XML</code>，即异步的<code>JavaScript</code>和<code>XML</code>。它不是一门编程语言，而是利用<code>JavaScript</code>在保证页面不被刷新、页面链接不改变的情况下与服务器交换数据并更新部分网页的技术。</p>\n<p>传统的网页，如果你想更新其内容，那么必须要刷新整个页面。有了<code>Ajax</code>，便可以在页面不被全部刷新的情况下更新其内容。在这个过程中，页面实际上在后台与服务器进行了数据交互，获取到数据之后，再 利用<code>JavaScript</code>改变网页，这样网页内容就会更新了。</p>\n<p>到<code>W3School</code>上体验几个<code>Demo</code>来感受一下：<a href=\"http://www.w3school.com.cn/ajax/ajax_xmlhttprequest_send.asp\">http://www.w3school.com.cn/ajax/ajax_xmlhttprequest_send.asp</a>。</p>\n<h2 id=\"基本原理\"><a href=\"#基本原理\" class=\"headerlink\" title=\"基本原理\"></a>基本原理</h2><p>初步了解了<code>Ajax</code>之后，来详细了解它的基本原理。发送<code>Ajax</code>请求到网页更新的过程可以简单分为以下3步：</p>\n<ul>\n<li>发送请求</li>\n<li>解析内容</li>\n<li>渲染网页</li>\n</ul>\n<h3 id=\"发送请求\"><a href=\"#发送请求\" class=\"headerlink\" title=\"发送请求\"></a>发送请求</h3><p><code>JavaScript</code>可以实现页面的各种交互功能，<code>Ajax</code>也不例外，它是由<code>JavaScript</code>实现的，实际上执行了如下代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> xmlhttp;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.XMLHttpRequest)</span><br><span class=\"line\">  &#123;<span class=\"comment\">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class=\"line\">  xmlhttp=<span class=\"keyword\">new</span> XMLHttpRequest();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  &#123;<span class=\"comment\">// code for IE6, IE5</span></span><br><span class=\"line\">  xmlhttp=<span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">xmlhttp.onreadystatechange=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">  </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (xmlhttp.readyState==<span class=\"number\">4</span> &amp;&amp; xmlhttp.status==<span class=\"number\">200</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;myDiv&quot;</span>).innerHTML=xmlhttp.responseText;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">xmlhttp.open(<span class=\"string\">&quot;GET&quot;</span>,<span class=\"string\">&quot;/ajax/demo_get.asp&quot;</span>,<span class=\"literal\">true</span>);</span><br><span class=\"line\">xmlhttp.send();</span><br></pre></td></tr></table></figure>\n\n<p>这是<code>JavaScript</code>对<code>Ajax</code>最底层的实现，这个过程实际上是新建了<code>XMLHttpRequest</code>对象，然后调用<code>onreadystatechange</code>属性设置监听，最后调用<code>open()</code>和<code>send()</code>方法向某个链接（也就是服务器）发送请求。</p>\n<p>用<code>Python</code>实现请求发送之后，可以得到响应结果，但这里请求的发送由<code>JavaScript</code>来完成。由于设置了监听，所以当服务器返回响应时，<code>onreadystatechange</code>对应的方法便会被触发，在这个方法里面 解析响应内容即可。</p>\n<h3 id=\"解析内容\"><a href=\"#解析内容\" class=\"headerlink\" title=\"解析内容\"></a>解析内容</h3><p>解得到响应之后，<code>onreadystatechange</code>属性对应的方法会被触发，此时利用<code>xmlhttp</code>的<code>responseText</code>属性便可取到响应内容。这类似于<code>Python</code>中利用<code>requests</code>向服务器发起请求，然后得到响应的过程。</p>\n<p>返回的内容可能是<code>HTML</code>，也可能是<code>JSON</code>，接下来只需要在方法中用<code>JavaScript</code>进一步处理即可。比如，如果返回的内容是<code>JSON</code>的话，可以对它进行解析和转化。</p>\n<h3 id=\"渲染网页\"><a href=\"#渲染网页\" class=\"headerlink\" title=\"渲染网页\"></a>渲染网页</h3><p><code>JavaScript</code>有改变网页内容的能力，解析完响应内容之后，就可以调用<code>JavaScript</code>针对解析完的内容对网页进行下一步处理。比如，通过<code>document.getElementById().innerHTML</code>这样的操作，对某个元素内的源代码进行更改，这样网页显示的内容就改变了，这种对<code>Document</code>网页文档进行如更改、删除等操作也被称作**<code>DOM</code>操作**。</p>\n<p>上例中，<code>document.getElementById(&quot;myDiv&quot;).innerHTML=xmlhttp.responseText</code>这个操作便将<code>ID</code>为<code>myDiv</code>的节点内部的<code>HTML</code>代码更改为服务器返回的内容，这样<code>myDiv</code>元素内部便会呈现出服务器返回的新数据，网页的部分内容看上去就更新了。</p>\n<p>可以看到，<strong>发送请求</strong>、<strong>解析内容</strong>和<strong>渲染网页</strong>这3个步骤其实都是由<code>JavaScript</code>完成的。</p>\n<h2 id=\"Ajax分析\"><a href=\"#Ajax分析\" class=\"headerlink\" title=\"Ajax分析\"></a>Ajax分析</h2><p>用浏览器打开微博链接<a href=\"https://weibo.com/u/5902654742\">https://weibo.com/u/5902654742</a>，随后在页面中点击鼠标右键，从弹出的快捷菜单中选择“检查”选项，此时便会弹出开发者工具，如图所示：</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>Ajax</code>有其特殊的请求类型，它叫作<code>xhr</code>。在图中我们可以发现一个以<code>getIndex</code>开头的请求，其<code>Type</code>为<code>xhr</code>，这就是一个<code>Ajax</code>请求。用鼠标点击这个请求，可以查看这个请求的详细信息。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>在右侧可以观察到<code>Request Headers</code>、<code>URL</code>和<code>Response Headers</code>等信息。<code>Request Headers</code>中有一个信息为<code>X-Requested-With:XMLHttpRequest</code>，这就标记了此请求是<code>Ajax</code>请求，如图所示：</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<p><img src=\"Screenshot_4.webp\"></p>\n<p>点击<code>Preview</code>，即可看到响应的内容，它是<code>JSON</code>格式的。这里<code>Chrome</code>为我们自动做了解析，点击箭头即可展开和收起相应内容。</p>\n<p>可以观察到，返回结果是我的个人信息，包括昵称、简介、头像等，这也是用来渲染个人主页所使用的数据。<code>JavaScript</code>接收到这些数据之后，再执行相应的渲染方法，整个页面就渲染出来了。</p>\n<p><img src=\"Screenshot_5.webp\"></p>\n<p>切换到<code>Response</code>选项卡，从中观察到真实的返回数据，如图所示：</p>\n<p><img src=\"Screenshot_6.webp\"></p>\n<p>所以说，我们看到的微博页面的真实数据并不是最原始的页面返回的，而是在执行 JavaScript 后再次向后台发送 Ajax请求，浏览器拿到数据后进一步渲染出来的。</p>\n<h2 id=\"过滤请求\"><a href=\"#过滤请求\" class=\"headerlink\" title=\"过滤请求\"></a>过滤请求</h2><p>利用<code>Chrome</code>开发者工具的筛选功能筛选出所有的<code>Ajax</code>请求。在请求的上方有一层筛选栏，直接点击<code>XHR</code>，此时在下方显示的所有请求便都是<code>Ajax</code>请求了，如图所示：</p>\n<p><img src=\"Screenshot_7.webp\"></p>\n<p>接下来，不断滑动页面，可以看到页面底部有一条条新的微博被刷出，而开发者工具下方也不断地出现<code>Ajax</code>请求，这样我们就可以捕获到所有的<code>Ajax</code>请求了。 随意点开一个条目，都可以清楚地看到其<code>Request URL、Request Headers、Response Headers、Response Body</code>等内容，此时想要模拟请求和提取就非常简单了。</p>\n<p><img src=\"Screenshot_8.webp\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"什么是Ajax？\"><a href=\"#什么是Ajax？\" class=\"headerlink\" title=\"什么是Ajax？\"></a>什么是Ajax？</h2><p><code>Ajax</code>，全称为<code>Asynchronous JavaScriptand XML</code>，即异步的<code>JavaScript</code>和<code>XML</code>。它不是一门编程语言，而是利用<code>JavaScript</code>在保证页面不被刷新、页面链接不改变的情况下与服务器交换数据并更新部分网页的技术。</p>\n<p>传统的网页，如果你想更新其内容，那么必须要刷新整个页面。有了<code>Ajax</code>，便可以在页面不被全部刷新的情况下更新其内容。在这个过程中，页面实际上在后台与服务器进行了数据交互，获取到数据之后，再 利用<code>JavaScript</code>改变网页，这样网页内容就会更新了。</p>\n<p>到<code>W3School</code>上体验几个<code>Demo</code>来感受一下：<a href=\"http://www.w3school.com.cn/ajax/ajax_xmlhttprequest_send.asp\">http://www.w3school.com.cn/ajax/ajax_xmlhttprequest_send.asp</a>。</p>\n<h2 id=\"基本原理\"><a href=\"#基本原理\" class=\"headerlink\" title=\"基本原理\"></a>基本原理</h2><p>初步了解了<code>Ajax</code>之后，来详细了解它的基本原理。发送<code>Ajax</code>请求到网页更新的过程可以简单分为以下3步：</p>\n<ul>\n<li>发送请求</li>\n<li>解析内容</li>\n<li>渲染网页</li>\n</ul>\n<h3 id=\"发送请求\"><a href=\"#发送请求\" class=\"headerlink\" title=\"发送请求\"></a>发送请求</h3><p><code>JavaScript</code>可以实现页面的各种交互功能，<code>Ajax</code>也不例外，它是由<code>JavaScript</code>实现的，实际上执行了如下代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> xmlhttp;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.XMLHttpRequest)</span><br><span class=\"line\">  &#123;<span class=\"comment\">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class=\"line\">  xmlhttp=<span class=\"keyword\">new</span> XMLHttpRequest();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  &#123;<span class=\"comment\">// code for IE6, IE5</span></span><br><span class=\"line\">  xmlhttp=<span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">xmlhttp.onreadystatechange=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">  </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (xmlhttp.readyState==<span class=\"number\">4</span> &amp;&amp; xmlhttp.status==<span class=\"number\">200</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;myDiv&quot;</span>).innerHTML=xmlhttp.responseText;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">xmlhttp.open(<span class=\"string\">&quot;GET&quot;</span>,<span class=\"string\">&quot;/ajax/demo_get.asp&quot;</span>,<span class=\"literal\">true</span>);</span><br><span class=\"line\">xmlhttp.send();</span><br></pre></td></tr></table></figure>\n\n<p>这是<code>JavaScript</code>对<code>Ajax</code>最底层的实现，这个过程实际上是新建了<code>XMLHttpRequest</code>对象，然后调用<code>onreadystatechange</code>属性设置监听，最后调用<code>open()</code>和<code>send()</code>方法向某个链接（也就是服务器）发送请求。</p>\n<p>用<code>Python</code>实现请求发送之后，可以得到响应结果，但这里请求的发送由<code>JavaScript</code>来完成。由于设置了监听，所以当服务器返回响应时，<code>onreadystatechange</code>对应的方法便会被触发，在这个方法里面 解析响应内容即可。</p>\n<h3 id=\"解析内容\"><a href=\"#解析内容\" class=\"headerlink\" title=\"解析内容\"></a>解析内容</h3><p>解得到响应之后，<code>onreadystatechange</code>属性对应的方法会被触发，此时利用<code>xmlhttp</code>的<code>responseText</code>属性便可取到响应内容。这类似于<code>Python</code>中利用<code>requests</code>向服务器发起请求，然后得到响应的过程。</p>\n<p>返回的内容可能是<code>HTML</code>，也可能是<code>JSON</code>，接下来只需要在方法中用<code>JavaScript</code>进一步处理即可。比如，如果返回的内容是<code>JSON</code>的话，可以对它进行解析和转化。</p>\n<h3 id=\"渲染网页\"><a href=\"#渲染网页\" class=\"headerlink\" title=\"渲染网页\"></a>渲染网页</h3><p><code>JavaScript</code>有改变网页内容的能力，解析完响应内容之后，就可以调用<code>JavaScript</code>针对解析完的内容对网页进行下一步处理。比如，通过<code>document.getElementById().innerHTML</code>这样的操作，对某个元素内的源代码进行更改，这样网页显示的内容就改变了，这种对<code>Document</code>网页文档进行如更改、删除等操作也被称作**<code>DOM</code>操作**。</p>\n<p>上例中，<code>document.getElementById(&quot;myDiv&quot;).innerHTML=xmlhttp.responseText</code>这个操作便将<code>ID</code>为<code>myDiv</code>的节点内部的<code>HTML</code>代码更改为服务器返回的内容，这样<code>myDiv</code>元素内部便会呈现出服务器返回的新数据，网页的部分内容看上去就更新了。</p>\n<p>可以看到，<strong>发送请求</strong>、<strong>解析内容</strong>和<strong>渲染网页</strong>这3个步骤其实都是由<code>JavaScript</code>完成的。</p>\n<h2 id=\"Ajax分析\"><a href=\"#Ajax分析\" class=\"headerlink\" title=\"Ajax分析\"></a>Ajax分析</h2><p>用浏览器打开微博链接<a href=\"https://weibo.com/u/5902654742\">https://weibo.com/u/5902654742</a>，随后在页面中点击鼠标右键，从弹出的快捷菜单中选择“检查”选项，此时便会弹出开发者工具，如图所示：</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>Ajax</code>有其特殊的请求类型，它叫作<code>xhr</code>。在图中我们可以发现一个以<code>getIndex</code>开头的请求，其<code>Type</code>为<code>xhr</code>，这就是一个<code>Ajax</code>请求。用鼠标点击这个请求，可以查看这个请求的详细信息。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>在右侧可以观察到<code>Request Headers</code>、<code>URL</code>和<code>Response Headers</code>等信息。<code>Request Headers</code>中有一个信息为<code>X-Requested-With:XMLHttpRequest</code>，这就标记了此请求是<code>Ajax</code>请求，如图所示：</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<p><img src=\"Screenshot_4.webp\"></p>\n<p>点击<code>Preview</code>，即可看到响应的内容，它是<code>JSON</code>格式的。这里<code>Chrome</code>为我们自动做了解析，点击箭头即可展开和收起相应内容。</p>\n<p>可以观察到，返回结果是我的个人信息，包括昵称、简介、头像等，这也是用来渲染个人主页所使用的数据。<code>JavaScript</code>接收到这些数据之后，再执行相应的渲染方法，整个页面就渲染出来了。</p>\n<p><img src=\"Screenshot_5.webp\"></p>\n<p>切换到<code>Response</code>选项卡，从中观察到真实的返回数据，如图所示：</p>\n<p><img src=\"Screenshot_6.webp\"></p>\n<p>所以说，我们看到的微博页面的真实数据并不是最原始的页面返回的，而是在执行 JavaScript 后再次向后台发送 Ajax请求，浏览器拿到数据后进一步渲染出来的。</p>\n<h2 id=\"过滤请求\"><a href=\"#过滤请求\" class=\"headerlink\" title=\"过滤请求\"></a>过滤请求</h2><p>利用<code>Chrome</code>开发者工具的筛选功能筛选出所有的<code>Ajax</code>请求。在请求的上方有一层筛选栏，直接点击<code>XHR</code>，此时在下方显示的所有请求便都是<code>Ajax</code>请求了，如图所示：</p>\n<p><img src=\"Screenshot_7.webp\"></p>\n<p>接下来，不断滑动页面，可以看到页面底部有一条条新的微博被刷出，而开发者工具下方也不断地出现<code>Ajax</code>请求，这样我们就可以捕获到所有的<code>Ajax</code>请求了。 随意点开一个条目，都可以清楚地看到其<code>Request URL、Request Headers、Response Headers、Response Body</code>等内容，此时想要模拟请求和提取就非常简单了。</p>\n<p><img src=\"Screenshot_8.webp\"></p>\n"},{"title":"Beautiful Soup4库","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-05T08:15:33.000Z","pic":null,"_content":"\n\n\n`Beautiful Soup` 是一个可以从`HTML`或`XML`文件中提取数据的`Python`库。\n\n## 安装\n\n```python\npip install beautifulsoup4\n```\n\n`Beautiful Soup`支持`Python`标准库中的`HTML解析器`,还支持一些第三方的解析器,其中一个是 `lxml` .根据操作系统不同,可以选择下列方法来安装`lxml`:\n\n```python\npip install lxml\n```\n\n## 使用\n\n示例HTML；\n\n```html\nhtml_doc = \"\"\"\n<html><head><title>The Dormouse's story</title></head>\n<body>\n<p class=\"title\"><b>The Dormouse's story</b></p>\n\n<p class=\"story\">Once upon a time there were three little sisters; and their names were\n<a href=\"http://example.com/elsie\" class=\"sister\" id=\"link1\">Elsie</a>,\n<a href=\"http://example.com/lacie\" class=\"sister\" id=\"link2\">Lacie</a> and\n<a href=\"http://example.com/tillie\" class=\"sister\" id=\"link3\">Tillie</a>;\nand they lived at the bottom of a well.</p>\n\n<p class=\"story\">...</p>\n\"\"\"\n```\n\n使用`BeautifulSoup`解析这段代码,能够得到一个 `BeautifulSoup` 的对象,并能按照标准的缩进格式的结构输出:\n\noutput:\n\n```\n<html><head><title>The Dormouse's story</title></head>\n<body>\n<p class=\"title\"><b>The Dormouse's story</b></p>\n<p class=\"story\">Once upon a time there were three little sisters; and their names were\n<a class=\"sister\" href=\"http://example.com/elsie\" id=\"link1\">Elsie</a>,\n<a class=\"sister\" href=\"http://example.com/lacie\" id=\"link2\">Lacie</a> and\n<a class=\"sister\" href=\"http://example.com/tillie\" id=\"link3\">Tillie</a>;\nand they lived at the bottom of a well.</p>\n<p class=\"story\">...</p>\n</body></html>\n```\n\n几个简单的浏览结构化数据的方法:\n\n```python\nsoup.title\n# <title>The Dormouse's story</title>\n\nsoup.title.name\n# u'title'\n\nsoup.title.string\n# u'The Dormouse's story'\n\nsoup.title.parent.name\n# u'head'\n\nsoup.p\n# <p class=\"title\"><b>The Dormouse's story</b></p>\n\nsoup.p['class']\n# u'title'\n\nsoup.a\n# <a class=\"sister\" href=\"http://example.com/elsie\" id=\"link1\">Elsie</a>\n\nsoup.find_all('a')\n# [<a class=\"sister\" href=\"http://example.com/elsie\" id=\"link1\">Elsie</a>,\n#  <a class=\"sister\" href=\"http://example.com/lacie\" id=\"link2\">Lacie</a>,\n#  <a class=\"sister\" href=\"http://example.com/tillie\" id=\"link3\">Tillie</a>]\n\nsoup.find(id=\"link3\")\n# <a class=\"sister\" href=\"http://example.com/tillie\" id=\"link3\">Tillie</a>\n```\n\n从文档中找到所有<a>标签的链接:\n\n```python\nfor link in soup.find_all('a'):\n    print(link.get('href'))\n    # http://example.com/elsie\n    # http://example.com/lacie\n    # http://example.com/tillie\n```\n\n从文档中获取所有文字内容:\n\n```python\nprint(soup.get_text())\n# The Dormouse's story\n#\n# The Dormouse's story\n#\n# Once upon a time there were three little sisters; and their names were\n# Elsie,\n# Lacie and\n# Tillie;\n# and they lived at the bottom of a well.\n#\n# ...\n```\n\n## 对象的种类\n\n`Beautiful Soup`将复杂*HTML文档*转换成一个复杂的树形结构,每个节点都是*Python对象*,所有对象可以归纳为4种: `Tag` , `NavigableString` , `BeautifulSoup` , `Comment` .\n\n### Tag\n\n`Tag` 对象与`XML`或`HTML`原生文档中的`tag`相同:\n\n```python\nsoup = BeautifulSoup('<b class=\"boldest\">hello world</b>', features=\"lxml\")\ntag = soup.b\n\nprint(tag)\nprint(type(tag))\n\n# <b class=\"boldest\">hello world</b>\n# <class 'bs4.element.Tag'>\n```\n\n### Name\n\n每个`tag`都有自己的名字,通过 `.name` 来获取:\n\n```python\ntag.name\n# u'b'\n```\n\n如果改变了`tag`的`name`,那将影响所有通过当前`Beautiful Soup`对象生成的`HTML`文档:\n\n```python\ntag.name = \"blockquote\"\ntag\n# <blockquote class=\"boldest\">Extremely bold</blockquote>\n```\n\n### Attributes\n\n一个`tag`可能有很多个属性`. tag <b class=\"boldest\"> `有一个 `“class”` 的属性,值为 `“boldest” . tag`的属性的操作方法与字典相同:\n\n```python\ntag['class']\n# u'boldest'\n```\n\n也可以直接”点”取属性, 比如: `.attrs` :\n\n```python\ntag.attrs\n# {u'class': u'boldest'}\n```\n\n`tag`的属性可以被添加,删除或修改. 再说一次, `tag`的属性操作方法与字典一样\n\n```python\ntag['class'] = 'verybold'\ntag['id'] = 1\ntag\n# <blockquote class=\"verybold\" id=\"1\">Extremely bold</blockquote>\n\ndel tag['class']\ndel tag['id']\ntag\n# <blockquote>Extremely bold</blockquote>\n\ntag['class']\n# KeyError: 'class'\nprint(tag.get('class'))\n# None\n```\n\n### 多值属性\n\n还有一些属性 `rel` , `rev` , `accept-charset` , `headers` , `accesskey` `.` 在`Beautiful Soup``中多值属性的返回类型是list`:\n\n```python\ncss_soup = BeautifulSoup('<p class=\"body strikeout\"></p>')\ncss_soup.p['class']\n# [\"body\", \"strikeout\"]\n\ncss_soup = BeautifulSoup('<p class=\"body\"></p>')\ncss_soup.p['class']\n# [\"body\"]\n```\n\n如果某个属性看起来好像有多个值,但在任何版本的`HTML`定义中都没有被定义为多值属性,那么`Beautiful Soup`会将这个属性作为字符串返回。\n\n```python\nid_soup = BeautifulSoup('<p id=\"my id\"></p>')\nid_soup.p['id']\n# 'my id'\n```\n\n将`tag`转换成字符串时,多值属性会合并为一个值。\n\n```python\nrel_soup = BeautifulSoup('<p>Back to the <a rel=\"index\">homepage</a></p>')\nrel_soup.a['rel']\n# ['index']\nrel_soup.a['rel'] = ['index', 'contents']\nprint(rel_soup.p)\n# <p>Back to the <a rel=\"index contents\">homepage</a></p>\n```\n\n如果转换的文档是`XML`格式,那么`tag`中不包含多值属性\n\n```python\nxml_soup = BeautifulSoup('<p class=\"body strikeout\"></p>', 'xml')\nxml_soup.p['class']\n# u'body strikeout'\n```\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","source":"_posts/Beautiful-Soup库.md","raw":"---\ntitle: Beautiful Soup4库\ntags:\n  - bs4\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-05 16:15:33\ncategories: Python库\npic:\n---\n\n\n\n`Beautiful Soup` 是一个可以从`HTML`或`XML`文件中提取数据的`Python`库。\n\n## 安装\n\n```python\npip install beautifulsoup4\n```\n\n`Beautiful Soup`支持`Python`标准库中的`HTML解析器`,还支持一些第三方的解析器,其中一个是 `lxml` .根据操作系统不同,可以选择下列方法来安装`lxml`:\n\n```python\npip install lxml\n```\n\n## 使用\n\n示例HTML；\n\n```html\nhtml_doc = \"\"\"\n<html><head><title>The Dormouse's story</title></head>\n<body>\n<p class=\"title\"><b>The Dormouse's story</b></p>\n\n<p class=\"story\">Once upon a time there were three little sisters; and their names were\n<a href=\"http://example.com/elsie\" class=\"sister\" id=\"link1\">Elsie</a>,\n<a href=\"http://example.com/lacie\" class=\"sister\" id=\"link2\">Lacie</a> and\n<a href=\"http://example.com/tillie\" class=\"sister\" id=\"link3\">Tillie</a>;\nand they lived at the bottom of a well.</p>\n\n<p class=\"story\">...</p>\n\"\"\"\n```\n\n使用`BeautifulSoup`解析这段代码,能够得到一个 `BeautifulSoup` 的对象,并能按照标准的缩进格式的结构输出:\n\noutput:\n\n```\n<html><head><title>The Dormouse's story</title></head>\n<body>\n<p class=\"title\"><b>The Dormouse's story</b></p>\n<p class=\"story\">Once upon a time there were three little sisters; and their names were\n<a class=\"sister\" href=\"http://example.com/elsie\" id=\"link1\">Elsie</a>,\n<a class=\"sister\" href=\"http://example.com/lacie\" id=\"link2\">Lacie</a> and\n<a class=\"sister\" href=\"http://example.com/tillie\" id=\"link3\">Tillie</a>;\nand they lived at the bottom of a well.</p>\n<p class=\"story\">...</p>\n</body></html>\n```\n\n几个简单的浏览结构化数据的方法:\n\n```python\nsoup.title\n# <title>The Dormouse's story</title>\n\nsoup.title.name\n# u'title'\n\nsoup.title.string\n# u'The Dormouse's story'\n\nsoup.title.parent.name\n# u'head'\n\nsoup.p\n# <p class=\"title\"><b>The Dormouse's story</b></p>\n\nsoup.p['class']\n# u'title'\n\nsoup.a\n# <a class=\"sister\" href=\"http://example.com/elsie\" id=\"link1\">Elsie</a>\n\nsoup.find_all('a')\n# [<a class=\"sister\" href=\"http://example.com/elsie\" id=\"link1\">Elsie</a>,\n#  <a class=\"sister\" href=\"http://example.com/lacie\" id=\"link2\">Lacie</a>,\n#  <a class=\"sister\" href=\"http://example.com/tillie\" id=\"link3\">Tillie</a>]\n\nsoup.find(id=\"link3\")\n# <a class=\"sister\" href=\"http://example.com/tillie\" id=\"link3\">Tillie</a>\n```\n\n从文档中找到所有<a>标签的链接:\n\n```python\nfor link in soup.find_all('a'):\n    print(link.get('href'))\n    # http://example.com/elsie\n    # http://example.com/lacie\n    # http://example.com/tillie\n```\n\n从文档中获取所有文字内容:\n\n```python\nprint(soup.get_text())\n# The Dormouse's story\n#\n# The Dormouse's story\n#\n# Once upon a time there were three little sisters; and their names were\n# Elsie,\n# Lacie and\n# Tillie;\n# and they lived at the bottom of a well.\n#\n# ...\n```\n\n## 对象的种类\n\n`Beautiful Soup`将复杂*HTML文档*转换成一个复杂的树形结构,每个节点都是*Python对象*,所有对象可以归纳为4种: `Tag` , `NavigableString` , `BeautifulSoup` , `Comment` .\n\n### Tag\n\n`Tag` 对象与`XML`或`HTML`原生文档中的`tag`相同:\n\n```python\nsoup = BeautifulSoup('<b class=\"boldest\">hello world</b>', features=\"lxml\")\ntag = soup.b\n\nprint(tag)\nprint(type(tag))\n\n# <b class=\"boldest\">hello world</b>\n# <class 'bs4.element.Tag'>\n```\n\n### Name\n\n每个`tag`都有自己的名字,通过 `.name` 来获取:\n\n```python\ntag.name\n# u'b'\n```\n\n如果改变了`tag`的`name`,那将影响所有通过当前`Beautiful Soup`对象生成的`HTML`文档:\n\n```python\ntag.name = \"blockquote\"\ntag\n# <blockquote class=\"boldest\">Extremely bold</blockquote>\n```\n\n### Attributes\n\n一个`tag`可能有很多个属性`. tag <b class=\"boldest\"> `有一个 `“class”` 的属性,值为 `“boldest” . tag`的属性的操作方法与字典相同:\n\n```python\ntag['class']\n# u'boldest'\n```\n\n也可以直接”点”取属性, 比如: `.attrs` :\n\n```python\ntag.attrs\n# {u'class': u'boldest'}\n```\n\n`tag`的属性可以被添加,删除或修改. 再说一次, `tag`的属性操作方法与字典一样\n\n```python\ntag['class'] = 'verybold'\ntag['id'] = 1\ntag\n# <blockquote class=\"verybold\" id=\"1\">Extremely bold</blockquote>\n\ndel tag['class']\ndel tag['id']\ntag\n# <blockquote>Extremely bold</blockquote>\n\ntag['class']\n# KeyError: 'class'\nprint(tag.get('class'))\n# None\n```\n\n### 多值属性\n\n还有一些属性 `rel` , `rev` , `accept-charset` , `headers` , `accesskey` `.` 在`Beautiful Soup``中多值属性的返回类型是list`:\n\n```python\ncss_soup = BeautifulSoup('<p class=\"body strikeout\"></p>')\ncss_soup.p['class']\n# [\"body\", \"strikeout\"]\n\ncss_soup = BeautifulSoup('<p class=\"body\"></p>')\ncss_soup.p['class']\n# [\"body\"]\n```\n\n如果某个属性看起来好像有多个值,但在任何版本的`HTML`定义中都没有被定义为多值属性,那么`Beautiful Soup`会将这个属性作为字符串返回。\n\n```python\nid_soup = BeautifulSoup('<p id=\"my id\"></p>')\nid_soup.p['id']\n# 'my id'\n```\n\n将`tag`转换成字符串时,多值属性会合并为一个值。\n\n```python\nrel_soup = BeautifulSoup('<p>Back to the <a rel=\"index\">homepage</a></p>')\nrel_soup.a['rel']\n# ['index']\nrel_soup.a['rel'] = ['index', 'contents']\nprint(rel_soup.p)\n# <p>Back to the <a rel=\"index contents\">homepage</a></p>\n```\n\n如果转换的文档是`XML`格式,那么`tag`中不包含多值属性\n\n```python\nxml_soup = BeautifulSoup('<p class=\"body strikeout\"></p>', 'xml')\nxml_soup.p['class']\n# u'body strikeout'\n```\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","slug":"Beautiful-Soup库","published":1,"updated":"2021-06-17T11:47:57.184Z","layout":"post","photos":[],"link":"","_id":"ckq14rx1s000544ude5b5cn5h","content":"<p><code>Beautiful Soup</code> 是一个可以从<code>HTML</code>或<code>XML</code>文件中提取数据的<code>Python</code>库。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install beautifulsoup4</span><br></pre></td></tr></table></figure>\n\n<p><code>Beautiful Soup</code>支持<code>Python</code>标准库中的<code>HTML解析器</code>,还支持一些第三方的解析器,其中一个是 <code>lxml</code> .根据操作系统不同,可以选择下列方法来安装<code>lxml</code>:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install lxml</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>示例HTML；</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html_doc = &quot;&quot;&quot;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>The Dormouse&#x27;s story<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;title&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">b</span>&gt;</span>The Dormouse&#x27;s story<span class=\"tag\">&lt;/<span class=\"name\">b</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;story&quot;</span>&gt;</span>Once upon a time there were three little sisters; and their names were</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;http://example.com/elsie&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;sister&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;link1&quot;</span>&gt;</span>Elsie<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>,</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;http://example.com/lacie&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;sister&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;link2&quot;</span>&gt;</span>Lacie<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> and</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;http://example.com/tillie&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;sister&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;link3&quot;</span>&gt;</span>Tillie<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>;</span><br><span class=\"line\">and they lived at the bottom of a well.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;story&quot;</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>\n\n<p>使用<code>BeautifulSoup</code>解析这段代码,能够得到一个 <code>BeautifulSoup</code> 的对象,并能按照标准的缩进格式的结构输出:</p>\n<p>output:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#x27;s story&lt;/b&gt;&lt;/p&gt;</span><br><span class=\"line\">&lt;p class=&quot;story&quot;&gt;Once upon a time there were three little sisters; and their names were</span><br><span class=\"line\">&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,</span><br><span class=\"line\">&lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and</span><br><span class=\"line\">&lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;;</span><br><span class=\"line\">and they lived at the bottom of a well.&lt;/p&gt;</span><br><span class=\"line\">&lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;</span><br><span class=\"line\">&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p>几个简单的浏览结构化数据的方法:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">soup.title</span><br><span class=\"line\"><span class=\"comment\"># &lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.title.name</span><br><span class=\"line\"><span class=\"comment\"># u&#x27;title&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.title.string</span><br><span class=\"line\"><span class=\"comment\"># u&#x27;The Dormouse&#x27;s story&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.title.parent.name</span><br><span class=\"line\"><span class=\"comment\"># u&#x27;head&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.p</span><br><span class=\"line\"><span class=\"comment\"># &lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#x27;s story&lt;/b&gt;&lt;/p&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.p[<span class=\"string\">&#x27;class&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># u&#x27;title&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.a</span><br><span class=\"line\"><span class=\"comment\"># &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.find_all(<span class=\"string\">&#x27;a&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,</span></span><br><span class=\"line\"><span class=\"comment\">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;,</span></span><br><span class=\"line\"><span class=\"comment\">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;]</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.find(<span class=\"built_in\">id</span>=<span class=\"string\">&quot;link3&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\"># &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>从文档中找到所有<a>标签的链接:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> link <span class=\"keyword\">in</span> soup.find_all(<span class=\"string\">&#x27;a&#x27;</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(link.get(<span class=\"string\">&#x27;href&#x27;</span>))</span><br><span class=\"line\">    <span class=\"comment\"># http://example.com/elsie</span></span><br><span class=\"line\">    <span class=\"comment\"># http://example.com/lacie</span></span><br><span class=\"line\">    <span class=\"comment\"># http://example.com/tillie</span></span><br></pre></td></tr></table></figure>\n\n<p>从文档中获取所有文字内容:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(soup.get_text())</span><br><span class=\"line\"><span class=\"comment\"># The Dormouse&#x27;s story</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># The Dormouse&#x27;s story</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Once upon a time there were three little sisters; and their names were</span></span><br><span class=\"line\"><span class=\"comment\"># Elsie,</span></span><br><span class=\"line\"><span class=\"comment\"># Lacie and</span></span><br><span class=\"line\"><span class=\"comment\"># Tillie;</span></span><br><span class=\"line\"><span class=\"comment\"># and they lived at the bottom of a well.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># ...</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"对象的种类\"><a href=\"#对象的种类\" class=\"headerlink\" title=\"对象的种类\"></a>对象的种类</h2><p><code>Beautiful Soup</code>将复杂<em>HTML文档</em>转换成一个复杂的树形结构,每个节点都是<em>Python对象</em>,所有对象可以归纳为4种: <code>Tag</code> , <code>NavigableString</code> , <code>BeautifulSoup</code> , <code>Comment</code> .</p>\n<h3 id=\"Tag\"><a href=\"#Tag\" class=\"headerlink\" title=\"Tag\"></a>Tag</h3><p><code>Tag</code> 对象与<code>XML</code>或<code>HTML</code>原生文档中的<code>tag</code>相同:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">soup = BeautifulSoup(<span class=\"string\">&#x27;&lt;b class=&quot;boldest&quot;&gt;hello world&lt;/b&gt;&#x27;</span>, features=<span class=\"string\">&quot;lxml&quot;</span>)</span><br><span class=\"line\">tag = soup.b</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(tag)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(tag))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># &lt;b class=&quot;boldest&quot;&gt;hello world&lt;/b&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;class &#x27;bs4.element.Tag&#x27;&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Name\"><a href=\"#Name\" class=\"headerlink\" title=\"Name\"></a>Name</h3><p>每个<code>tag</code>都有自己的名字,通过 <code>.name</code> 来获取:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tag.name</span><br><span class=\"line\"><span class=\"comment\"># u&#x27;b&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果改变了<code>tag</code>的<code>name</code>,那将影响所有通过当前<code>Beautiful Soup</code>对象生成的<code>HTML</code>文档:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tag.name = <span class=\"string\">&quot;blockquote&quot;</span></span><br><span class=\"line\">tag</span><br><span class=\"line\"><span class=\"comment\"># &lt;blockquote class=&quot;boldest&quot;&gt;Extremely bold&lt;/blockquote&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Attributes\"><a href=\"#Attributes\" class=\"headerlink\" title=\"Attributes\"></a>Attributes</h3><p>一个<code>tag</code>可能有很多个属性<code>. tag &lt;b class=&quot;boldest&quot;&gt; </code>有一个 <code>“class”</code> 的属性,值为 <code>“boldest” . tag</code>的属性的操作方法与字典相同:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tag[<span class=\"string\">&#x27;class&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># u&#x27;boldest&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>也可以直接”点”取属性, 比如: <code>.attrs</code> :</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tag.attrs</span><br><span class=\"line\"><span class=\"comment\"># &#123;u&#x27;class&#x27;: u&#x27;boldest&#x27;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>tag</code>的属性可以被添加,删除或修改. 再说一次, <code>tag</code>的属性操作方法与字典一样</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tag[<span class=\"string\">&#x27;class&#x27;</span>] = <span class=\"string\">&#x27;verybold&#x27;</span></span><br><span class=\"line\">tag[<span class=\"string\">&#x27;id&#x27;</span>] = <span class=\"number\">1</span></span><br><span class=\"line\">tag</span><br><span class=\"line\"><span class=\"comment\"># &lt;blockquote class=&quot;verybold&quot; id=&quot;1&quot;&gt;Extremely bold&lt;/blockquote&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">del</span> tag[<span class=\"string\">&#x27;class&#x27;</span>]</span><br><span class=\"line\"><span class=\"keyword\">del</span> tag[<span class=\"string\">&#x27;id&#x27;</span>]</span><br><span class=\"line\">tag</span><br><span class=\"line\"><span class=\"comment\"># &lt;blockquote&gt;Extremely bold&lt;/blockquote&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">tag[<span class=\"string\">&#x27;class&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># KeyError: &#x27;class&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(tag.get(<span class=\"string\">&#x27;class&#x27;</span>))</span><br><span class=\"line\"><span class=\"comment\"># None</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"多值属性\"><a href=\"#多值属性\" class=\"headerlink\" title=\"多值属性\"></a>多值属性</h3><p>还有一些属性 <code>rel</code> , <code>rev</code> , <code>accept-charset</code> , <code>headers</code> , <code>accesskey</code> <code>.</code> 在<code>Beautiful Soup``中多值属性的返回类型是list</code>:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">css_soup = BeautifulSoup(<span class=\"string\">&#x27;&lt;p class=&quot;body strikeout&quot;&gt;&lt;/p&gt;&#x27;</span>)</span><br><span class=\"line\">css_soup.p[<span class=\"string\">&#x27;class&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># [&quot;body&quot;, &quot;strikeout&quot;]</span></span><br><span class=\"line\"></span><br><span class=\"line\">css_soup = BeautifulSoup(<span class=\"string\">&#x27;&lt;p class=&quot;body&quot;&gt;&lt;/p&gt;&#x27;</span>)</span><br><span class=\"line\">css_soup.p[<span class=\"string\">&#x27;class&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># [&quot;body&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<p>如果某个属性看起来好像有多个值,但在任何版本的<code>HTML</code>定义中都没有被定义为多值属性,那么<code>Beautiful Soup</code>会将这个属性作为字符串返回。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">id_soup = BeautifulSoup(<span class=\"string\">&#x27;&lt;p id=&quot;my id&quot;&gt;&lt;/p&gt;&#x27;</span>)</span><br><span class=\"line\">id_soup.p[<span class=\"string\">&#x27;id&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># &#x27;my id&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>将<code>tag</code>转换成字符串时,多值属性会合并为一个值。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rel_soup = BeautifulSoup(<span class=\"string\">&#x27;&lt;p&gt;Back to the &lt;a rel=&quot;index&quot;&gt;homepage&lt;/a&gt;&lt;/p&gt;&#x27;</span>)</span><br><span class=\"line\">rel_soup.a[<span class=\"string\">&#x27;rel&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;index&#x27;]</span></span><br><span class=\"line\">rel_soup.a[<span class=\"string\">&#x27;rel&#x27;</span>] = [<span class=\"string\">&#x27;index&#x27;</span>, <span class=\"string\">&#x27;contents&#x27;</span>]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(rel_soup.p)</span><br><span class=\"line\"><span class=\"comment\"># &lt;p&gt;Back to the &lt;a rel=&quot;index contents&quot;&gt;homepage&lt;/a&gt;&lt;/p&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果转换的文档是<code>XML</code>格式,那么<code>tag</code>中不包含多值属性</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xml_soup = BeautifulSoup(<span class=\"string\">&#x27;&lt;p class=&quot;body strikeout&quot;&gt;&lt;/p&gt;&#x27;</span>, <span class=\"string\">&#x27;xml&#x27;</span>)</span><br><span class=\"line\">xml_soup.p[<span class=\"string\">&#x27;class&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># u&#x27;body strikeout&#x27;</span></span><br></pre></td></tr></table></figure>\n\n\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","site":{"data":{}},"excerpt":"","more":"<p><code>Beautiful Soup</code> 是一个可以从<code>HTML</code>或<code>XML</code>文件中提取数据的<code>Python</code>库。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install beautifulsoup4</span><br></pre></td></tr></table></figure>\n\n<p><code>Beautiful Soup</code>支持<code>Python</code>标准库中的<code>HTML解析器</code>,还支持一些第三方的解析器,其中一个是 <code>lxml</code> .根据操作系统不同,可以选择下列方法来安装<code>lxml</code>:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install lxml</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>示例HTML；</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html_doc = &quot;&quot;&quot;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>The Dormouse&#x27;s story<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;title&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">b</span>&gt;</span>The Dormouse&#x27;s story<span class=\"tag\">&lt;/<span class=\"name\">b</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;story&quot;</span>&gt;</span>Once upon a time there were three little sisters; and their names were</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;http://example.com/elsie&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;sister&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;link1&quot;</span>&gt;</span>Elsie<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>,</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;http://example.com/lacie&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;sister&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;link2&quot;</span>&gt;</span>Lacie<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> and</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;http://example.com/tillie&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;sister&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;link3&quot;</span>&gt;</span>Tillie<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>;</span><br><span class=\"line\">and they lived at the bottom of a well.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;story&quot;</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>\n\n<p>使用<code>BeautifulSoup</code>解析这段代码,能够得到一个 <code>BeautifulSoup</code> 的对象,并能按照标准的缩进格式的结构输出:</p>\n<p>output:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#x27;s story&lt;/b&gt;&lt;/p&gt;</span><br><span class=\"line\">&lt;p class=&quot;story&quot;&gt;Once upon a time there were three little sisters; and their names were</span><br><span class=\"line\">&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,</span><br><span class=\"line\">&lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and</span><br><span class=\"line\">&lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;;</span><br><span class=\"line\">and they lived at the bottom of a well.&lt;/p&gt;</span><br><span class=\"line\">&lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;</span><br><span class=\"line\">&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p>几个简单的浏览结构化数据的方法:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">soup.title</span><br><span class=\"line\"><span class=\"comment\"># &lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.title.name</span><br><span class=\"line\"><span class=\"comment\"># u&#x27;title&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.title.string</span><br><span class=\"line\"><span class=\"comment\"># u&#x27;The Dormouse&#x27;s story&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.title.parent.name</span><br><span class=\"line\"><span class=\"comment\"># u&#x27;head&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.p</span><br><span class=\"line\"><span class=\"comment\"># &lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#x27;s story&lt;/b&gt;&lt;/p&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.p[<span class=\"string\">&#x27;class&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># u&#x27;title&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.a</span><br><span class=\"line\"><span class=\"comment\"># &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.find_all(<span class=\"string\">&#x27;a&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,</span></span><br><span class=\"line\"><span class=\"comment\">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;,</span></span><br><span class=\"line\"><span class=\"comment\">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;]</span></span><br><span class=\"line\"></span><br><span class=\"line\">soup.find(<span class=\"built_in\">id</span>=<span class=\"string\">&quot;link3&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\"># &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>从文档中找到所有<a>标签的链接:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> link <span class=\"keyword\">in</span> soup.find_all(<span class=\"string\">&#x27;a&#x27;</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(link.get(<span class=\"string\">&#x27;href&#x27;</span>))</span><br><span class=\"line\">    <span class=\"comment\"># http://example.com/elsie</span></span><br><span class=\"line\">    <span class=\"comment\"># http://example.com/lacie</span></span><br><span class=\"line\">    <span class=\"comment\"># http://example.com/tillie</span></span><br></pre></td></tr></table></figure>\n\n<p>从文档中获取所有文字内容:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(soup.get_text())</span><br><span class=\"line\"><span class=\"comment\"># The Dormouse&#x27;s story</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># The Dormouse&#x27;s story</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Once upon a time there were three little sisters; and their names were</span></span><br><span class=\"line\"><span class=\"comment\"># Elsie,</span></span><br><span class=\"line\"><span class=\"comment\"># Lacie and</span></span><br><span class=\"line\"><span class=\"comment\"># Tillie;</span></span><br><span class=\"line\"><span class=\"comment\"># and they lived at the bottom of a well.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># ...</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"对象的种类\"><a href=\"#对象的种类\" class=\"headerlink\" title=\"对象的种类\"></a>对象的种类</h2><p><code>Beautiful Soup</code>将复杂<em>HTML文档</em>转换成一个复杂的树形结构,每个节点都是<em>Python对象</em>,所有对象可以归纳为4种: <code>Tag</code> , <code>NavigableString</code> , <code>BeautifulSoup</code> , <code>Comment</code> .</p>\n<h3 id=\"Tag\"><a href=\"#Tag\" class=\"headerlink\" title=\"Tag\"></a>Tag</h3><p><code>Tag</code> 对象与<code>XML</code>或<code>HTML</code>原生文档中的<code>tag</code>相同:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">soup = BeautifulSoup(<span class=\"string\">&#x27;&lt;b class=&quot;boldest&quot;&gt;hello world&lt;/b&gt;&#x27;</span>, features=<span class=\"string\">&quot;lxml&quot;</span>)</span><br><span class=\"line\">tag = soup.b</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(tag)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(tag))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># &lt;b class=&quot;boldest&quot;&gt;hello world&lt;/b&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;class &#x27;bs4.element.Tag&#x27;&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Name\"><a href=\"#Name\" class=\"headerlink\" title=\"Name\"></a>Name</h3><p>每个<code>tag</code>都有自己的名字,通过 <code>.name</code> 来获取:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tag.name</span><br><span class=\"line\"><span class=\"comment\"># u&#x27;b&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果改变了<code>tag</code>的<code>name</code>,那将影响所有通过当前<code>Beautiful Soup</code>对象生成的<code>HTML</code>文档:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tag.name = <span class=\"string\">&quot;blockquote&quot;</span></span><br><span class=\"line\">tag</span><br><span class=\"line\"><span class=\"comment\"># &lt;blockquote class=&quot;boldest&quot;&gt;Extremely bold&lt;/blockquote&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Attributes\"><a href=\"#Attributes\" class=\"headerlink\" title=\"Attributes\"></a>Attributes</h3><p>一个<code>tag</code>可能有很多个属性<code>. tag &lt;b class=&quot;boldest&quot;&gt; </code>有一个 <code>“class”</code> 的属性,值为 <code>“boldest” . tag</code>的属性的操作方法与字典相同:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tag[<span class=\"string\">&#x27;class&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># u&#x27;boldest&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>也可以直接”点”取属性, 比如: <code>.attrs</code> :</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tag.attrs</span><br><span class=\"line\"><span class=\"comment\"># &#123;u&#x27;class&#x27;: u&#x27;boldest&#x27;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>tag</code>的属性可以被添加,删除或修改. 再说一次, <code>tag</code>的属性操作方法与字典一样</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tag[<span class=\"string\">&#x27;class&#x27;</span>] = <span class=\"string\">&#x27;verybold&#x27;</span></span><br><span class=\"line\">tag[<span class=\"string\">&#x27;id&#x27;</span>] = <span class=\"number\">1</span></span><br><span class=\"line\">tag</span><br><span class=\"line\"><span class=\"comment\"># &lt;blockquote class=&quot;verybold&quot; id=&quot;1&quot;&gt;Extremely bold&lt;/blockquote&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">del</span> tag[<span class=\"string\">&#x27;class&#x27;</span>]</span><br><span class=\"line\"><span class=\"keyword\">del</span> tag[<span class=\"string\">&#x27;id&#x27;</span>]</span><br><span class=\"line\">tag</span><br><span class=\"line\"><span class=\"comment\"># &lt;blockquote&gt;Extremely bold&lt;/blockquote&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">tag[<span class=\"string\">&#x27;class&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># KeyError: &#x27;class&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(tag.get(<span class=\"string\">&#x27;class&#x27;</span>))</span><br><span class=\"line\"><span class=\"comment\"># None</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"多值属性\"><a href=\"#多值属性\" class=\"headerlink\" title=\"多值属性\"></a>多值属性</h3><p>还有一些属性 <code>rel</code> , <code>rev</code> , <code>accept-charset</code> , <code>headers</code> , <code>accesskey</code> <code>.</code> 在<code>Beautiful Soup``中多值属性的返回类型是list</code>:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">css_soup = BeautifulSoup(<span class=\"string\">&#x27;&lt;p class=&quot;body strikeout&quot;&gt;&lt;/p&gt;&#x27;</span>)</span><br><span class=\"line\">css_soup.p[<span class=\"string\">&#x27;class&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># [&quot;body&quot;, &quot;strikeout&quot;]</span></span><br><span class=\"line\"></span><br><span class=\"line\">css_soup = BeautifulSoup(<span class=\"string\">&#x27;&lt;p class=&quot;body&quot;&gt;&lt;/p&gt;&#x27;</span>)</span><br><span class=\"line\">css_soup.p[<span class=\"string\">&#x27;class&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># [&quot;body&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<p>如果某个属性看起来好像有多个值,但在任何版本的<code>HTML</code>定义中都没有被定义为多值属性,那么<code>Beautiful Soup</code>会将这个属性作为字符串返回。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">id_soup = BeautifulSoup(<span class=\"string\">&#x27;&lt;p id=&quot;my id&quot;&gt;&lt;/p&gt;&#x27;</span>)</span><br><span class=\"line\">id_soup.p[<span class=\"string\">&#x27;id&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># &#x27;my id&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>将<code>tag</code>转换成字符串时,多值属性会合并为一个值。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rel_soup = BeautifulSoup(<span class=\"string\">&#x27;&lt;p&gt;Back to the &lt;a rel=&quot;index&quot;&gt;homepage&lt;/a&gt;&lt;/p&gt;&#x27;</span>)</span><br><span class=\"line\">rel_soup.a[<span class=\"string\">&#x27;rel&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;index&#x27;]</span></span><br><span class=\"line\">rel_soup.a[<span class=\"string\">&#x27;rel&#x27;</span>] = [<span class=\"string\">&#x27;index&#x27;</span>, <span class=\"string\">&#x27;contents&#x27;</span>]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(rel_soup.p)</span><br><span class=\"line\"><span class=\"comment\"># &lt;p&gt;Back to the &lt;a rel=&quot;index contents&quot;&gt;homepage&lt;/a&gt;&lt;/p&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果转换的文档是<code>XML</code>格式,那么<code>tag</code>中不包含多值属性</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xml_soup = BeautifulSoup(<span class=\"string\">&#x27;&lt;p class=&quot;body strikeout&quot;&gt;&lt;/p&gt;&#x27;</span>, <span class=\"string\">&#x27;xml&#x27;</span>)</span><br><span class=\"line\">xml_soup.p[<span class=\"string\">&#x27;class&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># u&#x27;body strikeout&#x27;</span></span><br></pre></td></tr></table></figure>\n\n\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n"},{"title":"Django入门-Django Admin","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-16T04:47:04.000Z","pic":"Screenshot_8.webp","_content":"\n## Django Admin 简介\n\n当我们开始第一个新项目的时候，`Django`已经配置了`Django Admin`，这个应用程序列出的`INSTALLED_APPS`。\n\n使用`Django Admin`的一个很好的列子就是在博客中，它可以用来被作者用来编写和发布文章。另一个列子是电子商务网站，工作人员可以创建，编辑，删除产品。\n\n现在，我们来配置`Django Admin`来维护我们应用程序的板块。\n\n首先，创建一个管理员账户：\n\n```python\n>>>python manage.py createsuperuser\n```\n\n按说明设置管理员账户名，邮箱和密码：\n\n```\nUsername (leave blank to use 'q'): Admin\nEmail address: espholychan@outlook.com\nPassword:\nPassword (again):\nThe password is too similar to the username.\nThis password is too short. It must contain at least 8 characters.\nThis password is too common.\nBypass password validation and create user anyway? [y/N]: y\nSuperuser created successfully.\n```\n\n在浏览器访问`http://127.0.0.1/admin`。\n\n![](1.PNG)\n\n输入刚才设置的用户名和密码到管理界面：\n\n![](2.PNG)\n\n它已经配置了一些功能。在这里，我们可以添加用户和组的权限管理，这些概念在后面将会探讨。\n\n添加`Board`模型，在`boards`目录中的`admin.py`文件中添加以下代码：\n\n**boards/admin.py**\n```python\nfrom django.contrib import admin\nfrom .models import Board\n# Register your models here.\n\nadmin.site.register(Board)\n```\n\n保存`admin.py`文件，然后刷新页面。\n\n![](3.PNG)\n\n可以新增板块。\n\n![](4.PNG)\n\n查看主页，新的板块已经添加。\n\n![](5.PNG)\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","source":"_posts/Django入门-Django-Admin.md","raw":"---\ntitle: Django入门-Django Admin\ntags:\n  - django\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-16 12:47:04\ncategories: Django\npic: Screenshot_8.webp\n---\n\n## Django Admin 简介\n\n当我们开始第一个新项目的时候，`Django`已经配置了`Django Admin`，这个应用程序列出的`INSTALLED_APPS`。\n\n使用`Django Admin`的一个很好的列子就是在博客中，它可以用来被作者用来编写和发布文章。另一个列子是电子商务网站，工作人员可以创建，编辑，删除产品。\n\n现在，我们来配置`Django Admin`来维护我们应用程序的板块。\n\n首先，创建一个管理员账户：\n\n```python\n>>>python manage.py createsuperuser\n```\n\n按说明设置管理员账户名，邮箱和密码：\n\n```\nUsername (leave blank to use 'q'): Admin\nEmail address: espholychan@outlook.com\nPassword:\nPassword (again):\nThe password is too similar to the username.\nThis password is too short. It must contain at least 8 characters.\nThis password is too common.\nBypass password validation and create user anyway? [y/N]: y\nSuperuser created successfully.\n```\n\n在浏览器访问`http://127.0.0.1/admin`。\n\n![](1.PNG)\n\n输入刚才设置的用户名和密码到管理界面：\n\n![](2.PNG)\n\n它已经配置了一些功能。在这里，我们可以添加用户和组的权限管理，这些概念在后面将会探讨。\n\n添加`Board`模型，在`boards`目录中的`admin.py`文件中添加以下代码：\n\n**boards/admin.py**\n```python\nfrom django.contrib import admin\nfrom .models import Board\n# Register your models here.\n\nadmin.site.register(Board)\n```\n\n保存`admin.py`文件，然后刷新页面。\n\n![](3.PNG)\n\n可以新增板块。\n\n![](4.PNG)\n\n查看主页，新的板块已经添加。\n\n![](5.PNG)\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","slug":"Django入门-Django-Admin","published":1,"updated":"2021-06-16T09:29:13.755Z","layout":"post","photos":[],"link":"","_id":"ckq14rx1s000644udhqh10rqa","content":"<h2 id=\"Django-Admin-简介\"><a href=\"#Django-Admin-简介\" class=\"headerlink\" title=\"Django Admin 简介\"></a>Django Admin 简介</h2><p>当我们开始第一个新项目的时候，<code>Django</code>已经配置了<code>Django Admin</code>，这个应用程序列出的<code>INSTALLED_APPS</code>。</p>\n<p>使用<code>Django Admin</code>的一个很好的列子就是在博客中，它可以用来被作者用来编写和发布文章。另一个列子是电子商务网站，工作人员可以创建，编辑，删除产品。</p>\n<p>现在，我们来配置<code>Django Admin</code>来维护我们应用程序的板块。</p>\n<p>首先，创建一个管理员账户：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt;python manage.py createsuperuser</span><br></pre></td></tr></table></figure>\n\n<p>按说明设置管理员账户名，邮箱和密码：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Username (leave blank to use &#x27;q&#x27;): Admin</span><br><span class=\"line\">Email address: espholychan@outlook.com</span><br><span class=\"line\">Password:</span><br><span class=\"line\">Password (again):</span><br><span class=\"line\">The password is too similar to the username.</span><br><span class=\"line\">This password is too short. It must contain at least 8 characters.</span><br><span class=\"line\">This password is too common.</span><br><span class=\"line\">Bypass password validation and create user anyway? [y/N]: y</span><br><span class=\"line\">Superuser created successfully.</span><br></pre></td></tr></table></figure>\n\n<p>在浏览器访问<code>http://127.0.0.1/admin</code>。</p>\n<p><img src=\"1.PNG\"></p>\n<p>输入刚才设置的用户名和密码到管理界面：</p>\n<p><img src=\"2.PNG\"></p>\n<p>它已经配置了一些功能。在这里，我们可以添加用户和组的权限管理，这些概念在后面将会探讨。</p>\n<p>添加<code>Board</code>模型，在<code>boards</code>目录中的<code>admin.py</code>文件中添加以下代码：</p>\n<p><strong>boards/admin.py</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.contrib <span class=\"keyword\">import</span> admin</span><br><span class=\"line\"><span class=\"keyword\">from</span> .models <span class=\"keyword\">import</span> Board</span><br><span class=\"line\"><span class=\"comment\"># Register your models here.</span></span><br><span class=\"line\"></span><br><span class=\"line\">admin.site.register(Board)</span><br></pre></td></tr></table></figure>\n\n<p>保存<code>admin.py</code>文件，然后刷新页面。</p>\n<p><img src=\"3.PNG\"></p>\n<p>可以新增板块。</p>\n<p><img src=\"4.PNG\"></p>\n<p>查看主页，新的板块已经添加。</p>\n<p><img src=\"5.PNG\"></p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Django-Admin-简介\"><a href=\"#Django-Admin-简介\" class=\"headerlink\" title=\"Django Admin 简介\"></a>Django Admin 简介</h2><p>当我们开始第一个新项目的时候，<code>Django</code>已经配置了<code>Django Admin</code>，这个应用程序列出的<code>INSTALLED_APPS</code>。</p>\n<p>使用<code>Django Admin</code>的一个很好的列子就是在博客中，它可以用来被作者用来编写和发布文章。另一个列子是电子商务网站，工作人员可以创建，编辑，删除产品。</p>\n<p>现在，我们来配置<code>Django Admin</code>来维护我们应用程序的板块。</p>\n<p>首先，创建一个管理员账户：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt;python manage.py createsuperuser</span><br></pre></td></tr></table></figure>\n\n<p>按说明设置管理员账户名，邮箱和密码：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Username (leave blank to use &#x27;q&#x27;): Admin</span><br><span class=\"line\">Email address: espholychan@outlook.com</span><br><span class=\"line\">Password:</span><br><span class=\"line\">Password (again):</span><br><span class=\"line\">The password is too similar to the username.</span><br><span class=\"line\">This password is too short. It must contain at least 8 characters.</span><br><span class=\"line\">This password is too common.</span><br><span class=\"line\">Bypass password validation and create user anyway? [y/N]: y</span><br><span class=\"line\">Superuser created successfully.</span><br></pre></td></tr></table></figure>\n\n<p>在浏览器访问<code>http://127.0.0.1/admin</code>。</p>\n<p><img src=\"1.PNG\"></p>\n<p>输入刚才设置的用户名和密码到管理界面：</p>\n<p><img src=\"2.PNG\"></p>\n<p>它已经配置了一些功能。在这里，我们可以添加用户和组的权限管理，这些概念在后面将会探讨。</p>\n<p>添加<code>Board</code>模型，在<code>boards</code>目录中的<code>admin.py</code>文件中添加以下代码：</p>\n<p><strong>boards/admin.py</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.contrib <span class=\"keyword\">import</span> admin</span><br><span class=\"line\"><span class=\"keyword\">from</span> .models <span class=\"keyword\">import</span> Board</span><br><span class=\"line\"><span class=\"comment\"># Register your models here.</span></span><br><span class=\"line\"></span><br><span class=\"line\">admin.site.register(Board)</span><br></pre></td></tr></table></figure>\n\n<p>保存<code>admin.py</code>文件，然后刷新页面。</p>\n<p><img src=\"3.PNG\"></p>\n<p>可以新增板块。</p>\n<p><img src=\"4.PNG\"></p>\n<p>查看主页，新的板块已经添加。</p>\n<p><img src=\"5.PNG\"></p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n"},{"title":"Django入门-URL分发","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-16T06:18:11.000Z","pic":"Screenshot_8.webp","_content":"\n## URLs\n\n我们要实现一个新的功能，就是列出某个板块下的所有主题列表。\n\n首先，我们要了解一个函数`re_path()`，`re_path(route, view, kwargs=None, name=None)`返回一个元素，以便包含在`urlpatterns`中。`route` 参数应该是一个字符串或 `gettext_lazy() `，它包含一个与 `Python` 的 `re` 模块兼容的正则表达式。字符串通常使用原始字符串语法（`r''`），因此它们可以包含像 `/d` 这样的序列，而不需要用另一个反斜杠来转义。当进行匹配时，从正则表达式中捕获的组会被传递到视图中 —— 如果组是命名的，则作为命名的参数，否则作为位置参数。值以字符串的形式传递，不进行任何类型转换。\n\n在这里先修改`boards/urls`开始修改：\n\n**boards/urls**\n```python\nfrom django.urls import path, re_path\nfrom . import views\n\nurlpatterns = [\n    path('', views.home, name='home'),\n    re_path(r'^boards/(?P<pk>\\d+)/$', views.board_topics, name='board_topics')\n]\n```\n\n`URL 调度器（dispatcher）`和 `URLconf （URL configuration）`是 `Django`应用中的基础部分。\n\n一个项目可以有很多 `urls.py` 分布在多个应用（app）中。`Django` 需要一个 `url.py`作为入口。这个特殊的 `urls.py` 叫做 *根路由配置（root URLconf）*。它被定义在 `settings.py` 中。\n\n```python\nROOT_URLCONF = 'myproject.urls'\n```\n\n它已经自动配置好了，你不需要去改变它任何东西。\n\n当 `Django` 接受一个*请求（request）*， 它就会在项目的 `URLconf` 中寻找匹配项。他从 `urlpatterns` 变量的第一条开始，然后在每个 `url` 中去匹配请求的 `URL`。\n\n如果 `Django` 找到了一个匹配路径，他会把请求（request）发送给 `re_path` 的第二个参数 `视图函数（view function）`。 `urlpatterns` 中的顺序很重要，因为 `Django` 一旦找到匹配就会停止往后搜索。如果 `Django` 在 `URLconf` 中没有找到匹配项，他会通过 `Page Not Found` 的错误处理代码抛出一个 404 异常。\n\n## 基础URLs路由\n\n基础URL创建起来很容易。就只是个匹配字符串的问题，比如说，我们想创建一个\"about\"页面，可以这样定义：\n\n```python\nurlpatterns = [\n    path('', views.home, name='home'),\n    re_path(r'^about/$', views.about, name='about')\n]\n```\n\n也可以创建更深层一点的URL结构：\n\n```python\nurlpatterns = [\n    path('', views.home, name='home'),\n    re_path(r'^about/$', views.about, name='about'),\n    re_path(r'^about/$', views.home, name='about')\n]\n```\n\n对于上面的例子，视图函数如下：\n\n```python\ndef about(request):\n    # do something\n    return render(request, 'about.html')\n\ndef about_company(request):\n    # do something\n    return render(request, 'about_company.html', {'company_name': 'Simple Complex'})\n```\n\n## 高级URLs路由\n\n更高级的URL路由使用方法是通过正则表达式来匹配某些类型的数据并创建动态URL。\n\n列如，要创建一个个人资料的页面，可以这样做：\n\n```python\nurlpatterns = [\n    path('', views.home, name='home'),\n    re_path(r'^(?P<username>[\\w.@+-]+)/$', views.user_profile, name='user_profile')\n]\n```\n\n它会匹配 `Django` 用户模型里面所有有效的用户名。\n\n现在我们可以看到上面的例子是一个很宽松的 `URL`。这意味大量的 `URL patterns` 都会被它匹配，因为它定义在 `URL的根`，而不像` /profile//`这样。在这种情况下，如果我们想定义一个`/about/` 的URL，我们要把它定义在这个 `username URL pattern` 的前面∶\n\n```python\nurlpatterns = [\n    path('', views.home, name='home'),\n    re_path(r'^about/$', views.about, name='about'),\n    re_path(r'^(?P<username>[\\w.@+-]+)/$', views.user_profile, name='user_profile')\n]\n```\n\n如果这个`\"about\" `页面定义在`usrename URL pattern` 后面，`Django` 将永远找不到它，因为`\"about\"`这个单词会先被`usrname`的正则表达式所匹配到，视图函数 `user_profile` 将会被执行而不是执行 `about` 。\n\n此外，这有一些副作用。例如，从现在开始，我们要把`\"about\"` 视为禁止使用的`username`，因为如果有用户将`\"about\"`作为他们的`username`，他们将永远不能看到他们的个人资料页面，而看到的`abou`t页面。\n\n开始的时候，我们使用` Board ID `去创建 `Topics列表`的动态页面。让我们再来看一下我在 `URLs` 开头的部分给出的例子∶\n\n```python\nre_path(r'^boards/(?P<pk>\\d+)/$', views.board_topics, name='board_topics')\n```\n\n正则表达式中的 `\\d+`，会匹配一个任意大小的整数值。这个整数值用来从数据库中取到 `指定的 Board`。现在注意我们这样写这个正则表达式 `（? P<pk>d+）`，这是告诉 `Django` 将捕获到的值放入名为 `pk` 的关键字参数中。这时我们为它写的一个视图函数∶\n\n```python\ndef board_topics(request, pk):\n  # dosomthing\n    return None\n```\n\n因为我们使用了 `（?P<pk>d+）`正则表达式，在 `board_topics` 函数中，关键字参数必须命名为 `pk`。\n\n如果你想在视图函数使用任意名字的参数，那么可以这样定义∶\n\n```python\nurl(r'^boards/(\\d+)/$',views.board_topics,name='board_topic s')\n```\n\n然后在视图函数可以这样定义∶\n\n```python\ndef board_topics(request,board_id):\n  # do something...\n```\n\n或者这样:\n\n```python\ndef board_topics(request,id):\n```\n\n名字不重要，但是使用命名参数是一个很好的办法，因为，当我们有个更大的URL去捕获多个ID和变量时，这会更加便于我们阅读。\n\n## 使用URLS API\n\n现在来写代码实现开头提到的主题列表页面。\n\n首先，编辑`boars/urls.py`添加新的URL路由。\n\n```python\nurlpatterns = [\n    path('', views.home, name='home'),\n    re_path(r'^boards/(?P<pk>\\d+)/$', views.board_topics, name='board_topics'),\n]\n```\n\n再创建视图函数`board_topics`：\n\n```python\ndef board_topics(request, pk):\n    board = Board.objects.get(pk=pk)\n    return render((request, 'topics.html', {'board': board}))\n```\n\n在`templates`目录中，创建一个名为`topics.html`的模板：\n\n```html\n{% load static %}\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>{{board.name}}</title>\n    <link rel=\"stylesheet\" href=\"{% static 'css/bootstrap.min.css' %}\">\n</head>\n<body>\n    <div class=\"container\">\n        <ol class=\"breadcrumb my-4\">\n            <li class=\"breadcrumb-item\">Boards</li>\n            <li class=\"breadcrumb-item active\">{{ boards.name }}</li>\n        </ol>\n\n    </div>\n\n</body>\n</html>\n```\n\n在浏览器中访问`http://127.0.0.1:8000/boards/1/`，显示下面结果：\n\n![](1.PNG)\n\n\n\n\n\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","source":"_posts/Django入门-URL分发.md","raw":"---\ntitle: Django入门-URL分发\ntags:\n  - django\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-16 14:18:11\ncategories: Django\npic: Screenshot_8.webp\n---\n\n## URLs\n\n我们要实现一个新的功能，就是列出某个板块下的所有主题列表。\n\n首先，我们要了解一个函数`re_path()`，`re_path(route, view, kwargs=None, name=None)`返回一个元素，以便包含在`urlpatterns`中。`route` 参数应该是一个字符串或 `gettext_lazy() `，它包含一个与 `Python` 的 `re` 模块兼容的正则表达式。字符串通常使用原始字符串语法（`r''`），因此它们可以包含像 `/d` 这样的序列，而不需要用另一个反斜杠来转义。当进行匹配时，从正则表达式中捕获的组会被传递到视图中 —— 如果组是命名的，则作为命名的参数，否则作为位置参数。值以字符串的形式传递，不进行任何类型转换。\n\n在这里先修改`boards/urls`开始修改：\n\n**boards/urls**\n```python\nfrom django.urls import path, re_path\nfrom . import views\n\nurlpatterns = [\n    path('', views.home, name='home'),\n    re_path(r'^boards/(?P<pk>\\d+)/$', views.board_topics, name='board_topics')\n]\n```\n\n`URL 调度器（dispatcher）`和 `URLconf （URL configuration）`是 `Django`应用中的基础部分。\n\n一个项目可以有很多 `urls.py` 分布在多个应用（app）中。`Django` 需要一个 `url.py`作为入口。这个特殊的 `urls.py` 叫做 *根路由配置（root URLconf）*。它被定义在 `settings.py` 中。\n\n```python\nROOT_URLCONF = 'myproject.urls'\n```\n\n它已经自动配置好了，你不需要去改变它任何东西。\n\n当 `Django` 接受一个*请求（request）*， 它就会在项目的 `URLconf` 中寻找匹配项。他从 `urlpatterns` 变量的第一条开始，然后在每个 `url` 中去匹配请求的 `URL`。\n\n如果 `Django` 找到了一个匹配路径，他会把请求（request）发送给 `re_path` 的第二个参数 `视图函数（view function）`。 `urlpatterns` 中的顺序很重要，因为 `Django` 一旦找到匹配就会停止往后搜索。如果 `Django` 在 `URLconf` 中没有找到匹配项，他会通过 `Page Not Found` 的错误处理代码抛出一个 404 异常。\n\n## 基础URLs路由\n\n基础URL创建起来很容易。就只是个匹配字符串的问题，比如说，我们想创建一个\"about\"页面，可以这样定义：\n\n```python\nurlpatterns = [\n    path('', views.home, name='home'),\n    re_path(r'^about/$', views.about, name='about')\n]\n```\n\n也可以创建更深层一点的URL结构：\n\n```python\nurlpatterns = [\n    path('', views.home, name='home'),\n    re_path(r'^about/$', views.about, name='about'),\n    re_path(r'^about/$', views.home, name='about')\n]\n```\n\n对于上面的例子，视图函数如下：\n\n```python\ndef about(request):\n    # do something\n    return render(request, 'about.html')\n\ndef about_company(request):\n    # do something\n    return render(request, 'about_company.html', {'company_name': 'Simple Complex'})\n```\n\n## 高级URLs路由\n\n更高级的URL路由使用方法是通过正则表达式来匹配某些类型的数据并创建动态URL。\n\n列如，要创建一个个人资料的页面，可以这样做：\n\n```python\nurlpatterns = [\n    path('', views.home, name='home'),\n    re_path(r'^(?P<username>[\\w.@+-]+)/$', views.user_profile, name='user_profile')\n]\n```\n\n它会匹配 `Django` 用户模型里面所有有效的用户名。\n\n现在我们可以看到上面的例子是一个很宽松的 `URL`。这意味大量的 `URL patterns` 都会被它匹配，因为它定义在 `URL的根`，而不像` /profile//`这样。在这种情况下，如果我们想定义一个`/about/` 的URL，我们要把它定义在这个 `username URL pattern` 的前面∶\n\n```python\nurlpatterns = [\n    path('', views.home, name='home'),\n    re_path(r'^about/$', views.about, name='about'),\n    re_path(r'^(?P<username>[\\w.@+-]+)/$', views.user_profile, name='user_profile')\n]\n```\n\n如果这个`\"about\" `页面定义在`usrename URL pattern` 后面，`Django` 将永远找不到它，因为`\"about\"`这个单词会先被`usrname`的正则表达式所匹配到，视图函数 `user_profile` 将会被执行而不是执行 `about` 。\n\n此外，这有一些副作用。例如，从现在开始，我们要把`\"about\"` 视为禁止使用的`username`，因为如果有用户将`\"about\"`作为他们的`username`，他们将永远不能看到他们的个人资料页面，而看到的`abou`t页面。\n\n开始的时候，我们使用` Board ID `去创建 `Topics列表`的动态页面。让我们再来看一下我在 `URLs` 开头的部分给出的例子∶\n\n```python\nre_path(r'^boards/(?P<pk>\\d+)/$', views.board_topics, name='board_topics')\n```\n\n正则表达式中的 `\\d+`，会匹配一个任意大小的整数值。这个整数值用来从数据库中取到 `指定的 Board`。现在注意我们这样写这个正则表达式 `（? P<pk>d+）`，这是告诉 `Django` 将捕获到的值放入名为 `pk` 的关键字参数中。这时我们为它写的一个视图函数∶\n\n```python\ndef board_topics(request, pk):\n  # dosomthing\n    return None\n```\n\n因为我们使用了 `（?P<pk>d+）`正则表达式，在 `board_topics` 函数中，关键字参数必须命名为 `pk`。\n\n如果你想在视图函数使用任意名字的参数，那么可以这样定义∶\n\n```python\nurl(r'^boards/(\\d+)/$',views.board_topics,name='board_topic s')\n```\n\n然后在视图函数可以这样定义∶\n\n```python\ndef board_topics(request,board_id):\n  # do something...\n```\n\n或者这样:\n\n```python\ndef board_topics(request,id):\n```\n\n名字不重要，但是使用命名参数是一个很好的办法，因为，当我们有个更大的URL去捕获多个ID和变量时，这会更加便于我们阅读。\n\n## 使用URLS API\n\n现在来写代码实现开头提到的主题列表页面。\n\n首先，编辑`boars/urls.py`添加新的URL路由。\n\n```python\nurlpatterns = [\n    path('', views.home, name='home'),\n    re_path(r'^boards/(?P<pk>\\d+)/$', views.board_topics, name='board_topics'),\n]\n```\n\n再创建视图函数`board_topics`：\n\n```python\ndef board_topics(request, pk):\n    board = Board.objects.get(pk=pk)\n    return render((request, 'topics.html', {'board': board}))\n```\n\n在`templates`目录中，创建一个名为`topics.html`的模板：\n\n```html\n{% load static %}\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>{{board.name}}</title>\n    <link rel=\"stylesheet\" href=\"{% static 'css/bootstrap.min.css' %}\">\n</head>\n<body>\n    <div class=\"container\">\n        <ol class=\"breadcrumb my-4\">\n            <li class=\"breadcrumb-item\">Boards</li>\n            <li class=\"breadcrumb-item active\">{{ boards.name }}</li>\n        </ol>\n\n    </div>\n\n</body>\n</html>\n```\n\n在浏览器中访问`http://127.0.0.1:8000/boards/1/`，显示下面结果：\n\n![](1.PNG)\n\n\n\n\n\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","slug":"Django入门-URL分发","published":1,"updated":"2021-06-16T09:29:20.551Z","layout":"post","photos":[],"link":"","_id":"ckq14rx1t000744ud5hc8bryn","content":"<h2 id=\"URLs\"><a href=\"#URLs\" class=\"headerlink\" title=\"URLs\"></a>URLs</h2><p>我们要实现一个新的功能，就是列出某个板块下的所有主题列表。</p>\n<p>首先，我们要了解一个函数<code>re_path()</code>，<code>re_path(route, view, kwargs=None, name=None)</code>返回一个元素，以便包含在<code>urlpatterns</code>中。<code>route</code> 参数应该是一个字符串或 <code>gettext_lazy() </code>，它包含一个与 <code>Python</code> 的 <code>re</code> 模块兼容的正则表达式。字符串通常使用原始字符串语法（<code>r&#39;&#39;</code>），因此它们可以包含像 <code>/d</code> 这样的序列，而不需要用另一个反斜杠来转义。当进行匹配时，从正则表达式中捕获的组会被传递到视图中 —— 如果组是命名的，则作为命名的参数，否则作为位置参数。值以字符串的形式传递，不进行任何类型转换。</p>\n<p>在这里先修改<code>boards/urls</code>开始修改：</p>\n<p><strong>boards/urls</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.urls <span class=\"keyword\">import</span> path, re_path</span><br><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> views</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, views.home, name=<span class=\"string\">&#x27;home&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^boards/(?P&lt;pk&gt;\\d+)/$&#x27;</span>, views.board_topics, name=<span class=\"string\">&#x27;board_topics&#x27;</span>)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p><code>URL 调度器（dispatcher）</code>和 <code>URLconf （URL configuration）</code>是 <code>Django</code>应用中的基础部分。</p>\n<p>一个项目可以有很多 <code>urls.py</code> 分布在多个应用（app）中。<code>Django</code> 需要一个 <code>url.py</code>作为入口。这个特殊的 <code>urls.py</code> 叫做 <em>根路由配置（root URLconf）</em>。它被定义在 <code>settings.py</code> 中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ROOT_URLCONF = <span class=\"string\">&#x27;myproject.urls&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>它已经自动配置好了，你不需要去改变它任何东西。</p>\n<p>当 <code>Django</code> 接受一个<em>请求（request）</em>， 它就会在项目的 <code>URLconf</code> 中寻找匹配项。他从 <code>urlpatterns</code> 变量的第一条开始，然后在每个 <code>url</code> 中去匹配请求的 <code>URL</code>。</p>\n<p>如果 <code>Django</code> 找到了一个匹配路径，他会把请求（request）发送给 <code>re_path</code> 的第二个参数 <code>视图函数（view function）</code>。 <code>urlpatterns</code> 中的顺序很重要，因为 <code>Django</code> 一旦找到匹配就会停止往后搜索。如果 <code>Django</code> 在 <code>URLconf</code> 中没有找到匹配项，他会通过 <code>Page Not Found</code> 的错误处理代码抛出一个 404 异常。</p>\n<h2 id=\"基础URLs路由\"><a href=\"#基础URLs路由\" class=\"headerlink\" title=\"基础URLs路由\"></a>基础URLs路由</h2><p>基础URL创建起来很容易。就只是个匹配字符串的问题，比如说，我们想创建一个”about”页面，可以这样定义：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, views.home, name=<span class=\"string\">&#x27;home&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^about/$&#x27;</span>, views.about, name=<span class=\"string\">&#x27;about&#x27;</span>)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>也可以创建更深层一点的URL结构：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, views.home, name=<span class=\"string\">&#x27;home&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^about/$&#x27;</span>, views.about, name=<span class=\"string\">&#x27;about&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^about/$&#x27;</span>, views.home, name=<span class=\"string\">&#x27;about&#x27;</span>)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>对于上面的例子，视图函数如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">about</span>(<span class=\"params\">request</span>):</span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> render(request, <span class=\"string\">&#x27;about.html&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">about_company</span>(<span class=\"params\">request</span>):</span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> render(request, <span class=\"string\">&#x27;about_company.html&#x27;</span>, &#123;<span class=\"string\">&#x27;company_name&#x27;</span>: <span class=\"string\">&#x27;Simple Complex&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"高级URLs路由\"><a href=\"#高级URLs路由\" class=\"headerlink\" title=\"高级URLs路由\"></a>高级URLs路由</h2><p>更高级的URL路由使用方法是通过正则表达式来匹配某些类型的数据并创建动态URL。</p>\n<p>列如，要创建一个个人资料的页面，可以这样做：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, views.home, name=<span class=\"string\">&#x27;home&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^(?P&lt;username&gt;[\\w.@+-]+)/$&#x27;</span>, views.user_profile, name=<span class=\"string\">&#x27;user_profile&#x27;</span>)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>它会匹配 <code>Django</code> 用户模型里面所有有效的用户名。</p>\n<p>现在我们可以看到上面的例子是一个很宽松的 <code>URL</code>。这意味大量的 <code>URL patterns</code> 都会被它匹配，因为它定义在 <code>URL的根</code>，而不像<code> /profile//</code>这样。在这种情况下，如果我们想定义一个<code>/about/</code> 的URL，我们要把它定义在这个 <code>username URL pattern</code> 的前面∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, views.home, name=<span class=\"string\">&#x27;home&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^about/$&#x27;</span>, views.about, name=<span class=\"string\">&#x27;about&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^(?P&lt;username&gt;[\\w.@+-]+)/$&#x27;</span>, views.user_profile, name=<span class=\"string\">&#x27;user_profile&#x27;</span>)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>如果这个<code>&quot;about&quot; </code>页面定义在<code>usrename URL pattern</code> 后面，<code>Django</code> 将永远找不到它，因为<code>&quot;about&quot;</code>这个单词会先被<code>usrname</code>的正则表达式所匹配到，视图函数 <code>user_profile</code> 将会被执行而不是执行 <code>about</code> 。</p>\n<p>此外，这有一些副作用。例如，从现在开始，我们要把<code>&quot;about&quot;</code> 视为禁止使用的<code>username</code>，因为如果有用户将<code>&quot;about&quot;</code>作为他们的<code>username</code>，他们将永远不能看到他们的个人资料页面，而看到的<code>abou</code>t页面。</p>\n<p>开始的时候，我们使用<code>Board ID</code>去创建 <code>Topics列表</code>的动态页面。让我们再来看一下我在 <code>URLs</code> 开头的部分给出的例子∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">re_path(<span class=\"string\">r&#x27;^boards/(?P&lt;pk&gt;\\d+)/$&#x27;</span>, views.board_topics, name=<span class=\"string\">&#x27;board_topics&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>正则表达式中的 <code>\\d+</code>，会匹配一个任意大小的整数值。这个整数值用来从数据库中取到 <code>指定的 Board</code>。现在注意我们这样写这个正则表达式 <code>（? P&lt;pk&gt;d+）</code>，这是告诉 <code>Django</code> 将捕获到的值放入名为 <code>pk</code> 的关键字参数中。这时我们为它写的一个视图函数∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">board_topics</span>(<span class=\"params\">request, pk</span>):</span></span><br><span class=\"line\">  <span class=\"comment\"># dosomthing</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">None</span></span><br></pre></td></tr></table></figure>\n\n<p>因为我们使用了 <code>（?P&lt;pk&gt;d+）</code>正则表达式，在 <code>board_topics</code> 函数中，关键字参数必须命名为 <code>pk</code>。</p>\n<p>如果你想在视图函数使用任意名字的参数，那么可以这样定义∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url(<span class=\"string\">r&#x27;^boards/(\\d+)/$&#x27;</span>,views.board_topics,name=<span class=\"string\">&#x27;board_topic s&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>然后在视图函数可以这样定义∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">board_topics</span>(<span class=\"params\">request,board_id</span>):</span></span><br><span class=\"line\">  <span class=\"comment\"># do something...</span></span><br></pre></td></tr></table></figure>\n\n<p>或者这样:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">board_topics</span>(<span class=\"params\">request,<span class=\"built_in\">id</span></span>):</span></span><br></pre></td></tr></table></figure>\n\n<p>名字不重要，但是使用命名参数是一个很好的办法，因为，当我们有个更大的URL去捕获多个ID和变量时，这会更加便于我们阅读。</p>\n<h2 id=\"使用URLS-API\"><a href=\"#使用URLS-API\" class=\"headerlink\" title=\"使用URLS API\"></a>使用URLS API</h2><p>现在来写代码实现开头提到的主题列表页面。</p>\n<p>首先，编辑<code>boars/urls.py</code>添加新的URL路由。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, views.home, name=<span class=\"string\">&#x27;home&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^boards/(?P&lt;pk&gt;\\d+)/$&#x27;</span>, views.board_topics, name=<span class=\"string\">&#x27;board_topics&#x27;</span>),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>再创建视图函数<code>board_topics</code>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">board_topics</span>(<span class=\"params\">request, pk</span>):</span></span><br><span class=\"line\">    board = Board.objects.get(pk=pk)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> render((request, <span class=\"string\">&#x27;topics.html&#x27;</span>, &#123;<span class=\"string\">&#x27;board&#x27;</span>: board&#125;))</span><br></pre></td></tr></table></figure>\n\n<p>在<code>templates</code>目录中，创建一个名为<code>topics.html</code>的模板：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% load static %&#125;</span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>&#123;&#123;board.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;% static &#x27;css/bootstrap.min.css&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">ol</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;breadcrumb my-4&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;breadcrumb-item&quot;</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;breadcrumb-item active&quot;</span>&gt;</span>&#123;&#123; boards.name &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">ol</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>在浏览器中访问<code>http://127.0.0.1:8000/boards/1/</code>，显示下面结果：</p>\n<p><img src=\"1.PNG\"></p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"URLs\"><a href=\"#URLs\" class=\"headerlink\" title=\"URLs\"></a>URLs</h2><p>我们要实现一个新的功能，就是列出某个板块下的所有主题列表。</p>\n<p>首先，我们要了解一个函数<code>re_path()</code>，<code>re_path(route, view, kwargs=None, name=None)</code>返回一个元素，以便包含在<code>urlpatterns</code>中。<code>route</code> 参数应该是一个字符串或 <code>gettext_lazy() </code>，它包含一个与 <code>Python</code> 的 <code>re</code> 模块兼容的正则表达式。字符串通常使用原始字符串语法（<code>r&#39;&#39;</code>），因此它们可以包含像 <code>/d</code> 这样的序列，而不需要用另一个反斜杠来转义。当进行匹配时，从正则表达式中捕获的组会被传递到视图中 —— 如果组是命名的，则作为命名的参数，否则作为位置参数。值以字符串的形式传递，不进行任何类型转换。</p>\n<p>在这里先修改<code>boards/urls</code>开始修改：</p>\n<p><strong>boards/urls</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.urls <span class=\"keyword\">import</span> path, re_path</span><br><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> views</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, views.home, name=<span class=\"string\">&#x27;home&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^boards/(?P&lt;pk&gt;\\d+)/$&#x27;</span>, views.board_topics, name=<span class=\"string\">&#x27;board_topics&#x27;</span>)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p><code>URL 调度器（dispatcher）</code>和 <code>URLconf （URL configuration）</code>是 <code>Django</code>应用中的基础部分。</p>\n<p>一个项目可以有很多 <code>urls.py</code> 分布在多个应用（app）中。<code>Django</code> 需要一个 <code>url.py</code>作为入口。这个特殊的 <code>urls.py</code> 叫做 <em>根路由配置（root URLconf）</em>。它被定义在 <code>settings.py</code> 中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ROOT_URLCONF = <span class=\"string\">&#x27;myproject.urls&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>它已经自动配置好了，你不需要去改变它任何东西。</p>\n<p>当 <code>Django</code> 接受一个<em>请求（request）</em>， 它就会在项目的 <code>URLconf</code> 中寻找匹配项。他从 <code>urlpatterns</code> 变量的第一条开始，然后在每个 <code>url</code> 中去匹配请求的 <code>URL</code>。</p>\n<p>如果 <code>Django</code> 找到了一个匹配路径，他会把请求（request）发送给 <code>re_path</code> 的第二个参数 <code>视图函数（view function）</code>。 <code>urlpatterns</code> 中的顺序很重要，因为 <code>Django</code> 一旦找到匹配就会停止往后搜索。如果 <code>Django</code> 在 <code>URLconf</code> 中没有找到匹配项，他会通过 <code>Page Not Found</code> 的错误处理代码抛出一个 404 异常。</p>\n<h2 id=\"基础URLs路由\"><a href=\"#基础URLs路由\" class=\"headerlink\" title=\"基础URLs路由\"></a>基础URLs路由</h2><p>基础URL创建起来很容易。就只是个匹配字符串的问题，比如说，我们想创建一个”about”页面，可以这样定义：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, views.home, name=<span class=\"string\">&#x27;home&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^about/$&#x27;</span>, views.about, name=<span class=\"string\">&#x27;about&#x27;</span>)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>也可以创建更深层一点的URL结构：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, views.home, name=<span class=\"string\">&#x27;home&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^about/$&#x27;</span>, views.about, name=<span class=\"string\">&#x27;about&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^about/$&#x27;</span>, views.home, name=<span class=\"string\">&#x27;about&#x27;</span>)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>对于上面的例子，视图函数如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">about</span>(<span class=\"params\">request</span>):</span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> render(request, <span class=\"string\">&#x27;about.html&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">about_company</span>(<span class=\"params\">request</span>):</span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> render(request, <span class=\"string\">&#x27;about_company.html&#x27;</span>, &#123;<span class=\"string\">&#x27;company_name&#x27;</span>: <span class=\"string\">&#x27;Simple Complex&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"高级URLs路由\"><a href=\"#高级URLs路由\" class=\"headerlink\" title=\"高级URLs路由\"></a>高级URLs路由</h2><p>更高级的URL路由使用方法是通过正则表达式来匹配某些类型的数据并创建动态URL。</p>\n<p>列如，要创建一个个人资料的页面，可以这样做：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, views.home, name=<span class=\"string\">&#x27;home&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^(?P&lt;username&gt;[\\w.@+-]+)/$&#x27;</span>, views.user_profile, name=<span class=\"string\">&#x27;user_profile&#x27;</span>)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>它会匹配 <code>Django</code> 用户模型里面所有有效的用户名。</p>\n<p>现在我们可以看到上面的例子是一个很宽松的 <code>URL</code>。这意味大量的 <code>URL patterns</code> 都会被它匹配，因为它定义在 <code>URL的根</code>，而不像<code> /profile//</code>这样。在这种情况下，如果我们想定义一个<code>/about/</code> 的URL，我们要把它定义在这个 <code>username URL pattern</code> 的前面∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, views.home, name=<span class=\"string\">&#x27;home&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^about/$&#x27;</span>, views.about, name=<span class=\"string\">&#x27;about&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^(?P&lt;username&gt;[\\w.@+-]+)/$&#x27;</span>, views.user_profile, name=<span class=\"string\">&#x27;user_profile&#x27;</span>)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>如果这个<code>&quot;about&quot; </code>页面定义在<code>usrename URL pattern</code> 后面，<code>Django</code> 将永远找不到它，因为<code>&quot;about&quot;</code>这个单词会先被<code>usrname</code>的正则表达式所匹配到，视图函数 <code>user_profile</code> 将会被执行而不是执行 <code>about</code> 。</p>\n<p>此外，这有一些副作用。例如，从现在开始，我们要把<code>&quot;about&quot;</code> 视为禁止使用的<code>username</code>，因为如果有用户将<code>&quot;about&quot;</code>作为他们的<code>username</code>，他们将永远不能看到他们的个人资料页面，而看到的<code>abou</code>t页面。</p>\n<p>开始的时候，我们使用<code>Board ID</code>去创建 <code>Topics列表</code>的动态页面。让我们再来看一下我在 <code>URLs</code> 开头的部分给出的例子∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">re_path(<span class=\"string\">r&#x27;^boards/(?P&lt;pk&gt;\\d+)/$&#x27;</span>, views.board_topics, name=<span class=\"string\">&#x27;board_topics&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>正则表达式中的 <code>\\d+</code>，会匹配一个任意大小的整数值。这个整数值用来从数据库中取到 <code>指定的 Board</code>。现在注意我们这样写这个正则表达式 <code>（? P&lt;pk&gt;d+）</code>，这是告诉 <code>Django</code> 将捕获到的值放入名为 <code>pk</code> 的关键字参数中。这时我们为它写的一个视图函数∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">board_topics</span>(<span class=\"params\">request, pk</span>):</span></span><br><span class=\"line\">  <span class=\"comment\"># dosomthing</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">None</span></span><br></pre></td></tr></table></figure>\n\n<p>因为我们使用了 <code>（?P&lt;pk&gt;d+）</code>正则表达式，在 <code>board_topics</code> 函数中，关键字参数必须命名为 <code>pk</code>。</p>\n<p>如果你想在视图函数使用任意名字的参数，那么可以这样定义∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url(<span class=\"string\">r&#x27;^boards/(\\d+)/$&#x27;</span>,views.board_topics,name=<span class=\"string\">&#x27;board_topic s&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>然后在视图函数可以这样定义∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">board_topics</span>(<span class=\"params\">request,board_id</span>):</span></span><br><span class=\"line\">  <span class=\"comment\"># do something...</span></span><br></pre></td></tr></table></figure>\n\n<p>或者这样:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">board_topics</span>(<span class=\"params\">request,<span class=\"built_in\">id</span></span>):</span></span><br></pre></td></tr></table></figure>\n\n<p>名字不重要，但是使用命名参数是一个很好的办法，因为，当我们有个更大的URL去捕获多个ID和变量时，这会更加便于我们阅读。</p>\n<h2 id=\"使用URLS-API\"><a href=\"#使用URLS-API\" class=\"headerlink\" title=\"使用URLS API\"></a>使用URLS API</h2><p>现在来写代码实现开头提到的主题列表页面。</p>\n<p>首先，编辑<code>boars/urls.py</code>添加新的URL路由。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, views.home, name=<span class=\"string\">&#x27;home&#x27;</span>),</span><br><span class=\"line\">    re_path(<span class=\"string\">r&#x27;^boards/(?P&lt;pk&gt;\\d+)/$&#x27;</span>, views.board_topics, name=<span class=\"string\">&#x27;board_topics&#x27;</span>),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>再创建视图函数<code>board_topics</code>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">board_topics</span>(<span class=\"params\">request, pk</span>):</span></span><br><span class=\"line\">    board = Board.objects.get(pk=pk)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> render((request, <span class=\"string\">&#x27;topics.html&#x27;</span>, &#123;<span class=\"string\">&#x27;board&#x27;</span>: board&#125;))</span><br></pre></td></tr></table></figure>\n\n<p>在<code>templates</code>目录中，创建一个名为<code>topics.html</code>的模板：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% load static %&#125;</span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>&#123;&#123;board.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;% static &#x27;css/bootstrap.min.css&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">ol</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;breadcrumb my-4&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;breadcrumb-item&quot;</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;breadcrumb-item active&quot;</span>&gt;</span>&#123;&#123; boards.name &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">ol</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>在浏览器中访问<code>http://127.0.0.1:8000/boards/1/</code>，显示下面结果：</p>\n<p><img src=\"1.PNG\"></p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n"},{"title":"Django入门-模型设计","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-09T13:29:50.000Z","pic":"Screenshot_8.webp","_content":"\n## 模型\n\n这些模型基本上代表了应用程序的数据库设计。在本节中要做的是创建 `Django` 所表示的类，这些类就是在上一节中建模的类∶ `Board`，`Topic`和 `Post`。`User` 模型被命名为内置应用叫 `auth`，它以命名空间 `django.contrib.auth` 的形式出现在 `INSTALLED_APPS`配置中。\n\n我们要做的工作都在 `boards/models.py 文`件中。以下是我们在`Django应用程序`中如何表示类图的代码∶\n\n```python\nfrom django.db import models\nfrom django.contrib.auth.models import User\n\n# Create your models here.\n\nclass Board(models.Model):\n    name = models.CharField(max_length=30, unique=True)\n    description = models.CharField(max_length=100)\n\nclass Topic(models.Model):\n    subject = models.CharField(max_length=255)\n    last_updated = models.DateTimeField(auto_now_add=True)\n    board = models.ForeignKey(Board, related_name='topics', on_delete=models.CASCADE)\n    starter = models.ForeignKey(User, related_name='topics', on_delete=models.CASCADE)\n\nclass Post(models.Model):\n    message = models.TextField(max_length=4000)\n    topic = models.ForeignKey(Topic, related_name='posts', on_delete=models.CASCADE)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now_add=True)\n    create_by = models.ForeignKey(User, related_name='posts', on_delete=models.CASCADE)\n    updated_by = models.ForeignKey(User, null=True, related_name='+', on_delete=models.CASCADE)\n```\n\n所有模型都是`django.db.models.Model`类的子类。每个类将被转换为**数据库表**。每个字段由 `django.db.models.Field`子类（内置在`Django core`）的实例表示，它们并将被转换为数据库的列。\n\n`字段 CharField`，`DateTimeField`等等，都是 `django.db.models.Field` 的子类，包含在`Django`的核心里面-随时可以使用。\n\n在这里，我们仅使用 `CharField``，TextField` ，`DateTimeField`，和`ForeignKey`字段来定义我们的模型。不过在`Django`提供了更广泛的选择来代表不同类型的数据，例如 `IntegerField`，`BooleanField`， `DecimalField`和其它一些字段。\n\n我们会在需要的时候提及它们。\n\n有些字段需要参数，例如`CharField`。我们应该始终设定一个`max_length` 。这些信息将用于创建数据库列。`Django`需要知道数据库列需要多大。该 `max_length` 参数也将被`Django Forms API`用来验证用户输入。\n\n在 `Board` 模型定义中，更具体地说，在 `name` 字段中，我们设置了参数 `unique=True` ，顾名思义，它将强制数据库级别字段的唯一性。\n\n在 `Post` 模型中， `created_at` 字段有一个可选参数， `auto_now_add` 设置为 `True` 。这将告诉Django创建 `Post` 对象时为当前日期和时间。\n\n模型之间的关系使用 `Foreignkey` 字段。它将在模型之间创建一个连接，并在数据库级别创建适当的关系 （注∶ 外键关联）。该 `Foreignkey` 字段需要一个位置参数 `related_name` ，用于引用它关联的模型。（注∶ 例如 `created_by` 是外键字段，关联的`User`模型，表明这个帖子是谁创建的， `related name=posts` 表示在 `User` 那边可以使用 `user.posts` 来查看这个用户创建了哪些帖子）\n\n例如，在 `Topic` 模型中， `board` 字段是 `Board` 模型的 `ForeignKey` 。它告诉`Django`，一个 `Topic` 实例只涉及一个`Board`实例。 `related_name` 参数将用于创建反向关系， `Board` 实例通过属性 `topics` 访问属于这个版块下的 `Topic` 列表。\n\n`Django`自动创建这种反向关系， `related_name` 是可选项。但是，如果我们不为它设置一个名称，`Django`会自动生成它∶`（class_name）_set` 。例如，在 `Board` 模型中，所有 `Topic` 列表将用 `topic_set` 属性表示。而这里我们将其重新命名为了 `topics` ，以使其感觉更自然。\n\n在 `Post` 模型中，该 `updated_by` 字段设置 `related_name='+'`。这指示 `Django`我们不需要这种反向关系，所以它会被忽略（注∶也就是说我们不需要关系用户修改过哪些帖子）。\n\n下面您可以看到类图和Django模型的源代码之间的比较，绿线表示我们如何处理反向关系。\n\n![](Screenshot_1.webp)\n\n## 迁移模型\n\n下一步是告诉`Django`创建数据库，以便我们可以开始使用它。打开终端，激活虚拟环境，转到` manage.py`文件所在的文件夹，然后运行以下命令∶\n\n```python\npython manage. py makemigrations\n```\n\n你会看到输出的内容是∶\n\n```python\nMigrations for 'boards':\n  boards\\migrations\\0001_initial.py\n    - Create model Board\n    - Create model Topic\n    - Create model Post\n```\n\n此时， `Django` 在 `boards/migrations` 目录创建了一个名为 `0001_initial.py` 的文件。它代表了应用程序模型的当前状态。在下一步，`Django`将使用该文件创建表和列。\n\n迁移文件将被翻译成SQL语句。如果您熟悉SQL，则可以运行以下命令来检验将是要被数据库执行的SQL指令\n\n```python\npython manage.py sqlmigrate boards 0001\n```\n\n如果你不熟悉SQL，也不要担心。所有的工作都将使用`Django ORM`来完成，它是一个与数据库进行通信的抽象层。下一步是将我们生成的迁移文件应用到数据库∶\n\n```python\npython manage.py migrate\n```\n\n输出结果如下：\n\n```python\nOperations to perform:\n  Apply all migrations: admin, auth, boards, contenttypes, sessions\nRunning migrations:\n  Applying contenttypes.0001_initial... OK\n  Applying auth.0001_initial... OK\n  Applying admin.0001_initial... OK\n  Applying admin.0002_logentry_remove_auto_add... OK\n  Applying admin.0003_logentry_add_action_flag_choices... OK\n  Applying contenttypes.0002_remove_content_type_name... OK\n  Applying auth.0002_alter_permission_name_max_length... OK\n  Applying auth.0003_alter_user_email_max_length... OK\n  Applying auth.0004_alter_user_username_opts... OK\n  Applying auth.0005_alter_user_last_login_null... OK\n  Applying auth.0006_require_contenttypes_0002... OK\n  Applying auth.0007_alter_validators_add_error_messages... OK\n  Applying auth.0008_alter_user_username_max_length... OK\n  Applying auth.0009_alter_user_last_name_max_length... OK\n  Applying auth.0010_alter_group_name_max_length... OK\n  Applying auth.0011_update_proxy_permissions... OK\n  Applying auth.0012_alter_user_first_name_max_length... OK\n  Applying boards.0001_initial... OK\n  Applying sessions.0001_initial... OK\n```\n\n好了数据库就迁移成功了。\n\n## 试验 Models API\n\n使用Python进行开发的一个重要优点是`交互式shell`。我一直在使用它。这是一种快速尝试和试验API的方法。\n\n可以使用`manage.py`工具加载我们的项目来启动 `Python shell` ∶\n\n```python\npython manage. py shell\n```\n\n这与直接输入 `python` 指令来调用交互式控制台是非常相似的，除此之外，项目将被添加到 `sys.path` 并加载Django。这意味着我们可以在项目中导入我们的模型和其他资源并使用它。\n\n让我们从导入`Board类`开始∶\n\n```python\nfrom boards.models import Board\n```\n\n\n要创建新的 `board` 对象，我们可以执行以下操作∶\n\n```python\nboard = Board(name='Django',description='This is a board abo ut Django.')\n```\n\n为了将这个对象保存在数据库中，我们必须调用`save`方法∶\n\n```python\nboard.save()\n```\n\n`save` 方法用于创建和更新对象。这里Django创建了一个新对象，因为这时 `Board` 实例没有`id`。第一次保存后，Django会自动设置`ID`∶\n\n```python\n>>> board.id\n1\n```\n\n您可以将其余的字段当做Python属性访问∶\n\n```python\n>>> board.name\n'Django'\n>>> board.description\n'This is a board about django'\n```\n\n要更新一个值，我们可以这样做∶\n\n```python\nboard.description ='Django discussion board'\nboard.save()\n>>> board.description \n'this is new description'\n```\n每个Django模型都带有一个特殊的属性；我们称之为`模型管理器（Model Manager）`。你可以通过属性 `objects` 来访问这个管理器，它主要用于数据库操作。例如，我们可以使用它来直接创建一个新的`Board`对象∶\n\n```python\n>>> board = Board.objects.create(name='Python', description='id 2 for django model')\n>>> board.save()\n>>> board.id\n2\n```\n\n所以，现在我们有两个版块了。我们可以使用 `objects` 列出数据库中所有现有的版块\n\n```python\n>>> Board.objects.all()\n<QuerySet [<Board: Board object (1)>, <Board: Board object (2)>]>\n```\n\n结果是一个`QuerySet`。稍后我们会进一步了解。基本上，它是从数据库中查询的对象列表。我们看到有两个对象，但显示的名称是 `Board object`。这是因为我们尚未实现 `Board` 的 `__str___` 方法。\n\n`_str__ `方法是对象的字符串表示形式。我们可以使用版块的名称来表示它。\n\n首先，退出交互式控制台∶\n\n```python\nexit()\n```\n\n现在编辑`boards app`中的 `models.py` 文件:\n\n```python\nclass Board(models.Model):\n    name = models.CharField(max_length=30, unique=True)\n    description = models.CharField(max_length=100)\n\n    def __str__(self):\n        return self.name\n\n```\n\n再进入交互台，查询：\n\n```python\n<class 'boards.models.Board'>\n>>> Board.objects.all()\n<QuerySet [<Board: Django>, <Board: Python>]>\n```\n\n这样是不是好多了呢。\n\n我们可以将这个`QuerySet`看作一个列表。假设我们想遍历它并打印每个版块的描述∶\n\n```python\nboards_list = Board.objects.all() \n>>> board_list = Board.objects.all()\n>>> for board in board_list:\n...     print(board.description)\n... \nthis is new description\nid 2 for django model\n```\n\n同样，我们可以使用模型的 `管理器（Manager）`来查询数据库并返回单个对象。为此，我们要使用 `get` 方法∶\n\n```python\n>>> django_board = Board.objects.get(id='1')\n>>> django_board\n<Board: Django>\n>>> django_board.name\n'Django'\n>>> django_board.description\n'this is new description'\n```\n\n但我们必须小心这种操作。如果我们试图查找一个不存在的对象，例如，查找`id=3`的版块，它会引发一个异常∶\n\n```python\n>>> django_board = Board.objects.get(id='3') \nboards.models.Board.DoesNotExist: Board matching query does not exist.\n```\n\n`get` 方法的参数可以是模型的任何字段，但最好使用可唯一标识对象的字段来查询。否则，查询可能会返回多个对象，这也会导致异常。\n\n```python\nBoard.objects.get(name='Django')\n<Board: Django>\n```\n\n请注意，查询区分大小写，小写\"django\"不匹配∶\n\n```Python\nBoard.objects.get (name='django')\nboards.models.DoesNotExist: Board matching query does not exist.\n```\n\n\n\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","source":"_posts/Django入门-模型设计.md","raw":"---\ntitle: Django入门-模型设计\ntags:\n  - django\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-09 21:29:50\ncategories: Django\npic: Screenshot_8.webp\n---\n\n## 模型\n\n这些模型基本上代表了应用程序的数据库设计。在本节中要做的是创建 `Django` 所表示的类，这些类就是在上一节中建模的类∶ `Board`，`Topic`和 `Post`。`User` 模型被命名为内置应用叫 `auth`，它以命名空间 `django.contrib.auth` 的形式出现在 `INSTALLED_APPS`配置中。\n\n我们要做的工作都在 `boards/models.py 文`件中。以下是我们在`Django应用程序`中如何表示类图的代码∶\n\n```python\nfrom django.db import models\nfrom django.contrib.auth.models import User\n\n# Create your models here.\n\nclass Board(models.Model):\n    name = models.CharField(max_length=30, unique=True)\n    description = models.CharField(max_length=100)\n\nclass Topic(models.Model):\n    subject = models.CharField(max_length=255)\n    last_updated = models.DateTimeField(auto_now_add=True)\n    board = models.ForeignKey(Board, related_name='topics', on_delete=models.CASCADE)\n    starter = models.ForeignKey(User, related_name='topics', on_delete=models.CASCADE)\n\nclass Post(models.Model):\n    message = models.TextField(max_length=4000)\n    topic = models.ForeignKey(Topic, related_name='posts', on_delete=models.CASCADE)\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now_add=True)\n    create_by = models.ForeignKey(User, related_name='posts', on_delete=models.CASCADE)\n    updated_by = models.ForeignKey(User, null=True, related_name='+', on_delete=models.CASCADE)\n```\n\n所有模型都是`django.db.models.Model`类的子类。每个类将被转换为**数据库表**。每个字段由 `django.db.models.Field`子类（内置在`Django core`）的实例表示，它们并将被转换为数据库的列。\n\n`字段 CharField`，`DateTimeField`等等，都是 `django.db.models.Field` 的子类，包含在`Django`的核心里面-随时可以使用。\n\n在这里，我们仅使用 `CharField``，TextField` ，`DateTimeField`，和`ForeignKey`字段来定义我们的模型。不过在`Django`提供了更广泛的选择来代表不同类型的数据，例如 `IntegerField`，`BooleanField`， `DecimalField`和其它一些字段。\n\n我们会在需要的时候提及它们。\n\n有些字段需要参数，例如`CharField`。我们应该始终设定一个`max_length` 。这些信息将用于创建数据库列。`Django`需要知道数据库列需要多大。该 `max_length` 参数也将被`Django Forms API`用来验证用户输入。\n\n在 `Board` 模型定义中，更具体地说，在 `name` 字段中，我们设置了参数 `unique=True` ，顾名思义，它将强制数据库级别字段的唯一性。\n\n在 `Post` 模型中， `created_at` 字段有一个可选参数， `auto_now_add` 设置为 `True` 。这将告诉Django创建 `Post` 对象时为当前日期和时间。\n\n模型之间的关系使用 `Foreignkey` 字段。它将在模型之间创建一个连接，并在数据库级别创建适当的关系 （注∶ 外键关联）。该 `Foreignkey` 字段需要一个位置参数 `related_name` ，用于引用它关联的模型。（注∶ 例如 `created_by` 是外键字段，关联的`User`模型，表明这个帖子是谁创建的， `related name=posts` 表示在 `User` 那边可以使用 `user.posts` 来查看这个用户创建了哪些帖子）\n\n例如，在 `Topic` 模型中， `board` 字段是 `Board` 模型的 `ForeignKey` 。它告诉`Django`，一个 `Topic` 实例只涉及一个`Board`实例。 `related_name` 参数将用于创建反向关系， `Board` 实例通过属性 `topics` 访问属于这个版块下的 `Topic` 列表。\n\n`Django`自动创建这种反向关系， `related_name` 是可选项。但是，如果我们不为它设置一个名称，`Django`会自动生成它∶`（class_name）_set` 。例如，在 `Board` 模型中，所有 `Topic` 列表将用 `topic_set` 属性表示。而这里我们将其重新命名为了 `topics` ，以使其感觉更自然。\n\n在 `Post` 模型中，该 `updated_by` 字段设置 `related_name='+'`。这指示 `Django`我们不需要这种反向关系，所以它会被忽略（注∶也就是说我们不需要关系用户修改过哪些帖子）。\n\n下面您可以看到类图和Django模型的源代码之间的比较，绿线表示我们如何处理反向关系。\n\n![](Screenshot_1.webp)\n\n## 迁移模型\n\n下一步是告诉`Django`创建数据库，以便我们可以开始使用它。打开终端，激活虚拟环境，转到` manage.py`文件所在的文件夹，然后运行以下命令∶\n\n```python\npython manage. py makemigrations\n```\n\n你会看到输出的内容是∶\n\n```python\nMigrations for 'boards':\n  boards\\migrations\\0001_initial.py\n    - Create model Board\n    - Create model Topic\n    - Create model Post\n```\n\n此时， `Django` 在 `boards/migrations` 目录创建了一个名为 `0001_initial.py` 的文件。它代表了应用程序模型的当前状态。在下一步，`Django`将使用该文件创建表和列。\n\n迁移文件将被翻译成SQL语句。如果您熟悉SQL，则可以运行以下命令来检验将是要被数据库执行的SQL指令\n\n```python\npython manage.py sqlmigrate boards 0001\n```\n\n如果你不熟悉SQL，也不要担心。所有的工作都将使用`Django ORM`来完成，它是一个与数据库进行通信的抽象层。下一步是将我们生成的迁移文件应用到数据库∶\n\n```python\npython manage.py migrate\n```\n\n输出结果如下：\n\n```python\nOperations to perform:\n  Apply all migrations: admin, auth, boards, contenttypes, sessions\nRunning migrations:\n  Applying contenttypes.0001_initial... OK\n  Applying auth.0001_initial... OK\n  Applying admin.0001_initial... OK\n  Applying admin.0002_logentry_remove_auto_add... OK\n  Applying admin.0003_logentry_add_action_flag_choices... OK\n  Applying contenttypes.0002_remove_content_type_name... OK\n  Applying auth.0002_alter_permission_name_max_length... OK\n  Applying auth.0003_alter_user_email_max_length... OK\n  Applying auth.0004_alter_user_username_opts... OK\n  Applying auth.0005_alter_user_last_login_null... OK\n  Applying auth.0006_require_contenttypes_0002... OK\n  Applying auth.0007_alter_validators_add_error_messages... OK\n  Applying auth.0008_alter_user_username_max_length... OK\n  Applying auth.0009_alter_user_last_name_max_length... OK\n  Applying auth.0010_alter_group_name_max_length... OK\n  Applying auth.0011_update_proxy_permissions... OK\n  Applying auth.0012_alter_user_first_name_max_length... OK\n  Applying boards.0001_initial... OK\n  Applying sessions.0001_initial... OK\n```\n\n好了数据库就迁移成功了。\n\n## 试验 Models API\n\n使用Python进行开发的一个重要优点是`交互式shell`。我一直在使用它。这是一种快速尝试和试验API的方法。\n\n可以使用`manage.py`工具加载我们的项目来启动 `Python shell` ∶\n\n```python\npython manage. py shell\n```\n\n这与直接输入 `python` 指令来调用交互式控制台是非常相似的，除此之外，项目将被添加到 `sys.path` 并加载Django。这意味着我们可以在项目中导入我们的模型和其他资源并使用它。\n\n让我们从导入`Board类`开始∶\n\n```python\nfrom boards.models import Board\n```\n\n\n要创建新的 `board` 对象，我们可以执行以下操作∶\n\n```python\nboard = Board(name='Django',description='This is a board abo ut Django.')\n```\n\n为了将这个对象保存在数据库中，我们必须调用`save`方法∶\n\n```python\nboard.save()\n```\n\n`save` 方法用于创建和更新对象。这里Django创建了一个新对象，因为这时 `Board` 实例没有`id`。第一次保存后，Django会自动设置`ID`∶\n\n```python\n>>> board.id\n1\n```\n\n您可以将其余的字段当做Python属性访问∶\n\n```python\n>>> board.name\n'Django'\n>>> board.description\n'This is a board about django'\n```\n\n要更新一个值，我们可以这样做∶\n\n```python\nboard.description ='Django discussion board'\nboard.save()\n>>> board.description \n'this is new description'\n```\n每个Django模型都带有一个特殊的属性；我们称之为`模型管理器（Model Manager）`。你可以通过属性 `objects` 来访问这个管理器，它主要用于数据库操作。例如，我们可以使用它来直接创建一个新的`Board`对象∶\n\n```python\n>>> board = Board.objects.create(name='Python', description='id 2 for django model')\n>>> board.save()\n>>> board.id\n2\n```\n\n所以，现在我们有两个版块了。我们可以使用 `objects` 列出数据库中所有现有的版块\n\n```python\n>>> Board.objects.all()\n<QuerySet [<Board: Board object (1)>, <Board: Board object (2)>]>\n```\n\n结果是一个`QuerySet`。稍后我们会进一步了解。基本上，它是从数据库中查询的对象列表。我们看到有两个对象，但显示的名称是 `Board object`。这是因为我们尚未实现 `Board` 的 `__str___` 方法。\n\n`_str__ `方法是对象的字符串表示形式。我们可以使用版块的名称来表示它。\n\n首先，退出交互式控制台∶\n\n```python\nexit()\n```\n\n现在编辑`boards app`中的 `models.py` 文件:\n\n```python\nclass Board(models.Model):\n    name = models.CharField(max_length=30, unique=True)\n    description = models.CharField(max_length=100)\n\n    def __str__(self):\n        return self.name\n\n```\n\n再进入交互台，查询：\n\n```python\n<class 'boards.models.Board'>\n>>> Board.objects.all()\n<QuerySet [<Board: Django>, <Board: Python>]>\n```\n\n这样是不是好多了呢。\n\n我们可以将这个`QuerySet`看作一个列表。假设我们想遍历它并打印每个版块的描述∶\n\n```python\nboards_list = Board.objects.all() \n>>> board_list = Board.objects.all()\n>>> for board in board_list:\n...     print(board.description)\n... \nthis is new description\nid 2 for django model\n```\n\n同样，我们可以使用模型的 `管理器（Manager）`来查询数据库并返回单个对象。为此，我们要使用 `get` 方法∶\n\n```python\n>>> django_board = Board.objects.get(id='1')\n>>> django_board\n<Board: Django>\n>>> django_board.name\n'Django'\n>>> django_board.description\n'this is new description'\n```\n\n但我们必须小心这种操作。如果我们试图查找一个不存在的对象，例如，查找`id=3`的版块，它会引发一个异常∶\n\n```python\n>>> django_board = Board.objects.get(id='3') \nboards.models.Board.DoesNotExist: Board matching query does not exist.\n```\n\n`get` 方法的参数可以是模型的任何字段，但最好使用可唯一标识对象的字段来查询。否则，查询可能会返回多个对象，这也会导致异常。\n\n```python\nBoard.objects.get(name='Django')\n<Board: Django>\n```\n\n请注意，查询区分大小写，小写\"django\"不匹配∶\n\n```Python\nBoard.objects.get (name='django')\nboards.models.DoesNotExist: Board matching query does not exist.\n```\n\n\n\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","slug":"Django入门-模型设计","published":1,"updated":"2021-06-16T09:29:06.007Z","layout":"post","photos":[],"link":"","_id":"ckq14rx1w000a44ud6rrc2nrr","content":"<h2 id=\"模型\"><a href=\"#模型\" class=\"headerlink\" title=\"模型\"></a>模型</h2><p>这些模型基本上代表了应用程序的数据库设计。在本节中要做的是创建 <code>Django</code> 所表示的类，这些类就是在上一节中建模的类∶ <code>Board</code>，<code>Topic</code>和 <code>Post</code>。<code>User</code> 模型被命名为内置应用叫 <code>auth</code>，它以命名空间 <code>django.contrib.auth</code> 的形式出现在 <code>INSTALLED_APPS</code>配置中。</p>\n<p>我们要做的工作都在 <code>boards/models.py 文</code>件中。以下是我们在<code>Django应用程序</code>中如何表示类图的代码∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.db <span class=\"keyword\">import</span> models</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.contrib.auth.models <span class=\"keyword\">import</span> User</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Create your models here.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Board</span>(<span class=\"params\">models.Model</span>):</span></span><br><span class=\"line\">    name = models.CharField(max_length=<span class=\"number\">30</span>, unique=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    description = models.CharField(max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Topic</span>(<span class=\"params\">models.Model</span>):</span></span><br><span class=\"line\">    subject = models.CharField(max_length=<span class=\"number\">255</span>)</span><br><span class=\"line\">    last_updated = models.DateTimeField(auto_now_add=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    board = models.ForeignKey(Board, related_name=<span class=\"string\">&#x27;topics&#x27;</span>, on_delete=models.CASCADE)</span><br><span class=\"line\">    starter = models.ForeignKey(User, related_name=<span class=\"string\">&#x27;topics&#x27;</span>, on_delete=models.CASCADE)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Post</span>(<span class=\"params\">models.Model</span>):</span></span><br><span class=\"line\">    message = models.TextField(max_length=<span class=\"number\">4000</span>)</span><br><span class=\"line\">    topic = models.ForeignKey(Topic, related_name=<span class=\"string\">&#x27;posts&#x27;</span>, on_delete=models.CASCADE)</span><br><span class=\"line\">    created_at = models.DateTimeField(auto_now_add=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    updated_at = models.DateTimeField(auto_now_add=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    create_by = models.ForeignKey(User, related_name=<span class=\"string\">&#x27;posts&#x27;</span>, on_delete=models.CASCADE)</span><br><span class=\"line\">    updated_by = models.ForeignKey(User, null=<span class=\"literal\">True</span>, related_name=<span class=\"string\">&#x27;+&#x27;</span>, on_delete=models.CASCADE)</span><br></pre></td></tr></table></figure>\n\n<p>所有模型都是<code>django.db.models.Model</code>类的子类。每个类将被转换为<strong>数据库表</strong>。每个字段由 <code>django.db.models.Field</code>子类（内置在<code>Django core</code>）的实例表示，它们并将被转换为数据库的列。</p>\n<p><code>字段 CharField</code>，<code>DateTimeField</code>等等，都是 <code>django.db.models.Field</code> 的子类，包含在<code>Django</code>的核心里面-随时可以使用。</p>\n<p>在这里，我们仅使用 <code>CharField``，TextField</code> ，<code>DateTimeField</code>，和<code>ForeignKey</code>字段来定义我们的模型。不过在<code>Django</code>提供了更广泛的选择来代表不同类型的数据，例如 <code>IntegerField</code>，<code>BooleanField</code>， <code>DecimalField</code>和其它一些字段。</p>\n<p>我们会在需要的时候提及它们。</p>\n<p>有些字段需要参数，例如<code>CharField</code>。我们应该始终设定一个<code>max_length</code> 。这些信息将用于创建数据库列。<code>Django</code>需要知道数据库列需要多大。该 <code>max_length</code> 参数也将被<code>Django Forms API</code>用来验证用户输入。</p>\n<p>在 <code>Board</code> 模型定义中，更具体地说，在 <code>name</code> 字段中，我们设置了参数 <code>unique=True</code> ，顾名思义，它将强制数据库级别字段的唯一性。</p>\n<p>在 <code>Post</code> 模型中， <code>created_at</code> 字段有一个可选参数， <code>auto_now_add</code> 设置为 <code>True</code> 。这将告诉Django创建 <code>Post</code> 对象时为当前日期和时间。</p>\n<p>模型之间的关系使用 <code>Foreignkey</code> 字段。它将在模型之间创建一个连接，并在数据库级别创建适当的关系 （注∶ 外键关联）。该 <code>Foreignkey</code> 字段需要一个位置参数 <code>related_name</code> ，用于引用它关联的模型。（注∶ 例如 <code>created_by</code> 是外键字段，关联的<code>User</code>模型，表明这个帖子是谁创建的， <code>related name=posts</code> 表示在 <code>User</code> 那边可以使用 <code>user.posts</code> 来查看这个用户创建了哪些帖子）</p>\n<p>例如，在 <code>Topic</code> 模型中， <code>board</code> 字段是 <code>Board</code> 模型的 <code>ForeignKey</code> 。它告诉<code>Django</code>，一个 <code>Topic</code> 实例只涉及一个<code>Board</code>实例。 <code>related_name</code> 参数将用于创建反向关系， <code>Board</code> 实例通过属性 <code>topics</code> 访问属于这个版块下的 <code>Topic</code> 列表。</p>\n<p><code>Django</code>自动创建这种反向关系， <code>related_name</code> 是可选项。但是，如果我们不为它设置一个名称，<code>Django</code>会自动生成它∶<code>（class_name）_set</code> 。例如，在 <code>Board</code> 模型中，所有 <code>Topic</code> 列表将用 <code>topic_set</code> 属性表示。而这里我们将其重新命名为了 <code>topics</code> ，以使其感觉更自然。</p>\n<p>在 <code>Post</code> 模型中，该 <code>updated_by</code> 字段设置 <code>related_name=&#39;+&#39;</code>。这指示 <code>Django</code>我们不需要这种反向关系，所以它会被忽略（注∶也就是说我们不需要关系用户修改过哪些帖子）。</p>\n<p>下面您可以看到类图和Django模型的源代码之间的比较，绿线表示我们如何处理反向关系。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<h2 id=\"迁移模型\"><a href=\"#迁移模型\" class=\"headerlink\" title=\"迁移模型\"></a>迁移模型</h2><p>下一步是告诉<code>Django</code>创建数据库，以便我们可以开始使用它。打开终端，激活虚拟环境，转到<code> manage.py</code>文件所在的文件夹，然后运行以下命令∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage. py makemigrations</span><br></pre></td></tr></table></figure>\n\n<p>你会看到输出的内容是∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Migrations <span class=\"keyword\">for</span> <span class=\"string\">&#x27;boards&#x27;</span>:</span><br><span class=\"line\">  boards\\migrations\\0001_initial.py</span><br><span class=\"line\">    - Create model Board</span><br><span class=\"line\">    - Create model Topic</span><br><span class=\"line\">    - Create model Post</span><br></pre></td></tr></table></figure>\n\n<p>此时， <code>Django</code> 在 <code>boards/migrations</code> 目录创建了一个名为 <code>0001_initial.py</code> 的文件。它代表了应用程序模型的当前状态。在下一步，<code>Django</code>将使用该文件创建表和列。</p>\n<p>迁移文件将被翻译成SQL语句。如果您熟悉SQL，则可以运行以下命令来检验将是要被数据库执行的SQL指令</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py sqlmigrate boards 0001</span><br></pre></td></tr></table></figure>\n\n<p>如果你不熟悉SQL，也不要担心。所有的工作都将使用<code>Django ORM</code>来完成，它是一个与数据库进行通信的抽象层。下一步是将我们生成的迁移文件应用到数据库∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py migrate</span><br></pre></td></tr></table></figure>\n\n<p>输出结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Operations to perform:</span><br><span class=\"line\">  Apply <span class=\"built_in\">all</span> migrations: admin, auth, boards, contenttypes, sessions</span><br><span class=\"line\">Running migrations:</span><br><span class=\"line\">  Applying contenttypes<span class=\"number\">.0001</span>_initial... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0001</span>_initial... OK</span><br><span class=\"line\">  Applying admin<span class=\"number\">.0001</span>_initial... OK</span><br><span class=\"line\">  Applying admin<span class=\"number\">.0002</span>_logentry_remove_auto_add... OK</span><br><span class=\"line\">  Applying admin<span class=\"number\">.0003</span>_logentry_add_action_flag_choices... OK</span><br><span class=\"line\">  Applying contenttypes<span class=\"number\">.0002</span>_remove_content_type_name... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0002</span>_alter_permission_name_max_length... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0003</span>_alter_user_email_max_length... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0004</span>_alter_user_username_opts... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0005</span>_alter_user_last_login_null... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0006</span>_require_contenttypes_0002... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0007</span>_alter_validators_add_error_messages... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0008</span>_alter_user_username_max_length... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0009</span>_alter_user_last_name_max_length... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0010</span>_alter_group_name_max_length... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0011</span>_update_proxy_permissions... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0012</span>_alter_user_first_name_max_length... OK</span><br><span class=\"line\">  Applying boards<span class=\"number\">.0001</span>_initial... OK</span><br><span class=\"line\">  Applying sessions<span class=\"number\">.0001</span>_initial... OK</span><br></pre></td></tr></table></figure>\n\n<p>好了数据库就迁移成功了。</p>\n<h2 id=\"试验-Models-API\"><a href=\"#试验-Models-API\" class=\"headerlink\" title=\"试验 Models API\"></a>试验 Models API</h2><p>使用Python进行开发的一个重要优点是<code>交互式shell</code>。我一直在使用它。这是一种快速尝试和试验API的方法。</p>\n<p>可以使用<code>manage.py</code>工具加载我们的项目来启动 <code>Python shell</code> ∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage. py shell</span><br></pre></td></tr></table></figure>\n\n<p>这与直接输入 <code>python</code> 指令来调用交互式控制台是非常相似的，除此之外，项目将被添加到 <code>sys.path</code> 并加载Django。这意味着我们可以在项目中导入我们的模型和其他资源并使用它。</p>\n<p>让我们从导入<code>Board类</code>开始∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> boards.models <span class=\"keyword\">import</span> Board</span><br></pre></td></tr></table></figure>\n\n\n<p>要创建新的 <code>board</code> 对象，我们可以执行以下操作∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">board = Board(name=<span class=\"string\">&#x27;Django&#x27;</span>,description=<span class=\"string\">&#x27;This is a board abo ut Django.&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>为了将这个对象保存在数据库中，我们必须调用<code>save</code>方法∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">board.save()</span><br></pre></td></tr></table></figure>\n\n<p><code>save</code> 方法用于创建和更新对象。这里Django创建了一个新对象，因为这时 <code>Board</code> 实例没有<code>id</code>。第一次保存后，Django会自动设置<code>ID</code>∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board.<span class=\"built_in\">id</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<p>您可以将其余的字段当做Python属性访问∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board.name</span><br><span class=\"line\"><span class=\"string\">&#x27;Django&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board.description</span><br><span class=\"line\"><span class=\"string\">&#x27;This is a board about django&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>要更新一个值，我们可以这样做∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">board.description =<span class=\"string\">&#x27;Django discussion board&#x27;</span></span><br><span class=\"line\">board.save()</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board.description </span><br><span class=\"line\"><span class=\"string\">&#x27;this is new description&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>每个Django模型都带有一个特殊的属性；我们称之为<code>模型管理器（Model Manager）</code>。你可以通过属性 <code>objects</code> 来访问这个管理器，它主要用于数据库操作。例如，我们可以使用它来直接创建一个新的<code>Board</code>对象∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board = Board.objects.create(name=<span class=\"string\">&#x27;Python&#x27;</span>, description=<span class=\"string\">&#x27;id 2 for django model&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board.save()</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board.<span class=\"built_in\">id</span></span><br><span class=\"line\"><span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n\n<p>所以，现在我们有两个版块了。我们可以使用 <code>objects</code> 列出数据库中所有现有的版块</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>Board.objects.<span class=\"built_in\">all</span>()</span><br><span class=\"line\">&lt;QuerySet [&lt;Board: Board <span class=\"built_in\">object</span> (<span class=\"number\">1</span>)&gt;, &lt;Board: Board <span class=\"built_in\">object</span> (<span class=\"number\">2</span>)&gt;]&gt;</span><br></pre></td></tr></table></figure>\n\n<p>结果是一个<code>QuerySet</code>。稍后我们会进一步了解。基本上，它是从数据库中查询的对象列表。我们看到有两个对象，但显示的名称是 <code>Board object</code>。这是因为我们尚未实现 <code>Board</code> 的 <code>__str___</code> 方法。</p>\n<p><code>_str__ </code>方法是对象的字符串表示形式。我们可以使用版块的名称来表示它。</p>\n<p>首先，退出交互式控制台∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exit()</span><br></pre></td></tr></table></figure>\n\n<p>现在编辑<code>boards app</code>中的 <code>models.py</code> 文件:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Board</span>(<span class=\"params\">models.Model</span>):</span></span><br><span class=\"line\">    name = models.CharField(max_length=<span class=\"number\">30</span>, unique=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    description = models.CharField(max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__str__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.name</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>再进入交互台，查询：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">boards</span>.<span class=\"title\">models</span>.<span class=\"title\">Board</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&gt;&gt;&gt; <span class=\"title\">Board</span>.<span class=\"title\">objects</span>.<span class=\"title\">all</span>()</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">QuerySet</span> [&lt;<span class=\"title\">Board</span>:</span> Django&gt;, &lt;Board: Python&gt;]&gt;</span><br></pre></td></tr></table></figure>\n\n<p>这样是不是好多了呢。</p>\n<p>我们可以将这个<code>QuerySet</code>看作一个列表。假设我们想遍历它并打印每个版块的描述∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">boards_list = Board.objects.<span class=\"built_in\">all</span>() </span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board_list = Board.objects.<span class=\"built_in\">all</span>()</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">for</span> board <span class=\"keyword\">in</span> board_list:</span><br><span class=\"line\"><span class=\"meta\">... </span>    <span class=\"built_in\">print</span>(board.description)</span><br><span class=\"line\"><span class=\"meta\">... </span></span><br><span class=\"line\">this <span class=\"keyword\">is</span> new description</span><br><span class=\"line\"><span class=\"built_in\">id</span> <span class=\"number\">2</span> <span class=\"keyword\">for</span> django model</span><br></pre></td></tr></table></figure>\n\n<p>同样，我们可以使用模型的 <code>管理器（Manager）</code>来查询数据库并返回单个对象。为此，我们要使用 <code>get</code> 方法∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>django_board = Board.objects.get(<span class=\"built_in\">id</span>=<span class=\"string\">&#x27;1&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>django_board</span><br><span class=\"line\">&lt;Board: Django&gt;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>django_board.name</span><br><span class=\"line\"><span class=\"string\">&#x27;Django&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>django_board.description</span><br><span class=\"line\"><span class=\"string\">&#x27;this is new description&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>但我们必须小心这种操作。如果我们试图查找一个不存在的对象，例如，查找<code>id=3</code>的版块，它会引发一个异常∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>django_board = Board.objects.get(<span class=\"built_in\">id</span>=<span class=\"string\">&#x27;3&#x27;</span>) </span><br><span class=\"line\">boards.models.Board.DoesNotExist: Board matching query does <span class=\"keyword\">not</span> exist.</span><br></pre></td></tr></table></figure>\n\n<p><code>get</code> 方法的参数可以是模型的任何字段，但最好使用可唯一标识对象的字段来查询。否则，查询可能会返回多个对象，这也会导致异常。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Board.objects.get(name=<span class=\"string\">&#x27;Django&#x27;</span>)</span><br><span class=\"line\">&lt;Board: Django&gt;</span><br></pre></td></tr></table></figure>\n\n<p>请注意，查询区分大小写，小写”django”不匹配∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Board.objects.get (name=<span class=\"string\">&#x27;django&#x27;</span>)</span><br><span class=\"line\">boards.models.DoesNotExist: Board matching query does <span class=\"keyword\">not</span> exist.</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"模型\"><a href=\"#模型\" class=\"headerlink\" title=\"模型\"></a>模型</h2><p>这些模型基本上代表了应用程序的数据库设计。在本节中要做的是创建 <code>Django</code> 所表示的类，这些类就是在上一节中建模的类∶ <code>Board</code>，<code>Topic</code>和 <code>Post</code>。<code>User</code> 模型被命名为内置应用叫 <code>auth</code>，它以命名空间 <code>django.contrib.auth</code> 的形式出现在 <code>INSTALLED_APPS</code>配置中。</p>\n<p>我们要做的工作都在 <code>boards/models.py 文</code>件中。以下是我们在<code>Django应用程序</code>中如何表示类图的代码∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.db <span class=\"keyword\">import</span> models</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.contrib.auth.models <span class=\"keyword\">import</span> User</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Create your models here.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Board</span>(<span class=\"params\">models.Model</span>):</span></span><br><span class=\"line\">    name = models.CharField(max_length=<span class=\"number\">30</span>, unique=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    description = models.CharField(max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Topic</span>(<span class=\"params\">models.Model</span>):</span></span><br><span class=\"line\">    subject = models.CharField(max_length=<span class=\"number\">255</span>)</span><br><span class=\"line\">    last_updated = models.DateTimeField(auto_now_add=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    board = models.ForeignKey(Board, related_name=<span class=\"string\">&#x27;topics&#x27;</span>, on_delete=models.CASCADE)</span><br><span class=\"line\">    starter = models.ForeignKey(User, related_name=<span class=\"string\">&#x27;topics&#x27;</span>, on_delete=models.CASCADE)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Post</span>(<span class=\"params\">models.Model</span>):</span></span><br><span class=\"line\">    message = models.TextField(max_length=<span class=\"number\">4000</span>)</span><br><span class=\"line\">    topic = models.ForeignKey(Topic, related_name=<span class=\"string\">&#x27;posts&#x27;</span>, on_delete=models.CASCADE)</span><br><span class=\"line\">    created_at = models.DateTimeField(auto_now_add=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    updated_at = models.DateTimeField(auto_now_add=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    create_by = models.ForeignKey(User, related_name=<span class=\"string\">&#x27;posts&#x27;</span>, on_delete=models.CASCADE)</span><br><span class=\"line\">    updated_by = models.ForeignKey(User, null=<span class=\"literal\">True</span>, related_name=<span class=\"string\">&#x27;+&#x27;</span>, on_delete=models.CASCADE)</span><br></pre></td></tr></table></figure>\n\n<p>所有模型都是<code>django.db.models.Model</code>类的子类。每个类将被转换为<strong>数据库表</strong>。每个字段由 <code>django.db.models.Field</code>子类（内置在<code>Django core</code>）的实例表示，它们并将被转换为数据库的列。</p>\n<p><code>字段 CharField</code>，<code>DateTimeField</code>等等，都是 <code>django.db.models.Field</code> 的子类，包含在<code>Django</code>的核心里面-随时可以使用。</p>\n<p>在这里，我们仅使用 <code>CharField``，TextField</code> ，<code>DateTimeField</code>，和<code>ForeignKey</code>字段来定义我们的模型。不过在<code>Django</code>提供了更广泛的选择来代表不同类型的数据，例如 <code>IntegerField</code>，<code>BooleanField</code>， <code>DecimalField</code>和其它一些字段。</p>\n<p>我们会在需要的时候提及它们。</p>\n<p>有些字段需要参数，例如<code>CharField</code>。我们应该始终设定一个<code>max_length</code> 。这些信息将用于创建数据库列。<code>Django</code>需要知道数据库列需要多大。该 <code>max_length</code> 参数也将被<code>Django Forms API</code>用来验证用户输入。</p>\n<p>在 <code>Board</code> 模型定义中，更具体地说，在 <code>name</code> 字段中，我们设置了参数 <code>unique=True</code> ，顾名思义，它将强制数据库级别字段的唯一性。</p>\n<p>在 <code>Post</code> 模型中， <code>created_at</code> 字段有一个可选参数， <code>auto_now_add</code> 设置为 <code>True</code> 。这将告诉Django创建 <code>Post</code> 对象时为当前日期和时间。</p>\n<p>模型之间的关系使用 <code>Foreignkey</code> 字段。它将在模型之间创建一个连接，并在数据库级别创建适当的关系 （注∶ 外键关联）。该 <code>Foreignkey</code> 字段需要一个位置参数 <code>related_name</code> ，用于引用它关联的模型。（注∶ 例如 <code>created_by</code> 是外键字段，关联的<code>User</code>模型，表明这个帖子是谁创建的， <code>related name=posts</code> 表示在 <code>User</code> 那边可以使用 <code>user.posts</code> 来查看这个用户创建了哪些帖子）</p>\n<p>例如，在 <code>Topic</code> 模型中， <code>board</code> 字段是 <code>Board</code> 模型的 <code>ForeignKey</code> 。它告诉<code>Django</code>，一个 <code>Topic</code> 实例只涉及一个<code>Board</code>实例。 <code>related_name</code> 参数将用于创建反向关系， <code>Board</code> 实例通过属性 <code>topics</code> 访问属于这个版块下的 <code>Topic</code> 列表。</p>\n<p><code>Django</code>自动创建这种反向关系， <code>related_name</code> 是可选项。但是，如果我们不为它设置一个名称，<code>Django</code>会自动生成它∶<code>（class_name）_set</code> 。例如，在 <code>Board</code> 模型中，所有 <code>Topic</code> 列表将用 <code>topic_set</code> 属性表示。而这里我们将其重新命名为了 <code>topics</code> ，以使其感觉更自然。</p>\n<p>在 <code>Post</code> 模型中，该 <code>updated_by</code> 字段设置 <code>related_name=&#39;+&#39;</code>。这指示 <code>Django</code>我们不需要这种反向关系，所以它会被忽略（注∶也就是说我们不需要关系用户修改过哪些帖子）。</p>\n<p>下面您可以看到类图和Django模型的源代码之间的比较，绿线表示我们如何处理反向关系。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<h2 id=\"迁移模型\"><a href=\"#迁移模型\" class=\"headerlink\" title=\"迁移模型\"></a>迁移模型</h2><p>下一步是告诉<code>Django</code>创建数据库，以便我们可以开始使用它。打开终端，激活虚拟环境，转到<code> manage.py</code>文件所在的文件夹，然后运行以下命令∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage. py makemigrations</span><br></pre></td></tr></table></figure>\n\n<p>你会看到输出的内容是∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Migrations <span class=\"keyword\">for</span> <span class=\"string\">&#x27;boards&#x27;</span>:</span><br><span class=\"line\">  boards\\migrations\\0001_initial.py</span><br><span class=\"line\">    - Create model Board</span><br><span class=\"line\">    - Create model Topic</span><br><span class=\"line\">    - Create model Post</span><br></pre></td></tr></table></figure>\n\n<p>此时， <code>Django</code> 在 <code>boards/migrations</code> 目录创建了一个名为 <code>0001_initial.py</code> 的文件。它代表了应用程序模型的当前状态。在下一步，<code>Django</code>将使用该文件创建表和列。</p>\n<p>迁移文件将被翻译成SQL语句。如果您熟悉SQL，则可以运行以下命令来检验将是要被数据库执行的SQL指令</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py sqlmigrate boards 0001</span><br></pre></td></tr></table></figure>\n\n<p>如果你不熟悉SQL，也不要担心。所有的工作都将使用<code>Django ORM</code>来完成，它是一个与数据库进行通信的抽象层。下一步是将我们生成的迁移文件应用到数据库∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py migrate</span><br></pre></td></tr></table></figure>\n\n<p>输出结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Operations to perform:</span><br><span class=\"line\">  Apply <span class=\"built_in\">all</span> migrations: admin, auth, boards, contenttypes, sessions</span><br><span class=\"line\">Running migrations:</span><br><span class=\"line\">  Applying contenttypes<span class=\"number\">.0001</span>_initial... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0001</span>_initial... OK</span><br><span class=\"line\">  Applying admin<span class=\"number\">.0001</span>_initial... OK</span><br><span class=\"line\">  Applying admin<span class=\"number\">.0002</span>_logentry_remove_auto_add... OK</span><br><span class=\"line\">  Applying admin<span class=\"number\">.0003</span>_logentry_add_action_flag_choices... OK</span><br><span class=\"line\">  Applying contenttypes<span class=\"number\">.0002</span>_remove_content_type_name... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0002</span>_alter_permission_name_max_length... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0003</span>_alter_user_email_max_length... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0004</span>_alter_user_username_opts... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0005</span>_alter_user_last_login_null... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0006</span>_require_contenttypes_0002... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0007</span>_alter_validators_add_error_messages... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0008</span>_alter_user_username_max_length... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0009</span>_alter_user_last_name_max_length... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0010</span>_alter_group_name_max_length... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0011</span>_update_proxy_permissions... OK</span><br><span class=\"line\">  Applying auth<span class=\"number\">.0012</span>_alter_user_first_name_max_length... OK</span><br><span class=\"line\">  Applying boards<span class=\"number\">.0001</span>_initial... OK</span><br><span class=\"line\">  Applying sessions<span class=\"number\">.0001</span>_initial... OK</span><br></pre></td></tr></table></figure>\n\n<p>好了数据库就迁移成功了。</p>\n<h2 id=\"试验-Models-API\"><a href=\"#试验-Models-API\" class=\"headerlink\" title=\"试验 Models API\"></a>试验 Models API</h2><p>使用Python进行开发的一个重要优点是<code>交互式shell</code>。我一直在使用它。这是一种快速尝试和试验API的方法。</p>\n<p>可以使用<code>manage.py</code>工具加载我们的项目来启动 <code>Python shell</code> ∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage. py shell</span><br></pre></td></tr></table></figure>\n\n<p>这与直接输入 <code>python</code> 指令来调用交互式控制台是非常相似的，除此之外，项目将被添加到 <code>sys.path</code> 并加载Django。这意味着我们可以在项目中导入我们的模型和其他资源并使用它。</p>\n<p>让我们从导入<code>Board类</code>开始∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> boards.models <span class=\"keyword\">import</span> Board</span><br></pre></td></tr></table></figure>\n\n\n<p>要创建新的 <code>board</code> 对象，我们可以执行以下操作∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">board = Board(name=<span class=\"string\">&#x27;Django&#x27;</span>,description=<span class=\"string\">&#x27;This is a board abo ut Django.&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>为了将这个对象保存在数据库中，我们必须调用<code>save</code>方法∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">board.save()</span><br></pre></td></tr></table></figure>\n\n<p><code>save</code> 方法用于创建和更新对象。这里Django创建了一个新对象，因为这时 <code>Board</code> 实例没有<code>id</code>。第一次保存后，Django会自动设置<code>ID</code>∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board.<span class=\"built_in\">id</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<p>您可以将其余的字段当做Python属性访问∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board.name</span><br><span class=\"line\"><span class=\"string\">&#x27;Django&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board.description</span><br><span class=\"line\"><span class=\"string\">&#x27;This is a board about django&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>要更新一个值，我们可以这样做∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">board.description =<span class=\"string\">&#x27;Django discussion board&#x27;</span></span><br><span class=\"line\">board.save()</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board.description </span><br><span class=\"line\"><span class=\"string\">&#x27;this is new description&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>每个Django模型都带有一个特殊的属性；我们称之为<code>模型管理器（Model Manager）</code>。你可以通过属性 <code>objects</code> 来访问这个管理器，它主要用于数据库操作。例如，我们可以使用它来直接创建一个新的<code>Board</code>对象∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board = Board.objects.create(name=<span class=\"string\">&#x27;Python&#x27;</span>, description=<span class=\"string\">&#x27;id 2 for django model&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board.save()</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board.<span class=\"built_in\">id</span></span><br><span class=\"line\"><span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n\n<p>所以，现在我们有两个版块了。我们可以使用 <code>objects</code> 列出数据库中所有现有的版块</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>Board.objects.<span class=\"built_in\">all</span>()</span><br><span class=\"line\">&lt;QuerySet [&lt;Board: Board <span class=\"built_in\">object</span> (<span class=\"number\">1</span>)&gt;, &lt;Board: Board <span class=\"built_in\">object</span> (<span class=\"number\">2</span>)&gt;]&gt;</span><br></pre></td></tr></table></figure>\n\n<p>结果是一个<code>QuerySet</code>。稍后我们会进一步了解。基本上，它是从数据库中查询的对象列表。我们看到有两个对象，但显示的名称是 <code>Board object</code>。这是因为我们尚未实现 <code>Board</code> 的 <code>__str___</code> 方法。</p>\n<p><code>_str__ </code>方法是对象的字符串表示形式。我们可以使用版块的名称来表示它。</p>\n<p>首先，退出交互式控制台∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exit()</span><br></pre></td></tr></table></figure>\n\n<p>现在编辑<code>boards app</code>中的 <code>models.py</code> 文件:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Board</span>(<span class=\"params\">models.Model</span>):</span></span><br><span class=\"line\">    name = models.CharField(max_length=<span class=\"number\">30</span>, unique=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    description = models.CharField(max_length=<span class=\"number\">100</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__str__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.name</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>再进入交互台，查询：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">boards</span>.<span class=\"title\">models</span>.<span class=\"title\">Board</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&gt;&gt;&gt; <span class=\"title\">Board</span>.<span class=\"title\">objects</span>.<span class=\"title\">all</span>()</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">QuerySet</span> [&lt;<span class=\"title\">Board</span>:</span> Django&gt;, &lt;Board: Python&gt;]&gt;</span><br></pre></td></tr></table></figure>\n\n<p>这样是不是好多了呢。</p>\n<p>我们可以将这个<code>QuerySet</code>看作一个列表。假设我们想遍历它并打印每个版块的描述∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">boards_list = Board.objects.<span class=\"built_in\">all</span>() </span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>board_list = Board.objects.<span class=\"built_in\">all</span>()</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">for</span> board <span class=\"keyword\">in</span> board_list:</span><br><span class=\"line\"><span class=\"meta\">... </span>    <span class=\"built_in\">print</span>(board.description)</span><br><span class=\"line\"><span class=\"meta\">... </span></span><br><span class=\"line\">this <span class=\"keyword\">is</span> new description</span><br><span class=\"line\"><span class=\"built_in\">id</span> <span class=\"number\">2</span> <span class=\"keyword\">for</span> django model</span><br></pre></td></tr></table></figure>\n\n<p>同样，我们可以使用模型的 <code>管理器（Manager）</code>来查询数据库并返回单个对象。为此，我们要使用 <code>get</code> 方法∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>django_board = Board.objects.get(<span class=\"built_in\">id</span>=<span class=\"string\">&#x27;1&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>django_board</span><br><span class=\"line\">&lt;Board: Django&gt;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>django_board.name</span><br><span class=\"line\"><span class=\"string\">&#x27;Django&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>django_board.description</span><br><span class=\"line\"><span class=\"string\">&#x27;this is new description&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>但我们必须小心这种操作。如果我们试图查找一个不存在的对象，例如，查找<code>id=3</code>的版块，它会引发一个异常∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>django_board = Board.objects.get(<span class=\"built_in\">id</span>=<span class=\"string\">&#x27;3&#x27;</span>) </span><br><span class=\"line\">boards.models.Board.DoesNotExist: Board matching query does <span class=\"keyword\">not</span> exist.</span><br></pre></td></tr></table></figure>\n\n<p><code>get</code> 方法的参数可以是模型的任何字段，但最好使用可唯一标识对象的字段来查询。否则，查询可能会返回多个对象，这也会导致异常。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Board.objects.get(name=<span class=\"string\">&#x27;Django&#x27;</span>)</span><br><span class=\"line\">&lt;Board: Django&gt;</span><br></pre></td></tr></table></figure>\n\n<p>请注意，查询区分大小写，小写”django”不匹配∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Board.objects.get (name=<span class=\"string\">&#x27;django&#x27;</span>)</span><br><span class=\"line\">boards.models.DoesNotExist: Board matching query does <span class=\"keyword\">not</span> exist.</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n"},{"title":"Django入门-系统设计","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-09T01:56:24.000Z","pic":"Screenshot_8.webp","_content":"\n## 论坛项目\n\n在进入模型，视图等其它有趣的部分之前，先让我们花点时间，简要地讨论我们将要开发的这个项目。如果你已经有了Web 开发的经验并且觉得它太繁琐了，那么你可以浏览一下图片以了解我们将要构建的内容，然后直接跳转到本教程的模型部分。\n\n### 用列图\n\n我们的项目是一个论坛系统，整个项目的构思是维护几个论坛版块（boards），每个版块像一个分类一样。在指定的版块里面，用户可以通过创建新主题（Topic）开始讨论，其他用户可以参与讨论回复。我们需要找到一种方法来区分普通用户和管理员用户，因为只有管理员可以创建版块。下图概述了主要的用例和每种类型的用户角色∶\n\n![](Screenshot_1.webp)\n\n从用例图中，我们可以开始思考项目所需的实体类有哪些。这些实体就是我们要创建的模型，它与我们的Django应用程序处理的数据非常密切。\n\n### 类图\n\n从用例图中，我们可以开始思考项目所需的实体类有哪些。这些实体就是我们要创建的模型，它与我们的Django应用程序处理的数据非常密切。\n\n为了能够实现上面描述的用例，我们需要至少实现下面几个模型∶ `Board`， `Topic`，`Post`和`User`。\n\n![](Screenshot_2.webp)\n\n- `Board`∶ 版块\n- `Topic`∶主题\n- `Post`∶帖子（译注∶ 其实就是主题的回复或评论）\n\n类与类之间的实线告诉我们，在一个主题`（Topic）`中，我们需要有一个字段（译注∶其实就是通过外键来关联）来确定它属于哪个版块`（Board）`。同样，帖子`（Post）`也需要一个字段来表示它属于哪个主题，这样我们就可以列出在特定主题内创建的帖子。最后，我们需要一个字段来表示主题是谁发起的，帖子是谁发的。用户和版块之间也有联系，谁创建的版块。但是这些信息与应用程序无关。\n\n现在我们的类图有基本的表现形式，我们还要考虑这些模型将承载哪些信息。这很容易让事情变得复杂，所以试着先把重要的内容列出来，这些内容是我们启动项目需要的信息。后面我们再使用 `Django` 的迁移`（Migrations）`功能来改进模型，您将在下一节中详细了解这些内容。但就目前而言，这是模型最基本的内容∶\n\n![](Screenshot_3.webp)\n\n\n这个类图强调的是模型之间的关系，这些线条和箭头最终会在稍后转换为字段。\n\n对于 `Board` 模型，我们将从两个字段开始∶ `name` 和 `description`。`name` 字段必须是唯一的，为了避免有重复的名称。 `description` 用于说明这个版块是做什么用的。\n\n`Topic` 模型包括四个字段∶`subject` 表示主题内容，`last update` 用来定义话题的排序，`starter` 用来识别谁发起的话题，`board` 用于指定它属于哪个版块。\n\n`Post` 模型有一个 `message` 字段，用于存储回复的内容，`created at` 在排序时候用 （最先发表的帖子排最前面），`updated at` 告诉用户是否更新了内容，同时，还需要有对应的 `User` `模型的引用，Post` 由谁创建的和谁更新的。\n\n最后是 `User` 模型。在类图中，我只提到了字段 `username`，`password`， `email`， `is superuser` 标志，因为这几乎是我们现在要使用的所有东西。\n\n需要注意的是，我们不需要创建 `User` 模型，因为`Django`已经在`contrib`包中内置了`User`模型，我们将直接拿来用。\n\n关于类图之间的对应关系（数字 1，0.* 等等），这里教你如何阅读∶\n\n一个 `topic` 必须与一个（1）`Board`（这意味着它不能为空）相关联，但是 `Board` 下面可能与许多个或者0个 `topic` 关联 （0.*）。这意味着 `Board` 下面可能没有主题。（译注∶ 一对多关系）\n\n![](Screenshot_4.webp)\n\n一个 `Topic` 至少有一个 `Post`（发起话题时，同时会发布一个帖子），并且它也可能有许多 `Post`（1.*）。一个`Post`必须与一个并且只有一个`Topic（1）`相关联。\n\n![](Screenshot_5.webp)\n\n一个 `Topic`必须有一个且只有一个`User`相关联，`topic`的发起者是（1）。而一个用户可能有很多或者没有 `topic` （0.*）。\n\n![](Screenshot_6.webp)\n\n`Post` 必须有一个并且只有一个与之关联的用户，用户可以有许多或没有 `Post`（0.*）。`Post`和`User`之间的第二个关联是直接关联（参见该行最后的箭头），就是 `Post` 可以被用户修改（`updated_by`），`updated_by`有可能是空（`Post` 没有被修改）。\n\n画这个类图的另一种方法是强调字段而不是模型之间的关系∶\n\n![](Screenshot_7.webp)\n\n上面的表示方式与前面的表示方式是对等的，不过这种方式更接近我们将要使用 `Django Models API` 设计的内容。在这种表示方式中，我们可以更清楚地看到，在 `Post` 模型中，关联了 `Topic`，`created_by`（创建者）和 `updated by`（更新者）字段。另一个值得注意的事情是，在 `Topic` 模型中，有一个名为 `posts （`） 的操作（一个类方法）。我们将通过反向关系来实现这一目标，`Django` 将自动在数据库中执行查询以返回特定主题的所有帖子列表。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","source":"_posts/Django入门-系统设计.md","raw":"---\ntitle: Django入门-系统设计\ntags:\n  - django\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-09 09:56:24\ncategories: Django\npic: Screenshot_8.webp\n---\n\n## 论坛项目\n\n在进入模型，视图等其它有趣的部分之前，先让我们花点时间，简要地讨论我们将要开发的这个项目。如果你已经有了Web 开发的经验并且觉得它太繁琐了，那么你可以浏览一下图片以了解我们将要构建的内容，然后直接跳转到本教程的模型部分。\n\n### 用列图\n\n我们的项目是一个论坛系统，整个项目的构思是维护几个论坛版块（boards），每个版块像一个分类一样。在指定的版块里面，用户可以通过创建新主题（Topic）开始讨论，其他用户可以参与讨论回复。我们需要找到一种方法来区分普通用户和管理员用户，因为只有管理员可以创建版块。下图概述了主要的用例和每种类型的用户角色∶\n\n![](Screenshot_1.webp)\n\n从用例图中，我们可以开始思考项目所需的实体类有哪些。这些实体就是我们要创建的模型，它与我们的Django应用程序处理的数据非常密切。\n\n### 类图\n\n从用例图中，我们可以开始思考项目所需的实体类有哪些。这些实体就是我们要创建的模型，它与我们的Django应用程序处理的数据非常密切。\n\n为了能够实现上面描述的用例，我们需要至少实现下面几个模型∶ `Board`， `Topic`，`Post`和`User`。\n\n![](Screenshot_2.webp)\n\n- `Board`∶ 版块\n- `Topic`∶主题\n- `Post`∶帖子（译注∶ 其实就是主题的回复或评论）\n\n类与类之间的实线告诉我们，在一个主题`（Topic）`中，我们需要有一个字段（译注∶其实就是通过外键来关联）来确定它属于哪个版块`（Board）`。同样，帖子`（Post）`也需要一个字段来表示它属于哪个主题，这样我们就可以列出在特定主题内创建的帖子。最后，我们需要一个字段来表示主题是谁发起的，帖子是谁发的。用户和版块之间也有联系，谁创建的版块。但是这些信息与应用程序无关。\n\n现在我们的类图有基本的表现形式，我们还要考虑这些模型将承载哪些信息。这很容易让事情变得复杂，所以试着先把重要的内容列出来，这些内容是我们启动项目需要的信息。后面我们再使用 `Django` 的迁移`（Migrations）`功能来改进模型，您将在下一节中详细了解这些内容。但就目前而言，这是模型最基本的内容∶\n\n![](Screenshot_3.webp)\n\n\n这个类图强调的是模型之间的关系，这些线条和箭头最终会在稍后转换为字段。\n\n对于 `Board` 模型，我们将从两个字段开始∶ `name` 和 `description`。`name` 字段必须是唯一的，为了避免有重复的名称。 `description` 用于说明这个版块是做什么用的。\n\n`Topic` 模型包括四个字段∶`subject` 表示主题内容，`last update` 用来定义话题的排序，`starter` 用来识别谁发起的话题，`board` 用于指定它属于哪个版块。\n\n`Post` 模型有一个 `message` 字段，用于存储回复的内容，`created at` 在排序时候用 （最先发表的帖子排最前面），`updated at` 告诉用户是否更新了内容，同时，还需要有对应的 `User` `模型的引用，Post` 由谁创建的和谁更新的。\n\n最后是 `User` 模型。在类图中，我只提到了字段 `username`，`password`， `email`， `is superuser` 标志，因为这几乎是我们现在要使用的所有东西。\n\n需要注意的是，我们不需要创建 `User` 模型，因为`Django`已经在`contrib`包中内置了`User`模型，我们将直接拿来用。\n\n关于类图之间的对应关系（数字 1，0.* 等等），这里教你如何阅读∶\n\n一个 `topic` 必须与一个（1）`Board`（这意味着它不能为空）相关联，但是 `Board` 下面可能与许多个或者0个 `topic` 关联 （0.*）。这意味着 `Board` 下面可能没有主题。（译注∶ 一对多关系）\n\n![](Screenshot_4.webp)\n\n一个 `Topic` 至少有一个 `Post`（发起话题时，同时会发布一个帖子），并且它也可能有许多 `Post`（1.*）。一个`Post`必须与一个并且只有一个`Topic（1）`相关联。\n\n![](Screenshot_5.webp)\n\n一个 `Topic`必须有一个且只有一个`User`相关联，`topic`的发起者是（1）。而一个用户可能有很多或者没有 `topic` （0.*）。\n\n![](Screenshot_6.webp)\n\n`Post` 必须有一个并且只有一个与之关联的用户，用户可以有许多或没有 `Post`（0.*）。`Post`和`User`之间的第二个关联是直接关联（参见该行最后的箭头），就是 `Post` 可以被用户修改（`updated_by`），`updated_by`有可能是空（`Post` 没有被修改）。\n\n画这个类图的另一种方法是强调字段而不是模型之间的关系∶\n\n![](Screenshot_7.webp)\n\n上面的表示方式与前面的表示方式是对等的，不过这种方式更接近我们将要使用 `Django Models API` 设计的内容。在这种表示方式中，我们可以更清楚地看到，在 `Post` 模型中，关联了 `Topic`，`created_by`（创建者）和 `updated by`（更新者）字段。另一个值得注意的事情是，在 `Topic` 模型中，有一个名为 `posts （`） 的操作（一个类方法）。我们将通过反向关系来实现这一目标，`Django` 将自动在数据库中执行查询以返回特定主题的所有帖子列表。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","slug":"Django入门-系统设计","published":1,"updated":"2021-06-15T15:47:31.580Z","layout":"post","photos":[],"link":"","_id":"ckq14rx1x000b44uddd9z6z1t","content":"<h2 id=\"论坛项目\"><a href=\"#论坛项目\" class=\"headerlink\" title=\"论坛项目\"></a>论坛项目</h2><p>在进入模型，视图等其它有趣的部分之前，先让我们花点时间，简要地讨论我们将要开发的这个项目。如果你已经有了Web 开发的经验并且觉得它太繁琐了，那么你可以浏览一下图片以了解我们将要构建的内容，然后直接跳转到本教程的模型部分。</p>\n<h3 id=\"用列图\"><a href=\"#用列图\" class=\"headerlink\" title=\"用列图\"></a>用列图</h3><p>我们的项目是一个论坛系统，整个项目的构思是维护几个论坛版块（boards），每个版块像一个分类一样。在指定的版块里面，用户可以通过创建新主题（Topic）开始讨论，其他用户可以参与讨论回复。我们需要找到一种方法来区分普通用户和管理员用户，因为只有管理员可以创建版块。下图概述了主要的用例和每种类型的用户角色∶</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>从用例图中，我们可以开始思考项目所需的实体类有哪些。这些实体就是我们要创建的模型，它与我们的Django应用程序处理的数据非常密切。</p>\n<h3 id=\"类图\"><a href=\"#类图\" class=\"headerlink\" title=\"类图\"></a>类图</h3><p>从用例图中，我们可以开始思考项目所需的实体类有哪些。这些实体就是我们要创建的模型，它与我们的Django应用程序处理的数据非常密切。</p>\n<p>为了能够实现上面描述的用例，我们需要至少实现下面几个模型∶ <code>Board</code>， <code>Topic</code>，<code>Post</code>和<code>User</code>。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<ul>\n<li><code>Board</code>∶ 版块</li>\n<li><code>Topic</code>∶主题</li>\n<li><code>Post</code>∶帖子（译注∶ 其实就是主题的回复或评论）</li>\n</ul>\n<p>类与类之间的实线告诉我们，在一个主题<code>（Topic）</code>中，我们需要有一个字段（译注∶其实就是通过外键来关联）来确定它属于哪个版块<code>（Board）</code>。同样，帖子<code>（Post）</code>也需要一个字段来表示它属于哪个主题，这样我们就可以列出在特定主题内创建的帖子。最后，我们需要一个字段来表示主题是谁发起的，帖子是谁发的。用户和版块之间也有联系，谁创建的版块。但是这些信息与应用程序无关。</p>\n<p>现在我们的类图有基本的表现形式，我们还要考虑这些模型将承载哪些信息。这很容易让事情变得复杂，所以试着先把重要的内容列出来，这些内容是我们启动项目需要的信息。后面我们再使用 <code>Django</code> 的迁移<code>（Migrations）</code>功能来改进模型，您将在下一节中详细了解这些内容。但就目前而言，这是模型最基本的内容∶</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<p>这个类图强调的是模型之间的关系，这些线条和箭头最终会在稍后转换为字段。</p>\n<p>对于 <code>Board</code> 模型，我们将从两个字段开始∶ <code>name</code> 和 <code>description</code>。<code>name</code> 字段必须是唯一的，为了避免有重复的名称。 <code>description</code> 用于说明这个版块是做什么用的。</p>\n<p><code>Topic</code> 模型包括四个字段∶<code>subject</code> 表示主题内容，<code>last update</code> 用来定义话题的排序，<code>starter</code> 用来识别谁发起的话题，<code>board</code> 用于指定它属于哪个版块。</p>\n<p><code>Post</code> 模型有一个 <code>message</code> 字段，用于存储回复的内容，<code>created at</code> 在排序时候用 （最先发表的帖子排最前面），<code>updated at</code> 告诉用户是否更新了内容，同时，还需要有对应的 <code>User</code> <code>模型的引用，Post</code> 由谁创建的和谁更新的。</p>\n<p>最后是 <code>User</code> 模型。在类图中，我只提到了字段 <code>username</code>，<code>password</code>， <code>email</code>， <code>is superuser</code> 标志，因为这几乎是我们现在要使用的所有东西。</p>\n<p>需要注意的是，我们不需要创建 <code>User</code> 模型，因为<code>Django</code>已经在<code>contrib</code>包中内置了<code>User</code>模型，我们将直接拿来用。</p>\n<p>关于类图之间的对应关系（数字 1，0.* 等等），这里教你如何阅读∶</p>\n<p>一个 <code>topic</code> 必须与一个（1）<code>Board</code>（这意味着它不能为空）相关联，但是 <code>Board</code> 下面可能与许多个或者0个 <code>topic</code> 关联 （0.*）。这意味着 <code>Board</code> 下面可能没有主题。（译注∶ 一对多关系）</p>\n<p><img src=\"Screenshot_4.webp\"></p>\n<p>一个 <code>Topic</code> 至少有一个 <code>Post</code>（发起话题时，同时会发布一个帖子），并且它也可能有许多 <code>Post</code>（1.*）。一个<code>Post</code>必须与一个并且只有一个<code>Topic（1）</code>相关联。</p>\n<p><img src=\"Screenshot_5.webp\"></p>\n<p>一个 <code>Topic</code>必须有一个且只有一个<code>User</code>相关联，<code>topic</code>的发起者是（1）。而一个用户可能有很多或者没有 <code>topic</code> （0.*）。</p>\n<p><img src=\"Screenshot_6.webp\"></p>\n<p><code>Post</code> 必须有一个并且只有一个与之关联的用户，用户可以有许多或没有 <code>Post</code>（0.*）。<code>Post</code>和<code>User</code>之间的第二个关联是直接关联（参见该行最后的箭头），就是 <code>Post</code> 可以被用户修改（<code>updated_by</code>），<code>updated_by</code>有可能是空（<code>Post</code> 没有被修改）。</p>\n<p>画这个类图的另一种方法是强调字段而不是模型之间的关系∶</p>\n<p><img src=\"Screenshot_7.webp\"></p>\n<p>上面的表示方式与前面的表示方式是对等的，不过这种方式更接近我们将要使用 <code>Django Models API</code> 设计的内容。在这种表示方式中，我们可以更清楚地看到，在 <code>Post</code> 模型中，关联了 <code>Topic</code>，<code>created_by</code>（创建者）和 <code>updated by</code>（更新者）字段。另一个值得注意的事情是，在 <code>Topic</code> 模型中，有一个名为 <code>posts （</code>） 的操作（一个类方法）。我们将通过反向关系来实现这一目标，<code>Django</code> 将自动在数据库中执行查询以返回特定主题的所有帖子列表。</p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"论坛项目\"><a href=\"#论坛项目\" class=\"headerlink\" title=\"论坛项目\"></a>论坛项目</h2><p>在进入模型，视图等其它有趣的部分之前，先让我们花点时间，简要地讨论我们将要开发的这个项目。如果你已经有了Web 开发的经验并且觉得它太繁琐了，那么你可以浏览一下图片以了解我们将要构建的内容，然后直接跳转到本教程的模型部分。</p>\n<h3 id=\"用列图\"><a href=\"#用列图\" class=\"headerlink\" title=\"用列图\"></a>用列图</h3><p>我们的项目是一个论坛系统，整个项目的构思是维护几个论坛版块（boards），每个版块像一个分类一样。在指定的版块里面，用户可以通过创建新主题（Topic）开始讨论，其他用户可以参与讨论回复。我们需要找到一种方法来区分普通用户和管理员用户，因为只有管理员可以创建版块。下图概述了主要的用例和每种类型的用户角色∶</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>从用例图中，我们可以开始思考项目所需的实体类有哪些。这些实体就是我们要创建的模型，它与我们的Django应用程序处理的数据非常密切。</p>\n<h3 id=\"类图\"><a href=\"#类图\" class=\"headerlink\" title=\"类图\"></a>类图</h3><p>从用例图中，我们可以开始思考项目所需的实体类有哪些。这些实体就是我们要创建的模型，它与我们的Django应用程序处理的数据非常密切。</p>\n<p>为了能够实现上面描述的用例，我们需要至少实现下面几个模型∶ <code>Board</code>， <code>Topic</code>，<code>Post</code>和<code>User</code>。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<ul>\n<li><code>Board</code>∶ 版块</li>\n<li><code>Topic</code>∶主题</li>\n<li><code>Post</code>∶帖子（译注∶ 其实就是主题的回复或评论）</li>\n</ul>\n<p>类与类之间的实线告诉我们，在一个主题<code>（Topic）</code>中，我们需要有一个字段（译注∶其实就是通过外键来关联）来确定它属于哪个版块<code>（Board）</code>。同样，帖子<code>（Post）</code>也需要一个字段来表示它属于哪个主题，这样我们就可以列出在特定主题内创建的帖子。最后，我们需要一个字段来表示主题是谁发起的，帖子是谁发的。用户和版块之间也有联系，谁创建的版块。但是这些信息与应用程序无关。</p>\n<p>现在我们的类图有基本的表现形式，我们还要考虑这些模型将承载哪些信息。这很容易让事情变得复杂，所以试着先把重要的内容列出来，这些内容是我们启动项目需要的信息。后面我们再使用 <code>Django</code> 的迁移<code>（Migrations）</code>功能来改进模型，您将在下一节中详细了解这些内容。但就目前而言，这是模型最基本的内容∶</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<p>这个类图强调的是模型之间的关系，这些线条和箭头最终会在稍后转换为字段。</p>\n<p>对于 <code>Board</code> 模型，我们将从两个字段开始∶ <code>name</code> 和 <code>description</code>。<code>name</code> 字段必须是唯一的，为了避免有重复的名称。 <code>description</code> 用于说明这个版块是做什么用的。</p>\n<p><code>Topic</code> 模型包括四个字段∶<code>subject</code> 表示主题内容，<code>last update</code> 用来定义话题的排序，<code>starter</code> 用来识别谁发起的话题，<code>board</code> 用于指定它属于哪个版块。</p>\n<p><code>Post</code> 模型有一个 <code>message</code> 字段，用于存储回复的内容，<code>created at</code> 在排序时候用 （最先发表的帖子排最前面），<code>updated at</code> 告诉用户是否更新了内容，同时，还需要有对应的 <code>User</code> <code>模型的引用，Post</code> 由谁创建的和谁更新的。</p>\n<p>最后是 <code>User</code> 模型。在类图中，我只提到了字段 <code>username</code>，<code>password</code>， <code>email</code>， <code>is superuser</code> 标志，因为这几乎是我们现在要使用的所有东西。</p>\n<p>需要注意的是，我们不需要创建 <code>User</code> 模型，因为<code>Django</code>已经在<code>contrib</code>包中内置了<code>User</code>模型，我们将直接拿来用。</p>\n<p>关于类图之间的对应关系（数字 1，0.* 等等），这里教你如何阅读∶</p>\n<p>一个 <code>topic</code> 必须与一个（1）<code>Board</code>（这意味着它不能为空）相关联，但是 <code>Board</code> 下面可能与许多个或者0个 <code>topic</code> 关联 （0.*）。这意味着 <code>Board</code> 下面可能没有主题。（译注∶ 一对多关系）</p>\n<p><img src=\"Screenshot_4.webp\"></p>\n<p>一个 <code>Topic</code> 至少有一个 <code>Post</code>（发起话题时，同时会发布一个帖子），并且它也可能有许多 <code>Post</code>（1.*）。一个<code>Post</code>必须与一个并且只有一个<code>Topic（1）</code>相关联。</p>\n<p><img src=\"Screenshot_5.webp\"></p>\n<p>一个 <code>Topic</code>必须有一个且只有一个<code>User</code>相关联，<code>topic</code>的发起者是（1）。而一个用户可能有很多或者没有 <code>topic</code> （0.*）。</p>\n<p><img src=\"Screenshot_6.webp\"></p>\n<p><code>Post</code> 必须有一个并且只有一个与之关联的用户，用户可以有许多或没有 <code>Post</code>（0.*）。<code>Post</code>和<code>User</code>之间的第二个关联是直接关联（参见该行最后的箭头），就是 <code>Post</code> 可以被用户修改（<code>updated_by</code>），<code>updated_by</code>有可能是空（<code>Post</code> 没有被修改）。</p>\n<p>画这个类图的另一种方法是强调字段而不是模型之间的关系∶</p>\n<p><img src=\"Screenshot_7.webp\"></p>\n<p>上面的表示方式与前面的表示方式是对等的，不过这种方式更接近我们将要使用 <code>Django Models API</code> 设计的内容。在这种表示方式中，我们可以更清楚地看到，在 <code>Post</code> 模型中，关联了 <code>Topic</code>，<code>created_by</code>（创建者）和 <code>updated by</code>（更新者）字段。另一个值得注意的事情是，在 <code>Topic</code> 模型中，有一个名为 <code>posts （</code>） 的操作（一个类方法）。我们将通过反向关系来实现这一目标，<code>Django</code> 将自动在数据库中执行查询以返回特定主题的所有帖子列表。</p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n"},{"title":"Django入门-视图函数","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-11T05:45:32.000Z","pic":"Screenshot_8.webp","_content":"\n## 第一个视图函数\n\n第一个视图函数目前我们已经有一个视图函数叫 `home` ，这个视图在我们的应用程序主页上显示为`\"Hello， World!\"` 。\n\n**boards/views.py**\n```python\nfrom django.http import HttpResponse\n\ndef home(request):\n    return HttpResponse('hello World')\n```\n\n首先要做的是导入Board模型并列出所有的板块。\n\n**boards/views.py**\n```python\nfrom django.http import HttpResponse\nfrom .models import Board\n\ndef home(request):\n    boards = Board.objects.all()\n    boards_names = list()\n\n    for board in boards:\n        boards_names.append(board.name)\n    \n    response_html = '<br>'.join(boards_names)\n    return HttpResponse(response_html)\n```\n\n访问[http://127.0.0.1:8000/](http://127.0.0.1:8000/)如下：\n\n![](Screenshot_1.webp)\n\n当然，真正的项目里面不会这样去渲染HTML，渲染的部分会交给`Django模板引擎`来实现。\n\n## 模板引擎\n\n在`manage.py`所在的目录创建一个名为`templates`的新文件夹：\n\n在`templates`文件夹中，创建一个名为`home.html`的`HTML`文件。\n\n**templates/home.html**\n```html\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"UTF-8\">\n        <title>Boards</title>\n    </head>\n    <body>\n        <h1>Boards</h1>\n\n        {% for board in boards %}\n            {{board.name}} <br>\n        {% endfor %}\n    </body>\n</html>\n```\n\n上面的例子中，混入了原始的`HTML`和一些特殊的标签`{% for ... in ... %}`和`{{variable}}`。它们是Django模板语法的一部分。上面的列子展示了如何使用`for`遍历列表对象。`{{board.name}}`会在HTMl模板中会被渲染成板块的名称，最后生成动态HTML文档。\n\n在我们可以使用这个HTML页面之前，我们必须告诉Django在哪里可以找到我们应用程序的模板。\n\n打开`myproject目录`下面的`settings.py`文件，搜索 `TEMPLATES` 变量，并设置 `DIRS` 的值为 `os.path.join（BASE_DIR，'templates'）`∶\n\n本质上，刚添加的这一行所做的事情就是找到项目的完整路径并在后面附加`\"templates\"`。\n\n我们可以使用`Python shell`进行调试∶\n\n```python\nTEMPLATES = [\n    {\n        'BACKEND': 'django.template.backends.django.DjangoTemplates',\n        'DIRS': [os.path.join(BASE_DIR, 'templates')],\n        'APP_DIRS': True,\n        'OPTIONS': {\n            'context_processors': [\n                'django.template.context_processors.debug',\n                'django.template.context_processors.request',\n                'django.contrib.auth.context_processors.auth',\n                'django.contrib.messages.context_processors.messages',\n            ],\n        },\n    },\n]\n```\n\n打开`python shell`进行调试。\n\n```python\npython manage.py shell\n>>> from django.conf import settings\n>>> settings.BASE_DIR \nWindowsPath('C:/Users/espho/PycharmProjects/PythonProjs/django/myproject/myproject')\n>>> import os\n>>> os.path.join(settings.BASE_DIR, 'templates') \n'C:\\\\Users\\\\espho\\\\PycharmProjects\\\\PythonProjs\\\\django\\\\myproject\\\\myproject\\\\templates'\n```\n\n可以看到，它只是指向了我们在前面步骤中创建的`templates`文件夹。\n\n现在我们可以更新视图：\n\n**boards/views.py**\n```python\nfrom django.shortcuts import render\nfrom .models import Board\n\ndef home(request):\n    boards = Board.objects.all()\n    return render(request, 'home.html', {'boards': boards})\n```\n\n重新运行，访问[http://127.0.0.1:8000/](http://127.0.0.1:8000/)。\n\n![](Screenshot_2.webp)\n\n\n可以修改HTML文件，使其更加美观。\n\n**templates/home.html**\n```html\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"UTF-8\">\n        <title>Boards</title>\n    </head>\n    <body>\n        <h1>Boards</h1>\n\n        <table border=\"1\">\n            <thead>\n                <tr>\n                    <th>Board</th>\n                    <th>Posts</th>\n                    <th>Topics</th>\n                    <th>Last Post</th>\n                </tr>\n            </thead>\n            <tbody>\n                {% for board in boards %}\n                    <tr>\n                        <td>\n                            {{board.name}} <br>\n                            <small style=\"color: #888;\">{{board.description}}</small>\n                        </td>\n                        <td>0</td>\n                        <td>0</td>\n                        <td></td>\n                    </tr>\n            {% endfor %}\n            </tbody>\n        </table>\n    </body>\n</html>\n```\n\n不用重启，刷新页面：\n\n![](Screenshot_3.webp)\n\n\n\n\n\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","source":"_posts/Django入门-视图函数.md","raw":"---\ntitle: Django入门-视图函数\ntags:\n  - django\ncomments: true\ntoc: true\nonly: \n  - home\n  - category\n  - tag\ndate: 2021-06-11 13:45:32\ncategories: Django\npic: Screenshot_8.webp\n---\n\n## 第一个视图函数\n\n第一个视图函数目前我们已经有一个视图函数叫 `home` ，这个视图在我们的应用程序主页上显示为`\"Hello， World!\"` 。\n\n**boards/views.py**\n```python\nfrom django.http import HttpResponse\n\ndef home(request):\n    return HttpResponse('hello World')\n```\n\n首先要做的是导入Board模型并列出所有的板块。\n\n**boards/views.py**\n```python\nfrom django.http import HttpResponse\nfrom .models import Board\n\ndef home(request):\n    boards = Board.objects.all()\n    boards_names = list()\n\n    for board in boards:\n        boards_names.append(board.name)\n    \n    response_html = '<br>'.join(boards_names)\n    return HttpResponse(response_html)\n```\n\n访问[http://127.0.0.1:8000/](http://127.0.0.1:8000/)如下：\n\n![](Screenshot_1.webp)\n\n当然，真正的项目里面不会这样去渲染HTML，渲染的部分会交给`Django模板引擎`来实现。\n\n## 模板引擎\n\n在`manage.py`所在的目录创建一个名为`templates`的新文件夹：\n\n在`templates`文件夹中，创建一个名为`home.html`的`HTML`文件。\n\n**templates/home.html**\n```html\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"UTF-8\">\n        <title>Boards</title>\n    </head>\n    <body>\n        <h1>Boards</h1>\n\n        {% for board in boards %}\n            {{board.name}} <br>\n        {% endfor %}\n    </body>\n</html>\n```\n\n上面的例子中，混入了原始的`HTML`和一些特殊的标签`{% for ... in ... %}`和`{{variable}}`。它们是Django模板语法的一部分。上面的列子展示了如何使用`for`遍历列表对象。`{{board.name}}`会在HTMl模板中会被渲染成板块的名称，最后生成动态HTML文档。\n\n在我们可以使用这个HTML页面之前，我们必须告诉Django在哪里可以找到我们应用程序的模板。\n\n打开`myproject目录`下面的`settings.py`文件，搜索 `TEMPLATES` 变量，并设置 `DIRS` 的值为 `os.path.join（BASE_DIR，'templates'）`∶\n\n本质上，刚添加的这一行所做的事情就是找到项目的完整路径并在后面附加`\"templates\"`。\n\n我们可以使用`Python shell`进行调试∶\n\n```python\nTEMPLATES = [\n    {\n        'BACKEND': 'django.template.backends.django.DjangoTemplates',\n        'DIRS': [os.path.join(BASE_DIR, 'templates')],\n        'APP_DIRS': True,\n        'OPTIONS': {\n            'context_processors': [\n                'django.template.context_processors.debug',\n                'django.template.context_processors.request',\n                'django.contrib.auth.context_processors.auth',\n                'django.contrib.messages.context_processors.messages',\n            ],\n        },\n    },\n]\n```\n\n打开`python shell`进行调试。\n\n```python\npython manage.py shell\n>>> from django.conf import settings\n>>> settings.BASE_DIR \nWindowsPath('C:/Users/espho/PycharmProjects/PythonProjs/django/myproject/myproject')\n>>> import os\n>>> os.path.join(settings.BASE_DIR, 'templates') \n'C:\\\\Users\\\\espho\\\\PycharmProjects\\\\PythonProjs\\\\django\\\\myproject\\\\myproject\\\\templates'\n```\n\n可以看到，它只是指向了我们在前面步骤中创建的`templates`文件夹。\n\n现在我们可以更新视图：\n\n**boards/views.py**\n```python\nfrom django.shortcuts import render\nfrom .models import Board\n\ndef home(request):\n    boards = Board.objects.all()\n    return render(request, 'home.html', {'boards': boards})\n```\n\n重新运行，访问[http://127.0.0.1:8000/](http://127.0.0.1:8000/)。\n\n![](Screenshot_2.webp)\n\n\n可以修改HTML文件，使其更加美观。\n\n**templates/home.html**\n```html\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"UTF-8\">\n        <title>Boards</title>\n    </head>\n    <body>\n        <h1>Boards</h1>\n\n        <table border=\"1\">\n            <thead>\n                <tr>\n                    <th>Board</th>\n                    <th>Posts</th>\n                    <th>Topics</th>\n                    <th>Last Post</th>\n                </tr>\n            </thead>\n            <tbody>\n                {% for board in boards %}\n                    <tr>\n                        <td>\n                            {{board.name}} <br>\n                            <small style=\"color: #888;\">{{board.description}}</small>\n                        </td>\n                        <td>0</td>\n                        <td>0</td>\n                        <td></td>\n                    </tr>\n            {% endfor %}\n            </tbody>\n        </table>\n    </body>\n</html>\n```\n\n不用重启，刷新页面：\n\n![](Screenshot_3.webp)\n\n\n\n\n\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","slug":"Django入门-视图函数","published":1,"updated":"2021-06-15T15:47:31.593Z","layout":"post","photos":[],"link":"","_id":"ckq14rx1z000f44ud0sl942m4","content":"<h2 id=\"第一个视图函数\"><a href=\"#第一个视图函数\" class=\"headerlink\" title=\"第一个视图函数\"></a>第一个视图函数</h2><p>第一个视图函数目前我们已经有一个视图函数叫 <code>home</code> ，这个视图在我们的应用程序主页上显示为<code>&quot;Hello， World!&quot;</code> 。</p>\n<p><strong>boards/views.py</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.http <span class=\"keyword\">import</span> HttpResponse</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">home</span>(<span class=\"params\">request</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> HttpResponse(<span class=\"string\">&#x27;hello World&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>首先要做的是导入Board模型并列出所有的板块。</p>\n<p><strong>boards/views.py</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.http <span class=\"keyword\">import</span> HttpResponse</span><br><span class=\"line\"><span class=\"keyword\">from</span> .models <span class=\"keyword\">import</span> Board</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">home</span>(<span class=\"params\">request</span>):</span></span><br><span class=\"line\">    boards = Board.objects.<span class=\"built_in\">all</span>()</span><br><span class=\"line\">    boards_names = <span class=\"built_in\">list</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> board <span class=\"keyword\">in</span> boards:</span><br><span class=\"line\">        boards_names.append(board.name)</span><br><span class=\"line\">    </span><br><span class=\"line\">    response_html = <span class=\"string\">&#x27;&lt;br&gt;&#x27;</span>.join(boards_names)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> HttpResponse(response_html)</span><br></pre></td></tr></table></figure>\n\n<p>访问<a href=\"http://127.0.0.1:8000/\">http://127.0.0.1:8000/</a>如下：</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>当然，真正的项目里面不会这样去渲染HTML，渲染的部分会交给<code>Django模板引擎</code>来实现。</p>\n<h2 id=\"模板引擎\"><a href=\"#模板引擎\" class=\"headerlink\" title=\"模板引擎\"></a>模板引擎</h2><p>在<code>manage.py</code>所在的目录创建一个名为<code>templates</code>的新文件夹：</p>\n<p>在<code>templates</code>文件夹中，创建一个名为<code>home.html</code>的<code>HTML</code>文件。</p>\n<p><strong>templates/home.html</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        &#123;% for board in boards %&#125;</span><br><span class=\"line\">            &#123;&#123;board.name&#125;&#125; <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">        &#123;% endfor %&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>上面的例子中，混入了原始的<code>HTML</code>和一些特殊的标签<code>&#123;% for ... in ... %&#125;</code>和<code>&#123;&#123;variable&#125;&#125;</code>。它们是Django模板语法的一部分。上面的列子展示了如何使用<code>for</code>遍历列表对象。<code>&#123;&#123;board.name&#125;&#125;</code>会在HTMl模板中会被渲染成板块的名称，最后生成动态HTML文档。</p>\n<p>在我们可以使用这个HTML页面之前，我们必须告诉Django在哪里可以找到我们应用程序的模板。</p>\n<p>打开<code>myproject目录</code>下面的<code>settings.py</code>文件，搜索 <code>TEMPLATES</code> 变量，并设置 <code>DIRS</code> 的值为 <code>os.path.join（BASE_DIR，&#39;templates&#39;）</code>∶</p>\n<p>本质上，刚添加的这一行所做的事情就是找到项目的完整路径并在后面附加<code>&quot;templates&quot;</code>。</p>\n<p>我们可以使用<code>Python shell</code>进行调试∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TEMPLATES = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;BACKEND&#x27;</span>: <span class=\"string\">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class=\"string\">&#x27;templates&#x27;</span>)],</span><br><span class=\"line\">        <span class=\"string\">&#x27;APP_DIRS&#x27;</span>: <span class=\"literal\">True</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;context_processors&#x27;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&#x27;django.template.context_processors.debug&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;django.template.context_processors.request&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,</span><br><span class=\"line\">            ],</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>打开<code>python shell</code>进行调试。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py shell</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">from</span> django.conf <span class=\"keyword\">import</span> settings</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>settings.BASE_DIR </span><br><span class=\"line\">WindowsPath(<span class=\"string\">&#x27;C:/Users/espho/PycharmProjects/PythonProjs/django/myproject/myproject&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>os.path.join(settings.BASE_DIR, <span class=\"string\">&#x27;templates&#x27;</span>) </span><br><span class=\"line\"><span class=\"string\">&#x27;C:\\\\Users\\\\espho\\\\PycharmProjects\\\\PythonProjs\\\\django\\\\myproject\\\\myproject\\\\templates&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>可以看到，它只是指向了我们在前面步骤中创建的<code>templates</code>文件夹。</p>\n<p>现在我们可以更新视图：</p>\n<p><strong>boards/views.py</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.shortcuts <span class=\"keyword\">import</span> render</span><br><span class=\"line\"><span class=\"keyword\">from</span> .models <span class=\"keyword\">import</span> Board</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">home</span>(<span class=\"params\">request</span>):</span></span><br><span class=\"line\">    boards = Board.objects.<span class=\"built_in\">all</span>()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> render(request, <span class=\"string\">&#x27;home.html&#x27;</span>, &#123;<span class=\"string\">&#x27;boards&#x27;</span>: boards&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>重新运行，访问<a href=\"http://127.0.0.1:8000/\">http://127.0.0.1:8000/</a>。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>可以修改HTML文件，使其更加美观。</p>\n<p><strong>templates/home.html</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span> <span class=\"attr\">border</span>=<span class=\"string\">&quot;1&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Board<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Posts<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Topics<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Last Post<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">                &#123;% for board in boards %&#125;</span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                            &#123;&#123;board.name&#125;&#125; <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">small</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: #888;&quot;</span>&gt;</span>&#123;&#123;board.description&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">small</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            &#123;% endfor %&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>不用重启，刷新页面：</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"第一个视图函数\"><a href=\"#第一个视图函数\" class=\"headerlink\" title=\"第一个视图函数\"></a>第一个视图函数</h2><p>第一个视图函数目前我们已经有一个视图函数叫 <code>home</code> ，这个视图在我们的应用程序主页上显示为<code>&quot;Hello， World!&quot;</code> 。</p>\n<p><strong>boards/views.py</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.http <span class=\"keyword\">import</span> HttpResponse</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">home</span>(<span class=\"params\">request</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> HttpResponse(<span class=\"string\">&#x27;hello World&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>首先要做的是导入Board模型并列出所有的板块。</p>\n<p><strong>boards/views.py</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.http <span class=\"keyword\">import</span> HttpResponse</span><br><span class=\"line\"><span class=\"keyword\">from</span> .models <span class=\"keyword\">import</span> Board</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">home</span>(<span class=\"params\">request</span>):</span></span><br><span class=\"line\">    boards = Board.objects.<span class=\"built_in\">all</span>()</span><br><span class=\"line\">    boards_names = <span class=\"built_in\">list</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> board <span class=\"keyword\">in</span> boards:</span><br><span class=\"line\">        boards_names.append(board.name)</span><br><span class=\"line\">    </span><br><span class=\"line\">    response_html = <span class=\"string\">&#x27;&lt;br&gt;&#x27;</span>.join(boards_names)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> HttpResponse(response_html)</span><br></pre></td></tr></table></figure>\n\n<p>访问<a href=\"http://127.0.0.1:8000/\">http://127.0.0.1:8000/</a>如下：</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>当然，真正的项目里面不会这样去渲染HTML，渲染的部分会交给<code>Django模板引擎</code>来实现。</p>\n<h2 id=\"模板引擎\"><a href=\"#模板引擎\" class=\"headerlink\" title=\"模板引擎\"></a>模板引擎</h2><p>在<code>manage.py</code>所在的目录创建一个名为<code>templates</code>的新文件夹：</p>\n<p>在<code>templates</code>文件夹中，创建一个名为<code>home.html</code>的<code>HTML</code>文件。</p>\n<p><strong>templates/home.html</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        &#123;% for board in boards %&#125;</span><br><span class=\"line\">            &#123;&#123;board.name&#125;&#125; <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">        &#123;% endfor %&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>上面的例子中，混入了原始的<code>HTML</code>和一些特殊的标签<code>&#123;% for ... in ... %&#125;</code>和<code>&#123;&#123;variable&#125;&#125;</code>。它们是Django模板语法的一部分。上面的列子展示了如何使用<code>for</code>遍历列表对象。<code>&#123;&#123;board.name&#125;&#125;</code>会在HTMl模板中会被渲染成板块的名称，最后生成动态HTML文档。</p>\n<p>在我们可以使用这个HTML页面之前，我们必须告诉Django在哪里可以找到我们应用程序的模板。</p>\n<p>打开<code>myproject目录</code>下面的<code>settings.py</code>文件，搜索 <code>TEMPLATES</code> 变量，并设置 <code>DIRS</code> 的值为 <code>os.path.join（BASE_DIR，&#39;templates&#39;）</code>∶</p>\n<p>本质上，刚添加的这一行所做的事情就是找到项目的完整路径并在后面附加<code>&quot;templates&quot;</code>。</p>\n<p>我们可以使用<code>Python shell</code>进行调试∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TEMPLATES = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;BACKEND&#x27;</span>: <span class=\"string\">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class=\"string\">&#x27;templates&#x27;</span>)],</span><br><span class=\"line\">        <span class=\"string\">&#x27;APP_DIRS&#x27;</span>: <span class=\"literal\">True</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;context_processors&#x27;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&#x27;django.template.context_processors.debug&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;django.template.context_processors.request&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,</span><br><span class=\"line\">            ],</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>打开<code>python shell</code>进行调试。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py shell</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">from</span> django.conf <span class=\"keyword\">import</span> settings</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>settings.BASE_DIR </span><br><span class=\"line\">WindowsPath(<span class=\"string\">&#x27;C:/Users/espho/PycharmProjects/PythonProjs/django/myproject/myproject&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>os.path.join(settings.BASE_DIR, <span class=\"string\">&#x27;templates&#x27;</span>) </span><br><span class=\"line\"><span class=\"string\">&#x27;C:\\\\Users\\\\espho\\\\PycharmProjects\\\\PythonProjs\\\\django\\\\myproject\\\\myproject\\\\templates&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>可以看到，它只是指向了我们在前面步骤中创建的<code>templates</code>文件夹。</p>\n<p>现在我们可以更新视图：</p>\n<p><strong>boards/views.py</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.shortcuts <span class=\"keyword\">import</span> render</span><br><span class=\"line\"><span class=\"keyword\">from</span> .models <span class=\"keyword\">import</span> Board</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">home</span>(<span class=\"params\">request</span>):</span></span><br><span class=\"line\">    boards = Board.objects.<span class=\"built_in\">all</span>()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> render(request, <span class=\"string\">&#x27;home.html&#x27;</span>, &#123;<span class=\"string\">&#x27;boards&#x27;</span>: boards&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>重新运行，访问<a href=\"http://127.0.0.1:8000/\">http://127.0.0.1:8000/</a>。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>可以修改HTML文件，使其更加美观。</p>\n<p><strong>templates/home.html</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span> <span class=\"attr\">border</span>=<span class=\"string\">&quot;1&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Board<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Posts<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Topics<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Last Post<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">                &#123;% for board in boards %&#125;</span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                            &#123;&#123;board.name&#125;&#125; <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">small</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: #888;&quot;</span>&gt;</span>&#123;&#123;board.description&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">small</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            &#123;% endfor %&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>不用重启，刷新页面：</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n"},{"title":"Django入门-静态文件设置","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-15T16:01:36.000Z","pic":"Screenshot_8.webp","_content":"\n静态文件设置静态文件是指 `CSS`，`JavaScript`，`字体`，`图片`或者是用`来组成用户界面的任何其他资源`。\n\n\n`Django` 本身是不负责处理这些文件的，但是为了让我们的开发过程更轻松，`Django` 提供了一些功能来帮助我们管理静态文件。这些功能可在 `INSTALLED_APPS` 的` django.contrib.staticfiles` 应用程序中找到。实际上，`Django`为了使得开发方便，也可以处理静态文件，而在生产环境下，静态文件一般直接由 `Nginx` 等反向代理服务器处理，而应用工服务器专心负责处理它擅长的业务逻辑。\n\n市面上很多优秀前端组件框架，我们没有理由继续用简陋的HTML文档来渲染。我们可以轻松地将`Bootstrap 4`添加到我们的项目中。`Bootstrap`是—个用`HTML`，`CSS`和`JavaScript`开发的前端开源工具包。\n\n在项目根目录中，除了 `boards`， `templates` 和`myproject`文件夹外，再创建一个名为`static`的新文件夹，并在`static`文件夹内创建另一个名为`css`的文件夹∶\n\n转到[getbootstrap.com](getbootstrap.com)并下载最新版本：\n\n![](1.png)\n\n下载编译版本的`CSS`和`JS`\n\n在你的计算机中，解压 `bootstrap-5.0.1-dist` 文件，将文件 `css/bootstrap.min.css `复制到我们项目的`css`文件夹中∶\n\n\n下一步是告诉`Django`在哪里可以找到静态文件。打开`settings.py`，拉到文件的底部，在`STATIC_URL`后面添加以下内容∶\n\n```python\nSTATIC_URL = '/static/'\n\nSTATICFILES_DIRS = [\n    os.path.join(BASE_DIR, \"static\"),\n]\n```\n\n还记得 `TEMPLATES`目录吗，和这个配置是一样的，现在我们必须在模板中加载静态文件（`Bootstrap CSS`文件）。\n\n\n**templates/home.html**\n```html\n{% load static %}\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"UTF-8\">\n        <title>Boards</title>\n        <link rel=\"stylesheet\" href=\"{% static 'css/bootstrap.min.css' %}\">\n    </head>\n    <body>\n        <h1>Boards</h1>\n\n        <table border=\"1\">\n            <thead>\n                <tr>\n                    <th>Board</th>\n                    <th>Posts</th>\n                    <th>Topics</th>\n                    <th>Last Post</th>\n                </tr>\n            </thead>\n            <tbody>\n                {% for board in boards %}\n                    <tr>\n                        <td>\n                            {{board.name}} <br>\n                            <small style=\"color: #888;\">{{board.description}}</small>\n                        </td>\n                        <td>0</td>\n                        <td>0</td>\n                        <td></td>\n                    </tr>\n            {% endfor %}\n            </tbody>\n        </table>\n    </body>\n</html>\n```\n\n首先，我们在模板的开头使用了 `Static Files App` 模板标签 `{% load static%}`。\n\n模板标签 `{% static %}` 用于构成资源文件完整URL。在这种情况下， `{% static 'css/bootstrap.min.css' %}` 将返回`/static/css/bootstrap.min.css`，它相当于 `http://127.0.0.1:8000/static/css/bootstrap.min.css`。\n\n`{% static %}`模板标签使用 `settings.py` 文件中的 `STATIC_uRL` 配置来组成最终的URL，例如，如果您将静态文件托管在像`https∶//static.example.com/`这样的子域中，那么我们将设置 `STATIC_URL=https∶//static.example.com/` ，然后 `{% static'css/bootstrap.min.css' %}` 返回的是`https://static.example.com/css/bootstrap.min.css`。记得但凡是需要引用`CSS`， `JavaScript`或图片文件的地方就使用 `{% static %}`稍后，当我们开始部署项目到正式环境时，我们将讨论更多。现在都设置好了。\n\n刷新页面 `http∶//127.0.0.1∶8000`，我们可以看到它可以正常运行∶\n\n现在我们可以编辑模板，以利用`Bootstrap CSS`∶\n\n```html\n{% load static %}\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"UTF-8\">\n        <title>Boards</title>\n        <link rel=\"stylesheet\" href=\"{% static 'css/bootstrap.min.css' %}\">\n    </head>\n    <body>\n        <div class=\"container\">\n            <ol class=\"breadcrumb my-4\">\n                <li class=\"breadcrumb-item active\">Boards</li>\n            </ol>\n\n\n            <table class=\"table\">\n                <thead class=\"thead-inverse\">\n                    <tr>\n                        <th>Board</th>\n                        <th>Posts</th>\n                        <th>Topics</th>\n                        <th>Last Post</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {% for board in boards %}\n                        <tr>\n                            <td>\n                                {{board.name}} <br>\n                                <small style=\"color: #888;\">{{board.description}}</small>\n                            </td>\n                            <td>0</td>\n                            <td>0</td>\n                            <td></td>\n                        </tr>\n                {% endfor %}\n                </tbody>\n            </table>\n            </div>\n    </body>\n</html>\n```\n\n显示效果：\n\n![](2.png)\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","source":"_posts/Django入门-静态文件设置.md","raw":"---\ntitle: Django入门-静态文件设置\ntags:\n  - django\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-16 00:01:36\ncategories: Django\npic: Screenshot_8.webp\n---\n\n静态文件设置静态文件是指 `CSS`，`JavaScript`，`字体`，`图片`或者是用`来组成用户界面的任何其他资源`。\n\n\n`Django` 本身是不负责处理这些文件的，但是为了让我们的开发过程更轻松，`Django` 提供了一些功能来帮助我们管理静态文件。这些功能可在 `INSTALLED_APPS` 的` django.contrib.staticfiles` 应用程序中找到。实际上，`Django`为了使得开发方便，也可以处理静态文件，而在生产环境下，静态文件一般直接由 `Nginx` 等反向代理服务器处理，而应用工服务器专心负责处理它擅长的业务逻辑。\n\n市面上很多优秀前端组件框架，我们没有理由继续用简陋的HTML文档来渲染。我们可以轻松地将`Bootstrap 4`添加到我们的项目中。`Bootstrap`是—个用`HTML`，`CSS`和`JavaScript`开发的前端开源工具包。\n\n在项目根目录中，除了 `boards`， `templates` 和`myproject`文件夹外，再创建一个名为`static`的新文件夹，并在`static`文件夹内创建另一个名为`css`的文件夹∶\n\n转到[getbootstrap.com](getbootstrap.com)并下载最新版本：\n\n![](1.png)\n\n下载编译版本的`CSS`和`JS`\n\n在你的计算机中，解压 `bootstrap-5.0.1-dist` 文件，将文件 `css/bootstrap.min.css `复制到我们项目的`css`文件夹中∶\n\n\n下一步是告诉`Django`在哪里可以找到静态文件。打开`settings.py`，拉到文件的底部，在`STATIC_URL`后面添加以下内容∶\n\n```python\nSTATIC_URL = '/static/'\n\nSTATICFILES_DIRS = [\n    os.path.join(BASE_DIR, \"static\"),\n]\n```\n\n还记得 `TEMPLATES`目录吗，和这个配置是一样的，现在我们必须在模板中加载静态文件（`Bootstrap CSS`文件）。\n\n\n**templates/home.html**\n```html\n{% load static %}\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"UTF-8\">\n        <title>Boards</title>\n        <link rel=\"stylesheet\" href=\"{% static 'css/bootstrap.min.css' %}\">\n    </head>\n    <body>\n        <h1>Boards</h1>\n\n        <table border=\"1\">\n            <thead>\n                <tr>\n                    <th>Board</th>\n                    <th>Posts</th>\n                    <th>Topics</th>\n                    <th>Last Post</th>\n                </tr>\n            </thead>\n            <tbody>\n                {% for board in boards %}\n                    <tr>\n                        <td>\n                            {{board.name}} <br>\n                            <small style=\"color: #888;\">{{board.description}}</small>\n                        </td>\n                        <td>0</td>\n                        <td>0</td>\n                        <td></td>\n                    </tr>\n            {% endfor %}\n            </tbody>\n        </table>\n    </body>\n</html>\n```\n\n首先，我们在模板的开头使用了 `Static Files App` 模板标签 `{% load static%}`。\n\n模板标签 `{% static %}` 用于构成资源文件完整URL。在这种情况下， `{% static 'css/bootstrap.min.css' %}` 将返回`/static/css/bootstrap.min.css`，它相当于 `http://127.0.0.1:8000/static/css/bootstrap.min.css`。\n\n`{% static %}`模板标签使用 `settings.py` 文件中的 `STATIC_uRL` 配置来组成最终的URL，例如，如果您将静态文件托管在像`https∶//static.example.com/`这样的子域中，那么我们将设置 `STATIC_URL=https∶//static.example.com/` ，然后 `{% static'css/bootstrap.min.css' %}` 返回的是`https://static.example.com/css/bootstrap.min.css`。记得但凡是需要引用`CSS`， `JavaScript`或图片文件的地方就使用 `{% static %}`稍后，当我们开始部署项目到正式环境时，我们将讨论更多。现在都设置好了。\n\n刷新页面 `http∶//127.0.0.1∶8000`，我们可以看到它可以正常运行∶\n\n现在我们可以编辑模板，以利用`Bootstrap CSS`∶\n\n```html\n{% load static %}\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"UTF-8\">\n        <title>Boards</title>\n        <link rel=\"stylesheet\" href=\"{% static 'css/bootstrap.min.css' %}\">\n    </head>\n    <body>\n        <div class=\"container\">\n            <ol class=\"breadcrumb my-4\">\n                <li class=\"breadcrumb-item active\">Boards</li>\n            </ol>\n\n\n            <table class=\"table\">\n                <thead class=\"thead-inverse\">\n                    <tr>\n                        <th>Board</th>\n                        <th>Posts</th>\n                        <th>Topics</th>\n                        <th>Last Post</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {% for board in boards %}\n                        <tr>\n                            <td>\n                                {{board.name}} <br>\n                                <small style=\"color: #888;\">{{board.description}}</small>\n                            </td>\n                            <td>0</td>\n                            <td>0</td>\n                            <td></td>\n                        </tr>\n                {% endfor %}\n                </tbody>\n            </table>\n            </div>\n    </body>\n</html>\n```\n\n显示效果：\n\n![](2.png)\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","slug":"Django入门-静态文件设置","published":1,"updated":"2021-06-16T09:29:51.799Z","layout":"post","photos":[],"link":"","_id":"ckq14rx1z000h44ud0j9o1lug","content":"<p>静态文件设置静态文件是指 <code>CSS</code>，<code>JavaScript</code>，<code>字体</code>，<code>图片</code>或者是用<code>来组成用户界面的任何其他资源</code>。</p>\n<p><code>Django</code> 本身是不负责处理这些文件的，但是为了让我们的开发过程更轻松，<code>Django</code> 提供了一些功能来帮助我们管理静态文件。这些功能可在 <code>INSTALLED_APPS</code> 的<code> django.contrib.staticfiles</code> 应用程序中找到。实际上，<code>Django</code>为了使得开发方便，也可以处理静态文件，而在生产环境下，静态文件一般直接由 <code>Nginx</code> 等反向代理服务器处理，而应用工服务器专心负责处理它擅长的业务逻辑。</p>\n<p>市面上很多优秀前端组件框架，我们没有理由继续用简陋的HTML文档来渲染。我们可以轻松地将<code>Bootstrap 4</code>添加到我们的项目中。<code>Bootstrap</code>是—个用<code>HTML</code>，<code>CSS</code>和<code>JavaScript</code>开发的前端开源工具包。</p>\n<p>在项目根目录中，除了 <code>boards</code>， <code>templates</code> 和<code>myproject</code>文件夹外，再创建一个名为<code>static</code>的新文件夹，并在<code>static</code>文件夹内创建另一个名为<code>css</code>的文件夹∶</p>\n<p>转到<a href=\"getbootstrap.com\">getbootstrap.com</a>并下载最新版本：</p>\n<p><img src=\"1.png\"></p>\n<p>下载编译版本的<code>CSS</code>和<code>JS</code></p>\n<p>在你的计算机中，解压 <code>bootstrap-5.0.1-dist</code> 文件，将文件 <code>css/bootstrap.min.css </code>复制到我们项目的<code>css</code>文件夹中∶</p>\n<p>下一步是告诉<code>Django</code>在哪里可以找到静态文件。打开<code>settings.py</code>，拉到文件的底部，在<code>STATIC_URL</code>后面添加以下内容∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">STATIC_URL = <span class=\"string\">&#x27;/static/&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">STATICFILES_DIRS = [</span><br><span class=\"line\">    os.path.join(BASE_DIR, <span class=\"string\">&quot;static&quot;</span>),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>还记得 <code>TEMPLATES</code>目录吗，和这个配置是一样的，现在我们必须在模板中加载静态文件（<code>Bootstrap CSS</code>文件）。</p>\n<p><strong>templates/home.html</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% load static %&#125;</span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;% static &#x27;css/bootstrap.min.css&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span> <span class=\"attr\">border</span>=<span class=\"string\">&quot;1&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Board<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Posts<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Topics<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Last Post<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">                &#123;% for board in boards %&#125;</span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                            &#123;&#123;board.name&#125;&#125; <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">small</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: #888;&quot;</span>&gt;</span>&#123;&#123;board.description&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">small</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            &#123;% endfor %&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>首先，我们在模板的开头使用了 <code>Static Files App</code> 模板标签 <code>&#123;% load static%&#125;</code>。</p>\n<p>模板标签 <code>&#123;% static %&#125;</code> 用于构成资源文件完整URL。在这种情况下， <code>&#123;% static 'css/bootstrap.min.css' %&#125;</code> 将返回<code>/static/css/bootstrap.min.css</code>，它相当于 <code>http://127.0.0.1:8000/static/css/bootstrap.min.css</code>。</p>\n<p><code>&#123;% static %&#125;</code>模板标签使用 <code>settings.py</code> 文件中的 <code>STATIC_uRL</code> 配置来组成最终的URL，例如，如果您将静态文件托管在像<code>https∶//static.example.com/</code>这样的子域中，那么我们将设置 <code>STATIC_URL=https∶//static.example.com/</code> ，然后 <code>&#123;% static'css/bootstrap.min.css' %&#125;</code> 返回的是<code>https://static.example.com/css/bootstrap.min.css</code>。记得但凡是需要引用<code>CSS</code>， <code>JavaScript</code>或图片文件的地方就使用 <code>&#123;% static %&#125;</code>稍后，当我们开始部署项目到正式环境时，我们将讨论更多。现在都设置好了。</p>\n<p>刷新页面 <code>http∶//127.0.0.1∶8000</code>，我们可以看到它可以正常运行∶</p>\n<p>现在我们可以编辑模板，以利用<code>Bootstrap CSS</code>∶</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% load static %&#125;</span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;% static &#x27;css/bootstrap.min.css&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">ol</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;breadcrumb my-4&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;breadcrumb-item active&quot;</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">ol</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">table</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;table&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">thead</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;thead-inverse&quot;</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Board<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Posts<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Topics<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Last Post<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">                    &#123;% for board in boards %&#125;</span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                                &#123;&#123;board.name&#125;&#125; <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">                                <span class=\"tag\">&lt;<span class=\"name\">small</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: #888;&quot;</span>&gt;</span>&#123;&#123;board.description&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">small</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                &#123;% endfor %&#125;</span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>显示效果：</p>\n<p><img src=\"2.png\"></p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","site":{"data":{}},"excerpt":"","more":"<p>静态文件设置静态文件是指 <code>CSS</code>，<code>JavaScript</code>，<code>字体</code>，<code>图片</code>或者是用<code>来组成用户界面的任何其他资源</code>。</p>\n<p><code>Django</code> 本身是不负责处理这些文件的，但是为了让我们的开发过程更轻松，<code>Django</code> 提供了一些功能来帮助我们管理静态文件。这些功能可在 <code>INSTALLED_APPS</code> 的<code> django.contrib.staticfiles</code> 应用程序中找到。实际上，<code>Django</code>为了使得开发方便，也可以处理静态文件，而在生产环境下，静态文件一般直接由 <code>Nginx</code> 等反向代理服务器处理，而应用工服务器专心负责处理它擅长的业务逻辑。</p>\n<p>市面上很多优秀前端组件框架，我们没有理由继续用简陋的HTML文档来渲染。我们可以轻松地将<code>Bootstrap 4</code>添加到我们的项目中。<code>Bootstrap</code>是—个用<code>HTML</code>，<code>CSS</code>和<code>JavaScript</code>开发的前端开源工具包。</p>\n<p>在项目根目录中，除了 <code>boards</code>， <code>templates</code> 和<code>myproject</code>文件夹外，再创建一个名为<code>static</code>的新文件夹，并在<code>static</code>文件夹内创建另一个名为<code>css</code>的文件夹∶</p>\n<p>转到<a href=\"getbootstrap.com\">getbootstrap.com</a>并下载最新版本：</p>\n<p><img src=\"1.png\"></p>\n<p>下载编译版本的<code>CSS</code>和<code>JS</code></p>\n<p>在你的计算机中，解压 <code>bootstrap-5.0.1-dist</code> 文件，将文件 <code>css/bootstrap.min.css </code>复制到我们项目的<code>css</code>文件夹中∶</p>\n<p>下一步是告诉<code>Django</code>在哪里可以找到静态文件。打开<code>settings.py</code>，拉到文件的底部，在<code>STATIC_URL</code>后面添加以下内容∶</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">STATIC_URL = <span class=\"string\">&#x27;/static/&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">STATICFILES_DIRS = [</span><br><span class=\"line\">    os.path.join(BASE_DIR, <span class=\"string\">&quot;static&quot;</span>),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>还记得 <code>TEMPLATES</code>目录吗，和这个配置是一样的，现在我们必须在模板中加载静态文件（<code>Bootstrap CSS</code>文件）。</p>\n<p><strong>templates/home.html</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% load static %&#125;</span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;% static &#x27;css/bootstrap.min.css&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span> <span class=\"attr\">border</span>=<span class=\"string\">&quot;1&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Board<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Posts<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Topics<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Last Post<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">                &#123;% for board in boards %&#125;</span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                            &#123;&#123;board.name&#125;&#125; <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">small</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: #888;&quot;</span>&gt;</span>&#123;&#123;board.description&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">small</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            &#123;% endfor %&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>首先，我们在模板的开头使用了 <code>Static Files App</code> 模板标签 <code>&#123;% load static%&#125;</code>。</p>\n<p>模板标签 <code>&#123;% static %&#125;</code> 用于构成资源文件完整URL。在这种情况下， <code>&#123;% static 'css/bootstrap.min.css' %&#125;</code> 将返回<code>/static/css/bootstrap.min.css</code>，它相当于 <code>http://127.0.0.1:8000/static/css/bootstrap.min.css</code>。</p>\n<p><code>&#123;% static %&#125;</code>模板标签使用 <code>settings.py</code> 文件中的 <code>STATIC_uRL</code> 配置来组成最终的URL，例如，如果您将静态文件托管在像<code>https∶//static.example.com/</code>这样的子域中，那么我们将设置 <code>STATIC_URL=https∶//static.example.com/</code> ，然后 <code>&#123;% static'css/bootstrap.min.css' %&#125;</code> 返回的是<code>https://static.example.com/css/bootstrap.min.css</code>。记得但凡是需要引用<code>CSS</code>， <code>JavaScript</code>或图片文件的地方就使用 <code>&#123;% static %&#125;</code>稍后，当我们开始部署项目到正式环境时，我们将讨论更多。现在都设置好了。</p>\n<p>刷新页面 <code>http∶//127.0.0.1∶8000</code>，我们可以看到它可以正常运行∶</p>\n<p>现在我们可以编辑模板，以利用<code>Bootstrap CSS</code>∶</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% load static %&#125;</span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;% static &#x27;css/bootstrap.min.css&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">ol</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;breadcrumb my-4&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;breadcrumb-item active&quot;</span>&gt;</span>Boards<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">ol</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">table</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;table&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">thead</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;thead-inverse&quot;</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Board<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Posts<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Topics<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>Last Post<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">                    &#123;% for board in boards %&#125;</span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                                &#123;&#123;board.name&#125;&#125; <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">                                <span class=\"tag\">&lt;<span class=\"name\">small</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: #888;&quot;</span>&gt;</span>&#123;&#123;board.description&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">small</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                &#123;% endfor %&#125;</span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>显示效果：</p>\n<p><img src=\"2.png\"></p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n"},{"title":"FastAPI安装和使用","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-30T07:51:17.000Z","pic":null,"_content":"\n## 简介\n\n`FastAPI` 是一个用于构建 API 的现代、快速（高性能）的 web 框架，使用 Python 3.6+ 并基于标准的 Python 类型提示。\n\n关键特性:\n\n- 快速：可与 NodeJS 和 Go 比肩的极高性能（归功于 Starlette 和 Pydantic）。最快的 Python web 框架之一。\n\n- 高效编码：提高功能开发速度约 200％ 至 300％。*\n\n- 更少 bug：减少约 40％ 的人为（开发者）导致错误。*\n- 智能：极佳的编辑器支持。处处皆可自动补全，减少调试时间。\n- 简单：设计的易于使用和学习，阅读文档的时间更短。\n- 简短：使代码重复最小化。通过不同的参数声明实现丰富功能。bug 更少。\n- 健壮：生产可用级别的代码。还有自动生成的交互式文档。\n- 标准化：基于（并完全兼容）API 的相关开放标准：OpenAPI (以前被称为 Swagger) 和 JSON Schema。\n\n## 依赖\n\n`Python 3.6`及更高版本\n\n`FastAPI`站在以下巨人的肩膀之上：\n\n- `Starlette` 负责 `web` 部分。\n- `Pydantic` 负责数据部分。\n\n## 安装\n\n```python\npip install fastapi\n```\n\n你还会需要一个 `ASGI` 服务器，生产环境可以使用 `Uvicorn` 或者 `Hypercorn`。\n\n```python\npip install uvicorn[standard]\n```\n\n## 示例\n\n### 创建\n\n创建一个`main.py`文件并写入以下内容:\n\n```python\nfrom typing import Optional\n\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/\")\ndef read_root():\n    return {\"Hello\": \"World\"}\n\n\n@app.get(\"/items/{item_id}\")\ndef read_item(item_id: int, q: Optional[str] = None):\n    return {\"item_id\": item_id, \"q\": q}\n```\n\n{% collapse 或者使用 async def... %}\n\n如果你的代码里会出现 async / await，请使用 async def：\n\n```python\nfrom typing import Optional\n\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/\")\nasync def read_root():\n    return {\"Hello\": \"World\"}\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id: int, q: Optional[str] = None):\n    return {\"item_id\": item_id, \"q\": q}\n```\n\n{% endcollapse %}\n\n## 运行\n\n通过以下命令运行服务器：\n\n```python\nuvicorn main:app --reload\n```\n\n## 检查\n\n使用浏览器访问[http://127.0.0.1:8000/items/5?q=somequery](http://127.0.0.1:8000/items/5?q=somequery)。\n\n你将会看到如下`JSON`响应：\n\n```python\n{\"item_id\": 5, \"q\": \"somequery\"}\n```\n\n你已经创建了一个具有以下功能的 `API`：\n\n- 通过 *路径* `/` 和 `/items/{item_id}` 接受 `HTTP` 请求。\n- 以上 *路径* 都接受 `GET` 操作（也被称为 `HTTP` 方法）。\n- `/items/{item_id}` *路径* 有一个路径参数 `item_id` 并且应该为 `int` 类型。\n- `/items/{item_id}` *路径* 有一个可选的 `str` 类型的 查询参数 `q`。\n\n## 交互式 API 文档\n\n访问[http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)，你会看到自动生成的交互式 `API` 文档（由 Swagger UI生成）：\n\n![](Screenshot_1.webp)\n\n## 示例升级\n\n现在修改`main.py`文件来从 `PUT` 请求中接收请求体。\n\n我们借助 `Pydantic` 来使用标准的 `Python` 类型声明请求体。\n\n```python\nfrom typing import Optional\n\nfrom fastapi import FastAPI\n\nfrom pydantic import BaseModel\n\n\napp = FastAPI()\n\n\n\nclass Item(BaseModel):\n\n    name: str\n\n    price: float\n\n    is_offer: Optional[bool] = None\n\n\n\n@app.get(\"/\")\ndef read_root():\n    return {\"Hello\": \"World\"}\n\n\n@app.get(\"/items/{item_id}\")\ndef read_item(item_id: int, q: Optional[str] = None):\n    return {\"item_id\": item_id, \"q\": q}\n\n\n\n@app.put(\"/items/{item_id}\")\n\ndef update_item(item_id: int, item: Item):\n\n    return {\"item_name\": item.name, \"item_id\": item_id}\n```\n\n## 交互式 API 文档升级\n\n访问[http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)。\n\n- 交互式 API 文档将会自动更新，并加入新的请求体：\n\n- 点击「Try it out」按钮，之后你可以填写参数并直接调用 API：\n\n- 然后点击「Execute」按钮，用户界面将会和 API 进行通信，发送参数，获取结果并在屏幕上展示：\n\n![](Screenshot_2.webp)","source":"_posts/FastAPI安装和使用.md","raw":"---\ntitle: FastAPI安装和使用\ntags:\n  - fastapi\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-30 15:51:17\ncategories: FastAPI\npic:\n---\n\n## 简介\n\n`FastAPI` 是一个用于构建 API 的现代、快速（高性能）的 web 框架，使用 Python 3.6+ 并基于标准的 Python 类型提示。\n\n关键特性:\n\n- 快速：可与 NodeJS 和 Go 比肩的极高性能（归功于 Starlette 和 Pydantic）。最快的 Python web 框架之一。\n\n- 高效编码：提高功能开发速度约 200％ 至 300％。*\n\n- 更少 bug：减少约 40％ 的人为（开发者）导致错误。*\n- 智能：极佳的编辑器支持。处处皆可自动补全，减少调试时间。\n- 简单：设计的易于使用和学习，阅读文档的时间更短。\n- 简短：使代码重复最小化。通过不同的参数声明实现丰富功能。bug 更少。\n- 健壮：生产可用级别的代码。还有自动生成的交互式文档。\n- 标准化：基于（并完全兼容）API 的相关开放标准：OpenAPI (以前被称为 Swagger) 和 JSON Schema。\n\n## 依赖\n\n`Python 3.6`及更高版本\n\n`FastAPI`站在以下巨人的肩膀之上：\n\n- `Starlette` 负责 `web` 部分。\n- `Pydantic` 负责数据部分。\n\n## 安装\n\n```python\npip install fastapi\n```\n\n你还会需要一个 `ASGI` 服务器，生产环境可以使用 `Uvicorn` 或者 `Hypercorn`。\n\n```python\npip install uvicorn[standard]\n```\n\n## 示例\n\n### 创建\n\n创建一个`main.py`文件并写入以下内容:\n\n```python\nfrom typing import Optional\n\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/\")\ndef read_root():\n    return {\"Hello\": \"World\"}\n\n\n@app.get(\"/items/{item_id}\")\ndef read_item(item_id: int, q: Optional[str] = None):\n    return {\"item_id\": item_id, \"q\": q}\n```\n\n{% collapse 或者使用 async def... %}\n\n如果你的代码里会出现 async / await，请使用 async def：\n\n```python\nfrom typing import Optional\n\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/\")\nasync def read_root():\n    return {\"Hello\": \"World\"}\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id: int, q: Optional[str] = None):\n    return {\"item_id\": item_id, \"q\": q}\n```\n\n{% endcollapse %}\n\n## 运行\n\n通过以下命令运行服务器：\n\n```python\nuvicorn main:app --reload\n```\n\n## 检查\n\n使用浏览器访问[http://127.0.0.1:8000/items/5?q=somequery](http://127.0.0.1:8000/items/5?q=somequery)。\n\n你将会看到如下`JSON`响应：\n\n```python\n{\"item_id\": 5, \"q\": \"somequery\"}\n```\n\n你已经创建了一个具有以下功能的 `API`：\n\n- 通过 *路径* `/` 和 `/items/{item_id}` 接受 `HTTP` 请求。\n- 以上 *路径* 都接受 `GET` 操作（也被称为 `HTTP` 方法）。\n- `/items/{item_id}` *路径* 有一个路径参数 `item_id` 并且应该为 `int` 类型。\n- `/items/{item_id}` *路径* 有一个可选的 `str` 类型的 查询参数 `q`。\n\n## 交互式 API 文档\n\n访问[http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)，你会看到自动生成的交互式 `API` 文档（由 Swagger UI生成）：\n\n![](Screenshot_1.webp)\n\n## 示例升级\n\n现在修改`main.py`文件来从 `PUT` 请求中接收请求体。\n\n我们借助 `Pydantic` 来使用标准的 `Python` 类型声明请求体。\n\n```python\nfrom typing import Optional\n\nfrom fastapi import FastAPI\n\nfrom pydantic import BaseModel\n\n\napp = FastAPI()\n\n\n\nclass Item(BaseModel):\n\n    name: str\n\n    price: float\n\n    is_offer: Optional[bool] = None\n\n\n\n@app.get(\"/\")\ndef read_root():\n    return {\"Hello\": \"World\"}\n\n\n@app.get(\"/items/{item_id}\")\ndef read_item(item_id: int, q: Optional[str] = None):\n    return {\"item_id\": item_id, \"q\": q}\n\n\n\n@app.put(\"/items/{item_id}\")\n\ndef update_item(item_id: int, item: Item):\n\n    return {\"item_name\": item.name, \"item_id\": item_id}\n```\n\n## 交互式 API 文档升级\n\n访问[http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)。\n\n- 交互式 API 文档将会自动更新，并加入新的请求体：\n\n- 点击「Try it out」按钮，之后你可以填写参数并直接调用 API：\n\n- 然后点击「Execute」按钮，用户界面将会和 API 进行通信，发送参数，获取结果并在屏幕上展示：\n\n![](Screenshot_2.webp)","slug":"FastAPI安装和使用","published":1,"updated":"2021-06-15T15:47:31.593Z","layout":"post","photos":[],"link":"","_id":"ckq14rx21000m44ud97bxbmz4","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p><code>FastAPI</code> 是一个用于构建 API 的现代、快速（高性能）的 web 框架，使用 Python 3.6+ 并基于标准的 Python 类型提示。</p>\n<p>关键特性:</p>\n<ul>\n<li><p>快速：可与 NodeJS 和 Go 比肩的极高性能（归功于 Starlette 和 Pydantic）。最快的 Python web 框架之一。</p>\n</li>\n<li><p>高效编码：提高功能开发速度约 200％ 至 300％。*</p>\n</li>\n<li><p>更少 bug：减少约 40％ 的人为（开发者）导致错误。*</p>\n</li>\n<li><p>智能：极佳的编辑器支持。处处皆可自动补全，减少调试时间。</p>\n</li>\n<li><p>简单：设计的易于使用和学习，阅读文档的时间更短。</p>\n</li>\n<li><p>简短：使代码重复最小化。通过不同的参数声明实现丰富功能。bug 更少。</p>\n</li>\n<li><p>健壮：生产可用级别的代码。还有自动生成的交互式文档。</p>\n</li>\n<li><p>标准化：基于（并完全兼容）API 的相关开放标准：OpenAPI (以前被称为 Swagger) 和 JSON Schema。</p>\n</li>\n</ul>\n<h2 id=\"依赖\"><a href=\"#依赖\" class=\"headerlink\" title=\"依赖\"></a>依赖</h2><p><code>Python 3.6</code>及更高版本</p>\n<p><code>FastAPI</code>站在以下巨人的肩膀之上：</p>\n<ul>\n<li><code>Starlette</code> 负责 <code>web</code> 部分。</li>\n<li><code>Pydantic</code> 负责数据部分。</li>\n</ul>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install fastapi</span><br></pre></td></tr></table></figure>\n\n<p>你还会需要一个 <code>ASGI</code> 服务器，生产环境可以使用 <code>Uvicorn</code> 或者 <code>Hypercorn</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install uvicorn[standard]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h2><h3 id=\"创建\"><a href=\"#创建\" class=\"headerlink\" title=\"创建\"></a>创建</h3><p>创建一个<code>main.py</code>文件并写入以下内容:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Optional</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_root</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;Hello&quot;</span>: <span class=\"string\">&quot;World&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_item</span>(<span class=\"params\">item_id: <span class=\"built_in\">int</span>, q: <span class=\"type\">Optional</span>[<span class=\"built_in\">str</span>] = <span class=\"literal\">None</span></span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;item_id&quot;</span>: item_id, <span class=\"string\">&quot;q&quot;</span>: q&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"xControl\">\n    <div class=\"xHeading\"><div class=\"xIcon\"><i class=\"fa fa-plus\"></i></div><span>或者使用</span></div>\n    <div class=\"xContent\"><div class=\"inner\">\n        <p>如果你的代码里会出现 async / await，请使用 async def：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Optional</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_root</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;Hello&quot;</span>: <span class=\"string\">&quot;World&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_item</span>(<span class=\"params\">item_id: <span class=\"built_in\">int</span>, q: <span class=\"type\">Optional</span>[<span class=\"built_in\">str</span>] = <span class=\"literal\">None</span></span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;item_id&quot;</span>: item_id, <span class=\"string\">&quot;q&quot;</span>: q&#125;</span><br></pre></td></tr></table></figure>\n \n    </div></div>\n    </div>\n\n<h2 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h2><p>通过以下命令运行服务器：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uvicorn main:app --reload</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"检查\"><a href=\"#检查\" class=\"headerlink\" title=\"检查\"></a>检查</h2><p>使用浏览器访问<a href=\"http://127.0.0.1:8000/items/5?q=somequery\">http://127.0.0.1:8000/items/5?q=somequery</a>。</p>\n<p>你将会看到如下<code>JSON</code>响应：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&quot;item_id&quot;</span>: <span class=\"number\">5</span>, <span class=\"string\">&quot;q&quot;</span>: <span class=\"string\">&quot;somequery&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>你已经创建了一个具有以下功能的 <code>API</code>：</p>\n<ul>\n<li>通过 <em>路径</em> <code>/</code> 和 <code>/items/&#123;item_id&#125;</code> 接受 <code>HTTP</code> 请求。</li>\n<li>以上 <em>路径</em> 都接受 <code>GET</code> 操作（也被称为 <code>HTTP</code> 方法）。</li>\n<li><code>/items/&#123;item_id&#125;</code> <em>路径</em> 有一个路径参数 <code>item_id</code> 并且应该为 <code>int</code> 类型。</li>\n<li><code>/items/&#123;item_id&#125;</code> <em>路径</em> 有一个可选的 <code>str</code> 类型的 查询参数 <code>q</code>。</li>\n</ul>\n<h2 id=\"交互式-API-文档\"><a href=\"#交互式-API-文档\" class=\"headerlink\" title=\"交互式 API 文档\"></a>交互式 API 文档</h2><p>访问<a href=\"http://127.0.0.1:8000/docs\">http://127.0.0.1:8000/docs</a>，你会看到自动生成的交互式 <code>API</code> 文档（由 Swagger UI生成）：</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<h2 id=\"示例升级\"><a href=\"#示例升级\" class=\"headerlink\" title=\"示例升级\"></a>示例升级</h2><p>现在修改<code>main.py</code>文件来从 <code>PUT</code> 请求中接收请求体。</p>\n<p>我们借助 <code>Pydantic</code> 来使用标准的 <code>Python</code> 类型声明请求体。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Optional</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pydantic <span class=\"keyword\">import</span> BaseModel</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Item</span>(<span class=\"params\">BaseModel</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">    name: <span class=\"built_in\">str</span></span><br><span class=\"line\"></span><br><span class=\"line\">    price: <span class=\"built_in\">float</span></span><br><span class=\"line\"></span><br><span class=\"line\">    is_offer: <span class=\"type\">Optional</span>[<span class=\"built_in\">bool</span>] = <span class=\"literal\">None</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_root</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;Hello&quot;</span>: <span class=\"string\">&quot;World&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_item</span>(<span class=\"params\">item_id: <span class=\"built_in\">int</span>, q: <span class=\"type\">Optional</span>[<span class=\"built_in\">str</span>] = <span class=\"literal\">None</span></span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;item_id&quot;</span>: item_id, <span class=\"string\">&quot;q&quot;</span>: q&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.put(<span class=\"params\"><span class=\"string\">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">update_item</span>(<span class=\"params\">item_id: <span class=\"built_in\">int</span>, item: Item</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;item_name&quot;</span>: item.name, <span class=\"string\">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"交互式-API-文档升级\"><a href=\"#交互式-API-文档升级\" class=\"headerlink\" title=\"交互式 API 文档升级\"></a>交互式 API 文档升级</h2><p>访问<a href=\"http://127.0.0.1:8000/docs\">http://127.0.0.1:8000/docs</a>。</p>\n<ul>\n<li><p>交互式 API 文档将会自动更新，并加入新的请求体：</p>\n</li>\n<li><p>点击「Try it out」按钮，之后你可以填写参数并直接调用 API：</p>\n</li>\n<li><p>然后点击「Execute」按钮，用户界面将会和 API 进行通信，发送参数，获取结果并在屏幕上展示：</p>\n</li>\n</ul>\n<p><img src=\"Screenshot_2.webp\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p><code>FastAPI</code> 是一个用于构建 API 的现代、快速（高性能）的 web 框架，使用 Python 3.6+ 并基于标准的 Python 类型提示。</p>\n<p>关键特性:</p>\n<ul>\n<li><p>快速：可与 NodeJS 和 Go 比肩的极高性能（归功于 Starlette 和 Pydantic）。最快的 Python web 框架之一。</p>\n</li>\n<li><p>高效编码：提高功能开发速度约 200％ 至 300％。*</p>\n</li>\n<li><p>更少 bug：减少约 40％ 的人为（开发者）导致错误。*</p>\n</li>\n<li><p>智能：极佳的编辑器支持。处处皆可自动补全，减少调试时间。</p>\n</li>\n<li><p>简单：设计的易于使用和学习，阅读文档的时间更短。</p>\n</li>\n<li><p>简短：使代码重复最小化。通过不同的参数声明实现丰富功能。bug 更少。</p>\n</li>\n<li><p>健壮：生产可用级别的代码。还有自动生成的交互式文档。</p>\n</li>\n<li><p>标准化：基于（并完全兼容）API 的相关开放标准：OpenAPI (以前被称为 Swagger) 和 JSON Schema。</p>\n</li>\n</ul>\n<h2 id=\"依赖\"><a href=\"#依赖\" class=\"headerlink\" title=\"依赖\"></a>依赖</h2><p><code>Python 3.6</code>及更高版本</p>\n<p><code>FastAPI</code>站在以下巨人的肩膀之上：</p>\n<ul>\n<li><code>Starlette</code> 负责 <code>web</code> 部分。</li>\n<li><code>Pydantic</code> 负责数据部分。</li>\n</ul>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install fastapi</span><br></pre></td></tr></table></figure>\n\n<p>你还会需要一个 <code>ASGI</code> 服务器，生产环境可以使用 <code>Uvicorn</code> 或者 <code>Hypercorn</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install uvicorn[standard]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h2><h3 id=\"创建\"><a href=\"#创建\" class=\"headerlink\" title=\"创建\"></a>创建</h3><p>创建一个<code>main.py</code>文件并写入以下内容:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Optional</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_root</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;Hello&quot;</span>: <span class=\"string\">&quot;World&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_item</span>(<span class=\"params\">item_id: <span class=\"built_in\">int</span>, q: <span class=\"type\">Optional</span>[<span class=\"built_in\">str</span>] = <span class=\"literal\">None</span></span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;item_id&quot;</span>: item_id, <span class=\"string\">&quot;q&quot;</span>: q&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"xControl\">\n    <div class=\"xHeading\"><div class=\"xIcon\"><i class=\"fa fa-plus\"></i></div><span>或者使用</span></div>\n    <div class=\"xContent\"><div class=\"inner\">\n        <p>如果你的代码里会出现 async / await，请使用 async def：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Optional</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_root</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;Hello&quot;</span>: <span class=\"string\">&quot;World&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_item</span>(<span class=\"params\">item_id: <span class=\"built_in\">int</span>, q: <span class=\"type\">Optional</span>[<span class=\"built_in\">str</span>] = <span class=\"literal\">None</span></span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;item_id&quot;</span>: item_id, <span class=\"string\">&quot;q&quot;</span>: q&#125;</span><br></pre></td></tr></table></figure>\n \n    </div></div>\n    </div>\n\n<h2 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h2><p>通过以下命令运行服务器：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uvicorn main:app --reload</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"检查\"><a href=\"#检查\" class=\"headerlink\" title=\"检查\"></a>检查</h2><p>使用浏览器访问<a href=\"http://127.0.0.1:8000/items/5?q=somequery\">http://127.0.0.1:8000/items/5?q=somequery</a>。</p>\n<p>你将会看到如下<code>JSON</code>响应：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&quot;item_id&quot;</span>: <span class=\"number\">5</span>, <span class=\"string\">&quot;q&quot;</span>: <span class=\"string\">&quot;somequery&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>你已经创建了一个具有以下功能的 <code>API</code>：</p>\n<ul>\n<li>通过 <em>路径</em> <code>/</code> 和 <code>/items/&#123;item_id&#125;</code> 接受 <code>HTTP</code> 请求。</li>\n<li>以上 <em>路径</em> 都接受 <code>GET</code> 操作（也被称为 <code>HTTP</code> 方法）。</li>\n<li><code>/items/&#123;item_id&#125;</code> <em>路径</em> 有一个路径参数 <code>item_id</code> 并且应该为 <code>int</code> 类型。</li>\n<li><code>/items/&#123;item_id&#125;</code> <em>路径</em> 有一个可选的 <code>str</code> 类型的 查询参数 <code>q</code>。</li>\n</ul>\n<h2 id=\"交互式-API-文档\"><a href=\"#交互式-API-文档\" class=\"headerlink\" title=\"交互式 API 文档\"></a>交互式 API 文档</h2><p>访问<a href=\"http://127.0.0.1:8000/docs\">http://127.0.0.1:8000/docs</a>，你会看到自动生成的交互式 <code>API</code> 文档（由 Swagger UI生成）：</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<h2 id=\"示例升级\"><a href=\"#示例升级\" class=\"headerlink\" title=\"示例升级\"></a>示例升级</h2><p>现在修改<code>main.py</code>文件来从 <code>PUT</code> 请求中接收请求体。</p>\n<p>我们借助 <code>Pydantic</code> 来使用标准的 <code>Python</code> 类型声明请求体。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Optional</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pydantic <span class=\"keyword\">import</span> BaseModel</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Item</span>(<span class=\"params\">BaseModel</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">    name: <span class=\"built_in\">str</span></span><br><span class=\"line\"></span><br><span class=\"line\">    price: <span class=\"built_in\">float</span></span><br><span class=\"line\"></span><br><span class=\"line\">    is_offer: <span class=\"type\">Optional</span>[<span class=\"built_in\">bool</span>] = <span class=\"literal\">None</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_root</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;Hello&quot;</span>: <span class=\"string\">&quot;World&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_item</span>(<span class=\"params\">item_id: <span class=\"built_in\">int</span>, q: <span class=\"type\">Optional</span>[<span class=\"built_in\">str</span>] = <span class=\"literal\">None</span></span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;item_id&quot;</span>: item_id, <span class=\"string\">&quot;q&quot;</span>: q&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.put(<span class=\"params\"><span class=\"string\">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">update_item</span>(<span class=\"params\">item_id: <span class=\"built_in\">int</span>, item: Item</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;item_name&quot;</span>: item.name, <span class=\"string\">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"交互式-API-文档升级\"><a href=\"#交互式-API-文档升级\" class=\"headerlink\" title=\"交互式 API 文档升级\"></a>交互式 API 文档升级</h2><p>访问<a href=\"http://127.0.0.1:8000/docs\">http://127.0.0.1:8000/docs</a>。</p>\n<ul>\n<li><p>交互式 API 文档将会自动更新，并加入新的请求体：</p>\n</li>\n<li><p>点击「Try it out」按钮，之后你可以填写参数并直接调用 API：</p>\n</li>\n<li><p>然后点击「Execute」按钮，用户界面将会和 API 进行通信，发送参数，获取结果并在屏幕上展示：</p>\n</li>\n</ul>\n<p><img src=\"Screenshot_2.webp\"></p>\n"},{"title":"FastAPI教程-入门介绍","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-30T11:57:07.000Z","pic":null,"_content":"\n\n## 第一步\n\n最简单的 `FastAPI` 文件可能像下面这样：\n\n最简单的 FastAPI 文件可能像下面这样：\n\n```python\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello World\"}\n```\n\n将其复制到 `main.py` 文件中。\n\n运行实时服务器：\n\n```shell\nuvicorn main:app --reload\n```\n\n{% colorpanel info Note %}\n\nuvicorn main:app 命令含义如下:\n\n- main：main.py 文件（一个 Python「模块」）。\n- app：在 main.py 文件中通过 app = FastAPI() 创建的对象。\n- \\-\\-reload：让服务器在更新代码后重新启动。仅在开发时使用该选项。\n\n{% endcolorpanel %}\n\n## 分步概括\n\n### 步骤1：导入FastAPI\n\n```python\nfrom fastapi import FastAPI\n```\n\n`FastAPI` 是一个为 `API` 提供了所有功能的 `Python` 类。\n\n{% colorpanel info 技术细节 %}\n\nFastAPI 是直接从 Starlette 继承的类。\n你可以通过 FastAPI 使用所有的 Starlette 的功能。\n\n{% endcolorpanel %}\n\n### 步骤 2：创建一个 FastAPI「实例」\n\n```python\napp = FastAPI()\n```\n\n这里的变量 `app` 会是 `FastAPI` 类的一个「实例」。\n\n这个实例将是创建你所有 `API` 的主要交互对象。\n\n这个 `app` 同样在如下命令中被 `uvicorn` 所引用：\n\n```python\nuvicorn main:app --reload\n```\n\n如果你像下面这样创建应用：\n\n```python\nfrom fastapi import FastAPI\n\nmy_awesome_api = FastAPI()\n\n@my_awesome_api.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello World\"}\n```\n\n将代码放入 `main.py` 文件中，然后你可以像下面这样运行 `uvicorn`：\n\n```python\nuvicorn main:my_awesome_api --reload\n```\n\n### 步骤 3：创建一个路径操作\n\n#### 路径\n\n这里的「路径」指的是 `URL` 中从第一个 `/` 起的后半部分。\n\n所以，在一个这样的 `URL` 中：\n\n```python\nhttps://example.com/items/foo\n```\n\n...路径会是：\n\n```python\n/items/foo\n```\n\n{% colorpanel info info %}\n\n「路径」也通常被称为「端点」或「路由」。\n\n{% endcolorpanel %}\n\n开发 `API` 时，「路径」是用来分离「关注点」和「资源」的主要手段。\n\n#### 操作\n\n这里的「操作」指的是一种 `HTTP「方法」`。\n\n下列之一：\n\n- POST\n- GET\n- PUT\n- DELETE\n\n...以及更少见的几种：\n\n- OPTIONS\n- HEAD\n- PATCH\n- TRACE\n\n在 `HTTP` 协议中，你可以使用以上的其中一种（或多种）「方法」与每个路径进行通信。\n\n在开发 `API` 时，通常使用特定的 `HTTP` 方法去执行特定的行为。\n\n通常使用：\n\n- POST：创建数据。\n- GET：读取数据。\n- PUT：更新数据。\n- DELETE：删除数据。\n\n因此，在 `OpenAPI` 中，每一个 `HTTP` 方法都被称为`「操作」`。\n\n#### 定义一个路径操作装饰器\n\n```python\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello World\"}\n```\n\n`@app.get(\"/\")`告诉 `FastAPI` 在它下方的函数负责处理如下访问请求：\n\n- 请求路径为 `/`\n- 使用 `get` 操作\n\n{% colorpanel info \"@decorator Info\" %}\n\n`@something`语法在 `Python` 中被称为「装饰器」。\n\n装饰器接收位于其下方的函数并且用它完成一些工作。\n\n在上面的例子中，这个装饰器告诉 `FastAPI` 位于其下方的函数对应着路径 `/` 加上 `get` 操作。\n\n它是一个「路径操作装饰器」。\n\n{% endcolorpanel %}\n\n### 步骤 4：定义路径操作函数\n\n这是「路径操作函数」：\n\n- 路径：是 `/`。\n- 操作：是 `get`。\n- 函数：是位于「装饰器」下方的函数（位于` @app.get(\"/\") `下方）。\n\n```python\nfrom fastapi import FastAPI\napp = FastAPI()\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello World\"}\n```\n\n这是一个 `Python` 函数。\n\n每当 `FastAPI` 接收一个使用 `GET` 方法访问 `URL「/」`的请求时这个函数会被调用。\n\n在这个例子中，它是一个 `async` 函数。当然也可以定义为常规函数。\n\n### 步骤 5：返回内容\n\n```python\nreturn {\"message\": \"Hello World\"}\n```\n\n你可以返回一个 `dict`、`list`，像 `str`、`int` 一样的单个值，等等。\n\n你还可以返回 `Pydantic` 模型（稍后你将了解更多）。\n\n还有许多其他将会自动转换为 `JSON` 的对象和模型（包括 `ORM` 对象等）。\n\n\n","source":"_posts/FastAPI教程-用户指南.md","raw":"---\ntitle: FastAPI教程-入门介绍\ntags:\n  - fastapi\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-30 19:57:07\ncategories: FastAPI\npic:\n---\n\n\n## 第一步\n\n最简单的 `FastAPI` 文件可能像下面这样：\n\n最简单的 FastAPI 文件可能像下面这样：\n\n```python\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello World\"}\n```\n\n将其复制到 `main.py` 文件中。\n\n运行实时服务器：\n\n```shell\nuvicorn main:app --reload\n```\n\n{% colorpanel info Note %}\n\nuvicorn main:app 命令含义如下:\n\n- main：main.py 文件（一个 Python「模块」）。\n- app：在 main.py 文件中通过 app = FastAPI() 创建的对象。\n- \\-\\-reload：让服务器在更新代码后重新启动。仅在开发时使用该选项。\n\n{% endcolorpanel %}\n\n## 分步概括\n\n### 步骤1：导入FastAPI\n\n```python\nfrom fastapi import FastAPI\n```\n\n`FastAPI` 是一个为 `API` 提供了所有功能的 `Python` 类。\n\n{% colorpanel info 技术细节 %}\n\nFastAPI 是直接从 Starlette 继承的类。\n你可以通过 FastAPI 使用所有的 Starlette 的功能。\n\n{% endcolorpanel %}\n\n### 步骤 2：创建一个 FastAPI「实例」\n\n```python\napp = FastAPI()\n```\n\n这里的变量 `app` 会是 `FastAPI` 类的一个「实例」。\n\n这个实例将是创建你所有 `API` 的主要交互对象。\n\n这个 `app` 同样在如下命令中被 `uvicorn` 所引用：\n\n```python\nuvicorn main:app --reload\n```\n\n如果你像下面这样创建应用：\n\n```python\nfrom fastapi import FastAPI\n\nmy_awesome_api = FastAPI()\n\n@my_awesome_api.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello World\"}\n```\n\n将代码放入 `main.py` 文件中，然后你可以像下面这样运行 `uvicorn`：\n\n```python\nuvicorn main:my_awesome_api --reload\n```\n\n### 步骤 3：创建一个路径操作\n\n#### 路径\n\n这里的「路径」指的是 `URL` 中从第一个 `/` 起的后半部分。\n\n所以，在一个这样的 `URL` 中：\n\n```python\nhttps://example.com/items/foo\n```\n\n...路径会是：\n\n```python\n/items/foo\n```\n\n{% colorpanel info info %}\n\n「路径」也通常被称为「端点」或「路由」。\n\n{% endcolorpanel %}\n\n开发 `API` 时，「路径」是用来分离「关注点」和「资源」的主要手段。\n\n#### 操作\n\n这里的「操作」指的是一种 `HTTP「方法」`。\n\n下列之一：\n\n- POST\n- GET\n- PUT\n- DELETE\n\n...以及更少见的几种：\n\n- OPTIONS\n- HEAD\n- PATCH\n- TRACE\n\n在 `HTTP` 协议中，你可以使用以上的其中一种（或多种）「方法」与每个路径进行通信。\n\n在开发 `API` 时，通常使用特定的 `HTTP` 方法去执行特定的行为。\n\n通常使用：\n\n- POST：创建数据。\n- GET：读取数据。\n- PUT：更新数据。\n- DELETE：删除数据。\n\n因此，在 `OpenAPI` 中，每一个 `HTTP` 方法都被称为`「操作」`。\n\n#### 定义一个路径操作装饰器\n\n```python\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello World\"}\n```\n\n`@app.get(\"/\")`告诉 `FastAPI` 在它下方的函数负责处理如下访问请求：\n\n- 请求路径为 `/`\n- 使用 `get` 操作\n\n{% colorpanel info \"@decorator Info\" %}\n\n`@something`语法在 `Python` 中被称为「装饰器」。\n\n装饰器接收位于其下方的函数并且用它完成一些工作。\n\n在上面的例子中，这个装饰器告诉 `FastAPI` 位于其下方的函数对应着路径 `/` 加上 `get` 操作。\n\n它是一个「路径操作装饰器」。\n\n{% endcolorpanel %}\n\n### 步骤 4：定义路径操作函数\n\n这是「路径操作函数」：\n\n- 路径：是 `/`。\n- 操作：是 `get`。\n- 函数：是位于「装饰器」下方的函数（位于` @app.get(\"/\") `下方）。\n\n```python\nfrom fastapi import FastAPI\napp = FastAPI()\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello World\"}\n```\n\n这是一个 `Python` 函数。\n\n每当 `FastAPI` 接收一个使用 `GET` 方法访问 `URL「/」`的请求时这个函数会被调用。\n\n在这个例子中，它是一个 `async` 函数。当然也可以定义为常规函数。\n\n### 步骤 5：返回内容\n\n```python\nreturn {\"message\": \"Hello World\"}\n```\n\n你可以返回一个 `dict`、`list`，像 `str`、`int` 一样的单个值，等等。\n\n你还可以返回 `Pydantic` 模型（稍后你将了解更多）。\n\n还有许多其他将会自动转换为 `JSON` 的对象和模型（包括 `ORM` 对象等）。\n\n\n","slug":"FastAPI教程-用户指南","published":1,"updated":"2021-06-15T15:47:31.601Z","layout":"post","photos":[],"link":"","_id":"ckq14rx21000n44udfelrbuw0","content":"<h2 id=\"第一步\"><a href=\"#第一步\" class=\"headerlink\" title=\"第一步\"></a>第一步</h2><p>最简单的 <code>FastAPI</code> 文件可能像下面这样：</p>\n<p>最简单的 FastAPI 文件可能像下面这样：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">root</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>将其复制到 <code>main.py</code> 文件中。</p>\n<p>运行实时服务器：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uvicorn main:app --reload</span><br></pre></td></tr></table></figure>\n\n<div class=\"panel panel-info\">\n    <div class=\"panel-title\">Note</div>\n    <div class=\"panel-body\">\n        <p>uvicorn main:app 命令含义如下:</p>\n<ul>\n<li>main：main.py 文件（一个 Python「模块」）。</li>\n<li>app：在 main.py 文件中通过 app = FastAPI() 创建的对象。</li>\n<li>--reload：让服务器在更新代码后重新启动。仅在开发时使用该选项。</li>\n</ul>\n\n    </div>\n    </div>\n\n<h2 id=\"分步概括\"><a href=\"#分步概括\" class=\"headerlink\" title=\"分步概括\"></a>分步概括</h2><h3 id=\"步骤1：导入FastAPI\"><a href=\"#步骤1：导入FastAPI\" class=\"headerlink\" title=\"步骤1：导入FastAPI\"></a>步骤1：导入FastAPI</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br></pre></td></tr></table></figure>\n\n<p><code>FastAPI</code> 是一个为 <code>API</code> 提供了所有功能的 <code>Python</code> 类。</p>\n<div class=\"panel panel-info\">\n    <div class=\"panel-title\">技术细节</div>\n    <div class=\"panel-body\">\n        <p>FastAPI 是直接从 Starlette 继承的类。<br>你可以通过 FastAPI 使用所有的 Starlette 的功能。</p>\n\n    </div>\n    </div>\n\n<h3 id=\"步骤-2：创建一个-FastAPI「实例」\"><a href=\"#步骤-2：创建一个-FastAPI「实例」\" class=\"headerlink\" title=\"步骤 2：创建一个 FastAPI「实例」\"></a>步骤 2：创建一个 FastAPI「实例」</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app = FastAPI()</span><br></pre></td></tr></table></figure>\n\n<p>这里的变量 <code>app</code> 会是 <code>FastAPI</code> 类的一个「实例」。</p>\n<p>这个实例将是创建你所有 <code>API</code> 的主要交互对象。</p>\n<p>这个 <code>app</code> 同样在如下命令中被 <code>uvicorn</code> 所引用：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uvicorn main:app --reload</span><br></pre></td></tr></table></figure>\n\n<p>如果你像下面这样创建应用：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\">my_awesome_api = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@my_awesome_api.get(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">root</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>将代码放入 <code>main.py</code> 文件中，然后你可以像下面这样运行 <code>uvicorn</code>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uvicorn main:my_awesome_api --reload</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"步骤-3：创建一个路径操作\"><a href=\"#步骤-3：创建一个路径操作\" class=\"headerlink\" title=\"步骤 3：创建一个路径操作\"></a>步骤 3：创建一个路径操作</h3><h4 id=\"路径\"><a href=\"#路径\" class=\"headerlink\" title=\"路径\"></a>路径</h4><p>这里的「路径」指的是 <code>URL</code> 中从第一个 <code>/</code> 起的后半部分。</p>\n<p>所以，在一个这样的 <code>URL</code> 中：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://example.com/items/foo</span><br></pre></td></tr></table></figure>\n\n<p>…路径会是：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/items/foo</span><br></pre></td></tr></table></figure>\n\n<div class=\"panel panel-info\">\n    <div class=\"panel-title\">info</div>\n    <div class=\"panel-body\">\n        <p>「路径」也通常被称为「端点」或「路由」。</p>\n\n    </div>\n    </div>\n\n<p>开发 <code>API</code> 时，「路径」是用来分离「关注点」和「资源」的主要手段。</p>\n<h4 id=\"操作\"><a href=\"#操作\" class=\"headerlink\" title=\"操作\"></a>操作</h4><p>这里的「操作」指的是一种 <code>HTTP「方法」</code>。</p>\n<p>下列之一：</p>\n<ul>\n<li>POST</li>\n<li>GET</li>\n<li>PUT</li>\n<li>DELETE</li>\n</ul>\n<p>…以及更少见的几种：</p>\n<ul>\n<li>OPTIONS</li>\n<li>HEAD</li>\n<li>PATCH</li>\n<li>TRACE</li>\n</ul>\n<p>在 <code>HTTP</code> 协议中，你可以使用以上的其中一种（或多种）「方法」与每个路径进行通信。</p>\n<p>在开发 <code>API</code> 时，通常使用特定的 <code>HTTP</code> 方法去执行特定的行为。</p>\n<p>通常使用：</p>\n<ul>\n<li>POST：创建数据。</li>\n<li>GET：读取数据。</li>\n<li>PUT：更新数据。</li>\n<li>DELETE：删除数据。</li>\n</ul>\n<p>因此，在 <code>OpenAPI</code> 中，每一个 <code>HTTP</code> 方法都被称为<code>「操作」</code>。</p>\n<h4 id=\"定义一个路径操作装饰器\"><a href=\"#定义一个路径操作装饰器\" class=\"headerlink\" title=\"定义一个路径操作装饰器\"></a>定义一个路径操作装饰器</h4><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">root</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>@app.get(&quot;/&quot;)</code>告诉 <code>FastAPI</code> 在它下方的函数负责处理如下访问请求：</p>\n<ul>\n<li>请求路径为 <code>/</code></li>\n<li>使用 <code>get</code> 操作</li>\n</ul>\n<div class=\"panel panel-info\">\n    <div class=\"panel-title\">@decorator Info</div>\n    <div class=\"panel-body\">\n        <p><code>@something</code>语法在 <code>Python</code> 中被称为「装饰器」。</p>\n<p>装饰器接收位于其下方的函数并且用它完成一些工作。</p>\n<p>在上面的例子中，这个装饰器告诉 <code>FastAPI</code> 位于其下方的函数对应着路径 <code>/</code> 加上 <code>get</code> 操作。</p>\n<p>它是一个「路径操作装饰器」。</p>\n\n    </div>\n    </div>\n\n<h3 id=\"步骤-4：定义路径操作函数\"><a href=\"#步骤-4：定义路径操作函数\" class=\"headerlink\" title=\"步骤 4：定义路径操作函数\"></a>步骤 4：定义路径操作函数</h3><p>这是「路径操作函数」：</p>\n<ul>\n<li>路径：是 <code>/</code>。</li>\n<li>操作：是 <code>get</code>。</li>\n<li>函数：是位于「装饰器」下方的函数（位于<code>@app.get(&quot;/&quot;)</code>下方）。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">root</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这是一个 <code>Python</code> 函数。</p>\n<p>每当 <code>FastAPI</code> 接收一个使用 <code>GET</code> 方法访问 <code>URL「/」</code>的请求时这个函数会被调用。</p>\n<p>在这个例子中，它是一个 <code>async</code> 函数。当然也可以定义为常规函数。</p>\n<h3 id=\"步骤-5：返回内容\"><a href=\"#步骤-5：返回内容\" class=\"headerlink\" title=\"步骤 5：返回内容\"></a>步骤 5：返回内容</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>你可以返回一个 <code>dict</code>、<code>list</code>，像 <code>str</code>、<code>int</code> 一样的单个值，等等。</p>\n<p>你还可以返回 <code>Pydantic</code> 模型（稍后你将了解更多）。</p>\n<p>还有许多其他将会自动转换为 <code>JSON</code> 的对象和模型（包括 <code>ORM</code> 对象等）。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"第一步\"><a href=\"#第一步\" class=\"headerlink\" title=\"第一步\"></a>第一步</h2><p>最简单的 <code>FastAPI</code> 文件可能像下面这样：</p>\n<p>最简单的 FastAPI 文件可能像下面这样：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">root</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>将其复制到 <code>main.py</code> 文件中。</p>\n<p>运行实时服务器：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uvicorn main:app --reload</span><br></pre></td></tr></table></figure>\n\n<div class=\"panel panel-info\">\n    <div class=\"panel-title\">Note</div>\n    <div class=\"panel-body\">\n        <p>uvicorn main:app 命令含义如下:</p>\n<ul>\n<li>main：main.py 文件（一个 Python「模块」）。</li>\n<li>app：在 main.py 文件中通过 app = FastAPI() 创建的对象。</li>\n<li>--reload：让服务器在更新代码后重新启动。仅在开发时使用该选项。</li>\n</ul>\n\n    </div>\n    </div>\n\n<h2 id=\"分步概括\"><a href=\"#分步概括\" class=\"headerlink\" title=\"分步概括\"></a>分步概括</h2><h3 id=\"步骤1：导入FastAPI\"><a href=\"#步骤1：导入FastAPI\" class=\"headerlink\" title=\"步骤1：导入FastAPI\"></a>步骤1：导入FastAPI</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br></pre></td></tr></table></figure>\n\n<p><code>FastAPI</code> 是一个为 <code>API</code> 提供了所有功能的 <code>Python</code> 类。</p>\n<div class=\"panel panel-info\">\n    <div class=\"panel-title\">技术细节</div>\n    <div class=\"panel-body\">\n        <p>FastAPI 是直接从 Starlette 继承的类。<br>你可以通过 FastAPI 使用所有的 Starlette 的功能。</p>\n\n    </div>\n    </div>\n\n<h3 id=\"步骤-2：创建一个-FastAPI「实例」\"><a href=\"#步骤-2：创建一个-FastAPI「实例」\" class=\"headerlink\" title=\"步骤 2：创建一个 FastAPI「实例」\"></a>步骤 2：创建一个 FastAPI「实例」</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app = FastAPI()</span><br></pre></td></tr></table></figure>\n\n<p>这里的变量 <code>app</code> 会是 <code>FastAPI</code> 类的一个「实例」。</p>\n<p>这个实例将是创建你所有 <code>API</code> 的主要交互对象。</p>\n<p>这个 <code>app</code> 同样在如下命令中被 <code>uvicorn</code> 所引用：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uvicorn main:app --reload</span><br></pre></td></tr></table></figure>\n\n<p>如果你像下面这样创建应用：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\">my_awesome_api = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@my_awesome_api.get(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">root</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>将代码放入 <code>main.py</code> 文件中，然后你可以像下面这样运行 <code>uvicorn</code>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uvicorn main:my_awesome_api --reload</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"步骤-3：创建一个路径操作\"><a href=\"#步骤-3：创建一个路径操作\" class=\"headerlink\" title=\"步骤 3：创建一个路径操作\"></a>步骤 3：创建一个路径操作</h3><h4 id=\"路径\"><a href=\"#路径\" class=\"headerlink\" title=\"路径\"></a>路径</h4><p>这里的「路径」指的是 <code>URL</code> 中从第一个 <code>/</code> 起的后半部分。</p>\n<p>所以，在一个这样的 <code>URL</code> 中：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://example.com/items/foo</span><br></pre></td></tr></table></figure>\n\n<p>…路径会是：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/items/foo</span><br></pre></td></tr></table></figure>\n\n<div class=\"panel panel-info\">\n    <div class=\"panel-title\">info</div>\n    <div class=\"panel-body\">\n        <p>「路径」也通常被称为「端点」或「路由」。</p>\n\n    </div>\n    </div>\n\n<p>开发 <code>API</code> 时，「路径」是用来分离「关注点」和「资源」的主要手段。</p>\n<h4 id=\"操作\"><a href=\"#操作\" class=\"headerlink\" title=\"操作\"></a>操作</h4><p>这里的「操作」指的是一种 <code>HTTP「方法」</code>。</p>\n<p>下列之一：</p>\n<ul>\n<li>POST</li>\n<li>GET</li>\n<li>PUT</li>\n<li>DELETE</li>\n</ul>\n<p>…以及更少见的几种：</p>\n<ul>\n<li>OPTIONS</li>\n<li>HEAD</li>\n<li>PATCH</li>\n<li>TRACE</li>\n</ul>\n<p>在 <code>HTTP</code> 协议中，你可以使用以上的其中一种（或多种）「方法」与每个路径进行通信。</p>\n<p>在开发 <code>API</code> 时，通常使用特定的 <code>HTTP</code> 方法去执行特定的行为。</p>\n<p>通常使用：</p>\n<ul>\n<li>POST：创建数据。</li>\n<li>GET：读取数据。</li>\n<li>PUT：更新数据。</li>\n<li>DELETE：删除数据。</li>\n</ul>\n<p>因此，在 <code>OpenAPI</code> 中，每一个 <code>HTTP</code> 方法都被称为<code>「操作」</code>。</p>\n<h4 id=\"定义一个路径操作装饰器\"><a href=\"#定义一个路径操作装饰器\" class=\"headerlink\" title=\"定义一个路径操作装饰器\"></a>定义一个路径操作装饰器</h4><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">root</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>@app.get(&quot;/&quot;)</code>告诉 <code>FastAPI</code> 在它下方的函数负责处理如下访问请求：</p>\n<ul>\n<li>请求路径为 <code>/</code></li>\n<li>使用 <code>get</code> 操作</li>\n</ul>\n<div class=\"panel panel-info\">\n    <div class=\"panel-title\">@decorator Info</div>\n    <div class=\"panel-body\">\n        <p><code>@something</code>语法在 <code>Python</code> 中被称为「装饰器」。</p>\n<p>装饰器接收位于其下方的函数并且用它完成一些工作。</p>\n<p>在上面的例子中，这个装饰器告诉 <code>FastAPI</code> 位于其下方的函数对应着路径 <code>/</code> 加上 <code>get</code> 操作。</p>\n<p>它是一个「路径操作装饰器」。</p>\n\n    </div>\n    </div>\n\n<h3 id=\"步骤-4：定义路径操作函数\"><a href=\"#步骤-4：定义路径操作函数\" class=\"headerlink\" title=\"步骤 4：定义路径操作函数\"></a>步骤 4：定义路径操作函数</h3><p>这是「路径操作函数」：</p>\n<ul>\n<li>路径：是 <code>/</code>。</li>\n<li>操作：是 <code>get</code>。</li>\n<li>函数：是位于「装饰器」下方的函数（位于<code>@app.get(&quot;/&quot;)</code>下方）。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">root</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这是一个 <code>Python</code> 函数。</p>\n<p>每当 <code>FastAPI</code> 接收一个使用 <code>GET</code> 方法访问 <code>URL「/」</code>的请求时这个函数会被调用。</p>\n<p>在这个例子中，它是一个 <code>async</code> 函数。当然也可以定义为常规函数。</p>\n<h3 id=\"步骤-5：返回内容\"><a href=\"#步骤-5：返回内容\" class=\"headerlink\" title=\"步骤 5：返回内容\"></a>步骤 5：返回内容</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>你可以返回一个 <code>dict</code>、<code>list</code>，像 <code>str</code>、<code>int</code> 一样的单个值，等等。</p>\n<p>你还可以返回 <code>Pydantic</code> 模型（稍后你将了解更多）。</p>\n<p>还有许多其他将会自动转换为 <code>JSON</code> 的对象和模型（包括 <code>ORM</code> 对象等）。</p>\n"},{"title":"FastAPI教程-路径参数","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-30T14:47:15.000Z","pic":null,"_content":"\n可以使用与 `Python` 格式化字符串相同的语法来声明路径\"参数\"或\"变量\"：\n\n```python\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id):\n    return {\"item_id\": item_id}\n```\n\n路径参数 `item_id` 的值将作为参数 `item_id` 传递给你的函数。\n\n所以，运行示例并访问 [http://127.0.0.1:8000/items/foo](http://127.0.0.1:8000/items/foo)，将会看到如下响应：\n\n```python\n{\"item_id\":\"foo\"}\n```\n\n## 有类型的路径参数\n\n可以使用标准的 `Python` 类型标注为函数中的路径参数声明类型。\n\n```python\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id: int):\n    return {\"item_id\": item_id}\n```\n\n在这个例子中，`item_id` 被声明为 `int` 类型。\n\n{% colorpanel success Check %}\n\n这将为你的函数提供编辑器支持，包括错误检查、代码补全等等。\n\n{% endcolorpanel %}\n\n## 数据转换\n\n如果运行示例并打开浏览器访问[http://127.0.0.1:8000/items/3](http://127.0.0.1:8000/items/3)，将得到如下响应：\n\n```python\n{\"item_id\":3}\n```\n\n{% colorpanel success Check %}\n\n注意函数接收（并返回）的值为 3，是一个 Python int 值，而不是字符串 \"3\"。\n\n所以，`FastAPI` 通过上面的类型声明提供了对请求的自动\"解析\"。\n\n{% endcolorpanel %}\n\n## 数据校验\n\n但如果你通过浏览器访问[http://127.0.0.1:8000/items/foo](http://127.0.0.1:8000/items/foo)，你会看到一个清晰可读的 HTTP 错误：\n\n```python\n{\n    \"detail\": [\n        {\n            \"loc\": [\n                \"path\",\n                \"item_id\"\n            ],\n            \"msg\": \"value is not a valid integer\",\n            \"type\": \"type_error.integer\"\n        }\n    ]\n}\n```\n\n因为路径参数 `item_id` 传入的值为 `\"foo\"`，它不是一个 `int`。\n\n如果你提供的是 `float` 而非整数也会出现同样的错误，比如：[http://127.0.0.1:8000/items/1.2](http://127.0.0.1:8000/items/1.2)\n\n{% colorpanel success Check %}\n\n所以，通过同样的 Python 类型声明，FastAPI 提供了数据校验功能。\n\n注意上面的错误同样清楚地指出了校验未通过的具体原因。\n\n在开发和调试与你的 API 进行交互的代码时，这非常有用。\n\n{% endcolorpanel %}\n\n## 文档\n\n打开浏览器访问[http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)，你将看到自动生成的交互式 `API` 文档：\n\n![](Screenshot_1.webp)\n\n## 路径操作的顺序\n\n在创建路径操作时，你会发现有些情况下路径是固定的。\n\n比如 `/users/me`，我们假设它用来获取关于当前用户的数据.\n\n然后，你还可以使用路径 `/users/{user_id}` 来通过用户 `ID` 获取关于特定用户的数据。\n\n由于路径操作是按顺序依次运行的，你需要确保路径 `/users/me` 声明在路径 `/users/{user_id}`之前：\n\n```python\nfrom fastapi import FastAPI\napp = FastAPI()\n\n@app.get(\"/users/me\")\nasync def read_user_me():\n    return {\"user_id\": \"the current user\"}\n\n\n@app.get(\"/users/{user_id}\")\nasync def read_user(user_id: str):\n    return {\"user_id\": user_id}\n```\n\n否则，`/users/{user_id}` 的路径还将与 `/users/me` 相匹配，\"认为\"自己正在接收一个值为 `\"me\"` 的 `user_id` 参数。\n\n## 预设值\n\n如果你有一个接收路径参数的路径操作，但你希望预先设定可能的有效参数值，则可以使用标准的 `Python Enum` 类型。\n\n### 创建一个 Enum 类\n\n导入 `Enum` 并创建一个继承自 `str` 和 `Enum` 的子类。\n\n通过从 `str` 继承，`API`文档将能够知道这些值必须为 `string` 类型并且能够正确地展示出来。\n\n然后创建具有固定值的类属性，这些固定值将是可用的有效值：\n\n```python\nfrom enum import Enum\nfrom fastapi import FastAPI\n\nclass ModelName(str, Enum):\n    holy = \"holy\"\n    jack = \"jack\"\n    tony = \"tony\"\n\napp = FastAPI()\n\n@app.get(\"/model/{model_name}\")\nasync def get_model(model_name: ModelName):\n    if model_name == ModelName.holy:\n        return {\"model_name\": model_name, \"messagge\": \"好好学习！\"}\n    if model_name == ModelName.jack:\n        return {\"model_name\": model_name, \"message\": \"我对钱没有兴趣！\"}\n    \n    return {\"model_name\": model_name, \"message\": \"欢乐时光就要来临了！\"}\n```\n\n输出结果：\n\n```python\n{\"model_name\":\"jack\",\"message\":\"我对钱没有兴趣！\"}\n```\n\n### 获取枚举值\n\n可以使用 `model_name.value` 或通常来说 `your_enum_member.value` 来获取实际的值（在这个例子中为 str）。\n\n{% colorpanel warning Tip %}\n\n你也可以通过 ModelName.tony.value 来获取值 \"tony\"。\n\n{% endcolorpanel %}\n\n### 返回枚举成员\n\n你以从路径操作中返回枚举成员，即使嵌套在 `JSON` 结构中（例如一个 `dict` 中）。\n\n## 包含路径的路径参数\n\n### 路径转换器\n\n可以使用直接来自 `Starlette` 的选项来声明一个包含路径的路径参数：\n\n```python\n/files/{file_path:path}\n```\n\n在这种情况下，参数的名称为 `file_path`，结尾部分的 :`path` 说明该参数应匹配任意的路径。\n\n因此，可以这样使用它：\n\n```python\nfrom fastapi import FastAPI\napp = FastAPI()\n\n\n@app.get(\"/files/{file_path:path}\")\n\nasync def read_file(file_path: str):\n    return {\"file_path\": file_path}\n```\n\n访问`http://127.0.0.1:8000/files/linux/holy`输出结果如下：\n\n```python\n{\"file_path\":\"/root/holy\"}\n```\n\n{% colorpanel warning Tip %}\n\n可能会需要参数包含 /home/johndoe/myfile.txt，以斜杠（/）开头。\n\n在这种情况下，URL 将会是 /files//home/johndoe/myfile.txt，在files 和 home 之间有一个双斜杠（//）。\n{% endcolorpanel %}","source":"_posts/FastAPI教程-路径参数.md","raw":"---\ntitle: FastAPI教程-路径参数\ntags:\n  - fastapi\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-30 22:47:15\ncategories: FastAPI\npic:\n---\n\n可以使用与 `Python` 格式化字符串相同的语法来声明路径\"参数\"或\"变量\"：\n\n```python\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id):\n    return {\"item_id\": item_id}\n```\n\n路径参数 `item_id` 的值将作为参数 `item_id` 传递给你的函数。\n\n所以，运行示例并访问 [http://127.0.0.1:8000/items/foo](http://127.0.0.1:8000/items/foo)，将会看到如下响应：\n\n```python\n{\"item_id\":\"foo\"}\n```\n\n## 有类型的路径参数\n\n可以使用标准的 `Python` 类型标注为函数中的路径参数声明类型。\n\n```python\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id: int):\n    return {\"item_id\": item_id}\n```\n\n在这个例子中，`item_id` 被声明为 `int` 类型。\n\n{% colorpanel success Check %}\n\n这将为你的函数提供编辑器支持，包括错误检查、代码补全等等。\n\n{% endcolorpanel %}\n\n## 数据转换\n\n如果运行示例并打开浏览器访问[http://127.0.0.1:8000/items/3](http://127.0.0.1:8000/items/3)，将得到如下响应：\n\n```python\n{\"item_id\":3}\n```\n\n{% colorpanel success Check %}\n\n注意函数接收（并返回）的值为 3，是一个 Python int 值，而不是字符串 \"3\"。\n\n所以，`FastAPI` 通过上面的类型声明提供了对请求的自动\"解析\"。\n\n{% endcolorpanel %}\n\n## 数据校验\n\n但如果你通过浏览器访问[http://127.0.0.1:8000/items/foo](http://127.0.0.1:8000/items/foo)，你会看到一个清晰可读的 HTTP 错误：\n\n```python\n{\n    \"detail\": [\n        {\n            \"loc\": [\n                \"path\",\n                \"item_id\"\n            ],\n            \"msg\": \"value is not a valid integer\",\n            \"type\": \"type_error.integer\"\n        }\n    ]\n}\n```\n\n因为路径参数 `item_id` 传入的值为 `\"foo\"`，它不是一个 `int`。\n\n如果你提供的是 `float` 而非整数也会出现同样的错误，比如：[http://127.0.0.1:8000/items/1.2](http://127.0.0.1:8000/items/1.2)\n\n{% colorpanel success Check %}\n\n所以，通过同样的 Python 类型声明，FastAPI 提供了数据校验功能。\n\n注意上面的错误同样清楚地指出了校验未通过的具体原因。\n\n在开发和调试与你的 API 进行交互的代码时，这非常有用。\n\n{% endcolorpanel %}\n\n## 文档\n\n打开浏览器访问[http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)，你将看到自动生成的交互式 `API` 文档：\n\n![](Screenshot_1.webp)\n\n## 路径操作的顺序\n\n在创建路径操作时，你会发现有些情况下路径是固定的。\n\n比如 `/users/me`，我们假设它用来获取关于当前用户的数据.\n\n然后，你还可以使用路径 `/users/{user_id}` 来通过用户 `ID` 获取关于特定用户的数据。\n\n由于路径操作是按顺序依次运行的，你需要确保路径 `/users/me` 声明在路径 `/users/{user_id}`之前：\n\n```python\nfrom fastapi import FastAPI\napp = FastAPI()\n\n@app.get(\"/users/me\")\nasync def read_user_me():\n    return {\"user_id\": \"the current user\"}\n\n\n@app.get(\"/users/{user_id}\")\nasync def read_user(user_id: str):\n    return {\"user_id\": user_id}\n```\n\n否则，`/users/{user_id}` 的路径还将与 `/users/me` 相匹配，\"认为\"自己正在接收一个值为 `\"me\"` 的 `user_id` 参数。\n\n## 预设值\n\n如果你有一个接收路径参数的路径操作，但你希望预先设定可能的有效参数值，则可以使用标准的 `Python Enum` 类型。\n\n### 创建一个 Enum 类\n\n导入 `Enum` 并创建一个继承自 `str` 和 `Enum` 的子类。\n\n通过从 `str` 继承，`API`文档将能够知道这些值必须为 `string` 类型并且能够正确地展示出来。\n\n然后创建具有固定值的类属性，这些固定值将是可用的有效值：\n\n```python\nfrom enum import Enum\nfrom fastapi import FastAPI\n\nclass ModelName(str, Enum):\n    holy = \"holy\"\n    jack = \"jack\"\n    tony = \"tony\"\n\napp = FastAPI()\n\n@app.get(\"/model/{model_name}\")\nasync def get_model(model_name: ModelName):\n    if model_name == ModelName.holy:\n        return {\"model_name\": model_name, \"messagge\": \"好好学习！\"}\n    if model_name == ModelName.jack:\n        return {\"model_name\": model_name, \"message\": \"我对钱没有兴趣！\"}\n    \n    return {\"model_name\": model_name, \"message\": \"欢乐时光就要来临了！\"}\n```\n\n输出结果：\n\n```python\n{\"model_name\":\"jack\",\"message\":\"我对钱没有兴趣！\"}\n```\n\n### 获取枚举值\n\n可以使用 `model_name.value` 或通常来说 `your_enum_member.value` 来获取实际的值（在这个例子中为 str）。\n\n{% colorpanel warning Tip %}\n\n你也可以通过 ModelName.tony.value 来获取值 \"tony\"。\n\n{% endcolorpanel %}\n\n### 返回枚举成员\n\n你以从路径操作中返回枚举成员，即使嵌套在 `JSON` 结构中（例如一个 `dict` 中）。\n\n## 包含路径的路径参数\n\n### 路径转换器\n\n可以使用直接来自 `Starlette` 的选项来声明一个包含路径的路径参数：\n\n```python\n/files/{file_path:path}\n```\n\n在这种情况下，参数的名称为 `file_path`，结尾部分的 :`path` 说明该参数应匹配任意的路径。\n\n因此，可以这样使用它：\n\n```python\nfrom fastapi import FastAPI\napp = FastAPI()\n\n\n@app.get(\"/files/{file_path:path}\")\n\nasync def read_file(file_path: str):\n    return {\"file_path\": file_path}\n```\n\n访问`http://127.0.0.1:8000/files/linux/holy`输出结果如下：\n\n```python\n{\"file_path\":\"/root/holy\"}\n```\n\n{% colorpanel warning Tip %}\n\n可能会需要参数包含 /home/johndoe/myfile.txt，以斜杠（/）开头。\n\n在这种情况下，URL 将会是 /files//home/johndoe/myfile.txt，在files 和 home 之间有一个双斜杠（//）。\n{% endcolorpanel %}","slug":"FastAPI教程-路径参数","published":1,"updated":"2021-06-15T15:47:31.601Z","layout":"post","photos":[],"link":"","_id":"ckq14rx23000r44ud9msme734","content":"<p>可以使用与 <code>Python</code> 格式化字符串相同的语法来声明路径”参数”或”变量”：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_item</span>(<span class=\"params\">item_id</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure>\n\n<p>路径参数 <code>item_id</code> 的值将作为参数 <code>item_id</code> 传递给你的函数。</p>\n<p>所以，运行示例并访问 <a href=\"http://127.0.0.1:8000/items/foo\">http://127.0.0.1:8000/items/foo</a>，将会看到如下响应：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&quot;item_id&quot;</span>:<span class=\"string\">&quot;foo&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"有类型的路径参数\"><a href=\"#有类型的路径参数\" class=\"headerlink\" title=\"有类型的路径参数\"></a>有类型的路径参数</h2><p>可以使用标准的 <code>Python</code> 类型标注为函数中的路径参数声明类型。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_item</span>(<span class=\"params\">item_id: <span class=\"built_in\">int</span></span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在这个例子中，<code>item_id</code> 被声明为 <code>int</code> 类型。</p>\n<div class=\"panel panel-success\">\n    <div class=\"panel-title\">Check</div>\n    <div class=\"panel-body\">\n        <p>这将为你的函数提供编辑器支持，包括错误检查、代码补全等等。</p>\n\n    </div>\n    </div>\n\n<h2 id=\"数据转换\"><a href=\"#数据转换\" class=\"headerlink\" title=\"数据转换\"></a>数据转换</h2><p>如果运行示例并打开浏览器访问<a href=\"http://127.0.0.1:8000/items/3\">http://127.0.0.1:8000/items/3</a>，将得到如下响应：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&quot;item_id&quot;</span>:<span class=\"number\">3</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"panel panel-success\">\n    <div class=\"panel-title\">Check</div>\n    <div class=\"panel-body\">\n        <p>注意函数接收（并返回）的值为 3，是一个 Python int 值，而不是字符串 “3”。</p>\n<p>所以，<code>FastAPI</code> 通过上面的类型声明提供了对请求的自动”解析”。</p>\n\n    </div>\n    </div>\n\n<h2 id=\"数据校验\"><a href=\"#数据校验\" class=\"headerlink\" title=\"数据校验\"></a>数据校验</h2><p>但如果你通过浏览器访问<a href=\"http://127.0.0.1:8000/items/foo\">http://127.0.0.1:8000/items/foo</a>，你会看到一个清晰可读的 HTTP 错误：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;detail&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;loc&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;path&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;item_id&quot;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&quot;msg&quot;</span>: <span class=\"string\">&quot;value is not a valid integer&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;type_error.integer&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>因为路径参数 <code>item_id</code> 传入的值为 <code>&quot;foo&quot;</code>，它不是一个 <code>int</code>。</p>\n<p>如果你提供的是 <code>float</code> 而非整数也会出现同样的错误，比如：<a href=\"http://127.0.0.1:8000/items/1.2\">http://127.0.0.1:8000/items/1.2</a></p>\n<div class=\"panel panel-success\">\n    <div class=\"panel-title\">Check</div>\n    <div class=\"panel-body\">\n        <p>所以，通过同样的 Python 类型声明，FastAPI 提供了数据校验功能。</p>\n<p>注意上面的错误同样清楚地指出了校验未通过的具体原因。</p>\n<p>在开发和调试与你的 API 进行交互的代码时，这非常有用。</p>\n\n    </div>\n    </div>\n\n<h2 id=\"文档\"><a href=\"#文档\" class=\"headerlink\" title=\"文档\"></a>文档</h2><p>打开浏览器访问<a href=\"http://127.0.0.1:8000/docs\">http://127.0.0.1:8000/docs</a>，你将看到自动生成的交互式 <code>API</code> 文档：</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<h2 id=\"路径操作的顺序\"><a href=\"#路径操作的顺序\" class=\"headerlink\" title=\"路径操作的顺序\"></a>路径操作的顺序</h2><p>在创建路径操作时，你会发现有些情况下路径是固定的。</p>\n<p>比如 <code>/users/me</code>，我们假设它用来获取关于当前用户的数据.</p>\n<p>然后，你还可以使用路径 <code>/users/&#123;user_id&#125;</code> 来通过用户 <code>ID</code> 获取关于特定用户的数据。</p>\n<p>由于路径操作是按顺序依次运行的，你需要确保路径 <code>/users/me</code> 声明在路径 <code>/users/&#123;user_id&#125;</code>之前：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/users/me&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_user_me</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;user_id&quot;</span>: <span class=\"string\">&quot;the current user&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/users/&#123;user_id&#125;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_user</span>(<span class=\"params\">user_id: <span class=\"built_in\">str</span></span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;user_id&quot;</span>: user_id&#125;</span><br></pre></td></tr></table></figure>\n\n<p>否则，<code>/users/&#123;user_id&#125;</code> 的路径还将与 <code>/users/me</code> 相匹配，”认为”自己正在接收一个值为 <code>&quot;me&quot;</code> 的 <code>user_id</code> 参数。</p>\n<h2 id=\"预设值\"><a href=\"#预设值\" class=\"headerlink\" title=\"预设值\"></a>预设值</h2><p>如果你有一个接收路径参数的路径操作，但你希望预先设定可能的有效参数值，则可以使用标准的 <code>Python Enum</code> 类型。</p>\n<h3 id=\"创建一个-Enum-类\"><a href=\"#创建一个-Enum-类\" class=\"headerlink\" title=\"创建一个 Enum 类\"></a>创建一个 Enum 类</h3><p>导入 <code>Enum</code> 并创建一个继承自 <code>str</code> 和 <code>Enum</code> 的子类。</p>\n<p>通过从 <code>str</code> 继承，<code>API</code>文档将能够知道这些值必须为 <code>string</code> 类型并且能够正确地展示出来。</p>\n<p>然后创建具有固定值的类属性，这些固定值将是可用的有效值：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> enum <span class=\"keyword\">import</span> Enum</span><br><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ModelName</span>(<span class=\"params\"><span class=\"built_in\">str</span>, Enum</span>):</span></span><br><span class=\"line\">    holy = <span class=\"string\">&quot;holy&quot;</span></span><br><span class=\"line\">    jack = <span class=\"string\">&quot;jack&quot;</span></span><br><span class=\"line\">    tony = <span class=\"string\">&quot;tony&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/model/&#123;model_name&#125;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_model</span>(<span class=\"params\">model_name: ModelName</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> model_name == ModelName.holy:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;model_name&quot;</span>: model_name, <span class=\"string\">&quot;messagge&quot;</span>: <span class=\"string\">&quot;好好学习！&quot;</span>&#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> model_name == ModelName.jack:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;model_name&quot;</span>: model_name, <span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;我对钱没有兴趣！&quot;</span>&#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;model_name&quot;</span>: model_name, <span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;欢乐时光就要来临了！&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&quot;model_name&quot;</span>:<span class=\"string\">&quot;jack&quot;</span>,<span class=\"string\">&quot;message&quot;</span>:<span class=\"string\">&quot;我对钱没有兴趣！&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"获取枚举值\"><a href=\"#获取枚举值\" class=\"headerlink\" title=\"获取枚举值\"></a>获取枚举值</h3><p>可以使用 <code>model_name.value</code> 或通常来说 <code>your_enum_member.value</code> 来获取实际的值（在这个例子中为 str）。</p>\n<div class=\"panel panel-warning\">\n    <div class=\"panel-title\">Tip</div>\n    <div class=\"panel-body\">\n        <p>你也可以通过 ModelName.tony.value 来获取值 “tony”。</p>\n\n    </div>\n    </div>\n\n<h3 id=\"返回枚举成员\"><a href=\"#返回枚举成员\" class=\"headerlink\" title=\"返回枚举成员\"></a>返回枚举成员</h3><p>你以从路径操作中返回枚举成员，即使嵌套在 <code>JSON</code> 结构中（例如一个 <code>dict</code> 中）。</p>\n<h2 id=\"包含路径的路径参数\"><a href=\"#包含路径的路径参数\" class=\"headerlink\" title=\"包含路径的路径参数\"></a>包含路径的路径参数</h2><h3 id=\"路径转换器\"><a href=\"#路径转换器\" class=\"headerlink\" title=\"路径转换器\"></a>路径转换器</h3><p>可以使用直接来自 <code>Starlette</code> 的选项来声明一个包含路径的路径参数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/files/&#123;file_path:path&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在这种情况下，参数的名称为 <code>file_path</code>，结尾部分的 :<code>path</code> 说明该参数应匹配任意的路径。</p>\n<p>因此，可以这样使用它：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/files/&#123;file_path:path&#125;&quot;</span></span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_file</span>(<span class=\"params\">file_path: <span class=\"built_in\">str</span></span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;file_path&quot;</span>: file_path&#125;</span><br></pre></td></tr></table></figure>\n\n<p>访问<code>http://127.0.0.1:8000/files/linux/holy</code>输出结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&quot;file_path&quot;</span>:<span class=\"string\">&quot;/root/holy&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"panel panel-warning\">\n    <div class=\"panel-title\">Tip</div>\n    <div class=\"panel-body\">\n        <p>可能会需要参数包含 /home/johndoe/myfile.txt，以斜杠（/）开头。</p>\n<p>在这种情况下，URL 将会是 /files//home/johndoe/myfile.txt，在files 和 home 之间有一个双斜杠（//）。</p>\n\n    </div>\n    </div>","site":{"data":{}},"excerpt":"","more":"<p>可以使用与 <code>Python</code> 格式化字符串相同的语法来声明路径”参数”或”变量”：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_item</span>(<span class=\"params\">item_id</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure>\n\n<p>路径参数 <code>item_id</code> 的值将作为参数 <code>item_id</code> 传递给你的函数。</p>\n<p>所以，运行示例并访问 <a href=\"http://127.0.0.1:8000/items/foo\">http://127.0.0.1:8000/items/foo</a>，将会看到如下响应：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&quot;item_id&quot;</span>:<span class=\"string\">&quot;foo&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"有类型的路径参数\"><a href=\"#有类型的路径参数\" class=\"headerlink\" title=\"有类型的路径参数\"></a>有类型的路径参数</h2><p>可以使用标准的 <code>Python</code> 类型标注为函数中的路径参数声明类型。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_item</span>(<span class=\"params\">item_id: <span class=\"built_in\">int</span></span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在这个例子中，<code>item_id</code> 被声明为 <code>int</code> 类型。</p>\n<div class=\"panel panel-success\">\n    <div class=\"panel-title\">Check</div>\n    <div class=\"panel-body\">\n        <p>这将为你的函数提供编辑器支持，包括错误检查、代码补全等等。</p>\n\n    </div>\n    </div>\n\n<h2 id=\"数据转换\"><a href=\"#数据转换\" class=\"headerlink\" title=\"数据转换\"></a>数据转换</h2><p>如果运行示例并打开浏览器访问<a href=\"http://127.0.0.1:8000/items/3\">http://127.0.0.1:8000/items/3</a>，将得到如下响应：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&quot;item_id&quot;</span>:<span class=\"number\">3</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"panel panel-success\">\n    <div class=\"panel-title\">Check</div>\n    <div class=\"panel-body\">\n        <p>注意函数接收（并返回）的值为 3，是一个 Python int 值，而不是字符串 “3”。</p>\n<p>所以，<code>FastAPI</code> 通过上面的类型声明提供了对请求的自动”解析”。</p>\n\n    </div>\n    </div>\n\n<h2 id=\"数据校验\"><a href=\"#数据校验\" class=\"headerlink\" title=\"数据校验\"></a>数据校验</h2><p>但如果你通过浏览器访问<a href=\"http://127.0.0.1:8000/items/foo\">http://127.0.0.1:8000/items/foo</a>，你会看到一个清晰可读的 HTTP 错误：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;detail&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;loc&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;path&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;item_id&quot;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&quot;msg&quot;</span>: <span class=\"string\">&quot;value is not a valid integer&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;type_error.integer&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>因为路径参数 <code>item_id</code> 传入的值为 <code>&quot;foo&quot;</code>，它不是一个 <code>int</code>。</p>\n<p>如果你提供的是 <code>float</code> 而非整数也会出现同样的错误，比如：<a href=\"http://127.0.0.1:8000/items/1.2\">http://127.0.0.1:8000/items/1.2</a></p>\n<div class=\"panel panel-success\">\n    <div class=\"panel-title\">Check</div>\n    <div class=\"panel-body\">\n        <p>所以，通过同样的 Python 类型声明，FastAPI 提供了数据校验功能。</p>\n<p>注意上面的错误同样清楚地指出了校验未通过的具体原因。</p>\n<p>在开发和调试与你的 API 进行交互的代码时，这非常有用。</p>\n\n    </div>\n    </div>\n\n<h2 id=\"文档\"><a href=\"#文档\" class=\"headerlink\" title=\"文档\"></a>文档</h2><p>打开浏览器访问<a href=\"http://127.0.0.1:8000/docs\">http://127.0.0.1:8000/docs</a>，你将看到自动生成的交互式 <code>API</code> 文档：</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<h2 id=\"路径操作的顺序\"><a href=\"#路径操作的顺序\" class=\"headerlink\" title=\"路径操作的顺序\"></a>路径操作的顺序</h2><p>在创建路径操作时，你会发现有些情况下路径是固定的。</p>\n<p>比如 <code>/users/me</code>，我们假设它用来获取关于当前用户的数据.</p>\n<p>然后，你还可以使用路径 <code>/users/&#123;user_id&#125;</code> 来通过用户 <code>ID</code> 获取关于特定用户的数据。</p>\n<p>由于路径操作是按顺序依次运行的，你需要确保路径 <code>/users/me</code> 声明在路径 <code>/users/&#123;user_id&#125;</code>之前：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/users/me&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_user_me</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;user_id&quot;</span>: <span class=\"string\">&quot;the current user&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/users/&#123;user_id&#125;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_user</span>(<span class=\"params\">user_id: <span class=\"built_in\">str</span></span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;user_id&quot;</span>: user_id&#125;</span><br></pre></td></tr></table></figure>\n\n<p>否则，<code>/users/&#123;user_id&#125;</code> 的路径还将与 <code>/users/me</code> 相匹配，”认为”自己正在接收一个值为 <code>&quot;me&quot;</code> 的 <code>user_id</code> 参数。</p>\n<h2 id=\"预设值\"><a href=\"#预设值\" class=\"headerlink\" title=\"预设值\"></a>预设值</h2><p>如果你有一个接收路径参数的路径操作，但你希望预先设定可能的有效参数值，则可以使用标准的 <code>Python Enum</code> 类型。</p>\n<h3 id=\"创建一个-Enum-类\"><a href=\"#创建一个-Enum-类\" class=\"headerlink\" title=\"创建一个 Enum 类\"></a>创建一个 Enum 类</h3><p>导入 <code>Enum</code> 并创建一个继承自 <code>str</code> 和 <code>Enum</code> 的子类。</p>\n<p>通过从 <code>str</code> 继承，<code>API</code>文档将能够知道这些值必须为 <code>string</code> 类型并且能够正确地展示出来。</p>\n<p>然后创建具有固定值的类属性，这些固定值将是可用的有效值：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> enum <span class=\"keyword\">import</span> Enum</span><br><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ModelName</span>(<span class=\"params\"><span class=\"built_in\">str</span>, Enum</span>):</span></span><br><span class=\"line\">    holy = <span class=\"string\">&quot;holy&quot;</span></span><br><span class=\"line\">    jack = <span class=\"string\">&quot;jack&quot;</span></span><br><span class=\"line\">    tony = <span class=\"string\">&quot;tony&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/model/&#123;model_name&#125;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_model</span>(<span class=\"params\">model_name: ModelName</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> model_name == ModelName.holy:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;model_name&quot;</span>: model_name, <span class=\"string\">&quot;messagge&quot;</span>: <span class=\"string\">&quot;好好学习！&quot;</span>&#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> model_name == ModelName.jack:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;model_name&quot;</span>: model_name, <span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;我对钱没有兴趣！&quot;</span>&#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;model_name&quot;</span>: model_name, <span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;欢乐时光就要来临了！&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&quot;model_name&quot;</span>:<span class=\"string\">&quot;jack&quot;</span>,<span class=\"string\">&quot;message&quot;</span>:<span class=\"string\">&quot;我对钱没有兴趣！&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"获取枚举值\"><a href=\"#获取枚举值\" class=\"headerlink\" title=\"获取枚举值\"></a>获取枚举值</h3><p>可以使用 <code>model_name.value</code> 或通常来说 <code>your_enum_member.value</code> 来获取实际的值（在这个例子中为 str）。</p>\n<div class=\"panel panel-warning\">\n    <div class=\"panel-title\">Tip</div>\n    <div class=\"panel-body\">\n        <p>你也可以通过 ModelName.tony.value 来获取值 “tony”。</p>\n\n    </div>\n    </div>\n\n<h3 id=\"返回枚举成员\"><a href=\"#返回枚举成员\" class=\"headerlink\" title=\"返回枚举成员\"></a>返回枚举成员</h3><p>你以从路径操作中返回枚举成员，即使嵌套在 <code>JSON</code> 结构中（例如一个 <code>dict</code> 中）。</p>\n<h2 id=\"包含路径的路径参数\"><a href=\"#包含路径的路径参数\" class=\"headerlink\" title=\"包含路径的路径参数\"></a>包含路径的路径参数</h2><h3 id=\"路径转换器\"><a href=\"#路径转换器\" class=\"headerlink\" title=\"路径转换器\"></a>路径转换器</h3><p>可以使用直接来自 <code>Starlette</code> 的选项来声明一个包含路径的路径参数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/files/&#123;file_path:path&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在这种情况下，参数的名称为 <code>file_path</code>，结尾部分的 :<code>path</code> 说明该参数应匹配任意的路径。</p>\n<p>因此，可以这样使用它：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> fastapi <span class=\"keyword\">import</span> FastAPI</span><br><span class=\"line\">app = FastAPI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&quot;/files/&#123;file_path:path&#125;&quot;</span></span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">read_file</span>(<span class=\"params\">file_path: <span class=\"built_in\">str</span></span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;file_path&quot;</span>: file_path&#125;</span><br></pre></td></tr></table></figure>\n\n<p>访问<code>http://127.0.0.1:8000/files/linux/holy</code>输出结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&quot;file_path&quot;</span>:<span class=\"string\">&quot;/root/holy&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"panel panel-warning\">\n    <div class=\"panel-title\">Tip</div>\n    <div class=\"panel-body\">\n        <p>可能会需要参数包含 /home/johndoe/myfile.txt，以斜杠（/）开头。</p>\n<p>在这种情况下，URL 将会是 /files//home/johndoe/myfile.txt，在files 和 home 之间有一个双斜杠（//）。</p>\n\n    </div>\n    </div>"},{"title":"Flask安装","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-30T06:24:17.000Z","pic":null,"_content":"\n# 安装\n\n## Python版本\n\n推荐使用最新版本的`Python3` 。 `Flask`支持`Python 3.5`及更高版本的`Python 3` 、`Python 2.7`和`PyPy`。\n\n## 依赖\n\n当安装`Flask`时，以下配套软件会被自动安装。\n\n- `Werkzeug`用于实现`WSGI`，应用和服务之间的标准`Python`接口。\n\n- `Jinja`用于渲染页面的模板语言。\n\n- `MarkupSafe`与`Jinja`共用，在渲染页面时用于避免不可信的输入，防止注入攻击。\n\n- `ItsDangerous`保证数据完整性的安全标志数据，用于保护`Flask`的`session cookie`.\n\n- `Click`是一个命令行应用的框架。用于提供`flask`命令，并允许添加自定义管理命令。\n\n## 可选依赖\n\n以下配套软件不会被自动安装。如果安装了，那么`Flask`会检测到这些软件。\n\n- `Blinker`为信号提供支持。\n\n- `SimpleJSON`是一个快速的`JSON`实现，兼容`Python’s json`模块。如果安装了这个软件，那么会优先使用这个软件来进行`JSON`操作。\n\n- `python-dotenv`当运行`flask`命令时为通过`dotenv`设置环境变量 提供支持。\n\n- `Watchdog`为开发服务器提供快速高效的重载。\n\n## 虚拟环境\n\n建议在开发环境和生产环境下都使用虚拟环境来管理项目的依赖。\n\n为什么要使用虚拟环境？随着你的Python项目越来越多，你会发现不同的项目会需要不同的版本的Python库。同一个Python库的不同版本可能不兼容。\n\n虚拟环境可以为每一个项目安装独立的Python库，这样就可以隔离不同项目之间的Python库，也可以隔离项目与操作系统之间的Python库。\n\nPython3内置了用于创建虚拟环境的`venv`模块。如果你使用的是较新的Python版本，那么可以按照下面的步骤创建虚拟环境。\n\n## 创建一个虚拟环境\n\n创建一个项目文件夹，然后创建一个虚拟环境。创建完成后项目文件夹中会有一个`venv`文件夹：\n\n```shell\nmkdir myproject\ncd myproject\npython3 -m venv venv\n```\n\n在`Windows`下：\n\n```shell\npy -3 -m venv venv\n```\n\n在老版本的`Python`中要使用下面的命令创建虚拟环境：\n\n```shell\npython2 -m virtualenv venv\n```\n\n在`Windows`下：\n\n```shell\n\\Python27\\Scripts\\virtualenv.exe venv\n```\n\n### 激活python环境\n\n在开始工作前，先要激活相应的虚拟环境：\n\n```shell\n. venv/bin/activate\n```\n\n在`Windows`下：\n\n```shell\nvenv\\Scripts\\activate\n```\n\n激活后，你的终端提示符会显示虚拟环境的名称。\n\n{% alertbox info \"如果你使用的VS code，要在cmd命令行下激活虚拟环境，如果是power shell则不可以。\" %}\n\n## 安装Flask\n\n在已激活的虚拟环境中可以使用如下命令安装`Flask`：\n\n```python\npip install Flask\n```\n\n`Flask`现在已经安装完毕。\n","source":"_posts/Flask安装.md","raw":"---\ntitle: Flask安装\ntags:\n  - flask\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-30 14:24:17\ncategories: Flask\npic:\n---\n\n# 安装\n\n## Python版本\n\n推荐使用最新版本的`Python3` 。 `Flask`支持`Python 3.5`及更高版本的`Python 3` 、`Python 2.7`和`PyPy`。\n\n## 依赖\n\n当安装`Flask`时，以下配套软件会被自动安装。\n\n- `Werkzeug`用于实现`WSGI`，应用和服务之间的标准`Python`接口。\n\n- `Jinja`用于渲染页面的模板语言。\n\n- `MarkupSafe`与`Jinja`共用，在渲染页面时用于避免不可信的输入，防止注入攻击。\n\n- `ItsDangerous`保证数据完整性的安全标志数据，用于保护`Flask`的`session cookie`.\n\n- `Click`是一个命令行应用的框架。用于提供`flask`命令，并允许添加自定义管理命令。\n\n## 可选依赖\n\n以下配套软件不会被自动安装。如果安装了，那么`Flask`会检测到这些软件。\n\n- `Blinker`为信号提供支持。\n\n- `SimpleJSON`是一个快速的`JSON`实现，兼容`Python’s json`模块。如果安装了这个软件，那么会优先使用这个软件来进行`JSON`操作。\n\n- `python-dotenv`当运行`flask`命令时为通过`dotenv`设置环境变量 提供支持。\n\n- `Watchdog`为开发服务器提供快速高效的重载。\n\n## 虚拟环境\n\n建议在开发环境和生产环境下都使用虚拟环境来管理项目的依赖。\n\n为什么要使用虚拟环境？随着你的Python项目越来越多，你会发现不同的项目会需要不同的版本的Python库。同一个Python库的不同版本可能不兼容。\n\n虚拟环境可以为每一个项目安装独立的Python库，这样就可以隔离不同项目之间的Python库，也可以隔离项目与操作系统之间的Python库。\n\nPython3内置了用于创建虚拟环境的`venv`模块。如果你使用的是较新的Python版本，那么可以按照下面的步骤创建虚拟环境。\n\n## 创建一个虚拟环境\n\n创建一个项目文件夹，然后创建一个虚拟环境。创建完成后项目文件夹中会有一个`venv`文件夹：\n\n```shell\nmkdir myproject\ncd myproject\npython3 -m venv venv\n```\n\n在`Windows`下：\n\n```shell\npy -3 -m venv venv\n```\n\n在老版本的`Python`中要使用下面的命令创建虚拟环境：\n\n```shell\npython2 -m virtualenv venv\n```\n\n在`Windows`下：\n\n```shell\n\\Python27\\Scripts\\virtualenv.exe venv\n```\n\n### 激活python环境\n\n在开始工作前，先要激活相应的虚拟环境：\n\n```shell\n. venv/bin/activate\n```\n\n在`Windows`下：\n\n```shell\nvenv\\Scripts\\activate\n```\n\n激活后，你的终端提示符会显示虚拟环境的名称。\n\n{% alertbox info \"如果你使用的VS code，要在cmd命令行下激活虚拟环境，如果是power shell则不可以。\" %}\n\n## 安装Flask\n\n在已激活的虚拟环境中可以使用如下命令安装`Flask`：\n\n```python\npip install Flask\n```\n\n`Flask`现在已经安装完毕。\n","slug":"Flask安装","published":1,"updated":"2021-06-15T15:47:31.601Z","layout":"post","photos":[],"link":"","_id":"ckq14rx23000t44ud3y854fmi","content":"<h1 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h1><h2 id=\"Python版本\"><a href=\"#Python版本\" class=\"headerlink\" title=\"Python版本\"></a>Python版本</h2><p>推荐使用最新版本的<code>Python3</code> 。 <code>Flask</code>支持<code>Python 3.5</code>及更高版本的<code>Python 3</code> 、<code>Python 2.7</code>和<code>PyPy</code>。</p>\n<h2 id=\"依赖\"><a href=\"#依赖\" class=\"headerlink\" title=\"依赖\"></a>依赖</h2><p>当安装<code>Flask</code>时，以下配套软件会被自动安装。</p>\n<ul>\n<li><p><code>Werkzeug</code>用于实现<code>WSGI</code>，应用和服务之间的标准<code>Python</code>接口。</p>\n</li>\n<li><p><code>Jinja</code>用于渲染页面的模板语言。</p>\n</li>\n<li><p><code>MarkupSafe</code>与<code>Jinja</code>共用，在渲染页面时用于避免不可信的输入，防止注入攻击。</p>\n</li>\n<li><p><code>ItsDangerous</code>保证数据完整性的安全标志数据，用于保护<code>Flask</code>的<code>session cookie</code>.</p>\n</li>\n<li><p><code>Click</code>是一个命令行应用的框架。用于提供<code>flask</code>命令，并允许添加自定义管理命令。</p>\n</li>\n</ul>\n<h2 id=\"可选依赖\"><a href=\"#可选依赖\" class=\"headerlink\" title=\"可选依赖\"></a>可选依赖</h2><p>以下配套软件不会被自动安装。如果安装了，那么<code>Flask</code>会检测到这些软件。</p>\n<ul>\n<li><p><code>Blinker</code>为信号提供支持。</p>\n</li>\n<li><p><code>SimpleJSON</code>是一个快速的<code>JSON</code>实现，兼容<code>Python’s json</code>模块。如果安装了这个软件，那么会优先使用这个软件来进行<code>JSON</code>操作。</p>\n</li>\n<li><p><code>python-dotenv</code>当运行<code>flask</code>命令时为通过<code>dotenv</code>设置环境变量 提供支持。</p>\n</li>\n<li><p><code>Watchdog</code>为开发服务器提供快速高效的重载。</p>\n</li>\n</ul>\n<h2 id=\"虚拟环境\"><a href=\"#虚拟环境\" class=\"headerlink\" title=\"虚拟环境\"></a>虚拟环境</h2><p>建议在开发环境和生产环境下都使用虚拟环境来管理项目的依赖。</p>\n<p>为什么要使用虚拟环境？随着你的Python项目越来越多，你会发现不同的项目会需要不同的版本的Python库。同一个Python库的不同版本可能不兼容。</p>\n<p>虚拟环境可以为每一个项目安装独立的Python库，这样就可以隔离不同项目之间的Python库，也可以隔离项目与操作系统之间的Python库。</p>\n<p>Python3内置了用于创建虚拟环境的<code>venv</code>模块。如果你使用的是较新的Python版本，那么可以按照下面的步骤创建虚拟环境。</p>\n<h2 id=\"创建一个虚拟环境\"><a href=\"#创建一个虚拟环境\" class=\"headerlink\" title=\"创建一个虚拟环境\"></a>创建一个虚拟环境</h2><p>创建一个项目文件夹，然后创建一个虚拟环境。创建完成后项目文件夹中会有一个<code>venv</code>文件夹：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir myproject</span><br><span class=\"line\">cd myproject</span><br><span class=\"line\">python3 -m venv venv</span><br></pre></td></tr></table></figure>\n\n<p>在<code>Windows</code>下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">py -3 -m venv venv</span><br></pre></td></tr></table></figure>\n\n<p>在老版本的<code>Python</code>中要使用下面的命令创建虚拟环境：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python2 -m virtualenv venv</span><br></pre></td></tr></table></figure>\n\n<p>在<code>Windows</code>下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\Python27\\Scripts\\virtualenv.exe venv</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"激活python环境\"><a href=\"#激活python环境\" class=\"headerlink\" title=\"激活python环境\"></a>激活python环境</h3><p>在开始工作前，先要激活相应的虚拟环境：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">. venv/bin/activate</span><br></pre></td></tr></table></figure>\n\n<p>在<code>Windows</code>下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">venv\\Scripts\\activate</span><br></pre></td></tr></table></figure>\n\n<p>激活后，你的终端提示符会显示虚拟环境的名称。</p>\n<div class=\"alert alert-info\"><p>如果你使用的VS code，要在cmd命令行下激活虚拟环境，如果是power shell则不可以。</p>\n</div>\n\n<h2 id=\"安装Flask\"><a href=\"#安装Flask\" class=\"headerlink\" title=\"安装Flask\"></a>安装Flask</h2><p>在已激活的虚拟环境中可以使用如下命令安装<code>Flask</code>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install Flask</span><br></pre></td></tr></table></figure>\n\n<p><code>Flask</code>现在已经安装完毕。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h1><h2 id=\"Python版本\"><a href=\"#Python版本\" class=\"headerlink\" title=\"Python版本\"></a>Python版本</h2><p>推荐使用最新版本的<code>Python3</code> 。 <code>Flask</code>支持<code>Python 3.5</code>及更高版本的<code>Python 3</code> 、<code>Python 2.7</code>和<code>PyPy</code>。</p>\n<h2 id=\"依赖\"><a href=\"#依赖\" class=\"headerlink\" title=\"依赖\"></a>依赖</h2><p>当安装<code>Flask</code>时，以下配套软件会被自动安装。</p>\n<ul>\n<li><p><code>Werkzeug</code>用于实现<code>WSGI</code>，应用和服务之间的标准<code>Python</code>接口。</p>\n</li>\n<li><p><code>Jinja</code>用于渲染页面的模板语言。</p>\n</li>\n<li><p><code>MarkupSafe</code>与<code>Jinja</code>共用，在渲染页面时用于避免不可信的输入，防止注入攻击。</p>\n</li>\n<li><p><code>ItsDangerous</code>保证数据完整性的安全标志数据，用于保护<code>Flask</code>的<code>session cookie</code>.</p>\n</li>\n<li><p><code>Click</code>是一个命令行应用的框架。用于提供<code>flask</code>命令，并允许添加自定义管理命令。</p>\n</li>\n</ul>\n<h2 id=\"可选依赖\"><a href=\"#可选依赖\" class=\"headerlink\" title=\"可选依赖\"></a>可选依赖</h2><p>以下配套软件不会被自动安装。如果安装了，那么<code>Flask</code>会检测到这些软件。</p>\n<ul>\n<li><p><code>Blinker</code>为信号提供支持。</p>\n</li>\n<li><p><code>SimpleJSON</code>是一个快速的<code>JSON</code>实现，兼容<code>Python’s json</code>模块。如果安装了这个软件，那么会优先使用这个软件来进行<code>JSON</code>操作。</p>\n</li>\n<li><p><code>python-dotenv</code>当运行<code>flask</code>命令时为通过<code>dotenv</code>设置环境变量 提供支持。</p>\n</li>\n<li><p><code>Watchdog</code>为开发服务器提供快速高效的重载。</p>\n</li>\n</ul>\n<h2 id=\"虚拟环境\"><a href=\"#虚拟环境\" class=\"headerlink\" title=\"虚拟环境\"></a>虚拟环境</h2><p>建议在开发环境和生产环境下都使用虚拟环境来管理项目的依赖。</p>\n<p>为什么要使用虚拟环境？随着你的Python项目越来越多，你会发现不同的项目会需要不同的版本的Python库。同一个Python库的不同版本可能不兼容。</p>\n<p>虚拟环境可以为每一个项目安装独立的Python库，这样就可以隔离不同项目之间的Python库，也可以隔离项目与操作系统之间的Python库。</p>\n<p>Python3内置了用于创建虚拟环境的<code>venv</code>模块。如果你使用的是较新的Python版本，那么可以按照下面的步骤创建虚拟环境。</p>\n<h2 id=\"创建一个虚拟环境\"><a href=\"#创建一个虚拟环境\" class=\"headerlink\" title=\"创建一个虚拟环境\"></a>创建一个虚拟环境</h2><p>创建一个项目文件夹，然后创建一个虚拟环境。创建完成后项目文件夹中会有一个<code>venv</code>文件夹：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir myproject</span><br><span class=\"line\">cd myproject</span><br><span class=\"line\">python3 -m venv venv</span><br></pre></td></tr></table></figure>\n\n<p>在<code>Windows</code>下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">py -3 -m venv venv</span><br></pre></td></tr></table></figure>\n\n<p>在老版本的<code>Python</code>中要使用下面的命令创建虚拟环境：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python2 -m virtualenv venv</span><br></pre></td></tr></table></figure>\n\n<p>在<code>Windows</code>下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\Python27\\Scripts\\virtualenv.exe venv</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"激活python环境\"><a href=\"#激活python环境\" class=\"headerlink\" title=\"激活python环境\"></a>激活python环境</h3><p>在开始工作前，先要激活相应的虚拟环境：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">. venv/bin/activate</span><br></pre></td></tr></table></figure>\n\n<p>在<code>Windows</code>下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">venv\\Scripts\\activate</span><br></pre></td></tr></table></figure>\n\n<p>激活后，你的终端提示符会显示虚拟环境的名称。</p>\n<div class=\"alert alert-info\"><p>如果你使用的VS code，要在cmd命令行下激活虚拟环境，如果是power shell则不可以。</p>\n</div>\n\n<h2 id=\"安装Flask\"><a href=\"#安装Flask\" class=\"headerlink\" title=\"安装Flask\"></a>安装Flask</h2><p>在已激活的虚拟环境中可以使用如下命令安装<code>Flask</code>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install Flask</span><br></pre></td></tr></table></figure>\n\n<p><code>Flask</code>现在已经安装完毕。</p>\n"},{"title":"Flask快速上手","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-30T06:56:17.000Z","pic":null,"_content":"\n## 一个最小的应用\n\n一个最小的`Flask`应用如下:\n\n```python\nfrom flask import Flask\napp = Flask(__name__)\n\n@app.route('/')\ndef hello_world():\n    return 'Hello, World!'\n```\n\n那么，这些代码是什么意思呢？\n\n1. 首先我们导入了`Flask`类。 该类的实例将会成为我们的`WSGI`应用。\n\n2. 接着我们创建一个该类的实例。第一个参数是应用模块或者包的名称。如果你使用一个单一模块（就像本例），那么应当使用`__name__`，因为名称会根据这个模块是按应用方式使用还是作为一个模块导入而发生变化（可能是 ‘`__main__`’ ， 也可能是实际导入的名称）。这个参数是必需的，这样`Flask`才能知道在哪里可以找到模板和静态文件等东西。更多内容详见`Flask`文档。\n\n3. 使用`route()`装饰器来告诉`Flask`触发函数的`URL`。\n\n4. 函数名称被用于生成相关联的`URL` 。函数最后返回需要在用户浏览器中显示的信息。\n\n可以使用`flask`命令或者`python`的`-m`开关来运行这个应用。在运行应用之前，需要在终端里导出`FLASK_APP`环境变量:\n\n```shell\n$ export FLASK_APP=hello.py\n$ flask run\n * Running on http://127.0.0.1:5000/\n```\n\n如果是在`Windows`下，那么导出环境变量的语法取决于使用的是哪种命令行解释器。 在`Command Prompt`下:\n\n```shell\nC:\\path\\to\\app>set FLASK_APP=hello.py\n```\n\n还可以使用`python -m flask`:\n\n```shell\n$ export FLASK_APP=hello.py\n$ python -m flask run\n * Running on http://127.0.0.1:5000/\n```\n\n这样就启动了一个非常简单的内建的服务器。这个服务器用于测试应该是足够了，但是用于生产可能是不够的。\n\n## 路由\n\n现代`web`应用都使用有意义的`URL`，这样有助于用户记忆，网页会更得到用户的青睐， 提高回头率。\n\n使用`route()`装饰器来把函数绑定到`URL`:\n\n```python\n@app.route('/')\ndef index():\n    return 'Index Page'\n\n@app.route('/hello')\ndef hello():\n    return 'Hello, World'\n```\n\n","source":"_posts/Flask快速上手.md","raw":"---\ntitle: Flask快速上手\ntags:\n  - flask\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-30 14:56:17\ncategories: Flask\npic:\n---\n\n## 一个最小的应用\n\n一个最小的`Flask`应用如下:\n\n```python\nfrom flask import Flask\napp = Flask(__name__)\n\n@app.route('/')\ndef hello_world():\n    return 'Hello, World!'\n```\n\n那么，这些代码是什么意思呢？\n\n1. 首先我们导入了`Flask`类。 该类的实例将会成为我们的`WSGI`应用。\n\n2. 接着我们创建一个该类的实例。第一个参数是应用模块或者包的名称。如果你使用一个单一模块（就像本例），那么应当使用`__name__`，因为名称会根据这个模块是按应用方式使用还是作为一个模块导入而发生变化（可能是 ‘`__main__`’ ， 也可能是实际导入的名称）。这个参数是必需的，这样`Flask`才能知道在哪里可以找到模板和静态文件等东西。更多内容详见`Flask`文档。\n\n3. 使用`route()`装饰器来告诉`Flask`触发函数的`URL`。\n\n4. 函数名称被用于生成相关联的`URL` 。函数最后返回需要在用户浏览器中显示的信息。\n\n可以使用`flask`命令或者`python`的`-m`开关来运行这个应用。在运行应用之前，需要在终端里导出`FLASK_APP`环境变量:\n\n```shell\n$ export FLASK_APP=hello.py\n$ flask run\n * Running on http://127.0.0.1:5000/\n```\n\n如果是在`Windows`下，那么导出环境变量的语法取决于使用的是哪种命令行解释器。 在`Command Prompt`下:\n\n```shell\nC:\\path\\to\\app>set FLASK_APP=hello.py\n```\n\n还可以使用`python -m flask`:\n\n```shell\n$ export FLASK_APP=hello.py\n$ python -m flask run\n * Running on http://127.0.0.1:5000/\n```\n\n这样就启动了一个非常简单的内建的服务器。这个服务器用于测试应该是足够了，但是用于生产可能是不够的。\n\n## 路由\n\n现代`web`应用都使用有意义的`URL`，这样有助于用户记忆，网页会更得到用户的青睐， 提高回头率。\n\n使用`route()`装饰器来把函数绑定到`URL`:\n\n```python\n@app.route('/')\ndef index():\n    return 'Index Page'\n\n@app.route('/hello')\ndef hello():\n    return 'Hello, World'\n```\n\n","slug":"Flask快速上手","published":1,"updated":"2021-06-15T15:47:31.601Z","layout":"post","photos":[],"link":"","_id":"ckq14rx25000y44udgmmrg69i","content":"<h2 id=\"一个最小的应用\"><a href=\"#一个最小的应用\" class=\"headerlink\" title=\"一个最小的应用\"></a>一个最小的应用</h2><p>一个最小的<code>Flask</code>应用如下:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello_world</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello, World!&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>那么，这些代码是什么意思呢？</p>\n<ol>\n<li><p>首先我们导入了<code>Flask</code>类。 该类的实例将会成为我们的<code>WSGI</code>应用。</p>\n</li>\n<li><p>接着我们创建一个该类的实例。第一个参数是应用模块或者包的名称。如果你使用一个单一模块（就像本例），那么应当使用<code>__name__</code>，因为名称会根据这个模块是按应用方式使用还是作为一个模块导入而发生变化（可能是 ‘<code>__main__</code>’ ， 也可能是实际导入的名称）。这个参数是必需的，这样<code>Flask</code>才能知道在哪里可以找到模板和静态文件等东西。更多内容详见<code>Flask</code>文档。</p>\n</li>\n<li><p>使用<code>route()</code>装饰器来告诉<code>Flask</code>触发函数的<code>URL</code>。</p>\n</li>\n<li><p>函数名称被用于生成相关联的<code>URL</code> 。函数最后返回需要在用户浏览器中显示的信息。</p>\n</li>\n</ol>\n<p>可以使用<code>flask</code>命令或者<code>python</code>的<code>-m</code>开关来运行这个应用。在运行应用之前，需要在终端里导出<code>FLASK_APP</code>环境变量:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">export</span> FLASK_APP=hello.py</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> flask run</span></span><br><span class=\"line\"> * Running on http://127.0.0.1:5000/</span><br></pre></td></tr></table></figure>\n\n<p>如果是在<code>Windows</code>下，那么导出环境变量的语法取决于使用的是哪种命令行解释器。 在<code>Command Prompt</code>下:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\path\\to\\app&gt;set FLASK_APP=hello.py</span><br></pre></td></tr></table></figure>\n\n<p>还可以使用<code>python -m flask</code>:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">export</span> FLASK_APP=hello.py</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> python -m flask run</span></span><br><span class=\"line\"> * Running on http://127.0.0.1:5000/</span><br></pre></td></tr></table></figure>\n\n<p>这样就启动了一个非常简单的内建的服务器。这个服务器用于测试应该是足够了，但是用于生产可能是不够的。</p>\n<h2 id=\"路由\"><a href=\"#路由\" class=\"headerlink\" title=\"路由\"></a>路由</h2><p>现代<code>web</code>应用都使用有意义的<code>URL</code>，这样有助于用户记忆，网页会更得到用户的青睐， 提高回头率。</p>\n<p>使用<code>route()</code>装饰器来把函数绑定到<code>URL</code>:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Index Page&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/hello&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello, World&#x27;</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一个最小的应用\"><a href=\"#一个最小的应用\" class=\"headerlink\" title=\"一个最小的应用\"></a>一个最小的应用</h2><p>一个最小的<code>Flask</code>应用如下:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello_world</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello, World!&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>那么，这些代码是什么意思呢？</p>\n<ol>\n<li><p>首先我们导入了<code>Flask</code>类。 该类的实例将会成为我们的<code>WSGI</code>应用。</p>\n</li>\n<li><p>接着我们创建一个该类的实例。第一个参数是应用模块或者包的名称。如果你使用一个单一模块（就像本例），那么应当使用<code>__name__</code>，因为名称会根据这个模块是按应用方式使用还是作为一个模块导入而发生变化（可能是 ‘<code>__main__</code>’ ， 也可能是实际导入的名称）。这个参数是必需的，这样<code>Flask</code>才能知道在哪里可以找到模板和静态文件等东西。更多内容详见<code>Flask</code>文档。</p>\n</li>\n<li><p>使用<code>route()</code>装饰器来告诉<code>Flask</code>触发函数的<code>URL</code>。</p>\n</li>\n<li><p>函数名称被用于生成相关联的<code>URL</code> 。函数最后返回需要在用户浏览器中显示的信息。</p>\n</li>\n</ol>\n<p>可以使用<code>flask</code>命令或者<code>python</code>的<code>-m</code>开关来运行这个应用。在运行应用之前，需要在终端里导出<code>FLASK_APP</code>环境变量:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">export</span> FLASK_APP=hello.py</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> flask run</span></span><br><span class=\"line\"> * Running on http://127.0.0.1:5000/</span><br></pre></td></tr></table></figure>\n\n<p>如果是在<code>Windows</code>下，那么导出环境变量的语法取决于使用的是哪种命令行解释器。 在<code>Command Prompt</code>下:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\path\\to\\app&gt;set FLASK_APP=hello.py</span><br></pre></td></tr></table></figure>\n\n<p>还可以使用<code>python -m flask</code>:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">export</span> FLASK_APP=hello.py</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> python -m flask run</span></span><br><span class=\"line\"> * Running on http://127.0.0.1:5000/</span><br></pre></td></tr></table></figure>\n\n<p>这样就启动了一个非常简单的内建的服务器。这个服务器用于测试应该是足够了，但是用于生产可能是不够的。</p>\n<h2 id=\"路由\"><a href=\"#路由\" class=\"headerlink\" title=\"路由\"></a>路由</h2><p>现代<code>web</code>应用都使用有意义的<code>URL</code>，这样有助于用户记忆，网页会更得到用户的青睐， 提高回头率。</p>\n<p>使用<code>route()</code>装饰器来把函数绑定到<code>URL</code>:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">index</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Index Page&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/hello&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello, World&#x27;</span></span><br></pre></td></tr></table></figure>\n\n"},{"title":"Hexo搭建个人博客","date":"2021-05-08T07:39:22.000Z","pic":null,"comments":1,"toc":true,"only":["home","category","tag"],"_content":"\n\n# Hexo\n\n[Hexo](https://hexo.io/zh-cn/)是一个快速、简洁且高效的博客框架。\n\n## 安装\n\n### git安装\n\n```shell\n    Windows：下载并安装 git.\n    Mac：使用 Homebrew, MacPorts 或者下载 安装程序。\n    Linux (Ubuntu, Debian)：sudo apt-get install git-core\n    Linux (Fedora, Red Hat, CentOS)：sudo yum install git-core\n```\n\n### 安装 Node.js\n\nNode.js 为大多数平台提供了官方的 安装程序。对于中国大陆地区用户，可以前往 淘宝 Node.js 镜像 下载。\n\n其它的安装方法：\n\n```shell\n    Windows：通过 nvs（推荐）或者nvm 安装。\n    Mac：使用 Homebrew 或 MacPorts 安装。\n    Linux（DEB/RPM-based）：从 NodeSource 安装。\n    其它：使用相应的软件包管理器进行安装，可以参考由 Node.js 提供的 指导\n```\n\n### 安装 Hexo\n\n所有必备的应用程序安装完成后，即可使用 npm 安装 Hexo。\n\n```shell\n    npm install -g hexo-cli\n```\n\n安装完成后，`win`+`R`输入`cmd`调出命令行，输入`hexo`提示如下，说明安装正确。\n\n```shell\n    C:\\Users\\espho>hexo\n    Usage: hexo <command>\n\n    Commands:\n    help     Get help on a command.\n    init     Create a new Hexo folder.\n    version  Display version information.\n\n    Global Options:\n    --config  Specify config file instead of using _config.yml\n    --cwd     Specify the CWD\n    --debug   Display all verbose messages in the terminal\n    --draft   Display draft posts\n    --safe    Disable all plugins and scripts\n    --silent  Hide output on console\n\n    For more help, you can use 'hexo help [command]' for the detailed information\n    or you can check the docs: http://hexo.io/docs/\n```\n\n## 建站\n\n安装 Hexo 完成后，请执行下列命令，Hexo 将会在指定文件夹中新建所需要的文件。\n\n```shell\n    hexo init <folder>\n    cd <folder>\n    npm install\n```\n\n新建完成后，指定文件夹的目录如下：\n\n```shell\n.\n├── _config.yml\n├── package.json\n├── scaffolds\n├── source\n|   ├── _drafts\n|   └── _posts\n└── themes\n```\n\n### _config.yml\n\n网站的 配置 信息，您可以在此配置大部分的参数。\n\n### package.json\n\n应用程序的信息。EJS, Stylus 和 Markdown renderer 已默认安装，您可以自由移除。\n\n```shell\npackage.json\n{\n  \"name\": \"hexo-site\",\n  \"version\": \"0.0.0\",\n  \"private\": true,\n  \"hexo\": {\n    \"version\": \"\"\n  },\n  \"dependencies\": {\n    \"hexo\": \"^3.8.0\",\n    \"hexo-generator-archive\": \"^0.1.5\",\n    \"hexo-generator-category\": \"^0.1.3\",\n    \"hexo-generator-index\": \"^0.2.1\",\n    \"hexo-generator-tag\": \"^0.2.0\",\n    \"hexo-renderer-ejs\": \"^0.3.1\",\n    \"hexo-renderer-stylus\": \"^0.3.3\",\n    \"hexo-renderer-marked\": \"^0.3.2\",\n    \"hexo-server\": \"^0.3.3\"\n  }\n}\n```\n\n### scaffolds\n\n`模版`文件夹。当您新建文章时，Hexo 会根据 scaffold 来建立文件。\n\nHexo的模板是指在新建的文章文件中默认填充的内容。例如，如果您修改scaffold/post.md中的Front-matter内容，那么每次新建一篇文章时都会包含这个修改。\n\n### source\n\n资源文件夹是存放用户资源的地方。除 `_posts`文件夹之外，开头命名为 `_ (下划线)`的文件`/文件夹`和`隐藏的文件`将会被忽略。Markdown 和 HTML 文件会被解析并放到 `public`文件夹，而其他文件会被拷贝过去。\n\n### themes\n\n`主题`文件夹。Hexo 会根据主题来生成静态页面。\n\n## 配置\n\n相关配置可直接访问[官方文档](https://hexo.io/zh-cn/docs/configuration)查看，我们先从使用别人的主题开始，[官方](https://hexo.io/themes/)提供了335个主题下载使用，你也可以根据规范制定自己的主题。\n\n## 主题\n\n创建`Hexo`主题非常容易，您只要在`themes`文件夹内，新增一个任意名称的文件夹，并修改`_config.yml`内的`theme`设定，即可切换主题。一个主题可能会有以下的结构：\n\n```shell\n.\n├── _config.yml\n├── languages\n├── layout\n├── scripts\n└── source\n```\n\n### _config.yml\n\n主题的配置文件。和 Hexo 配置文件不同，主题配置文件修改时会自动更新，无需重启`Hexo Server`。\n\n## 获取主题\n\n选择相应的主题，从`github`上获取到`themes`目录下。\n\n修改主目录下`_config.yml`中的配置文件，将`theme`修改为获取主题的`文件夹名`。\n\n```shell\ntheme: Kratos-Rebirth\n```\n\n## 运行\n\n在主目录下调用`cmd`命令`hexo server`运行服务，访问`http://localhost:4000`进入博客。\n\n```shell\nespho@Holy-Surface MINGW64 /e/blog\n$ hexo server\nINFO  Validating config\nINFO  Start processing\nINFO  Hexo is running at http://localhost:4000 . Press Ctrl+C to stop.\nINFO  感谢使用 Kratos-Rebirth 主题，您的版本是 v1.6.2\nINFO  如有任何疑问，您可以查阅文档，或是去 https://github.com/Candinya/Kratos-Rebirth/issues 提出对应的 issue 。\nINFO  预祝您使用愉快。\n```\n\n## 添加文章\n\n","source":"_posts/Hexo创建博客.md","raw":"---\ntitle: Hexo搭建个人博客\ndate: 2021-05-08 15:39:22\ncategories: 博客教程\ntags:\n- Hexo\n# sticky: 100\npic:\ncomments: true\ntoc: true\nonly:\n- home\n- category\n- tag\n---\n\n\n# Hexo\n\n[Hexo](https://hexo.io/zh-cn/)是一个快速、简洁且高效的博客框架。\n\n## 安装\n\n### git安装\n\n```shell\n    Windows：下载并安装 git.\n    Mac：使用 Homebrew, MacPorts 或者下载 安装程序。\n    Linux (Ubuntu, Debian)：sudo apt-get install git-core\n    Linux (Fedora, Red Hat, CentOS)：sudo yum install git-core\n```\n\n### 安装 Node.js\n\nNode.js 为大多数平台提供了官方的 安装程序。对于中国大陆地区用户，可以前往 淘宝 Node.js 镜像 下载。\n\n其它的安装方法：\n\n```shell\n    Windows：通过 nvs（推荐）或者nvm 安装。\n    Mac：使用 Homebrew 或 MacPorts 安装。\n    Linux（DEB/RPM-based）：从 NodeSource 安装。\n    其它：使用相应的软件包管理器进行安装，可以参考由 Node.js 提供的 指导\n```\n\n### 安装 Hexo\n\n所有必备的应用程序安装完成后，即可使用 npm 安装 Hexo。\n\n```shell\n    npm install -g hexo-cli\n```\n\n安装完成后，`win`+`R`输入`cmd`调出命令行，输入`hexo`提示如下，说明安装正确。\n\n```shell\n    C:\\Users\\espho>hexo\n    Usage: hexo <command>\n\n    Commands:\n    help     Get help on a command.\n    init     Create a new Hexo folder.\n    version  Display version information.\n\n    Global Options:\n    --config  Specify config file instead of using _config.yml\n    --cwd     Specify the CWD\n    --debug   Display all verbose messages in the terminal\n    --draft   Display draft posts\n    --safe    Disable all plugins and scripts\n    --silent  Hide output on console\n\n    For more help, you can use 'hexo help [command]' for the detailed information\n    or you can check the docs: http://hexo.io/docs/\n```\n\n## 建站\n\n安装 Hexo 完成后，请执行下列命令，Hexo 将会在指定文件夹中新建所需要的文件。\n\n```shell\n    hexo init <folder>\n    cd <folder>\n    npm install\n```\n\n新建完成后，指定文件夹的目录如下：\n\n```shell\n.\n├── _config.yml\n├── package.json\n├── scaffolds\n├── source\n|   ├── _drafts\n|   └── _posts\n└── themes\n```\n\n### _config.yml\n\n网站的 配置 信息，您可以在此配置大部分的参数。\n\n### package.json\n\n应用程序的信息。EJS, Stylus 和 Markdown renderer 已默认安装，您可以自由移除。\n\n```shell\npackage.json\n{\n  \"name\": \"hexo-site\",\n  \"version\": \"0.0.0\",\n  \"private\": true,\n  \"hexo\": {\n    \"version\": \"\"\n  },\n  \"dependencies\": {\n    \"hexo\": \"^3.8.0\",\n    \"hexo-generator-archive\": \"^0.1.5\",\n    \"hexo-generator-category\": \"^0.1.3\",\n    \"hexo-generator-index\": \"^0.2.1\",\n    \"hexo-generator-tag\": \"^0.2.0\",\n    \"hexo-renderer-ejs\": \"^0.3.1\",\n    \"hexo-renderer-stylus\": \"^0.3.3\",\n    \"hexo-renderer-marked\": \"^0.3.2\",\n    \"hexo-server\": \"^0.3.3\"\n  }\n}\n```\n\n### scaffolds\n\n`模版`文件夹。当您新建文章时，Hexo 会根据 scaffold 来建立文件。\n\nHexo的模板是指在新建的文章文件中默认填充的内容。例如，如果您修改scaffold/post.md中的Front-matter内容，那么每次新建一篇文章时都会包含这个修改。\n\n### source\n\n资源文件夹是存放用户资源的地方。除 `_posts`文件夹之外，开头命名为 `_ (下划线)`的文件`/文件夹`和`隐藏的文件`将会被忽略。Markdown 和 HTML 文件会被解析并放到 `public`文件夹，而其他文件会被拷贝过去。\n\n### themes\n\n`主题`文件夹。Hexo 会根据主题来生成静态页面。\n\n## 配置\n\n相关配置可直接访问[官方文档](https://hexo.io/zh-cn/docs/configuration)查看，我们先从使用别人的主题开始，[官方](https://hexo.io/themes/)提供了335个主题下载使用，你也可以根据规范制定自己的主题。\n\n## 主题\n\n创建`Hexo`主题非常容易，您只要在`themes`文件夹内，新增一个任意名称的文件夹，并修改`_config.yml`内的`theme`设定，即可切换主题。一个主题可能会有以下的结构：\n\n```shell\n.\n├── _config.yml\n├── languages\n├── layout\n├── scripts\n└── source\n```\n\n### _config.yml\n\n主题的配置文件。和 Hexo 配置文件不同，主题配置文件修改时会自动更新，无需重启`Hexo Server`。\n\n## 获取主题\n\n选择相应的主题，从`github`上获取到`themes`目录下。\n\n修改主目录下`_config.yml`中的配置文件，将`theme`修改为获取主题的`文件夹名`。\n\n```shell\ntheme: Kratos-Rebirth\n```\n\n## 运行\n\n在主目录下调用`cmd`命令`hexo server`运行服务，访问`http://localhost:4000`进入博客。\n\n```shell\nespho@Holy-Surface MINGW64 /e/blog\n$ hexo server\nINFO  Validating config\nINFO  Start processing\nINFO  Hexo is running at http://localhost:4000 . Press Ctrl+C to stop.\nINFO  感谢使用 Kratos-Rebirth 主题，您的版本是 v1.6.2\nINFO  如有任何疑问，您可以查阅文档，或是去 https://github.com/Candinya/Kratos-Rebirth/issues 提出对应的 issue 。\nINFO  预祝您使用愉快。\n```\n\n## 添加文章\n\n","slug":"Hexo创建博客","published":1,"updated":"2021-06-15T03:24:11.460Z","layout":"post","photos":[],"link":"","_id":"ckq14rx25000z44uda4nbfdlh","content":"<h1 id=\"Hexo\"><a href=\"#Hexo\" class=\"headerlink\" title=\"Hexo\"></a>Hexo</h1><p><a href=\"https://hexo.io/zh-cn/\">Hexo</a>是一个快速、简洁且高效的博客框架。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><h3 id=\"git安装\"><a href=\"#git安装\" class=\"headerlink\" title=\"git安装\"></a>git安装</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Windows：下载并安装 git.</span><br><span class=\"line\">Mac：使用 Homebrew, MacPorts 或者下载 安装程序。</span><br><span class=\"line\">Linux (Ubuntu, Debian)：sudo apt-get install git-core</span><br><span class=\"line\">Linux (Fedora, Red Hat, CentOS)：sudo yum install git-core</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装-Node-js\"><a href=\"#安装-Node-js\" class=\"headerlink\" title=\"安装 Node.js\"></a>安装 Node.js</h3><p>Node.js 为大多数平台提供了官方的 安装程序。对于中国大陆地区用户，可以前往 淘宝 Node.js 镜像 下载。</p>\n<p>其它的安装方法：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Windows：通过 nvs（推荐）或者nvm 安装。</span><br><span class=\"line\">Mac：使用 Homebrew 或 MacPorts 安装。</span><br><span class=\"line\">Linux（DEB/RPM-based）：从 NodeSource 安装。</span><br><span class=\"line\">其它：使用相应的软件包管理器进行安装，可以参考由 Node.js 提供的 指导</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装-Hexo\"><a href=\"#安装-Hexo\" class=\"headerlink\" title=\"安装 Hexo\"></a>安装 Hexo</h3><p>所有必备的应用程序安装完成后，即可使用 npm 安装 Hexo。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g hexo-cli</span><br></pre></td></tr></table></figure>\n\n<p>安装完成后，<code>win</code>+<code>R</code>输入<code>cmd</code>调出命令行，输入<code>hexo</code>提示如下，说明安装正确。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\Users\\espho&gt;hexo</span><br><span class=\"line\">Usage: hexo &lt;command&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">Commands:</span><br><span class=\"line\">help     Get help on a command.</span><br><span class=\"line\">init     Create a new Hexo folder.</span><br><span class=\"line\">version  Display version information.</span><br><span class=\"line\"></span><br><span class=\"line\">Global Options:</span><br><span class=\"line\">--config  Specify config file instead of using _config.yml</span><br><span class=\"line\">--cwd     Specify the CWD</span><br><span class=\"line\">--debug   Display all verbose messages in the terminal</span><br><span class=\"line\">--draft   Display draft posts</span><br><span class=\"line\">--safe    Disable all plugins and scripts</span><br><span class=\"line\">--silent  Hide output on console</span><br><span class=\"line\"></span><br><span class=\"line\">For more help, you can use &#x27;hexo help [command]&#x27; for the detailed information</span><br><span class=\"line\">or you can check the docs: http://hexo.io/docs/</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"建站\"><a href=\"#建站\" class=\"headerlink\" title=\"建站\"></a>建站</h2><p>安装 Hexo 完成后，请执行下列命令，Hexo 将会在指定文件夹中新建所需要的文件。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo init &lt;folder&gt;</span><br><span class=\"line\">cd &lt;folder&gt;</span><br><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n\n<p>新建完成后，指定文件夹的目录如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.</span><br><span class=\"line\">├── _config.yml</span><br><span class=\"line\">├── package.json</span><br><span class=\"line\">├── scaffolds</span><br><span class=\"line\">├── source</span><br><span class=\"line\">|   ├── _drafts</span><br><span class=\"line\">|   └── _posts</span><br><span class=\"line\">└── themes</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"config-yml\"><a href=\"#config-yml\" class=\"headerlink\" title=\"_config.yml\"></a>_config.yml</h3><p>网站的 配置 信息，您可以在此配置大部分的参数。</p>\n<h3 id=\"package-json\"><a href=\"#package-json\" class=\"headerlink\" title=\"package.json\"></a>package.json</h3><p>应用程序的信息。EJS, Stylus 和 Markdown renderer 已默认安装，您可以自由移除。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package.json</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;name&quot;: &quot;hexo-site&quot;,</span><br><span class=\"line\">  &quot;version&quot;: &quot;0.0.0&quot;,</span><br><span class=\"line\">  &quot;private&quot;: true,</span><br><span class=\"line\">  &quot;hexo&quot;: &#123;</span><br><span class=\"line\">    &quot;version&quot;: &quot;&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;dependencies&quot;: &#123;</span><br><span class=\"line\">    &quot;hexo&quot;: &quot;^3.8.0&quot;,</span><br><span class=\"line\">    &quot;hexo-generator-archive&quot;: &quot;^0.1.5&quot;,</span><br><span class=\"line\">    &quot;hexo-generator-category&quot;: &quot;^0.1.3&quot;,</span><br><span class=\"line\">    &quot;hexo-generator-index&quot;: &quot;^0.2.1&quot;,</span><br><span class=\"line\">    &quot;hexo-generator-tag&quot;: &quot;^0.2.0&quot;,</span><br><span class=\"line\">    &quot;hexo-renderer-ejs&quot;: &quot;^0.3.1&quot;,</span><br><span class=\"line\">    &quot;hexo-renderer-stylus&quot;: &quot;^0.3.3&quot;,</span><br><span class=\"line\">    &quot;hexo-renderer-marked&quot;: &quot;^0.3.2&quot;,</span><br><span class=\"line\">    &quot;hexo-server&quot;: &quot;^0.3.3&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"scaffolds\"><a href=\"#scaffolds\" class=\"headerlink\" title=\"scaffolds\"></a>scaffolds</h3><p><code>模版</code>文件夹。当您新建文章时，Hexo 会根据 scaffold 来建立文件。</p>\n<p>Hexo的模板是指在新建的文章文件中默认填充的内容。例如，如果您修改scaffold/post.md中的Front-matter内容，那么每次新建一篇文章时都会包含这个修改。</p>\n<h3 id=\"source\"><a href=\"#source\" class=\"headerlink\" title=\"source\"></a>source</h3><p>资源文件夹是存放用户资源的地方。除 <code>_posts</code>文件夹之外，开头命名为 <code>_ (下划线)</code>的文件<code>/文件夹</code>和<code>隐藏的文件</code>将会被忽略。Markdown 和 HTML 文件会被解析并放到 <code>public</code>文件夹，而其他文件会被拷贝过去。</p>\n<h3 id=\"themes\"><a href=\"#themes\" class=\"headerlink\" title=\"themes\"></a>themes</h3><p><code>主题</code>文件夹。Hexo 会根据主题来生成静态页面。</p>\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>相关配置可直接访问<a href=\"https://hexo.io/zh-cn/docs/configuration\">官方文档</a>查看，我们先从使用别人的主题开始，<a href=\"https://hexo.io/themes/\">官方</a>提供了335个主题下载使用，你也可以根据规范制定自己的主题。</p>\n<h2 id=\"主题\"><a href=\"#主题\" class=\"headerlink\" title=\"主题\"></a>主题</h2><p>创建<code>Hexo</code>主题非常容易，您只要在<code>themes</code>文件夹内，新增一个任意名称的文件夹，并修改<code>_config.yml</code>内的<code>theme</code>设定，即可切换主题。一个主题可能会有以下的结构：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.</span><br><span class=\"line\">├── _config.yml</span><br><span class=\"line\">├── languages</span><br><span class=\"line\">├── layout</span><br><span class=\"line\">├── scripts</span><br><span class=\"line\">└── source</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"config-yml-1\"><a href=\"#config-yml-1\" class=\"headerlink\" title=\"_config.yml\"></a>_config.yml</h3><p>主题的配置文件。和 Hexo 配置文件不同，主题配置文件修改时会自动更新，无需重启<code>Hexo Server</code>。</p>\n<h2 id=\"获取主题\"><a href=\"#获取主题\" class=\"headerlink\" title=\"获取主题\"></a>获取主题</h2><p>选择相应的主题，从<code>github</code>上获取到<code>themes</code>目录下。</p>\n<p>修改主目录下<code>_config.yml</code>中的配置文件，将<code>theme</code>修改为获取主题的<code>文件夹名</code>。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">theme: Kratos-Rebirth</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h2><p>在主目录下调用<code>cmd</code>命令<code>hexo server</code>运行服务，访问<code>http://localhost:4000</code>进入博客。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">espho@Holy-Surface MINGW64 /e/blog</span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> hexo server</span></span><br><span class=\"line\">INFO  Validating config</span><br><span class=\"line\">INFO  Start processing</span><br><span class=\"line\">INFO  Hexo is running at http://localhost:4000 . Press Ctrl+C to stop.</span><br><span class=\"line\">INFO  感谢使用 Kratos-Rebirth 主题，您的版本是 v1.6.2</span><br><span class=\"line\">INFO  如有任何疑问，您可以查阅文档，或是去 https://github.com/Candinya/Kratos-Rebirth/issues 提出对应的 issue 。</span><br><span class=\"line\">INFO  预祝您使用愉快。</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"添加文章\"><a href=\"#添加文章\" class=\"headerlink\" title=\"添加文章\"></a>添加文章</h2>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Hexo\"><a href=\"#Hexo\" class=\"headerlink\" title=\"Hexo\"></a>Hexo</h1><p><a href=\"https://hexo.io/zh-cn/\">Hexo</a>是一个快速、简洁且高效的博客框架。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><h3 id=\"git安装\"><a href=\"#git安装\" class=\"headerlink\" title=\"git安装\"></a>git安装</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Windows：下载并安装 git.</span><br><span class=\"line\">Mac：使用 Homebrew, MacPorts 或者下载 安装程序。</span><br><span class=\"line\">Linux (Ubuntu, Debian)：sudo apt-get install git-core</span><br><span class=\"line\">Linux (Fedora, Red Hat, CentOS)：sudo yum install git-core</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装-Node-js\"><a href=\"#安装-Node-js\" class=\"headerlink\" title=\"安装 Node.js\"></a>安装 Node.js</h3><p>Node.js 为大多数平台提供了官方的 安装程序。对于中国大陆地区用户，可以前往 淘宝 Node.js 镜像 下载。</p>\n<p>其它的安装方法：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Windows：通过 nvs（推荐）或者nvm 安装。</span><br><span class=\"line\">Mac：使用 Homebrew 或 MacPorts 安装。</span><br><span class=\"line\">Linux（DEB/RPM-based）：从 NodeSource 安装。</span><br><span class=\"line\">其它：使用相应的软件包管理器进行安装，可以参考由 Node.js 提供的 指导</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装-Hexo\"><a href=\"#安装-Hexo\" class=\"headerlink\" title=\"安装 Hexo\"></a>安装 Hexo</h3><p>所有必备的应用程序安装完成后，即可使用 npm 安装 Hexo。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g hexo-cli</span><br></pre></td></tr></table></figure>\n\n<p>安装完成后，<code>win</code>+<code>R</code>输入<code>cmd</code>调出命令行，输入<code>hexo</code>提示如下，说明安装正确。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\Users\\espho&gt;hexo</span><br><span class=\"line\">Usage: hexo &lt;command&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">Commands:</span><br><span class=\"line\">help     Get help on a command.</span><br><span class=\"line\">init     Create a new Hexo folder.</span><br><span class=\"line\">version  Display version information.</span><br><span class=\"line\"></span><br><span class=\"line\">Global Options:</span><br><span class=\"line\">--config  Specify config file instead of using _config.yml</span><br><span class=\"line\">--cwd     Specify the CWD</span><br><span class=\"line\">--debug   Display all verbose messages in the terminal</span><br><span class=\"line\">--draft   Display draft posts</span><br><span class=\"line\">--safe    Disable all plugins and scripts</span><br><span class=\"line\">--silent  Hide output on console</span><br><span class=\"line\"></span><br><span class=\"line\">For more help, you can use &#x27;hexo help [command]&#x27; for the detailed information</span><br><span class=\"line\">or you can check the docs: http://hexo.io/docs/</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"建站\"><a href=\"#建站\" class=\"headerlink\" title=\"建站\"></a>建站</h2><p>安装 Hexo 完成后，请执行下列命令，Hexo 将会在指定文件夹中新建所需要的文件。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo init &lt;folder&gt;</span><br><span class=\"line\">cd &lt;folder&gt;</span><br><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n\n<p>新建完成后，指定文件夹的目录如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.</span><br><span class=\"line\">├── _config.yml</span><br><span class=\"line\">├── package.json</span><br><span class=\"line\">├── scaffolds</span><br><span class=\"line\">├── source</span><br><span class=\"line\">|   ├── _drafts</span><br><span class=\"line\">|   └── _posts</span><br><span class=\"line\">└── themes</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"config-yml\"><a href=\"#config-yml\" class=\"headerlink\" title=\"_config.yml\"></a>_config.yml</h3><p>网站的 配置 信息，您可以在此配置大部分的参数。</p>\n<h3 id=\"package-json\"><a href=\"#package-json\" class=\"headerlink\" title=\"package.json\"></a>package.json</h3><p>应用程序的信息。EJS, Stylus 和 Markdown renderer 已默认安装，您可以自由移除。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package.json</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;name&quot;: &quot;hexo-site&quot;,</span><br><span class=\"line\">  &quot;version&quot;: &quot;0.0.0&quot;,</span><br><span class=\"line\">  &quot;private&quot;: true,</span><br><span class=\"line\">  &quot;hexo&quot;: &#123;</span><br><span class=\"line\">    &quot;version&quot;: &quot;&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;dependencies&quot;: &#123;</span><br><span class=\"line\">    &quot;hexo&quot;: &quot;^3.8.0&quot;,</span><br><span class=\"line\">    &quot;hexo-generator-archive&quot;: &quot;^0.1.5&quot;,</span><br><span class=\"line\">    &quot;hexo-generator-category&quot;: &quot;^0.1.3&quot;,</span><br><span class=\"line\">    &quot;hexo-generator-index&quot;: &quot;^0.2.1&quot;,</span><br><span class=\"line\">    &quot;hexo-generator-tag&quot;: &quot;^0.2.0&quot;,</span><br><span class=\"line\">    &quot;hexo-renderer-ejs&quot;: &quot;^0.3.1&quot;,</span><br><span class=\"line\">    &quot;hexo-renderer-stylus&quot;: &quot;^0.3.3&quot;,</span><br><span class=\"line\">    &quot;hexo-renderer-marked&quot;: &quot;^0.3.2&quot;,</span><br><span class=\"line\">    &quot;hexo-server&quot;: &quot;^0.3.3&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"scaffolds\"><a href=\"#scaffolds\" class=\"headerlink\" title=\"scaffolds\"></a>scaffolds</h3><p><code>模版</code>文件夹。当您新建文章时，Hexo 会根据 scaffold 来建立文件。</p>\n<p>Hexo的模板是指在新建的文章文件中默认填充的内容。例如，如果您修改scaffold/post.md中的Front-matter内容，那么每次新建一篇文章时都会包含这个修改。</p>\n<h3 id=\"source\"><a href=\"#source\" class=\"headerlink\" title=\"source\"></a>source</h3><p>资源文件夹是存放用户资源的地方。除 <code>_posts</code>文件夹之外，开头命名为 <code>_ (下划线)</code>的文件<code>/文件夹</code>和<code>隐藏的文件</code>将会被忽略。Markdown 和 HTML 文件会被解析并放到 <code>public</code>文件夹，而其他文件会被拷贝过去。</p>\n<h3 id=\"themes\"><a href=\"#themes\" class=\"headerlink\" title=\"themes\"></a>themes</h3><p><code>主题</code>文件夹。Hexo 会根据主题来生成静态页面。</p>\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>相关配置可直接访问<a href=\"https://hexo.io/zh-cn/docs/configuration\">官方文档</a>查看，我们先从使用别人的主题开始，<a href=\"https://hexo.io/themes/\">官方</a>提供了335个主题下载使用，你也可以根据规范制定自己的主题。</p>\n<h2 id=\"主题\"><a href=\"#主题\" class=\"headerlink\" title=\"主题\"></a>主题</h2><p>创建<code>Hexo</code>主题非常容易，您只要在<code>themes</code>文件夹内，新增一个任意名称的文件夹，并修改<code>_config.yml</code>内的<code>theme</code>设定，即可切换主题。一个主题可能会有以下的结构：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.</span><br><span class=\"line\">├── _config.yml</span><br><span class=\"line\">├── languages</span><br><span class=\"line\">├── layout</span><br><span class=\"line\">├── scripts</span><br><span class=\"line\">└── source</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"config-yml-1\"><a href=\"#config-yml-1\" class=\"headerlink\" title=\"_config.yml\"></a>_config.yml</h3><p>主题的配置文件。和 Hexo 配置文件不同，主题配置文件修改时会自动更新，无需重启<code>Hexo Server</code>。</p>\n<h2 id=\"获取主题\"><a href=\"#获取主题\" class=\"headerlink\" title=\"获取主题\"></a>获取主题</h2><p>选择相应的主题，从<code>github</code>上获取到<code>themes</code>目录下。</p>\n<p>修改主目录下<code>_config.yml</code>中的配置文件，将<code>theme</code>修改为获取主题的<code>文件夹名</code>。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">theme: Kratos-Rebirth</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h2><p>在主目录下调用<code>cmd</code>命令<code>hexo server</code>运行服务，访问<code>http://localhost:4000</code>进入博客。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">espho@Holy-Surface MINGW64 /e/blog</span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> hexo server</span></span><br><span class=\"line\">INFO  Validating config</span><br><span class=\"line\">INFO  Start processing</span><br><span class=\"line\">INFO  Hexo is running at http://localhost:4000 . Press Ctrl+C to stop.</span><br><span class=\"line\">INFO  感谢使用 Kratos-Rebirth 主题，您的版本是 v1.6.2</span><br><span class=\"line\">INFO  如有任何疑问，您可以查阅文档，或是去 https://github.com/Candinya/Kratos-Rebirth/issues 提出对应的 issue 。</span><br><span class=\"line\">INFO  预祝您使用愉快。</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"添加文章\"><a href=\"#添加文章\" class=\"headerlink\" title=\"添加文章\"></a>添加文章</h2>"},{"title":"Hexo在腾讯云的部署","date":"2021-05-10T04:51:56.000Z","pic":null,"comments":1,"toc":true,"only":["home","category","tag"],"_content":"\n## 简介\n\n`Hexo`在`GitHub pages`上的访问太慢了，迁移到腾讯云服务器上。\n\n## 部署环境\n\n腾讯云服务器（Centos 64位）。\n\n## 服务器配置\n\n### 安装git\n\n```shell\nyum install git\n```\n\n创建git用户并修改权限\n\n```shell\nadduser git\npasswd git\nchmod 740 /etc/sudoers\nvim /etc/sudoers\n```\n\n找到一下内容\n\n```shell\n## Allow root to run any commands anywhere\nroot    ALL=(ALL)       ALL\n```\n\n在该语句下添加\n\n```shell\ngit ALL=(ALL) ALL\n```\n\n退出（esc + :wq）并修改权限\n\n```shell\nchmod 400 /etc/sudoers\n```\n\n本地使用gitbash创建密钥\n\n```shell\nssh-keygen -t rsa //因为我在GitHub上部署博客时已经创建过密钥，这里可以直接跳过生成，用以前的密钥\n```\n\n在腾讯云中创建`ssh`，并将本地的`id_rsa.pub`中的文件内容全部复制到`authorized_keys`中。\n\n```shell\nsu git\nmkdir ~/.ssh\nvim ~/.ssh/authorized_keys\n```\n\n修改权限\n\n```shell\ncd ~\nchmod 600 .ssh/authorized_keys\nchmod 700 .ssh\n```\n\n本地测试\n\n```shell\nssh -v git@SERVER //@后是你自己的服务器公网IP，如果不出现failed字样，说明成功\n```\n\n云服务器中创建网站目录并设置权限\n\n```shell\nsu root\nmkdir /home/hexo\nchown git:git -R /home/hexo\n```\n\n### 安装nginx\n\n```shell\nyum install -y nginx    // 安装\nsystemctl start nginx.service     // 启动服务\n```\n\n以上执行完之后，在浏览器中输入你的公网IP如果可以进入CentOs界面，说明Nginx安装成功。\n\n### 配置nginx\n\n```shell\nnginx -t  // 命令查看位置，一般为 /etc/nginx/nginx.conf。\nvim /etc/nginx/nginx.conf //修改配置文件，在server_name后添加自己的域名（要备案），root后添加/home/hexo\n```\n\n重启服务\n\n```shell\nsystemctl restart nginx.service\n```\n\n## 建立git仓库并修改权限\n\n```shell\nsu root\ncd /home/git\ngit init --bare blog.git\nchown git:git -R blog.git\n```\n\n同步网站根目录\n\n```shell\nvim blog.git/hooks/post-receive\n```\n\n填入如下内容\n\n```shell\n#!/bin/sh\ngit --work-tree=/home/hexo --git-dir=/home/git/blog.git checkout -f\n```\n\n修改权限\n\n```shell\nchmod +x /home/git/blog.git/hooks/post-receive\n```\n\n在本地Hexo目录下修改_config.yml文件中的deploy后的repo改为：\n\n```shell\ngit@SERVER:/home/git/blog.git   //@后为你的服务器公网IP\n```\n\n以上全部完成后，执行hexo的部署命令即可完成在腾讯云服务器上的博客部署。","source":"_posts/Hexo在腾讯云的部署.md","raw":"---\ntitle: Hexo在腾讯云的部署\ndate: 2021-05-10 12:51:56\ncategories: 博客教程\ntags:\n- Hexo\n# sticky: 100\npic:\ncomments: true\ntoc: true\nonly:\n- home\n- category\n- tag\n---\n\n## 简介\n\n`Hexo`在`GitHub pages`上的访问太慢了，迁移到腾讯云服务器上。\n\n## 部署环境\n\n腾讯云服务器（Centos 64位）。\n\n## 服务器配置\n\n### 安装git\n\n```shell\nyum install git\n```\n\n创建git用户并修改权限\n\n```shell\nadduser git\npasswd git\nchmod 740 /etc/sudoers\nvim /etc/sudoers\n```\n\n找到一下内容\n\n```shell\n## Allow root to run any commands anywhere\nroot    ALL=(ALL)       ALL\n```\n\n在该语句下添加\n\n```shell\ngit ALL=(ALL) ALL\n```\n\n退出（esc + :wq）并修改权限\n\n```shell\nchmod 400 /etc/sudoers\n```\n\n本地使用gitbash创建密钥\n\n```shell\nssh-keygen -t rsa //因为我在GitHub上部署博客时已经创建过密钥，这里可以直接跳过生成，用以前的密钥\n```\n\n在腾讯云中创建`ssh`，并将本地的`id_rsa.pub`中的文件内容全部复制到`authorized_keys`中。\n\n```shell\nsu git\nmkdir ~/.ssh\nvim ~/.ssh/authorized_keys\n```\n\n修改权限\n\n```shell\ncd ~\nchmod 600 .ssh/authorized_keys\nchmod 700 .ssh\n```\n\n本地测试\n\n```shell\nssh -v git@SERVER //@后是你自己的服务器公网IP，如果不出现failed字样，说明成功\n```\n\n云服务器中创建网站目录并设置权限\n\n```shell\nsu root\nmkdir /home/hexo\nchown git:git -R /home/hexo\n```\n\n### 安装nginx\n\n```shell\nyum install -y nginx    // 安装\nsystemctl start nginx.service     // 启动服务\n```\n\n以上执行完之后，在浏览器中输入你的公网IP如果可以进入CentOs界面，说明Nginx安装成功。\n\n### 配置nginx\n\n```shell\nnginx -t  // 命令查看位置，一般为 /etc/nginx/nginx.conf。\nvim /etc/nginx/nginx.conf //修改配置文件，在server_name后添加自己的域名（要备案），root后添加/home/hexo\n```\n\n重启服务\n\n```shell\nsystemctl restart nginx.service\n```\n\n## 建立git仓库并修改权限\n\n```shell\nsu root\ncd /home/git\ngit init --bare blog.git\nchown git:git -R blog.git\n```\n\n同步网站根目录\n\n```shell\nvim blog.git/hooks/post-receive\n```\n\n填入如下内容\n\n```shell\n#!/bin/sh\ngit --work-tree=/home/hexo --git-dir=/home/git/blog.git checkout -f\n```\n\n修改权限\n\n```shell\nchmod +x /home/git/blog.git/hooks/post-receive\n```\n\n在本地Hexo目录下修改_config.yml文件中的deploy后的repo改为：\n\n```shell\ngit@SERVER:/home/git/blog.git   //@后为你的服务器公网IP\n```\n\n以上全部完成后，执行hexo的部署命令即可完成在腾讯云服务器上的博客部署。","slug":"Hexo在腾讯云的部署","published":1,"updated":"2021-06-15T03:24:11.461Z","layout":"post","photos":[],"link":"","_id":"ckq14rx26001344udgg5jh0hc","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p><code>Hexo</code>在<code>GitHub pages</code>上的访问太慢了，迁移到腾讯云服务器上。</p>\n<h2 id=\"部署环境\"><a href=\"#部署环境\" class=\"headerlink\" title=\"部署环境\"></a>部署环境</h2><p>腾讯云服务器（Centos 64位）。</p>\n<h2 id=\"服务器配置\"><a href=\"#服务器配置\" class=\"headerlink\" title=\"服务器配置\"></a>服务器配置</h2><h3 id=\"安装git\"><a href=\"#安装git\" class=\"headerlink\" title=\"安装git\"></a>安装git</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install git</span><br></pre></td></tr></table></figure>\n\n<p>创建git用户并修改权限</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">adduser git</span><br><span class=\"line\">passwd git</span><br><span class=\"line\">chmod 740 /etc/sudoers</span><br><span class=\"line\">vim /etc/sudoers</span><br></pre></td></tr></table></figure>\n\n<p>找到一下内容</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># Allow root to run any commands anywhere</span></span></span><br><span class=\"line\">root    ALL=(ALL)       ALL</span><br></pre></td></tr></table></figure>\n\n<p>在该语句下添加</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git ALL=(ALL) ALL</span><br></pre></td></tr></table></figure>\n\n<p>退出（esc + :wq）并修改权限</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod 400 /etc/sudoers</span><br></pre></td></tr></table></figure>\n\n<p>本地使用gitbash创建密钥</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa //因为我在GitHub上部署博客时已经创建过密钥，这里可以直接跳过生成，用以前的密钥</span><br></pre></td></tr></table></figure>\n\n<p>在腾讯云中创建<code>ssh</code>，并将本地的<code>id_rsa.pub</code>中的文件内容全部复制到<code>authorized_keys</code>中。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su git</span><br><span class=\"line\">mkdir ~/.ssh</span><br><span class=\"line\">vim ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>\n\n<p>修改权限</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~</span><br><span class=\"line\">chmod 600 .ssh/authorized_keys</span><br><span class=\"line\">chmod 700 .ssh</span><br></pre></td></tr></table></figure>\n\n<p>本地测试</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh -v git@SERVER //@后是你自己的服务器公网IP，如果不出现failed字样，说明成功</span><br></pre></td></tr></table></figure>\n\n<p>云服务器中创建网站目录并设置权限</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su root</span><br><span class=\"line\">mkdir /home/hexo</span><br><span class=\"line\">chown git:git -R /home/hexo</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装nginx\"><a href=\"#安装nginx\" class=\"headerlink\" title=\"安装nginx\"></a>安装nginx</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y nginx    // 安装</span><br><span class=\"line\">systemctl start nginx.service     // 启动服务</span><br></pre></td></tr></table></figure>\n\n<p>以上执行完之后，在浏览器中输入你的公网IP如果可以进入CentOs界面，说明Nginx安装成功。</p>\n<h3 id=\"配置nginx\"><a href=\"#配置nginx\" class=\"headerlink\" title=\"配置nginx\"></a>配置nginx</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx -t  // 命令查看位置，一般为 /etc/nginx/nginx.conf。</span><br><span class=\"line\">vim /etc/nginx/nginx.conf //修改配置文件，在server_name后添加自己的域名（要备案），root后添加/home/hexo</span><br></pre></td></tr></table></figure>\n\n<p>重启服务</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart nginx.service</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"建立git仓库并修改权限\"><a href=\"#建立git仓库并修改权限\" class=\"headerlink\" title=\"建立git仓库并修改权限\"></a>建立git仓库并修改权限</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su root</span><br><span class=\"line\">cd /home/git</span><br><span class=\"line\">git init --bare blog.git</span><br><span class=\"line\">chown git:git -R blog.git</span><br></pre></td></tr></table></figure>\n\n<p>同步网站根目录</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim blog.git/hooks/post-receive</span><br></pre></td></tr></table></figure>\n\n<p>填入如下内容</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/sh</span></span><br><span class=\"line\">git --work-tree=/home/hexo --git-dir=/home/git/blog.git checkout -f</span><br></pre></td></tr></table></figure>\n\n<p>修改权限</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x /home/git/blog.git/hooks/post-receive</span><br></pre></td></tr></table></figure>\n\n<p>在本地Hexo目录下修改_config.yml文件中的deploy后的repo改为：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git@SERVER:/home/git/blog.git   //@后为你的服务器公网IP</span><br></pre></td></tr></table></figure>\n\n<p>以上全部完成后，执行hexo的部署命令即可完成在腾讯云服务器上的博客部署。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p><code>Hexo</code>在<code>GitHub pages</code>上的访问太慢了，迁移到腾讯云服务器上。</p>\n<h2 id=\"部署环境\"><a href=\"#部署环境\" class=\"headerlink\" title=\"部署环境\"></a>部署环境</h2><p>腾讯云服务器（Centos 64位）。</p>\n<h2 id=\"服务器配置\"><a href=\"#服务器配置\" class=\"headerlink\" title=\"服务器配置\"></a>服务器配置</h2><h3 id=\"安装git\"><a href=\"#安装git\" class=\"headerlink\" title=\"安装git\"></a>安装git</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install git</span><br></pre></td></tr></table></figure>\n\n<p>创建git用户并修改权限</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">adduser git</span><br><span class=\"line\">passwd git</span><br><span class=\"line\">chmod 740 /etc/sudoers</span><br><span class=\"line\">vim /etc/sudoers</span><br></pre></td></tr></table></figure>\n\n<p>找到一下内容</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># Allow root to run any commands anywhere</span></span></span><br><span class=\"line\">root    ALL=(ALL)       ALL</span><br></pre></td></tr></table></figure>\n\n<p>在该语句下添加</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git ALL=(ALL) ALL</span><br></pre></td></tr></table></figure>\n\n<p>退出（esc + :wq）并修改权限</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod 400 /etc/sudoers</span><br></pre></td></tr></table></figure>\n\n<p>本地使用gitbash创建密钥</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa //因为我在GitHub上部署博客时已经创建过密钥，这里可以直接跳过生成，用以前的密钥</span><br></pre></td></tr></table></figure>\n\n<p>在腾讯云中创建<code>ssh</code>，并将本地的<code>id_rsa.pub</code>中的文件内容全部复制到<code>authorized_keys</code>中。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su git</span><br><span class=\"line\">mkdir ~/.ssh</span><br><span class=\"line\">vim ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>\n\n<p>修改权限</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~</span><br><span class=\"line\">chmod 600 .ssh/authorized_keys</span><br><span class=\"line\">chmod 700 .ssh</span><br></pre></td></tr></table></figure>\n\n<p>本地测试</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh -v git@SERVER //@后是你自己的服务器公网IP，如果不出现failed字样，说明成功</span><br></pre></td></tr></table></figure>\n\n<p>云服务器中创建网站目录并设置权限</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su root</span><br><span class=\"line\">mkdir /home/hexo</span><br><span class=\"line\">chown git:git -R /home/hexo</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装nginx\"><a href=\"#安装nginx\" class=\"headerlink\" title=\"安装nginx\"></a>安装nginx</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y nginx    // 安装</span><br><span class=\"line\">systemctl start nginx.service     // 启动服务</span><br></pre></td></tr></table></figure>\n\n<p>以上执行完之后，在浏览器中输入你的公网IP如果可以进入CentOs界面，说明Nginx安装成功。</p>\n<h3 id=\"配置nginx\"><a href=\"#配置nginx\" class=\"headerlink\" title=\"配置nginx\"></a>配置nginx</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx -t  // 命令查看位置，一般为 /etc/nginx/nginx.conf。</span><br><span class=\"line\">vim /etc/nginx/nginx.conf //修改配置文件，在server_name后添加自己的域名（要备案），root后添加/home/hexo</span><br></pre></td></tr></table></figure>\n\n<p>重启服务</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart nginx.service</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"建立git仓库并修改权限\"><a href=\"#建立git仓库并修改权限\" class=\"headerlink\" title=\"建立git仓库并修改权限\"></a>建立git仓库并修改权限</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su root</span><br><span class=\"line\">cd /home/git</span><br><span class=\"line\">git init --bare blog.git</span><br><span class=\"line\">chown git:git -R blog.git</span><br></pre></td></tr></table></figure>\n\n<p>同步网站根目录</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim blog.git/hooks/post-receive</span><br></pre></td></tr></table></figure>\n\n<p>填入如下内容</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/sh</span></span><br><span class=\"line\">git --work-tree=/home/hexo --git-dir=/home/git/blog.git checkout -f</span><br></pre></td></tr></table></figure>\n\n<p>修改权限</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x /home/git/blog.git/hooks/post-receive</span><br></pre></td></tr></table></figure>\n\n<p>在本地Hexo目录下修改_config.yml文件中的deploy后的repo改为：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git@SERVER:/home/git/blog.git   //@后为你的服务器公网IP</span><br></pre></td></tr></table></figure>\n\n<p>以上全部完成后，执行hexo的部署命令即可完成在腾讯云服务器上的博客部署。</p>\n"},{"title":"MongoDB数据库的使用","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-23T06:46:16.000Z","pic":null,"_content":"\n## 准备工作\n\n开始之前，请确保你已经安装好了`MongoDB`并启动了其服务，同时安装好了`Python`的`PyMongo`库。\n\n安装好之后，我们需要把`MongoDB`服务启动起来。启动完成之后，它会默认在本地`localhost`的`27017`端口上运行。\n\n接下来我们需要安装`PyMongo`这个库，它是`Python`用来操作`MongoDB`的第三方库，直接用`pip3`安装即可：\n\n```python\npip3 install pymongo\n```\n\n## 连接MongoDB\n\n连接`MongoDB`时，需要使用`PyMongo`库里面的`MongoClient`。一般来说，向其传入`MongoDB`的`IP`及端口即可，其中第一个参数为地址`host`，第二个参数为端口 `port`（如果不给它传递参数，则默认是`27017`）：\n\n```python\nimport pymongo\n\nclient = pymongo.MongoClient(host='localhost', port=27017)\n```\n\n另外，`MongoClient`的第一个参数`host`还可以直接传入`MongoDB`的连接字符串，它以`mongodb`开头，例如：\n\n```python\nclient = MongoClient('mongodb://localhost:27017/')\n```\n\n这样也可以达到同样的连接效果。\n\n### 指定数据库\n\n`MongoDB`中可以建立多个数据库，接下来指定操作其中一个数据库。这里以`test`数据库作为下一步需要在程序中指定使用的例子：\n\n```python\ndb = client.test\n```\n\n这里调用`client`的`test`属性即可返回`test`数据库。当然，也可以这样指定：\n\n```python\ndb = client['test']\n```\n\n这两种方式是等价的。\n\n### 指定集合\n\n`MongoDB`的每个数据库又包含许多集合`（collection）`，它们类似于关系型数据库中的表。\n\n下一步需要指定要操作的集合，这里指定一个名称为`students`的集合。与指定数据库类似，指定集合也有两种方式：\n\n```python\ncollection = db.students\n```\n\n或是\n\n```python\ncollection = db['students']\n```\n\n这样便声明了一个`Collection`对象。\n\n### 插入数据\n\n接下来，便可以插入数据了。对`students`这个集合新建一条学生数据，这条数据以字典形式表示：\n\n```python\nstudent = {\n    'id': '20170101',\n    'name': 'Jordan',\n    'age':'20',\n    'gender': 'male'\n}\n```\n\n新建的这条数据里指定了学生的学号、姓名、年龄和性别。直接调用`collection`的`insert`方法即可插入数据，代码如下：\n\n```python\nresult = collection.insert(student)\nprint(result)\n```\n\n在`MongoDB`中，每条数据其实都有一个`_id`属性来唯一标识。如果没有显式指明该属性，`MongoDB`会自动产生一个`ObjectId`类型的`_id`属性。`insert()`方法会在执行后返回`_id`值。\n\n运行结果如下：\n\n```python\n60aa06aca3aff156a9093404\n```\n\n当然，我们也可以同时插入多条数据，只需要以列表形式传递即可，示例如下：\n\n```python\nstudent1 = {\n    'id': '20170102',\n    'name': 'Jack',\n    'age':'23',\n    'gender': 'male'\n}\n\nstudent2 = {\n    'id': '201701013',\n    'name': 'Holy',\n    'age':'25',\n    'gender': 'male'\n}\nresult = collection.insert([student1, student2])\nprint(result)\n```\n\n返回结果是对应的`_id`的集合：\n\n```python\n[ObjectId('60aa07d11755f43c2a5becf3'), ObjectId('60aa07d11755f43c2a5becf4')]\n```\n\n在`PyMongo`中，官方已经不推荐使用`insert`方法了。但是如果你要继续使用也没有什么问题。目前，官方推荐使用`insert_one`和`insert_many`方法来分别插入单条记录和多条记录，示例如下：\n\n```python\nstudent = {\n    'id': '20170101',\n    'name': 'Jordan',\n    'age':'20',\n    'gender': 'male'\n}\n\nresult = collection.insert_one(student)\nprint(result)\nprint(result.inserted_id)\n```\n\n运行结果如下：\n\n```python\n<pymongo.results.InsertOneResult object at 0x00000267F7E9CD80>\n60aa0884c1479c83fc0e07a6\n```\n\n与`insert`方法不同，返回的是`InsertOneResult`对象，可以调用其`inserted_id`属性获取`_id`。 对于`insert_many`方法，可以将数据以列表形式传递，示例如下：\n\n```python\nstudent1 = {\n    'id': '20170102',\n    'name': 'Jack',\n    'age':'23',\n    'gender': 'male'\n}\n\nstudent2 = {\n    'id': '201701013',\n    'name': 'Holy',\n    'age':'25',\n    'gender': 'male'\n}\nresult = collection.insert_many([student1,student2])\nprint(result)\nprint(result.inserted_ids)\n```\n\n运行结果如下：\n\n```python\n<pymongo.results.InsertManyResult object at 0x0000021A0BA7A780>\n[ObjectId('60aa0908ba9556afc2c8ebec'), ObjectId('60aa0908ba9556afc2c8ebed')]\n```\n\n该方法返回的类型是`InsertManyResult`，调用`inserted_ids`属性可以获取插入数据的`_id`列表。\n\n### 查询数据\n\n插入数据后，可以利用`find_one`或`find`方法进行查询，其中`find_one`查询得到的是单个结果，`find`则返回一个生成器对象。示例如下：\n\n```python\nresult = collection.find_one({'name': 'Holy'})\nprint(result)\n```\n\n这里我们查询`name`为`Holy`的数据，它的返回结果是字典类型，运行结果如下：\n\n查询结果：\n\n```python\n{'_id': ObjectId('60aa07d11755f43c2a5becf4'), 'id': '201701013', 'name': 'Holy', 'age': '25', 'gender': 'male'}\n```\n\n可以发现，它多了`_id`属性，这就是`MongoDB`在插入过程中自动添加的。此外，也可以根据`ObjectId`来查询，此时需要调用`bson`库里面的`objectid`：\n\n```python\nfrom bson.objectid import ObjectId\n\nresult = collection.find_one({'_id': ObjectId('60aa07d11755f43c2a5becf4')})\nprint(result)\n```\n\n查询结果：\n\n```python\n{'_id': ObjectId('60aa07d11755f43c2a5becf4'), 'id': '201701013', 'name': 'Holy', 'age': '25', 'gender': 'male'}\n```\n\n对于多条数据的查询，可以使用`find`方法。例如，这里查找性别为`male`的数据，示例如下：\n\n```python\nresults = collection.find({'age': 20})\nprint(results)\nfor result in results:\n    print(result)\n```\n\n运行结果如下：\n\n```python\n{'_id': ObjectId('60aa065e109b00a7eee5447b'), 'id': '20170101', 'name': 'Jordan', 'age': '20', 'gender': 'male'}\n{'_id': ObjectId('60aa0686802c3967b97d7791'), 'id': '20170101', 'name': 'Jordan', 'age': '20', 'gender': 'male'}\n{'_id': ObjectId('60aa06aca3aff156a9093404'), 'id': '20170101', 'name': 'Jordan', 'age': '20', 'gender': 'male'}\n{'_id': ObjectId('60aa076374369a6a0801fb4a'), 'id': '20170102', 'name': 'Jack', 'age': '23', 'gender': 'male'}\n{'_id': ObjectId('60aa077162e23647877e4213'), 'id': '20170102', 'name': 'Jack', 'age': '23', 'gender': 'male'}\n{'_id': ObjectId('60aa07d11755f43c2a5becf3'), 'id': '20170102', 'name': 'Jack', 'age': '23', 'gender': 'male'}\n{'_id': ObjectId('60aa07d11755f43c2a5becf4'), 'id': '201701013', 'name': 'Holy', 'age': '25', 'gender': 'male'}\n{'_id': ObjectId('60aa0884c1479c83fc0e07a6'), 'id': '20170101', 'name': 'Jordan', 'age': '20', 'gender': 'male'}\n{'_id': ObjectId('60aa08f67cd6ac92cb505552'), 'id': '20170102', 'name': 'Jack', 'age': '23', 'gender': 'male'}\n{'_id': ObjectId('60aa08f67cd6ac92cb505553'), 'id': '201701013', 'name': 'Holy', 'age': '25', 'gender': 'male'}\n{'_id': ObjectId('60aa0908ba9556afc2c8ebec'), 'id': '20170102', 'name': 'Jack', 'age': '23', 'gender': 'male'}\n{'_id': ObjectId('60aa0908ba9556afc2c8ebed'), 'id': '201701013', 'name': 'Holy', 'age': '25', 'gender': 'male'}\n```\n\n返回结果是`Cursor`类型，它相当于一个生成器，需要遍历获取的所有结果，其中每个结果都是字典类型。\n\n如果要查询年龄大于`20`的数据，则写法如下：\n\n```python\nresults = collection.find({'age': {'$gt': 20}})\n```\n\n查询的条件键值已经不是单纯的数字了，而是一个字典，其键名为比较符号`$gt`，意思是**大于**，键值为`20`。\n\n比较符号归纳如下：\n\n| 符号 | 含义 | 示例 |\n| :---: | :---: | :---: |\n| $lt | 小于 | {'age':{'$lt':20}} |\n| $gt | 大于 | {'age':{'$gt':20}} |\n| $lte | 小于或等于 | {'age':{'$lte':20}} |\n| $gte | 大于或等于 | {'age':{'$gte':20}} |\n| $ne | 不等于 | {'age':{'$ne':20}} |\n| $in | 在范围内 | {'age':{'$in':[20,23]}} |\n| $nin | 不在范围内 | {'age':{'$nin':[20, 23]}} |\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n另外，还可以进行正则匹配查询。例如，查询名字以`H`开头的学生数据，示例如下：\n\n```python\nresults = collection.find({'name': {'$regex': '^H.*'}})\n```\n\n这里使用`$regex`来指定正则匹配，`^M.*`代表以`M`开头的正则表达式。\n\n一些功能符号归类为下表：\n\n| 符号 | 含义 | 示例 |\n| :---: | :---: | :---: |\n| $regrx | 匹配正则表达式 | {'name':{'$regex':'^M.*'}} |\n| $exists | 属性是否存在 | {'name':{'$exists':True}} |\n| $type | 类型判断 | {'age':{'$type':'int'}} |\n| $mod | 数字模操作 | {'age':{'$mod':[5,0]}} |\n| $text | 文本查询 | {'$text':{'$search':'Holy'}} |\n| $where | 高级条件查询 | {'$where':'obj.fans_count==obj.follows_count'} |\n\n### 计数\n\n要统计查询结果有多少条数据，可以调用`count`方法。以统计所有数据条数为例：\n\n```python\ncount = collection.find().count()\nprint(count)\n```\n\n我们还可以统计符合某个条件的数据：\n\n```python\ncount = collection.find({'age': 20}).count() \nprint(count)\n```\n\n运行结果是一个数值，即符合条件的数据条数。\n\n### 排序\n\n排序时，可以直接调用`sort`方法，并在其中传入排序的字段及升降序标志。示例如下：\n\n```python\nresults = collection.find().sort('name', pymongo.ASCENDING)\nprint([result['name'] for result in results])\n```\n\n运行结果如下：\n\n```python\n['Holy', 'Holy', 'Holy', 'Holy', 'Jack', 'Jack', 'Jack', 'Jack', 'Jack', 'Jack', 'Jordan', 'Jordan', 'Jordan', 'Jordan']\n```\n\n调用`pymongo.ASCENDING`指定升序。如果要降序排列，可以传入`pymongo.DESCENDING`。\n\n### 偏移\n\n只需要取某几个元素，可以利用`skip`方法偏移几个位置，比如偏移2，就代表忽略前两个元素，得到第3个及以后的元素：\n\n```python\nresults = collection.find().sort('name', pymongo.ASCENDING).skip(3)\nprint([result['name'] for result in results])\n```\n\n运行结果如下：\n\n```python\n['Holy', 'Jack', 'Jack', 'Jack', 'Jack', 'Jack', 'Jack', 'Jordan', 'Jordan', 'Jordan', 'Jordan']\n```\n\n还可以用`limit`方法指定要取的结果个数，示例如下：\n\n```python\nresults = collection.find().sort('name', pymongo.ASCENDING).limit(1)\nprint([result['name'] for result in results])\n```\n\n运行结果如下：\n\n```python\n['Holy']\n```\n\n值得注意的是，在数据量非常庞大的时候，比如在查询千万、亿级别的数据库时，最好不要使用大的偏移量，因为这样很可能导致内存溢出。\n\n### 更新\n\n数据更新，可以使用`update`方法，指定更新的条件和更新后的数据即可。例如：\n\n```python\ncondition = {'name': 'Holy'}\nstudent = collection.find_one(condition)\nstudent['age'] = 30\nresult = collection.update(condition, student)\nprint(result)\n```\n\n更新`name`为`Holy`的数据的年龄：首先指定查询条件，然后将数据查询出来，修改年龄后调用`update`方法将原条件和修改后的数据传入。\n\n运行结果如下：\n\n```python\n{'n': 1, 'nModified': 0, 'ok': 1.0, 'updatedExisting': True}\n```\n\n返回结果是字典形式，`ok`代表执行成功，`nModified`代表影响的数据条数。\n\n也可以使用`$set`操作符对数据进行更新，代码如下：\n\n```python\nresult = collection.update(condition, {'$set': student})\n```\n\n这样可以只更新`student`字典内存在的字段。如果原先还有其他字段，则不会更新，也不会删除。而如果不用`$set`的话，则会把之前的数据全部用`student`字典替换；如果原本存在其他字段，则会被删除。\n\n`update`方法其实也是官方不推荐使用的方法。这里也分为`update_one`方法和`update_many`方法，用法更加严格，它们的第2个参数需要使用`$`类型操作符作为字典的键名，示例如下:\n\n```python\ncondition = {'name': 'Kevin'} \nstudent = collection.find_one(condition)\nstudent['age'] = 26\nresult = collection.update_one(condition, {'$set': student})\nprint(result) print(result.matched_count, result.modified_count)\n```\n\n上面的例子中调用了`update_one`方法，使得第2个参数不能再直接传入修改后的字典，而是需要使用`{'$set':student}`这样的形式，其返回结果是`UpdateResult`类型。然后分别调用`matched_count`和`modified_count`属性，可以获得匹配的数据条数和影响的数据条数。\n\n运行结果如下：\n\n```python\n<pymongo.results.UpdateResult object at 0x10d17b678>\n1 0\n```\n\n## 删除\n\n删除操作比较简单，直接调用`remove`方法指定删除的条件即可，此时符合条件的所有数据均会被删除。\n\n示例如下：\n\n```python\nresult = collection.remove({'name': 'Kevin'})\nprint(result)\n```\n\n运行结果如下：\n\n```python\n{'ok': 1, 'n': 1}\n```\n\n另外，这里依然存在两个新的推荐方法 ——`delete_one`和`delete_many`，示例如下：\n\n```python\nresult = collection.delete_one({'name': 'Kevin'})\nprint(result) \nprint(result.deleted_count)\nresult = collection.delete_many({'age': {'$lt': 25}})\nprint(result.deleted_count)\n```\n\n运行结果如下：\n\n```python\n<pymongo.results.DeleteResult object at 0x10e6ba4c8> \n14\n```\n\n`delete_one`删除第一条符合条件的数据，`delete_many`即删除所有符合条件的数据。它们的返回结果都是`DeleteResult`类型，可以调用`deleted_count`属性获取删除的数据条数。\n","source":"_posts/MongoDB数据库的使用.md","raw":"---\ntitle: MongoDB数据库的使用\ntags:\n  - python\n  - mongodb\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-23 14:46:16\ncategories: 爬虫\npic:\n---\n\n## 准备工作\n\n开始之前，请确保你已经安装好了`MongoDB`并启动了其服务，同时安装好了`Python`的`PyMongo`库。\n\n安装好之后，我们需要把`MongoDB`服务启动起来。启动完成之后，它会默认在本地`localhost`的`27017`端口上运行。\n\n接下来我们需要安装`PyMongo`这个库，它是`Python`用来操作`MongoDB`的第三方库，直接用`pip3`安装即可：\n\n```python\npip3 install pymongo\n```\n\n## 连接MongoDB\n\n连接`MongoDB`时，需要使用`PyMongo`库里面的`MongoClient`。一般来说，向其传入`MongoDB`的`IP`及端口即可，其中第一个参数为地址`host`，第二个参数为端口 `port`（如果不给它传递参数，则默认是`27017`）：\n\n```python\nimport pymongo\n\nclient = pymongo.MongoClient(host='localhost', port=27017)\n```\n\n另外，`MongoClient`的第一个参数`host`还可以直接传入`MongoDB`的连接字符串，它以`mongodb`开头，例如：\n\n```python\nclient = MongoClient('mongodb://localhost:27017/')\n```\n\n这样也可以达到同样的连接效果。\n\n### 指定数据库\n\n`MongoDB`中可以建立多个数据库，接下来指定操作其中一个数据库。这里以`test`数据库作为下一步需要在程序中指定使用的例子：\n\n```python\ndb = client.test\n```\n\n这里调用`client`的`test`属性即可返回`test`数据库。当然，也可以这样指定：\n\n```python\ndb = client['test']\n```\n\n这两种方式是等价的。\n\n### 指定集合\n\n`MongoDB`的每个数据库又包含许多集合`（collection）`，它们类似于关系型数据库中的表。\n\n下一步需要指定要操作的集合，这里指定一个名称为`students`的集合。与指定数据库类似，指定集合也有两种方式：\n\n```python\ncollection = db.students\n```\n\n或是\n\n```python\ncollection = db['students']\n```\n\n这样便声明了一个`Collection`对象。\n\n### 插入数据\n\n接下来，便可以插入数据了。对`students`这个集合新建一条学生数据，这条数据以字典形式表示：\n\n```python\nstudent = {\n    'id': '20170101',\n    'name': 'Jordan',\n    'age':'20',\n    'gender': 'male'\n}\n```\n\n新建的这条数据里指定了学生的学号、姓名、年龄和性别。直接调用`collection`的`insert`方法即可插入数据，代码如下：\n\n```python\nresult = collection.insert(student)\nprint(result)\n```\n\n在`MongoDB`中，每条数据其实都有一个`_id`属性来唯一标识。如果没有显式指明该属性，`MongoDB`会自动产生一个`ObjectId`类型的`_id`属性。`insert()`方法会在执行后返回`_id`值。\n\n运行结果如下：\n\n```python\n60aa06aca3aff156a9093404\n```\n\n当然，我们也可以同时插入多条数据，只需要以列表形式传递即可，示例如下：\n\n```python\nstudent1 = {\n    'id': '20170102',\n    'name': 'Jack',\n    'age':'23',\n    'gender': 'male'\n}\n\nstudent2 = {\n    'id': '201701013',\n    'name': 'Holy',\n    'age':'25',\n    'gender': 'male'\n}\nresult = collection.insert([student1, student2])\nprint(result)\n```\n\n返回结果是对应的`_id`的集合：\n\n```python\n[ObjectId('60aa07d11755f43c2a5becf3'), ObjectId('60aa07d11755f43c2a5becf4')]\n```\n\n在`PyMongo`中，官方已经不推荐使用`insert`方法了。但是如果你要继续使用也没有什么问题。目前，官方推荐使用`insert_one`和`insert_many`方法来分别插入单条记录和多条记录，示例如下：\n\n```python\nstudent = {\n    'id': '20170101',\n    'name': 'Jordan',\n    'age':'20',\n    'gender': 'male'\n}\n\nresult = collection.insert_one(student)\nprint(result)\nprint(result.inserted_id)\n```\n\n运行结果如下：\n\n```python\n<pymongo.results.InsertOneResult object at 0x00000267F7E9CD80>\n60aa0884c1479c83fc0e07a6\n```\n\n与`insert`方法不同，返回的是`InsertOneResult`对象，可以调用其`inserted_id`属性获取`_id`。 对于`insert_many`方法，可以将数据以列表形式传递，示例如下：\n\n```python\nstudent1 = {\n    'id': '20170102',\n    'name': 'Jack',\n    'age':'23',\n    'gender': 'male'\n}\n\nstudent2 = {\n    'id': '201701013',\n    'name': 'Holy',\n    'age':'25',\n    'gender': 'male'\n}\nresult = collection.insert_many([student1,student2])\nprint(result)\nprint(result.inserted_ids)\n```\n\n运行结果如下：\n\n```python\n<pymongo.results.InsertManyResult object at 0x0000021A0BA7A780>\n[ObjectId('60aa0908ba9556afc2c8ebec'), ObjectId('60aa0908ba9556afc2c8ebed')]\n```\n\n该方法返回的类型是`InsertManyResult`，调用`inserted_ids`属性可以获取插入数据的`_id`列表。\n\n### 查询数据\n\n插入数据后，可以利用`find_one`或`find`方法进行查询，其中`find_one`查询得到的是单个结果，`find`则返回一个生成器对象。示例如下：\n\n```python\nresult = collection.find_one({'name': 'Holy'})\nprint(result)\n```\n\n这里我们查询`name`为`Holy`的数据，它的返回结果是字典类型，运行结果如下：\n\n查询结果：\n\n```python\n{'_id': ObjectId('60aa07d11755f43c2a5becf4'), 'id': '201701013', 'name': 'Holy', 'age': '25', 'gender': 'male'}\n```\n\n可以发现，它多了`_id`属性，这就是`MongoDB`在插入过程中自动添加的。此外，也可以根据`ObjectId`来查询，此时需要调用`bson`库里面的`objectid`：\n\n```python\nfrom bson.objectid import ObjectId\n\nresult = collection.find_one({'_id': ObjectId('60aa07d11755f43c2a5becf4')})\nprint(result)\n```\n\n查询结果：\n\n```python\n{'_id': ObjectId('60aa07d11755f43c2a5becf4'), 'id': '201701013', 'name': 'Holy', 'age': '25', 'gender': 'male'}\n```\n\n对于多条数据的查询，可以使用`find`方法。例如，这里查找性别为`male`的数据，示例如下：\n\n```python\nresults = collection.find({'age': 20})\nprint(results)\nfor result in results:\n    print(result)\n```\n\n运行结果如下：\n\n```python\n{'_id': ObjectId('60aa065e109b00a7eee5447b'), 'id': '20170101', 'name': 'Jordan', 'age': '20', 'gender': 'male'}\n{'_id': ObjectId('60aa0686802c3967b97d7791'), 'id': '20170101', 'name': 'Jordan', 'age': '20', 'gender': 'male'}\n{'_id': ObjectId('60aa06aca3aff156a9093404'), 'id': '20170101', 'name': 'Jordan', 'age': '20', 'gender': 'male'}\n{'_id': ObjectId('60aa076374369a6a0801fb4a'), 'id': '20170102', 'name': 'Jack', 'age': '23', 'gender': 'male'}\n{'_id': ObjectId('60aa077162e23647877e4213'), 'id': '20170102', 'name': 'Jack', 'age': '23', 'gender': 'male'}\n{'_id': ObjectId('60aa07d11755f43c2a5becf3'), 'id': '20170102', 'name': 'Jack', 'age': '23', 'gender': 'male'}\n{'_id': ObjectId('60aa07d11755f43c2a5becf4'), 'id': '201701013', 'name': 'Holy', 'age': '25', 'gender': 'male'}\n{'_id': ObjectId('60aa0884c1479c83fc0e07a6'), 'id': '20170101', 'name': 'Jordan', 'age': '20', 'gender': 'male'}\n{'_id': ObjectId('60aa08f67cd6ac92cb505552'), 'id': '20170102', 'name': 'Jack', 'age': '23', 'gender': 'male'}\n{'_id': ObjectId('60aa08f67cd6ac92cb505553'), 'id': '201701013', 'name': 'Holy', 'age': '25', 'gender': 'male'}\n{'_id': ObjectId('60aa0908ba9556afc2c8ebec'), 'id': '20170102', 'name': 'Jack', 'age': '23', 'gender': 'male'}\n{'_id': ObjectId('60aa0908ba9556afc2c8ebed'), 'id': '201701013', 'name': 'Holy', 'age': '25', 'gender': 'male'}\n```\n\n返回结果是`Cursor`类型，它相当于一个生成器，需要遍历获取的所有结果，其中每个结果都是字典类型。\n\n如果要查询年龄大于`20`的数据，则写法如下：\n\n```python\nresults = collection.find({'age': {'$gt': 20}})\n```\n\n查询的条件键值已经不是单纯的数字了，而是一个字典，其键名为比较符号`$gt`，意思是**大于**，键值为`20`。\n\n比较符号归纳如下：\n\n| 符号 | 含义 | 示例 |\n| :---: | :---: | :---: |\n| $lt | 小于 | {'age':{'$lt':20}} |\n| $gt | 大于 | {'age':{'$gt':20}} |\n| $lte | 小于或等于 | {'age':{'$lte':20}} |\n| $gte | 大于或等于 | {'age':{'$gte':20}} |\n| $ne | 不等于 | {'age':{'$ne':20}} |\n| $in | 在范围内 | {'age':{'$in':[20,23]}} |\n| $nin | 不在范围内 | {'age':{'$nin':[20, 23]}} |\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n另外，还可以进行正则匹配查询。例如，查询名字以`H`开头的学生数据，示例如下：\n\n```python\nresults = collection.find({'name': {'$regex': '^H.*'}})\n```\n\n这里使用`$regex`来指定正则匹配，`^M.*`代表以`M`开头的正则表达式。\n\n一些功能符号归类为下表：\n\n| 符号 | 含义 | 示例 |\n| :---: | :---: | :---: |\n| $regrx | 匹配正则表达式 | {'name':{'$regex':'^M.*'}} |\n| $exists | 属性是否存在 | {'name':{'$exists':True}} |\n| $type | 类型判断 | {'age':{'$type':'int'}} |\n| $mod | 数字模操作 | {'age':{'$mod':[5,0]}} |\n| $text | 文本查询 | {'$text':{'$search':'Holy'}} |\n| $where | 高级条件查询 | {'$where':'obj.fans_count==obj.follows_count'} |\n\n### 计数\n\n要统计查询结果有多少条数据，可以调用`count`方法。以统计所有数据条数为例：\n\n```python\ncount = collection.find().count()\nprint(count)\n```\n\n我们还可以统计符合某个条件的数据：\n\n```python\ncount = collection.find({'age': 20}).count() \nprint(count)\n```\n\n运行结果是一个数值，即符合条件的数据条数。\n\n### 排序\n\n排序时，可以直接调用`sort`方法，并在其中传入排序的字段及升降序标志。示例如下：\n\n```python\nresults = collection.find().sort('name', pymongo.ASCENDING)\nprint([result['name'] for result in results])\n```\n\n运行结果如下：\n\n```python\n['Holy', 'Holy', 'Holy', 'Holy', 'Jack', 'Jack', 'Jack', 'Jack', 'Jack', 'Jack', 'Jordan', 'Jordan', 'Jordan', 'Jordan']\n```\n\n调用`pymongo.ASCENDING`指定升序。如果要降序排列，可以传入`pymongo.DESCENDING`。\n\n### 偏移\n\n只需要取某几个元素，可以利用`skip`方法偏移几个位置，比如偏移2，就代表忽略前两个元素，得到第3个及以后的元素：\n\n```python\nresults = collection.find().sort('name', pymongo.ASCENDING).skip(3)\nprint([result['name'] for result in results])\n```\n\n运行结果如下：\n\n```python\n['Holy', 'Jack', 'Jack', 'Jack', 'Jack', 'Jack', 'Jack', 'Jordan', 'Jordan', 'Jordan', 'Jordan']\n```\n\n还可以用`limit`方法指定要取的结果个数，示例如下：\n\n```python\nresults = collection.find().sort('name', pymongo.ASCENDING).limit(1)\nprint([result['name'] for result in results])\n```\n\n运行结果如下：\n\n```python\n['Holy']\n```\n\n值得注意的是，在数据量非常庞大的时候，比如在查询千万、亿级别的数据库时，最好不要使用大的偏移量，因为这样很可能导致内存溢出。\n\n### 更新\n\n数据更新，可以使用`update`方法，指定更新的条件和更新后的数据即可。例如：\n\n```python\ncondition = {'name': 'Holy'}\nstudent = collection.find_one(condition)\nstudent['age'] = 30\nresult = collection.update(condition, student)\nprint(result)\n```\n\n更新`name`为`Holy`的数据的年龄：首先指定查询条件，然后将数据查询出来，修改年龄后调用`update`方法将原条件和修改后的数据传入。\n\n运行结果如下：\n\n```python\n{'n': 1, 'nModified': 0, 'ok': 1.0, 'updatedExisting': True}\n```\n\n返回结果是字典形式，`ok`代表执行成功，`nModified`代表影响的数据条数。\n\n也可以使用`$set`操作符对数据进行更新，代码如下：\n\n```python\nresult = collection.update(condition, {'$set': student})\n```\n\n这样可以只更新`student`字典内存在的字段。如果原先还有其他字段，则不会更新，也不会删除。而如果不用`$set`的话，则会把之前的数据全部用`student`字典替换；如果原本存在其他字段，则会被删除。\n\n`update`方法其实也是官方不推荐使用的方法。这里也分为`update_one`方法和`update_many`方法，用法更加严格，它们的第2个参数需要使用`$`类型操作符作为字典的键名，示例如下:\n\n```python\ncondition = {'name': 'Kevin'} \nstudent = collection.find_one(condition)\nstudent['age'] = 26\nresult = collection.update_one(condition, {'$set': student})\nprint(result) print(result.matched_count, result.modified_count)\n```\n\n上面的例子中调用了`update_one`方法，使得第2个参数不能再直接传入修改后的字典，而是需要使用`{'$set':student}`这样的形式，其返回结果是`UpdateResult`类型。然后分别调用`matched_count`和`modified_count`属性，可以获得匹配的数据条数和影响的数据条数。\n\n运行结果如下：\n\n```python\n<pymongo.results.UpdateResult object at 0x10d17b678>\n1 0\n```\n\n## 删除\n\n删除操作比较简单，直接调用`remove`方法指定删除的条件即可，此时符合条件的所有数据均会被删除。\n\n示例如下：\n\n```python\nresult = collection.remove({'name': 'Kevin'})\nprint(result)\n```\n\n运行结果如下：\n\n```python\n{'ok': 1, 'n': 1}\n```\n\n另外，这里依然存在两个新的推荐方法 ——`delete_one`和`delete_many`，示例如下：\n\n```python\nresult = collection.delete_one({'name': 'Kevin'})\nprint(result) \nprint(result.deleted_count)\nresult = collection.delete_many({'age': {'$lt': 25}})\nprint(result.deleted_count)\n```\n\n运行结果如下：\n\n```python\n<pymongo.results.DeleteResult object at 0x10e6ba4c8> \n14\n```\n\n`delete_one`删除第一条符合条件的数据，`delete_many`即删除所有符合条件的数据。它们的返回结果都是`DeleteResult`类型，可以调用`deleted_count`属性获取删除的数据条数。\n","slug":"MongoDB数据库的使用","published":1,"updated":"2021-06-15T03:24:11.461Z","layout":"post","photos":[],"link":"","_id":"ckq14rx27001544ud4npbh07d","content":"<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p>开始之前，请确保你已经安装好了<code>MongoDB</code>并启动了其服务，同时安装好了<code>Python</code>的<code>PyMongo</code>库。</p>\n<p>安装好之后，我们需要把<code>MongoDB</code>服务启动起来。启动完成之后，它会默认在本地<code>localhost</code>的<code>27017</code>端口上运行。</p>\n<p>接下来我们需要安装<code>PyMongo</code>这个库，它是<code>Python</code>用来操作<code>MongoDB</code>的第三方库，直接用<code>pip3</code>安装即可：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install pymongo</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"连接MongoDB\"><a href=\"#连接MongoDB\" class=\"headerlink\" title=\"连接MongoDB\"></a>连接MongoDB</h2><p>连接<code>MongoDB</code>时，需要使用<code>PyMongo</code>库里面的<code>MongoClient</code>。一般来说，向其传入<code>MongoDB</code>的<code>IP</code>及端口即可，其中第一个参数为地址<code>host</code>，第二个参数为端口 <code>port</code>（如果不给它传递参数，则默认是<code>27017</code>）：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pymongo</span><br><span class=\"line\"></span><br><span class=\"line\">client = pymongo.MongoClient(host=<span class=\"string\">&#x27;localhost&#x27;</span>, port=<span class=\"number\">27017</span>)</span><br></pre></td></tr></table></figure>\n\n<p>另外，<code>MongoClient</code>的第一个参数<code>host</code>还可以直接传入<code>MongoDB</code>的连接字符串，它以<code>mongodb</code>开头，例如：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client = MongoClient(<span class=\"string\">&#x27;mongodb://localhost:27017/&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这样也可以达到同样的连接效果。</p>\n<h3 id=\"指定数据库\"><a href=\"#指定数据库\" class=\"headerlink\" title=\"指定数据库\"></a>指定数据库</h3><p><code>MongoDB</code>中可以建立多个数据库，接下来指定操作其中一个数据库。这里以<code>test</code>数据库作为下一步需要在程序中指定使用的例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db = client.test</span><br></pre></td></tr></table></figure>\n\n<p>这里调用<code>client</code>的<code>test</code>属性即可返回<code>test</code>数据库。当然，也可以这样指定：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db = client[<span class=\"string\">&#x27;test&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>这两种方式是等价的。</p>\n<h3 id=\"指定集合\"><a href=\"#指定集合\" class=\"headerlink\" title=\"指定集合\"></a>指定集合</h3><p><code>MongoDB</code>的每个数据库又包含许多集合<code>（collection）</code>，它们类似于关系型数据库中的表。</p>\n<p>下一步需要指定要操作的集合，这里指定一个名称为<code>students</code>的集合。与指定数据库类似，指定集合也有两种方式：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">collection = db.students</span><br></pre></td></tr></table></figure>\n\n<p>或是</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">collection = db[<span class=\"string\">&#x27;students&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>这样便声明了一个<code>Collection</code>对象。</p>\n<h3 id=\"插入数据\"><a href=\"#插入数据\" class=\"headerlink\" title=\"插入数据\"></a>插入数据</h3><p>接下来，便可以插入数据了。对<code>students</code>这个集合新建一条学生数据，这条数据以字典形式表示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">student = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170101&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jordan&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;20&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>新建的这条数据里指定了学生的学号、姓名、年龄和性别。直接调用<code>collection</code>的<code>insert</code>方法即可插入数据，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = collection.insert(student)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<p>在<code>MongoDB</code>中，每条数据其实都有一个<code>_id</code>属性来唯一标识。如果没有显式指明该属性，<code>MongoDB</code>会自动产生一个<code>ObjectId</code>类型的<code>_id</code>属性。<code>insert()</code>方法会在执行后返回<code>_id</code>值。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">60aa06aca3aff156a9093404</span><br></pre></td></tr></table></figure>\n\n<p>当然，我们也可以同时插入多条数据，只需要以列表形式传递即可，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">student1 = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170102&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jack&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;23&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">student2 = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;201701013&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;25&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">result = collection.insert([student1, student2])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<p>返回结果是对应的<code>_id</code>的集合：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[ObjectId(<span class=\"string\">&#x27;60aa07d11755f43c2a5becf3&#x27;</span>), ObjectId(<span class=\"string\">&#x27;60aa07d11755f43c2a5becf4&#x27;</span>)]</span><br></pre></td></tr></table></figure>\n\n<p>在<code>PyMongo</code>中，官方已经不推荐使用<code>insert</code>方法了。但是如果你要继续使用也没有什么问题。目前，官方推荐使用<code>insert_one</code>和<code>insert_many</code>方法来分别插入单条记录和多条记录，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">student = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170101&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jordan&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;20&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">result = collection.insert_one(student)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.inserted_id)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;pymongo.results.InsertOneResult <span class=\"built_in\">object</span> at <span class=\"number\">0x00000267F7E9CD80</span>&gt;</span><br><span class=\"line\">60aa0884c1479c83fc0e07a6</span><br></pre></td></tr></table></figure>\n\n<p>与<code>insert</code>方法不同，返回的是<code>InsertOneResult</code>对象，可以调用其<code>inserted_id</code>属性获取<code>_id</code>。 对于<code>insert_many</code>方法，可以将数据以列表形式传递，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">student1 = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170102&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jack&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;23&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">student2 = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;201701013&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;25&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">result = collection.insert_many([student1,student2])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.inserted_ids)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;pymongo.results.InsertManyResult <span class=\"built_in\">object</span> at <span class=\"number\">0x0000021A0BA7A780</span>&gt;</span><br><span class=\"line\">[ObjectId(<span class=\"string\">&#x27;60aa0908ba9556afc2c8ebec&#x27;</span>), ObjectId(<span class=\"string\">&#x27;60aa0908ba9556afc2c8ebed&#x27;</span>)]</span><br></pre></td></tr></table></figure>\n\n<p>该方法返回的类型是<code>InsertManyResult</code>，调用<code>inserted_ids</code>属性可以获取插入数据的<code>_id</code>列表。</p>\n<h3 id=\"查询数据\"><a href=\"#查询数据\" class=\"headerlink\" title=\"查询数据\"></a>查询数据</h3><p>插入数据后，可以利用<code>find_one</code>或<code>find</code>方法进行查询，其中<code>find_one</code>查询得到的是单个结果，<code>find</code>则返回一个生成器对象。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = collection.find_one(&#123;<span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<p>这里我们查询<code>name</code>为<code>Holy</code>的数据，它的返回结果是字典类型，运行结果如下：</p>\n<p>查询结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa07d11755f43c2a5becf4&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;201701013&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;25&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以发现，它多了<code>_id</code>属性，这就是<code>MongoDB</code>在插入过程中自动添加的。此外，也可以根据<code>ObjectId</code>来查询，此时需要调用<code>bson</code>库里面的<code>objectid</code>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> bson.objectid <span class=\"keyword\">import</span> ObjectId</span><br><span class=\"line\"></span><br><span class=\"line\">result = collection.find_one(&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa07d11755f43c2a5becf4&#x27;</span>)&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<p>查询结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa07d11755f43c2a5becf4&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;201701013&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;25&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>对于多条数据的查询，可以使用<code>find</code>方法。例如，这里查找性别为<code>male</code>的数据，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">results = collection.find(&#123;<span class=\"string\">&#x27;age&#x27;</span>: <span class=\"number\">20</span>&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(results)</span><br><span class=\"line\"><span class=\"keyword\">for</span> result <span class=\"keyword\">in</span> results:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa065e109b00a7eee5447b&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170101&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;20&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa0686802c3967b97d7791&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170101&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;20&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa06aca3aff156a9093404&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170101&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;20&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa076374369a6a0801fb4a&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170102&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;23&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa077162e23647877e4213&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170102&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;23&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa07d11755f43c2a5becf3&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170102&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;23&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa07d11755f43c2a5becf4&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;201701013&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;25&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa0884c1479c83fc0e07a6&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170101&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;20&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa08f67cd6ac92cb505552&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170102&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;23&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa08f67cd6ac92cb505553&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;201701013&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;25&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa0908ba9556afc2c8ebec&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170102&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;23&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa0908ba9556afc2c8ebed&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;201701013&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;25&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>返回结果是<code>Cursor</code>类型，它相当于一个生成器，需要遍历获取的所有结果，其中每个结果都是字典类型。</p>\n<p>如果要查询年龄大于<code>20</code>的数据，则写法如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">results = collection.find(&#123;<span class=\"string\">&#x27;age&#x27;</span>: &#123;<span class=\"string\">&#x27;$gt&#x27;</span>: <span class=\"number\">20</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>查询的条件键值已经不是单纯的数字了，而是一个字典，其键名为比较符号<code>$gt</code>，意思是<strong>大于</strong>，键值为<code>20</code>。</p>\n<p>比较符号归纳如下：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">符号</th>\n<th align=\"center\">含义</th>\n<th align=\"center\">示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">$lt</td>\n<td align=\"center\">小于</td>\n<td align=\"center\">{‘age’:{‘$lt’:20}}</td>\n</tr>\n<tr>\n<td align=\"center\">$gt</td>\n<td align=\"center\">大于</td>\n<td align=\"center\">{‘age’:{‘$gt’:20}}</td>\n</tr>\n<tr>\n<td align=\"center\">$lte</td>\n<td align=\"center\">小于或等于</td>\n<td align=\"center\">{‘age’:{‘$lte’:20}}</td>\n</tr>\n<tr>\n<td align=\"center\">$gte</td>\n<td align=\"center\">大于或等于</td>\n<td align=\"center\">{‘age’:{‘$gte’:20}}</td>\n</tr>\n<tr>\n<td align=\"center\">$ne</td>\n<td align=\"center\">不等于</td>\n<td align=\"center\">{‘age’:{‘$ne’:20}}</td>\n</tr>\n<tr>\n<td align=\"center\">$in</td>\n<td align=\"center\">在范围内</td>\n<td align=\"center\">{‘age’:{‘$in’:[20,23]}}</td>\n</tr>\n<tr>\n<td align=\"center\">$nin</td>\n<td align=\"center\">不在范围内</td>\n<td align=\"center\">{‘age’:{‘$nin’:[20, 23]}}</td>\n</tr>\n</tbody></table>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n<p>另外，还可以进行正则匹配查询。例如，查询名字以<code>H</code>开头的学生数据，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">results = collection.find(&#123;<span class=\"string\">&#x27;name&#x27;</span>: &#123;<span class=\"string\">&#x27;$regex&#x27;</span>: <span class=\"string\">&#x27;^H.*&#x27;</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>这里使用<code>$regex</code>来指定正则匹配，<code>^M.*</code>代表以<code>M</code>开头的正则表达式。</p>\n<p>一些功能符号归类为下表：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">符号</th>\n<th align=\"center\">含义</th>\n<th align=\"center\">示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">$regrx</td>\n<td align=\"center\">匹配正则表达式</td>\n<td align=\"center\">{‘name’:{‘$regex’:’^M.*’}}</td>\n</tr>\n<tr>\n<td align=\"center\">$exists</td>\n<td align=\"center\">属性是否存在</td>\n<td align=\"center\">{‘name’:{‘$exists’:True}}</td>\n</tr>\n<tr>\n<td align=\"center\">$type</td>\n<td align=\"center\">类型判断</td>\n<td align=\"center\">{‘age’:{‘$type’:’int’}}</td>\n</tr>\n<tr>\n<td align=\"center\">$mod</td>\n<td align=\"center\">数字模操作</td>\n<td align=\"center\">{‘age’:{‘$mod’:[5,0]}}</td>\n</tr>\n<tr>\n<td align=\"center\">$text</td>\n<td align=\"center\">文本查询</td>\n<td align=\"center\">{‘$text’:{‘$search’:’Holy’}}</td>\n</tr>\n<tr>\n<td align=\"center\">$where</td>\n<td align=\"center\">高级条件查询</td>\n<td align=\"center\">{‘$where’:’obj.fans_count==obj.follows_count’}</td>\n</tr>\n</tbody></table>\n<h3 id=\"计数\"><a href=\"#计数\" class=\"headerlink\" title=\"计数\"></a>计数</h3><p>要统计查询结果有多少条数据，可以调用<code>count</code>方法。以统计所有数据条数为例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">count = collection.find().count()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(count)</span><br></pre></td></tr></table></figure>\n\n<p>我们还可以统计符合某个条件的数据：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">count = collection.find(&#123;<span class=\"string\">&#x27;age&#x27;</span>: <span class=\"number\">20</span>&#125;).count() </span><br><span class=\"line\"><span class=\"built_in\">print</span>(count)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果是一个数值，即符合条件的数据条数。</p>\n<h3 id=\"排序\"><a href=\"#排序\" class=\"headerlink\" title=\"排序\"></a>排序</h3><p>排序时，可以直接调用<code>sort</code>方法，并在其中传入排序的字段及升降序标志。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">results = collection.find().sort(<span class=\"string\">&#x27;name&#x27;</span>, pymongo.ASCENDING)</span><br><span class=\"line\"><span class=\"built_in\">print</span>([result[<span class=\"string\">&#x27;name&#x27;</span>] <span class=\"keyword\">for</span> result <span class=\"keyword\">in</span> results])</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>调用<code>pymongo.ASCENDING</code>指定升序。如果要降序排列，可以传入<code>pymongo.DESCENDING</code>。</p>\n<h3 id=\"偏移\"><a href=\"#偏移\" class=\"headerlink\" title=\"偏移\"></a>偏移</h3><p>只需要取某几个元素，可以利用<code>skip</code>方法偏移几个位置，比如偏移2，就代表忽略前两个元素，得到第3个及以后的元素：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">results = collection.find().sort(<span class=\"string\">&#x27;name&#x27;</span>, pymongo.ASCENDING).skip(<span class=\"number\">3</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>([result[<span class=\"string\">&#x27;name&#x27;</span>] <span class=\"keyword\">for</span> result <span class=\"keyword\">in</span> results])</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>还可以用<code>limit</code>方法指定要取的结果个数，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">results = collection.find().sort(<span class=\"string\">&#x27;name&#x27;</span>, pymongo.ASCENDING).limit(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>([result[<span class=\"string\">&#x27;name&#x27;</span>] <span class=\"keyword\">for</span> result <span class=\"keyword\">in</span> results])</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">&#x27;Holy&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>值得注意的是，在数据量非常庞大的时候，比如在查询千万、亿级别的数据库时，最好不要使用大的偏移量，因为这样很可能导致内存溢出。</p>\n<h3 id=\"更新\"><a href=\"#更新\" class=\"headerlink\" title=\"更新\"></a>更新</h3><p>数据更新，可以使用<code>update</code>方法，指定更新的条件和更新后的数据即可。例如：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">condition = &#123;<span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>&#125;</span><br><span class=\"line\">student = collection.find_one(condition)</span><br><span class=\"line\">student[<span class=\"string\">&#x27;age&#x27;</span>] = <span class=\"number\">30</span></span><br><span class=\"line\">result = collection.update(condition, student)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<p>更新<code>name</code>为<code>Holy</code>的数据的年龄：首先指定查询条件，然后将数据查询出来，修改年龄后调用<code>update</code>方法将原条件和修改后的数据传入。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&#x27;n&#x27;</span>: <span class=\"number\">1</span>, <span class=\"string\">&#x27;nModified&#x27;</span>: <span class=\"number\">0</span>, <span class=\"string\">&#x27;ok&#x27;</span>: <span class=\"number\">1.0</span>, <span class=\"string\">&#x27;updatedExisting&#x27;</span>: <span class=\"literal\">True</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>返回结果是字典形式，<code>ok</code>代表执行成功，<code>nModified</code>代表影响的数据条数。</p>\n<p>也可以使用<code>$set</code>操作符对数据进行更新，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = collection.update(condition, &#123;<span class=\"string\">&#x27;$set&#x27;</span>: student&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>这样可以只更新<code>student</code>字典内存在的字段。如果原先还有其他字段，则不会更新，也不会删除。而如果不用<code>$set</code>的话，则会把之前的数据全部用<code>student</code>字典替换；如果原本存在其他字段，则会被删除。</p>\n<p><code>update</code>方法其实也是官方不推荐使用的方法。这里也分为<code>update_one</code>方法和<code>update_many</code>方法，用法更加严格，它们的第2个参数需要使用<code>$</code>类型操作符作为字典的键名，示例如下:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">condition = &#123;<span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Kevin&#x27;</span>&#125; </span><br><span class=\"line\">student = collection.find_one(condition)</span><br><span class=\"line\">student[<span class=\"string\">&#x27;age&#x27;</span>] = <span class=\"number\">26</span></span><br><span class=\"line\">result = collection.update_one(condition, &#123;<span class=\"string\">&#x27;$set&#x27;</span>: student&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result) <span class=\"built_in\">print</span>(result.matched_count, result.modified_count)</span><br></pre></td></tr></table></figure>\n\n<p>上面的例子中调用了<code>update_one</code>方法，使得第2个参数不能再直接传入修改后的字典，而是需要使用<code>&#123;&#39;$set&#39;:student&#125;</code>这样的形式，其返回结果是<code>UpdateResult</code>类型。然后分别调用<code>matched_count</code>和<code>modified_count</code>属性，可以获得匹配的数据条数和影响的数据条数。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;pymongo.results.UpdateResult <span class=\"built_in\">object</span> at <span class=\"number\">0x10d17b678</span>&gt;</span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h2><p>删除操作比较简单，直接调用<code>remove</code>方法指定删除的条件即可，此时符合条件的所有数据均会被删除。</p>\n<p>示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = collection.remove(&#123;<span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Kevin&#x27;</span>&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&#x27;ok&#x27;</span>: <span class=\"number\">1</span>, <span class=\"string\">&#x27;n&#x27;</span>: <span class=\"number\">1</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>另外，这里依然存在两个新的推荐方法 ——<code>delete_one</code>和<code>delete_many</code>，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = collection.delete_one(&#123;<span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Kevin&#x27;</span>&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.deleted_count)</span><br><span class=\"line\">result = collection.delete_many(&#123;<span class=\"string\">&#x27;age&#x27;</span>: &#123;<span class=\"string\">&#x27;$lt&#x27;</span>: <span class=\"number\">25</span>&#125;&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.deleted_count)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;pymongo.results.DeleteResult <span class=\"built_in\">object</span> at <span class=\"number\">0x10e6ba4c8</span>&gt; </span><br><span class=\"line\"><span class=\"number\">14</span></span><br></pre></td></tr></table></figure>\n\n<p><code>delete_one</code>删除第一条符合条件的数据，<code>delete_many</code>即删除所有符合条件的数据。它们的返回结果都是<code>DeleteResult</code>类型，可以调用<code>deleted_count</code>属性获取删除的数据条数。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p>开始之前，请确保你已经安装好了<code>MongoDB</code>并启动了其服务，同时安装好了<code>Python</code>的<code>PyMongo</code>库。</p>\n<p>安装好之后，我们需要把<code>MongoDB</code>服务启动起来。启动完成之后，它会默认在本地<code>localhost</code>的<code>27017</code>端口上运行。</p>\n<p>接下来我们需要安装<code>PyMongo</code>这个库，它是<code>Python</code>用来操作<code>MongoDB</code>的第三方库，直接用<code>pip3</code>安装即可：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install pymongo</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"连接MongoDB\"><a href=\"#连接MongoDB\" class=\"headerlink\" title=\"连接MongoDB\"></a>连接MongoDB</h2><p>连接<code>MongoDB</code>时，需要使用<code>PyMongo</code>库里面的<code>MongoClient</code>。一般来说，向其传入<code>MongoDB</code>的<code>IP</code>及端口即可，其中第一个参数为地址<code>host</code>，第二个参数为端口 <code>port</code>（如果不给它传递参数，则默认是<code>27017</code>）：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pymongo</span><br><span class=\"line\"></span><br><span class=\"line\">client = pymongo.MongoClient(host=<span class=\"string\">&#x27;localhost&#x27;</span>, port=<span class=\"number\">27017</span>)</span><br></pre></td></tr></table></figure>\n\n<p>另外，<code>MongoClient</code>的第一个参数<code>host</code>还可以直接传入<code>MongoDB</code>的连接字符串，它以<code>mongodb</code>开头，例如：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client = MongoClient(<span class=\"string\">&#x27;mongodb://localhost:27017/&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这样也可以达到同样的连接效果。</p>\n<h3 id=\"指定数据库\"><a href=\"#指定数据库\" class=\"headerlink\" title=\"指定数据库\"></a>指定数据库</h3><p><code>MongoDB</code>中可以建立多个数据库，接下来指定操作其中一个数据库。这里以<code>test</code>数据库作为下一步需要在程序中指定使用的例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db = client.test</span><br></pre></td></tr></table></figure>\n\n<p>这里调用<code>client</code>的<code>test</code>属性即可返回<code>test</code>数据库。当然，也可以这样指定：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db = client[<span class=\"string\">&#x27;test&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>这两种方式是等价的。</p>\n<h3 id=\"指定集合\"><a href=\"#指定集合\" class=\"headerlink\" title=\"指定集合\"></a>指定集合</h3><p><code>MongoDB</code>的每个数据库又包含许多集合<code>（collection）</code>，它们类似于关系型数据库中的表。</p>\n<p>下一步需要指定要操作的集合，这里指定一个名称为<code>students</code>的集合。与指定数据库类似，指定集合也有两种方式：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">collection = db.students</span><br></pre></td></tr></table></figure>\n\n<p>或是</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">collection = db[<span class=\"string\">&#x27;students&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>这样便声明了一个<code>Collection</code>对象。</p>\n<h3 id=\"插入数据\"><a href=\"#插入数据\" class=\"headerlink\" title=\"插入数据\"></a>插入数据</h3><p>接下来，便可以插入数据了。对<code>students</code>这个集合新建一条学生数据，这条数据以字典形式表示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">student = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170101&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jordan&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;20&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>新建的这条数据里指定了学生的学号、姓名、年龄和性别。直接调用<code>collection</code>的<code>insert</code>方法即可插入数据，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = collection.insert(student)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<p>在<code>MongoDB</code>中，每条数据其实都有一个<code>_id</code>属性来唯一标识。如果没有显式指明该属性，<code>MongoDB</code>会自动产生一个<code>ObjectId</code>类型的<code>_id</code>属性。<code>insert()</code>方法会在执行后返回<code>_id</code>值。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">60aa06aca3aff156a9093404</span><br></pre></td></tr></table></figure>\n\n<p>当然，我们也可以同时插入多条数据，只需要以列表形式传递即可，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">student1 = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170102&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jack&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;23&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">student2 = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;201701013&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;25&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">result = collection.insert([student1, student2])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<p>返回结果是对应的<code>_id</code>的集合：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[ObjectId(<span class=\"string\">&#x27;60aa07d11755f43c2a5becf3&#x27;</span>), ObjectId(<span class=\"string\">&#x27;60aa07d11755f43c2a5becf4&#x27;</span>)]</span><br></pre></td></tr></table></figure>\n\n<p>在<code>PyMongo</code>中，官方已经不推荐使用<code>insert</code>方法了。但是如果你要继续使用也没有什么问题。目前，官方推荐使用<code>insert_one</code>和<code>insert_many</code>方法来分别插入单条记录和多条记录，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">student = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170101&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jordan&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;20&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">result = collection.insert_one(student)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.inserted_id)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;pymongo.results.InsertOneResult <span class=\"built_in\">object</span> at <span class=\"number\">0x00000267F7E9CD80</span>&gt;</span><br><span class=\"line\">60aa0884c1479c83fc0e07a6</span><br></pre></td></tr></table></figure>\n\n<p>与<code>insert</code>方法不同，返回的是<code>InsertOneResult</code>对象，可以调用其<code>inserted_id</code>属性获取<code>_id</code>。 对于<code>insert_many</code>方法，可以将数据以列表形式传递，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">student1 = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170102&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jack&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;23&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">student2 = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;201701013&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;25&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">result = collection.insert_many([student1,student2])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.inserted_ids)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;pymongo.results.InsertManyResult <span class=\"built_in\">object</span> at <span class=\"number\">0x0000021A0BA7A780</span>&gt;</span><br><span class=\"line\">[ObjectId(<span class=\"string\">&#x27;60aa0908ba9556afc2c8ebec&#x27;</span>), ObjectId(<span class=\"string\">&#x27;60aa0908ba9556afc2c8ebed&#x27;</span>)]</span><br></pre></td></tr></table></figure>\n\n<p>该方法返回的类型是<code>InsertManyResult</code>，调用<code>inserted_ids</code>属性可以获取插入数据的<code>_id</code>列表。</p>\n<h3 id=\"查询数据\"><a href=\"#查询数据\" class=\"headerlink\" title=\"查询数据\"></a>查询数据</h3><p>插入数据后，可以利用<code>find_one</code>或<code>find</code>方法进行查询，其中<code>find_one</code>查询得到的是单个结果，<code>find</code>则返回一个生成器对象。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = collection.find_one(&#123;<span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<p>这里我们查询<code>name</code>为<code>Holy</code>的数据，它的返回结果是字典类型，运行结果如下：</p>\n<p>查询结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa07d11755f43c2a5becf4&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;201701013&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;25&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以发现，它多了<code>_id</code>属性，这就是<code>MongoDB</code>在插入过程中自动添加的。此外，也可以根据<code>ObjectId</code>来查询，此时需要调用<code>bson</code>库里面的<code>objectid</code>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> bson.objectid <span class=\"keyword\">import</span> ObjectId</span><br><span class=\"line\"></span><br><span class=\"line\">result = collection.find_one(&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa07d11755f43c2a5becf4&#x27;</span>)&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<p>查询结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa07d11755f43c2a5becf4&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;201701013&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;25&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>对于多条数据的查询，可以使用<code>find</code>方法。例如，这里查找性别为<code>male</code>的数据，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">results = collection.find(&#123;<span class=\"string\">&#x27;age&#x27;</span>: <span class=\"number\">20</span>&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(results)</span><br><span class=\"line\"><span class=\"keyword\">for</span> result <span class=\"keyword\">in</span> results:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa065e109b00a7eee5447b&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170101&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;20&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa0686802c3967b97d7791&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170101&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;20&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa06aca3aff156a9093404&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170101&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;20&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa076374369a6a0801fb4a&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170102&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;23&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa077162e23647877e4213&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170102&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;23&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa07d11755f43c2a5becf3&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170102&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;23&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa07d11755f43c2a5becf4&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;201701013&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;25&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa0884c1479c83fc0e07a6&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170101&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;20&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa08f67cd6ac92cb505552&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170102&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;23&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa08f67cd6ac92cb505553&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;201701013&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;25&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa0908ba9556afc2c8ebec&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;20170102&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;23&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;_id&#x27;</span>: ObjectId(<span class=\"string\">&#x27;60aa0908ba9556afc2c8ebed&#x27;</span>), <span class=\"string\">&#x27;id&#x27;</span>: <span class=\"string\">&#x27;201701013&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"string\">&#x27;25&#x27;</span>, <span class=\"string\">&#x27;gender&#x27;</span>: <span class=\"string\">&#x27;male&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>返回结果是<code>Cursor</code>类型，它相当于一个生成器，需要遍历获取的所有结果，其中每个结果都是字典类型。</p>\n<p>如果要查询年龄大于<code>20</code>的数据，则写法如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">results = collection.find(&#123;<span class=\"string\">&#x27;age&#x27;</span>: &#123;<span class=\"string\">&#x27;$gt&#x27;</span>: <span class=\"number\">20</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>查询的条件键值已经不是单纯的数字了，而是一个字典，其键名为比较符号<code>$gt</code>，意思是<strong>大于</strong>，键值为<code>20</code>。</p>\n<p>比较符号归纳如下：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">符号</th>\n<th align=\"center\">含义</th>\n<th align=\"center\">示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">$lt</td>\n<td align=\"center\">小于</td>\n<td align=\"center\">{‘age’:{‘$lt’:20}}</td>\n</tr>\n<tr>\n<td align=\"center\">$gt</td>\n<td align=\"center\">大于</td>\n<td align=\"center\">{‘age’:{‘$gt’:20}}</td>\n</tr>\n<tr>\n<td align=\"center\">$lte</td>\n<td align=\"center\">小于或等于</td>\n<td align=\"center\">{‘age’:{‘$lte’:20}}</td>\n</tr>\n<tr>\n<td align=\"center\">$gte</td>\n<td align=\"center\">大于或等于</td>\n<td align=\"center\">{‘age’:{‘$gte’:20}}</td>\n</tr>\n<tr>\n<td align=\"center\">$ne</td>\n<td align=\"center\">不等于</td>\n<td align=\"center\">{‘age’:{‘$ne’:20}}</td>\n</tr>\n<tr>\n<td align=\"center\">$in</td>\n<td align=\"center\">在范围内</td>\n<td align=\"center\">{‘age’:{‘$in’:[20,23]}}</td>\n</tr>\n<tr>\n<td align=\"center\">$nin</td>\n<td align=\"center\">不在范围内</td>\n<td align=\"center\">{‘age’:{‘$nin’:[20, 23]}}</td>\n</tr>\n</tbody></table>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n<p>另外，还可以进行正则匹配查询。例如，查询名字以<code>H</code>开头的学生数据，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">results = collection.find(&#123;<span class=\"string\">&#x27;name&#x27;</span>: &#123;<span class=\"string\">&#x27;$regex&#x27;</span>: <span class=\"string\">&#x27;^H.*&#x27;</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>这里使用<code>$regex</code>来指定正则匹配，<code>^M.*</code>代表以<code>M</code>开头的正则表达式。</p>\n<p>一些功能符号归类为下表：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">符号</th>\n<th align=\"center\">含义</th>\n<th align=\"center\">示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">$regrx</td>\n<td align=\"center\">匹配正则表达式</td>\n<td align=\"center\">{‘name’:{‘$regex’:’^M.*’}}</td>\n</tr>\n<tr>\n<td align=\"center\">$exists</td>\n<td align=\"center\">属性是否存在</td>\n<td align=\"center\">{‘name’:{‘$exists’:True}}</td>\n</tr>\n<tr>\n<td align=\"center\">$type</td>\n<td align=\"center\">类型判断</td>\n<td align=\"center\">{‘age’:{‘$type’:’int’}}</td>\n</tr>\n<tr>\n<td align=\"center\">$mod</td>\n<td align=\"center\">数字模操作</td>\n<td align=\"center\">{‘age’:{‘$mod’:[5,0]}}</td>\n</tr>\n<tr>\n<td align=\"center\">$text</td>\n<td align=\"center\">文本查询</td>\n<td align=\"center\">{‘$text’:{‘$search’:’Holy’}}</td>\n</tr>\n<tr>\n<td align=\"center\">$where</td>\n<td align=\"center\">高级条件查询</td>\n<td align=\"center\">{‘$where’:’obj.fans_count==obj.follows_count’}</td>\n</tr>\n</tbody></table>\n<h3 id=\"计数\"><a href=\"#计数\" class=\"headerlink\" title=\"计数\"></a>计数</h3><p>要统计查询结果有多少条数据，可以调用<code>count</code>方法。以统计所有数据条数为例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">count = collection.find().count()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(count)</span><br></pre></td></tr></table></figure>\n\n<p>我们还可以统计符合某个条件的数据：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">count = collection.find(&#123;<span class=\"string\">&#x27;age&#x27;</span>: <span class=\"number\">20</span>&#125;).count() </span><br><span class=\"line\"><span class=\"built_in\">print</span>(count)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果是一个数值，即符合条件的数据条数。</p>\n<h3 id=\"排序\"><a href=\"#排序\" class=\"headerlink\" title=\"排序\"></a>排序</h3><p>排序时，可以直接调用<code>sort</code>方法，并在其中传入排序的字段及升降序标志。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">results = collection.find().sort(<span class=\"string\">&#x27;name&#x27;</span>, pymongo.ASCENDING)</span><br><span class=\"line\"><span class=\"built_in\">print</span>([result[<span class=\"string\">&#x27;name&#x27;</span>] <span class=\"keyword\">for</span> result <span class=\"keyword\">in</span> results])</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>调用<code>pymongo.ASCENDING</code>指定升序。如果要降序排列，可以传入<code>pymongo.DESCENDING</code>。</p>\n<h3 id=\"偏移\"><a href=\"#偏移\" class=\"headerlink\" title=\"偏移\"></a>偏移</h3><p>只需要取某几个元素，可以利用<code>skip</code>方法偏移几个位置，比如偏移2，就代表忽略前两个元素，得到第3个及以后的元素：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">results = collection.find().sort(<span class=\"string\">&#x27;name&#x27;</span>, pymongo.ASCENDING).skip(<span class=\"number\">3</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>([result[<span class=\"string\">&#x27;name&#x27;</span>] <span class=\"keyword\">for</span> result <span class=\"keyword\">in</span> results])</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">&#x27;Holy&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jack&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>, <span class=\"string\">&#x27;Jordan&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>还可以用<code>limit</code>方法指定要取的结果个数，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">results = collection.find().sort(<span class=\"string\">&#x27;name&#x27;</span>, pymongo.ASCENDING).limit(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>([result[<span class=\"string\">&#x27;name&#x27;</span>] <span class=\"keyword\">for</span> result <span class=\"keyword\">in</span> results])</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">&#x27;Holy&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>值得注意的是，在数据量非常庞大的时候，比如在查询千万、亿级别的数据库时，最好不要使用大的偏移量，因为这样很可能导致内存溢出。</p>\n<h3 id=\"更新\"><a href=\"#更新\" class=\"headerlink\" title=\"更新\"></a>更新</h3><p>数据更新，可以使用<code>update</code>方法，指定更新的条件和更新后的数据即可。例如：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">condition = &#123;<span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Holy&#x27;</span>&#125;</span><br><span class=\"line\">student = collection.find_one(condition)</span><br><span class=\"line\">student[<span class=\"string\">&#x27;age&#x27;</span>] = <span class=\"number\">30</span></span><br><span class=\"line\">result = collection.update(condition, student)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<p>更新<code>name</code>为<code>Holy</code>的数据的年龄：首先指定查询条件，然后将数据查询出来，修改年龄后调用<code>update</code>方法将原条件和修改后的数据传入。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&#x27;n&#x27;</span>: <span class=\"number\">1</span>, <span class=\"string\">&#x27;nModified&#x27;</span>: <span class=\"number\">0</span>, <span class=\"string\">&#x27;ok&#x27;</span>: <span class=\"number\">1.0</span>, <span class=\"string\">&#x27;updatedExisting&#x27;</span>: <span class=\"literal\">True</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>返回结果是字典形式，<code>ok</code>代表执行成功，<code>nModified</code>代表影响的数据条数。</p>\n<p>也可以使用<code>$set</code>操作符对数据进行更新，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = collection.update(condition, &#123;<span class=\"string\">&#x27;$set&#x27;</span>: student&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>这样可以只更新<code>student</code>字典内存在的字段。如果原先还有其他字段，则不会更新，也不会删除。而如果不用<code>$set</code>的话，则会把之前的数据全部用<code>student</code>字典替换；如果原本存在其他字段，则会被删除。</p>\n<p><code>update</code>方法其实也是官方不推荐使用的方法。这里也分为<code>update_one</code>方法和<code>update_many</code>方法，用法更加严格，它们的第2个参数需要使用<code>$</code>类型操作符作为字典的键名，示例如下:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">condition = &#123;<span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Kevin&#x27;</span>&#125; </span><br><span class=\"line\">student = collection.find_one(condition)</span><br><span class=\"line\">student[<span class=\"string\">&#x27;age&#x27;</span>] = <span class=\"number\">26</span></span><br><span class=\"line\">result = collection.update_one(condition, &#123;<span class=\"string\">&#x27;$set&#x27;</span>: student&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result) <span class=\"built_in\">print</span>(result.matched_count, result.modified_count)</span><br></pre></td></tr></table></figure>\n\n<p>上面的例子中调用了<code>update_one</code>方法，使得第2个参数不能再直接传入修改后的字典，而是需要使用<code>&#123;&#39;$set&#39;:student&#125;</code>这样的形式，其返回结果是<code>UpdateResult</code>类型。然后分别调用<code>matched_count</code>和<code>modified_count</code>属性，可以获得匹配的数据条数和影响的数据条数。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;pymongo.results.UpdateResult <span class=\"built_in\">object</span> at <span class=\"number\">0x10d17b678</span>&gt;</span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h2><p>删除操作比较简单，直接调用<code>remove</code>方法指定删除的条件即可，此时符合条件的所有数据均会被删除。</p>\n<p>示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = collection.remove(&#123;<span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Kevin&#x27;</span>&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&#x27;ok&#x27;</span>: <span class=\"number\">1</span>, <span class=\"string\">&#x27;n&#x27;</span>: <span class=\"number\">1</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>另外，这里依然存在两个新的推荐方法 ——<code>delete_one</code>和<code>delete_many</code>，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = collection.delete_one(&#123;<span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Kevin&#x27;</span>&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.deleted_count)</span><br><span class=\"line\">result = collection.delete_many(&#123;<span class=\"string\">&#x27;age&#x27;</span>: &#123;<span class=\"string\">&#x27;$lt&#x27;</span>: <span class=\"number\">25</span>&#125;&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.deleted_count)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;pymongo.results.DeleteResult <span class=\"built_in\">object</span> at <span class=\"number\">0x10e6ba4c8</span>&gt; </span><br><span class=\"line\"><span class=\"number\">14</span></span><br></pre></td></tr></table></figure>\n\n<p><code>delete_one</code>删除第一条符合条件的数据，<code>delete_many</code>即删除所有符合条件的数据。它们的返回结果都是<code>DeleteResult</code>类型，可以调用<code>deleted_count</code>属性获取删除的数据条数。</p>\n"},{"title":"Nginx配置详解","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-18T03:16:57.000Z","pic":null,"_content":"\n## 简介\n\n`Nginx`是`lgor Sysoev`为俄罗斯访问量第二的`rambler.ru`站点设计开发的。从`2004`年发布至今，凭借开源的力量，已经接近成熟与完善。\n\n`Nginx`功能丰富，可作为`HTTP服务器`，也可作为反向代理服务器，邮件服务器。支持`FastCGI`、`SSL`、`Virtual Host`、`URL Rewrite`、`Gzip`等功能。并且支持很多第三方的模块扩展。\n\n`Nginx`的稳定性、功能集、示例配置文件和低系统资源的消耗让他后来居上，在全球活跃的网站中有`12.18%`的使用比率，大约为`2220`万个网站。\n\n## Nginx常用功能\n\n### 1、Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理\n\n正向代理和反向代理：\n\n![正向代理和反向代理](1.jpg)\n\n`Nginx`在做反向代理时，提供性能稳定，并且能够提供配置灵活的转发功能。`Nginx`可以根据不同的正则匹配，采取不同的转发策略，比如图片文件结尾的文件服务器，动态页面`web`服务器，只要你正则写的没问题，又有相对应的服务器解决方案，你就可以随心所欲的玩。并且`Nginx`对返回结果进行错误页跳转，异常判断等。如果被分发的服务器存在异常，他可以将请求重新转发给另外一台服务器，然后自动去除异常服务器。\n\n### 2、负载均衡\n\n`Nginx`提供的负载均衡策略有2种：`内置策略`和`扩展策略`。内置策略为轮询，加权轮询，`Ip hash`。扩展策略，就天马行空，只有你想不到的没有他做不到的啦，你可以参照所有的负载均衡算法，给他一一找出来做下实现。\n\n上3个图，理解这三种负载均衡算法的实现\n\n![负载均衡](2.jpg)\n\nIp hash算法，对客户端请求的ip进行hash操作，然后根据hash结果将同一个客户端ip的请求分发给同一台服务器进行处理，可以解决session不共享的问题。\n\n![负载均衡](3.jpg)\n\n### 3、web缓存\n\n`Nginx`可以对不同的文件做不同的缓存处理，配置灵活，并且支持`FastCGI_Cache`，主要用于对`FastCGI`的动态程序进行缓存。配合着第三方的`ngx_cache_purge`，对制定的`URL`缓存内容可以的进行增删管理。\n\n### 4、Nginx相关地址\n\n源码：https://trac.nginx.org/nginx/browser\n\n官网：http://www.nginx.org/\n\n## Nginx配置文件结构\n\n如果你下载好啦，你的安装文件，不妨打开`conf`文件夹的`nginx.conf`文件，`Nginx`服务器的基础配置，默认的配置也存放在此。\n\n在`nginx.conf`的注释符号为：`#`\n\n默认的`nginx`配置文件`nginx.conf`内容如下：\n\n```shell\n#user  nobody;\nworker_processes  1;\n\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n\n#pid        logs/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    #log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n    #                  '$status $body_bytes_sent \"$http_referer\" '\n    #                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    #access_log  logs/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    server {\n        listen       80;\n        server_name  localhost;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n\n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n\n        # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n        #\n        #location ~ \\.php$ {\n        #    proxy_pass   http://127.0.0.1;\n        #}\n\n        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n        #\n        #location ~ \\.php$ {\n        #    root           html;\n        #    fastcgi_pass   127.0.0.1:9000;\n        #    fastcgi_index  index.php;\n        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n        #    include        fastcgi_params;\n        #}\n\n        # deny access to .htaccess files, if Apache's document root\n        # concurs with nginx's one\n        #\n        #location ~ /\\.ht {\n        #    deny  all;\n        #}\n    }\n\n\n    # another virtual host using mix of IP-, name-, and port-based configuration\n    #\n    #server {\n    #    listen       8000;\n    #    listen       somename:8080;\n    #    server_name  somename  alias  another.alias;\n\n    #    location / {\n    #        root   html;\n    #        index  index.html index.htm;\n    #    }\n    #}\n\n\n    # HTTPS server\n    #\n    #server {\n    #    listen       443 ssl;\n    #    server_name  localhost;\n\n    #    ssl_certificate      cert.pem;\n    #    ssl_certificate_key  cert.key;\n\n    #    ssl_session_cache    shared:SSL:1m;\n    #    ssl_session_timeout  5m;\n\n    #    ssl_ciphers  HIGH:!aNULL:!MD5;\n    #    ssl_prefer_server_ciphers  on;\n\n    #    location / {\n    #        root   html;\n    #        index  index.html index.htm;\n    #    }\n    #}\n\n}\n```\n\n## nginx 文件结构\n\n```shell\n...              #全局块\n\nevents {         #events块\n   ...\n}\n\nhttp      #http块\n{\n    ...   #http全局块\n    server        #server块\n    { \n        ...       #server全局块\n        location [PATTERN]   #location块\n        {\n            ...\n        }\n        location [PATTERN] \n        {\n            ...\n        }\n    }\n    server\n    {\n      ...\n    }\n    ...     #http全局块\n}\n```\n\n- 1、**全局块**：配置影响`nginx`全局的指令。一般有运行`nginx`服务器的用户组，`nginx`进程`pid`存放路径，日志存放路径，配置文件引入，允许生成`worker process数`等。\n- 2、**events块**：配置影响`nginx`服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。\n- 3、**http块**：可以嵌套多个`server`，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，`mime-type`定义，日志自定义，是否使用`sendfile`传输文件，连接超时时间，单连接请求数等。\n- 4、**server块**：配置虚拟主机的相关参数，一个`http`中可以有多个`server`。\n- 5、**location块**：配置请求的路由，以及各种页面的处理情况。\n\n下面给大家上一个配置文件，作为理解。\n\n```shell\n########### 每个指令必须有分号结束。#################\n#user administrator administrators;  #配置用户或者组，默认为nobody nobody。\n#worker_processes 2;  #允许生成的进程数，默认为1\n#pid /nginx/pid/nginx.pid;   #指定nginx进程运行文件存放地址\nerror_log log/error.log debug;  #制定日志路径，级别。这个设置可以放入全局块，http块，server块，级别以此为：debug|info|notice|warn|error|crit|alert|emerg\nevents {\n    accept_mutex on;   #设置网路连接序列化，防止惊群现象发生，默认为on\n    multi_accept on;  #设置一个进程是否同时接受多个网络连接，默认为off\n    #use epoll;      #事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport\n    worker_connections  1024;    #最大连接数，默认为512\n}\nhttp {\n    include       mime.types;   #文件扩展名与文件类型映射表\n    default_type  application/octet-stream; #默认文件类型，默认为text/plain\n    #access_log off; #取消服务日志    \n    log_format myFormat '$remote_addr–$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for'; #自定义格式\n    access_log log/access.log myFormat;  #combined为日志格式的默认值\n    sendfile on;   #允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。\n    sendfile_max_chunk 100k;  #每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。\n    keepalive_timeout 65;  #连接超时时间，默认为75s，可以在http，server，location块。\n\n    upstream mysvr {   \n      server 127.0.0.1:7878;\n      server 192.168.10.121:3333 backup;  #热备\n    }\n    error_page 404 https://www.baidu.com; #错误页\n    server {\n        keepalive_requests 120; #单连接请求上限次数。\n        listen       4545;   #监听端口\n        server_name  127.0.0.1;   #监听地址       \n        location  ~*^.+$ {       #请求的url过滤，正则匹配，~为区分大小写，~*为不区分大小写。\n           #root path;  #根目录\n           #index vv.txt;  #设置默认页\n           proxy_pass  http://mysvr;  #请求转向mysvr 定义的服务器列表\n           deny 127.0.0.1;  #拒绝的ip\n           allow 172.18.5.54; #允许的ip           \n        } \n    }\n}\n```\n\n上面是nginx的基本配置，需要注意的有以下几点：\n\n- 1、几个常见配置项\n\n```shell\n1.$remote_addr 与 $http_x_forwarded_for 用以记录客户端的ip地址；\n2.$remote_user ：用来记录客户端用户名称；\n3.$time_local ： 用来记录访问时间与时区；\n4.$request ： 用来记录请求的url与http协议；\n5.$status ： 用来记录请求状态；成功是200；\n6.$body_bytes_s ent ：记录发送给客户端文件主体内容大小；\n7.$http_referer ：用来记录从那个页面链接访问过来的；\n8.$http_user_agent ：记录客户端浏览器的相关信息；\n```\n\n- 2、惊群现象：一个网路连接到来，多个睡眠的进程被同时叫醒，但只有一个进程能获得链接，这样会影响系统性能。\n\n- 3、每个指令必须有分号结束。\n\n> 原文地址：[https://www.runoob.com/w3cnote/nginx-setup-intro.html](https://www.runoob.com/w3cnote/nginx-setup-intro.html)","source":"_posts/Nginx配置详解.md","raw":"---\ntitle: Nginx配置详解\ntags:\n  - Nginx\n  - 负载均衡\n  - http\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-18 11:16:57\ncategories: Nginx\npic:\n---\n\n## 简介\n\n`Nginx`是`lgor Sysoev`为俄罗斯访问量第二的`rambler.ru`站点设计开发的。从`2004`年发布至今，凭借开源的力量，已经接近成熟与完善。\n\n`Nginx`功能丰富，可作为`HTTP服务器`，也可作为反向代理服务器，邮件服务器。支持`FastCGI`、`SSL`、`Virtual Host`、`URL Rewrite`、`Gzip`等功能。并且支持很多第三方的模块扩展。\n\n`Nginx`的稳定性、功能集、示例配置文件和低系统资源的消耗让他后来居上，在全球活跃的网站中有`12.18%`的使用比率，大约为`2220`万个网站。\n\n## Nginx常用功能\n\n### 1、Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理\n\n正向代理和反向代理：\n\n![正向代理和反向代理](1.jpg)\n\n`Nginx`在做反向代理时，提供性能稳定，并且能够提供配置灵活的转发功能。`Nginx`可以根据不同的正则匹配，采取不同的转发策略，比如图片文件结尾的文件服务器，动态页面`web`服务器，只要你正则写的没问题，又有相对应的服务器解决方案，你就可以随心所欲的玩。并且`Nginx`对返回结果进行错误页跳转，异常判断等。如果被分发的服务器存在异常，他可以将请求重新转发给另外一台服务器，然后自动去除异常服务器。\n\n### 2、负载均衡\n\n`Nginx`提供的负载均衡策略有2种：`内置策略`和`扩展策略`。内置策略为轮询，加权轮询，`Ip hash`。扩展策略，就天马行空，只有你想不到的没有他做不到的啦，你可以参照所有的负载均衡算法，给他一一找出来做下实现。\n\n上3个图，理解这三种负载均衡算法的实现\n\n![负载均衡](2.jpg)\n\nIp hash算法，对客户端请求的ip进行hash操作，然后根据hash结果将同一个客户端ip的请求分发给同一台服务器进行处理，可以解决session不共享的问题。\n\n![负载均衡](3.jpg)\n\n### 3、web缓存\n\n`Nginx`可以对不同的文件做不同的缓存处理，配置灵活，并且支持`FastCGI_Cache`，主要用于对`FastCGI`的动态程序进行缓存。配合着第三方的`ngx_cache_purge`，对制定的`URL`缓存内容可以的进行增删管理。\n\n### 4、Nginx相关地址\n\n源码：https://trac.nginx.org/nginx/browser\n\n官网：http://www.nginx.org/\n\n## Nginx配置文件结构\n\n如果你下载好啦，你的安装文件，不妨打开`conf`文件夹的`nginx.conf`文件，`Nginx`服务器的基础配置，默认的配置也存放在此。\n\n在`nginx.conf`的注释符号为：`#`\n\n默认的`nginx`配置文件`nginx.conf`内容如下：\n\n```shell\n#user  nobody;\nworker_processes  1;\n\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n\n#pid        logs/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    #log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n    #                  '$status $body_bytes_sent \"$http_referer\" '\n    #                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    #access_log  logs/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    server {\n        listen       80;\n        server_name  localhost;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n\n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n\n        # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n        #\n        #location ~ \\.php$ {\n        #    proxy_pass   http://127.0.0.1;\n        #}\n\n        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n        #\n        #location ~ \\.php$ {\n        #    root           html;\n        #    fastcgi_pass   127.0.0.1:9000;\n        #    fastcgi_index  index.php;\n        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n        #    include        fastcgi_params;\n        #}\n\n        # deny access to .htaccess files, if Apache's document root\n        # concurs with nginx's one\n        #\n        #location ~ /\\.ht {\n        #    deny  all;\n        #}\n    }\n\n\n    # another virtual host using mix of IP-, name-, and port-based configuration\n    #\n    #server {\n    #    listen       8000;\n    #    listen       somename:8080;\n    #    server_name  somename  alias  another.alias;\n\n    #    location / {\n    #        root   html;\n    #        index  index.html index.htm;\n    #    }\n    #}\n\n\n    # HTTPS server\n    #\n    #server {\n    #    listen       443 ssl;\n    #    server_name  localhost;\n\n    #    ssl_certificate      cert.pem;\n    #    ssl_certificate_key  cert.key;\n\n    #    ssl_session_cache    shared:SSL:1m;\n    #    ssl_session_timeout  5m;\n\n    #    ssl_ciphers  HIGH:!aNULL:!MD5;\n    #    ssl_prefer_server_ciphers  on;\n\n    #    location / {\n    #        root   html;\n    #        index  index.html index.htm;\n    #    }\n    #}\n\n}\n```\n\n## nginx 文件结构\n\n```shell\n...              #全局块\n\nevents {         #events块\n   ...\n}\n\nhttp      #http块\n{\n    ...   #http全局块\n    server        #server块\n    { \n        ...       #server全局块\n        location [PATTERN]   #location块\n        {\n            ...\n        }\n        location [PATTERN] \n        {\n            ...\n        }\n    }\n    server\n    {\n      ...\n    }\n    ...     #http全局块\n}\n```\n\n- 1、**全局块**：配置影响`nginx`全局的指令。一般有运行`nginx`服务器的用户组，`nginx`进程`pid`存放路径，日志存放路径，配置文件引入，允许生成`worker process数`等。\n- 2、**events块**：配置影响`nginx`服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。\n- 3、**http块**：可以嵌套多个`server`，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，`mime-type`定义，日志自定义，是否使用`sendfile`传输文件，连接超时时间，单连接请求数等。\n- 4、**server块**：配置虚拟主机的相关参数，一个`http`中可以有多个`server`。\n- 5、**location块**：配置请求的路由，以及各种页面的处理情况。\n\n下面给大家上一个配置文件，作为理解。\n\n```shell\n########### 每个指令必须有分号结束。#################\n#user administrator administrators;  #配置用户或者组，默认为nobody nobody。\n#worker_processes 2;  #允许生成的进程数，默认为1\n#pid /nginx/pid/nginx.pid;   #指定nginx进程运行文件存放地址\nerror_log log/error.log debug;  #制定日志路径，级别。这个设置可以放入全局块，http块，server块，级别以此为：debug|info|notice|warn|error|crit|alert|emerg\nevents {\n    accept_mutex on;   #设置网路连接序列化，防止惊群现象发生，默认为on\n    multi_accept on;  #设置一个进程是否同时接受多个网络连接，默认为off\n    #use epoll;      #事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport\n    worker_connections  1024;    #最大连接数，默认为512\n}\nhttp {\n    include       mime.types;   #文件扩展名与文件类型映射表\n    default_type  application/octet-stream; #默认文件类型，默认为text/plain\n    #access_log off; #取消服务日志    \n    log_format myFormat '$remote_addr–$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for'; #自定义格式\n    access_log log/access.log myFormat;  #combined为日志格式的默认值\n    sendfile on;   #允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。\n    sendfile_max_chunk 100k;  #每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。\n    keepalive_timeout 65;  #连接超时时间，默认为75s，可以在http，server，location块。\n\n    upstream mysvr {   \n      server 127.0.0.1:7878;\n      server 192.168.10.121:3333 backup;  #热备\n    }\n    error_page 404 https://www.baidu.com; #错误页\n    server {\n        keepalive_requests 120; #单连接请求上限次数。\n        listen       4545;   #监听端口\n        server_name  127.0.0.1;   #监听地址       \n        location  ~*^.+$ {       #请求的url过滤，正则匹配，~为区分大小写，~*为不区分大小写。\n           #root path;  #根目录\n           #index vv.txt;  #设置默认页\n           proxy_pass  http://mysvr;  #请求转向mysvr 定义的服务器列表\n           deny 127.0.0.1;  #拒绝的ip\n           allow 172.18.5.54; #允许的ip           \n        } \n    }\n}\n```\n\n上面是nginx的基本配置，需要注意的有以下几点：\n\n- 1、几个常见配置项\n\n```shell\n1.$remote_addr 与 $http_x_forwarded_for 用以记录客户端的ip地址；\n2.$remote_user ：用来记录客户端用户名称；\n3.$time_local ： 用来记录访问时间与时区；\n4.$request ： 用来记录请求的url与http协议；\n5.$status ： 用来记录请求状态；成功是200；\n6.$body_bytes_s ent ：记录发送给客户端文件主体内容大小；\n7.$http_referer ：用来记录从那个页面链接访问过来的；\n8.$http_user_agent ：记录客户端浏览器的相关信息；\n```\n\n- 2、惊群现象：一个网路连接到来，多个睡眠的进程被同时叫醒，但只有一个进程能获得链接，这样会影响系统性能。\n\n- 3、每个指令必须有分号结束。\n\n> 原文地址：[https://www.runoob.com/w3cnote/nginx-setup-intro.html](https://www.runoob.com/w3cnote/nginx-setup-intro.html)","slug":"Nginx配置详解","published":1,"updated":"2021-06-15T03:24:11.462Z","layout":"post","photos":[],"link":"","_id":"ckq14rx28001944ud3d8ecghf","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p><code>Nginx</code>是<code>lgor Sysoev</code>为俄罗斯访问量第二的<code>rambler.ru</code>站点设计开发的。从<code>2004</code>年发布至今，凭借开源的力量，已经接近成熟与完善。</p>\n<p><code>Nginx</code>功能丰富，可作为<code>HTTP服务器</code>，也可作为反向代理服务器，邮件服务器。支持<code>FastCGI</code>、<code>SSL</code>、<code>Virtual Host</code>、<code>URL Rewrite</code>、<code>Gzip</code>等功能。并且支持很多第三方的模块扩展。</p>\n<p><code>Nginx</code>的稳定性、功能集、示例配置文件和低系统资源的消耗让他后来居上，在全球活跃的网站中有<code>12.18%</code>的使用比率，大约为<code>2220</code>万个网站。</p>\n<h2 id=\"Nginx常用功能\"><a href=\"#Nginx常用功能\" class=\"headerlink\" title=\"Nginx常用功能\"></a>Nginx常用功能</h2><h3 id=\"1、Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理\"><a href=\"#1、Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理\" class=\"headerlink\" title=\"1、Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理\"></a>1、Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理</h3><p>正向代理和反向代理：</p>\n<p><img src=\"1.jpg\" alt=\"正向代理和反向代理\"></p>\n<p><code>Nginx</code>在做反向代理时，提供性能稳定，并且能够提供配置灵活的转发功能。<code>Nginx</code>可以根据不同的正则匹配，采取不同的转发策略，比如图片文件结尾的文件服务器，动态页面<code>web</code>服务器，只要你正则写的没问题，又有相对应的服务器解决方案，你就可以随心所欲的玩。并且<code>Nginx</code>对返回结果进行错误页跳转，异常判断等。如果被分发的服务器存在异常，他可以将请求重新转发给另外一台服务器，然后自动去除异常服务器。</p>\n<h3 id=\"2、负载均衡\"><a href=\"#2、负载均衡\" class=\"headerlink\" title=\"2、负载均衡\"></a>2、负载均衡</h3><p><code>Nginx</code>提供的负载均衡策略有2种：<code>内置策略</code>和<code>扩展策略</code>。内置策略为轮询，加权轮询，<code>Ip hash</code>。扩展策略，就天马行空，只有你想不到的没有他做不到的啦，你可以参照所有的负载均衡算法，给他一一找出来做下实现。</p>\n<p>上3个图，理解这三种负载均衡算法的实现</p>\n<p><img src=\"2.jpg\" alt=\"负载均衡\"></p>\n<p>Ip hash算法，对客户端请求的ip进行hash操作，然后根据hash结果将同一个客户端ip的请求分发给同一台服务器进行处理，可以解决session不共享的问题。</p>\n<p><img src=\"3.jpg\" alt=\"负载均衡\"></p>\n<h3 id=\"3、web缓存\"><a href=\"#3、web缓存\" class=\"headerlink\" title=\"3、web缓存\"></a>3、web缓存</h3><p><code>Nginx</code>可以对不同的文件做不同的缓存处理，配置灵活，并且支持<code>FastCGI_Cache</code>，主要用于对<code>FastCGI</code>的动态程序进行缓存。配合着第三方的<code>ngx_cache_purge</code>，对制定的<code>URL</code>缓存内容可以的进行增删管理。</p>\n<h3 id=\"4、Nginx相关地址\"><a href=\"#4、Nginx相关地址\" class=\"headerlink\" title=\"4、Nginx相关地址\"></a>4、Nginx相关地址</h3><p>源码：<a href=\"https://trac.nginx.org/nginx/browser\">https://trac.nginx.org/nginx/browser</a></p>\n<p>官网：<a href=\"http://www.nginx.org/\">http://www.nginx.org/</a></p>\n<h2 id=\"Nginx配置文件结构\"><a href=\"#Nginx配置文件结构\" class=\"headerlink\" title=\"Nginx配置文件结构\"></a>Nginx配置文件结构</h2><p>如果你下载好啦，你的安装文件，不妨打开<code>conf</code>文件夹的<code>nginx.conf</code>文件，<code>Nginx</code>服务器的基础配置，默认的配置也存放在此。</p>\n<p>在<code>nginx.conf</code>的注释符号为：<code>#</code></p>\n<p>默认的<code>nginx</code>配置文件<code>nginx.conf</code>内容如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">user  nobody;</span></span><br><span class=\"line\">worker_processes  1;</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">error_log  logs/error.log;</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">error_log  logs/error.log  notice;</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">error_log  logs/error.log  info;</span></span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">pid        logs/nginx.pid;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">events &#123;</span><br><span class=\"line\">    worker_connections  1024;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">    include       mime.types;</span><br><span class=\"line\">    default_type  application/octet-stream;</span><br><span class=\"line\"></span><br><span class=\"line\">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class=\"line\">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class=\"line\">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">    #access_log  logs/access.log  main;</span><br><span class=\"line\"></span><br><span class=\"line\">    sendfile        on;</span><br><span class=\"line\">    #tcp_nopush     on;</span><br><span class=\"line\"></span><br><span class=\"line\">    #keepalive_timeout  0;</span><br><span class=\"line\">    keepalive_timeout  65;</span><br><span class=\"line\"></span><br><span class=\"line\">    #gzip  on;</span><br><span class=\"line\"></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen       80;</span><br><span class=\"line\">        server_name  localhost;</span><br><span class=\"line\"></span><br><span class=\"line\">        #charset koi8-r;</span><br><span class=\"line\"></span><br><span class=\"line\">        #access_log  logs/host.access.log  main;</span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">            root   html;</span><br><span class=\"line\">            index  index.html index.htm;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        #error_page  404              /404.html;</span><br><span class=\"line\"></span><br><span class=\"line\">        # redirect server error pages to the static page /50x.html</span><br><span class=\"line\">        #</span><br><span class=\"line\">        error_page   500 502 503 504  /50x.html;</span><br><span class=\"line\">        location = /50x.html &#123;</span><br><span class=\"line\">            root   html;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class=\"line\">        #</span><br><span class=\"line\">        #location ~ \\.php$ &#123;</span><br><span class=\"line\">        #    proxy_pass   http://127.0.0.1;</span><br><span class=\"line\">        #&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class=\"line\">        #</span><br><span class=\"line\">        #location ~ \\.php$ &#123;</span><br><span class=\"line\">        #    root           html;</span><br><span class=\"line\">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class=\"line\">        #    fastcgi_index  index.php;</span><br><span class=\"line\">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class=\"line\">        #    include        fastcgi_params;</span><br><span class=\"line\">        #&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        # deny access to .htaccess files, if Apache&#x27;s document root</span><br><span class=\"line\">        # concurs with nginx&#x27;s one</span><br><span class=\"line\">        #</span><br><span class=\"line\">        #location ~ /\\.ht &#123;</span><br><span class=\"line\">        #    deny  all;</span><br><span class=\"line\">        #&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class=\"line\">    #</span><br><span class=\"line\">    #server &#123;</span><br><span class=\"line\">    #    listen       8000;</span><br><span class=\"line\">    #    listen       somename:8080;</span><br><span class=\"line\">    #    server_name  somename  alias  another.alias;</span><br><span class=\"line\"></span><br><span class=\"line\">    #    location / &#123;</span><br><span class=\"line\">    #        root   html;</span><br><span class=\"line\">    #        index  index.html index.htm;</span><br><span class=\"line\">    #    &#125;</span><br><span class=\"line\">    #&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    # HTTPS server</span><br><span class=\"line\">    #</span><br><span class=\"line\">    #server &#123;</span><br><span class=\"line\">    #    listen       443 ssl;</span><br><span class=\"line\">    #    server_name  localhost;</span><br><span class=\"line\"></span><br><span class=\"line\">    #    ssl_certificate      cert.pem;</span><br><span class=\"line\">    #    ssl_certificate_key  cert.key;</span><br><span class=\"line\"></span><br><span class=\"line\">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class=\"line\">    #    ssl_session_timeout  5m;</span><br><span class=\"line\"></span><br><span class=\"line\">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class=\"line\">    #    ssl_prefer_server_ciphers  on;</span><br><span class=\"line\"></span><br><span class=\"line\">    #    location / &#123;</span><br><span class=\"line\">    #        root   html;</span><br><span class=\"line\">    #        index  index.html index.htm;</span><br><span class=\"line\">    #    &#125;</span><br><span class=\"line\">    #&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"nginx-文件结构\"><a href=\"#nginx-文件结构\" class=\"headerlink\" title=\"nginx 文件结构\"></a>nginx 文件结构</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...              #全局块</span><br><span class=\"line\"></span><br><span class=\"line\">events &#123;         #events块</span><br><span class=\"line\">   ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">http      #http块</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    ...   #http全局块</span><br><span class=\"line\">    server        #server块</span><br><span class=\"line\">    &#123; </span><br><span class=\"line\">        ...       #server全局块</span><br><span class=\"line\">        location [PATTERN]   #location块</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ...</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        location [PATTERN] </span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ...</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    server</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ...     #http全局块</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>1、<strong>全局块</strong>：配置影响<code>nginx</code>全局的指令。一般有运行<code>nginx</code>服务器的用户组，<code>nginx</code>进程<code>pid</code>存放路径，日志存放路径，配置文件引入，允许生成<code>worker process数</code>等。</li>\n<li>2、<strong>events块</strong>：配置影响<code>nginx</code>服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。</li>\n<li>3、<strong>http块</strong>：可以嵌套多个<code>server</code>，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，<code>mime-type</code>定义，日志自定义，是否使用<code>sendfile</code>传输文件，连接超时时间，单连接请求数等。</li>\n<li>4、<strong>server块</strong>：配置虚拟主机的相关参数，一个<code>http</code>中可以有多个<code>server</code>。</li>\n<li>5、<strong>location块</strong>：配置请求的路由，以及各种页面的处理情况。</li>\n</ul>\n<p>下面给大家上一个配置文件，作为理解。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\">########## 每个指令必须有分号结束。#################</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">user administrator administrators;  <span class=\"comment\">#配置用户或者组，默认为nobody nobody。</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">worker_processes 2;  <span class=\"comment\">#允许生成的进程数，默认为1</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">pid /nginx/pid/nginx.pid;   <span class=\"comment\">#指定nginx进程运行文件存放地址</span></span></span><br><span class=\"line\">error_log log/error.log debug;  #制定日志路径，级别。这个设置可以放入全局块，http块，server块，级别以此为：debug|info|notice|warn|error|crit|alert|emerg</span><br><span class=\"line\">events &#123;</span><br><span class=\"line\">    accept_mutex on;   #设置网路连接序列化，防止惊群现象发生，默认为on</span><br><span class=\"line\">    multi_accept on;  #设置一个进程是否同时接受多个网络连接，默认为off</span><br><span class=\"line\">    #use epoll;      #事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport</span><br><span class=\"line\">    worker_connections  1024;    #最大连接数，默认为512</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">    include       mime.types;   #文件扩展名与文件类型映射表</span><br><span class=\"line\">    default_type  application/octet-stream; #默认文件类型，默认为text/plain</span><br><span class=\"line\">    #access_log off; #取消服务日志    </span><br><span class=\"line\">    log_format myFormat &#x27;$remote_addr–$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for&#x27;; #自定义格式</span><br><span class=\"line\">    access_log log/access.log myFormat;  #combined为日志格式的默认值</span><br><span class=\"line\">    sendfile on;   #允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。</span><br><span class=\"line\">    sendfile_max_chunk 100k;  #每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。</span><br><span class=\"line\">    keepalive_timeout 65;  #连接超时时间，默认为75s，可以在http，server，location块。</span><br><span class=\"line\"></span><br><span class=\"line\">    upstream mysvr &#123;   </span><br><span class=\"line\">      server 127.0.0.1:7878;</span><br><span class=\"line\">      server 192.168.10.121:3333 backup;  #热备</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    error_page 404 https://www.baidu.com; #错误页</span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        keepalive_requests 120; #单连接请求上限次数。</span><br><span class=\"line\">        listen       4545;   #监听端口</span><br><span class=\"line\">        server_name  127.0.0.1;   #监听地址       </span><br><span class=\"line\">        location  ~*^.+$ &#123;       #请求的url过滤，正则匹配，~为区分大小写，~*为不区分大小写。</span><br><span class=\"line\">           #root path;  #根目录</span><br><span class=\"line\">           #index vv.txt;  #设置默认页</span><br><span class=\"line\">           proxy_pass  http://mysvr;  #请求转向mysvr 定义的服务器列表</span><br><span class=\"line\">           deny 127.0.0.1;  #拒绝的ip</span><br><span class=\"line\">           allow 172.18.5.54; #允许的ip           </span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面是nginx的基本配置，需要注意的有以下几点：</p>\n<ul>\n<li>1、几个常见配置项</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.$remote_addr 与 $http_x_forwarded_for 用以记录客户端的ip地址；</span><br><span class=\"line\">2.$remote_user ：用来记录客户端用户名称；</span><br><span class=\"line\">3.$time_local ： 用来记录访问时间与时区；</span><br><span class=\"line\">4.$request ： 用来记录请求的url与http协议；</span><br><span class=\"line\">5.$status ： 用来记录请求状态；成功是200；</span><br><span class=\"line\">6.$body_bytes_s ent ：记录发送给客户端文件主体内容大小；</span><br><span class=\"line\">7.$http_referer ：用来记录从那个页面链接访问过来的；</span><br><span class=\"line\">8.$http_user_agent ：记录客户端浏览器的相关信息；</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>2、惊群现象：一个网路连接到来，多个睡眠的进程被同时叫醒，但只有一个进程能获得链接，这样会影响系统性能。</p>\n</li>\n<li><p>3、每个指令必须有分号结束。</p>\n</li>\n</ul>\n<blockquote>\n<p>原文地址：<a href=\"https://www.runoob.com/w3cnote/nginx-setup-intro.html\">https://www.runoob.com/w3cnote/nginx-setup-intro.html</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p><code>Nginx</code>是<code>lgor Sysoev</code>为俄罗斯访问量第二的<code>rambler.ru</code>站点设计开发的。从<code>2004</code>年发布至今，凭借开源的力量，已经接近成熟与完善。</p>\n<p><code>Nginx</code>功能丰富，可作为<code>HTTP服务器</code>，也可作为反向代理服务器，邮件服务器。支持<code>FastCGI</code>、<code>SSL</code>、<code>Virtual Host</code>、<code>URL Rewrite</code>、<code>Gzip</code>等功能。并且支持很多第三方的模块扩展。</p>\n<p><code>Nginx</code>的稳定性、功能集、示例配置文件和低系统资源的消耗让他后来居上，在全球活跃的网站中有<code>12.18%</code>的使用比率，大约为<code>2220</code>万个网站。</p>\n<h2 id=\"Nginx常用功能\"><a href=\"#Nginx常用功能\" class=\"headerlink\" title=\"Nginx常用功能\"></a>Nginx常用功能</h2><h3 id=\"1、Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理\"><a href=\"#1、Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理\" class=\"headerlink\" title=\"1、Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理\"></a>1、Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理</h3><p>正向代理和反向代理：</p>\n<p><img src=\"1.jpg\" alt=\"正向代理和反向代理\"></p>\n<p><code>Nginx</code>在做反向代理时，提供性能稳定，并且能够提供配置灵活的转发功能。<code>Nginx</code>可以根据不同的正则匹配，采取不同的转发策略，比如图片文件结尾的文件服务器，动态页面<code>web</code>服务器，只要你正则写的没问题，又有相对应的服务器解决方案，你就可以随心所欲的玩。并且<code>Nginx</code>对返回结果进行错误页跳转，异常判断等。如果被分发的服务器存在异常，他可以将请求重新转发给另外一台服务器，然后自动去除异常服务器。</p>\n<h3 id=\"2、负载均衡\"><a href=\"#2、负载均衡\" class=\"headerlink\" title=\"2、负载均衡\"></a>2、负载均衡</h3><p><code>Nginx</code>提供的负载均衡策略有2种：<code>内置策略</code>和<code>扩展策略</code>。内置策略为轮询，加权轮询，<code>Ip hash</code>。扩展策略，就天马行空，只有你想不到的没有他做不到的啦，你可以参照所有的负载均衡算法，给他一一找出来做下实现。</p>\n<p>上3个图，理解这三种负载均衡算法的实现</p>\n<p><img src=\"2.jpg\" alt=\"负载均衡\"></p>\n<p>Ip hash算法，对客户端请求的ip进行hash操作，然后根据hash结果将同一个客户端ip的请求分发给同一台服务器进行处理，可以解决session不共享的问题。</p>\n<p><img src=\"3.jpg\" alt=\"负载均衡\"></p>\n<h3 id=\"3、web缓存\"><a href=\"#3、web缓存\" class=\"headerlink\" title=\"3、web缓存\"></a>3、web缓存</h3><p><code>Nginx</code>可以对不同的文件做不同的缓存处理，配置灵活，并且支持<code>FastCGI_Cache</code>，主要用于对<code>FastCGI</code>的动态程序进行缓存。配合着第三方的<code>ngx_cache_purge</code>，对制定的<code>URL</code>缓存内容可以的进行增删管理。</p>\n<h3 id=\"4、Nginx相关地址\"><a href=\"#4、Nginx相关地址\" class=\"headerlink\" title=\"4、Nginx相关地址\"></a>4、Nginx相关地址</h3><p>源码：<a href=\"https://trac.nginx.org/nginx/browser\">https://trac.nginx.org/nginx/browser</a></p>\n<p>官网：<a href=\"http://www.nginx.org/\">http://www.nginx.org/</a></p>\n<h2 id=\"Nginx配置文件结构\"><a href=\"#Nginx配置文件结构\" class=\"headerlink\" title=\"Nginx配置文件结构\"></a>Nginx配置文件结构</h2><p>如果你下载好啦，你的安装文件，不妨打开<code>conf</code>文件夹的<code>nginx.conf</code>文件，<code>Nginx</code>服务器的基础配置，默认的配置也存放在此。</p>\n<p>在<code>nginx.conf</code>的注释符号为：<code>#</code></p>\n<p>默认的<code>nginx</code>配置文件<code>nginx.conf</code>内容如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">user  nobody;</span></span><br><span class=\"line\">worker_processes  1;</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">error_log  logs/error.log;</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">error_log  logs/error.log  notice;</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">error_log  logs/error.log  info;</span></span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">pid        logs/nginx.pid;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">events &#123;</span><br><span class=\"line\">    worker_connections  1024;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">    include       mime.types;</span><br><span class=\"line\">    default_type  application/octet-stream;</span><br><span class=\"line\"></span><br><span class=\"line\">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class=\"line\">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class=\"line\">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">    #access_log  logs/access.log  main;</span><br><span class=\"line\"></span><br><span class=\"line\">    sendfile        on;</span><br><span class=\"line\">    #tcp_nopush     on;</span><br><span class=\"line\"></span><br><span class=\"line\">    #keepalive_timeout  0;</span><br><span class=\"line\">    keepalive_timeout  65;</span><br><span class=\"line\"></span><br><span class=\"line\">    #gzip  on;</span><br><span class=\"line\"></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen       80;</span><br><span class=\"line\">        server_name  localhost;</span><br><span class=\"line\"></span><br><span class=\"line\">        #charset koi8-r;</span><br><span class=\"line\"></span><br><span class=\"line\">        #access_log  logs/host.access.log  main;</span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">            root   html;</span><br><span class=\"line\">            index  index.html index.htm;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        #error_page  404              /404.html;</span><br><span class=\"line\"></span><br><span class=\"line\">        # redirect server error pages to the static page /50x.html</span><br><span class=\"line\">        #</span><br><span class=\"line\">        error_page   500 502 503 504  /50x.html;</span><br><span class=\"line\">        location = /50x.html &#123;</span><br><span class=\"line\">            root   html;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class=\"line\">        #</span><br><span class=\"line\">        #location ~ \\.php$ &#123;</span><br><span class=\"line\">        #    proxy_pass   http://127.0.0.1;</span><br><span class=\"line\">        #&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class=\"line\">        #</span><br><span class=\"line\">        #location ~ \\.php$ &#123;</span><br><span class=\"line\">        #    root           html;</span><br><span class=\"line\">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class=\"line\">        #    fastcgi_index  index.php;</span><br><span class=\"line\">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class=\"line\">        #    include        fastcgi_params;</span><br><span class=\"line\">        #&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        # deny access to .htaccess files, if Apache&#x27;s document root</span><br><span class=\"line\">        # concurs with nginx&#x27;s one</span><br><span class=\"line\">        #</span><br><span class=\"line\">        #location ~ /\\.ht &#123;</span><br><span class=\"line\">        #    deny  all;</span><br><span class=\"line\">        #&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class=\"line\">    #</span><br><span class=\"line\">    #server &#123;</span><br><span class=\"line\">    #    listen       8000;</span><br><span class=\"line\">    #    listen       somename:8080;</span><br><span class=\"line\">    #    server_name  somename  alias  another.alias;</span><br><span class=\"line\"></span><br><span class=\"line\">    #    location / &#123;</span><br><span class=\"line\">    #        root   html;</span><br><span class=\"line\">    #        index  index.html index.htm;</span><br><span class=\"line\">    #    &#125;</span><br><span class=\"line\">    #&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    # HTTPS server</span><br><span class=\"line\">    #</span><br><span class=\"line\">    #server &#123;</span><br><span class=\"line\">    #    listen       443 ssl;</span><br><span class=\"line\">    #    server_name  localhost;</span><br><span class=\"line\"></span><br><span class=\"line\">    #    ssl_certificate      cert.pem;</span><br><span class=\"line\">    #    ssl_certificate_key  cert.key;</span><br><span class=\"line\"></span><br><span class=\"line\">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class=\"line\">    #    ssl_session_timeout  5m;</span><br><span class=\"line\"></span><br><span class=\"line\">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class=\"line\">    #    ssl_prefer_server_ciphers  on;</span><br><span class=\"line\"></span><br><span class=\"line\">    #    location / &#123;</span><br><span class=\"line\">    #        root   html;</span><br><span class=\"line\">    #        index  index.html index.htm;</span><br><span class=\"line\">    #    &#125;</span><br><span class=\"line\">    #&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"nginx-文件结构\"><a href=\"#nginx-文件结构\" class=\"headerlink\" title=\"nginx 文件结构\"></a>nginx 文件结构</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...              #全局块</span><br><span class=\"line\"></span><br><span class=\"line\">events &#123;         #events块</span><br><span class=\"line\">   ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">http      #http块</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    ...   #http全局块</span><br><span class=\"line\">    server        #server块</span><br><span class=\"line\">    &#123; </span><br><span class=\"line\">        ...       #server全局块</span><br><span class=\"line\">        location [PATTERN]   #location块</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ...</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        location [PATTERN] </span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ...</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    server</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ...     #http全局块</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>1、<strong>全局块</strong>：配置影响<code>nginx</code>全局的指令。一般有运行<code>nginx</code>服务器的用户组，<code>nginx</code>进程<code>pid</code>存放路径，日志存放路径，配置文件引入，允许生成<code>worker process数</code>等。</li>\n<li>2、<strong>events块</strong>：配置影响<code>nginx</code>服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。</li>\n<li>3、<strong>http块</strong>：可以嵌套多个<code>server</code>，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，<code>mime-type</code>定义，日志自定义，是否使用<code>sendfile</code>传输文件，连接超时时间，单连接请求数等。</li>\n<li>4、<strong>server块</strong>：配置虚拟主机的相关参数，一个<code>http</code>中可以有多个<code>server</code>。</li>\n<li>5、<strong>location块</strong>：配置请求的路由，以及各种页面的处理情况。</li>\n</ul>\n<p>下面给大家上一个配置文件，作为理解。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\">########## 每个指令必须有分号结束。#################</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">user administrator administrators;  <span class=\"comment\">#配置用户或者组，默认为nobody nobody。</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">worker_processes 2;  <span class=\"comment\">#允许生成的进程数，默认为1</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">pid /nginx/pid/nginx.pid;   <span class=\"comment\">#指定nginx进程运行文件存放地址</span></span></span><br><span class=\"line\">error_log log/error.log debug;  #制定日志路径，级别。这个设置可以放入全局块，http块，server块，级别以此为：debug|info|notice|warn|error|crit|alert|emerg</span><br><span class=\"line\">events &#123;</span><br><span class=\"line\">    accept_mutex on;   #设置网路连接序列化，防止惊群现象发生，默认为on</span><br><span class=\"line\">    multi_accept on;  #设置一个进程是否同时接受多个网络连接，默认为off</span><br><span class=\"line\">    #use epoll;      #事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport</span><br><span class=\"line\">    worker_connections  1024;    #最大连接数，默认为512</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">    include       mime.types;   #文件扩展名与文件类型映射表</span><br><span class=\"line\">    default_type  application/octet-stream; #默认文件类型，默认为text/plain</span><br><span class=\"line\">    #access_log off; #取消服务日志    </span><br><span class=\"line\">    log_format myFormat &#x27;$remote_addr–$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for&#x27;; #自定义格式</span><br><span class=\"line\">    access_log log/access.log myFormat;  #combined为日志格式的默认值</span><br><span class=\"line\">    sendfile on;   #允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。</span><br><span class=\"line\">    sendfile_max_chunk 100k;  #每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。</span><br><span class=\"line\">    keepalive_timeout 65;  #连接超时时间，默认为75s，可以在http，server，location块。</span><br><span class=\"line\"></span><br><span class=\"line\">    upstream mysvr &#123;   </span><br><span class=\"line\">      server 127.0.0.1:7878;</span><br><span class=\"line\">      server 192.168.10.121:3333 backup;  #热备</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    error_page 404 https://www.baidu.com; #错误页</span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        keepalive_requests 120; #单连接请求上限次数。</span><br><span class=\"line\">        listen       4545;   #监听端口</span><br><span class=\"line\">        server_name  127.0.0.1;   #监听地址       </span><br><span class=\"line\">        location  ~*^.+$ &#123;       #请求的url过滤，正则匹配，~为区分大小写，~*为不区分大小写。</span><br><span class=\"line\">           #root path;  #根目录</span><br><span class=\"line\">           #index vv.txt;  #设置默认页</span><br><span class=\"line\">           proxy_pass  http://mysvr;  #请求转向mysvr 定义的服务器列表</span><br><span class=\"line\">           deny 127.0.0.1;  #拒绝的ip</span><br><span class=\"line\">           allow 172.18.5.54; #允许的ip           </span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面是nginx的基本配置，需要注意的有以下几点：</p>\n<ul>\n<li>1、几个常见配置项</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.$remote_addr 与 $http_x_forwarded_for 用以记录客户端的ip地址；</span><br><span class=\"line\">2.$remote_user ：用来记录客户端用户名称；</span><br><span class=\"line\">3.$time_local ： 用来记录访问时间与时区；</span><br><span class=\"line\">4.$request ： 用来记录请求的url与http协议；</span><br><span class=\"line\">5.$status ： 用来记录请求状态；成功是200；</span><br><span class=\"line\">6.$body_bytes_s ent ：记录发送给客户端文件主体内容大小；</span><br><span class=\"line\">7.$http_referer ：用来记录从那个页面链接访问过来的；</span><br><span class=\"line\">8.$http_user_agent ：记录客户端浏览器的相关信息；</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>2、惊群现象：一个网路连接到来，多个睡眠的进程被同时叫醒，但只有一个进程能获得链接，这样会影响系统性能。</p>\n</li>\n<li><p>3、每个指令必须有分号结束。</p>\n</li>\n</ul>\n<blockquote>\n<p>原文地址：<a href=\"https://www.runoob.com/w3cnote/nginx-setup-intro.html\">https://www.runoob.com/w3cnote/nginx-setup-intro.html</a></p>\n</blockquote>\n"},{"title":"Pyppeteer的使用","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-02T06:04:50.000Z","pic":null,"_content":"\nSelenium功能虽热强大，但还是有些不方便。\n\n## Pyppeteer介绍\n\n`Puppeteer` 是 `Google` 基于 Node.js 开发的一个工具，有了它我们可以通过 `JavaScript` 来控制 `Chrome` 浏览器的一些操作，当然也可以用作网络爬虫上，其 API 极其完善，功能非常强大。\n\n`Pyppeteer` 是 `Puppeteer` 的 Python版本的实现，但它不是 `Google` 开发的，是一位来自于日本的工程师依据 `Puppeteer` 的一些功能开发出来的非官方版本。\n\n`Pyppeteer` 是依赖于 `Chromium`这个浏览器来运行的。那么有了 `Pyppeteer` 之后，我们就可以免去那些烦琐的环境配置等问题。如果第一次运行的时候，`Chromium`浏览器没有安装，那么程序会帮我们自动安装和配置，就免去了烦琐的环境配置等工作。\n\n## 安装\n\n运行环境python 3.7以上。\n\n```python\npip3 install pyppeteer\n```\n\n查看安装路径\n\n```python\nimport pyppeteer\n\nprint(pyppeteer.__chromium_revision__)  # 查看版本号\nprint(pyppeteer.executablePath())   # 查看chromium存放路径\n```\noutput:\n\n```python\n588429\nC:\\Users\\espho\\AppData\\Local\\pyppeteer\\pyppeteer\\local-chromium\\588429\\chrome-win32\\chrome.exe\n```\n\n## 使用\n\n`Pyppeteer` 是一款非常高效的 web 自动化测试工具，由于 `Pyppeteer` 是基于 `asyncio` 构建的，它的所有属性和方法几乎都是 `coroutine (协程)` 对象，因此在构建异步程序的时候非常方便，天生就支持异步运行。\n\n程序构建的基本思路是新建一个 `browser` 浏览器 和 一个 页面 `page`。\n\n```python\nimport asyncio\nfrom pyppeteer import launch\n\nasync def main():\n    browser = await launch()\n    page = await browser.newPage()\n    await page.goto('http://baidu.com')\n    await page.screenshot({'path': 'example.png'})  # 截图\n    await browser.close()   # 关闭\n\nasyncio.get_event_loop().run_until_complete(main())\n```\n\n运行上面这段代码会发现并没有浏览器弹出运行，这是因为 `Pyppeteer` `默认使用的是无头浏览器，如果想要浏览器显示，需要在launch` 函数中设置参数 `“headless = False”`，程序运行结束后在同一目录下会出现截取到的网页图片：\n\n![](example.webp)\n\n有个问题就是图片显示不全，网站内容没有办法完全铺满。\n\n```python\n# Pyppeteer 支持字典 和 关键字传参，Puppeteer 只支持字典传参。\n# 这里使用字典传参\nbrowser = await launch(\n    {\n        'headless': False, \n        'dumpio': True, \n        'autoClose': False, \n        'args': [\n            '--no-sandbox', \n            '--window-size=1366,850'\n        ]\n    }\n)\nawait page.setViewport({'width': 1366, 'height': 768})\n```\n\n### 报错\n\n报错 `OSError: Unable to remove Temporary User Data`\n启动浏览器时指定参数 `userDataDir` 存放缓存，保证硬盘够大且不是系统盘。\n\n### 移除Chrome正受到自动测试软件的控制\n\n```python\nimport asyncio\nfrom pyppeteer import launch\n\nasync def main():\n    browser = await launch(headless=False, ignoreDefaultArgs=['--enable-automation'])\n    input()\n    await browser.close()\n\nasyncio.get_event_loop().run_until_complete(main())\n```\n\n### 全屏\n\n```python\nimport tkinter\nimport asyncio\nfrom pyppeteer import launch\n\n\ndef screen_size():\n    tk = tkinter.Tk()\n    width = tk.winfo_screenwidth()\n    height = tk.winfo_screenheight()\n    tk.quit()\n    return {'width': width, 'height': height}\n\n\nasync def main():\n    browser = await launch(headless=False, args=['--start-maximized'])  # 页面全屏\n    page = await browser.newPage()\n    await page.setViewport(screen_size())  # 内容全屏\n    await page.goto('https://www.baidu.com/')\n    input()\n    await browser.close()\n\n\nasyncio.get_event_loop().run_until_complete(main())\n```\n\n### 页面内容\n\nPage.content()或Page.evalute()\n\n```python\nimport asyncio\nfrom pyppeteer import launch\n\n\nasync def main():\n    browser = await launch(headless=False)\n    page = await browser.newPage()\n    url = 'https://www.holychan.ltd/'\n    await page.goto(url)\n    # content = await page.content()\n    content = await page.evaluate('document.body.textContent', force_expr=True)\n    print(content)\n    input()\n    await browser.close()\n\n\nasyncio.get_event_loop().run_until_complete(main())\n```\n\n把整个页面的文字获取下来了。\n\n### 异步运行\n\n`asyncio.wait() `或 `asyncio.gather()`，建议只用在一次性读取的页面，需要滚动的不建议使用。\n\n```python\nimport asyncio\nfrom pyppeteer import launch\n\nasync def crawl(url):\n    browser = await  launch(headless=False)\n    page = await browser.newPage()\n    await page.goto(url)\n    title = await page.title()\n    print(title)\n    await browser.close()\n\nasync def main():\n    urls = [\n        crawl('https://www.baidu.com/'),\n        crawl('https://www.bing.com/')\n    ]\n    await asyncio.wait(urls)\n    # await asyncio.gather(*urls)\n\nasyncio.get_event_loop().run_until_complete(main())\n\n#微软 Bing 搜索 - 国内版\n#百度一下，你就知道\n```\n\n### 反爬虫检测\n\n访问 [https://bot.sannysoft.com/](https://bot.sannysoft.com/)。\n\n```python\nimport asyncio\nfrom pyppeteer import launch\n\nasync def main():\n    browser = await launch(\n        {\n            'headless': False, \n            'dumpio': True, \n            'autoClose': False, \n            'data_dir':'E:/.cache/',\n            'args': [\n                '--no-sandbox', \n                '--window-size=1366,850'\n            ]\n            \n        }\n    )\n    page = await browser.newPage()\n    await page.setViewport({'width': 1366, 'height': 768})\n    await page.goto('https://bot.sannysoft.com/')\n    await page.screenshot({'path': 'test.png'})\n    await browser.close()\n\nasyncio.get_event_loop().run_until_complete(main())\n```\n![](example1.webp)","source":"_posts/Pyppeteer的使用.md","raw":"---\ntitle: Pyppeteer的使用\ntags:\n  - python\n  - pypprteer\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-02 14:04:50\ncategories: 爬虫\npic:\n---\n\nSelenium功能虽热强大，但还是有些不方便。\n\n## Pyppeteer介绍\n\n`Puppeteer` 是 `Google` 基于 Node.js 开发的一个工具，有了它我们可以通过 `JavaScript` 来控制 `Chrome` 浏览器的一些操作，当然也可以用作网络爬虫上，其 API 极其完善，功能非常强大。\n\n`Pyppeteer` 是 `Puppeteer` 的 Python版本的实现，但它不是 `Google` 开发的，是一位来自于日本的工程师依据 `Puppeteer` 的一些功能开发出来的非官方版本。\n\n`Pyppeteer` 是依赖于 `Chromium`这个浏览器来运行的。那么有了 `Pyppeteer` 之后，我们就可以免去那些烦琐的环境配置等问题。如果第一次运行的时候，`Chromium`浏览器没有安装，那么程序会帮我们自动安装和配置，就免去了烦琐的环境配置等工作。\n\n## 安装\n\n运行环境python 3.7以上。\n\n```python\npip3 install pyppeteer\n```\n\n查看安装路径\n\n```python\nimport pyppeteer\n\nprint(pyppeteer.__chromium_revision__)  # 查看版本号\nprint(pyppeteer.executablePath())   # 查看chromium存放路径\n```\noutput:\n\n```python\n588429\nC:\\Users\\espho\\AppData\\Local\\pyppeteer\\pyppeteer\\local-chromium\\588429\\chrome-win32\\chrome.exe\n```\n\n## 使用\n\n`Pyppeteer` 是一款非常高效的 web 自动化测试工具，由于 `Pyppeteer` 是基于 `asyncio` 构建的，它的所有属性和方法几乎都是 `coroutine (协程)` 对象，因此在构建异步程序的时候非常方便，天生就支持异步运行。\n\n程序构建的基本思路是新建一个 `browser` 浏览器 和 一个 页面 `page`。\n\n```python\nimport asyncio\nfrom pyppeteer import launch\n\nasync def main():\n    browser = await launch()\n    page = await browser.newPage()\n    await page.goto('http://baidu.com')\n    await page.screenshot({'path': 'example.png'})  # 截图\n    await browser.close()   # 关闭\n\nasyncio.get_event_loop().run_until_complete(main())\n```\n\n运行上面这段代码会发现并没有浏览器弹出运行，这是因为 `Pyppeteer` `默认使用的是无头浏览器，如果想要浏览器显示，需要在launch` 函数中设置参数 `“headless = False”`，程序运行结束后在同一目录下会出现截取到的网页图片：\n\n![](example.webp)\n\n有个问题就是图片显示不全，网站内容没有办法完全铺满。\n\n```python\n# Pyppeteer 支持字典 和 关键字传参，Puppeteer 只支持字典传参。\n# 这里使用字典传参\nbrowser = await launch(\n    {\n        'headless': False, \n        'dumpio': True, \n        'autoClose': False, \n        'args': [\n            '--no-sandbox', \n            '--window-size=1366,850'\n        ]\n    }\n)\nawait page.setViewport({'width': 1366, 'height': 768})\n```\n\n### 报错\n\n报错 `OSError: Unable to remove Temporary User Data`\n启动浏览器时指定参数 `userDataDir` 存放缓存，保证硬盘够大且不是系统盘。\n\n### 移除Chrome正受到自动测试软件的控制\n\n```python\nimport asyncio\nfrom pyppeteer import launch\n\nasync def main():\n    browser = await launch(headless=False, ignoreDefaultArgs=['--enable-automation'])\n    input()\n    await browser.close()\n\nasyncio.get_event_loop().run_until_complete(main())\n```\n\n### 全屏\n\n```python\nimport tkinter\nimport asyncio\nfrom pyppeteer import launch\n\n\ndef screen_size():\n    tk = tkinter.Tk()\n    width = tk.winfo_screenwidth()\n    height = tk.winfo_screenheight()\n    tk.quit()\n    return {'width': width, 'height': height}\n\n\nasync def main():\n    browser = await launch(headless=False, args=['--start-maximized'])  # 页面全屏\n    page = await browser.newPage()\n    await page.setViewport(screen_size())  # 内容全屏\n    await page.goto('https://www.baidu.com/')\n    input()\n    await browser.close()\n\n\nasyncio.get_event_loop().run_until_complete(main())\n```\n\n### 页面内容\n\nPage.content()或Page.evalute()\n\n```python\nimport asyncio\nfrom pyppeteer import launch\n\n\nasync def main():\n    browser = await launch(headless=False)\n    page = await browser.newPage()\n    url = 'https://www.holychan.ltd/'\n    await page.goto(url)\n    # content = await page.content()\n    content = await page.evaluate('document.body.textContent', force_expr=True)\n    print(content)\n    input()\n    await browser.close()\n\n\nasyncio.get_event_loop().run_until_complete(main())\n```\n\n把整个页面的文字获取下来了。\n\n### 异步运行\n\n`asyncio.wait() `或 `asyncio.gather()`，建议只用在一次性读取的页面，需要滚动的不建议使用。\n\n```python\nimport asyncio\nfrom pyppeteer import launch\n\nasync def crawl(url):\n    browser = await  launch(headless=False)\n    page = await browser.newPage()\n    await page.goto(url)\n    title = await page.title()\n    print(title)\n    await browser.close()\n\nasync def main():\n    urls = [\n        crawl('https://www.baidu.com/'),\n        crawl('https://www.bing.com/')\n    ]\n    await asyncio.wait(urls)\n    # await asyncio.gather(*urls)\n\nasyncio.get_event_loop().run_until_complete(main())\n\n#微软 Bing 搜索 - 国内版\n#百度一下，你就知道\n```\n\n### 反爬虫检测\n\n访问 [https://bot.sannysoft.com/](https://bot.sannysoft.com/)。\n\n```python\nimport asyncio\nfrom pyppeteer import launch\n\nasync def main():\n    browser = await launch(\n        {\n            'headless': False, \n            'dumpio': True, \n            'autoClose': False, \n            'data_dir':'E:/.cache/',\n            'args': [\n                '--no-sandbox', \n                '--window-size=1366,850'\n            ]\n            \n        }\n    )\n    page = await browser.newPage()\n    await page.setViewport({'width': 1366, 'height': 768})\n    await page.goto('https://bot.sannysoft.com/')\n    await page.screenshot({'path': 'test.png'})\n    await browser.close()\n\nasyncio.get_event_loop().run_until_complete(main())\n```\n![](example1.webp)","slug":"Pyppeteer的使用","published":1,"updated":"2021-06-15T15:47:31.601Z","layout":"post","photos":[],"link":"","_id":"ckq14rx29001b44udfzos2d06","content":"<p>Selenium功能虽热强大，但还是有些不方便。</p>\n<h2 id=\"Pyppeteer介绍\"><a href=\"#Pyppeteer介绍\" class=\"headerlink\" title=\"Pyppeteer介绍\"></a>Pyppeteer介绍</h2><p><code>Puppeteer</code> 是 <code>Google</code> 基于 Node.js 开发的一个工具，有了它我们可以通过 <code>JavaScript</code> 来控制 <code>Chrome</code> 浏览器的一些操作，当然也可以用作网络爬虫上，其 API 极其完善，功能非常强大。</p>\n<p><code>Pyppeteer</code> 是 <code>Puppeteer</code> 的 Python版本的实现，但它不是 <code>Google</code> 开发的，是一位来自于日本的工程师依据 <code>Puppeteer</code> 的一些功能开发出来的非官方版本。</p>\n<p><code>Pyppeteer</code> 是依赖于 <code>Chromium</code>这个浏览器来运行的。那么有了 <code>Pyppeteer</code> 之后，我们就可以免去那些烦琐的环境配置等问题。如果第一次运行的时候，<code>Chromium</code>浏览器没有安装，那么程序会帮我们自动安装和配置，就免去了烦琐的环境配置等工作。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>运行环境python 3.7以上。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install pyppeteer</span><br></pre></td></tr></table></figure>\n\n<p>查看安装路径</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pyppeteer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(pyppeteer.__chromium_revision__)  <span class=\"comment\"># 查看版本号</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(pyppeteer.executablePath())   <span class=\"comment\"># 查看chromium存放路径</span></span><br></pre></td></tr></table></figure>\n<p>output:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">588429</span></span><br><span class=\"line\">C:\\Users\\espho\\AppData\\Local\\pyppeteer\\pyppeteer\\local-chromium\\<span class=\"number\">588429</span>\\chrome-win32\\chrome.exe</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p><code>Pyppeteer</code> 是一款非常高效的 web 自动化测试工具，由于 <code>Pyppeteer</code> 是基于 <code>asyncio</code> 构建的，它的所有属性和方法几乎都是 <code>coroutine (协程)</code> 对象，因此在构建异步程序的时候非常方便，天生就支持异步运行。</p>\n<p>程序构建的基本思路是新建一个 <code>browser</code> 浏览器 和 一个 页面 <code>page</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyppeteer <span class=\"keyword\">import</span> launch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    browser = <span class=\"keyword\">await</span> launch()</span><br><span class=\"line\">    page = <span class=\"keyword\">await</span> browser.newPage()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.goto(<span class=\"string\">&#x27;http://baidu.com&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.screenshot(&#123;<span class=\"string\">&#x27;path&#x27;</span>: <span class=\"string\">&#x27;example.png&#x27;</span>&#125;)  <span class=\"comment\"># 截图</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> browser.close()   <span class=\"comment\"># 关闭</span></span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure>\n\n<p>运行上面这段代码会发现并没有浏览器弹出运行，这是因为 <code>Pyppeteer</code> <code>默认使用的是无头浏览器，如果想要浏览器显示，需要在launch</code> 函数中设置参数 <code>“headless = False”</code>，程序运行结束后在同一目录下会出现截取到的网页图片：</p>\n<p><img src=\"example.webp\"></p>\n<p>有个问题就是图片显示不全，网站内容没有办法完全铺满。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Pyppeteer 支持字典 和 关键字传参，Puppeteer 只支持字典传参。</span></span><br><span class=\"line\"><span class=\"comment\"># 这里使用字典传参</span></span><br><span class=\"line\">browser = <span class=\"keyword\">await</span> launch(</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;headless&#x27;</span>: <span class=\"literal\">False</span>, </span><br><span class=\"line\">        <span class=\"string\">&#x27;dumpio&#x27;</span>: <span class=\"literal\">True</span>, </span><br><span class=\"line\">        <span class=\"string\">&#x27;autoClose&#x27;</span>: <span class=\"literal\">False</span>, </span><br><span class=\"line\">        <span class=\"string\">&#x27;args&#x27;</span>: [</span><br><span class=\"line\">            <span class=\"string\">&#x27;--no-sandbox&#x27;</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;--window-size=1366,850&#x27;</span></span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">await</span> page.setViewport(&#123;<span class=\"string\">&#x27;width&#x27;</span>: <span class=\"number\">1366</span>, <span class=\"string\">&#x27;height&#x27;</span>: <span class=\"number\">768</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"报错\"><a href=\"#报错\" class=\"headerlink\" title=\"报错\"></a>报错</h3><p>报错 <code>OSError: Unable to remove Temporary User Data</code><br>启动浏览器时指定参数 <code>userDataDir</code> 存放缓存，保证硬盘够大且不是系统盘。</p>\n<h3 id=\"移除Chrome正受到自动测试软件的控制\"><a href=\"#移除Chrome正受到自动测试软件的控制\" class=\"headerlink\" title=\"移除Chrome正受到自动测试软件的控制\"></a>移除Chrome正受到自动测试软件的控制</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyppeteer <span class=\"keyword\">import</span> launch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    browser = <span class=\"keyword\">await</span> launch(headless=<span class=\"literal\">False</span>, ignoreDefaultArgs=[<span class=\"string\">&#x27;--enable-automation&#x27;</span>])</span><br><span class=\"line\">    <span class=\"built_in\">input</span>()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> browser.close()</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"全屏\"><a href=\"#全屏\" class=\"headerlink\" title=\"全屏\"></a>全屏</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> tkinter</span><br><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyppeteer <span class=\"keyword\">import</span> launch</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">screen_size</span>():</span></span><br><span class=\"line\">    tk = tkinter.Tk()</span><br><span class=\"line\">    width = tk.winfo_screenwidth()</span><br><span class=\"line\">    height = tk.winfo_screenheight()</span><br><span class=\"line\">    tk.quit()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&#x27;width&#x27;</span>: width, <span class=\"string\">&#x27;height&#x27;</span>: height&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    browser = <span class=\"keyword\">await</span> launch(headless=<span class=\"literal\">False</span>, args=[<span class=\"string\">&#x27;--start-maximized&#x27;</span>])  <span class=\"comment\"># 页面全屏</span></span><br><span class=\"line\">    page = <span class=\"keyword\">await</span> browser.newPage()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.setViewport(screen_size())  <span class=\"comment\"># 内容全屏</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.goto(<span class=\"string\">&#x27;https://www.baidu.com/&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">input</span>()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> browser.close()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"页面内容\"><a href=\"#页面内容\" class=\"headerlink\" title=\"页面内容\"></a>页面内容</h3><p>Page.content()或Page.evalute()</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyppeteer <span class=\"keyword\">import</span> launch</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    browser = <span class=\"keyword\">await</span> launch(headless=<span class=\"literal\">False</span>)</span><br><span class=\"line\">    page = <span class=\"keyword\">await</span> browser.newPage()</span><br><span class=\"line\">    url = <span class=\"string\">&#x27;https://www.holychan.ltd/&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.goto(url)</span><br><span class=\"line\">    <span class=\"comment\"># content = await page.content()</span></span><br><span class=\"line\">    content = <span class=\"keyword\">await</span> page.evaluate(<span class=\"string\">&#x27;document.body.textContent&#x27;</span>, force_expr=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(content)</span><br><span class=\"line\">    <span class=\"built_in\">input</span>()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> browser.close()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure>\n\n<p>把整个页面的文字获取下来了。</p>\n<h3 id=\"异步运行\"><a href=\"#异步运行\" class=\"headerlink\" title=\"异步运行\"></a>异步运行</h3><p><code>asyncio.wait() </code>或 <code>asyncio.gather()</code>，建议只用在一次性读取的页面，需要滚动的不建议使用。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyppeteer <span class=\"keyword\">import</span> launch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">crawl</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    browser = <span class=\"keyword\">await</span>  launch(headless=<span class=\"literal\">False</span>)</span><br><span class=\"line\">    page = <span class=\"keyword\">await</span> browser.newPage()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.goto(url)</span><br><span class=\"line\">    title = <span class=\"keyword\">await</span> page.title()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(title)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> browser.close()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    urls = [</span><br><span class=\"line\">        crawl(<span class=\"string\">&#x27;https://www.baidu.com/&#x27;</span>),</span><br><span class=\"line\">        crawl(<span class=\"string\">&#x27;https://www.bing.com/&#x27;</span>)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">    <span class=\"keyword\">await</span> asyncio.wait(urls)</span><br><span class=\"line\">    <span class=\"comment\"># await asyncio.gather(*urls)</span></span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.get_event_loop().run_until_complete(main())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#微软 Bing 搜索 - 国内版</span></span><br><span class=\"line\"><span class=\"comment\">#百度一下，你就知道</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"反爬虫检测\"><a href=\"#反爬虫检测\" class=\"headerlink\" title=\"反爬虫检测\"></a>反爬虫检测</h3><p>访问 <a href=\"https://bot.sannysoft.com/\">https://bot.sannysoft.com/</a>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyppeteer <span class=\"keyword\">import</span> launch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    browser = <span class=\"keyword\">await</span> launch(</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;headless&#x27;</span>: <span class=\"literal\">False</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;dumpio&#x27;</span>: <span class=\"literal\">True</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;autoClose&#x27;</span>: <span class=\"literal\">False</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;data_dir&#x27;</span>:<span class=\"string\">&#x27;E:/.cache/&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;args&#x27;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&#x27;--no-sandbox&#x27;</span>, </span><br><span class=\"line\">                <span class=\"string\">&#x27;--window-size=1366,850&#x27;</span></span><br><span class=\"line\">            ]</span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\">    page = <span class=\"keyword\">await</span> browser.newPage()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.setViewport(&#123;<span class=\"string\">&#x27;width&#x27;</span>: <span class=\"number\">1366</span>, <span class=\"string\">&#x27;height&#x27;</span>: <span class=\"number\">768</span>&#125;)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.goto(<span class=\"string\">&#x27;https://bot.sannysoft.com/&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.screenshot(&#123;<span class=\"string\">&#x27;path&#x27;</span>: <span class=\"string\">&#x27;test.png&#x27;</span>&#125;)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> browser.close()</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure>\n<p><img src=\"example1.webp\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Selenium功能虽热强大，但还是有些不方便。</p>\n<h2 id=\"Pyppeteer介绍\"><a href=\"#Pyppeteer介绍\" class=\"headerlink\" title=\"Pyppeteer介绍\"></a>Pyppeteer介绍</h2><p><code>Puppeteer</code> 是 <code>Google</code> 基于 Node.js 开发的一个工具，有了它我们可以通过 <code>JavaScript</code> 来控制 <code>Chrome</code> 浏览器的一些操作，当然也可以用作网络爬虫上，其 API 极其完善，功能非常强大。</p>\n<p><code>Pyppeteer</code> 是 <code>Puppeteer</code> 的 Python版本的实现，但它不是 <code>Google</code> 开发的，是一位来自于日本的工程师依据 <code>Puppeteer</code> 的一些功能开发出来的非官方版本。</p>\n<p><code>Pyppeteer</code> 是依赖于 <code>Chromium</code>这个浏览器来运行的。那么有了 <code>Pyppeteer</code> 之后，我们就可以免去那些烦琐的环境配置等问题。如果第一次运行的时候，<code>Chromium</code>浏览器没有安装，那么程序会帮我们自动安装和配置，就免去了烦琐的环境配置等工作。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>运行环境python 3.7以上。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install pyppeteer</span><br></pre></td></tr></table></figure>\n\n<p>查看安装路径</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pyppeteer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(pyppeteer.__chromium_revision__)  <span class=\"comment\"># 查看版本号</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(pyppeteer.executablePath())   <span class=\"comment\"># 查看chromium存放路径</span></span><br></pre></td></tr></table></figure>\n<p>output:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">588429</span></span><br><span class=\"line\">C:\\Users\\espho\\AppData\\Local\\pyppeteer\\pyppeteer\\local-chromium\\<span class=\"number\">588429</span>\\chrome-win32\\chrome.exe</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p><code>Pyppeteer</code> 是一款非常高效的 web 自动化测试工具，由于 <code>Pyppeteer</code> 是基于 <code>asyncio</code> 构建的，它的所有属性和方法几乎都是 <code>coroutine (协程)</code> 对象，因此在构建异步程序的时候非常方便，天生就支持异步运行。</p>\n<p>程序构建的基本思路是新建一个 <code>browser</code> 浏览器 和 一个 页面 <code>page</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyppeteer <span class=\"keyword\">import</span> launch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    browser = <span class=\"keyword\">await</span> launch()</span><br><span class=\"line\">    page = <span class=\"keyword\">await</span> browser.newPage()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.goto(<span class=\"string\">&#x27;http://baidu.com&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.screenshot(&#123;<span class=\"string\">&#x27;path&#x27;</span>: <span class=\"string\">&#x27;example.png&#x27;</span>&#125;)  <span class=\"comment\"># 截图</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> browser.close()   <span class=\"comment\"># 关闭</span></span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure>\n\n<p>运行上面这段代码会发现并没有浏览器弹出运行，这是因为 <code>Pyppeteer</code> <code>默认使用的是无头浏览器，如果想要浏览器显示，需要在launch</code> 函数中设置参数 <code>“headless = False”</code>，程序运行结束后在同一目录下会出现截取到的网页图片：</p>\n<p><img src=\"example.webp\"></p>\n<p>有个问题就是图片显示不全，网站内容没有办法完全铺满。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Pyppeteer 支持字典 和 关键字传参，Puppeteer 只支持字典传参。</span></span><br><span class=\"line\"><span class=\"comment\"># 这里使用字典传参</span></span><br><span class=\"line\">browser = <span class=\"keyword\">await</span> launch(</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;headless&#x27;</span>: <span class=\"literal\">False</span>, </span><br><span class=\"line\">        <span class=\"string\">&#x27;dumpio&#x27;</span>: <span class=\"literal\">True</span>, </span><br><span class=\"line\">        <span class=\"string\">&#x27;autoClose&#x27;</span>: <span class=\"literal\">False</span>, </span><br><span class=\"line\">        <span class=\"string\">&#x27;args&#x27;</span>: [</span><br><span class=\"line\">            <span class=\"string\">&#x27;--no-sandbox&#x27;</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;--window-size=1366,850&#x27;</span></span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">await</span> page.setViewport(&#123;<span class=\"string\">&#x27;width&#x27;</span>: <span class=\"number\">1366</span>, <span class=\"string\">&#x27;height&#x27;</span>: <span class=\"number\">768</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"报错\"><a href=\"#报错\" class=\"headerlink\" title=\"报错\"></a>报错</h3><p>报错 <code>OSError: Unable to remove Temporary User Data</code><br>启动浏览器时指定参数 <code>userDataDir</code> 存放缓存，保证硬盘够大且不是系统盘。</p>\n<h3 id=\"移除Chrome正受到自动测试软件的控制\"><a href=\"#移除Chrome正受到自动测试软件的控制\" class=\"headerlink\" title=\"移除Chrome正受到自动测试软件的控制\"></a>移除Chrome正受到自动测试软件的控制</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyppeteer <span class=\"keyword\">import</span> launch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    browser = <span class=\"keyword\">await</span> launch(headless=<span class=\"literal\">False</span>, ignoreDefaultArgs=[<span class=\"string\">&#x27;--enable-automation&#x27;</span>])</span><br><span class=\"line\">    <span class=\"built_in\">input</span>()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> browser.close()</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"全屏\"><a href=\"#全屏\" class=\"headerlink\" title=\"全屏\"></a>全屏</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> tkinter</span><br><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyppeteer <span class=\"keyword\">import</span> launch</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">screen_size</span>():</span></span><br><span class=\"line\">    tk = tkinter.Tk()</span><br><span class=\"line\">    width = tk.winfo_screenwidth()</span><br><span class=\"line\">    height = tk.winfo_screenheight()</span><br><span class=\"line\">    tk.quit()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&#x27;width&#x27;</span>: width, <span class=\"string\">&#x27;height&#x27;</span>: height&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    browser = <span class=\"keyword\">await</span> launch(headless=<span class=\"literal\">False</span>, args=[<span class=\"string\">&#x27;--start-maximized&#x27;</span>])  <span class=\"comment\"># 页面全屏</span></span><br><span class=\"line\">    page = <span class=\"keyword\">await</span> browser.newPage()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.setViewport(screen_size())  <span class=\"comment\"># 内容全屏</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.goto(<span class=\"string\">&#x27;https://www.baidu.com/&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">input</span>()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> browser.close()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"页面内容\"><a href=\"#页面内容\" class=\"headerlink\" title=\"页面内容\"></a>页面内容</h3><p>Page.content()或Page.evalute()</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyppeteer <span class=\"keyword\">import</span> launch</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    browser = <span class=\"keyword\">await</span> launch(headless=<span class=\"literal\">False</span>)</span><br><span class=\"line\">    page = <span class=\"keyword\">await</span> browser.newPage()</span><br><span class=\"line\">    url = <span class=\"string\">&#x27;https://www.holychan.ltd/&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.goto(url)</span><br><span class=\"line\">    <span class=\"comment\"># content = await page.content()</span></span><br><span class=\"line\">    content = <span class=\"keyword\">await</span> page.evaluate(<span class=\"string\">&#x27;document.body.textContent&#x27;</span>, force_expr=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(content)</span><br><span class=\"line\">    <span class=\"built_in\">input</span>()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> browser.close()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure>\n\n<p>把整个页面的文字获取下来了。</p>\n<h3 id=\"异步运行\"><a href=\"#异步运行\" class=\"headerlink\" title=\"异步运行\"></a>异步运行</h3><p><code>asyncio.wait() </code>或 <code>asyncio.gather()</code>，建议只用在一次性读取的页面，需要滚动的不建议使用。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyppeteer <span class=\"keyword\">import</span> launch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">crawl</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    browser = <span class=\"keyword\">await</span>  launch(headless=<span class=\"literal\">False</span>)</span><br><span class=\"line\">    page = <span class=\"keyword\">await</span> browser.newPage()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.goto(url)</span><br><span class=\"line\">    title = <span class=\"keyword\">await</span> page.title()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(title)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> browser.close()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    urls = [</span><br><span class=\"line\">        crawl(<span class=\"string\">&#x27;https://www.baidu.com/&#x27;</span>),</span><br><span class=\"line\">        crawl(<span class=\"string\">&#x27;https://www.bing.com/&#x27;</span>)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">    <span class=\"keyword\">await</span> asyncio.wait(urls)</span><br><span class=\"line\">    <span class=\"comment\"># await asyncio.gather(*urls)</span></span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.get_event_loop().run_until_complete(main())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#微软 Bing 搜索 - 国内版</span></span><br><span class=\"line\"><span class=\"comment\">#百度一下，你就知道</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"反爬虫检测\"><a href=\"#反爬虫检测\" class=\"headerlink\" title=\"反爬虫检测\"></a>反爬虫检测</h3><p>访问 <a href=\"https://bot.sannysoft.com/\">https://bot.sannysoft.com/</a>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyppeteer <span class=\"keyword\">import</span> launch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    browser = <span class=\"keyword\">await</span> launch(</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;headless&#x27;</span>: <span class=\"literal\">False</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;dumpio&#x27;</span>: <span class=\"literal\">True</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;autoClose&#x27;</span>: <span class=\"literal\">False</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;data_dir&#x27;</span>:<span class=\"string\">&#x27;E:/.cache/&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;args&#x27;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&#x27;--no-sandbox&#x27;</span>, </span><br><span class=\"line\">                <span class=\"string\">&#x27;--window-size=1366,850&#x27;</span></span><br><span class=\"line\">            ]</span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\">    page = <span class=\"keyword\">await</span> browser.newPage()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.setViewport(&#123;<span class=\"string\">&#x27;width&#x27;</span>: <span class=\"number\">1366</span>, <span class=\"string\">&#x27;height&#x27;</span>: <span class=\"number\">768</span>&#125;)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.goto(<span class=\"string\">&#x27;https://bot.sannysoft.com/&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> page.screenshot(&#123;<span class=\"string\">&#x27;path&#x27;</span>: <span class=\"string\">&#x27;test.png&#x27;</span>&#125;)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> browser.close()</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure>\n<p><img src=\"example1.webp\"></p>\n"},{"title":"Session和Cookies","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-12T02:51:36.000Z","pic":null,"_content":"\n## 静态网页和动态网页\n\n示例代码：\n\n```html\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"UTF-8\">\n    <title>This is a Demo</title> \n  </head>\n  <body> \n    <div id=\"container\">\n      <div class=\"wrapper\"> \n        <h2 class=\"title\">Hello World</h2> \n        <p class=\"text\">Hello, this is a paragraph.</p> \n        </div> \n      </div> \n    </body> \n</html>\n```\n\n这是最基本的HTML代码，保存为一个`.html`文件，然后把它放在某台具有固定公网`IP`的主机上，主机上装上`Apache`或`Nginx`等服务器，这样这台主机就可以作为服务器了，其他人便可以通过访问服务器看到这个页面，这就搭建了一个最简单的网站。\n\n这种网页的内容是HTML代码编写的，文字、图片等内容均通过写好的HTML代码来指定，这种页面叫作静态网页。它加载速度快，编写简单，但是存在很大的缺陷，如可维护性差，不能根据`URL`灵活多变地显示内容等。例如，想要给这个网页的`URL`传入一个`name`参数，让其在网页中显示出来，是无法做到的。\n\n因此，动态网页应运而生，它可以动态解析`URL`中参数的变化，关联数据库并动态呈现不同的页面内容，非常灵活多变。现在遇到的大多数网站都是动态网站，它们不再是一个简单的`HTML`，而是可能由`JSP`、`PHP`、`Python`等语言编写的，其功能比静态网页强大和丰富太多了。\n\n此外，动态网站还可以实现用户登录和注册的功能。按照一般的逻辑来说，输入用户名和密码登录之后，肯定是拿到了一种类似凭证的东西，有了它，才能保持登录状态，才能访问登录之后才能看到的页面。\n\n那么，这种神秘的凭证到底是什么呢？其实它就是 Session和Cookies 共同产生的结果。\n\n## 无状态HTTP\n\n在了解`Session`和`Cookies`之前，还需要了解`HTTP`的一个特点，叫作无状态。\n\n`HTTP`的无状态是指`HTTP`协议对事务处理是没有记忆能力的，也就是说服务器不知道客户端是什么状态。\n\n当向服务器发送请求后，服务器解析此请求，然后返回对应的响应，服务器负责完成这个过程，而且这个过程是完全独立的，服务器不会记录前后状态的变化，也就是缺少状态记录。\n\n这意味着如果后续需要处理前面的信息，则必须重传，这也导致需要额外传递一些前面的重复请求，才能获取后续响应，这种效果显然不是想要的。为了保持前后状态，肯定不能将前面的请求全 部重传一次，这太浪费资源了，对于这种需要用户登录的页面来说，更是棘手。\n\n这时两个用于保持`HTTP`连接状态的技术就出现了，它们分别是`Session`和`Cookies`。`Session`在服务端，也就是网站的服务器，用来保存用户的`Session信息`；`Cookies`在客户端，也可以理解为**浏览器端**，有了`Cookies`，浏览器在下次访问网页时会自动附带上它发送给服务器，服务器通过识别`Cookies`并鉴定出是哪个用户，然后再判断用户是否是登录状态，进而返回对应的响应。\n\n可以理解为`Cookies`里面保存了登录的凭证，有了它，只需要在下次请求携带`Cookies`发送请求而不必重新输入用户名、密码等信息重新登录了。\n\n因此在爬虫中，有时候处理需要登录才能访问的页面时，一般会直接将登录成功后获取的`Cookies`放在请求头里面直接请求，而不必重新模拟登录。\n\n## Cookies\n\n`Cookies`指某些网站为了辨别用户身份、进行`Session`跟踪而存储在用户本地终端上的数据。\n\n## Session\n\n`Session`，中文称之为**会话**，其本身的含义是指有始有终的一系列动作/消息。比如，打电话时，从拿起电话拨号到挂断电话这中间的一系列过程可以称为一个 `Session`。\n\n而在`Web`中，`Session对象`用来存储特定用户`Session`所需的属性及配置信息。这样，当用户在应用程序的`Web`页之间跳转时，存储在`Session`对象中的变量将不会丢失，而是在整个用户`Session`中一直存在下去。当用户请求来自应用程序的`Web`页时，如果该用户还没有`Session`，则`Web`服务器将自动创建一个 `Session`对象。当`Session`过期或被放弃后，服务器将终止该`Session`。\n\n## Session维持\n\n那么，怎样利用`Cookies`保持状态呢？当客户端第一次请求服务器时，服务器会返回一个响应头中带有`Set-Cookie`字段的响应给客户端，用来标记是哪一个用户，客户端浏览器会把`Cookies`保存起来。当浏览器下一次再请求该网站时，浏览器会把此`Cookies`放到请求头一起提交给服务器，`Cookies`携带了`SessionID` 信息，服务器检查该`Cookies`即可找到对应的`Session`是什么，然后再判断`Session`来以此来辨认用户状态。\n\n在成功登录某个网站时，服务器会告诉客户端设置哪些`Cookies`信息，在后续访问页面时客户端会把`Cookies`发送给服务器，服务器再找到对应的`Session`加以判断。如果`Session`中的某些设置登录状态的变量是有效的，那就证明用户处于登录状态，此时返回登录之后才可以查看的网页内容，浏览器再进行解析便可以看到了。\n\n反之，如果传给服务器的`Cookies`是无效的，或者`Session`已经过期了，将不能继续访问页面，此时可能会收到错误的响应或者跳转到登录页面重新登录。 所以，`Cookies`和`Session`需要配合，一个处于客户端，一个处于服务端，二者共同协作，就实现了登录`Session`控制。\n\n## Cookies属性结构\n\n`Cookie`有如下几个属性。\n\n- `Name`，即该`Cookie`的名称。\n- `Cookie`一旦创建，名称便不可更改。\n- `Value`，即该`Cookie`的值。如果值为`Unicode`字符，需要为字符编码。如果值为二进制数据，则需要使用`BASE64`编码。\n- `MaxAge`，即该`Cookie`失效的时间，单位秒，也常和`Expires`一起使用，通过它可以计算出其有效时间。\n- `MaxAge` 如果为正数，则该`Cookie`在`MaxAge`秒之后失效。如果为负数，则关闭浏览器时`Cookie`即失效，浏览器也不会以任何形式保存该`Cookie`。\n- `Path`，即该`Cookie`的使用路径。如果设置为`/path/`，则只有路径为`/path/`的页面可以访问该`Cookie`。如果设置为`/`，则本域名下的所有页面都可以访问该`Cookie`。\n- `Domain`，即可以访问该`Cookie`的域名。例如如果设置为`.zhihu.com`，则所有以`zhihu.com`，结尾的域名都可以访问该`Cookie`。\n- `Size`字段，即此`Cookie`的大小。\n- `Http`字段，即`Cookie`的`httponly`属性。若此属性为`true`，则只有在`HTTP Headers`中会带有此`Cookie`的信息，而不能通过`document.cookie`来访问此`Cookie`。\n- `Secure`，即该`Cookie`是否仅被使用安全协议传输。安全协议。安全协议有`HTTPS、SSL`等，在网络上传输数据之前先将数据加密。默认为`false`。\n\n## 会话会`Cookie`和持久和`Cookie`\n\n从表面意思来说，会话`Cookie`就是把`Cookie`放在浏览器内存里，浏览器在关闭之后该`Cookie`即失效；持久`Cookie`则会保存到客户端的硬盘中，下次还可以继续使用，用于长久保持用户登录状态。\n\n严格来说，没有会话`Cookie`和持久`Cookie`之分，只是由`Cookie`的`MaxAge`或`Expires`字段决定了过期的时间。 因此，一些持久化登录的网站其实就是把`Cookie`的有效时间和`Session`有效期设置得比较长，下次再访问页面时仍然携带之前的`Cookie`，就可以直接保持登录状态。\n\n## 常见误区\n\n在谈论`Session`机制的时候，常常听到这样一种误解 ——“只要关闭浏览器，`Session`就消失了”。可以想象一下会员卡的例子，除非顾客主动对店家提出销卡，否则店家绝对不会轻易删除顾客的资料。对`Session`来说，也是一样，除非程序通知服务器删除一个`Session`，否则服务器会一直保留。比如，程序一般都是在做注销操作时才去删除`Session`。\n\n但是当关闭浏览器时，浏览器不会主动在关闭之前通知服务器它将要关闭，所以服务器根本不会有机会知道浏览器已经关闭。之所以会有这种错觉，是因为大部分网站都使用会话`Cookie`来保存`Session ID`信息，而关闭浏览器后`Cookies`就消失了，再次连接服务器时，也就无法找到原来的`Session`了。如果服务器设置的`Cookies`保存到硬盘上，或者使用某种手段改写浏览器发出的`HTTP`请求头，把原来的`Cookies`发送给服务器，则再次打开浏览器，仍然能够找到原来的`Session ID`，依旧还是可以保持登录状态的。\n\n而且恰恰是由于关闭浏览器不会导致`Session`被删除，这就需要服务器为`Session`设置一个失效时间，当距离客户端上一次使用`Session`的时间超过这个失效时间时，服务器就可以认为客户端已经停止了活动，才会把`Session`删除以节省存储空间。\n","source":"_posts/Session和Cookies.md","raw":"---\ntitle: Session和Cookies\ntags:\n  - http\n  - web\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-12 10:51:36\ncategories: 爬虫\npic:\n---\n\n## 静态网页和动态网页\n\n示例代码：\n\n```html\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"UTF-8\">\n    <title>This is a Demo</title> \n  </head>\n  <body> \n    <div id=\"container\">\n      <div class=\"wrapper\"> \n        <h2 class=\"title\">Hello World</h2> \n        <p class=\"text\">Hello, this is a paragraph.</p> \n        </div> \n      </div> \n    </body> \n</html>\n```\n\n这是最基本的HTML代码，保存为一个`.html`文件，然后把它放在某台具有固定公网`IP`的主机上，主机上装上`Apache`或`Nginx`等服务器，这样这台主机就可以作为服务器了，其他人便可以通过访问服务器看到这个页面，这就搭建了一个最简单的网站。\n\n这种网页的内容是HTML代码编写的，文字、图片等内容均通过写好的HTML代码来指定，这种页面叫作静态网页。它加载速度快，编写简单，但是存在很大的缺陷，如可维护性差，不能根据`URL`灵活多变地显示内容等。例如，想要给这个网页的`URL`传入一个`name`参数，让其在网页中显示出来，是无法做到的。\n\n因此，动态网页应运而生，它可以动态解析`URL`中参数的变化，关联数据库并动态呈现不同的页面内容，非常灵活多变。现在遇到的大多数网站都是动态网站，它们不再是一个简单的`HTML`，而是可能由`JSP`、`PHP`、`Python`等语言编写的，其功能比静态网页强大和丰富太多了。\n\n此外，动态网站还可以实现用户登录和注册的功能。按照一般的逻辑来说，输入用户名和密码登录之后，肯定是拿到了一种类似凭证的东西，有了它，才能保持登录状态，才能访问登录之后才能看到的页面。\n\n那么，这种神秘的凭证到底是什么呢？其实它就是 Session和Cookies 共同产生的结果。\n\n## 无状态HTTP\n\n在了解`Session`和`Cookies`之前，还需要了解`HTTP`的一个特点，叫作无状态。\n\n`HTTP`的无状态是指`HTTP`协议对事务处理是没有记忆能力的，也就是说服务器不知道客户端是什么状态。\n\n当向服务器发送请求后，服务器解析此请求，然后返回对应的响应，服务器负责完成这个过程，而且这个过程是完全独立的，服务器不会记录前后状态的变化，也就是缺少状态记录。\n\n这意味着如果后续需要处理前面的信息，则必须重传，这也导致需要额外传递一些前面的重复请求，才能获取后续响应，这种效果显然不是想要的。为了保持前后状态，肯定不能将前面的请求全 部重传一次，这太浪费资源了，对于这种需要用户登录的页面来说，更是棘手。\n\n这时两个用于保持`HTTP`连接状态的技术就出现了，它们分别是`Session`和`Cookies`。`Session`在服务端，也就是网站的服务器，用来保存用户的`Session信息`；`Cookies`在客户端，也可以理解为**浏览器端**，有了`Cookies`，浏览器在下次访问网页时会自动附带上它发送给服务器，服务器通过识别`Cookies`并鉴定出是哪个用户，然后再判断用户是否是登录状态，进而返回对应的响应。\n\n可以理解为`Cookies`里面保存了登录的凭证，有了它，只需要在下次请求携带`Cookies`发送请求而不必重新输入用户名、密码等信息重新登录了。\n\n因此在爬虫中，有时候处理需要登录才能访问的页面时，一般会直接将登录成功后获取的`Cookies`放在请求头里面直接请求，而不必重新模拟登录。\n\n## Cookies\n\n`Cookies`指某些网站为了辨别用户身份、进行`Session`跟踪而存储在用户本地终端上的数据。\n\n## Session\n\n`Session`，中文称之为**会话**，其本身的含义是指有始有终的一系列动作/消息。比如，打电话时，从拿起电话拨号到挂断电话这中间的一系列过程可以称为一个 `Session`。\n\n而在`Web`中，`Session对象`用来存储特定用户`Session`所需的属性及配置信息。这样，当用户在应用程序的`Web`页之间跳转时，存储在`Session`对象中的变量将不会丢失，而是在整个用户`Session`中一直存在下去。当用户请求来自应用程序的`Web`页时，如果该用户还没有`Session`，则`Web`服务器将自动创建一个 `Session`对象。当`Session`过期或被放弃后，服务器将终止该`Session`。\n\n## Session维持\n\n那么，怎样利用`Cookies`保持状态呢？当客户端第一次请求服务器时，服务器会返回一个响应头中带有`Set-Cookie`字段的响应给客户端，用来标记是哪一个用户，客户端浏览器会把`Cookies`保存起来。当浏览器下一次再请求该网站时，浏览器会把此`Cookies`放到请求头一起提交给服务器，`Cookies`携带了`SessionID` 信息，服务器检查该`Cookies`即可找到对应的`Session`是什么，然后再判断`Session`来以此来辨认用户状态。\n\n在成功登录某个网站时，服务器会告诉客户端设置哪些`Cookies`信息，在后续访问页面时客户端会把`Cookies`发送给服务器，服务器再找到对应的`Session`加以判断。如果`Session`中的某些设置登录状态的变量是有效的，那就证明用户处于登录状态，此时返回登录之后才可以查看的网页内容，浏览器再进行解析便可以看到了。\n\n反之，如果传给服务器的`Cookies`是无效的，或者`Session`已经过期了，将不能继续访问页面，此时可能会收到错误的响应或者跳转到登录页面重新登录。 所以，`Cookies`和`Session`需要配合，一个处于客户端，一个处于服务端，二者共同协作，就实现了登录`Session`控制。\n\n## Cookies属性结构\n\n`Cookie`有如下几个属性。\n\n- `Name`，即该`Cookie`的名称。\n- `Cookie`一旦创建，名称便不可更改。\n- `Value`，即该`Cookie`的值。如果值为`Unicode`字符，需要为字符编码。如果值为二进制数据，则需要使用`BASE64`编码。\n- `MaxAge`，即该`Cookie`失效的时间，单位秒，也常和`Expires`一起使用，通过它可以计算出其有效时间。\n- `MaxAge` 如果为正数，则该`Cookie`在`MaxAge`秒之后失效。如果为负数，则关闭浏览器时`Cookie`即失效，浏览器也不会以任何形式保存该`Cookie`。\n- `Path`，即该`Cookie`的使用路径。如果设置为`/path/`，则只有路径为`/path/`的页面可以访问该`Cookie`。如果设置为`/`，则本域名下的所有页面都可以访问该`Cookie`。\n- `Domain`，即可以访问该`Cookie`的域名。例如如果设置为`.zhihu.com`，则所有以`zhihu.com`，结尾的域名都可以访问该`Cookie`。\n- `Size`字段，即此`Cookie`的大小。\n- `Http`字段，即`Cookie`的`httponly`属性。若此属性为`true`，则只有在`HTTP Headers`中会带有此`Cookie`的信息，而不能通过`document.cookie`来访问此`Cookie`。\n- `Secure`，即该`Cookie`是否仅被使用安全协议传输。安全协议。安全协议有`HTTPS、SSL`等，在网络上传输数据之前先将数据加密。默认为`false`。\n\n## 会话会`Cookie`和持久和`Cookie`\n\n从表面意思来说，会话`Cookie`就是把`Cookie`放在浏览器内存里，浏览器在关闭之后该`Cookie`即失效；持久`Cookie`则会保存到客户端的硬盘中，下次还可以继续使用，用于长久保持用户登录状态。\n\n严格来说，没有会话`Cookie`和持久`Cookie`之分，只是由`Cookie`的`MaxAge`或`Expires`字段决定了过期的时间。 因此，一些持久化登录的网站其实就是把`Cookie`的有效时间和`Session`有效期设置得比较长，下次再访问页面时仍然携带之前的`Cookie`，就可以直接保持登录状态。\n\n## 常见误区\n\n在谈论`Session`机制的时候，常常听到这样一种误解 ——“只要关闭浏览器，`Session`就消失了”。可以想象一下会员卡的例子，除非顾客主动对店家提出销卡，否则店家绝对不会轻易删除顾客的资料。对`Session`来说，也是一样，除非程序通知服务器删除一个`Session`，否则服务器会一直保留。比如，程序一般都是在做注销操作时才去删除`Session`。\n\n但是当关闭浏览器时，浏览器不会主动在关闭之前通知服务器它将要关闭，所以服务器根本不会有机会知道浏览器已经关闭。之所以会有这种错觉，是因为大部分网站都使用会话`Cookie`来保存`Session ID`信息，而关闭浏览器后`Cookies`就消失了，再次连接服务器时，也就无法找到原来的`Session`了。如果服务器设置的`Cookies`保存到硬盘上，或者使用某种手段改写浏览器发出的`HTTP`请求头，把原来的`Cookies`发送给服务器，则再次打开浏览器，仍然能够找到原来的`Session ID`，依旧还是可以保持登录状态的。\n\n而且恰恰是由于关闭浏览器不会导致`Session`被删除，这就需要服务器为`Session`设置一个失效时间，当距离客户端上一次使用`Session`的时间超过这个失效时间时，服务器就可以认为客户端已经停止了活动，才会把`Session`删除以节省存储空间。\n","slug":"Session和Cookies","published":1,"updated":"2021-06-15T03:24:11.487Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2b001e44ud5od5dy24","content":"<h2 id=\"静态网页和动态网页\"><a href=\"#静态网页和动态网页\" class=\"headerlink\" title=\"静态网页和动态网页\"></a>静态网页和动态网页</h2><p>示例代码：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>This is a Demo<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;wrapper&quot;</span>&gt;</span> </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;title&quot;</span>&gt;</span>Hello World<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span> </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;text&quot;</span>&gt;</span>Hello, this is a paragraph.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span> </span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>这是最基本的HTML代码，保存为一个<code>.html</code>文件，然后把它放在某台具有固定公网<code>IP</code>的主机上，主机上装上<code>Apache</code>或<code>Nginx</code>等服务器，这样这台主机就可以作为服务器了，其他人便可以通过访问服务器看到这个页面，这就搭建了一个最简单的网站。</p>\n<p>这种网页的内容是HTML代码编写的，文字、图片等内容均通过写好的HTML代码来指定，这种页面叫作静态网页。它加载速度快，编写简单，但是存在很大的缺陷，如可维护性差，不能根据<code>URL</code>灵活多变地显示内容等。例如，想要给这个网页的<code>URL</code>传入一个<code>name</code>参数，让其在网页中显示出来，是无法做到的。</p>\n<p>因此，动态网页应运而生，它可以动态解析<code>URL</code>中参数的变化，关联数据库并动态呈现不同的页面内容，非常灵活多变。现在遇到的大多数网站都是动态网站，它们不再是一个简单的<code>HTML</code>，而是可能由<code>JSP</code>、<code>PHP</code>、<code>Python</code>等语言编写的，其功能比静态网页强大和丰富太多了。</p>\n<p>此外，动态网站还可以实现用户登录和注册的功能。按照一般的逻辑来说，输入用户名和密码登录之后，肯定是拿到了一种类似凭证的东西，有了它，才能保持登录状态，才能访问登录之后才能看到的页面。</p>\n<p>那么，这种神秘的凭证到底是什么呢？其实它就是 Session和Cookies 共同产生的结果。</p>\n<h2 id=\"无状态HTTP\"><a href=\"#无状态HTTP\" class=\"headerlink\" title=\"无状态HTTP\"></a>无状态HTTP</h2><p>在了解<code>Session</code>和<code>Cookies</code>之前，还需要了解<code>HTTP</code>的一个特点，叫作无状态。</p>\n<p><code>HTTP</code>的无状态是指<code>HTTP</code>协议对事务处理是没有记忆能力的，也就是说服务器不知道客户端是什么状态。</p>\n<p>当向服务器发送请求后，服务器解析此请求，然后返回对应的响应，服务器负责完成这个过程，而且这个过程是完全独立的，服务器不会记录前后状态的变化，也就是缺少状态记录。</p>\n<p>这意味着如果后续需要处理前面的信息，则必须重传，这也导致需要额外传递一些前面的重复请求，才能获取后续响应，这种效果显然不是想要的。为了保持前后状态，肯定不能将前面的请求全 部重传一次，这太浪费资源了，对于这种需要用户登录的页面来说，更是棘手。</p>\n<p>这时两个用于保持<code>HTTP</code>连接状态的技术就出现了，它们分别是<code>Session</code>和<code>Cookies</code>。<code>Session</code>在服务端，也就是网站的服务器，用来保存用户的<code>Session信息</code>；<code>Cookies</code>在客户端，也可以理解为<strong>浏览器端</strong>，有了<code>Cookies</code>，浏览器在下次访问网页时会自动附带上它发送给服务器，服务器通过识别<code>Cookies</code>并鉴定出是哪个用户，然后再判断用户是否是登录状态，进而返回对应的响应。</p>\n<p>可以理解为<code>Cookies</code>里面保存了登录的凭证，有了它，只需要在下次请求携带<code>Cookies</code>发送请求而不必重新输入用户名、密码等信息重新登录了。</p>\n<p>因此在爬虫中，有时候处理需要登录才能访问的页面时，一般会直接将登录成功后获取的<code>Cookies</code>放在请求头里面直接请求，而不必重新模拟登录。</p>\n<h2 id=\"Cookies\"><a href=\"#Cookies\" class=\"headerlink\" title=\"Cookies\"></a>Cookies</h2><p><code>Cookies</code>指某些网站为了辨别用户身份、进行<code>Session</code>跟踪而存储在用户本地终端上的数据。</p>\n<h2 id=\"Session\"><a href=\"#Session\" class=\"headerlink\" title=\"Session\"></a>Session</h2><p><code>Session</code>，中文称之为<strong>会话</strong>，其本身的含义是指有始有终的一系列动作/消息。比如，打电话时，从拿起电话拨号到挂断电话这中间的一系列过程可以称为一个 <code>Session</code>。</p>\n<p>而在<code>Web</code>中，<code>Session对象</code>用来存储特定用户<code>Session</code>所需的属性及配置信息。这样，当用户在应用程序的<code>Web</code>页之间跳转时，存储在<code>Session</code>对象中的变量将不会丢失，而是在整个用户<code>Session</code>中一直存在下去。当用户请求来自应用程序的<code>Web</code>页时，如果该用户还没有<code>Session</code>，则<code>Web</code>服务器将自动创建一个 <code>Session</code>对象。当<code>Session</code>过期或被放弃后，服务器将终止该<code>Session</code>。</p>\n<h2 id=\"Session维持\"><a href=\"#Session维持\" class=\"headerlink\" title=\"Session维持\"></a>Session维持</h2><p>那么，怎样利用<code>Cookies</code>保持状态呢？当客户端第一次请求服务器时，服务器会返回一个响应头中带有<code>Set-Cookie</code>字段的响应给客户端，用来标记是哪一个用户，客户端浏览器会把<code>Cookies</code>保存起来。当浏览器下一次再请求该网站时，浏览器会把此<code>Cookies</code>放到请求头一起提交给服务器，<code>Cookies</code>携带了<code>SessionID</code> 信息，服务器检查该<code>Cookies</code>即可找到对应的<code>Session</code>是什么，然后再判断<code>Session</code>来以此来辨认用户状态。</p>\n<p>在成功登录某个网站时，服务器会告诉客户端设置哪些<code>Cookies</code>信息，在后续访问页面时客户端会把<code>Cookies</code>发送给服务器，服务器再找到对应的<code>Session</code>加以判断。如果<code>Session</code>中的某些设置登录状态的变量是有效的，那就证明用户处于登录状态，此时返回登录之后才可以查看的网页内容，浏览器再进行解析便可以看到了。</p>\n<p>反之，如果传给服务器的<code>Cookies</code>是无效的，或者<code>Session</code>已经过期了，将不能继续访问页面，此时可能会收到错误的响应或者跳转到登录页面重新登录。 所以，<code>Cookies</code>和<code>Session</code>需要配合，一个处于客户端，一个处于服务端，二者共同协作，就实现了登录<code>Session</code>控制。</p>\n<h2 id=\"Cookies属性结构\"><a href=\"#Cookies属性结构\" class=\"headerlink\" title=\"Cookies属性结构\"></a>Cookies属性结构</h2><p><code>Cookie</code>有如下几个属性。</p>\n<ul>\n<li><code>Name</code>，即该<code>Cookie</code>的名称。</li>\n<li><code>Cookie</code>一旦创建，名称便不可更改。</li>\n<li><code>Value</code>，即该<code>Cookie</code>的值。如果值为<code>Unicode</code>字符，需要为字符编码。如果值为二进制数据，则需要使用<code>BASE64</code>编码。</li>\n<li><code>MaxAge</code>，即该<code>Cookie</code>失效的时间，单位秒，也常和<code>Expires</code>一起使用，通过它可以计算出其有效时间。</li>\n<li><code>MaxAge</code> 如果为正数，则该<code>Cookie</code>在<code>MaxAge</code>秒之后失效。如果为负数，则关闭浏览器时<code>Cookie</code>即失效，浏览器也不会以任何形式保存该<code>Cookie</code>。</li>\n<li><code>Path</code>，即该<code>Cookie</code>的使用路径。如果设置为<code>/path/</code>，则只有路径为<code>/path/</code>的页面可以访问该<code>Cookie</code>。如果设置为<code>/</code>，则本域名下的所有页面都可以访问该<code>Cookie</code>。</li>\n<li><code>Domain</code>，即可以访问该<code>Cookie</code>的域名。例如如果设置为<code>.zhihu.com</code>，则所有以<code>zhihu.com</code>，结尾的域名都可以访问该<code>Cookie</code>。</li>\n<li><code>Size</code>字段，即此<code>Cookie</code>的大小。</li>\n<li><code>Http</code>字段，即<code>Cookie</code>的<code>httponly</code>属性。若此属性为<code>true</code>，则只有在<code>HTTP Headers</code>中会带有此<code>Cookie</code>的信息，而不能通过<code>document.cookie</code>来访问此<code>Cookie</code>。</li>\n<li><code>Secure</code>，即该<code>Cookie</code>是否仅被使用安全协议传输。安全协议。安全协议有<code>HTTPS、SSL</code>等，在网络上传输数据之前先将数据加密。默认为<code>false</code>。</li>\n</ul>\n<h2 id=\"会话会Cookie和持久和Cookie\"><a href=\"#会话会Cookie和持久和Cookie\" class=\"headerlink\" title=\"会话会Cookie和持久和Cookie\"></a>会话会<code>Cookie</code>和持久和<code>Cookie</code></h2><p>从表面意思来说，会话<code>Cookie</code>就是把<code>Cookie</code>放在浏览器内存里，浏览器在关闭之后该<code>Cookie</code>即失效；持久<code>Cookie</code>则会保存到客户端的硬盘中，下次还可以继续使用，用于长久保持用户登录状态。</p>\n<p>严格来说，没有会话<code>Cookie</code>和持久<code>Cookie</code>之分，只是由<code>Cookie</code>的<code>MaxAge</code>或<code>Expires</code>字段决定了过期的时间。 因此，一些持久化登录的网站其实就是把<code>Cookie</code>的有效时间和<code>Session</code>有效期设置得比较长，下次再访问页面时仍然携带之前的<code>Cookie</code>，就可以直接保持登录状态。</p>\n<h2 id=\"常见误区\"><a href=\"#常见误区\" class=\"headerlink\" title=\"常见误区\"></a>常见误区</h2><p>在谈论<code>Session</code>机制的时候，常常听到这样一种误解 ——“只要关闭浏览器，<code>Session</code>就消失了”。可以想象一下会员卡的例子，除非顾客主动对店家提出销卡，否则店家绝对不会轻易删除顾客的资料。对<code>Session</code>来说，也是一样，除非程序通知服务器删除一个<code>Session</code>，否则服务器会一直保留。比如，程序一般都是在做注销操作时才去删除<code>Session</code>。</p>\n<p>但是当关闭浏览器时，浏览器不会主动在关闭之前通知服务器它将要关闭，所以服务器根本不会有机会知道浏览器已经关闭。之所以会有这种错觉，是因为大部分网站都使用会话<code>Cookie</code>来保存<code>Session ID</code>信息，而关闭浏览器后<code>Cookies</code>就消失了，再次连接服务器时，也就无法找到原来的<code>Session</code>了。如果服务器设置的<code>Cookies</code>保存到硬盘上，或者使用某种手段改写浏览器发出的<code>HTTP</code>请求头，把原来的<code>Cookies</code>发送给服务器，则再次打开浏览器，仍然能够找到原来的<code>Session ID</code>，依旧还是可以保持登录状态的。</p>\n<p>而且恰恰是由于关闭浏览器不会导致<code>Session</code>被删除，这就需要服务器为<code>Session</code>设置一个失效时间，当距离客户端上一次使用<code>Session</code>的时间超过这个失效时间时，服务器就可以认为客户端已经停止了活动，才会把<code>Session</code>删除以节省存储空间。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"静态网页和动态网页\"><a href=\"#静态网页和动态网页\" class=\"headerlink\" title=\"静态网页和动态网页\"></a>静态网页和动态网页</h2><p>示例代码：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>This is a Demo<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;wrapper&quot;</span>&gt;</span> </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;title&quot;</span>&gt;</span>Hello World<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span> </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;text&quot;</span>&gt;</span>Hello, this is a paragraph.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span> </span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>这是最基本的HTML代码，保存为一个<code>.html</code>文件，然后把它放在某台具有固定公网<code>IP</code>的主机上，主机上装上<code>Apache</code>或<code>Nginx</code>等服务器，这样这台主机就可以作为服务器了，其他人便可以通过访问服务器看到这个页面，这就搭建了一个最简单的网站。</p>\n<p>这种网页的内容是HTML代码编写的，文字、图片等内容均通过写好的HTML代码来指定，这种页面叫作静态网页。它加载速度快，编写简单，但是存在很大的缺陷，如可维护性差，不能根据<code>URL</code>灵活多变地显示内容等。例如，想要给这个网页的<code>URL</code>传入一个<code>name</code>参数，让其在网页中显示出来，是无法做到的。</p>\n<p>因此，动态网页应运而生，它可以动态解析<code>URL</code>中参数的变化，关联数据库并动态呈现不同的页面内容，非常灵活多变。现在遇到的大多数网站都是动态网站，它们不再是一个简单的<code>HTML</code>，而是可能由<code>JSP</code>、<code>PHP</code>、<code>Python</code>等语言编写的，其功能比静态网页强大和丰富太多了。</p>\n<p>此外，动态网站还可以实现用户登录和注册的功能。按照一般的逻辑来说，输入用户名和密码登录之后，肯定是拿到了一种类似凭证的东西，有了它，才能保持登录状态，才能访问登录之后才能看到的页面。</p>\n<p>那么，这种神秘的凭证到底是什么呢？其实它就是 Session和Cookies 共同产生的结果。</p>\n<h2 id=\"无状态HTTP\"><a href=\"#无状态HTTP\" class=\"headerlink\" title=\"无状态HTTP\"></a>无状态HTTP</h2><p>在了解<code>Session</code>和<code>Cookies</code>之前，还需要了解<code>HTTP</code>的一个特点，叫作无状态。</p>\n<p><code>HTTP</code>的无状态是指<code>HTTP</code>协议对事务处理是没有记忆能力的，也就是说服务器不知道客户端是什么状态。</p>\n<p>当向服务器发送请求后，服务器解析此请求，然后返回对应的响应，服务器负责完成这个过程，而且这个过程是完全独立的，服务器不会记录前后状态的变化，也就是缺少状态记录。</p>\n<p>这意味着如果后续需要处理前面的信息，则必须重传，这也导致需要额外传递一些前面的重复请求，才能获取后续响应，这种效果显然不是想要的。为了保持前后状态，肯定不能将前面的请求全 部重传一次，这太浪费资源了，对于这种需要用户登录的页面来说，更是棘手。</p>\n<p>这时两个用于保持<code>HTTP</code>连接状态的技术就出现了，它们分别是<code>Session</code>和<code>Cookies</code>。<code>Session</code>在服务端，也就是网站的服务器，用来保存用户的<code>Session信息</code>；<code>Cookies</code>在客户端，也可以理解为<strong>浏览器端</strong>，有了<code>Cookies</code>，浏览器在下次访问网页时会自动附带上它发送给服务器，服务器通过识别<code>Cookies</code>并鉴定出是哪个用户，然后再判断用户是否是登录状态，进而返回对应的响应。</p>\n<p>可以理解为<code>Cookies</code>里面保存了登录的凭证，有了它，只需要在下次请求携带<code>Cookies</code>发送请求而不必重新输入用户名、密码等信息重新登录了。</p>\n<p>因此在爬虫中，有时候处理需要登录才能访问的页面时，一般会直接将登录成功后获取的<code>Cookies</code>放在请求头里面直接请求，而不必重新模拟登录。</p>\n<h2 id=\"Cookies\"><a href=\"#Cookies\" class=\"headerlink\" title=\"Cookies\"></a>Cookies</h2><p><code>Cookies</code>指某些网站为了辨别用户身份、进行<code>Session</code>跟踪而存储在用户本地终端上的数据。</p>\n<h2 id=\"Session\"><a href=\"#Session\" class=\"headerlink\" title=\"Session\"></a>Session</h2><p><code>Session</code>，中文称之为<strong>会话</strong>，其本身的含义是指有始有终的一系列动作/消息。比如，打电话时，从拿起电话拨号到挂断电话这中间的一系列过程可以称为一个 <code>Session</code>。</p>\n<p>而在<code>Web</code>中，<code>Session对象</code>用来存储特定用户<code>Session</code>所需的属性及配置信息。这样，当用户在应用程序的<code>Web</code>页之间跳转时，存储在<code>Session</code>对象中的变量将不会丢失，而是在整个用户<code>Session</code>中一直存在下去。当用户请求来自应用程序的<code>Web</code>页时，如果该用户还没有<code>Session</code>，则<code>Web</code>服务器将自动创建一个 <code>Session</code>对象。当<code>Session</code>过期或被放弃后，服务器将终止该<code>Session</code>。</p>\n<h2 id=\"Session维持\"><a href=\"#Session维持\" class=\"headerlink\" title=\"Session维持\"></a>Session维持</h2><p>那么，怎样利用<code>Cookies</code>保持状态呢？当客户端第一次请求服务器时，服务器会返回一个响应头中带有<code>Set-Cookie</code>字段的响应给客户端，用来标记是哪一个用户，客户端浏览器会把<code>Cookies</code>保存起来。当浏览器下一次再请求该网站时，浏览器会把此<code>Cookies</code>放到请求头一起提交给服务器，<code>Cookies</code>携带了<code>SessionID</code> 信息，服务器检查该<code>Cookies</code>即可找到对应的<code>Session</code>是什么，然后再判断<code>Session</code>来以此来辨认用户状态。</p>\n<p>在成功登录某个网站时，服务器会告诉客户端设置哪些<code>Cookies</code>信息，在后续访问页面时客户端会把<code>Cookies</code>发送给服务器，服务器再找到对应的<code>Session</code>加以判断。如果<code>Session</code>中的某些设置登录状态的变量是有效的，那就证明用户处于登录状态，此时返回登录之后才可以查看的网页内容，浏览器再进行解析便可以看到了。</p>\n<p>反之，如果传给服务器的<code>Cookies</code>是无效的，或者<code>Session</code>已经过期了，将不能继续访问页面，此时可能会收到错误的响应或者跳转到登录页面重新登录。 所以，<code>Cookies</code>和<code>Session</code>需要配合，一个处于客户端，一个处于服务端，二者共同协作，就实现了登录<code>Session</code>控制。</p>\n<h2 id=\"Cookies属性结构\"><a href=\"#Cookies属性结构\" class=\"headerlink\" title=\"Cookies属性结构\"></a>Cookies属性结构</h2><p><code>Cookie</code>有如下几个属性。</p>\n<ul>\n<li><code>Name</code>，即该<code>Cookie</code>的名称。</li>\n<li><code>Cookie</code>一旦创建，名称便不可更改。</li>\n<li><code>Value</code>，即该<code>Cookie</code>的值。如果值为<code>Unicode</code>字符，需要为字符编码。如果值为二进制数据，则需要使用<code>BASE64</code>编码。</li>\n<li><code>MaxAge</code>，即该<code>Cookie</code>失效的时间，单位秒，也常和<code>Expires</code>一起使用，通过它可以计算出其有效时间。</li>\n<li><code>MaxAge</code> 如果为正数，则该<code>Cookie</code>在<code>MaxAge</code>秒之后失效。如果为负数，则关闭浏览器时<code>Cookie</code>即失效，浏览器也不会以任何形式保存该<code>Cookie</code>。</li>\n<li><code>Path</code>，即该<code>Cookie</code>的使用路径。如果设置为<code>/path/</code>，则只有路径为<code>/path/</code>的页面可以访问该<code>Cookie</code>。如果设置为<code>/</code>，则本域名下的所有页面都可以访问该<code>Cookie</code>。</li>\n<li><code>Domain</code>，即可以访问该<code>Cookie</code>的域名。例如如果设置为<code>.zhihu.com</code>，则所有以<code>zhihu.com</code>，结尾的域名都可以访问该<code>Cookie</code>。</li>\n<li><code>Size</code>字段，即此<code>Cookie</code>的大小。</li>\n<li><code>Http</code>字段，即<code>Cookie</code>的<code>httponly</code>属性。若此属性为<code>true</code>，则只有在<code>HTTP Headers</code>中会带有此<code>Cookie</code>的信息，而不能通过<code>document.cookie</code>来访问此<code>Cookie</code>。</li>\n<li><code>Secure</code>，即该<code>Cookie</code>是否仅被使用安全协议传输。安全协议。安全协议有<code>HTTPS、SSL</code>等，在网络上传输数据之前先将数据加密。默认为<code>false</code>。</li>\n</ul>\n<h2 id=\"会话会Cookie和持久和Cookie\"><a href=\"#会话会Cookie和持久和Cookie\" class=\"headerlink\" title=\"会话会Cookie和持久和Cookie\"></a>会话会<code>Cookie</code>和持久和<code>Cookie</code></h2><p>从表面意思来说，会话<code>Cookie</code>就是把<code>Cookie</code>放在浏览器内存里，浏览器在关闭之后该<code>Cookie</code>即失效；持久<code>Cookie</code>则会保存到客户端的硬盘中，下次还可以继续使用，用于长久保持用户登录状态。</p>\n<p>严格来说，没有会话<code>Cookie</code>和持久<code>Cookie</code>之分，只是由<code>Cookie</code>的<code>MaxAge</code>或<code>Expires</code>字段决定了过期的时间。 因此，一些持久化登录的网站其实就是把<code>Cookie</code>的有效时间和<code>Session</code>有效期设置得比较长，下次再访问页面时仍然携带之前的<code>Cookie</code>，就可以直接保持登录状态。</p>\n<h2 id=\"常见误区\"><a href=\"#常见误区\" class=\"headerlink\" title=\"常见误区\"></a>常见误区</h2><p>在谈论<code>Session</code>机制的时候，常常听到这样一种误解 ——“只要关闭浏览器，<code>Session</code>就消失了”。可以想象一下会员卡的例子，除非顾客主动对店家提出销卡，否则店家绝对不会轻易删除顾客的资料。对<code>Session</code>来说，也是一样，除非程序通知服务器删除一个<code>Session</code>，否则服务器会一直保留。比如，程序一般都是在做注销操作时才去删除<code>Session</code>。</p>\n<p>但是当关闭浏览器时，浏览器不会主动在关闭之前通知服务器它将要关闭，所以服务器根本不会有机会知道浏览器已经关闭。之所以会有这种错觉，是因为大部分网站都使用会话<code>Cookie</code>来保存<code>Session ID</code>信息，而关闭浏览器后<code>Cookies</code>就消失了，再次连接服务器时，也就无法找到原来的<code>Session</code>了。如果服务器设置的<code>Cookies</code>保存到硬盘上，或者使用某种手段改写浏览器发出的<code>HTTP</code>请求头，把原来的<code>Cookies</code>发送给服务器，则再次打开浏览器，仍然能够找到原来的<code>Session ID</code>，依旧还是可以保持登录状态的。</p>\n<p>而且恰恰是由于关闭浏览器不会导致<code>Session</code>被删除，这就需要服务器为<code>Session</code>设置一个失效时间，当距离客户端上一次使用<code>Session</code>的时间超过这个失效时间时，服务器就可以认为客户端已经停止了活动，才会把<code>Session</code>删除以节省存储空间。</p>\n"},{"title":"XPath库解析","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-06T06:44:22.000Z","pic":null,"_content":"\n\n\n`XPath`，全称 `XML Path Language`，即 `XML` 路径语言，它是一门在*XML文档*中查找信息的语言。`XPath` 最初设计是用来搜寻*XML文档*的，`HTML`是`XML`的子集，它同样适用于*HTML文档*的搜索。\n\n## 安装\n\n```python\npip install lxml\n```\n\n## XPath 术语\n\n### 节点（Node）\n\n在 `XPath` 中，有七种类型的节点：*元素*、*属性*、*文本*、*命名空间*、*处理指令*、*注释*以及*文档节点（或称为根节点）*。\n\n请看下面这个 `XML` 文档：\n\n```xml\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n\n<bookstore>\n\n<book>\n  <title lang=\"en\">Harry Potter</title>\n  <author>J K. Rowling</author> \n  <year>2005</year>\n  <price>29.99</price>\n</book>\n\n</bookstore>\n```\n\n上面的`XML`文档中的节点例子：\n\n```xml\n<bookstore> （文档节点）\n<author>J K. Rowling</author> （元素节点）\nlang=\"en\" （属性节点） \n```\n\n#### 基本值（或称原子值，Atomic value）\n\n基本值是无父或无子的节点。\n\n基本值的例子：\n\n```xml\nJ K. Rowling\n\"en\"\n```\n\n#### 项目（Item）\n\n项目是基本值或者节点。\n\n### 节点关系\n\n#### 父（Parent）\n\n每个元素以及属性都有一个父。\n\n在下面的例子中，`book` 元素是 `title`、`author`、`year` 以及 `price` 元素的父：\n\n```xml\n<book>\n  <title>Harry Potter</title>\n  <author>J K. Rowling</author>\n  <year>2005</year>\n  <price>29.99</price>\n</book>\n```\n\n####　子（Children）\n\n元素节点可有零个、一个或多个子。\n\n在下面的例子中，`title`、`author`、`year` 以及 `price` 元素都是 `book` 元素的子：\n\n```xml\n<book>\n  <title>Harry Potter</title>\n  <author>J K. Rowling</author>\n  <year>2005</year>\n  <price>29.99</price>\n</book>\n```\n\n#### 同胞（Sibling）\n\n拥有相同的父的节点\n\n在下面的例子中，`title`、`author`、`year` 以及 `price` 元素都是同胞：\n\n```xml\n<book>\n  <title>Harry Potter</title>\n  <author>J K. Rowling</author>\n  <year>2005</year>\n  <price>29.99</price>\n</book>\n```\n\n#### 先辈（Ancestor）\n\n某节点的父、父的父，等等。\n\n在下面的例子中，`title` 元素的先辈是 `book` 元素和 `bookstore` 元素：\n\n```xml\n<bookstore>\n\n<book>\n  <title>Harry Potter</title>\n  <author>J K. Rowling</author>\n  <year>2005</year>\n  <price>29.99</price>\n</book>\n\n</bookstore>\n```\n\n#### 后代（Descendant）\n\n某个节点的子，子的子，等等。\n\n在下面的例子中，`bookstore `的后代是 `book`、`title`、`author`、`year` 以及 `price` 元素：\n\n```xml\n<bookstore>\n\n<book>\n  <title>Harry Potter</title>\n  <author>J K. Rowling</author>\n  <year>2005</year>\n  <price>29.99</price>\n</book>\n\n</bookstore>\n```\n\n## XPath 语法\n\n目标实列：\n\n```xml\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n\n<bookstore>\n\n<book category=\"COOKING\">\n  <title lang=\"en\">Everyday Italian</title>\n  <author>Giada De Laurentiis</author>\n  <year>2005</year>\n  <price>30.00</price>\n</book>\n\n<book category=\"CHILDREN\">\n  <title lang=\"en\">Harry Potter</title>\n  <author>J K. Rowling</author>\n  <year>2005</year>\n  <price>29.99</price>\n</book>\n\n<book category=\"WEB\">\n  <title lang=\"en\">XQuery Kick Start</title>\n  <author>James McGovern</author>\n  <author>Per Bothner</author>\n  <author>Kurt Cagle</author>\n  <author>James Linn</author>\n  <author>Vaidyanathan Nagarajan</author>\n  <year>2003</year>\n  <price>49.99</price>\n</book>\n\n<book category=\"WEB\">\n  <title lang=\"en\">Learning XML</title>\n  <author>Erik T. Ray</author>\n  <year>2003</year>\n  <price>39.95</price>\n</book>\n\n</bookstore>\n```\n\n### 选取节点\n\n`XPath` 使用路径表达式在 `XML` 文档中选取节点。节点是通过沿着路径或者 `step` 来选取的。\n\n下面列出了最有用的路径表达式：\n\n| 表达式\t| 描述 |\n| :--- | :---- |\n| nodename\t| 选取此节点的所有子节点。 |\n| /\t| 从根节点选取。 |\n| //\t| 从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。 |\n| .\t| 选取当前节点。 |\n| ..\t| 选取当前节点的父节点。 |\n| @\t| 选取属性。 |\n\n**实例**\n\n在下面的表格中，列出了一些路径表达式以及表达式的结果：\n\n| 路径表达式\t| 结果 |\n| :--- | :---- |\n| bookstore |\t选取 bookstore 元素的所有子节点。 |\n| /bookstore | 选取根元素 bookstore。<br>注释：假如路径起始于正斜杠( / )，则此路径始终代表到某元素的绝对路径！ |\n| bookstore/book\t| 选取属于 bookstore 的子元素的所有 book 元素。 |\n| //book\t| 选取所有 book 子元素，而不管它们在文档中的位置。 |\n| bookstore//book\t| 选择属于 bookstore 元素的后代的所有 book 元素，而不管它们位于 bookstore 之下的什么位置。 |\n| //@lang\t| 选取名为 lang 的所有属性。 |\n\n###　谓语（Predicates）\n\n谓语用来查找某个特定的节点或者包含某个指定的值的节点。\n\n谓语被嵌在方括号中。\n\n**实例**\n在下面的表格中，我们列出了带有谓语的一些路径表达式，以及表达式的结果：\n\n| 路径表达式\t| 结果 |\n| :--- | :---- |\n| /bookstore/book[1]\t| 选取属于 bookstore 子元素的第一个 book 元素。 |\n| /bookstore/book[last()]\t| 选取属于 bookstore 子元素的最后一个 book 元素。 |\n| /bookstore/book[last()-1]\t| 选取属于 bookstore 子元素的倒数第二个 book 元素。 |\n| /bookstore/book[position()<3]\t| 选取最前面的两个属于 bookstore 元素的子元素的 book 元素。 |\n| //title[@lang]\t| 选取所有拥有名为 lang 的属性的 title 元素。 |\n| //title[@lang='eng']\t| 选取所有 title 元素，且这些元素拥有值为 eng 的 lang 属性。 |\n| /bookstore/book[price>35.00]\t| 选取 bookstore 元素的所有 book 元素，且其中的 price 元素的值须大于 35.00。 |\n| /bookstore/book[price>35.00]/title\t| 选取 bookstore 元素中的 book 元素的所有 title 元素，且其中的 price 元素的值须大于 35.00。 |\n\n### 选取未知节点\n\n`XPath` 通配符可用来选取未知的 `XML` 元素。\n\n| 通配符\t| 描述 |\n| :--- | :---- |\n| *\t| 匹配任何元素节点。 |\n| @*\t| 匹配任何属性节点。 |\n| node()\t| 匹配任何类型的节点。 |\n\n**实例**\n\n在下面的表格中，列出了一些路径表达式，以及这些表达式的结果：\n\n| 路径表达式\t| 结果 |\n| :--- | :---- |\n| /bookstore/*\t| 选取 bookstore 元素的所有子元素。 |\n| //*\t| 选取文档中的所有元素。 |\n| //title[@*] | 选取所有带有属性的 title 元素。 |\n\n### 选取若干路径\n\n通过在路径表达式中使用“|”运算符，您可以选取若干个路径。\n\n**实例**\n在下面的表格中，我们列出了一些路径表达式，以及这些表达式的结果：\n\n| 路径表达式\t| 结果 |\n| :----- | :---- |\n| //book/title \\| //book/price\t|选取 book 元素的所有 title 和 price 元素。 |\n| //title \\| //price\t| 选取文档中的所有 title 和 price 元素。 |\n| /bookstore/book/title \\| //price\t| 选取属于 bookstore 元素的 book 元素的所有 title 元素，以及文档中所有的 price 元素。 |\n\n## XPath 实例\n\n对`xml`文档的匹配。\n\n```python\n# coding: utf-8\nfrom lxml import etree\n\ntree = etree.XML(xml,)\nresult = tree.xpath(\"/bookstore/book/title/text()\")\n# ['Everyday Italian', 'Harry Potter', 'XQuery Kick Start', 'Learning XML']\n\nresult = tree.xpath(\"//book[3]/author[2]/text()\")\n# ['Per Bothner']\n```\n\n对`html`文档的匹配。\n\n```html\n<div>\n    <ul>\n        <li class=\"item-0\"><a href=\"link1.html\">first item</a></li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n        <li class=\"item-inactive\"><a href=\"link3.html\">third item</a></li>\n        <li class=\"item-1\"><a href=\"link4.html\">fourth item</a></li>\n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a>\n    </ul>\n</div>\n```\n\n引入`xlxml`模块， 从文件中导入`html`。\n\n```python\nfrom lxml import etree\n\ntree = etree.parse('./test.html', etree.HTMLParser())\n```\n\n### 通过字符串转换成html格式\n\n利用`etree.HTML`解析字符串，将字符串解析从`html`格式的文件， 经过处理后，部分缺失的节点可以自动修复，并且还自动添加了 `body`、`html` 节点。\n\n```python\nfrom lxml import etree\n\ntext = \"\"\"\n<html>\n    <body>\n        <div>\n            <ul>\n                <li class=\"item-0\"><a href=\"link1.html\">first item</a></li>\n                <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n                <li class=\"item-inactive\"><a href=\"link3.html\">third item</a></li>\n                <li class=\"item-1\"><a href=\"link4.html\">fourth item</a></li>\n                <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n            </ul>\n        </div>\n    </body>\n</html>\n\"\"\"\n\nhtml = etree.HTML(text)\ns = etree.tostring(html).decode()\nprint(s)\n\n# <html>\n#     <body>\n#         <div>\n#             <ul>\n#                 <li class=\"item-0\"><a href=\"link1.html\">first item</a></li>\n#                 <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n#                 <li class=\"item-inactive\"><a href=\"link3.html\">third item</a></li>\n#                 <li class=\"item-1\"><a href=\"link4.html\">fourth item</a></li>\n#                 <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n#             </ul>\n#         </div>\n#     </body>\n# </html>\n```\n\n### 所有节点\n\n用以 `//` 开头的 `XPath` 规则来选取所有符合要求的字符串：\n\n```python\nresult = html.xpath(\"//text()\")\n# ['\\n    ', '\\n        ', '\\n            ', '\\n                ', 'first item', '\\n                ', 'second item', '\\n                ', 'third item', '\\n\n#       ', 'fourth item', '\\n                ', 'fifth item', '\\n            ', '\\n        ', '\\n    ', '\\n']\n```\n\n### 绝对路径查找\n\n- 获取某个标签的内容\n\n注意，获取`a`标签的所有内容，`a`后面就不用再加正斜杠，否则报错。\n\n```python\nresult = html.xpath(\"/html/body/div/ul/li/a\")\nfor i in result:\n    print(i.text)\n\n# first item\n# second item\n# third item\n# fourth item\n# fifth item\n```\n\n或者\n\n```python\nresult = html.xpath(\"/html/body/div/ul/li/a/text()\")\nfor i in result:\n    print(i)\n\nfirst item\nsecond item\nthird item\nfourth item\nfifth item\n```\n\n- 打印指定路径下a标签的属性\n\n这里可以通过遍历拿到某个属性的值，查找标签的内容，通过`@属性名`获取。\n\n```python\nresult = html.xpath(\"/html/body/div/ul/li/a/@href\")\nfor i in result:\n    print(i)\n\n# link1.html\n# link2.html\n# link3.html\n# link4.html\n# link5.html\n```\n\n- 获取指定标签对应属性值的内容\n\n使用`xpath`拿到得都是一个个的`ElementTree`对象，如果需要查找内容的话，还需要遍历拿到数据的列表。\n\n```python\nresult = html.xpath('/html/body/div/ul/li/a[@href=\"link3.html\"]/text()')\nfor i in result:\n    print(i)\n\n# third item\n```\n\n## 相对路径查找（常用）\n\n- 查找所有li标签下的a标签内容\n\n```python\nresult = html.xpath('//li/a/text()')\nprint(result)\n# ['first item', 'second item', 'third item', 'fourth item', 'fifth item']\n```\n\n- 查找一下l相对路径下li标签下的a标签下的href属性的值\n\n注意，`a`标签后面需要双`//`。\n\n```python\nresult = html.xpath('//li/a/@href')\nprint(result)\n```\n\n- 查找`a`标签下属性`href`值为`link5.html`的内容。\n\n```python\nresult = html.xpath('//li/a/@href')\nprint(result)\n```\n\n- 查找`a`标签下属性`href`值为\"\"的内容。\n\n```python\nresult = html.xpath('//li/a[@href=\"link5.html\"]/text()')\nprint(result)\n\n# ['fifth item']\n```\n\n## 子节点\n\n通过 `/` 或 `//` 即可查找元素的子节点或子孙节点，选择 `li` 节点的所有直接 `a` 子节点`xpath`为：`//li/a`。\n\n## 父节点\n\n知道子节点，查询父节点可以用 `..` 来实现。\n\n```python\nresult = html.xpath('//li/a[@href=\"link5.html\"]/../@class')\nprint(result)\n# ['item-0']\n```\n\n## 属性匹配\n\n匹配时可以用`@`符号进行属性过滤，匹配`li`下属性`class`为`item-5`的内容。\n\n```python\nresult = html.xpath('//li/a[@href=\"link5.html\"]/../@class')\nprint(result)\n# ['item-0']\n```\n\n## 文本获取\n\n有两种方法：一是获取文本所在节点后直接获取文本，二是使用 `//`。第二种方法会获取到补全代码时换行产生的特殊字符，推荐使用第一种方法，可以保证获取的结果是整洁的。\n\n```python\n# first\nresult = html.xpath('//li[@class=\"item-0\"]/a/text()')\nprint(result)\n# ['first item', 'fifth item']\n\n# second\nresult = html.xpath('//li[@class=\"item-0\"]//text()')\nprint(result)\n# ['first item', 'fifth item']\n```\n\n## 属性获取\n\n`@`符号相当于过滤器，可以直接获取节点的属性值。\n\n```python\nresult = html.xpath('//li/a/@href')\nprint(result)\n# ['link1.html', 'link2.html', 'link3.html', 'link4.html', 'link5.html']\n```\n\n## 属性多值匹配\n\n某些节点的某个属性可能有多个值：\n\n```python\nfrom lxml import etree\n\ntext = '''\n<li class=\"zxc  asd  wer\"><a href=\"https://s2.bdstatic.com/\">1 item</a></li>\n<li class=\"ddd  asd  eee\"><a href=\"https://s3.bdstatic.com/\">2 item</a></li>\n'''\n\nhtml = etree.HTML(text)\nresult = html.xpath('//li[contains(@class, \"asd\")]/a/text()')\nprint(result)\n\n# ['1 item', '2 item']\n```\n\n## 多属性匹配\n\n```python\nfrom lxml import etree\n\ntext = '''\n<li class=\"zxc  asd  wer\" name=\"222\"><a href=\"https://s2.bdstatic.com/\">1 item</a></li>\n<li class=\"ddd  zxc  eee\" name=\"111\"><a href=\"https://s3.bdstatic.com/\">2 item</a></li>\n'''\nhtml = etree.HTML(text)\nresult = html.xpath('//li[contains(@class, \"zxc\") and @name=\"111\"]/a/text()')\nprint(result)\n\n# 运行结果：['2 item']\n```\n\n## 函数\n\n查找最后一个`li`标签里的`a`标签的`href`属性（`last()函数`）\n\n```python\nfrom lxml import etree\n\ntext = '''\n<li class=\"zxc  asd  wer\"><a href=\"https://s2.bdstatic.com/\">1 item</a></li>\n<li class=\"ddd  asd  eee\"><a href=\"https://s3.bdstatic.com/\">2 item</a></li>\n'''\nhtml = etree.HTML(text)\nresult = html.xpath('//li[last()]/a/text()')\nprint(result)\n# ['2 item']\n```\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>","source":"_posts/XPath库解析.md","raw":"---\ntitle: XPath库解析\ntags:\n  - xpath\n  - python\n  - lxml\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-06 14:44:22\ncategories: Python库\npic:\n---\n\n\n\n`XPath`，全称 `XML Path Language`，即 `XML` 路径语言，它是一门在*XML文档*中查找信息的语言。`XPath` 最初设计是用来搜寻*XML文档*的，`HTML`是`XML`的子集，它同样适用于*HTML文档*的搜索。\n\n## 安装\n\n```python\npip install lxml\n```\n\n## XPath 术语\n\n### 节点（Node）\n\n在 `XPath` 中，有七种类型的节点：*元素*、*属性*、*文本*、*命名空间*、*处理指令*、*注释*以及*文档节点（或称为根节点）*。\n\n请看下面这个 `XML` 文档：\n\n```xml\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n\n<bookstore>\n\n<book>\n  <title lang=\"en\">Harry Potter</title>\n  <author>J K. Rowling</author> \n  <year>2005</year>\n  <price>29.99</price>\n</book>\n\n</bookstore>\n```\n\n上面的`XML`文档中的节点例子：\n\n```xml\n<bookstore> （文档节点）\n<author>J K. Rowling</author> （元素节点）\nlang=\"en\" （属性节点） \n```\n\n#### 基本值（或称原子值，Atomic value）\n\n基本值是无父或无子的节点。\n\n基本值的例子：\n\n```xml\nJ K. Rowling\n\"en\"\n```\n\n#### 项目（Item）\n\n项目是基本值或者节点。\n\n### 节点关系\n\n#### 父（Parent）\n\n每个元素以及属性都有一个父。\n\n在下面的例子中，`book` 元素是 `title`、`author`、`year` 以及 `price` 元素的父：\n\n```xml\n<book>\n  <title>Harry Potter</title>\n  <author>J K. Rowling</author>\n  <year>2005</year>\n  <price>29.99</price>\n</book>\n```\n\n####　子（Children）\n\n元素节点可有零个、一个或多个子。\n\n在下面的例子中，`title`、`author`、`year` 以及 `price` 元素都是 `book` 元素的子：\n\n```xml\n<book>\n  <title>Harry Potter</title>\n  <author>J K. Rowling</author>\n  <year>2005</year>\n  <price>29.99</price>\n</book>\n```\n\n#### 同胞（Sibling）\n\n拥有相同的父的节点\n\n在下面的例子中，`title`、`author`、`year` 以及 `price` 元素都是同胞：\n\n```xml\n<book>\n  <title>Harry Potter</title>\n  <author>J K. Rowling</author>\n  <year>2005</year>\n  <price>29.99</price>\n</book>\n```\n\n#### 先辈（Ancestor）\n\n某节点的父、父的父，等等。\n\n在下面的例子中，`title` 元素的先辈是 `book` 元素和 `bookstore` 元素：\n\n```xml\n<bookstore>\n\n<book>\n  <title>Harry Potter</title>\n  <author>J K. Rowling</author>\n  <year>2005</year>\n  <price>29.99</price>\n</book>\n\n</bookstore>\n```\n\n#### 后代（Descendant）\n\n某个节点的子，子的子，等等。\n\n在下面的例子中，`bookstore `的后代是 `book`、`title`、`author`、`year` 以及 `price` 元素：\n\n```xml\n<bookstore>\n\n<book>\n  <title>Harry Potter</title>\n  <author>J K. Rowling</author>\n  <year>2005</year>\n  <price>29.99</price>\n</book>\n\n</bookstore>\n```\n\n## XPath 语法\n\n目标实列：\n\n```xml\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n\n<bookstore>\n\n<book category=\"COOKING\">\n  <title lang=\"en\">Everyday Italian</title>\n  <author>Giada De Laurentiis</author>\n  <year>2005</year>\n  <price>30.00</price>\n</book>\n\n<book category=\"CHILDREN\">\n  <title lang=\"en\">Harry Potter</title>\n  <author>J K. Rowling</author>\n  <year>2005</year>\n  <price>29.99</price>\n</book>\n\n<book category=\"WEB\">\n  <title lang=\"en\">XQuery Kick Start</title>\n  <author>James McGovern</author>\n  <author>Per Bothner</author>\n  <author>Kurt Cagle</author>\n  <author>James Linn</author>\n  <author>Vaidyanathan Nagarajan</author>\n  <year>2003</year>\n  <price>49.99</price>\n</book>\n\n<book category=\"WEB\">\n  <title lang=\"en\">Learning XML</title>\n  <author>Erik T. Ray</author>\n  <year>2003</year>\n  <price>39.95</price>\n</book>\n\n</bookstore>\n```\n\n### 选取节点\n\n`XPath` 使用路径表达式在 `XML` 文档中选取节点。节点是通过沿着路径或者 `step` 来选取的。\n\n下面列出了最有用的路径表达式：\n\n| 表达式\t| 描述 |\n| :--- | :---- |\n| nodename\t| 选取此节点的所有子节点。 |\n| /\t| 从根节点选取。 |\n| //\t| 从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。 |\n| .\t| 选取当前节点。 |\n| ..\t| 选取当前节点的父节点。 |\n| @\t| 选取属性。 |\n\n**实例**\n\n在下面的表格中，列出了一些路径表达式以及表达式的结果：\n\n| 路径表达式\t| 结果 |\n| :--- | :---- |\n| bookstore |\t选取 bookstore 元素的所有子节点。 |\n| /bookstore | 选取根元素 bookstore。<br>注释：假如路径起始于正斜杠( / )，则此路径始终代表到某元素的绝对路径！ |\n| bookstore/book\t| 选取属于 bookstore 的子元素的所有 book 元素。 |\n| //book\t| 选取所有 book 子元素，而不管它们在文档中的位置。 |\n| bookstore//book\t| 选择属于 bookstore 元素的后代的所有 book 元素，而不管它们位于 bookstore 之下的什么位置。 |\n| //@lang\t| 选取名为 lang 的所有属性。 |\n\n###　谓语（Predicates）\n\n谓语用来查找某个特定的节点或者包含某个指定的值的节点。\n\n谓语被嵌在方括号中。\n\n**实例**\n在下面的表格中，我们列出了带有谓语的一些路径表达式，以及表达式的结果：\n\n| 路径表达式\t| 结果 |\n| :--- | :---- |\n| /bookstore/book[1]\t| 选取属于 bookstore 子元素的第一个 book 元素。 |\n| /bookstore/book[last()]\t| 选取属于 bookstore 子元素的最后一个 book 元素。 |\n| /bookstore/book[last()-1]\t| 选取属于 bookstore 子元素的倒数第二个 book 元素。 |\n| /bookstore/book[position()<3]\t| 选取最前面的两个属于 bookstore 元素的子元素的 book 元素。 |\n| //title[@lang]\t| 选取所有拥有名为 lang 的属性的 title 元素。 |\n| //title[@lang='eng']\t| 选取所有 title 元素，且这些元素拥有值为 eng 的 lang 属性。 |\n| /bookstore/book[price>35.00]\t| 选取 bookstore 元素的所有 book 元素，且其中的 price 元素的值须大于 35.00。 |\n| /bookstore/book[price>35.00]/title\t| 选取 bookstore 元素中的 book 元素的所有 title 元素，且其中的 price 元素的值须大于 35.00。 |\n\n### 选取未知节点\n\n`XPath` 通配符可用来选取未知的 `XML` 元素。\n\n| 通配符\t| 描述 |\n| :--- | :---- |\n| *\t| 匹配任何元素节点。 |\n| @*\t| 匹配任何属性节点。 |\n| node()\t| 匹配任何类型的节点。 |\n\n**实例**\n\n在下面的表格中，列出了一些路径表达式，以及这些表达式的结果：\n\n| 路径表达式\t| 结果 |\n| :--- | :---- |\n| /bookstore/*\t| 选取 bookstore 元素的所有子元素。 |\n| //*\t| 选取文档中的所有元素。 |\n| //title[@*] | 选取所有带有属性的 title 元素。 |\n\n### 选取若干路径\n\n通过在路径表达式中使用“|”运算符，您可以选取若干个路径。\n\n**实例**\n在下面的表格中，我们列出了一些路径表达式，以及这些表达式的结果：\n\n| 路径表达式\t| 结果 |\n| :----- | :---- |\n| //book/title \\| //book/price\t|选取 book 元素的所有 title 和 price 元素。 |\n| //title \\| //price\t| 选取文档中的所有 title 和 price 元素。 |\n| /bookstore/book/title \\| //price\t| 选取属于 bookstore 元素的 book 元素的所有 title 元素，以及文档中所有的 price 元素。 |\n\n## XPath 实例\n\n对`xml`文档的匹配。\n\n```python\n# coding: utf-8\nfrom lxml import etree\n\ntree = etree.XML(xml,)\nresult = tree.xpath(\"/bookstore/book/title/text()\")\n# ['Everyday Italian', 'Harry Potter', 'XQuery Kick Start', 'Learning XML']\n\nresult = tree.xpath(\"//book[3]/author[2]/text()\")\n# ['Per Bothner']\n```\n\n对`html`文档的匹配。\n\n```html\n<div>\n    <ul>\n        <li class=\"item-0\"><a href=\"link1.html\">first item</a></li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n        <li class=\"item-inactive\"><a href=\"link3.html\">third item</a></li>\n        <li class=\"item-1\"><a href=\"link4.html\">fourth item</a></li>\n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a>\n    </ul>\n</div>\n```\n\n引入`xlxml`模块， 从文件中导入`html`。\n\n```python\nfrom lxml import etree\n\ntree = etree.parse('./test.html', etree.HTMLParser())\n```\n\n### 通过字符串转换成html格式\n\n利用`etree.HTML`解析字符串，将字符串解析从`html`格式的文件， 经过处理后，部分缺失的节点可以自动修复，并且还自动添加了 `body`、`html` 节点。\n\n```python\nfrom lxml import etree\n\ntext = \"\"\"\n<html>\n    <body>\n        <div>\n            <ul>\n                <li class=\"item-0\"><a href=\"link1.html\">first item</a></li>\n                <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n                <li class=\"item-inactive\"><a href=\"link3.html\">third item</a></li>\n                <li class=\"item-1\"><a href=\"link4.html\">fourth item</a></li>\n                <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n            </ul>\n        </div>\n    </body>\n</html>\n\"\"\"\n\nhtml = etree.HTML(text)\ns = etree.tostring(html).decode()\nprint(s)\n\n# <html>\n#     <body>\n#         <div>\n#             <ul>\n#                 <li class=\"item-0\"><a href=\"link1.html\">first item</a></li>\n#                 <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n#                 <li class=\"item-inactive\"><a href=\"link3.html\">third item</a></li>\n#                 <li class=\"item-1\"><a href=\"link4.html\">fourth item</a></li>\n#                 <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n#             </ul>\n#         </div>\n#     </body>\n# </html>\n```\n\n### 所有节点\n\n用以 `//` 开头的 `XPath` 规则来选取所有符合要求的字符串：\n\n```python\nresult = html.xpath(\"//text()\")\n# ['\\n    ', '\\n        ', '\\n            ', '\\n                ', 'first item', '\\n                ', 'second item', '\\n                ', 'third item', '\\n\n#       ', 'fourth item', '\\n                ', 'fifth item', '\\n            ', '\\n        ', '\\n    ', '\\n']\n```\n\n### 绝对路径查找\n\n- 获取某个标签的内容\n\n注意，获取`a`标签的所有内容，`a`后面就不用再加正斜杠，否则报错。\n\n```python\nresult = html.xpath(\"/html/body/div/ul/li/a\")\nfor i in result:\n    print(i.text)\n\n# first item\n# second item\n# third item\n# fourth item\n# fifth item\n```\n\n或者\n\n```python\nresult = html.xpath(\"/html/body/div/ul/li/a/text()\")\nfor i in result:\n    print(i)\n\nfirst item\nsecond item\nthird item\nfourth item\nfifth item\n```\n\n- 打印指定路径下a标签的属性\n\n这里可以通过遍历拿到某个属性的值，查找标签的内容，通过`@属性名`获取。\n\n```python\nresult = html.xpath(\"/html/body/div/ul/li/a/@href\")\nfor i in result:\n    print(i)\n\n# link1.html\n# link2.html\n# link3.html\n# link4.html\n# link5.html\n```\n\n- 获取指定标签对应属性值的内容\n\n使用`xpath`拿到得都是一个个的`ElementTree`对象，如果需要查找内容的话，还需要遍历拿到数据的列表。\n\n```python\nresult = html.xpath('/html/body/div/ul/li/a[@href=\"link3.html\"]/text()')\nfor i in result:\n    print(i)\n\n# third item\n```\n\n## 相对路径查找（常用）\n\n- 查找所有li标签下的a标签内容\n\n```python\nresult = html.xpath('//li/a/text()')\nprint(result)\n# ['first item', 'second item', 'third item', 'fourth item', 'fifth item']\n```\n\n- 查找一下l相对路径下li标签下的a标签下的href属性的值\n\n注意，`a`标签后面需要双`//`。\n\n```python\nresult = html.xpath('//li/a/@href')\nprint(result)\n```\n\n- 查找`a`标签下属性`href`值为`link5.html`的内容。\n\n```python\nresult = html.xpath('//li/a/@href')\nprint(result)\n```\n\n- 查找`a`标签下属性`href`值为\"\"的内容。\n\n```python\nresult = html.xpath('//li/a[@href=\"link5.html\"]/text()')\nprint(result)\n\n# ['fifth item']\n```\n\n## 子节点\n\n通过 `/` 或 `//` 即可查找元素的子节点或子孙节点，选择 `li` 节点的所有直接 `a` 子节点`xpath`为：`//li/a`。\n\n## 父节点\n\n知道子节点，查询父节点可以用 `..` 来实现。\n\n```python\nresult = html.xpath('//li/a[@href=\"link5.html\"]/../@class')\nprint(result)\n# ['item-0']\n```\n\n## 属性匹配\n\n匹配时可以用`@`符号进行属性过滤，匹配`li`下属性`class`为`item-5`的内容。\n\n```python\nresult = html.xpath('//li/a[@href=\"link5.html\"]/../@class')\nprint(result)\n# ['item-0']\n```\n\n## 文本获取\n\n有两种方法：一是获取文本所在节点后直接获取文本，二是使用 `//`。第二种方法会获取到补全代码时换行产生的特殊字符，推荐使用第一种方法，可以保证获取的结果是整洁的。\n\n```python\n# first\nresult = html.xpath('//li[@class=\"item-0\"]/a/text()')\nprint(result)\n# ['first item', 'fifth item']\n\n# second\nresult = html.xpath('//li[@class=\"item-0\"]//text()')\nprint(result)\n# ['first item', 'fifth item']\n```\n\n## 属性获取\n\n`@`符号相当于过滤器，可以直接获取节点的属性值。\n\n```python\nresult = html.xpath('//li/a/@href')\nprint(result)\n# ['link1.html', 'link2.html', 'link3.html', 'link4.html', 'link5.html']\n```\n\n## 属性多值匹配\n\n某些节点的某个属性可能有多个值：\n\n```python\nfrom lxml import etree\n\ntext = '''\n<li class=\"zxc  asd  wer\"><a href=\"https://s2.bdstatic.com/\">1 item</a></li>\n<li class=\"ddd  asd  eee\"><a href=\"https://s3.bdstatic.com/\">2 item</a></li>\n'''\n\nhtml = etree.HTML(text)\nresult = html.xpath('//li[contains(@class, \"asd\")]/a/text()')\nprint(result)\n\n# ['1 item', '2 item']\n```\n\n## 多属性匹配\n\n```python\nfrom lxml import etree\n\ntext = '''\n<li class=\"zxc  asd  wer\" name=\"222\"><a href=\"https://s2.bdstatic.com/\">1 item</a></li>\n<li class=\"ddd  zxc  eee\" name=\"111\"><a href=\"https://s3.bdstatic.com/\">2 item</a></li>\n'''\nhtml = etree.HTML(text)\nresult = html.xpath('//li[contains(@class, \"zxc\") and @name=\"111\"]/a/text()')\nprint(result)\n\n# 运行结果：['2 item']\n```\n\n## 函数\n\n查找最后一个`li`标签里的`a`标签的`href`属性（`last()函数`）\n\n```python\nfrom lxml import etree\n\ntext = '''\n<li class=\"zxc  asd  wer\"><a href=\"https://s2.bdstatic.com/\">1 item</a></li>\n<li class=\"ddd  asd  eee\"><a href=\"https://s3.bdstatic.com/\">2 item</a></li>\n'''\nhtml = etree.HTML(text)\nresult = html.xpath('//li[last()]/a/text()')\nprint(result)\n# ['2 item']\n```\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>","slug":"XPath库解析","published":1,"updated":"2021-06-17T11:47:41.880Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2c001i44udb2h8161p","content":"<p><code>XPath</code>，全称 <code>XML Path Language</code>，即 <code>XML</code> 路径语言，它是一门在<em>XML文档</em>中查找信息的语言。<code>XPath</code> 最初设计是用来搜寻<em>XML文档</em>的，<code>HTML</code>是<code>XML</code>的子集，它同样适用于<em>HTML文档</em>的搜索。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install lxml</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"XPath-术语\"><a href=\"#XPath-术语\" class=\"headerlink\" title=\"XPath 术语\"></a>XPath 术语</h2><h3 id=\"节点（Node）\"><a href=\"#节点（Node）\" class=\"headerlink\" title=\"节点（Node）\"></a>节点（Node）</h3><p>在 <code>XPath</code> 中，有七种类型的节点：<em>元素</em>、<em>属性</em>、<em>文本</em>、<em>命名空间</em>、<em>处理指令</em>、<em>注释</em>以及<em>文档节点（或称为根节点）</em>。</p>\n<p>请看下面这个 <code>XML</code> 文档：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bookstore</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span>Harry Potter<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>29.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bookstore</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>上面的<code>XML</code>文档中的节点例子：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bookstore</span>&gt;</span> （文档节点）</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span> （元素节点）</span><br><span class=\"line\">lang=&quot;en&quot; （属性节点） </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"基本值（或称原子值，Atomic-value）\"><a href=\"#基本值（或称原子值，Atomic-value）\" class=\"headerlink\" title=\"基本值（或称原子值，Atomic value）\"></a>基本值（或称原子值，Atomic value）</h4><p>基本值是无父或无子的节点。</p>\n<p>基本值的例子：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">J K. Rowling</span><br><span class=\"line\">&quot;en&quot;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"项目（Item）\"><a href=\"#项目（Item）\" class=\"headerlink\" title=\"项目（Item）\"></a>项目（Item）</h4><p>项目是基本值或者节点。</p>\n<h3 id=\"节点关系\"><a href=\"#节点关系\" class=\"headerlink\" title=\"节点关系\"></a>节点关系</h3><h4 id=\"父（Parent）\"><a href=\"#父（Parent）\" class=\"headerlink\" title=\"父（Parent）\"></a>父（Parent）</h4><p>每个元素以及属性都有一个父。</p>\n<p>在下面的例子中，<code>book</code> 元素是 <code>title</code>、<code>author</code>、<code>year</code> 以及 <code>price</code> 元素的父：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Harry Potter<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>29.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"子（Children）\"><a href=\"#子（Children）\" class=\"headerlink\" title=\"子（Children）\"></a>子（Children）</h4><p>元素节点可有零个、一个或多个子。</p>\n<p>在下面的例子中，<code>title</code>、<code>author</code>、<code>year</code> 以及 <code>price</code> 元素都是 <code>book</code> 元素的子：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Harry Potter<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>29.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"同胞（Sibling）\"><a href=\"#同胞（Sibling）\" class=\"headerlink\" title=\"同胞（Sibling）\"></a>同胞（Sibling）</h4><p>拥有相同的父的节点</p>\n<p>在下面的例子中，<code>title</code>、<code>author</code>、<code>year</code> 以及 <code>price</code> 元素都是同胞：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Harry Potter<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>29.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"先辈（Ancestor）\"><a href=\"#先辈（Ancestor）\" class=\"headerlink\" title=\"先辈（Ancestor）\"></a>先辈（Ancestor）</h4><p>某节点的父、父的父，等等。</p>\n<p>在下面的例子中，<code>title</code> 元素的先辈是 <code>book</code> 元素和 <code>bookstore</code> 元素：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bookstore</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Harry Potter<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>29.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bookstore</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"后代（Descendant）\"><a href=\"#后代（Descendant）\" class=\"headerlink\" title=\"后代（Descendant）\"></a>后代（Descendant）</h4><p>某个节点的子，子的子，等等。</p>\n<p>在下面的例子中，<code>bookstore </code>的后代是 <code>book</code>、<code>title</code>、<code>author</code>、<code>year</code> 以及 <code>price</code> 元素：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bookstore</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Harry Potter<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>29.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bookstore</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"XPath-语法\"><a href=\"#XPath-语法\" class=\"headerlink\" title=\"XPath 语法\"></a>XPath 语法</h2><p>目标实列：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bookstore</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span> <span class=\"attr\">category</span>=<span class=\"string\">&quot;COOKING&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span>Everyday Italian<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>Giada De Laurentiis<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>30.00<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span> <span class=\"attr\">category</span>=<span class=\"string\">&quot;CHILDREN&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span>Harry Potter<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>29.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span> <span class=\"attr\">category</span>=<span class=\"string\">&quot;WEB&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span>XQuery Kick Start<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>James McGovern<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>Per Bothner<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>Kurt Cagle<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>James Linn<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>Vaidyanathan Nagarajan<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2003<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>49.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span> <span class=\"attr\">category</span>=<span class=\"string\">&quot;WEB&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span>Learning XML<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>Erik T. Ray<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2003<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>39.95<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bookstore</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"选取节点\"><a href=\"#选取节点\" class=\"headerlink\" title=\"选取节点\"></a>选取节点</h3><p><code>XPath</code> 使用路径表达式在 <code>XML</code> 文档中选取节点。节点是通过沿着路径或者 <code>step</code> 来选取的。</p>\n<p>下面列出了最有用的路径表达式：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">表达式</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">nodename</td>\n<td align=\"left\">选取此节点的所有子节点。</td>\n</tr>\n<tr>\n<td align=\"left\">/</td>\n<td align=\"left\">从根节点选取。</td>\n</tr>\n<tr>\n<td align=\"left\">//</td>\n<td align=\"left\">从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。</td>\n</tr>\n<tr>\n<td align=\"left\">.</td>\n<td align=\"left\">选取当前节点。</td>\n</tr>\n<tr>\n<td align=\"left\">..</td>\n<td align=\"left\">选取当前节点的父节点。</td>\n</tr>\n<tr>\n<td align=\"left\">@</td>\n<td align=\"left\">选取属性。</td>\n</tr>\n</tbody></table>\n<p><strong>实例</strong></p>\n<p>在下面的表格中，列出了一些路径表达式以及表达式的结果：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">路径表达式</th>\n<th align=\"left\">结果</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">bookstore</td>\n<td align=\"left\">选取 bookstore 元素的所有子节点。</td>\n</tr>\n<tr>\n<td align=\"left\">/bookstore</td>\n<td align=\"left\">选取根元素 bookstore。<br>注释：假如路径起始于正斜杠( / )，则此路径始终代表到某元素的绝对路径！</td>\n</tr>\n<tr>\n<td align=\"left\">bookstore/book</td>\n<td align=\"left\">选取属于 bookstore 的子元素的所有 book 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">//book</td>\n<td align=\"left\">选取所有 book 子元素，而不管它们在文档中的位置。</td>\n</tr>\n<tr>\n<td align=\"left\">bookstore//book</td>\n<td align=\"left\">选择属于 bookstore 元素的后代的所有 book 元素，而不管它们位于 bookstore 之下的什么位置。</td>\n</tr>\n<tr>\n<td align=\"left\">//@lang</td>\n<td align=\"left\">选取名为 lang 的所有属性。</td>\n</tr>\n</tbody></table>\n<h3 id=\"谓语（Predicates）\"><a href=\"#谓语（Predicates）\" class=\"headerlink\" title=\"谓语（Predicates）\"></a>谓语（Predicates）</h3><p>谓语用来查找某个特定的节点或者包含某个指定的值的节点。</p>\n<p>谓语被嵌在方括号中。</p>\n<p><strong>实例</strong><br>在下面的表格中，我们列出了带有谓语的一些路径表达式，以及表达式的结果：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">路径表达式</th>\n<th align=\"left\">结果</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">/bookstore/book[1]</td>\n<td align=\"left\">选取属于 bookstore 子元素的第一个 book 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">/bookstore/book[last()]</td>\n<td align=\"left\">选取属于 bookstore 子元素的最后一个 book 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">/bookstore/book[last()-1]</td>\n<td align=\"left\">选取属于 bookstore 子元素的倒数第二个 book 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">/bookstore/book[position()&lt;3]</td>\n<td align=\"left\">选取最前面的两个属于 bookstore 元素的子元素的 book 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">//title[@lang]</td>\n<td align=\"left\">选取所有拥有名为 lang 的属性的 title 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">//title[@lang=’eng’]</td>\n<td align=\"left\">选取所有 title 元素，且这些元素拥有值为 eng 的 lang 属性。</td>\n</tr>\n<tr>\n<td align=\"left\">/bookstore/book[price&gt;35.00]</td>\n<td align=\"left\">选取 bookstore 元素的所有 book 元素，且其中的 price 元素的值须大于 35.00。</td>\n</tr>\n<tr>\n<td align=\"left\">/bookstore/book[price&gt;35.00]/title</td>\n<td align=\"left\">选取 bookstore 元素中的 book 元素的所有 title 元素，且其中的 price 元素的值须大于 35.00。</td>\n</tr>\n</tbody></table>\n<h3 id=\"选取未知节点\"><a href=\"#选取未知节点\" class=\"headerlink\" title=\"选取未知节点\"></a>选取未知节点</h3><p><code>XPath</code> 通配符可用来选取未知的 <code>XML</code> 元素。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">通配符</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">*</td>\n<td align=\"left\">匹配任何元素节点。</td>\n</tr>\n<tr>\n<td align=\"left\">@*</td>\n<td align=\"left\">匹配任何属性节点。</td>\n</tr>\n<tr>\n<td align=\"left\">node()</td>\n<td align=\"left\">匹配任何类型的节点。</td>\n</tr>\n</tbody></table>\n<p><strong>实例</strong></p>\n<p>在下面的表格中，列出了一些路径表达式，以及这些表达式的结果：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">路径表达式</th>\n<th align=\"left\">结果</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">/bookstore/*</td>\n<td align=\"left\">选取 bookstore 元素的所有子元素。</td>\n</tr>\n<tr>\n<td align=\"left\">//*</td>\n<td align=\"left\">选取文档中的所有元素。</td>\n</tr>\n<tr>\n<td align=\"left\">//title[@*]</td>\n<td align=\"left\">选取所有带有属性的 title 元素。</td>\n</tr>\n</tbody></table>\n<h3 id=\"选取若干路径\"><a href=\"#选取若干路径\" class=\"headerlink\" title=\"选取若干路径\"></a>选取若干路径</h3><p>通过在路径表达式中使用“|”运算符，您可以选取若干个路径。</p>\n<p><strong>实例</strong><br>在下面的表格中，我们列出了一些路径表达式，以及这些表达式的结果：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">路径表达式</th>\n<th align=\"left\">结果</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">//book/title | //book/price</td>\n<td align=\"left\">选取 book 元素的所有 title 和 price 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">//title | //price</td>\n<td align=\"left\">选取文档中的所有 title 和 price 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">/bookstore/book/title | //price</td>\n<td align=\"left\">选取属于 bookstore 元素的 book 元素的所有 title 元素，以及文档中所有的 price 元素。</td>\n</tr>\n</tbody></table>\n<h2 id=\"XPath-实例\"><a href=\"#XPath-实例\" class=\"headerlink\" title=\"XPath 实例\"></a>XPath 实例</h2><p>对<code>xml</code>文档的匹配。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># coding: utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> lxml <span class=\"keyword\">import</span> etree</span><br><span class=\"line\"></span><br><span class=\"line\">tree = etree.XML(xml,)</span><br><span class=\"line\">result = tree.xpath(<span class=\"string\">&quot;/bookstore/book/title/text()&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;Everyday Italian&#x27;, &#x27;Harry Potter&#x27;, &#x27;XQuery Kick Start&#x27;, &#x27;Learning XML&#x27;]</span></span><br><span class=\"line\"></span><br><span class=\"line\">result = tree.xpath(<span class=\"string\">&quot;//book[3]/author[2]/text()&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;Per Bothner&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<p>对<code>html</code>文档的匹配。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;item-0&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;link1.html&quot;</span>&gt;</span>first item<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;item-1&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;link2.html&quot;</span>&gt;</span>second item<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;item-inactive&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;link3.html&quot;</span>&gt;</span>third item<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;item-1&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;link4.html&quot;</span>&gt;</span>fourth item<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;item-0&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;link5.html&quot;</span>&gt;</span>fifth item<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>引入<code>xlxml</code>模块， 从文件中导入<code>html</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> lxml <span class=\"keyword\">import</span> etree</span><br><span class=\"line\"></span><br><span class=\"line\">tree = etree.parse(<span class=\"string\">&#x27;./test.html&#x27;</span>, etree.HTMLParser())</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"通过字符串转换成html格式\"><a href=\"#通过字符串转换成html格式\" class=\"headerlink\" title=\"通过字符串转换成html格式\"></a>通过字符串转换成html格式</h3><p>利用<code>etree.HTML</code>解析字符串，将字符串解析从<code>html</code>格式的文件， 经过处理后，部分缺失的节点可以自动修复，并且还自动添加了 <code>body</code>、<code>html</code> 节点。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> lxml <span class=\"keyword\">import</span> etree</span><br><span class=\"line\"></span><br><span class=\"line\">text = <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">&lt;html&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;body&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;div&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">                &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link1.html&quot;&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">                &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">                &lt;li class=&quot;item-inactive&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;third item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">                &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">                &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/body&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/html&gt;</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">html = etree.HTML(text)</span><br><span class=\"line\">s = etree.tostring(html).decode()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(s)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># &lt;html&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#     &lt;body&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#         &lt;div&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#             &lt;ul&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#                 &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link1.html&quot;&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#                 &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#                 &lt;li class=&quot;item-inactive&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;third item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#                 &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#                 &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#             &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#         &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#     &lt;/body&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;/html&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"所有节点\"><a href=\"#所有节点\" class=\"headerlink\" title=\"所有节点\"></a>所有节点</h3><p>用以 <code>//</code> 开头的 <code>XPath</code> 规则来选取所有符合要求的字符串：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&quot;//text()&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;\\n    &#x27;, &#x27;\\n        &#x27;, &#x27;\\n            &#x27;, &#x27;\\n                &#x27;, &#x27;first item&#x27;, &#x27;\\n                &#x27;, &#x27;second item&#x27;, &#x27;\\n                &#x27;, &#x27;third item&#x27;, &#x27;\\n</span></span><br><span class=\"line\"><span class=\"comment\">#       &#x27;, &#x27;fourth item&#x27;, &#x27;\\n                &#x27;, &#x27;fifth item&#x27;, &#x27;\\n            &#x27;, &#x27;\\n        &#x27;, &#x27;\\n    &#x27;, &#x27;\\n&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"绝对路径查找\"><a href=\"#绝对路径查找\" class=\"headerlink\" title=\"绝对路径查找\"></a>绝对路径查找</h3><ul>\n<li>获取某个标签的内容</li>\n</ul>\n<p>注意，获取<code>a</code>标签的所有内容，<code>a</code>后面就不用再加正斜杠，否则报错。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&quot;/html/body/div/ul/li/a&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> result:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(i.text)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># first item</span></span><br><span class=\"line\"><span class=\"comment\"># second item</span></span><br><span class=\"line\"><span class=\"comment\"># third item</span></span><br><span class=\"line\"><span class=\"comment\"># fourth item</span></span><br><span class=\"line\"><span class=\"comment\"># fifth item</span></span><br></pre></td></tr></table></figure>\n\n<p>或者</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&quot;/html/body/div/ul/li/a/text()&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> result:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(i)</span><br><span class=\"line\"></span><br><span class=\"line\">first item</span><br><span class=\"line\">second item</span><br><span class=\"line\">third item</span><br><span class=\"line\">fourth item</span><br><span class=\"line\">fifth item</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>打印指定路径下a标签的属性</li>\n</ul>\n<p>这里可以通过遍历拿到某个属性的值，查找标签的内容，通过<code>@属性名</code>获取。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&quot;/html/body/div/ul/li/a/@href&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> result:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(i)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># link1.html</span></span><br><span class=\"line\"><span class=\"comment\"># link2.html</span></span><br><span class=\"line\"><span class=\"comment\"># link3.html</span></span><br><span class=\"line\"><span class=\"comment\"># link4.html</span></span><br><span class=\"line\"><span class=\"comment\"># link5.html</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>获取指定标签对应属性值的内容</li>\n</ul>\n<p>使用<code>xpath</code>拿到得都是一个个的<code>ElementTree</code>对象，如果需要查找内容的话，还需要遍历拿到数据的列表。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;/html/body/div/ul/li/a[@href=&quot;link3.html&quot;]/text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> result:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(i)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># third item</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"相对路径查找（常用）\"><a href=\"#相对路径查找（常用）\" class=\"headerlink\" title=\"相对路径查找（常用）\"></a>相对路径查找（常用）</h2><ul>\n<li>查找所有li标签下的a标签内容</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li/a/text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;first item&#x27;, &#x27;second item&#x27;, &#x27;third item&#x27;, &#x27;fourth item&#x27;, &#x27;fifth item&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>查找一下l相对路径下li标签下的a标签下的href属性的值</li>\n</ul>\n<p>注意，<code>a</code>标签后面需要双<code>//</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li/a/@href&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>查找<code>a</code>标签下属性<code>href</code>值为<code>link5.html</code>的内容。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li/a/@href&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>查找<code>a</code>标签下属性<code>href</code>值为””的内容。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li/a[@href=&quot;link5.html&quot;]/text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># [&#x27;fifth item&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"子节点\"><a href=\"#子节点\" class=\"headerlink\" title=\"子节点\"></a>子节点</h2><p>通过 <code>/</code> 或 <code>//</code> 即可查找元素的子节点或子孙节点，选择 <code>li</code> 节点的所有直接 <code>a</code> 子节点<code>xpath</code>为：<code>//li/a</code>。</p>\n<h2 id=\"父节点\"><a href=\"#父节点\" class=\"headerlink\" title=\"父节点\"></a>父节点</h2><p>知道子节点，查询父节点可以用 <code>..</code> 来实现。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li/a[@href=&quot;link5.html&quot;]/../@class&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;item-0&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"属性匹配\"><a href=\"#属性匹配\" class=\"headerlink\" title=\"属性匹配\"></a>属性匹配</h2><p>匹配时可以用<code>@</code>符号进行属性过滤，匹配<code>li</code>下属性<code>class</code>为<code>item-5</code>的内容。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li/a[@href=&quot;link5.html&quot;]/../@class&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;item-0&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"文本获取\"><a href=\"#文本获取\" class=\"headerlink\" title=\"文本获取\"></a>文本获取</h2><p>有两种方法：一是获取文本所在节点后直接获取文本，二是使用 <code>//</code>。第二种方法会获取到补全代码时换行产生的特殊字符，推荐使用第一种方法，可以保证获取的结果是整洁的。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># first</span></span><br><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li[@class=&quot;item-0&quot;]/a/text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;first item&#x27;, &#x27;fifth item&#x27;]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># second</span></span><br><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li[@class=&quot;item-0&quot;]//text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;first item&#x27;, &#x27;fifth item&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"属性获取\"><a href=\"#属性获取\" class=\"headerlink\" title=\"属性获取\"></a>属性获取</h2><p><code>@</code>符号相当于过滤器，可以直接获取节点的属性值。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li/a/@href&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;link1.html&#x27;, &#x27;link2.html&#x27;, &#x27;link3.html&#x27;, &#x27;link4.html&#x27;, &#x27;link5.html&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"属性多值匹配\"><a href=\"#属性多值匹配\" class=\"headerlink\" title=\"属性多值匹配\"></a>属性多值匹配</h2><p>某些节点的某个属性可能有多个值：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> lxml <span class=\"keyword\">import</span> etree</span><br><span class=\"line\"></span><br><span class=\"line\">text = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;li class=&quot;zxc  asd  wer&quot;&gt;&lt;a href=&quot;https://s2.bdstatic.com/&quot;&gt;1 item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;li class=&quot;ddd  asd  eee&quot;&gt;&lt;a href=&quot;https://s3.bdstatic.com/&quot;&gt;2 item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">html = etree.HTML(text)</span><br><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li[contains(@class, &quot;asd&quot;)]/a/text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># [&#x27;1 item&#x27;, &#x27;2 item&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"多属性匹配\"><a href=\"#多属性匹配\" class=\"headerlink\" title=\"多属性匹配\"></a>多属性匹配</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> lxml <span class=\"keyword\">import</span> etree</span><br><span class=\"line\"></span><br><span class=\"line\">text = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;li class=&quot;zxc  asd  wer&quot; name=&quot;222&quot;&gt;&lt;a href=&quot;https://s2.bdstatic.com/&quot;&gt;1 item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;li class=&quot;ddd  zxc  eee&quot; name=&quot;111&quot;&gt;&lt;a href=&quot;https://s3.bdstatic.com/&quot;&gt;2 item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\">html = etree.HTML(text)</span><br><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li[contains(@class, &quot;zxc&quot;) and @name=&quot;111&quot;]/a/text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 运行结果：[&#x27;2 item&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a>函数</h2><p>查找最后一个<code>li</code>标签里的<code>a</code>标签的<code>href</code>属性（<code>last()函数</code>）</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> lxml <span class=\"keyword\">import</span> etree</span><br><span class=\"line\"></span><br><span class=\"line\">text = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;li class=&quot;zxc  asd  wer&quot;&gt;&lt;a href=&quot;https://s2.bdstatic.com/&quot;&gt;1 item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;li class=&quot;ddd  asd  eee&quot;&gt;&lt;a href=&quot;https://s3.bdstatic.com/&quot;&gt;2 item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\">html = etree.HTML(text)</span><br><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li[last()]/a/text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;2 item&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>","site":{"data":{}},"excerpt":"","more":"<p><code>XPath</code>，全称 <code>XML Path Language</code>，即 <code>XML</code> 路径语言，它是一门在<em>XML文档</em>中查找信息的语言。<code>XPath</code> 最初设计是用来搜寻<em>XML文档</em>的，<code>HTML</code>是<code>XML</code>的子集，它同样适用于<em>HTML文档</em>的搜索。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install lxml</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"XPath-术语\"><a href=\"#XPath-术语\" class=\"headerlink\" title=\"XPath 术语\"></a>XPath 术语</h2><h3 id=\"节点（Node）\"><a href=\"#节点（Node）\" class=\"headerlink\" title=\"节点（Node）\"></a>节点（Node）</h3><p>在 <code>XPath</code> 中，有七种类型的节点：<em>元素</em>、<em>属性</em>、<em>文本</em>、<em>命名空间</em>、<em>处理指令</em>、<em>注释</em>以及<em>文档节点（或称为根节点）</em>。</p>\n<p>请看下面这个 <code>XML</code> 文档：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bookstore</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span>Harry Potter<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>29.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bookstore</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>上面的<code>XML</code>文档中的节点例子：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bookstore</span>&gt;</span> （文档节点）</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span> （元素节点）</span><br><span class=\"line\">lang=&quot;en&quot; （属性节点） </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"基本值（或称原子值，Atomic-value）\"><a href=\"#基本值（或称原子值，Atomic-value）\" class=\"headerlink\" title=\"基本值（或称原子值，Atomic value）\"></a>基本值（或称原子值，Atomic value）</h4><p>基本值是无父或无子的节点。</p>\n<p>基本值的例子：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">J K. Rowling</span><br><span class=\"line\">&quot;en&quot;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"项目（Item）\"><a href=\"#项目（Item）\" class=\"headerlink\" title=\"项目（Item）\"></a>项目（Item）</h4><p>项目是基本值或者节点。</p>\n<h3 id=\"节点关系\"><a href=\"#节点关系\" class=\"headerlink\" title=\"节点关系\"></a>节点关系</h3><h4 id=\"父（Parent）\"><a href=\"#父（Parent）\" class=\"headerlink\" title=\"父（Parent）\"></a>父（Parent）</h4><p>每个元素以及属性都有一个父。</p>\n<p>在下面的例子中，<code>book</code> 元素是 <code>title</code>、<code>author</code>、<code>year</code> 以及 <code>price</code> 元素的父：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Harry Potter<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>29.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"子（Children）\"><a href=\"#子（Children）\" class=\"headerlink\" title=\"子（Children）\"></a>子（Children）</h4><p>元素节点可有零个、一个或多个子。</p>\n<p>在下面的例子中，<code>title</code>、<code>author</code>、<code>year</code> 以及 <code>price</code> 元素都是 <code>book</code> 元素的子：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Harry Potter<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>29.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"同胞（Sibling）\"><a href=\"#同胞（Sibling）\" class=\"headerlink\" title=\"同胞（Sibling）\"></a>同胞（Sibling）</h4><p>拥有相同的父的节点</p>\n<p>在下面的例子中，<code>title</code>、<code>author</code>、<code>year</code> 以及 <code>price</code> 元素都是同胞：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Harry Potter<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>29.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"先辈（Ancestor）\"><a href=\"#先辈（Ancestor）\" class=\"headerlink\" title=\"先辈（Ancestor）\"></a>先辈（Ancestor）</h4><p>某节点的父、父的父，等等。</p>\n<p>在下面的例子中，<code>title</code> 元素的先辈是 <code>book</code> 元素和 <code>bookstore</code> 元素：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bookstore</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Harry Potter<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>29.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bookstore</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"后代（Descendant）\"><a href=\"#后代（Descendant）\" class=\"headerlink\" title=\"后代（Descendant）\"></a>后代（Descendant）</h4><p>某个节点的子，子的子，等等。</p>\n<p>在下面的例子中，<code>bookstore </code>的后代是 <code>book</code>、<code>title</code>、<code>author</code>、<code>year</code> 以及 <code>price</code> 元素：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bookstore</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Harry Potter<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>29.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bookstore</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"XPath-语法\"><a href=\"#XPath-语法\" class=\"headerlink\" title=\"XPath 语法\"></a>XPath 语法</h2><p>目标实列：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bookstore</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span> <span class=\"attr\">category</span>=<span class=\"string\">&quot;COOKING&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span>Everyday Italian<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>Giada De Laurentiis<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>30.00<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span> <span class=\"attr\">category</span>=<span class=\"string\">&quot;CHILDREN&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span>Harry Potter<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>J K. Rowling<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2005<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>29.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span> <span class=\"attr\">category</span>=<span class=\"string\">&quot;WEB&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span>XQuery Kick Start<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>James McGovern<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>Per Bothner<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>Kurt Cagle<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>James Linn<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>Vaidyanathan Nagarajan<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2003<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>49.99<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">book</span> <span class=\"attr\">category</span>=<span class=\"string\">&quot;WEB&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span>Learning XML<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">author</span>&gt;</span>Erik T. Ray<span class=\"tag\">&lt;/<span class=\"name\">author</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">year</span>&gt;</span>2003<span class=\"tag\">&lt;/<span class=\"name\">year</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">price</span>&gt;</span>39.95<span class=\"tag\">&lt;/<span class=\"name\">price</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">book</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bookstore</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"选取节点\"><a href=\"#选取节点\" class=\"headerlink\" title=\"选取节点\"></a>选取节点</h3><p><code>XPath</code> 使用路径表达式在 <code>XML</code> 文档中选取节点。节点是通过沿着路径或者 <code>step</code> 来选取的。</p>\n<p>下面列出了最有用的路径表达式：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">表达式</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">nodename</td>\n<td align=\"left\">选取此节点的所有子节点。</td>\n</tr>\n<tr>\n<td align=\"left\">/</td>\n<td align=\"left\">从根节点选取。</td>\n</tr>\n<tr>\n<td align=\"left\">//</td>\n<td align=\"left\">从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。</td>\n</tr>\n<tr>\n<td align=\"left\">.</td>\n<td align=\"left\">选取当前节点。</td>\n</tr>\n<tr>\n<td align=\"left\">..</td>\n<td align=\"left\">选取当前节点的父节点。</td>\n</tr>\n<tr>\n<td align=\"left\">@</td>\n<td align=\"left\">选取属性。</td>\n</tr>\n</tbody></table>\n<p><strong>实例</strong></p>\n<p>在下面的表格中，列出了一些路径表达式以及表达式的结果：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">路径表达式</th>\n<th align=\"left\">结果</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">bookstore</td>\n<td align=\"left\">选取 bookstore 元素的所有子节点。</td>\n</tr>\n<tr>\n<td align=\"left\">/bookstore</td>\n<td align=\"left\">选取根元素 bookstore。<br>注释：假如路径起始于正斜杠( / )，则此路径始终代表到某元素的绝对路径！</td>\n</tr>\n<tr>\n<td align=\"left\">bookstore/book</td>\n<td align=\"left\">选取属于 bookstore 的子元素的所有 book 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">//book</td>\n<td align=\"left\">选取所有 book 子元素，而不管它们在文档中的位置。</td>\n</tr>\n<tr>\n<td align=\"left\">bookstore//book</td>\n<td align=\"left\">选择属于 bookstore 元素的后代的所有 book 元素，而不管它们位于 bookstore 之下的什么位置。</td>\n</tr>\n<tr>\n<td align=\"left\">//@lang</td>\n<td align=\"left\">选取名为 lang 的所有属性。</td>\n</tr>\n</tbody></table>\n<h3 id=\"谓语（Predicates）\"><a href=\"#谓语（Predicates）\" class=\"headerlink\" title=\"谓语（Predicates）\"></a>谓语（Predicates）</h3><p>谓语用来查找某个特定的节点或者包含某个指定的值的节点。</p>\n<p>谓语被嵌在方括号中。</p>\n<p><strong>实例</strong><br>在下面的表格中，我们列出了带有谓语的一些路径表达式，以及表达式的结果：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">路径表达式</th>\n<th align=\"left\">结果</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">/bookstore/book[1]</td>\n<td align=\"left\">选取属于 bookstore 子元素的第一个 book 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">/bookstore/book[last()]</td>\n<td align=\"left\">选取属于 bookstore 子元素的最后一个 book 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">/bookstore/book[last()-1]</td>\n<td align=\"left\">选取属于 bookstore 子元素的倒数第二个 book 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">/bookstore/book[position()&lt;3]</td>\n<td align=\"left\">选取最前面的两个属于 bookstore 元素的子元素的 book 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">//title[@lang]</td>\n<td align=\"left\">选取所有拥有名为 lang 的属性的 title 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">//title[@lang=’eng’]</td>\n<td align=\"left\">选取所有 title 元素，且这些元素拥有值为 eng 的 lang 属性。</td>\n</tr>\n<tr>\n<td align=\"left\">/bookstore/book[price&gt;35.00]</td>\n<td align=\"left\">选取 bookstore 元素的所有 book 元素，且其中的 price 元素的值须大于 35.00。</td>\n</tr>\n<tr>\n<td align=\"left\">/bookstore/book[price&gt;35.00]/title</td>\n<td align=\"left\">选取 bookstore 元素中的 book 元素的所有 title 元素，且其中的 price 元素的值须大于 35.00。</td>\n</tr>\n</tbody></table>\n<h3 id=\"选取未知节点\"><a href=\"#选取未知节点\" class=\"headerlink\" title=\"选取未知节点\"></a>选取未知节点</h3><p><code>XPath</code> 通配符可用来选取未知的 <code>XML</code> 元素。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">通配符</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">*</td>\n<td align=\"left\">匹配任何元素节点。</td>\n</tr>\n<tr>\n<td align=\"left\">@*</td>\n<td align=\"left\">匹配任何属性节点。</td>\n</tr>\n<tr>\n<td align=\"left\">node()</td>\n<td align=\"left\">匹配任何类型的节点。</td>\n</tr>\n</tbody></table>\n<p><strong>实例</strong></p>\n<p>在下面的表格中，列出了一些路径表达式，以及这些表达式的结果：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">路径表达式</th>\n<th align=\"left\">结果</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">/bookstore/*</td>\n<td align=\"left\">选取 bookstore 元素的所有子元素。</td>\n</tr>\n<tr>\n<td align=\"left\">//*</td>\n<td align=\"left\">选取文档中的所有元素。</td>\n</tr>\n<tr>\n<td align=\"left\">//title[@*]</td>\n<td align=\"left\">选取所有带有属性的 title 元素。</td>\n</tr>\n</tbody></table>\n<h3 id=\"选取若干路径\"><a href=\"#选取若干路径\" class=\"headerlink\" title=\"选取若干路径\"></a>选取若干路径</h3><p>通过在路径表达式中使用“|”运算符，您可以选取若干个路径。</p>\n<p><strong>实例</strong><br>在下面的表格中，我们列出了一些路径表达式，以及这些表达式的结果：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">路径表达式</th>\n<th align=\"left\">结果</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">//book/title | //book/price</td>\n<td align=\"left\">选取 book 元素的所有 title 和 price 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">//title | //price</td>\n<td align=\"left\">选取文档中的所有 title 和 price 元素。</td>\n</tr>\n<tr>\n<td align=\"left\">/bookstore/book/title | //price</td>\n<td align=\"left\">选取属于 bookstore 元素的 book 元素的所有 title 元素，以及文档中所有的 price 元素。</td>\n</tr>\n</tbody></table>\n<h2 id=\"XPath-实例\"><a href=\"#XPath-实例\" class=\"headerlink\" title=\"XPath 实例\"></a>XPath 实例</h2><p>对<code>xml</code>文档的匹配。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># coding: utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> lxml <span class=\"keyword\">import</span> etree</span><br><span class=\"line\"></span><br><span class=\"line\">tree = etree.XML(xml,)</span><br><span class=\"line\">result = tree.xpath(<span class=\"string\">&quot;/bookstore/book/title/text()&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;Everyday Italian&#x27;, &#x27;Harry Potter&#x27;, &#x27;XQuery Kick Start&#x27;, &#x27;Learning XML&#x27;]</span></span><br><span class=\"line\"></span><br><span class=\"line\">result = tree.xpath(<span class=\"string\">&quot;//book[3]/author[2]/text()&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;Per Bothner&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<p>对<code>html</code>文档的匹配。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;item-0&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;link1.html&quot;</span>&gt;</span>first item<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;item-1&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;link2.html&quot;</span>&gt;</span>second item<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;item-inactive&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;link3.html&quot;</span>&gt;</span>third item<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;item-1&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;link4.html&quot;</span>&gt;</span>fourth item<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;item-0&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;link5.html&quot;</span>&gt;</span>fifth item<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>引入<code>xlxml</code>模块， 从文件中导入<code>html</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> lxml <span class=\"keyword\">import</span> etree</span><br><span class=\"line\"></span><br><span class=\"line\">tree = etree.parse(<span class=\"string\">&#x27;./test.html&#x27;</span>, etree.HTMLParser())</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"通过字符串转换成html格式\"><a href=\"#通过字符串转换成html格式\" class=\"headerlink\" title=\"通过字符串转换成html格式\"></a>通过字符串转换成html格式</h3><p>利用<code>etree.HTML</code>解析字符串，将字符串解析从<code>html</code>格式的文件， 经过处理后，部分缺失的节点可以自动修复，并且还自动添加了 <code>body</code>、<code>html</code> 节点。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> lxml <span class=\"keyword\">import</span> etree</span><br><span class=\"line\"></span><br><span class=\"line\">text = <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">&lt;html&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;body&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;div&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">                &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link1.html&quot;&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">                &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">                &lt;li class=&quot;item-inactive&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;third item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">                &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">                &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/body&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/html&gt;</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">html = etree.HTML(text)</span><br><span class=\"line\">s = etree.tostring(html).decode()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(s)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># &lt;html&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#     &lt;body&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#         &lt;div&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#             &lt;ul&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#                 &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link1.html&quot;&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#                 &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#                 &lt;li class=&quot;item-inactive&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;third item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#                 &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#                 &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#             &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#         &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#     &lt;/body&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;/html&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"所有节点\"><a href=\"#所有节点\" class=\"headerlink\" title=\"所有节点\"></a>所有节点</h3><p>用以 <code>//</code> 开头的 <code>XPath</code> 规则来选取所有符合要求的字符串：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&quot;//text()&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;\\n    &#x27;, &#x27;\\n        &#x27;, &#x27;\\n            &#x27;, &#x27;\\n                &#x27;, &#x27;first item&#x27;, &#x27;\\n                &#x27;, &#x27;second item&#x27;, &#x27;\\n                &#x27;, &#x27;third item&#x27;, &#x27;\\n</span></span><br><span class=\"line\"><span class=\"comment\">#       &#x27;, &#x27;fourth item&#x27;, &#x27;\\n                &#x27;, &#x27;fifth item&#x27;, &#x27;\\n            &#x27;, &#x27;\\n        &#x27;, &#x27;\\n    &#x27;, &#x27;\\n&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"绝对路径查找\"><a href=\"#绝对路径查找\" class=\"headerlink\" title=\"绝对路径查找\"></a>绝对路径查找</h3><ul>\n<li>获取某个标签的内容</li>\n</ul>\n<p>注意，获取<code>a</code>标签的所有内容，<code>a</code>后面就不用再加正斜杠，否则报错。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&quot;/html/body/div/ul/li/a&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> result:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(i.text)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># first item</span></span><br><span class=\"line\"><span class=\"comment\"># second item</span></span><br><span class=\"line\"><span class=\"comment\"># third item</span></span><br><span class=\"line\"><span class=\"comment\"># fourth item</span></span><br><span class=\"line\"><span class=\"comment\"># fifth item</span></span><br></pre></td></tr></table></figure>\n\n<p>或者</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&quot;/html/body/div/ul/li/a/text()&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> result:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(i)</span><br><span class=\"line\"></span><br><span class=\"line\">first item</span><br><span class=\"line\">second item</span><br><span class=\"line\">third item</span><br><span class=\"line\">fourth item</span><br><span class=\"line\">fifth item</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>打印指定路径下a标签的属性</li>\n</ul>\n<p>这里可以通过遍历拿到某个属性的值，查找标签的内容，通过<code>@属性名</code>获取。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&quot;/html/body/div/ul/li/a/@href&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> result:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(i)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># link1.html</span></span><br><span class=\"line\"><span class=\"comment\"># link2.html</span></span><br><span class=\"line\"><span class=\"comment\"># link3.html</span></span><br><span class=\"line\"><span class=\"comment\"># link4.html</span></span><br><span class=\"line\"><span class=\"comment\"># link5.html</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>获取指定标签对应属性值的内容</li>\n</ul>\n<p>使用<code>xpath</code>拿到得都是一个个的<code>ElementTree</code>对象，如果需要查找内容的话，还需要遍历拿到数据的列表。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;/html/body/div/ul/li/a[@href=&quot;link3.html&quot;]/text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> result:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(i)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># third item</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"相对路径查找（常用）\"><a href=\"#相对路径查找（常用）\" class=\"headerlink\" title=\"相对路径查找（常用）\"></a>相对路径查找（常用）</h2><ul>\n<li>查找所有li标签下的a标签内容</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li/a/text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;first item&#x27;, &#x27;second item&#x27;, &#x27;third item&#x27;, &#x27;fourth item&#x27;, &#x27;fifth item&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>查找一下l相对路径下li标签下的a标签下的href属性的值</li>\n</ul>\n<p>注意，<code>a</code>标签后面需要双<code>//</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li/a/@href&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>查找<code>a</code>标签下属性<code>href</code>值为<code>link5.html</code>的内容。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li/a/@href&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>查找<code>a</code>标签下属性<code>href</code>值为””的内容。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li/a[@href=&quot;link5.html&quot;]/text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># [&#x27;fifth item&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"子节点\"><a href=\"#子节点\" class=\"headerlink\" title=\"子节点\"></a>子节点</h2><p>通过 <code>/</code> 或 <code>//</code> 即可查找元素的子节点或子孙节点，选择 <code>li</code> 节点的所有直接 <code>a</code> 子节点<code>xpath</code>为：<code>//li/a</code>。</p>\n<h2 id=\"父节点\"><a href=\"#父节点\" class=\"headerlink\" title=\"父节点\"></a>父节点</h2><p>知道子节点，查询父节点可以用 <code>..</code> 来实现。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li/a[@href=&quot;link5.html&quot;]/../@class&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;item-0&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"属性匹配\"><a href=\"#属性匹配\" class=\"headerlink\" title=\"属性匹配\"></a>属性匹配</h2><p>匹配时可以用<code>@</code>符号进行属性过滤，匹配<code>li</code>下属性<code>class</code>为<code>item-5</code>的内容。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li/a[@href=&quot;link5.html&quot;]/../@class&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;item-0&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"文本获取\"><a href=\"#文本获取\" class=\"headerlink\" title=\"文本获取\"></a>文本获取</h2><p>有两种方法：一是获取文本所在节点后直接获取文本，二是使用 <code>//</code>。第二种方法会获取到补全代码时换行产生的特殊字符，推荐使用第一种方法，可以保证获取的结果是整洁的。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># first</span></span><br><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li[@class=&quot;item-0&quot;]/a/text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;first item&#x27;, &#x27;fifth item&#x27;]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># second</span></span><br><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li[@class=&quot;item-0&quot;]//text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;first item&#x27;, &#x27;fifth item&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"属性获取\"><a href=\"#属性获取\" class=\"headerlink\" title=\"属性获取\"></a>属性获取</h2><p><code>@</code>符号相当于过滤器，可以直接获取节点的属性值。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li/a/@href&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;link1.html&#x27;, &#x27;link2.html&#x27;, &#x27;link3.html&#x27;, &#x27;link4.html&#x27;, &#x27;link5.html&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"属性多值匹配\"><a href=\"#属性多值匹配\" class=\"headerlink\" title=\"属性多值匹配\"></a>属性多值匹配</h2><p>某些节点的某个属性可能有多个值：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> lxml <span class=\"keyword\">import</span> etree</span><br><span class=\"line\"></span><br><span class=\"line\">text = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;li class=&quot;zxc  asd  wer&quot;&gt;&lt;a href=&quot;https://s2.bdstatic.com/&quot;&gt;1 item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;li class=&quot;ddd  asd  eee&quot;&gt;&lt;a href=&quot;https://s3.bdstatic.com/&quot;&gt;2 item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">html = etree.HTML(text)</span><br><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li[contains(@class, &quot;asd&quot;)]/a/text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># [&#x27;1 item&#x27;, &#x27;2 item&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"多属性匹配\"><a href=\"#多属性匹配\" class=\"headerlink\" title=\"多属性匹配\"></a>多属性匹配</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> lxml <span class=\"keyword\">import</span> etree</span><br><span class=\"line\"></span><br><span class=\"line\">text = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;li class=&quot;zxc  asd  wer&quot; name=&quot;222&quot;&gt;&lt;a href=&quot;https://s2.bdstatic.com/&quot;&gt;1 item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;li class=&quot;ddd  zxc  eee&quot; name=&quot;111&quot;&gt;&lt;a href=&quot;https://s3.bdstatic.com/&quot;&gt;2 item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\">html = etree.HTML(text)</span><br><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li[contains(@class, &quot;zxc&quot;) and @name=&quot;111&quot;]/a/text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 运行结果：[&#x27;2 item&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a>函数</h2><p>查找最后一个<code>li</code>标签里的<code>a</code>标签的<code>href</code>属性（<code>last()函数</code>）</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> lxml <span class=\"keyword\">import</span> etree</span><br><span class=\"line\"></span><br><span class=\"line\">text = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;li class=&quot;zxc  asd  wer&quot;&gt;&lt;a href=&quot;https://s2.bdstatic.com/&quot;&gt;1 item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;li class=&quot;ddd  asd  eee&quot;&gt;&lt;a href=&quot;https://s3.bdstatic.com/&quot;&gt;2 item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\">html = etree.HTML(text)</span><br><span class=\"line\">result = html.xpath(<span class=\"string\">&#x27;//li[last()]/a/text()&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"comment\"># [&#x27;2 item&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>"},{"title":"asyncio异步I/O模块","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-02T23:40:51.000Z","pic":null,"_content":"\n`asyncio` 是用来编写并发代码的库，使用 `async/await` 语法。\n\n`asyncio` 被用作多个提供高性能 `Python` 异步框架的基础，包括网络和网站服务，数据库连接库，分布式任务队列等等。\n\n`asyncio` 往往是构建 `IO` 密集型和高层级 `结构化` 网络代码的最佳选择。\n\n`asyncio` 提供一组 `高层级 API` 用于:\n\n- 并发地运行 `Python` 协程 并对其执行过程实现完全控制;\n- 执行网络IO和IPC;\n- 控制子进程;\n- 通过队列 实现分布式任务;\n- 同步并发代码;\n\n此外，还有一些 `低层级 API` 以支持库和框架的开发者实现:\n\n- 创建和管理事件循环，以提供异步 API 用于`网络化`, 运行`子进程`，处理 `OS信号` 等等;\n- 使用 `transports` 实现高效率协议;\n- 通过 `async/await` 语法 `桥接` 基于回调的库和代码。\n\n## 协程与任务\n\n### 协程\n\n协程 通过 `async/await` 语法进行声明，是编写 `asyncio` 应用的推荐方式。\n\n```python\n import asyncio\n\nasync def main():\n    print('hello')\n    await asyncio.sleep(1)\n    print('world')\n\nasyncio.run(main())\n```\n\n输出hello后停止1秒后输出world。\n\n直接调用协程并不会执行，比如这里直接`main()`是运行不了的，吃屎的`main`不是函数而是一个协程对象。\n\n运行协程，有三种机制：\n\n- `asyncio.run()`函数来运行最高层级的入口点“main”函数。\n- 等待一个协程，下面的代码等待1秒后输出hello，再等待2秒后输出world。\n\n```python\nimport asyncio\nimport time\n\nasync def say_after(delay, what):\n    await asyncio.sleep(delay)\n    print(f\"%s at {time.strftime('%X')}\"%what)\n\nasync def main():\n    print(f\"startd at {time.strftime('%X')}\")\n    await say_after(1, \"hello\")\n    await say_after(2, \"world\")\n    print(f\"ended at {time.strftime('%X')}\")\n\nasyncio.run(main())\n```\n\n输出结果：\n\n```python\nstartd at 15:04:17\nhello at 15:04:18\nworld at 15:04:20\nended at 15:04:20\n```\n\n- `asyncio.create_task()`函数用来并发运行作为 `asyncio` 任务的多个协程。\n\n```python\nimport asyncio\nimport time\n\nasync def say_after(delay, what):\n    await asyncio.sleep(delay)\n    print(f\"%s at {time.strftime('%X')}\"%what)\n\nasync def main():\n    task1 = asyncio.create_task(say_after(1, \"hello\"))\n    task2 = asyncio.create_task(say_after(2, \"world\"))\n\n    print(f\"startd at {time.strftime('%X')}\")\n    await task1\n    await task2\n    print(f\"ended at {time.strftime('%X')}\")\n\nasyncio.run(main())\n```\n\n输出结果，注意，输出显示代码段的运行时间比之前快了 1 秒:：\n\n```python\nstartd at 15:17:35\nhello at 15:17:36\nworld at 15:17:37\nended at 15:17:37\n```\n\n### 可等待对象\n\n如果一个对象可以在 `await` 语句中使用，那么它就是 `可等待` 对象。\n\n`可等待` 对象有三种主要类型: `协程`, `任务` 和 `Future`。\n\n#### 协程\n\n`Python` 协程属于 `可等待` 对象，因此可以在其他协程中被等待:\n\n```python\nimport asyncio\n\nasync def nested():\n    return 42\n\nasync def main():\n    nested()     # 不会直接执行\n\n    print(await nested()) # 打印42\n\nasyncio.run(main())\n```\n\n{% colorpanel info 重要 %}\n\n\"协程\" 可用来表示两个紧密关联的概念:\n- 协程函数: 定义形式为 `async def` 的函数;\n\n- 协程对象: 调用 `协程函数` 所返回的对象。\n\n{% endcolorpanel %}\n\n#### 任务\n\n*任务* 被用来“并行的”调度协程\n\n当一个协程通过 `asyncio.create_task()` 等函数被封装为一个 *任务*，该协程会被自动调度执行:\n\n```python\nimport asyncio\n\nasync def hello():\n    print('hello World')\n\nasync def main():\n    task = asyncio.create_task(hello())\n    await task\n\nasyncio.run(main())\n\n>>hello World\n```\n\n### 运行 asyncio 程序\n\n`asyncio.run(coro, *, debug=False)`\n\n执行 `coroutine coro` 并返回结果。\n\n此函数会运行传入的协程，负责管理 `asyncio` 事件循环，终结异步生成器，并关闭线程池。\n\n当有其他 `asyncio` 事件循环在同一线程中运行时，此函数不能被调用。\n\n如果 `debug` 为 `True`，事件循环将以调试模式运行。\n\n此函数总是会创建一个新的事件循环并在结束时关闭之。它应当被用作 `asyncio` 程序的主入口点，理想情况下应当只被调用一次。\n\n示例:\n\n```python\nasync def main():\n    await asyncio.sleep(1)\n    print('hello')\n\nasyncio.run(main())\n```\n\n### 创建任务\n\n`asyncio.create_task(coro, *, name=None)`\n\n将 `coro` 协程 封装为一个 `Task` 并调度其执行。返回 `Task` 对象。\n\n`name` 不为 `None`，它将使用 `Task.set_name()` 来设为任务的名称。\n\n该任务会在 `get_running_loop()` 返回的循环中执行，如果当前线程没有在运行的循环则会引发 `RuntimeError`。\n\n此函数 在 `Python 3.7` 中被加入。在 `Python 3.7 `之前，可以改用低层级的 `asyncio.ensure_future()` 函数。\n\n```python\nasync def coro():\n    print(\"hello\")\n\n# python3.7\ntask = asyncio.create_task(coro())\n...\n\n# python3.7以前\ntask = asyncio.ensure_future(coro())\n```\n\n### 休眠\n\n`coroutine asyncio.sleep(delay, result=None, *, loop=None)`\n\n阻塞 `delay` 指定的秒数。\n\n如果指定了 `result`，则当协程完成时将其返回给调用者。\n\n`sleep()` 总是会挂起当前任务，以允许其他任务运行。\n\n将 `delay` 设为 `0` 将提供一个经优化的路径以允许其他任务运行。 这可供长期间运行的函数使用以避免在函数调用的全过程中阻塞事件循环。\n\n```python\nimport asyncio\nimport datetime\n\nasync def display_date():\n    loop = asyncio.get_running_loop()\n    end_time = loop.time() + 5.0\n    while True:\n        print(datetime.datetime.now())\n        if (loop.time() + 1.0) >= end_time:\n            break\n        await asyncio.sleep(1)\n\nasyncio.run(display_date())\n```\n\n输出结果：\n\n```python\n2021-06-04 16:05:16.005762\n2021-06-04 16:05:17.010811\n2021-06-04 16:05:18.022837\n2021-06-04 16:05:19.038106\n2021-06-04 16:05:20.038414\n```\n\n### 并发运行任务\n\n`awaitable asyncio.gather(*aws, loop=None, return_exceptions=False)`\n\n并发 运行 `aws` 序列中的 可等待对象。\n\n如果 `aws` 中的某个可等待对象为协程，它将自动被作为一个任务调度。\n\n如果所有可等待对象都成功完成，结果将是一个由所有返回值聚合而成的列表。结果值的顺序与 `aws` 中可等待对象的顺序一致。\n\n如果 `return_exceptions` 为 `False` (默认)，所引发的首个异常会立即传播给等待 `gather()` 的任务。`aws` 序列中的其他可等待对象 不会被取消 并将继续运行。\n\n如果 `return_exceptions` 为 `True`，异常会和成功的结果一样处理，并聚合至结果列表。\n\n如果 `gather()` 被取消，所有被提交 (尚未完成) 的可等待对象也会 被取消。\n\n如果 `aws` 序列中的任一 `Task` 或 `Future` 对象 被取消，它将被当作引发了 `CancelledError` 一样处理 -- 在此情况下 `gather()` 调用 *不会* 被取消。这是为了防止一个已提交的 `Task/Future` 被取消导致其他 `Tasks/Future` 也被取消。\n\n```python\nimport asyncio\n\nasync def factorial(name, number):\n    f = 1\n    for i in range(2, number + 1):\n        print(f'任务名 {name}: factorial({number}), currently i = {i}...')\n        await asyncio.sleep(1)\n        f *= i\n    print(f\"任务 {name}: factorial({number}) = {f}\")\n    return f\n\nasync def main():\n    L = await asyncio.gather(\n        factorial(\"A\", 2),\n        factorial(\"B\", 3),\n        factorial(\"C\", 4),\n    )\n    print(L)\n\nasyncio.run(main())\n\n# output\n# 任务名 A: factorial(2), currently i = 2...\n# 任务名 B: factorial(3), currently i = 2...\n# 任务名 C: factorial(4), currently i = 2...\n# 任务 A: factorial(2) = 2\n# 任务名 B: factorial(3), currently i = 3...\n# 任务名 C: factorial(4), currently i = 3...\n# 任务 B: factorial(3) = 6\n# 任务名 C: factorial(4), currently i = 4...\n# 任务 C: factorial(4) = 24\n# [2, 6, 24]\n```\n\n\n\n","source":"_posts/asyncio异步I-O模块.md","raw":"---\ntitle: asyncio异步I/O模块\ntags:\n  - asyncio\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-03 07:40:51\ncategories: Python库\npic:\n---\n\n`asyncio` 是用来编写并发代码的库，使用 `async/await` 语法。\n\n`asyncio` 被用作多个提供高性能 `Python` 异步框架的基础，包括网络和网站服务，数据库连接库，分布式任务队列等等。\n\n`asyncio` 往往是构建 `IO` 密集型和高层级 `结构化` 网络代码的最佳选择。\n\n`asyncio` 提供一组 `高层级 API` 用于:\n\n- 并发地运行 `Python` 协程 并对其执行过程实现完全控制;\n- 执行网络IO和IPC;\n- 控制子进程;\n- 通过队列 实现分布式任务;\n- 同步并发代码;\n\n此外，还有一些 `低层级 API` 以支持库和框架的开发者实现:\n\n- 创建和管理事件循环，以提供异步 API 用于`网络化`, 运行`子进程`，处理 `OS信号` 等等;\n- 使用 `transports` 实现高效率协议;\n- 通过 `async/await` 语法 `桥接` 基于回调的库和代码。\n\n## 协程与任务\n\n### 协程\n\n协程 通过 `async/await` 语法进行声明，是编写 `asyncio` 应用的推荐方式。\n\n```python\n import asyncio\n\nasync def main():\n    print('hello')\n    await asyncio.sleep(1)\n    print('world')\n\nasyncio.run(main())\n```\n\n输出hello后停止1秒后输出world。\n\n直接调用协程并不会执行，比如这里直接`main()`是运行不了的，吃屎的`main`不是函数而是一个协程对象。\n\n运行协程，有三种机制：\n\n- `asyncio.run()`函数来运行最高层级的入口点“main”函数。\n- 等待一个协程，下面的代码等待1秒后输出hello，再等待2秒后输出world。\n\n```python\nimport asyncio\nimport time\n\nasync def say_after(delay, what):\n    await asyncio.sleep(delay)\n    print(f\"%s at {time.strftime('%X')}\"%what)\n\nasync def main():\n    print(f\"startd at {time.strftime('%X')}\")\n    await say_after(1, \"hello\")\n    await say_after(2, \"world\")\n    print(f\"ended at {time.strftime('%X')}\")\n\nasyncio.run(main())\n```\n\n输出结果：\n\n```python\nstartd at 15:04:17\nhello at 15:04:18\nworld at 15:04:20\nended at 15:04:20\n```\n\n- `asyncio.create_task()`函数用来并发运行作为 `asyncio` 任务的多个协程。\n\n```python\nimport asyncio\nimport time\n\nasync def say_after(delay, what):\n    await asyncio.sleep(delay)\n    print(f\"%s at {time.strftime('%X')}\"%what)\n\nasync def main():\n    task1 = asyncio.create_task(say_after(1, \"hello\"))\n    task2 = asyncio.create_task(say_after(2, \"world\"))\n\n    print(f\"startd at {time.strftime('%X')}\")\n    await task1\n    await task2\n    print(f\"ended at {time.strftime('%X')}\")\n\nasyncio.run(main())\n```\n\n输出结果，注意，输出显示代码段的运行时间比之前快了 1 秒:：\n\n```python\nstartd at 15:17:35\nhello at 15:17:36\nworld at 15:17:37\nended at 15:17:37\n```\n\n### 可等待对象\n\n如果一个对象可以在 `await` 语句中使用，那么它就是 `可等待` 对象。\n\n`可等待` 对象有三种主要类型: `协程`, `任务` 和 `Future`。\n\n#### 协程\n\n`Python` 协程属于 `可等待` 对象，因此可以在其他协程中被等待:\n\n```python\nimport asyncio\n\nasync def nested():\n    return 42\n\nasync def main():\n    nested()     # 不会直接执行\n\n    print(await nested()) # 打印42\n\nasyncio.run(main())\n```\n\n{% colorpanel info 重要 %}\n\n\"协程\" 可用来表示两个紧密关联的概念:\n- 协程函数: 定义形式为 `async def` 的函数;\n\n- 协程对象: 调用 `协程函数` 所返回的对象。\n\n{% endcolorpanel %}\n\n#### 任务\n\n*任务* 被用来“并行的”调度协程\n\n当一个协程通过 `asyncio.create_task()` 等函数被封装为一个 *任务*，该协程会被自动调度执行:\n\n```python\nimport asyncio\n\nasync def hello():\n    print('hello World')\n\nasync def main():\n    task = asyncio.create_task(hello())\n    await task\n\nasyncio.run(main())\n\n>>hello World\n```\n\n### 运行 asyncio 程序\n\n`asyncio.run(coro, *, debug=False)`\n\n执行 `coroutine coro` 并返回结果。\n\n此函数会运行传入的协程，负责管理 `asyncio` 事件循环，终结异步生成器，并关闭线程池。\n\n当有其他 `asyncio` 事件循环在同一线程中运行时，此函数不能被调用。\n\n如果 `debug` 为 `True`，事件循环将以调试模式运行。\n\n此函数总是会创建一个新的事件循环并在结束时关闭之。它应当被用作 `asyncio` 程序的主入口点，理想情况下应当只被调用一次。\n\n示例:\n\n```python\nasync def main():\n    await asyncio.sleep(1)\n    print('hello')\n\nasyncio.run(main())\n```\n\n### 创建任务\n\n`asyncio.create_task(coro, *, name=None)`\n\n将 `coro` 协程 封装为一个 `Task` 并调度其执行。返回 `Task` 对象。\n\n`name` 不为 `None`，它将使用 `Task.set_name()` 来设为任务的名称。\n\n该任务会在 `get_running_loop()` 返回的循环中执行，如果当前线程没有在运行的循环则会引发 `RuntimeError`。\n\n此函数 在 `Python 3.7` 中被加入。在 `Python 3.7 `之前，可以改用低层级的 `asyncio.ensure_future()` 函数。\n\n```python\nasync def coro():\n    print(\"hello\")\n\n# python3.7\ntask = asyncio.create_task(coro())\n...\n\n# python3.7以前\ntask = asyncio.ensure_future(coro())\n```\n\n### 休眠\n\n`coroutine asyncio.sleep(delay, result=None, *, loop=None)`\n\n阻塞 `delay` 指定的秒数。\n\n如果指定了 `result`，则当协程完成时将其返回给调用者。\n\n`sleep()` 总是会挂起当前任务，以允许其他任务运行。\n\n将 `delay` 设为 `0` 将提供一个经优化的路径以允许其他任务运行。 这可供长期间运行的函数使用以避免在函数调用的全过程中阻塞事件循环。\n\n```python\nimport asyncio\nimport datetime\n\nasync def display_date():\n    loop = asyncio.get_running_loop()\n    end_time = loop.time() + 5.0\n    while True:\n        print(datetime.datetime.now())\n        if (loop.time() + 1.0) >= end_time:\n            break\n        await asyncio.sleep(1)\n\nasyncio.run(display_date())\n```\n\n输出结果：\n\n```python\n2021-06-04 16:05:16.005762\n2021-06-04 16:05:17.010811\n2021-06-04 16:05:18.022837\n2021-06-04 16:05:19.038106\n2021-06-04 16:05:20.038414\n```\n\n### 并发运行任务\n\n`awaitable asyncio.gather(*aws, loop=None, return_exceptions=False)`\n\n并发 运行 `aws` 序列中的 可等待对象。\n\n如果 `aws` 中的某个可等待对象为协程，它将自动被作为一个任务调度。\n\n如果所有可等待对象都成功完成，结果将是一个由所有返回值聚合而成的列表。结果值的顺序与 `aws` 中可等待对象的顺序一致。\n\n如果 `return_exceptions` 为 `False` (默认)，所引发的首个异常会立即传播给等待 `gather()` 的任务。`aws` 序列中的其他可等待对象 不会被取消 并将继续运行。\n\n如果 `return_exceptions` 为 `True`，异常会和成功的结果一样处理，并聚合至结果列表。\n\n如果 `gather()` 被取消，所有被提交 (尚未完成) 的可等待对象也会 被取消。\n\n如果 `aws` 序列中的任一 `Task` 或 `Future` 对象 被取消，它将被当作引发了 `CancelledError` 一样处理 -- 在此情况下 `gather()` 调用 *不会* 被取消。这是为了防止一个已提交的 `Task/Future` 被取消导致其他 `Tasks/Future` 也被取消。\n\n```python\nimport asyncio\n\nasync def factorial(name, number):\n    f = 1\n    for i in range(2, number + 1):\n        print(f'任务名 {name}: factorial({number}), currently i = {i}...')\n        await asyncio.sleep(1)\n        f *= i\n    print(f\"任务 {name}: factorial({number}) = {f}\")\n    return f\n\nasync def main():\n    L = await asyncio.gather(\n        factorial(\"A\", 2),\n        factorial(\"B\", 3),\n        factorial(\"C\", 4),\n    )\n    print(L)\n\nasyncio.run(main())\n\n# output\n# 任务名 A: factorial(2), currently i = 2...\n# 任务名 B: factorial(3), currently i = 2...\n# 任务名 C: factorial(4), currently i = 2...\n# 任务 A: factorial(2) = 2\n# 任务名 B: factorial(3), currently i = 3...\n# 任务名 C: factorial(4), currently i = 3...\n# 任务 B: factorial(3) = 6\n# 任务名 C: factorial(4), currently i = 4...\n# 任务 C: factorial(4) = 24\n# [2, 6, 24]\n```\n\n\n\n","slug":"asyncio异步I-O模块","published":1,"updated":"2021-06-17T11:48:40.225Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2d001m44udc7qx4dem","content":"<p><code>asyncio</code> 是用来编写并发代码的库，使用 <code>async/await</code> 语法。</p>\n<p><code>asyncio</code> 被用作多个提供高性能 <code>Python</code> 异步框架的基础，包括网络和网站服务，数据库连接库，分布式任务队列等等。</p>\n<p><code>asyncio</code> 往往是构建 <code>IO</code> 密集型和高层级 <code>结构化</code> 网络代码的最佳选择。</p>\n<p><code>asyncio</code> 提供一组 <code>高层级 API</code> 用于:</p>\n<ul>\n<li>并发地运行 <code>Python</code> 协程 并对其执行过程实现完全控制;</li>\n<li>执行网络IO和IPC;</li>\n<li>控制子进程;</li>\n<li>通过队列 实现分布式任务;</li>\n<li>同步并发代码;</li>\n</ul>\n<p>此外，还有一些 <code>低层级 API</code> 以支持库和框架的开发者实现:</p>\n<ul>\n<li>创建和管理事件循环，以提供异步 API 用于<code>网络化</code>, 运行<code>子进程</code>，处理 <code>OS信号</code> 等等;</li>\n<li>使用 <code>transports</code> 实现高效率协议;</li>\n<li>通过 <code>async/await</code> 语法 <code>桥接</code> 基于回调的库和代码。</li>\n</ul>\n<h2 id=\"协程与任务\"><a href=\"#协程与任务\" class=\"headerlink\" title=\"协程与任务\"></a>协程与任务</h2><h3 id=\"协程\"><a href=\"#协程\" class=\"headerlink\" title=\"协程\"></a>协程</h3><p>协程 通过 <code>async/await</code> 语法进行声明，是编写 <code>asyncio</code> 应用的推荐方式。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;hello&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> asyncio.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;world&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(main())</span><br></pre></td></tr></table></figure>\n\n<p>输出hello后停止1秒后输出world。</p>\n<p>直接调用协程并不会执行，比如这里直接<code>main()</code>是运行不了的，吃屎的<code>main</code>不是函数而是一个协程对象。</p>\n<p>运行协程，有三种机制：</p>\n<ul>\n<li><code>asyncio.run()</code>函数来运行最高层级的入口点“main”函数。</li>\n<li>等待一个协程，下面的代码等待1秒后输出hello，再等待2秒后输出world。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">say_after</span>(<span class=\"params\">delay, what</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> asyncio.sleep(delay)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;%s at <span class=\"subst\">&#123;time.strftime(<span class=\"string\">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>%what)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;startd at <span class=\"subst\">&#123;time.strftime(<span class=\"string\">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> say_after(<span class=\"number\">1</span>, <span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> say_after(<span class=\"number\">2</span>, <span class=\"string\">&quot;world&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;ended at <span class=\"subst\">&#123;time.strftime(<span class=\"string\">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(main())</span><br></pre></td></tr></table></figure>\n\n<p>输出结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">startd at <span class=\"number\">15</span>:04:<span class=\"number\">17</span></span><br><span class=\"line\">hello at <span class=\"number\">15</span>:04:<span class=\"number\">18</span></span><br><span class=\"line\">world at <span class=\"number\">15</span>:04:<span class=\"number\">20</span></span><br><span class=\"line\">ended at <span class=\"number\">15</span>:04:<span class=\"number\">20</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>asyncio.create_task()</code>函数用来并发运行作为 <code>asyncio</code> 任务的多个协程。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">say_after</span>(<span class=\"params\">delay, what</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> asyncio.sleep(delay)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;%s at <span class=\"subst\">&#123;time.strftime(<span class=\"string\">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>%what)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    task1 = asyncio.create_task(say_after(<span class=\"number\">1</span>, <span class=\"string\">&quot;hello&quot;</span>))</span><br><span class=\"line\">    task2 = asyncio.create_task(say_after(<span class=\"number\">2</span>, <span class=\"string\">&quot;world&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;startd at <span class=\"subst\">&#123;time.strftime(<span class=\"string\">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> task1</span><br><span class=\"line\">    <span class=\"keyword\">await</span> task2</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;ended at <span class=\"subst\">&#123;time.strftime(<span class=\"string\">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(main())</span><br></pre></td></tr></table></figure>\n\n<p>输出结果，注意，输出显示代码段的运行时间比之前快了 1 秒:：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">startd at <span class=\"number\">15</span>:<span class=\"number\">17</span>:<span class=\"number\">35</span></span><br><span class=\"line\">hello at <span class=\"number\">15</span>:<span class=\"number\">17</span>:<span class=\"number\">36</span></span><br><span class=\"line\">world at <span class=\"number\">15</span>:<span class=\"number\">17</span>:<span class=\"number\">37</span></span><br><span class=\"line\">ended at <span class=\"number\">15</span>:<span class=\"number\">17</span>:<span class=\"number\">37</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"可等待对象\"><a href=\"#可等待对象\" class=\"headerlink\" title=\"可等待对象\"></a>可等待对象</h3><p>如果一个对象可以在 <code>await</code> 语句中使用，那么它就是 <code>可等待</code> 对象。</p>\n<p><code>可等待</code> 对象有三种主要类型: <code>协程</code>, <code>任务</code> 和 <code>Future</code>。</p>\n<h4 id=\"协程-1\"><a href=\"#协程-1\" class=\"headerlink\" title=\"协程\"></a>协程</h4><p><code>Python</code> 协程属于 <code>可等待</code> 对象，因此可以在其他协程中被等待:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">nested</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">42</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    nested()     <span class=\"comment\"># 不会直接执行</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"keyword\">await</span> nested()) <span class=\"comment\"># 打印42</span></span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(main())</span><br></pre></td></tr></table></figure>\n\n<div class=\"panel panel-info\">\n    <div class=\"panel-title\">重要</div>\n    <div class=\"panel-body\">\n        <p>“协程” 可用来表示两个紧密关联的概念:</p>\n<ul>\n<li><p>协程函数: 定义形式为 <code>async def</code> 的函数;</p>\n</li>\n<li><p>协程对象: 调用 <code>协程函数</code> 所返回的对象。</p>\n</li>\n</ul>\n\n    </div>\n    </div>\n\n<h4 id=\"任务\"><a href=\"#任务\" class=\"headerlink\" title=\"任务\"></a>任务</h4><p><em>任务</em> 被用来“并行的”调度协程</p>\n<p>当一个协程通过 <code>asyncio.create_task()</code> 等函数被封装为一个 <em>任务</em>，该协程会被自动调度执行:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span>():</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;hello World&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    task = asyncio.create_task(hello())</span><br><span class=\"line\">    <span class=\"keyword\">await</span> task</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(main())</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;hello World</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"运行-asyncio-程序\"><a href=\"#运行-asyncio-程序\" class=\"headerlink\" title=\"运行 asyncio 程序\"></a>运行 asyncio 程序</h3><p><code>asyncio.run(coro, *, debug=False)</code></p>\n<p>执行 <code>coroutine coro</code> 并返回结果。</p>\n<p>此函数会运行传入的协程，负责管理 <code>asyncio</code> 事件循环，终结异步生成器，并关闭线程池。</p>\n<p>当有其他 <code>asyncio</code> 事件循环在同一线程中运行时，此函数不能被调用。</p>\n<p>如果 <code>debug</code> 为 <code>True</code>，事件循环将以调试模式运行。</p>\n<p>此函数总是会创建一个新的事件循环并在结束时关闭之。它应当被用作 <code>asyncio</code> 程序的主入口点，理想情况下应当只被调用一次。</p>\n<p>示例:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> asyncio.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;hello&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(main())</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建任务\"><a href=\"#创建任务\" class=\"headerlink\" title=\"创建任务\"></a>创建任务</h3><p><code>asyncio.create_task(coro, *, name=None)</code></p>\n<p>将 <code>coro</code> 协程 封装为一个 <code>Task</code> 并调度其执行。返回 <code>Task</code> 对象。</p>\n<p><code>name</code> 不为 <code>None</code>，它将使用 <code>Task.set_name()</code> 来设为任务的名称。</p>\n<p>该任务会在 <code>get_running_loop()</code> 返回的循环中执行，如果当前线程没有在运行的循环则会引发 <code>RuntimeError</code>。</p>\n<p>此函数 在 <code>Python 3.7</code> 中被加入。在 <code>Python 3.7 </code>之前，可以改用低层级的 <code>asyncio.ensure_future()</code> 函数。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">coro</span>():</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># python3.7</span></span><br><span class=\"line\">task = asyncio.create_task(coro())</span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># python3.7以前</span></span><br><span class=\"line\">task = asyncio.ensure_future(coro())</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"休眠\"><a href=\"#休眠\" class=\"headerlink\" title=\"休眠\"></a>休眠</h3><p><code>coroutine asyncio.sleep(delay, result=None, *, loop=None)</code></p>\n<p>阻塞 <code>delay</code> 指定的秒数。</p>\n<p>如果指定了 <code>result</code>，则当协程完成时将其返回给调用者。</p>\n<p><code>sleep()</code> 总是会挂起当前任务，以允许其他任务运行。</p>\n<p>将 <code>delay</code> 设为 <code>0</code> 将提供一个经优化的路径以允许其他任务运行。 这可供长期间运行的函数使用以避免在函数调用的全过程中阻塞事件循环。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">display_date</span>():</span></span><br><span class=\"line\">    loop = asyncio.get_running_loop()</span><br><span class=\"line\">    end_time = loop.time() + <span class=\"number\">5.0</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(datetime.datetime.now())</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (loop.time() + <span class=\"number\">1.0</span>) &gt;= end_time:</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">await</span> asyncio.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(display_date())</span><br></pre></td></tr></table></figure>\n\n<p>输出结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2021</span>-06-04 <span class=\"number\">16</span>:05:<span class=\"number\">16.005762</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-06-04 <span class=\"number\">16</span>:05:<span class=\"number\">17.010811</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-06-04 <span class=\"number\">16</span>:05:<span class=\"number\">18.022837</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-06-04 <span class=\"number\">16</span>:05:<span class=\"number\">19.038106</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-06-04 <span class=\"number\">16</span>:05:<span class=\"number\">20.038414</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"并发运行任务\"><a href=\"#并发运行任务\" class=\"headerlink\" title=\"并发运行任务\"></a>并发运行任务</h3><p><code>awaitable asyncio.gather(*aws, loop=None, return_exceptions=False)</code></p>\n<p>并发 运行 <code>aws</code> 序列中的 可等待对象。</p>\n<p>如果 <code>aws</code> 中的某个可等待对象为协程，它将自动被作为一个任务调度。</p>\n<p>如果所有可等待对象都成功完成，结果将是一个由所有返回值聚合而成的列表。结果值的顺序与 <code>aws</code> 中可等待对象的顺序一致。</p>\n<p>如果 <code>return_exceptions</code> 为 <code>False</code> (默认)，所引发的首个异常会立即传播给等待 <code>gather()</code> 的任务。<code>aws</code> 序列中的其他可等待对象 不会被取消 并将继续运行。</p>\n<p>如果 <code>return_exceptions</code> 为 <code>True</code>，异常会和成功的结果一样处理，并聚合至结果列表。</p>\n<p>如果 <code>gather()</code> 被取消，所有被提交 (尚未完成) 的可等待对象也会 被取消。</p>\n<p>如果 <code>aws</code> 序列中的任一 <code>Task</code> 或 <code>Future</code> 对象 被取消，它将被当作引发了 <code>CancelledError</code> 一样处理 – 在此情况下 <code>gather()</code> 调用 <em>不会</em> 被取消。这是为了防止一个已提交的 <code>Task/Future</code> 被取消导致其他 <code>Tasks/Future</code> 也被取消。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">factorial</span>(<span class=\"params\">name, number</span>):</span></span><br><span class=\"line\">    f = <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">2</span>, number + <span class=\"number\">1</span>):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;任务名 <span class=\"subst\">&#123;name&#125;</span>: factorial(<span class=\"subst\">&#123;number&#125;</span>), currently i = <span class=\"subst\">&#123;i&#125;</span>...&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">await</span> asyncio.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">        f *= i</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;任务 <span class=\"subst\">&#123;name&#125;</span>: factorial(<span class=\"subst\">&#123;number&#125;</span>) = <span class=\"subst\">&#123;f&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> f</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    L = <span class=\"keyword\">await</span> asyncio.gather(</span><br><span class=\"line\">        factorial(<span class=\"string\">&quot;A&quot;</span>, <span class=\"number\">2</span>),</span><br><span class=\"line\">        factorial(<span class=\"string\">&quot;B&quot;</span>, <span class=\"number\">3</span>),</span><br><span class=\"line\">        factorial(<span class=\"string\">&quot;C&quot;</span>, <span class=\"number\">4</span>),</span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(L)</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(main())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># output</span></span><br><span class=\"line\"><span class=\"comment\"># 任务名 A: factorial(2), currently i = 2...</span></span><br><span class=\"line\"><span class=\"comment\"># 任务名 B: factorial(3), currently i = 2...</span></span><br><span class=\"line\"><span class=\"comment\"># 任务名 C: factorial(4), currently i = 2...</span></span><br><span class=\"line\"><span class=\"comment\"># 任务 A: factorial(2) = 2</span></span><br><span class=\"line\"><span class=\"comment\"># 任务名 B: factorial(3), currently i = 3...</span></span><br><span class=\"line\"><span class=\"comment\"># 任务名 C: factorial(4), currently i = 3...</span></span><br><span class=\"line\"><span class=\"comment\"># 任务 B: factorial(3) = 6</span></span><br><span class=\"line\"><span class=\"comment\"># 任务名 C: factorial(4), currently i = 4...</span></span><br><span class=\"line\"><span class=\"comment\"># 任务 C: factorial(4) = 24</span></span><br><span class=\"line\"><span class=\"comment\"># [2, 6, 24]</span></span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<p><code>asyncio</code> 是用来编写并发代码的库，使用 <code>async/await</code> 语法。</p>\n<p><code>asyncio</code> 被用作多个提供高性能 <code>Python</code> 异步框架的基础，包括网络和网站服务，数据库连接库，分布式任务队列等等。</p>\n<p><code>asyncio</code> 往往是构建 <code>IO</code> 密集型和高层级 <code>结构化</code> 网络代码的最佳选择。</p>\n<p><code>asyncio</code> 提供一组 <code>高层级 API</code> 用于:</p>\n<ul>\n<li>并发地运行 <code>Python</code> 协程 并对其执行过程实现完全控制;</li>\n<li>执行网络IO和IPC;</li>\n<li>控制子进程;</li>\n<li>通过队列 实现分布式任务;</li>\n<li>同步并发代码;</li>\n</ul>\n<p>此外，还有一些 <code>低层级 API</code> 以支持库和框架的开发者实现:</p>\n<ul>\n<li>创建和管理事件循环，以提供异步 API 用于<code>网络化</code>, 运行<code>子进程</code>，处理 <code>OS信号</code> 等等;</li>\n<li>使用 <code>transports</code> 实现高效率协议;</li>\n<li>通过 <code>async/await</code> 语法 <code>桥接</code> 基于回调的库和代码。</li>\n</ul>\n<h2 id=\"协程与任务\"><a href=\"#协程与任务\" class=\"headerlink\" title=\"协程与任务\"></a>协程与任务</h2><h3 id=\"协程\"><a href=\"#协程\" class=\"headerlink\" title=\"协程\"></a>协程</h3><p>协程 通过 <code>async/await</code> 语法进行声明，是编写 <code>asyncio</code> 应用的推荐方式。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;hello&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> asyncio.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;world&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(main())</span><br></pre></td></tr></table></figure>\n\n<p>输出hello后停止1秒后输出world。</p>\n<p>直接调用协程并不会执行，比如这里直接<code>main()</code>是运行不了的，吃屎的<code>main</code>不是函数而是一个协程对象。</p>\n<p>运行协程，有三种机制：</p>\n<ul>\n<li><code>asyncio.run()</code>函数来运行最高层级的入口点“main”函数。</li>\n<li>等待一个协程，下面的代码等待1秒后输出hello，再等待2秒后输出world。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">say_after</span>(<span class=\"params\">delay, what</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> asyncio.sleep(delay)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;%s at <span class=\"subst\">&#123;time.strftime(<span class=\"string\">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>%what)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;startd at <span class=\"subst\">&#123;time.strftime(<span class=\"string\">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> say_after(<span class=\"number\">1</span>, <span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> say_after(<span class=\"number\">2</span>, <span class=\"string\">&quot;world&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;ended at <span class=\"subst\">&#123;time.strftime(<span class=\"string\">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(main())</span><br></pre></td></tr></table></figure>\n\n<p>输出结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">startd at <span class=\"number\">15</span>:04:<span class=\"number\">17</span></span><br><span class=\"line\">hello at <span class=\"number\">15</span>:04:<span class=\"number\">18</span></span><br><span class=\"line\">world at <span class=\"number\">15</span>:04:<span class=\"number\">20</span></span><br><span class=\"line\">ended at <span class=\"number\">15</span>:04:<span class=\"number\">20</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>asyncio.create_task()</code>函数用来并发运行作为 <code>asyncio</code> 任务的多个协程。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">say_after</span>(<span class=\"params\">delay, what</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> asyncio.sleep(delay)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;%s at <span class=\"subst\">&#123;time.strftime(<span class=\"string\">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>%what)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    task1 = asyncio.create_task(say_after(<span class=\"number\">1</span>, <span class=\"string\">&quot;hello&quot;</span>))</span><br><span class=\"line\">    task2 = asyncio.create_task(say_after(<span class=\"number\">2</span>, <span class=\"string\">&quot;world&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;startd at <span class=\"subst\">&#123;time.strftime(<span class=\"string\">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> task1</span><br><span class=\"line\">    <span class=\"keyword\">await</span> task2</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;ended at <span class=\"subst\">&#123;time.strftime(<span class=\"string\">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(main())</span><br></pre></td></tr></table></figure>\n\n<p>输出结果，注意，输出显示代码段的运行时间比之前快了 1 秒:：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">startd at <span class=\"number\">15</span>:<span class=\"number\">17</span>:<span class=\"number\">35</span></span><br><span class=\"line\">hello at <span class=\"number\">15</span>:<span class=\"number\">17</span>:<span class=\"number\">36</span></span><br><span class=\"line\">world at <span class=\"number\">15</span>:<span class=\"number\">17</span>:<span class=\"number\">37</span></span><br><span class=\"line\">ended at <span class=\"number\">15</span>:<span class=\"number\">17</span>:<span class=\"number\">37</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"可等待对象\"><a href=\"#可等待对象\" class=\"headerlink\" title=\"可等待对象\"></a>可等待对象</h3><p>如果一个对象可以在 <code>await</code> 语句中使用，那么它就是 <code>可等待</code> 对象。</p>\n<p><code>可等待</code> 对象有三种主要类型: <code>协程</code>, <code>任务</code> 和 <code>Future</code>。</p>\n<h4 id=\"协程-1\"><a href=\"#协程-1\" class=\"headerlink\" title=\"协程\"></a>协程</h4><p><code>Python</code> 协程属于 <code>可等待</code> 对象，因此可以在其他协程中被等待:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">nested</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">42</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    nested()     <span class=\"comment\"># 不会直接执行</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"keyword\">await</span> nested()) <span class=\"comment\"># 打印42</span></span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(main())</span><br></pre></td></tr></table></figure>\n\n<div class=\"panel panel-info\">\n    <div class=\"panel-title\">重要</div>\n    <div class=\"panel-body\">\n        <p>“协程” 可用来表示两个紧密关联的概念:</p>\n<ul>\n<li><p>协程函数: 定义形式为 <code>async def</code> 的函数;</p>\n</li>\n<li><p>协程对象: 调用 <code>协程函数</code> 所返回的对象。</p>\n</li>\n</ul>\n\n    </div>\n    </div>\n\n<h4 id=\"任务\"><a href=\"#任务\" class=\"headerlink\" title=\"任务\"></a>任务</h4><p><em>任务</em> 被用来“并行的”调度协程</p>\n<p>当一个协程通过 <code>asyncio.create_task()</code> 等函数被封装为一个 <em>任务</em>，该协程会被自动调度执行:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span>():</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;hello World&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    task = asyncio.create_task(hello())</span><br><span class=\"line\">    <span class=\"keyword\">await</span> task</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(main())</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;hello World</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"运行-asyncio-程序\"><a href=\"#运行-asyncio-程序\" class=\"headerlink\" title=\"运行 asyncio 程序\"></a>运行 asyncio 程序</h3><p><code>asyncio.run(coro, *, debug=False)</code></p>\n<p>执行 <code>coroutine coro</code> 并返回结果。</p>\n<p>此函数会运行传入的协程，负责管理 <code>asyncio</code> 事件循环，终结异步生成器，并关闭线程池。</p>\n<p>当有其他 <code>asyncio</code> 事件循环在同一线程中运行时，此函数不能被调用。</p>\n<p>如果 <code>debug</code> 为 <code>True</code>，事件循环将以调试模式运行。</p>\n<p>此函数总是会创建一个新的事件循环并在结束时关闭之。它应当被用作 <code>asyncio</code> 程序的主入口点，理想情况下应当只被调用一次。</p>\n<p>示例:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> asyncio.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;hello&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(main())</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建任务\"><a href=\"#创建任务\" class=\"headerlink\" title=\"创建任务\"></a>创建任务</h3><p><code>asyncio.create_task(coro, *, name=None)</code></p>\n<p>将 <code>coro</code> 协程 封装为一个 <code>Task</code> 并调度其执行。返回 <code>Task</code> 对象。</p>\n<p><code>name</code> 不为 <code>None</code>，它将使用 <code>Task.set_name()</code> 来设为任务的名称。</p>\n<p>该任务会在 <code>get_running_loop()</code> 返回的循环中执行，如果当前线程没有在运行的循环则会引发 <code>RuntimeError</code>。</p>\n<p>此函数 在 <code>Python 3.7</code> 中被加入。在 <code>Python 3.7 </code>之前，可以改用低层级的 <code>asyncio.ensure_future()</code> 函数。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">coro</span>():</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># python3.7</span></span><br><span class=\"line\">task = asyncio.create_task(coro())</span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># python3.7以前</span></span><br><span class=\"line\">task = asyncio.ensure_future(coro())</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"休眠\"><a href=\"#休眠\" class=\"headerlink\" title=\"休眠\"></a>休眠</h3><p><code>coroutine asyncio.sleep(delay, result=None, *, loop=None)</code></p>\n<p>阻塞 <code>delay</code> 指定的秒数。</p>\n<p>如果指定了 <code>result</code>，则当协程完成时将其返回给调用者。</p>\n<p><code>sleep()</code> 总是会挂起当前任务，以允许其他任务运行。</p>\n<p>将 <code>delay</code> 设为 <code>0</code> 将提供一个经优化的路径以允许其他任务运行。 这可供长期间运行的函数使用以避免在函数调用的全过程中阻塞事件循环。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">display_date</span>():</span></span><br><span class=\"line\">    loop = asyncio.get_running_loop()</span><br><span class=\"line\">    end_time = loop.time() + <span class=\"number\">5.0</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(datetime.datetime.now())</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (loop.time() + <span class=\"number\">1.0</span>) &gt;= end_time:</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">await</span> asyncio.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(display_date())</span><br></pre></td></tr></table></figure>\n\n<p>输出结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2021</span>-06-04 <span class=\"number\">16</span>:05:<span class=\"number\">16.005762</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-06-04 <span class=\"number\">16</span>:05:<span class=\"number\">17.010811</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-06-04 <span class=\"number\">16</span>:05:<span class=\"number\">18.022837</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-06-04 <span class=\"number\">16</span>:05:<span class=\"number\">19.038106</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-06-04 <span class=\"number\">16</span>:05:<span class=\"number\">20.038414</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"并发运行任务\"><a href=\"#并发运行任务\" class=\"headerlink\" title=\"并发运行任务\"></a>并发运行任务</h3><p><code>awaitable asyncio.gather(*aws, loop=None, return_exceptions=False)</code></p>\n<p>并发 运行 <code>aws</code> 序列中的 可等待对象。</p>\n<p>如果 <code>aws</code> 中的某个可等待对象为协程，它将自动被作为一个任务调度。</p>\n<p>如果所有可等待对象都成功完成，结果将是一个由所有返回值聚合而成的列表。结果值的顺序与 <code>aws</code> 中可等待对象的顺序一致。</p>\n<p>如果 <code>return_exceptions</code> 为 <code>False</code> (默认)，所引发的首个异常会立即传播给等待 <code>gather()</code> 的任务。<code>aws</code> 序列中的其他可等待对象 不会被取消 并将继续运行。</p>\n<p>如果 <code>return_exceptions</code> 为 <code>True</code>，异常会和成功的结果一样处理，并聚合至结果列表。</p>\n<p>如果 <code>gather()</code> 被取消，所有被提交 (尚未完成) 的可等待对象也会 被取消。</p>\n<p>如果 <code>aws</code> 序列中的任一 <code>Task</code> 或 <code>Future</code> 对象 被取消，它将被当作引发了 <code>CancelledError</code> 一样处理 – 在此情况下 <code>gather()</code> 调用 <em>不会</em> 被取消。这是为了防止一个已提交的 <code>Task/Future</code> 被取消导致其他 <code>Tasks/Future</code> 也被取消。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">factorial</span>(<span class=\"params\">name, number</span>):</span></span><br><span class=\"line\">    f = <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">2</span>, number + <span class=\"number\">1</span>):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;任务名 <span class=\"subst\">&#123;name&#125;</span>: factorial(<span class=\"subst\">&#123;number&#125;</span>), currently i = <span class=\"subst\">&#123;i&#125;</span>...&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">await</span> asyncio.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">        f *= i</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;任务 <span class=\"subst\">&#123;name&#125;</span>: factorial(<span class=\"subst\">&#123;number&#125;</span>) = <span class=\"subst\">&#123;f&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> f</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    L = <span class=\"keyword\">await</span> asyncio.gather(</span><br><span class=\"line\">        factorial(<span class=\"string\">&quot;A&quot;</span>, <span class=\"number\">2</span>),</span><br><span class=\"line\">        factorial(<span class=\"string\">&quot;B&quot;</span>, <span class=\"number\">3</span>),</span><br><span class=\"line\">        factorial(<span class=\"string\">&quot;C&quot;</span>, <span class=\"number\">4</span>),</span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(L)</span><br><span class=\"line\"></span><br><span class=\"line\">asyncio.run(main())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># output</span></span><br><span class=\"line\"><span class=\"comment\"># 任务名 A: factorial(2), currently i = 2...</span></span><br><span class=\"line\"><span class=\"comment\"># 任务名 B: factorial(3), currently i = 2...</span></span><br><span class=\"line\"><span class=\"comment\"># 任务名 C: factorial(4), currently i = 2...</span></span><br><span class=\"line\"><span class=\"comment\"># 任务 A: factorial(2) = 2</span></span><br><span class=\"line\"><span class=\"comment\"># 任务名 B: factorial(3), currently i = 3...</span></span><br><span class=\"line\"><span class=\"comment\"># 任务名 C: factorial(4), currently i = 3...</span></span><br><span class=\"line\"><span class=\"comment\"># 任务 B: factorial(3) = 6</span></span><br><span class=\"line\"><span class=\"comment\"># 任务名 C: factorial(4), currently i = 4...</span></span><br><span class=\"line\"><span class=\"comment\"># 任务 C: factorial(4) = 24</span></span><br><span class=\"line\"><span class=\"comment\"># [2, 6, 24]</span></span><br></pre></td></tr></table></figure>\n\n\n\n"},{"title":"django入门-环境搭建","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-07T07:56:49.000Z","pic":"Screenshot_8.webp","_content":"\n## 为什么要使用Django?\n\n`Django`是一个用`python`编写的Web框架。Web框架是一种软件，基于web框架可以开发动态网站，各种应用程序以及服务。它提供了一系列工具和功能，可以解决许多与Web开发相关的常见问题，比如∶ 安全功能，数据库访问，会话，模板处理，URL路由，国际化，本地化，等等。\n\n使用诸如 `Django` 之类的网络框架，使我们能够以标准化的方式快速开发安全可靠的Web应用程序，而无需重新发明轮子。\n\n那么，Django有什么特别之处呢? 对于初学者来说，它是一个`Python Web`框架，这意味着你可以受益于各种各样的开源库包。如果当你想要解决一个特定的问题的时候，可能有人已经为它实现了一个库来供你使用。`Django`是用python编写的最流行的web框架之一。它绝对是最完整的，提供了各种各样的开箱即用的功能，比如用于开发和测试的独立Web服务器，缓存，中间件系统，`ORM`，模板引擎，表单处理，基于`Python单元测试`的工具接口。`Django`还自带内部电池，提供内置应用程序，比如一个认证系统，一个可用于 `cRuD （增删改查）`操作并且自动生成页面的后台管理界面，生成订阅文档`（RSS/Atom）`，站点地图等。甚至在`django`中内建了一个`地理信息系统（GIS）框架`。\n\n## 安装\n\n通过虚拟环境安装，先安装虚拟环境。\n\n```python\npip install virtualenv\n```\n\n创建虚拟环境并激活，在虚拟环境下安装`django`。\n\n```python\nmkdir myproject\ncd myproject\nvirtualenv venv -p python3\n.\\venv\\Scripts\\activate.bat # 激活虚拟环境，在命令行前出现venv得命令，代表虚拟环境激活\npip install django\n```\n\n如果要退出虚拟环境，运行`deactive`就退出了虚拟环境。\n\n## 创建一个项目\n\n```python\ndjango-admin startproject myproject\n```\n\n执行上面的命令后，会在目录下生成基础文件夹结构。\n\n```shell\nvnev/\nmyproject/\n  - myproject/\n    -- asgi.py\n    -- settings.py\n    -- urls.py\n    -- wsgi.py\n    -- __init__.py\n  - manage.py\n```\n\n最初项目由五个文件构成：\n\n- `manage.py `：使用 `django-admin` 命令行工具得快捷方式。用于运行与项目相关得管理命令。\n- `__init__.py`：告诉python这个文件夹是一个python包\n- `seetings.py`：这个文件包含了所有得项目配置。\n- `urls.py`：这个文件负责映射项目中得路由和路径。\n- `wsgi.py`：该文件是用于部署得简单网关接口。\n\n`django`自带了一个简单得网络服务器。在开发过程中无需安装其他软件即可在本地运行项目，通过执行命令测试一些。\n\n```python\npython manage.py runserver\n\n# Django version 3.2.4, using settings 'myproject.settings'\n# Starting development server at http://127.0.0.1:8000/\n# Quit the server with CTRL-BREAK.\n```\n\n访问`http://127.0.0.1:8000/`，你可以看到下面页面。\n\n![](Screenshot_1.webp)\n\n使用`ctrl+c`来终止服务器。\n\n## Django应用\n\n在`Django`得哲学中，有两个重要概念：\n\n- app：是一个可以完成做某件事情得web应用程序。一个应用程序通常由一组models（数据库表），views（视图），templates（模板），tests（测试）组成。\n- project：是配置和应用程序得集合。一个项目可以由多个应用程序或一个应用程序组成。\n\n创建一个应用：\n\n```python\ndjango-admin startapp boards\n```\n\n执行上面的命令后，会在`myproject/`目录下生成`boards`文件夹。\n\n```shell\nvnev/\nmyproject/\n  - boards/\n      -- migrations/\n      -- admin.py\n      -- apps.py\n      -- models.py\n      -- tests.py\n      -- views.py\n      -- __init__.py\n  - myproject/\n      -- asgi.py\n      -- settings.py\n      -- urls.py\n      -- wsgi.py\n      -- __init__.py\n  - manage.py\n```\n\n文件作用介绍：\n\n- `migrations/`：在这个文件夹里，Django会存储一些文件跟踪models文件中创建得变更，用来保持数据库和models.py的同步。\n- `admin.py`：这个文件为一个django内置的应用程序Django Admin的配置文件。\n- `apps.py`：应用程序本身的配置文件。\n- `models.py`：定义web应用程序数据实列的地方，models会由Django自动转为数据库表。\n- `tests.py`：这个文件用来写当前应用程序的单元测试。\n- `views.py`：处理web应用程序请求（request）/响应（response）周期的文件。\n\n现在创建了第一个应用程序，来配置下项目以便启用这个应用程序。\n\n在`settings`文件中`INSTALLED_APPS`中添加这个应用：\n\n```python\nINSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n\n    'boards',\n]\n```\n\n## 创建视图\n\n现在来写第一个视图（view），打开boards应用程序中的views.py文件，并添加以下代码：\n\n```python\nfrom django.http import HttpResponse\n\ndef home(request):\n    return HttpResponse('hello World')\n```\n\n视图是接收`httprequest`对象并返回一个`httpresponse`对象的`python`函数。接收`request`作为参数并返回`response`作为结果。\n\n这里定义了一个简单的视图，命名为`home`，它只是简单返回一个信息，一个字符串`hello world`。\n\n接下来需要告诉`Django`什么时候会调用这个`view`。在`boards`文件夹下创建`urls.py`文件并添加以下内容中添加：\n\n```python\nfrom django.urls import path\n\nfrom . import views\n\nurlpatterns = [\n    path('', views.home, name='home'),\n]\n```\n\n下一步是要在根 `URLconf` 文件中指定我们创建的 `boards.urls`模块。在 `myproject/urls.py` 文件的 `urlpatterns` 列表里插入一个` include()`， 如下：\n\n```python\nfrom django.contrib import admin\nfrom django.urls import include, path\n\nurlpatterns = [\n    path('', include('boards.urls')),\n    path('admin/', admin.site.urls),\n]\n```\n\n函数 `include()` 允许引用其它 `URLconfs`。每当 `Django` 遇到 `include()` 时，它会截断与此项匹配的 `URL` 的部分，并将剩余的字符串发送到 `URLconf` 以供进一步处理。\n\n访问`http://127.0.0.1:8000/`，就会返回`hello world`。\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","source":"_posts/django入门及环境搭建.md","raw":"---\ntitle: django入门-环境搭建\ntags:\n  - django\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-07 15:56:49\ncategories: Django\npic: Screenshot_8.webp\n---\n\n## 为什么要使用Django?\n\n`Django`是一个用`python`编写的Web框架。Web框架是一种软件，基于web框架可以开发动态网站，各种应用程序以及服务。它提供了一系列工具和功能，可以解决许多与Web开发相关的常见问题，比如∶ 安全功能，数据库访问，会话，模板处理，URL路由，国际化，本地化，等等。\n\n使用诸如 `Django` 之类的网络框架，使我们能够以标准化的方式快速开发安全可靠的Web应用程序，而无需重新发明轮子。\n\n那么，Django有什么特别之处呢? 对于初学者来说，它是一个`Python Web`框架，这意味着你可以受益于各种各样的开源库包。如果当你想要解决一个特定的问题的时候，可能有人已经为它实现了一个库来供你使用。`Django`是用python编写的最流行的web框架之一。它绝对是最完整的，提供了各种各样的开箱即用的功能，比如用于开发和测试的独立Web服务器，缓存，中间件系统，`ORM`，模板引擎，表单处理，基于`Python单元测试`的工具接口。`Django`还自带内部电池，提供内置应用程序，比如一个认证系统，一个可用于 `cRuD （增删改查）`操作并且自动生成页面的后台管理界面，生成订阅文档`（RSS/Atom）`，站点地图等。甚至在`django`中内建了一个`地理信息系统（GIS）框架`。\n\n## 安装\n\n通过虚拟环境安装，先安装虚拟环境。\n\n```python\npip install virtualenv\n```\n\n创建虚拟环境并激活，在虚拟环境下安装`django`。\n\n```python\nmkdir myproject\ncd myproject\nvirtualenv venv -p python3\n.\\venv\\Scripts\\activate.bat # 激活虚拟环境，在命令行前出现venv得命令，代表虚拟环境激活\npip install django\n```\n\n如果要退出虚拟环境，运行`deactive`就退出了虚拟环境。\n\n## 创建一个项目\n\n```python\ndjango-admin startproject myproject\n```\n\n执行上面的命令后，会在目录下生成基础文件夹结构。\n\n```shell\nvnev/\nmyproject/\n  - myproject/\n    -- asgi.py\n    -- settings.py\n    -- urls.py\n    -- wsgi.py\n    -- __init__.py\n  - manage.py\n```\n\n最初项目由五个文件构成：\n\n- `manage.py `：使用 `django-admin` 命令行工具得快捷方式。用于运行与项目相关得管理命令。\n- `__init__.py`：告诉python这个文件夹是一个python包\n- `seetings.py`：这个文件包含了所有得项目配置。\n- `urls.py`：这个文件负责映射项目中得路由和路径。\n- `wsgi.py`：该文件是用于部署得简单网关接口。\n\n`django`自带了一个简单得网络服务器。在开发过程中无需安装其他软件即可在本地运行项目，通过执行命令测试一些。\n\n```python\npython manage.py runserver\n\n# Django version 3.2.4, using settings 'myproject.settings'\n# Starting development server at http://127.0.0.1:8000/\n# Quit the server with CTRL-BREAK.\n```\n\n访问`http://127.0.0.1:8000/`，你可以看到下面页面。\n\n![](Screenshot_1.webp)\n\n使用`ctrl+c`来终止服务器。\n\n## Django应用\n\n在`Django`得哲学中，有两个重要概念：\n\n- app：是一个可以完成做某件事情得web应用程序。一个应用程序通常由一组models（数据库表），views（视图），templates（模板），tests（测试）组成。\n- project：是配置和应用程序得集合。一个项目可以由多个应用程序或一个应用程序组成。\n\n创建一个应用：\n\n```python\ndjango-admin startapp boards\n```\n\n执行上面的命令后，会在`myproject/`目录下生成`boards`文件夹。\n\n```shell\nvnev/\nmyproject/\n  - boards/\n      -- migrations/\n      -- admin.py\n      -- apps.py\n      -- models.py\n      -- tests.py\n      -- views.py\n      -- __init__.py\n  - myproject/\n      -- asgi.py\n      -- settings.py\n      -- urls.py\n      -- wsgi.py\n      -- __init__.py\n  - manage.py\n```\n\n文件作用介绍：\n\n- `migrations/`：在这个文件夹里，Django会存储一些文件跟踪models文件中创建得变更，用来保持数据库和models.py的同步。\n- `admin.py`：这个文件为一个django内置的应用程序Django Admin的配置文件。\n- `apps.py`：应用程序本身的配置文件。\n- `models.py`：定义web应用程序数据实列的地方，models会由Django自动转为数据库表。\n- `tests.py`：这个文件用来写当前应用程序的单元测试。\n- `views.py`：处理web应用程序请求（request）/响应（response）周期的文件。\n\n现在创建了第一个应用程序，来配置下项目以便启用这个应用程序。\n\n在`settings`文件中`INSTALLED_APPS`中添加这个应用：\n\n```python\nINSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n\n    'boards',\n]\n```\n\n## 创建视图\n\n现在来写第一个视图（view），打开boards应用程序中的views.py文件，并添加以下代码：\n\n```python\nfrom django.http import HttpResponse\n\ndef home(request):\n    return HttpResponse('hello World')\n```\n\n视图是接收`httprequest`对象并返回一个`httpresponse`对象的`python`函数。接收`request`作为参数并返回`response`作为结果。\n\n这里定义了一个简单的视图，命名为`home`，它只是简单返回一个信息，一个字符串`hello world`。\n\n接下来需要告诉`Django`什么时候会调用这个`view`。在`boards`文件夹下创建`urls.py`文件并添加以下内容中添加：\n\n```python\nfrom django.urls import path\n\nfrom . import views\n\nurlpatterns = [\n    path('', views.home, name='home'),\n]\n```\n\n下一步是要在根 `URLconf` 文件中指定我们创建的 `boards.urls`模块。在 `myproject/urls.py` 文件的 `urlpatterns` 列表里插入一个` include()`， 如下：\n\n```python\nfrom django.contrib import admin\nfrom django.urls import include, path\n\nurlpatterns = [\n    path('', include('boards.urls')),\n    path('admin/', admin.site.urls),\n]\n```\n\n函数 `include()` 允许引用其它 `URLconfs`。每当 `Django` 遇到 `include()` 时，它会截断与此项匹配的 `URL` 的部分，并将剩余的字符串发送到 `URLconf` 以供进一步处理。\n\n访问`http://127.0.0.1:8000/`，就会返回`hello world`。\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","slug":"django入门及环境搭建","published":1,"updated":"2021-06-16T09:29:04.091Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2d001p44udgygwas9u","content":"<h2 id=\"为什么要使用Django\"><a href=\"#为什么要使用Django\" class=\"headerlink\" title=\"为什么要使用Django?\"></a>为什么要使用Django?</h2><p><code>Django</code>是一个用<code>python</code>编写的Web框架。Web框架是一种软件，基于web框架可以开发动态网站，各种应用程序以及服务。它提供了一系列工具和功能，可以解决许多与Web开发相关的常见问题，比如∶ 安全功能，数据库访问，会话，模板处理，URL路由，国际化，本地化，等等。</p>\n<p>使用诸如 <code>Django</code> 之类的网络框架，使我们能够以标准化的方式快速开发安全可靠的Web应用程序，而无需重新发明轮子。</p>\n<p>那么，Django有什么特别之处呢? 对于初学者来说，它是一个<code>Python Web</code>框架，这意味着你可以受益于各种各样的开源库包。如果当你想要解决一个特定的问题的时候，可能有人已经为它实现了一个库来供你使用。<code>Django</code>是用python编写的最流行的web框架之一。它绝对是最完整的，提供了各种各样的开箱即用的功能，比如用于开发和测试的独立Web服务器，缓存，中间件系统，<code>ORM</code>，模板引擎，表单处理，基于<code>Python单元测试</code>的工具接口。<code>Django</code>还自带内部电池，提供内置应用程序，比如一个认证系统，一个可用于 <code>cRuD （增删改查）</code>操作并且自动生成页面的后台管理界面，生成订阅文档<code>（RSS/Atom）</code>，站点地图等。甚至在<code>django</code>中内建了一个<code>地理信息系统（GIS）框架</code>。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>通过虚拟环境安装，先安装虚拟环境。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install virtualenv</span><br></pre></td></tr></table></figure>\n\n<p>创建虚拟环境并激活，在虚拟环境下安装<code>django</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir myproject</span><br><span class=\"line\">cd myproject</span><br><span class=\"line\">virtualenv venv -p python3</span><br><span class=\"line\">.\\venv\\Scripts\\activate.bat <span class=\"comment\"># 激活虚拟环境，在命令行前出现venv得命令，代表虚拟环境激活</span></span><br><span class=\"line\">pip install django</span><br></pre></td></tr></table></figure>\n\n<p>如果要退出虚拟环境，运行<code>deactive</code>就退出了虚拟环境。</p>\n<h2 id=\"创建一个项目\"><a href=\"#创建一个项目\" class=\"headerlink\" title=\"创建一个项目\"></a>创建一个项目</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">django-admin startproject myproject</span><br></pre></td></tr></table></figure>\n\n<p>执行上面的命令后，会在目录下生成基础文件夹结构。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vnev/</span><br><span class=\"line\">myproject/</span><br><span class=\"line\">  - myproject/</span><br><span class=\"line\">    -- asgi.py</span><br><span class=\"line\">    -- settings.py</span><br><span class=\"line\">    -- urls.py</span><br><span class=\"line\">    -- wsgi.py</span><br><span class=\"line\">    -- __init__.py</span><br><span class=\"line\">  - manage.py</span><br></pre></td></tr></table></figure>\n\n<p>最初项目由五个文件构成：</p>\n<ul>\n<li><code>manage.py </code>：使用 <code>django-admin</code> 命令行工具得快捷方式。用于运行与项目相关得管理命令。</li>\n<li><code>__init__.py</code>：告诉python这个文件夹是一个python包</li>\n<li><code>seetings.py</code>：这个文件包含了所有得项目配置。</li>\n<li><code>urls.py</code>：这个文件负责映射项目中得路由和路径。</li>\n<li><code>wsgi.py</code>：该文件是用于部署得简单网关接口。</li>\n</ul>\n<p><code>django</code>自带了一个简单得网络服务器。在开发过程中无需安装其他软件即可在本地运行项目，通过执行命令测试一些。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py runserver</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Django version 3.2.4, using settings &#x27;myproject.settings&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># Starting development server at http://127.0.0.1:8000/</span></span><br><span class=\"line\"><span class=\"comment\"># Quit the server with CTRL-BREAK.</span></span><br></pre></td></tr></table></figure>\n\n<p>访问<code>http://127.0.0.1:8000/</code>，你可以看到下面页面。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>使用<code>ctrl+c</code>来终止服务器。</p>\n<h2 id=\"Django应用\"><a href=\"#Django应用\" class=\"headerlink\" title=\"Django应用\"></a>Django应用</h2><p>在<code>Django</code>得哲学中，有两个重要概念：</p>\n<ul>\n<li>app：是一个可以完成做某件事情得web应用程序。一个应用程序通常由一组models（数据库表），views（视图），templates（模板），tests（测试）组成。</li>\n<li>project：是配置和应用程序得集合。一个项目可以由多个应用程序或一个应用程序组成。</li>\n</ul>\n<p>创建一个应用：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">django-admin startapp boards</span><br></pre></td></tr></table></figure>\n\n<p>执行上面的命令后，会在<code>myproject/</code>目录下生成<code>boards</code>文件夹。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vnev/</span><br><span class=\"line\">myproject/</span><br><span class=\"line\">  - boards/</span><br><span class=\"line\">      -- migrations/</span><br><span class=\"line\">      -- admin.py</span><br><span class=\"line\">      -- apps.py</span><br><span class=\"line\">      -- models.py</span><br><span class=\"line\">      -- tests.py</span><br><span class=\"line\">      -- views.py</span><br><span class=\"line\">      -- __init__.py</span><br><span class=\"line\">  - myproject/</span><br><span class=\"line\">      -- asgi.py</span><br><span class=\"line\">      -- settings.py</span><br><span class=\"line\">      -- urls.py</span><br><span class=\"line\">      -- wsgi.py</span><br><span class=\"line\">      -- __init__.py</span><br><span class=\"line\">  - manage.py</span><br></pre></td></tr></table></figure>\n\n<p>文件作用介绍：</p>\n<ul>\n<li><code>migrations/</code>：在这个文件夹里，Django会存储一些文件跟踪models文件中创建得变更，用来保持数据库和models.py的同步。</li>\n<li><code>admin.py</code>：这个文件为一个django内置的应用程序Django Admin的配置文件。</li>\n<li><code>apps.py</code>：应用程序本身的配置文件。</li>\n<li><code>models.py</code>：定义web应用程序数据实列的地方，models会由Django自动转为数据库表。</li>\n<li><code>tests.py</code>：这个文件用来写当前应用程序的单元测试。</li>\n<li><code>views.py</code>：处理web应用程序请求（request）/响应（response）周期的文件。</li>\n</ul>\n<p>现在创建了第一个应用程序，来配置下项目以便启用这个应用程序。</p>\n<p>在<code>settings</code>文件中<code>INSTALLED_APPS</code>中添加这个应用：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSTALLED_APPS = [</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&#x27;boards&#x27;</span>,</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建视图\"><a href=\"#创建视图\" class=\"headerlink\" title=\"创建视图\"></a>创建视图</h2><p>现在来写第一个视图（view），打开boards应用程序中的views.py文件，并添加以下代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.http <span class=\"keyword\">import</span> HttpResponse</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">home</span>(<span class=\"params\">request</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> HttpResponse(<span class=\"string\">&#x27;hello World&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>视图是接收<code>httprequest</code>对象并返回一个<code>httpresponse</code>对象的<code>python</code>函数。接收<code>request</code>作为参数并返回<code>response</code>作为结果。</p>\n<p>这里定义了一个简单的视图，命名为<code>home</code>，它只是简单返回一个信息，一个字符串<code>hello world</code>。</p>\n<p>接下来需要告诉<code>Django</code>什么时候会调用这个<code>view</code>。在<code>boards</code>文件夹下创建<code>urls.py</code>文件并添加以下内容中添加：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.urls <span class=\"keyword\">import</span> path</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> views</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, views.home, name=<span class=\"string\">&#x27;home&#x27;</span>),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>下一步是要在根 <code>URLconf</code> 文件中指定我们创建的 <code>boards.urls</code>模块。在 <code>myproject/urls.py</code> 文件的 <code>urlpatterns</code> 列表里插入一个<code> include()</code>， 如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.contrib <span class=\"keyword\">import</span> admin</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.urls <span class=\"keyword\">import</span> include, path</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, include(<span class=\"string\">&#x27;boards.urls&#x27;</span>)),</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>函数 <code>include()</code> 允许引用其它 <code>URLconfs</code>。每当 <code>Django</code> 遇到 <code>include()</code> 时，它会截断与此项匹配的 <code>URL</code> 的部分，并将剩余的字符串发送到 <code>URLconf</code> 以供进一步处理。</p>\n<p>访问<code>http://127.0.0.1:8000/</code>，就会返回<code>hello world</code>。</p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"为什么要使用Django\"><a href=\"#为什么要使用Django\" class=\"headerlink\" title=\"为什么要使用Django?\"></a>为什么要使用Django?</h2><p><code>Django</code>是一个用<code>python</code>编写的Web框架。Web框架是一种软件，基于web框架可以开发动态网站，各种应用程序以及服务。它提供了一系列工具和功能，可以解决许多与Web开发相关的常见问题，比如∶ 安全功能，数据库访问，会话，模板处理，URL路由，国际化，本地化，等等。</p>\n<p>使用诸如 <code>Django</code> 之类的网络框架，使我们能够以标准化的方式快速开发安全可靠的Web应用程序，而无需重新发明轮子。</p>\n<p>那么，Django有什么特别之处呢? 对于初学者来说，它是一个<code>Python Web</code>框架，这意味着你可以受益于各种各样的开源库包。如果当你想要解决一个特定的问题的时候，可能有人已经为它实现了一个库来供你使用。<code>Django</code>是用python编写的最流行的web框架之一。它绝对是最完整的，提供了各种各样的开箱即用的功能，比如用于开发和测试的独立Web服务器，缓存，中间件系统，<code>ORM</code>，模板引擎，表单处理，基于<code>Python单元测试</code>的工具接口。<code>Django</code>还自带内部电池，提供内置应用程序，比如一个认证系统，一个可用于 <code>cRuD （增删改查）</code>操作并且自动生成页面的后台管理界面，生成订阅文档<code>（RSS/Atom）</code>，站点地图等。甚至在<code>django</code>中内建了一个<code>地理信息系统（GIS）框架</code>。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>通过虚拟环境安装，先安装虚拟环境。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install virtualenv</span><br></pre></td></tr></table></figure>\n\n<p>创建虚拟环境并激活，在虚拟环境下安装<code>django</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir myproject</span><br><span class=\"line\">cd myproject</span><br><span class=\"line\">virtualenv venv -p python3</span><br><span class=\"line\">.\\venv\\Scripts\\activate.bat <span class=\"comment\"># 激活虚拟环境，在命令行前出现venv得命令，代表虚拟环境激活</span></span><br><span class=\"line\">pip install django</span><br></pre></td></tr></table></figure>\n\n<p>如果要退出虚拟环境，运行<code>deactive</code>就退出了虚拟环境。</p>\n<h2 id=\"创建一个项目\"><a href=\"#创建一个项目\" class=\"headerlink\" title=\"创建一个项目\"></a>创建一个项目</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">django-admin startproject myproject</span><br></pre></td></tr></table></figure>\n\n<p>执行上面的命令后，会在目录下生成基础文件夹结构。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vnev/</span><br><span class=\"line\">myproject/</span><br><span class=\"line\">  - myproject/</span><br><span class=\"line\">    -- asgi.py</span><br><span class=\"line\">    -- settings.py</span><br><span class=\"line\">    -- urls.py</span><br><span class=\"line\">    -- wsgi.py</span><br><span class=\"line\">    -- __init__.py</span><br><span class=\"line\">  - manage.py</span><br></pre></td></tr></table></figure>\n\n<p>最初项目由五个文件构成：</p>\n<ul>\n<li><code>manage.py </code>：使用 <code>django-admin</code> 命令行工具得快捷方式。用于运行与项目相关得管理命令。</li>\n<li><code>__init__.py</code>：告诉python这个文件夹是一个python包</li>\n<li><code>seetings.py</code>：这个文件包含了所有得项目配置。</li>\n<li><code>urls.py</code>：这个文件负责映射项目中得路由和路径。</li>\n<li><code>wsgi.py</code>：该文件是用于部署得简单网关接口。</li>\n</ul>\n<p><code>django</code>自带了一个简单得网络服务器。在开发过程中无需安装其他软件即可在本地运行项目，通过执行命令测试一些。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py runserver</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Django version 3.2.4, using settings &#x27;myproject.settings&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># Starting development server at http://127.0.0.1:8000/</span></span><br><span class=\"line\"><span class=\"comment\"># Quit the server with CTRL-BREAK.</span></span><br></pre></td></tr></table></figure>\n\n<p>访问<code>http://127.0.0.1:8000/</code>，你可以看到下面页面。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>使用<code>ctrl+c</code>来终止服务器。</p>\n<h2 id=\"Django应用\"><a href=\"#Django应用\" class=\"headerlink\" title=\"Django应用\"></a>Django应用</h2><p>在<code>Django</code>得哲学中，有两个重要概念：</p>\n<ul>\n<li>app：是一个可以完成做某件事情得web应用程序。一个应用程序通常由一组models（数据库表），views（视图），templates（模板），tests（测试）组成。</li>\n<li>project：是配置和应用程序得集合。一个项目可以由多个应用程序或一个应用程序组成。</li>\n</ul>\n<p>创建一个应用：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">django-admin startapp boards</span><br></pre></td></tr></table></figure>\n\n<p>执行上面的命令后，会在<code>myproject/</code>目录下生成<code>boards</code>文件夹。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vnev/</span><br><span class=\"line\">myproject/</span><br><span class=\"line\">  - boards/</span><br><span class=\"line\">      -- migrations/</span><br><span class=\"line\">      -- admin.py</span><br><span class=\"line\">      -- apps.py</span><br><span class=\"line\">      -- models.py</span><br><span class=\"line\">      -- tests.py</span><br><span class=\"line\">      -- views.py</span><br><span class=\"line\">      -- __init__.py</span><br><span class=\"line\">  - myproject/</span><br><span class=\"line\">      -- asgi.py</span><br><span class=\"line\">      -- settings.py</span><br><span class=\"line\">      -- urls.py</span><br><span class=\"line\">      -- wsgi.py</span><br><span class=\"line\">      -- __init__.py</span><br><span class=\"line\">  - manage.py</span><br></pre></td></tr></table></figure>\n\n<p>文件作用介绍：</p>\n<ul>\n<li><code>migrations/</code>：在这个文件夹里，Django会存储一些文件跟踪models文件中创建得变更，用来保持数据库和models.py的同步。</li>\n<li><code>admin.py</code>：这个文件为一个django内置的应用程序Django Admin的配置文件。</li>\n<li><code>apps.py</code>：应用程序本身的配置文件。</li>\n<li><code>models.py</code>：定义web应用程序数据实列的地方，models会由Django自动转为数据库表。</li>\n<li><code>tests.py</code>：这个文件用来写当前应用程序的单元测试。</li>\n<li><code>views.py</code>：处理web应用程序请求（request）/响应（response）周期的文件。</li>\n</ul>\n<p>现在创建了第一个应用程序，来配置下项目以便启用这个应用程序。</p>\n<p>在<code>settings</code>文件中<code>INSTALLED_APPS</code>中添加这个应用：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSTALLED_APPS = [</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&#x27;boards&#x27;</span>,</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建视图\"><a href=\"#创建视图\" class=\"headerlink\" title=\"创建视图\"></a>创建视图</h2><p>现在来写第一个视图（view），打开boards应用程序中的views.py文件，并添加以下代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.http <span class=\"keyword\">import</span> HttpResponse</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">home</span>(<span class=\"params\">request</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> HttpResponse(<span class=\"string\">&#x27;hello World&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>视图是接收<code>httprequest</code>对象并返回一个<code>httpresponse</code>对象的<code>python</code>函数。接收<code>request</code>作为参数并返回<code>response</code>作为结果。</p>\n<p>这里定义了一个简单的视图，命名为<code>home</code>，它只是简单返回一个信息，一个字符串<code>hello world</code>。</p>\n<p>接下来需要告诉<code>Django</code>什么时候会调用这个<code>view</code>。在<code>boards</code>文件夹下创建<code>urls.py</code>文件并添加以下内容中添加：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.urls <span class=\"keyword\">import</span> path</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> views</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, views.home, name=<span class=\"string\">&#x27;home&#x27;</span>),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>下一步是要在根 <code>URLconf</code> 文件中指定我们创建的 <code>boards.urls</code>模块。在 <code>myproject/urls.py</code> 文件的 <code>urlpatterns</code> 列表里插入一个<code> include()</code>， 如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.contrib <span class=\"keyword\">import</span> admin</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.urls <span class=\"keyword\">import</span> include, path</span><br><span class=\"line\"></span><br><span class=\"line\">urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;&#x27;</span>, include(<span class=\"string\">&#x27;boards.urls&#x27;</span>)),</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>函数 <code>include()</code> 允许引用其它 <code>URLconfs</code>。每当 <code>Django</code> 遇到 <code>include()</code> 时，它会截断与此项匹配的 <code>URL</code> 的部分，并将剩余的字符串发送到 <code>URLconf</code> 以供进一步处理。</p>\n<p>访问<code>http://127.0.0.1:8000/</code>，就会返回<code>hello world</code>。</p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n"},{"title":"docker的安装","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-20T08:45:41.000Z","pic":null,"_content":"\n\n## 安装环境\n\n安装环境是Centos环境，要求版本是` CentOS 7 or 8`以上。\n\n## 卸载旧版本的docker\n\n```shell\n sudo yum remove docker \\\n                  docker-client \\\n                  docker-client-latest \\\n                  docker-common \\\n                  docker-latest \\\n                  docker-latest-logrotate \\\n                  docker-logrotate \\\n                  docker-engine\n```\n\n## 使用yum仓库安装\n\n安装方式有很多种，可以参考官方文档。\n\n### 设置仓库源\n\n下载`yum-utils`工具包和稳固的安装源。\n\n```shell\nsudo yum install -y yum-utils\n\nsudo yum-config-manager \\\n    --add-repo \\\n    https://download.docker.com/linux/centos/docker-ce.repo\n```\n\n### 安装docker引擎\n\n- 1.安装最新版本\n\n```shell\nsudo yum install docker-ce docker-ce-cli containerd.io\n```\n\n- 2.安装特定版本\n\n列出可安装的版本。\n\n```python\nyum list docker-ce --showduplicates | sort -r\n```\n\n选择安装版本。\n\n```python\nsudo yum install docker-ce-<VERSION_STRING> docker-ce-cli-<VERSION_STRING> containerd.io\n```\n\n### 启动docker\n\n运行下列命令启动`docker`。\n\n```shell\nsudo systemctl start docker\n```\n\n测试`docker`安装正确。\n\n```python\nsudo docker run hello-world\n```\n\n## 卸载docker\n\n卸载docker和下载的容器及包：\n\n```shell\nsudo yum remove docker-ce docker-ce-cli containerd.io\n\n ```\n\n镜像等配置文件不会自动移除，需要手动删除。\n\n```shell\nsudo rm -rf /var/lib/docker\nsudo rm -rf /var/lib/containerd\n```\n","source":"_posts/docker的安装.md","raw":"---\ntitle: docker的安装\ntags:\n  - linux\n  - docker\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-20 16:45:41\ncategories: Linux\npic:\n---\n\n\n## 安装环境\n\n安装环境是Centos环境，要求版本是` CentOS 7 or 8`以上。\n\n## 卸载旧版本的docker\n\n```shell\n sudo yum remove docker \\\n                  docker-client \\\n                  docker-client-latest \\\n                  docker-common \\\n                  docker-latest \\\n                  docker-latest-logrotate \\\n                  docker-logrotate \\\n                  docker-engine\n```\n\n## 使用yum仓库安装\n\n安装方式有很多种，可以参考官方文档。\n\n### 设置仓库源\n\n下载`yum-utils`工具包和稳固的安装源。\n\n```shell\nsudo yum install -y yum-utils\n\nsudo yum-config-manager \\\n    --add-repo \\\n    https://download.docker.com/linux/centos/docker-ce.repo\n```\n\n### 安装docker引擎\n\n- 1.安装最新版本\n\n```shell\nsudo yum install docker-ce docker-ce-cli containerd.io\n```\n\n- 2.安装特定版本\n\n列出可安装的版本。\n\n```python\nyum list docker-ce --showduplicates | sort -r\n```\n\n选择安装版本。\n\n```python\nsudo yum install docker-ce-<VERSION_STRING> docker-ce-cli-<VERSION_STRING> containerd.io\n```\n\n### 启动docker\n\n运行下列命令启动`docker`。\n\n```shell\nsudo systemctl start docker\n```\n\n测试`docker`安装正确。\n\n```python\nsudo docker run hello-world\n```\n\n## 卸载docker\n\n卸载docker和下载的容器及包：\n\n```shell\nsudo yum remove docker-ce docker-ce-cli containerd.io\n\n ```\n\n镜像等配置文件不会自动移除，需要手动删除。\n\n```shell\nsudo rm -rf /var/lib/docker\nsudo rm -rf /var/lib/containerd\n```\n","slug":"docker的安装","published":1,"updated":"2021-06-15T03:24:11.488Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2e001s44udbzgcbtjj","content":"<h2 id=\"安装环境\"><a href=\"#安装环境\" class=\"headerlink\" title=\"安装环境\"></a>安装环境</h2><p>安装环境是Centos环境，要求版本是<code> CentOS 7 or 8</code>以上。</p>\n<h2 id=\"卸载旧版本的docker\"><a href=\"#卸载旧版本的docker\" class=\"headerlink\" title=\"卸载旧版本的docker\"></a>卸载旧版本的docker</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum remove docker \\</span><br><span class=\"line\">                 docker-client \\</span><br><span class=\"line\">                 docker-client-latest \\</span><br><span class=\"line\">                 docker-common \\</span><br><span class=\"line\">                 docker-latest \\</span><br><span class=\"line\">                 docker-latest-logrotate \\</span><br><span class=\"line\">                 docker-logrotate \\</span><br><span class=\"line\">                 docker-engine</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用yum仓库安装\"><a href=\"#使用yum仓库安装\" class=\"headerlink\" title=\"使用yum仓库安装\"></a>使用yum仓库安装</h2><p>安装方式有很多种，可以参考官方文档。</p>\n<h3 id=\"设置仓库源\"><a href=\"#设置仓库源\" class=\"headerlink\" title=\"设置仓库源\"></a>设置仓库源</h3><p>下载<code>yum-utils</code>工具包和稳固的安装源。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install -y yum-utils</span><br><span class=\"line\"></span><br><span class=\"line\">sudo yum-config-manager \\</span><br><span class=\"line\">    --add-repo \\</span><br><span class=\"line\">    https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装docker引擎\"><a href=\"#安装docker引擎\" class=\"headerlink\" title=\"安装docker引擎\"></a>安装docker引擎</h3><ul>\n<li>1.安装最新版本</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>2.安装特定版本</li>\n</ul>\n<p>列出可安装的版本。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum <span class=\"built_in\">list</span> docker-ce --showduplicates | sort -r</span><br></pre></td></tr></table></figure>\n\n<p>选择安装版本。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动docker\"><a href=\"#启动docker\" class=\"headerlink\" title=\"启动docker\"></a>启动docker</h3><p>运行下列命令启动<code>docker</code>。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl start docker</span><br></pre></td></tr></table></figure>\n\n<p>测试<code>docker</code>安装正确。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run hello-world</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"卸载docker\"><a href=\"#卸载docker\" class=\"headerlink\" title=\"卸载docker\"></a>卸载docker</h2><p>卸载docker和下载的容器及包：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum remove docker-ce docker-ce-cli containerd.io</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>镜像等配置文件不会自动移除，需要手动删除。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo rm -rf /var/lib/docker</span><br><span class=\"line\">sudo rm -rf /var/lib/containerd</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"安装环境\"><a href=\"#安装环境\" class=\"headerlink\" title=\"安装环境\"></a>安装环境</h2><p>安装环境是Centos环境，要求版本是<code> CentOS 7 or 8</code>以上。</p>\n<h2 id=\"卸载旧版本的docker\"><a href=\"#卸载旧版本的docker\" class=\"headerlink\" title=\"卸载旧版本的docker\"></a>卸载旧版本的docker</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum remove docker \\</span><br><span class=\"line\">                 docker-client \\</span><br><span class=\"line\">                 docker-client-latest \\</span><br><span class=\"line\">                 docker-common \\</span><br><span class=\"line\">                 docker-latest \\</span><br><span class=\"line\">                 docker-latest-logrotate \\</span><br><span class=\"line\">                 docker-logrotate \\</span><br><span class=\"line\">                 docker-engine</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用yum仓库安装\"><a href=\"#使用yum仓库安装\" class=\"headerlink\" title=\"使用yum仓库安装\"></a>使用yum仓库安装</h2><p>安装方式有很多种，可以参考官方文档。</p>\n<h3 id=\"设置仓库源\"><a href=\"#设置仓库源\" class=\"headerlink\" title=\"设置仓库源\"></a>设置仓库源</h3><p>下载<code>yum-utils</code>工具包和稳固的安装源。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install -y yum-utils</span><br><span class=\"line\"></span><br><span class=\"line\">sudo yum-config-manager \\</span><br><span class=\"line\">    --add-repo \\</span><br><span class=\"line\">    https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装docker引擎\"><a href=\"#安装docker引擎\" class=\"headerlink\" title=\"安装docker引擎\"></a>安装docker引擎</h3><ul>\n<li>1.安装最新版本</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>2.安装特定版本</li>\n</ul>\n<p>列出可安装的版本。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum <span class=\"built_in\">list</span> docker-ce --showduplicates | sort -r</span><br></pre></td></tr></table></figure>\n\n<p>选择安装版本。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动docker\"><a href=\"#启动docker\" class=\"headerlink\" title=\"启动docker\"></a>启动docker</h3><p>运行下列命令启动<code>docker</code>。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl start docker</span><br></pre></td></tr></table></figure>\n\n<p>测试<code>docker</code>安装正确。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run hello-world</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"卸载docker\"><a href=\"#卸载docker\" class=\"headerlink\" title=\"卸载docker\"></a>卸载docker</h2><p>卸载docker和下载的容器及包：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum remove docker-ce docker-ce-cli containerd.io</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>镜像等配置文件不会自动移除，需要手动删除。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo rm -rf /var/lib/docker</span><br><span class=\"line\">sudo rm -rf /var/lib/containerd</span><br></pre></td></tr></table></figure>\n"},{"title":"Git常用命令","date":"2021-05-08T10:03:19.000Z","pic":null,"comments":1,"toc":true,"only":["home","category","tag"],"_content":"\n# Git常用命令\n\n## 仓库\n\n在当前目录新建一个Git代码库\n\n```shell\ngit init\n```\n\n新建一个目录，将其初始化为Git代码库\n\n```shell\ngit init [project-name]\n```\n\n下载一个项目和它的整个代码历史\n\n```shell\ngit clone [url]\n```\n\n## 配置\n\n显示当前的Git配置\n\n```shell\ngit config --list\n```\n\n编辑Git配置文件\n\n```shell\ngit config -e [--global]\n```\n\n设置提交代码时的用户信息\n\n```shell\ngit config [--global] user.name \"[name]\"\ngit config [--global] user.email \"[email address]\"\n```\n\n## 增加/删除文件\n\n添加指定文件到暂存区\n\n```shell\ngit add [file1] [file2] ...\n```\n\n添加指定目录到暂存区，包括子目录\n\n```shell\ngit add [dir]\n```\n\n添加当前目录的所有文件到暂存区\n\n```shell\ngit add .\n```\n\n## 添加每个变化前，都会要求确认\n\n对于同一个文件的多处变化，可以实现分次提交\n\n```shell\ngit add -p\n````\n\n删除工作区文件，并且将这次删除放入暂存区\n\n```shell\ngit rm [file1] [file2] ...\n```\n\n停止追踪指定文件，但该文件会保留在工作区\n\n```shell\ngit rm --cached [file]\n```\n\n改名文件，并且将这个改名放入暂存区\n\n```shell\ngit mv [file-original] [file-renamed]\n```\n\n## 代码提交\n\n提交暂存区到仓库区\n\n```shell\ngit commit -m [message]\n```\n\n提交暂存区的指定文件到仓库区\n\n```shell\ngit commit [file1] [file2] ... -m [message]\n```\n\n提交工作区自上次commit之后的变化，直接到仓库区\n\n```shell\ngit commit -a\n```\n\n提交时显示所有diff信息\n\n```shell\ngit commit -v\n```\n\n使用一次新的commit，替代上一次提交,如果代码没有任何新变化，则用来改写上一次commit的提交信息\n\n```shell\ngit commit --amend -m [message]\n```\n\n重做上一次commit，并包括指定文件的新变化\n\n```shell\ngit commit --amend [file1] [file2] ...\n```\n\n## 分支\n\n列出所有本地分支\n\n```shell\ngit branch\n```\n\n列出所有远程分支\n\n```shell\ngit branch -r\n```\n\n列出所有本地分支和远程分支\n\n```shell\ngit branch -a\n```\n\n新建一个分支，但依然停留在当前分支\n\n```shell\ngit branch [branch-name]\n```\n\n新建一个分支，并切换到该分支\n\n```shell\ngit checkout -b [branch]\n```\n\n新建一个分支，指向指定commit\n\n```shell\ngit branch [branch] [commit]\n```\n\n新建一个分支，与指定的远程分支建立追踪关系\n\n```shell\ngit branch --track [branch] [remote-branch]\n```\n\n切换到指定分支，并更新工作区\n\n```shell\ngit checkout [branch-name]\n```\n\n切换到上一个分支\n\n```shell\ngit checkout -\n```\n\n建立追踪关系，在现有分支与指定的远程分支之间\n\n```shell\ngit branch --set-upstream [branch] [remote-branch]\n```\n\n合并指定分支到当前分支\n\n```shell\ngit merge [branch]\n```\n\n选择一个commit，合并进当前分支\n\n```shell\ngit cherry-pick [commit]\n```\n\n删除分支\n\n```shell\ngit branch -d [branch-name]\n```\n\n删除远程分支\n\n```shell\ngit push origin --delete [branch-name]\ngit branch -dr [remote/branch]\n```\n\n## 标签\n\n列出所有tag\n\n```shell\ngit tag\n```\n\n新建一个tag在当前commit\n\n```shell\ngit tag [tag]\n```\n\n新建一个tag在指定commit\n\n```shell\ngit tag [tag] [commit]\n```\n\n删除本地tag\n\n```shell\ngit tag -d [tag]\n```\n\n删除远程tag\n\n```shell\ngit push origin :refs/tags/[tagName]\n```\n\n查看tag信息\n\n```shell\ngit show [tag]\n```\n\n提交指定tag\n\n```shell\ngit push [remote] [tag]\n```\n\n提交所有tag\n\n```shell\ngit push [remote] --tags\n```\n\n新建一个分支，指向某个tag\n\n```shell\ngit checkout -b [branch] [tag]\n```\n\n## 查看信息\n\n显示有变更的文件\n\n```shell\ngit status\n```\n\n显示当前分支的版本历史\n\n```shell\ngit log\n```\n\n显示commit历史，以及每次commit发生变更的文件\n\n```shell\ngit log --stat\n```\n\n搜索提交历史，根据关键词\n\n```shell\ngit log -S [keyword]\n```\n\n显示某个commit之后的所有变动，每个commit占据一行\n\n```shell\ngit log [tag] HEAD --pretty=format:%s\n```\n\n显示某个commit之后的所有变动，其\"提交说明\"必须符合搜索条件\n\n```shell\ngit log [tag] HEAD --grep feature\n```\n\n显示某个文件的版本历史，包括文件改名\n\n```shell\ngit log --follow [file]\ngit whatchanged [file]\n```\n\n显示指定文件相关的每一次diff\n\n```shell\ngit log -p [file]\n```\n\n显示过去5次提交\n\n```shell\ngit log -5 --pretty --oneline\n```\n\n显示所有提交过的用户，按提交次数排序\n\n```shell\ngit shortlog -sn\n```\n\n显示指定文件是什么人在什么时间修改过\n\n```shell\ngit blame [file]\n```\n\n显示暂存区和工作区的差异\n\n```shell\ngit diff\n```\n\n显示暂存区和上一个commit的差异\n\n```shell\ngit diff --cached [file]\n```\n\n显示工作区与当前分支最新commit之间的差异\n\n```shell\ngit diff HEAD\n```\n\n显示两次提交之间的差异\n\n```shell\ngit diff [first-branch]...[second-branch]\n```\n\n显示今天你写了多少行代码\n\n```shell\ngit diff --shortstat \"@{0 day ago}\"\n```\n\n显示某次提交的元数据和内容变化\n\n```shell\ngit show [commit]\n```\n\n显示某次提交发生变化的文件\n\n```shell\ngit show --name-only [commit]\n```\n\n显示某次提交时，某个文件的内容\n\n```shell\ngit show [commit]:[filename]\n```\n\n显示当前分支的最近几次提交\n\n```shell\ngit reflog\n```\n\n## 远程同步\n\n下载远程仓库的所有变动\n\n```shell\ngit fetch [remote]\n```\n\n显示所有远程仓库\n\n```shell\ngit remote -v\n```\n\n显示某个远程仓库的信息\n\n```shell\ngit remote show [remote]\n```\n\n增加一个新的远程仓库，并命名\n\n```shell\ngit remote add [shortname] [url]\n```\n\n取回远程仓库的变化，并与本地分支合并\n\n```shell\ngit pull [remote] [branch]\n```\n\n上传本地指定分支到远程仓库\n\n```shell\ngit push [remote] [branch]\n```\n\n强行推送当前分支到远程仓库，即使有冲突\n\n```shell\ngit push [remote] --force\n```\n\n推送所有分支到远程仓库\n\n```shell\ngit push [remote] --all\n```\n\n## 撤销\n\n恢复暂存区的指定文件到工作区\n\n```shell\ngit checkout [file]\n```\n\n恢复某个commit的指定文件到暂存区和工作区\n\n```shell\ngit checkout [commit] [file]\n```\n\n恢复暂存区的所有文件到工作区\n\n```shell\ngit checkout .\n```\n\n重置暂存区的指定文件，与上一次commit保持一致，但工作区不变\n\n```shell\ngit reset [file]\n```\n\n重置暂存区与工作区，与上一次commit保持一致\n\n```shell\ngit reset --hard\n```\n\n重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变\n\n```shell\ngit reset [commit]\n```\n\n重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致\n\n```shell\ngit reset --hard [commit]\n```\n\n重置当前HEAD为指定commit，但保持暂存区和工作区不变\n\n```shell\ngit reset --keep [commit]\n```\n\n新建一个commit，用来撤销指定commit，后者的所有变化都将被前者抵消，并且应用到当前分支\n\n```shell\ngit revert [commit]\n```\n\n暂时将未提交的变化移除，稍后再移入\n\n```shell\ngit stash\ngit stash pop\n```\n\n## 其他\n\n生成一个可供发布的压缩包\n\n```shell\ngit archive\n```\n","source":"_posts/git常用命令.md","raw":"---\ntitle: Git常用命令\ndate: 2021-05-08 18:03:19\ncategories: Git\ntags:\n- Git\n# sticky: 100\npic:\ncomments: true\ntoc: true\nonly:\n- home\n- category\n- tag\n---\n\n# Git常用命令\n\n## 仓库\n\n在当前目录新建一个Git代码库\n\n```shell\ngit init\n```\n\n新建一个目录，将其初始化为Git代码库\n\n```shell\ngit init [project-name]\n```\n\n下载一个项目和它的整个代码历史\n\n```shell\ngit clone [url]\n```\n\n## 配置\n\n显示当前的Git配置\n\n```shell\ngit config --list\n```\n\n编辑Git配置文件\n\n```shell\ngit config -e [--global]\n```\n\n设置提交代码时的用户信息\n\n```shell\ngit config [--global] user.name \"[name]\"\ngit config [--global] user.email \"[email address]\"\n```\n\n## 增加/删除文件\n\n添加指定文件到暂存区\n\n```shell\ngit add [file1] [file2] ...\n```\n\n添加指定目录到暂存区，包括子目录\n\n```shell\ngit add [dir]\n```\n\n添加当前目录的所有文件到暂存区\n\n```shell\ngit add .\n```\n\n## 添加每个变化前，都会要求确认\n\n对于同一个文件的多处变化，可以实现分次提交\n\n```shell\ngit add -p\n````\n\n删除工作区文件，并且将这次删除放入暂存区\n\n```shell\ngit rm [file1] [file2] ...\n```\n\n停止追踪指定文件，但该文件会保留在工作区\n\n```shell\ngit rm --cached [file]\n```\n\n改名文件，并且将这个改名放入暂存区\n\n```shell\ngit mv [file-original] [file-renamed]\n```\n\n## 代码提交\n\n提交暂存区到仓库区\n\n```shell\ngit commit -m [message]\n```\n\n提交暂存区的指定文件到仓库区\n\n```shell\ngit commit [file1] [file2] ... -m [message]\n```\n\n提交工作区自上次commit之后的变化，直接到仓库区\n\n```shell\ngit commit -a\n```\n\n提交时显示所有diff信息\n\n```shell\ngit commit -v\n```\n\n使用一次新的commit，替代上一次提交,如果代码没有任何新变化，则用来改写上一次commit的提交信息\n\n```shell\ngit commit --amend -m [message]\n```\n\n重做上一次commit，并包括指定文件的新变化\n\n```shell\ngit commit --amend [file1] [file2] ...\n```\n\n## 分支\n\n列出所有本地分支\n\n```shell\ngit branch\n```\n\n列出所有远程分支\n\n```shell\ngit branch -r\n```\n\n列出所有本地分支和远程分支\n\n```shell\ngit branch -a\n```\n\n新建一个分支，但依然停留在当前分支\n\n```shell\ngit branch [branch-name]\n```\n\n新建一个分支，并切换到该分支\n\n```shell\ngit checkout -b [branch]\n```\n\n新建一个分支，指向指定commit\n\n```shell\ngit branch [branch] [commit]\n```\n\n新建一个分支，与指定的远程分支建立追踪关系\n\n```shell\ngit branch --track [branch] [remote-branch]\n```\n\n切换到指定分支，并更新工作区\n\n```shell\ngit checkout [branch-name]\n```\n\n切换到上一个分支\n\n```shell\ngit checkout -\n```\n\n建立追踪关系，在现有分支与指定的远程分支之间\n\n```shell\ngit branch --set-upstream [branch] [remote-branch]\n```\n\n合并指定分支到当前分支\n\n```shell\ngit merge [branch]\n```\n\n选择一个commit，合并进当前分支\n\n```shell\ngit cherry-pick [commit]\n```\n\n删除分支\n\n```shell\ngit branch -d [branch-name]\n```\n\n删除远程分支\n\n```shell\ngit push origin --delete [branch-name]\ngit branch -dr [remote/branch]\n```\n\n## 标签\n\n列出所有tag\n\n```shell\ngit tag\n```\n\n新建一个tag在当前commit\n\n```shell\ngit tag [tag]\n```\n\n新建一个tag在指定commit\n\n```shell\ngit tag [tag] [commit]\n```\n\n删除本地tag\n\n```shell\ngit tag -d [tag]\n```\n\n删除远程tag\n\n```shell\ngit push origin :refs/tags/[tagName]\n```\n\n查看tag信息\n\n```shell\ngit show [tag]\n```\n\n提交指定tag\n\n```shell\ngit push [remote] [tag]\n```\n\n提交所有tag\n\n```shell\ngit push [remote] --tags\n```\n\n新建一个分支，指向某个tag\n\n```shell\ngit checkout -b [branch] [tag]\n```\n\n## 查看信息\n\n显示有变更的文件\n\n```shell\ngit status\n```\n\n显示当前分支的版本历史\n\n```shell\ngit log\n```\n\n显示commit历史，以及每次commit发生变更的文件\n\n```shell\ngit log --stat\n```\n\n搜索提交历史，根据关键词\n\n```shell\ngit log -S [keyword]\n```\n\n显示某个commit之后的所有变动，每个commit占据一行\n\n```shell\ngit log [tag] HEAD --pretty=format:%s\n```\n\n显示某个commit之后的所有变动，其\"提交说明\"必须符合搜索条件\n\n```shell\ngit log [tag] HEAD --grep feature\n```\n\n显示某个文件的版本历史，包括文件改名\n\n```shell\ngit log --follow [file]\ngit whatchanged [file]\n```\n\n显示指定文件相关的每一次diff\n\n```shell\ngit log -p [file]\n```\n\n显示过去5次提交\n\n```shell\ngit log -5 --pretty --oneline\n```\n\n显示所有提交过的用户，按提交次数排序\n\n```shell\ngit shortlog -sn\n```\n\n显示指定文件是什么人在什么时间修改过\n\n```shell\ngit blame [file]\n```\n\n显示暂存区和工作区的差异\n\n```shell\ngit diff\n```\n\n显示暂存区和上一个commit的差异\n\n```shell\ngit diff --cached [file]\n```\n\n显示工作区与当前分支最新commit之间的差异\n\n```shell\ngit diff HEAD\n```\n\n显示两次提交之间的差异\n\n```shell\ngit diff [first-branch]...[second-branch]\n```\n\n显示今天你写了多少行代码\n\n```shell\ngit diff --shortstat \"@{0 day ago}\"\n```\n\n显示某次提交的元数据和内容变化\n\n```shell\ngit show [commit]\n```\n\n显示某次提交发生变化的文件\n\n```shell\ngit show --name-only [commit]\n```\n\n显示某次提交时，某个文件的内容\n\n```shell\ngit show [commit]:[filename]\n```\n\n显示当前分支的最近几次提交\n\n```shell\ngit reflog\n```\n\n## 远程同步\n\n下载远程仓库的所有变动\n\n```shell\ngit fetch [remote]\n```\n\n显示所有远程仓库\n\n```shell\ngit remote -v\n```\n\n显示某个远程仓库的信息\n\n```shell\ngit remote show [remote]\n```\n\n增加一个新的远程仓库，并命名\n\n```shell\ngit remote add [shortname] [url]\n```\n\n取回远程仓库的变化，并与本地分支合并\n\n```shell\ngit pull [remote] [branch]\n```\n\n上传本地指定分支到远程仓库\n\n```shell\ngit push [remote] [branch]\n```\n\n强行推送当前分支到远程仓库，即使有冲突\n\n```shell\ngit push [remote] --force\n```\n\n推送所有分支到远程仓库\n\n```shell\ngit push [remote] --all\n```\n\n## 撤销\n\n恢复暂存区的指定文件到工作区\n\n```shell\ngit checkout [file]\n```\n\n恢复某个commit的指定文件到暂存区和工作区\n\n```shell\ngit checkout [commit] [file]\n```\n\n恢复暂存区的所有文件到工作区\n\n```shell\ngit checkout .\n```\n\n重置暂存区的指定文件，与上一次commit保持一致，但工作区不变\n\n```shell\ngit reset [file]\n```\n\n重置暂存区与工作区，与上一次commit保持一致\n\n```shell\ngit reset --hard\n```\n\n重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变\n\n```shell\ngit reset [commit]\n```\n\n重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致\n\n```shell\ngit reset --hard [commit]\n```\n\n重置当前HEAD为指定commit，但保持暂存区和工作区不变\n\n```shell\ngit reset --keep [commit]\n```\n\n新建一个commit，用来撤销指定commit，后者的所有变化都将被前者抵消，并且应用到当前分支\n\n```shell\ngit revert [commit]\n```\n\n暂时将未提交的变化移除，稍后再移入\n\n```shell\ngit stash\ngit stash pop\n```\n\n## 其他\n\n生成一个可供发布的压缩包\n\n```shell\ngit archive\n```\n","slug":"git常用命令","published":1,"updated":"2021-06-15T03:24:11.488Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2f001w44ud5mwg942g","content":"<h1 id=\"Git常用命令\"><a href=\"#Git常用命令\" class=\"headerlink\" title=\"Git常用命令\"></a>Git常用命令</h1><h2 id=\"仓库\"><a href=\"#仓库\" class=\"headerlink\" title=\"仓库\"></a>仓库</h2><p>在当前目录新建一个Git代码库</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git init</span><br></pre></td></tr></table></figure>\n\n<p>新建一个目录，将其初始化为Git代码库</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git init [project-name]</span><br></pre></td></tr></table></figure>\n\n<p>下载一个项目和它的整个代码历史</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone [url]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>显示当前的Git配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --list</span><br></pre></td></tr></table></figure>\n\n<p>编辑Git配置文件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config -e [--global]</span><br></pre></td></tr></table></figure>\n\n<p>设置提交代码时的用户信息</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config [--global] user.name &quot;[name]&quot;</span><br><span class=\"line\">git config [--global] user.email &quot;[email address]&quot;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"增加-删除文件\"><a href=\"#增加-删除文件\" class=\"headerlink\" title=\"增加/删除文件\"></a>增加/删除文件</h2><p>添加指定文件到暂存区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add [file1] [file2] ...</span><br></pre></td></tr></table></figure>\n\n<p>添加指定目录到暂存区，包括子目录</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add [dir]</span><br></pre></td></tr></table></figure>\n\n<p>添加当前目录的所有文件到暂存区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"添加每个变化前，都会要求确认\"><a href=\"#添加每个变化前，都会要求确认\" class=\"headerlink\" title=\"添加每个变化前，都会要求确认\"></a>添加每个变化前，都会要求确认</h2><p>对于同一个文件的多处变化，可以实现分次提交</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add -p</span><br><span class=\"line\">````</span><br><span class=\"line\"></span><br><span class=\"line\">删除工作区文件，并且将这次删除放入暂存区</span><br><span class=\"line\"></span><br><span class=\"line\">```shell</span><br><span class=\"line\">git rm [file1] [file2] ...</span><br></pre></td></tr></table></figure>\n\n<p>停止追踪指定文件，但该文件会保留在工作区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git rm --cached [file]</span><br></pre></td></tr></table></figure>\n\n<p>改名文件，并且将这个改名放入暂存区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git mv [file-original] [file-renamed]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"代码提交\"><a href=\"#代码提交\" class=\"headerlink\" title=\"代码提交\"></a>代码提交</h2><p>提交暂存区到仓库区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit -m [message]</span><br></pre></td></tr></table></figure>\n\n<p>提交暂存区的指定文件到仓库区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit [file1] [file2] ... -m [message]</span><br></pre></td></tr></table></figure>\n\n<p>提交工作区自上次commit之后的变化，直接到仓库区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit -a</span><br></pre></td></tr></table></figure>\n\n<p>提交时显示所有diff信息</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit -v</span><br></pre></td></tr></table></figure>\n\n<p>使用一次新的commit，替代上一次提交,如果代码没有任何新变化，则用来改写上一次commit的提交信息</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit --amend -m [message]</span><br></pre></td></tr></table></figure>\n\n<p>重做上一次commit，并包括指定文件的新变化</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"分支\"><a href=\"#分支\" class=\"headerlink\" title=\"分支\"></a>分支</h2><p>列出所有本地分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch</span><br></pre></td></tr></table></figure>\n\n<p>列出所有远程分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -r</span><br></pre></td></tr></table></figure>\n\n<p>列出所有本地分支和远程分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -a</span><br></pre></td></tr></table></figure>\n\n<p>新建一个分支，但依然停留在当前分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch [branch-name]</span><br></pre></td></tr></table></figure>\n\n<p>新建一个分支，并切换到该分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b [branch]</span><br></pre></td></tr></table></figure>\n\n<p>新建一个分支，指向指定commit</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch [branch] [commit]</span><br></pre></td></tr></table></figure>\n\n<p>新建一个分支，与指定的远程分支建立追踪关系</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch --track [branch] [remote-branch]</span><br></pre></td></tr></table></figure>\n\n<p>切换到指定分支，并更新工作区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout [branch-name]</span><br></pre></td></tr></table></figure>\n\n<p>切换到上一个分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -</span><br></pre></td></tr></table></figure>\n\n<p>建立追踪关系，在现有分支与指定的远程分支之间</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch --set-upstream [branch] [remote-branch]</span><br></pre></td></tr></table></figure>\n\n<p>合并指定分支到当前分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git merge [branch]</span><br></pre></td></tr></table></figure>\n\n<p>选择一个commit，合并进当前分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git cherry-pick [commit]</span><br></pre></td></tr></table></figure>\n\n<p>删除分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -d [branch-name]</span><br></pre></td></tr></table></figure>\n\n<p>删除远程分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin --delete [branch-name]</span><br><span class=\"line\">git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"标签\"><a href=\"#标签\" class=\"headerlink\" title=\"标签\"></a>标签</h2><p>列出所有tag</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag</span><br></pre></td></tr></table></figure>\n\n<p>新建一个tag在当前commit</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag [tag]</span><br></pre></td></tr></table></figure>\n\n<p>新建一个tag在指定commit</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag [tag] [commit]</span><br></pre></td></tr></table></figure>\n\n<p>删除本地tag</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag -d [tag]</span><br></pre></td></tr></table></figure>\n\n<p>删除远程tag</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin :refs/tags/[tagName]</span><br></pre></td></tr></table></figure>\n\n<p>查看tag信息</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git show [tag]</span><br></pre></td></tr></table></figure>\n\n<p>提交指定tag</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push [remote] [tag]</span><br></pre></td></tr></table></figure>\n\n<p>提交所有tag</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push [remote] --tags</span><br></pre></td></tr></table></figure>\n\n<p>新建一个分支，指向某个tag</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b [branch] [tag]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"查看信息\"><a href=\"#查看信息\" class=\"headerlink\" title=\"查看信息\"></a>查看信息</h2><p>显示有变更的文件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git status</span><br></pre></td></tr></table></figure>\n\n<p>显示当前分支的版本历史</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log</span><br></pre></td></tr></table></figure>\n\n<p>显示commit历史，以及每次commit发生变更的文件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log --stat</span><br></pre></td></tr></table></figure>\n\n<p>搜索提交历史，根据关键词</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log -S [keyword]</span><br></pre></td></tr></table></figure>\n\n<p>显示某个commit之后的所有变动，每个commit占据一行</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log [tag] HEAD --pretty=format:%s</span><br></pre></td></tr></table></figure>\n\n<p>显示某个commit之后的所有变动，其”提交说明”必须符合搜索条件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log [tag] HEAD --grep feature</span><br></pre></td></tr></table></figure>\n\n<p>显示某个文件的版本历史，包括文件改名</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log --follow [file]</span><br><span class=\"line\">git whatchanged [file]</span><br></pre></td></tr></table></figure>\n\n<p>显示指定文件相关的每一次diff</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log -p [file]</span><br></pre></td></tr></table></figure>\n\n<p>显示过去5次提交</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log -5 --pretty --oneline</span><br></pre></td></tr></table></figure>\n\n<p>显示所有提交过的用户，按提交次数排序</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git shortlog -sn</span><br></pre></td></tr></table></figure>\n\n<p>显示指定文件是什么人在什么时间修改过</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git blame [file]</span><br></pre></td></tr></table></figure>\n\n<p>显示暂存区和工作区的差异</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git diff</span><br></pre></td></tr></table></figure>\n\n<p>显示暂存区和上一个commit的差异</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git diff --cached [file]</span><br></pre></td></tr></table></figure>\n\n<p>显示工作区与当前分支最新commit之间的差异</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git diff HEAD</span><br></pre></td></tr></table></figure>\n\n<p>显示两次提交之间的差异</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git diff [first-branch]...[second-branch]</span><br></pre></td></tr></table></figure>\n\n<p>显示今天你写了多少行代码</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git diff --shortstat &quot;@&#123;0 day ago&#125;&quot;</span><br></pre></td></tr></table></figure>\n\n<p>显示某次提交的元数据和内容变化</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git show [commit]</span><br></pre></td></tr></table></figure>\n\n<p>显示某次提交发生变化的文件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git show --name-only [commit]</span><br></pre></td></tr></table></figure>\n\n<p>显示某次提交时，某个文件的内容</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git show [commit]:[filename]</span><br></pre></td></tr></table></figure>\n\n<p>显示当前分支的最近几次提交</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reflog</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"远程同步\"><a href=\"#远程同步\" class=\"headerlink\" title=\"远程同步\"></a>远程同步</h2><p>下载远程仓库的所有变动</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git fetch [remote]</span><br></pre></td></tr></table></figure>\n\n<p>显示所有远程仓库</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote -v</span><br></pre></td></tr></table></figure>\n\n<p>显示某个远程仓库的信息</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote show [remote]</span><br></pre></td></tr></table></figure>\n\n<p>增加一个新的远程仓库，并命名</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote add [shortname] [url]</span><br></pre></td></tr></table></figure>\n\n<p>取回远程仓库的变化，并与本地分支合并</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git pull [remote] [branch]</span><br></pre></td></tr></table></figure>\n\n<p>上传本地指定分支到远程仓库</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push [remote] [branch]</span><br></pre></td></tr></table></figure>\n\n<p>强行推送当前分支到远程仓库，即使有冲突</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push [remote] --force</span><br></pre></td></tr></table></figure>\n\n<p>推送所有分支到远程仓库</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push [remote] --all</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"撤销\"><a href=\"#撤销\" class=\"headerlink\" title=\"撤销\"></a>撤销</h2><p>恢复暂存区的指定文件到工作区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout [file]</span><br></pre></td></tr></table></figure>\n\n<p>恢复某个commit的指定文件到暂存区和工作区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout [commit] [file]</span><br></pre></td></tr></table></figure>\n\n<p>恢复暂存区的所有文件到工作区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout .</span><br></pre></td></tr></table></figure>\n\n<p>重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset [file]</span><br></pre></td></tr></table></figure>\n\n<p>重置暂存区与工作区，与上一次commit保持一致</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset --hard</span><br></pre></td></tr></table></figure>\n\n<p>重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset [commit]</span><br></pre></td></tr></table></figure>\n\n<p>重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset --hard [commit]</span><br></pre></td></tr></table></figure>\n\n<p>重置当前HEAD为指定commit，但保持暂存区和工作区不变</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset --keep [commit]</span><br></pre></td></tr></table></figure>\n\n<p>新建一个commit，用来撤销指定commit，后者的所有变化都将被前者抵消，并且应用到当前分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git revert [commit]</span><br></pre></td></tr></table></figure>\n\n<p>暂时将未提交的变化移除，稍后再移入</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git stash</span><br><span class=\"line\">git stash pop</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><p>生成一个可供发布的压缩包</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git archive</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Git常用命令\"><a href=\"#Git常用命令\" class=\"headerlink\" title=\"Git常用命令\"></a>Git常用命令</h1><h2 id=\"仓库\"><a href=\"#仓库\" class=\"headerlink\" title=\"仓库\"></a>仓库</h2><p>在当前目录新建一个Git代码库</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git init</span><br></pre></td></tr></table></figure>\n\n<p>新建一个目录，将其初始化为Git代码库</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git init [project-name]</span><br></pre></td></tr></table></figure>\n\n<p>下载一个项目和它的整个代码历史</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone [url]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>显示当前的Git配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --list</span><br></pre></td></tr></table></figure>\n\n<p>编辑Git配置文件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config -e [--global]</span><br></pre></td></tr></table></figure>\n\n<p>设置提交代码时的用户信息</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config [--global] user.name &quot;[name]&quot;</span><br><span class=\"line\">git config [--global] user.email &quot;[email address]&quot;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"增加-删除文件\"><a href=\"#增加-删除文件\" class=\"headerlink\" title=\"增加/删除文件\"></a>增加/删除文件</h2><p>添加指定文件到暂存区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add [file1] [file2] ...</span><br></pre></td></tr></table></figure>\n\n<p>添加指定目录到暂存区，包括子目录</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add [dir]</span><br></pre></td></tr></table></figure>\n\n<p>添加当前目录的所有文件到暂存区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"添加每个变化前，都会要求确认\"><a href=\"#添加每个变化前，都会要求确认\" class=\"headerlink\" title=\"添加每个变化前，都会要求确认\"></a>添加每个变化前，都会要求确认</h2><p>对于同一个文件的多处变化，可以实现分次提交</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add -p</span><br><span class=\"line\">````</span><br><span class=\"line\"></span><br><span class=\"line\">删除工作区文件，并且将这次删除放入暂存区</span><br><span class=\"line\"></span><br><span class=\"line\">```shell</span><br><span class=\"line\">git rm [file1] [file2] ...</span><br></pre></td></tr></table></figure>\n\n<p>停止追踪指定文件，但该文件会保留在工作区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git rm --cached [file]</span><br></pre></td></tr></table></figure>\n\n<p>改名文件，并且将这个改名放入暂存区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git mv [file-original] [file-renamed]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"代码提交\"><a href=\"#代码提交\" class=\"headerlink\" title=\"代码提交\"></a>代码提交</h2><p>提交暂存区到仓库区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit -m [message]</span><br></pre></td></tr></table></figure>\n\n<p>提交暂存区的指定文件到仓库区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit [file1] [file2] ... -m [message]</span><br></pre></td></tr></table></figure>\n\n<p>提交工作区自上次commit之后的变化，直接到仓库区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit -a</span><br></pre></td></tr></table></figure>\n\n<p>提交时显示所有diff信息</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit -v</span><br></pre></td></tr></table></figure>\n\n<p>使用一次新的commit，替代上一次提交,如果代码没有任何新变化，则用来改写上一次commit的提交信息</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit --amend -m [message]</span><br></pre></td></tr></table></figure>\n\n<p>重做上一次commit，并包括指定文件的新变化</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"分支\"><a href=\"#分支\" class=\"headerlink\" title=\"分支\"></a>分支</h2><p>列出所有本地分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch</span><br></pre></td></tr></table></figure>\n\n<p>列出所有远程分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -r</span><br></pre></td></tr></table></figure>\n\n<p>列出所有本地分支和远程分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -a</span><br></pre></td></tr></table></figure>\n\n<p>新建一个分支，但依然停留在当前分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch [branch-name]</span><br></pre></td></tr></table></figure>\n\n<p>新建一个分支，并切换到该分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b [branch]</span><br></pre></td></tr></table></figure>\n\n<p>新建一个分支，指向指定commit</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch [branch] [commit]</span><br></pre></td></tr></table></figure>\n\n<p>新建一个分支，与指定的远程分支建立追踪关系</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch --track [branch] [remote-branch]</span><br></pre></td></tr></table></figure>\n\n<p>切换到指定分支，并更新工作区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout [branch-name]</span><br></pre></td></tr></table></figure>\n\n<p>切换到上一个分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -</span><br></pre></td></tr></table></figure>\n\n<p>建立追踪关系，在现有分支与指定的远程分支之间</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch --set-upstream [branch] [remote-branch]</span><br></pre></td></tr></table></figure>\n\n<p>合并指定分支到当前分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git merge [branch]</span><br></pre></td></tr></table></figure>\n\n<p>选择一个commit，合并进当前分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git cherry-pick [commit]</span><br></pre></td></tr></table></figure>\n\n<p>删除分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -d [branch-name]</span><br></pre></td></tr></table></figure>\n\n<p>删除远程分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin --delete [branch-name]</span><br><span class=\"line\">git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"标签\"><a href=\"#标签\" class=\"headerlink\" title=\"标签\"></a>标签</h2><p>列出所有tag</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag</span><br></pre></td></tr></table></figure>\n\n<p>新建一个tag在当前commit</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag [tag]</span><br></pre></td></tr></table></figure>\n\n<p>新建一个tag在指定commit</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag [tag] [commit]</span><br></pre></td></tr></table></figure>\n\n<p>删除本地tag</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag -d [tag]</span><br></pre></td></tr></table></figure>\n\n<p>删除远程tag</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin :refs/tags/[tagName]</span><br></pre></td></tr></table></figure>\n\n<p>查看tag信息</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git show [tag]</span><br></pre></td></tr></table></figure>\n\n<p>提交指定tag</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push [remote] [tag]</span><br></pre></td></tr></table></figure>\n\n<p>提交所有tag</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push [remote] --tags</span><br></pre></td></tr></table></figure>\n\n<p>新建一个分支，指向某个tag</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b [branch] [tag]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"查看信息\"><a href=\"#查看信息\" class=\"headerlink\" title=\"查看信息\"></a>查看信息</h2><p>显示有变更的文件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git status</span><br></pre></td></tr></table></figure>\n\n<p>显示当前分支的版本历史</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log</span><br></pre></td></tr></table></figure>\n\n<p>显示commit历史，以及每次commit发生变更的文件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log --stat</span><br></pre></td></tr></table></figure>\n\n<p>搜索提交历史，根据关键词</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log -S [keyword]</span><br></pre></td></tr></table></figure>\n\n<p>显示某个commit之后的所有变动，每个commit占据一行</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log [tag] HEAD --pretty=format:%s</span><br></pre></td></tr></table></figure>\n\n<p>显示某个commit之后的所有变动，其”提交说明”必须符合搜索条件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log [tag] HEAD --grep feature</span><br></pre></td></tr></table></figure>\n\n<p>显示某个文件的版本历史，包括文件改名</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log --follow [file]</span><br><span class=\"line\">git whatchanged [file]</span><br></pre></td></tr></table></figure>\n\n<p>显示指定文件相关的每一次diff</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log -p [file]</span><br></pre></td></tr></table></figure>\n\n<p>显示过去5次提交</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git log -5 --pretty --oneline</span><br></pre></td></tr></table></figure>\n\n<p>显示所有提交过的用户，按提交次数排序</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git shortlog -sn</span><br></pre></td></tr></table></figure>\n\n<p>显示指定文件是什么人在什么时间修改过</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git blame [file]</span><br></pre></td></tr></table></figure>\n\n<p>显示暂存区和工作区的差异</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git diff</span><br></pre></td></tr></table></figure>\n\n<p>显示暂存区和上一个commit的差异</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git diff --cached [file]</span><br></pre></td></tr></table></figure>\n\n<p>显示工作区与当前分支最新commit之间的差异</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git diff HEAD</span><br></pre></td></tr></table></figure>\n\n<p>显示两次提交之间的差异</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git diff [first-branch]...[second-branch]</span><br></pre></td></tr></table></figure>\n\n<p>显示今天你写了多少行代码</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git diff --shortstat &quot;@&#123;0 day ago&#125;&quot;</span><br></pre></td></tr></table></figure>\n\n<p>显示某次提交的元数据和内容变化</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git show [commit]</span><br></pre></td></tr></table></figure>\n\n<p>显示某次提交发生变化的文件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git show --name-only [commit]</span><br></pre></td></tr></table></figure>\n\n<p>显示某次提交时，某个文件的内容</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git show [commit]:[filename]</span><br></pre></td></tr></table></figure>\n\n<p>显示当前分支的最近几次提交</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reflog</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"远程同步\"><a href=\"#远程同步\" class=\"headerlink\" title=\"远程同步\"></a>远程同步</h2><p>下载远程仓库的所有变动</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git fetch [remote]</span><br></pre></td></tr></table></figure>\n\n<p>显示所有远程仓库</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote -v</span><br></pre></td></tr></table></figure>\n\n<p>显示某个远程仓库的信息</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote show [remote]</span><br></pre></td></tr></table></figure>\n\n<p>增加一个新的远程仓库，并命名</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote add [shortname] [url]</span><br></pre></td></tr></table></figure>\n\n<p>取回远程仓库的变化，并与本地分支合并</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git pull [remote] [branch]</span><br></pre></td></tr></table></figure>\n\n<p>上传本地指定分支到远程仓库</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push [remote] [branch]</span><br></pre></td></tr></table></figure>\n\n<p>强行推送当前分支到远程仓库，即使有冲突</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push [remote] --force</span><br></pre></td></tr></table></figure>\n\n<p>推送所有分支到远程仓库</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push [remote] --all</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"撤销\"><a href=\"#撤销\" class=\"headerlink\" title=\"撤销\"></a>撤销</h2><p>恢复暂存区的指定文件到工作区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout [file]</span><br></pre></td></tr></table></figure>\n\n<p>恢复某个commit的指定文件到暂存区和工作区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout [commit] [file]</span><br></pre></td></tr></table></figure>\n\n<p>恢复暂存区的所有文件到工作区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout .</span><br></pre></td></tr></table></figure>\n\n<p>重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset [file]</span><br></pre></td></tr></table></figure>\n\n<p>重置暂存区与工作区，与上一次commit保持一致</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset --hard</span><br></pre></td></tr></table></figure>\n\n<p>重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset [commit]</span><br></pre></td></tr></table></figure>\n\n<p>重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset --hard [commit]</span><br></pre></td></tr></table></figure>\n\n<p>重置当前HEAD为指定commit，但保持暂存区和工作区不变</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset --keep [commit]</span><br></pre></td></tr></table></figure>\n\n<p>新建一个commit，用来撤销指定commit，后者的所有变化都将被前者抵消，并且应用到当前分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git revert [commit]</span><br></pre></td></tr></table></figure>\n\n<p>暂时将未提交的变化移除，稍后再移入</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git stash</span><br><span class=\"line\">git stash pop</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><p>生成一个可供发布的压缩包</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git archive</span><br></pre></td></tr></table></figure>\n"},{"title":"go语言的下载和安装","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-26T02:37:38.000Z","pic":null,"_content":"\n\n## 下载安装包\n\n访问[https://studygolang.com/dl](https://studygolang.com/dl)下载对应系统的安装包，这里以`windows`平台为例。\n\n![](Screenshot_1.webp)\n\n## 安装\n\n安装下载后的安装文件。\n\n![](Screenshot_2.webp)\n\n使用推荐的默认设置就可以了。\n\n## 增加环境变量\n\n在系统环境变量`PATH`中添加`go`的安装路径，比如`C:\\Program Files\\Go\\bin`。\n\n添加完成后调出`cmd`输入`go version`有下面的显示说明安装成功了。\n\n```cmd\nC:\\Users\\espho>go version\ngo version go1.16.4 windows/amd64\n```\n\n## 设置代理\n\n设置为国内代理，方便下载`go`模块：\n\n```shell\n阿里云\nhttps://mirrors.aliyun.com/goproxy/\n七牛云\nhttps://goproxy.cn\n```\n\n设置方式：\n\n```shell\ngo env -w GO111MODULE=on\ngo env -w GOPROXY=https://mirrors.aliyun.com/goproxy/\n```\n\n运行`go env`查看设置是否成功。\n","source":"_posts/go语言的下载和安装.md","raw":"---\ntitle: go语言的下载和安装\ntags:\n  - go\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-26 10:37:38\ncategories: Go\npic:\n---\n\n\n## 下载安装包\n\n访问[https://studygolang.com/dl](https://studygolang.com/dl)下载对应系统的安装包，这里以`windows`平台为例。\n\n![](Screenshot_1.webp)\n\n## 安装\n\n安装下载后的安装文件。\n\n![](Screenshot_2.webp)\n\n使用推荐的默认设置就可以了。\n\n## 增加环境变量\n\n在系统环境变量`PATH`中添加`go`的安装路径，比如`C:\\Program Files\\Go\\bin`。\n\n添加完成后调出`cmd`输入`go version`有下面的显示说明安装成功了。\n\n```cmd\nC:\\Users\\espho>go version\ngo version go1.16.4 windows/amd64\n```\n\n## 设置代理\n\n设置为国内代理，方便下载`go`模块：\n\n```shell\n阿里云\nhttps://mirrors.aliyun.com/goproxy/\n七牛云\nhttps://goproxy.cn\n```\n\n设置方式：\n\n```shell\ngo env -w GO111MODULE=on\ngo env -w GOPROXY=https://mirrors.aliyun.com/goproxy/\n```\n\n运行`go env`查看设置是否成功。\n","slug":"go语言的下载和安装","published":1,"updated":"2021-06-15T03:24:11.489Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2g002044ud1tqu689z","content":"<h2 id=\"下载安装包\"><a href=\"#下载安装包\" class=\"headerlink\" title=\"下载安装包\"></a>下载安装包</h2><p>访问<a href=\"https://studygolang.com/dl\">https://studygolang.com/dl</a>下载对应系统的安装包，这里以<code>windows</code>平台为例。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>安装下载后的安装文件。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>使用推荐的默认设置就可以了。</p>\n<h2 id=\"增加环境变量\"><a href=\"#增加环境变量\" class=\"headerlink\" title=\"增加环境变量\"></a>增加环境变量</h2><p>在系统环境变量<code>PATH</code>中添加<code>go</code>的安装路径，比如<code>C:\\Program Files\\Go\\bin</code>。</p>\n<p>添加完成后调出<code>cmd</code>输入<code>go version</code>有下面的显示说明安装成功了。</p>\n<figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">C:\\<span class=\"title\">Users</span>\\<span class=\"title\">espho</span>&gt;<span class=\"title\">go</span> <span class=\"title\">version</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">go</span> <span class=\"title\">version</span> <span class=\"title\">go1</span>.16.4 <span class=\"title\">windows</span>/<span class=\"title\">amd64</span></span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"设置代理\"><a href=\"#设置代理\" class=\"headerlink\" title=\"设置代理\"></a>设置代理</h2><p>设置为国内代理，方便下载<code>go</code>模块：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">阿里云</span><br><span class=\"line\">https://mirrors.aliyun.com/goproxy/</span><br><span class=\"line\">七牛云</span><br><span class=\"line\">https://goproxy.cn</span><br></pre></td></tr></table></figure>\n\n<p>设置方式：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go env -w GO111MODULE=on</span><br><span class=\"line\">go env -w GOPROXY=https://mirrors.aliyun.com/goproxy/</span><br></pre></td></tr></table></figure>\n\n<p>运行<code>go env</code>查看设置是否成功。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"下载安装包\"><a href=\"#下载安装包\" class=\"headerlink\" title=\"下载安装包\"></a>下载安装包</h2><p>访问<a href=\"https://studygolang.com/dl\">https://studygolang.com/dl</a>下载对应系统的安装包，这里以<code>windows</code>平台为例。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>安装下载后的安装文件。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>使用推荐的默认设置就可以了。</p>\n<h2 id=\"增加环境变量\"><a href=\"#增加环境变量\" class=\"headerlink\" title=\"增加环境变量\"></a>增加环境变量</h2><p>在系统环境变量<code>PATH</code>中添加<code>go</code>的安装路径，比如<code>C:\\Program Files\\Go\\bin</code>。</p>\n<p>添加完成后调出<code>cmd</code>输入<code>go version</code>有下面的显示说明安装成功了。</p>\n<figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">C:\\<span class=\"title\">Users</span>\\<span class=\"title\">espho</span>&gt;<span class=\"title\">go</span> <span class=\"title\">version</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">go</span> <span class=\"title\">version</span> <span class=\"title\">go1</span>.16.4 <span class=\"title\">windows</span>/<span class=\"title\">amd64</span></span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"设置代理\"><a href=\"#设置代理\" class=\"headerlink\" title=\"设置代理\"></a>设置代理</h2><p>设置为国内代理，方便下载<code>go</code>模块：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">阿里云</span><br><span class=\"line\">https://mirrors.aliyun.com/goproxy/</span><br><span class=\"line\">七牛云</span><br><span class=\"line\">https://goproxy.cn</span><br></pre></td></tr></table></figure>\n\n<p>设置方式：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go env -w GO111MODULE=on</span><br><span class=\"line\">go env -w GOPROXY=https://mirrors.aliyun.com/goproxy/</span><br></pre></td></tr></table></figure>\n\n<p>运行<code>go env</code>查看设置是否成功。</p>\n"},{"title":"logging日志模块","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-02T01:34:05.000Z","pic":null,"_content":"\n## 基础教程\n\n### 日志级别\n\n| 级别 | 使用场景 |\n| :--: | :---: |\n| DEBUG | 细节信息，仅当诊断问题时适用 |\n| INFO | 程序按预期运行 |\n| WARNING | 表明有已经或即将发生的意外 |\n| ERROR | 由于严重的问题，程序的某些功能已经不能正常执行 |\n| CRITICAL | 严重的错误，表明程序已经不能继续执行 |\n\n默认是WARNING级别，意味着只会追踪该级别以及以上的事件，除非修改日志配置。\n\nsimple example:\n\n```python\nimport logging\n\nlogging.warning('警告信息')\nlogging.info('正常信息')\n```\n\noutput:\n\n```python\nWARNING:root:警告信息\n```\n\nINFO信息并没有出现，因为默认级别是WARNING级别。\n\n### 记录日志到文件\n\n```python\nimport logging\nlogging.basicConfig(filename='example.log', encoding='utf-8', level=logging.DEBUG)\nlogging.debug('这个消息会被记录到日志文件中')\nlogging.info('这个也会被记录')\nlogging.warning('这个也会被记录')\nlogging.error('这个也被记录，error')\n```\n\n日志信息会记录到`exampe.log`中，3.9版本以后增加了encoding参数，在之前的版本或者没有指定时，编码会使用open()使用的默认值。\n\n对 basicConfig() 的调用应该在 debug() ， info() 等的前面。因为它被设计为一次性的配置，只有第一次调用会进行操作，随后的调用不会产生有效操作。\n\n如果多次运行上述脚本，则连续运行的消息将追加到文件 example.log 。 如果你希望每次运行重新开始，而不是记住先前运行的消息，则可以通过将上例中的调用更改为来指定 filemode 参数:\n\n```python\nlogging.basicConfig(filename='example.log', filemode='w', level=logging.DEBUG)\n```\n\n### 记录变量数据\n\n使用格式字符作为事件描述信息，附加传入变量数据作为参数。\n\n```python\nimport logging\n\nlogging.warning('打印变量1：%s，打印变量2：%s', '100', '1000')\n```\n\noutput:\n\n```python\nWARNING:root:打印变量1：100，打印变量2：1000\n```\n\n### 更改显示消息的格式\n\nexample:\n\n```python\nimport logging\n\nlogging.basicConfig(format='%(levelname)s:%(message)s', level=logging.DEBUG)\nlogging.debug(\"这是debug信息\")\nlogging.info(\"这是info信息\")\nlogging.warning(\"这是warning信息\")\n```\n\noutput:\n\n```python\nDEBUG:这是debug信息\nINFO:这是info信息      \nWARNING:这是warning信息\n```\n\n### 在消息中显示日期/时间\n\n显示事件的日期和时间，在格式字符串中使用`'%(asctime)s'`。\n\n```python\nimport logging\n\nlogging.basicConfig(format='%(asctime)s %(message)s', level=logging.DEBUG)\nlogging.warning('这是警告信息')\nlogging.info('这是提示信息')\n```\n\noutput:\n\n```python\n2021-06-02 10:52:34,738 这是警告信息\n2021-06-02 10:52:34,738 这是提示信息\n```\n\n`datafmt`参数可以控制时间的格式。\n\n```python\nimport logging\n\nlogging.basicConfig(format='%(asctime)s %(message)s', level=logging.DEBUG, datefmt='%Y-%m-%d %I:%M:%S %p')\nlogging.warning('这是警告信息')\nlogging.info('这是提示信息')\n```\n\noutput:\n\n```python\n2021-06-02 10:55:55 AM 这是警告信息\n2021-06-02 10:55:55 AM 这是提示信息\n```\n\n`datefmt` 参数的格式与 `time.strftime()` 支持的格式相同。\n\n## 进阶教程\n\n日志库采用模块化的方法，提供了几类组件：记录器、处理器、过滤器和格式器。\n\n- 记录器暴露了应用程序代码直接使用的接口。\n- 处理器将日志记录（由记录器创建）发送到适当的目标。\n- 过滤器提供了更精细的附加功能，用于确定要输出的日志记录。\n- 格式器指定最终输出中日志记录的样式。\n\n通过调用 `Logger` 类（以下称为 loggers ， 记录器）的实例来执行日志记录。 每个实例都有一个名称，它们在概念上以点（句点）作为分隔符排列在命名空间的层次结构中。 例如，名为 'scan' 的记录器是记录器 'scan.text' ，'scan.html' 和 'scan.pdf' 的父级。 记录器名称可以是你想要的任何名称，并指示记录消息源自的应用程序区域。\n\n良好实践是在使用日志记录模块中使用模块记录器，命名如下：\n\n```python\nlogger = logging.getLogger(__name__)\n```\n\n记录器层次结构的根称为根记录器。 这是函数 `debug()` 、 `info()` 、 `warning()` 、 `error()` 和 `critical() `使用的记录器，它们就是调用了根记录器的同名方法。函数和方法具有相同的签名。根记录器的名称在输出中打印为 `'root'` 。\n\n可以将消息记录到不同的地方。 软件包中的支持包含，用于将日志消息写入文件、 HTTP GET/POST 位置、通过 `SMTP` 发送电子邮件、通用套接字、队列或特定于操作系统的日志记录机制（如 `syslog` 或 Windows NT 事件日志）。 目标由 `handler` 类提供。 如果你有任何内置处理器类未满足的特殊要求，则可以创建自己的日志目标类。\n\n默认情况下，没有为任何日志消息设置目标。 你可以使用 `basicConfig()` 指定目标（例如控制台或文件），如教程示例中所示。 如果你调用函数 debug() 、 info() 、 warning() 、 error() 和 critical() ，它们将检查是否有设置目标；如果没有设置，将在委托给根记录器进行实际的消息输出之前设置目标为控制台（ sys.stderr ）并设置显示消息的默认格式。\n\n由 `basicConfig()` 设置的消息默认格式为：\n\n```python\nseverity:logger name:message\n```\n\n可以通过使用 `format` 参数将格式字符串传递给 `basicConfig()` 来更改此设置。\n\n### 记录流程\n\n记录器和处理器中的日志事件信息流程如下图所示。\n\n![]()\n\n### 记录器\n\n`Logger` 对象有三重任务。首先，它们向应用程序代码公开了几种方法，以便应用程序可以在运行时记录消息。其次，记录器对象根据严重性（默认过滤工具）或过滤器对象确定要处理的日志消息。第三，记录器对象将相关的日志消息传递给所有感兴趣的日志处理器。\n\n这些是最常见的配置方法：\n\n- Logger.setLevel() 指定记录器将处理的最低严重性日志消息，其中 debug 是最低内置严重性级别， critical 是最高内置严重性级别。 例如，如果严重性级别为 INFO ，则记录器将仅处理 INFO 、 WARNING 、 ERROR 和 CRITICAL 消息，并将忽略 DEBUG 消息。\n- Logger.addHandler() 和 Logger.removeHandler() 从记录器对象中添加和删除处理器对象。处理器在以下内容中有更详细的介绍 处理器 。\n- Logger.addFilter() 和 Logger.removeFilter() 可以添加或移除记录器对象中的过滤器。 过滤器对象 包含更多的过滤器细节。\n\n### 处理器\n\n`Handler` 对象负责将适当的日志消息（基于日志消息的严重性）分派给处理器的指定目标。 `Logger` 对象可以使用 `addHandler()` 方法向自己添加零个或多个处理器对象。作为示例场景，应用程序可能希望将所有日志消息发送到日志文件，将错误或更高的所有日志消息发送到标准输出，以及将所有关键消息发送至一个邮件地址。 此方案需要三个单独的处理器，其中每个处理器负责将特定严重性的消息发送到特定位置。\n\n常用的配置方法：\n\n- setLevel() 方法，就像在记录器对象中一样，指定将被分派到适当目标的最低严重性。为什么有两个 setLevel() 方法？记录器中设置的级别确定将传递给其处理器的消息的严重性。每个处理器中设置的级别确定该处理器将发送哪些消息。\n- setFormatter() 选择一个该处理器使用的 Formatter 对象。\n- addFilter() 和 removeFilter() 分别在处理器上配置和取消配置过滤器对象。\n\n### 格式器\n\n格式化器对象配置日志消息的最终顺序、结构和内容。与 `logging.Handler` 类不同，应用程序代码可以实例化格式器类，但如果应用程序需要特殊行为，则可能会对格式化器进行子类化定制。构造函数有三个可选参数 —— `消息格式字符串`、`日期格式字符串`和`样式指示符`。\n\n`logging.Formatter.__init__(fmt=None, datefmt=None, style='%')`\n\n如果没有消息格式字符串，则默认使用原始消息。如果没有日期格式字符串，则默认日期格式为：\n\n```python\n%Y-%m-%d %H:%M:%S\n```\n\n最后加上毫秒数。 `style` 是 `％`，`'{'` 或 `'$'` 之一。 如果未指定，则将使用 `'％'`。\n\n在 `3.2 `版更改: 添加 `style` 形参。\n\n以下消息格式字符串将以人类可读的格式记录时间、消息的严重性以及消息的内容，按此顺序:\n\n```python\n'%(asctime)s - %(levelname)s - %(message)s'\n```\n\n格式器通过用户可配置的函数将记录的创建时间转换为元组。 默认情况下，使用 `time.localtime()`；要为特定格式器实例更改此项，请将实例的 `converter` 属性设置为与 `time.localtime()` 或 `time.gmtime()` 具有相同签名的函数。\n\n### 配置日志记录\n\n开发者可以通过三种方式配置日志记录：\n\n1. 使用调用上面列出的配置方法的 `Python` 代码显式创建记录器、处理器和格式器。\n2. 创建日志配置文件并使用 `fileConfig()` 函数读取它。\n3. 创建配置信息字典并将其传递给 `dictConfig()` 函数。\n\n具体可参考官方文档。\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>","source":"_posts/logging日志模块.md","raw":"---\ntitle: logging日志模块\ntags:\n  - logging\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-02 09:34:05\ncategories: Python库\npic:\n---\n\n## 基础教程\n\n### 日志级别\n\n| 级别 | 使用场景 |\n| :--: | :---: |\n| DEBUG | 细节信息，仅当诊断问题时适用 |\n| INFO | 程序按预期运行 |\n| WARNING | 表明有已经或即将发生的意外 |\n| ERROR | 由于严重的问题，程序的某些功能已经不能正常执行 |\n| CRITICAL | 严重的错误，表明程序已经不能继续执行 |\n\n默认是WARNING级别，意味着只会追踪该级别以及以上的事件，除非修改日志配置。\n\nsimple example:\n\n```python\nimport logging\n\nlogging.warning('警告信息')\nlogging.info('正常信息')\n```\n\noutput:\n\n```python\nWARNING:root:警告信息\n```\n\nINFO信息并没有出现，因为默认级别是WARNING级别。\n\n### 记录日志到文件\n\n```python\nimport logging\nlogging.basicConfig(filename='example.log', encoding='utf-8', level=logging.DEBUG)\nlogging.debug('这个消息会被记录到日志文件中')\nlogging.info('这个也会被记录')\nlogging.warning('这个也会被记录')\nlogging.error('这个也被记录，error')\n```\n\n日志信息会记录到`exampe.log`中，3.9版本以后增加了encoding参数，在之前的版本或者没有指定时，编码会使用open()使用的默认值。\n\n对 basicConfig() 的调用应该在 debug() ， info() 等的前面。因为它被设计为一次性的配置，只有第一次调用会进行操作，随后的调用不会产生有效操作。\n\n如果多次运行上述脚本，则连续运行的消息将追加到文件 example.log 。 如果你希望每次运行重新开始，而不是记住先前运行的消息，则可以通过将上例中的调用更改为来指定 filemode 参数:\n\n```python\nlogging.basicConfig(filename='example.log', filemode='w', level=logging.DEBUG)\n```\n\n### 记录变量数据\n\n使用格式字符作为事件描述信息，附加传入变量数据作为参数。\n\n```python\nimport logging\n\nlogging.warning('打印变量1：%s，打印变量2：%s', '100', '1000')\n```\n\noutput:\n\n```python\nWARNING:root:打印变量1：100，打印变量2：1000\n```\n\n### 更改显示消息的格式\n\nexample:\n\n```python\nimport logging\n\nlogging.basicConfig(format='%(levelname)s:%(message)s', level=logging.DEBUG)\nlogging.debug(\"这是debug信息\")\nlogging.info(\"这是info信息\")\nlogging.warning(\"这是warning信息\")\n```\n\noutput:\n\n```python\nDEBUG:这是debug信息\nINFO:这是info信息      \nWARNING:这是warning信息\n```\n\n### 在消息中显示日期/时间\n\n显示事件的日期和时间，在格式字符串中使用`'%(asctime)s'`。\n\n```python\nimport logging\n\nlogging.basicConfig(format='%(asctime)s %(message)s', level=logging.DEBUG)\nlogging.warning('这是警告信息')\nlogging.info('这是提示信息')\n```\n\noutput:\n\n```python\n2021-06-02 10:52:34,738 这是警告信息\n2021-06-02 10:52:34,738 这是提示信息\n```\n\n`datafmt`参数可以控制时间的格式。\n\n```python\nimport logging\n\nlogging.basicConfig(format='%(asctime)s %(message)s', level=logging.DEBUG, datefmt='%Y-%m-%d %I:%M:%S %p')\nlogging.warning('这是警告信息')\nlogging.info('这是提示信息')\n```\n\noutput:\n\n```python\n2021-06-02 10:55:55 AM 这是警告信息\n2021-06-02 10:55:55 AM 这是提示信息\n```\n\n`datefmt` 参数的格式与 `time.strftime()` 支持的格式相同。\n\n## 进阶教程\n\n日志库采用模块化的方法，提供了几类组件：记录器、处理器、过滤器和格式器。\n\n- 记录器暴露了应用程序代码直接使用的接口。\n- 处理器将日志记录（由记录器创建）发送到适当的目标。\n- 过滤器提供了更精细的附加功能，用于确定要输出的日志记录。\n- 格式器指定最终输出中日志记录的样式。\n\n通过调用 `Logger` 类（以下称为 loggers ， 记录器）的实例来执行日志记录。 每个实例都有一个名称，它们在概念上以点（句点）作为分隔符排列在命名空间的层次结构中。 例如，名为 'scan' 的记录器是记录器 'scan.text' ，'scan.html' 和 'scan.pdf' 的父级。 记录器名称可以是你想要的任何名称，并指示记录消息源自的应用程序区域。\n\n良好实践是在使用日志记录模块中使用模块记录器，命名如下：\n\n```python\nlogger = logging.getLogger(__name__)\n```\n\n记录器层次结构的根称为根记录器。 这是函数 `debug()` 、 `info()` 、 `warning()` 、 `error()` 和 `critical() `使用的记录器，它们就是调用了根记录器的同名方法。函数和方法具有相同的签名。根记录器的名称在输出中打印为 `'root'` 。\n\n可以将消息记录到不同的地方。 软件包中的支持包含，用于将日志消息写入文件、 HTTP GET/POST 位置、通过 `SMTP` 发送电子邮件、通用套接字、队列或特定于操作系统的日志记录机制（如 `syslog` 或 Windows NT 事件日志）。 目标由 `handler` 类提供。 如果你有任何内置处理器类未满足的特殊要求，则可以创建自己的日志目标类。\n\n默认情况下，没有为任何日志消息设置目标。 你可以使用 `basicConfig()` 指定目标（例如控制台或文件），如教程示例中所示。 如果你调用函数 debug() 、 info() 、 warning() 、 error() 和 critical() ，它们将检查是否有设置目标；如果没有设置，将在委托给根记录器进行实际的消息输出之前设置目标为控制台（ sys.stderr ）并设置显示消息的默认格式。\n\n由 `basicConfig()` 设置的消息默认格式为：\n\n```python\nseverity:logger name:message\n```\n\n可以通过使用 `format` 参数将格式字符串传递给 `basicConfig()` 来更改此设置。\n\n### 记录流程\n\n记录器和处理器中的日志事件信息流程如下图所示。\n\n![]()\n\n### 记录器\n\n`Logger` 对象有三重任务。首先，它们向应用程序代码公开了几种方法，以便应用程序可以在运行时记录消息。其次，记录器对象根据严重性（默认过滤工具）或过滤器对象确定要处理的日志消息。第三，记录器对象将相关的日志消息传递给所有感兴趣的日志处理器。\n\n这些是最常见的配置方法：\n\n- Logger.setLevel() 指定记录器将处理的最低严重性日志消息，其中 debug 是最低内置严重性级别， critical 是最高内置严重性级别。 例如，如果严重性级别为 INFO ，则记录器将仅处理 INFO 、 WARNING 、 ERROR 和 CRITICAL 消息，并将忽略 DEBUG 消息。\n- Logger.addHandler() 和 Logger.removeHandler() 从记录器对象中添加和删除处理器对象。处理器在以下内容中有更详细的介绍 处理器 。\n- Logger.addFilter() 和 Logger.removeFilter() 可以添加或移除记录器对象中的过滤器。 过滤器对象 包含更多的过滤器细节。\n\n### 处理器\n\n`Handler` 对象负责将适当的日志消息（基于日志消息的严重性）分派给处理器的指定目标。 `Logger` 对象可以使用 `addHandler()` 方法向自己添加零个或多个处理器对象。作为示例场景，应用程序可能希望将所有日志消息发送到日志文件，将错误或更高的所有日志消息发送到标准输出，以及将所有关键消息发送至一个邮件地址。 此方案需要三个单独的处理器，其中每个处理器负责将特定严重性的消息发送到特定位置。\n\n常用的配置方法：\n\n- setLevel() 方法，就像在记录器对象中一样，指定将被分派到适当目标的最低严重性。为什么有两个 setLevel() 方法？记录器中设置的级别确定将传递给其处理器的消息的严重性。每个处理器中设置的级别确定该处理器将发送哪些消息。\n- setFormatter() 选择一个该处理器使用的 Formatter 对象。\n- addFilter() 和 removeFilter() 分别在处理器上配置和取消配置过滤器对象。\n\n### 格式器\n\n格式化器对象配置日志消息的最终顺序、结构和内容。与 `logging.Handler` 类不同，应用程序代码可以实例化格式器类，但如果应用程序需要特殊行为，则可能会对格式化器进行子类化定制。构造函数有三个可选参数 —— `消息格式字符串`、`日期格式字符串`和`样式指示符`。\n\n`logging.Formatter.__init__(fmt=None, datefmt=None, style='%')`\n\n如果没有消息格式字符串，则默认使用原始消息。如果没有日期格式字符串，则默认日期格式为：\n\n```python\n%Y-%m-%d %H:%M:%S\n```\n\n最后加上毫秒数。 `style` 是 `％`，`'{'` 或 `'$'` 之一。 如果未指定，则将使用 `'％'`。\n\n在 `3.2 `版更改: 添加 `style` 形参。\n\n以下消息格式字符串将以人类可读的格式记录时间、消息的严重性以及消息的内容，按此顺序:\n\n```python\n'%(asctime)s - %(levelname)s - %(message)s'\n```\n\n格式器通过用户可配置的函数将记录的创建时间转换为元组。 默认情况下，使用 `time.localtime()`；要为特定格式器实例更改此项，请将实例的 `converter` 属性设置为与 `time.localtime()` 或 `time.gmtime()` 具有相同签名的函数。\n\n### 配置日志记录\n\n开发者可以通过三种方式配置日志记录：\n\n1. 使用调用上面列出的配置方法的 `Python` 代码显式创建记录器、处理器和格式器。\n2. 创建日志配置文件并使用 `fileConfig()` 函数读取它。\n3. 创建配置信息字典并将其传递给 `dictConfig()` 函数。\n\n具体可参考官方文档。\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>","slug":"logging日志模块","published":1,"updated":"2021-06-17T11:48:53.905Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2h002444ud1xjj6ao6","content":"<h2 id=\"基础教程\"><a href=\"#基础教程\" class=\"headerlink\" title=\"基础教程\"></a>基础教程</h2><h3 id=\"日志级别\"><a href=\"#日志级别\" class=\"headerlink\" title=\"日志级别\"></a>日志级别</h3><table>\n<thead>\n<tr>\n<th align=\"center\">级别</th>\n<th align=\"center\">使用场景</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">DEBUG</td>\n<td align=\"center\">细节信息，仅当诊断问题时适用</td>\n</tr>\n<tr>\n<td align=\"center\">INFO</td>\n<td align=\"center\">程序按预期运行</td>\n</tr>\n<tr>\n<td align=\"center\">WARNING</td>\n<td align=\"center\">表明有已经或即将发生的意外</td>\n</tr>\n<tr>\n<td align=\"center\">ERROR</td>\n<td align=\"center\">由于严重的问题，程序的某些功能已经不能正常执行</td>\n</tr>\n<tr>\n<td align=\"center\">CRITICAL</td>\n<td align=\"center\">严重的错误，表明程序已经不能继续执行</td>\n</tr>\n</tbody></table>\n<p>默认是WARNING级别，意味着只会追踪该级别以及以上的事件，除非修改日志配置。</p>\n<p>simple example:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"></span><br><span class=\"line\">logging.warning(<span class=\"string\">&#x27;警告信息&#x27;</span>)</span><br><span class=\"line\">logging.info(<span class=\"string\">&#x27;正常信息&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>output:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WARNING:root:警告信息</span><br></pre></td></tr></table></figure>\n\n<p>INFO信息并没有出现，因为默认级别是WARNING级别。</p>\n<h3 id=\"记录日志到文件\"><a href=\"#记录日志到文件\" class=\"headerlink\" title=\"记录日志到文件\"></a>记录日志到文件</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\">logging.basicConfig(filename=<span class=\"string\">&#x27;example.log&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>, level=logging.DEBUG)</span><br><span class=\"line\">logging.debug(<span class=\"string\">&#x27;这个消息会被记录到日志文件中&#x27;</span>)</span><br><span class=\"line\">logging.info(<span class=\"string\">&#x27;这个也会被记录&#x27;</span>)</span><br><span class=\"line\">logging.warning(<span class=\"string\">&#x27;这个也会被记录&#x27;</span>)</span><br><span class=\"line\">logging.error(<span class=\"string\">&#x27;这个也被记录，error&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>日志信息会记录到<code>exampe.log</code>中，3.9版本以后增加了encoding参数，在之前的版本或者没有指定时，编码会使用open()使用的默认值。</p>\n<p>对 basicConfig() 的调用应该在 debug() ， info() 等的前面。因为它被设计为一次性的配置，只有第一次调用会进行操作，随后的调用不会产生有效操作。</p>\n<p>如果多次运行上述脚本，则连续运行的消息将追加到文件 example.log 。 如果你希望每次运行重新开始，而不是记住先前运行的消息，则可以通过将上例中的调用更改为来指定 filemode 参数:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">logging.basicConfig(filename=<span class=\"string\">&#x27;example.log&#x27;</span>, filemode=<span class=\"string\">&#x27;w&#x27;</span>, level=logging.DEBUG)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"记录变量数据\"><a href=\"#记录变量数据\" class=\"headerlink\" title=\"记录变量数据\"></a>记录变量数据</h3><p>使用格式字符作为事件描述信息，附加传入变量数据作为参数。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"></span><br><span class=\"line\">logging.warning(<span class=\"string\">&#x27;打印变量1：%s，打印变量2：%s&#x27;</span>, <span class=\"string\">&#x27;100&#x27;</span>, <span class=\"string\">&#x27;1000&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>output:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WARNING:root:打印变量<span class=\"number\">1</span>：<span class=\"number\">100</span>，打印变量<span class=\"number\">2</span>：<span class=\"number\">1000</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"更改显示消息的格式\"><a href=\"#更改显示消息的格式\" class=\"headerlink\" title=\"更改显示消息的格式\"></a>更改显示消息的格式</h3><p>example:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"></span><br><span class=\"line\">logging.basicConfig(<span class=\"built_in\">format</span>=<span class=\"string\">&#x27;%(levelname)s:%(message)s&#x27;</span>, level=logging.DEBUG)</span><br><span class=\"line\">logging.debug(<span class=\"string\">&quot;这是debug信息&quot;</span>)</span><br><span class=\"line\">logging.info(<span class=\"string\">&quot;这是info信息&quot;</span>)</span><br><span class=\"line\">logging.warning(<span class=\"string\">&quot;这是warning信息&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>output:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DEBUG:这是debug信息</span><br><span class=\"line\">INFO:这是info信息      </span><br><span class=\"line\">WARNING:这是warning信息</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在消息中显示日期-时间\"><a href=\"#在消息中显示日期-时间\" class=\"headerlink\" title=\"在消息中显示日期/时间\"></a>在消息中显示日期/时间</h3><p>显示事件的日期和时间，在格式字符串中使用<code>&#39;%(asctime)s&#39;</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"></span><br><span class=\"line\">logging.basicConfig(<span class=\"built_in\">format</span>=<span class=\"string\">&#x27;%(asctime)s %(message)s&#x27;</span>, level=logging.DEBUG)</span><br><span class=\"line\">logging.warning(<span class=\"string\">&#x27;这是警告信息&#x27;</span>)</span><br><span class=\"line\">logging.info(<span class=\"string\">&#x27;这是提示信息&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>output:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2021</span>-06-02 <span class=\"number\">10</span>:<span class=\"number\">52</span>:<span class=\"number\">34</span>,<span class=\"number\">738</span> 这是警告信息</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-02 <span class=\"number\">10</span>:<span class=\"number\">52</span>:<span class=\"number\">34</span>,<span class=\"number\">738</span> 这是提示信息</span><br></pre></td></tr></table></figure>\n\n<p><code>datafmt</code>参数可以控制时间的格式。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"></span><br><span class=\"line\">logging.basicConfig(<span class=\"built_in\">format</span>=<span class=\"string\">&#x27;%(asctime)s %(message)s&#x27;</span>, level=logging.DEBUG, datefmt=<span class=\"string\">&#x27;%Y-%m-%d %I:%M:%S %p&#x27;</span>)</span><br><span class=\"line\">logging.warning(<span class=\"string\">&#x27;这是警告信息&#x27;</span>)</span><br><span class=\"line\">logging.info(<span class=\"string\">&#x27;这是提示信息&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>output:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2021</span>-06-02 <span class=\"number\">10</span>:<span class=\"number\">55</span>:<span class=\"number\">55</span> AM 这是警告信息</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-02 <span class=\"number\">10</span>:<span class=\"number\">55</span>:<span class=\"number\">55</span> AM 这是提示信息</span><br></pre></td></tr></table></figure>\n\n<p><code>datefmt</code> 参数的格式与 <code>time.strftime()</code> 支持的格式相同。</p>\n<h2 id=\"进阶教程\"><a href=\"#进阶教程\" class=\"headerlink\" title=\"进阶教程\"></a>进阶教程</h2><p>日志库采用模块化的方法，提供了几类组件：记录器、处理器、过滤器和格式器。</p>\n<ul>\n<li>记录器暴露了应用程序代码直接使用的接口。</li>\n<li>处理器将日志记录（由记录器创建）发送到适当的目标。</li>\n<li>过滤器提供了更精细的附加功能，用于确定要输出的日志记录。</li>\n<li>格式器指定最终输出中日志记录的样式。</li>\n</ul>\n<p>通过调用 <code>Logger</code> 类（以下称为 loggers ， 记录器）的实例来执行日志记录。 每个实例都有一个名称，它们在概念上以点（句点）作为分隔符排列在命名空间的层次结构中。 例如，名为 ‘scan’ 的记录器是记录器 ‘scan.text’ ，’scan.html’ 和 ‘scan.pdf’ 的父级。 记录器名称可以是你想要的任何名称，并指示记录消息源自的应用程序区域。</p>\n<p>良好实践是在使用日志记录模块中使用模块记录器，命名如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">logger = logging.getLogger(__name__)</span><br></pre></td></tr></table></figure>\n\n<p>记录器层次结构的根称为根记录器。 这是函数 <code>debug()</code> 、 <code>info()</code> 、 <code>warning()</code> 、 <code>error()</code> 和 <code>critical() </code>使用的记录器，它们就是调用了根记录器的同名方法。函数和方法具有相同的签名。根记录器的名称在输出中打印为 <code>&#39;root&#39;</code> 。</p>\n<p>可以将消息记录到不同的地方。 软件包中的支持包含，用于将日志消息写入文件、 HTTP GET/POST 位置、通过 <code>SMTP</code> 发送电子邮件、通用套接字、队列或特定于操作系统的日志记录机制（如 <code>syslog</code> 或 Windows NT 事件日志）。 目标由 <code>handler</code> 类提供。 如果你有任何内置处理器类未满足的特殊要求，则可以创建自己的日志目标类。</p>\n<p>默认情况下，没有为任何日志消息设置目标。 你可以使用 <code>basicConfig()</code> 指定目标（例如控制台或文件），如教程示例中所示。 如果你调用函数 debug() 、 info() 、 warning() 、 error() 和 critical() ，它们将检查是否有设置目标；如果没有设置，将在委托给根记录器进行实际的消息输出之前设置目标为控制台（ sys.stderr ）并设置显示消息的默认格式。</p>\n<p>由 <code>basicConfig()</code> 设置的消息默认格式为：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">severity:logger name:message</span><br></pre></td></tr></table></figure>\n\n<p>可以通过使用 <code>format</code> 参数将格式字符串传递给 <code>basicConfig()</code> 来更改此设置。</p>\n<h3 id=\"记录流程\"><a href=\"#记录流程\" class=\"headerlink\" title=\"记录流程\"></a>记录流程</h3><p>记录器和处理器中的日志事件信息流程如下图所示。</p>\n<p><img src=\"\"></p>\n<h3 id=\"记录器\"><a href=\"#记录器\" class=\"headerlink\" title=\"记录器\"></a>记录器</h3><p><code>Logger</code> 对象有三重任务。首先，它们向应用程序代码公开了几种方法，以便应用程序可以在运行时记录消息。其次，记录器对象根据严重性（默认过滤工具）或过滤器对象确定要处理的日志消息。第三，记录器对象将相关的日志消息传递给所有感兴趣的日志处理器。</p>\n<p>这些是最常见的配置方法：</p>\n<ul>\n<li>Logger.setLevel() 指定记录器将处理的最低严重性日志消息，其中 debug 是最低内置严重性级别， critical 是最高内置严重性级别。 例如，如果严重性级别为 INFO ，则记录器将仅处理 INFO 、 WARNING 、 ERROR 和 CRITICAL 消息，并将忽略 DEBUG 消息。</li>\n<li>Logger.addHandler() 和 Logger.removeHandler() 从记录器对象中添加和删除处理器对象。处理器在以下内容中有更详细的介绍 处理器 。</li>\n<li>Logger.addFilter() 和 Logger.removeFilter() 可以添加或移除记录器对象中的过滤器。 过滤器对象 包含更多的过滤器细节。</li>\n</ul>\n<h3 id=\"处理器\"><a href=\"#处理器\" class=\"headerlink\" title=\"处理器\"></a>处理器</h3><p><code>Handler</code> 对象负责将适当的日志消息（基于日志消息的严重性）分派给处理器的指定目标。 <code>Logger</code> 对象可以使用 <code>addHandler()</code> 方法向自己添加零个或多个处理器对象。作为示例场景，应用程序可能希望将所有日志消息发送到日志文件，将错误或更高的所有日志消息发送到标准输出，以及将所有关键消息发送至一个邮件地址。 此方案需要三个单独的处理器，其中每个处理器负责将特定严重性的消息发送到特定位置。</p>\n<p>常用的配置方法：</p>\n<ul>\n<li>setLevel() 方法，就像在记录器对象中一样，指定将被分派到适当目标的最低严重性。为什么有两个 setLevel() 方法？记录器中设置的级别确定将传递给其处理器的消息的严重性。每个处理器中设置的级别确定该处理器将发送哪些消息。</li>\n<li>setFormatter() 选择一个该处理器使用的 Formatter 对象。</li>\n<li>addFilter() 和 removeFilter() 分别在处理器上配置和取消配置过滤器对象。</li>\n</ul>\n<h3 id=\"格式器\"><a href=\"#格式器\" class=\"headerlink\" title=\"格式器\"></a>格式器</h3><p>格式化器对象配置日志消息的最终顺序、结构和内容。与 <code>logging.Handler</code> 类不同，应用程序代码可以实例化格式器类，但如果应用程序需要特殊行为，则可能会对格式化器进行子类化定制。构造函数有三个可选参数 —— <code>消息格式字符串</code>、<code>日期格式字符串</code>和<code>样式指示符</code>。</p>\n<p><code>logging.Formatter.__init__(fmt=None, datefmt=None, style=&#39;%&#39;)</code></p>\n<p>如果没有消息格式字符串，则默认使用原始消息。如果没有日期格式字符串，则默认日期格式为：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%Y-%m-%d %H:%M:%S</span><br></pre></td></tr></table></figure>\n\n<p>最后加上毫秒数。 <code>style</code> 是 <code>％</code>，<code>&#39;&#123;&#39;</code> 或 <code>&#39;$&#39;</code> 之一。 如果未指定，则将使用 <code>&#39;％&#39;</code>。</p>\n<p>在 <code>3.2 </code>版更改: 添加 <code>style</code> 形参。</p>\n<p>以下消息格式字符串将以人类可读的格式记录时间、消息的严重性以及消息的内容，按此顺序:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;%(asctime)s - %(levelname)s - %(message)s&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>格式器通过用户可配置的函数将记录的创建时间转换为元组。 默认情况下，使用 <code>time.localtime()</code>；要为特定格式器实例更改此项，请将实例的 <code>converter</code> 属性设置为与 <code>time.localtime()</code> 或 <code>time.gmtime()</code> 具有相同签名的函数。</p>\n<h3 id=\"配置日志记录\"><a href=\"#配置日志记录\" class=\"headerlink\" title=\"配置日志记录\"></a>配置日志记录</h3><p>开发者可以通过三种方式配置日志记录：</p>\n<ol>\n<li>使用调用上面列出的配置方法的 <code>Python</code> 代码显式创建记录器、处理器和格式器。</li>\n<li>创建日志配置文件并使用 <code>fileConfig()</code> 函数读取它。</li>\n<li>创建配置信息字典并将其传递给 <code>dictConfig()</code> 函数。</li>\n</ol>\n<p>具体可参考官方文档。</p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"基础教程\"><a href=\"#基础教程\" class=\"headerlink\" title=\"基础教程\"></a>基础教程</h2><h3 id=\"日志级别\"><a href=\"#日志级别\" class=\"headerlink\" title=\"日志级别\"></a>日志级别</h3><table>\n<thead>\n<tr>\n<th align=\"center\">级别</th>\n<th align=\"center\">使用场景</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">DEBUG</td>\n<td align=\"center\">细节信息，仅当诊断问题时适用</td>\n</tr>\n<tr>\n<td align=\"center\">INFO</td>\n<td align=\"center\">程序按预期运行</td>\n</tr>\n<tr>\n<td align=\"center\">WARNING</td>\n<td align=\"center\">表明有已经或即将发生的意外</td>\n</tr>\n<tr>\n<td align=\"center\">ERROR</td>\n<td align=\"center\">由于严重的问题，程序的某些功能已经不能正常执行</td>\n</tr>\n<tr>\n<td align=\"center\">CRITICAL</td>\n<td align=\"center\">严重的错误，表明程序已经不能继续执行</td>\n</tr>\n</tbody></table>\n<p>默认是WARNING级别，意味着只会追踪该级别以及以上的事件，除非修改日志配置。</p>\n<p>simple example:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"></span><br><span class=\"line\">logging.warning(<span class=\"string\">&#x27;警告信息&#x27;</span>)</span><br><span class=\"line\">logging.info(<span class=\"string\">&#x27;正常信息&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>output:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WARNING:root:警告信息</span><br></pre></td></tr></table></figure>\n\n<p>INFO信息并没有出现，因为默认级别是WARNING级别。</p>\n<h3 id=\"记录日志到文件\"><a href=\"#记录日志到文件\" class=\"headerlink\" title=\"记录日志到文件\"></a>记录日志到文件</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\">logging.basicConfig(filename=<span class=\"string\">&#x27;example.log&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>, level=logging.DEBUG)</span><br><span class=\"line\">logging.debug(<span class=\"string\">&#x27;这个消息会被记录到日志文件中&#x27;</span>)</span><br><span class=\"line\">logging.info(<span class=\"string\">&#x27;这个也会被记录&#x27;</span>)</span><br><span class=\"line\">logging.warning(<span class=\"string\">&#x27;这个也会被记录&#x27;</span>)</span><br><span class=\"line\">logging.error(<span class=\"string\">&#x27;这个也被记录，error&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>日志信息会记录到<code>exampe.log</code>中，3.9版本以后增加了encoding参数，在之前的版本或者没有指定时，编码会使用open()使用的默认值。</p>\n<p>对 basicConfig() 的调用应该在 debug() ， info() 等的前面。因为它被设计为一次性的配置，只有第一次调用会进行操作，随后的调用不会产生有效操作。</p>\n<p>如果多次运行上述脚本，则连续运行的消息将追加到文件 example.log 。 如果你希望每次运行重新开始，而不是记住先前运行的消息，则可以通过将上例中的调用更改为来指定 filemode 参数:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">logging.basicConfig(filename=<span class=\"string\">&#x27;example.log&#x27;</span>, filemode=<span class=\"string\">&#x27;w&#x27;</span>, level=logging.DEBUG)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"记录变量数据\"><a href=\"#记录变量数据\" class=\"headerlink\" title=\"记录变量数据\"></a>记录变量数据</h3><p>使用格式字符作为事件描述信息，附加传入变量数据作为参数。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"></span><br><span class=\"line\">logging.warning(<span class=\"string\">&#x27;打印变量1：%s，打印变量2：%s&#x27;</span>, <span class=\"string\">&#x27;100&#x27;</span>, <span class=\"string\">&#x27;1000&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>output:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WARNING:root:打印变量<span class=\"number\">1</span>：<span class=\"number\">100</span>，打印变量<span class=\"number\">2</span>：<span class=\"number\">1000</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"更改显示消息的格式\"><a href=\"#更改显示消息的格式\" class=\"headerlink\" title=\"更改显示消息的格式\"></a>更改显示消息的格式</h3><p>example:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"></span><br><span class=\"line\">logging.basicConfig(<span class=\"built_in\">format</span>=<span class=\"string\">&#x27;%(levelname)s:%(message)s&#x27;</span>, level=logging.DEBUG)</span><br><span class=\"line\">logging.debug(<span class=\"string\">&quot;这是debug信息&quot;</span>)</span><br><span class=\"line\">logging.info(<span class=\"string\">&quot;这是info信息&quot;</span>)</span><br><span class=\"line\">logging.warning(<span class=\"string\">&quot;这是warning信息&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>output:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DEBUG:这是debug信息</span><br><span class=\"line\">INFO:这是info信息      </span><br><span class=\"line\">WARNING:这是warning信息</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在消息中显示日期-时间\"><a href=\"#在消息中显示日期-时间\" class=\"headerlink\" title=\"在消息中显示日期/时间\"></a>在消息中显示日期/时间</h3><p>显示事件的日期和时间，在格式字符串中使用<code>&#39;%(asctime)s&#39;</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"></span><br><span class=\"line\">logging.basicConfig(<span class=\"built_in\">format</span>=<span class=\"string\">&#x27;%(asctime)s %(message)s&#x27;</span>, level=logging.DEBUG)</span><br><span class=\"line\">logging.warning(<span class=\"string\">&#x27;这是警告信息&#x27;</span>)</span><br><span class=\"line\">logging.info(<span class=\"string\">&#x27;这是提示信息&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>output:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2021</span>-06-02 <span class=\"number\">10</span>:<span class=\"number\">52</span>:<span class=\"number\">34</span>,<span class=\"number\">738</span> 这是警告信息</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-02 <span class=\"number\">10</span>:<span class=\"number\">52</span>:<span class=\"number\">34</span>,<span class=\"number\">738</span> 这是提示信息</span><br></pre></td></tr></table></figure>\n\n<p><code>datafmt</code>参数可以控制时间的格式。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"></span><br><span class=\"line\">logging.basicConfig(<span class=\"built_in\">format</span>=<span class=\"string\">&#x27;%(asctime)s %(message)s&#x27;</span>, level=logging.DEBUG, datefmt=<span class=\"string\">&#x27;%Y-%m-%d %I:%M:%S %p&#x27;</span>)</span><br><span class=\"line\">logging.warning(<span class=\"string\">&#x27;这是警告信息&#x27;</span>)</span><br><span class=\"line\">logging.info(<span class=\"string\">&#x27;这是提示信息&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>output:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2021</span>-06-02 <span class=\"number\">10</span>:<span class=\"number\">55</span>:<span class=\"number\">55</span> AM 这是警告信息</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-02 <span class=\"number\">10</span>:<span class=\"number\">55</span>:<span class=\"number\">55</span> AM 这是提示信息</span><br></pre></td></tr></table></figure>\n\n<p><code>datefmt</code> 参数的格式与 <code>time.strftime()</code> 支持的格式相同。</p>\n<h2 id=\"进阶教程\"><a href=\"#进阶教程\" class=\"headerlink\" title=\"进阶教程\"></a>进阶教程</h2><p>日志库采用模块化的方法，提供了几类组件：记录器、处理器、过滤器和格式器。</p>\n<ul>\n<li>记录器暴露了应用程序代码直接使用的接口。</li>\n<li>处理器将日志记录（由记录器创建）发送到适当的目标。</li>\n<li>过滤器提供了更精细的附加功能，用于确定要输出的日志记录。</li>\n<li>格式器指定最终输出中日志记录的样式。</li>\n</ul>\n<p>通过调用 <code>Logger</code> 类（以下称为 loggers ， 记录器）的实例来执行日志记录。 每个实例都有一个名称，它们在概念上以点（句点）作为分隔符排列在命名空间的层次结构中。 例如，名为 ‘scan’ 的记录器是记录器 ‘scan.text’ ，’scan.html’ 和 ‘scan.pdf’ 的父级。 记录器名称可以是你想要的任何名称，并指示记录消息源自的应用程序区域。</p>\n<p>良好实践是在使用日志记录模块中使用模块记录器，命名如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">logger = logging.getLogger(__name__)</span><br></pre></td></tr></table></figure>\n\n<p>记录器层次结构的根称为根记录器。 这是函数 <code>debug()</code> 、 <code>info()</code> 、 <code>warning()</code> 、 <code>error()</code> 和 <code>critical() </code>使用的记录器，它们就是调用了根记录器的同名方法。函数和方法具有相同的签名。根记录器的名称在输出中打印为 <code>&#39;root&#39;</code> 。</p>\n<p>可以将消息记录到不同的地方。 软件包中的支持包含，用于将日志消息写入文件、 HTTP GET/POST 位置、通过 <code>SMTP</code> 发送电子邮件、通用套接字、队列或特定于操作系统的日志记录机制（如 <code>syslog</code> 或 Windows NT 事件日志）。 目标由 <code>handler</code> 类提供。 如果你有任何内置处理器类未满足的特殊要求，则可以创建自己的日志目标类。</p>\n<p>默认情况下，没有为任何日志消息设置目标。 你可以使用 <code>basicConfig()</code> 指定目标（例如控制台或文件），如教程示例中所示。 如果你调用函数 debug() 、 info() 、 warning() 、 error() 和 critical() ，它们将检查是否有设置目标；如果没有设置，将在委托给根记录器进行实际的消息输出之前设置目标为控制台（ sys.stderr ）并设置显示消息的默认格式。</p>\n<p>由 <code>basicConfig()</code> 设置的消息默认格式为：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">severity:logger name:message</span><br></pre></td></tr></table></figure>\n\n<p>可以通过使用 <code>format</code> 参数将格式字符串传递给 <code>basicConfig()</code> 来更改此设置。</p>\n<h3 id=\"记录流程\"><a href=\"#记录流程\" class=\"headerlink\" title=\"记录流程\"></a>记录流程</h3><p>记录器和处理器中的日志事件信息流程如下图所示。</p>\n<p><img src=\"\"></p>\n<h3 id=\"记录器\"><a href=\"#记录器\" class=\"headerlink\" title=\"记录器\"></a>记录器</h3><p><code>Logger</code> 对象有三重任务。首先，它们向应用程序代码公开了几种方法，以便应用程序可以在运行时记录消息。其次，记录器对象根据严重性（默认过滤工具）或过滤器对象确定要处理的日志消息。第三，记录器对象将相关的日志消息传递给所有感兴趣的日志处理器。</p>\n<p>这些是最常见的配置方法：</p>\n<ul>\n<li>Logger.setLevel() 指定记录器将处理的最低严重性日志消息，其中 debug 是最低内置严重性级别， critical 是最高内置严重性级别。 例如，如果严重性级别为 INFO ，则记录器将仅处理 INFO 、 WARNING 、 ERROR 和 CRITICAL 消息，并将忽略 DEBUG 消息。</li>\n<li>Logger.addHandler() 和 Logger.removeHandler() 从记录器对象中添加和删除处理器对象。处理器在以下内容中有更详细的介绍 处理器 。</li>\n<li>Logger.addFilter() 和 Logger.removeFilter() 可以添加或移除记录器对象中的过滤器。 过滤器对象 包含更多的过滤器细节。</li>\n</ul>\n<h3 id=\"处理器\"><a href=\"#处理器\" class=\"headerlink\" title=\"处理器\"></a>处理器</h3><p><code>Handler</code> 对象负责将适当的日志消息（基于日志消息的严重性）分派给处理器的指定目标。 <code>Logger</code> 对象可以使用 <code>addHandler()</code> 方法向自己添加零个或多个处理器对象。作为示例场景，应用程序可能希望将所有日志消息发送到日志文件，将错误或更高的所有日志消息发送到标准输出，以及将所有关键消息发送至一个邮件地址。 此方案需要三个单独的处理器，其中每个处理器负责将特定严重性的消息发送到特定位置。</p>\n<p>常用的配置方法：</p>\n<ul>\n<li>setLevel() 方法，就像在记录器对象中一样，指定将被分派到适当目标的最低严重性。为什么有两个 setLevel() 方法？记录器中设置的级别确定将传递给其处理器的消息的严重性。每个处理器中设置的级别确定该处理器将发送哪些消息。</li>\n<li>setFormatter() 选择一个该处理器使用的 Formatter 对象。</li>\n<li>addFilter() 和 removeFilter() 分别在处理器上配置和取消配置过滤器对象。</li>\n</ul>\n<h3 id=\"格式器\"><a href=\"#格式器\" class=\"headerlink\" title=\"格式器\"></a>格式器</h3><p>格式化器对象配置日志消息的最终顺序、结构和内容。与 <code>logging.Handler</code> 类不同，应用程序代码可以实例化格式器类，但如果应用程序需要特殊行为，则可能会对格式化器进行子类化定制。构造函数有三个可选参数 —— <code>消息格式字符串</code>、<code>日期格式字符串</code>和<code>样式指示符</code>。</p>\n<p><code>logging.Formatter.__init__(fmt=None, datefmt=None, style=&#39;%&#39;)</code></p>\n<p>如果没有消息格式字符串，则默认使用原始消息。如果没有日期格式字符串，则默认日期格式为：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%Y-%m-%d %H:%M:%S</span><br></pre></td></tr></table></figure>\n\n<p>最后加上毫秒数。 <code>style</code> 是 <code>％</code>，<code>&#39;&#123;&#39;</code> 或 <code>&#39;$&#39;</code> 之一。 如果未指定，则将使用 <code>&#39;％&#39;</code>。</p>\n<p>在 <code>3.2 </code>版更改: 添加 <code>style</code> 形参。</p>\n<p>以下消息格式字符串将以人类可读的格式记录时间、消息的严重性以及消息的内容，按此顺序:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;%(asctime)s - %(levelname)s - %(message)s&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>格式器通过用户可配置的函数将记录的创建时间转换为元组。 默认情况下，使用 <code>time.localtime()</code>；要为特定格式器实例更改此项，请将实例的 <code>converter</code> 属性设置为与 <code>time.localtime()</code> 或 <code>time.gmtime()</code> 具有相同签名的函数。</p>\n<h3 id=\"配置日志记录\"><a href=\"#配置日志记录\" class=\"headerlink\" title=\"配置日志记录\"></a>配置日志记录</h3><p>开发者可以通过三种方式配置日志记录：</p>\n<ol>\n<li>使用调用上面列出的配置方法的 <code>Python</code> 代码显式创建记录器、处理器和格式器。</li>\n<li>创建日志配置文件并使用 <code>fileConfig()</code> 函数读取它。</li>\n<li>创建配置信息字典并将其传递给 <code>dictConfig()</code> 函数。</li>\n</ol>\n<p>具体可参考官方文档。</p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>"},{"title":"python多线程基本原理","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-15T03:24:11.491Z","pic":null,"_content":"\n\n## 多线程的含义\n\n说起多线程，就不得不先说什么是线程。然而想要弄明白什么是线程，又不得不先说什么是进程。\n\n进程可以理解为是一个可以独立运行的程序单位，比如打开一个浏览器，这就开启了一个浏览器进程；打开一个文本编辑器，这就开启了一个文本编辑器进程。但一个进程中是可以同时处理很多事情的，比如在浏览器中，可以在多个选项卡中打开多个页面，有的页面在播放音乐，有的页面在播放视频，有的网页在播放动画，它们可以同时运行，互不干扰。为什么能同时做到同时运行这么多的任务呢？这里就需要引出线程的概念了，其实这一个个任务，实际上就对应着一个个线程的执行。\n\n而进程呢？它就是**线程的集合**，进程就是由一个或多个线程构成的，线程是操作系统进行运算调度的最小单位，是进程中的一个最小运行单元。比如上面所说的浏览器进程，其中的播放音乐就是一个线程，播放视频也是一个线程，当然其中还有很多其他的线程在同时运行，这些线程的并发或并行执行最后使得整个浏览器可以同时运行这么多的任务。\n\n了解了线程的概念，多线程就很容易理解了，多线程就是一个进程中同时执行多个线程，前面所说的浏览器的情景就是典型的多线程执行。\n\n## 并发和并行\n\n并说到多进程和多线程，这里就需要再讲解两个概念，那就是并发和并行。知道，一个程序在计算机中运行，其底层是处理器通过运行一条条的指令来实现的。\n\n并发，英文叫作`concurrency`。它是指同一时刻只能有一条指令执行，但是多个线程的对应的指令被快速轮换地执行。比如一个处理器，它先执行线程`A`的指令一段时间，再执行线程`B`的指令一段时间，再切回到线程`A`执行一段时间。\n\n由于处理器执行指令的速度和切换的速度非常非常快，人完全感知不到计算机在这个过程中有多个线程切换上下文执行的操作，这就使得宏观上看起来多个线程在同时运行。但微观上只是这个处理器在连续不断地在多个线程之间切换和执行，每个线程的执行一定会占用这个处理器一个时间片段，同一时刻，其实只有一个线程在执行。\n\n并行，英文叫作`parallel`。它是指同一时刻，有多条指令在多个处理器上同时执行，并行必须要依赖于多个处理器。不论是从宏观上还是微观上，多个线程都是在同一时刻一起执行的。\n\n并行只能在多处理器系统中存在，如果的计算机处理器只有一个核，那就不可能实现并行。而并发在单处理器和多处理器系统中都是可以存在的，因为仅靠一个核，就可以实现并发。\n\n举个例子，比如系统处理器需要同时运行多个线程。如果系统处理器只有一个核，那它只能通过并发的方式来运行这些线程。如果系统处理器有多个核，当一个核在执行一个线程时，另一个核可以执行另一个线程，这样这两个线程就实现了并行执行，当然其他的线程也可能和另外的线程处在同一个核上执行，它们之间就是并发执行。具体的执行方式，就取决于操作系统的调度了。\n\n## 多线程适用场景\n\n多在一个程序进程中，有一些操作是比较耗时或者需要等待的，比如等待数据库的查询结果的返回，等待网页结果的响应。如果使用单线程，处理器必须要等到这些操作完成之后才能继续往下执行其他操作，而这个线程在等待的过程中，处理器明显是可以来执行其他的操作的。如果使用多线程，处理器就可以在某个线程等待的时候，去执行其他的线程，从而从整体上提高执行效率。\n\n像上述场景，线程在执行过程中很多情况下是需要等待的。比如网络爬虫就是一个非常典型的例子，爬虫在向服务器发起请求之后，有一段时间必须要等待服务器的响应返回，这种任务就属于`IO`密集型任务。对于这种任务，如果启用多线程，处理器就可以在某个线程等待的过程中去处理其他的任务，从而提高整体的爬取效率。\n\n但并不是所有的任务都是`IO`密集型任务，还有一种任务叫作计算密集型任务，也可以称之为`CPU`密集型任务。顾名思义，就是任务的运行一直需要处理器的参与。此时如果开启了多线程，一个处理器从一个计算密集型任务切换到切换到另一个计算密集型任务上去，处理器依然不会停下来，始终会忙于计算，这样并不会节省总体的时间，因为需要处理的任务的计算总量是不变的。如果线程数目过多，反而还会在线程切换的过程中多耗费一些时间，整体效率会变低。\n\n所以，如果任务不全是计算密集型任务，可以使用多线程来提高程序整体的执行效率。尤其对于网络爬虫这种IO密集型任务来说，使用多线程会大大提高程序整体的爬取效率。\n\n## Python实现多线程\n\n实在`Python`中，实现多线程的模块叫作`threading`，是`Python`自带的模块。使用`threading`实现多线程的方法。\n\n###Thread直接创建子线程\n\n首先，可以使用`Thread`类来创建一个线程，创建时需要指定`target`参数为运行的方法名称，如果被调用的方法需要传入额外的参数，则可以通过`Thread`的`args`参数来指定。示例如下：\n\n```python\nimport threading\nimport time\n\ndef target(second):\n    print(f'Threading {threading.currentThread().name} id runing')\n    print(f'Threading {threading.current_thread().name} sleep {second}s')\n    time.sleep(second)\n    print(f'Threading {threading.currentThread().name} is ended')\n\nprint(f'Threading {threading.currentThread().name} id runing')\nfor i in [1, 5]:\n    thread = threading.Thread(target=target, args=[i])\n    thread.start()\nprint(f'Threading {threading.currentThread().name} is ended')\n```\n\n运行结果如下：\n\n```python\nThreading MainThread id runing\nThreading Thread-1 id runing\nThreading Thread-1 sleep 1s\nThreading Thread-2 id runingThreading MainThread is ended\n\nThreading Thread-2 sleep 5s\nThreading Thread-1 is ended\nThreading Thread-2 is ended\n```\n\n在这里首先声明了一个方法，叫作`target`，它接收一个参数为`second`，通过方法的实现可以发现，这个方法其实就是执行了一个`time.sleep`休眠操作，`second`参数就是休眠秒数，其前后都`print`了一些内容，其中线程的名字通过`threading.current_thread().name`来获取出来，如果是主线程的话，其值就是`MainThread`，如果是子线程的话，其值就是`Thread-*`。\n\n然后通过`Thead`类新建了两个线程，`target`参数就是刚才所定义的方法名，`args`以列表的形式传递。两次循环中，这里`i`分别就是`1`和`5`，这样两个线程就分别休眠`1`秒·和5秒，声明完成之后，调用`start`方法即可开始线程的运行。\n\n观察结果可以发现，这里一共产生了三个线程，分别是主线程`MainThread`和两个子线程`Thread-1`、`Thread-2`。另外观察到，主线程首先运行结束，紧接着`Thread-1`、`Thread-2`才接连运行结束，分别间隔了`1`秒和`4`秒。这说明主线程并没有等待子线程运行完毕才结束运行，而是直接退出了，有点不符合常理。如果想要主线程等待子线程运行完毕之后才退出，可以让每个子线程对象都调用下`join`方法，实现如下：\n\n```python\nthreads = []\nfor i in [1, 5]:\n    thread = threading.Thread(target=target, args=[i])\n    threads.append(thread)\n    thread.start()\nfor thread in threads:\n    thread.join()\n```\n\n运行结果如下：\n\n```python\nThreading MainThread id runing\nThreading Thread-1 id runing\nThreading Thread-1 sleep 1s\nThreading Thread-2 id runing\nThreading Thread-2 sleep 5s\nThreading Thread-1 is ended\nThreading Thread-2 is ended\nThreading MainThread is ended\n```\n\n主线程必须等待子线程都运行结束，主线程才继续运行并结束。\n\n## 继承Thread类创建子线程\n\n另外，也可以通过继承`Thread`类的方式创建一个线程，该线程需要执行的方法写在类的`run`方法里面即可。上面的例子的等价改写为：\n\n```python\nimport time\nimport threading\n\nclass MyThread(threading.Thread):\n    def __init__(self, second):\n        threading.Thread.__init__(self)\n        self.second = second\n\n    def run(self):\n        print(f'Threading {threading.current_thread().name} is runing')\n        print(f'Threding {threading.current_thread().name} sleep {self.second}s')\n        time.sleep(self.second)\n        print(f'Threading {threading.current_thread().name} is ended')\n\nprint(f'Threading {threading.current_thread().name} is running')\nthreads = []\nfor i in [1, 5]:\n    thread = MyThread(i)\n    threads.append(thread)\n    thread.start()\nfor thread in threads:\n    thread.join()\nprint(f'Threading {threading.current_thread().name} is ended')\n```\n\n运行结果如下：\n\n```python\nThreading MainThread id runing\nThreading Thread-1 id runing\nThreading Thread-1 sleep 1s\nThreading Thread-2 id runing\nThreading Thread-2 sleep 5s\nThreading Thread-1 is ended\nThreading Thread-2 is ended\nThreading MainThread is ended\n```\n\n可以看到，两种实现方式，其运行效果是相同的。\n\n## 守护进程\n\n在线程中有一个叫作守护线程的概念，如果一个线程被设置为守护线程，那么意味着这个线程是“不重要”的，这意味着，如果主线程结束了而该守护线程还没有运行完，那么它将会被强制结束。在`Python`中可以通过`setDaemon`方法来将某个线程设置为守护线程。\n\n示例如下：\n\n```python\nThreding MainThread is running\nThreading Thread-1 is running\nThreding Thread-1 sleep 2s\nThreading Thread-2 is running\nThreding Thread-2 sleep 5s\nThreading MainThread is ended\nThreading Thread-1 is ended\n```\n\n在这里通过 setDaemon方法将 t2 设置为了守护线程，这样主线程在运行完毕时，t2 线程会随着线程的结束而结束。\n\n运行结果如下：\n\n```python\nThreding MainThread is running\nThreading Thread-1 is running\nThreding Thread-1 sleep 2s\nThreading Thread-2 is running\nThreding Thread-2 sleep 5s\nThreading MainThread is ended\nThreading Thread-1 is ended\n```\n\n可以看到，没有`Thread-2`打印退出的消息，`Thread-2`随着主线程的退出而退出了。\n\n这里并没有调用`join`方法，如果让`t1`和`t2`都调用`join`方法，主线程就会仍然等待各个子线程执行完毕再退出，不论其是否是守护线程。\n\n## 互斥锁\n\n互在一个进程中的多个线程是共享资源的，比如在一个进程中，有一个全局变量`count`用来计数，声明多个线程，每个线程运行时都给`count`加`1`，代码实现如下：\n\n在这里，声明了`1000`个线程，每个线程都是现取到当前的全局变量`count`值，然后休眠一小段时间，然后对`count`赋予新的值。\n\n按照常理来说，最终的`count`值应该为`1000`。但其实不然。运行结果如下：\n\n```python\nFinal count: 15\n```\n\n最后的结果居然只有`15`，而且多次运行或者换个环境运行结果是不同的.这是为什么呢？因为`count`这个值是共享的，每个线程都可以在执行`temp = count`这行代码时拿到当前`count`的值，但是这些线程中的一些线程可能是并发或者并行执行的，这就导致不同的线程拿到的可能是同一个`count`值，最后导致有些线程的`count`的加`1`操作并没有生效，导致最后的结果偏小。\n\n所以，如果多个线程同时对某个数据进行读取或修改，就会出现不可预料的结果。为了避免这种情况，我们需要对多个线程进行同步，要实现同步，我们可以对需要操作的数据进行**加锁保护**，这里就需要用到`threading.Lock`了。\n\n加锁保护是什么意思呢？就是说，某个线程在对数据进行操作前，需要先加锁，这样其他的线程发现被加锁了之后，就无法继续向下执行，会一直等待锁被释放，只有加锁的线程把锁释放了，其他的线程才能 继续加锁并对数据做修改，修改完了再释放锁。这样可以确保同一时间只有一个线程操作数据，多个线程不会再同时读取和修改同一个数据，这样最后的运行结果就是对的了。\n\n将代码修改为如下内容：\n\n```python\nimport time\nimport threading\n\ncount = 0\n\nclass MyThread(threading.Thread):\n    def __init__(self):\n        threading.Thread.__init__(self)\n\n    def run(self):\n        global count\n        lock.acquire()  # 加锁\n        temp = count + 1\n        time.sleep(0.001)\n        count = temp\n        lock.release() # 解锁\n\nthreads = []\nlock = threading.Lock() # 创建一把锁\nfor _ in range(1000):\n    thread = MyThread()\n    thread.start()\n    threads.append(thread)\n\nfor thread in threads:\n    thread.join()\nprint(f'Final count: {count}')\n\n```\n\n运行结果如下：\n\n```python\nFinal count: 1000\n```\n\n## Python多线程的问题\n\n由于`Python`中`GIL`的限制，导致不论是在单核还是多核条件下，在同一时刻只能运行一个线程，导致`Python`多线程无法发挥多核并行的优势。\n\n`GIL`全称为`GlobalInterpreter Lock`，中文翻译为全局解释器锁，其最初设计是出于数据安全而考虑的。\n\n在`Python`多线程下，每个线程的执行方式如下：\n\n- 获取`GIL`执行对应线程的代码\n- 释放`GIL`可见，某个线程想要执行，必须先拿到 GIL，我们可以把 GIL看作是通行证，并且在一个 Python进程中，GIL只有一个。拿不到通行证的线程，就不允许执行。这样就会导致，即使是多核条件下，一个 Python 进程下的多个线程，同一时刻也只能执行一个线程。 不过对于爬虫这种 IO 密集型任务来说，这个问题影响并不大。而对于计算密集型任务来说，由于 GIL的存在，多线程总体的运行效率相比可能反而比单线程更低","source":"_posts/python多线程基本原理.md","raw":"---\ntitle: python多线程基本原理\ntags: \n- python\n- 多线程\n- threading\ncomments: true\ntoc: true\nonly:\n- home\n- category\n- tag\ndate: 2021-05-1303:42:12\ncategories: Python\npic:\n---\n\n\n## 多线程的含义\n\n说起多线程，就不得不先说什么是线程。然而想要弄明白什么是线程，又不得不先说什么是进程。\n\n进程可以理解为是一个可以独立运行的程序单位，比如打开一个浏览器，这就开启了一个浏览器进程；打开一个文本编辑器，这就开启了一个文本编辑器进程。但一个进程中是可以同时处理很多事情的，比如在浏览器中，可以在多个选项卡中打开多个页面，有的页面在播放音乐，有的页面在播放视频，有的网页在播放动画，它们可以同时运行，互不干扰。为什么能同时做到同时运行这么多的任务呢？这里就需要引出线程的概念了，其实这一个个任务，实际上就对应着一个个线程的执行。\n\n而进程呢？它就是**线程的集合**，进程就是由一个或多个线程构成的，线程是操作系统进行运算调度的最小单位，是进程中的一个最小运行单元。比如上面所说的浏览器进程，其中的播放音乐就是一个线程，播放视频也是一个线程，当然其中还有很多其他的线程在同时运行，这些线程的并发或并行执行最后使得整个浏览器可以同时运行这么多的任务。\n\n了解了线程的概念，多线程就很容易理解了，多线程就是一个进程中同时执行多个线程，前面所说的浏览器的情景就是典型的多线程执行。\n\n## 并发和并行\n\n并说到多进程和多线程，这里就需要再讲解两个概念，那就是并发和并行。知道，一个程序在计算机中运行，其底层是处理器通过运行一条条的指令来实现的。\n\n并发，英文叫作`concurrency`。它是指同一时刻只能有一条指令执行，但是多个线程的对应的指令被快速轮换地执行。比如一个处理器，它先执行线程`A`的指令一段时间，再执行线程`B`的指令一段时间，再切回到线程`A`执行一段时间。\n\n由于处理器执行指令的速度和切换的速度非常非常快，人完全感知不到计算机在这个过程中有多个线程切换上下文执行的操作，这就使得宏观上看起来多个线程在同时运行。但微观上只是这个处理器在连续不断地在多个线程之间切换和执行，每个线程的执行一定会占用这个处理器一个时间片段，同一时刻，其实只有一个线程在执行。\n\n并行，英文叫作`parallel`。它是指同一时刻，有多条指令在多个处理器上同时执行，并行必须要依赖于多个处理器。不论是从宏观上还是微观上，多个线程都是在同一时刻一起执行的。\n\n并行只能在多处理器系统中存在，如果的计算机处理器只有一个核，那就不可能实现并行。而并发在单处理器和多处理器系统中都是可以存在的，因为仅靠一个核，就可以实现并发。\n\n举个例子，比如系统处理器需要同时运行多个线程。如果系统处理器只有一个核，那它只能通过并发的方式来运行这些线程。如果系统处理器有多个核，当一个核在执行一个线程时，另一个核可以执行另一个线程，这样这两个线程就实现了并行执行，当然其他的线程也可能和另外的线程处在同一个核上执行，它们之间就是并发执行。具体的执行方式，就取决于操作系统的调度了。\n\n## 多线程适用场景\n\n多在一个程序进程中，有一些操作是比较耗时或者需要等待的，比如等待数据库的查询结果的返回，等待网页结果的响应。如果使用单线程，处理器必须要等到这些操作完成之后才能继续往下执行其他操作，而这个线程在等待的过程中，处理器明显是可以来执行其他的操作的。如果使用多线程，处理器就可以在某个线程等待的时候，去执行其他的线程，从而从整体上提高执行效率。\n\n像上述场景，线程在执行过程中很多情况下是需要等待的。比如网络爬虫就是一个非常典型的例子，爬虫在向服务器发起请求之后，有一段时间必须要等待服务器的响应返回，这种任务就属于`IO`密集型任务。对于这种任务，如果启用多线程，处理器就可以在某个线程等待的过程中去处理其他的任务，从而提高整体的爬取效率。\n\n但并不是所有的任务都是`IO`密集型任务，还有一种任务叫作计算密集型任务，也可以称之为`CPU`密集型任务。顾名思义，就是任务的运行一直需要处理器的参与。此时如果开启了多线程，一个处理器从一个计算密集型任务切换到切换到另一个计算密集型任务上去，处理器依然不会停下来，始终会忙于计算，这样并不会节省总体的时间，因为需要处理的任务的计算总量是不变的。如果线程数目过多，反而还会在线程切换的过程中多耗费一些时间，整体效率会变低。\n\n所以，如果任务不全是计算密集型任务，可以使用多线程来提高程序整体的执行效率。尤其对于网络爬虫这种IO密集型任务来说，使用多线程会大大提高程序整体的爬取效率。\n\n## Python实现多线程\n\n实在`Python`中，实现多线程的模块叫作`threading`，是`Python`自带的模块。使用`threading`实现多线程的方法。\n\n###Thread直接创建子线程\n\n首先，可以使用`Thread`类来创建一个线程，创建时需要指定`target`参数为运行的方法名称，如果被调用的方法需要传入额外的参数，则可以通过`Thread`的`args`参数来指定。示例如下：\n\n```python\nimport threading\nimport time\n\ndef target(second):\n    print(f'Threading {threading.currentThread().name} id runing')\n    print(f'Threading {threading.current_thread().name} sleep {second}s')\n    time.sleep(second)\n    print(f'Threading {threading.currentThread().name} is ended')\n\nprint(f'Threading {threading.currentThread().name} id runing')\nfor i in [1, 5]:\n    thread = threading.Thread(target=target, args=[i])\n    thread.start()\nprint(f'Threading {threading.currentThread().name} is ended')\n```\n\n运行结果如下：\n\n```python\nThreading MainThread id runing\nThreading Thread-1 id runing\nThreading Thread-1 sleep 1s\nThreading Thread-2 id runingThreading MainThread is ended\n\nThreading Thread-2 sleep 5s\nThreading Thread-1 is ended\nThreading Thread-2 is ended\n```\n\n在这里首先声明了一个方法，叫作`target`，它接收一个参数为`second`，通过方法的实现可以发现，这个方法其实就是执行了一个`time.sleep`休眠操作，`second`参数就是休眠秒数，其前后都`print`了一些内容，其中线程的名字通过`threading.current_thread().name`来获取出来，如果是主线程的话，其值就是`MainThread`，如果是子线程的话，其值就是`Thread-*`。\n\n然后通过`Thead`类新建了两个线程，`target`参数就是刚才所定义的方法名，`args`以列表的形式传递。两次循环中，这里`i`分别就是`1`和`5`，这样两个线程就分别休眠`1`秒·和5秒，声明完成之后，调用`start`方法即可开始线程的运行。\n\n观察结果可以发现，这里一共产生了三个线程，分别是主线程`MainThread`和两个子线程`Thread-1`、`Thread-2`。另外观察到，主线程首先运行结束，紧接着`Thread-1`、`Thread-2`才接连运行结束，分别间隔了`1`秒和`4`秒。这说明主线程并没有等待子线程运行完毕才结束运行，而是直接退出了，有点不符合常理。如果想要主线程等待子线程运行完毕之后才退出，可以让每个子线程对象都调用下`join`方法，实现如下：\n\n```python\nthreads = []\nfor i in [1, 5]:\n    thread = threading.Thread(target=target, args=[i])\n    threads.append(thread)\n    thread.start()\nfor thread in threads:\n    thread.join()\n```\n\n运行结果如下：\n\n```python\nThreading MainThread id runing\nThreading Thread-1 id runing\nThreading Thread-1 sleep 1s\nThreading Thread-2 id runing\nThreading Thread-2 sleep 5s\nThreading Thread-1 is ended\nThreading Thread-2 is ended\nThreading MainThread is ended\n```\n\n主线程必须等待子线程都运行结束，主线程才继续运行并结束。\n\n## 继承Thread类创建子线程\n\n另外，也可以通过继承`Thread`类的方式创建一个线程，该线程需要执行的方法写在类的`run`方法里面即可。上面的例子的等价改写为：\n\n```python\nimport time\nimport threading\n\nclass MyThread(threading.Thread):\n    def __init__(self, second):\n        threading.Thread.__init__(self)\n        self.second = second\n\n    def run(self):\n        print(f'Threading {threading.current_thread().name} is runing')\n        print(f'Threding {threading.current_thread().name} sleep {self.second}s')\n        time.sleep(self.second)\n        print(f'Threading {threading.current_thread().name} is ended')\n\nprint(f'Threading {threading.current_thread().name} is running')\nthreads = []\nfor i in [1, 5]:\n    thread = MyThread(i)\n    threads.append(thread)\n    thread.start()\nfor thread in threads:\n    thread.join()\nprint(f'Threading {threading.current_thread().name} is ended')\n```\n\n运行结果如下：\n\n```python\nThreading MainThread id runing\nThreading Thread-1 id runing\nThreading Thread-1 sleep 1s\nThreading Thread-2 id runing\nThreading Thread-2 sleep 5s\nThreading Thread-1 is ended\nThreading Thread-2 is ended\nThreading MainThread is ended\n```\n\n可以看到，两种实现方式，其运行效果是相同的。\n\n## 守护进程\n\n在线程中有一个叫作守护线程的概念，如果一个线程被设置为守护线程，那么意味着这个线程是“不重要”的，这意味着，如果主线程结束了而该守护线程还没有运行完，那么它将会被强制结束。在`Python`中可以通过`setDaemon`方法来将某个线程设置为守护线程。\n\n示例如下：\n\n```python\nThreding MainThread is running\nThreading Thread-1 is running\nThreding Thread-1 sleep 2s\nThreading Thread-2 is running\nThreding Thread-2 sleep 5s\nThreading MainThread is ended\nThreading Thread-1 is ended\n```\n\n在这里通过 setDaemon方法将 t2 设置为了守护线程，这样主线程在运行完毕时，t2 线程会随着线程的结束而结束。\n\n运行结果如下：\n\n```python\nThreding MainThread is running\nThreading Thread-1 is running\nThreding Thread-1 sleep 2s\nThreading Thread-2 is running\nThreding Thread-2 sleep 5s\nThreading MainThread is ended\nThreading Thread-1 is ended\n```\n\n可以看到，没有`Thread-2`打印退出的消息，`Thread-2`随着主线程的退出而退出了。\n\n这里并没有调用`join`方法，如果让`t1`和`t2`都调用`join`方法，主线程就会仍然等待各个子线程执行完毕再退出，不论其是否是守护线程。\n\n## 互斥锁\n\n互在一个进程中的多个线程是共享资源的，比如在一个进程中，有一个全局变量`count`用来计数，声明多个线程，每个线程运行时都给`count`加`1`，代码实现如下：\n\n在这里，声明了`1000`个线程，每个线程都是现取到当前的全局变量`count`值，然后休眠一小段时间，然后对`count`赋予新的值。\n\n按照常理来说，最终的`count`值应该为`1000`。但其实不然。运行结果如下：\n\n```python\nFinal count: 15\n```\n\n最后的结果居然只有`15`，而且多次运行或者换个环境运行结果是不同的.这是为什么呢？因为`count`这个值是共享的，每个线程都可以在执行`temp = count`这行代码时拿到当前`count`的值，但是这些线程中的一些线程可能是并发或者并行执行的，这就导致不同的线程拿到的可能是同一个`count`值，最后导致有些线程的`count`的加`1`操作并没有生效，导致最后的结果偏小。\n\n所以，如果多个线程同时对某个数据进行读取或修改，就会出现不可预料的结果。为了避免这种情况，我们需要对多个线程进行同步，要实现同步，我们可以对需要操作的数据进行**加锁保护**，这里就需要用到`threading.Lock`了。\n\n加锁保护是什么意思呢？就是说，某个线程在对数据进行操作前，需要先加锁，这样其他的线程发现被加锁了之后，就无法继续向下执行，会一直等待锁被释放，只有加锁的线程把锁释放了，其他的线程才能 继续加锁并对数据做修改，修改完了再释放锁。这样可以确保同一时间只有一个线程操作数据，多个线程不会再同时读取和修改同一个数据，这样最后的运行结果就是对的了。\n\n将代码修改为如下内容：\n\n```python\nimport time\nimport threading\n\ncount = 0\n\nclass MyThread(threading.Thread):\n    def __init__(self):\n        threading.Thread.__init__(self)\n\n    def run(self):\n        global count\n        lock.acquire()  # 加锁\n        temp = count + 1\n        time.sleep(0.001)\n        count = temp\n        lock.release() # 解锁\n\nthreads = []\nlock = threading.Lock() # 创建一把锁\nfor _ in range(1000):\n    thread = MyThread()\n    thread.start()\n    threads.append(thread)\n\nfor thread in threads:\n    thread.join()\nprint(f'Final count: {count}')\n\n```\n\n运行结果如下：\n\n```python\nFinal count: 1000\n```\n\n## Python多线程的问题\n\n由于`Python`中`GIL`的限制，导致不论是在单核还是多核条件下，在同一时刻只能运行一个线程，导致`Python`多线程无法发挥多核并行的优势。\n\n`GIL`全称为`GlobalInterpreter Lock`，中文翻译为全局解释器锁，其最初设计是出于数据安全而考虑的。\n\n在`Python`多线程下，每个线程的执行方式如下：\n\n- 获取`GIL`执行对应线程的代码\n- 释放`GIL`可见，某个线程想要执行，必须先拿到 GIL，我们可以把 GIL看作是通行证，并且在一个 Python进程中，GIL只有一个。拿不到通行证的线程，就不允许执行。这样就会导致，即使是多核条件下，一个 Python 进程下的多个线程，同一时刻也只能执行一个线程。 不过对于爬虫这种 IO 密集型任务来说，这个问题影响并不大。而对于计算密集型任务来说，由于 GIL的存在，多线程总体的运行效率相比可能反而比单线程更低","slug":"python多线程基本原理","published":1,"updated":"2021-06-15T03:24:11.492Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2k002844ud9kdmc7e0","content":"<h2 id=\"多线程的含义\"><a href=\"#多线程的含义\" class=\"headerlink\" title=\"多线程的含义\"></a>多线程的含义</h2><p>说起多线程，就不得不先说什么是线程。然而想要弄明白什么是线程，又不得不先说什么是进程。</p>\n<p>进程可以理解为是一个可以独立运行的程序单位，比如打开一个浏览器，这就开启了一个浏览器进程；打开一个文本编辑器，这就开启了一个文本编辑器进程。但一个进程中是可以同时处理很多事情的，比如在浏览器中，可以在多个选项卡中打开多个页面，有的页面在播放音乐，有的页面在播放视频，有的网页在播放动画，它们可以同时运行，互不干扰。为什么能同时做到同时运行这么多的任务呢？这里就需要引出线程的概念了，其实这一个个任务，实际上就对应着一个个线程的执行。</p>\n<p>而进程呢？它就是<strong>线程的集合</strong>，进程就是由一个或多个线程构成的，线程是操作系统进行运算调度的最小单位，是进程中的一个最小运行单元。比如上面所说的浏览器进程，其中的播放音乐就是一个线程，播放视频也是一个线程，当然其中还有很多其他的线程在同时运行，这些线程的并发或并行执行最后使得整个浏览器可以同时运行这么多的任务。</p>\n<p>了解了线程的概念，多线程就很容易理解了，多线程就是一个进程中同时执行多个线程，前面所说的浏览器的情景就是典型的多线程执行。</p>\n<h2 id=\"并发和并行\"><a href=\"#并发和并行\" class=\"headerlink\" title=\"并发和并行\"></a>并发和并行</h2><p>并说到多进程和多线程，这里就需要再讲解两个概念，那就是并发和并行。知道，一个程序在计算机中运行，其底层是处理器通过运行一条条的指令来实现的。</p>\n<p>并发，英文叫作<code>concurrency</code>。它是指同一时刻只能有一条指令执行，但是多个线程的对应的指令被快速轮换地执行。比如一个处理器，它先执行线程<code>A</code>的指令一段时间，再执行线程<code>B</code>的指令一段时间，再切回到线程<code>A</code>执行一段时间。</p>\n<p>由于处理器执行指令的速度和切换的速度非常非常快，人完全感知不到计算机在这个过程中有多个线程切换上下文执行的操作，这就使得宏观上看起来多个线程在同时运行。但微观上只是这个处理器在连续不断地在多个线程之间切换和执行，每个线程的执行一定会占用这个处理器一个时间片段，同一时刻，其实只有一个线程在执行。</p>\n<p>并行，英文叫作<code>parallel</code>。它是指同一时刻，有多条指令在多个处理器上同时执行，并行必须要依赖于多个处理器。不论是从宏观上还是微观上，多个线程都是在同一时刻一起执行的。</p>\n<p>并行只能在多处理器系统中存在，如果的计算机处理器只有一个核，那就不可能实现并行。而并发在单处理器和多处理器系统中都是可以存在的，因为仅靠一个核，就可以实现并发。</p>\n<p>举个例子，比如系统处理器需要同时运行多个线程。如果系统处理器只有一个核，那它只能通过并发的方式来运行这些线程。如果系统处理器有多个核，当一个核在执行一个线程时，另一个核可以执行另一个线程，这样这两个线程就实现了并行执行，当然其他的线程也可能和另外的线程处在同一个核上执行，它们之间就是并发执行。具体的执行方式，就取决于操作系统的调度了。</p>\n<h2 id=\"多线程适用场景\"><a href=\"#多线程适用场景\" class=\"headerlink\" title=\"多线程适用场景\"></a>多线程适用场景</h2><p>多在一个程序进程中，有一些操作是比较耗时或者需要等待的，比如等待数据库的查询结果的返回，等待网页结果的响应。如果使用单线程，处理器必须要等到这些操作完成之后才能继续往下执行其他操作，而这个线程在等待的过程中，处理器明显是可以来执行其他的操作的。如果使用多线程，处理器就可以在某个线程等待的时候，去执行其他的线程，从而从整体上提高执行效率。</p>\n<p>像上述场景，线程在执行过程中很多情况下是需要等待的。比如网络爬虫就是一个非常典型的例子，爬虫在向服务器发起请求之后，有一段时间必须要等待服务器的响应返回，这种任务就属于<code>IO</code>密集型任务。对于这种任务，如果启用多线程，处理器就可以在某个线程等待的过程中去处理其他的任务，从而提高整体的爬取效率。</p>\n<p>但并不是所有的任务都是<code>IO</code>密集型任务，还有一种任务叫作计算密集型任务，也可以称之为<code>CPU</code>密集型任务。顾名思义，就是任务的运行一直需要处理器的参与。此时如果开启了多线程，一个处理器从一个计算密集型任务切换到切换到另一个计算密集型任务上去，处理器依然不会停下来，始终会忙于计算，这样并不会节省总体的时间，因为需要处理的任务的计算总量是不变的。如果线程数目过多，反而还会在线程切换的过程中多耗费一些时间，整体效率会变低。</p>\n<p>所以，如果任务不全是计算密集型任务，可以使用多线程来提高程序整体的执行效率。尤其对于网络爬虫这种IO密集型任务来说，使用多线程会大大提高程序整体的爬取效率。</p>\n<h2 id=\"Python实现多线程\"><a href=\"#Python实现多线程\" class=\"headerlink\" title=\"Python实现多线程\"></a>Python实现多线程</h2><p>实在<code>Python</code>中，实现多线程的模块叫作<code>threading</code>，是<code>Python</code>自带的模块。使用<code>threading</code>实现多线程的方法。</p>\n<p>###Thread直接创建子线程</p>\n<p>首先，可以使用<code>Thread</code>类来创建一个线程，创建时需要指定<code>target</code>参数为运行的方法名称，如果被调用的方法需要传入额外的参数，则可以通过<code>Thread</code>的<code>args</code>参数来指定。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> threading</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">target</span>(<span class=\"params\">second</span>):</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.currentThread().name&#125;</span> id runing&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.current_thread().name&#125;</span> sleep <span class=\"subst\">&#123;second&#125;</span>s&#x27;</span>)</span><br><span class=\"line\">    time.sleep(second)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.currentThread().name&#125;</span> is ended&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.currentThread().name&#125;</span> id runing&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> [<span class=\"number\">1</span>, <span class=\"number\">5</span>]:</span><br><span class=\"line\">    thread = threading.Thread(target=target, args=[i])</span><br><span class=\"line\">    thread.start()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.currentThread().name&#125;</span> is ended&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Threading MainThread <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> sleep 1s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"built_in\">id</span> runingThreading MainThread <span class=\"keyword\">is</span> ended</span><br><span class=\"line\"></span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> sleep 5s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"keyword\">is</span> ended</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"keyword\">is</span> ended</span><br></pre></td></tr></table></figure>\n\n<p>在这里首先声明了一个方法，叫作<code>target</code>，它接收一个参数为<code>second</code>，通过方法的实现可以发现，这个方法其实就是执行了一个<code>time.sleep</code>休眠操作，<code>second</code>参数就是休眠秒数，其前后都<code>print</code>了一些内容，其中线程的名字通过<code>threading.current_thread().name</code>来获取出来，如果是主线程的话，其值就是<code>MainThread</code>，如果是子线程的话，其值就是<code>Thread-*</code>。</p>\n<p>然后通过<code>Thead</code>类新建了两个线程，<code>target</code>参数就是刚才所定义的方法名，<code>args</code>以列表的形式传递。两次循环中，这里<code>i</code>分别就是<code>1</code>和<code>5</code>，这样两个线程就分别休眠<code>1</code>秒·和5秒，声明完成之后，调用<code>start</code>方法即可开始线程的运行。</p>\n<p>观察结果可以发现，这里一共产生了三个线程，分别是主线程<code>MainThread</code>和两个子线程<code>Thread-1</code>、<code>Thread-2</code>。另外观察到，主线程首先运行结束，紧接着<code>Thread-1</code>、<code>Thread-2</code>才接连运行结束，分别间隔了<code>1</code>秒和<code>4</code>秒。这说明主线程并没有等待子线程运行完毕才结束运行，而是直接退出了，有点不符合常理。如果想要主线程等待子线程运行完毕之后才退出，可以让每个子线程对象都调用下<code>join</code>方法，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">threads = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> [<span class=\"number\">1</span>, <span class=\"number\">5</span>]:</span><br><span class=\"line\">    thread = threading.Thread(target=target, args=[i])</span><br><span class=\"line\">    threads.append(thread)</span><br><span class=\"line\">    thread.start()</span><br><span class=\"line\"><span class=\"keyword\">for</span> thread <span class=\"keyword\">in</span> threads:</span><br><span class=\"line\">    thread.join()</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Threading MainThread <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> sleep 1s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> sleep 5s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"keyword\">is</span> ended</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"keyword\">is</span> ended</span><br><span class=\"line\">Threading MainThread <span class=\"keyword\">is</span> ended</span><br></pre></td></tr></table></figure>\n\n<p>主线程必须等待子线程都运行结束，主线程才继续运行并结束。</p>\n<h2 id=\"继承Thread类创建子线程\"><a href=\"#继承Thread类创建子线程\" class=\"headerlink\" title=\"继承Thread类创建子线程\"></a>继承Thread类创建子线程</h2><p>另外，也可以通过继承<code>Thread</code>类的方式创建一个线程，该线程需要执行的方法写在类的<code>run</code>方法里面即可。上面的例子的等价改写为：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> threading</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread</span>(<span class=\"params\">threading.Thread</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, second</span>):</span></span><br><span class=\"line\">        threading.Thread.__init__(self)</span><br><span class=\"line\">        self.second = second</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">run</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.current_thread().name&#125;</span> is runing&#x27;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threding <span class=\"subst\">&#123;threading.current_thread().name&#125;</span> sleep <span class=\"subst\">&#123;self.second&#125;</span>s&#x27;</span>)</span><br><span class=\"line\">        time.sleep(self.second)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.current_thread().name&#125;</span> is ended&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.current_thread().name&#125;</span> is running&#x27;</span>)</span><br><span class=\"line\">threads = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> [<span class=\"number\">1</span>, <span class=\"number\">5</span>]:</span><br><span class=\"line\">    thread = MyThread(i)</span><br><span class=\"line\">    threads.append(thread)</span><br><span class=\"line\">    thread.start()</span><br><span class=\"line\"><span class=\"keyword\">for</span> thread <span class=\"keyword\">in</span> threads:</span><br><span class=\"line\">    thread.join()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.current_thread().name&#125;</span> is ended&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Threading MainThread <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> sleep 1s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> sleep 5s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"keyword\">is</span> ended</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"keyword\">is</span> ended</span><br><span class=\"line\">Threading MainThread <span class=\"keyword\">is</span> ended</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，两种实现方式，其运行效果是相同的。</p>\n<h2 id=\"守护进程\"><a href=\"#守护进程\" class=\"headerlink\" title=\"守护进程\"></a>守护进程</h2><p>在线程中有一个叫作守护线程的概念，如果一个线程被设置为守护线程，那么意味着这个线程是“不重要”的，这意味着，如果主线程结束了而该守护线程还没有运行完，那么它将会被强制结束。在<code>Python</code>中可以通过<code>setDaemon</code>方法来将某个线程设置为守护线程。</p>\n<p>示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Threding MainThread <span class=\"keyword\">is</span> running</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"keyword\">is</span> running</span><br><span class=\"line\">Threding Thread-<span class=\"number\">1</span> sleep 2s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"keyword\">is</span> running</span><br><span class=\"line\">Threding Thread-<span class=\"number\">2</span> sleep 5s</span><br><span class=\"line\">Threading MainThread <span class=\"keyword\">is</span> ended</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"keyword\">is</span> ended</span><br></pre></td></tr></table></figure>\n\n<p>在这里通过 setDaemon方法将 t2 设置为了守护线程，这样主线程在运行完毕时，t2 线程会随着线程的结束而结束。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Threding MainThread <span class=\"keyword\">is</span> running</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"keyword\">is</span> running</span><br><span class=\"line\">Threding Thread-<span class=\"number\">1</span> sleep 2s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"keyword\">is</span> running</span><br><span class=\"line\">Threding Thread-<span class=\"number\">2</span> sleep 5s</span><br><span class=\"line\">Threading MainThread <span class=\"keyword\">is</span> ended</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"keyword\">is</span> ended</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，没有<code>Thread-2</code>打印退出的消息，<code>Thread-2</code>随着主线程的退出而退出了。</p>\n<p>这里并没有调用<code>join</code>方法，如果让<code>t1</code>和<code>t2</code>都调用<code>join</code>方法，主线程就会仍然等待各个子线程执行完毕再退出，不论其是否是守护线程。</p>\n<h2 id=\"互斥锁\"><a href=\"#互斥锁\" class=\"headerlink\" title=\"互斥锁\"></a>互斥锁</h2><p>互在一个进程中的多个线程是共享资源的，比如在一个进程中，有一个全局变量<code>count</code>用来计数，声明多个线程，每个线程运行时都给<code>count</code>加<code>1</code>，代码实现如下：</p>\n<p>在这里，声明了<code>1000</code>个线程，每个线程都是现取到当前的全局变量<code>count</code>值，然后休眠一小段时间，然后对<code>count</code>赋予新的值。</p>\n<p>按照常理来说，最终的<code>count</code>值应该为<code>1000</code>。但其实不然。运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Final count: <span class=\"number\">15</span></span><br></pre></td></tr></table></figure>\n\n<p>最后的结果居然只有<code>15</code>，而且多次运行或者换个环境运行结果是不同的.这是为什么呢？因为<code>count</code>这个值是共享的，每个线程都可以在执行<code>temp = count</code>这行代码时拿到当前<code>count</code>的值，但是这些线程中的一些线程可能是并发或者并行执行的，这就导致不同的线程拿到的可能是同一个<code>count</code>值，最后导致有些线程的<code>count</code>的加<code>1</code>操作并没有生效，导致最后的结果偏小。</p>\n<p>所以，如果多个线程同时对某个数据进行读取或修改，就会出现不可预料的结果。为了避免这种情况，我们需要对多个线程进行同步，要实现同步，我们可以对需要操作的数据进行<strong>加锁保护</strong>，这里就需要用到<code>threading.Lock</code>了。</p>\n<p>加锁保护是什么意思呢？就是说，某个线程在对数据进行操作前，需要先加锁，这样其他的线程发现被加锁了之后，就无法继续向下执行，会一直等待锁被释放，只有加锁的线程把锁释放了，其他的线程才能 继续加锁并对数据做修改，修改完了再释放锁。这样可以确保同一时间只有一个线程操作数据，多个线程不会再同时读取和修改同一个数据，这样最后的运行结果就是对的了。</p>\n<p>将代码修改为如下内容：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> threading</span><br><span class=\"line\"></span><br><span class=\"line\">count = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread</span>(<span class=\"params\">threading.Thread</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        threading.Thread.__init__(self)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">run</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">global</span> count</span><br><span class=\"line\">        lock.acquire()  <span class=\"comment\"># 加锁</span></span><br><span class=\"line\">        temp = count + <span class=\"number\">1</span></span><br><span class=\"line\">        time.sleep(<span class=\"number\">0.001</span>)</span><br><span class=\"line\">        count = temp</span><br><span class=\"line\">        lock.release() <span class=\"comment\"># 解锁</span></span><br><span class=\"line\"></span><br><span class=\"line\">threads = []</span><br><span class=\"line\">lock = threading.Lock() <span class=\"comment\"># 创建一把锁</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1000</span>):</span><br><span class=\"line\">    thread = MyThread()</span><br><span class=\"line\">    thread.start()</span><br><span class=\"line\">    threads.append(thread)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> thread <span class=\"keyword\">in</span> threads:</span><br><span class=\"line\">    thread.join()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Final count: <span class=\"subst\">&#123;count&#125;</span>&#x27;</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Final count: <span class=\"number\">1000</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Python多线程的问题\"><a href=\"#Python多线程的问题\" class=\"headerlink\" title=\"Python多线程的问题\"></a>Python多线程的问题</h2><p>由于<code>Python</code>中<code>GIL</code>的限制，导致不论是在单核还是多核条件下，在同一时刻只能运行一个线程，导致<code>Python</code>多线程无法发挥多核并行的优势。</p>\n<p><code>GIL</code>全称为<code>GlobalInterpreter Lock</code>，中文翻译为全局解释器锁，其最初设计是出于数据安全而考虑的。</p>\n<p>在<code>Python</code>多线程下，每个线程的执行方式如下：</p>\n<ul>\n<li>获取<code>GIL</code>执行对应线程的代码</li>\n<li>释放<code>GIL</code>可见，某个线程想要执行，必须先拿到 GIL，我们可以把 GIL看作是通行证，并且在一个 Python进程中，GIL只有一个。拿不到通行证的线程，就不允许执行。这样就会导致，即使是多核条件下，一个 Python 进程下的多个线程，同一时刻也只能执行一个线程。 不过对于爬虫这种 IO 密集型任务来说，这个问题影响并不大。而对于计算密集型任务来说，由于 GIL的存在，多线程总体的运行效率相比可能反而比单线程更低</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"多线程的含义\"><a href=\"#多线程的含义\" class=\"headerlink\" title=\"多线程的含义\"></a>多线程的含义</h2><p>说起多线程，就不得不先说什么是线程。然而想要弄明白什么是线程，又不得不先说什么是进程。</p>\n<p>进程可以理解为是一个可以独立运行的程序单位，比如打开一个浏览器，这就开启了一个浏览器进程；打开一个文本编辑器，这就开启了一个文本编辑器进程。但一个进程中是可以同时处理很多事情的，比如在浏览器中，可以在多个选项卡中打开多个页面，有的页面在播放音乐，有的页面在播放视频，有的网页在播放动画，它们可以同时运行，互不干扰。为什么能同时做到同时运行这么多的任务呢？这里就需要引出线程的概念了，其实这一个个任务，实际上就对应着一个个线程的执行。</p>\n<p>而进程呢？它就是<strong>线程的集合</strong>，进程就是由一个或多个线程构成的，线程是操作系统进行运算调度的最小单位，是进程中的一个最小运行单元。比如上面所说的浏览器进程，其中的播放音乐就是一个线程，播放视频也是一个线程，当然其中还有很多其他的线程在同时运行，这些线程的并发或并行执行最后使得整个浏览器可以同时运行这么多的任务。</p>\n<p>了解了线程的概念，多线程就很容易理解了，多线程就是一个进程中同时执行多个线程，前面所说的浏览器的情景就是典型的多线程执行。</p>\n<h2 id=\"并发和并行\"><a href=\"#并发和并行\" class=\"headerlink\" title=\"并发和并行\"></a>并发和并行</h2><p>并说到多进程和多线程，这里就需要再讲解两个概念，那就是并发和并行。知道，一个程序在计算机中运行，其底层是处理器通过运行一条条的指令来实现的。</p>\n<p>并发，英文叫作<code>concurrency</code>。它是指同一时刻只能有一条指令执行，但是多个线程的对应的指令被快速轮换地执行。比如一个处理器，它先执行线程<code>A</code>的指令一段时间，再执行线程<code>B</code>的指令一段时间，再切回到线程<code>A</code>执行一段时间。</p>\n<p>由于处理器执行指令的速度和切换的速度非常非常快，人完全感知不到计算机在这个过程中有多个线程切换上下文执行的操作，这就使得宏观上看起来多个线程在同时运行。但微观上只是这个处理器在连续不断地在多个线程之间切换和执行，每个线程的执行一定会占用这个处理器一个时间片段，同一时刻，其实只有一个线程在执行。</p>\n<p>并行，英文叫作<code>parallel</code>。它是指同一时刻，有多条指令在多个处理器上同时执行，并行必须要依赖于多个处理器。不论是从宏观上还是微观上，多个线程都是在同一时刻一起执行的。</p>\n<p>并行只能在多处理器系统中存在，如果的计算机处理器只有一个核，那就不可能实现并行。而并发在单处理器和多处理器系统中都是可以存在的，因为仅靠一个核，就可以实现并发。</p>\n<p>举个例子，比如系统处理器需要同时运行多个线程。如果系统处理器只有一个核，那它只能通过并发的方式来运行这些线程。如果系统处理器有多个核，当一个核在执行一个线程时，另一个核可以执行另一个线程，这样这两个线程就实现了并行执行，当然其他的线程也可能和另外的线程处在同一个核上执行，它们之间就是并发执行。具体的执行方式，就取决于操作系统的调度了。</p>\n<h2 id=\"多线程适用场景\"><a href=\"#多线程适用场景\" class=\"headerlink\" title=\"多线程适用场景\"></a>多线程适用场景</h2><p>多在一个程序进程中，有一些操作是比较耗时或者需要等待的，比如等待数据库的查询结果的返回，等待网页结果的响应。如果使用单线程，处理器必须要等到这些操作完成之后才能继续往下执行其他操作，而这个线程在等待的过程中，处理器明显是可以来执行其他的操作的。如果使用多线程，处理器就可以在某个线程等待的时候，去执行其他的线程，从而从整体上提高执行效率。</p>\n<p>像上述场景，线程在执行过程中很多情况下是需要等待的。比如网络爬虫就是一个非常典型的例子，爬虫在向服务器发起请求之后，有一段时间必须要等待服务器的响应返回，这种任务就属于<code>IO</code>密集型任务。对于这种任务，如果启用多线程，处理器就可以在某个线程等待的过程中去处理其他的任务，从而提高整体的爬取效率。</p>\n<p>但并不是所有的任务都是<code>IO</code>密集型任务，还有一种任务叫作计算密集型任务，也可以称之为<code>CPU</code>密集型任务。顾名思义，就是任务的运行一直需要处理器的参与。此时如果开启了多线程，一个处理器从一个计算密集型任务切换到切换到另一个计算密集型任务上去，处理器依然不会停下来，始终会忙于计算，这样并不会节省总体的时间，因为需要处理的任务的计算总量是不变的。如果线程数目过多，反而还会在线程切换的过程中多耗费一些时间，整体效率会变低。</p>\n<p>所以，如果任务不全是计算密集型任务，可以使用多线程来提高程序整体的执行效率。尤其对于网络爬虫这种IO密集型任务来说，使用多线程会大大提高程序整体的爬取效率。</p>\n<h2 id=\"Python实现多线程\"><a href=\"#Python实现多线程\" class=\"headerlink\" title=\"Python实现多线程\"></a>Python实现多线程</h2><p>实在<code>Python</code>中，实现多线程的模块叫作<code>threading</code>，是<code>Python</code>自带的模块。使用<code>threading</code>实现多线程的方法。</p>\n<p>###Thread直接创建子线程</p>\n<p>首先，可以使用<code>Thread</code>类来创建一个线程，创建时需要指定<code>target</code>参数为运行的方法名称，如果被调用的方法需要传入额外的参数，则可以通过<code>Thread</code>的<code>args</code>参数来指定。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> threading</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">target</span>(<span class=\"params\">second</span>):</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.currentThread().name&#125;</span> id runing&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.current_thread().name&#125;</span> sleep <span class=\"subst\">&#123;second&#125;</span>s&#x27;</span>)</span><br><span class=\"line\">    time.sleep(second)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.currentThread().name&#125;</span> is ended&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.currentThread().name&#125;</span> id runing&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> [<span class=\"number\">1</span>, <span class=\"number\">5</span>]:</span><br><span class=\"line\">    thread = threading.Thread(target=target, args=[i])</span><br><span class=\"line\">    thread.start()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.currentThread().name&#125;</span> is ended&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Threading MainThread <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> sleep 1s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"built_in\">id</span> runingThreading MainThread <span class=\"keyword\">is</span> ended</span><br><span class=\"line\"></span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> sleep 5s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"keyword\">is</span> ended</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"keyword\">is</span> ended</span><br></pre></td></tr></table></figure>\n\n<p>在这里首先声明了一个方法，叫作<code>target</code>，它接收一个参数为<code>second</code>，通过方法的实现可以发现，这个方法其实就是执行了一个<code>time.sleep</code>休眠操作，<code>second</code>参数就是休眠秒数，其前后都<code>print</code>了一些内容，其中线程的名字通过<code>threading.current_thread().name</code>来获取出来，如果是主线程的话，其值就是<code>MainThread</code>，如果是子线程的话，其值就是<code>Thread-*</code>。</p>\n<p>然后通过<code>Thead</code>类新建了两个线程，<code>target</code>参数就是刚才所定义的方法名，<code>args</code>以列表的形式传递。两次循环中，这里<code>i</code>分别就是<code>1</code>和<code>5</code>，这样两个线程就分别休眠<code>1</code>秒·和5秒，声明完成之后，调用<code>start</code>方法即可开始线程的运行。</p>\n<p>观察结果可以发现，这里一共产生了三个线程，分别是主线程<code>MainThread</code>和两个子线程<code>Thread-1</code>、<code>Thread-2</code>。另外观察到，主线程首先运行结束，紧接着<code>Thread-1</code>、<code>Thread-2</code>才接连运行结束，分别间隔了<code>1</code>秒和<code>4</code>秒。这说明主线程并没有等待子线程运行完毕才结束运行，而是直接退出了，有点不符合常理。如果想要主线程等待子线程运行完毕之后才退出，可以让每个子线程对象都调用下<code>join</code>方法，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">threads = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> [<span class=\"number\">1</span>, <span class=\"number\">5</span>]:</span><br><span class=\"line\">    thread = threading.Thread(target=target, args=[i])</span><br><span class=\"line\">    threads.append(thread)</span><br><span class=\"line\">    thread.start()</span><br><span class=\"line\"><span class=\"keyword\">for</span> thread <span class=\"keyword\">in</span> threads:</span><br><span class=\"line\">    thread.join()</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Threading MainThread <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> sleep 1s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> sleep 5s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"keyword\">is</span> ended</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"keyword\">is</span> ended</span><br><span class=\"line\">Threading MainThread <span class=\"keyword\">is</span> ended</span><br></pre></td></tr></table></figure>\n\n<p>主线程必须等待子线程都运行结束，主线程才继续运行并结束。</p>\n<h2 id=\"继承Thread类创建子线程\"><a href=\"#继承Thread类创建子线程\" class=\"headerlink\" title=\"继承Thread类创建子线程\"></a>继承Thread类创建子线程</h2><p>另外，也可以通过继承<code>Thread</code>类的方式创建一个线程，该线程需要执行的方法写在类的<code>run</code>方法里面即可。上面的例子的等价改写为：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> threading</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread</span>(<span class=\"params\">threading.Thread</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, second</span>):</span></span><br><span class=\"line\">        threading.Thread.__init__(self)</span><br><span class=\"line\">        self.second = second</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">run</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.current_thread().name&#125;</span> is runing&#x27;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threding <span class=\"subst\">&#123;threading.current_thread().name&#125;</span> sleep <span class=\"subst\">&#123;self.second&#125;</span>s&#x27;</span>)</span><br><span class=\"line\">        time.sleep(self.second)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.current_thread().name&#125;</span> is ended&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.current_thread().name&#125;</span> is running&#x27;</span>)</span><br><span class=\"line\">threads = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> [<span class=\"number\">1</span>, <span class=\"number\">5</span>]:</span><br><span class=\"line\">    thread = MyThread(i)</span><br><span class=\"line\">    threads.append(thread)</span><br><span class=\"line\">    thread.start()</span><br><span class=\"line\"><span class=\"keyword\">for</span> thread <span class=\"keyword\">in</span> threads:</span><br><span class=\"line\">    thread.join()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Threading <span class=\"subst\">&#123;threading.current_thread().name&#125;</span> is ended&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Threading MainThread <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> sleep 1s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"built_in\">id</span> runing</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> sleep 5s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"keyword\">is</span> ended</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"keyword\">is</span> ended</span><br><span class=\"line\">Threading MainThread <span class=\"keyword\">is</span> ended</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，两种实现方式，其运行效果是相同的。</p>\n<h2 id=\"守护进程\"><a href=\"#守护进程\" class=\"headerlink\" title=\"守护进程\"></a>守护进程</h2><p>在线程中有一个叫作守护线程的概念，如果一个线程被设置为守护线程，那么意味着这个线程是“不重要”的，这意味着，如果主线程结束了而该守护线程还没有运行完，那么它将会被强制结束。在<code>Python</code>中可以通过<code>setDaemon</code>方法来将某个线程设置为守护线程。</p>\n<p>示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Threding MainThread <span class=\"keyword\">is</span> running</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"keyword\">is</span> running</span><br><span class=\"line\">Threding Thread-<span class=\"number\">1</span> sleep 2s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"keyword\">is</span> running</span><br><span class=\"line\">Threding Thread-<span class=\"number\">2</span> sleep 5s</span><br><span class=\"line\">Threading MainThread <span class=\"keyword\">is</span> ended</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"keyword\">is</span> ended</span><br></pre></td></tr></table></figure>\n\n<p>在这里通过 setDaemon方法将 t2 设置为了守护线程，这样主线程在运行完毕时，t2 线程会随着线程的结束而结束。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Threding MainThread <span class=\"keyword\">is</span> running</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"keyword\">is</span> running</span><br><span class=\"line\">Threding Thread-<span class=\"number\">1</span> sleep 2s</span><br><span class=\"line\">Threading Thread-<span class=\"number\">2</span> <span class=\"keyword\">is</span> running</span><br><span class=\"line\">Threding Thread-<span class=\"number\">2</span> sleep 5s</span><br><span class=\"line\">Threading MainThread <span class=\"keyword\">is</span> ended</span><br><span class=\"line\">Threading Thread-<span class=\"number\">1</span> <span class=\"keyword\">is</span> ended</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，没有<code>Thread-2</code>打印退出的消息，<code>Thread-2</code>随着主线程的退出而退出了。</p>\n<p>这里并没有调用<code>join</code>方法，如果让<code>t1</code>和<code>t2</code>都调用<code>join</code>方法，主线程就会仍然等待各个子线程执行完毕再退出，不论其是否是守护线程。</p>\n<h2 id=\"互斥锁\"><a href=\"#互斥锁\" class=\"headerlink\" title=\"互斥锁\"></a>互斥锁</h2><p>互在一个进程中的多个线程是共享资源的，比如在一个进程中，有一个全局变量<code>count</code>用来计数，声明多个线程，每个线程运行时都给<code>count</code>加<code>1</code>，代码实现如下：</p>\n<p>在这里，声明了<code>1000</code>个线程，每个线程都是现取到当前的全局变量<code>count</code>值，然后休眠一小段时间，然后对<code>count</code>赋予新的值。</p>\n<p>按照常理来说，最终的<code>count</code>值应该为<code>1000</code>。但其实不然。运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Final count: <span class=\"number\">15</span></span><br></pre></td></tr></table></figure>\n\n<p>最后的结果居然只有<code>15</code>，而且多次运行或者换个环境运行结果是不同的.这是为什么呢？因为<code>count</code>这个值是共享的，每个线程都可以在执行<code>temp = count</code>这行代码时拿到当前<code>count</code>的值，但是这些线程中的一些线程可能是并发或者并行执行的，这就导致不同的线程拿到的可能是同一个<code>count</code>值，最后导致有些线程的<code>count</code>的加<code>1</code>操作并没有生效，导致最后的结果偏小。</p>\n<p>所以，如果多个线程同时对某个数据进行读取或修改，就会出现不可预料的结果。为了避免这种情况，我们需要对多个线程进行同步，要实现同步，我们可以对需要操作的数据进行<strong>加锁保护</strong>，这里就需要用到<code>threading.Lock</code>了。</p>\n<p>加锁保护是什么意思呢？就是说，某个线程在对数据进行操作前，需要先加锁，这样其他的线程发现被加锁了之后，就无法继续向下执行，会一直等待锁被释放，只有加锁的线程把锁释放了，其他的线程才能 继续加锁并对数据做修改，修改完了再释放锁。这样可以确保同一时间只有一个线程操作数据，多个线程不会再同时读取和修改同一个数据，这样最后的运行结果就是对的了。</p>\n<p>将代码修改为如下内容：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> threading</span><br><span class=\"line\"></span><br><span class=\"line\">count = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread</span>(<span class=\"params\">threading.Thread</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        threading.Thread.__init__(self)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">run</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">global</span> count</span><br><span class=\"line\">        lock.acquire()  <span class=\"comment\"># 加锁</span></span><br><span class=\"line\">        temp = count + <span class=\"number\">1</span></span><br><span class=\"line\">        time.sleep(<span class=\"number\">0.001</span>)</span><br><span class=\"line\">        count = temp</span><br><span class=\"line\">        lock.release() <span class=\"comment\"># 解锁</span></span><br><span class=\"line\"></span><br><span class=\"line\">threads = []</span><br><span class=\"line\">lock = threading.Lock() <span class=\"comment\"># 创建一把锁</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1000</span>):</span><br><span class=\"line\">    thread = MyThread()</span><br><span class=\"line\">    thread.start()</span><br><span class=\"line\">    threads.append(thread)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> thread <span class=\"keyword\">in</span> threads:</span><br><span class=\"line\">    thread.join()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Final count: <span class=\"subst\">&#123;count&#125;</span>&#x27;</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Final count: <span class=\"number\">1000</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Python多线程的问题\"><a href=\"#Python多线程的问题\" class=\"headerlink\" title=\"Python多线程的问题\"></a>Python多线程的问题</h2><p>由于<code>Python</code>中<code>GIL</code>的限制，导致不论是在单核还是多核条件下，在同一时刻只能运行一个线程，导致<code>Python</code>多线程无法发挥多核并行的优势。</p>\n<p><code>GIL</code>全称为<code>GlobalInterpreter Lock</code>，中文翻译为全局解释器锁，其最初设计是出于数据安全而考虑的。</p>\n<p>在<code>Python</code>多线程下，每个线程的执行方式如下：</p>\n<ul>\n<li>获取<code>GIL</code>执行对应线程的代码</li>\n<li>释放<code>GIL</code>可见，某个线程想要执行，必须先拿到 GIL，我们可以把 GIL看作是通行证，并且在一个 Python进程中，GIL只有一个。拿不到通行证的线程，就不允许执行。这样就会导致，即使是多核条件下，一个 Python 进程下的多个线程，同一时刻也只能执行一个线程。 不过对于爬虫这种 IO 密集型任务来说，这个问题影响并不大。而对于计算密集型任务来说，由于 GIL的存在，多线程总体的运行效率相比可能反而比单线程更低</li>\n</ul>\n"},{"title":"python的内置类型","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-28T15:52:16.000Z","pic":null,"_content":"\n## 字符串与字节\n\n`Python3`中只有一种能够保存文本信息的数据类型，就是`str`(`string`，字符串)。它是不可变的序列，保存的`Unicode`码位(`code point`)。\n\n字符串可以保存的数据类型有非常明确的限制，就是`Unicode`文本。\n\n`bytes`以及可变的`bytearray`与`str`不同，只能用字节作为序列值，即`0<=x<256`范围内的整数。\n\n```python\n>>> bytes([102,111,111])\nb'foo'\n```\n\n对于`bytes`和`bytearray`，在转换为另一种序列类型（例如`list`或`tuple`）时可以显示出其本来面目：\n\n```python\n>>> list(b'foo bar')\n[102, 111, 111, 32, 98, 97, 114]\n>>> tuple(b'foo bar')\n(102, 111, 111, 32, 98, 97, 114)\n```\n\n从`Python3.0`开始，所有没有前缀的字符串都是`Unicode`。因此，所有用单引号（'）、双引号（\"）或成组的3个引号（单引号或双引号）包围且没有前缀的值都表示`str`数据类型：\n\n```python\n>>> type(\"some string\")\n<class 'str'>\n```\n\n字节也被单引号、双引号或三引号包围，但必须有一个`b`或`B`前缀：\n\n```python\n>>> type(b\"some bytes\")\n<class 'bytes'>\n```\n\n`Python`字符串是不可变的。字节序列也是如此。`bytearray`是`bytes`的可变版本，不存在这样的问题。字节数组可以通过元素赋值来进行原处修改（无需创建新对象），其大小也可以像列表一样动态地变化（利用`append`、`pop`、`inseer`等方法）。\n\n### 字符串拼接\n\n用`str.join()`方法。它接受可迭代的字符串作为参数，返回合并后的字符串。\n\n```python\n>>> ','.join(['some','one','like','you','forever'])\n'some,one,like,you,forever'\n```\n\n因为`join()`方法速度更快（对于大型列表来说更是如此），并不意味着在所有需要拼接两个字符串的情况下都应该使用这一方法。虽然这是一种广为认可的做法，但并不会提高代码的可读性。可读性是很重要的！在某些情况下，`join()`的性能可能还不如利用加法的普通拼接。\n\n## 集合类型\n\n### 列表和元组\n\n列表是动态的，其大小可以改变；而元组是不可变的，一旦创建就不能修改。\n\n`tuple是`不可变的（immutable），因此也是可哈希的（hashable）\n\n从细节上来看，`Python`中的列表是由对其他对象的引用组成的的连续数组。指向这个数组的指针及其长度被保存在一个列表头结构中。这意味着，每次添加或删除一个元素时，由引用组成的数组需要改变大小（重新分配）。幸运的是，`Python`在创建这些数组时采用了指数过分配（exponential over-allocation），所以并不是每次操作都需要改变数组大小。这也是添加或取出元素的平摊复杂度较低的原因。不幸的是，在普通链表中“代价很小”的其他一些操作在`Python`中的计算复杂度却相对较高：\n\n- 利用`list.insert`方法在任意位置插入一个元素——复杂度为`O(n)`。\n- 利用`list.delete`或`del`删除一个元素——复杂度为`O(n)`。\n\n![](Screenshot_1.webp)\n\n#### 列表推导\n\n```python\n>>> evens = []\n>>> for i in range(10):\n...     if i%2 == 0:\n...             evens.append(i)\n...\n>>> evens\n[0, 2, 4, 6, 8]\n```\n\n这种写法可能适用于`C`语言，但在`Python`中的实际运行速度很慢，原因如下。\n\n- 解释器在每次循环中都需要判断序列中的哪一部分需要修改。\n- 需要用一个计数器来跟踪需要处理的元素。\n- 由于`append()`是一个列表方法，所以每次遍历时还需要额外执行一个查询函数。\n\n列表推导正是解决这个问题的正确方法。它使用编排好的功能对上述语法的一部分做了自动化处理：\n\n```python\n>>> [i for i in range(10) if i % 2 == 0]\n[0, 2, 4, 6, 8]\n```\n\n这种写法除了更加高效之外，也更加简短，涉及的语法元素也更少。在大型程序中，这意味着更少的错误，代码也更容易阅读和理解。\n\n#### 其他习语\n\n`Python`习语的另一个典型例子是使用`enumerate`（枚举）。在循环中使用序列时，这个内置函数可以很方便地获取其索引。以下面这段代码为例：\n\n```python\n>>> for element in ['one','two','three']:\n...     print(i, element)\n...     i += 1\n...\n0 one\n1 two\n2 three\n```\n\n它可以替换为下面这段更短的代码：\n\n```python\n>>> for i, element in enumerate(['one','two','three']):\n...     print(i, element)\n...\n0 one\n1 two\n2 three\n```\n\n#### 序列解包（sequence unpacking）\n\n这种方法并不限于列表和元组，而是适用于任意序列类型（甚至包括字符串和字节序列）。只要赋值运算符左边的变量数目与序列中的元素数目相等，你都可以用这种方法将元素序列解包到另一组变量中：\n\n```python\n>>> first, second, third = \"holy\", \"chan\", 100\n>>> first\n'holy'\n>>> second\n'chan'\n>>> third\n100\n```\n\n解包还可以利用带星号的表达式获取单个变量中的多个元素，只要它的解释没有歧义即可。还可以对嵌套序列进行解包。特别是在遍历由序列构成的复杂数据结构时，这种方法非常实用。下面是一些更复杂的解包示例\n\n```python\n>>> # 带星号的表达式可以获取序列的剩余部分\n>>> first, second, *rest = 0, 1, 2, 3\n>>> first\n0\n>>> second\n1\n>>> rest\n[2, 3]\n\n>>> # 带星号的表达式可以获取序列的中间部分\n>>> first, *inner, last = 0, 1, 2, 3\n>>> first\n0\n>>> inner\n[1, 2]\n>>> last\n3\n\n>>> # 嵌套解包\n>>> (a,b), (c,d) = (1,2), (3,4)\n>>> a, b, c, d\n(1, 2, 3, 4)\n```\n\n### 字典\n\n字典是`Python`中最通用的数据结构之一。`dict`可以将一组唯一键映射到对应的值，如下所示：\n\n```python\n{\n  1: 'one',\n  2: 'two',\n  3: 'three',\n}\n```\n\n可以用和前面列表推导类似的推导来创建一个新的字典。这里有一个非常简单的例子如下所示：\n\n```python\n>>> squares = {number: number ** 2 for number in range(10)}\n>>> squares\n{0: 0, 1: 1, 2: 4, 3: 9, 4: 16, 5: 25, 6: 36, 7: 49, 8: 64, 9: 81}\n```\n\n在许多情况下，字典推导要更加高效、更加简短、更加整洁。对于更复杂的代码而言，需要用到许多`if`语句或函数调用来创建一个字典，这时最好使用简单的`for`循环，尤其是它还提高了可读性。\n\n对于`python3`，字典的`keys()`、`values()`和`items()`3个方法的返回值类型不再是列表。此外，与之对应的`iterkeys()`、`itervalues()`和`iteritems()`本来返回的是迭代器，而`Python3`中并没有这3个方法。现在`keys()`、`values()`和`items()`返回的是视图对象（`viewobjects`）。\n\n- keys()：返回dict_keys对象，可以查看字典的所有键。\n- values()：返回dict_values对象，可以查看字典的所有值。\n- items()：返回dict_items对象，可以查看字典所有的(key, value)二元元组。\n\n视图对象可以动态查看字典的内容，因此每次字典发生变化时，视图都会相应改变，见下面这个例子：\n\n```python\n>>> words = {'foo1':'bar', 'fizz':'bazz'}\n>>> items = words.items()\n>>> words['spam'] = 'eggs'\n>>> items\ndict_items([('foo1', 'bar'), ('fizz', 'bazz'), ('spam', 'eggs')])\n```\n\n视图对象既有旧的`keys()`、`values()`和`items()`方法返回的列表的特性，也有旧的`iterkeys()`、`itervalues()`和`iteritems()`方法返回的迭代器的特性。视图无需冗余地将所有值都保存在内存里（像列表那样），但你仍然可以获取其长度（使用`len`），也可以测试元素是否包含其中（使用`in`子句）。当然，视图是可迭代的。最后一件重要的事情是，在`keys()`和`values()`方法返回的视图中，键和值的顺序是完全对应的。\n\n### 集合\n\n集合是一种鲁棒性很好的数据结构，当元素顺序的重要性不如元素的唯一性和测试元素是否包含在集合中的效率时，大部分情况下这种数据结构是很有用的。它与数学上的集合概念非常类似。`Python`的内置集合类型有两种。\n\n- set()：一种可变的、无序的、有限的集合，其元素是唯一的、不可变的（可哈希的）对象。\n- frozenset()：一种不可变的、可哈希的、无序的集合，其元素是唯一的、不可变的（可哈希的）对象。\n\n由于`frozenset()`具有不变性，它可以用作字典的键，也可以作为其他`set()`和`frozenset()`的元素。在一个`set()`或`frozenset()`中不能包含另一个普通的可变`set()`，因为这会引发`TypeError`：\n\n```python\n>>> set([set([1,2,3]),set([2,3,4])])\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nTypeError: unhashable type: 'set'\n```\n\n下面这种集合初始化的方法是完全正确的：\n\n```python\n>>> set([frozenset([1,2,3]),frozenset([2,3,4])])\n{frozenset({1, 2, 3}), frozenset({2, 3, 4})}\n```\n\n创建可变集合方法有以下3种，如下所示。\n\n- 调用set()，选择性地接受可迭代对象作为初始化参数，例如set([0, 1, 2])。\n- 使用集合推导，例如{element for element in range(3)}。\n- 使用集合字面值，例如{1, 2, 3}。\n\n使用集合的字面值和推导要格外小心，因为它们在形式上与字典的字面值和推导非常相似。此外，空的集合对象是没有字面值的。空的花括号{}表示的是空的字典字面值。\n","source":"_posts/python的内置类型.md","raw":"---\ntitle: python的内置类型\ntags:\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-28 23:52:16\ncategories: Python\npic:\n---\n\n## 字符串与字节\n\n`Python3`中只有一种能够保存文本信息的数据类型，就是`str`(`string`，字符串)。它是不可变的序列，保存的`Unicode`码位(`code point`)。\n\n字符串可以保存的数据类型有非常明确的限制，就是`Unicode`文本。\n\n`bytes`以及可变的`bytearray`与`str`不同，只能用字节作为序列值，即`0<=x<256`范围内的整数。\n\n```python\n>>> bytes([102,111,111])\nb'foo'\n```\n\n对于`bytes`和`bytearray`，在转换为另一种序列类型（例如`list`或`tuple`）时可以显示出其本来面目：\n\n```python\n>>> list(b'foo bar')\n[102, 111, 111, 32, 98, 97, 114]\n>>> tuple(b'foo bar')\n(102, 111, 111, 32, 98, 97, 114)\n```\n\n从`Python3.0`开始，所有没有前缀的字符串都是`Unicode`。因此，所有用单引号（'）、双引号（\"）或成组的3个引号（单引号或双引号）包围且没有前缀的值都表示`str`数据类型：\n\n```python\n>>> type(\"some string\")\n<class 'str'>\n```\n\n字节也被单引号、双引号或三引号包围，但必须有一个`b`或`B`前缀：\n\n```python\n>>> type(b\"some bytes\")\n<class 'bytes'>\n```\n\n`Python`字符串是不可变的。字节序列也是如此。`bytearray`是`bytes`的可变版本，不存在这样的问题。字节数组可以通过元素赋值来进行原处修改（无需创建新对象），其大小也可以像列表一样动态地变化（利用`append`、`pop`、`inseer`等方法）。\n\n### 字符串拼接\n\n用`str.join()`方法。它接受可迭代的字符串作为参数，返回合并后的字符串。\n\n```python\n>>> ','.join(['some','one','like','you','forever'])\n'some,one,like,you,forever'\n```\n\n因为`join()`方法速度更快（对于大型列表来说更是如此），并不意味着在所有需要拼接两个字符串的情况下都应该使用这一方法。虽然这是一种广为认可的做法，但并不会提高代码的可读性。可读性是很重要的！在某些情况下，`join()`的性能可能还不如利用加法的普通拼接。\n\n## 集合类型\n\n### 列表和元组\n\n列表是动态的，其大小可以改变；而元组是不可变的，一旦创建就不能修改。\n\n`tuple是`不可变的（immutable），因此也是可哈希的（hashable）\n\n从细节上来看，`Python`中的列表是由对其他对象的引用组成的的连续数组。指向这个数组的指针及其长度被保存在一个列表头结构中。这意味着，每次添加或删除一个元素时，由引用组成的数组需要改变大小（重新分配）。幸运的是，`Python`在创建这些数组时采用了指数过分配（exponential over-allocation），所以并不是每次操作都需要改变数组大小。这也是添加或取出元素的平摊复杂度较低的原因。不幸的是，在普通链表中“代价很小”的其他一些操作在`Python`中的计算复杂度却相对较高：\n\n- 利用`list.insert`方法在任意位置插入一个元素——复杂度为`O(n)`。\n- 利用`list.delete`或`del`删除一个元素——复杂度为`O(n)`。\n\n![](Screenshot_1.webp)\n\n#### 列表推导\n\n```python\n>>> evens = []\n>>> for i in range(10):\n...     if i%2 == 0:\n...             evens.append(i)\n...\n>>> evens\n[0, 2, 4, 6, 8]\n```\n\n这种写法可能适用于`C`语言，但在`Python`中的实际运行速度很慢，原因如下。\n\n- 解释器在每次循环中都需要判断序列中的哪一部分需要修改。\n- 需要用一个计数器来跟踪需要处理的元素。\n- 由于`append()`是一个列表方法，所以每次遍历时还需要额外执行一个查询函数。\n\n列表推导正是解决这个问题的正确方法。它使用编排好的功能对上述语法的一部分做了自动化处理：\n\n```python\n>>> [i for i in range(10) if i % 2 == 0]\n[0, 2, 4, 6, 8]\n```\n\n这种写法除了更加高效之外，也更加简短，涉及的语法元素也更少。在大型程序中，这意味着更少的错误，代码也更容易阅读和理解。\n\n#### 其他习语\n\n`Python`习语的另一个典型例子是使用`enumerate`（枚举）。在循环中使用序列时，这个内置函数可以很方便地获取其索引。以下面这段代码为例：\n\n```python\n>>> for element in ['one','two','three']:\n...     print(i, element)\n...     i += 1\n...\n0 one\n1 two\n2 three\n```\n\n它可以替换为下面这段更短的代码：\n\n```python\n>>> for i, element in enumerate(['one','two','three']):\n...     print(i, element)\n...\n0 one\n1 two\n2 three\n```\n\n#### 序列解包（sequence unpacking）\n\n这种方法并不限于列表和元组，而是适用于任意序列类型（甚至包括字符串和字节序列）。只要赋值运算符左边的变量数目与序列中的元素数目相等，你都可以用这种方法将元素序列解包到另一组变量中：\n\n```python\n>>> first, second, third = \"holy\", \"chan\", 100\n>>> first\n'holy'\n>>> second\n'chan'\n>>> third\n100\n```\n\n解包还可以利用带星号的表达式获取单个变量中的多个元素，只要它的解释没有歧义即可。还可以对嵌套序列进行解包。特别是在遍历由序列构成的复杂数据结构时，这种方法非常实用。下面是一些更复杂的解包示例\n\n```python\n>>> # 带星号的表达式可以获取序列的剩余部分\n>>> first, second, *rest = 0, 1, 2, 3\n>>> first\n0\n>>> second\n1\n>>> rest\n[2, 3]\n\n>>> # 带星号的表达式可以获取序列的中间部分\n>>> first, *inner, last = 0, 1, 2, 3\n>>> first\n0\n>>> inner\n[1, 2]\n>>> last\n3\n\n>>> # 嵌套解包\n>>> (a,b), (c,d) = (1,2), (3,4)\n>>> a, b, c, d\n(1, 2, 3, 4)\n```\n\n### 字典\n\n字典是`Python`中最通用的数据结构之一。`dict`可以将一组唯一键映射到对应的值，如下所示：\n\n```python\n{\n  1: 'one',\n  2: 'two',\n  3: 'three',\n}\n```\n\n可以用和前面列表推导类似的推导来创建一个新的字典。这里有一个非常简单的例子如下所示：\n\n```python\n>>> squares = {number: number ** 2 for number in range(10)}\n>>> squares\n{0: 0, 1: 1, 2: 4, 3: 9, 4: 16, 5: 25, 6: 36, 7: 49, 8: 64, 9: 81}\n```\n\n在许多情况下，字典推导要更加高效、更加简短、更加整洁。对于更复杂的代码而言，需要用到许多`if`语句或函数调用来创建一个字典，这时最好使用简单的`for`循环，尤其是它还提高了可读性。\n\n对于`python3`，字典的`keys()`、`values()`和`items()`3个方法的返回值类型不再是列表。此外，与之对应的`iterkeys()`、`itervalues()`和`iteritems()`本来返回的是迭代器，而`Python3`中并没有这3个方法。现在`keys()`、`values()`和`items()`返回的是视图对象（`viewobjects`）。\n\n- keys()：返回dict_keys对象，可以查看字典的所有键。\n- values()：返回dict_values对象，可以查看字典的所有值。\n- items()：返回dict_items对象，可以查看字典所有的(key, value)二元元组。\n\n视图对象可以动态查看字典的内容，因此每次字典发生变化时，视图都会相应改变，见下面这个例子：\n\n```python\n>>> words = {'foo1':'bar', 'fizz':'bazz'}\n>>> items = words.items()\n>>> words['spam'] = 'eggs'\n>>> items\ndict_items([('foo1', 'bar'), ('fizz', 'bazz'), ('spam', 'eggs')])\n```\n\n视图对象既有旧的`keys()`、`values()`和`items()`方法返回的列表的特性，也有旧的`iterkeys()`、`itervalues()`和`iteritems()`方法返回的迭代器的特性。视图无需冗余地将所有值都保存在内存里（像列表那样），但你仍然可以获取其长度（使用`len`），也可以测试元素是否包含其中（使用`in`子句）。当然，视图是可迭代的。最后一件重要的事情是，在`keys()`和`values()`方法返回的视图中，键和值的顺序是完全对应的。\n\n### 集合\n\n集合是一种鲁棒性很好的数据结构，当元素顺序的重要性不如元素的唯一性和测试元素是否包含在集合中的效率时，大部分情况下这种数据结构是很有用的。它与数学上的集合概念非常类似。`Python`的内置集合类型有两种。\n\n- set()：一种可变的、无序的、有限的集合，其元素是唯一的、不可变的（可哈希的）对象。\n- frozenset()：一种不可变的、可哈希的、无序的集合，其元素是唯一的、不可变的（可哈希的）对象。\n\n由于`frozenset()`具有不变性，它可以用作字典的键，也可以作为其他`set()`和`frozenset()`的元素。在一个`set()`或`frozenset()`中不能包含另一个普通的可变`set()`，因为这会引发`TypeError`：\n\n```python\n>>> set([set([1,2,3]),set([2,3,4])])\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nTypeError: unhashable type: 'set'\n```\n\n下面这种集合初始化的方法是完全正确的：\n\n```python\n>>> set([frozenset([1,2,3]),frozenset([2,3,4])])\n{frozenset({1, 2, 3}), frozenset({2, 3, 4})}\n```\n\n创建可变集合方法有以下3种，如下所示。\n\n- 调用set()，选择性地接受可迭代对象作为初始化参数，例如set([0, 1, 2])。\n- 使用集合推导，例如{element for element in range(3)}。\n- 使用集合字面值，例如{1, 2, 3}。\n\n使用集合的字面值和推导要格外小心，因为它们在形式上与字典的字面值和推导非常相似。此外，空的集合对象是没有字面值的。空的花括号{}表示的是空的字典字面值。\n","slug":"python的内置类型","published":1,"updated":"2021-06-15T03:24:11.493Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2l002c44udesx65y7q","content":"<h2 id=\"字符串与字节\"><a href=\"#字符串与字节\" class=\"headerlink\" title=\"字符串与字节\"></a>字符串与字节</h2><p><code>Python3</code>中只有一种能够保存文本信息的数据类型，就是<code>str</code>(<code>string</code>，字符串)。它是不可变的序列，保存的<code>Unicode</code>码位(<code>code point</code>)。</p>\n<p>字符串可以保存的数据类型有非常明确的限制，就是<code>Unicode</code>文本。</p>\n<p><code>bytes</code>以及可变的<code>bytearray</code>与<code>str</code>不同，只能用字节作为序列值，即<code>0&lt;=x&lt;256</code>范围内的整数。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">bytes</span>([<span class=\"number\">102</span>,<span class=\"number\">111</span>,<span class=\"number\">111</span>])</span><br><span class=\"line\"><span class=\"string\">b&#x27;foo&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>对于<code>bytes</code>和<code>bytearray</code>，在转换为另一种序列类型（例如<code>list</code>或<code>tuple</code>）时可以显示出其本来面目：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">list</span>(<span class=\"string\">b&#x27;foo bar&#x27;</span>)</span><br><span class=\"line\">[<span class=\"number\">102</span>, <span class=\"number\">111</span>, <span class=\"number\">111</span>, <span class=\"number\">32</span>, <span class=\"number\">98</span>, <span class=\"number\">97</span>, <span class=\"number\">114</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">tuple</span>(<span class=\"string\">b&#x27;foo bar&#x27;</span>)</span><br><span class=\"line\">(<span class=\"number\">102</span>, <span class=\"number\">111</span>, <span class=\"number\">111</span>, <span class=\"number\">32</span>, <span class=\"number\">98</span>, <span class=\"number\">97</span>, <span class=\"number\">114</span>)</span><br></pre></td></tr></table></figure>\n\n<p>从<code>Python3.0</code>开始，所有没有前缀的字符串都是<code>Unicode</code>。因此，所有用单引号（’）、双引号（”）或成组的3个引号（单引号或双引号）包围且没有前缀的值都表示<code>str</code>数据类型：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">type</span>(<span class=\"string\">&quot;some string&quot;</span>)</span><br><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">str</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>字节也被单引号、双引号或三引号包围，但必须有一个<code>b</code>或<code>B</code>前缀：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">type</span>(<span class=\"string\">b&quot;some bytes&quot;</span>)</span><br><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">bytes</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>Python</code>字符串是不可变的。字节序列也是如此。<code>bytearray</code>是<code>bytes</code>的可变版本，不存在这样的问题。字节数组可以通过元素赋值来进行原处修改（无需创建新对象），其大小也可以像列表一样动态地变化（利用<code>append</code>、<code>pop</code>、<code>inseer</code>等方法）。</p>\n<h3 id=\"字符串拼接\"><a href=\"#字符串拼接\" class=\"headerlink\" title=\"字符串拼接\"></a>字符串拼接</h3><p>用<code>str.join()</code>方法。它接受可迭代的字符串作为参数，返回合并后的字符串。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"string\">&#x27;,&#x27;</span>.join([<span class=\"string\">&#x27;some&#x27;</span>,<span class=\"string\">&#x27;one&#x27;</span>,<span class=\"string\">&#x27;like&#x27;</span>,<span class=\"string\">&#x27;you&#x27;</span>,<span class=\"string\">&#x27;forever&#x27;</span>])</span><br><span class=\"line\"><span class=\"string\">&#x27;some,one,like,you,forever&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>因为<code>join()</code>方法速度更快（对于大型列表来说更是如此），并不意味着在所有需要拼接两个字符串的情况下都应该使用这一方法。虽然这是一种广为认可的做法，但并不会提高代码的可读性。可读性是很重要的！在某些情况下，<code>join()</code>的性能可能还不如利用加法的普通拼接。</p>\n<h2 id=\"集合类型\"><a href=\"#集合类型\" class=\"headerlink\" title=\"集合类型\"></a>集合类型</h2><h3 id=\"列表和元组\"><a href=\"#列表和元组\" class=\"headerlink\" title=\"列表和元组\"></a>列表和元组</h3><p>列表是动态的，其大小可以改变；而元组是不可变的，一旦创建就不能修改。</p>\n<p><code>tuple是</code>不可变的（immutable），因此也是可哈希的（hashable）</p>\n<p>从细节上来看，<code>Python</code>中的列表是由对其他对象的引用组成的的连续数组。指向这个数组的指针及其长度被保存在一个列表头结构中。这意味着，每次添加或删除一个元素时，由引用组成的数组需要改变大小（重新分配）。幸运的是，<code>Python</code>在创建这些数组时采用了指数过分配（exponential over-allocation），所以并不是每次操作都需要改变数组大小。这也是添加或取出元素的平摊复杂度较低的原因。不幸的是，在普通链表中“代价很小”的其他一些操作在<code>Python</code>中的计算复杂度却相对较高：</p>\n<ul>\n<li>利用<code>list.insert</code>方法在任意位置插入一个元素——复杂度为<code>O(n)</code>。</li>\n<li>利用<code>list.delete</code>或<code>del</code>删除一个元素——复杂度为<code>O(n)</code>。</li>\n</ul>\n<p><img src=\"Screenshot_1.webp\"></p>\n<h4 id=\"列表推导\"><a href=\"#列表推导\" class=\"headerlink\" title=\"列表推导\"></a>列表推导</h4><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>evens = []</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>):</span><br><span class=\"line\"><span class=\"meta\">... </span>    <span class=\"keyword\">if</span> i%<span class=\"number\">2</span> == <span class=\"number\">0</span>:</span><br><span class=\"line\"><span class=\"meta\">... </span>            evens.append(i)</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>evens</span><br><span class=\"line\">[<span class=\"number\">0</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">6</span>, <span class=\"number\">8</span>]</span><br></pre></td></tr></table></figure>\n\n<p>这种写法可能适用于<code>C</code>语言，但在<code>Python</code>中的实际运行速度很慢，原因如下。</p>\n<ul>\n<li>解释器在每次循环中都需要判断序列中的哪一部分需要修改。</li>\n<li>需要用一个计数器来跟踪需要处理的元素。</li>\n<li>由于<code>append()</code>是一个列表方法，所以每次遍历时还需要额外执行一个查询函数。</li>\n</ul>\n<p>列表推导正是解决这个问题的正确方法。它使用编排好的功能对上述语法的一部分做了自动化处理：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>[i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>) <span class=\"keyword\">if</span> i % <span class=\"number\">2</span> == <span class=\"number\">0</span>]</span><br><span class=\"line\">[<span class=\"number\">0</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">6</span>, <span class=\"number\">8</span>]</span><br></pre></td></tr></table></figure>\n\n<p>这种写法除了更加高效之外，也更加简短，涉及的语法元素也更少。在大型程序中，这意味着更少的错误，代码也更容易阅读和理解。</p>\n<h4 id=\"其他习语\"><a href=\"#其他习语\" class=\"headerlink\" title=\"其他习语\"></a>其他习语</h4><p><code>Python</code>习语的另一个典型例子是使用<code>enumerate</code>（枚举）。在循环中使用序列时，这个内置函数可以很方便地获取其索引。以下面这段代码为例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">for</span> element <span class=\"keyword\">in</span> [<span class=\"string\">&#x27;one&#x27;</span>,<span class=\"string\">&#x27;two&#x27;</span>,<span class=\"string\">&#x27;three&#x27;</span>]:</span><br><span class=\"line\"><span class=\"meta\">... </span>    <span class=\"built_in\">print</span>(i, element)</span><br><span class=\"line\"><span class=\"meta\">... </span>    i += <span class=\"number\">1</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"number\">0</span> one</span><br><span class=\"line\"><span class=\"number\">1</span> two</span><br><span class=\"line\"><span class=\"number\">2</span> three</span><br></pre></td></tr></table></figure>\n\n<p>它可以替换为下面这段更短的代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">for</span> i, element <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>([<span class=\"string\">&#x27;one&#x27;</span>,<span class=\"string\">&#x27;two&#x27;</span>,<span class=\"string\">&#x27;three&#x27;</span>]):</span><br><span class=\"line\"><span class=\"meta\">... </span>    <span class=\"built_in\">print</span>(i, element)</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"number\">0</span> one</span><br><span class=\"line\"><span class=\"number\">1</span> two</span><br><span class=\"line\"><span class=\"number\">2</span> three</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"序列解包（sequence-unpacking）\"><a href=\"#序列解包（sequence-unpacking）\" class=\"headerlink\" title=\"序列解包（sequence unpacking）\"></a>序列解包（sequence unpacking）</h4><p>这种方法并不限于列表和元组，而是适用于任意序列类型（甚至包括字符串和字节序列）。只要赋值运算符左边的变量数目与序列中的元素数目相等，你都可以用这种方法将元素序列解包到另一组变量中：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>first, second, third = <span class=\"string\">&quot;holy&quot;</span>, <span class=\"string\">&quot;chan&quot;</span>, <span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>first</span><br><span class=\"line\"><span class=\"string\">&#x27;holy&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>second</span><br><span class=\"line\"><span class=\"string\">&#x27;chan&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>third</span><br><span class=\"line\"><span class=\"number\">100</span></span><br></pre></td></tr></table></figure>\n\n<p>解包还可以利用带星号的表达式获取单个变量中的多个元素，只要它的解释没有歧义即可。还可以对嵌套序列进行解包。特别是在遍历由序列构成的复杂数据结构时，这种方法非常实用。下面是一些更复杂的解包示例</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"comment\"># 带星号的表达式可以获取序列的剩余部分</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>first, second, *rest = <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>first</span><br><span class=\"line\"><span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>second</span><br><span class=\"line\"><span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>rest</span><br><span class=\"line\">[<span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"comment\"># 带星号的表达式可以获取序列的中间部分</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>first, *inner, last = <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>first</span><br><span class=\"line\"><span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>inner</span><br><span class=\"line\">[<span class=\"number\">1</span>, <span class=\"number\">2</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>last</span><br><span class=\"line\"><span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"comment\"># 嵌套解包</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>(a,b), (c,d) = (<span class=\"number\">1</span>,<span class=\"number\">2</span>), (<span class=\"number\">3</span>,<span class=\"number\">4</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>a, b, c, d</span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"字典\"><a href=\"#字典\" class=\"headerlink\" title=\"字典\"></a>字典</h3><p>字典是<code>Python</code>中最通用的数据结构之一。<code>dict</code>可以将一组唯一键映射到对应的值，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"number\">1</span>: <span class=\"string\">&#x27;one&#x27;</span>,</span><br><span class=\"line\">  <span class=\"number\">2</span>: <span class=\"string\">&#x27;two&#x27;</span>,</span><br><span class=\"line\">  <span class=\"number\">3</span>: <span class=\"string\">&#x27;three&#x27;</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以用和前面列表推导类似的推导来创建一个新的字典。这里有一个非常简单的例子如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>squares = &#123;number: number ** <span class=\"number\">2</span> <span class=\"keyword\">for</span> number <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>)&#125;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>squares</span><br><span class=\"line\">&#123;<span class=\"number\">0</span>: <span class=\"number\">0</span>, <span class=\"number\">1</span>: <span class=\"number\">1</span>, <span class=\"number\">2</span>: <span class=\"number\">4</span>, <span class=\"number\">3</span>: <span class=\"number\">9</span>, <span class=\"number\">4</span>: <span class=\"number\">16</span>, <span class=\"number\">5</span>: <span class=\"number\">25</span>, <span class=\"number\">6</span>: <span class=\"number\">36</span>, <span class=\"number\">7</span>: <span class=\"number\">49</span>, <span class=\"number\">8</span>: <span class=\"number\">64</span>, <span class=\"number\">9</span>: <span class=\"number\">81</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在许多情况下，字典推导要更加高效、更加简短、更加整洁。对于更复杂的代码而言，需要用到许多<code>if</code>语句或函数调用来创建一个字典，这时最好使用简单的<code>for</code>循环，尤其是它还提高了可读性。</p>\n<p>对于<code>python3</code>，字典的<code>keys()</code>、<code>values()</code>和<code>items()</code>3个方法的返回值类型不再是列表。此外，与之对应的<code>iterkeys()</code>、<code>itervalues()</code>和<code>iteritems()</code>本来返回的是迭代器，而<code>Python3</code>中并没有这3个方法。现在<code>keys()</code>、<code>values()</code>和<code>items()</code>返回的是视图对象（<code>viewobjects</code>）。</p>\n<ul>\n<li>keys()：返回dict_keys对象，可以查看字典的所有键。</li>\n<li>values()：返回dict_values对象，可以查看字典的所有值。</li>\n<li>items()：返回dict_items对象，可以查看字典所有的(key, value)二元元组。</li>\n</ul>\n<p>视图对象可以动态查看字典的内容，因此每次字典发生变化时，视图都会相应改变，见下面这个例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>words = &#123;<span class=\"string\">&#x27;foo1&#x27;</span>:<span class=\"string\">&#x27;bar&#x27;</span>, <span class=\"string\">&#x27;fizz&#x27;</span>:<span class=\"string\">&#x27;bazz&#x27;</span>&#125;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>items = words.items()</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>words[<span class=\"string\">&#x27;spam&#x27;</span>] = <span class=\"string\">&#x27;eggs&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>items</span><br><span class=\"line\">dict_items([(<span class=\"string\">&#x27;foo1&#x27;</span>, <span class=\"string\">&#x27;bar&#x27;</span>), (<span class=\"string\">&#x27;fizz&#x27;</span>, <span class=\"string\">&#x27;bazz&#x27;</span>), (<span class=\"string\">&#x27;spam&#x27;</span>, <span class=\"string\">&#x27;eggs&#x27;</span>)])</span><br></pre></td></tr></table></figure>\n\n<p>视图对象既有旧的<code>keys()</code>、<code>values()</code>和<code>items()</code>方法返回的列表的特性，也有旧的<code>iterkeys()</code>、<code>itervalues()</code>和<code>iteritems()</code>方法返回的迭代器的特性。视图无需冗余地将所有值都保存在内存里（像列表那样），但你仍然可以获取其长度（使用<code>len</code>），也可以测试元素是否包含其中（使用<code>in</code>子句）。当然，视图是可迭代的。最后一件重要的事情是，在<code>keys()</code>和<code>values()</code>方法返回的视图中，键和值的顺序是完全对应的。</p>\n<h3 id=\"集合\"><a href=\"#集合\" class=\"headerlink\" title=\"集合\"></a>集合</h3><p>集合是一种鲁棒性很好的数据结构，当元素顺序的重要性不如元素的唯一性和测试元素是否包含在集合中的效率时，大部分情况下这种数据结构是很有用的。它与数学上的集合概念非常类似。<code>Python</code>的内置集合类型有两种。</p>\n<ul>\n<li>set()：一种可变的、无序的、有限的集合，其元素是唯一的、不可变的（可哈希的）对象。</li>\n<li>frozenset()：一种不可变的、可哈希的、无序的集合，其元素是唯一的、不可变的（可哈希的）对象。</li>\n</ul>\n<p>由于<code>frozenset()</code>具有不变性，它可以用作字典的键，也可以作为其他<code>set()</code>和<code>frozenset()</code>的元素。在一个<code>set()</code>或<code>frozenset()</code>中不能包含另一个普通的可变<code>set()</code>，因为这会引发<code>TypeError</code>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">set</span>([<span class=\"built_in\">set</span>([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]),<span class=\"built_in\">set</span>([<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>])])</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File <span class=\"string\">&quot;&lt;stdin&gt;&quot;</span>, line <span class=\"number\">1</span>, <span class=\"keyword\">in</span> &lt;module&gt;</span><br><span class=\"line\">TypeError: unhashable <span class=\"built_in\">type</span>: <span class=\"string\">&#x27;set&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>下面这种集合初始化的方法是完全正确的：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">set</span>([<span class=\"built_in\">frozenset</span>([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]),<span class=\"built_in\">frozenset</span>([<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>])])</span><br><span class=\"line\">&#123;<span class=\"built_in\">frozenset</span>(&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125;), <span class=\"built_in\">frozenset</span>(&#123;<span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>&#125;)&#125;</span><br></pre></td></tr></table></figure>\n\n<p>创建可变集合方法有以下3种，如下所示。</p>\n<ul>\n<li>调用set()，选择性地接受可迭代对象作为初始化参数，例如set([0, 1, 2])。</li>\n<li>使用集合推导，例如{element for element in range(3)}。</li>\n<li>使用集合字面值，例如{1, 2, 3}。</li>\n</ul>\n<p>使用集合的字面值和推导要格外小心，因为它们在形式上与字典的字面值和推导非常相似。此外，空的集合对象是没有字面值的。空的花括号{}表示的是空的字典字面值。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"字符串与字节\"><a href=\"#字符串与字节\" class=\"headerlink\" title=\"字符串与字节\"></a>字符串与字节</h2><p><code>Python3</code>中只有一种能够保存文本信息的数据类型，就是<code>str</code>(<code>string</code>，字符串)。它是不可变的序列，保存的<code>Unicode</code>码位(<code>code point</code>)。</p>\n<p>字符串可以保存的数据类型有非常明确的限制，就是<code>Unicode</code>文本。</p>\n<p><code>bytes</code>以及可变的<code>bytearray</code>与<code>str</code>不同，只能用字节作为序列值，即<code>0&lt;=x&lt;256</code>范围内的整数。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">bytes</span>([<span class=\"number\">102</span>,<span class=\"number\">111</span>,<span class=\"number\">111</span>])</span><br><span class=\"line\"><span class=\"string\">b&#x27;foo&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>对于<code>bytes</code>和<code>bytearray</code>，在转换为另一种序列类型（例如<code>list</code>或<code>tuple</code>）时可以显示出其本来面目：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">list</span>(<span class=\"string\">b&#x27;foo bar&#x27;</span>)</span><br><span class=\"line\">[<span class=\"number\">102</span>, <span class=\"number\">111</span>, <span class=\"number\">111</span>, <span class=\"number\">32</span>, <span class=\"number\">98</span>, <span class=\"number\">97</span>, <span class=\"number\">114</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">tuple</span>(<span class=\"string\">b&#x27;foo bar&#x27;</span>)</span><br><span class=\"line\">(<span class=\"number\">102</span>, <span class=\"number\">111</span>, <span class=\"number\">111</span>, <span class=\"number\">32</span>, <span class=\"number\">98</span>, <span class=\"number\">97</span>, <span class=\"number\">114</span>)</span><br></pre></td></tr></table></figure>\n\n<p>从<code>Python3.0</code>开始，所有没有前缀的字符串都是<code>Unicode</code>。因此，所有用单引号（’）、双引号（”）或成组的3个引号（单引号或双引号）包围且没有前缀的值都表示<code>str</code>数据类型：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">type</span>(<span class=\"string\">&quot;some string&quot;</span>)</span><br><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">str</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>字节也被单引号、双引号或三引号包围，但必须有一个<code>b</code>或<code>B</code>前缀：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">type</span>(<span class=\"string\">b&quot;some bytes&quot;</span>)</span><br><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">bytes</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>Python</code>字符串是不可变的。字节序列也是如此。<code>bytearray</code>是<code>bytes</code>的可变版本，不存在这样的问题。字节数组可以通过元素赋值来进行原处修改（无需创建新对象），其大小也可以像列表一样动态地变化（利用<code>append</code>、<code>pop</code>、<code>inseer</code>等方法）。</p>\n<h3 id=\"字符串拼接\"><a href=\"#字符串拼接\" class=\"headerlink\" title=\"字符串拼接\"></a>字符串拼接</h3><p>用<code>str.join()</code>方法。它接受可迭代的字符串作为参数，返回合并后的字符串。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"string\">&#x27;,&#x27;</span>.join([<span class=\"string\">&#x27;some&#x27;</span>,<span class=\"string\">&#x27;one&#x27;</span>,<span class=\"string\">&#x27;like&#x27;</span>,<span class=\"string\">&#x27;you&#x27;</span>,<span class=\"string\">&#x27;forever&#x27;</span>])</span><br><span class=\"line\"><span class=\"string\">&#x27;some,one,like,you,forever&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>因为<code>join()</code>方法速度更快（对于大型列表来说更是如此），并不意味着在所有需要拼接两个字符串的情况下都应该使用这一方法。虽然这是一种广为认可的做法，但并不会提高代码的可读性。可读性是很重要的！在某些情况下，<code>join()</code>的性能可能还不如利用加法的普通拼接。</p>\n<h2 id=\"集合类型\"><a href=\"#集合类型\" class=\"headerlink\" title=\"集合类型\"></a>集合类型</h2><h3 id=\"列表和元组\"><a href=\"#列表和元组\" class=\"headerlink\" title=\"列表和元组\"></a>列表和元组</h3><p>列表是动态的，其大小可以改变；而元组是不可变的，一旦创建就不能修改。</p>\n<p><code>tuple是</code>不可变的（immutable），因此也是可哈希的（hashable）</p>\n<p>从细节上来看，<code>Python</code>中的列表是由对其他对象的引用组成的的连续数组。指向这个数组的指针及其长度被保存在一个列表头结构中。这意味着，每次添加或删除一个元素时，由引用组成的数组需要改变大小（重新分配）。幸运的是，<code>Python</code>在创建这些数组时采用了指数过分配（exponential over-allocation），所以并不是每次操作都需要改变数组大小。这也是添加或取出元素的平摊复杂度较低的原因。不幸的是，在普通链表中“代价很小”的其他一些操作在<code>Python</code>中的计算复杂度却相对较高：</p>\n<ul>\n<li>利用<code>list.insert</code>方法在任意位置插入一个元素——复杂度为<code>O(n)</code>。</li>\n<li>利用<code>list.delete</code>或<code>del</code>删除一个元素——复杂度为<code>O(n)</code>。</li>\n</ul>\n<p><img src=\"Screenshot_1.webp\"></p>\n<h4 id=\"列表推导\"><a href=\"#列表推导\" class=\"headerlink\" title=\"列表推导\"></a>列表推导</h4><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>evens = []</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>):</span><br><span class=\"line\"><span class=\"meta\">... </span>    <span class=\"keyword\">if</span> i%<span class=\"number\">2</span> == <span class=\"number\">0</span>:</span><br><span class=\"line\"><span class=\"meta\">... </span>            evens.append(i)</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>evens</span><br><span class=\"line\">[<span class=\"number\">0</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">6</span>, <span class=\"number\">8</span>]</span><br></pre></td></tr></table></figure>\n\n<p>这种写法可能适用于<code>C</code>语言，但在<code>Python</code>中的实际运行速度很慢，原因如下。</p>\n<ul>\n<li>解释器在每次循环中都需要判断序列中的哪一部分需要修改。</li>\n<li>需要用一个计数器来跟踪需要处理的元素。</li>\n<li>由于<code>append()</code>是一个列表方法，所以每次遍历时还需要额外执行一个查询函数。</li>\n</ul>\n<p>列表推导正是解决这个问题的正确方法。它使用编排好的功能对上述语法的一部分做了自动化处理：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>[i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>) <span class=\"keyword\">if</span> i % <span class=\"number\">2</span> == <span class=\"number\">0</span>]</span><br><span class=\"line\">[<span class=\"number\">0</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">6</span>, <span class=\"number\">8</span>]</span><br></pre></td></tr></table></figure>\n\n<p>这种写法除了更加高效之外，也更加简短，涉及的语法元素也更少。在大型程序中，这意味着更少的错误，代码也更容易阅读和理解。</p>\n<h4 id=\"其他习语\"><a href=\"#其他习语\" class=\"headerlink\" title=\"其他习语\"></a>其他习语</h4><p><code>Python</code>习语的另一个典型例子是使用<code>enumerate</code>（枚举）。在循环中使用序列时，这个内置函数可以很方便地获取其索引。以下面这段代码为例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">for</span> element <span class=\"keyword\">in</span> [<span class=\"string\">&#x27;one&#x27;</span>,<span class=\"string\">&#x27;two&#x27;</span>,<span class=\"string\">&#x27;three&#x27;</span>]:</span><br><span class=\"line\"><span class=\"meta\">... </span>    <span class=\"built_in\">print</span>(i, element)</span><br><span class=\"line\"><span class=\"meta\">... </span>    i += <span class=\"number\">1</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"number\">0</span> one</span><br><span class=\"line\"><span class=\"number\">1</span> two</span><br><span class=\"line\"><span class=\"number\">2</span> three</span><br></pre></td></tr></table></figure>\n\n<p>它可以替换为下面这段更短的代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">for</span> i, element <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>([<span class=\"string\">&#x27;one&#x27;</span>,<span class=\"string\">&#x27;two&#x27;</span>,<span class=\"string\">&#x27;three&#x27;</span>]):</span><br><span class=\"line\"><span class=\"meta\">... </span>    <span class=\"built_in\">print</span>(i, element)</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"number\">0</span> one</span><br><span class=\"line\"><span class=\"number\">1</span> two</span><br><span class=\"line\"><span class=\"number\">2</span> three</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"序列解包（sequence-unpacking）\"><a href=\"#序列解包（sequence-unpacking）\" class=\"headerlink\" title=\"序列解包（sequence unpacking）\"></a>序列解包（sequence unpacking）</h4><p>这种方法并不限于列表和元组，而是适用于任意序列类型（甚至包括字符串和字节序列）。只要赋值运算符左边的变量数目与序列中的元素数目相等，你都可以用这种方法将元素序列解包到另一组变量中：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>first, second, third = <span class=\"string\">&quot;holy&quot;</span>, <span class=\"string\">&quot;chan&quot;</span>, <span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>first</span><br><span class=\"line\"><span class=\"string\">&#x27;holy&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>second</span><br><span class=\"line\"><span class=\"string\">&#x27;chan&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>third</span><br><span class=\"line\"><span class=\"number\">100</span></span><br></pre></td></tr></table></figure>\n\n<p>解包还可以利用带星号的表达式获取单个变量中的多个元素，只要它的解释没有歧义即可。还可以对嵌套序列进行解包。特别是在遍历由序列构成的复杂数据结构时，这种方法非常实用。下面是一些更复杂的解包示例</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"comment\"># 带星号的表达式可以获取序列的剩余部分</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>first, second, *rest = <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>first</span><br><span class=\"line\"><span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>second</span><br><span class=\"line\"><span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>rest</span><br><span class=\"line\">[<span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"comment\"># 带星号的表达式可以获取序列的中间部分</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>first, *inner, last = <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>first</span><br><span class=\"line\"><span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>inner</span><br><span class=\"line\">[<span class=\"number\">1</span>, <span class=\"number\">2</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>last</span><br><span class=\"line\"><span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"comment\"># 嵌套解包</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>(a,b), (c,d) = (<span class=\"number\">1</span>,<span class=\"number\">2</span>), (<span class=\"number\">3</span>,<span class=\"number\">4</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>a, b, c, d</span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"字典\"><a href=\"#字典\" class=\"headerlink\" title=\"字典\"></a>字典</h3><p>字典是<code>Python</code>中最通用的数据结构之一。<code>dict</code>可以将一组唯一键映射到对应的值，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"number\">1</span>: <span class=\"string\">&#x27;one&#x27;</span>,</span><br><span class=\"line\">  <span class=\"number\">2</span>: <span class=\"string\">&#x27;two&#x27;</span>,</span><br><span class=\"line\">  <span class=\"number\">3</span>: <span class=\"string\">&#x27;three&#x27;</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以用和前面列表推导类似的推导来创建一个新的字典。这里有一个非常简单的例子如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>squares = &#123;number: number ** <span class=\"number\">2</span> <span class=\"keyword\">for</span> number <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>)&#125;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>squares</span><br><span class=\"line\">&#123;<span class=\"number\">0</span>: <span class=\"number\">0</span>, <span class=\"number\">1</span>: <span class=\"number\">1</span>, <span class=\"number\">2</span>: <span class=\"number\">4</span>, <span class=\"number\">3</span>: <span class=\"number\">9</span>, <span class=\"number\">4</span>: <span class=\"number\">16</span>, <span class=\"number\">5</span>: <span class=\"number\">25</span>, <span class=\"number\">6</span>: <span class=\"number\">36</span>, <span class=\"number\">7</span>: <span class=\"number\">49</span>, <span class=\"number\">8</span>: <span class=\"number\">64</span>, <span class=\"number\">9</span>: <span class=\"number\">81</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在许多情况下，字典推导要更加高效、更加简短、更加整洁。对于更复杂的代码而言，需要用到许多<code>if</code>语句或函数调用来创建一个字典，这时最好使用简单的<code>for</code>循环，尤其是它还提高了可读性。</p>\n<p>对于<code>python3</code>，字典的<code>keys()</code>、<code>values()</code>和<code>items()</code>3个方法的返回值类型不再是列表。此外，与之对应的<code>iterkeys()</code>、<code>itervalues()</code>和<code>iteritems()</code>本来返回的是迭代器，而<code>Python3</code>中并没有这3个方法。现在<code>keys()</code>、<code>values()</code>和<code>items()</code>返回的是视图对象（<code>viewobjects</code>）。</p>\n<ul>\n<li>keys()：返回dict_keys对象，可以查看字典的所有键。</li>\n<li>values()：返回dict_values对象，可以查看字典的所有值。</li>\n<li>items()：返回dict_items对象，可以查看字典所有的(key, value)二元元组。</li>\n</ul>\n<p>视图对象可以动态查看字典的内容，因此每次字典发生变化时，视图都会相应改变，见下面这个例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>words = &#123;<span class=\"string\">&#x27;foo1&#x27;</span>:<span class=\"string\">&#x27;bar&#x27;</span>, <span class=\"string\">&#x27;fizz&#x27;</span>:<span class=\"string\">&#x27;bazz&#x27;</span>&#125;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>items = words.items()</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>words[<span class=\"string\">&#x27;spam&#x27;</span>] = <span class=\"string\">&#x27;eggs&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>items</span><br><span class=\"line\">dict_items([(<span class=\"string\">&#x27;foo1&#x27;</span>, <span class=\"string\">&#x27;bar&#x27;</span>), (<span class=\"string\">&#x27;fizz&#x27;</span>, <span class=\"string\">&#x27;bazz&#x27;</span>), (<span class=\"string\">&#x27;spam&#x27;</span>, <span class=\"string\">&#x27;eggs&#x27;</span>)])</span><br></pre></td></tr></table></figure>\n\n<p>视图对象既有旧的<code>keys()</code>、<code>values()</code>和<code>items()</code>方法返回的列表的特性，也有旧的<code>iterkeys()</code>、<code>itervalues()</code>和<code>iteritems()</code>方法返回的迭代器的特性。视图无需冗余地将所有值都保存在内存里（像列表那样），但你仍然可以获取其长度（使用<code>len</code>），也可以测试元素是否包含其中（使用<code>in</code>子句）。当然，视图是可迭代的。最后一件重要的事情是，在<code>keys()</code>和<code>values()</code>方法返回的视图中，键和值的顺序是完全对应的。</p>\n<h3 id=\"集合\"><a href=\"#集合\" class=\"headerlink\" title=\"集合\"></a>集合</h3><p>集合是一种鲁棒性很好的数据结构，当元素顺序的重要性不如元素的唯一性和测试元素是否包含在集合中的效率时，大部分情况下这种数据结构是很有用的。它与数学上的集合概念非常类似。<code>Python</code>的内置集合类型有两种。</p>\n<ul>\n<li>set()：一种可变的、无序的、有限的集合，其元素是唯一的、不可变的（可哈希的）对象。</li>\n<li>frozenset()：一种不可变的、可哈希的、无序的集合，其元素是唯一的、不可变的（可哈希的）对象。</li>\n</ul>\n<p>由于<code>frozenset()</code>具有不变性，它可以用作字典的键，也可以作为其他<code>set()</code>和<code>frozenset()</code>的元素。在一个<code>set()</code>或<code>frozenset()</code>中不能包含另一个普通的可变<code>set()</code>，因为这会引发<code>TypeError</code>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">set</span>([<span class=\"built_in\">set</span>([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]),<span class=\"built_in\">set</span>([<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>])])</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File <span class=\"string\">&quot;&lt;stdin&gt;&quot;</span>, line <span class=\"number\">1</span>, <span class=\"keyword\">in</span> &lt;module&gt;</span><br><span class=\"line\">TypeError: unhashable <span class=\"built_in\">type</span>: <span class=\"string\">&#x27;set&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>下面这种集合初始化的方法是完全正确的：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">set</span>([<span class=\"built_in\">frozenset</span>([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]),<span class=\"built_in\">frozenset</span>([<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>])])</span><br><span class=\"line\">&#123;<span class=\"built_in\">frozenset</span>(&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125;), <span class=\"built_in\">frozenset</span>(&#123;<span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>&#125;)&#125;</span><br></pre></td></tr></table></figure>\n\n<p>创建可变集合方法有以下3种，如下所示。</p>\n<ul>\n<li>调用set()，选择性地接受可迭代对象作为初始化参数，例如set([0, 1, 2])。</li>\n<li>使用集合推导，例如{element for element in range(3)}。</li>\n<li>使用集合字面值，例如{1, 2, 3}。</li>\n</ul>\n<p>使用集合的字面值和推导要格外小心，因为它们在形式上与字典的字面值和推导非常相似。此外，空的集合对象是没有字面值的。空的花括号{}表示的是空的字典字面值。</p>\n"},{"title":"re正则表达式操作","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-04T14:02:30.000Z","pic":null,"_content":"\n\n`Regular Expression`，正则表达式，使用表达式的方式对字符串进行匹配的语法规则。\n\n## 正则表达式语法\n\n一个*正则表达式*指定了一集与之匹配的字符串；模块内的函数可以让你检查某个字符串是否跟给定的正则表达式匹配。\n\n要看正则写得对不对，可以去[测试网站](https://tool.oschina.net/regex/)测试匹配结果。\n\n首先了解`元字符`的概念：*具有固定含义的特殊符号*。\n\n特殊字符有：\n\n```\n .    \n (点) 在默认模式，匹配**除了换行的任意字符**。\n\n ^    \n (插入符号) 匹配字符串的**开头**。\n\n $    \n 匹配**字符串尾或者在字符串尾的换行符的前一个字符**。在 *MULTILINE* 模式下也会匹配换行符之前的文本。\n\n *    \n 对它前面的正则式匹配**0到任意次重复**，尽量多的匹配字符串。 ab* 会匹配 a，ab，或者 a 后面跟随任意个 b。\n\n +    \n 对它前面的正则式匹配**1到任意次重复**。ab+ 会匹配 a 后面跟随1个以上到任意个 b，它不会匹配 a。\n\n ?    \n 对它前面的正则式匹配**0到1次重复**。 ab? 会匹配 a 或者 ab。\n\n *?, +?, ??    \n \\*, +，和 ? 修饰符都是 **贪婪的**；它们在字符串进行尽可能多的匹配。如果正则式 <.*> 希望找到 <a> b <c>，它将会匹配整个字符串，而不仅是 <a>。在修饰符之后添加 ? 将使样式以 非贪婪 方式进行匹配； 尽量 **少** 的字符将会被匹配。使用正则式 <.*?> 将会仅仅匹配 <a>。\n\n {m}    \n 对其之前的正则式指定匹配 m 个重复；少于 m 的话就会导致匹配失败。比如， a{6} 将匹配6个 a , 但是不能是5个。\n\n {m,n}    \n 对正则式进行 m 到 n 次匹配，在 m 和 n 之间取尽量多。 比如，a{3,5} 将匹配 3 到5个 a。忽略 m 意为指定下界为0，忽略 n 指定上界为无限次。比如 a{4,}b 将匹配 aaaab 或者1000个 a 尾随一个 b，但不能匹配 aaab。逗号不能省略，否则无法辨别修饰符应该忽略哪个边界。\n\n {m,n}?    \n 前一个修饰符的非贪婪模式，只匹配尽量少的字符次数。比如，对于 aaaaaa， a{3,5} 匹配5个 a ，而 a{3,5}? 只匹配3个 a。\n\n \\    \n 转义特殊字符（允许你匹配 '*', '?', 或者此类其他），或者表示一个特殊序列；\n\n []\n 用于表示一个字符集合。在一个集合中：\n    - 字符可以单独列出，比如 [amk] 匹配 'a'， 'm'， 或者 'k'。\n    - 可以表示字符范围，通过用 '-' 将两个字符连起来。比如 [a-z] 将匹配任何小写ASCII字符， [0-5][0-9] 将匹配从 00 到 59 的两位数字， [0-9A-Fa-f] 将匹配任何十六进制数位。\n    - 不在集合范围内的字符可以通过 取反 来进行匹配。如果集合首字符是 '^' ，所有 不 在集合内的字符将会被匹配，比如 [^5] 将匹配所有字符，除了 '5'， [^^] 将匹配所有字符，除了 '^'. ^ 如果不在集合首位，就没有特殊含义。\n    - 在集合内要匹配一个字符 ']'，有两种方法，要么就在它之前加上反斜杠，要么就把它放到集合首位。比如， [()[\\]{}] 和 []()[{}] 都可以匹配括号。\n\n|\nA|B， A 和 B 可以是任意正则表达式，创建一个正则表达式，匹配 A 或者 B. 任意个正则表达式可以用 '|' 连接。它也可以在组合（见下列）内使用。扫描目标字符串时， '|' 分隔开的正则样式从左到右进行匹配。当一个样式完全匹配时，这个分支就被接受。意思就是，一旦 A 匹配成功， B 就不再进行匹配，即便它能产生一个更好的匹配。或者说，'|' 操作符绝不贪婪。 如果要匹配 '|' 字符，使用 \\|， 或者把它包含在字符集里，比如 [|].\n\n(...)    \n（组合），匹配括号内的任意正则表达式，并标识出组合的开始和结尾。匹配完成后，组合的内容可以被获取，并可以在之后用 \\number 转义序列进行再次匹配，之后进行详细说明。要匹配字符 '(' 或者 ')', 用 \\( 或 \\), 或者把它们包含在字符集合里: [(], [)].\n\n\\A\n只匹配字符串开始。\n \n\\b\n匹配空字符串，但只在单词开始或结尾的位置。一个单词被定义为一个单词字符的序列。注意，通常 \\b 定义为 \\w 和 \\W 字符之间，或者 \\w 和字符串开始/结尾的边界， 意思就是 r'\\bfoo\\b' 匹配 'foo', 'foo.', '(foo)', 'bar foo baz' 但不匹配 'foobar' 或者 'foo3'。\n\n\\B\n匹配空字符串，但 不 能在词的开头或者结尾。意思就是 r'py\\B' 匹配 'python', 'py3', 'py2', 但不匹配 'py', 'py.', 或者 'py!'. \\B 是 \\b 的取非，所以Unicode样式的词语是由Unicode字母，数字或下划线构成的，虽然可以用 ASCII 标志来改变。如果使用了 LOCALE 标志，则词的边界由当前语言区域设置。\n\n\\d\n对于 Unicode (str) 样式：\n匹配任何Unicode十进制数（就是在Unicode字符目录[Nd]里的字符）。这包括了 [0-9] ，和很多其他的数字字符。如果设置了 ASCII 标志，就只匹配 [0-9] 。\n\n对于8位(bytes)样式：\n匹配任何十进制数，就是 [0-9]。\n\n\\D\n匹配任何非十进制数字的字符。就是 \\d 取非。 如果设置了 ASCII 标志，就相当于 [^0-9] 。\n\n\\s\n对于 Unicode (str) 样式：\n匹配任何Unicode空白字符（包括 [ \\t\\n\\r\\f\\v] ，还有很多其他字符，比如不同语言排版规则约定的不换行空格）。如果 ASCII 被设置，就只匹配 [ \\t\\n\\r\\f\\v] 。\n\n对于8位(bytes)样式：\n匹配ASCII中的空白字符，就是 [ \\t\\n\\r\\f\\v] 。\n\n\\S\n匹配任何非空白字符。就是 \\s 取非。如果设置了 ASCII 标志，就相当于 [^ \\t\\n\\r\\f\\v] 。\n\n\\w\n对于 Unicode (str) 样式：\n匹配Unicode词语的字符，包含了可以构成词语的绝大部分字符，也包括数字和下划线。如果设置了 ASCII 标志，就只匹配 [a-zA-Z0-9_] 。\n\n对于8位(bytes)样式：\n匹配ASCII字符中的数字和字母和下划线，就是 [a-zA-Z0-9_] 。如果设置了 LOCALE 标记，就匹配当前语言区域的数字和字母和下划线。\n\n\\W\n匹配非单词字符的字符。这与 \\w 正相反。如果使用了 ASCII 旗标，这就等价于 [^a-zA-Z0-9_]。如果使用了 LOCALE 旗标，则会匹配当前区域中既非字母数字也非下划线的字符。\n\n\\Z\n只匹配字符串尾。\n```\n\n## 模块内容\n\n模块定义了几个函数，常量，和一个例外。\n\n### re.compile\n\n```python\nre.compile(pattern, flags=0)\n```\n\n`re.compile`将正则表达式的样式编译为一个 `正则表达式对象（正则对象`），可以用于匹配，通过这个对象的方法` match()`, `search()` 。\n\n比如：\n\n```python\nimport re\n\nprog = re.compile('^a')\nresult = prog.match(\"abcd\")\nprint(result)\n\nresult = re.match('^a', \"abcd\")\nprint(result)\n\n# output\n# <re.Match object; span=(0, 1), match='a'>\n# <re.Match object; span=(0, 1), match='a'>\n```\n\n使用 `re.compile()` 保存正则对象以便复用，可以让程序更加高效。\n\n### re.match\n\n```python\nre.match(pattern, string, flags=0)\n```\n\n如果 `string` 开始的0或者多个字符匹配到了正则表达式样式，就返回一个相应的 `匹配对象` 。 如果没有匹配，就返回 `None` ；注意它跟零长度匹配是不同的。\n\n### re.search\n\n```python\nre.search(pattern, string, flags=0)\n```\n\n扫描整个 `字符串` 找到匹配样式的第一个位置，并返回一个相应的 `匹配对象` 。如果没有匹配，就返回一个 `None` ；\n\n### re.split\n\n```python\nre.split(pattern, string, maxsplit=0, flags=0)\n```\n\n用 `pattern` 分开 `string` 。 如果在 `pattern` 中捕获到括号，那么所有的组里的文字也会包含在列表里。如果 `maxsplit` 非零， 最多进行 `maxsplit` 次分隔， 剩下的字符全部返回到列表的最后一个元素。\n\n```python\n>>> re.split(r'\\W+', 'Words, words, words.')\n['Words', 'words', 'words', '']\n>>> re.split(r'(\\W+)', 'Words, words, words.')\n['Words', ', ', 'words', ', ', 'words', '.', '']\n>>> re.split(r'\\W+', 'Words, words, words.', 1)\n['Words', 'words, words.']\n>>> re.split('[a-f]+', '0a3B9', flags=re.IGNORECASE)\n['0', '3', '9']\n```\n\n### re.findall\n\n```python\nre.findall(pattern, string, flags=0)\n```\n\n对 `string` 返回一个不重复的 `pattern` 的匹配列表， `string` 从左到右进行扫描，匹配按找到的顺序返回。如果样式里存在一到多个组，就返回一个组合列表；就是一个元组的列表（如果样式里有超过一个组合的话）。空匹配也会包含在结果里。\n\n```python\nimport re\n\npartern = re.compile(r\"\\d+\")\n\nres = partern.findall(\"我的电话号码是1760718283，你的电话是110吗？\")\nprint(res)\n\n# ['1760718283', '110']\n```\n\n###  re.finditer\n\n```python\nre.finditer(pattern, string, flags=0)\n```\n\n`pattern` 在 `string` 里所有的非重复匹配，返回为一个迭代器 `iterator` 保存了 匹配对象 。 string 从左到右扫描，匹配按顺序排列。空匹配也包含在结果里。\n\n```python\nimport re\n\npartern = re.compile(r\"\\d+\")\n\nres = partern.finditer(\"我的电话号码是1760718283，你的电话是110吗？\")\nfor item in res:\n    print(item.group())\n\n# output\n# 1760718283\n# 110\n```\n\n## 匹配对象\n\n匹配对象总是有一个布尔值 `True`。如果没有匹配的话 `match()` 和 `search()` 返回 `None` 所以你可以简单的用 `if` 语句来判断是否匹配\n\n```python\nmatch = re.search(pattern, string)\nif match:\n    process(match)\n```\n\n匹配对象支持以下方法和属性：\n\n### Match.group\n\n```python\nMatch.group([group1, ...])\n```\n\n返回一个或者多个匹配的子组。如果只有一个参数，结果就是一个字符串，如果有多个参数，结果就是一个元组（每个参数对应一个项），如果没有参数，组1默认到0（整个匹配都被返回）。如果一个组N 参数值为 0，相应的返回值就是整个匹配字符串；如果它是一个范围 [1..99]，结果就是相应的括号组字符串。\n\n```python\nimport re\n\nmatch = re.match(r\"(\\w+) (\\w+)\", \"Hello World, heyhey!\")\nprint(match)    # <re.Match object; span=(0, 11), match='Hello World'>\n\nprint(match.group())   # Hello World\nprint(match.group(0))   # Hello World\nprint(match.group(1))   # Hello\nprint(match.group(2))   # World\n```\n\n如果正则表达式使用了 `(?P<name>…)` 语法， `groupN` 参数就也可能是命名组合的名字。\n\n```python\n>>> m = re.match(r\"(?P<first_name>\\w+) (?P<last_name>\\w+)\", \"Malcolm Reynolds\")\n>>> m.group('first_name')\n'Malcolm'\n>>> m.group('last_name')\n'Reynolds'\n\n```\n\n命名组合同样可以通过索引值引用。\n\n```python\n>>> m.group(1)\n'Malcolm'\n>>> m.group(2)\n'Reynolds'\n```\n\n如果一个组匹配成功多次，就只返回最后一个匹配。\n\n```python\n>>> m = re.match(r\"(..)+\", \"a1b2c3\")  # Matches 3 times.\n>>> m.group(1)                        # Returns only the last match.\n'c3'\n```\n\n### Match.groups\n\n```python\nMatch.groups(default=None)\n```\n\n返回一个元组，包含所有匹配的子组，在样式中出现的从1到任意多的组合。 `default` 参数用于不参与匹配的情况，默认为 `None`。\n\n```python\nimport re\n\nmatch = re.match(r\"(\\w+) (\\w+)\", \"Hello World, heyhey!\")\nprint(match)    # <re.Match object; span=(0, 11), match='Hello World'>\n\nprint(match.groups())   # ('Hello', 'World')\n```\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n\n","source":"_posts/re正则表达式操作.md","raw":"---\ntitle: re正则表达式操作\ntags:\n  - re\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-04 22:02:30\ncategories: Python库\npic:\n---\n\n\n`Regular Expression`，正则表达式，使用表达式的方式对字符串进行匹配的语法规则。\n\n## 正则表达式语法\n\n一个*正则表达式*指定了一集与之匹配的字符串；模块内的函数可以让你检查某个字符串是否跟给定的正则表达式匹配。\n\n要看正则写得对不对，可以去[测试网站](https://tool.oschina.net/regex/)测试匹配结果。\n\n首先了解`元字符`的概念：*具有固定含义的特殊符号*。\n\n特殊字符有：\n\n```\n .    \n (点) 在默认模式，匹配**除了换行的任意字符**。\n\n ^    \n (插入符号) 匹配字符串的**开头**。\n\n $    \n 匹配**字符串尾或者在字符串尾的换行符的前一个字符**。在 *MULTILINE* 模式下也会匹配换行符之前的文本。\n\n *    \n 对它前面的正则式匹配**0到任意次重复**，尽量多的匹配字符串。 ab* 会匹配 a，ab，或者 a 后面跟随任意个 b。\n\n +    \n 对它前面的正则式匹配**1到任意次重复**。ab+ 会匹配 a 后面跟随1个以上到任意个 b，它不会匹配 a。\n\n ?    \n 对它前面的正则式匹配**0到1次重复**。 ab? 会匹配 a 或者 ab。\n\n *?, +?, ??    \n \\*, +，和 ? 修饰符都是 **贪婪的**；它们在字符串进行尽可能多的匹配。如果正则式 <.*> 希望找到 <a> b <c>，它将会匹配整个字符串，而不仅是 <a>。在修饰符之后添加 ? 将使样式以 非贪婪 方式进行匹配； 尽量 **少** 的字符将会被匹配。使用正则式 <.*?> 将会仅仅匹配 <a>。\n\n {m}    \n 对其之前的正则式指定匹配 m 个重复；少于 m 的话就会导致匹配失败。比如， a{6} 将匹配6个 a , 但是不能是5个。\n\n {m,n}    \n 对正则式进行 m 到 n 次匹配，在 m 和 n 之间取尽量多。 比如，a{3,5} 将匹配 3 到5个 a。忽略 m 意为指定下界为0，忽略 n 指定上界为无限次。比如 a{4,}b 将匹配 aaaab 或者1000个 a 尾随一个 b，但不能匹配 aaab。逗号不能省略，否则无法辨别修饰符应该忽略哪个边界。\n\n {m,n}?    \n 前一个修饰符的非贪婪模式，只匹配尽量少的字符次数。比如，对于 aaaaaa， a{3,5} 匹配5个 a ，而 a{3,5}? 只匹配3个 a。\n\n \\    \n 转义特殊字符（允许你匹配 '*', '?', 或者此类其他），或者表示一个特殊序列；\n\n []\n 用于表示一个字符集合。在一个集合中：\n    - 字符可以单独列出，比如 [amk] 匹配 'a'， 'm'， 或者 'k'。\n    - 可以表示字符范围，通过用 '-' 将两个字符连起来。比如 [a-z] 将匹配任何小写ASCII字符， [0-5][0-9] 将匹配从 00 到 59 的两位数字， [0-9A-Fa-f] 将匹配任何十六进制数位。\n    - 不在集合范围内的字符可以通过 取反 来进行匹配。如果集合首字符是 '^' ，所有 不 在集合内的字符将会被匹配，比如 [^5] 将匹配所有字符，除了 '5'， [^^] 将匹配所有字符，除了 '^'. ^ 如果不在集合首位，就没有特殊含义。\n    - 在集合内要匹配一个字符 ']'，有两种方法，要么就在它之前加上反斜杠，要么就把它放到集合首位。比如， [()[\\]{}] 和 []()[{}] 都可以匹配括号。\n\n|\nA|B， A 和 B 可以是任意正则表达式，创建一个正则表达式，匹配 A 或者 B. 任意个正则表达式可以用 '|' 连接。它也可以在组合（见下列）内使用。扫描目标字符串时， '|' 分隔开的正则样式从左到右进行匹配。当一个样式完全匹配时，这个分支就被接受。意思就是，一旦 A 匹配成功， B 就不再进行匹配，即便它能产生一个更好的匹配。或者说，'|' 操作符绝不贪婪。 如果要匹配 '|' 字符，使用 \\|， 或者把它包含在字符集里，比如 [|].\n\n(...)    \n（组合），匹配括号内的任意正则表达式，并标识出组合的开始和结尾。匹配完成后，组合的内容可以被获取，并可以在之后用 \\number 转义序列进行再次匹配，之后进行详细说明。要匹配字符 '(' 或者 ')', 用 \\( 或 \\), 或者把它们包含在字符集合里: [(], [)].\n\n\\A\n只匹配字符串开始。\n \n\\b\n匹配空字符串，但只在单词开始或结尾的位置。一个单词被定义为一个单词字符的序列。注意，通常 \\b 定义为 \\w 和 \\W 字符之间，或者 \\w 和字符串开始/结尾的边界， 意思就是 r'\\bfoo\\b' 匹配 'foo', 'foo.', '(foo)', 'bar foo baz' 但不匹配 'foobar' 或者 'foo3'。\n\n\\B\n匹配空字符串，但 不 能在词的开头或者结尾。意思就是 r'py\\B' 匹配 'python', 'py3', 'py2', 但不匹配 'py', 'py.', 或者 'py!'. \\B 是 \\b 的取非，所以Unicode样式的词语是由Unicode字母，数字或下划线构成的，虽然可以用 ASCII 标志来改变。如果使用了 LOCALE 标志，则词的边界由当前语言区域设置。\n\n\\d\n对于 Unicode (str) 样式：\n匹配任何Unicode十进制数（就是在Unicode字符目录[Nd]里的字符）。这包括了 [0-9] ，和很多其他的数字字符。如果设置了 ASCII 标志，就只匹配 [0-9] 。\n\n对于8位(bytes)样式：\n匹配任何十进制数，就是 [0-9]。\n\n\\D\n匹配任何非十进制数字的字符。就是 \\d 取非。 如果设置了 ASCII 标志，就相当于 [^0-9] 。\n\n\\s\n对于 Unicode (str) 样式：\n匹配任何Unicode空白字符（包括 [ \\t\\n\\r\\f\\v] ，还有很多其他字符，比如不同语言排版规则约定的不换行空格）。如果 ASCII 被设置，就只匹配 [ \\t\\n\\r\\f\\v] 。\n\n对于8位(bytes)样式：\n匹配ASCII中的空白字符，就是 [ \\t\\n\\r\\f\\v] 。\n\n\\S\n匹配任何非空白字符。就是 \\s 取非。如果设置了 ASCII 标志，就相当于 [^ \\t\\n\\r\\f\\v] 。\n\n\\w\n对于 Unicode (str) 样式：\n匹配Unicode词语的字符，包含了可以构成词语的绝大部分字符，也包括数字和下划线。如果设置了 ASCII 标志，就只匹配 [a-zA-Z0-9_] 。\n\n对于8位(bytes)样式：\n匹配ASCII字符中的数字和字母和下划线，就是 [a-zA-Z0-9_] 。如果设置了 LOCALE 标记，就匹配当前语言区域的数字和字母和下划线。\n\n\\W\n匹配非单词字符的字符。这与 \\w 正相反。如果使用了 ASCII 旗标，这就等价于 [^a-zA-Z0-9_]。如果使用了 LOCALE 旗标，则会匹配当前区域中既非字母数字也非下划线的字符。\n\n\\Z\n只匹配字符串尾。\n```\n\n## 模块内容\n\n模块定义了几个函数，常量，和一个例外。\n\n### re.compile\n\n```python\nre.compile(pattern, flags=0)\n```\n\n`re.compile`将正则表达式的样式编译为一个 `正则表达式对象（正则对象`），可以用于匹配，通过这个对象的方法` match()`, `search()` 。\n\n比如：\n\n```python\nimport re\n\nprog = re.compile('^a')\nresult = prog.match(\"abcd\")\nprint(result)\n\nresult = re.match('^a', \"abcd\")\nprint(result)\n\n# output\n# <re.Match object; span=(0, 1), match='a'>\n# <re.Match object; span=(0, 1), match='a'>\n```\n\n使用 `re.compile()` 保存正则对象以便复用，可以让程序更加高效。\n\n### re.match\n\n```python\nre.match(pattern, string, flags=0)\n```\n\n如果 `string` 开始的0或者多个字符匹配到了正则表达式样式，就返回一个相应的 `匹配对象` 。 如果没有匹配，就返回 `None` ；注意它跟零长度匹配是不同的。\n\n### re.search\n\n```python\nre.search(pattern, string, flags=0)\n```\n\n扫描整个 `字符串` 找到匹配样式的第一个位置，并返回一个相应的 `匹配对象` 。如果没有匹配，就返回一个 `None` ；\n\n### re.split\n\n```python\nre.split(pattern, string, maxsplit=0, flags=0)\n```\n\n用 `pattern` 分开 `string` 。 如果在 `pattern` 中捕获到括号，那么所有的组里的文字也会包含在列表里。如果 `maxsplit` 非零， 最多进行 `maxsplit` 次分隔， 剩下的字符全部返回到列表的最后一个元素。\n\n```python\n>>> re.split(r'\\W+', 'Words, words, words.')\n['Words', 'words', 'words', '']\n>>> re.split(r'(\\W+)', 'Words, words, words.')\n['Words', ', ', 'words', ', ', 'words', '.', '']\n>>> re.split(r'\\W+', 'Words, words, words.', 1)\n['Words', 'words, words.']\n>>> re.split('[a-f]+', '0a3B9', flags=re.IGNORECASE)\n['0', '3', '9']\n```\n\n### re.findall\n\n```python\nre.findall(pattern, string, flags=0)\n```\n\n对 `string` 返回一个不重复的 `pattern` 的匹配列表， `string` 从左到右进行扫描，匹配按找到的顺序返回。如果样式里存在一到多个组，就返回一个组合列表；就是一个元组的列表（如果样式里有超过一个组合的话）。空匹配也会包含在结果里。\n\n```python\nimport re\n\npartern = re.compile(r\"\\d+\")\n\nres = partern.findall(\"我的电话号码是1760718283，你的电话是110吗？\")\nprint(res)\n\n# ['1760718283', '110']\n```\n\n###  re.finditer\n\n```python\nre.finditer(pattern, string, flags=0)\n```\n\n`pattern` 在 `string` 里所有的非重复匹配，返回为一个迭代器 `iterator` 保存了 匹配对象 。 string 从左到右扫描，匹配按顺序排列。空匹配也包含在结果里。\n\n```python\nimport re\n\npartern = re.compile(r\"\\d+\")\n\nres = partern.finditer(\"我的电话号码是1760718283，你的电话是110吗？\")\nfor item in res:\n    print(item.group())\n\n# output\n# 1760718283\n# 110\n```\n\n## 匹配对象\n\n匹配对象总是有一个布尔值 `True`。如果没有匹配的话 `match()` 和 `search()` 返回 `None` 所以你可以简单的用 `if` 语句来判断是否匹配\n\n```python\nmatch = re.search(pattern, string)\nif match:\n    process(match)\n```\n\n匹配对象支持以下方法和属性：\n\n### Match.group\n\n```python\nMatch.group([group1, ...])\n```\n\n返回一个或者多个匹配的子组。如果只有一个参数，结果就是一个字符串，如果有多个参数，结果就是一个元组（每个参数对应一个项），如果没有参数，组1默认到0（整个匹配都被返回）。如果一个组N 参数值为 0，相应的返回值就是整个匹配字符串；如果它是一个范围 [1..99]，结果就是相应的括号组字符串。\n\n```python\nimport re\n\nmatch = re.match(r\"(\\w+) (\\w+)\", \"Hello World, heyhey!\")\nprint(match)    # <re.Match object; span=(0, 11), match='Hello World'>\n\nprint(match.group())   # Hello World\nprint(match.group(0))   # Hello World\nprint(match.group(1))   # Hello\nprint(match.group(2))   # World\n```\n\n如果正则表达式使用了 `(?P<name>…)` 语法， `groupN` 参数就也可能是命名组合的名字。\n\n```python\n>>> m = re.match(r\"(?P<first_name>\\w+) (?P<last_name>\\w+)\", \"Malcolm Reynolds\")\n>>> m.group('first_name')\n'Malcolm'\n>>> m.group('last_name')\n'Reynolds'\n\n```\n\n命名组合同样可以通过索引值引用。\n\n```python\n>>> m.group(1)\n'Malcolm'\n>>> m.group(2)\n'Reynolds'\n```\n\n如果一个组匹配成功多次，就只返回最后一个匹配。\n\n```python\n>>> m = re.match(r\"(..)+\", \"a1b2c3\")  # Matches 3 times.\n>>> m.group(1)                        # Returns only the last match.\n'c3'\n```\n\n### Match.groups\n\n```python\nMatch.groups(default=None)\n```\n\n返回一个元组，包含所有匹配的子组，在样式中出现的从1到任意多的组合。 `default` 参数用于不参与匹配的情况，默认为 `None`。\n\n```python\nimport re\n\nmatch = re.match(r\"(\\w+) (\\w+)\", \"Hello World, heyhey!\")\nprint(match)    # <re.Match object; span=(0, 11), match='Hello World'>\n\nprint(match.groups())   # ('Hello', 'World')\n```\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n\n","slug":"re正则表达式操作","published":1,"updated":"2021-06-17T11:48:09.717Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2m002f44udc6r0e9dp","content":"<p><code>Regular Expression</code>，正则表达式，使用表达式的方式对字符串进行匹配的语法规则。</p>\n<h2 id=\"正则表达式语法\"><a href=\"#正则表达式语法\" class=\"headerlink\" title=\"正则表达式语法\"></a>正则表达式语法</h2><p>一个<em>正则表达式</em>指定了一集与之匹配的字符串；模块内的函数可以让你检查某个字符串是否跟给定的正则表达式匹配。</p>\n<p>要看正则写得对不对，可以去<a href=\"https://tool.oschina.net/regex/\">测试网站</a>测试匹配结果。</p>\n<p>首先了解<code>元字符</code>的概念：<em>具有固定含义的特殊符号</em>。</p>\n<p>特殊字符有：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> .    </span><br><span class=\"line\"> (点) 在默认模式，匹配**除了换行的任意字符**。</span><br><span class=\"line\"></span><br><span class=\"line\"> ^    </span><br><span class=\"line\"> (插入符号) 匹配字符串的**开头**。</span><br><span class=\"line\"></span><br><span class=\"line\"> $    </span><br><span class=\"line\"> 匹配**字符串尾或者在字符串尾的换行符的前一个字符**。在 *MULTILINE* 模式下也会匹配换行符之前的文本。</span><br><span class=\"line\"></span><br><span class=\"line\"> *    </span><br><span class=\"line\"> 对它前面的正则式匹配**0到任意次重复**，尽量多的匹配字符串。 ab* 会匹配 a，ab，或者 a 后面跟随任意个 b。</span><br><span class=\"line\"></span><br><span class=\"line\"> +    </span><br><span class=\"line\"> 对它前面的正则式匹配**1到任意次重复**。ab+ 会匹配 a 后面跟随1个以上到任意个 b，它不会匹配 a。</span><br><span class=\"line\"></span><br><span class=\"line\"> ?    </span><br><span class=\"line\"> 对它前面的正则式匹配**0到1次重复**。 ab? 会匹配 a 或者 ab。</span><br><span class=\"line\"></span><br><span class=\"line\"> *?, +?, ??    </span><br><span class=\"line\"> \\*, +，和 ? 修饰符都是 **贪婪的**；它们在字符串进行尽可能多的匹配。如果正则式 &lt;.*&gt; 希望找到 &lt;a&gt; b &lt;c&gt;，它将会匹配整个字符串，而不仅是 &lt;a&gt;。在修饰符之后添加 ? 将使样式以 非贪婪 方式进行匹配； 尽量 **少** 的字符将会被匹配。使用正则式 &lt;.*?&gt; 将会仅仅匹配 &lt;a&gt;。</span><br><span class=\"line\"></span><br><span class=\"line\"> &#123;m&#125;    </span><br><span class=\"line\"> 对其之前的正则式指定匹配 m 个重复；少于 m 的话就会导致匹配失败。比如， a&#123;6&#125; 将匹配6个 a , 但是不能是5个。</span><br><span class=\"line\"></span><br><span class=\"line\"> &#123;m,n&#125;    </span><br><span class=\"line\"> 对正则式进行 m 到 n 次匹配，在 m 和 n 之间取尽量多。 比如，a&#123;3,5&#125; 将匹配 3 到5个 a。忽略 m 意为指定下界为0，忽略 n 指定上界为无限次。比如 a&#123;4,&#125;b 将匹配 aaaab 或者1000个 a 尾随一个 b，但不能匹配 aaab。逗号不能省略，否则无法辨别修饰符应该忽略哪个边界。</span><br><span class=\"line\"></span><br><span class=\"line\"> &#123;m,n&#125;?    </span><br><span class=\"line\"> 前一个修饰符的非贪婪模式，只匹配尽量少的字符次数。比如，对于 aaaaaa， a&#123;3,5&#125; 匹配5个 a ，而 a&#123;3,5&#125;? 只匹配3个 a。</span><br><span class=\"line\"></span><br><span class=\"line\"> \\    </span><br><span class=\"line\"> 转义特殊字符（允许你匹配 &#x27;*&#x27;, &#x27;?&#x27;, 或者此类其他），或者表示一个特殊序列；</span><br><span class=\"line\"></span><br><span class=\"line\"> []</span><br><span class=\"line\"> 用于表示一个字符集合。在一个集合中：</span><br><span class=\"line\">    - 字符可以单独列出，比如 [amk] 匹配 &#x27;a&#x27;， &#x27;m&#x27;， 或者 &#x27;k&#x27;。</span><br><span class=\"line\">    - 可以表示字符范围，通过用 &#x27;-&#x27; 将两个字符连起来。比如 [a-z] 将匹配任何小写ASCII字符， [0-5][0-9] 将匹配从 00 到 59 的两位数字， [0-9A-Fa-f] 将匹配任何十六进制数位。</span><br><span class=\"line\">    - 不在集合范围内的字符可以通过 取反 来进行匹配。如果集合首字符是 &#x27;^&#x27; ，所有 不 在集合内的字符将会被匹配，比如 [^5] 将匹配所有字符，除了 &#x27;5&#x27;， [^^] 将匹配所有字符，除了 &#x27;^&#x27;. ^ 如果不在集合首位，就没有特殊含义。</span><br><span class=\"line\">    - 在集合内要匹配一个字符 &#x27;]&#x27;，有两种方法，要么就在它之前加上反斜杠，要么就把它放到集合首位。比如， [()[\\]&#123;&#125;] 和 []()[&#123;&#125;] 都可以匹配括号。</span><br><span class=\"line\"></span><br><span class=\"line\">|</span><br><span class=\"line\">A|B， A 和 B 可以是任意正则表达式，创建一个正则表达式，匹配 A 或者 B. 任意个正则表达式可以用 &#x27;|&#x27; 连接。它也可以在组合（见下列）内使用。扫描目标字符串时， &#x27;|&#x27; 分隔开的正则样式从左到右进行匹配。当一个样式完全匹配时，这个分支就被接受。意思就是，一旦 A 匹配成功， B 就不再进行匹配，即便它能产生一个更好的匹配。或者说，&#x27;|&#x27; 操作符绝不贪婪。 如果要匹配 &#x27;|&#x27; 字符，使用 \\|， 或者把它包含在字符集里，比如 [|].</span><br><span class=\"line\"></span><br><span class=\"line\">(...)    </span><br><span class=\"line\">（组合），匹配括号内的任意正则表达式，并标识出组合的开始和结尾。匹配完成后，组合的内容可以被获取，并可以在之后用 \\number 转义序列进行再次匹配，之后进行详细说明。要匹配字符 &#x27;(&#x27; 或者 &#x27;)&#x27;, 用 \\( 或 \\), 或者把它们包含在字符集合里: [(], [)].</span><br><span class=\"line\"></span><br><span class=\"line\">\\A</span><br><span class=\"line\">只匹配字符串开始。</span><br><span class=\"line\"> </span><br><span class=\"line\">\\b</span><br><span class=\"line\">匹配空字符串，但只在单词开始或结尾的位置。一个单词被定义为一个单词字符的序列。注意，通常 \\b 定义为 \\w 和 \\W 字符之间，或者 \\w 和字符串开始/结尾的边界， 意思就是 r&#x27;\\bfoo\\b&#x27; 匹配 &#x27;foo&#x27;, &#x27;foo.&#x27;, &#x27;(foo)&#x27;, &#x27;bar foo baz&#x27; 但不匹配 &#x27;foobar&#x27; 或者 &#x27;foo3&#x27;。</span><br><span class=\"line\"></span><br><span class=\"line\">\\B</span><br><span class=\"line\">匹配空字符串，但 不 能在词的开头或者结尾。意思就是 r&#x27;py\\B&#x27; 匹配 &#x27;python&#x27;, &#x27;py3&#x27;, &#x27;py2&#x27;, 但不匹配 &#x27;py&#x27;, &#x27;py.&#x27;, 或者 &#x27;py!&#x27;. \\B 是 \\b 的取非，所以Unicode样式的词语是由Unicode字母，数字或下划线构成的，虽然可以用 ASCII 标志来改变。如果使用了 LOCALE 标志，则词的边界由当前语言区域设置。</span><br><span class=\"line\"></span><br><span class=\"line\">\\d</span><br><span class=\"line\">对于 Unicode (str) 样式：</span><br><span class=\"line\">匹配任何Unicode十进制数（就是在Unicode字符目录[Nd]里的字符）。这包括了 [0-9] ，和很多其他的数字字符。如果设置了 ASCII 标志，就只匹配 [0-9] 。</span><br><span class=\"line\"></span><br><span class=\"line\">对于8位(bytes)样式：</span><br><span class=\"line\">匹配任何十进制数，就是 [0-9]。</span><br><span class=\"line\"></span><br><span class=\"line\">\\D</span><br><span class=\"line\">匹配任何非十进制数字的字符。就是 \\d 取非。 如果设置了 ASCII 标志，就相当于 [^0-9] 。</span><br><span class=\"line\"></span><br><span class=\"line\">\\s</span><br><span class=\"line\">对于 Unicode (str) 样式：</span><br><span class=\"line\">匹配任何Unicode空白字符（包括 [ \\t\\n\\r\\f\\v] ，还有很多其他字符，比如不同语言排版规则约定的不换行空格）。如果 ASCII 被设置，就只匹配 [ \\t\\n\\r\\f\\v] 。</span><br><span class=\"line\"></span><br><span class=\"line\">对于8位(bytes)样式：</span><br><span class=\"line\">匹配ASCII中的空白字符，就是 [ \\t\\n\\r\\f\\v] 。</span><br><span class=\"line\"></span><br><span class=\"line\">\\S</span><br><span class=\"line\">匹配任何非空白字符。就是 \\s 取非。如果设置了 ASCII 标志，就相当于 [^ \\t\\n\\r\\f\\v] 。</span><br><span class=\"line\"></span><br><span class=\"line\">\\w</span><br><span class=\"line\">对于 Unicode (str) 样式：</span><br><span class=\"line\">匹配Unicode词语的字符，包含了可以构成词语的绝大部分字符，也包括数字和下划线。如果设置了 ASCII 标志，就只匹配 [a-zA-Z0-9_] 。</span><br><span class=\"line\"></span><br><span class=\"line\">对于8位(bytes)样式：</span><br><span class=\"line\">匹配ASCII字符中的数字和字母和下划线，就是 [a-zA-Z0-9_] 。如果设置了 LOCALE 标记，就匹配当前语言区域的数字和字母和下划线。</span><br><span class=\"line\"></span><br><span class=\"line\">\\W</span><br><span class=\"line\">匹配非单词字符的字符。这与 \\w 正相反。如果使用了 ASCII 旗标，这就等价于 [^a-zA-Z0-9_]。如果使用了 LOCALE 旗标，则会匹配当前区域中既非字母数字也非下划线的字符。</span><br><span class=\"line\"></span><br><span class=\"line\">\\Z</span><br><span class=\"line\">只匹配字符串尾。</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"模块内容\"><a href=\"#模块内容\" class=\"headerlink\" title=\"模块内容\"></a>模块内容</h2><p>模块定义了几个函数，常量，和一个例外。</p>\n<h3 id=\"re-compile\"><a href=\"#re-compile\" class=\"headerlink\" title=\"re.compile\"></a>re.compile</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">re.<span class=\"built_in\">compile</span>(pattern, flags=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<p><code>re.compile</code>将正则表达式的样式编译为一个 <code>正则表达式对象（正则对象</code>），可以用于匹配，通过这个对象的方法<code> match()</code>, <code>search()</code> 。</p>\n<p>比如：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">prog = re.<span class=\"built_in\">compile</span>(<span class=\"string\">&#x27;^a&#x27;</span>)</span><br><span class=\"line\">result = prog.match(<span class=\"string\">&quot;abcd&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"></span><br><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^a&#x27;</span>, <span class=\"string\">&quot;abcd&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># output</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;re.Match object; span=(0, 1), match=&#x27;a&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;re.Match object; span=(0, 1), match=&#x27;a&#x27;&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>使用 <code>re.compile()</code> 保存正则对象以便复用，可以让程序更加高效。</p>\n<h3 id=\"re-match\"><a href=\"#re-match\" class=\"headerlink\" title=\"re.match\"></a>re.match</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">re.match(pattern, string, flags=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<p>如果 <code>string</code> 开始的0或者多个字符匹配到了正则表达式样式，就返回一个相应的 <code>匹配对象</code> 。 如果没有匹配，就返回 <code>None</code> ；注意它跟零长度匹配是不同的。</p>\n<h3 id=\"re-search\"><a href=\"#re-search\" class=\"headerlink\" title=\"re.search\"></a>re.search</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">re.search(pattern, string, flags=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<p>扫描整个 <code>字符串</code> 找到匹配样式的第一个位置，并返回一个相应的 <code>匹配对象</code> 。如果没有匹配，就返回一个 <code>None</code> ；</p>\n<h3 id=\"re-split\"><a href=\"#re-split\" class=\"headerlink\" title=\"re.split\"></a>re.split</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">re.split(pattern, string, maxsplit=<span class=\"number\">0</span>, flags=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<p>用 <code>pattern</code> 分开 <code>string</code> 。 如果在 <code>pattern</code> 中捕获到括号，那么所有的组里的文字也会包含在列表里。如果 <code>maxsplit</code> 非零， 最多进行 <code>maxsplit</code> 次分隔， 剩下的字符全部返回到列表的最后一个元素。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>re.split(<span class=\"string\">r&#x27;\\W+&#x27;</span>, <span class=\"string\">&#x27;Words, words, words.&#x27;</span>)</span><br><span class=\"line\">[<span class=\"string\">&#x27;Words&#x27;</span>, <span class=\"string\">&#x27;words&#x27;</span>, <span class=\"string\">&#x27;words&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>re.split(<span class=\"string\">r&#x27;(\\W+)&#x27;</span>, <span class=\"string\">&#x27;Words, words, words.&#x27;</span>)</span><br><span class=\"line\">[<span class=\"string\">&#x27;Words&#x27;</span>, <span class=\"string\">&#x27;, &#x27;</span>, <span class=\"string\">&#x27;words&#x27;</span>, <span class=\"string\">&#x27;, &#x27;</span>, <span class=\"string\">&#x27;words&#x27;</span>, <span class=\"string\">&#x27;.&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>re.split(<span class=\"string\">r&#x27;\\W+&#x27;</span>, <span class=\"string\">&#x27;Words, words, words.&#x27;</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">[<span class=\"string\">&#x27;Words&#x27;</span>, <span class=\"string\">&#x27;words, words.&#x27;</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>re.split(<span class=\"string\">&#x27;[a-f]+&#x27;</span>, <span class=\"string\">&#x27;0a3B9&#x27;</span>, flags=re.IGNORECASE)</span><br><span class=\"line\">[<span class=\"string\">&#x27;0&#x27;</span>, <span class=\"string\">&#x27;3&#x27;</span>, <span class=\"string\">&#x27;9&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"re-findall\"><a href=\"#re-findall\" class=\"headerlink\" title=\"re.findall\"></a>re.findall</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">re.findall(pattern, string, flags=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<p>对 <code>string</code> 返回一个不重复的 <code>pattern</code> 的匹配列表， <code>string</code> 从左到右进行扫描，匹配按找到的顺序返回。如果样式里存在一到多个组，就返回一个组合列表；就是一个元组的列表（如果样式里有超过一个组合的话）。空匹配也会包含在结果里。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">partern = re.<span class=\"built_in\">compile</span>(<span class=\"string\">r&quot;\\d+&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">res = partern.findall(<span class=\"string\">&quot;我的电话号码是1760718283，你的电话是110吗？&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(res)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># [&#x27;1760718283&#x27;, &#x27;110&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"re-finditer\"><a href=\"#re-finditer\" class=\"headerlink\" title=\"re.finditer\"></a>re.finditer</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">re.finditer(pattern, string, flags=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<p><code>pattern</code> 在 <code>string</code> 里所有的非重复匹配，返回为一个迭代器 <code>iterator</code> 保存了 匹配对象 。 string 从左到右扫描，匹配按顺序排列。空匹配也包含在结果里。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">partern = re.<span class=\"built_in\">compile</span>(<span class=\"string\">r&quot;\\d+&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">res = partern.finditer(<span class=\"string\">&quot;我的电话号码是1760718283，你的电话是110吗？&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> res:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(item.group())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># output</span></span><br><span class=\"line\"><span class=\"comment\"># 1760718283</span></span><br><span class=\"line\"><span class=\"comment\"># 110</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"匹配对象\"><a href=\"#匹配对象\" class=\"headerlink\" title=\"匹配对象\"></a>匹配对象</h2><p>匹配对象总是有一个布尔值 <code>True</code>。如果没有匹配的话 <code>match()</code> 和 <code>search()</code> 返回 <code>None</code> 所以你可以简单的用 <code>if</code> 语句来判断是否匹配</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">match = re.search(pattern, string)</span><br><span class=\"line\"><span class=\"keyword\">if</span> match:</span><br><span class=\"line\">    process(match)</span><br></pre></td></tr></table></figure>\n\n<p>匹配对象支持以下方法和属性：</p>\n<h3 id=\"Match-group\"><a href=\"#Match-group\" class=\"headerlink\" title=\"Match.group\"></a>Match.group</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Match.group([group1, ...])</span><br></pre></td></tr></table></figure>\n\n<p>返回一个或者多个匹配的子组。如果只有一个参数，结果就是一个字符串，如果有多个参数，结果就是一个元组（每个参数对应一个项），如果没有参数，组1默认到0（整个匹配都被返回）。如果一个组N 参数值为 0，相应的返回值就是整个匹配字符串；如果它是一个范围 [1..99]，结果就是相应的括号组字符串。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">match = re.match(<span class=\"string\">r&quot;(\\w+) (\\w+)&quot;</span>, <span class=\"string\">&quot;Hello World, heyhey!&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(match)    <span class=\"comment\"># &lt;re.Match object; span=(0, 11), match=&#x27;Hello World&#x27;&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(match.group())   <span class=\"comment\"># Hello World</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(match.group(<span class=\"number\">0</span>))   <span class=\"comment\"># Hello World</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(match.group(<span class=\"number\">1</span>))   <span class=\"comment\"># Hello</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(match.group(<span class=\"number\">2</span>))   <span class=\"comment\"># World</span></span><br></pre></td></tr></table></figure>\n\n<p>如果正则表达式使用了 <code>(?P&lt;name&gt;…)</code> 语法， <code>groupN</code> 参数就也可能是命名组合的名字。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m = re.match(<span class=\"string\">r&quot;(?P&lt;first_name&gt;\\w+) (?P&lt;last_name&gt;\\w+)&quot;</span>, <span class=\"string\">&quot;Malcolm Reynolds&quot;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m.group(<span class=\"string\">&#x27;first_name&#x27;</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;Malcolm&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m.group(<span class=\"string\">&#x27;last_name&#x27;</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;Reynolds&#x27;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>命名组合同样可以通过索引值引用。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m.group(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;Malcolm&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m.group(<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;Reynolds&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果一个组匹配成功多次，就只返回最后一个匹配。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m = re.match(<span class=\"string\">r&quot;(..)+&quot;</span>, <span class=\"string\">&quot;a1b2c3&quot;</span>)  <span class=\"comment\"># Matches 3 times.</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m.group(<span class=\"number\">1</span>)                        <span class=\"comment\"># Returns only the last match.</span></span><br><span class=\"line\"><span class=\"string\">&#x27;c3&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Match-groups\"><a href=\"#Match-groups\" class=\"headerlink\" title=\"Match.groups\"></a>Match.groups</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Match.groups(default=<span class=\"literal\">None</span>)</span><br></pre></td></tr></table></figure>\n\n<p>返回一个元组，包含所有匹配的子组，在样式中出现的从1到任意多的组合。 <code>default</code> 参数用于不参与匹配的情况，默认为 <code>None</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">match = re.match(<span class=\"string\">r&quot;(\\w+) (\\w+)&quot;</span>, <span class=\"string\">&quot;Hello World, heyhey!&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(match)    <span class=\"comment\"># &lt;re.Match object; span=(0, 11), match=&#x27;Hello World&#x27;&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(match.groups())   <span class=\"comment\"># (&#x27;Hello&#x27;, &#x27;World&#x27;)</span></span><br></pre></td></tr></table></figure>\n\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<p><code>Regular Expression</code>，正则表达式，使用表达式的方式对字符串进行匹配的语法规则。</p>\n<h2 id=\"正则表达式语法\"><a href=\"#正则表达式语法\" class=\"headerlink\" title=\"正则表达式语法\"></a>正则表达式语法</h2><p>一个<em>正则表达式</em>指定了一集与之匹配的字符串；模块内的函数可以让你检查某个字符串是否跟给定的正则表达式匹配。</p>\n<p>要看正则写得对不对，可以去<a href=\"https://tool.oschina.net/regex/\">测试网站</a>测试匹配结果。</p>\n<p>首先了解<code>元字符</code>的概念：<em>具有固定含义的特殊符号</em>。</p>\n<p>特殊字符有：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> .    </span><br><span class=\"line\"> (点) 在默认模式，匹配**除了换行的任意字符**。</span><br><span class=\"line\"></span><br><span class=\"line\"> ^    </span><br><span class=\"line\"> (插入符号) 匹配字符串的**开头**。</span><br><span class=\"line\"></span><br><span class=\"line\"> $    </span><br><span class=\"line\"> 匹配**字符串尾或者在字符串尾的换行符的前一个字符**。在 *MULTILINE* 模式下也会匹配换行符之前的文本。</span><br><span class=\"line\"></span><br><span class=\"line\"> *    </span><br><span class=\"line\"> 对它前面的正则式匹配**0到任意次重复**，尽量多的匹配字符串。 ab* 会匹配 a，ab，或者 a 后面跟随任意个 b。</span><br><span class=\"line\"></span><br><span class=\"line\"> +    </span><br><span class=\"line\"> 对它前面的正则式匹配**1到任意次重复**。ab+ 会匹配 a 后面跟随1个以上到任意个 b，它不会匹配 a。</span><br><span class=\"line\"></span><br><span class=\"line\"> ?    </span><br><span class=\"line\"> 对它前面的正则式匹配**0到1次重复**。 ab? 会匹配 a 或者 ab。</span><br><span class=\"line\"></span><br><span class=\"line\"> *?, +?, ??    </span><br><span class=\"line\"> \\*, +，和 ? 修饰符都是 **贪婪的**；它们在字符串进行尽可能多的匹配。如果正则式 &lt;.*&gt; 希望找到 &lt;a&gt; b &lt;c&gt;，它将会匹配整个字符串，而不仅是 &lt;a&gt;。在修饰符之后添加 ? 将使样式以 非贪婪 方式进行匹配； 尽量 **少** 的字符将会被匹配。使用正则式 &lt;.*?&gt; 将会仅仅匹配 &lt;a&gt;。</span><br><span class=\"line\"></span><br><span class=\"line\"> &#123;m&#125;    </span><br><span class=\"line\"> 对其之前的正则式指定匹配 m 个重复；少于 m 的话就会导致匹配失败。比如， a&#123;6&#125; 将匹配6个 a , 但是不能是5个。</span><br><span class=\"line\"></span><br><span class=\"line\"> &#123;m,n&#125;    </span><br><span class=\"line\"> 对正则式进行 m 到 n 次匹配，在 m 和 n 之间取尽量多。 比如，a&#123;3,5&#125; 将匹配 3 到5个 a。忽略 m 意为指定下界为0，忽略 n 指定上界为无限次。比如 a&#123;4,&#125;b 将匹配 aaaab 或者1000个 a 尾随一个 b，但不能匹配 aaab。逗号不能省略，否则无法辨别修饰符应该忽略哪个边界。</span><br><span class=\"line\"></span><br><span class=\"line\"> &#123;m,n&#125;?    </span><br><span class=\"line\"> 前一个修饰符的非贪婪模式，只匹配尽量少的字符次数。比如，对于 aaaaaa， a&#123;3,5&#125; 匹配5个 a ，而 a&#123;3,5&#125;? 只匹配3个 a。</span><br><span class=\"line\"></span><br><span class=\"line\"> \\    </span><br><span class=\"line\"> 转义特殊字符（允许你匹配 &#x27;*&#x27;, &#x27;?&#x27;, 或者此类其他），或者表示一个特殊序列；</span><br><span class=\"line\"></span><br><span class=\"line\"> []</span><br><span class=\"line\"> 用于表示一个字符集合。在一个集合中：</span><br><span class=\"line\">    - 字符可以单独列出，比如 [amk] 匹配 &#x27;a&#x27;， &#x27;m&#x27;， 或者 &#x27;k&#x27;。</span><br><span class=\"line\">    - 可以表示字符范围，通过用 &#x27;-&#x27; 将两个字符连起来。比如 [a-z] 将匹配任何小写ASCII字符， [0-5][0-9] 将匹配从 00 到 59 的两位数字， [0-9A-Fa-f] 将匹配任何十六进制数位。</span><br><span class=\"line\">    - 不在集合范围内的字符可以通过 取反 来进行匹配。如果集合首字符是 &#x27;^&#x27; ，所有 不 在集合内的字符将会被匹配，比如 [^5] 将匹配所有字符，除了 &#x27;5&#x27;， [^^] 将匹配所有字符，除了 &#x27;^&#x27;. ^ 如果不在集合首位，就没有特殊含义。</span><br><span class=\"line\">    - 在集合内要匹配一个字符 &#x27;]&#x27;，有两种方法，要么就在它之前加上反斜杠，要么就把它放到集合首位。比如， [()[\\]&#123;&#125;] 和 []()[&#123;&#125;] 都可以匹配括号。</span><br><span class=\"line\"></span><br><span class=\"line\">|</span><br><span class=\"line\">A|B， A 和 B 可以是任意正则表达式，创建一个正则表达式，匹配 A 或者 B. 任意个正则表达式可以用 &#x27;|&#x27; 连接。它也可以在组合（见下列）内使用。扫描目标字符串时， &#x27;|&#x27; 分隔开的正则样式从左到右进行匹配。当一个样式完全匹配时，这个分支就被接受。意思就是，一旦 A 匹配成功， B 就不再进行匹配，即便它能产生一个更好的匹配。或者说，&#x27;|&#x27; 操作符绝不贪婪。 如果要匹配 &#x27;|&#x27; 字符，使用 \\|， 或者把它包含在字符集里，比如 [|].</span><br><span class=\"line\"></span><br><span class=\"line\">(...)    </span><br><span class=\"line\">（组合），匹配括号内的任意正则表达式，并标识出组合的开始和结尾。匹配完成后，组合的内容可以被获取，并可以在之后用 \\number 转义序列进行再次匹配，之后进行详细说明。要匹配字符 &#x27;(&#x27; 或者 &#x27;)&#x27;, 用 \\( 或 \\), 或者把它们包含在字符集合里: [(], [)].</span><br><span class=\"line\"></span><br><span class=\"line\">\\A</span><br><span class=\"line\">只匹配字符串开始。</span><br><span class=\"line\"> </span><br><span class=\"line\">\\b</span><br><span class=\"line\">匹配空字符串，但只在单词开始或结尾的位置。一个单词被定义为一个单词字符的序列。注意，通常 \\b 定义为 \\w 和 \\W 字符之间，或者 \\w 和字符串开始/结尾的边界， 意思就是 r&#x27;\\bfoo\\b&#x27; 匹配 &#x27;foo&#x27;, &#x27;foo.&#x27;, &#x27;(foo)&#x27;, &#x27;bar foo baz&#x27; 但不匹配 &#x27;foobar&#x27; 或者 &#x27;foo3&#x27;。</span><br><span class=\"line\"></span><br><span class=\"line\">\\B</span><br><span class=\"line\">匹配空字符串，但 不 能在词的开头或者结尾。意思就是 r&#x27;py\\B&#x27; 匹配 &#x27;python&#x27;, &#x27;py3&#x27;, &#x27;py2&#x27;, 但不匹配 &#x27;py&#x27;, &#x27;py.&#x27;, 或者 &#x27;py!&#x27;. \\B 是 \\b 的取非，所以Unicode样式的词语是由Unicode字母，数字或下划线构成的，虽然可以用 ASCII 标志来改变。如果使用了 LOCALE 标志，则词的边界由当前语言区域设置。</span><br><span class=\"line\"></span><br><span class=\"line\">\\d</span><br><span class=\"line\">对于 Unicode (str) 样式：</span><br><span class=\"line\">匹配任何Unicode十进制数（就是在Unicode字符目录[Nd]里的字符）。这包括了 [0-9] ，和很多其他的数字字符。如果设置了 ASCII 标志，就只匹配 [0-9] 。</span><br><span class=\"line\"></span><br><span class=\"line\">对于8位(bytes)样式：</span><br><span class=\"line\">匹配任何十进制数，就是 [0-9]。</span><br><span class=\"line\"></span><br><span class=\"line\">\\D</span><br><span class=\"line\">匹配任何非十进制数字的字符。就是 \\d 取非。 如果设置了 ASCII 标志，就相当于 [^0-9] 。</span><br><span class=\"line\"></span><br><span class=\"line\">\\s</span><br><span class=\"line\">对于 Unicode (str) 样式：</span><br><span class=\"line\">匹配任何Unicode空白字符（包括 [ \\t\\n\\r\\f\\v] ，还有很多其他字符，比如不同语言排版规则约定的不换行空格）。如果 ASCII 被设置，就只匹配 [ \\t\\n\\r\\f\\v] 。</span><br><span class=\"line\"></span><br><span class=\"line\">对于8位(bytes)样式：</span><br><span class=\"line\">匹配ASCII中的空白字符，就是 [ \\t\\n\\r\\f\\v] 。</span><br><span class=\"line\"></span><br><span class=\"line\">\\S</span><br><span class=\"line\">匹配任何非空白字符。就是 \\s 取非。如果设置了 ASCII 标志，就相当于 [^ \\t\\n\\r\\f\\v] 。</span><br><span class=\"line\"></span><br><span class=\"line\">\\w</span><br><span class=\"line\">对于 Unicode (str) 样式：</span><br><span class=\"line\">匹配Unicode词语的字符，包含了可以构成词语的绝大部分字符，也包括数字和下划线。如果设置了 ASCII 标志，就只匹配 [a-zA-Z0-9_] 。</span><br><span class=\"line\"></span><br><span class=\"line\">对于8位(bytes)样式：</span><br><span class=\"line\">匹配ASCII字符中的数字和字母和下划线，就是 [a-zA-Z0-9_] 。如果设置了 LOCALE 标记，就匹配当前语言区域的数字和字母和下划线。</span><br><span class=\"line\"></span><br><span class=\"line\">\\W</span><br><span class=\"line\">匹配非单词字符的字符。这与 \\w 正相反。如果使用了 ASCII 旗标，这就等价于 [^a-zA-Z0-9_]。如果使用了 LOCALE 旗标，则会匹配当前区域中既非字母数字也非下划线的字符。</span><br><span class=\"line\"></span><br><span class=\"line\">\\Z</span><br><span class=\"line\">只匹配字符串尾。</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"模块内容\"><a href=\"#模块内容\" class=\"headerlink\" title=\"模块内容\"></a>模块内容</h2><p>模块定义了几个函数，常量，和一个例外。</p>\n<h3 id=\"re-compile\"><a href=\"#re-compile\" class=\"headerlink\" title=\"re.compile\"></a>re.compile</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">re.<span class=\"built_in\">compile</span>(pattern, flags=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<p><code>re.compile</code>将正则表达式的样式编译为一个 <code>正则表达式对象（正则对象</code>），可以用于匹配，通过这个对象的方法<code> match()</code>, <code>search()</code> 。</p>\n<p>比如：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">prog = re.<span class=\"built_in\">compile</span>(<span class=\"string\">&#x27;^a&#x27;</span>)</span><br><span class=\"line\">result = prog.match(<span class=\"string\">&quot;abcd&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"></span><br><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^a&#x27;</span>, <span class=\"string\">&quot;abcd&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># output</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;re.Match object; span=(0, 1), match=&#x27;a&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;re.Match object; span=(0, 1), match=&#x27;a&#x27;&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>使用 <code>re.compile()</code> 保存正则对象以便复用，可以让程序更加高效。</p>\n<h3 id=\"re-match\"><a href=\"#re-match\" class=\"headerlink\" title=\"re.match\"></a>re.match</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">re.match(pattern, string, flags=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<p>如果 <code>string</code> 开始的0或者多个字符匹配到了正则表达式样式，就返回一个相应的 <code>匹配对象</code> 。 如果没有匹配，就返回 <code>None</code> ；注意它跟零长度匹配是不同的。</p>\n<h3 id=\"re-search\"><a href=\"#re-search\" class=\"headerlink\" title=\"re.search\"></a>re.search</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">re.search(pattern, string, flags=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<p>扫描整个 <code>字符串</code> 找到匹配样式的第一个位置，并返回一个相应的 <code>匹配对象</code> 。如果没有匹配，就返回一个 <code>None</code> ；</p>\n<h3 id=\"re-split\"><a href=\"#re-split\" class=\"headerlink\" title=\"re.split\"></a>re.split</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">re.split(pattern, string, maxsplit=<span class=\"number\">0</span>, flags=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<p>用 <code>pattern</code> 分开 <code>string</code> 。 如果在 <code>pattern</code> 中捕获到括号，那么所有的组里的文字也会包含在列表里。如果 <code>maxsplit</code> 非零， 最多进行 <code>maxsplit</code> 次分隔， 剩下的字符全部返回到列表的最后一个元素。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>re.split(<span class=\"string\">r&#x27;\\W+&#x27;</span>, <span class=\"string\">&#x27;Words, words, words.&#x27;</span>)</span><br><span class=\"line\">[<span class=\"string\">&#x27;Words&#x27;</span>, <span class=\"string\">&#x27;words&#x27;</span>, <span class=\"string\">&#x27;words&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>re.split(<span class=\"string\">r&#x27;(\\W+)&#x27;</span>, <span class=\"string\">&#x27;Words, words, words.&#x27;</span>)</span><br><span class=\"line\">[<span class=\"string\">&#x27;Words&#x27;</span>, <span class=\"string\">&#x27;, &#x27;</span>, <span class=\"string\">&#x27;words&#x27;</span>, <span class=\"string\">&#x27;, &#x27;</span>, <span class=\"string\">&#x27;words&#x27;</span>, <span class=\"string\">&#x27;.&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>re.split(<span class=\"string\">r&#x27;\\W+&#x27;</span>, <span class=\"string\">&#x27;Words, words, words.&#x27;</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">[<span class=\"string\">&#x27;Words&#x27;</span>, <span class=\"string\">&#x27;words, words.&#x27;</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>re.split(<span class=\"string\">&#x27;[a-f]+&#x27;</span>, <span class=\"string\">&#x27;0a3B9&#x27;</span>, flags=re.IGNORECASE)</span><br><span class=\"line\">[<span class=\"string\">&#x27;0&#x27;</span>, <span class=\"string\">&#x27;3&#x27;</span>, <span class=\"string\">&#x27;9&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"re-findall\"><a href=\"#re-findall\" class=\"headerlink\" title=\"re.findall\"></a>re.findall</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">re.findall(pattern, string, flags=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<p>对 <code>string</code> 返回一个不重复的 <code>pattern</code> 的匹配列表， <code>string</code> 从左到右进行扫描，匹配按找到的顺序返回。如果样式里存在一到多个组，就返回一个组合列表；就是一个元组的列表（如果样式里有超过一个组合的话）。空匹配也会包含在结果里。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">partern = re.<span class=\"built_in\">compile</span>(<span class=\"string\">r&quot;\\d+&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">res = partern.findall(<span class=\"string\">&quot;我的电话号码是1760718283，你的电话是110吗？&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(res)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># [&#x27;1760718283&#x27;, &#x27;110&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"re-finditer\"><a href=\"#re-finditer\" class=\"headerlink\" title=\"re.finditer\"></a>re.finditer</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">re.finditer(pattern, string, flags=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<p><code>pattern</code> 在 <code>string</code> 里所有的非重复匹配，返回为一个迭代器 <code>iterator</code> 保存了 匹配对象 。 string 从左到右扫描，匹配按顺序排列。空匹配也包含在结果里。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">partern = re.<span class=\"built_in\">compile</span>(<span class=\"string\">r&quot;\\d+&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">res = partern.finditer(<span class=\"string\">&quot;我的电话号码是1760718283，你的电话是110吗？&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> res:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(item.group())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># output</span></span><br><span class=\"line\"><span class=\"comment\"># 1760718283</span></span><br><span class=\"line\"><span class=\"comment\"># 110</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"匹配对象\"><a href=\"#匹配对象\" class=\"headerlink\" title=\"匹配对象\"></a>匹配对象</h2><p>匹配对象总是有一个布尔值 <code>True</code>。如果没有匹配的话 <code>match()</code> 和 <code>search()</code> 返回 <code>None</code> 所以你可以简单的用 <code>if</code> 语句来判断是否匹配</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">match = re.search(pattern, string)</span><br><span class=\"line\"><span class=\"keyword\">if</span> match:</span><br><span class=\"line\">    process(match)</span><br></pre></td></tr></table></figure>\n\n<p>匹配对象支持以下方法和属性：</p>\n<h3 id=\"Match-group\"><a href=\"#Match-group\" class=\"headerlink\" title=\"Match.group\"></a>Match.group</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Match.group([group1, ...])</span><br></pre></td></tr></table></figure>\n\n<p>返回一个或者多个匹配的子组。如果只有一个参数，结果就是一个字符串，如果有多个参数，结果就是一个元组（每个参数对应一个项），如果没有参数，组1默认到0（整个匹配都被返回）。如果一个组N 参数值为 0，相应的返回值就是整个匹配字符串；如果它是一个范围 [1..99]，结果就是相应的括号组字符串。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">match = re.match(<span class=\"string\">r&quot;(\\w+) (\\w+)&quot;</span>, <span class=\"string\">&quot;Hello World, heyhey!&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(match)    <span class=\"comment\"># &lt;re.Match object; span=(0, 11), match=&#x27;Hello World&#x27;&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(match.group())   <span class=\"comment\"># Hello World</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(match.group(<span class=\"number\">0</span>))   <span class=\"comment\"># Hello World</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(match.group(<span class=\"number\">1</span>))   <span class=\"comment\"># Hello</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(match.group(<span class=\"number\">2</span>))   <span class=\"comment\"># World</span></span><br></pre></td></tr></table></figure>\n\n<p>如果正则表达式使用了 <code>(?P&lt;name&gt;…)</code> 语法， <code>groupN</code> 参数就也可能是命名组合的名字。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m = re.match(<span class=\"string\">r&quot;(?P&lt;first_name&gt;\\w+) (?P&lt;last_name&gt;\\w+)&quot;</span>, <span class=\"string\">&quot;Malcolm Reynolds&quot;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m.group(<span class=\"string\">&#x27;first_name&#x27;</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;Malcolm&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m.group(<span class=\"string\">&#x27;last_name&#x27;</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;Reynolds&#x27;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>命名组合同样可以通过索引值引用。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m.group(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;Malcolm&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m.group(<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;Reynolds&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果一个组匹配成功多次，就只返回最后一个匹配。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m = re.match(<span class=\"string\">r&quot;(..)+&quot;</span>, <span class=\"string\">&quot;a1b2c3&quot;</span>)  <span class=\"comment\"># Matches 3 times.</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>m.group(<span class=\"number\">1</span>)                        <span class=\"comment\"># Returns only the last match.</span></span><br><span class=\"line\"><span class=\"string\">&#x27;c3&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Match-groups\"><a href=\"#Match-groups\" class=\"headerlink\" title=\"Match.groups\"></a>Match.groups</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Match.groups(default=<span class=\"literal\">None</span>)</span><br></pre></td></tr></table></figure>\n\n<p>返回一个元组，包含所有匹配的子组，在样式中出现的从1到任意多的组合。 <code>default</code> 参数用于不参与匹配的情况，默认为 <code>None</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">match = re.match(<span class=\"string\">r&quot;(\\w+) (\\w+)&quot;</span>, <span class=\"string\">&quot;Hello World, heyhey!&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(match)    <span class=\"comment\"># &lt;re.Match object; span=(0, 11), match=&#x27;Hello World&#x27;&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(match.groups())   <span class=\"comment\"># (&#x27;Hello&#x27;, &#x27;World&#x27;)</span></span><br></pre></td></tr></table></figure>\n\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n\n"},{"title":"scrapy框架介绍","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-29T10:13:04.000Z","pic":null,"_content":"\n## Scrapy介绍\n\n`Scrapy`是一个基于`Twisted`的异步处理框架，是纯`Python`实现的爬虫框架，其架构清晰，模块之间的耦合程度低，可扩展性极强，可以灵活完成各种需求。只需要定制开发几个模块就可以轻松实现一个爬虫。\n\n首先来看下`Scrapy`框架的架构，如图所示：\n\n![](Screenshot_1.webp)\n\n它可以分为如下的几个部分。\n\n- `Engine（引擎）`：用来处理整个系统的数据流处理、触发事务，是整个框架的核心。\n- `Item（项目）`：定义了爬取结果的数据结构，爬取的数据会被赋值成该对象。\n- `Scheduler（调度器）`：用来接受引擎发过来的请求并加入队列中，并在引擎再次请求的时候提供给引擎。\n- `Downloader（下载器）`：用于下载网页内容，并将网页内容返回给蜘蛛。\n- `Spiders（蜘蛛）`：其内定义了爬取的逻辑和网页的解析规则，它主要负责解析响应并生成提取结果和新的请求。\n- `ItemPipeline（项目管道）`：负责处理由蜘蛛从网页中抽取的项目，它的主要任务是清洗、验证和存储数据。\n- `Downloader Middlewares（下载器中间件）`：位于引擎和下载器之间的钩子框架，主要是处理引擎与下载器之间的请求及响应。\n- `Spider Middlewares（蜘蛛中间件）`：位于引擎和蜘蛛之间的钩子框架，主要工作是处理蜘蛛输入的响应和输出的结果及新的请求。\n\n## 数据流\n\n了解了架构，就是要了解它是怎么进行数据爬取和处理的，所以接下来介绍`Scrapy`的数据流机制。\n\n`Scrapy`中的数据流由引擎控制，其过程如下：\n\n- `Engine`首先打开一个网站，找到处理该网站的`Spider`并向该`Spider`请求第一个要爬虫的`URL`。\n- `Engine`从`Spider`中获取到第一个要爬取的`URL`并通过`Scheduler`以`Request`的形式调度。\n- `Engine`向`Scheduler`请求下一个要爬取的`URL`。\n- `Scheduler`返回下一个要爬取的`URL`给`Engine`，`Engine`将`URL`通过`Downloader Middlewares`转发给`Downloader`下载。\n- 一旦页面下载完毕， `Downloader`生成一个该页面的`Response`，并将其通过`Downloader Middlewares`发送给`Engine`。\n- `Engine`从下载器中接收到`Response`并通过`Spider Middlewares`发送给`Spider`处理。\n- `Spider`处理`Response`并返回爬取到的`Item`及新的`Request`给`Engine`。\n- `Engine`将`Spider`返回的`Item`给`ItemPipeline`，将新的`Request`给`Scheduler`。\n- 重复第二步到最后一步，直到`Scheduler`中没有更多的`Request`，`Engine`关闭该网站，爬取结束。\n\n通过多个组件的相互协作、不同组件完成工作的不同、组件对异步处理的支持，`Scrapy`最大限度地利用了网络带宽，大大提高了 数据爬取和处理的效率。\n\n## 安装\n\n使用官方文档推荐的方式安装就可以了：\n\n```python\npip install scrapy\n```\n\n## 项目结构\n\n安装完成后，就可以使用`Scrapy`预先配置好的很多可用的组件和编写爬虫时所用的脚手架。\n\n创建项目的命令如下：\n\n```python\nscrapy startproject demo\n```\n\n执行完成之后，在当前运行目录下便会出现一个文件夹，叫作`demo`，这就是一个`Scrapy`项目框架，可以基于这个项目框架来编写爬虫。\n\n项目文件结构如下所示：\n\n```python\nscrapy.cfg \nproject/ \n  __init__.py\n  items.py \n  pipelines.py \n  settings.py \n  middlewares.py \n  spiders/\n    __init__.py\n    spider1.py\n    spider2.py\n    ...\n```\n\n在此要将各个文件的功能描述如下：\n\n- `scrapy.cfg`：它是`Scrapy`项目的配置文件，其内定义了项目的配置文件路径、部署相关信息等内容。\n- `items.py`：它定义`Item`数据结构，所有的`Item`的定义都可以放这里。\n- `pipelines.py`：它定义`ItemPipeline`的实现，所有的`ItemPipeline`的实现都可以放这里。\n- `settings.py`：它定义项目的全局配置。\n- `middlewares.py`：它定义`Spider Middlewares`和`Downloader Middlewares`的实现。\n- `spiders`：其内包含一个个`Spider`的实现，每个`Spider`都有一个文件。\n\n","source":"_posts/scrapy框架介绍.md","raw":"---\ntitle: scrapy框架介绍\ntags:\n  - scrapy\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-29 18:13:04\ncategories: 爬虫\npic:\n---\n\n## Scrapy介绍\n\n`Scrapy`是一个基于`Twisted`的异步处理框架，是纯`Python`实现的爬虫框架，其架构清晰，模块之间的耦合程度低，可扩展性极强，可以灵活完成各种需求。只需要定制开发几个模块就可以轻松实现一个爬虫。\n\n首先来看下`Scrapy`框架的架构，如图所示：\n\n![](Screenshot_1.webp)\n\n它可以分为如下的几个部分。\n\n- `Engine（引擎）`：用来处理整个系统的数据流处理、触发事务，是整个框架的核心。\n- `Item（项目）`：定义了爬取结果的数据结构，爬取的数据会被赋值成该对象。\n- `Scheduler（调度器）`：用来接受引擎发过来的请求并加入队列中，并在引擎再次请求的时候提供给引擎。\n- `Downloader（下载器）`：用于下载网页内容，并将网页内容返回给蜘蛛。\n- `Spiders（蜘蛛）`：其内定义了爬取的逻辑和网页的解析规则，它主要负责解析响应并生成提取结果和新的请求。\n- `ItemPipeline（项目管道）`：负责处理由蜘蛛从网页中抽取的项目，它的主要任务是清洗、验证和存储数据。\n- `Downloader Middlewares（下载器中间件）`：位于引擎和下载器之间的钩子框架，主要是处理引擎与下载器之间的请求及响应。\n- `Spider Middlewares（蜘蛛中间件）`：位于引擎和蜘蛛之间的钩子框架，主要工作是处理蜘蛛输入的响应和输出的结果及新的请求。\n\n## 数据流\n\n了解了架构，就是要了解它是怎么进行数据爬取和处理的，所以接下来介绍`Scrapy`的数据流机制。\n\n`Scrapy`中的数据流由引擎控制，其过程如下：\n\n- `Engine`首先打开一个网站，找到处理该网站的`Spider`并向该`Spider`请求第一个要爬虫的`URL`。\n- `Engine`从`Spider`中获取到第一个要爬取的`URL`并通过`Scheduler`以`Request`的形式调度。\n- `Engine`向`Scheduler`请求下一个要爬取的`URL`。\n- `Scheduler`返回下一个要爬取的`URL`给`Engine`，`Engine`将`URL`通过`Downloader Middlewares`转发给`Downloader`下载。\n- 一旦页面下载完毕， `Downloader`生成一个该页面的`Response`，并将其通过`Downloader Middlewares`发送给`Engine`。\n- `Engine`从下载器中接收到`Response`并通过`Spider Middlewares`发送给`Spider`处理。\n- `Spider`处理`Response`并返回爬取到的`Item`及新的`Request`给`Engine`。\n- `Engine`将`Spider`返回的`Item`给`ItemPipeline`，将新的`Request`给`Scheduler`。\n- 重复第二步到最后一步，直到`Scheduler`中没有更多的`Request`，`Engine`关闭该网站，爬取结束。\n\n通过多个组件的相互协作、不同组件完成工作的不同、组件对异步处理的支持，`Scrapy`最大限度地利用了网络带宽，大大提高了 数据爬取和处理的效率。\n\n## 安装\n\n使用官方文档推荐的方式安装就可以了：\n\n```python\npip install scrapy\n```\n\n## 项目结构\n\n安装完成后，就可以使用`Scrapy`预先配置好的很多可用的组件和编写爬虫时所用的脚手架。\n\n创建项目的命令如下：\n\n```python\nscrapy startproject demo\n```\n\n执行完成之后，在当前运行目录下便会出现一个文件夹，叫作`demo`，这就是一个`Scrapy`项目框架，可以基于这个项目框架来编写爬虫。\n\n项目文件结构如下所示：\n\n```python\nscrapy.cfg \nproject/ \n  __init__.py\n  items.py \n  pipelines.py \n  settings.py \n  middlewares.py \n  spiders/\n    __init__.py\n    spider1.py\n    spider2.py\n    ...\n```\n\n在此要将各个文件的功能描述如下：\n\n- `scrapy.cfg`：它是`Scrapy`项目的配置文件，其内定义了项目的配置文件路径、部署相关信息等内容。\n- `items.py`：它定义`Item`数据结构，所有的`Item`的定义都可以放这里。\n- `pipelines.py`：它定义`ItemPipeline`的实现，所有的`ItemPipeline`的实现都可以放这里。\n- `settings.py`：它定义项目的全局配置。\n- `middlewares.py`：它定义`Spider Middlewares`和`Downloader Middlewares`的实现。\n- `spiders`：其内包含一个个`Spider`的实现，每个`Spider`都有一个文件。\n\n","slug":"scrapy框架介绍","published":1,"updated":"2021-06-15T03:24:11.518Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2n002k44udb8h68u35","content":"<h2 id=\"Scrapy介绍\"><a href=\"#Scrapy介绍\" class=\"headerlink\" title=\"Scrapy介绍\"></a>Scrapy介绍</h2><p><code>Scrapy</code>是一个基于<code>Twisted</code>的异步处理框架，是纯<code>Python</code>实现的爬虫框架，其架构清晰，模块之间的耦合程度低，可扩展性极强，可以灵活完成各种需求。只需要定制开发几个模块就可以轻松实现一个爬虫。</p>\n<p>首先来看下<code>Scrapy</code>框架的架构，如图所示：</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>它可以分为如下的几个部分。</p>\n<ul>\n<li><code>Engine（引擎）</code>：用来处理整个系统的数据流处理、触发事务，是整个框架的核心。</li>\n<li><code>Item（项目）</code>：定义了爬取结果的数据结构，爬取的数据会被赋值成该对象。</li>\n<li><code>Scheduler（调度器）</code>：用来接受引擎发过来的请求并加入队列中，并在引擎再次请求的时候提供给引擎。</li>\n<li><code>Downloader（下载器）</code>：用于下载网页内容，并将网页内容返回给蜘蛛。</li>\n<li><code>Spiders（蜘蛛）</code>：其内定义了爬取的逻辑和网页的解析规则，它主要负责解析响应并生成提取结果和新的请求。</li>\n<li><code>ItemPipeline（项目管道）</code>：负责处理由蜘蛛从网页中抽取的项目，它的主要任务是清洗、验证和存储数据。</li>\n<li><code>Downloader Middlewares（下载器中间件）</code>：位于引擎和下载器之间的钩子框架，主要是处理引擎与下载器之间的请求及响应。</li>\n<li><code>Spider Middlewares（蜘蛛中间件）</code>：位于引擎和蜘蛛之间的钩子框架，主要工作是处理蜘蛛输入的响应和输出的结果及新的请求。</li>\n</ul>\n<h2 id=\"数据流\"><a href=\"#数据流\" class=\"headerlink\" title=\"数据流\"></a>数据流</h2><p>了解了架构，就是要了解它是怎么进行数据爬取和处理的，所以接下来介绍<code>Scrapy</code>的数据流机制。</p>\n<p><code>Scrapy</code>中的数据流由引擎控制，其过程如下：</p>\n<ul>\n<li><code>Engine</code>首先打开一个网站，找到处理该网站的<code>Spider</code>并向该<code>Spider</code>请求第一个要爬虫的<code>URL</code>。</li>\n<li><code>Engine</code>从<code>Spider</code>中获取到第一个要爬取的<code>URL</code>并通过<code>Scheduler</code>以<code>Request</code>的形式调度。</li>\n<li><code>Engine</code>向<code>Scheduler</code>请求下一个要爬取的<code>URL</code>。</li>\n<li><code>Scheduler</code>返回下一个要爬取的<code>URL</code>给<code>Engine</code>，<code>Engine</code>将<code>URL</code>通过<code>Downloader Middlewares</code>转发给<code>Downloader</code>下载。</li>\n<li>一旦页面下载完毕， <code>Downloader</code>生成一个该页面的<code>Response</code>，并将其通过<code>Downloader Middlewares</code>发送给<code>Engine</code>。</li>\n<li><code>Engine</code>从下载器中接收到<code>Response</code>并通过<code>Spider Middlewares</code>发送给<code>Spider</code>处理。</li>\n<li><code>Spider</code>处理<code>Response</code>并返回爬取到的<code>Item</code>及新的<code>Request</code>给<code>Engine</code>。</li>\n<li><code>Engine</code>将<code>Spider</code>返回的<code>Item</code>给<code>ItemPipeline</code>，将新的<code>Request</code>给<code>Scheduler</code>。</li>\n<li>重复第二步到最后一步，直到<code>Scheduler</code>中没有更多的<code>Request</code>，<code>Engine</code>关闭该网站，爬取结束。</li>\n</ul>\n<p>通过多个组件的相互协作、不同组件完成工作的不同、组件对异步处理的支持，<code>Scrapy</code>最大限度地利用了网络带宽，大大提高了 数据爬取和处理的效率。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>使用官方文档推荐的方式安装就可以了：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install scrapy</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"项目结构\"><a href=\"#项目结构\" class=\"headerlink\" title=\"项目结构\"></a>项目结构</h2><p>安装完成后，就可以使用<code>Scrapy</code>预先配置好的很多可用的组件和编写爬虫时所用的脚手架。</p>\n<p>创建项目的命令如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy startproject demo</span><br></pre></td></tr></table></figure>\n\n<p>执行完成之后，在当前运行目录下便会出现一个文件夹，叫作<code>demo</code>，这就是一个<code>Scrapy</code>项目框架，可以基于这个项目框架来编写爬虫。</p>\n<p>项目文件结构如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy.cfg </span><br><span class=\"line\">project/ </span><br><span class=\"line\">  __init__.py</span><br><span class=\"line\">  items.py </span><br><span class=\"line\">  pipelines.py </span><br><span class=\"line\">  settings.py </span><br><span class=\"line\">  middlewares.py </span><br><span class=\"line\">  spiders/</span><br><span class=\"line\">    __init__.py</span><br><span class=\"line\">    spider1.py</span><br><span class=\"line\">    spider2.py</span><br><span class=\"line\">    ...</span><br></pre></td></tr></table></figure>\n\n<p>在此要将各个文件的功能描述如下：</p>\n<ul>\n<li><code>scrapy.cfg</code>：它是<code>Scrapy</code>项目的配置文件，其内定义了项目的配置文件路径、部署相关信息等内容。</li>\n<li><code>items.py</code>：它定义<code>Item</code>数据结构，所有的<code>Item</code>的定义都可以放这里。</li>\n<li><code>pipelines.py</code>：它定义<code>ItemPipeline</code>的实现，所有的<code>ItemPipeline</code>的实现都可以放这里。</li>\n<li><code>settings.py</code>：它定义项目的全局配置。</li>\n<li><code>middlewares.py</code>：它定义<code>Spider Middlewares</code>和<code>Downloader Middlewares</code>的实现。</li>\n<li><code>spiders</code>：其内包含一个个<code>Spider</code>的实现，每个<code>Spider</code>都有一个文件。</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Scrapy介绍\"><a href=\"#Scrapy介绍\" class=\"headerlink\" title=\"Scrapy介绍\"></a>Scrapy介绍</h2><p><code>Scrapy</code>是一个基于<code>Twisted</code>的异步处理框架，是纯<code>Python</code>实现的爬虫框架，其架构清晰，模块之间的耦合程度低，可扩展性极强，可以灵活完成各种需求。只需要定制开发几个模块就可以轻松实现一个爬虫。</p>\n<p>首先来看下<code>Scrapy</code>框架的架构，如图所示：</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>它可以分为如下的几个部分。</p>\n<ul>\n<li><code>Engine（引擎）</code>：用来处理整个系统的数据流处理、触发事务，是整个框架的核心。</li>\n<li><code>Item（项目）</code>：定义了爬取结果的数据结构，爬取的数据会被赋值成该对象。</li>\n<li><code>Scheduler（调度器）</code>：用来接受引擎发过来的请求并加入队列中，并在引擎再次请求的时候提供给引擎。</li>\n<li><code>Downloader（下载器）</code>：用于下载网页内容，并将网页内容返回给蜘蛛。</li>\n<li><code>Spiders（蜘蛛）</code>：其内定义了爬取的逻辑和网页的解析规则，它主要负责解析响应并生成提取结果和新的请求。</li>\n<li><code>ItemPipeline（项目管道）</code>：负责处理由蜘蛛从网页中抽取的项目，它的主要任务是清洗、验证和存储数据。</li>\n<li><code>Downloader Middlewares（下载器中间件）</code>：位于引擎和下载器之间的钩子框架，主要是处理引擎与下载器之间的请求及响应。</li>\n<li><code>Spider Middlewares（蜘蛛中间件）</code>：位于引擎和蜘蛛之间的钩子框架，主要工作是处理蜘蛛输入的响应和输出的结果及新的请求。</li>\n</ul>\n<h2 id=\"数据流\"><a href=\"#数据流\" class=\"headerlink\" title=\"数据流\"></a>数据流</h2><p>了解了架构，就是要了解它是怎么进行数据爬取和处理的，所以接下来介绍<code>Scrapy</code>的数据流机制。</p>\n<p><code>Scrapy</code>中的数据流由引擎控制，其过程如下：</p>\n<ul>\n<li><code>Engine</code>首先打开一个网站，找到处理该网站的<code>Spider</code>并向该<code>Spider</code>请求第一个要爬虫的<code>URL</code>。</li>\n<li><code>Engine</code>从<code>Spider</code>中获取到第一个要爬取的<code>URL</code>并通过<code>Scheduler</code>以<code>Request</code>的形式调度。</li>\n<li><code>Engine</code>向<code>Scheduler</code>请求下一个要爬取的<code>URL</code>。</li>\n<li><code>Scheduler</code>返回下一个要爬取的<code>URL</code>给<code>Engine</code>，<code>Engine</code>将<code>URL</code>通过<code>Downloader Middlewares</code>转发给<code>Downloader</code>下载。</li>\n<li>一旦页面下载完毕， <code>Downloader</code>生成一个该页面的<code>Response</code>，并将其通过<code>Downloader Middlewares</code>发送给<code>Engine</code>。</li>\n<li><code>Engine</code>从下载器中接收到<code>Response</code>并通过<code>Spider Middlewares</code>发送给<code>Spider</code>处理。</li>\n<li><code>Spider</code>处理<code>Response</code>并返回爬取到的<code>Item</code>及新的<code>Request</code>给<code>Engine</code>。</li>\n<li><code>Engine</code>将<code>Spider</code>返回的<code>Item</code>给<code>ItemPipeline</code>，将新的<code>Request</code>给<code>Scheduler</code>。</li>\n<li>重复第二步到最后一步，直到<code>Scheduler</code>中没有更多的<code>Request</code>，<code>Engine</code>关闭该网站，爬取结束。</li>\n</ul>\n<p>通过多个组件的相互协作、不同组件完成工作的不同、组件对异步处理的支持，<code>Scrapy</code>最大限度地利用了网络带宽，大大提高了 数据爬取和处理的效率。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>使用官方文档推荐的方式安装就可以了：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install scrapy</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"项目结构\"><a href=\"#项目结构\" class=\"headerlink\" title=\"项目结构\"></a>项目结构</h2><p>安装完成后，就可以使用<code>Scrapy</code>预先配置好的很多可用的组件和编写爬虫时所用的脚手架。</p>\n<p>创建项目的命令如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy startproject demo</span><br></pre></td></tr></table></figure>\n\n<p>执行完成之后，在当前运行目录下便会出现一个文件夹，叫作<code>demo</code>，这就是一个<code>Scrapy</code>项目框架，可以基于这个项目框架来编写爬虫。</p>\n<p>项目文件结构如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy.cfg </span><br><span class=\"line\">project/ </span><br><span class=\"line\">  __init__.py</span><br><span class=\"line\">  items.py </span><br><span class=\"line\">  pipelines.py </span><br><span class=\"line\">  settings.py </span><br><span class=\"line\">  middlewares.py </span><br><span class=\"line\">  spiders/</span><br><span class=\"line\">    __init__.py</span><br><span class=\"line\">    spider1.py</span><br><span class=\"line\">    spider2.py</span><br><span class=\"line\">    ...</span><br></pre></td></tr></table></figure>\n\n<p>在此要将各个文件的功能描述如下：</p>\n<ul>\n<li><code>scrapy.cfg</code>：它是<code>Scrapy</code>项目的配置文件，其内定义了项目的配置文件路径、部署相关信息等内容。</li>\n<li><code>items.py</code>：它定义<code>Item</code>数据结构，所有的<code>Item</code>的定义都可以放这里。</li>\n<li><code>pipelines.py</code>：它定义<code>ItemPipeline</code>的实现，所有的<code>ItemPipeline</code>的实现都可以放这里。</li>\n<li><code>settings.py</code>：它定义项目的全局配置。</li>\n<li><code>middlewares.py</code>：它定义<code>Spider Middlewares</code>和<code>Downloader Middlewares</code>的实现。</li>\n<li><code>spiders</code>：其内包含一个个<code>Spider</code>的实现，每个<code>Spider</code>都有一个文件。</li>\n</ul>\n"},{"title":"scrapy的基本使用","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-29T14:49:55.000Z","pic":null,"_content":"\n## 抓取目标\n\n要完成的任务如下。\n\n- 创建一个`Scrapy`项目。\n- 创建一个`Spider`来抓取站点和处理数据。\n- 通过命令行将抓取的内容导出。\n- 将抓取的内容保存到`MongoDB`数据库。\n\n抓取的目标站点为[](http://quotes.toscrape.com/)。\n\n## 准备工作\n\n安装好`scrapy`框架、`MongoDB`和`PyMongo`库。\n\n## 创建项目\n\n创建一个`Scrapy`项目，项目文件可以直接用`Scrapy`命令生成，命令如下所示：\n\n```python\nscrapy startproject tutorial\n```\n\n这个命令将会创建一个名为`tutorial`的文件夹，文件夹结构如下所示：\n\n```python\nscrapy.cfg    # Scrapy 部署时的配置文件 \ntutorial    # 项目的模块，引入的时候需要从这里引入 \n  __init__.py \n  items.py    # Items 的定义，定义爬取的数据结构 \n  middlewares.py     # Middlewares 的定义，定义爬取时的中间件 \n  pipelines.py    # Pipelines 的定义，定义数据管道 \n  settings.py     # 配置文件 \n  spiders     # 放置 Spiders 的文件夹 \n    __init__.py\n```\n\n## 创建Spider\n\n`Spider`是自己定义的类，`Scrapy`用它从网页里抓取内容，并解析抓取的结果。不过这个类必须继承`Scrapy`提供的`Spider`类`scrapy.Spider`，还要定义`Spider`的名称和起始请求，以及怎样处理爬取后的结果的方法。\n\n也可以使用命令行创建一个`Spider`。比如要生成`Quotes`这个`Spider`，可以执行如下命令：\n\n```python\n>>> scrapy genspider quotes quotes.toscrape.com     \nCreated spider 'quotes' using template 'basic' in module:\n  tutorial.spiders.quotes\n```\n\n进入刚才创建的`tutorial`文件夹，然后执行`genspider`命令。第一个参数是`Spider`的名称，第二个参数是`网站域名`。执行完毕之后，`spiders`文件夹中多了一个`quotes.py`，它就是刚刚创建的`Spider`，内容如下所示：\n\n```python\nimport scrapy\n\nclass QuotesSpider(scrapy.Spider):\n    name = 'quotes'\n    allowed_domains = ['quotes.toscrape.com']\n    start_urls = ['http://quotes.toscrape.com/']\n\n    def parse(self, response):\n        pass\n```\n\n这里有三个属性——`name`、`allowed_domains`和`start_urls`，还有一个方法`parse`。\n\n- `name`：它是每个项目唯一的名字，用来区分不同的`Spider`。\n- `allowed_domains`：它是允许爬取的域名，如果初始或后续的请求链接不是这个域名下的，则请求链接会被过滤掉。\n- `start_urls`：它包含了`Spider`在启动时爬取的`url`列表，初始请求是由它来定义的。\n- `parse`：它是`Spider`的一个方法。默认情况下，被调用时`start_urls`里面的链接构成的请求完成下载执行后，返回的响应就会作为唯一的参数传递给这个函数。该方法负责解析返回的响应、提取数据或者进一 步生成要处理的请求。\n\n## 创建Item\n\n`Item`是保存爬虫数据的容器，它的使用方法和字典类似，不过相比字典，`Item`多了额外的保护机制，可以避免拼写错误或者定义字段错误。\n\n创建`Item`需要继承`scrapy.Item`类，并且定义类型为`scrapy.Field`的字段。观察目标网站，可以获取到的内容有`text`、`author`、`tags`。\n\n定义`Item`，此时将`items.py`修改如下：\n\n```python\nimport scrapy\n\nclass QuoteItem(scrapy.Item):\n    # define the fields for your item here like:\n    # name = scrapy.Field()\n    text = scrapy.Field()\n    author = scrapy.Field()\n    tags = scrapy.Field()\n```\n\n这里定义了三个字段，将类的名称修改为`QuoteItem`，接下来爬取时会使用到这个`Item`。\n\n## 解析Response\n\n`parse`方法的参数`response`是`start_urls`里面的链接爬取后的结果。所以在`parse`方法中，可以直接对`response`变量包含的内容进行解析，比如浏览请求结果的网页源代码，或者进一步分析源代码内容，或者找出结果中的链接而得到下一个请求。\n\n首先看看网页结构，如图所示。每一页都有多个`class`为`quote`的区块，每个区块内都包含`text`、`author`、`tags`。那么先找出所有的`quote`，然后提取每一个`quote`中的内容。\n\n![](Screenshot_1.webp)\n\n提取的方式可以是`CSS`选择器或`XPath`选择器。在这里使用`CSS`选择器进行选择，`parse`方法的改写如下所示：\n\n```python\nclass QuotesSpider(scrapy.Spider):\n    name = 'quotes'\n    allowed_domains = ['http://quotes.toscrape.com/']\n    start_urls = ['http://http://quotes.toscrape.com//']\n\n    def parse(self, response):\n        quotes = response.css('.quote')\n        for quote in quotes:\n            text = quote.css('.text::text').extract_first()\n            author = quote.css('.author::text').extract_first()\n            tags = quote.css('.tags .tag::text').extract()\n```\n\n对于`text`，获取结果的第一个元素即可，所以使用`extract_first`方法，对于`tags`，要获取所有结果组成的列表，所以使用`extract`方法。\n\n## 使用Item\n\n上文定义了`Item`，接下来就要使用它了。`Item`可以理解为一个字典，不过在声明的时候需要实例化。然后依次用刚才解析的结果赋值`Item`的每一个字段，最后将`Item`返回即可。\n\n`QuotesSpider`的改写如下所示：\n\n```python\n    def parse(self, response):\n        quotes = response.css('.quote')\n        for quote in quotes:\n            item = QuoteItem()\n            item['text'] = quote.css('.text::text').extract_first()\n            item['author'] = quote.css('.author::text').extract_first()\n            item['tags'] = quote.css('.tags .tag::text').extract()\n            yield item\n```\n\n如此一来，首页的所有内容被解析出来，并被赋值成了一个个`QuoteItem`。\n\n## 后续Request\n\n接下来就需要从当前页面中找到信息来生成下一个请求，然后在下一个请求的页面里面找到信息再构造下一个请求。这样循环往复迭代，从而实现整站的爬取。\n\n将刚才的页面拉到最底部，如图所示。\n\n![](Screenshot_2.webp)\n\n有一个`Next`按钮，查看一下源代码，可以发现它的链接是`/page/2/`，实际上全链接就是：`http://quotes.toscrape.com/page/2`，通过这个链接我们就可以构造下一个请求。\n\n构造请求时需要用到`scrapy.Request`。这里传递两个参数——`url`和`callback`，这两个参数的说明如下。\n\n- `url`：它是请求链接。\n- `callback`：它是回调函数。当指定了该回调函数的请求完成之后，获取到响应，引擎会将该响应作为参数传递给这个回调函数。回调函数进行解析或生成下一个请求，回调函数如上文的`parse()`所示。\n\n由于`parse`就是解析`text`、`author`、`tags`的方法，而下一页的结构和刚才已经解析的页面结构是一样的，所以可以再次使用`parse`方法来做页面解析。\n\n接下来要做的就是利用选择器得到下一页链接并生成请求，在`parse`方法后追加如下的代码：\n\n```python\nnext = response.css('.pager .next a::attr(href)').extract_first()\nurl = response.urljoin(next)\nyield scrapy.Request(url=url, callback=self.parse, dont_filter=True)\n```\n\n第一句代码首先通过`CSS`选择器获取下一个页面的链接，即要获取`a`超链接中的`href`属性。这里用到了`::attr(href)`操作。然后再调用`extract_first`方法获取内容。\n\n第二句代码调用了`urljoin`方法，`urljoin()`方法可以将相对`URL`构造成一个绝对的`URL`。例如，获取到的下一页地址是`/page/2`，`urljoin`方法处理后得到的结果就是：`http://quotes.toscrape.com/page/2/`。\n\n第三句代码通过`url`和`callback`变量构造了一个新的请求，回调函数`callback`依然使用`parse`方法。这个请求完成后，响应会重新经过`parse`方法处理，得到第二页的解析结果，然后生成第二页的下一页，也就是第三页的请求。这样爬虫就进入了一个循环，直到最后一页。`dont_filter`设置为`Ture`不进行域名过滤，这样就能继续爬取。\n\n通过几行代码，就轻松实现了一个抓取循环，将每个页面的结果抓取下来了。现在，改写之后的整个`Spider`类如下所示：\n\n```python\nimport scrapy\nfrom tutorial.items import QuoteItem\n\n\nclass QuotesSpider(scrapy.Spider):\n    name = 'quotes'\n    allowed_domains = ['quotes.toscrape.com/']\n    start_urls = ['http://quotes.toscrape.com/']\n\n    def parse(self, response):\n        quotes = response.css('.quote')\n        for quote in quotes:\n            item = QuoteItem()\n            item['text'] = quote.css('.text::text').extract_first()\n            item['author'] = quote.css('.author::text').extract_first()\n            item['tags'] = quote.css('.tags .tag::text').extract()\n            yield item\n\n        next = response.css('.pager .next a::attr(href)').extract_first()\n        if next !== \"\":\n          url = response.urljoin(next)\n          yield scrapy.Request(url=url, callback=self.parse, dont_filter=True)\n```\n\n## 运行\n\n进入目录，运行如下命令：\n\n```python\nscrapy crawl quotes\n```\n\n爬虫一边解析，一边翻页，直至将所有内容抓取完毕，然后终止。\n\n最后，`Scrapy`输出了整个抓取过程的统计信息，如请求的字节数、请求次数、响应次数、完成原因等。\n\n## 保存到文件\n\n`Scrapy`提供的`Feed Exports`可以轻松将抓取结果输出。例如，想将上面的结果保存成`JSON`文件，可以执行如下命令：\n\n```python\nscrapy crawl quotes -o quotes.json\n```\n\n命令运行后，项目内多了一个`quotes.json`文件，文件包含了刚才抓取的所有内容，内容是`JSON`格式。\n\n![](Screenshot_3.webp)\n\n另外还可以每一个`Item`输出一行`JSON`，输出后缀为`jl`，为`jsonline`的缩写，命令如下所示：\n\n```python\nscrapy crawl quotes -o quotes.jl\n```\n\n或\n\n```python\nscrapy crawl quotes -o quotes.jsonlines\n```\n\n输出格式还支持很多种，例如`csv`、`xml`、`pickle`、`marshal`等，还支持`ftp`、`s3` 等远程输出，另外还可以通过自定义`ItemExporter`来实现其他的输出。\n\n例如，下面命令对应的输出分别为`csv`、`xml`、`pickle`、`marshal`格式以及`ftp`远程输出：\n\n```python\nscrapy crawl quotes -o quotes.csv\nscrapy crawl quotes -o quotes.xml\nscrapy crawl quotes -o quotes.pickle\nscrapy crawl quotes -o quotes.marshal\nscrapy crawl quotes -o ftp://user:pass@ftp.example.com/path/to/quotes.csv \n```\n\n其中，`ftp`输出需要正确配置用户名、密码、地址、输出路径，否则会报错。通过`Scrapy`提供的`Feed Exports`，可以轻松地输出抓取结果到文件。对于一些小型项目来说，这应该足够了。不过如果想要更复杂的输出，如输出到数据库等，可以使用`ItemPileline`来完成。\n\n## 使用ItemPileline\n\n如果想进行更复杂的操作，如将结果保存到`MongoDB`数据库，或者筛选某些有用的`Item`，则可以定义`ItemPipeline`来实现。\n\n`ItemPipeline`为项目管道。当`Item`生成后，它会自动被送到`ItemPipeline`进行处理，常用`ItemPipeline`来做如下操作。\n\n- 清洗`HTML`数据；\n- 验证爬取数据，检查爬取字段；\n- 查重并丢弃重复内容；\n- 将爬取结果储存到数据库。\n\n要实现`ItemPipeline`很简单，只需要定义一个类并实现`process_item`方法即可。启用`ItemPipeline`后，`ItemPipeline`会自动调用这个方法。`process_item`方法必须返回包含数据的字典或`Item`对象，或者抛出`DropItem`异常。\n\n`process_item`方法有两个参数。一个参数是`item`，每次`Spider`生成的`Item`都会作为参数传递过来。另一个参数是`spider`，就是`Spider`的实例。\n\n接下来，实现一个`ItemPipeline`，筛掉`text`长度大于`50`的`Item`，并将结果保存到`MongoDB`。\n\n修改项目里的`pipelines`.py文件，之前用命令行自动生成的文件内容可以删掉，增加一个`TextPipeline`类，内容如下所示：\n\n```python\nfrom scrapy.exceptions import DropItem\n\nclass TextPipeline(object):\n    def __init__(self):\n        self.limit = 50\n    \n    def process_item(self, item, spider):\n        if item['text']:\n            if len(item['text']) > self.limit:\n                item['text'] =item['text'][0:self.limit].rstrip() + '...'\n                return item\n            else:\n                return DropItem\n```\n\n这段代码在构造方法里定义了限制长度为50，实现了`process_item`方法，其参数是`item`和`spider`。首先该方法判断`item`的`text`属性是否存在，如果不存在，则抛出`DropItem`异常；如果存在，再判断长度是否大于50，如果大于，那就截断然后拼接省略号，再将`item`返回即可。\n\n将处理后的`item`存入`MongoDB`，定义另外一个`Pipeline`。同样在`pipelines.py`中，实现另一个类`MongoPipeline`，内容如下所示：\n\n```python\nimport pymongo\n\n    @classmethod\n    def from_crawler(cls, crawler):\n        return cls(mongo_uri=crawler.settings.get('MONGO_URI'), mongo_db=crawler.settings.get('MONGO_DB'))\n        \n    def open_spider(self, spider):\n        self.client = pymongo.MongoClient(self.mongo_uri)\n        self.db = self.client[self.mongo_db]\n    \n    def process_item(self, item, spider): \n        name = item.__class__.__name__ \n        self.db[name].insert(dict(item)) \n        return item \n    \n    def close_spider(self, spider): \n        self.client.close()\n```\n\n`MongoPipeline`类实现了`API`定义的另外几个方法。\n\n- `from_crawler`：这是一个类方法，用`@classmethod`标识，是一种依赖注入的方式，方法的参数就是`crawler`，通过`crawler`这个参数我们可以拿到全局配置的每个配置信息，在全局配置`settings.py`中可以定义`MONGO_URI`和`MONGO_DB`来指定`MongoDB`连接需要的地址和数据库名称，拿到配置信息之后返回类对象即可。所以这个方法的定义主要是用来获取`settings.py`中的配置的。\n- `open_spider`：当`Spider`被开启时，这个方法被调用。在这里主要进行了一些初始化操作。\n- `close_spider`：当`Spider`被关闭时，这个方法会调用，在这里将数据库连接关闭。\n\n最主要的`process_item`方法则执行了数据插入操作。\n\n定义好`TextPipeline`和`MongoPipeline`这两个类后，需要在`settings.py`中使用它们。`MongoDB`的连接信息还需要定义。\n\n```python\nITEM_PIPELINES = {\n    'tutorial.pipelines.TextPipeline': 300,\n    'tutorial.pipelines.MongoPipeline': 400,\n}\nMONGO_URI='localhost'\nMONGO_DB='tutorial'\n```\n\n赋值`ITEM_PIPELINES`字典，键名是`Pipeline`的类名称，键值是调用优先级，是一个数字，数字越小则对应的`Pipeline`越先被调用。\n再重新执行爬取，命令如下所示：\n\n```python\nscrapy crawl quotes\n```\n\n爬取结束后，`MongoDB`中创建了一个`tutorial`的数据库、`QuoteItem`的表。\n","source":"_posts/scrapy的基本使用.md","raw":"---\ntitle: scrapy的基本使用\ntags:\n  - scrapy\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-29 22:49:55\ncategories: 爬虫\npic:\n---\n\n## 抓取目标\n\n要完成的任务如下。\n\n- 创建一个`Scrapy`项目。\n- 创建一个`Spider`来抓取站点和处理数据。\n- 通过命令行将抓取的内容导出。\n- 将抓取的内容保存到`MongoDB`数据库。\n\n抓取的目标站点为[](http://quotes.toscrape.com/)。\n\n## 准备工作\n\n安装好`scrapy`框架、`MongoDB`和`PyMongo`库。\n\n## 创建项目\n\n创建一个`Scrapy`项目，项目文件可以直接用`Scrapy`命令生成，命令如下所示：\n\n```python\nscrapy startproject tutorial\n```\n\n这个命令将会创建一个名为`tutorial`的文件夹，文件夹结构如下所示：\n\n```python\nscrapy.cfg    # Scrapy 部署时的配置文件 \ntutorial    # 项目的模块，引入的时候需要从这里引入 \n  __init__.py \n  items.py    # Items 的定义，定义爬取的数据结构 \n  middlewares.py     # Middlewares 的定义，定义爬取时的中间件 \n  pipelines.py    # Pipelines 的定义，定义数据管道 \n  settings.py     # 配置文件 \n  spiders     # 放置 Spiders 的文件夹 \n    __init__.py\n```\n\n## 创建Spider\n\n`Spider`是自己定义的类，`Scrapy`用它从网页里抓取内容，并解析抓取的结果。不过这个类必须继承`Scrapy`提供的`Spider`类`scrapy.Spider`，还要定义`Spider`的名称和起始请求，以及怎样处理爬取后的结果的方法。\n\n也可以使用命令行创建一个`Spider`。比如要生成`Quotes`这个`Spider`，可以执行如下命令：\n\n```python\n>>> scrapy genspider quotes quotes.toscrape.com     \nCreated spider 'quotes' using template 'basic' in module:\n  tutorial.spiders.quotes\n```\n\n进入刚才创建的`tutorial`文件夹，然后执行`genspider`命令。第一个参数是`Spider`的名称，第二个参数是`网站域名`。执行完毕之后，`spiders`文件夹中多了一个`quotes.py`，它就是刚刚创建的`Spider`，内容如下所示：\n\n```python\nimport scrapy\n\nclass QuotesSpider(scrapy.Spider):\n    name = 'quotes'\n    allowed_domains = ['quotes.toscrape.com']\n    start_urls = ['http://quotes.toscrape.com/']\n\n    def parse(self, response):\n        pass\n```\n\n这里有三个属性——`name`、`allowed_domains`和`start_urls`，还有一个方法`parse`。\n\n- `name`：它是每个项目唯一的名字，用来区分不同的`Spider`。\n- `allowed_domains`：它是允许爬取的域名，如果初始或后续的请求链接不是这个域名下的，则请求链接会被过滤掉。\n- `start_urls`：它包含了`Spider`在启动时爬取的`url`列表，初始请求是由它来定义的。\n- `parse`：它是`Spider`的一个方法。默认情况下，被调用时`start_urls`里面的链接构成的请求完成下载执行后，返回的响应就会作为唯一的参数传递给这个函数。该方法负责解析返回的响应、提取数据或者进一 步生成要处理的请求。\n\n## 创建Item\n\n`Item`是保存爬虫数据的容器，它的使用方法和字典类似，不过相比字典，`Item`多了额外的保护机制，可以避免拼写错误或者定义字段错误。\n\n创建`Item`需要继承`scrapy.Item`类，并且定义类型为`scrapy.Field`的字段。观察目标网站，可以获取到的内容有`text`、`author`、`tags`。\n\n定义`Item`，此时将`items.py`修改如下：\n\n```python\nimport scrapy\n\nclass QuoteItem(scrapy.Item):\n    # define the fields for your item here like:\n    # name = scrapy.Field()\n    text = scrapy.Field()\n    author = scrapy.Field()\n    tags = scrapy.Field()\n```\n\n这里定义了三个字段，将类的名称修改为`QuoteItem`，接下来爬取时会使用到这个`Item`。\n\n## 解析Response\n\n`parse`方法的参数`response`是`start_urls`里面的链接爬取后的结果。所以在`parse`方法中，可以直接对`response`变量包含的内容进行解析，比如浏览请求结果的网页源代码，或者进一步分析源代码内容，或者找出结果中的链接而得到下一个请求。\n\n首先看看网页结构，如图所示。每一页都有多个`class`为`quote`的区块，每个区块内都包含`text`、`author`、`tags`。那么先找出所有的`quote`，然后提取每一个`quote`中的内容。\n\n![](Screenshot_1.webp)\n\n提取的方式可以是`CSS`选择器或`XPath`选择器。在这里使用`CSS`选择器进行选择，`parse`方法的改写如下所示：\n\n```python\nclass QuotesSpider(scrapy.Spider):\n    name = 'quotes'\n    allowed_domains = ['http://quotes.toscrape.com/']\n    start_urls = ['http://http://quotes.toscrape.com//']\n\n    def parse(self, response):\n        quotes = response.css('.quote')\n        for quote in quotes:\n            text = quote.css('.text::text').extract_first()\n            author = quote.css('.author::text').extract_first()\n            tags = quote.css('.tags .tag::text').extract()\n```\n\n对于`text`，获取结果的第一个元素即可，所以使用`extract_first`方法，对于`tags`，要获取所有结果组成的列表，所以使用`extract`方法。\n\n## 使用Item\n\n上文定义了`Item`，接下来就要使用它了。`Item`可以理解为一个字典，不过在声明的时候需要实例化。然后依次用刚才解析的结果赋值`Item`的每一个字段，最后将`Item`返回即可。\n\n`QuotesSpider`的改写如下所示：\n\n```python\n    def parse(self, response):\n        quotes = response.css('.quote')\n        for quote in quotes:\n            item = QuoteItem()\n            item['text'] = quote.css('.text::text').extract_first()\n            item['author'] = quote.css('.author::text').extract_first()\n            item['tags'] = quote.css('.tags .tag::text').extract()\n            yield item\n```\n\n如此一来，首页的所有内容被解析出来，并被赋值成了一个个`QuoteItem`。\n\n## 后续Request\n\n接下来就需要从当前页面中找到信息来生成下一个请求，然后在下一个请求的页面里面找到信息再构造下一个请求。这样循环往复迭代，从而实现整站的爬取。\n\n将刚才的页面拉到最底部，如图所示。\n\n![](Screenshot_2.webp)\n\n有一个`Next`按钮，查看一下源代码，可以发现它的链接是`/page/2/`，实际上全链接就是：`http://quotes.toscrape.com/page/2`，通过这个链接我们就可以构造下一个请求。\n\n构造请求时需要用到`scrapy.Request`。这里传递两个参数——`url`和`callback`，这两个参数的说明如下。\n\n- `url`：它是请求链接。\n- `callback`：它是回调函数。当指定了该回调函数的请求完成之后，获取到响应，引擎会将该响应作为参数传递给这个回调函数。回调函数进行解析或生成下一个请求，回调函数如上文的`parse()`所示。\n\n由于`parse`就是解析`text`、`author`、`tags`的方法，而下一页的结构和刚才已经解析的页面结构是一样的，所以可以再次使用`parse`方法来做页面解析。\n\n接下来要做的就是利用选择器得到下一页链接并生成请求，在`parse`方法后追加如下的代码：\n\n```python\nnext = response.css('.pager .next a::attr(href)').extract_first()\nurl = response.urljoin(next)\nyield scrapy.Request(url=url, callback=self.parse, dont_filter=True)\n```\n\n第一句代码首先通过`CSS`选择器获取下一个页面的链接，即要获取`a`超链接中的`href`属性。这里用到了`::attr(href)`操作。然后再调用`extract_first`方法获取内容。\n\n第二句代码调用了`urljoin`方法，`urljoin()`方法可以将相对`URL`构造成一个绝对的`URL`。例如，获取到的下一页地址是`/page/2`，`urljoin`方法处理后得到的结果就是：`http://quotes.toscrape.com/page/2/`。\n\n第三句代码通过`url`和`callback`变量构造了一个新的请求，回调函数`callback`依然使用`parse`方法。这个请求完成后，响应会重新经过`parse`方法处理，得到第二页的解析结果，然后生成第二页的下一页，也就是第三页的请求。这样爬虫就进入了一个循环，直到最后一页。`dont_filter`设置为`Ture`不进行域名过滤，这样就能继续爬取。\n\n通过几行代码，就轻松实现了一个抓取循环，将每个页面的结果抓取下来了。现在，改写之后的整个`Spider`类如下所示：\n\n```python\nimport scrapy\nfrom tutorial.items import QuoteItem\n\n\nclass QuotesSpider(scrapy.Spider):\n    name = 'quotes'\n    allowed_domains = ['quotes.toscrape.com/']\n    start_urls = ['http://quotes.toscrape.com/']\n\n    def parse(self, response):\n        quotes = response.css('.quote')\n        for quote in quotes:\n            item = QuoteItem()\n            item['text'] = quote.css('.text::text').extract_first()\n            item['author'] = quote.css('.author::text').extract_first()\n            item['tags'] = quote.css('.tags .tag::text').extract()\n            yield item\n\n        next = response.css('.pager .next a::attr(href)').extract_first()\n        if next !== \"\":\n          url = response.urljoin(next)\n          yield scrapy.Request(url=url, callback=self.parse, dont_filter=True)\n```\n\n## 运行\n\n进入目录，运行如下命令：\n\n```python\nscrapy crawl quotes\n```\n\n爬虫一边解析，一边翻页，直至将所有内容抓取完毕，然后终止。\n\n最后，`Scrapy`输出了整个抓取过程的统计信息，如请求的字节数、请求次数、响应次数、完成原因等。\n\n## 保存到文件\n\n`Scrapy`提供的`Feed Exports`可以轻松将抓取结果输出。例如，想将上面的结果保存成`JSON`文件，可以执行如下命令：\n\n```python\nscrapy crawl quotes -o quotes.json\n```\n\n命令运行后，项目内多了一个`quotes.json`文件，文件包含了刚才抓取的所有内容，内容是`JSON`格式。\n\n![](Screenshot_3.webp)\n\n另外还可以每一个`Item`输出一行`JSON`，输出后缀为`jl`，为`jsonline`的缩写，命令如下所示：\n\n```python\nscrapy crawl quotes -o quotes.jl\n```\n\n或\n\n```python\nscrapy crawl quotes -o quotes.jsonlines\n```\n\n输出格式还支持很多种，例如`csv`、`xml`、`pickle`、`marshal`等，还支持`ftp`、`s3` 等远程输出，另外还可以通过自定义`ItemExporter`来实现其他的输出。\n\n例如，下面命令对应的输出分别为`csv`、`xml`、`pickle`、`marshal`格式以及`ftp`远程输出：\n\n```python\nscrapy crawl quotes -o quotes.csv\nscrapy crawl quotes -o quotes.xml\nscrapy crawl quotes -o quotes.pickle\nscrapy crawl quotes -o quotes.marshal\nscrapy crawl quotes -o ftp://user:pass@ftp.example.com/path/to/quotes.csv \n```\n\n其中，`ftp`输出需要正确配置用户名、密码、地址、输出路径，否则会报错。通过`Scrapy`提供的`Feed Exports`，可以轻松地输出抓取结果到文件。对于一些小型项目来说，这应该足够了。不过如果想要更复杂的输出，如输出到数据库等，可以使用`ItemPileline`来完成。\n\n## 使用ItemPileline\n\n如果想进行更复杂的操作，如将结果保存到`MongoDB`数据库，或者筛选某些有用的`Item`，则可以定义`ItemPipeline`来实现。\n\n`ItemPipeline`为项目管道。当`Item`生成后，它会自动被送到`ItemPipeline`进行处理，常用`ItemPipeline`来做如下操作。\n\n- 清洗`HTML`数据；\n- 验证爬取数据，检查爬取字段；\n- 查重并丢弃重复内容；\n- 将爬取结果储存到数据库。\n\n要实现`ItemPipeline`很简单，只需要定义一个类并实现`process_item`方法即可。启用`ItemPipeline`后，`ItemPipeline`会自动调用这个方法。`process_item`方法必须返回包含数据的字典或`Item`对象，或者抛出`DropItem`异常。\n\n`process_item`方法有两个参数。一个参数是`item`，每次`Spider`生成的`Item`都会作为参数传递过来。另一个参数是`spider`，就是`Spider`的实例。\n\n接下来，实现一个`ItemPipeline`，筛掉`text`长度大于`50`的`Item`，并将结果保存到`MongoDB`。\n\n修改项目里的`pipelines`.py文件，之前用命令行自动生成的文件内容可以删掉，增加一个`TextPipeline`类，内容如下所示：\n\n```python\nfrom scrapy.exceptions import DropItem\n\nclass TextPipeline(object):\n    def __init__(self):\n        self.limit = 50\n    \n    def process_item(self, item, spider):\n        if item['text']:\n            if len(item['text']) > self.limit:\n                item['text'] =item['text'][0:self.limit].rstrip() + '...'\n                return item\n            else:\n                return DropItem\n```\n\n这段代码在构造方法里定义了限制长度为50，实现了`process_item`方法，其参数是`item`和`spider`。首先该方法判断`item`的`text`属性是否存在，如果不存在，则抛出`DropItem`异常；如果存在，再判断长度是否大于50，如果大于，那就截断然后拼接省略号，再将`item`返回即可。\n\n将处理后的`item`存入`MongoDB`，定义另外一个`Pipeline`。同样在`pipelines.py`中，实现另一个类`MongoPipeline`，内容如下所示：\n\n```python\nimport pymongo\n\n    @classmethod\n    def from_crawler(cls, crawler):\n        return cls(mongo_uri=crawler.settings.get('MONGO_URI'), mongo_db=crawler.settings.get('MONGO_DB'))\n        \n    def open_spider(self, spider):\n        self.client = pymongo.MongoClient(self.mongo_uri)\n        self.db = self.client[self.mongo_db]\n    \n    def process_item(self, item, spider): \n        name = item.__class__.__name__ \n        self.db[name].insert(dict(item)) \n        return item \n    \n    def close_spider(self, spider): \n        self.client.close()\n```\n\n`MongoPipeline`类实现了`API`定义的另外几个方法。\n\n- `from_crawler`：这是一个类方法，用`@classmethod`标识，是一种依赖注入的方式，方法的参数就是`crawler`，通过`crawler`这个参数我们可以拿到全局配置的每个配置信息，在全局配置`settings.py`中可以定义`MONGO_URI`和`MONGO_DB`来指定`MongoDB`连接需要的地址和数据库名称，拿到配置信息之后返回类对象即可。所以这个方法的定义主要是用来获取`settings.py`中的配置的。\n- `open_spider`：当`Spider`被开启时，这个方法被调用。在这里主要进行了一些初始化操作。\n- `close_spider`：当`Spider`被关闭时，这个方法会调用，在这里将数据库连接关闭。\n\n最主要的`process_item`方法则执行了数据插入操作。\n\n定义好`TextPipeline`和`MongoPipeline`这两个类后，需要在`settings.py`中使用它们。`MongoDB`的连接信息还需要定义。\n\n```python\nITEM_PIPELINES = {\n    'tutorial.pipelines.TextPipeline': 300,\n    'tutorial.pipelines.MongoPipeline': 400,\n}\nMONGO_URI='localhost'\nMONGO_DB='tutorial'\n```\n\n赋值`ITEM_PIPELINES`字典，键名是`Pipeline`的类名称，键值是调用优先级，是一个数字，数字越小则对应的`Pipeline`越先被调用。\n再重新执行爬取，命令如下所示：\n\n```python\nscrapy crawl quotes\n```\n\n爬取结束后，`MongoDB`中创建了一个`tutorial`的数据库、`QuoteItem`的表。\n","slug":"scrapy的基本使用","published":1,"updated":"2021-06-15T03:24:11.519Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2o002n44udc5qo24uz","content":"<h2 id=\"抓取目标\"><a href=\"#抓取目标\" class=\"headerlink\" title=\"抓取目标\"></a>抓取目标</h2><p>要完成的任务如下。</p>\n<ul>\n<li>创建一个<code>Scrapy</code>项目。</li>\n<li>创建一个<code>Spider</code>来抓取站点和处理数据。</li>\n<li>通过命令行将抓取的内容导出。</li>\n<li>将抓取的内容保存到<code>MongoDB</code>数据库。</li>\n</ul>\n<p>抓取的目标站点为<a href=\"http://quotes.toscrape.com/\"></a>。</p>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p>安装好<code>scrapy</code>框架、<code>MongoDB</code>和<code>PyMongo</code>库。</p>\n<h2 id=\"创建项目\"><a href=\"#创建项目\" class=\"headerlink\" title=\"创建项目\"></a>创建项目</h2><p>创建一个<code>Scrapy</code>项目，项目文件可以直接用<code>Scrapy</code>命令生成，命令如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy startproject tutorial</span><br></pre></td></tr></table></figure>\n\n<p>这个命令将会创建一个名为<code>tutorial</code>的文件夹，文件夹结构如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy.cfg    <span class=\"comment\"># Scrapy 部署时的配置文件 </span></span><br><span class=\"line\">tutorial    <span class=\"comment\"># 项目的模块，引入的时候需要从这里引入 </span></span><br><span class=\"line\">  __init__.py </span><br><span class=\"line\">  items.py    <span class=\"comment\"># Items 的定义，定义爬取的数据结构 </span></span><br><span class=\"line\">  middlewares.py     <span class=\"comment\"># Middlewares 的定义，定义爬取时的中间件 </span></span><br><span class=\"line\">  pipelines.py    <span class=\"comment\"># Pipelines 的定义，定义数据管道 </span></span><br><span class=\"line\">  settings.py     <span class=\"comment\"># 配置文件 </span></span><br><span class=\"line\">  spiders     <span class=\"comment\"># 放置 Spiders 的文件夹 </span></span><br><span class=\"line\">    __init__.py</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建Spider\"><a href=\"#创建Spider\" class=\"headerlink\" title=\"创建Spider\"></a>创建Spider</h2><p><code>Spider</code>是自己定义的类，<code>Scrapy</code>用它从网页里抓取内容，并解析抓取的结果。不过这个类必须继承<code>Scrapy</code>提供的<code>Spider</code>类<code>scrapy.Spider</code>，还要定义<code>Spider</code>的名称和起始请求，以及怎样处理爬取后的结果的方法。</p>\n<p>也可以使用命令行创建一个<code>Spider</code>。比如要生成<code>Quotes</code>这个<code>Spider</code>，可以执行如下命令：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>scrapy genspider quotes quotes.toscrape.com     </span><br><span class=\"line\">Created spider <span class=\"string\">&#x27;quotes&#x27;</span> using template <span class=\"string\">&#x27;basic&#x27;</span> <span class=\"keyword\">in</span> module:</span><br><span class=\"line\">  tutorial.spiders.quotes</span><br></pre></td></tr></table></figure>\n\n<p>进入刚才创建的<code>tutorial</code>文件夹，然后执行<code>genspider</code>命令。第一个参数是<code>Spider</code>的名称，第二个参数是<code>网站域名</code>。执行完毕之后，<code>spiders</code>文件夹中多了一个<code>quotes.py</code>，它就是刚刚创建的<code>Spider</code>，内容如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> scrapy</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">QuotesSpider</span>(<span class=\"params\">scrapy.Spider</span>):</span></span><br><span class=\"line\">    name = <span class=\"string\">&#x27;quotes&#x27;</span></span><br><span class=\"line\">    allowed_domains = [<span class=\"string\">&#x27;quotes.toscrape.com&#x27;</span>]</span><br><span class=\"line\">    start_urls = [<span class=\"string\">&#x27;http://quotes.toscrape.com/&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse</span>(<span class=\"params\">self, response</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n\n<p>这里有三个属性——<code>name</code>、<code>allowed_domains</code>和<code>start_urls</code>，还有一个方法<code>parse</code>。</p>\n<ul>\n<li><code>name</code>：它是每个项目唯一的名字，用来区分不同的<code>Spider</code>。</li>\n<li><code>allowed_domains</code>：它是允许爬取的域名，如果初始或后续的请求链接不是这个域名下的，则请求链接会被过滤掉。</li>\n<li><code>start_urls</code>：它包含了<code>Spider</code>在启动时爬取的<code>url</code>列表，初始请求是由它来定义的。</li>\n<li><code>parse</code>：它是<code>Spider</code>的一个方法。默认情况下，被调用时<code>start_urls</code>里面的链接构成的请求完成下载执行后，返回的响应就会作为唯一的参数传递给这个函数。该方法负责解析返回的响应、提取数据或者进一 步生成要处理的请求。</li>\n</ul>\n<h2 id=\"创建Item\"><a href=\"#创建Item\" class=\"headerlink\" title=\"创建Item\"></a>创建Item</h2><p><code>Item</code>是保存爬虫数据的容器，它的使用方法和字典类似，不过相比字典，<code>Item</code>多了额外的保护机制，可以避免拼写错误或者定义字段错误。</p>\n<p>创建<code>Item</code>需要继承<code>scrapy.Item</code>类，并且定义类型为<code>scrapy.Field</code>的字段。观察目标网站，可以获取到的内容有<code>text</code>、<code>author</code>、<code>tags</code>。</p>\n<p>定义<code>Item</code>，此时将<code>items.py</code>修改如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> scrapy</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">QuoteItem</span>(<span class=\"params\">scrapy.Item</span>):</span></span><br><span class=\"line\">    <span class=\"comment\"># define the fields for your item here like:</span></span><br><span class=\"line\">    <span class=\"comment\"># name = scrapy.Field()</span></span><br><span class=\"line\">    text = scrapy.Field()</span><br><span class=\"line\">    author = scrapy.Field()</span><br><span class=\"line\">    tags = scrapy.Field()</span><br></pre></td></tr></table></figure>\n\n<p>这里定义了三个字段，将类的名称修改为<code>QuoteItem</code>，接下来爬取时会使用到这个<code>Item</code>。</p>\n<h2 id=\"解析Response\"><a href=\"#解析Response\" class=\"headerlink\" title=\"解析Response\"></a>解析Response</h2><p><code>parse</code>方法的参数<code>response</code>是<code>start_urls</code>里面的链接爬取后的结果。所以在<code>parse</code>方法中，可以直接对<code>response</code>变量包含的内容进行解析，比如浏览请求结果的网页源代码，或者进一步分析源代码内容，或者找出结果中的链接而得到下一个请求。</p>\n<p>首先看看网页结构，如图所示。每一页都有多个<code>class</code>为<code>quote</code>的区块，每个区块内都包含<code>text</code>、<code>author</code>、<code>tags</code>。那么先找出所有的<code>quote</code>，然后提取每一个<code>quote</code>中的内容。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>提取的方式可以是<code>CSS</code>选择器或<code>XPath</code>选择器。在这里使用<code>CSS</code>选择器进行选择，<code>parse</code>方法的改写如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">QuotesSpider</span>(<span class=\"params\">scrapy.Spider</span>):</span></span><br><span class=\"line\">    name = <span class=\"string\">&#x27;quotes&#x27;</span></span><br><span class=\"line\">    allowed_domains = [<span class=\"string\">&#x27;http://quotes.toscrape.com/&#x27;</span>]</span><br><span class=\"line\">    start_urls = [<span class=\"string\">&#x27;http://http://quotes.toscrape.com//&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse</span>(<span class=\"params\">self, response</span>):</span></span><br><span class=\"line\">        quotes = response.css(<span class=\"string\">&#x27;.quote&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> quote <span class=\"keyword\">in</span> quotes:</span><br><span class=\"line\">            text = quote.css(<span class=\"string\">&#x27;.text::text&#x27;</span>).extract_first()</span><br><span class=\"line\">            author = quote.css(<span class=\"string\">&#x27;.author::text&#x27;</span>).extract_first()</span><br><span class=\"line\">            tags = quote.css(<span class=\"string\">&#x27;.tags .tag::text&#x27;</span>).extract()</span><br></pre></td></tr></table></figure>\n\n<p>对于<code>text</code>，获取结果的第一个元素即可，所以使用<code>extract_first</code>方法，对于<code>tags</code>，要获取所有结果组成的列表，所以使用<code>extract</code>方法。</p>\n<h2 id=\"使用Item\"><a href=\"#使用Item\" class=\"headerlink\" title=\"使用Item\"></a>使用Item</h2><p>上文定义了<code>Item</code>，接下来就要使用它了。<code>Item</code>可以理解为一个字典，不过在声明的时候需要实例化。然后依次用刚才解析的结果赋值<code>Item</code>的每一个字段，最后将<code>Item</code>返回即可。</p>\n<p><code>QuotesSpider</code>的改写如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse</span>(<span class=\"params\">self, response</span>):</span></span><br><span class=\"line\">    quotes = response.css(<span class=\"string\">&#x27;.quote&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> quote <span class=\"keyword\">in</span> quotes:</span><br><span class=\"line\">        item = QuoteItem()</span><br><span class=\"line\">        item[<span class=\"string\">&#x27;text&#x27;</span>] = quote.css(<span class=\"string\">&#x27;.text::text&#x27;</span>).extract_first()</span><br><span class=\"line\">        item[<span class=\"string\">&#x27;author&#x27;</span>] = quote.css(<span class=\"string\">&#x27;.author::text&#x27;</span>).extract_first()</span><br><span class=\"line\">        item[<span class=\"string\">&#x27;tags&#x27;</span>] = quote.css(<span class=\"string\">&#x27;.tags .tag::text&#x27;</span>).extract()</span><br><span class=\"line\">        <span class=\"keyword\">yield</span> item</span><br></pre></td></tr></table></figure>\n\n<p>如此一来，首页的所有内容被解析出来，并被赋值成了一个个<code>QuoteItem</code>。</p>\n<h2 id=\"后续Request\"><a href=\"#后续Request\" class=\"headerlink\" title=\"后续Request\"></a>后续Request</h2><p>接下来就需要从当前页面中找到信息来生成下一个请求，然后在下一个请求的页面里面找到信息再构造下一个请求。这样循环往复迭代，从而实现整站的爬取。</p>\n<p>将刚才的页面拉到最底部，如图所示。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>有一个<code>Next</code>按钮，查看一下源代码，可以发现它的链接是<code>/page/2/</code>，实际上全链接就是：<code>http://quotes.toscrape.com/page/2</code>，通过这个链接我们就可以构造下一个请求。</p>\n<p>构造请求时需要用到<code>scrapy.Request</code>。这里传递两个参数——<code>url</code>和<code>callback</code>，这两个参数的说明如下。</p>\n<ul>\n<li><code>url</code>：它是请求链接。</li>\n<li><code>callback</code>：它是回调函数。当指定了该回调函数的请求完成之后，获取到响应，引擎会将该响应作为参数传递给这个回调函数。回调函数进行解析或生成下一个请求，回调函数如上文的<code>parse()</code>所示。</li>\n</ul>\n<p>由于<code>parse</code>就是解析<code>text</code>、<code>author</code>、<code>tags</code>的方法，而下一页的结构和刚才已经解析的页面结构是一样的，所以可以再次使用<code>parse</code>方法来做页面解析。</p>\n<p>接下来要做的就是利用选择器得到下一页链接并生成请求，在<code>parse</code>方法后追加如下的代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">next</span> = response.css(<span class=\"string\">&#x27;.pager .next a::attr(href)&#x27;</span>).extract_first()</span><br><span class=\"line\">url = response.urljoin(<span class=\"built_in\">next</span>)</span><br><span class=\"line\"><span class=\"keyword\">yield</span> scrapy.Request(url=url, callback=self.parse, dont_filter=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n<p>第一句代码首先通过<code>CSS</code>选择器获取下一个页面的链接，即要获取<code>a</code>超链接中的<code>href</code>属性。这里用到了<code>::attr(href)</code>操作。然后再调用<code>extract_first</code>方法获取内容。</p>\n<p>第二句代码调用了<code>urljoin</code>方法，<code>urljoin()</code>方法可以将相对<code>URL</code>构造成一个绝对的<code>URL</code>。例如，获取到的下一页地址是<code>/page/2</code>，<code>urljoin</code>方法处理后得到的结果就是：<code>http://quotes.toscrape.com/page/2/</code>。</p>\n<p>第三句代码通过<code>url</code>和<code>callback</code>变量构造了一个新的请求，回调函数<code>callback</code>依然使用<code>parse</code>方法。这个请求完成后，响应会重新经过<code>parse</code>方法处理，得到第二页的解析结果，然后生成第二页的下一页，也就是第三页的请求。这样爬虫就进入了一个循环，直到最后一页。<code>dont_filter</code>设置为<code>Ture</code>不进行域名过滤，这样就能继续爬取。</p>\n<p>通过几行代码，就轻松实现了一个抓取循环，将每个页面的结果抓取下来了。现在，改写之后的整个<code>Spider</code>类如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> scrapy</span><br><span class=\"line\"><span class=\"keyword\">from</span> tutorial.items <span class=\"keyword\">import</span> QuoteItem</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">QuotesSpider</span>(<span class=\"params\">scrapy.Spider</span>):</span></span><br><span class=\"line\">    name = <span class=\"string\">&#x27;quotes&#x27;</span></span><br><span class=\"line\">    allowed_domains = [<span class=\"string\">&#x27;quotes.toscrape.com/&#x27;</span>]</span><br><span class=\"line\">    start_urls = [<span class=\"string\">&#x27;http://quotes.toscrape.com/&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse</span>(<span class=\"params\">self, response</span>):</span></span><br><span class=\"line\">        quotes = response.css(<span class=\"string\">&#x27;.quote&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> quote <span class=\"keyword\">in</span> quotes:</span><br><span class=\"line\">            item = QuoteItem()</span><br><span class=\"line\">            item[<span class=\"string\">&#x27;text&#x27;</span>] = quote.css(<span class=\"string\">&#x27;.text::text&#x27;</span>).extract_first()</span><br><span class=\"line\">            item[<span class=\"string\">&#x27;author&#x27;</span>] = quote.css(<span class=\"string\">&#x27;.author::text&#x27;</span>).extract_first()</span><br><span class=\"line\">            item[<span class=\"string\">&#x27;tags&#x27;</span>] = quote.css(<span class=\"string\">&#x27;.tags .tag::text&#x27;</span>).extract()</span><br><span class=\"line\">            <span class=\"keyword\">yield</span> item</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">next</span> = response.css(<span class=\"string\">&#x27;.pager .next a::attr(href)&#x27;</span>).extract_first()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">next</span> !== <span class=\"string\">&quot;&quot;</span>:</span><br><span class=\"line\">          url = response.urljoin(<span class=\"built_in\">next</span>)</span><br><span class=\"line\">          <span class=\"keyword\">yield</span> scrapy.Request(url=url, callback=self.parse, dont_filter=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h2><p>进入目录，运行如下命令：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy crawl quotes</span><br></pre></td></tr></table></figure>\n\n<p>爬虫一边解析，一边翻页，直至将所有内容抓取完毕，然后终止。</p>\n<p>最后，<code>Scrapy</code>输出了整个抓取过程的统计信息，如请求的字节数、请求次数、响应次数、完成原因等。</p>\n<h2 id=\"保存到文件\"><a href=\"#保存到文件\" class=\"headerlink\" title=\"保存到文件\"></a>保存到文件</h2><p><code>Scrapy</code>提供的<code>Feed Exports</code>可以轻松将抓取结果输出。例如，想将上面的结果保存成<code>JSON</code>文件，可以执行如下命令：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy crawl quotes -o quotes.json</span><br></pre></td></tr></table></figure>\n\n<p>命令运行后，项目内多了一个<code>quotes.json</code>文件，文件包含了刚才抓取的所有内容，内容是<code>JSON</code>格式。</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<p>另外还可以每一个<code>Item</code>输出一行<code>JSON</code>，输出后缀为<code>jl</code>，为<code>jsonline</code>的缩写，命令如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy crawl quotes -o quotes.jl</span><br></pre></td></tr></table></figure>\n\n<p>或</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy crawl quotes -o quotes.jsonlines</span><br></pre></td></tr></table></figure>\n\n<p>输出格式还支持很多种，例如<code>csv</code>、<code>xml</code>、<code>pickle</code>、<code>marshal</code>等，还支持<code>ftp</code>、<code>s3</code> 等远程输出，另外还可以通过自定义<code>ItemExporter</code>来实现其他的输出。</p>\n<p>例如，下面命令对应的输出分别为<code>csv</code>、<code>xml</code>、<code>pickle</code>、<code>marshal</code>格式以及<code>ftp</code>远程输出：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy crawl quotes -o quotes.csv</span><br><span class=\"line\">scrapy crawl quotes -o quotes.xml</span><br><span class=\"line\">scrapy crawl quotes -o quotes.pickle</span><br><span class=\"line\">scrapy crawl quotes -o quotes.marshal</span><br><span class=\"line\">scrapy crawl quotes -o ftp://user:<span class=\"keyword\">pass</span>@ftp.example.com/path/to/quotes.csv </span><br></pre></td></tr></table></figure>\n\n<p>其中，<code>ftp</code>输出需要正确配置用户名、密码、地址、输出路径，否则会报错。通过<code>Scrapy</code>提供的<code>Feed Exports</code>，可以轻松地输出抓取结果到文件。对于一些小型项目来说，这应该足够了。不过如果想要更复杂的输出，如输出到数据库等，可以使用<code>ItemPileline</code>来完成。</p>\n<h2 id=\"使用ItemPileline\"><a href=\"#使用ItemPileline\" class=\"headerlink\" title=\"使用ItemPileline\"></a>使用ItemPileline</h2><p>如果想进行更复杂的操作，如将结果保存到<code>MongoDB</code>数据库，或者筛选某些有用的<code>Item</code>，则可以定义<code>ItemPipeline</code>来实现。</p>\n<p><code>ItemPipeline</code>为项目管道。当<code>Item</code>生成后，它会自动被送到<code>ItemPipeline</code>进行处理，常用<code>ItemPipeline</code>来做如下操作。</p>\n<ul>\n<li>清洗<code>HTML</code>数据；</li>\n<li>验证爬取数据，检查爬取字段；</li>\n<li>查重并丢弃重复内容；</li>\n<li>将爬取结果储存到数据库。</li>\n</ul>\n<p>要实现<code>ItemPipeline</code>很简单，只需要定义一个类并实现<code>process_item</code>方法即可。启用<code>ItemPipeline</code>后，<code>ItemPipeline</code>会自动调用这个方法。<code>process_item</code>方法必须返回包含数据的字典或<code>Item</code>对象，或者抛出<code>DropItem</code>异常。</p>\n<p><code>process_item</code>方法有两个参数。一个参数是<code>item</code>，每次<code>Spider</code>生成的<code>Item</code>都会作为参数传递过来。另一个参数是<code>spider</code>，就是<code>Spider</code>的实例。</p>\n<p>接下来，实现一个<code>ItemPipeline</code>，筛掉<code>text</code>长度大于<code>50</code>的<code>Item</code>，并将结果保存到<code>MongoDB</code>。</p>\n<p>修改项目里的<code>pipelines</code>.py文件，之前用命令行自动生成的文件内容可以删掉，增加一个<code>TextPipeline</code>类，内容如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> scrapy.exceptions <span class=\"keyword\">import</span> DropItem</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TextPipeline</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        self.limit = <span class=\"number\">50</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">process_item</span>(<span class=\"params\">self, item, spider</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> item[<span class=\"string\">&#x27;text&#x27;</span>]:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(item[<span class=\"string\">&#x27;text&#x27;</span>]) &gt; self.limit:</span><br><span class=\"line\">                item[<span class=\"string\">&#x27;text&#x27;</span>] =item[<span class=\"string\">&#x27;text&#x27;</span>][<span class=\"number\">0</span>:self.limit].rstrip() + <span class=\"string\">&#x27;...&#x27;</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> item</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> DropItem</span><br></pre></td></tr></table></figure>\n\n<p>这段代码在构造方法里定义了限制长度为50，实现了<code>process_item</code>方法，其参数是<code>item</code>和<code>spider</code>。首先该方法判断<code>item</code>的<code>text</code>属性是否存在，如果不存在，则抛出<code>DropItem</code>异常；如果存在，再判断长度是否大于50，如果大于，那就截断然后拼接省略号，再将<code>item</code>返回即可。</p>\n<p>将处理后的<code>item</code>存入<code>MongoDB</code>，定义另外一个<code>Pipeline</code>。同样在<code>pipelines.py</code>中，实现另一个类<code>MongoPipeline</code>，内容如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pymongo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @classmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">from_crawler</span>(<span class=\"params\">cls, crawler</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> cls(mongo_uri=crawler.settings.get(<span class=\"string\">&#x27;MONGO_URI&#x27;</span>), mongo_db=crawler.settings.get(<span class=\"string\">&#x27;MONGO_DB&#x27;</span>))</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">open_spider</span>(<span class=\"params\">self, spider</span>):</span></span><br><span class=\"line\">        self.client = pymongo.MongoClient(self.mongo_uri)</span><br><span class=\"line\">        self.db = self.client[self.mongo_db]</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">process_item</span>(<span class=\"params\">self, item, spider</span>):</span> </span><br><span class=\"line\">        name = item.__class__.__name__ </span><br><span class=\"line\">        self.db[name].insert(<span class=\"built_in\">dict</span>(item)) </span><br><span class=\"line\">        <span class=\"keyword\">return</span> item </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">close_spider</span>(<span class=\"params\">self, spider</span>):</span> </span><br><span class=\"line\">        self.client.close()</span><br></pre></td></tr></table></figure>\n\n<p><code>MongoPipeline</code>类实现了<code>API</code>定义的另外几个方法。</p>\n<ul>\n<li><code>from_crawler</code>：这是一个类方法，用<code>@classmethod</code>标识，是一种依赖注入的方式，方法的参数就是<code>crawler</code>，通过<code>crawler</code>这个参数我们可以拿到全局配置的每个配置信息，在全局配置<code>settings.py</code>中可以定义<code>MONGO_URI</code>和<code>MONGO_DB</code>来指定<code>MongoDB</code>连接需要的地址和数据库名称，拿到配置信息之后返回类对象即可。所以这个方法的定义主要是用来获取<code>settings.py</code>中的配置的。</li>\n<li><code>open_spider</code>：当<code>Spider</code>被开启时，这个方法被调用。在这里主要进行了一些初始化操作。</li>\n<li><code>close_spider</code>：当<code>Spider</code>被关闭时，这个方法会调用，在这里将数据库连接关闭。</li>\n</ul>\n<p>最主要的<code>process_item</code>方法则执行了数据插入操作。</p>\n<p>定义好<code>TextPipeline</code>和<code>MongoPipeline</code>这两个类后，需要在<code>settings.py</code>中使用它们。<code>MongoDB</code>的连接信息还需要定义。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ITEM_PIPELINES = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;tutorial.pipelines.TextPipeline&#x27;</span>: <span class=\"number\">300</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;tutorial.pipelines.MongoPipeline&#x27;</span>: <span class=\"number\">400</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">MONGO_URI=<span class=\"string\">&#x27;localhost&#x27;</span></span><br><span class=\"line\">MONGO_DB=<span class=\"string\">&#x27;tutorial&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>赋值<code>ITEM_PIPELINES</code>字典，键名是<code>Pipeline</code>的类名称，键值是调用优先级，是一个数字，数字越小则对应的<code>Pipeline</code>越先被调用。<br>再重新执行爬取，命令如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy crawl quotes</span><br></pre></td></tr></table></figure>\n\n<p>爬取结束后，<code>MongoDB</code>中创建了一个<code>tutorial</code>的数据库、<code>QuoteItem</code>的表。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"抓取目标\"><a href=\"#抓取目标\" class=\"headerlink\" title=\"抓取目标\"></a>抓取目标</h2><p>要完成的任务如下。</p>\n<ul>\n<li>创建一个<code>Scrapy</code>项目。</li>\n<li>创建一个<code>Spider</code>来抓取站点和处理数据。</li>\n<li>通过命令行将抓取的内容导出。</li>\n<li>将抓取的内容保存到<code>MongoDB</code>数据库。</li>\n</ul>\n<p>抓取的目标站点为<a href=\"http://quotes.toscrape.com/\"></a>。</p>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p>安装好<code>scrapy</code>框架、<code>MongoDB</code>和<code>PyMongo</code>库。</p>\n<h2 id=\"创建项目\"><a href=\"#创建项目\" class=\"headerlink\" title=\"创建项目\"></a>创建项目</h2><p>创建一个<code>Scrapy</code>项目，项目文件可以直接用<code>Scrapy</code>命令生成，命令如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy startproject tutorial</span><br></pre></td></tr></table></figure>\n\n<p>这个命令将会创建一个名为<code>tutorial</code>的文件夹，文件夹结构如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy.cfg    <span class=\"comment\"># Scrapy 部署时的配置文件 </span></span><br><span class=\"line\">tutorial    <span class=\"comment\"># 项目的模块，引入的时候需要从这里引入 </span></span><br><span class=\"line\">  __init__.py </span><br><span class=\"line\">  items.py    <span class=\"comment\"># Items 的定义，定义爬取的数据结构 </span></span><br><span class=\"line\">  middlewares.py     <span class=\"comment\"># Middlewares 的定义，定义爬取时的中间件 </span></span><br><span class=\"line\">  pipelines.py    <span class=\"comment\"># Pipelines 的定义，定义数据管道 </span></span><br><span class=\"line\">  settings.py     <span class=\"comment\"># 配置文件 </span></span><br><span class=\"line\">  spiders     <span class=\"comment\"># 放置 Spiders 的文件夹 </span></span><br><span class=\"line\">    __init__.py</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建Spider\"><a href=\"#创建Spider\" class=\"headerlink\" title=\"创建Spider\"></a>创建Spider</h2><p><code>Spider</code>是自己定义的类，<code>Scrapy</code>用它从网页里抓取内容，并解析抓取的结果。不过这个类必须继承<code>Scrapy</code>提供的<code>Spider</code>类<code>scrapy.Spider</code>，还要定义<code>Spider</code>的名称和起始请求，以及怎样处理爬取后的结果的方法。</p>\n<p>也可以使用命令行创建一个<code>Spider</code>。比如要生成<code>Quotes</code>这个<code>Spider</code>，可以执行如下命令：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>scrapy genspider quotes quotes.toscrape.com     </span><br><span class=\"line\">Created spider <span class=\"string\">&#x27;quotes&#x27;</span> using template <span class=\"string\">&#x27;basic&#x27;</span> <span class=\"keyword\">in</span> module:</span><br><span class=\"line\">  tutorial.spiders.quotes</span><br></pre></td></tr></table></figure>\n\n<p>进入刚才创建的<code>tutorial</code>文件夹，然后执行<code>genspider</code>命令。第一个参数是<code>Spider</code>的名称，第二个参数是<code>网站域名</code>。执行完毕之后，<code>spiders</code>文件夹中多了一个<code>quotes.py</code>，它就是刚刚创建的<code>Spider</code>，内容如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> scrapy</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">QuotesSpider</span>(<span class=\"params\">scrapy.Spider</span>):</span></span><br><span class=\"line\">    name = <span class=\"string\">&#x27;quotes&#x27;</span></span><br><span class=\"line\">    allowed_domains = [<span class=\"string\">&#x27;quotes.toscrape.com&#x27;</span>]</span><br><span class=\"line\">    start_urls = [<span class=\"string\">&#x27;http://quotes.toscrape.com/&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse</span>(<span class=\"params\">self, response</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n\n<p>这里有三个属性——<code>name</code>、<code>allowed_domains</code>和<code>start_urls</code>，还有一个方法<code>parse</code>。</p>\n<ul>\n<li><code>name</code>：它是每个项目唯一的名字，用来区分不同的<code>Spider</code>。</li>\n<li><code>allowed_domains</code>：它是允许爬取的域名，如果初始或后续的请求链接不是这个域名下的，则请求链接会被过滤掉。</li>\n<li><code>start_urls</code>：它包含了<code>Spider</code>在启动时爬取的<code>url</code>列表，初始请求是由它来定义的。</li>\n<li><code>parse</code>：它是<code>Spider</code>的一个方法。默认情况下，被调用时<code>start_urls</code>里面的链接构成的请求完成下载执行后，返回的响应就会作为唯一的参数传递给这个函数。该方法负责解析返回的响应、提取数据或者进一 步生成要处理的请求。</li>\n</ul>\n<h2 id=\"创建Item\"><a href=\"#创建Item\" class=\"headerlink\" title=\"创建Item\"></a>创建Item</h2><p><code>Item</code>是保存爬虫数据的容器，它的使用方法和字典类似，不过相比字典，<code>Item</code>多了额外的保护机制，可以避免拼写错误或者定义字段错误。</p>\n<p>创建<code>Item</code>需要继承<code>scrapy.Item</code>类，并且定义类型为<code>scrapy.Field</code>的字段。观察目标网站，可以获取到的内容有<code>text</code>、<code>author</code>、<code>tags</code>。</p>\n<p>定义<code>Item</code>，此时将<code>items.py</code>修改如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> scrapy</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">QuoteItem</span>(<span class=\"params\">scrapy.Item</span>):</span></span><br><span class=\"line\">    <span class=\"comment\"># define the fields for your item here like:</span></span><br><span class=\"line\">    <span class=\"comment\"># name = scrapy.Field()</span></span><br><span class=\"line\">    text = scrapy.Field()</span><br><span class=\"line\">    author = scrapy.Field()</span><br><span class=\"line\">    tags = scrapy.Field()</span><br></pre></td></tr></table></figure>\n\n<p>这里定义了三个字段，将类的名称修改为<code>QuoteItem</code>，接下来爬取时会使用到这个<code>Item</code>。</p>\n<h2 id=\"解析Response\"><a href=\"#解析Response\" class=\"headerlink\" title=\"解析Response\"></a>解析Response</h2><p><code>parse</code>方法的参数<code>response</code>是<code>start_urls</code>里面的链接爬取后的结果。所以在<code>parse</code>方法中，可以直接对<code>response</code>变量包含的内容进行解析，比如浏览请求结果的网页源代码，或者进一步分析源代码内容，或者找出结果中的链接而得到下一个请求。</p>\n<p>首先看看网页结构，如图所示。每一页都有多个<code>class</code>为<code>quote</code>的区块，每个区块内都包含<code>text</code>、<code>author</code>、<code>tags</code>。那么先找出所有的<code>quote</code>，然后提取每一个<code>quote</code>中的内容。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>提取的方式可以是<code>CSS</code>选择器或<code>XPath</code>选择器。在这里使用<code>CSS</code>选择器进行选择，<code>parse</code>方法的改写如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">QuotesSpider</span>(<span class=\"params\">scrapy.Spider</span>):</span></span><br><span class=\"line\">    name = <span class=\"string\">&#x27;quotes&#x27;</span></span><br><span class=\"line\">    allowed_domains = [<span class=\"string\">&#x27;http://quotes.toscrape.com/&#x27;</span>]</span><br><span class=\"line\">    start_urls = [<span class=\"string\">&#x27;http://http://quotes.toscrape.com//&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse</span>(<span class=\"params\">self, response</span>):</span></span><br><span class=\"line\">        quotes = response.css(<span class=\"string\">&#x27;.quote&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> quote <span class=\"keyword\">in</span> quotes:</span><br><span class=\"line\">            text = quote.css(<span class=\"string\">&#x27;.text::text&#x27;</span>).extract_first()</span><br><span class=\"line\">            author = quote.css(<span class=\"string\">&#x27;.author::text&#x27;</span>).extract_first()</span><br><span class=\"line\">            tags = quote.css(<span class=\"string\">&#x27;.tags .tag::text&#x27;</span>).extract()</span><br></pre></td></tr></table></figure>\n\n<p>对于<code>text</code>，获取结果的第一个元素即可，所以使用<code>extract_first</code>方法，对于<code>tags</code>，要获取所有结果组成的列表，所以使用<code>extract</code>方法。</p>\n<h2 id=\"使用Item\"><a href=\"#使用Item\" class=\"headerlink\" title=\"使用Item\"></a>使用Item</h2><p>上文定义了<code>Item</code>，接下来就要使用它了。<code>Item</code>可以理解为一个字典，不过在声明的时候需要实例化。然后依次用刚才解析的结果赋值<code>Item</code>的每一个字段，最后将<code>Item</code>返回即可。</p>\n<p><code>QuotesSpider</code>的改写如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse</span>(<span class=\"params\">self, response</span>):</span></span><br><span class=\"line\">    quotes = response.css(<span class=\"string\">&#x27;.quote&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> quote <span class=\"keyword\">in</span> quotes:</span><br><span class=\"line\">        item = QuoteItem()</span><br><span class=\"line\">        item[<span class=\"string\">&#x27;text&#x27;</span>] = quote.css(<span class=\"string\">&#x27;.text::text&#x27;</span>).extract_first()</span><br><span class=\"line\">        item[<span class=\"string\">&#x27;author&#x27;</span>] = quote.css(<span class=\"string\">&#x27;.author::text&#x27;</span>).extract_first()</span><br><span class=\"line\">        item[<span class=\"string\">&#x27;tags&#x27;</span>] = quote.css(<span class=\"string\">&#x27;.tags .tag::text&#x27;</span>).extract()</span><br><span class=\"line\">        <span class=\"keyword\">yield</span> item</span><br></pre></td></tr></table></figure>\n\n<p>如此一来，首页的所有内容被解析出来，并被赋值成了一个个<code>QuoteItem</code>。</p>\n<h2 id=\"后续Request\"><a href=\"#后续Request\" class=\"headerlink\" title=\"后续Request\"></a>后续Request</h2><p>接下来就需要从当前页面中找到信息来生成下一个请求，然后在下一个请求的页面里面找到信息再构造下一个请求。这样循环往复迭代，从而实现整站的爬取。</p>\n<p>将刚才的页面拉到最底部，如图所示。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>有一个<code>Next</code>按钮，查看一下源代码，可以发现它的链接是<code>/page/2/</code>，实际上全链接就是：<code>http://quotes.toscrape.com/page/2</code>，通过这个链接我们就可以构造下一个请求。</p>\n<p>构造请求时需要用到<code>scrapy.Request</code>。这里传递两个参数——<code>url</code>和<code>callback</code>，这两个参数的说明如下。</p>\n<ul>\n<li><code>url</code>：它是请求链接。</li>\n<li><code>callback</code>：它是回调函数。当指定了该回调函数的请求完成之后，获取到响应，引擎会将该响应作为参数传递给这个回调函数。回调函数进行解析或生成下一个请求，回调函数如上文的<code>parse()</code>所示。</li>\n</ul>\n<p>由于<code>parse</code>就是解析<code>text</code>、<code>author</code>、<code>tags</code>的方法，而下一页的结构和刚才已经解析的页面结构是一样的，所以可以再次使用<code>parse</code>方法来做页面解析。</p>\n<p>接下来要做的就是利用选择器得到下一页链接并生成请求，在<code>parse</code>方法后追加如下的代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">next</span> = response.css(<span class=\"string\">&#x27;.pager .next a::attr(href)&#x27;</span>).extract_first()</span><br><span class=\"line\">url = response.urljoin(<span class=\"built_in\">next</span>)</span><br><span class=\"line\"><span class=\"keyword\">yield</span> scrapy.Request(url=url, callback=self.parse, dont_filter=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n<p>第一句代码首先通过<code>CSS</code>选择器获取下一个页面的链接，即要获取<code>a</code>超链接中的<code>href</code>属性。这里用到了<code>::attr(href)</code>操作。然后再调用<code>extract_first</code>方法获取内容。</p>\n<p>第二句代码调用了<code>urljoin</code>方法，<code>urljoin()</code>方法可以将相对<code>URL</code>构造成一个绝对的<code>URL</code>。例如，获取到的下一页地址是<code>/page/2</code>，<code>urljoin</code>方法处理后得到的结果就是：<code>http://quotes.toscrape.com/page/2/</code>。</p>\n<p>第三句代码通过<code>url</code>和<code>callback</code>变量构造了一个新的请求，回调函数<code>callback</code>依然使用<code>parse</code>方法。这个请求完成后，响应会重新经过<code>parse</code>方法处理，得到第二页的解析结果，然后生成第二页的下一页，也就是第三页的请求。这样爬虫就进入了一个循环，直到最后一页。<code>dont_filter</code>设置为<code>Ture</code>不进行域名过滤，这样就能继续爬取。</p>\n<p>通过几行代码，就轻松实现了一个抓取循环，将每个页面的结果抓取下来了。现在，改写之后的整个<code>Spider</code>类如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> scrapy</span><br><span class=\"line\"><span class=\"keyword\">from</span> tutorial.items <span class=\"keyword\">import</span> QuoteItem</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">QuotesSpider</span>(<span class=\"params\">scrapy.Spider</span>):</span></span><br><span class=\"line\">    name = <span class=\"string\">&#x27;quotes&#x27;</span></span><br><span class=\"line\">    allowed_domains = [<span class=\"string\">&#x27;quotes.toscrape.com/&#x27;</span>]</span><br><span class=\"line\">    start_urls = [<span class=\"string\">&#x27;http://quotes.toscrape.com/&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse</span>(<span class=\"params\">self, response</span>):</span></span><br><span class=\"line\">        quotes = response.css(<span class=\"string\">&#x27;.quote&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> quote <span class=\"keyword\">in</span> quotes:</span><br><span class=\"line\">            item = QuoteItem()</span><br><span class=\"line\">            item[<span class=\"string\">&#x27;text&#x27;</span>] = quote.css(<span class=\"string\">&#x27;.text::text&#x27;</span>).extract_first()</span><br><span class=\"line\">            item[<span class=\"string\">&#x27;author&#x27;</span>] = quote.css(<span class=\"string\">&#x27;.author::text&#x27;</span>).extract_first()</span><br><span class=\"line\">            item[<span class=\"string\">&#x27;tags&#x27;</span>] = quote.css(<span class=\"string\">&#x27;.tags .tag::text&#x27;</span>).extract()</span><br><span class=\"line\">            <span class=\"keyword\">yield</span> item</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">next</span> = response.css(<span class=\"string\">&#x27;.pager .next a::attr(href)&#x27;</span>).extract_first()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">next</span> !== <span class=\"string\">&quot;&quot;</span>:</span><br><span class=\"line\">          url = response.urljoin(<span class=\"built_in\">next</span>)</span><br><span class=\"line\">          <span class=\"keyword\">yield</span> scrapy.Request(url=url, callback=self.parse, dont_filter=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h2><p>进入目录，运行如下命令：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy crawl quotes</span><br></pre></td></tr></table></figure>\n\n<p>爬虫一边解析，一边翻页，直至将所有内容抓取完毕，然后终止。</p>\n<p>最后，<code>Scrapy</code>输出了整个抓取过程的统计信息，如请求的字节数、请求次数、响应次数、完成原因等。</p>\n<h2 id=\"保存到文件\"><a href=\"#保存到文件\" class=\"headerlink\" title=\"保存到文件\"></a>保存到文件</h2><p><code>Scrapy</code>提供的<code>Feed Exports</code>可以轻松将抓取结果输出。例如，想将上面的结果保存成<code>JSON</code>文件，可以执行如下命令：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy crawl quotes -o quotes.json</span><br></pre></td></tr></table></figure>\n\n<p>命令运行后，项目内多了一个<code>quotes.json</code>文件，文件包含了刚才抓取的所有内容，内容是<code>JSON</code>格式。</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<p>另外还可以每一个<code>Item</code>输出一行<code>JSON</code>，输出后缀为<code>jl</code>，为<code>jsonline</code>的缩写，命令如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy crawl quotes -o quotes.jl</span><br></pre></td></tr></table></figure>\n\n<p>或</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy crawl quotes -o quotes.jsonlines</span><br></pre></td></tr></table></figure>\n\n<p>输出格式还支持很多种，例如<code>csv</code>、<code>xml</code>、<code>pickle</code>、<code>marshal</code>等，还支持<code>ftp</code>、<code>s3</code> 等远程输出，另外还可以通过自定义<code>ItemExporter</code>来实现其他的输出。</p>\n<p>例如，下面命令对应的输出分别为<code>csv</code>、<code>xml</code>、<code>pickle</code>、<code>marshal</code>格式以及<code>ftp</code>远程输出：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy crawl quotes -o quotes.csv</span><br><span class=\"line\">scrapy crawl quotes -o quotes.xml</span><br><span class=\"line\">scrapy crawl quotes -o quotes.pickle</span><br><span class=\"line\">scrapy crawl quotes -o quotes.marshal</span><br><span class=\"line\">scrapy crawl quotes -o ftp://user:<span class=\"keyword\">pass</span>@ftp.example.com/path/to/quotes.csv </span><br></pre></td></tr></table></figure>\n\n<p>其中，<code>ftp</code>输出需要正确配置用户名、密码、地址、输出路径，否则会报错。通过<code>Scrapy</code>提供的<code>Feed Exports</code>，可以轻松地输出抓取结果到文件。对于一些小型项目来说，这应该足够了。不过如果想要更复杂的输出，如输出到数据库等，可以使用<code>ItemPileline</code>来完成。</p>\n<h2 id=\"使用ItemPileline\"><a href=\"#使用ItemPileline\" class=\"headerlink\" title=\"使用ItemPileline\"></a>使用ItemPileline</h2><p>如果想进行更复杂的操作，如将结果保存到<code>MongoDB</code>数据库，或者筛选某些有用的<code>Item</code>，则可以定义<code>ItemPipeline</code>来实现。</p>\n<p><code>ItemPipeline</code>为项目管道。当<code>Item</code>生成后，它会自动被送到<code>ItemPipeline</code>进行处理，常用<code>ItemPipeline</code>来做如下操作。</p>\n<ul>\n<li>清洗<code>HTML</code>数据；</li>\n<li>验证爬取数据，检查爬取字段；</li>\n<li>查重并丢弃重复内容；</li>\n<li>将爬取结果储存到数据库。</li>\n</ul>\n<p>要实现<code>ItemPipeline</code>很简单，只需要定义一个类并实现<code>process_item</code>方法即可。启用<code>ItemPipeline</code>后，<code>ItemPipeline</code>会自动调用这个方法。<code>process_item</code>方法必须返回包含数据的字典或<code>Item</code>对象，或者抛出<code>DropItem</code>异常。</p>\n<p><code>process_item</code>方法有两个参数。一个参数是<code>item</code>，每次<code>Spider</code>生成的<code>Item</code>都会作为参数传递过来。另一个参数是<code>spider</code>，就是<code>Spider</code>的实例。</p>\n<p>接下来，实现一个<code>ItemPipeline</code>，筛掉<code>text</code>长度大于<code>50</code>的<code>Item</code>，并将结果保存到<code>MongoDB</code>。</p>\n<p>修改项目里的<code>pipelines</code>.py文件，之前用命令行自动生成的文件内容可以删掉，增加一个<code>TextPipeline</code>类，内容如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> scrapy.exceptions <span class=\"keyword\">import</span> DropItem</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TextPipeline</span>(<span class=\"params\"><span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        self.limit = <span class=\"number\">50</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">process_item</span>(<span class=\"params\">self, item, spider</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> item[<span class=\"string\">&#x27;text&#x27;</span>]:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(item[<span class=\"string\">&#x27;text&#x27;</span>]) &gt; self.limit:</span><br><span class=\"line\">                item[<span class=\"string\">&#x27;text&#x27;</span>] =item[<span class=\"string\">&#x27;text&#x27;</span>][<span class=\"number\">0</span>:self.limit].rstrip() + <span class=\"string\">&#x27;...&#x27;</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> item</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> DropItem</span><br></pre></td></tr></table></figure>\n\n<p>这段代码在构造方法里定义了限制长度为50，实现了<code>process_item</code>方法，其参数是<code>item</code>和<code>spider</code>。首先该方法判断<code>item</code>的<code>text</code>属性是否存在，如果不存在，则抛出<code>DropItem</code>异常；如果存在，再判断长度是否大于50，如果大于，那就截断然后拼接省略号，再将<code>item</code>返回即可。</p>\n<p>将处理后的<code>item</code>存入<code>MongoDB</code>，定义另外一个<code>Pipeline</code>。同样在<code>pipelines.py</code>中，实现另一个类<code>MongoPipeline</code>，内容如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pymongo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @classmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">from_crawler</span>(<span class=\"params\">cls, crawler</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> cls(mongo_uri=crawler.settings.get(<span class=\"string\">&#x27;MONGO_URI&#x27;</span>), mongo_db=crawler.settings.get(<span class=\"string\">&#x27;MONGO_DB&#x27;</span>))</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">open_spider</span>(<span class=\"params\">self, spider</span>):</span></span><br><span class=\"line\">        self.client = pymongo.MongoClient(self.mongo_uri)</span><br><span class=\"line\">        self.db = self.client[self.mongo_db]</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">process_item</span>(<span class=\"params\">self, item, spider</span>):</span> </span><br><span class=\"line\">        name = item.__class__.__name__ </span><br><span class=\"line\">        self.db[name].insert(<span class=\"built_in\">dict</span>(item)) </span><br><span class=\"line\">        <span class=\"keyword\">return</span> item </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">close_spider</span>(<span class=\"params\">self, spider</span>):</span> </span><br><span class=\"line\">        self.client.close()</span><br></pre></td></tr></table></figure>\n\n<p><code>MongoPipeline</code>类实现了<code>API</code>定义的另外几个方法。</p>\n<ul>\n<li><code>from_crawler</code>：这是一个类方法，用<code>@classmethod</code>标识，是一种依赖注入的方式，方法的参数就是<code>crawler</code>，通过<code>crawler</code>这个参数我们可以拿到全局配置的每个配置信息，在全局配置<code>settings.py</code>中可以定义<code>MONGO_URI</code>和<code>MONGO_DB</code>来指定<code>MongoDB</code>连接需要的地址和数据库名称，拿到配置信息之后返回类对象即可。所以这个方法的定义主要是用来获取<code>settings.py</code>中的配置的。</li>\n<li><code>open_spider</code>：当<code>Spider</code>被开启时，这个方法被调用。在这里主要进行了一些初始化操作。</li>\n<li><code>close_spider</code>：当<code>Spider</code>被关闭时，这个方法会调用，在这里将数据库连接关闭。</li>\n</ul>\n<p>最主要的<code>process_item</code>方法则执行了数据插入操作。</p>\n<p>定义好<code>TextPipeline</code>和<code>MongoPipeline</code>这两个类后，需要在<code>settings.py</code>中使用它们。<code>MongoDB</code>的连接信息还需要定义。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ITEM_PIPELINES = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;tutorial.pipelines.TextPipeline&#x27;</span>: <span class=\"number\">300</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;tutorial.pipelines.MongoPipeline&#x27;</span>: <span class=\"number\">400</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">MONGO_URI=<span class=\"string\">&#x27;localhost&#x27;</span></span><br><span class=\"line\">MONGO_DB=<span class=\"string\">&#x27;tutorial&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>赋值<code>ITEM_PIPELINES</code>字典，键名是<code>Pipeline</code>的类名称，键值是调用优先级，是一个数字，数字越小则对应的<code>Pipeline</code>越先被调用。<br>再重新执行爬取，命令如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy crawl quotes</span><br></pre></td></tr></table></figure>\n\n<p>爬取结束后，<code>MongoDB</code>中创建了一个<code>tutorial</code>的数据库、<code>QuoteItem</code>的表。</p>\n"},{"title":"web网页基础","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-11T15:32:38.000Z","pic":null,"_content":"\n# 网页的组成\n\n首先，我们来了解网页的基本组成，网页可以分为三大部分：`HTML`、`CSS`和`JavaScript`。 如果把网页比作一个人的话，`HTML`相当于骨架，`JavaScript`相当于肌肉，`CSS`相当于皮肤，三者结合起来才能形成一个完整的网页。下面我们来分别介绍一下这三部分的功能。\n\n## HTML\n\n`HTML`是用来描述网页的一种语言，其全称叫作`Hyper Text Markup Language`，即超文本标记语言。\n\n我们浏览的网页包括文字、按钮、图片和视频等各种复杂的元素，其基础架构就是`HTML`。不同类型的元素通过不同类型的标签来表示，如图片用`img`标签表示，视频用`video`标签表示，段落用`p`标签表示，它们之间的布局又常通过布局标签`div`嵌套组合而成，各种标签通过不同的排列和嵌套就可以形成网页的框架。 \n\n在`Chrome`浏览器中打开百度，右击并选择 “检查”项（或按`F12键`），打开开发者模式，这时在`Elements`选项卡中即可看到网页的源代码，如图所示。\n\n![HTML结构](Screenshot_1.png)\n\n这就是`HTML`，整个网页就是由各种标签嵌套组合而成的。这些标签定义的节点元素相互嵌套和组合形成了复杂的层次关系，就形成了网页的架构。\n\n## CSS\n\n虽然`HTML`定义了网页的结构，但是只有`HTML`页面的布局并不美观，可能只是简单的节点元素的排列，为了让网页看起来更好看一些，这里就需要借助`CSS`了。\n\n`CSS`，全称叫作`Cascading Style Sheets`，即`层叠样式表`。“层叠”是指当在HTML中引用了数个样式文件，并且样式发生冲突时，浏览器能依据层叠顺序处理。“样式”指网页中文字大小、颜色、元素间距、排列等 格式。\n\n`CSS`是目前唯一的网页页面排版样式标准，有了它的帮助，页面才会变得更为美观。例如：\n\n```css\n#head_wrapper.s-ps-islite .s-p-top { \n    position: absolute; \n    bottom: 40px; \n    width: 100%; \n    height: 181px; \n    }\n```\n\n这就是一个`CSS`样式。大括号前面是一个`CSS选择器`。此选择器的作用是首先选中`id`为`head_wrapper`且`class` 为`s-ps-islite`的节点，然后再选中其内部的`class`为`s-p-top`的节点。大括号内部写的就是一条条样式规则，例如`position`指定了这个元素的布局方式为**绝对布局**，`bottom`指定元素的下边距为**40像素**，`width`指定了宽度为**100%**占满父元素，`height`则指定了元素的**高度**。也就是说，我们将位置、宽度、高度等样式配置统一写成这样的形式，然后用大括号括起来，接着在开头再加上`CSS`选择器，这就代表这个样式对`CSS`选择器选中的元素生效，元素就会根据此样式来展示了。\n\n在网页中，一般会统一定义整个网页的样式规则，并写入`CSS`文件中（其后缀为css）。在HTML中，只需要用`link`标签即可引入写好的`CSS`文件，这样整个页面就会变得美观、优雅。\n\n## JavaScript \n\n`JavaScript`，简称`JS`，是一种脚本语言。HTML和CSS配合使用，提供给用户的只是一种静态信息，缺乏交互性。我们在网页里可能会看到一些交互和动画效果，如下载进度条、提示框、轮播图等，这通常就是`JavaScript`的功劳。它的出现使得用户与信息之间不只是一种浏览与显示的关系，而是实现了一种**实时、动态、交互**的页面功能。\n\n`JavaScript`通常也是以单独的文件形式加载的，后缀为`js`，在 HTML中通过`script标签`即可引入，例如:\n\n```html\n<script src=\"jquery-2.1.0.js\"></script>\n```\n\n综上所述，HTML定义了网页的内容和结构，CSS描述了网页的布局，`JavaScript`定义了网页的行为。\n","source":"_posts/web网页基础.md","raw":"---\ntitle: web网页基础\ntags:\n  - html\n  - css\n  - javascript\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-11 23:32:38\ncategories: 爬虫\npic:\n---\n\n# 网页的组成\n\n首先，我们来了解网页的基本组成，网页可以分为三大部分：`HTML`、`CSS`和`JavaScript`。 如果把网页比作一个人的话，`HTML`相当于骨架，`JavaScript`相当于肌肉，`CSS`相当于皮肤，三者结合起来才能形成一个完整的网页。下面我们来分别介绍一下这三部分的功能。\n\n## HTML\n\n`HTML`是用来描述网页的一种语言，其全称叫作`Hyper Text Markup Language`，即超文本标记语言。\n\n我们浏览的网页包括文字、按钮、图片和视频等各种复杂的元素，其基础架构就是`HTML`。不同类型的元素通过不同类型的标签来表示，如图片用`img`标签表示，视频用`video`标签表示，段落用`p`标签表示，它们之间的布局又常通过布局标签`div`嵌套组合而成，各种标签通过不同的排列和嵌套就可以形成网页的框架。 \n\n在`Chrome`浏览器中打开百度，右击并选择 “检查”项（或按`F12键`），打开开发者模式，这时在`Elements`选项卡中即可看到网页的源代码，如图所示。\n\n![HTML结构](Screenshot_1.png)\n\n这就是`HTML`，整个网页就是由各种标签嵌套组合而成的。这些标签定义的节点元素相互嵌套和组合形成了复杂的层次关系，就形成了网页的架构。\n\n## CSS\n\n虽然`HTML`定义了网页的结构，但是只有`HTML`页面的布局并不美观，可能只是简单的节点元素的排列，为了让网页看起来更好看一些，这里就需要借助`CSS`了。\n\n`CSS`，全称叫作`Cascading Style Sheets`，即`层叠样式表`。“层叠”是指当在HTML中引用了数个样式文件，并且样式发生冲突时，浏览器能依据层叠顺序处理。“样式”指网页中文字大小、颜色、元素间距、排列等 格式。\n\n`CSS`是目前唯一的网页页面排版样式标准，有了它的帮助，页面才会变得更为美观。例如：\n\n```css\n#head_wrapper.s-ps-islite .s-p-top { \n    position: absolute; \n    bottom: 40px; \n    width: 100%; \n    height: 181px; \n    }\n```\n\n这就是一个`CSS`样式。大括号前面是一个`CSS选择器`。此选择器的作用是首先选中`id`为`head_wrapper`且`class` 为`s-ps-islite`的节点，然后再选中其内部的`class`为`s-p-top`的节点。大括号内部写的就是一条条样式规则，例如`position`指定了这个元素的布局方式为**绝对布局**，`bottom`指定元素的下边距为**40像素**，`width`指定了宽度为**100%**占满父元素，`height`则指定了元素的**高度**。也就是说，我们将位置、宽度、高度等样式配置统一写成这样的形式，然后用大括号括起来，接着在开头再加上`CSS`选择器，这就代表这个样式对`CSS`选择器选中的元素生效，元素就会根据此样式来展示了。\n\n在网页中，一般会统一定义整个网页的样式规则，并写入`CSS`文件中（其后缀为css）。在HTML中，只需要用`link`标签即可引入写好的`CSS`文件，这样整个页面就会变得美观、优雅。\n\n## JavaScript \n\n`JavaScript`，简称`JS`，是一种脚本语言。HTML和CSS配合使用，提供给用户的只是一种静态信息，缺乏交互性。我们在网页里可能会看到一些交互和动画效果，如下载进度条、提示框、轮播图等，这通常就是`JavaScript`的功劳。它的出现使得用户与信息之间不只是一种浏览与显示的关系，而是实现了一种**实时、动态、交互**的页面功能。\n\n`JavaScript`通常也是以单独的文件形式加载的，后缀为`js`，在 HTML中通过`script标签`即可引入，例如:\n\n```html\n<script src=\"jquery-2.1.0.js\"></script>\n```\n\n综上所述，HTML定义了网页的内容和结构，CSS描述了网页的布局，`JavaScript`定义了网页的行为。\n","slug":"web网页基础","published":1,"updated":"2021-06-15T03:24:11.529Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2p002s44udeu8v0gzv","content":"<h1 id=\"网页的组成\"><a href=\"#网页的组成\" class=\"headerlink\" title=\"网页的组成\"></a>网页的组成</h1><p>首先，我们来了解网页的基本组成，网页可以分为三大部分：<code>HTML</code>、<code>CSS</code>和<code>JavaScript</code>。 如果把网页比作一个人的话，<code>HTML</code>相当于骨架，<code>JavaScript</code>相当于肌肉，<code>CSS</code>相当于皮肤，三者结合起来才能形成一个完整的网页。下面我们来分别介绍一下这三部分的功能。</p>\n<h2 id=\"HTML\"><a href=\"#HTML\" class=\"headerlink\" title=\"HTML\"></a>HTML</h2><p><code>HTML</code>是用来描述网页的一种语言，其全称叫作<code>Hyper Text Markup Language</code>，即超文本标记语言。</p>\n<p>我们浏览的网页包括文字、按钮、图片和视频等各种复杂的元素，其基础架构就是<code>HTML</code>。不同类型的元素通过不同类型的标签来表示，如图片用<code>img</code>标签表示，视频用<code>video</code>标签表示，段落用<code>p</code>标签表示，它们之间的布局又常通过布局标签<code>div</code>嵌套组合而成，各种标签通过不同的排列和嵌套就可以形成网页的框架。 </p>\n<p>在<code>Chrome</code>浏览器中打开百度，右击并选择 “检查”项（或按<code>F12键</code>），打开开发者模式，这时在<code>Elements</code>选项卡中即可看到网页的源代码，如图所示。</p>\n<p><img src=\"Screenshot_1.png\" alt=\"HTML结构\"></p>\n<p>这就是<code>HTML</code>，整个网页就是由各种标签嵌套组合而成的。这些标签定义的节点元素相互嵌套和组合形成了复杂的层次关系，就形成了网页的架构。</p>\n<h2 id=\"CSS\"><a href=\"#CSS\" class=\"headerlink\" title=\"CSS\"></a>CSS</h2><p>虽然<code>HTML</code>定义了网页的结构，但是只有<code>HTML</code>页面的布局并不美观，可能只是简单的节点元素的排列，为了让网页看起来更好看一些，这里就需要借助<code>CSS</code>了。</p>\n<p><code>CSS</code>，全称叫作<code>Cascading Style Sheets</code>，即<code>层叠样式表</code>。“层叠”是指当在HTML中引用了数个样式文件，并且样式发生冲突时，浏览器能依据层叠顺序处理。“样式”指网页中文字大小、颜色、元素间距、排列等 格式。</p>\n<p><code>CSS</code>是目前唯一的网页页面排版样式标准，有了它的帮助，页面才会变得更为美观。例如：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-id\">#head_wrapper</span><span class=\"selector-class\">.s-ps-islite</span> <span class=\"selector-class\">.s-p-top</span> &#123; </span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute; </span><br><span class=\"line\">    <span class=\"attribute\">bottom</span>: <span class=\"number\">40px</span>; </span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>; </span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">181px</span>; </span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>这就是一个<code>CSS</code>样式。大括号前面是一个<code>CSS选择器</code>。此选择器的作用是首先选中<code>id</code>为<code>head_wrapper</code>且<code>class</code> 为<code>s-ps-islite</code>的节点，然后再选中其内部的<code>class</code>为<code>s-p-top</code>的节点。大括号内部写的就是一条条样式规则，例如<code>position</code>指定了这个元素的布局方式为<strong>绝对布局</strong>，<code>bottom</code>指定元素的下边距为<strong>40像素</strong>，<code>width</code>指定了宽度为<strong>100%<strong>占满父元素，<code>height</code>则指定了元素的</strong>高度</strong>。也就是说，我们将位置、宽度、高度等样式配置统一写成这样的形式，然后用大括号括起来，接着在开头再加上<code>CSS</code>选择器，这就代表这个样式对<code>CSS</code>选择器选中的元素生效，元素就会根据此样式来展示了。</p>\n<p>在网页中，一般会统一定义整个网页的样式规则，并写入<code>CSS</code>文件中（其后缀为css）。在HTML中，只需要用<code>link</code>标签即可引入写好的<code>CSS</code>文件，这样整个页面就会变得美观、优雅。</p>\n<h2 id=\"JavaScript\"><a href=\"#JavaScript\" class=\"headerlink\" title=\"JavaScript\"></a>JavaScript</h2><p><code>JavaScript</code>，简称<code>JS</code>，是一种脚本语言。HTML和CSS配合使用，提供给用户的只是一种静态信息，缺乏交互性。我们在网页里可能会看到一些交互和动画效果，如下载进度条、提示框、轮播图等，这通常就是<code>JavaScript</code>的功劳。它的出现使得用户与信息之间不只是一种浏览与显示的关系，而是实现了一种<strong>实时、动态、交互</strong>的页面功能。</p>\n<p><code>JavaScript</code>通常也是以单独的文件形式加载的，后缀为<code>js</code>，在 HTML中通过<code>script标签</code>即可引入，例如:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;jquery-2.1.0.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>综上所述，HTML定义了网页的内容和结构，CSS描述了网页的布局，<code>JavaScript</code>定义了网页的行为。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"网页的组成\"><a href=\"#网页的组成\" class=\"headerlink\" title=\"网页的组成\"></a>网页的组成</h1><p>首先，我们来了解网页的基本组成，网页可以分为三大部分：<code>HTML</code>、<code>CSS</code>和<code>JavaScript</code>。 如果把网页比作一个人的话，<code>HTML</code>相当于骨架，<code>JavaScript</code>相当于肌肉，<code>CSS</code>相当于皮肤，三者结合起来才能形成一个完整的网页。下面我们来分别介绍一下这三部分的功能。</p>\n<h2 id=\"HTML\"><a href=\"#HTML\" class=\"headerlink\" title=\"HTML\"></a>HTML</h2><p><code>HTML</code>是用来描述网页的一种语言，其全称叫作<code>Hyper Text Markup Language</code>，即超文本标记语言。</p>\n<p>我们浏览的网页包括文字、按钮、图片和视频等各种复杂的元素，其基础架构就是<code>HTML</code>。不同类型的元素通过不同类型的标签来表示，如图片用<code>img</code>标签表示，视频用<code>video</code>标签表示，段落用<code>p</code>标签表示，它们之间的布局又常通过布局标签<code>div</code>嵌套组合而成，各种标签通过不同的排列和嵌套就可以形成网页的框架。 </p>\n<p>在<code>Chrome</code>浏览器中打开百度，右击并选择 “检查”项（或按<code>F12键</code>），打开开发者模式，这时在<code>Elements</code>选项卡中即可看到网页的源代码，如图所示。</p>\n<p><img src=\"Screenshot_1.png\" alt=\"HTML结构\"></p>\n<p>这就是<code>HTML</code>，整个网页就是由各种标签嵌套组合而成的。这些标签定义的节点元素相互嵌套和组合形成了复杂的层次关系，就形成了网页的架构。</p>\n<h2 id=\"CSS\"><a href=\"#CSS\" class=\"headerlink\" title=\"CSS\"></a>CSS</h2><p>虽然<code>HTML</code>定义了网页的结构，但是只有<code>HTML</code>页面的布局并不美观，可能只是简单的节点元素的排列，为了让网页看起来更好看一些，这里就需要借助<code>CSS</code>了。</p>\n<p><code>CSS</code>，全称叫作<code>Cascading Style Sheets</code>，即<code>层叠样式表</code>。“层叠”是指当在HTML中引用了数个样式文件，并且样式发生冲突时，浏览器能依据层叠顺序处理。“样式”指网页中文字大小、颜色、元素间距、排列等 格式。</p>\n<p><code>CSS</code>是目前唯一的网页页面排版样式标准，有了它的帮助，页面才会变得更为美观。例如：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-id\">#head_wrapper</span><span class=\"selector-class\">.s-ps-islite</span> <span class=\"selector-class\">.s-p-top</span> &#123; </span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute; </span><br><span class=\"line\">    <span class=\"attribute\">bottom</span>: <span class=\"number\">40px</span>; </span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>; </span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">181px</span>; </span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>这就是一个<code>CSS</code>样式。大括号前面是一个<code>CSS选择器</code>。此选择器的作用是首先选中<code>id</code>为<code>head_wrapper</code>且<code>class</code> 为<code>s-ps-islite</code>的节点，然后再选中其内部的<code>class</code>为<code>s-p-top</code>的节点。大括号内部写的就是一条条样式规则，例如<code>position</code>指定了这个元素的布局方式为<strong>绝对布局</strong>，<code>bottom</code>指定元素的下边距为<strong>40像素</strong>，<code>width</code>指定了宽度为<strong>100%<strong>占满父元素，<code>height</code>则指定了元素的</strong>高度</strong>。也就是说，我们将位置、宽度、高度等样式配置统一写成这样的形式，然后用大括号括起来，接着在开头再加上<code>CSS</code>选择器，这就代表这个样式对<code>CSS</code>选择器选中的元素生效，元素就会根据此样式来展示了。</p>\n<p>在网页中，一般会统一定义整个网页的样式规则，并写入<code>CSS</code>文件中（其后缀为css）。在HTML中，只需要用<code>link</code>标签即可引入写好的<code>CSS</code>文件，这样整个页面就会变得美观、优雅。</p>\n<h2 id=\"JavaScript\"><a href=\"#JavaScript\" class=\"headerlink\" title=\"JavaScript\"></a>JavaScript</h2><p><code>JavaScript</code>，简称<code>JS</code>，是一种脚本语言。HTML和CSS配合使用，提供给用户的只是一种静态信息，缺乏交互性。我们在网页里可能会看到一些交互和动画效果，如下载进度条、提示框、轮播图等，这通常就是<code>JavaScript</code>的功劳。它的出现使得用户与信息之间不只是一种浏览与显示的关系，而是实现了一种<strong>实时、动态、交互</strong>的页面功能。</p>\n<p><code>JavaScript</code>通常也是以单独的文件形式加载的，后缀为<code>js</code>，在 HTML中通过<code>script标签</code>即可引入，例如:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;jquery-2.1.0.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>综上所述，HTML定义了网页的内容和结构，CSS描述了网页的布局，<code>JavaScript</code>定义了网页的行为。</p>\n"},{"title":"优美图库抓取","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-06T05:56:08.000Z","pic":null,"_content":"\n\n\n\n\n## 抓取思路\n\n1.拿到主页面的源代码，然后提取子页面的链接接地址，`href`\n2.通过`href`拿到子页面的内容，从子页面中找到图片的下载地址 `img -> src`\n3.下载图片并保存\n\n实现代码如下：\n\n```python\nimport os\nimport time\nimport requests\nfrom bs4 import BeautifulSoup\n\nurl = \"https://www.umei.net/weimeitupian/hunshatupian/\"\n\ndef main_spider(url):\n    resp = requests.get(url, verify=False)\n    resp.encoding = \"utf-8\"\n    # print(resp.text)\n    return resp.text\n\ndef parse(content):\n    main_page = BeautifulSoup(content, \"html.parser\")\n    a_list = main_page.find(\"div\", class_=\"TypeList\").find_all(\"a\")\n    # print(a_list)\n    for a in a_list:\n        href = \"https://www.umei.net\" + a.get(\"href\")\n        # 接下来子页面源代码\n        child_page_text = main_spider(href)\n        # 从子页面中获取图片的下载路径\n        child_page = BeautifulSoup(child_page_text, \"html.parser\")\n        image_name = child_page.find(\"h1\", class_=\"inline\").text\n        image_href = child_page.find(\"div\", class_=\"ImageBody\").find(\"img\").get(\"src\")\n        print(image_name, image_href)\n        # 下载图片\n        image_resp = requests.get(image_href).content\n        if os.path.exists(\"./images\") == False:\n            os.mkdir(\"./images\")\n        with open (\"./images/\"+ image_name + \".jpg\", mode=\"wb\") as f:\n            f.write(image_resp) # 图片保存到文件\n        f.close()\n        print(\"{}.jpg保存成功\".format(image_name))\n        time.sleep(1)\n\n\nif __name__ == '__main__':\n    parse(main_spider(url))\n```\n\n没有做进一步的爬取，只爬取了一个页面。\n\n所有图片保存到文件夹`images`。\n\n![](Screenshot_1.webp)\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>","source":"_posts/优美图库抓取.md","raw":"---\ntitle: 优美图库抓取\ntags:\n  - python\n  - bs4\n  - requests\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-06 13:56:08\ncategories: 爬虫\npic:\n---\n\n\n\n\n\n## 抓取思路\n\n1.拿到主页面的源代码，然后提取子页面的链接接地址，`href`\n2.通过`href`拿到子页面的内容，从子页面中找到图片的下载地址 `img -> src`\n3.下载图片并保存\n\n实现代码如下：\n\n```python\nimport os\nimport time\nimport requests\nfrom bs4 import BeautifulSoup\n\nurl = \"https://www.umei.net/weimeitupian/hunshatupian/\"\n\ndef main_spider(url):\n    resp = requests.get(url, verify=False)\n    resp.encoding = \"utf-8\"\n    # print(resp.text)\n    return resp.text\n\ndef parse(content):\n    main_page = BeautifulSoup(content, \"html.parser\")\n    a_list = main_page.find(\"div\", class_=\"TypeList\").find_all(\"a\")\n    # print(a_list)\n    for a in a_list:\n        href = \"https://www.umei.net\" + a.get(\"href\")\n        # 接下来子页面源代码\n        child_page_text = main_spider(href)\n        # 从子页面中获取图片的下载路径\n        child_page = BeautifulSoup(child_page_text, \"html.parser\")\n        image_name = child_page.find(\"h1\", class_=\"inline\").text\n        image_href = child_page.find(\"div\", class_=\"ImageBody\").find(\"img\").get(\"src\")\n        print(image_name, image_href)\n        # 下载图片\n        image_resp = requests.get(image_href).content\n        if os.path.exists(\"./images\") == False:\n            os.mkdir(\"./images\")\n        with open (\"./images/\"+ image_name + \".jpg\", mode=\"wb\") as f:\n            f.write(image_resp) # 图片保存到文件\n        f.close()\n        print(\"{}.jpg保存成功\".format(image_name))\n        time.sleep(1)\n\n\nif __name__ == '__main__':\n    parse(main_spider(url))\n```\n\n没有做进一步的爬取，只爬取了一个页面。\n\n所有图片保存到文件夹`images`。\n\n![](Screenshot_1.webp)\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>","slug":"优美图库抓取","published":1,"updated":"2021-06-15T15:47:31.609Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2q002v44ud2ndzc7i1","content":"<h2 id=\"抓取思路\"><a href=\"#抓取思路\" class=\"headerlink\" title=\"抓取思路\"></a>抓取思路</h2><p>1.拿到主页面的源代码，然后提取子页面的链接接地址，<code>href</code><br>2.通过<code>href</code>拿到子页面的内容，从子页面中找到图片的下载地址 <code>img -&gt; src</code><br>3.下载图片并保存</p>\n<p>实现代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup</span><br><span class=\"line\"></span><br><span class=\"line\">url = <span class=\"string\">&quot;https://www.umei.net/weimeitupian/hunshatupian/&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main_spider</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    resp = requests.get(url, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">    resp.encoding = <span class=\"string\">&quot;utf-8&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># print(resp.text)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> resp.text</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse</span>(<span class=\"params\">content</span>):</span></span><br><span class=\"line\">    main_page = BeautifulSoup(content, <span class=\"string\">&quot;html.parser&quot;</span>)</span><br><span class=\"line\">    a_list = main_page.find(<span class=\"string\">&quot;div&quot;</span>, class_=<span class=\"string\">&quot;TypeList&quot;</span>).find_all(<span class=\"string\">&quot;a&quot;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># print(a_list)</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> a <span class=\"keyword\">in</span> a_list:</span><br><span class=\"line\">        href = <span class=\"string\">&quot;https://www.umei.net&quot;</span> + a.get(<span class=\"string\">&quot;href&quot;</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 接下来子页面源代码</span></span><br><span class=\"line\">        child_page_text = main_spider(href)</span><br><span class=\"line\">        <span class=\"comment\"># 从子页面中获取图片的下载路径</span></span><br><span class=\"line\">        child_page = BeautifulSoup(child_page_text, <span class=\"string\">&quot;html.parser&quot;</span>)</span><br><span class=\"line\">        image_name = child_page.find(<span class=\"string\">&quot;h1&quot;</span>, class_=<span class=\"string\">&quot;inline&quot;</span>).text</span><br><span class=\"line\">        image_href = child_page.find(<span class=\"string\">&quot;div&quot;</span>, class_=<span class=\"string\">&quot;ImageBody&quot;</span>).find(<span class=\"string\">&quot;img&quot;</span>).get(<span class=\"string\">&quot;src&quot;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(image_name, image_href)</span><br><span class=\"line\">        <span class=\"comment\"># 下载图片</span></span><br><span class=\"line\">        image_resp = requests.get(image_href).content</span><br><span class=\"line\">        <span class=\"keyword\">if</span> os.path.exists(<span class=\"string\">&quot;./images&quot;</span>) == <span class=\"literal\">False</span>:</span><br><span class=\"line\">            os.mkdir(<span class=\"string\">&quot;./images&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span> (<span class=\"string\">&quot;./images/&quot;</span>+ image_name + <span class=\"string\">&quot;.jpg&quot;</span>, mode=<span class=\"string\">&quot;wb&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            f.write(image_resp) <span class=\"comment\"># 图片保存到文件</span></span><br><span class=\"line\">        f.close()</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;&#123;&#125;.jpg保存成功&quot;</span>.<span class=\"built_in\">format</span>(image_name))</span><br><span class=\"line\">        time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    parse(main_spider(url))</span><br></pre></td></tr></table></figure>\n\n<p>没有做进一步的爬取，只爬取了一个页面。</p>\n<p>所有图片保存到文件夹<code>images</code>。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"抓取思路\"><a href=\"#抓取思路\" class=\"headerlink\" title=\"抓取思路\"></a>抓取思路</h2><p>1.拿到主页面的源代码，然后提取子页面的链接接地址，<code>href</code><br>2.通过<code>href</code>拿到子页面的内容，从子页面中找到图片的下载地址 <code>img -&gt; src</code><br>3.下载图片并保存</p>\n<p>实现代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup</span><br><span class=\"line\"></span><br><span class=\"line\">url = <span class=\"string\">&quot;https://www.umei.net/weimeitupian/hunshatupian/&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main_spider</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    resp = requests.get(url, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">    resp.encoding = <span class=\"string\">&quot;utf-8&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># print(resp.text)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> resp.text</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse</span>(<span class=\"params\">content</span>):</span></span><br><span class=\"line\">    main_page = BeautifulSoup(content, <span class=\"string\">&quot;html.parser&quot;</span>)</span><br><span class=\"line\">    a_list = main_page.find(<span class=\"string\">&quot;div&quot;</span>, class_=<span class=\"string\">&quot;TypeList&quot;</span>).find_all(<span class=\"string\">&quot;a&quot;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># print(a_list)</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> a <span class=\"keyword\">in</span> a_list:</span><br><span class=\"line\">        href = <span class=\"string\">&quot;https://www.umei.net&quot;</span> + a.get(<span class=\"string\">&quot;href&quot;</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 接下来子页面源代码</span></span><br><span class=\"line\">        child_page_text = main_spider(href)</span><br><span class=\"line\">        <span class=\"comment\"># 从子页面中获取图片的下载路径</span></span><br><span class=\"line\">        child_page = BeautifulSoup(child_page_text, <span class=\"string\">&quot;html.parser&quot;</span>)</span><br><span class=\"line\">        image_name = child_page.find(<span class=\"string\">&quot;h1&quot;</span>, class_=<span class=\"string\">&quot;inline&quot;</span>).text</span><br><span class=\"line\">        image_href = child_page.find(<span class=\"string\">&quot;div&quot;</span>, class_=<span class=\"string\">&quot;ImageBody&quot;</span>).find(<span class=\"string\">&quot;img&quot;</span>).get(<span class=\"string\">&quot;src&quot;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(image_name, image_href)</span><br><span class=\"line\">        <span class=\"comment\"># 下载图片</span></span><br><span class=\"line\">        image_resp = requests.get(image_href).content</span><br><span class=\"line\">        <span class=\"keyword\">if</span> os.path.exists(<span class=\"string\">&quot;./images&quot;</span>) == <span class=\"literal\">False</span>:</span><br><span class=\"line\">            os.mkdir(<span class=\"string\">&quot;./images&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span> (<span class=\"string\">&quot;./images/&quot;</span>+ image_name + <span class=\"string\">&quot;.jpg&quot;</span>, mode=<span class=\"string\">&quot;wb&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            f.write(image_resp) <span class=\"comment\"># 图片保存到文件</span></span><br><span class=\"line\">        f.close()</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;&#123;&#125;.jpg保存成功&quot;</span>.<span class=\"built_in\">format</span>(image_name))</span><br><span class=\"line\">        time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    parse(main_spider(url))</span><br></pre></td></tr></table></figure>\n\n<p>没有做进一步的爬取，只爬取了一个页面。</p>\n<p>所有图片保存到文件夹<code>images</code>。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>"},{"title":"南瑞103协议详解","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-01T07:09:53.000Z","pic":null,"_content":"\n## 前言\n\n`IEC60870-5-103 `传输规约是1999年10月1日实施的电力行业标准（国内称为DL/T667－1999继电保护设备信息接口配套标准），规约要求采用此规约的监控和保护装置必须符合该标准的所有强制性定义。\n\n深圳所`IEC-103`是该标准的一个子集，主要目的在于明确`应用层`功能，满足`IEC60870-5-103`的所有强制性定义，如果该子集与`IEC60870-5-103`相冲突，则以\n`IEC60870-5-103`为准。\n\n### 缩略语\n\nASDU（Application Service Data Unit）应用服务数据单元\nCOT（Cause Of Transmission）传动原因\nDCO（Double COmmand)双命令\nH（Hex）十六进制\nKOD（Kind Of Description）命令的描述类型\nTOO（Type Of Order）命令类型\n\n## IEC-103规约说明\n\n`IEC60870-5-103`规约描述了两种信息交换的方法，第一种方法是基于严格规定的应用服务数据单元和为传输 “标准化” 报文的应用过程， 第二种方法使用了通用分类服务， 以传输几乎所有可能的信息。 \n`IEC-103( 深圳所 )`两种方法都采用。利用第一种方法来实现校时、信号复归、传输保护事件、告警、状态量和故障录波数据；利用第二种方法来实现定值（包括修改定值） 、测量值、软压板（控制字） （包括修改软压板（控制字））的传输。\n\n下面是其详细列表 (括号中是涉及到的主要长帧报文)。\n\n{% colorpanel success 详细列表 %}\n\n1. 保护动作事件 (ASDU2) \n2. 保护告警信息 (ASDU1) \n3. 保护状态信息 (ASDU1) \n4. 故障录波(ASDU23/ASDU24/ASDU25/ASDU26/ASDU27/ASDU28/ASDU29/ASDU30/ASDU31)\n5. 读取定值 (通用分类服务 ,ASDU10,ASDU21) \n6. 修改定值 (通用分类服务 ,ASDU10) \n7. 读取测量值 (通用分类服务 , ASDU10,ASDU21) \n8. 读取软压板（控制字） (通用分类服务 , ASDU10,ASDU21) \n9. 修改软压板（控制字） (通用分类服务 ,ASDU10) \n10. 校时 (ASDU6) \n11. 信号复归 (ASDU20)\n\n{% endcolorpanel %}\n\n## IEC-103 规约结构\n\n`IEC 60870-5-103 `规约基于三层参考模型（增强性能结构） ，这种模型用三层来表示：`物理层`、`链路层`、`应用层`。\n\n![](Screenshot_1.webp)\n\n## IEC-103 物理层说明\n\n支持光纤或者 `RS-485` 方式。\n\n## IEC-103 链路层说明\n\n### 传输方式\n\n非平衡传输。控制系统组成主站，继电保护设备为子站，按照严格的`Polling`（轮询）方式进行通信。\n\n### 传输速率、校验方式和重复帧传输的超时时间\n\n传输速率为 `9600Kbit/s` 或 `19.2Kbit/s`(可调)。`8`位数据位，`1`位停止位，校验方式为`偶校验`。\n\n重复帧传输的超时时间间隔为`50ms`，控制系统中此值应当可以调节。\n\n### 帧格式\n\n两种：固定长帧格式和非固定长帧格式。\n\n#### 固定长帧格式\n\n![](Screenshot_2.webp)\n\n固定帧长帧格式用于控制系统向继电保护设备传输询问帧或命令帧（复位数据单元或复位帧计数位），或继电保护设备向控制系统传输确认帧或响应帧。\n\n帧校验和是控制字、地址的算术和（不考虑溢出位即 `256` 模和）\n\n子站和主站在接收报文时，校验启动字符、帧校验和、结束字符，检出任何一个差错，该数据帧无效。\n\n#### 可变长帧格式\n\n![](Screenshot_3.webp)\n\n可变帧长帧格式用于控制系统向继电保护设备传输数据，或由继电保护设备向控制系统传输数据之用。\n\n长度`L`包括控制域、地址域、链路用户数据长度的总和， `L`最大值为 `255`,子站和主站在组织报文时， 要控制链路用户数据的长度， 注意使控制域、 地址域、 链路用户数据长度之和不要超出 `255`。如果超出，则要考虑分包传送。\n\n帧校验和是控制、地址、链路用户数据的算术和，（不考虑溢出位即 256 模和）。\n\n子站和主站在接收报文时， 应校验两个启动字符、 两个 `L`值应一致，接收字符数为 `L+6`,帧校验和、结束字符，若检出任何一个差错，则舍弃此帧数据。\n\n#### 控制系统至保护设备报文控制域定义\n\n8位，一个字节。\n\n![](Screenshot_4.webp)\n\n- 备用位，始终为0。\n- 启动报文位，始终为1，表示是由控制系统向继电保护设备传输，控制系统为启动站。\n- `FCB（帧计数位）`，控制系统向同一个继电保护设备进行新一轮的`发送/确认`或`请求/响应`时，将 `FCB` 取反值。控制系统应为每一个继电保护设备保留一个帧计数位(`FCB`)的拷贝，若超时未从继电保护设备收到报文，或接收出现差错，则控制系统不改变帧计数位(`FCB`)的状态，重传原报文，重传次数大于等于 3 次，如果通信恢复，则继续正常通信过程，否则将复位该继电保护设备。继电保护设备在发送报文时，应该保留该发送报文的一个拷贝。在下一轮传输过程中如果控制系统的**FCB有效且没有取反**，则继电保护设备重新发送上一次发送报文的拷贝。在下一轮传输过程中如果控制系统的有效且 `FCB` 取反，则组织新报文发送，并保留此新报文的一个拷贝，并丢弃原来报文的拷贝。这样有效防止了报文丢失。\n  复位命令的帧计数位 (`FCB`)为 0,帧计数有效位 (`FCV`) 为 0。\n  广播校时报文不需要考虑报文丢失和重复重传，无需改变帧计数位 (`FCB`) 的状态，故在广播校时报文中帧计数有效位 (`FCV`) 为 0。\n- `FCV`(帧计数有效位)，0表示帧计数位（FCB）的变化无效，1表示帧计数位（FCB）的变化有效。\n- 功能码：\n\n\n| 功能码序号 | 帧类型 | 功能 | FCV |\n| :--: | :--: | :---: | :--: |\n| 0 | 发送/确认帧 | 复位通信单元 (CU) | 0 |\n| 1－2 | —— | 备用 | — |\n| 3 | 发送/确认帧 | 传送数据 (总查询启动、命令报文、读写定值和软压板 （控制字），读取测量值 ) | 1 | \n| 4 | 发送/无回答帧 | 传送数据（广播校时） | 0 |\n| 5－6 | —— | 备用 | — |\n| 7 | 复位帧计数位 (FCB) | 传送数据 | 0 |\n| 8 | —— | 备用 | — |\n| 9 | 请求/响应帧 | 召唤链路状态 | 0 |\n| 10 | 请求/响应帧 | 召唤1级用户数据 | 1 |\n| 11 | 请求/响应帧 | 召唤2级用户数据 | 1 |\n| 12－13 | —— | 备用 | — |\n| 14－15 | —— | 备用 | — |\n\n<style>\n  table {\n    margin: auto;\n    font-size: 70%;\n  }\n</style>\n\n#### 保护设备至控制系统报文控制域的定义\n\n8位，一个字节。\n\n![](Screenshot_5.webp)\n\n- 备用位，始终为 0。\n- 启动报文位，始终为 0：表示是由继电保护设备向控制系统传输。\n- `ACD`( 要求访问位 )，继电保护设备有 `1` 级用户用户数据，将 `ACD` 置 `1` 通知控制系统召唤 `1` 级用户数据，如果继电保护设备没有 `1` 级用户数据，则将 `ACD` 置 `0`。\n- `DFC`(数据流控制位 ) ，`DFC=0`表示继电保护设备可以接受数据。`DFC=1`表示继电保护设备的缓冲区已满，无法接受新数据。\n- 本规约规定深圳所保护设备上送报文中 `DFC` 始终为 0，即可以接受新数据， 控制系统应能够处理 `DFC=1` 的报文。\n- 功能码\n\n| 功能码序号 | 帧类型 | 功能 |\n| :--: | :--: | :---: |\n| 0 | 确认帧 | 确认 |\n| 1 | 确认帧 | 链路忙 |\n| 2－5 | —— | 备用 |\n| 6－7 | —— | 制造厂和用户协商定义 |\n| 8 | 响应帧 | 以数据响应请求帧 |\n| 9 | 响应帧 | 无所召唤的数据 |\n| 10 | —— | 备用 |\n| 11 | 响应帧 | 以链路状态或访问请求回答请求帧 |\n| 12 |   | 备用 |\n| 13 |   | 制造厂和用户协商定义 |\n| 14 |   | 链路服务未工作 |\n| 15 |   | 链路服务未工作 |\n\n功能码 0 :\n继电保护设备从控制系统接收到复位、 读写数据报文时， 在传递 1 级用户数据之前， 都要发送一个短帧来通知控制系统继电保护设备已经接收到复位或读写数据报文， 且如果有 1级用户数据则将 ACD 置 1 来通知控制系统召唤 1 级用户数据。\n\n功能码 1：\n如果控制系统向继电保护设备召唤 1 级用户 ,继电保护设备能够确定有需要发送的 1 级用户数据 ,但由于某种原因无法立即组织好 ,可以用此功能码来组织短帧`10 21 01 22 16`（假定地址为 1） 通知控制系统该继电保护设备链路忙，控制系统在接收到此报文后在下一个周期轮询到此继电保护设备时，继续召唤 1 级用户数据。\n\n## IEC-103应用层说明\n\n### 1级和2级用户\n\n1级用户数据（优先级从高到低）：\n\n1. 一次设备的工作状态和系统工作状态发生变化时形成的数据。\n2. 继电保护设备动作信号。\n3. 初始化过程中，继电保护设备发送的 `ASDU5` 报文。\n4. 控制系统发送总查询命令后，继电保护传送的状态量或动作信息，继电保护设备发送的总查询结束报文。\n5. 命令传输过程中，继电保护设备形成的肯定或否定认可报文。\n6. 在通用分类服务控制系统发送读或写命令后，继电保护设备发送的 `ASDU10` 报文。\n7. 继电保护设备在故障录波后形成扰动数据时所产生的如下内容：\n\n{% colorpanel info 扰动信息 %}\n\n-  扰动数据表 `ASDU23` \n-  扰动数据传输准备就绪 `ASDU26` \n-  被记录的通道传输准备就绪 `ASDU27` \n-  带标志的状态变位传输准备就绪 `ASDU28` \n-  传送带标志的状态变位的状态 `ASDU29` \n-  传送扰动值 `ASDU30` \n-  带标志的状态变位传输结束 `ASDU31`\n\n{% endcolorpanel %}\n\n2 级用户数据：\n\n二级用户数据主要用来传输测量值， `IEC－ 103(深圳所)`规定深圳所继电保护设备测量值采用通用分类服务传输， 故无 2 级用户数据， 当主站召唤 2 级用户数据时， 用无所请求报文数据回答。 但要求在非深圳所继电保护设备利用 `ASDU3` `、ASDU9` 上送测量值的情况下， 深圳所控制系统能够支持。\n\n### 应用层系统介绍\n\n`IEC－103（深圳所）`是严格的 `Polling` 规约，按照非平衡方式传输，控制系统为主站，继电保护为子站。通信开始时，控制系统向继电保护设备发送服务命令使通信功能复位，然后是对保护进行广播校时，和总查询，总查询完毕后进入通常的召唤 2 级用户数据的过程。如果有突发事件，则子站首先通过`ACD`标志位置 1 通知主站本子站有 1 级用户数据， 主站然后根据`ACD`标志位为 1 来召唤 1 级用户数据。 对于控制系统主动发送的命令或通用分类服务读命令，子站首先响应一个短帧来确认收到此命令，并将`ACD`位置 1，通知主站有 1 级用户数据，主站然后根据`ACD`标志位为 1 来召唤 1 级用户数据， 如果此时子站尚未准备好 1 级用户数据， 则可发送链路忙报文并将`ACD`置 1 以通知主站子站忙，主站接收到此报文后应继续召唤 1 级用户数据，直到最后接收到 1 级用户数据或无所请求报文为止。\n\n为了防止主站对某一个子站进行查询的时间过长，规定与某一个子站通信一次后应马上转入与下一个子站的通信过程， 主站应该记录与该子站的通信状态， 以便下一次轮询到此子站时能够继续正常通信。\n\n  应用层功能实现：\n  利用`ASDU1`传送告警、状态信息\n  利用`ASDU2`来传送事件\n  利用`ASDU6`来对保护装置校时\n  利用`ASDU20`来对保护装置信号复归\n  利用通用分类服务实现调取和修改定值、调取和修改测量值、调取测量值，其中定值支持调取多组定值。\n\n","source":"_posts/南瑞103协议详解.md","raw":"---\ntitle: 南瑞103协议详解\ntags:\n  - pscada\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-01 15:09:53\ncategories: 自动化\npic:\n---\n\n## 前言\n\n`IEC60870-5-103 `传输规约是1999年10月1日实施的电力行业标准（国内称为DL/T667－1999继电保护设备信息接口配套标准），规约要求采用此规约的监控和保护装置必须符合该标准的所有强制性定义。\n\n深圳所`IEC-103`是该标准的一个子集，主要目的在于明确`应用层`功能，满足`IEC60870-5-103`的所有强制性定义，如果该子集与`IEC60870-5-103`相冲突，则以\n`IEC60870-5-103`为准。\n\n### 缩略语\n\nASDU（Application Service Data Unit）应用服务数据单元\nCOT（Cause Of Transmission）传动原因\nDCO（Double COmmand)双命令\nH（Hex）十六进制\nKOD（Kind Of Description）命令的描述类型\nTOO（Type Of Order）命令类型\n\n## IEC-103规约说明\n\n`IEC60870-5-103`规约描述了两种信息交换的方法，第一种方法是基于严格规定的应用服务数据单元和为传输 “标准化” 报文的应用过程， 第二种方法使用了通用分类服务， 以传输几乎所有可能的信息。 \n`IEC-103( 深圳所 )`两种方法都采用。利用第一种方法来实现校时、信号复归、传输保护事件、告警、状态量和故障录波数据；利用第二种方法来实现定值（包括修改定值） 、测量值、软压板（控制字） （包括修改软压板（控制字））的传输。\n\n下面是其详细列表 (括号中是涉及到的主要长帧报文)。\n\n{% colorpanel success 详细列表 %}\n\n1. 保护动作事件 (ASDU2) \n2. 保护告警信息 (ASDU1) \n3. 保护状态信息 (ASDU1) \n4. 故障录波(ASDU23/ASDU24/ASDU25/ASDU26/ASDU27/ASDU28/ASDU29/ASDU30/ASDU31)\n5. 读取定值 (通用分类服务 ,ASDU10,ASDU21) \n6. 修改定值 (通用分类服务 ,ASDU10) \n7. 读取测量值 (通用分类服务 , ASDU10,ASDU21) \n8. 读取软压板（控制字） (通用分类服务 , ASDU10,ASDU21) \n9. 修改软压板（控制字） (通用分类服务 ,ASDU10) \n10. 校时 (ASDU6) \n11. 信号复归 (ASDU20)\n\n{% endcolorpanel %}\n\n## IEC-103 规约结构\n\n`IEC 60870-5-103 `规约基于三层参考模型（增强性能结构） ，这种模型用三层来表示：`物理层`、`链路层`、`应用层`。\n\n![](Screenshot_1.webp)\n\n## IEC-103 物理层说明\n\n支持光纤或者 `RS-485` 方式。\n\n## IEC-103 链路层说明\n\n### 传输方式\n\n非平衡传输。控制系统组成主站，继电保护设备为子站，按照严格的`Polling`（轮询）方式进行通信。\n\n### 传输速率、校验方式和重复帧传输的超时时间\n\n传输速率为 `9600Kbit/s` 或 `19.2Kbit/s`(可调)。`8`位数据位，`1`位停止位，校验方式为`偶校验`。\n\n重复帧传输的超时时间间隔为`50ms`，控制系统中此值应当可以调节。\n\n### 帧格式\n\n两种：固定长帧格式和非固定长帧格式。\n\n#### 固定长帧格式\n\n![](Screenshot_2.webp)\n\n固定帧长帧格式用于控制系统向继电保护设备传输询问帧或命令帧（复位数据单元或复位帧计数位），或继电保护设备向控制系统传输确认帧或响应帧。\n\n帧校验和是控制字、地址的算术和（不考虑溢出位即 `256` 模和）\n\n子站和主站在接收报文时，校验启动字符、帧校验和、结束字符，检出任何一个差错，该数据帧无效。\n\n#### 可变长帧格式\n\n![](Screenshot_3.webp)\n\n可变帧长帧格式用于控制系统向继电保护设备传输数据，或由继电保护设备向控制系统传输数据之用。\n\n长度`L`包括控制域、地址域、链路用户数据长度的总和， `L`最大值为 `255`,子站和主站在组织报文时， 要控制链路用户数据的长度， 注意使控制域、 地址域、 链路用户数据长度之和不要超出 `255`。如果超出，则要考虑分包传送。\n\n帧校验和是控制、地址、链路用户数据的算术和，（不考虑溢出位即 256 模和）。\n\n子站和主站在接收报文时， 应校验两个启动字符、 两个 `L`值应一致，接收字符数为 `L+6`,帧校验和、结束字符，若检出任何一个差错，则舍弃此帧数据。\n\n#### 控制系统至保护设备报文控制域定义\n\n8位，一个字节。\n\n![](Screenshot_4.webp)\n\n- 备用位，始终为0。\n- 启动报文位，始终为1，表示是由控制系统向继电保护设备传输，控制系统为启动站。\n- `FCB（帧计数位）`，控制系统向同一个继电保护设备进行新一轮的`发送/确认`或`请求/响应`时，将 `FCB` 取反值。控制系统应为每一个继电保护设备保留一个帧计数位(`FCB`)的拷贝，若超时未从继电保护设备收到报文，或接收出现差错，则控制系统不改变帧计数位(`FCB`)的状态，重传原报文，重传次数大于等于 3 次，如果通信恢复，则继续正常通信过程，否则将复位该继电保护设备。继电保护设备在发送报文时，应该保留该发送报文的一个拷贝。在下一轮传输过程中如果控制系统的**FCB有效且没有取反**，则继电保护设备重新发送上一次发送报文的拷贝。在下一轮传输过程中如果控制系统的有效且 `FCB` 取反，则组织新报文发送，并保留此新报文的一个拷贝，并丢弃原来报文的拷贝。这样有效防止了报文丢失。\n  复位命令的帧计数位 (`FCB`)为 0,帧计数有效位 (`FCV`) 为 0。\n  广播校时报文不需要考虑报文丢失和重复重传，无需改变帧计数位 (`FCB`) 的状态，故在广播校时报文中帧计数有效位 (`FCV`) 为 0。\n- `FCV`(帧计数有效位)，0表示帧计数位（FCB）的变化无效，1表示帧计数位（FCB）的变化有效。\n- 功能码：\n\n\n| 功能码序号 | 帧类型 | 功能 | FCV |\n| :--: | :--: | :---: | :--: |\n| 0 | 发送/确认帧 | 复位通信单元 (CU) | 0 |\n| 1－2 | —— | 备用 | — |\n| 3 | 发送/确认帧 | 传送数据 (总查询启动、命令报文、读写定值和软压板 （控制字），读取测量值 ) | 1 | \n| 4 | 发送/无回答帧 | 传送数据（广播校时） | 0 |\n| 5－6 | —— | 备用 | — |\n| 7 | 复位帧计数位 (FCB) | 传送数据 | 0 |\n| 8 | —— | 备用 | — |\n| 9 | 请求/响应帧 | 召唤链路状态 | 0 |\n| 10 | 请求/响应帧 | 召唤1级用户数据 | 1 |\n| 11 | 请求/响应帧 | 召唤2级用户数据 | 1 |\n| 12－13 | —— | 备用 | — |\n| 14－15 | —— | 备用 | — |\n\n<style>\n  table {\n    margin: auto;\n    font-size: 70%;\n  }\n</style>\n\n#### 保护设备至控制系统报文控制域的定义\n\n8位，一个字节。\n\n![](Screenshot_5.webp)\n\n- 备用位，始终为 0。\n- 启动报文位，始终为 0：表示是由继电保护设备向控制系统传输。\n- `ACD`( 要求访问位 )，继电保护设备有 `1` 级用户用户数据，将 `ACD` 置 `1` 通知控制系统召唤 `1` 级用户数据，如果继电保护设备没有 `1` 级用户数据，则将 `ACD` 置 `0`。\n- `DFC`(数据流控制位 ) ，`DFC=0`表示继电保护设备可以接受数据。`DFC=1`表示继电保护设备的缓冲区已满，无法接受新数据。\n- 本规约规定深圳所保护设备上送报文中 `DFC` 始终为 0，即可以接受新数据， 控制系统应能够处理 `DFC=1` 的报文。\n- 功能码\n\n| 功能码序号 | 帧类型 | 功能 |\n| :--: | :--: | :---: |\n| 0 | 确认帧 | 确认 |\n| 1 | 确认帧 | 链路忙 |\n| 2－5 | —— | 备用 |\n| 6－7 | —— | 制造厂和用户协商定义 |\n| 8 | 响应帧 | 以数据响应请求帧 |\n| 9 | 响应帧 | 无所召唤的数据 |\n| 10 | —— | 备用 |\n| 11 | 响应帧 | 以链路状态或访问请求回答请求帧 |\n| 12 |   | 备用 |\n| 13 |   | 制造厂和用户协商定义 |\n| 14 |   | 链路服务未工作 |\n| 15 |   | 链路服务未工作 |\n\n功能码 0 :\n继电保护设备从控制系统接收到复位、 读写数据报文时， 在传递 1 级用户数据之前， 都要发送一个短帧来通知控制系统继电保护设备已经接收到复位或读写数据报文， 且如果有 1级用户数据则将 ACD 置 1 来通知控制系统召唤 1 级用户数据。\n\n功能码 1：\n如果控制系统向继电保护设备召唤 1 级用户 ,继电保护设备能够确定有需要发送的 1 级用户数据 ,但由于某种原因无法立即组织好 ,可以用此功能码来组织短帧`10 21 01 22 16`（假定地址为 1） 通知控制系统该继电保护设备链路忙，控制系统在接收到此报文后在下一个周期轮询到此继电保护设备时，继续召唤 1 级用户数据。\n\n## IEC-103应用层说明\n\n### 1级和2级用户\n\n1级用户数据（优先级从高到低）：\n\n1. 一次设备的工作状态和系统工作状态发生变化时形成的数据。\n2. 继电保护设备动作信号。\n3. 初始化过程中，继电保护设备发送的 `ASDU5` 报文。\n4. 控制系统发送总查询命令后，继电保护传送的状态量或动作信息，继电保护设备发送的总查询结束报文。\n5. 命令传输过程中，继电保护设备形成的肯定或否定认可报文。\n6. 在通用分类服务控制系统发送读或写命令后，继电保护设备发送的 `ASDU10` 报文。\n7. 继电保护设备在故障录波后形成扰动数据时所产生的如下内容：\n\n{% colorpanel info 扰动信息 %}\n\n-  扰动数据表 `ASDU23` \n-  扰动数据传输准备就绪 `ASDU26` \n-  被记录的通道传输准备就绪 `ASDU27` \n-  带标志的状态变位传输准备就绪 `ASDU28` \n-  传送带标志的状态变位的状态 `ASDU29` \n-  传送扰动值 `ASDU30` \n-  带标志的状态变位传输结束 `ASDU31`\n\n{% endcolorpanel %}\n\n2 级用户数据：\n\n二级用户数据主要用来传输测量值， `IEC－ 103(深圳所)`规定深圳所继电保护设备测量值采用通用分类服务传输， 故无 2 级用户数据， 当主站召唤 2 级用户数据时， 用无所请求报文数据回答。 但要求在非深圳所继电保护设备利用 `ASDU3` `、ASDU9` 上送测量值的情况下， 深圳所控制系统能够支持。\n\n### 应用层系统介绍\n\n`IEC－103（深圳所）`是严格的 `Polling` 规约，按照非平衡方式传输，控制系统为主站，继电保护为子站。通信开始时，控制系统向继电保护设备发送服务命令使通信功能复位，然后是对保护进行广播校时，和总查询，总查询完毕后进入通常的召唤 2 级用户数据的过程。如果有突发事件，则子站首先通过`ACD`标志位置 1 通知主站本子站有 1 级用户数据， 主站然后根据`ACD`标志位为 1 来召唤 1 级用户数据。 对于控制系统主动发送的命令或通用分类服务读命令，子站首先响应一个短帧来确认收到此命令，并将`ACD`位置 1，通知主站有 1 级用户数据，主站然后根据`ACD`标志位为 1 来召唤 1 级用户数据， 如果此时子站尚未准备好 1 级用户数据， 则可发送链路忙报文并将`ACD`置 1 以通知主站子站忙，主站接收到此报文后应继续召唤 1 级用户数据，直到最后接收到 1 级用户数据或无所请求报文为止。\n\n为了防止主站对某一个子站进行查询的时间过长，规定与某一个子站通信一次后应马上转入与下一个子站的通信过程， 主站应该记录与该子站的通信状态， 以便下一次轮询到此子站时能够继续正常通信。\n\n  应用层功能实现：\n  利用`ASDU1`传送告警、状态信息\n  利用`ASDU2`来传送事件\n  利用`ASDU6`来对保护装置校时\n  利用`ASDU20`来对保护装置信号复归\n  利用通用分类服务实现调取和修改定值、调取和修改测量值、调取测量值，其中定值支持调取多组定值。\n\n","slug":"南瑞103协议详解","published":1,"updated":"2021-06-15T15:47:31.609Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2r003044udgx6d6emv","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p><code>IEC60870-5-103 </code>传输规约是1999年10月1日实施的电力行业标准（国内称为DL/T667－1999继电保护设备信息接口配套标准），规约要求采用此规约的监控和保护装置必须符合该标准的所有强制性定义。</p>\n<p>深圳所<code>IEC-103</code>是该标准的一个子集，主要目的在于明确<code>应用层</code>功能，满足<code>IEC60870-5-103</code>的所有强制性定义，如果该子集与<code>IEC60870-5-103</code>相冲突，则以<br><code>IEC60870-5-103</code>为准。</p>\n<h3 id=\"缩略语\"><a href=\"#缩略语\" class=\"headerlink\" title=\"缩略语\"></a>缩略语</h3><p>ASDU（Application Service Data Unit）应用服务数据单元<br>COT（Cause Of Transmission）传动原因<br>DCO（Double COmmand)双命令<br>H（Hex）十六进制<br>KOD（Kind Of Description）命令的描述类型<br>TOO（Type Of Order）命令类型</p>\n<h2 id=\"IEC-103规约说明\"><a href=\"#IEC-103规约说明\" class=\"headerlink\" title=\"IEC-103规约说明\"></a>IEC-103规约说明</h2><p><code>IEC60870-5-103</code>规约描述了两种信息交换的方法，第一种方法是基于严格规定的应用服务数据单元和为传输 “标准化” 报文的应用过程， 第二种方法使用了通用分类服务， 以传输几乎所有可能的信息。<br><code>IEC-103( 深圳所 )</code>两种方法都采用。利用第一种方法来实现校时、信号复归、传输保护事件、告警、状态量和故障录波数据；利用第二种方法来实现定值（包括修改定值） 、测量值、软压板（控制字） （包括修改软压板（控制字））的传输。</p>\n<p>下面是其详细列表 (括号中是涉及到的主要长帧报文)。</p>\n<div class=\"panel panel-success\">\n    <div class=\"panel-title\">详细列表</div>\n    <div class=\"panel-body\">\n        <ol>\n<li>保护动作事件 (ASDU2) </li>\n<li>保护告警信息 (ASDU1) </li>\n<li>保护状态信息 (ASDU1) </li>\n<li>故障录波(ASDU23/ASDU24/ASDU25/ASDU26/ASDU27/ASDU28/ASDU29/ASDU30/ASDU31)</li>\n<li>读取定值 (通用分类服务 ,ASDU10,ASDU21) </li>\n<li>修改定值 (通用分类服务 ,ASDU10) </li>\n<li>读取测量值 (通用分类服务 , ASDU10,ASDU21) </li>\n<li>读取软压板（控制字） (通用分类服务 , ASDU10,ASDU21) </li>\n<li>修改软压板（控制字） (通用分类服务 ,ASDU10) </li>\n<li>校时 (ASDU6) </li>\n<li>信号复归 (ASDU20)</li>\n</ol>\n\n    </div>\n    </div>\n\n<h2 id=\"IEC-103-规约结构\"><a href=\"#IEC-103-规约结构\" class=\"headerlink\" title=\"IEC-103 规约结构\"></a>IEC-103 规约结构</h2><p><code>IEC 60870-5-103 </code>规约基于三层参考模型（增强性能结构） ，这种模型用三层来表示：<code>物理层</code>、<code>链路层</code>、<code>应用层</code>。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<h2 id=\"IEC-103-物理层说明\"><a href=\"#IEC-103-物理层说明\" class=\"headerlink\" title=\"IEC-103 物理层说明\"></a>IEC-103 物理层说明</h2><p>支持光纤或者 <code>RS-485</code> 方式。</p>\n<h2 id=\"IEC-103-链路层说明\"><a href=\"#IEC-103-链路层说明\" class=\"headerlink\" title=\"IEC-103 链路层说明\"></a>IEC-103 链路层说明</h2><h3 id=\"传输方式\"><a href=\"#传输方式\" class=\"headerlink\" title=\"传输方式\"></a>传输方式</h3><p>非平衡传输。控制系统组成主站，继电保护设备为子站，按照严格的<code>Polling</code>（轮询）方式进行通信。</p>\n<h3 id=\"传输速率、校验方式和重复帧传输的超时时间\"><a href=\"#传输速率、校验方式和重复帧传输的超时时间\" class=\"headerlink\" title=\"传输速率、校验方式和重复帧传输的超时时间\"></a>传输速率、校验方式和重复帧传输的超时时间</h3><p>传输速率为 <code>9600Kbit/s</code> 或 <code>19.2Kbit/s</code>(可调)。<code>8</code>位数据位，<code>1</code>位停止位，校验方式为<code>偶校验</code>。</p>\n<p>重复帧传输的超时时间间隔为<code>50ms</code>，控制系统中此值应当可以调节。</p>\n<h3 id=\"帧格式\"><a href=\"#帧格式\" class=\"headerlink\" title=\"帧格式\"></a>帧格式</h3><p>两种：固定长帧格式和非固定长帧格式。</p>\n<h4 id=\"固定长帧格式\"><a href=\"#固定长帧格式\" class=\"headerlink\" title=\"固定长帧格式\"></a>固定长帧格式</h4><p><img src=\"Screenshot_2.webp\"></p>\n<p>固定帧长帧格式用于控制系统向继电保护设备传输询问帧或命令帧（复位数据单元或复位帧计数位），或继电保护设备向控制系统传输确认帧或响应帧。</p>\n<p>帧校验和是控制字、地址的算术和（不考虑溢出位即 <code>256</code> 模和）</p>\n<p>子站和主站在接收报文时，校验启动字符、帧校验和、结束字符，检出任何一个差错，该数据帧无效。</p>\n<h4 id=\"可变长帧格式\"><a href=\"#可变长帧格式\" class=\"headerlink\" title=\"可变长帧格式\"></a>可变长帧格式</h4><p><img src=\"Screenshot_3.webp\"></p>\n<p>可变帧长帧格式用于控制系统向继电保护设备传输数据，或由继电保护设备向控制系统传输数据之用。</p>\n<p>长度<code>L</code>包括控制域、地址域、链路用户数据长度的总和， <code>L</code>最大值为 <code>255</code>,子站和主站在组织报文时， 要控制链路用户数据的长度， 注意使控制域、 地址域、 链路用户数据长度之和不要超出 <code>255</code>。如果超出，则要考虑分包传送。</p>\n<p>帧校验和是控制、地址、链路用户数据的算术和，（不考虑溢出位即 256 模和）。</p>\n<p>子站和主站在接收报文时， 应校验两个启动字符、 两个 <code>L</code>值应一致，接收字符数为 <code>L+6</code>,帧校验和、结束字符，若检出任何一个差错，则舍弃此帧数据。</p>\n<h4 id=\"控制系统至保护设备报文控制域定义\"><a href=\"#控制系统至保护设备报文控制域定义\" class=\"headerlink\" title=\"控制系统至保护设备报文控制域定义\"></a>控制系统至保护设备报文控制域定义</h4><p>8位，一个字节。</p>\n<p><img src=\"Screenshot_4.webp\"></p>\n<ul>\n<li>备用位，始终为0。</li>\n<li>启动报文位，始终为1，表示是由控制系统向继电保护设备传输，控制系统为启动站。</li>\n<li><code>FCB（帧计数位）</code>，控制系统向同一个继电保护设备进行新一轮的<code>发送/确认</code>或<code>请求/响应</code>时，将 <code>FCB</code> 取反值。控制系统应为每一个继电保护设备保留一个帧计数位(<code>FCB</code>)的拷贝，若超时未从继电保护设备收到报文，或接收出现差错，则控制系统不改变帧计数位(<code>FCB</code>)的状态，重传原报文，重传次数大于等于 3 次，如果通信恢复，则继续正常通信过程，否则将复位该继电保护设备。继电保护设备在发送报文时，应该保留该发送报文的一个拷贝。在下一轮传输过程中如果控制系统的<strong>FCB有效且没有取反</strong>，则继电保护设备重新发送上一次发送报文的拷贝。在下一轮传输过程中如果控制系统的有效且 <code>FCB</code> 取反，则组织新报文发送，并保留此新报文的一个拷贝，并丢弃原来报文的拷贝。这样有效防止了报文丢失。<br>复位命令的帧计数位 (<code>FCB</code>)为 0,帧计数有效位 (<code>FCV</code>) 为 0。<br>广播校时报文不需要考虑报文丢失和重复重传，无需改变帧计数位 (<code>FCB</code>) 的状态，故在广播校时报文中帧计数有效位 (<code>FCV</code>) 为 0。</li>\n<li><code>FCV</code>(帧计数有效位)，0表示帧计数位（FCB）的变化无效，1表示帧计数位（FCB）的变化有效。</li>\n<li>功能码：</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">功能码序号</th>\n<th align=\"center\">帧类型</th>\n<th align=\"center\">功能</th>\n<th align=\"center\">FCV</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">0</td>\n<td align=\"center\">发送/确认帧</td>\n<td align=\"center\">复位通信单元 (CU)</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">1－2</td>\n<td align=\"center\">——</td>\n<td align=\"center\">备用</td>\n<td align=\"center\">—</td>\n</tr>\n<tr>\n<td align=\"center\">3</td>\n<td align=\"center\">发送/确认帧</td>\n<td align=\"center\">传送数据 (总查询启动、命令报文、读写定值和软压板 （控制字），读取测量值 )</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">4</td>\n<td align=\"center\">发送/无回答帧</td>\n<td align=\"center\">传送数据（广播校时）</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">5－6</td>\n<td align=\"center\">——</td>\n<td align=\"center\">备用</td>\n<td align=\"center\">—</td>\n</tr>\n<tr>\n<td align=\"center\">7</td>\n<td align=\"center\">复位帧计数位 (FCB)</td>\n<td align=\"center\">传送数据</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">8</td>\n<td align=\"center\">——</td>\n<td align=\"center\">备用</td>\n<td align=\"center\">—</td>\n</tr>\n<tr>\n<td align=\"center\">9</td>\n<td align=\"center\">请求/响应帧</td>\n<td align=\"center\">召唤链路状态</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">10</td>\n<td align=\"center\">请求/响应帧</td>\n<td align=\"center\">召唤1级用户数据</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">11</td>\n<td align=\"center\">请求/响应帧</td>\n<td align=\"center\">召唤2级用户数据</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">12－13</td>\n<td align=\"center\">——</td>\n<td align=\"center\">备用</td>\n<td align=\"center\">—</td>\n</tr>\n<tr>\n<td align=\"center\">14－15</td>\n<td align=\"center\">——</td>\n<td align=\"center\">备用</td>\n<td align=\"center\">—</td>\n</tr>\n</tbody></table>\n<style>\n  table {\n    margin: auto;\n    font-size: 70%;\n  }\n</style>\n\n<h4 id=\"保护设备至控制系统报文控制域的定义\"><a href=\"#保护设备至控制系统报文控制域的定义\" class=\"headerlink\" title=\"保护设备至控制系统报文控制域的定义\"></a>保护设备至控制系统报文控制域的定义</h4><p>8位，一个字节。</p>\n<p><img src=\"Screenshot_5.webp\"></p>\n<ul>\n<li>备用位，始终为 0。</li>\n<li>启动报文位，始终为 0：表示是由继电保护设备向控制系统传输。</li>\n<li><code>ACD</code>( 要求访问位 )，继电保护设备有 <code>1</code> 级用户用户数据，将 <code>ACD</code> 置 <code>1</code> 通知控制系统召唤 <code>1</code> 级用户数据，如果继电保护设备没有 <code>1</code> 级用户数据，则将 <code>ACD</code> 置 <code>0</code>。</li>\n<li><code>DFC</code>(数据流控制位 ) ，<code>DFC=0</code>表示继电保护设备可以接受数据。<code>DFC=1</code>表示继电保护设备的缓冲区已满，无法接受新数据。</li>\n<li>本规约规定深圳所保护设备上送报文中 <code>DFC</code> 始终为 0，即可以接受新数据， 控制系统应能够处理 <code>DFC=1</code> 的报文。</li>\n<li>功能码</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">功能码序号</th>\n<th align=\"center\">帧类型</th>\n<th align=\"center\">功能</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">0</td>\n<td align=\"center\">确认帧</td>\n<td align=\"center\">确认</td>\n</tr>\n<tr>\n<td align=\"center\">1</td>\n<td align=\"center\">确认帧</td>\n<td align=\"center\">链路忙</td>\n</tr>\n<tr>\n<td align=\"center\">2－5</td>\n<td align=\"center\">——</td>\n<td align=\"center\">备用</td>\n</tr>\n<tr>\n<td align=\"center\">6－7</td>\n<td align=\"center\">——</td>\n<td align=\"center\">制造厂和用户协商定义</td>\n</tr>\n<tr>\n<td align=\"center\">8</td>\n<td align=\"center\">响应帧</td>\n<td align=\"center\">以数据响应请求帧</td>\n</tr>\n<tr>\n<td align=\"center\">9</td>\n<td align=\"center\">响应帧</td>\n<td align=\"center\">无所召唤的数据</td>\n</tr>\n<tr>\n<td align=\"center\">10</td>\n<td align=\"center\">——</td>\n<td align=\"center\">备用</td>\n</tr>\n<tr>\n<td align=\"center\">11</td>\n<td align=\"center\">响应帧</td>\n<td align=\"center\">以链路状态或访问请求回答请求帧</td>\n</tr>\n<tr>\n<td align=\"center\">12</td>\n<td align=\"center\"></td>\n<td align=\"center\">备用</td>\n</tr>\n<tr>\n<td align=\"center\">13</td>\n<td align=\"center\"></td>\n<td align=\"center\">制造厂和用户协商定义</td>\n</tr>\n<tr>\n<td align=\"center\">14</td>\n<td align=\"center\"></td>\n<td align=\"center\">链路服务未工作</td>\n</tr>\n<tr>\n<td align=\"center\">15</td>\n<td align=\"center\"></td>\n<td align=\"center\">链路服务未工作</td>\n</tr>\n</tbody></table>\n<p>功能码 0 :<br>继电保护设备从控制系统接收到复位、 读写数据报文时， 在传递 1 级用户数据之前， 都要发送一个短帧来通知控制系统继电保护设备已经接收到复位或读写数据报文， 且如果有 1级用户数据则将 ACD 置 1 来通知控制系统召唤 1 级用户数据。</p>\n<p>功能码 1：<br>如果控制系统向继电保护设备召唤 1 级用户 ,继电保护设备能够确定有需要发送的 1 级用户数据 ,但由于某种原因无法立即组织好 ,可以用此功能码来组织短帧<code>10 21 01 22 16</code>（假定地址为 1） 通知控制系统该继电保护设备链路忙，控制系统在接收到此报文后在下一个周期轮询到此继电保护设备时，继续召唤 1 级用户数据。</p>\n<h2 id=\"IEC-103应用层说明\"><a href=\"#IEC-103应用层说明\" class=\"headerlink\" title=\"IEC-103应用层说明\"></a>IEC-103应用层说明</h2><h3 id=\"1级和2级用户\"><a href=\"#1级和2级用户\" class=\"headerlink\" title=\"1级和2级用户\"></a>1级和2级用户</h3><p>1级用户数据（优先级从高到低）：</p>\n<ol>\n<li>一次设备的工作状态和系统工作状态发生变化时形成的数据。</li>\n<li>继电保护设备动作信号。</li>\n<li>初始化过程中，继电保护设备发送的 <code>ASDU5</code> 报文。</li>\n<li>控制系统发送总查询命令后，继电保护传送的状态量或动作信息，继电保护设备发送的总查询结束报文。</li>\n<li>命令传输过程中，继电保护设备形成的肯定或否定认可报文。</li>\n<li>在通用分类服务控制系统发送读或写命令后，继电保护设备发送的 <code>ASDU10</code> 报文。</li>\n<li>继电保护设备在故障录波后形成扰动数据时所产生的如下内容：</li>\n</ol>\n<div class=\"panel panel-info\">\n    <div class=\"panel-title\">扰动信息</div>\n    <div class=\"panel-body\">\n        <ul>\n<li> 扰动数据表 <code>ASDU23</code> </li>\n<li> 扰动数据传输准备就绪 <code>ASDU26</code> </li>\n<li> 被记录的通道传输准备就绪 <code>ASDU27</code> </li>\n<li> 带标志的状态变位传输准备就绪 <code>ASDU28</code> </li>\n<li> 传送带标志的状态变位的状态 <code>ASDU29</code> </li>\n<li> 传送扰动值 <code>ASDU30</code> </li>\n<li> 带标志的状态变位传输结束 <code>ASDU31</code></li>\n</ul>\n\n    </div>\n    </div>\n\n<p>2 级用户数据：</p>\n<p>二级用户数据主要用来传输测量值， <code>IEC－ 103(深圳所)</code>规定深圳所继电保护设备测量值采用通用分类服务传输， 故无 2 级用户数据， 当主站召唤 2 级用户数据时， 用无所请求报文数据回答。 但要求在非深圳所继电保护设备利用 <code>ASDU3</code> <code>、ASDU9</code> 上送测量值的情况下， 深圳所控制系统能够支持。</p>\n<h3 id=\"应用层系统介绍\"><a href=\"#应用层系统介绍\" class=\"headerlink\" title=\"应用层系统介绍\"></a>应用层系统介绍</h3><p><code>IEC－103（深圳所）</code>是严格的 <code>Polling</code> 规约，按照非平衡方式传输，控制系统为主站，继电保护为子站。通信开始时，控制系统向继电保护设备发送服务命令使通信功能复位，然后是对保护进行广播校时，和总查询，总查询完毕后进入通常的召唤 2 级用户数据的过程。如果有突发事件，则子站首先通过<code>ACD</code>标志位置 1 通知主站本子站有 1 级用户数据， 主站然后根据<code>ACD</code>标志位为 1 来召唤 1 级用户数据。 对于控制系统主动发送的命令或通用分类服务读命令，子站首先响应一个短帧来确认收到此命令，并将<code>ACD</code>位置 1，通知主站有 1 级用户数据，主站然后根据<code>ACD</code>标志位为 1 来召唤 1 级用户数据， 如果此时子站尚未准备好 1 级用户数据， 则可发送链路忙报文并将<code>ACD</code>置 1 以通知主站子站忙，主站接收到此报文后应继续召唤 1 级用户数据，直到最后接收到 1 级用户数据或无所请求报文为止。</p>\n<p>为了防止主站对某一个子站进行查询的时间过长，规定与某一个子站通信一次后应马上转入与下一个子站的通信过程， 主站应该记录与该子站的通信状态， 以便下一次轮询到此子站时能够继续正常通信。</p>\n<p>  应用层功能实现：<br>  利用<code>ASDU1</code>传送告警、状态信息<br>  利用<code>ASDU2</code>来传送事件<br>  利用<code>ASDU6</code>来对保护装置校时<br>  利用<code>ASDU20</code>来对保护装置信号复归<br>  利用通用分类服务实现调取和修改定值、调取和修改测量值、调取测量值，其中定值支持调取多组定值。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p><code>IEC60870-5-103 </code>传输规约是1999年10月1日实施的电力行业标准（国内称为DL/T667－1999继电保护设备信息接口配套标准），规约要求采用此规约的监控和保护装置必须符合该标准的所有强制性定义。</p>\n<p>深圳所<code>IEC-103</code>是该标准的一个子集，主要目的在于明确<code>应用层</code>功能，满足<code>IEC60870-5-103</code>的所有强制性定义，如果该子集与<code>IEC60870-5-103</code>相冲突，则以<br><code>IEC60870-5-103</code>为准。</p>\n<h3 id=\"缩略语\"><a href=\"#缩略语\" class=\"headerlink\" title=\"缩略语\"></a>缩略语</h3><p>ASDU（Application Service Data Unit）应用服务数据单元<br>COT（Cause Of Transmission）传动原因<br>DCO（Double COmmand)双命令<br>H（Hex）十六进制<br>KOD（Kind Of Description）命令的描述类型<br>TOO（Type Of Order）命令类型</p>\n<h2 id=\"IEC-103规约说明\"><a href=\"#IEC-103规约说明\" class=\"headerlink\" title=\"IEC-103规约说明\"></a>IEC-103规约说明</h2><p><code>IEC60870-5-103</code>规约描述了两种信息交换的方法，第一种方法是基于严格规定的应用服务数据单元和为传输 “标准化” 报文的应用过程， 第二种方法使用了通用分类服务， 以传输几乎所有可能的信息。<br><code>IEC-103( 深圳所 )</code>两种方法都采用。利用第一种方法来实现校时、信号复归、传输保护事件、告警、状态量和故障录波数据；利用第二种方法来实现定值（包括修改定值） 、测量值、软压板（控制字） （包括修改软压板（控制字））的传输。</p>\n<p>下面是其详细列表 (括号中是涉及到的主要长帧报文)。</p>\n<div class=\"panel panel-success\">\n    <div class=\"panel-title\">详细列表</div>\n    <div class=\"panel-body\">\n        <ol>\n<li>保护动作事件 (ASDU2) </li>\n<li>保护告警信息 (ASDU1) </li>\n<li>保护状态信息 (ASDU1) </li>\n<li>故障录波(ASDU23/ASDU24/ASDU25/ASDU26/ASDU27/ASDU28/ASDU29/ASDU30/ASDU31)</li>\n<li>读取定值 (通用分类服务 ,ASDU10,ASDU21) </li>\n<li>修改定值 (通用分类服务 ,ASDU10) </li>\n<li>读取测量值 (通用分类服务 , ASDU10,ASDU21) </li>\n<li>读取软压板（控制字） (通用分类服务 , ASDU10,ASDU21) </li>\n<li>修改软压板（控制字） (通用分类服务 ,ASDU10) </li>\n<li>校时 (ASDU6) </li>\n<li>信号复归 (ASDU20)</li>\n</ol>\n\n    </div>\n    </div>\n\n<h2 id=\"IEC-103-规约结构\"><a href=\"#IEC-103-规约结构\" class=\"headerlink\" title=\"IEC-103 规约结构\"></a>IEC-103 规约结构</h2><p><code>IEC 60870-5-103 </code>规约基于三层参考模型（增强性能结构） ，这种模型用三层来表示：<code>物理层</code>、<code>链路层</code>、<code>应用层</code>。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<h2 id=\"IEC-103-物理层说明\"><a href=\"#IEC-103-物理层说明\" class=\"headerlink\" title=\"IEC-103 物理层说明\"></a>IEC-103 物理层说明</h2><p>支持光纤或者 <code>RS-485</code> 方式。</p>\n<h2 id=\"IEC-103-链路层说明\"><a href=\"#IEC-103-链路层说明\" class=\"headerlink\" title=\"IEC-103 链路层说明\"></a>IEC-103 链路层说明</h2><h3 id=\"传输方式\"><a href=\"#传输方式\" class=\"headerlink\" title=\"传输方式\"></a>传输方式</h3><p>非平衡传输。控制系统组成主站，继电保护设备为子站，按照严格的<code>Polling</code>（轮询）方式进行通信。</p>\n<h3 id=\"传输速率、校验方式和重复帧传输的超时时间\"><a href=\"#传输速率、校验方式和重复帧传输的超时时间\" class=\"headerlink\" title=\"传输速率、校验方式和重复帧传输的超时时间\"></a>传输速率、校验方式和重复帧传输的超时时间</h3><p>传输速率为 <code>9600Kbit/s</code> 或 <code>19.2Kbit/s</code>(可调)。<code>8</code>位数据位，<code>1</code>位停止位，校验方式为<code>偶校验</code>。</p>\n<p>重复帧传输的超时时间间隔为<code>50ms</code>，控制系统中此值应当可以调节。</p>\n<h3 id=\"帧格式\"><a href=\"#帧格式\" class=\"headerlink\" title=\"帧格式\"></a>帧格式</h3><p>两种：固定长帧格式和非固定长帧格式。</p>\n<h4 id=\"固定长帧格式\"><a href=\"#固定长帧格式\" class=\"headerlink\" title=\"固定长帧格式\"></a>固定长帧格式</h4><p><img src=\"Screenshot_2.webp\"></p>\n<p>固定帧长帧格式用于控制系统向继电保护设备传输询问帧或命令帧（复位数据单元或复位帧计数位），或继电保护设备向控制系统传输确认帧或响应帧。</p>\n<p>帧校验和是控制字、地址的算术和（不考虑溢出位即 <code>256</code> 模和）</p>\n<p>子站和主站在接收报文时，校验启动字符、帧校验和、结束字符，检出任何一个差错，该数据帧无效。</p>\n<h4 id=\"可变长帧格式\"><a href=\"#可变长帧格式\" class=\"headerlink\" title=\"可变长帧格式\"></a>可变长帧格式</h4><p><img src=\"Screenshot_3.webp\"></p>\n<p>可变帧长帧格式用于控制系统向继电保护设备传输数据，或由继电保护设备向控制系统传输数据之用。</p>\n<p>长度<code>L</code>包括控制域、地址域、链路用户数据长度的总和， <code>L</code>最大值为 <code>255</code>,子站和主站在组织报文时， 要控制链路用户数据的长度， 注意使控制域、 地址域、 链路用户数据长度之和不要超出 <code>255</code>。如果超出，则要考虑分包传送。</p>\n<p>帧校验和是控制、地址、链路用户数据的算术和，（不考虑溢出位即 256 模和）。</p>\n<p>子站和主站在接收报文时， 应校验两个启动字符、 两个 <code>L</code>值应一致，接收字符数为 <code>L+6</code>,帧校验和、结束字符，若检出任何一个差错，则舍弃此帧数据。</p>\n<h4 id=\"控制系统至保护设备报文控制域定义\"><a href=\"#控制系统至保护设备报文控制域定义\" class=\"headerlink\" title=\"控制系统至保护设备报文控制域定义\"></a>控制系统至保护设备报文控制域定义</h4><p>8位，一个字节。</p>\n<p><img src=\"Screenshot_4.webp\"></p>\n<ul>\n<li>备用位，始终为0。</li>\n<li>启动报文位，始终为1，表示是由控制系统向继电保护设备传输，控制系统为启动站。</li>\n<li><code>FCB（帧计数位）</code>，控制系统向同一个继电保护设备进行新一轮的<code>发送/确认</code>或<code>请求/响应</code>时，将 <code>FCB</code> 取反值。控制系统应为每一个继电保护设备保留一个帧计数位(<code>FCB</code>)的拷贝，若超时未从继电保护设备收到报文，或接收出现差错，则控制系统不改变帧计数位(<code>FCB</code>)的状态，重传原报文，重传次数大于等于 3 次，如果通信恢复，则继续正常通信过程，否则将复位该继电保护设备。继电保护设备在发送报文时，应该保留该发送报文的一个拷贝。在下一轮传输过程中如果控制系统的<strong>FCB有效且没有取反</strong>，则继电保护设备重新发送上一次发送报文的拷贝。在下一轮传输过程中如果控制系统的有效且 <code>FCB</code> 取反，则组织新报文发送，并保留此新报文的一个拷贝，并丢弃原来报文的拷贝。这样有效防止了报文丢失。<br>复位命令的帧计数位 (<code>FCB</code>)为 0,帧计数有效位 (<code>FCV</code>) 为 0。<br>广播校时报文不需要考虑报文丢失和重复重传，无需改变帧计数位 (<code>FCB</code>) 的状态，故在广播校时报文中帧计数有效位 (<code>FCV</code>) 为 0。</li>\n<li><code>FCV</code>(帧计数有效位)，0表示帧计数位（FCB）的变化无效，1表示帧计数位（FCB）的变化有效。</li>\n<li>功能码：</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">功能码序号</th>\n<th align=\"center\">帧类型</th>\n<th align=\"center\">功能</th>\n<th align=\"center\">FCV</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">0</td>\n<td align=\"center\">发送/确认帧</td>\n<td align=\"center\">复位通信单元 (CU)</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">1－2</td>\n<td align=\"center\">——</td>\n<td align=\"center\">备用</td>\n<td align=\"center\">—</td>\n</tr>\n<tr>\n<td align=\"center\">3</td>\n<td align=\"center\">发送/确认帧</td>\n<td align=\"center\">传送数据 (总查询启动、命令报文、读写定值和软压板 （控制字），读取测量值 )</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">4</td>\n<td align=\"center\">发送/无回答帧</td>\n<td align=\"center\">传送数据（广播校时）</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">5－6</td>\n<td align=\"center\">——</td>\n<td align=\"center\">备用</td>\n<td align=\"center\">—</td>\n</tr>\n<tr>\n<td align=\"center\">7</td>\n<td align=\"center\">复位帧计数位 (FCB)</td>\n<td align=\"center\">传送数据</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">8</td>\n<td align=\"center\">——</td>\n<td align=\"center\">备用</td>\n<td align=\"center\">—</td>\n</tr>\n<tr>\n<td align=\"center\">9</td>\n<td align=\"center\">请求/响应帧</td>\n<td align=\"center\">召唤链路状态</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">10</td>\n<td align=\"center\">请求/响应帧</td>\n<td align=\"center\">召唤1级用户数据</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">11</td>\n<td align=\"center\">请求/响应帧</td>\n<td align=\"center\">召唤2级用户数据</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">12－13</td>\n<td align=\"center\">——</td>\n<td align=\"center\">备用</td>\n<td align=\"center\">—</td>\n</tr>\n<tr>\n<td align=\"center\">14－15</td>\n<td align=\"center\">——</td>\n<td align=\"center\">备用</td>\n<td align=\"center\">—</td>\n</tr>\n</tbody></table>\n<style>\n  table {\n    margin: auto;\n    font-size: 70%;\n  }\n</style>\n\n<h4 id=\"保护设备至控制系统报文控制域的定义\"><a href=\"#保护设备至控制系统报文控制域的定义\" class=\"headerlink\" title=\"保护设备至控制系统报文控制域的定义\"></a>保护设备至控制系统报文控制域的定义</h4><p>8位，一个字节。</p>\n<p><img src=\"Screenshot_5.webp\"></p>\n<ul>\n<li>备用位，始终为 0。</li>\n<li>启动报文位，始终为 0：表示是由继电保护设备向控制系统传输。</li>\n<li><code>ACD</code>( 要求访问位 )，继电保护设备有 <code>1</code> 级用户用户数据，将 <code>ACD</code> 置 <code>1</code> 通知控制系统召唤 <code>1</code> 级用户数据，如果继电保护设备没有 <code>1</code> 级用户数据，则将 <code>ACD</code> 置 <code>0</code>。</li>\n<li><code>DFC</code>(数据流控制位 ) ，<code>DFC=0</code>表示继电保护设备可以接受数据。<code>DFC=1</code>表示继电保护设备的缓冲区已满，无法接受新数据。</li>\n<li>本规约规定深圳所保护设备上送报文中 <code>DFC</code> 始终为 0，即可以接受新数据， 控制系统应能够处理 <code>DFC=1</code> 的报文。</li>\n<li>功能码</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">功能码序号</th>\n<th align=\"center\">帧类型</th>\n<th align=\"center\">功能</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">0</td>\n<td align=\"center\">确认帧</td>\n<td align=\"center\">确认</td>\n</tr>\n<tr>\n<td align=\"center\">1</td>\n<td align=\"center\">确认帧</td>\n<td align=\"center\">链路忙</td>\n</tr>\n<tr>\n<td align=\"center\">2－5</td>\n<td align=\"center\">——</td>\n<td align=\"center\">备用</td>\n</tr>\n<tr>\n<td align=\"center\">6－7</td>\n<td align=\"center\">——</td>\n<td align=\"center\">制造厂和用户协商定义</td>\n</tr>\n<tr>\n<td align=\"center\">8</td>\n<td align=\"center\">响应帧</td>\n<td align=\"center\">以数据响应请求帧</td>\n</tr>\n<tr>\n<td align=\"center\">9</td>\n<td align=\"center\">响应帧</td>\n<td align=\"center\">无所召唤的数据</td>\n</tr>\n<tr>\n<td align=\"center\">10</td>\n<td align=\"center\">——</td>\n<td align=\"center\">备用</td>\n</tr>\n<tr>\n<td align=\"center\">11</td>\n<td align=\"center\">响应帧</td>\n<td align=\"center\">以链路状态或访问请求回答请求帧</td>\n</tr>\n<tr>\n<td align=\"center\">12</td>\n<td align=\"center\"></td>\n<td align=\"center\">备用</td>\n</tr>\n<tr>\n<td align=\"center\">13</td>\n<td align=\"center\"></td>\n<td align=\"center\">制造厂和用户协商定义</td>\n</tr>\n<tr>\n<td align=\"center\">14</td>\n<td align=\"center\"></td>\n<td align=\"center\">链路服务未工作</td>\n</tr>\n<tr>\n<td align=\"center\">15</td>\n<td align=\"center\"></td>\n<td align=\"center\">链路服务未工作</td>\n</tr>\n</tbody></table>\n<p>功能码 0 :<br>继电保护设备从控制系统接收到复位、 读写数据报文时， 在传递 1 级用户数据之前， 都要发送一个短帧来通知控制系统继电保护设备已经接收到复位或读写数据报文， 且如果有 1级用户数据则将 ACD 置 1 来通知控制系统召唤 1 级用户数据。</p>\n<p>功能码 1：<br>如果控制系统向继电保护设备召唤 1 级用户 ,继电保护设备能够确定有需要发送的 1 级用户数据 ,但由于某种原因无法立即组织好 ,可以用此功能码来组织短帧<code>10 21 01 22 16</code>（假定地址为 1） 通知控制系统该继电保护设备链路忙，控制系统在接收到此报文后在下一个周期轮询到此继电保护设备时，继续召唤 1 级用户数据。</p>\n<h2 id=\"IEC-103应用层说明\"><a href=\"#IEC-103应用层说明\" class=\"headerlink\" title=\"IEC-103应用层说明\"></a>IEC-103应用层说明</h2><h3 id=\"1级和2级用户\"><a href=\"#1级和2级用户\" class=\"headerlink\" title=\"1级和2级用户\"></a>1级和2级用户</h3><p>1级用户数据（优先级从高到低）：</p>\n<ol>\n<li>一次设备的工作状态和系统工作状态发生变化时形成的数据。</li>\n<li>继电保护设备动作信号。</li>\n<li>初始化过程中，继电保护设备发送的 <code>ASDU5</code> 报文。</li>\n<li>控制系统发送总查询命令后，继电保护传送的状态量或动作信息，继电保护设备发送的总查询结束报文。</li>\n<li>命令传输过程中，继电保护设备形成的肯定或否定认可报文。</li>\n<li>在通用分类服务控制系统发送读或写命令后，继电保护设备发送的 <code>ASDU10</code> 报文。</li>\n<li>继电保护设备在故障录波后形成扰动数据时所产生的如下内容：</li>\n</ol>\n<div class=\"panel panel-info\">\n    <div class=\"panel-title\">扰动信息</div>\n    <div class=\"panel-body\">\n        <ul>\n<li> 扰动数据表 <code>ASDU23</code> </li>\n<li> 扰动数据传输准备就绪 <code>ASDU26</code> </li>\n<li> 被记录的通道传输准备就绪 <code>ASDU27</code> </li>\n<li> 带标志的状态变位传输准备就绪 <code>ASDU28</code> </li>\n<li> 传送带标志的状态变位的状态 <code>ASDU29</code> </li>\n<li> 传送扰动值 <code>ASDU30</code> </li>\n<li> 带标志的状态变位传输结束 <code>ASDU31</code></li>\n</ul>\n\n    </div>\n    </div>\n\n<p>2 级用户数据：</p>\n<p>二级用户数据主要用来传输测量值， <code>IEC－ 103(深圳所)</code>规定深圳所继电保护设备测量值采用通用分类服务传输， 故无 2 级用户数据， 当主站召唤 2 级用户数据时， 用无所请求报文数据回答。 但要求在非深圳所继电保护设备利用 <code>ASDU3</code> <code>、ASDU9</code> 上送测量值的情况下， 深圳所控制系统能够支持。</p>\n<h3 id=\"应用层系统介绍\"><a href=\"#应用层系统介绍\" class=\"headerlink\" title=\"应用层系统介绍\"></a>应用层系统介绍</h3><p><code>IEC－103（深圳所）</code>是严格的 <code>Polling</code> 规约，按照非平衡方式传输，控制系统为主站，继电保护为子站。通信开始时，控制系统向继电保护设备发送服务命令使通信功能复位，然后是对保护进行广播校时，和总查询，总查询完毕后进入通常的召唤 2 级用户数据的过程。如果有突发事件，则子站首先通过<code>ACD</code>标志位置 1 通知主站本子站有 1 级用户数据， 主站然后根据<code>ACD</code>标志位为 1 来召唤 1 级用户数据。 对于控制系统主动发送的命令或通用分类服务读命令，子站首先响应一个短帧来确认收到此命令，并将<code>ACD</code>位置 1，通知主站有 1 级用户数据，主站然后根据<code>ACD</code>标志位为 1 来召唤 1 级用户数据， 如果此时子站尚未准备好 1 级用户数据， 则可发送链路忙报文并将<code>ACD</code>置 1 以通知主站子站忙，主站接收到此报文后应继续召唤 1 级用户数据，直到最后接收到 1 级用户数据或无所请求报文为止。</p>\n<p>为了防止主站对某一个子站进行查询的时间过长，规定与某一个子站通信一次后应马上转入与下一个子站的通信过程， 主站应该记录与该子站的通信状态， 以便下一次轮询到此子站时能够继续正常通信。</p>\n<p>  应用层功能实现：<br>  利用<code>ASDU1</code>传送告警、状态信息<br>  利用<code>ASDU2</code>来传送事件<br>  利用<code>ASDU6</code>来对保护装置校时<br>  利用<code>ASDU20</code>来对保护装置信号复归<br>  利用通用分类服务实现调取和修改定值、调取和修改测量值、调取测量值，其中定值支持调取多组定值。</p>\n"},{"title":"在Hexo博客中嵌入外链视频","date":"2021-05-11T01:12:11.000Z","pic":null,"comments":1,"toc":true,"only":["home","category","tag"],"_content":"\n# 嵌入的视频\n\nHexo支持Youtube视频的嵌入，可以参考其实现方式。\n\n首先，在`node_modules/hexo/lib/plugins/tag/index.js`中添加以下代码。\n\n```javascript\n  // 添加哔哩哔哩\n  tag.register('bilibili', require('./bilibili'));\n```\n\n然后在`node_modules/hexo/lib/plugins/tag/`目录下新建`bilibili.js`文件，打开并添加如下代码：\n\n```javascript\n'use strict';\n\nconst { htmlTag } = require('hexo-util');\n\n/**\n* bilibili tag\n*\n* Syntax:\n*   {% bilibili id %}\n*/\n\nfunction bilibiliTag(args, content) {\n  var id = args[0];\n  return `<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?${id}\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"> </iframe></div>`;\n}\n\nmodule.exports = bilibiliTag;\n\n```\n\n重新启动下`Hexo Server`,在`md`页面中添加下列：\n\n```javascript\n{% bilibili aid=586894170&bvid=BV1uz4y1m72t&cid=305401685&page=1 %}\n```\n\n重新刷新页面，就可以看到视频正常加载了。\n\n{% bilibili aid=586894170&bvid=BV1uz4y1m72t&cid=305401685&page=1 %}","source":"_posts/在Hexo博客中嵌入外链视频.md","raw":"---\ntitle: 在Hexo博客中嵌入外链视频\ndate: 2021-05-11 09:12:11\ncategories: 博客教程\ntags:\n- Hexo\n# sticky: 100\npic:\ncomments: true\ntoc: true\nonly:\n- home\n- category\n- tag\n---\n\n# 嵌入的视频\n\nHexo支持Youtube视频的嵌入，可以参考其实现方式。\n\n首先，在`node_modules/hexo/lib/plugins/tag/index.js`中添加以下代码。\n\n```javascript\n  // 添加哔哩哔哩\n  tag.register('bilibili', require('./bilibili'));\n```\n\n然后在`node_modules/hexo/lib/plugins/tag/`目录下新建`bilibili.js`文件，打开并添加如下代码：\n\n```javascript\n'use strict';\n\nconst { htmlTag } = require('hexo-util');\n\n/**\n* bilibili tag\n*\n* Syntax:\n*   {% bilibili id %}\n*/\n\nfunction bilibiliTag(args, content) {\n  var id = args[0];\n  return `<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?${id}\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"> </iframe></div>`;\n}\n\nmodule.exports = bilibiliTag;\n\n```\n\n重新启动下`Hexo Server`,在`md`页面中添加下列：\n\n```javascript\n{% bilibili aid=586894170&bvid=BV1uz4y1m72t&cid=305401685&page=1 %}\n```\n\n重新刷新页面，就可以看到视频正常加载了。\n\n{% bilibili aid=586894170&bvid=BV1uz4y1m72t&cid=305401685&page=1 %}","slug":"在Hexo博客中嵌入外链视频","published":1,"updated":"2021-06-15T03:24:11.544Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2s003344ud4pk93oai","content":"<h1 id=\"嵌入的视频\"><a href=\"#嵌入的视频\" class=\"headerlink\" title=\"嵌入的视频\"></a>嵌入的视频</h1><p>Hexo支持Youtube视频的嵌入，可以参考其实现方式。</p>\n<p>首先，在<code>node_modules/hexo/lib/plugins/tag/index.js</code>中添加以下代码。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 添加哔哩哔哩</span></span><br><span class=\"line\">tag.register(<span class=\"string\">&#x27;bilibili&#x27;</span>, <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./bilibili&#x27;</span>));</span><br></pre></td></tr></table></figure>\n\n<p>然后在<code>node_modules/hexo/lib/plugins/tag/</code>目录下新建<code>bilibili.js</code>文件，打开并添加如下代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&#x27;use strict&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; htmlTag &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;hexo-util&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* bilibili tag</span></span><br><span class=\"line\"><span class=\"comment\">*</span></span><br><span class=\"line\"><span class=\"comment\">* Syntax:</span></span><br><span class=\"line\"><span class=\"comment\">*   &#123;% bilibili id %&#125;</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bilibiliTag</span>(<span class=\"params\">args, content</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> id = args[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">`&lt;div style=&quot;position: relative; width: 100%; height: 0; padding-bottom: 75%;&quot;&gt;&lt;iframe src=&quot;//player.bilibili.com/player.html?<span class=\"subst\">$&#123;id&#125;</span>&quot; scrolling=&quot;no&quot; border=&quot;0&quot; frameborder=&quot;no&quot; framespacing=&quot;0&quot; allowfullscreen=&quot;true&quot; style=&quot;position: absolute; width: 100%; height: 100%; left: 0; top: 0;&quot;&gt; &lt;/iframe&gt;&lt;/div&gt;`</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = bilibiliTag;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>重新启动下<code>Hexo Server</code>,在<code>md</code>页面中添加下列：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% bilibili aid=<span class=\"number\">586894170</span>&amp;bvid=BV1uz4y1m72t&amp;cid=<span class=\"number\">305401685</span>&amp;page=<span class=\"number\">1</span> %&#125;</span><br></pre></td></tr></table></figure>\n\n<p>重新刷新页面，就可以看到视频正常加载了。</p>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=586894170&bvid=BV1uz4y1m72t&cid=305401685&page=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"> </iframe></div>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"嵌入的视频\"><a href=\"#嵌入的视频\" class=\"headerlink\" title=\"嵌入的视频\"></a>嵌入的视频</h1><p>Hexo支持Youtube视频的嵌入，可以参考其实现方式。</p>\n<p>首先，在<code>node_modules/hexo/lib/plugins/tag/index.js</code>中添加以下代码。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 添加哔哩哔哩</span></span><br><span class=\"line\">tag.register(<span class=\"string\">&#x27;bilibili&#x27;</span>, <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./bilibili&#x27;</span>));</span><br></pre></td></tr></table></figure>\n\n<p>然后在<code>node_modules/hexo/lib/plugins/tag/</code>目录下新建<code>bilibili.js</code>文件，打开并添加如下代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&#x27;use strict&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; htmlTag &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;hexo-util&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* bilibili tag</span></span><br><span class=\"line\"><span class=\"comment\">*</span></span><br><span class=\"line\"><span class=\"comment\">* Syntax:</span></span><br><span class=\"line\"><span class=\"comment\">*   &#123;% bilibili id %&#125;</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bilibiliTag</span>(<span class=\"params\">args, content</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> id = args[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">`&lt;div style=&quot;position: relative; width: 100%; height: 0; padding-bottom: 75%;&quot;&gt;&lt;iframe src=&quot;//player.bilibili.com/player.html?<span class=\"subst\">$&#123;id&#125;</span>&quot; scrolling=&quot;no&quot; border=&quot;0&quot; frameborder=&quot;no&quot; framespacing=&quot;0&quot; allowfullscreen=&quot;true&quot; style=&quot;position: absolute; width: 100%; height: 100%; left: 0; top: 0;&quot;&gt; &lt;/iframe&gt;&lt;/div&gt;`</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = bilibiliTag;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>重新启动下<code>Hexo Server</code>,在<code>md</code>页面中添加下列：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% bilibili aid=<span class=\"number\">586894170</span>&amp;bvid=BV1uz4y1m72t&amp;cid=<span class=\"number\">305401685</span>&amp;page=<span class=\"number\">1</span> %&#125;</span><br></pre></td></tr></table></figure>\n\n<p>重新刷新页面，就可以看到视频正常加载了。</p>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\"><iframe src=\"//player.bilibili.com/player.html?aid=586894170&bvid=BV1uz4y1m72t&cid=305401685&page=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"> </iframe></div>"},{"title":"基于NextCloud搭建个人网盘","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-20T08:16:41.000Z","pic":null,"_content":"\n## Nextcloud\n\n`Nextcloud`是一款开源免费的私有云存储网盘项目，可以让你快速便捷地搭建一套属于自己或团队的云同步网盘，从而实现跨平台跨设备文件同步、共享、版本控制、团队协作等功能。它的客户端覆盖了`Windows`、`Mac`、`Android`、`iOS`、`Linux`等各种平台，也提供了网页端以及`WebDAV`接口，所以你几乎可以在各种设备上方便地访问你的云盘。\n\n## 安装 Nextcloud\n\n### 安装Mysql\n\n```shell\ndocker pull mysql # 拉取镜像\n\ndocker images # 查看名称/镜像id\n\ndocker run -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=******** -d c0cdc95609f1 #c0cdc95609f1（镜像id）\n```\n\n运行`mysql`并且设置访问端口：`3306`，容器名称：`mysql` ,管理员密码：`********`\n\n进入容器`bash`。\n\n```shell\ndocker exec -it 容器名称/容器id bash\n```\n\n登陆`mysql`\n\n```shell\nmysql -uroot -p\n```\n\n接着输入管理员密码：`admin`,回车。\n创建一个数据库\n\n```mysql\nCREATE DATABASE nextcloud;\n```\n\n创建一个用户\n\n```mysql\nCREATE USER 'nextcloud'@'%' IDENTIFIED BY 'admin';\n```\n\n创建一个用户名称为：`nextcloud；‘%’`：代表不限`ip`登陆，远程登陆; 密码为：`admin`。\n\n授权。\n\n```mysql\nGRANT ALL PRIVILEGES ON nextcloud.* TO nextcloud@'%'  WITH GRANT OPTION;\n```\n\n给这个用户`nextcloud`授予 这个数据库`nextcloud.*`所有的权限，远程登陆，密码为`admin`；\n\n### 基于Docker部署Nextcloud服务端\n\n选择以`Docker`的方式来部署`nextcloud`是因为`Docker`可以跨平台上运行，可以确保执行环境的一致性，有利于应用的迁移和管理。\n\n服务端部署的基本流程是：**安装`Docker`并启动** --> **运行`Nextcloud`容器** --> **访问`Web`端初始化**。\n\n安装的话不做过多说明，参考官方文档或本博客其他博文。\n\n下载`Nextcloud`镜像\n\n```shell\ndocker pull nextcloud\n```\n\n运行`Nextcloud`\n\n参数说明：\n\n- -d #容器后台运行\n- --name nextcloud #容器名\n- -v /data/nextcloud:/var/www/html #将宿主机的目录/data/nextcloud挂载到容器的/var/www/html\n- -p 8000:80 #将宿主机的端口（此处以8000为例）映射到容器的80端口\"\n\n```shell\ndocker run -d \\\n--name nextcloud \\\n-p 8000:80 \\\n-v /data/nextcloud:/var/www/html \\\nnextcloud\n```\n\n查看运行的容器。\n\n```shell\ndocker ps -a\n```\n\n停止运行的容器。\n\n```shell\ndocker stop id\n```","source":"_posts/基于centos搭建个人网盘.md","raw":"---\ntitle: 基于NextCloud搭建个人网盘\ntags:\n  - nextCloud\n  - docker\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-20 16:16:41\ncategories: 博客教程\npic:\n---\n\n## Nextcloud\n\n`Nextcloud`是一款开源免费的私有云存储网盘项目，可以让你快速便捷地搭建一套属于自己或团队的云同步网盘，从而实现跨平台跨设备文件同步、共享、版本控制、团队协作等功能。它的客户端覆盖了`Windows`、`Mac`、`Android`、`iOS`、`Linux`等各种平台，也提供了网页端以及`WebDAV`接口，所以你几乎可以在各种设备上方便地访问你的云盘。\n\n## 安装 Nextcloud\n\n### 安装Mysql\n\n```shell\ndocker pull mysql # 拉取镜像\n\ndocker images # 查看名称/镜像id\n\ndocker run -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=******** -d c0cdc95609f1 #c0cdc95609f1（镜像id）\n```\n\n运行`mysql`并且设置访问端口：`3306`，容器名称：`mysql` ,管理员密码：`********`\n\n进入容器`bash`。\n\n```shell\ndocker exec -it 容器名称/容器id bash\n```\n\n登陆`mysql`\n\n```shell\nmysql -uroot -p\n```\n\n接着输入管理员密码：`admin`,回车。\n创建一个数据库\n\n```mysql\nCREATE DATABASE nextcloud;\n```\n\n创建一个用户\n\n```mysql\nCREATE USER 'nextcloud'@'%' IDENTIFIED BY 'admin';\n```\n\n创建一个用户名称为：`nextcloud；‘%’`：代表不限`ip`登陆，远程登陆; 密码为：`admin`。\n\n授权。\n\n```mysql\nGRANT ALL PRIVILEGES ON nextcloud.* TO nextcloud@'%'  WITH GRANT OPTION;\n```\n\n给这个用户`nextcloud`授予 这个数据库`nextcloud.*`所有的权限，远程登陆，密码为`admin`；\n\n### 基于Docker部署Nextcloud服务端\n\n选择以`Docker`的方式来部署`nextcloud`是因为`Docker`可以跨平台上运行，可以确保执行环境的一致性，有利于应用的迁移和管理。\n\n服务端部署的基本流程是：**安装`Docker`并启动** --> **运行`Nextcloud`容器** --> **访问`Web`端初始化**。\n\n安装的话不做过多说明，参考官方文档或本博客其他博文。\n\n下载`Nextcloud`镜像\n\n```shell\ndocker pull nextcloud\n```\n\n运行`Nextcloud`\n\n参数说明：\n\n- -d #容器后台运行\n- --name nextcloud #容器名\n- -v /data/nextcloud:/var/www/html #将宿主机的目录/data/nextcloud挂载到容器的/var/www/html\n- -p 8000:80 #将宿主机的端口（此处以8000为例）映射到容器的80端口\"\n\n```shell\ndocker run -d \\\n--name nextcloud \\\n-p 8000:80 \\\n-v /data/nextcloud:/var/www/html \\\nnextcloud\n```\n\n查看运行的容器。\n\n```shell\ndocker ps -a\n```\n\n停止运行的容器。\n\n```shell\ndocker stop id\n```","slug":"基于centos搭建个人网盘","published":1,"updated":"2021-06-15T03:24:11.545Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2u003844ud7ct5fkxg","content":"<h2 id=\"Nextcloud\"><a href=\"#Nextcloud\" class=\"headerlink\" title=\"Nextcloud\"></a>Nextcloud</h2><p><code>Nextcloud</code>是一款开源免费的私有云存储网盘项目，可以让你快速便捷地搭建一套属于自己或团队的云同步网盘，从而实现跨平台跨设备文件同步、共享、版本控制、团队协作等功能。它的客户端覆盖了<code>Windows</code>、<code>Mac</code>、<code>Android</code>、<code>iOS</code>、<code>Linux</code>等各种平台，也提供了网页端以及<code>WebDAV</code>接口，所以你几乎可以在各种设备上方便地访问你的云盘。</p>\n<h2 id=\"安装-Nextcloud\"><a href=\"#安装-Nextcloud\" class=\"headerlink\" title=\"安装 Nextcloud\"></a>安装 Nextcloud</h2><h3 id=\"安装Mysql\"><a href=\"#安装Mysql\" class=\"headerlink\" title=\"安装Mysql\"></a>安装Mysql</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull mysql # 拉取镜像</span><br><span class=\"line\"></span><br><span class=\"line\">docker images # 查看名称/镜像id</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=******** -d c0cdc95609f1 #c0cdc95609f1（镜像id）</span><br></pre></td></tr></table></figure>\n\n<p>运行<code>mysql</code>并且设置访问端口：<code>3306</code>，容器名称：<code>mysql</code> ,管理员密码：<code>********</code></p>\n<p>进入容器<code>bash</code>。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it 容器名称/容器id bash</span><br></pre></td></tr></table></figure>\n\n<p>登陆<code>mysql</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -uroot -p</span><br></pre></td></tr></table></figure>\n\n<p>接着输入管理员密码：<code>admin</code>,回车。<br>创建一个数据库</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE DATABASE nextcloud;</span><br></pre></td></tr></table></figure>\n\n<p>创建一个用户</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE USER &#x27;nextcloud&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;admin&#x27;;</span><br></pre></td></tr></table></figure>\n\n<p>创建一个用户名称为：<code>nextcloud；‘%’</code>：代表不限<code>ip</code>登陆，远程登陆; 密码为：<code>admin</code>。</p>\n<p>授权。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GRANT ALL PRIVILEGES ON nextcloud.* TO nextcloud@&#x27;%&#x27;  WITH GRANT OPTION;</span><br></pre></td></tr></table></figure>\n\n<p>给这个用户<code>nextcloud</code>授予 这个数据库<code>nextcloud.*</code>所有的权限，远程登陆，密码为<code>admin</code>；</p>\n<h3 id=\"基于Docker部署Nextcloud服务端\"><a href=\"#基于Docker部署Nextcloud服务端\" class=\"headerlink\" title=\"基于Docker部署Nextcloud服务端\"></a>基于Docker部署Nextcloud服务端</h3><p>选择以<code>Docker</code>的方式来部署<code>nextcloud</code>是因为<code>Docker</code>可以跨平台上运行，可以确保执行环境的一致性，有利于应用的迁移和管理。</p>\n<p>服务端部署的基本流程是：<strong>安装<code>Docker</code>并启动</strong> –&gt; <strong>运行<code>Nextcloud</code>容器</strong> –&gt; <strong>访问<code>Web</code>端初始化</strong>。</p>\n<p>安装的话不做过多说明，参考官方文档或本博客其他博文。</p>\n<p>下载<code>Nextcloud</code>镜像</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull nextcloud</span><br></pre></td></tr></table></figure>\n\n<p>运行<code>Nextcloud</code></p>\n<p>参数说明：</p>\n<ul>\n<li>-d #容器后台运行</li>\n<li>–name nextcloud #容器名</li>\n<li>-v /data/nextcloud:/var/www/html #将宿主机的目录/data/nextcloud挂载到容器的/var/www/html</li>\n<li>-p 8000:80 #将宿主机的端口（此处以8000为例）映射到容器的80端口”</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d \\</span><br><span class=\"line\">--name nextcloud \\</span><br><span class=\"line\">-p 8000:80 \\</span><br><span class=\"line\">-v /data/nextcloud:/var/www/html \\</span><br><span class=\"line\">nextcloud</span><br></pre></td></tr></table></figure>\n\n<p>查看运行的容器。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker ps -a</span><br></pre></td></tr></table></figure>\n\n<p>停止运行的容器。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker stop id</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Nextcloud\"><a href=\"#Nextcloud\" class=\"headerlink\" title=\"Nextcloud\"></a>Nextcloud</h2><p><code>Nextcloud</code>是一款开源免费的私有云存储网盘项目，可以让你快速便捷地搭建一套属于自己或团队的云同步网盘，从而实现跨平台跨设备文件同步、共享、版本控制、团队协作等功能。它的客户端覆盖了<code>Windows</code>、<code>Mac</code>、<code>Android</code>、<code>iOS</code>、<code>Linux</code>等各种平台，也提供了网页端以及<code>WebDAV</code>接口，所以你几乎可以在各种设备上方便地访问你的云盘。</p>\n<h2 id=\"安装-Nextcloud\"><a href=\"#安装-Nextcloud\" class=\"headerlink\" title=\"安装 Nextcloud\"></a>安装 Nextcloud</h2><h3 id=\"安装Mysql\"><a href=\"#安装Mysql\" class=\"headerlink\" title=\"安装Mysql\"></a>安装Mysql</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull mysql # 拉取镜像</span><br><span class=\"line\"></span><br><span class=\"line\">docker images # 查看名称/镜像id</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=******** -d c0cdc95609f1 #c0cdc95609f1（镜像id）</span><br></pre></td></tr></table></figure>\n\n<p>运行<code>mysql</code>并且设置访问端口：<code>3306</code>，容器名称：<code>mysql</code> ,管理员密码：<code>********</code></p>\n<p>进入容器<code>bash</code>。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it 容器名称/容器id bash</span><br></pre></td></tr></table></figure>\n\n<p>登陆<code>mysql</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -uroot -p</span><br></pre></td></tr></table></figure>\n\n<p>接着输入管理员密码：<code>admin</code>,回车。<br>创建一个数据库</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE DATABASE nextcloud;</span><br></pre></td></tr></table></figure>\n\n<p>创建一个用户</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE USER &#x27;nextcloud&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;admin&#x27;;</span><br></pre></td></tr></table></figure>\n\n<p>创建一个用户名称为：<code>nextcloud；‘%’</code>：代表不限<code>ip</code>登陆，远程登陆; 密码为：<code>admin</code>。</p>\n<p>授权。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GRANT ALL PRIVILEGES ON nextcloud.* TO nextcloud@&#x27;%&#x27;  WITH GRANT OPTION;</span><br></pre></td></tr></table></figure>\n\n<p>给这个用户<code>nextcloud</code>授予 这个数据库<code>nextcloud.*</code>所有的权限，远程登陆，密码为<code>admin</code>；</p>\n<h3 id=\"基于Docker部署Nextcloud服务端\"><a href=\"#基于Docker部署Nextcloud服务端\" class=\"headerlink\" title=\"基于Docker部署Nextcloud服务端\"></a>基于Docker部署Nextcloud服务端</h3><p>选择以<code>Docker</code>的方式来部署<code>nextcloud</code>是因为<code>Docker</code>可以跨平台上运行，可以确保执行环境的一致性，有利于应用的迁移和管理。</p>\n<p>服务端部署的基本流程是：<strong>安装<code>Docker</code>并启动</strong> –&gt; <strong>运行<code>Nextcloud</code>容器</strong> –&gt; <strong>访问<code>Web</code>端初始化</strong>。</p>\n<p>安装的话不做过多说明，参考官方文档或本博客其他博文。</p>\n<p>下载<code>Nextcloud</code>镜像</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull nextcloud</span><br></pre></td></tr></table></figure>\n\n<p>运行<code>Nextcloud</code></p>\n<p>参数说明：</p>\n<ul>\n<li>-d #容器后台运行</li>\n<li>–name nextcloud #容器名</li>\n<li>-v /data/nextcloud:/var/www/html #将宿主机的目录/data/nextcloud挂载到容器的/var/www/html</li>\n<li>-p 8000:80 #将宿主机的端口（此处以8000为例）映射到容器的80端口”</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d \\</span><br><span class=\"line\">--name nextcloud \\</span><br><span class=\"line\">-p 8000:80 \\</span><br><span class=\"line\">-v /data/nextcloud:/var/www/html \\</span><br><span class=\"line\">nextcloud</span><br></pre></td></tr></table></figure>\n\n<p>查看运行的容器。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker ps -a</span><br></pre></td></tr></table></figure>\n\n<p>停止运行的容器。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker stop id</span><br></pre></td></tr></table></figure>"},{"title":"基于docker安装redis","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-04T11:11:27.000Z","pic":null,"_content":"\n## 获取redis镜像\n\n安装环境，腾讯云。\n\n```shell\ndocker pull redis\n```\n\n不加版本号默认获取最新版本，也可以使用 `docker search redis` 查看镜像来源。\n\n## 查看本地镜像\n\n```shell\n[root@VM-0-15-centos ~]# docker images\nREPOSITORY                TAG       IMAGE ID       CREATED        SIZE\nredis                     latest    fad0ee7e917a   2 days ago     105MB\n```\n\n## 配置\n\n官网获取[redis](http://download.redis.io/redis-stable/redis.conf)配置文件:\n\n- 修改默认的配置文件\n\n```shell\n# bind 127.0.0.1 -::1   #注释这部分，去掉限制只能本地访问\n\nprotected-mode no   # 默认yes,开启保护模式，限制为本地访问\n\ndaemonize no    # 默认no，改为yes意为以守护进程方式启动，可后台运行，除非kill进程（可选），改为yes会使配置文件方式启动redis失败\n\ndir ./root/redis/data #输入本地redis数据库存放文件夹（可选）\n\nappendonly yes #redis持久化（可选）\n```\n\n使用xftp登录服务器，在`/root/redis/data `创建好文件夹用于存放`redis`数据，这个文件夹位置可自己设定。然后将配置好的`redis.conf`文件复制入`/root/redis/`文件夹下。\n\n## 运行\n\n```python\ndocker run -p 6379:6379 --name redis -v /root/redis/redis.conf:/etc/redis/redis.conf  -v /root/redis/data:/data -d redis:latest redis-server /etc/redis/redis.conf --appendonly yes\n```\n\n启动命令解释如下：\n\n```shell\n-p 6379:6379:把容器内的6379端口映射到宿主机6379端口\n-v /root/redis/redis.conf:/etc/redis/redis.conf：把宿主机配置好的redis.conf放到容器内的这个位置中\n-v /root/redis/data:/data：把redis持久化的数据在宿主机内显示，做数据备份\nredis-server /etc/redis/redis.conf：这个是关键配置，让redis不是无配置启动，而是按照这个redis.conf的配置启动\n–appendonly yes：redis启动后数据持久化\n```\n","source":"_posts/基于docker安装redis.md","raw":"---\ntitle: 基于docker安装redis\ntags:\n  - docker\n  - redis\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-04 19:11:27\ncategories: Docker\npic:\n---\n\n## 获取redis镜像\n\n安装环境，腾讯云。\n\n```shell\ndocker pull redis\n```\n\n不加版本号默认获取最新版本，也可以使用 `docker search redis` 查看镜像来源。\n\n## 查看本地镜像\n\n```shell\n[root@VM-0-15-centos ~]# docker images\nREPOSITORY                TAG       IMAGE ID       CREATED        SIZE\nredis                     latest    fad0ee7e917a   2 days ago     105MB\n```\n\n## 配置\n\n官网获取[redis](http://download.redis.io/redis-stable/redis.conf)配置文件:\n\n- 修改默认的配置文件\n\n```shell\n# bind 127.0.0.1 -::1   #注释这部分，去掉限制只能本地访问\n\nprotected-mode no   # 默认yes,开启保护模式，限制为本地访问\n\ndaemonize no    # 默认no，改为yes意为以守护进程方式启动，可后台运行，除非kill进程（可选），改为yes会使配置文件方式启动redis失败\n\ndir ./root/redis/data #输入本地redis数据库存放文件夹（可选）\n\nappendonly yes #redis持久化（可选）\n```\n\n使用xftp登录服务器，在`/root/redis/data `创建好文件夹用于存放`redis`数据，这个文件夹位置可自己设定。然后将配置好的`redis.conf`文件复制入`/root/redis/`文件夹下。\n\n## 运行\n\n```python\ndocker run -p 6379:6379 --name redis -v /root/redis/redis.conf:/etc/redis/redis.conf  -v /root/redis/data:/data -d redis:latest redis-server /etc/redis/redis.conf --appendonly yes\n```\n\n启动命令解释如下：\n\n```shell\n-p 6379:6379:把容器内的6379端口映射到宿主机6379端口\n-v /root/redis/redis.conf:/etc/redis/redis.conf：把宿主机配置好的redis.conf放到容器内的这个位置中\n-v /root/redis/data:/data：把redis持久化的数据在宿主机内显示，做数据备份\nredis-server /etc/redis/redis.conf：这个是关键配置，让redis不是无配置启动，而是按照这个redis.conf的配置启动\n–appendonly yes：redis启动后数据持久化\n```\n","slug":"基于docker安装redis","published":1,"updated":"2021-06-15T15:47:31.609Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2v003b44udf8rz5b76","content":"<h2 id=\"获取redis镜像\"><a href=\"#获取redis镜像\" class=\"headerlink\" title=\"获取redis镜像\"></a>获取redis镜像</h2><p>安装环境，腾讯云。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull redis</span><br></pre></td></tr></table></figure>\n\n<p>不加版本号默认获取最新版本，也可以使用 <code>docker search redis</code> 查看镜像来源。</p>\n<h2 id=\"查看本地镜像\"><a href=\"#查看本地镜像\" class=\"headerlink\" title=\"查看本地镜像\"></a>查看本地镜像</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@VM-0-15-centos ~]# docker images</span><br><span class=\"line\">REPOSITORY                TAG       IMAGE ID       CREATED        SIZE</span><br><span class=\"line\">redis                     latest    fad0ee7e917a   2 days ago     105MB</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>官网获取<a href=\"http://download.redis.io/redis-stable/redis.conf\">redis</a>配置文件:</p>\n<ul>\n<li>修改默认的配置文件</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> <span class=\"built_in\">bind</span> 127.0.0.1 -::1   <span class=\"comment\">#注释这部分，去掉限制只能本地访问</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">protected-mode no   # 默认yes,开启保护模式，限制为本地访问</span><br><span class=\"line\"></span><br><span class=\"line\">daemonize no    # 默认no，改为yes意为以守护进程方式启动，可后台运行，除非kill进程（可选），改为yes会使配置文件方式启动redis失败</span><br><span class=\"line\"></span><br><span class=\"line\">dir ./root/redis/data #输入本地redis数据库存放文件夹（可选）</span><br><span class=\"line\"></span><br><span class=\"line\">appendonly yes #redis持久化（可选）</span><br></pre></td></tr></table></figure>\n\n<p>使用xftp登录服务器，在<code>/root/redis/data </code>创建好文件夹用于存放<code>redis</code>数据，这个文件夹位置可自己设定。然后将配置好的<code>redis.conf</code>文件复制入<code>/root/redis/</code>文件夹下。</p>\n<h2 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -p <span class=\"number\">6379</span>:<span class=\"number\">6379</span> --name redis -v /root/redis/redis.conf:/etc/redis/redis.conf  -v /root/redis/data:/data -d redis:latest redis-server /etc/redis/redis.conf --appendonly yes</span><br></pre></td></tr></table></figure>\n\n<p>启动命令解释如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-p 6379:6379:把容器内的6379端口映射到宿主机6379端口</span><br><span class=\"line\">-v /root/redis/redis.conf:/etc/redis/redis.conf：把宿主机配置好的redis.conf放到容器内的这个位置中</span><br><span class=\"line\">-v /root/redis/data:/data：把redis持久化的数据在宿主机内显示，做数据备份</span><br><span class=\"line\">redis-server /etc/redis/redis.conf：这个是关键配置，让redis不是无配置启动，而是按照这个redis.conf的配置启动</span><br><span class=\"line\">–appendonly yes：redis启动后数据持久化</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"获取redis镜像\"><a href=\"#获取redis镜像\" class=\"headerlink\" title=\"获取redis镜像\"></a>获取redis镜像</h2><p>安装环境，腾讯云。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull redis</span><br></pre></td></tr></table></figure>\n\n<p>不加版本号默认获取最新版本，也可以使用 <code>docker search redis</code> 查看镜像来源。</p>\n<h2 id=\"查看本地镜像\"><a href=\"#查看本地镜像\" class=\"headerlink\" title=\"查看本地镜像\"></a>查看本地镜像</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@VM-0-15-centos ~]# docker images</span><br><span class=\"line\">REPOSITORY                TAG       IMAGE ID       CREATED        SIZE</span><br><span class=\"line\">redis                     latest    fad0ee7e917a   2 days ago     105MB</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>官网获取<a href=\"http://download.redis.io/redis-stable/redis.conf\">redis</a>配置文件:</p>\n<ul>\n<li>修改默认的配置文件</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> <span class=\"built_in\">bind</span> 127.0.0.1 -::1   <span class=\"comment\">#注释这部分，去掉限制只能本地访问</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">protected-mode no   # 默认yes,开启保护模式，限制为本地访问</span><br><span class=\"line\"></span><br><span class=\"line\">daemonize no    # 默认no，改为yes意为以守护进程方式启动，可后台运行，除非kill进程（可选），改为yes会使配置文件方式启动redis失败</span><br><span class=\"line\"></span><br><span class=\"line\">dir ./root/redis/data #输入本地redis数据库存放文件夹（可选）</span><br><span class=\"line\"></span><br><span class=\"line\">appendonly yes #redis持久化（可选）</span><br></pre></td></tr></table></figure>\n\n<p>使用xftp登录服务器，在<code>/root/redis/data </code>创建好文件夹用于存放<code>redis</code>数据，这个文件夹位置可自己设定。然后将配置好的<code>redis.conf</code>文件复制入<code>/root/redis/</code>文件夹下。</p>\n<h2 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -p <span class=\"number\">6379</span>:<span class=\"number\">6379</span> --name redis -v /root/redis/redis.conf:/etc/redis/redis.conf  -v /root/redis/data:/data -d redis:latest redis-server /etc/redis/redis.conf --appendonly yes</span><br></pre></td></tr></table></figure>\n\n<p>启动命令解释如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-p 6379:6379:把容器内的6379端口映射到宿主机6379端口</span><br><span class=\"line\">-v /root/redis/redis.conf:/etc/redis/redis.conf：把宿主机配置好的redis.conf放到容器内的这个位置中</span><br><span class=\"line\">-v /root/redis/data:/data：把redis持久化的数据在宿主机内显示，做数据备份</span><br><span class=\"line\">redis-server /etc/redis/redis.conf：这个是关键配置，让redis不是无配置启动，而是按照这个redis.conf的配置启动</span><br><span class=\"line\">–appendonly yes：redis启动后数据持久化</span><br></pre></td></tr></table></figure>\n"},{"title":"基于docker部署code-server","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-25T09:21:25.000Z","pic":null,"_content":"\n## 拉取镜像\n\n```shell\n# docker pull codercom/code-server\n# docker images\nREPOSITORY             TAG       IMAGE ID       CREATED       SIZE\ncodercom/code-server   latest    f3ac734fcec8   12 days ago   802MB\n```\n\n## 创建挂载目录\n\n```shell\n# CODE=/home/docker/code\n# mkdir $CODE && cd $CODE\n```\n\n## 配置文件\n\n启动一个容器：`-u`表示使用`root`用户运行\n\n```shell\n# docker run -d -u root -p 8088:8080 --name code-server -v $CODE:/home/code codercom/code-server\n# docker ps\nCONTAINER ID   IMAGE       COMMAND          CREATED    \\ STATUS         PORTS             NAMES\nf10030d88e1d  codercom/code-server \"/usr/bin/entrypoint鈥 3 minutes ago Up 3 minutes   0.0.0.0:8088->8080/tcp, :::8088->8080/tcp code-server\n```\n\n拉出配置文件\n\n```shell\n# docker cp code-server:/root/.config/code-server/config.yaml $CODE/\n# cat $CODE/config.yaml\nbind-addr: 127.0.0.1:8080\nauth: password\npassword: 59bd4df2841fbc77d67f674f\ncert: false\n```\n\n修改你的密码：\n\n```shell\ndocker run -d -u root \\\n  -p 8088:8080 \\\n  --name code-server \\\n  -v $CODE/config.yaml:/root/.config/code-server/config.yaml \\\n  -v $CODE:/home/code \\\n  codercom/code-server\n```\n\n## 启动服务\n\n```shell\n# docker stop code-server && docker rm code-server\n# docker run -d -u root \\\n  -p 8088:8080 \\\n  --name code-server \\\n  -v $CODE/config.yaml:/root/.config/code-server/config.yaml \\\n  -v $CODE:/home/code \\\n  codercom/code-server\n```\n\n## 登录\n\n访问`http://holychan.ltd:8088/`，输入密码登录。\n\n![](![](Screenshot_1.webp))","source":"_posts/基于docker部署code-server.md","raw":"---\ntitle: 基于docker部署code-server\ntags:\n  - docker\n  - vscode\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-25 17:21:25\ncategories: Docker\npic:\n---\n\n## 拉取镜像\n\n```shell\n# docker pull codercom/code-server\n# docker images\nREPOSITORY             TAG       IMAGE ID       CREATED       SIZE\ncodercom/code-server   latest    f3ac734fcec8   12 days ago   802MB\n```\n\n## 创建挂载目录\n\n```shell\n# CODE=/home/docker/code\n# mkdir $CODE && cd $CODE\n```\n\n## 配置文件\n\n启动一个容器：`-u`表示使用`root`用户运行\n\n```shell\n# docker run -d -u root -p 8088:8080 --name code-server -v $CODE:/home/code codercom/code-server\n# docker ps\nCONTAINER ID   IMAGE       COMMAND          CREATED    \\ STATUS         PORTS             NAMES\nf10030d88e1d  codercom/code-server \"/usr/bin/entrypoint鈥 3 minutes ago Up 3 minutes   0.0.0.0:8088->8080/tcp, :::8088->8080/tcp code-server\n```\n\n拉出配置文件\n\n```shell\n# docker cp code-server:/root/.config/code-server/config.yaml $CODE/\n# cat $CODE/config.yaml\nbind-addr: 127.0.0.1:8080\nauth: password\npassword: 59bd4df2841fbc77d67f674f\ncert: false\n```\n\n修改你的密码：\n\n```shell\ndocker run -d -u root \\\n  -p 8088:8080 \\\n  --name code-server \\\n  -v $CODE/config.yaml:/root/.config/code-server/config.yaml \\\n  -v $CODE:/home/code \\\n  codercom/code-server\n```\n\n## 启动服务\n\n```shell\n# docker stop code-server && docker rm code-server\n# docker run -d -u root \\\n  -p 8088:8080 \\\n  --name code-server \\\n  -v $CODE/config.yaml:/root/.config/code-server/config.yaml \\\n  -v $CODE:/home/code \\\n  codercom/code-server\n```\n\n## 登录\n\n访问`http://holychan.ltd:8088/`，输入密码登录。\n\n![](![](Screenshot_1.webp))","slug":"基于docker部署code-server","published":1,"updated":"2021-06-15T03:24:11.545Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2w003g44ud16kte82a","content":"<h2 id=\"拉取镜像\"><a href=\"#拉取镜像\" class=\"headerlink\" title=\"拉取镜像\"></a>拉取镜像</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> docker pull codercom/code-server</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> docker images</span></span><br><span class=\"line\">REPOSITORY             TAG       IMAGE ID       CREATED       SIZE</span><br><span class=\"line\">codercom/code-server   latest    f3ac734fcec8   12 days ago   802MB</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建挂载目录\"><a href=\"#创建挂载目录\" class=\"headerlink\" title=\"创建挂载目录\"></a>创建挂载目录</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> CODE=/home/docker/code</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> mkdir <span class=\"variable\">$CODE</span> &amp;&amp; <span class=\"built_in\">cd</span> <span class=\"variable\">$CODE</span></span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h2><p>启动一个容器：<code>-u</code>表示使用<code>root</code>用户运行</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> docker run -d -u root -p 8088:8080 --name code-server -v <span class=\"variable\">$CODE</span>:/home/code codercom/code-server</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> docker ps</span></span><br><span class=\"line\">CONTAINER ID   IMAGE       COMMAND          CREATED    \\ STATUS         PORTS             NAMES</span><br><span class=\"line\">f10030d88e1d  codercom/code-server &quot;/usr/bin/entrypoint鈥 3 minutes ago Up 3 minutes   0.0.0.0:8088-&gt;8080/tcp, :::8088-&gt;8080/tcp code-server</span><br></pre></td></tr></table></figure>\n\n<p>拉出配置文件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> docker cp code-server:/root/.config/code-server/config.yaml <span class=\"variable\">$CODE</span>/</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> cat <span class=\"variable\">$CODE</span>/config.yaml</span></span><br><span class=\"line\">bind-addr: 127.0.0.1:8080</span><br><span class=\"line\">auth: password</span><br><span class=\"line\">password: 59bd4df2841fbc77d67f674f</span><br><span class=\"line\">cert: false</span><br></pre></td></tr></table></figure>\n\n<p>修改你的密码：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d -u root \\</span><br><span class=\"line\">  -p 8088:8080 \\</span><br><span class=\"line\">  --name code-server \\</span><br><span class=\"line\">  -v $CODE/config.yaml:/root/.config/code-server/config.yaml \\</span><br><span class=\"line\">  -v $CODE:/home/code \\</span><br><span class=\"line\">  codercom/code-server</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动服务\"><a href=\"#启动服务\" class=\"headerlink\" title=\"启动服务\"></a>启动服务</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> docker stop code-server &amp;&amp; docker rm code-server</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> docker run -d -u root \\</span></span><br><span class=\"line\"><span class=\"bash\">  -p 8088:8080 \\</span></span><br><span class=\"line\"><span class=\"bash\">  --name code-server \\</span></span><br><span class=\"line\"><span class=\"bash\">  -v <span class=\"variable\">$CODE</span>/config.yaml:/root/.config/code-server/config.yaml \\</span></span><br><span class=\"line\"><span class=\"bash\">  -v <span class=\"variable\">$CODE</span>:/home/code \\</span></span><br><span class=\"line\"><span class=\"bash\">  codercom/code-server</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"登录\"><a href=\"#登录\" class=\"headerlink\" title=\"登录\"></a>登录</h2><p>访问<code>http://holychan.ltd:8088/</code>，输入密码登录。</p>\n<p><img src=\"!%5B%5D(Screenshot_1.webp)\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"拉取镜像\"><a href=\"#拉取镜像\" class=\"headerlink\" title=\"拉取镜像\"></a>拉取镜像</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> docker pull codercom/code-server</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> docker images</span></span><br><span class=\"line\">REPOSITORY             TAG       IMAGE ID       CREATED       SIZE</span><br><span class=\"line\">codercom/code-server   latest    f3ac734fcec8   12 days ago   802MB</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建挂载目录\"><a href=\"#创建挂载目录\" class=\"headerlink\" title=\"创建挂载目录\"></a>创建挂载目录</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> CODE=/home/docker/code</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> mkdir <span class=\"variable\">$CODE</span> &amp;&amp; <span class=\"built_in\">cd</span> <span class=\"variable\">$CODE</span></span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h2><p>启动一个容器：<code>-u</code>表示使用<code>root</code>用户运行</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> docker run -d -u root -p 8088:8080 --name code-server -v <span class=\"variable\">$CODE</span>:/home/code codercom/code-server</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> docker ps</span></span><br><span class=\"line\">CONTAINER ID   IMAGE       COMMAND          CREATED    \\ STATUS         PORTS             NAMES</span><br><span class=\"line\">f10030d88e1d  codercom/code-server &quot;/usr/bin/entrypoint鈥 3 minutes ago Up 3 minutes   0.0.0.0:8088-&gt;8080/tcp, :::8088-&gt;8080/tcp code-server</span><br></pre></td></tr></table></figure>\n\n<p>拉出配置文件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> docker cp code-server:/root/.config/code-server/config.yaml <span class=\"variable\">$CODE</span>/</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> cat <span class=\"variable\">$CODE</span>/config.yaml</span></span><br><span class=\"line\">bind-addr: 127.0.0.1:8080</span><br><span class=\"line\">auth: password</span><br><span class=\"line\">password: 59bd4df2841fbc77d67f674f</span><br><span class=\"line\">cert: false</span><br></pre></td></tr></table></figure>\n\n<p>修改你的密码：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d -u root \\</span><br><span class=\"line\">  -p 8088:8080 \\</span><br><span class=\"line\">  --name code-server \\</span><br><span class=\"line\">  -v $CODE/config.yaml:/root/.config/code-server/config.yaml \\</span><br><span class=\"line\">  -v $CODE:/home/code \\</span><br><span class=\"line\">  codercom/code-server</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动服务\"><a href=\"#启动服务\" class=\"headerlink\" title=\"启动服务\"></a>启动服务</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> docker stop code-server &amp;&amp; docker rm code-server</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> docker run -d -u root \\</span></span><br><span class=\"line\"><span class=\"bash\">  -p 8088:8080 \\</span></span><br><span class=\"line\"><span class=\"bash\">  --name code-server \\</span></span><br><span class=\"line\"><span class=\"bash\">  -v <span class=\"variable\">$CODE</span>/config.yaml:/root/.config/code-server/config.yaml \\</span></span><br><span class=\"line\"><span class=\"bash\">  -v <span class=\"variable\">$CODE</span>:/home/code \\</span></span><br><span class=\"line\"><span class=\"bash\">  codercom/code-server</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"登录\"><a href=\"#登录\" class=\"headerlink\" title=\"登录\"></a>登录</h2><p>访问<code>http://holychan.ltd:8088/</code>，输入密码登录。</p>\n<p><img src=\"!%5B%5D(Screenshot_1.webp)\"></p>\n"},{"title":"抓取网易云音乐热评","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-10T13:00:14.000Z","pic":null,"_content":"\n查看页面源代码，发现源代码中并不含有热评。通过工具抓包查看请求，数据是通过后端数据库请求过来的。\n\n![](Screenshot_1.webp)\n\n查看标头可以发现，这条获取热评的请求传递的参数是加密的。\n\n![](Screenshot_2.webp)\n\n首先，我们要找到未加密的参数。\n\n通过查看请求程序，可以看到当前网页调用了那些JS脚本执行过程，从下往上调用。\n\n![](Screenshot_3.webp)\n\n查看最上面的JS脚本，这是产生请求的最后一个脚本，看看这个脚本里面有什么。\n\n![](Screenshot_4.webp)\n\n点开后，咋一看没法理解，这是经过压缩后的JS脚本，没关系，点击左下方的`{}`优质打印，就是格式化该脚本。\n\n![](Screenshot_5.webp)\n\n通过查看JS脚本，发现最后的请求就是通过`send`函数发送出去的，在这里设置断点。\n\n![](Screenshot_6.webp)\n\n重新刷新页面，可以看到所有的变量，找到`request`中的`url`为`/weapi/cdns?csrf_token=`，不是我们想要的地址，继续刷新，\n\n![](Screenshot_7.webp)\n\n直到出现`https://music.163.com/weapi/comment/resource/comments/get?csrf_token=`，这就是我们想要的`url`。\n\n![](Screenshot_8.webp)\n\n从上图中可以看到，`params`参数是经过加密的，接着往上分析。\n\n![](Screenshot_9.webp)\n\n查看这里，`d7e`参数，查看这里的`params`依旧是加密的。接着往回找，是谁调用的`b7g.bsO0x`函数。\n\n![](Screenshot_10.webp)\n\n这里可以看到`params`参数依旧是加密的。\n\n![](Screenshot_11.webp)\n\n找到这里就可以看到`params`参数没有加密，说明加密过程就在` t7m.be7X`函数中完成。\n\n![](Screenshot_12.webp)\n\n在这一步中`i7b`就是未加密的信息，通过这段JS代码后，变成了加密的`e7d`。\n\n```javascript\ni7b:\n  csrf_token: \"\"\n  cursor: \"-1\"\n  offset: \"0\"\n  orderType: \"1\"\n  pageNo: \"1\"\n  pageSize: \"20\"\n  rid: \"R_SO_4_1465401422\"\n  threadId: \"R_SO_4_1465401422\"\n```\n\n那么，接下来就需要对这段JS代码进行分析，找到加密的逻辑，然后我们自己来写一个相同的逻辑模拟这个请求。\n\n```javascript\n    var cJt0x = t7m.be7X; \n    t7m.be7X = function(X7Q, e7d) {\n        var i7b = {}\n          , e7d = NEJ.X({}, e7d)\n          , mi1x = X7Q.indexOf(\"?\");\n        if (window.GEnc && /(^|\\.com)\\/api/.test(X7Q) && !(e7d.headers && e7d.headers[ew8o.BH9y] == ew8o.Jf1x) && !e7d.noEnc) {\n            if (mi1x != -1) {\n                i7b = j7c.gQ9H(X7Q.substring(mi1x + 1));\n                X7Q = X7Q.substring(0, mi1x)\n            }\n            if (e7d.query) {\n                i7b = NEJ.X(i7b, j7c.fO9F(e7d.query) ? j7c.gQ9H(e7d.query) : e7d.query)\n            }\n            if (e7d.data) {\n                i7b = NEJ.X(i7b, j7c.fO9F(e7d.data) ? j7c.gQ9H(e7d.data) : e7d.data)\n            }\n            i7b[\"csrf_token\"] = t7m.gP9G(\"__csrf\");\n            X7Q = X7Q.replace(\"api\", \"weapi\");\n            e7d.method = \"post\";\n            delete e7d.query;\n            var bZo6i = window.asrsea(JSON.stringify(i7b), bmn9e([\"流泪\", \"强\"]), bmn9e(WI6C.md), bmn9e([\"爱心\", \"女孩\", \"惊恐\", \"大笑\"])); # bZo6i这个变量就是加密后的params和encSecKey。是经过window.asrsea函数后加密的\n            e7d.data = j7c.cr7k({\n                params: bZo6i.encText,  # 这就是请求的params参数\n                encSecKey: bZo6i.encSecKey  # 这就是请求的encSecKey参数\n            })\n        }\n        var cdnHost = \"y.music.163.com\";\n        var apiHost = \"interface.music.163.com\";\n        if (location.host === cdnHost) {\n            X7Q = X7Q.replace(cdnHost, apiHost);\n            if (X7Q.match(/^\\/(we)?api/)) {\n                X7Q = \"//\" + apiHost + X7Q\n            }\n            e7d.cookie = true\n        }\n        cJt0x(X7Q, e7d)\n```\n\n加密的函数就是`window.asrsea`，这个函数一共传入了四个参数，把他们找出来一个个分析。\n\n```javascript\nwindow.asrsea(JSON.stringify(i7b), bmn9e([\"流泪\", \"强\"]), bmn9e(WI6C.md), bmn9e([\"爱心\", \"女孩\", \"惊恐\", \"大笑\"])\n```\n\n通过上下文搜索，找到`window.asrsea = d`，来看这个`d`函数做i了那些加密工作。\n\n```javascript\n    function a(a) { # a= 16\n        var d, e, b = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\", c = \"\";\n        for (d = 0; a > d; d += 1) # 循环16次\n            e = Math.random() * b.length, # 产生的随机数\n            e = Math.floor(e), # 取整\n            c += b.charAt(e); # 取字符串中的xxx位\n        return c #　返回16位随机的字符串\n    }\n    function b(a, b) { # a是要加密的内容\n        var c = CryptoJS.enc.Utf8.parse(b) # b就是密钥\n          , d = CryptoJS.enc.Utf8.parse(\"0102030405060708\")\n          , e = CryptoJS.enc.Utf8.parse(a) # e是a传入的数据\n          , f = CryptoJS.AES.encrypt(e, c, { # c是加密的密钥\n            iv: d, # 偏移量\n            mode: CryptoJS.mode.CBC # CBC加密模式\n        });\n        return f.toString()\n    }\n    function c(a, b, c) { # c里面没有随机函数\n        var d, e;\n        return setMaxDigits(131),\n        d = new RSAKeyPair(b,\"\",c),\n        e = encryptedString(d, a)\n    }\n    function d(d, e, f, g) {  \n        var h = {}  # 定义h空对象\n          , i = a(16); # i就是16位的随机值 把i设置成定值 \n        return h.encText = b(d, g), #  g是密钥\n        h.encText = b(h.encText, i), # 返回的就是params, i是密钥\n        h.encSecKey = c(i, e, f), # 得到的就是encSecKey, e和f是固定的值, i固定后，encSecKey一定是固定的\n        h\n\n        # 两次加密\n        # 数据+g => 第一次加密结果 + i => params\n    }\n    function e(a, b, d, e) {\n        var f = {};\n        return f.encText = c(a + e, b, d),\n        f\n    }\n    window.asrsea = d,\n    window.ecnonasr = e\n```\n\n- 第一个参数`JSON.stringify(i7b)`：这里的`i7b`就是未经加密的数据。\n- 第二个的参数`bmn9e([\"流泪\", \"强\"])`：执行了`bmn9e`函数，把这个复制到console中执行，可以发现是个固定值始终为`\"010001\"`。\n- 第三个参数`bmn9e(WI6C.md)`：在控制台执行，可以发现也是固定值`\"00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7\"`\n- 第三个参数`bmn9e([\"爱心\", \"女孩\", \"惊恐\", \"大笑\"]`：可以发现也是固定值`\"0CoJUm6Qyw8W8jud\"`。\n\n那么这里`function d(d, e, f, g)`中的`d`、`e`、`f`、`g`就分别找到了。\n\n```python\n# 没有经过加密的真实参数\ndata = {\n  \"csrf_token\": \"\",\n  \"cursor\": \"-1\",\n  \"offset\": \"0\",\n  \"orderType\": \"1\",\n  \"pageNo\": \"1\",\n  \"pageSize\": \"20\",\n  \"rid\": \"R_SO_4_1465401422\",\n  \"threadId\": \"R_SO_4_1465401422\"\n}\n\n# 处理加密过程\nd = data\ne = \"010001\"\nf = \"00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7\"\ng = \"0CoJUm6Qyw8W8jud\"\n\n```\n\n然后，把参数按照网易的规则进行加密处理，得到两个参数`params`和`encSecKry`。\n\n```python\n\n```\n\n最后，请求到网易，拿到评论信息。\n\n```python\nimport requests\nimport json\nfrom Crypto.Cipher import AES\nfrom base64 import b64encode\n# 请求的url\n\nurl = 'https://music.163.com/weapi/comment/resource/comments/get?csrf_token='\n\n# 请求方式post\n\n# 没有经过加密的真实参数\ndata = {\n    \"csrf_token\": \"\",\n    \"cursor\": \"-1\",\n    \"offset\": \"0\",\n    \"orderType\": \"1\",\n    \"pageNo\": \"1\",\n    \"pageSize\": \"20\",\n    \"rid\": \"R_SO_4_1465401422\",\n    \"threadId\": \"R_SO_4_1465401422\",\n}\n\n# 处理加密过程\n\nd = data\ne = \"010001\"\nf = \"00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7\"\ng = \"0CoJUm6Qyw8W8jud\"\ni = \"8vUt6QwGJDa5do4h\"\n\n\ndef get_encSecKey():\n    return \"b5fd7a3aa4b1bbab923026c03b1ebfb46ec108dbf90d7b968ff3953d58b0b7ac87a331043a9676a359051a5002a3a65c0bdf0c2b5f1519ddf153c26daeb5fdf0f43d25ca56d75c874fa98eebfec7d858f327f342f06aa03bb1f3250d4d8f7c3ab0ff2f7dd168ff9ea1327df172943a819d6fd0986699118de2ba25c535d22e4d\"\n\n\ndef get_params(data):\n    first = enc_params(data, g)\n    second = enc_params(first, i)\n    return second\n\n\ndef to_16(data):\n    pad = 16 - len(data) % 16\n    data += chr(pad) * pad\n    return data\n\n\ndef enc_params(data, key):\n    '''加密过程'''\n    data = to_16(data)\n    iv = \"0102030405060708\"\n    aes = AES.new(key=key.encode(\"utf-8\"), IV=iv.encode(\"utf-8\"),\n                  mode=AES.MODE_CBC)  # 新建一个加密对象\n    bs = aes.encrypt(data.encode('utf-8'))  # 加密内容的长度必须是16的倍数\n    return str(b64encode(bs), 'utf-8')\n\n\nif __name__ == '__main__':\n    resp = requests.post(url=url, data={\n        \"params\": get_params(json.dumps(data)),\n        \"encSecKey\": get_encSecKey()\n    })\n    print(resp.text)\n```\n\n兄弟们，我拿到了，有些细节还不清楚，以后再深究。\n\n\n\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","source":"_posts/抓取网易云音乐热评.md","raw":"---\ntitle: 抓取网易云音乐热评\ntags:\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-10 21:00:14\ncategories: 爬虫\npic:\n---\n\n查看页面源代码，发现源代码中并不含有热评。通过工具抓包查看请求，数据是通过后端数据库请求过来的。\n\n![](Screenshot_1.webp)\n\n查看标头可以发现，这条获取热评的请求传递的参数是加密的。\n\n![](Screenshot_2.webp)\n\n首先，我们要找到未加密的参数。\n\n通过查看请求程序，可以看到当前网页调用了那些JS脚本执行过程，从下往上调用。\n\n![](Screenshot_3.webp)\n\n查看最上面的JS脚本，这是产生请求的最后一个脚本，看看这个脚本里面有什么。\n\n![](Screenshot_4.webp)\n\n点开后，咋一看没法理解，这是经过压缩后的JS脚本，没关系，点击左下方的`{}`优质打印，就是格式化该脚本。\n\n![](Screenshot_5.webp)\n\n通过查看JS脚本，发现最后的请求就是通过`send`函数发送出去的，在这里设置断点。\n\n![](Screenshot_6.webp)\n\n重新刷新页面，可以看到所有的变量，找到`request`中的`url`为`/weapi/cdns?csrf_token=`，不是我们想要的地址，继续刷新，\n\n![](Screenshot_7.webp)\n\n直到出现`https://music.163.com/weapi/comment/resource/comments/get?csrf_token=`，这就是我们想要的`url`。\n\n![](Screenshot_8.webp)\n\n从上图中可以看到，`params`参数是经过加密的，接着往上分析。\n\n![](Screenshot_9.webp)\n\n查看这里，`d7e`参数，查看这里的`params`依旧是加密的。接着往回找，是谁调用的`b7g.bsO0x`函数。\n\n![](Screenshot_10.webp)\n\n这里可以看到`params`参数依旧是加密的。\n\n![](Screenshot_11.webp)\n\n找到这里就可以看到`params`参数没有加密，说明加密过程就在` t7m.be7X`函数中完成。\n\n![](Screenshot_12.webp)\n\n在这一步中`i7b`就是未加密的信息，通过这段JS代码后，变成了加密的`e7d`。\n\n```javascript\ni7b:\n  csrf_token: \"\"\n  cursor: \"-1\"\n  offset: \"0\"\n  orderType: \"1\"\n  pageNo: \"1\"\n  pageSize: \"20\"\n  rid: \"R_SO_4_1465401422\"\n  threadId: \"R_SO_4_1465401422\"\n```\n\n那么，接下来就需要对这段JS代码进行分析，找到加密的逻辑，然后我们自己来写一个相同的逻辑模拟这个请求。\n\n```javascript\n    var cJt0x = t7m.be7X; \n    t7m.be7X = function(X7Q, e7d) {\n        var i7b = {}\n          , e7d = NEJ.X({}, e7d)\n          , mi1x = X7Q.indexOf(\"?\");\n        if (window.GEnc && /(^|\\.com)\\/api/.test(X7Q) && !(e7d.headers && e7d.headers[ew8o.BH9y] == ew8o.Jf1x) && !e7d.noEnc) {\n            if (mi1x != -1) {\n                i7b = j7c.gQ9H(X7Q.substring(mi1x + 1));\n                X7Q = X7Q.substring(0, mi1x)\n            }\n            if (e7d.query) {\n                i7b = NEJ.X(i7b, j7c.fO9F(e7d.query) ? j7c.gQ9H(e7d.query) : e7d.query)\n            }\n            if (e7d.data) {\n                i7b = NEJ.X(i7b, j7c.fO9F(e7d.data) ? j7c.gQ9H(e7d.data) : e7d.data)\n            }\n            i7b[\"csrf_token\"] = t7m.gP9G(\"__csrf\");\n            X7Q = X7Q.replace(\"api\", \"weapi\");\n            e7d.method = \"post\";\n            delete e7d.query;\n            var bZo6i = window.asrsea(JSON.stringify(i7b), bmn9e([\"流泪\", \"强\"]), bmn9e(WI6C.md), bmn9e([\"爱心\", \"女孩\", \"惊恐\", \"大笑\"])); # bZo6i这个变量就是加密后的params和encSecKey。是经过window.asrsea函数后加密的\n            e7d.data = j7c.cr7k({\n                params: bZo6i.encText,  # 这就是请求的params参数\n                encSecKey: bZo6i.encSecKey  # 这就是请求的encSecKey参数\n            })\n        }\n        var cdnHost = \"y.music.163.com\";\n        var apiHost = \"interface.music.163.com\";\n        if (location.host === cdnHost) {\n            X7Q = X7Q.replace(cdnHost, apiHost);\n            if (X7Q.match(/^\\/(we)?api/)) {\n                X7Q = \"//\" + apiHost + X7Q\n            }\n            e7d.cookie = true\n        }\n        cJt0x(X7Q, e7d)\n```\n\n加密的函数就是`window.asrsea`，这个函数一共传入了四个参数，把他们找出来一个个分析。\n\n```javascript\nwindow.asrsea(JSON.stringify(i7b), bmn9e([\"流泪\", \"强\"]), bmn9e(WI6C.md), bmn9e([\"爱心\", \"女孩\", \"惊恐\", \"大笑\"])\n```\n\n通过上下文搜索，找到`window.asrsea = d`，来看这个`d`函数做i了那些加密工作。\n\n```javascript\n    function a(a) { # a= 16\n        var d, e, b = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\", c = \"\";\n        for (d = 0; a > d; d += 1) # 循环16次\n            e = Math.random() * b.length, # 产生的随机数\n            e = Math.floor(e), # 取整\n            c += b.charAt(e); # 取字符串中的xxx位\n        return c #　返回16位随机的字符串\n    }\n    function b(a, b) { # a是要加密的内容\n        var c = CryptoJS.enc.Utf8.parse(b) # b就是密钥\n          , d = CryptoJS.enc.Utf8.parse(\"0102030405060708\")\n          , e = CryptoJS.enc.Utf8.parse(a) # e是a传入的数据\n          , f = CryptoJS.AES.encrypt(e, c, { # c是加密的密钥\n            iv: d, # 偏移量\n            mode: CryptoJS.mode.CBC # CBC加密模式\n        });\n        return f.toString()\n    }\n    function c(a, b, c) { # c里面没有随机函数\n        var d, e;\n        return setMaxDigits(131),\n        d = new RSAKeyPair(b,\"\",c),\n        e = encryptedString(d, a)\n    }\n    function d(d, e, f, g) {  \n        var h = {}  # 定义h空对象\n          , i = a(16); # i就是16位的随机值 把i设置成定值 \n        return h.encText = b(d, g), #  g是密钥\n        h.encText = b(h.encText, i), # 返回的就是params, i是密钥\n        h.encSecKey = c(i, e, f), # 得到的就是encSecKey, e和f是固定的值, i固定后，encSecKey一定是固定的\n        h\n\n        # 两次加密\n        # 数据+g => 第一次加密结果 + i => params\n    }\n    function e(a, b, d, e) {\n        var f = {};\n        return f.encText = c(a + e, b, d),\n        f\n    }\n    window.asrsea = d,\n    window.ecnonasr = e\n```\n\n- 第一个参数`JSON.stringify(i7b)`：这里的`i7b`就是未经加密的数据。\n- 第二个的参数`bmn9e([\"流泪\", \"强\"])`：执行了`bmn9e`函数，把这个复制到console中执行，可以发现是个固定值始终为`\"010001\"`。\n- 第三个参数`bmn9e(WI6C.md)`：在控制台执行，可以发现也是固定值`\"00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7\"`\n- 第三个参数`bmn9e([\"爱心\", \"女孩\", \"惊恐\", \"大笑\"]`：可以发现也是固定值`\"0CoJUm6Qyw8W8jud\"`。\n\n那么这里`function d(d, e, f, g)`中的`d`、`e`、`f`、`g`就分别找到了。\n\n```python\n# 没有经过加密的真实参数\ndata = {\n  \"csrf_token\": \"\",\n  \"cursor\": \"-1\",\n  \"offset\": \"0\",\n  \"orderType\": \"1\",\n  \"pageNo\": \"1\",\n  \"pageSize\": \"20\",\n  \"rid\": \"R_SO_4_1465401422\",\n  \"threadId\": \"R_SO_4_1465401422\"\n}\n\n# 处理加密过程\nd = data\ne = \"010001\"\nf = \"00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7\"\ng = \"0CoJUm6Qyw8W8jud\"\n\n```\n\n然后，把参数按照网易的规则进行加密处理，得到两个参数`params`和`encSecKry`。\n\n```python\n\n```\n\n最后，请求到网易，拿到评论信息。\n\n```python\nimport requests\nimport json\nfrom Crypto.Cipher import AES\nfrom base64 import b64encode\n# 请求的url\n\nurl = 'https://music.163.com/weapi/comment/resource/comments/get?csrf_token='\n\n# 请求方式post\n\n# 没有经过加密的真实参数\ndata = {\n    \"csrf_token\": \"\",\n    \"cursor\": \"-1\",\n    \"offset\": \"0\",\n    \"orderType\": \"1\",\n    \"pageNo\": \"1\",\n    \"pageSize\": \"20\",\n    \"rid\": \"R_SO_4_1465401422\",\n    \"threadId\": \"R_SO_4_1465401422\",\n}\n\n# 处理加密过程\n\nd = data\ne = \"010001\"\nf = \"00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7\"\ng = \"0CoJUm6Qyw8W8jud\"\ni = \"8vUt6QwGJDa5do4h\"\n\n\ndef get_encSecKey():\n    return \"b5fd7a3aa4b1bbab923026c03b1ebfb46ec108dbf90d7b968ff3953d58b0b7ac87a331043a9676a359051a5002a3a65c0bdf0c2b5f1519ddf153c26daeb5fdf0f43d25ca56d75c874fa98eebfec7d858f327f342f06aa03bb1f3250d4d8f7c3ab0ff2f7dd168ff9ea1327df172943a819d6fd0986699118de2ba25c535d22e4d\"\n\n\ndef get_params(data):\n    first = enc_params(data, g)\n    second = enc_params(first, i)\n    return second\n\n\ndef to_16(data):\n    pad = 16 - len(data) % 16\n    data += chr(pad) * pad\n    return data\n\n\ndef enc_params(data, key):\n    '''加密过程'''\n    data = to_16(data)\n    iv = \"0102030405060708\"\n    aes = AES.new(key=key.encode(\"utf-8\"), IV=iv.encode(\"utf-8\"),\n                  mode=AES.MODE_CBC)  # 新建一个加密对象\n    bs = aes.encrypt(data.encode('utf-8'))  # 加密内容的长度必须是16的倍数\n    return str(b64encode(bs), 'utf-8')\n\n\nif __name__ == '__main__':\n    resp = requests.post(url=url, data={\n        \"params\": get_params(json.dumps(data)),\n        \"encSecKey\": get_encSecKey()\n    })\n    print(resp.text)\n```\n\n兄弟们，我拿到了，有些细节还不清楚，以后再深究。\n\n\n\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","slug":"抓取网易云音乐热评","published":1,"updated":"2021-06-15T15:47:31.617Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2w003j44udd8w6c77k","content":"<p>查看页面源代码，发现源代码中并不含有热评。通过工具抓包查看请求，数据是通过后端数据库请求过来的。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>查看标头可以发现，这条获取热评的请求传递的参数是加密的。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>首先，我们要找到未加密的参数。</p>\n<p>通过查看请求程序，可以看到当前网页调用了那些JS脚本执行过程，从下往上调用。</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<p>查看最上面的JS脚本，这是产生请求的最后一个脚本，看看这个脚本里面有什么。</p>\n<p><img src=\"Screenshot_4.webp\"></p>\n<p>点开后，咋一看没法理解，这是经过压缩后的JS脚本，没关系，点击左下方的<code>&#123;&#125;</code>优质打印，就是格式化该脚本。</p>\n<p><img src=\"Screenshot_5.webp\"></p>\n<p>通过查看JS脚本，发现最后的请求就是通过<code>send</code>函数发送出去的，在这里设置断点。</p>\n<p><img src=\"Screenshot_6.webp\"></p>\n<p>重新刷新页面，可以看到所有的变量，找到<code>request</code>中的<code>url</code>为<code>/weapi/cdns?csrf_token=</code>，不是我们想要的地址，继续刷新，</p>\n<p><img src=\"Screenshot_7.webp\"></p>\n<p>直到出现<code>https://music.163.com/weapi/comment/resource/comments/get?csrf_token=</code>，这就是我们想要的<code>url</code>。</p>\n<p><img src=\"Screenshot_8.webp\"></p>\n<p>从上图中可以看到，<code>params</code>参数是经过加密的，接着往上分析。</p>\n<p><img src=\"Screenshot_9.webp\"></p>\n<p>查看这里，<code>d7e</code>参数，查看这里的<code>params</code>依旧是加密的。接着往回找，是谁调用的<code>b7g.bsO0x</code>函数。</p>\n<p><img src=\"Screenshot_10.webp\"></p>\n<p>这里可以看到<code>params</code>参数依旧是加密的。</p>\n<p><img src=\"Screenshot_11.webp\"></p>\n<p>找到这里就可以看到<code>params</code>参数没有加密，说明加密过程就在<code> t7m.be7X</code>函数中完成。</p>\n<p><img src=\"Screenshot_12.webp\"></p>\n<p>在这一步中<code>i7b</code>就是未加密的信息，通过这段JS代码后，变成了加密的<code>e7d</code>。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i7b:</span><br><span class=\"line\">  csrf_token: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">cursor</span>: <span class=\"string\">&quot;-1&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">offset</span>: <span class=\"string\">&quot;0&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">orderType</span>: <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">pageNo</span>: <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">pageSize</span>: <span class=\"string\">&quot;20&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">rid</span>: <span class=\"string\">&quot;R_SO_4_1465401422&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">threadId</span>: <span class=\"string\">&quot;R_SO_4_1465401422&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>那么，接下来就需要对这段JS代码进行分析，找到加密的逻辑，然后我们自己来写一个相同的逻辑模拟这个请求。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> cJt0x = t7m.be7X; </span><br><span class=\"line\">t7m.be7X = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">X7Q, e7d</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> i7b = &#123;&#125;</span><br><span class=\"line\">      , e7d = NEJ.X(&#123;&#125;, e7d)</span><br><span class=\"line\">      , mi1x = X7Q.indexOf(<span class=\"string\">&quot;?&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.GEnc &amp;&amp; <span class=\"regexp\">/(^|\\.com)\\/api/</span>.test(X7Q) &amp;&amp; !(e7d.headers &amp;&amp; e7d.headers[ew8o.BH9y] == ew8o.Jf1x) &amp;&amp; !e7d.noEnc) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mi1x != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            i7b = j7c.gQ9H(X7Q.substring(mi1x + <span class=\"number\">1</span>));</span><br><span class=\"line\">            X7Q = X7Q.substring(<span class=\"number\">0</span>, mi1x)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (e7d.query) &#123;</span><br><span class=\"line\">            i7b = NEJ.X(i7b, j7c.fO9F(e7d.query) ? j7c.gQ9H(e7d.query) : e7d.query)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (e7d.data) &#123;</span><br><span class=\"line\">            i7b = NEJ.X(i7b, j7c.fO9F(e7d.data) ? j7c.gQ9H(e7d.data) : e7d.data)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        i7b[<span class=\"string\">&quot;csrf_token&quot;</span>] = t7m.gP9G(<span class=\"string\">&quot;__csrf&quot;</span>);</span><br><span class=\"line\">        X7Q = X7Q.replace(<span class=\"string\">&quot;api&quot;</span>, <span class=\"string\">&quot;weapi&quot;</span>);</span><br><span class=\"line\">        e7d.method = <span class=\"string\">&quot;post&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">delete</span> e7d.query;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bZo6i = <span class=\"built_in\">window</span>.asrsea(<span class=\"built_in\">JSON</span>.stringify(i7b), bmn9e([<span class=\"string\">&quot;流泪&quot;</span>, <span class=\"string\">&quot;强&quot;</span>]), bmn9e(WI6C.md), bmn9e([<span class=\"string\">&quot;爱心&quot;</span>, <span class=\"string\">&quot;女孩&quot;</span>, <span class=\"string\">&quot;惊恐&quot;</span>, <span class=\"string\">&quot;大笑&quot;</span>])); # bZo6i这个变量就是加密后的params和encSecKey。是经过<span class=\"built_in\">window</span>.asrsea函数后加密的</span><br><span class=\"line\">        e7d.data = j7c.cr7k(&#123;</span><br><span class=\"line\">            <span class=\"attr\">params</span>: bZo6i.encText,  # 这就是请求的params参数</span><br><span class=\"line\">            <span class=\"attr\">encSecKey</span>: bZo6i.encSecKey  # 这就是请求的encSecKey参数</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> cdnHost = <span class=\"string\">&quot;y.music.163.com&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> apiHost = <span class=\"string\">&quot;interface.music.163.com&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (location.host === cdnHost) &#123;</span><br><span class=\"line\">        X7Q = X7Q.replace(cdnHost, apiHost);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (X7Q.match(<span class=\"regexp\">/^\\/(we)?api/</span>)) &#123;</span><br><span class=\"line\">            X7Q = <span class=\"string\">&quot;//&quot;</span> + apiHost + X7Q</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        e7d.cookie = <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    cJt0x(X7Q, e7d)</span><br></pre></td></tr></table></figure>\n\n<p>加密的函数就是<code>window.asrsea</code>，这个函数一共传入了四个参数，把他们找出来一个个分析。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.asrsea(<span class=\"built_in\">JSON</span>.stringify(i7b), bmn9e([<span class=\"string\">&quot;流泪&quot;</span>, <span class=\"string\">&quot;强&quot;</span>]), bmn9e(WI6C.md), bmn9e([<span class=\"string\">&quot;爱心&quot;</span>, <span class=\"string\">&quot;女孩&quot;</span>, <span class=\"string\">&quot;惊恐&quot;</span>, <span class=\"string\">&quot;大笑&quot;</span>])</span><br></pre></td></tr></table></figure>\n\n<p>通过上下文搜索，找到<code>window.asrsea = d</code>，来看这个<code>d</code>函数做i了那些加密工作。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\">a</span>) </span>&#123; # a= <span class=\"number\">16</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> d, e, b = <span class=\"string\">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>, c = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (d = <span class=\"number\">0</span>; a &gt; d; d += <span class=\"number\">1</span>) # 循环<span class=\"number\">16</span>次</span><br><span class=\"line\">        e = <span class=\"built_in\">Math</span>.random() * b.length, # 产生的随机数</span><br><span class=\"line\">        e = <span class=\"built_in\">Math</span>.floor(e), # 取整</span><br><span class=\"line\">        c += b.charAt(e); # 取字符串中的xxx位</span><br><span class=\"line\">    <span class=\"keyword\">return</span> c #　返回<span class=\"number\">16</span>位随机的字符串</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\">a, b</span>) </span>&#123; # a是要加密的内容</span><br><span class=\"line\">    <span class=\"keyword\">var</span> c = CryptoJS.enc.Utf8.parse(b) # b就是密钥</span><br><span class=\"line\">      , d = CryptoJS.enc.Utf8.parse(<span class=\"string\">&quot;0102030405060708&quot;</span>)</span><br><span class=\"line\">      , e = CryptoJS.enc.Utf8.parse(a) # e是a传入的数据</span><br><span class=\"line\">      , f = CryptoJS.AES.encrypt(e, c, &#123; # c是加密的密钥</span><br><span class=\"line\">        <span class=\"attr\">iv</span>: d, # 偏移量</span><br><span class=\"line\">        <span class=\"attr\">mode</span>: CryptoJS.mode.CBC # CBC加密模式</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> f.toString()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">c</span>(<span class=\"params\">a, b, c</span>) </span>&#123; # c里面没有随机函数</span><br><span class=\"line\">    <span class=\"keyword\">var</span> d, e;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> setMaxDigits(<span class=\"number\">131</span>),</span><br><span class=\"line\">    d = <span class=\"keyword\">new</span> RSAKeyPair(b,<span class=\"string\">&quot;&quot;</span>,c),</span><br><span class=\"line\">    e = encryptedString(d, a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">d</span>(<span class=\"params\">d, e, f, g</span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> h = &#123;&#125;  # 定义h空对象</span><br><span class=\"line\">      , i = a(<span class=\"number\">16</span>); # i就是<span class=\"number\">16</span>位的随机值 把i设置成定值 </span><br><span class=\"line\">    <span class=\"keyword\">return</span> h.encText = b(d, g), #  g是密钥</span><br><span class=\"line\">    h.encText = b(h.encText, i), # 返回的就是params, i是密钥</span><br><span class=\"line\">    h.encSecKey = c(i, e, f), # 得到的就是encSecKey, e和f是固定的值, i固定后，encSecKey一定是固定的</span><br><span class=\"line\">    h</span><br><span class=\"line\"></span><br><span class=\"line\">    # 两次加密</span><br><span class=\"line\">    # 数据+<span class=\"function\"><span class=\"params\">g</span> =&gt;</span> 第一次加密结果 + <span class=\"function\"><span class=\"params\">i</span> =&gt;</span> params</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">e</span>(<span class=\"params\">a, b, d, e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> f = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> f.encText = c(a + e, b, d),</span><br><span class=\"line\">    f</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">window</span>.asrsea = d,</span><br><span class=\"line\"><span class=\"built_in\">window</span>.ecnonasr = e</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>第一个参数<code>JSON.stringify(i7b)</code>：这里的<code>i7b</code>就是未经加密的数据。</li>\n<li>第二个的参数<code>bmn9e([&quot;流泪&quot;, &quot;强&quot;])</code>：执行了<code>bmn9e</code>函数，把这个复制到console中执行，可以发现是个固定值始终为<code>&quot;010001&quot;</code>。</li>\n<li>第三个参数<code>bmn9e(WI6C.md)</code>：在控制台执行，可以发现也是固定值<code>&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&quot;</code></li>\n<li>第三个参数<code>bmn9e([&quot;爱心&quot;, &quot;女孩&quot;, &quot;惊恐&quot;, &quot;大笑&quot;]</code>：可以发现也是固定值<code>&quot;0CoJUm6Qyw8W8jud&quot;</code>。</li>\n</ul>\n<p>那么这里<code>function d(d, e, f, g)</code>中的<code>d</code>、<code>e</code>、<code>f</code>、<code>g</code>就分别找到了。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 没有经过加密的真实参数</span></span><br><span class=\"line\">data = &#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;csrf_token&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;cursor&quot;</span>: <span class=\"string\">&quot;-1&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;offset&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;orderType&quot;</span>: <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;pageNo&quot;</span>: <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;pageSize&quot;</span>: <span class=\"string\">&quot;20&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;rid&quot;</span>: <span class=\"string\">&quot;R_SO_4_1465401422&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;threadId&quot;</span>: <span class=\"string\">&quot;R_SO_4_1465401422&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 处理加密过程</span></span><br><span class=\"line\">d = data</span><br><span class=\"line\">e = <span class=\"string\">&quot;010001&quot;</span></span><br><span class=\"line\">f = <span class=\"string\">&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&quot;</span></span><br><span class=\"line\">g = <span class=\"string\">&quot;0CoJUm6Qyw8W8jud&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>然后，把参数按照网易的规则进行加密处理，得到两个参数<code>params</code>和<code>encSecKry</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>最后，请求到网易，拿到评论信息。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Cipher <span class=\"keyword\">import</span> AES</span><br><span class=\"line\"><span class=\"keyword\">from</span> base64 <span class=\"keyword\">import</span> b64encode</span><br><span class=\"line\"><span class=\"comment\"># 请求的url</span></span><br><span class=\"line\"></span><br><span class=\"line\">url = <span class=\"string\">&#x27;https://music.163.com/weapi/comment/resource/comments/get?csrf_token=&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 请求方式post</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 没有经过加密的真实参数</span></span><br><span class=\"line\">data = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;csrf_token&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;cursor&quot;</span>: <span class=\"string\">&quot;-1&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;offset&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;orderType&quot;</span>: <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;pageNo&quot;</span>: <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;pageSize&quot;</span>: <span class=\"string\">&quot;20&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;rid&quot;</span>: <span class=\"string\">&quot;R_SO_4_1465401422&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;threadId&quot;</span>: <span class=\"string\">&quot;R_SO_4_1465401422&quot;</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 处理加密过程</span></span><br><span class=\"line\"></span><br><span class=\"line\">d = data</span><br><span class=\"line\">e = <span class=\"string\">&quot;010001&quot;</span></span><br><span class=\"line\">f = <span class=\"string\">&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&quot;</span></span><br><span class=\"line\">g = <span class=\"string\">&quot;0CoJUm6Qyw8W8jud&quot;</span></span><br><span class=\"line\">i = <span class=\"string\">&quot;8vUt6QwGJDa5do4h&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_encSecKey</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;b5fd7a3aa4b1bbab923026c03b1ebfb46ec108dbf90d7b968ff3953d58b0b7ac87a331043a9676a359051a5002a3a65c0bdf0c2b5f1519ddf153c26daeb5fdf0f43d25ca56d75c874fa98eebfec7d858f327f342f06aa03bb1f3250d4d8f7c3ab0ff2f7dd168ff9ea1327df172943a819d6fd0986699118de2ba25c535d22e4d&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_params</span>(<span class=\"params\">data</span>):</span></span><br><span class=\"line\">    first = enc_params(data, g)</span><br><span class=\"line\">    second = enc_params(first, i)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> second</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">to_16</span>(<span class=\"params\">data</span>):</span></span><br><span class=\"line\">    pad = <span class=\"number\">16</span> - <span class=\"built_in\">len</span>(data) % <span class=\"number\">16</span></span><br><span class=\"line\">    data += <span class=\"built_in\">chr</span>(pad) * pad</span><br><span class=\"line\">    <span class=\"keyword\">return</span> data</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">enc_params</span>(<span class=\"params\">data, key</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;&#x27;&#x27;加密过程&#x27;&#x27;&#x27;</span></span><br><span class=\"line\">    data = to_16(data)</span><br><span class=\"line\">    iv = <span class=\"string\">&quot;0102030405060708&quot;</span></span><br><span class=\"line\">    aes = AES.new(key=key.encode(<span class=\"string\">&quot;utf-8&quot;</span>), IV=iv.encode(<span class=\"string\">&quot;utf-8&quot;</span>),</span><br><span class=\"line\">                  mode=AES.MODE_CBC)  <span class=\"comment\"># 新建一个加密对象</span></span><br><span class=\"line\">    bs = aes.encrypt(data.encode(<span class=\"string\">&#x27;utf-8&#x27;</span>))  <span class=\"comment\"># 加密内容的长度必须是16的倍数</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">str</span>(b64encode(bs), <span class=\"string\">&#x27;utf-8&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    resp = requests.post(url=url, data=&#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;params&quot;</span>: get_params(json.dumps(data)),</span><br><span class=\"line\">        <span class=\"string\">&quot;encSecKey&quot;</span>: get_encSecKey()</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(resp.text)</span><br></pre></td></tr></table></figure>\n\n<p>兄弟们，我拿到了，有些细节还不清楚，以后再深究。</p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","site":{"data":{}},"excerpt":"","more":"<p>查看页面源代码，发现源代码中并不含有热评。通过工具抓包查看请求，数据是通过后端数据库请求过来的。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>查看标头可以发现，这条获取热评的请求传递的参数是加密的。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>首先，我们要找到未加密的参数。</p>\n<p>通过查看请求程序，可以看到当前网页调用了那些JS脚本执行过程，从下往上调用。</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<p>查看最上面的JS脚本，这是产生请求的最后一个脚本，看看这个脚本里面有什么。</p>\n<p><img src=\"Screenshot_4.webp\"></p>\n<p>点开后，咋一看没法理解，这是经过压缩后的JS脚本，没关系，点击左下方的<code>&#123;&#125;</code>优质打印，就是格式化该脚本。</p>\n<p><img src=\"Screenshot_5.webp\"></p>\n<p>通过查看JS脚本，发现最后的请求就是通过<code>send</code>函数发送出去的，在这里设置断点。</p>\n<p><img src=\"Screenshot_6.webp\"></p>\n<p>重新刷新页面，可以看到所有的变量，找到<code>request</code>中的<code>url</code>为<code>/weapi/cdns?csrf_token=</code>，不是我们想要的地址，继续刷新，</p>\n<p><img src=\"Screenshot_7.webp\"></p>\n<p>直到出现<code>https://music.163.com/weapi/comment/resource/comments/get?csrf_token=</code>，这就是我们想要的<code>url</code>。</p>\n<p><img src=\"Screenshot_8.webp\"></p>\n<p>从上图中可以看到，<code>params</code>参数是经过加密的，接着往上分析。</p>\n<p><img src=\"Screenshot_9.webp\"></p>\n<p>查看这里，<code>d7e</code>参数，查看这里的<code>params</code>依旧是加密的。接着往回找，是谁调用的<code>b7g.bsO0x</code>函数。</p>\n<p><img src=\"Screenshot_10.webp\"></p>\n<p>这里可以看到<code>params</code>参数依旧是加密的。</p>\n<p><img src=\"Screenshot_11.webp\"></p>\n<p>找到这里就可以看到<code>params</code>参数没有加密，说明加密过程就在<code> t7m.be7X</code>函数中完成。</p>\n<p><img src=\"Screenshot_12.webp\"></p>\n<p>在这一步中<code>i7b</code>就是未加密的信息，通过这段JS代码后，变成了加密的<code>e7d</code>。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i7b:</span><br><span class=\"line\">  csrf_token: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">cursor</span>: <span class=\"string\">&quot;-1&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">offset</span>: <span class=\"string\">&quot;0&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">orderType</span>: <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">pageNo</span>: <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">pageSize</span>: <span class=\"string\">&quot;20&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">rid</span>: <span class=\"string\">&quot;R_SO_4_1465401422&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">threadId</span>: <span class=\"string\">&quot;R_SO_4_1465401422&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>那么，接下来就需要对这段JS代码进行分析，找到加密的逻辑，然后我们自己来写一个相同的逻辑模拟这个请求。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> cJt0x = t7m.be7X; </span><br><span class=\"line\">t7m.be7X = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">X7Q, e7d</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> i7b = &#123;&#125;</span><br><span class=\"line\">      , e7d = NEJ.X(&#123;&#125;, e7d)</span><br><span class=\"line\">      , mi1x = X7Q.indexOf(<span class=\"string\">&quot;?&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.GEnc &amp;&amp; <span class=\"regexp\">/(^|\\.com)\\/api/</span>.test(X7Q) &amp;&amp; !(e7d.headers &amp;&amp; e7d.headers[ew8o.BH9y] == ew8o.Jf1x) &amp;&amp; !e7d.noEnc) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mi1x != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            i7b = j7c.gQ9H(X7Q.substring(mi1x + <span class=\"number\">1</span>));</span><br><span class=\"line\">            X7Q = X7Q.substring(<span class=\"number\">0</span>, mi1x)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (e7d.query) &#123;</span><br><span class=\"line\">            i7b = NEJ.X(i7b, j7c.fO9F(e7d.query) ? j7c.gQ9H(e7d.query) : e7d.query)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (e7d.data) &#123;</span><br><span class=\"line\">            i7b = NEJ.X(i7b, j7c.fO9F(e7d.data) ? j7c.gQ9H(e7d.data) : e7d.data)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        i7b[<span class=\"string\">&quot;csrf_token&quot;</span>] = t7m.gP9G(<span class=\"string\">&quot;__csrf&quot;</span>);</span><br><span class=\"line\">        X7Q = X7Q.replace(<span class=\"string\">&quot;api&quot;</span>, <span class=\"string\">&quot;weapi&quot;</span>);</span><br><span class=\"line\">        e7d.method = <span class=\"string\">&quot;post&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">delete</span> e7d.query;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bZo6i = <span class=\"built_in\">window</span>.asrsea(<span class=\"built_in\">JSON</span>.stringify(i7b), bmn9e([<span class=\"string\">&quot;流泪&quot;</span>, <span class=\"string\">&quot;强&quot;</span>]), bmn9e(WI6C.md), bmn9e([<span class=\"string\">&quot;爱心&quot;</span>, <span class=\"string\">&quot;女孩&quot;</span>, <span class=\"string\">&quot;惊恐&quot;</span>, <span class=\"string\">&quot;大笑&quot;</span>])); # bZo6i这个变量就是加密后的params和encSecKey。是经过<span class=\"built_in\">window</span>.asrsea函数后加密的</span><br><span class=\"line\">        e7d.data = j7c.cr7k(&#123;</span><br><span class=\"line\">            <span class=\"attr\">params</span>: bZo6i.encText,  # 这就是请求的params参数</span><br><span class=\"line\">            <span class=\"attr\">encSecKey</span>: bZo6i.encSecKey  # 这就是请求的encSecKey参数</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> cdnHost = <span class=\"string\">&quot;y.music.163.com&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> apiHost = <span class=\"string\">&quot;interface.music.163.com&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (location.host === cdnHost) &#123;</span><br><span class=\"line\">        X7Q = X7Q.replace(cdnHost, apiHost);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (X7Q.match(<span class=\"regexp\">/^\\/(we)?api/</span>)) &#123;</span><br><span class=\"line\">            X7Q = <span class=\"string\">&quot;//&quot;</span> + apiHost + X7Q</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        e7d.cookie = <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    cJt0x(X7Q, e7d)</span><br></pre></td></tr></table></figure>\n\n<p>加密的函数就是<code>window.asrsea</code>，这个函数一共传入了四个参数，把他们找出来一个个分析。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.asrsea(<span class=\"built_in\">JSON</span>.stringify(i7b), bmn9e([<span class=\"string\">&quot;流泪&quot;</span>, <span class=\"string\">&quot;强&quot;</span>]), bmn9e(WI6C.md), bmn9e([<span class=\"string\">&quot;爱心&quot;</span>, <span class=\"string\">&quot;女孩&quot;</span>, <span class=\"string\">&quot;惊恐&quot;</span>, <span class=\"string\">&quot;大笑&quot;</span>])</span><br></pre></td></tr></table></figure>\n\n<p>通过上下文搜索，找到<code>window.asrsea = d</code>，来看这个<code>d</code>函数做i了那些加密工作。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\">a</span>) </span>&#123; # a= <span class=\"number\">16</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> d, e, b = <span class=\"string\">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>, c = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (d = <span class=\"number\">0</span>; a &gt; d; d += <span class=\"number\">1</span>) # 循环<span class=\"number\">16</span>次</span><br><span class=\"line\">        e = <span class=\"built_in\">Math</span>.random() * b.length, # 产生的随机数</span><br><span class=\"line\">        e = <span class=\"built_in\">Math</span>.floor(e), # 取整</span><br><span class=\"line\">        c += b.charAt(e); # 取字符串中的xxx位</span><br><span class=\"line\">    <span class=\"keyword\">return</span> c #　返回<span class=\"number\">16</span>位随机的字符串</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\">a, b</span>) </span>&#123; # a是要加密的内容</span><br><span class=\"line\">    <span class=\"keyword\">var</span> c = CryptoJS.enc.Utf8.parse(b) # b就是密钥</span><br><span class=\"line\">      , d = CryptoJS.enc.Utf8.parse(<span class=\"string\">&quot;0102030405060708&quot;</span>)</span><br><span class=\"line\">      , e = CryptoJS.enc.Utf8.parse(a) # e是a传入的数据</span><br><span class=\"line\">      , f = CryptoJS.AES.encrypt(e, c, &#123; # c是加密的密钥</span><br><span class=\"line\">        <span class=\"attr\">iv</span>: d, # 偏移量</span><br><span class=\"line\">        <span class=\"attr\">mode</span>: CryptoJS.mode.CBC # CBC加密模式</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> f.toString()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">c</span>(<span class=\"params\">a, b, c</span>) </span>&#123; # c里面没有随机函数</span><br><span class=\"line\">    <span class=\"keyword\">var</span> d, e;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> setMaxDigits(<span class=\"number\">131</span>),</span><br><span class=\"line\">    d = <span class=\"keyword\">new</span> RSAKeyPair(b,<span class=\"string\">&quot;&quot;</span>,c),</span><br><span class=\"line\">    e = encryptedString(d, a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">d</span>(<span class=\"params\">d, e, f, g</span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">var</span> h = &#123;&#125;  # 定义h空对象</span><br><span class=\"line\">      , i = a(<span class=\"number\">16</span>); # i就是<span class=\"number\">16</span>位的随机值 把i设置成定值 </span><br><span class=\"line\">    <span class=\"keyword\">return</span> h.encText = b(d, g), #  g是密钥</span><br><span class=\"line\">    h.encText = b(h.encText, i), # 返回的就是params, i是密钥</span><br><span class=\"line\">    h.encSecKey = c(i, e, f), # 得到的就是encSecKey, e和f是固定的值, i固定后，encSecKey一定是固定的</span><br><span class=\"line\">    h</span><br><span class=\"line\"></span><br><span class=\"line\">    # 两次加密</span><br><span class=\"line\">    # 数据+<span class=\"function\"><span class=\"params\">g</span> =&gt;</span> 第一次加密结果 + <span class=\"function\"><span class=\"params\">i</span> =&gt;</span> params</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">e</span>(<span class=\"params\">a, b, d, e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> f = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> f.encText = c(a + e, b, d),</span><br><span class=\"line\">    f</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">window</span>.asrsea = d,</span><br><span class=\"line\"><span class=\"built_in\">window</span>.ecnonasr = e</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>第一个参数<code>JSON.stringify(i7b)</code>：这里的<code>i7b</code>就是未经加密的数据。</li>\n<li>第二个的参数<code>bmn9e([&quot;流泪&quot;, &quot;强&quot;])</code>：执行了<code>bmn9e</code>函数，把这个复制到console中执行，可以发现是个固定值始终为<code>&quot;010001&quot;</code>。</li>\n<li>第三个参数<code>bmn9e(WI6C.md)</code>：在控制台执行，可以发现也是固定值<code>&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&quot;</code></li>\n<li>第三个参数<code>bmn9e([&quot;爱心&quot;, &quot;女孩&quot;, &quot;惊恐&quot;, &quot;大笑&quot;]</code>：可以发现也是固定值<code>&quot;0CoJUm6Qyw8W8jud&quot;</code>。</li>\n</ul>\n<p>那么这里<code>function d(d, e, f, g)</code>中的<code>d</code>、<code>e</code>、<code>f</code>、<code>g</code>就分别找到了。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 没有经过加密的真实参数</span></span><br><span class=\"line\">data = &#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;csrf_token&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;cursor&quot;</span>: <span class=\"string\">&quot;-1&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;offset&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;orderType&quot;</span>: <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;pageNo&quot;</span>: <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;pageSize&quot;</span>: <span class=\"string\">&quot;20&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;rid&quot;</span>: <span class=\"string\">&quot;R_SO_4_1465401422&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;threadId&quot;</span>: <span class=\"string\">&quot;R_SO_4_1465401422&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 处理加密过程</span></span><br><span class=\"line\">d = data</span><br><span class=\"line\">e = <span class=\"string\">&quot;010001&quot;</span></span><br><span class=\"line\">f = <span class=\"string\">&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&quot;</span></span><br><span class=\"line\">g = <span class=\"string\">&quot;0CoJUm6Qyw8W8jud&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>然后，把参数按照网易的规则进行加密处理，得到两个参数<code>params</code>和<code>encSecKry</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>最后，请求到网易，拿到评论信息。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Cipher <span class=\"keyword\">import</span> AES</span><br><span class=\"line\"><span class=\"keyword\">from</span> base64 <span class=\"keyword\">import</span> b64encode</span><br><span class=\"line\"><span class=\"comment\"># 请求的url</span></span><br><span class=\"line\"></span><br><span class=\"line\">url = <span class=\"string\">&#x27;https://music.163.com/weapi/comment/resource/comments/get?csrf_token=&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 请求方式post</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 没有经过加密的真实参数</span></span><br><span class=\"line\">data = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;csrf_token&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;cursor&quot;</span>: <span class=\"string\">&quot;-1&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;offset&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;orderType&quot;</span>: <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;pageNo&quot;</span>: <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;pageSize&quot;</span>: <span class=\"string\">&quot;20&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;rid&quot;</span>: <span class=\"string\">&quot;R_SO_4_1465401422&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;threadId&quot;</span>: <span class=\"string\">&quot;R_SO_4_1465401422&quot;</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 处理加密过程</span></span><br><span class=\"line\"></span><br><span class=\"line\">d = data</span><br><span class=\"line\">e = <span class=\"string\">&quot;010001&quot;</span></span><br><span class=\"line\">f = <span class=\"string\">&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&quot;</span></span><br><span class=\"line\">g = <span class=\"string\">&quot;0CoJUm6Qyw8W8jud&quot;</span></span><br><span class=\"line\">i = <span class=\"string\">&quot;8vUt6QwGJDa5do4h&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_encSecKey</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;b5fd7a3aa4b1bbab923026c03b1ebfb46ec108dbf90d7b968ff3953d58b0b7ac87a331043a9676a359051a5002a3a65c0bdf0c2b5f1519ddf153c26daeb5fdf0f43d25ca56d75c874fa98eebfec7d858f327f342f06aa03bb1f3250d4d8f7c3ab0ff2f7dd168ff9ea1327df172943a819d6fd0986699118de2ba25c535d22e4d&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_params</span>(<span class=\"params\">data</span>):</span></span><br><span class=\"line\">    first = enc_params(data, g)</span><br><span class=\"line\">    second = enc_params(first, i)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> second</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">to_16</span>(<span class=\"params\">data</span>):</span></span><br><span class=\"line\">    pad = <span class=\"number\">16</span> - <span class=\"built_in\">len</span>(data) % <span class=\"number\">16</span></span><br><span class=\"line\">    data += <span class=\"built_in\">chr</span>(pad) * pad</span><br><span class=\"line\">    <span class=\"keyword\">return</span> data</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">enc_params</span>(<span class=\"params\">data, key</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;&#x27;&#x27;加密过程&#x27;&#x27;&#x27;</span></span><br><span class=\"line\">    data = to_16(data)</span><br><span class=\"line\">    iv = <span class=\"string\">&quot;0102030405060708&quot;</span></span><br><span class=\"line\">    aes = AES.new(key=key.encode(<span class=\"string\">&quot;utf-8&quot;</span>), IV=iv.encode(<span class=\"string\">&quot;utf-8&quot;</span>),</span><br><span class=\"line\">                  mode=AES.MODE_CBC)  <span class=\"comment\"># 新建一个加密对象</span></span><br><span class=\"line\">    bs = aes.encrypt(data.encode(<span class=\"string\">&#x27;utf-8&#x27;</span>))  <span class=\"comment\"># 加密内容的长度必须是16的倍数</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">str</span>(b64encode(bs), <span class=\"string\">&#x27;utf-8&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    resp = requests.post(url=url, data=&#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;params&quot;</span>: get_params(json.dumps(data)),</span><br><span class=\"line\">        <span class=\"string\">&quot;encSecKey&quot;</span>: get_encSecKey()</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(resp.text)</span><br></pre></td></tr></table></figure>\n\n<p>兄弟们，我拿到了，有些细节还不清楚，以后再深究。</p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n"},{"title":"正则表达式","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-21T13:08:59.000Z","pic":null,"_content":"\n# 正则表达式\n\n正则表达式是处理字符串的强大工具，它有自己特定的语法结构。能实现字符串的检索、替换、匹配验证，对于爬虫来说，从`HTML`里提取想要的信息就非常方便。\n\n## 实例引入\n\n下面用几个实例来看一下正则表达式的用法。\n\n打开开源中国提供的正则表达式测试工具[http://tool.oschina.net/regex/](http://tool.oschina.net/regex/)，输入待匹配的文本，然后选择常用的正则表达式，就可以得出相应的匹配结果了。\n\n例如，输入下面这段待匹配的文本：\n\n```python\nHello, my phone number is 010-86432100 and email is espholychan@outlook.com, and my website is https://holychan.ltd.\n```\n\n这段字符串中包含了一个电话号码和一个电子邮件，接下来就尝试用正则表达式提取出来，如图所示。\n\n![](Screenshot_1.webp)\n\n在网页右侧选择**“匹配 Email地址”**，就可以看到下方出现了文本中的`E-mail`。如果选择**“匹配网址URL”**，就可以看到下方出现了文本中的`URL`。\n\n这里使用了正则表达式的匹配功能，也就是用一定规则将特定的文本提取出来。\n\n比方说，电子邮件是有其特定的组成格式的：`一段字符串` `+` `@` `符号` `+` `某个域名`。而`URL`的组成格式则是`协议类型``+``冒号``+``双斜线``+``域名和路径`。\n\n可以用下面的正则表达式匹配`URL`：\n\n```re\n[a-zA-z]+://[^\\s]*\n```\n\n用这个正则表达式去匹配一个字符串，如果这个字符串中包含类似`URL`的文本，那就会被提取出来。\n\n下表中列出了常用的匹配规则：\n\n| 模式 | 描述 |\n| :--: | :--- |\n| \\w | 匹配字母、数字及下划线 |\n| \\W | 匹配不是字母、数字及下划线的字符 |\n| \\s | 匹配任意空白字符，等价于 [\\t\\n\\r\\f] |\n| \\S | 匹配任意非空字符 |\n| \\d | 匹配任意数字，等价于 [0~9] |\n| \\D | 匹配任意非数字的字符 |\n| \\A | 匹配字符串开头 |\n| \\Z | 匹配字符串结尾，如果存在换行，只匹配到换行前的结束字符串 |\n| \\z | 匹配字符串结尾，如果存在换行，同时还会匹配换行符 |\n| \\G | 匹配最后匹配完成的位置 |\n| \\n | 匹配一个换行符 |\n| \\t | 匹配一个制表符 |\n| ^ | 匹配一行字符串的开头 |\n| $ | 匹配一行字符串的结尾 |\n| . | 匹配任意字符，除了换行符，当 re.DOTALL 标记被指定时，则可以匹配包括换行符的任意字符 |\n| [...] | 用来表示一组字符，单独列出，比如 [amk] 匹配 a、m 或 k |\n| [^...] | 不在 [] 中的字符，比如 匹配除了 a、b、c 之外的字符 |\n| * | 匹配 0 个或多个表达式 |\n| + | 匹配 1 个或多个表达式 |\n| ? | 匹配 0 个或 1 个前面的正则表达式定义的片段，非贪婪方式 |\n| {n} | 精确匹配 n 个前面的表达式 |\n| {n, m} | 匹配 n 到 m 次由前面正则表达式定义的片段，贪婪方式 |\n| a\\|b | 匹配 a 或 b |\n| () | 匹配括号内的表达式，也表示一个组 |\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n`Python`的`re库`提供了整个正则表达式的实现，利用这个库，可以在`Python`中使用正则表达式。\n\n## match\n\n首先介绍一个常用的匹配方法——`match`，向它传入要匹配的字符串，以及正则表达式，就可以检测这个正则表达式是否匹配字符串。`match`方法会尝试从字符串的起始位置匹配正则表达式，如果匹配，就返回匹配成功的结果；如果不匹配，就返回`None`。\n\n```python\nimport re\n\ncontent = 'Hello 123 4567 World_This is a Regex Demo'\nprint(len(content))\nresult = re.match('^Hello\\s\\d\\d\\d\\s\\d{4}\\s\\w{10}', content)\nprint(result)\nprint(result.group())\nprint(result.span())\n```\n\n运行结果如下：\n\n```python\n41\n<re.Match object; span=(0, 25), match='Hello 123 4567 World_This'>\nHello 123 4567 World_This\n(0, 25)\n```\n\n这里首先声明了一个字符串，其中包含英文字母、空白字符、数字等。接下来，我们写一个正则表达式：\n\n```python\n^Hello\\s\\d\\d\\d\\s\\d{4}\\s\\w{10}\n```\n\n用它来匹配这个长字符串。开头的`^`·匹配字符串的开头，也就是以`Hello`开头；`\\s`匹配空白字符，用来匹配目标字符串的空格；`\\d`匹配数字，3个`\\d`匹配`123`；再写1个`\\s`匹配空格；后面的`4567`，依然能用4个`\\d`来匹配，但是这么写比较烦琐，所以后面可以跟`{4}`代表匹配前面的规则4次，也就是匹配4个数字；后面再紧接1个空白字符，最后`\\w{10}`匹配10个字母及下划线。\n\n在`match`方法中，第一个参数传入正则表达式，第二个参数传入要匹配的字符串。打印输出结果，可以看到结果是`SRE_Match`对象，这证明成功匹配。该对象有两个方法：`group`方法可以输出匹配的内容，结果是`Hello 123 4567 World_This`，这恰好是正则表达式规则所匹配的内容；`span`方法可以输出匹配的范围，结果是`(0, 25)`，这就是匹配到的结果字符串在原字符串中的位置范围。\n\n在`match`方法中，第一个参数传入正则表达式，第二个参数传入要匹配的字符串。打印输出结果，可以看到结果是`SRE_Match`对象，这证明成功匹配。该对象有两个方法：`group`方法可以输出匹配的内容，结果是`Hello 123 4567 World_This`，这恰好是正则表达式规则所匹配的内容；`span`方法可以输出匹配的范围，结果是`(0, 25)`，这就是匹配到的结果字符串在原字符串中的位置范围。\n\n## 匹配目标\n\n用`match`方法得到了匹配到的字符串内容，想从字符串中提取一部分内容，该怎么办呢？\n\n要从一段文本中提取出邮件或电话号码等内容。可以使用`()`括号将想提取的子字符串括起来。`()`实际上标记了一个子表达式的开始和结束位置，被标记的每个子表达式会依次对应每一个分组，调用`group`方法传入分组的索引即可获取提取的结果。\n\n示例如下：\n\n```python\nimport re\n\ncontent = 'Hello 1234567 World_This is a Regex Demo'\nresult = re.match('^Hello\\s(\\d+)\\sWorld', content)\nprint(result)\nprint(result.group())\nprint(result.group(1))\nprint(result.span())\n```\n\n这里把字符串中的`1234567`提取出来，此时可以将数字部分的正则表达式用`()`括起来，然后调用了`group(1)`获取匹配结果。\n\n运行结果如下：\n\n```python\n<re.Match object; span=(0, 19), match='Hello 1234567 World'>\nHello 1234567 World\n1234567\n(0,25)\n```\n\n可以看到，成功得到了`1234567`。这里用的是`group(1)`，它与`group()`有所不同，后者会输出完整的匹配结果，而前者会输出第一个被`()`包围的匹配结果。假如正则表达式后面还有`()`包括的内容，那么可以依次用`group(2)`、`group(3)`等来获取。\n\n## 通用匹配\n\n刚才写的正则表达比较复杂，出现空白字符写`\\s`匹配，出现数字用`\\d`匹配，这样的工作量非常大。\n\n可以用一个万能匹配来减少这些工作，那就是`.*`。其中`.`可以匹配任意字符（除换行符），`*`代表匹配前面的字符无限次，组合在一起可以匹配任意字符。\n\n改写一下正则表达式：\n\n```python\nimport re\n\ncontent = 'Hello 1234567 World_This is a Regex Demo'\nresult = re.match('^Hello.*Demo$', content)\nprint(result)\nprint(result.group())\nprint(result.span())\n```\n\n运行结果：\n\n```python\n<re.Match object; span=(0, 40), match='Hello 1234567 World_This is a Regex Demo'>\nHello 1234567 World_This is a Regex Demo\n(0,40)\n```\n\n## 贪婪与非贪婪\n\n使用通用匹配`.*`时，有时候匹配到的并不是我们想要的结果。\n\n```python\nimport re\n\ncontent = 'Hello 1234567 World_This is a Regex Demo'\nresult = re.match('^He.*(\\d+).*Demo$', content)\nprint(result)\nprint(result.group(1))\n```\n\n想获取中间的数字，所以中间依然写的是`(\\d+)`。由于数字两侧的内容比较杂乱，所以略写成`.*`。最后，组成`^He.*(\\d+).*Demo$`，看样子并没有什么问题。\n\n运行结果：\n\n```python\n<re.Match object; span=(0, 40), match='Hello 1234567 World_This is a Regex Demo'>\n7\n```\n\n奇怪的事情发生了，只得到了`7`这个数字，这是怎么回事呢？\n\n这里就涉及一个**贪婪匹配**与**非贪婪匹配**的问题了。在贪婪匹配下，`.*`会匹配尽可能多的字符。正则表达式中`.*`后面是`\\d+`，也就是至少一个数字，并没有指定具体多少个数字，因此，`.*`就尽可能匹配多的字符，这里就把`123456`匹配了，给`\\d+`留下一个可满足条件的数字`7`，最后得到的内容就只有数字`7`了。\n\n这里需要使用非贪婪匹配，非贪婪匹配的写法是`.*?`。\n\n```python\nimport re\n\ncontent = 'Hello 1234567 World_This is a Regex Demo'\nresult = re.match('^He.*?(\\d+).*Demo$', content)\nprint(result)\nprint(result.group(1))\n```\n\n将第一个`.*`改成了`.*?`，转变为非贪婪匹配。运行结果如下：\n\n```shell\n<re.Match object; span=(0, 40), match='Hello 1234567 World_This is a Regex Demo'>\n1234567\n```\n\n成功获取`1234567`，贪婪匹配是尽可能匹配多的字符，非贪婪匹配就是尽可能匹配少的字符。当`.*?`匹配到`Hello`后面的空白字符时，再往后的字符就是数字了，而`\\d+`恰好可以匹配，`.*?`就不再进行匹配，交给`\\d+`去匹配后面的数字。这样`.*?`匹配了尽可能少的字符，`\\d+`的结果就是`1234567`。\n\n在做匹配的时候，字符串中间尽量使用非贪婪匹配，也就是用`.*?`来代替`.*`，以免出现匹配结果缺失的情况。\n\n需要注意的是，如果匹配的结果在字符串结尾，`.*?`就有可能匹配不到任何内容了，因为它会匹配尽可能少的字符。例如：\n\n```python\nimport re \n\ncontent = 'http://weibo.com/comment/kEraCN' \nresult1 = re.match('http.*?comment/(.*?)', content) \nresult2 = re.match('http.*?comment/(.*)', content) \nprint('result1', result1.group(1)) \nprint('result2', result2.group(1))\n```\n\n运行结果如下：\n\n```python\nresult1 \nresult2 kEraCN\n```\n\n## 修饰符\n\n正则表达式可以包含一些可选标志修饰符来控制匹配的模式。修饰符被指定为一个可选的标志。\n\n用实例来看一下：\n\n```python\nimport re\n\ncontent =  '''Hello 1234567 World_This is \na Regex Demo \n'''\nresult = re.match('^He.*?(\\d+).*?Demo$', content) \nprint(result.group(1))\n```\n\n字符串中加了换行符，正则表达式还是一样的，用来匹配其中的数字。看一下运行结果：\n\n```python\nTraceback (most recent call last):\n  File \"c:/Users/espho/PycharmProjects/PythonProjs/python模块/re库/修饰符.py\", line 7, in <module>\n    print(result.group(1))\nAttributeError: 'NoneType' object has no attribute 'group'\n```\n\n运行直接报错，也就是说正则表达式没有匹配到这个字符串，返回结果为`None`，又调用了`group`方法导致`AttributeError`。为什么加了一个换行符，就匹配不到了呢？这是因为我们匹配的是除换行符之外的任意字符，当遇到换行符时，`.*?`就不能匹配了，导致匹配失败。\n\n这里只需加一个修饰符`re.S`，即可修正这个错误：\n\n```python\nresult = re.match('^He.*?(\\d+).*?Demo$', content, re.S) \n```\n\n运行结果如下：\n\n```python\n1234567\n```\n\n这个`re.S`在网页匹配中经常用到。因为`HTML`节点经常会有换行，加上它，就可以匹配节点与节点之间的换行了。\n\n还有一些修饰符，在必要的情况下也可以使用，如表所示：\n\n| 修饰符 | 描述 |\n| :---: | :---- |\n| re.I | 使匹配对大小写不敏感 |\n| re.L | 做本地化识别（locale-aware）匹配 |\n| re.M | 多行匹配，影响 ^ 和 $ |\n| re.S | 使匹配包括换行在内的所有字符 |\n| re.U | 根据 Unicode 字符集解析字符。这个标志影响 \\w、\\W、\\b 和 \\B |\n| re.X | 该标志通过给予你更灵活的格式以便你将正则表达式写得更易于理解 |\n\n","source":"_posts/正则表达式.md","raw":"---\ntitle: 正则表达式\ntags:\n  - python\n  - re\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-21 21:08:59\ncategories: 爬虫\npic:\n---\n\n# 正则表达式\n\n正则表达式是处理字符串的强大工具，它有自己特定的语法结构。能实现字符串的检索、替换、匹配验证，对于爬虫来说，从`HTML`里提取想要的信息就非常方便。\n\n## 实例引入\n\n下面用几个实例来看一下正则表达式的用法。\n\n打开开源中国提供的正则表达式测试工具[http://tool.oschina.net/regex/](http://tool.oschina.net/regex/)，输入待匹配的文本，然后选择常用的正则表达式，就可以得出相应的匹配结果了。\n\n例如，输入下面这段待匹配的文本：\n\n```python\nHello, my phone number is 010-86432100 and email is espholychan@outlook.com, and my website is https://holychan.ltd.\n```\n\n这段字符串中包含了一个电话号码和一个电子邮件，接下来就尝试用正则表达式提取出来，如图所示。\n\n![](Screenshot_1.webp)\n\n在网页右侧选择**“匹配 Email地址”**，就可以看到下方出现了文本中的`E-mail`。如果选择**“匹配网址URL”**，就可以看到下方出现了文本中的`URL`。\n\n这里使用了正则表达式的匹配功能，也就是用一定规则将特定的文本提取出来。\n\n比方说，电子邮件是有其特定的组成格式的：`一段字符串` `+` `@` `符号` `+` `某个域名`。而`URL`的组成格式则是`协议类型``+``冒号``+``双斜线``+``域名和路径`。\n\n可以用下面的正则表达式匹配`URL`：\n\n```re\n[a-zA-z]+://[^\\s]*\n```\n\n用这个正则表达式去匹配一个字符串，如果这个字符串中包含类似`URL`的文本，那就会被提取出来。\n\n下表中列出了常用的匹配规则：\n\n| 模式 | 描述 |\n| :--: | :--- |\n| \\w | 匹配字母、数字及下划线 |\n| \\W | 匹配不是字母、数字及下划线的字符 |\n| \\s | 匹配任意空白字符，等价于 [\\t\\n\\r\\f] |\n| \\S | 匹配任意非空字符 |\n| \\d | 匹配任意数字，等价于 [0~9] |\n| \\D | 匹配任意非数字的字符 |\n| \\A | 匹配字符串开头 |\n| \\Z | 匹配字符串结尾，如果存在换行，只匹配到换行前的结束字符串 |\n| \\z | 匹配字符串结尾，如果存在换行，同时还会匹配换行符 |\n| \\G | 匹配最后匹配完成的位置 |\n| \\n | 匹配一个换行符 |\n| \\t | 匹配一个制表符 |\n| ^ | 匹配一行字符串的开头 |\n| $ | 匹配一行字符串的结尾 |\n| . | 匹配任意字符，除了换行符，当 re.DOTALL 标记被指定时，则可以匹配包括换行符的任意字符 |\n| [...] | 用来表示一组字符，单独列出，比如 [amk] 匹配 a、m 或 k |\n| [^...] | 不在 [] 中的字符，比如 匹配除了 a、b、c 之外的字符 |\n| * | 匹配 0 个或多个表达式 |\n| + | 匹配 1 个或多个表达式 |\n| ? | 匹配 0 个或 1 个前面的正则表达式定义的片段，非贪婪方式 |\n| {n} | 精确匹配 n 个前面的表达式 |\n| {n, m} | 匹配 n 到 m 次由前面正则表达式定义的片段，贪婪方式 |\n| a\\|b | 匹配 a 或 b |\n| () | 匹配括号内的表达式，也表示一个组 |\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n`Python`的`re库`提供了整个正则表达式的实现，利用这个库，可以在`Python`中使用正则表达式。\n\n## match\n\n首先介绍一个常用的匹配方法——`match`，向它传入要匹配的字符串，以及正则表达式，就可以检测这个正则表达式是否匹配字符串。`match`方法会尝试从字符串的起始位置匹配正则表达式，如果匹配，就返回匹配成功的结果；如果不匹配，就返回`None`。\n\n```python\nimport re\n\ncontent = 'Hello 123 4567 World_This is a Regex Demo'\nprint(len(content))\nresult = re.match('^Hello\\s\\d\\d\\d\\s\\d{4}\\s\\w{10}', content)\nprint(result)\nprint(result.group())\nprint(result.span())\n```\n\n运行结果如下：\n\n```python\n41\n<re.Match object; span=(0, 25), match='Hello 123 4567 World_This'>\nHello 123 4567 World_This\n(0, 25)\n```\n\n这里首先声明了一个字符串，其中包含英文字母、空白字符、数字等。接下来，我们写一个正则表达式：\n\n```python\n^Hello\\s\\d\\d\\d\\s\\d{4}\\s\\w{10}\n```\n\n用它来匹配这个长字符串。开头的`^`·匹配字符串的开头，也就是以`Hello`开头；`\\s`匹配空白字符，用来匹配目标字符串的空格；`\\d`匹配数字，3个`\\d`匹配`123`；再写1个`\\s`匹配空格；后面的`4567`，依然能用4个`\\d`来匹配，但是这么写比较烦琐，所以后面可以跟`{4}`代表匹配前面的规则4次，也就是匹配4个数字；后面再紧接1个空白字符，最后`\\w{10}`匹配10个字母及下划线。\n\n在`match`方法中，第一个参数传入正则表达式，第二个参数传入要匹配的字符串。打印输出结果，可以看到结果是`SRE_Match`对象，这证明成功匹配。该对象有两个方法：`group`方法可以输出匹配的内容，结果是`Hello 123 4567 World_This`，这恰好是正则表达式规则所匹配的内容；`span`方法可以输出匹配的范围，结果是`(0, 25)`，这就是匹配到的结果字符串在原字符串中的位置范围。\n\n在`match`方法中，第一个参数传入正则表达式，第二个参数传入要匹配的字符串。打印输出结果，可以看到结果是`SRE_Match`对象，这证明成功匹配。该对象有两个方法：`group`方法可以输出匹配的内容，结果是`Hello 123 4567 World_This`，这恰好是正则表达式规则所匹配的内容；`span`方法可以输出匹配的范围，结果是`(0, 25)`，这就是匹配到的结果字符串在原字符串中的位置范围。\n\n## 匹配目标\n\n用`match`方法得到了匹配到的字符串内容，想从字符串中提取一部分内容，该怎么办呢？\n\n要从一段文本中提取出邮件或电话号码等内容。可以使用`()`括号将想提取的子字符串括起来。`()`实际上标记了一个子表达式的开始和结束位置，被标记的每个子表达式会依次对应每一个分组，调用`group`方法传入分组的索引即可获取提取的结果。\n\n示例如下：\n\n```python\nimport re\n\ncontent = 'Hello 1234567 World_This is a Regex Demo'\nresult = re.match('^Hello\\s(\\d+)\\sWorld', content)\nprint(result)\nprint(result.group())\nprint(result.group(1))\nprint(result.span())\n```\n\n这里把字符串中的`1234567`提取出来，此时可以将数字部分的正则表达式用`()`括起来，然后调用了`group(1)`获取匹配结果。\n\n运行结果如下：\n\n```python\n<re.Match object; span=(0, 19), match='Hello 1234567 World'>\nHello 1234567 World\n1234567\n(0,25)\n```\n\n可以看到，成功得到了`1234567`。这里用的是`group(1)`，它与`group()`有所不同，后者会输出完整的匹配结果，而前者会输出第一个被`()`包围的匹配结果。假如正则表达式后面还有`()`包括的内容，那么可以依次用`group(2)`、`group(3)`等来获取。\n\n## 通用匹配\n\n刚才写的正则表达比较复杂，出现空白字符写`\\s`匹配，出现数字用`\\d`匹配，这样的工作量非常大。\n\n可以用一个万能匹配来减少这些工作，那就是`.*`。其中`.`可以匹配任意字符（除换行符），`*`代表匹配前面的字符无限次，组合在一起可以匹配任意字符。\n\n改写一下正则表达式：\n\n```python\nimport re\n\ncontent = 'Hello 1234567 World_This is a Regex Demo'\nresult = re.match('^Hello.*Demo$', content)\nprint(result)\nprint(result.group())\nprint(result.span())\n```\n\n运行结果：\n\n```python\n<re.Match object; span=(0, 40), match='Hello 1234567 World_This is a Regex Demo'>\nHello 1234567 World_This is a Regex Demo\n(0,40)\n```\n\n## 贪婪与非贪婪\n\n使用通用匹配`.*`时，有时候匹配到的并不是我们想要的结果。\n\n```python\nimport re\n\ncontent = 'Hello 1234567 World_This is a Regex Demo'\nresult = re.match('^He.*(\\d+).*Demo$', content)\nprint(result)\nprint(result.group(1))\n```\n\n想获取中间的数字，所以中间依然写的是`(\\d+)`。由于数字两侧的内容比较杂乱，所以略写成`.*`。最后，组成`^He.*(\\d+).*Demo$`，看样子并没有什么问题。\n\n运行结果：\n\n```python\n<re.Match object; span=(0, 40), match='Hello 1234567 World_This is a Regex Demo'>\n7\n```\n\n奇怪的事情发生了，只得到了`7`这个数字，这是怎么回事呢？\n\n这里就涉及一个**贪婪匹配**与**非贪婪匹配**的问题了。在贪婪匹配下，`.*`会匹配尽可能多的字符。正则表达式中`.*`后面是`\\d+`，也就是至少一个数字，并没有指定具体多少个数字，因此，`.*`就尽可能匹配多的字符，这里就把`123456`匹配了，给`\\d+`留下一个可满足条件的数字`7`，最后得到的内容就只有数字`7`了。\n\n这里需要使用非贪婪匹配，非贪婪匹配的写法是`.*?`。\n\n```python\nimport re\n\ncontent = 'Hello 1234567 World_This is a Regex Demo'\nresult = re.match('^He.*?(\\d+).*Demo$', content)\nprint(result)\nprint(result.group(1))\n```\n\n将第一个`.*`改成了`.*?`，转变为非贪婪匹配。运行结果如下：\n\n```shell\n<re.Match object; span=(0, 40), match='Hello 1234567 World_This is a Regex Demo'>\n1234567\n```\n\n成功获取`1234567`，贪婪匹配是尽可能匹配多的字符，非贪婪匹配就是尽可能匹配少的字符。当`.*?`匹配到`Hello`后面的空白字符时，再往后的字符就是数字了，而`\\d+`恰好可以匹配，`.*?`就不再进行匹配，交给`\\d+`去匹配后面的数字。这样`.*?`匹配了尽可能少的字符，`\\d+`的结果就是`1234567`。\n\n在做匹配的时候，字符串中间尽量使用非贪婪匹配，也就是用`.*?`来代替`.*`，以免出现匹配结果缺失的情况。\n\n需要注意的是，如果匹配的结果在字符串结尾，`.*?`就有可能匹配不到任何内容了，因为它会匹配尽可能少的字符。例如：\n\n```python\nimport re \n\ncontent = 'http://weibo.com/comment/kEraCN' \nresult1 = re.match('http.*?comment/(.*?)', content) \nresult2 = re.match('http.*?comment/(.*)', content) \nprint('result1', result1.group(1)) \nprint('result2', result2.group(1))\n```\n\n运行结果如下：\n\n```python\nresult1 \nresult2 kEraCN\n```\n\n## 修饰符\n\n正则表达式可以包含一些可选标志修饰符来控制匹配的模式。修饰符被指定为一个可选的标志。\n\n用实例来看一下：\n\n```python\nimport re\n\ncontent =  '''Hello 1234567 World_This is \na Regex Demo \n'''\nresult = re.match('^He.*?(\\d+).*?Demo$', content) \nprint(result.group(1))\n```\n\n字符串中加了换行符，正则表达式还是一样的，用来匹配其中的数字。看一下运行结果：\n\n```python\nTraceback (most recent call last):\n  File \"c:/Users/espho/PycharmProjects/PythonProjs/python模块/re库/修饰符.py\", line 7, in <module>\n    print(result.group(1))\nAttributeError: 'NoneType' object has no attribute 'group'\n```\n\n运行直接报错，也就是说正则表达式没有匹配到这个字符串，返回结果为`None`，又调用了`group`方法导致`AttributeError`。为什么加了一个换行符，就匹配不到了呢？这是因为我们匹配的是除换行符之外的任意字符，当遇到换行符时，`.*?`就不能匹配了，导致匹配失败。\n\n这里只需加一个修饰符`re.S`，即可修正这个错误：\n\n```python\nresult = re.match('^He.*?(\\d+).*?Demo$', content, re.S) \n```\n\n运行结果如下：\n\n```python\n1234567\n```\n\n这个`re.S`在网页匹配中经常用到。因为`HTML`节点经常会有换行，加上它，就可以匹配节点与节点之间的换行了。\n\n还有一些修饰符，在必要的情况下也可以使用，如表所示：\n\n| 修饰符 | 描述 |\n| :---: | :---- |\n| re.I | 使匹配对大小写不敏感 |\n| re.L | 做本地化识别（locale-aware）匹配 |\n| re.M | 多行匹配，影响 ^ 和 $ |\n| re.S | 使匹配包括换行在内的所有字符 |\n| re.U | 根据 Unicode 字符集解析字符。这个标志影响 \\w、\\W、\\b 和 \\B |\n| re.X | 该标志通过给予你更灵活的格式以便你将正则表达式写得更易于理解 |\n\n","slug":"正则表达式","published":1,"updated":"2021-06-15T15:47:31.641Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2x003n44udd6goao03","content":"<h1 id=\"正则表达式\"><a href=\"#正则表达式\" class=\"headerlink\" title=\"正则表达式\"></a>正则表达式</h1><p>正则表达式是处理字符串的强大工具，它有自己特定的语法结构。能实现字符串的检索、替换、匹配验证，对于爬虫来说，从<code>HTML</code>里提取想要的信息就非常方便。</p>\n<h2 id=\"实例引入\"><a href=\"#实例引入\" class=\"headerlink\" title=\"实例引入\"></a>实例引入</h2><p>下面用几个实例来看一下正则表达式的用法。</p>\n<p>打开开源中国提供的正则表达式测试工具<a href=\"http://tool.oschina.net/regex/\">http://tool.oschina.net/regex/</a>，输入待匹配的文本，然后选择常用的正则表达式，就可以得出相应的匹配结果了。</p>\n<p>例如，输入下面这段待匹配的文本：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Hello, my phone number <span class=\"keyword\">is</span> 010-<span class=\"number\">86432100</span> <span class=\"keyword\">and</span> email <span class=\"keyword\">is</span> espholychan@outlook.com, <span class=\"keyword\">and</span> my website <span class=\"keyword\">is</span> https://holychan.ltd.</span><br></pre></td></tr></table></figure>\n\n<p>这段字符串中包含了一个电话号码和一个电子邮件，接下来就尝试用正则表达式提取出来，如图所示。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>在网页右侧选择<strong>“匹配 Email地址”</strong>，就可以看到下方出现了文本中的<code>E-mail</code>。如果选择<strong>“匹配网址URL”</strong>，就可以看到下方出现了文本中的<code>URL</code>。</p>\n<p>这里使用了正则表达式的匹配功能，也就是用一定规则将特定的文本提取出来。</p>\n<p>比方说，电子邮件是有其特定的组成格式的：<code>一段字符串</code> <code>+</code> <code>@</code> <code>符号</code> <code>+</code> <code>某个域名</code>。而<code>URL</code>的组成格式则是<code>协议类型``+``冒号``+``双斜线``+``域名和路径</code>。</p>\n<p>可以用下面的正则表达式匹配<code>URL</code>：</p>\n<figure class=\"highlight re\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"literal\">[<span class=\"identifier\">a</span>-<span class=\"identifier\">zA</span>-<span class=\"identifier\">z</span>]</span>+:<span class=\"comment\">//[^\\s]*</span></span><br></pre></td></tr></table></figure>\n\n<p>用这个正则表达式去匹配一个字符串，如果这个字符串中包含类似<code>URL</code>的文本，那就会被提取出来。</p>\n<p>下表中列出了常用的匹配规则：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">模式</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">\\w</td>\n<td align=\"left\">匹配字母、数字及下划线</td>\n</tr>\n<tr>\n<td align=\"center\">\\W</td>\n<td align=\"left\">匹配不是字母、数字及下划线的字符</td>\n</tr>\n<tr>\n<td align=\"center\">\\s</td>\n<td align=\"left\">匹配任意空白字符，等价于 [\\t\\n\\r\\f]</td>\n</tr>\n<tr>\n<td align=\"center\">\\S</td>\n<td align=\"left\">匹配任意非空字符</td>\n</tr>\n<tr>\n<td align=\"center\">\\d</td>\n<td align=\"left\">匹配任意数字，等价于 [0~9]</td>\n</tr>\n<tr>\n<td align=\"center\">\\D</td>\n<td align=\"left\">匹配任意非数字的字符</td>\n</tr>\n<tr>\n<td align=\"center\">\\A</td>\n<td align=\"left\">匹配字符串开头</td>\n</tr>\n<tr>\n<td align=\"center\">\\Z</td>\n<td align=\"left\">匹配字符串结尾，如果存在换行，只匹配到换行前的结束字符串</td>\n</tr>\n<tr>\n<td align=\"center\">\\z</td>\n<td align=\"left\">匹配字符串结尾，如果存在换行，同时还会匹配换行符</td>\n</tr>\n<tr>\n<td align=\"center\">\\G</td>\n<td align=\"left\">匹配最后匹配完成的位置</td>\n</tr>\n<tr>\n<td align=\"center\">\\n</td>\n<td align=\"left\">匹配一个换行符</td>\n</tr>\n<tr>\n<td align=\"center\">\\t</td>\n<td align=\"left\">匹配一个制表符</td>\n</tr>\n<tr>\n<td align=\"center\">^</td>\n<td align=\"left\">匹配一行字符串的开头</td>\n</tr>\n<tr>\n<td align=\"center\">$</td>\n<td align=\"left\">匹配一行字符串的结尾</td>\n</tr>\n<tr>\n<td align=\"center\">.</td>\n<td align=\"left\">匹配任意字符，除了换行符，当 re.DOTALL 标记被指定时，则可以匹配包括换行符的任意字符</td>\n</tr>\n<tr>\n<td align=\"center\">[…]</td>\n<td align=\"left\">用来表示一组字符，单独列出，比如 [amk] 匹配 a、m 或 k</td>\n</tr>\n<tr>\n<td align=\"center\">[^…]</td>\n<td align=\"left\">不在 [] 中的字符，比如 匹配除了 a、b、c 之外的字符</td>\n</tr>\n<tr>\n<td align=\"center\">*</td>\n<td align=\"left\">匹配 0 个或多个表达式</td>\n</tr>\n<tr>\n<td align=\"center\">+</td>\n<td align=\"left\">匹配 1 个或多个表达式</td>\n</tr>\n<tr>\n<td align=\"center\">?</td>\n<td align=\"left\">匹配 0 个或 1 个前面的正则表达式定义的片段，非贪婪方式</td>\n</tr>\n<tr>\n<td align=\"center\">{n}</td>\n<td align=\"left\">精确匹配 n 个前面的表达式</td>\n</tr>\n<tr>\n<td align=\"center\">{n, m}</td>\n<td align=\"left\">匹配 n 到 m 次由前面正则表达式定义的片段，贪婪方式</td>\n</tr>\n<tr>\n<td align=\"center\">a|b</td>\n<td align=\"left\">匹配 a 或 b</td>\n</tr>\n<tr>\n<td align=\"center\">()</td>\n<td align=\"left\">匹配括号内的表达式，也表示一个组</td>\n</tr>\n</tbody></table>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n<p><code>Python</code>的<code>re库</code>提供了整个正则表达式的实现，利用这个库，可以在<code>Python</code>中使用正则表达式。</p>\n<h2 id=\"match\"><a href=\"#match\" class=\"headerlink\" title=\"match\"></a>match</h2><p>首先介绍一个常用的匹配方法——<code>match</code>，向它传入要匹配的字符串，以及正则表达式，就可以检测这个正则表达式是否匹配字符串。<code>match</code>方法会尝试从字符串的起始位置匹配正则表达式，如果匹配，就返回匹配成功的结果；如果不匹配，就返回<code>None</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">content = <span class=\"string\">&#x27;Hello 123 4567 World_This is a Regex Demo&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">len</span>(content))</span><br><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^Hello\\s\\d\\d\\d\\s\\d&#123;4&#125;\\s\\w&#123;10&#125;&#x27;</span>, content)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.group())</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.span())</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">41</span></span><br><span class=\"line\">&lt;re.Match <span class=\"built_in\">object</span>; span=(<span class=\"number\">0</span>, <span class=\"number\">25</span>), match=<span class=\"string\">&#x27;Hello 123 4567 World_This&#x27;</span>&gt;</span><br><span class=\"line\">Hello <span class=\"number\">123</span> <span class=\"number\">4567</span> World_This</span><br><span class=\"line\">(<span class=\"number\">0</span>, <span class=\"number\">25</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这里首先声明了一个字符串，其中包含英文字母、空白字符、数字等。接下来，我们写一个正则表达式：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">^Hello\\s\\d\\d\\d\\s\\d&#123;<span class=\"number\">4</span>&#125;\\s\\w&#123;<span class=\"number\">10</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>用它来匹配这个长字符串。开头的<code>^</code>·匹配字符串的开头，也就是以<code>Hello</code>开头；<code>\\s</code>匹配空白字符，用来匹配目标字符串的空格；<code>\\d</code>匹配数字，3个<code>\\d</code>匹配<code>123</code>；再写1个<code>\\s</code>匹配空格；后面的<code>4567</code>，依然能用4个<code>\\d</code>来匹配，但是这么写比较烦琐，所以后面可以跟<code>&#123;4&#125;</code>代表匹配前面的规则4次，也就是匹配4个数字；后面再紧接1个空白字符，最后<code>\\w&#123;10&#125;</code>匹配10个字母及下划线。</p>\n<p>在<code>match</code>方法中，第一个参数传入正则表达式，第二个参数传入要匹配的字符串。打印输出结果，可以看到结果是<code>SRE_Match</code>对象，这证明成功匹配。该对象有两个方法：<code>group</code>方法可以输出匹配的内容，结果是<code>Hello 123 4567 World_This</code>，这恰好是正则表达式规则所匹配的内容；<code>span</code>方法可以输出匹配的范围，结果是<code>(0, 25)</code>，这就是匹配到的结果字符串在原字符串中的位置范围。</p>\n<p>在<code>match</code>方法中，第一个参数传入正则表达式，第二个参数传入要匹配的字符串。打印输出结果，可以看到结果是<code>SRE_Match</code>对象，这证明成功匹配。该对象有两个方法：<code>group</code>方法可以输出匹配的内容，结果是<code>Hello 123 4567 World_This</code>，这恰好是正则表达式规则所匹配的内容；<code>span</code>方法可以输出匹配的范围，结果是<code>(0, 25)</code>，这就是匹配到的结果字符串在原字符串中的位置范围。</p>\n<h2 id=\"匹配目标\"><a href=\"#匹配目标\" class=\"headerlink\" title=\"匹配目标\"></a>匹配目标</h2><p>用<code>match</code>方法得到了匹配到的字符串内容，想从字符串中提取一部分内容，该怎么办呢？</p>\n<p>要从一段文本中提取出邮件或电话号码等内容。可以使用<code>()</code>括号将想提取的子字符串括起来。<code>()</code>实际上标记了一个子表达式的开始和结束位置，被标记的每个子表达式会依次对应每一个分组，调用<code>group</code>方法传入分组的索引即可获取提取的结果。</p>\n<p>示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">content = <span class=\"string\">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span></span><br><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^Hello\\s(\\d+)\\sWorld&#x27;</span>, content)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.group())</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.group(<span class=\"number\">1</span>))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.span())</span><br></pre></td></tr></table></figure>\n\n<p>这里把字符串中的<code>1234567</code>提取出来，此时可以将数字部分的正则表达式用<code>()</code>括起来，然后调用了<code>group(1)</code>获取匹配结果。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;re.Match <span class=\"built_in\">object</span>; span=(<span class=\"number\">0</span>, <span class=\"number\">19</span>), match=<span class=\"string\">&#x27;Hello 1234567 World&#x27;</span>&gt;</span><br><span class=\"line\">Hello <span class=\"number\">1234567</span> World</span><br><span class=\"line\"><span class=\"number\">1234567</span></span><br><span class=\"line\">(<span class=\"number\">0</span>,<span class=\"number\">25</span>)</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，成功得到了<code>1234567</code>。这里用的是<code>group(1)</code>，它与<code>group()</code>有所不同，后者会输出完整的匹配结果，而前者会输出第一个被<code>()</code>包围的匹配结果。假如正则表达式后面还有<code>()</code>包括的内容，那么可以依次用<code>group(2)</code>、<code>group(3)</code>等来获取。</p>\n<h2 id=\"通用匹配\"><a href=\"#通用匹配\" class=\"headerlink\" title=\"通用匹配\"></a>通用匹配</h2><p>刚才写的正则表达比较复杂，出现空白字符写<code>\\s</code>匹配，出现数字用<code>\\d</code>匹配，这样的工作量非常大。</p>\n<p>可以用一个万能匹配来减少这些工作，那就是<code>.*</code>。其中<code>.</code>可以匹配任意字符（除换行符），<code>*</code>代表匹配前面的字符无限次，组合在一起可以匹配任意字符。</p>\n<p>改写一下正则表达式：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">content = <span class=\"string\">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span></span><br><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^Hello.*Demo$&#x27;</span>, content)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.group())</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.span())</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;re.Match <span class=\"built_in\">object</span>; span=(<span class=\"number\">0</span>, <span class=\"number\">40</span>), match=<span class=\"string\">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span>&gt;</span><br><span class=\"line\">Hello <span class=\"number\">1234567</span> World_This <span class=\"keyword\">is</span> a Regex Demo</span><br><span class=\"line\">(<span class=\"number\">0</span>,<span class=\"number\">40</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"贪婪与非贪婪\"><a href=\"#贪婪与非贪婪\" class=\"headerlink\" title=\"贪婪与非贪婪\"></a>贪婪与非贪婪</h2><p>使用通用匹配<code>.*</code>时，有时候匹配到的并不是我们想要的结果。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">content = <span class=\"string\">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span></span><br><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^He.*(\\d+).*Demo$&#x27;</span>, content)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.group(<span class=\"number\">1</span>))</span><br></pre></td></tr></table></figure>\n\n<p>想获取中间的数字，所以中间依然写的是<code>(\\d+)</code>。由于数字两侧的内容比较杂乱，所以略写成<code>.*</code>。最后，组成<code>^He.*(\\d+).*Demo$</code>，看样子并没有什么问题。</p>\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;re.Match <span class=\"built_in\">object</span>; span=(<span class=\"number\">0</span>, <span class=\"number\">40</span>), match=<span class=\"string\">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span>&gt;</span><br><span class=\"line\"><span class=\"number\">7</span></span><br></pre></td></tr></table></figure>\n\n<p>奇怪的事情发生了，只得到了<code>7</code>这个数字，这是怎么回事呢？</p>\n<p>这里就涉及一个<strong>贪婪匹配</strong>与<strong>非贪婪匹配</strong>的问题了。在贪婪匹配下，<code>.*</code>会匹配尽可能多的字符。正则表达式中<code>.*</code>后面是<code>\\d+</code>，也就是至少一个数字，并没有指定具体多少个数字，因此，<code>.*</code>就尽可能匹配多的字符，这里就把<code>123456</code>匹配了，给<code>\\d+</code>留下一个可满足条件的数字<code>7</code>，最后得到的内容就只有数字<code>7</code>了。</p>\n<p>这里需要使用非贪婪匹配，非贪婪匹配的写法是<code>.*?</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">content = <span class=\"string\">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span></span><br><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^He.*?(\\d+).*Demo$&#x27;</span>, content)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.group(<span class=\"number\">1</span>))</span><br></pre></td></tr></table></figure>\n\n<p>将第一个<code>.*</code>改成了<code>.*?</code>，转变为非贪婪匹配。运行结果如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;re.Match object; span=(0, 40), match=&#x27;Hello 1234567 World_This is a Regex Demo&#x27;&gt;</span><br><span class=\"line\">1234567</span><br></pre></td></tr></table></figure>\n\n<p>成功获取<code>1234567</code>，贪婪匹配是尽可能匹配多的字符，非贪婪匹配就是尽可能匹配少的字符。当<code>.*?</code>匹配到<code>Hello</code>后面的空白字符时，再往后的字符就是数字了，而<code>\\d+</code>恰好可以匹配，<code>.*?</code>就不再进行匹配，交给<code>\\d+</code>去匹配后面的数字。这样<code>.*?</code>匹配了尽可能少的字符，<code>\\d+</code>的结果就是<code>1234567</code>。</p>\n<p>在做匹配的时候，字符串中间尽量使用非贪婪匹配，也就是用<code>.*?</code>来代替<code>.*</code>，以免出现匹配结果缺失的情况。</p>\n<p>需要注意的是，如果匹配的结果在字符串结尾，<code>.*?</code>就有可能匹配不到任何内容了，因为它会匹配尽可能少的字符。例如：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re </span><br><span class=\"line\"></span><br><span class=\"line\">content = <span class=\"string\">&#x27;http://weibo.com/comment/kEraCN&#x27;</span> </span><br><span class=\"line\">result1 = re.match(<span class=\"string\">&#x27;http.*?comment/(.*?)&#x27;</span>, content) </span><br><span class=\"line\">result2 = re.match(<span class=\"string\">&#x27;http.*?comment/(.*)&#x27;</span>, content) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;result1&#x27;</span>, result1.group(<span class=\"number\">1</span>)) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;result2&#x27;</span>, result2.group(<span class=\"number\">1</span>))</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result1 </span><br><span class=\"line\">result2 kEraCN</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"修饰符\"><a href=\"#修饰符\" class=\"headerlink\" title=\"修饰符\"></a>修饰符</h2><p>正则表达式可以包含一些可选标志修饰符来控制匹配的模式。修饰符被指定为一个可选的标志。</p>\n<p>用实例来看一下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">content =  <span class=\"string\">&#x27;&#x27;&#x27;Hello 1234567 World_This is </span></span><br><span class=\"line\"><span class=\"string\">a Regex Demo </span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^He.*?(\\d+).*?Demo$&#x27;</span>, content) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.group(<span class=\"number\">1</span>))</span><br></pre></td></tr></table></figure>\n\n<p>字符串中加了换行符，正则表达式还是一样的，用来匹配其中的数字。看一下运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File <span class=\"string\">&quot;c:/Users/espho/PycharmProjects/PythonProjs/python模块/re库/修饰符.py&quot;</span>, line <span class=\"number\">7</span>, <span class=\"keyword\">in</span> &lt;module&gt;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(result.group(<span class=\"number\">1</span>))</span><br><span class=\"line\">AttributeError: <span class=\"string\">&#x27;NoneType&#x27;</span> <span class=\"built_in\">object</span> has no attribute <span class=\"string\">&#x27;group&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>运行直接报错，也就是说正则表达式没有匹配到这个字符串，返回结果为<code>None</code>，又调用了<code>group</code>方法导致<code>AttributeError</code>。为什么加了一个换行符，就匹配不到了呢？这是因为我们匹配的是除换行符之外的任意字符，当遇到换行符时，<code>.*?</code>就不能匹配了，导致匹配失败。</p>\n<p>这里只需加一个修饰符<code>re.S</code>，即可修正这个错误：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^He.*?(\\d+).*?Demo$&#x27;</span>, content, re.S) </span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1234567</span></span><br></pre></td></tr></table></figure>\n\n<p>这个<code>re.S</code>在网页匹配中经常用到。因为<code>HTML</code>节点经常会有换行，加上它，就可以匹配节点与节点之间的换行了。</p>\n<p>还有一些修饰符，在必要的情况下也可以使用，如表所示：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">修饰符</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">re.I</td>\n<td align=\"left\">使匹配对大小写不敏感</td>\n</tr>\n<tr>\n<td align=\"center\">re.L</td>\n<td align=\"left\">做本地化识别（locale-aware）匹配</td>\n</tr>\n<tr>\n<td align=\"center\">re.M</td>\n<td align=\"left\">多行匹配，影响 ^ 和 $</td>\n</tr>\n<tr>\n<td align=\"center\">re.S</td>\n<td align=\"left\">使匹配包括换行在内的所有字符</td>\n</tr>\n<tr>\n<td align=\"center\">re.U</td>\n<td align=\"left\">根据 Unicode 字符集解析字符。这个标志影响 \\w、\\W、\\b 和 \\B</td>\n</tr>\n<tr>\n<td align=\"center\">re.X</td>\n<td align=\"left\">该标志通过给予你更灵活的格式以便你将正则表达式写得更易于理解</td>\n</tr>\n</tbody></table>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"正则表达式\"><a href=\"#正则表达式\" class=\"headerlink\" title=\"正则表达式\"></a>正则表达式</h1><p>正则表达式是处理字符串的强大工具，它有自己特定的语法结构。能实现字符串的检索、替换、匹配验证，对于爬虫来说，从<code>HTML</code>里提取想要的信息就非常方便。</p>\n<h2 id=\"实例引入\"><a href=\"#实例引入\" class=\"headerlink\" title=\"实例引入\"></a>实例引入</h2><p>下面用几个实例来看一下正则表达式的用法。</p>\n<p>打开开源中国提供的正则表达式测试工具<a href=\"http://tool.oschina.net/regex/\">http://tool.oschina.net/regex/</a>，输入待匹配的文本，然后选择常用的正则表达式，就可以得出相应的匹配结果了。</p>\n<p>例如，输入下面这段待匹配的文本：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Hello, my phone number <span class=\"keyword\">is</span> 010-<span class=\"number\">86432100</span> <span class=\"keyword\">and</span> email <span class=\"keyword\">is</span> espholychan@outlook.com, <span class=\"keyword\">and</span> my website <span class=\"keyword\">is</span> https://holychan.ltd.</span><br></pre></td></tr></table></figure>\n\n<p>这段字符串中包含了一个电话号码和一个电子邮件，接下来就尝试用正则表达式提取出来，如图所示。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>在网页右侧选择<strong>“匹配 Email地址”</strong>，就可以看到下方出现了文本中的<code>E-mail</code>。如果选择<strong>“匹配网址URL”</strong>，就可以看到下方出现了文本中的<code>URL</code>。</p>\n<p>这里使用了正则表达式的匹配功能，也就是用一定规则将特定的文本提取出来。</p>\n<p>比方说，电子邮件是有其特定的组成格式的：<code>一段字符串</code> <code>+</code> <code>@</code> <code>符号</code> <code>+</code> <code>某个域名</code>。而<code>URL</code>的组成格式则是<code>协议类型``+``冒号``+``双斜线``+``域名和路径</code>。</p>\n<p>可以用下面的正则表达式匹配<code>URL</code>：</p>\n<figure class=\"highlight re\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"literal\">[<span class=\"identifier\">a</span>-<span class=\"identifier\">zA</span>-<span class=\"identifier\">z</span>]</span>+:<span class=\"comment\">//[^\\s]*</span></span><br></pre></td></tr></table></figure>\n\n<p>用这个正则表达式去匹配一个字符串，如果这个字符串中包含类似<code>URL</code>的文本，那就会被提取出来。</p>\n<p>下表中列出了常用的匹配规则：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">模式</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">\\w</td>\n<td align=\"left\">匹配字母、数字及下划线</td>\n</tr>\n<tr>\n<td align=\"center\">\\W</td>\n<td align=\"left\">匹配不是字母、数字及下划线的字符</td>\n</tr>\n<tr>\n<td align=\"center\">\\s</td>\n<td align=\"left\">匹配任意空白字符，等价于 [\\t\\n\\r\\f]</td>\n</tr>\n<tr>\n<td align=\"center\">\\S</td>\n<td align=\"left\">匹配任意非空字符</td>\n</tr>\n<tr>\n<td align=\"center\">\\d</td>\n<td align=\"left\">匹配任意数字，等价于 [0~9]</td>\n</tr>\n<tr>\n<td align=\"center\">\\D</td>\n<td align=\"left\">匹配任意非数字的字符</td>\n</tr>\n<tr>\n<td align=\"center\">\\A</td>\n<td align=\"left\">匹配字符串开头</td>\n</tr>\n<tr>\n<td align=\"center\">\\Z</td>\n<td align=\"left\">匹配字符串结尾，如果存在换行，只匹配到换行前的结束字符串</td>\n</tr>\n<tr>\n<td align=\"center\">\\z</td>\n<td align=\"left\">匹配字符串结尾，如果存在换行，同时还会匹配换行符</td>\n</tr>\n<tr>\n<td align=\"center\">\\G</td>\n<td align=\"left\">匹配最后匹配完成的位置</td>\n</tr>\n<tr>\n<td align=\"center\">\\n</td>\n<td align=\"left\">匹配一个换行符</td>\n</tr>\n<tr>\n<td align=\"center\">\\t</td>\n<td align=\"left\">匹配一个制表符</td>\n</tr>\n<tr>\n<td align=\"center\">^</td>\n<td align=\"left\">匹配一行字符串的开头</td>\n</tr>\n<tr>\n<td align=\"center\">$</td>\n<td align=\"left\">匹配一行字符串的结尾</td>\n</tr>\n<tr>\n<td align=\"center\">.</td>\n<td align=\"left\">匹配任意字符，除了换行符，当 re.DOTALL 标记被指定时，则可以匹配包括换行符的任意字符</td>\n</tr>\n<tr>\n<td align=\"center\">[…]</td>\n<td align=\"left\">用来表示一组字符，单独列出，比如 [amk] 匹配 a、m 或 k</td>\n</tr>\n<tr>\n<td align=\"center\">[^…]</td>\n<td align=\"left\">不在 [] 中的字符，比如 匹配除了 a、b、c 之外的字符</td>\n</tr>\n<tr>\n<td align=\"center\">*</td>\n<td align=\"left\">匹配 0 个或多个表达式</td>\n</tr>\n<tr>\n<td align=\"center\">+</td>\n<td align=\"left\">匹配 1 个或多个表达式</td>\n</tr>\n<tr>\n<td align=\"center\">?</td>\n<td align=\"left\">匹配 0 个或 1 个前面的正则表达式定义的片段，非贪婪方式</td>\n</tr>\n<tr>\n<td align=\"center\">{n}</td>\n<td align=\"left\">精确匹配 n 个前面的表达式</td>\n</tr>\n<tr>\n<td align=\"center\">{n, m}</td>\n<td align=\"left\">匹配 n 到 m 次由前面正则表达式定义的片段，贪婪方式</td>\n</tr>\n<tr>\n<td align=\"center\">a|b</td>\n<td align=\"left\">匹配 a 或 b</td>\n</tr>\n<tr>\n<td align=\"center\">()</td>\n<td align=\"left\">匹配括号内的表达式，也表示一个组</td>\n</tr>\n</tbody></table>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n<p><code>Python</code>的<code>re库</code>提供了整个正则表达式的实现，利用这个库，可以在<code>Python</code>中使用正则表达式。</p>\n<h2 id=\"match\"><a href=\"#match\" class=\"headerlink\" title=\"match\"></a>match</h2><p>首先介绍一个常用的匹配方法——<code>match</code>，向它传入要匹配的字符串，以及正则表达式，就可以检测这个正则表达式是否匹配字符串。<code>match</code>方法会尝试从字符串的起始位置匹配正则表达式，如果匹配，就返回匹配成功的结果；如果不匹配，就返回<code>None</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">content = <span class=\"string\">&#x27;Hello 123 4567 World_This is a Regex Demo&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">len</span>(content))</span><br><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^Hello\\s\\d\\d\\d\\s\\d&#123;4&#125;\\s\\w&#123;10&#125;&#x27;</span>, content)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.group())</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.span())</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">41</span></span><br><span class=\"line\">&lt;re.Match <span class=\"built_in\">object</span>; span=(<span class=\"number\">0</span>, <span class=\"number\">25</span>), match=<span class=\"string\">&#x27;Hello 123 4567 World_This&#x27;</span>&gt;</span><br><span class=\"line\">Hello <span class=\"number\">123</span> <span class=\"number\">4567</span> World_This</span><br><span class=\"line\">(<span class=\"number\">0</span>, <span class=\"number\">25</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这里首先声明了一个字符串，其中包含英文字母、空白字符、数字等。接下来，我们写一个正则表达式：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">^Hello\\s\\d\\d\\d\\s\\d&#123;<span class=\"number\">4</span>&#125;\\s\\w&#123;<span class=\"number\">10</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>用它来匹配这个长字符串。开头的<code>^</code>·匹配字符串的开头，也就是以<code>Hello</code>开头；<code>\\s</code>匹配空白字符，用来匹配目标字符串的空格；<code>\\d</code>匹配数字，3个<code>\\d</code>匹配<code>123</code>；再写1个<code>\\s</code>匹配空格；后面的<code>4567</code>，依然能用4个<code>\\d</code>来匹配，但是这么写比较烦琐，所以后面可以跟<code>&#123;4&#125;</code>代表匹配前面的规则4次，也就是匹配4个数字；后面再紧接1个空白字符，最后<code>\\w&#123;10&#125;</code>匹配10个字母及下划线。</p>\n<p>在<code>match</code>方法中，第一个参数传入正则表达式，第二个参数传入要匹配的字符串。打印输出结果，可以看到结果是<code>SRE_Match</code>对象，这证明成功匹配。该对象有两个方法：<code>group</code>方法可以输出匹配的内容，结果是<code>Hello 123 4567 World_This</code>，这恰好是正则表达式规则所匹配的内容；<code>span</code>方法可以输出匹配的范围，结果是<code>(0, 25)</code>，这就是匹配到的结果字符串在原字符串中的位置范围。</p>\n<p>在<code>match</code>方法中，第一个参数传入正则表达式，第二个参数传入要匹配的字符串。打印输出结果，可以看到结果是<code>SRE_Match</code>对象，这证明成功匹配。该对象有两个方法：<code>group</code>方法可以输出匹配的内容，结果是<code>Hello 123 4567 World_This</code>，这恰好是正则表达式规则所匹配的内容；<code>span</code>方法可以输出匹配的范围，结果是<code>(0, 25)</code>，这就是匹配到的结果字符串在原字符串中的位置范围。</p>\n<h2 id=\"匹配目标\"><a href=\"#匹配目标\" class=\"headerlink\" title=\"匹配目标\"></a>匹配目标</h2><p>用<code>match</code>方法得到了匹配到的字符串内容，想从字符串中提取一部分内容，该怎么办呢？</p>\n<p>要从一段文本中提取出邮件或电话号码等内容。可以使用<code>()</code>括号将想提取的子字符串括起来。<code>()</code>实际上标记了一个子表达式的开始和结束位置，被标记的每个子表达式会依次对应每一个分组，调用<code>group</code>方法传入分组的索引即可获取提取的结果。</p>\n<p>示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">content = <span class=\"string\">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span></span><br><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^Hello\\s(\\d+)\\sWorld&#x27;</span>, content)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.group())</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.group(<span class=\"number\">1</span>))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.span())</span><br></pre></td></tr></table></figure>\n\n<p>这里把字符串中的<code>1234567</code>提取出来，此时可以将数字部分的正则表达式用<code>()</code>括起来，然后调用了<code>group(1)</code>获取匹配结果。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;re.Match <span class=\"built_in\">object</span>; span=(<span class=\"number\">0</span>, <span class=\"number\">19</span>), match=<span class=\"string\">&#x27;Hello 1234567 World&#x27;</span>&gt;</span><br><span class=\"line\">Hello <span class=\"number\">1234567</span> World</span><br><span class=\"line\"><span class=\"number\">1234567</span></span><br><span class=\"line\">(<span class=\"number\">0</span>,<span class=\"number\">25</span>)</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，成功得到了<code>1234567</code>。这里用的是<code>group(1)</code>，它与<code>group()</code>有所不同，后者会输出完整的匹配结果，而前者会输出第一个被<code>()</code>包围的匹配结果。假如正则表达式后面还有<code>()</code>包括的内容，那么可以依次用<code>group(2)</code>、<code>group(3)</code>等来获取。</p>\n<h2 id=\"通用匹配\"><a href=\"#通用匹配\" class=\"headerlink\" title=\"通用匹配\"></a>通用匹配</h2><p>刚才写的正则表达比较复杂，出现空白字符写<code>\\s</code>匹配，出现数字用<code>\\d</code>匹配，这样的工作量非常大。</p>\n<p>可以用一个万能匹配来减少这些工作，那就是<code>.*</code>。其中<code>.</code>可以匹配任意字符（除换行符），<code>*</code>代表匹配前面的字符无限次，组合在一起可以匹配任意字符。</p>\n<p>改写一下正则表达式：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">content = <span class=\"string\">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span></span><br><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^Hello.*Demo$&#x27;</span>, content)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.group())</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.span())</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;re.Match <span class=\"built_in\">object</span>; span=(<span class=\"number\">0</span>, <span class=\"number\">40</span>), match=<span class=\"string\">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span>&gt;</span><br><span class=\"line\">Hello <span class=\"number\">1234567</span> World_This <span class=\"keyword\">is</span> a Regex Demo</span><br><span class=\"line\">(<span class=\"number\">0</span>,<span class=\"number\">40</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"贪婪与非贪婪\"><a href=\"#贪婪与非贪婪\" class=\"headerlink\" title=\"贪婪与非贪婪\"></a>贪婪与非贪婪</h2><p>使用通用匹配<code>.*</code>时，有时候匹配到的并不是我们想要的结果。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">content = <span class=\"string\">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span></span><br><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^He.*(\\d+).*Demo$&#x27;</span>, content)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.group(<span class=\"number\">1</span>))</span><br></pre></td></tr></table></figure>\n\n<p>想获取中间的数字，所以中间依然写的是<code>(\\d+)</code>。由于数字两侧的内容比较杂乱，所以略写成<code>.*</code>。最后，组成<code>^He.*(\\d+).*Demo$</code>，看样子并没有什么问题。</p>\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;re.Match <span class=\"built_in\">object</span>; span=(<span class=\"number\">0</span>, <span class=\"number\">40</span>), match=<span class=\"string\">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span>&gt;</span><br><span class=\"line\"><span class=\"number\">7</span></span><br></pre></td></tr></table></figure>\n\n<p>奇怪的事情发生了，只得到了<code>7</code>这个数字，这是怎么回事呢？</p>\n<p>这里就涉及一个<strong>贪婪匹配</strong>与<strong>非贪婪匹配</strong>的问题了。在贪婪匹配下，<code>.*</code>会匹配尽可能多的字符。正则表达式中<code>.*</code>后面是<code>\\d+</code>，也就是至少一个数字，并没有指定具体多少个数字，因此，<code>.*</code>就尽可能匹配多的字符，这里就把<code>123456</code>匹配了，给<code>\\d+</code>留下一个可满足条件的数字<code>7</code>，最后得到的内容就只有数字<code>7</code>了。</p>\n<p>这里需要使用非贪婪匹配，非贪婪匹配的写法是<code>.*?</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">content = <span class=\"string\">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span></span><br><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^He.*?(\\d+).*Demo$&#x27;</span>, content)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.group(<span class=\"number\">1</span>))</span><br></pre></td></tr></table></figure>\n\n<p>将第一个<code>.*</code>改成了<code>.*?</code>，转变为非贪婪匹配。运行结果如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;re.Match object; span=(0, 40), match=&#x27;Hello 1234567 World_This is a Regex Demo&#x27;&gt;</span><br><span class=\"line\">1234567</span><br></pre></td></tr></table></figure>\n\n<p>成功获取<code>1234567</code>，贪婪匹配是尽可能匹配多的字符，非贪婪匹配就是尽可能匹配少的字符。当<code>.*?</code>匹配到<code>Hello</code>后面的空白字符时，再往后的字符就是数字了，而<code>\\d+</code>恰好可以匹配，<code>.*?</code>就不再进行匹配，交给<code>\\d+</code>去匹配后面的数字。这样<code>.*?</code>匹配了尽可能少的字符，<code>\\d+</code>的结果就是<code>1234567</code>。</p>\n<p>在做匹配的时候，字符串中间尽量使用非贪婪匹配，也就是用<code>.*?</code>来代替<code>.*</code>，以免出现匹配结果缺失的情况。</p>\n<p>需要注意的是，如果匹配的结果在字符串结尾，<code>.*?</code>就有可能匹配不到任何内容了，因为它会匹配尽可能少的字符。例如：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re </span><br><span class=\"line\"></span><br><span class=\"line\">content = <span class=\"string\">&#x27;http://weibo.com/comment/kEraCN&#x27;</span> </span><br><span class=\"line\">result1 = re.match(<span class=\"string\">&#x27;http.*?comment/(.*?)&#x27;</span>, content) </span><br><span class=\"line\">result2 = re.match(<span class=\"string\">&#x27;http.*?comment/(.*)&#x27;</span>, content) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;result1&#x27;</span>, result1.group(<span class=\"number\">1</span>)) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;result2&#x27;</span>, result2.group(<span class=\"number\">1</span>))</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result1 </span><br><span class=\"line\">result2 kEraCN</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"修饰符\"><a href=\"#修饰符\" class=\"headerlink\" title=\"修饰符\"></a>修饰符</h2><p>正则表达式可以包含一些可选标志修饰符来控制匹配的模式。修饰符被指定为一个可选的标志。</p>\n<p>用实例来看一下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">content =  <span class=\"string\">&#x27;&#x27;&#x27;Hello 1234567 World_This is </span></span><br><span class=\"line\"><span class=\"string\">a Regex Demo </span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^He.*?(\\d+).*?Demo$&#x27;</span>, content) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(result.group(<span class=\"number\">1</span>))</span><br></pre></td></tr></table></figure>\n\n<p>字符串中加了换行符，正则表达式还是一样的，用来匹配其中的数字。看一下运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File <span class=\"string\">&quot;c:/Users/espho/PycharmProjects/PythonProjs/python模块/re库/修饰符.py&quot;</span>, line <span class=\"number\">7</span>, <span class=\"keyword\">in</span> &lt;module&gt;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(result.group(<span class=\"number\">1</span>))</span><br><span class=\"line\">AttributeError: <span class=\"string\">&#x27;NoneType&#x27;</span> <span class=\"built_in\">object</span> has no attribute <span class=\"string\">&#x27;group&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>运行直接报错，也就是说正则表达式没有匹配到这个字符串，返回结果为<code>None</code>，又调用了<code>group</code>方法导致<code>AttributeError</code>。为什么加了一个换行符，就匹配不到了呢？这是因为我们匹配的是除换行符之外的任意字符，当遇到换行符时，<code>.*?</code>就不能匹配了，导致匹配失败。</p>\n<p>这里只需加一个修饰符<code>re.S</code>，即可修正这个错误：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = re.match(<span class=\"string\">&#x27;^He.*?(\\d+).*?Demo$&#x27;</span>, content, re.S) </span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1234567</span></span><br></pre></td></tr></table></figure>\n\n<p>这个<code>re.S</code>在网页匹配中经常用到。因为<code>HTML</code>节点经常会有换行，加上它，就可以匹配节点与节点之间的换行了。</p>\n<p>还有一些修饰符，在必要的情况下也可以使用，如表所示：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">修饰符</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">re.I</td>\n<td align=\"left\">使匹配对大小写不敏感</td>\n</tr>\n<tr>\n<td align=\"center\">re.L</td>\n<td align=\"left\">做本地化识别（locale-aware）匹配</td>\n</tr>\n<tr>\n<td align=\"center\">re.M</td>\n<td align=\"left\">多行匹配，影响 ^ 和 $</td>\n</tr>\n<tr>\n<td align=\"center\">re.S</td>\n<td align=\"left\">使匹配包括换行在内的所有字符</td>\n</tr>\n<tr>\n<td align=\"center\">re.U</td>\n<td align=\"left\">根据 Unicode 字符集解析字符。这个标志影响 \\w、\\W、\\b 和 \\B</td>\n</tr>\n<tr>\n<td align=\"center\">re.X</td>\n<td align=\"left\">该标志通过给予你更灵活的格式以便你将正则表达式写得更易于理解</td>\n</tr>\n</tbody></table>\n"},{"title":"深度优先和广度优先算法","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-16T13:29:31.000Z","pic":null,"_content":"\n深度优先遍历(Depth First Search, 简称 DFS) 与广度优先遍历(Breath First Search)是图论中两种非常重要的算法，生产上广泛用于拓扑排序，寻路(走迷宫)，搜索引擎，爬虫等，也频繁出现在 leetcode，高频面试题中。\n\n## 深度优先遍历\n\n主要思路是从图中一个未访问的顶点 V 开始，沿着一条路一直走到底，然后从这条路尽头的节点回退到上一个节点，再从另一条路开始走到底...，不断递归重复此过程，直到所有的顶点都遍历完成，它的特点是不撞南墙不回头，先走完一条路，再换一条路继续走。\n\n树是图的一种特例(连通无环的图就是树)，接下来我们来看看树用深度优先遍历该怎么遍历。\n\n![](1.PNG)\n\n我们从根节点 1 开始遍历，它相邻的节点有 2，3，4，先遍历节点 2，再遍历 2 的子节点 5，然后再遍历 5 的子节点 9。\n\n![](2.PNG)\n\n上图中一条路已经走到底了(9是叶子节点，再无可遍历的节点)，此时就从 9 回退到上一个节点 5，看下节点 5 是否还有除 9 以外的节点，没有继续回退到 2，2 也没有除 5 以外的节点，回退到 1，1 有除 2 以外的节点 3，所以从节点 3 开始进行深度优先遍历，如下：\n\n![](3.PNG)\n\n同理从 10 开始往上回溯到 6, 6 没有除 10 以外的子节点，再往上回溯，发现 3 有除 6 以外的子点 7，所以此时会遍历 7。同理从 10 开始往上回溯到 6, 6 没有除 10 以外的子节点，再往上回溯，发现 3 有除 6 以外的子点 7，所以此时会遍历 7。\n\n![](4.PNG)\n\n从 7 往上回溯到 3， 1，发现 1 还有节点 4 未遍历，所以此时沿着 4， 8 进行遍历,这样就遍历完成了。\n\n完整的节点的遍历顺序如下(节点上的的蓝色数字代表)：\n\n![](5.png)\n\n相信大家看到以上的遍历不难发现这就是树的前序遍历,实际上不管是前序遍历，还是中序遍历，亦或是后序遍历，都属于深度优先遍历。\n\n## 广度优先遍历\n\n广度优先遍历，指的是从图的一个未遍历的节点出发，先遍历这个节点的相邻节点，再依次遍历每个相邻节点的相邻节点。\n\n上文所述树的广度优先遍历动图如下，每个节点的值即为它们的遍历顺序。所以广度优先遍历也叫层序遍历，先遍历第一层(节点 1)，再遍历第二层(节点 2，3，4)，第三层(5，6，7，8)，第四层(9，10)。\n\n\n![](1.gif)\n\n深度优先遍历用的是栈，而广度优先遍历要用队列来实现，我们以下图二叉树为例来看看如何用队列来实现广度优先遍历。\n\n![](6.png)\n\n动图如下：\n\n![](2.gif)\n\n## 算法实现\n\n### python实现深度优先\n\n递归实现。\n\n```python\ndef depth_tree(tree_node):\n    if tree_node is not None:\n        print(tree_node._data)\n        if tree_node._left is not None:\n            return depth_tree(tree_node._left)\n        if tree_node._right is not None:\n            return depth_tree(tree_node._right)\n```\n\n### python实现广度优先\n\n队列实现。\n\n```python\ndef level_queue(root):\n    \"\"\"利用队列实现广度优先遍历\"\"\"\n    if root is not None:\n        return\n    my_queue = []\n    node = root\n    my_queue.append(node)\n    while my_queue:\n        node = my_queue.pop(0)\n        print(node.elem)\n        if node.lchild is not None:\n            my_queue.append(node.lchild)\n        if node.rchild is not None:\n            my_queue.append(node.rchild)\n```\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","source":"_posts/深度优先和广度优先算法.md","raw":"---\ntitle: 深度优先和广度优先算法\ntags:\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-16 21:29:31\ncategories: 算法\npic:\n---\n\n深度优先遍历(Depth First Search, 简称 DFS) 与广度优先遍历(Breath First Search)是图论中两种非常重要的算法，生产上广泛用于拓扑排序，寻路(走迷宫)，搜索引擎，爬虫等，也频繁出现在 leetcode，高频面试题中。\n\n## 深度优先遍历\n\n主要思路是从图中一个未访问的顶点 V 开始，沿着一条路一直走到底，然后从这条路尽头的节点回退到上一个节点，再从另一条路开始走到底...，不断递归重复此过程，直到所有的顶点都遍历完成，它的特点是不撞南墙不回头，先走完一条路，再换一条路继续走。\n\n树是图的一种特例(连通无环的图就是树)，接下来我们来看看树用深度优先遍历该怎么遍历。\n\n![](1.PNG)\n\n我们从根节点 1 开始遍历，它相邻的节点有 2，3，4，先遍历节点 2，再遍历 2 的子节点 5，然后再遍历 5 的子节点 9。\n\n![](2.PNG)\n\n上图中一条路已经走到底了(9是叶子节点，再无可遍历的节点)，此时就从 9 回退到上一个节点 5，看下节点 5 是否还有除 9 以外的节点，没有继续回退到 2，2 也没有除 5 以外的节点，回退到 1，1 有除 2 以外的节点 3，所以从节点 3 开始进行深度优先遍历，如下：\n\n![](3.PNG)\n\n同理从 10 开始往上回溯到 6, 6 没有除 10 以外的子节点，再往上回溯，发现 3 有除 6 以外的子点 7，所以此时会遍历 7。同理从 10 开始往上回溯到 6, 6 没有除 10 以外的子节点，再往上回溯，发现 3 有除 6 以外的子点 7，所以此时会遍历 7。\n\n![](4.PNG)\n\n从 7 往上回溯到 3， 1，发现 1 还有节点 4 未遍历，所以此时沿着 4， 8 进行遍历,这样就遍历完成了。\n\n完整的节点的遍历顺序如下(节点上的的蓝色数字代表)：\n\n![](5.png)\n\n相信大家看到以上的遍历不难发现这就是树的前序遍历,实际上不管是前序遍历，还是中序遍历，亦或是后序遍历，都属于深度优先遍历。\n\n## 广度优先遍历\n\n广度优先遍历，指的是从图的一个未遍历的节点出发，先遍历这个节点的相邻节点，再依次遍历每个相邻节点的相邻节点。\n\n上文所述树的广度优先遍历动图如下，每个节点的值即为它们的遍历顺序。所以广度优先遍历也叫层序遍历，先遍历第一层(节点 1)，再遍历第二层(节点 2，3，4)，第三层(5，6，7，8)，第四层(9，10)。\n\n\n![](1.gif)\n\n深度优先遍历用的是栈，而广度优先遍历要用队列来实现，我们以下图二叉树为例来看看如何用队列来实现广度优先遍历。\n\n![](6.png)\n\n动图如下：\n\n![](2.gif)\n\n## 算法实现\n\n### python实现深度优先\n\n递归实现。\n\n```python\ndef depth_tree(tree_node):\n    if tree_node is not None:\n        print(tree_node._data)\n        if tree_node._left is not None:\n            return depth_tree(tree_node._left)\n        if tree_node._right is not None:\n            return depth_tree(tree_node._right)\n```\n\n### python实现广度优先\n\n队列实现。\n\n```python\ndef level_queue(root):\n    \"\"\"利用队列实现广度优先遍历\"\"\"\n    if root is not None:\n        return\n    my_queue = []\n    node = root\n    my_queue.append(node)\n    while my_queue:\n        node = my_queue.pop(0)\n        print(node.elem)\n        if node.lchild is not None:\n            my_queue.append(node.lchild)\n        if node.rchild is not None:\n            my_queue.append(node.rchild)\n```\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","slug":"深度优先和广度优先算法","published":1,"updated":"2021-06-17T10:40:00.996Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2y003q44uddwlygsre","content":"<p>深度优先遍历(Depth First Search, 简称 DFS) 与广度优先遍历(Breath First Search)是图论中两种非常重要的算法，生产上广泛用于拓扑排序，寻路(走迷宫)，搜索引擎，爬虫等，也频繁出现在 leetcode，高频面试题中。</p>\n<h2 id=\"深度优先遍历\"><a href=\"#深度优先遍历\" class=\"headerlink\" title=\"深度优先遍历\"></a>深度优先遍历</h2><p>主要思路是从图中一个未访问的顶点 V 开始，沿着一条路一直走到底，然后从这条路尽头的节点回退到上一个节点，再从另一条路开始走到底…，不断递归重复此过程，直到所有的顶点都遍历完成，它的特点是不撞南墙不回头，先走完一条路，再换一条路继续走。</p>\n<p>树是图的一种特例(连通无环的图就是树)，接下来我们来看看树用深度优先遍历该怎么遍历。</p>\n<p><img src=\"1.PNG\"></p>\n<p>我们从根节点 1 开始遍历，它相邻的节点有 2，3，4，先遍历节点 2，再遍历 2 的子节点 5，然后再遍历 5 的子节点 9。</p>\n<p><img src=\"2.PNG\"></p>\n<p>上图中一条路已经走到底了(9是叶子节点，再无可遍历的节点)，此时就从 9 回退到上一个节点 5，看下节点 5 是否还有除 9 以外的节点，没有继续回退到 2，2 也没有除 5 以外的节点，回退到 1，1 有除 2 以外的节点 3，所以从节点 3 开始进行深度优先遍历，如下：</p>\n<p><img src=\"3.PNG\"></p>\n<p>同理从 10 开始往上回溯到 6, 6 没有除 10 以外的子节点，再往上回溯，发现 3 有除 6 以外的子点 7，所以此时会遍历 7。同理从 10 开始往上回溯到 6, 6 没有除 10 以外的子节点，再往上回溯，发现 3 有除 6 以外的子点 7，所以此时会遍历 7。</p>\n<p><img src=\"4.PNG\"></p>\n<p>从 7 往上回溯到 3， 1，发现 1 还有节点 4 未遍历，所以此时沿着 4， 8 进行遍历,这样就遍历完成了。</p>\n<p>完整的节点的遍历顺序如下(节点上的的蓝色数字代表)：</p>\n<p><img src=\"5.png\"></p>\n<p>相信大家看到以上的遍历不难发现这就是树的前序遍历,实际上不管是前序遍历，还是中序遍历，亦或是后序遍历，都属于深度优先遍历。</p>\n<h2 id=\"广度优先遍历\"><a href=\"#广度优先遍历\" class=\"headerlink\" title=\"广度优先遍历\"></a>广度优先遍历</h2><p>广度优先遍历，指的是从图的一个未遍历的节点出发，先遍历这个节点的相邻节点，再依次遍历每个相邻节点的相邻节点。</p>\n<p>上文所述树的广度优先遍历动图如下，每个节点的值即为它们的遍历顺序。所以广度优先遍历也叫层序遍历，先遍历第一层(节点 1)，再遍历第二层(节点 2，3，4)，第三层(5，6，7，8)，第四层(9，10)。</p>\n<p><img src=\"1.gif\"></p>\n<p>深度优先遍历用的是栈，而广度优先遍历要用队列来实现，我们以下图二叉树为例来看看如何用队列来实现广度优先遍历。</p>\n<p><img src=\"6.png\"></p>\n<p>动图如下：</p>\n<p><img src=\"2.gif\"></p>\n<h2 id=\"算法实现\"><a href=\"#算法实现\" class=\"headerlink\" title=\"算法实现\"></a>算法实现</h2><h3 id=\"python实现深度优先\"><a href=\"#python实现深度优先\" class=\"headerlink\" title=\"python实现深度优先\"></a>python实现深度优先</h3><p>递归实现。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">depth_tree</span>(<span class=\"params\">tree_node</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> tree_node <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(tree_node._data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> tree_node._left <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> depth_tree(tree_node._left)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> tree_node._right <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> depth_tree(tree_node._right)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"python实现广度优先\"><a href=\"#python实现广度优先\" class=\"headerlink\" title=\"python实现广度优先\"></a>python实现广度优先</h3><p>队列实现。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">level_queue</span>(<span class=\"params\">root</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;利用队列实现广度优先遍历&quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> root <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    my_queue = []</span><br><span class=\"line\">    node = root</span><br><span class=\"line\">    my_queue.append(node)</span><br><span class=\"line\">    <span class=\"keyword\">while</span> my_queue:</span><br><span class=\"line\">        node = my_queue.pop(<span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(node.elem)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> node.lchild <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            my_queue.append(node.lchild)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> node.rchild <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            my_queue.append(node.rchild)</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","site":{"data":{}},"excerpt":"","more":"<p>深度优先遍历(Depth First Search, 简称 DFS) 与广度优先遍历(Breath First Search)是图论中两种非常重要的算法，生产上广泛用于拓扑排序，寻路(走迷宫)，搜索引擎，爬虫等，也频繁出现在 leetcode，高频面试题中。</p>\n<h2 id=\"深度优先遍历\"><a href=\"#深度优先遍历\" class=\"headerlink\" title=\"深度优先遍历\"></a>深度优先遍历</h2><p>主要思路是从图中一个未访问的顶点 V 开始，沿着一条路一直走到底，然后从这条路尽头的节点回退到上一个节点，再从另一条路开始走到底…，不断递归重复此过程，直到所有的顶点都遍历完成，它的特点是不撞南墙不回头，先走完一条路，再换一条路继续走。</p>\n<p>树是图的一种特例(连通无环的图就是树)，接下来我们来看看树用深度优先遍历该怎么遍历。</p>\n<p><img src=\"1.PNG\"></p>\n<p>我们从根节点 1 开始遍历，它相邻的节点有 2，3，4，先遍历节点 2，再遍历 2 的子节点 5，然后再遍历 5 的子节点 9。</p>\n<p><img src=\"2.PNG\"></p>\n<p>上图中一条路已经走到底了(9是叶子节点，再无可遍历的节点)，此时就从 9 回退到上一个节点 5，看下节点 5 是否还有除 9 以外的节点，没有继续回退到 2，2 也没有除 5 以外的节点，回退到 1，1 有除 2 以外的节点 3，所以从节点 3 开始进行深度优先遍历，如下：</p>\n<p><img src=\"3.PNG\"></p>\n<p>同理从 10 开始往上回溯到 6, 6 没有除 10 以外的子节点，再往上回溯，发现 3 有除 6 以外的子点 7，所以此时会遍历 7。同理从 10 开始往上回溯到 6, 6 没有除 10 以外的子节点，再往上回溯，发现 3 有除 6 以外的子点 7，所以此时会遍历 7。</p>\n<p><img src=\"4.PNG\"></p>\n<p>从 7 往上回溯到 3， 1，发现 1 还有节点 4 未遍历，所以此时沿着 4， 8 进行遍历,这样就遍历完成了。</p>\n<p>完整的节点的遍历顺序如下(节点上的的蓝色数字代表)：</p>\n<p><img src=\"5.png\"></p>\n<p>相信大家看到以上的遍历不难发现这就是树的前序遍历,实际上不管是前序遍历，还是中序遍历，亦或是后序遍历，都属于深度优先遍历。</p>\n<h2 id=\"广度优先遍历\"><a href=\"#广度优先遍历\" class=\"headerlink\" title=\"广度优先遍历\"></a>广度优先遍历</h2><p>广度优先遍历，指的是从图的一个未遍历的节点出发，先遍历这个节点的相邻节点，再依次遍历每个相邻节点的相邻节点。</p>\n<p>上文所述树的广度优先遍历动图如下，每个节点的值即为它们的遍历顺序。所以广度优先遍历也叫层序遍历，先遍历第一层(节点 1)，再遍历第二层(节点 2，3，4)，第三层(5，6，7，8)，第四层(9，10)。</p>\n<p><img src=\"1.gif\"></p>\n<p>深度优先遍历用的是栈，而广度优先遍历要用队列来实现，我们以下图二叉树为例来看看如何用队列来实现广度优先遍历。</p>\n<p><img src=\"6.png\"></p>\n<p>动图如下：</p>\n<p><img src=\"2.gif\"></p>\n<h2 id=\"算法实现\"><a href=\"#算法实现\" class=\"headerlink\" title=\"算法实现\"></a>算法实现</h2><h3 id=\"python实现深度优先\"><a href=\"#python实现深度优先\" class=\"headerlink\" title=\"python实现深度优先\"></a>python实现深度优先</h3><p>递归实现。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">depth_tree</span>(<span class=\"params\">tree_node</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> tree_node <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(tree_node._data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> tree_node._left <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> depth_tree(tree_node._left)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> tree_node._right <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> depth_tree(tree_node._right)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"python实现广度优先\"><a href=\"#python实现广度优先\" class=\"headerlink\" title=\"python实现广度优先\"></a>python实现广度优先</h3><p>队列实现。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">level_queue</span>(<span class=\"params\">root</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;利用队列实现广度优先遍历&quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> root <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    my_queue = []</span><br><span class=\"line\">    node = root</span><br><span class=\"line\">    my_queue.append(node)</span><br><span class=\"line\">    <span class=\"keyword\">while</span> my_queue:</span><br><span class=\"line\">        node = my_queue.pop(<span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(node.elem)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> node.lchild <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            my_queue.append(node.lchild)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> node.rchild <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            my_queue.append(node.rchild)</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n"},{"title":"爬虫去重策略","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-17T10:48:10.000Z","pic":null,"_content":"\n\n1. 将访问过的URL保存到数据库\n\n2. 将访问过的URL保存到set中，只需要O(1)的代价就可以查询到URL，100000000\\*2byte\\*50个字符/1024/1024/1024 = 9G \n\n3. URL经过md5等方法哈希保存到set中\n\n4. 用bitmap方法，将访问过的URL通过hash函数映射到某一位\n\n5. bloomfilter方法对bitmap进行改进，多重hash函数降低冲突\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","source":"_posts/爬虫去重策略.md","raw":"---\ntitle: 爬虫去重策略\ntags:\n  - python\n  - MD5\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-17 18:48:10\ncategories: 爬虫\npic:\n---\n\n\n1. 将访问过的URL保存到数据库\n\n2. 将访问过的URL保存到set中，只需要O(1)的代价就可以查询到URL，100000000\\*2byte\\*50个字符/1024/1024/1024 = 9G \n\n3. URL经过md5等方法哈希保存到set中\n\n4. 用bitmap方法，将访问过的URL通过hash函数映射到某一位\n\n5. bloomfilter方法对bitmap进行改进，多重hash函数降低冲突\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","slug":"爬虫去重策略","published":1,"updated":"2021-06-17T14:16:30.997Z","layout":"post","photos":[],"link":"","_id":"ckq14rx2z003u44ud18r7dvmj","content":"<ol>\n<li><p>将访问过的URL保存到数据库</p>\n</li>\n<li><p>将访问过的URL保存到set中，只需要O(1)的代价就可以查询到URL，100000000*2byte*50个字符/1024/1024/1024 = 9G </p>\n</li>\n<li><p>URL经过md5等方法哈希保存到set中</p>\n</li>\n<li><p>用bitmap方法，将访问过的URL通过hash函数映射到某一位</p>\n</li>\n<li><p>bloomfilter方法对bitmap进行改进，多重hash函数降低冲突</p>\n</li>\n</ol>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","site":{"data":{}},"excerpt":"","more":"<ol>\n<li><p>将访问过的URL保存到数据库</p>\n</li>\n<li><p>将访问过的URL保存到set中，只需要O(1)的代价就可以查询到URL，100000000*2byte*50个字符/1024/1024/1024 = 9G </p>\n</li>\n<li><p>URL经过md5等方法哈希保存到set中</p>\n</li>\n<li><p>用bitmap方法，将访问过的URL通过hash函数映射到某一位</p>\n</li>\n<li><p>bloomfilter方法对bitmap进行改进，多重hash函数降低冲突</p>\n</li>\n</ol>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n"},{"title":"爬虫的基本原理","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-11T16:12:50.000Z","pic":null,"_content":"\n我们可以把互联网比作一张大网，而爬虫（即网络爬虫）便是在网上爬行的蜘蛛。如果把网的节点比作一个个网页，爬虫爬到这就相当于访问了该页面，获取了其信息。可以把节点间的连线比作网页与网页之间的链接关系，这样蜘蛛通过一个节点后，可以顺着节点连线继续爬行到达下一个节点，即通过一个网页继续获取后续的网页，这样整个网的节点便可以被蜘蛛全部爬行到，网站的数据就可以被抓取下来了。\n\n## 爬虫概述\n\n简单来说，爬虫就是获取网页并提取和保存信息的自动化程序，概要介绍一下。\n\n### 获取网页\n\n获爬虫首先要做的工作就是获取网页，这里就是获取网页的源代码。\n\n源代码里包含了网页的部分有用信息，所以只要把源代码获取下来，就可以从中提取想要的信息了。\n\n前面讲了请求和响应的概念，向网站的服务器发送一个请求，返回的响应体便是网页源代码。所以，最关键的部分就是构造一个 请求并发送给服务器，然后接收到响应并将其解析出来，那么这个流程怎样实现呢？\n\n`Python`提供了许多库来帮助我们实现这个操作，如`urllib`、`requests`等。可以用这些库来帮助我们实现`HTTP`请求操作，请求和响应都可以用类库提供的数据结构来表示，得到响应之后只需要解析数据结构中的`Body`部分，即得到网页的源代码，这样我们可以用程序来实现获取网页的过程了。 \n\n### 提取信息\n\n提获取网页源代码后，接下来就是分析网页源代码，从中提取我们想要的数据。首先，最通用的方法便是采用`正则表达式`提取，这是一个万能的方法，但是在构造正则表达式时比较复杂且容易出错。\n\n另外，由于网页的结构有一定的规则，所以还有一些根据网页节点属性、CSS选择器或`XPath`来提取网页信息的库，如`Beautiful Soup`、`pyquery`、`lxml`等。使用这些库，我们可以高效快速地从中提取网页信息，如节点的属性、文本值等。\n\n提取信息是爬虫非常重要的部分，它可以使杂乱的数据变得条理清晰，以便我们后续处理和分析数据。\n\n### 保存数据\n\n提取信息后，我们一般会将提取到的数据保存到某处以便后续使用。这里保存形式有多种多样，如可以简单保存为`TXT文本`或`JSON文本`，也可以保存到数据库，如`MySQL`和`MongoDB`等，还可保存至远程服务器，如借助`SFTP`进行操作等。\n\n### 自动化程序\n\n自动化程序，意思是说爬虫可以代替人来完成这些操作。首先，我们手工当然可以提取这些信息，但是当量特别大或者想快速获取大量数据的话，肯定还是要借助程序。爬虫就是代替我们来完成这份爬取工作的自动化程序，它可以在抓取过程中进行各 种异常处理、错误重试等操作，确保爬取持续高效地运行。\n\n### 能抓怎样的数据\n\n能在网页中我们能看到各种各样的信息，最常见的便是常规网页，它们对应着 HTML代码，而最常抓取的便是`HTML源代码`。\n\n另外，可能有些网页返回的不是`HTML代码`，而是一个`JSON字符串`（其中`API`接口大多采用这样的形式），这种格式的数据方便传输和解析，它们同样可以抓取，而且数据提取更加方便。\n\n此外，我们还可以看到各种二进制数据，如图片、视频和音频等。利用爬虫，我们可以将这些二进制数据抓取下来，然后保存成对应的文件名。\n\n另外，还可以看到各种扩展名的文件，如`CSS`、`JavaScript`和配置文件等，这些其实也是最普通的文件，只要在浏览器里面可以访问到，就可以将其抓取下来。\n\n上述内容其实都对应各自的`URL`，是基于`HTTP`或`HTTPS`协议的，只要是这种数据，爬虫都可以抓取。\n\n### JavaScript渲染页面\n\n有时候，在用`urllib`或`requests`抓取网页时，得到的源代码实际和浏览器中看到的不一样。\n\n这是一个非常常见的问题。现在网页越来越多地采用`Ajax`、`前端模块化工具`来构建，整个网页可能都是由`JavaScript`渲染出来的，也就是说原始的`HTML代码`就是一个空壳，例如：\n\n```html\n<!DOCTYPE html> \n<html> \n  <head> \n    <meta charset=\"UTF-8\"> \n    <title>This is a Demo</title> \n  </head> \n  <body>\n    <div id=\"container\"> </div> \n  </body> \n  <script src=\"app.js\"></script> \n</html> \n```\n\n`body`节点里面只有一个`id`为`container`的节点，但是需要注意在`body`节点后引入了`app.js`，它便负责整个网站的渲染。\n\n在浏览器中打开这个页面时，首先会加载这个`HTML`内容，接着浏览器会发现其中引入了一个`app.js`文件，然后便会接着去请求这个文件，获取到该文件后，便会执行其中的`JavaScript`代码，而`JavaScript`则会改变`HTML`中的节点，向其添加内容，最后得到完整的页面。\n\n但是在用`urllib`或`requests`等库请求当前页面时，我们得到的只是这个`HTML代码`，它不会帮助我们去继续加载这个`JavaScript`文件，这样也就看不到浏览器中的内容。\n\n这也解释了为什么有时我们得到的源代码和浏览器中看到的不一样。\n\n因此，使用基本`HTTP`请求库得到的源代码可能跟浏览器中的页面源代码不太一样。对于这样的情况，可以分析其后台`Ajax`接口，也可使用`Selenium`、`Splash`这样的库来实现模拟`JavaScript`渲染。\n","source":"_posts/爬虫的基本原理.md","raw":"---\ntitle: 爬虫的基本原理\ntags:\n  - http\n  - 爬虫\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-12 00:12:50\ncategories: 爬虫\npic:\n---\n\n我们可以把互联网比作一张大网，而爬虫（即网络爬虫）便是在网上爬行的蜘蛛。如果把网的节点比作一个个网页，爬虫爬到这就相当于访问了该页面，获取了其信息。可以把节点间的连线比作网页与网页之间的链接关系，这样蜘蛛通过一个节点后，可以顺着节点连线继续爬行到达下一个节点，即通过一个网页继续获取后续的网页，这样整个网的节点便可以被蜘蛛全部爬行到，网站的数据就可以被抓取下来了。\n\n## 爬虫概述\n\n简单来说，爬虫就是获取网页并提取和保存信息的自动化程序，概要介绍一下。\n\n### 获取网页\n\n获爬虫首先要做的工作就是获取网页，这里就是获取网页的源代码。\n\n源代码里包含了网页的部分有用信息，所以只要把源代码获取下来，就可以从中提取想要的信息了。\n\n前面讲了请求和响应的概念，向网站的服务器发送一个请求，返回的响应体便是网页源代码。所以，最关键的部分就是构造一个 请求并发送给服务器，然后接收到响应并将其解析出来，那么这个流程怎样实现呢？\n\n`Python`提供了许多库来帮助我们实现这个操作，如`urllib`、`requests`等。可以用这些库来帮助我们实现`HTTP`请求操作，请求和响应都可以用类库提供的数据结构来表示，得到响应之后只需要解析数据结构中的`Body`部分，即得到网页的源代码，这样我们可以用程序来实现获取网页的过程了。 \n\n### 提取信息\n\n提获取网页源代码后，接下来就是分析网页源代码，从中提取我们想要的数据。首先，最通用的方法便是采用`正则表达式`提取，这是一个万能的方法，但是在构造正则表达式时比较复杂且容易出错。\n\n另外，由于网页的结构有一定的规则，所以还有一些根据网页节点属性、CSS选择器或`XPath`来提取网页信息的库，如`Beautiful Soup`、`pyquery`、`lxml`等。使用这些库，我们可以高效快速地从中提取网页信息，如节点的属性、文本值等。\n\n提取信息是爬虫非常重要的部分，它可以使杂乱的数据变得条理清晰，以便我们后续处理和分析数据。\n\n### 保存数据\n\n提取信息后，我们一般会将提取到的数据保存到某处以便后续使用。这里保存形式有多种多样，如可以简单保存为`TXT文本`或`JSON文本`，也可以保存到数据库，如`MySQL`和`MongoDB`等，还可保存至远程服务器，如借助`SFTP`进行操作等。\n\n### 自动化程序\n\n自动化程序，意思是说爬虫可以代替人来完成这些操作。首先，我们手工当然可以提取这些信息，但是当量特别大或者想快速获取大量数据的话，肯定还是要借助程序。爬虫就是代替我们来完成这份爬取工作的自动化程序，它可以在抓取过程中进行各 种异常处理、错误重试等操作，确保爬取持续高效地运行。\n\n### 能抓怎样的数据\n\n能在网页中我们能看到各种各样的信息，最常见的便是常规网页，它们对应着 HTML代码，而最常抓取的便是`HTML源代码`。\n\n另外，可能有些网页返回的不是`HTML代码`，而是一个`JSON字符串`（其中`API`接口大多采用这样的形式），这种格式的数据方便传输和解析，它们同样可以抓取，而且数据提取更加方便。\n\n此外，我们还可以看到各种二进制数据，如图片、视频和音频等。利用爬虫，我们可以将这些二进制数据抓取下来，然后保存成对应的文件名。\n\n另外，还可以看到各种扩展名的文件，如`CSS`、`JavaScript`和配置文件等，这些其实也是最普通的文件，只要在浏览器里面可以访问到，就可以将其抓取下来。\n\n上述内容其实都对应各自的`URL`，是基于`HTTP`或`HTTPS`协议的，只要是这种数据，爬虫都可以抓取。\n\n### JavaScript渲染页面\n\n有时候，在用`urllib`或`requests`抓取网页时，得到的源代码实际和浏览器中看到的不一样。\n\n这是一个非常常见的问题。现在网页越来越多地采用`Ajax`、`前端模块化工具`来构建，整个网页可能都是由`JavaScript`渲染出来的，也就是说原始的`HTML代码`就是一个空壳，例如：\n\n```html\n<!DOCTYPE html> \n<html> \n  <head> \n    <meta charset=\"UTF-8\"> \n    <title>This is a Demo</title> \n  </head> \n  <body>\n    <div id=\"container\"> </div> \n  </body> \n  <script src=\"app.js\"></script> \n</html> \n```\n\n`body`节点里面只有一个`id`为`container`的节点，但是需要注意在`body`节点后引入了`app.js`，它便负责整个网站的渲染。\n\n在浏览器中打开这个页面时，首先会加载这个`HTML`内容，接着浏览器会发现其中引入了一个`app.js`文件，然后便会接着去请求这个文件，获取到该文件后，便会执行其中的`JavaScript`代码，而`JavaScript`则会改变`HTML`中的节点，向其添加内容，最后得到完整的页面。\n\n但是在用`urllib`或`requests`等库请求当前页面时，我们得到的只是这个`HTML代码`，它不会帮助我们去继续加载这个`JavaScript`文件，这样也就看不到浏览器中的内容。\n\n这也解释了为什么有时我们得到的源代码和浏览器中看到的不一样。\n\n因此，使用基本`HTTP`请求库得到的源代码可能跟浏览器中的页面源代码不太一样。对于这样的情况，可以分析其后台`Ajax`接口，也可使用`Selenium`、`Splash`这样的库来实现模拟`JavaScript`渲染。\n","slug":"爬虫的基本原理","published":1,"updated":"2021-06-15T03:24:11.551Z","layout":"post","photos":[],"link":"","_id":"ckq14rx30003y44ud0k0yctqj","content":"<p>我们可以把互联网比作一张大网，而爬虫（即网络爬虫）便是在网上爬行的蜘蛛。如果把网的节点比作一个个网页，爬虫爬到这就相当于访问了该页面，获取了其信息。可以把节点间的连线比作网页与网页之间的链接关系，这样蜘蛛通过一个节点后，可以顺着节点连线继续爬行到达下一个节点，即通过一个网页继续获取后续的网页，这样整个网的节点便可以被蜘蛛全部爬行到，网站的数据就可以被抓取下来了。</p>\n<h2 id=\"爬虫概述\"><a href=\"#爬虫概述\" class=\"headerlink\" title=\"爬虫概述\"></a>爬虫概述</h2><p>简单来说，爬虫就是获取网页并提取和保存信息的自动化程序，概要介绍一下。</p>\n<h3 id=\"获取网页\"><a href=\"#获取网页\" class=\"headerlink\" title=\"获取网页\"></a>获取网页</h3><p>获爬虫首先要做的工作就是获取网页，这里就是获取网页的源代码。</p>\n<p>源代码里包含了网页的部分有用信息，所以只要把源代码获取下来，就可以从中提取想要的信息了。</p>\n<p>前面讲了请求和响应的概念，向网站的服务器发送一个请求，返回的响应体便是网页源代码。所以，最关键的部分就是构造一个 请求并发送给服务器，然后接收到响应并将其解析出来，那么这个流程怎样实现呢？</p>\n<p><code>Python</code>提供了许多库来帮助我们实现这个操作，如<code>urllib</code>、<code>requests</code>等。可以用这些库来帮助我们实现<code>HTTP</code>请求操作，请求和响应都可以用类库提供的数据结构来表示，得到响应之后只需要解析数据结构中的<code>Body</code>部分，即得到网页的源代码，这样我们可以用程序来实现获取网页的过程了。 </p>\n<h3 id=\"提取信息\"><a href=\"#提取信息\" class=\"headerlink\" title=\"提取信息\"></a>提取信息</h3><p>提获取网页源代码后，接下来就是分析网页源代码，从中提取我们想要的数据。首先，最通用的方法便是采用<code>正则表达式</code>提取，这是一个万能的方法，但是在构造正则表达式时比较复杂且容易出错。</p>\n<p>另外，由于网页的结构有一定的规则，所以还有一些根据网页节点属性、CSS选择器或<code>XPath</code>来提取网页信息的库，如<code>Beautiful Soup</code>、<code>pyquery</code>、<code>lxml</code>等。使用这些库，我们可以高效快速地从中提取网页信息，如节点的属性、文本值等。</p>\n<p>提取信息是爬虫非常重要的部分，它可以使杂乱的数据变得条理清晰，以便我们后续处理和分析数据。</p>\n<h3 id=\"保存数据\"><a href=\"#保存数据\" class=\"headerlink\" title=\"保存数据\"></a>保存数据</h3><p>提取信息后，我们一般会将提取到的数据保存到某处以便后续使用。这里保存形式有多种多样，如可以简单保存为<code>TXT文本</code>或<code>JSON文本</code>，也可以保存到数据库，如<code>MySQL</code>和<code>MongoDB</code>等，还可保存至远程服务器，如借助<code>SFTP</code>进行操作等。</p>\n<h3 id=\"自动化程序\"><a href=\"#自动化程序\" class=\"headerlink\" title=\"自动化程序\"></a>自动化程序</h3><p>自动化程序，意思是说爬虫可以代替人来完成这些操作。首先，我们手工当然可以提取这些信息，但是当量特别大或者想快速获取大量数据的话，肯定还是要借助程序。爬虫就是代替我们来完成这份爬取工作的自动化程序，它可以在抓取过程中进行各 种异常处理、错误重试等操作，确保爬取持续高效地运行。</p>\n<h3 id=\"能抓怎样的数据\"><a href=\"#能抓怎样的数据\" class=\"headerlink\" title=\"能抓怎样的数据\"></a>能抓怎样的数据</h3><p>能在网页中我们能看到各种各样的信息，最常见的便是常规网页，它们对应着 HTML代码，而最常抓取的便是<code>HTML源代码</code>。</p>\n<p>另外，可能有些网页返回的不是<code>HTML代码</code>，而是一个<code>JSON字符串</code>（其中<code>API</code>接口大多采用这样的形式），这种格式的数据方便传输和解析，它们同样可以抓取，而且数据提取更加方便。</p>\n<p>此外，我们还可以看到各种二进制数据，如图片、视频和音频等。利用爬虫，我们可以将这些二进制数据抓取下来，然后保存成对应的文件名。</p>\n<p>另外，还可以看到各种扩展名的文件，如<code>CSS</code>、<code>JavaScript</code>和配置文件等，这些其实也是最普通的文件，只要在浏览器里面可以访问到，就可以将其抓取下来。</p>\n<p>上述内容其实都对应各自的<code>URL</code>，是基于<code>HTTP</code>或<code>HTTPS</code>协议的，只要是这种数据，爬虫都可以抓取。</p>\n<h3 id=\"JavaScript渲染页面\"><a href=\"#JavaScript渲染页面\" class=\"headerlink\" title=\"JavaScript渲染页面\"></a>JavaScript渲染页面</h3><p>有时候，在用<code>urllib</code>或<code>requests</code>抓取网页时，得到的源代码实际和浏览器中看到的不一样。</p>\n<p>这是一个非常常见的问题。现在网页越来越多地采用<code>Ajax</code>、<code>前端模块化工具</code>来构建，整个网页可能都是由<code>JavaScript</code>渲染出来的，也就是说原始的<code>HTML代码</code>就是一个空壳，例如：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>This is a Demo<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span> <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;app.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span> </span><br></pre></td></tr></table></figure>\n\n<p><code>body</code>节点里面只有一个<code>id</code>为<code>container</code>的节点，但是需要注意在<code>body</code>节点后引入了<code>app.js</code>，它便负责整个网站的渲染。</p>\n<p>在浏览器中打开这个页面时，首先会加载这个<code>HTML</code>内容，接着浏览器会发现其中引入了一个<code>app.js</code>文件，然后便会接着去请求这个文件，获取到该文件后，便会执行其中的<code>JavaScript</code>代码，而<code>JavaScript</code>则会改变<code>HTML</code>中的节点，向其添加内容，最后得到完整的页面。</p>\n<p>但是在用<code>urllib</code>或<code>requests</code>等库请求当前页面时，我们得到的只是这个<code>HTML代码</code>，它不会帮助我们去继续加载这个<code>JavaScript</code>文件，这样也就看不到浏览器中的内容。</p>\n<p>这也解释了为什么有时我们得到的源代码和浏览器中看到的不一样。</p>\n<p>因此，使用基本<code>HTTP</code>请求库得到的源代码可能跟浏览器中的页面源代码不太一样。对于这样的情况，可以分析其后台<code>Ajax</code>接口，也可使用<code>Selenium</code>、<code>Splash</code>这样的库来实现模拟<code>JavaScript</code>渲染。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>我们可以把互联网比作一张大网，而爬虫（即网络爬虫）便是在网上爬行的蜘蛛。如果把网的节点比作一个个网页，爬虫爬到这就相当于访问了该页面，获取了其信息。可以把节点间的连线比作网页与网页之间的链接关系，这样蜘蛛通过一个节点后，可以顺着节点连线继续爬行到达下一个节点，即通过一个网页继续获取后续的网页，这样整个网的节点便可以被蜘蛛全部爬行到，网站的数据就可以被抓取下来了。</p>\n<h2 id=\"爬虫概述\"><a href=\"#爬虫概述\" class=\"headerlink\" title=\"爬虫概述\"></a>爬虫概述</h2><p>简单来说，爬虫就是获取网页并提取和保存信息的自动化程序，概要介绍一下。</p>\n<h3 id=\"获取网页\"><a href=\"#获取网页\" class=\"headerlink\" title=\"获取网页\"></a>获取网页</h3><p>获爬虫首先要做的工作就是获取网页，这里就是获取网页的源代码。</p>\n<p>源代码里包含了网页的部分有用信息，所以只要把源代码获取下来，就可以从中提取想要的信息了。</p>\n<p>前面讲了请求和响应的概念，向网站的服务器发送一个请求，返回的响应体便是网页源代码。所以，最关键的部分就是构造一个 请求并发送给服务器，然后接收到响应并将其解析出来，那么这个流程怎样实现呢？</p>\n<p><code>Python</code>提供了许多库来帮助我们实现这个操作，如<code>urllib</code>、<code>requests</code>等。可以用这些库来帮助我们实现<code>HTTP</code>请求操作，请求和响应都可以用类库提供的数据结构来表示，得到响应之后只需要解析数据结构中的<code>Body</code>部分，即得到网页的源代码，这样我们可以用程序来实现获取网页的过程了。 </p>\n<h3 id=\"提取信息\"><a href=\"#提取信息\" class=\"headerlink\" title=\"提取信息\"></a>提取信息</h3><p>提获取网页源代码后，接下来就是分析网页源代码，从中提取我们想要的数据。首先，最通用的方法便是采用<code>正则表达式</code>提取，这是一个万能的方法，但是在构造正则表达式时比较复杂且容易出错。</p>\n<p>另外，由于网页的结构有一定的规则，所以还有一些根据网页节点属性、CSS选择器或<code>XPath</code>来提取网页信息的库，如<code>Beautiful Soup</code>、<code>pyquery</code>、<code>lxml</code>等。使用这些库，我们可以高效快速地从中提取网页信息，如节点的属性、文本值等。</p>\n<p>提取信息是爬虫非常重要的部分，它可以使杂乱的数据变得条理清晰，以便我们后续处理和分析数据。</p>\n<h3 id=\"保存数据\"><a href=\"#保存数据\" class=\"headerlink\" title=\"保存数据\"></a>保存数据</h3><p>提取信息后，我们一般会将提取到的数据保存到某处以便后续使用。这里保存形式有多种多样，如可以简单保存为<code>TXT文本</code>或<code>JSON文本</code>，也可以保存到数据库，如<code>MySQL</code>和<code>MongoDB</code>等，还可保存至远程服务器，如借助<code>SFTP</code>进行操作等。</p>\n<h3 id=\"自动化程序\"><a href=\"#自动化程序\" class=\"headerlink\" title=\"自动化程序\"></a>自动化程序</h3><p>自动化程序，意思是说爬虫可以代替人来完成这些操作。首先，我们手工当然可以提取这些信息，但是当量特别大或者想快速获取大量数据的话，肯定还是要借助程序。爬虫就是代替我们来完成这份爬取工作的自动化程序，它可以在抓取过程中进行各 种异常处理、错误重试等操作，确保爬取持续高效地运行。</p>\n<h3 id=\"能抓怎样的数据\"><a href=\"#能抓怎样的数据\" class=\"headerlink\" title=\"能抓怎样的数据\"></a>能抓怎样的数据</h3><p>能在网页中我们能看到各种各样的信息，最常见的便是常规网页，它们对应着 HTML代码，而最常抓取的便是<code>HTML源代码</code>。</p>\n<p>另外，可能有些网页返回的不是<code>HTML代码</code>，而是一个<code>JSON字符串</code>（其中<code>API</code>接口大多采用这样的形式），这种格式的数据方便传输和解析，它们同样可以抓取，而且数据提取更加方便。</p>\n<p>此外，我们还可以看到各种二进制数据，如图片、视频和音频等。利用爬虫，我们可以将这些二进制数据抓取下来，然后保存成对应的文件名。</p>\n<p>另外，还可以看到各种扩展名的文件，如<code>CSS</code>、<code>JavaScript</code>和配置文件等，这些其实也是最普通的文件，只要在浏览器里面可以访问到，就可以将其抓取下来。</p>\n<p>上述内容其实都对应各自的<code>URL</code>，是基于<code>HTTP</code>或<code>HTTPS</code>协议的，只要是这种数据，爬虫都可以抓取。</p>\n<h3 id=\"JavaScript渲染页面\"><a href=\"#JavaScript渲染页面\" class=\"headerlink\" title=\"JavaScript渲染页面\"></a>JavaScript渲染页面</h3><p>有时候，在用<code>urllib</code>或<code>requests</code>抓取网页时，得到的源代码实际和浏览器中看到的不一样。</p>\n<p>这是一个非常常见的问题。现在网页越来越多地采用<code>Ajax</code>、<code>前端模块化工具</code>来构建，整个网页可能都是由<code>JavaScript</code>渲染出来的，也就是说原始的<code>HTML代码</code>就是一个空壳，例如：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>This is a Demo<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span> <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;app.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span> </span><br></pre></td></tr></table></figure>\n\n<p><code>body</code>节点里面只有一个<code>id</code>为<code>container</code>的节点，但是需要注意在<code>body</code>节点后引入了<code>app.js</code>，它便负责整个网站的渲染。</p>\n<p>在浏览器中打开这个页面时，首先会加载这个<code>HTML</code>内容，接着浏览器会发现其中引入了一个<code>app.js</code>文件，然后便会接着去请求这个文件，获取到该文件后，便会执行其中的<code>JavaScript</code>代码，而<code>JavaScript</code>则会改变<code>HTML</code>中的节点，向其添加内容，最后得到完整的页面。</p>\n<p>但是在用<code>urllib</code>或<code>requests</code>等库请求当前页面时，我们得到的只是这个<code>HTML代码</code>，它不会帮助我们去继续加载这个<code>JavaScript</code>文件，这样也就看不到浏览器中的内容。</p>\n<p>这也解释了为什么有时我们得到的源代码和浏览器中看到的不一样。</p>\n<p>因此，使用基本<code>HTTP</code>请求库得到的源代码可能跟浏览器中的页面源代码不太一样。对于这样的情况，可以分析其后台<code>Ajax</code>接口，也可使用<code>Selenium</code>、<code>Splash</code>这样的库来实现模拟<code>JavaScript</code>渲染。</p>\n"},{"title":"腾讯云主机CPU占用100%","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-25T08:32:01.000Z","pic":null,"_content":"\n\n## 异常情况\n\n使用`ssh`登录发现连接很缓慢，排除网络问题。登陆后使用`top`查看进程，发现`git`用户的两个进程占用了`95%`的`CPU`。\n\n![](Screenshot_1.webp)\n\n网上查了下，`kswapd0`被植入挖矿病毒，立马`kill`这个进程，CPU的负荷马上降了下来。\n\n## 查看进程端口\n\n```shell\nnetstat -anltp|grep kswapd0\n```\n\n## 查看程序路径\n\n```shell\nls -l /proc/3882/exe\n```\n\n## 定时器查看\n\n```shell\ncrontab -l -u git\n```\n\n查看到定时任务，这个就是病毒的执行路径。\n\n```shell\n[root@VM-0-15-centos ~]# crontab -l -u git\n1 1 */2 * * /var/tmp/.X18263/.rsync/a/upd>/dev/null 2>&1\n5 8 * * 0 /var/tmp/.X18263/.rsync/b/sync>/dev/null 2>&1 \n@reboot /var/tmp/.X18263/.rsync/b/sync>/dev/null 2>&1  \n0 0 */3 * * /var/tmp/.X18263/.rsync/c/aptitude>/dev/null 2>&1\n```\n\n## 临时目录查看\n\n```shell\n[root@VM-0-15-centos tmp]# cd /temp\n[root@VM-0-15-centos tmp]# ll -sa | grep git\n0 -rw-rw-r--   1 git  git     0 May 24 21:41 .out\n4 -rw-rw-r--   1 git  git     9 May 24 07:28 up.txt\n4 drwxrwxr-x   2 git  git  4096 May 24 21:25 .X25-unix\n4 drwxrwxr-x   2 git  git  4096 May 24 21:50 .X3-u111\n```\n\n## 处理办法\n\n1. 直接杀掉进程\n\n2. 删除所有的crontab计划任务\n\n```sheel\ncrontab -e -u git\n```\n\n3. 删除用户和文件（前提是正规业务没有用到此用户）\n\n```shell\nuserdel -r git\n```\n\n4. 删除/tmp目录下test用户的文件\n\n## Xmrig挖矿木马之暴力分析\n\n可以参考大神的分析[https://www.jianshu.com/p/3dd5ad1cd51b](https://www.jianshu.com/p/3dd5ad1cd51b)。\n\n密码一定要复杂！！！\n","source":"_posts/腾讯云主机CPU占用百分百.md","raw":"---\ntitle: 腾讯云主机CPU占用100%\ntags:\n  - git\n  - linux\n  - 病毒\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-25 16:32:01\ncategories: Linux\npic:\n---\n\n\n## 异常情况\n\n使用`ssh`登录发现连接很缓慢，排除网络问题。登陆后使用`top`查看进程，发现`git`用户的两个进程占用了`95%`的`CPU`。\n\n![](Screenshot_1.webp)\n\n网上查了下，`kswapd0`被植入挖矿病毒，立马`kill`这个进程，CPU的负荷马上降了下来。\n\n## 查看进程端口\n\n```shell\nnetstat -anltp|grep kswapd0\n```\n\n## 查看程序路径\n\n```shell\nls -l /proc/3882/exe\n```\n\n## 定时器查看\n\n```shell\ncrontab -l -u git\n```\n\n查看到定时任务，这个就是病毒的执行路径。\n\n```shell\n[root@VM-0-15-centos ~]# crontab -l -u git\n1 1 */2 * * /var/tmp/.X18263/.rsync/a/upd>/dev/null 2>&1\n5 8 * * 0 /var/tmp/.X18263/.rsync/b/sync>/dev/null 2>&1 \n@reboot /var/tmp/.X18263/.rsync/b/sync>/dev/null 2>&1  \n0 0 */3 * * /var/tmp/.X18263/.rsync/c/aptitude>/dev/null 2>&1\n```\n\n## 临时目录查看\n\n```shell\n[root@VM-0-15-centos tmp]# cd /temp\n[root@VM-0-15-centos tmp]# ll -sa | grep git\n0 -rw-rw-r--   1 git  git     0 May 24 21:41 .out\n4 -rw-rw-r--   1 git  git     9 May 24 07:28 up.txt\n4 drwxrwxr-x   2 git  git  4096 May 24 21:25 .X25-unix\n4 drwxrwxr-x   2 git  git  4096 May 24 21:50 .X3-u111\n```\n\n## 处理办法\n\n1. 直接杀掉进程\n\n2. 删除所有的crontab计划任务\n\n```sheel\ncrontab -e -u git\n```\n\n3. 删除用户和文件（前提是正规业务没有用到此用户）\n\n```shell\nuserdel -r git\n```\n\n4. 删除/tmp目录下test用户的文件\n\n## Xmrig挖矿木马之暴力分析\n\n可以参考大神的分析[https://www.jianshu.com/p/3dd5ad1cd51b](https://www.jianshu.com/p/3dd5ad1cd51b)。\n\n密码一定要复杂！！！\n","slug":"腾讯云主机CPU占用百分百","published":1,"updated":"2021-06-15T03:24:11.551Z","layout":"post","photos":[],"link":"","_id":"ckq14rx3n006y44uddspf14b9","content":"<h2 id=\"异常情况\"><a href=\"#异常情况\" class=\"headerlink\" title=\"异常情况\"></a>异常情况</h2><p>使用<code>ssh</code>登录发现连接很缓慢，排除网络问题。登陆后使用<code>top</code>查看进程，发现<code>git</code>用户的两个进程占用了<code>95%</code>的<code>CPU</code>。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>网上查了下，<code>kswapd0</code>被植入挖矿病毒，立马<code>kill</code>这个进程，CPU的负荷马上降了下来。</p>\n<h2 id=\"查看进程端口\"><a href=\"#查看进程端口\" class=\"headerlink\" title=\"查看进程端口\"></a>查看进程端口</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netstat -anltp|grep kswapd0</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"查看程序路径\"><a href=\"#查看程序路径\" class=\"headerlink\" title=\"查看程序路径\"></a>查看程序路径</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls -l /proc/3882/exe</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"定时器查看\"><a href=\"#定时器查看\" class=\"headerlink\" title=\"定时器查看\"></a>定时器查看</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -l -u git</span><br></pre></td></tr></table></figure>\n\n<p>查看到定时任务，这个就是病毒的执行路径。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@VM-0-15-centos ~]# crontab -l -u git</span><br><span class=\"line\">1 1 */2 * * /var/tmp/.X18263/.rsync/a/upd&gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\">5 8 * * 0 /var/tmp/.X18263/.rsync/b/sync&gt;/dev/null 2&gt;&amp;1 </span><br><span class=\"line\">@reboot /var/tmp/.X18263/.rsync/b/sync&gt;/dev/null 2&gt;&amp;1  </span><br><span class=\"line\">0 0 */3 * * /var/tmp/.X18263/.rsync/c/aptitude&gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"临时目录查看\"><a href=\"#临时目录查看\" class=\"headerlink\" title=\"临时目录查看\"></a>临时目录查看</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@VM-0-15-centos tmp]# cd /temp</span><br><span class=\"line\">[root@VM-0-15-centos tmp]# ll -sa | grep git</span><br><span class=\"line\">0 -rw-rw-r--   1 git  git     0 May 24 21:41 .out</span><br><span class=\"line\">4 -rw-rw-r--   1 git  git     9 May 24 07:28 up.txt</span><br><span class=\"line\">4 drwxrwxr-x   2 git  git  4096 May 24 21:25 .X25-unix</span><br><span class=\"line\">4 drwxrwxr-x   2 git  git  4096 May 24 21:50 .X3-u111</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"处理办法\"><a href=\"#处理办法\" class=\"headerlink\" title=\"处理办法\"></a>处理办法</h2><ol>\n<li><p>直接杀掉进程</p>\n</li>\n<li><p>删除所有的crontab计划任务</p>\n</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -e -u git</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>删除用户和文件（前提是正规业务没有用到此用户）</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">userdel -r git</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>删除/tmp目录下test用户的文件</li>\n</ol>\n<h2 id=\"Xmrig挖矿木马之暴力分析\"><a href=\"#Xmrig挖矿木马之暴力分析\" class=\"headerlink\" title=\"Xmrig挖矿木马之暴力分析\"></a>Xmrig挖矿木马之暴力分析</h2><p>可以参考大神的分析<a href=\"https://www.jianshu.com/p/3dd5ad1cd51b\">https://www.jianshu.com/p/3dd5ad1cd51b</a>。</p>\n<p>密码一定要复杂！！！</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"异常情况\"><a href=\"#异常情况\" class=\"headerlink\" title=\"异常情况\"></a>异常情况</h2><p>使用<code>ssh</code>登录发现连接很缓慢，排除网络问题。登陆后使用<code>top</code>查看进程，发现<code>git</code>用户的两个进程占用了<code>95%</code>的<code>CPU</code>。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>网上查了下，<code>kswapd0</code>被植入挖矿病毒，立马<code>kill</code>这个进程，CPU的负荷马上降了下来。</p>\n<h2 id=\"查看进程端口\"><a href=\"#查看进程端口\" class=\"headerlink\" title=\"查看进程端口\"></a>查看进程端口</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netstat -anltp|grep kswapd0</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"查看程序路径\"><a href=\"#查看程序路径\" class=\"headerlink\" title=\"查看程序路径\"></a>查看程序路径</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls -l /proc/3882/exe</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"定时器查看\"><a href=\"#定时器查看\" class=\"headerlink\" title=\"定时器查看\"></a>定时器查看</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -l -u git</span><br></pre></td></tr></table></figure>\n\n<p>查看到定时任务，这个就是病毒的执行路径。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@VM-0-15-centos ~]# crontab -l -u git</span><br><span class=\"line\">1 1 */2 * * /var/tmp/.X18263/.rsync/a/upd&gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\">5 8 * * 0 /var/tmp/.X18263/.rsync/b/sync&gt;/dev/null 2&gt;&amp;1 </span><br><span class=\"line\">@reboot /var/tmp/.X18263/.rsync/b/sync&gt;/dev/null 2&gt;&amp;1  </span><br><span class=\"line\">0 0 */3 * * /var/tmp/.X18263/.rsync/c/aptitude&gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"临时目录查看\"><a href=\"#临时目录查看\" class=\"headerlink\" title=\"临时目录查看\"></a>临时目录查看</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@VM-0-15-centos tmp]# cd /temp</span><br><span class=\"line\">[root@VM-0-15-centos tmp]# ll -sa | grep git</span><br><span class=\"line\">0 -rw-rw-r--   1 git  git     0 May 24 21:41 .out</span><br><span class=\"line\">4 -rw-rw-r--   1 git  git     9 May 24 07:28 up.txt</span><br><span class=\"line\">4 drwxrwxr-x   2 git  git  4096 May 24 21:25 .X25-unix</span><br><span class=\"line\">4 drwxrwxr-x   2 git  git  4096 May 24 21:50 .X3-u111</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"处理办法\"><a href=\"#处理办法\" class=\"headerlink\" title=\"处理办法\"></a>处理办法</h2><ol>\n<li><p>直接杀掉进程</p>\n</li>\n<li><p>删除所有的crontab计划任务</p>\n</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -e -u git</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>删除用户和文件（前提是正规业务没有用到此用户）</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">userdel -r git</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>删除/tmp目录下test用户的文件</li>\n</ol>\n<h2 id=\"Xmrig挖矿木马之暴力分析\"><a href=\"#Xmrig挖矿木马之暴力分析\" class=\"headerlink\" title=\"Xmrig挖矿木马之暴力分析\"></a>Xmrig挖矿木马之暴力分析</h2><p>可以参考大神的分析<a href=\"https://www.jianshu.com/p/3dd5ad1cd51b\">https://www.jianshu.com/p/3dd5ad1cd51b</a>。</p>\n<p>密码一定要复杂！！！</p>\n"},{"title":"腾讯云配置ssl证书","date":"2021-05-10T07:36:11.000Z","pic":null,"comments":1,"toc":true,"only":["home","category","tag"],"_content":"\n## 什么是SSL证书？\n\nSSL证书是用于在Web服务器与浏览器以及客户端之间建立加密链接的加密技术，通过配置和应用SSL证书来启用HTTPS协议，来保证互联网数据传输的安全，全球每天有数以亿计的网站都是通过HTTPS来确保数据安全，保护用户隐私。\n\n## 申请腾讯云SSL证书\n\n百毒搜索腾讯SSL证书，找到免费使用SSL一年的产品，一系列骚操作后得到证书。\n\n## nginx配置修改\n\n下载SSL证书，上传到服务器`/etc/pki/nginx/`目录下。\n\n修改`/etc/`配置文件，注意SSL证书的路径和实际上传的路径和名称一致。\n\n```shell\n    # server {\n    #     listen       80 default_server;\n    #     listen       [::]:80 default_server;\n    #     server_name  www.holychan.ltd;\n    #     root         /home/hexo;\n\n    #     # Load configuration files for the default server block.\n    #     include /etc/nginx/default.d/*.conf;\n\n    #     location / {\n    #     }\n\n    #     error_page 404 /404.html;\n    #         location = /40x.html {\n    #     }\n\n    #     error_page 500 502 503 504 /50x.html;\n    #         location = /50x.html {\n    #     }\n    # }\n    # 以上的配置注释，使用下面的配置\n\n    # Settings for a TLS enabled server.\n\n    server {\n        listen       443 ssl http2 default_server;\n        listen       [::]:443 ssl http2 default_server;\n        server_name  www.holychan.ltd;\n        root         /home/hexo;    # 根目录\n\n        ssl_certificate \"/etc/pki/nginx/1_holychan.ltd_bundle.crt\";    # ssl证书路径\n        ssl_certificate_key \"/etc/pki/nginx/2_holychan.ltd.key\"; # ssl证书密钥\n        ssl_session_cache shared:SSL:1m;\n        ssl_session_timeout  10m;\n        ssl_ciphers PROFILE=SYSTEM;\n        ssl_prefer_server_ciphers on;\n\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n\n        location / {\n        }\n\n        error_page 404 /404.html;\n            location = /40x.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n        }\n    }\n\n}\n```","source":"_posts/腾讯云配置ssl证书.md","raw":"---\ntitle: 腾讯云配置ssl证书\ndate: 2021-05-10 15:36:11\ncategories: 博客教程\ntags:\n- nginx\n- https\n# sticky: 100\npic:\ncomments: true\ntoc: true\nonly:\n- home\n- category\n- tag\n---\n\n## 什么是SSL证书？\n\nSSL证书是用于在Web服务器与浏览器以及客户端之间建立加密链接的加密技术，通过配置和应用SSL证书来启用HTTPS协议，来保证互联网数据传输的安全，全球每天有数以亿计的网站都是通过HTTPS来确保数据安全，保护用户隐私。\n\n## 申请腾讯云SSL证书\n\n百毒搜索腾讯SSL证书，找到免费使用SSL一年的产品，一系列骚操作后得到证书。\n\n## nginx配置修改\n\n下载SSL证书，上传到服务器`/etc/pki/nginx/`目录下。\n\n修改`/etc/`配置文件，注意SSL证书的路径和实际上传的路径和名称一致。\n\n```shell\n    # server {\n    #     listen       80 default_server;\n    #     listen       [::]:80 default_server;\n    #     server_name  www.holychan.ltd;\n    #     root         /home/hexo;\n\n    #     # Load configuration files for the default server block.\n    #     include /etc/nginx/default.d/*.conf;\n\n    #     location / {\n    #     }\n\n    #     error_page 404 /404.html;\n    #         location = /40x.html {\n    #     }\n\n    #     error_page 500 502 503 504 /50x.html;\n    #         location = /50x.html {\n    #     }\n    # }\n    # 以上的配置注释，使用下面的配置\n\n    # Settings for a TLS enabled server.\n\n    server {\n        listen       443 ssl http2 default_server;\n        listen       [::]:443 ssl http2 default_server;\n        server_name  www.holychan.ltd;\n        root         /home/hexo;    # 根目录\n\n        ssl_certificate \"/etc/pki/nginx/1_holychan.ltd_bundle.crt\";    # ssl证书路径\n        ssl_certificate_key \"/etc/pki/nginx/2_holychan.ltd.key\"; # ssl证书密钥\n        ssl_session_cache shared:SSL:1m;\n        ssl_session_timeout  10m;\n        ssl_ciphers PROFILE=SYSTEM;\n        ssl_prefer_server_ciphers on;\n\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n\n        location / {\n        }\n\n        error_page 404 /404.html;\n            location = /40x.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n        }\n    }\n\n}\n```","slug":"腾讯云配置ssl证书","published":1,"updated":"2021-06-15T03:24:11.557Z","layout":"post","photos":[],"link":"","_id":"ckq14rx3r006z44ud1pa96ed6","content":"<h2 id=\"什么是SSL证书？\"><a href=\"#什么是SSL证书？\" class=\"headerlink\" title=\"什么是SSL证书？\"></a>什么是SSL证书？</h2><p>SSL证书是用于在Web服务器与浏览器以及客户端之间建立加密链接的加密技术，通过配置和应用SSL证书来启用HTTPS协议，来保证互联网数据传输的安全，全球每天有数以亿计的网站都是通过HTTPS来确保数据安全，保护用户隐私。</p>\n<h2 id=\"申请腾讯云SSL证书\"><a href=\"#申请腾讯云SSL证书\" class=\"headerlink\" title=\"申请腾讯云SSL证书\"></a>申请腾讯云SSL证书</h2><p>百毒搜索腾讯SSL证书，找到免费使用SSL一年的产品，一系列骚操作后得到证书。</p>\n<h2 id=\"nginx配置修改\"><a href=\"#nginx配置修改\" class=\"headerlink\" title=\"nginx配置修改\"></a>nginx配置修改</h2><p>下载SSL证书，上传到服务器<code>/etc/pki/nginx/</code>目录下。</p>\n<p>修改<code>/etc/</code>配置文件，注意SSL证书的路径和实际上传的路径和名称一致。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    # server &#123;</span><br><span class=\"line\">    #     listen       80 default_server;</span><br><span class=\"line\">    #     listen       [::]:80 default_server;</span><br><span class=\"line\">    #     server_name  www.holychan.ltd;</span><br><span class=\"line\">    #     root         /home/hexo;</span><br><span class=\"line\"></span><br><span class=\"line\">    #     # Load configuration files for the default server block.</span><br><span class=\"line\">    #     include /etc/nginx/default.d/*.conf;</span><br><span class=\"line\"></span><br><span class=\"line\">    #     location / &#123;</span><br><span class=\"line\">    #     &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    #     error_page 404 /404.html;</span><br><span class=\"line\">    #         location = /40x.html &#123;</span><br><span class=\"line\">    #     &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    #     error_page 500 502 503 504 /50x.html;</span><br><span class=\"line\">    #         location = /50x.html &#123;</span><br><span class=\"line\">    #     &#125;</span><br><span class=\"line\">    # &#125;</span><br><span class=\"line\">    # 以上的配置注释，使用下面的配置</span><br><span class=\"line\"></span><br><span class=\"line\">    # Settings for a TLS enabled server.</span><br><span class=\"line\"></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen       443 ssl http2 default_server;</span><br><span class=\"line\">        listen       [::]:443 ssl http2 default_server;</span><br><span class=\"line\">        server_name  www.holychan.ltd;</span><br><span class=\"line\">        root         /home/hexo;    # 根目录</span><br><span class=\"line\"></span><br><span class=\"line\">        ssl_certificate &quot;/etc/pki/nginx/1_holychan.ltd_bundle.crt&quot;;    # ssl证书路径</span><br><span class=\"line\">        ssl_certificate_key &quot;/etc/pki/nginx/2_holychan.ltd.key&quot;; # ssl证书密钥</span><br><span class=\"line\">        ssl_session_cache shared:SSL:1m;</span><br><span class=\"line\">        ssl_session_timeout  10m;</span><br><span class=\"line\">        ssl_ciphers PROFILE=SYSTEM;</span><br><span class=\"line\">        ssl_prefer_server_ciphers on;</span><br><span class=\"line\"></span><br><span class=\"line\">        # Load configuration files for the default server block.</span><br><span class=\"line\">        include /etc/nginx/default.d/*.conf;</span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        error_page 404 /404.html;</span><br><span class=\"line\">            location = /40x.html &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        error_page 500 502 503 504 /50x.html;</span><br><span class=\"line\">            location = /50x.html &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"什么是SSL证书？\"><a href=\"#什么是SSL证书？\" class=\"headerlink\" title=\"什么是SSL证书？\"></a>什么是SSL证书？</h2><p>SSL证书是用于在Web服务器与浏览器以及客户端之间建立加密链接的加密技术，通过配置和应用SSL证书来启用HTTPS协议，来保证互联网数据传输的安全，全球每天有数以亿计的网站都是通过HTTPS来确保数据安全，保护用户隐私。</p>\n<h2 id=\"申请腾讯云SSL证书\"><a href=\"#申请腾讯云SSL证书\" class=\"headerlink\" title=\"申请腾讯云SSL证书\"></a>申请腾讯云SSL证书</h2><p>百毒搜索腾讯SSL证书，找到免费使用SSL一年的产品，一系列骚操作后得到证书。</p>\n<h2 id=\"nginx配置修改\"><a href=\"#nginx配置修改\" class=\"headerlink\" title=\"nginx配置修改\"></a>nginx配置修改</h2><p>下载SSL证书，上传到服务器<code>/etc/pki/nginx/</code>目录下。</p>\n<p>修改<code>/etc/</code>配置文件，注意SSL证书的路径和实际上传的路径和名称一致。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    # server &#123;</span><br><span class=\"line\">    #     listen       80 default_server;</span><br><span class=\"line\">    #     listen       [::]:80 default_server;</span><br><span class=\"line\">    #     server_name  www.holychan.ltd;</span><br><span class=\"line\">    #     root         /home/hexo;</span><br><span class=\"line\"></span><br><span class=\"line\">    #     # Load configuration files for the default server block.</span><br><span class=\"line\">    #     include /etc/nginx/default.d/*.conf;</span><br><span class=\"line\"></span><br><span class=\"line\">    #     location / &#123;</span><br><span class=\"line\">    #     &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    #     error_page 404 /404.html;</span><br><span class=\"line\">    #         location = /40x.html &#123;</span><br><span class=\"line\">    #     &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    #     error_page 500 502 503 504 /50x.html;</span><br><span class=\"line\">    #         location = /50x.html &#123;</span><br><span class=\"line\">    #     &#125;</span><br><span class=\"line\">    # &#125;</span><br><span class=\"line\">    # 以上的配置注释，使用下面的配置</span><br><span class=\"line\"></span><br><span class=\"line\">    # Settings for a TLS enabled server.</span><br><span class=\"line\"></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen       443 ssl http2 default_server;</span><br><span class=\"line\">        listen       [::]:443 ssl http2 default_server;</span><br><span class=\"line\">        server_name  www.holychan.ltd;</span><br><span class=\"line\">        root         /home/hexo;    # 根目录</span><br><span class=\"line\"></span><br><span class=\"line\">        ssl_certificate &quot;/etc/pki/nginx/1_holychan.ltd_bundle.crt&quot;;    # ssl证书路径</span><br><span class=\"line\">        ssl_certificate_key &quot;/etc/pki/nginx/2_holychan.ltd.key&quot;; # ssl证书密钥</span><br><span class=\"line\">        ssl_session_cache shared:SSL:1m;</span><br><span class=\"line\">        ssl_session_timeout  10m;</span><br><span class=\"line\">        ssl_ciphers PROFILE=SYSTEM;</span><br><span class=\"line\">        ssl_prefer_server_ciphers on;</span><br><span class=\"line\"></span><br><span class=\"line\">        # Load configuration files for the default server block.</span><br><span class=\"line\">        include /etc/nginx/default.d/*.conf;</span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        error_page 404 /404.html;</span><br><span class=\"line\">            location = /40x.html &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        error_page 500 502 503 504 /50x.html;</span><br><span class=\"line\">            location = /50x.html &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"HTTP基本原理","date":"2021-05-09T12:48:23.000Z","pic":null,"comments":1,"toc":true,"only":["home","category","tag"],"_content":"\n\n## URI和URL\n\n`URI （Uniform Resource Identifier）` 即**统一资源标志符**。\n`URL （Uniform Resource Locator` 即**统一资源定位符**。\n\n例如：\n`https://github.com/favicon.ico`既是一个URL，也是一个URI。用URL/URI来唯一指定了它的访问方式，这其中包括了访问协议Https，访问路径（即根目录）和资源名称`favicon.ico`。\n\nURL是URI的一个子集，也就是每个URL都是URI，但不是每个URI都是URL。\n\nURI还包括一个子类叫做URN（Universal Resource Name）即统一资源名称。但是在目前的互联网，URN的使用非常少，几乎所有的 URI都是URL，所以一般的网页链接我们可以称之为 URL，也可以称之为 URI。\n\n## 超文本\n\n`Hypertext`，我们在浏览器里看到的网页就是超文本解析而成的，其网页源代码是一系列 HTML代码，里面包含了一系列标签，比如`img`显示图片，`p`指定显示段落等。浏览器解析这些标签后，便形成了我们平常看到的网页，而网页的源代码`HTML`就可以称作超文本。\n\n## HTTP和HTTPS\n\n`HTTP`的全称是Hyper Text Transfer Protocol，中文名叫作**超文本传输协议**，HTTP协议是用于从网络传输超文本数据到本地浏览器的传送协议，它能保证高效而准确地传送超文本文档。HTTP由万维网协会（World Wide Web Consortium）和Internet工作小组IETF（Internet EngineeringTask Force）共同合作制定的规范，目前广泛使用的是`HTTP 1.1`版本。\n\n`HTTPS`的全称是`Hyper Text Transfer Protocol over Secure Socket Layer`，是以安全为目标HTTP通道，简单讲是HTTP的安全版，即HTTP下加入`SSL`层，简称为`HTTPS`。\n\n`HTTPS`的安全基础是`SSL`，因此通过它传输的内容都是经过`SSL`加密的，它的主要作用可以分为两种：\n\n- 建立一个信息安全通道，来保证数据传输的安全。\n- 确认网站的真实性，凡是使用了HTTPS的网站，都可以通过点击浏览器地址栏的锁头标志来查看网站认证之后的真实信息，也可以通过`CA`机构颁发的安全签章来查询。\n  \n现在越来越多的网站和 App 都已经向 HTTPS 方向发展。例如：\n\n- 苹果公司强制所有 iOS App 在 2017 年 1 月 1 日 前全部改为使用 HTTPS 加密，否则 App 就无法在应用商店上架。\n- 谷歌从 2017 年 1 月推出的 Chrome 56 开始，对未进行 HTTPS 加密的网址链接亮出风险提示，即在地址栏的显著位置提醒用户 “此网页不安全”。\n- 腾讯微信小程序的官方需求文档要求后台使用 HTTPS 请求进行网络通信，不满足条件的域名和协议无法请求。\n  \n因此，HTTPS 已经已经是大势所趋。\n\n## HTTP请求过程\n\n我们在浏览器中输入一个URL，回车之后便可以在浏览器中观察到页面内容。实际上，这个过程是浏览器向网站所在的服务器发送了一个请求，网站服务器接收到这个请求后进行处理和解析，然后返回对应的**响应**，接着传回给浏览器。响应里包含了页面的源代码等内容，浏览器再对其进行解析，便将网页呈现了出来，传输模型如图所示：\n\n![传输模型](1.png)\n\n此处客户端即代表我们自己的 PC 或手机浏览器，服务器即要访问的网站所在的服务器。\n\n为了更直观地说明这个过程，这里用浏览器的开发者模式下的`Network监听组件`来做演示，它可以显示访问当前请求网页时发生的所有网络请求和响应。打开浏览器（Chrome或Edge都可以），右击并选择 “检查”项，即可打开浏览器的开发者工具。这里访问百度`http://www.baidu.com/`，输入该 URL后回车，观察这个过程中发生了怎样的网络请求。可以看到，在`Network`页面下方 出现了一个个的条目，其中一个条目就代表一次发送请求和接收响应的过程，如图所示:\n\n![Network监听](Screenshot_2.png)\n\n我们先观察第一个网络请求，即`www.baidu.com`，其中各列的含义如下。\n\n- 第一列 `Name：请求的名称`，一般会将 URL的最后一部分内容当作名称。\n- 第二列 `Status：响应的状态码`，这里显示为 `200`，代表响应是正常的。通过状态码，我们可以判断发送了请求之后是否得到了正常的响应。 \n- 第三列 `Type：请求的文档类型`。这里为`document`，代表我们这次请求的是一个 HTML文档，内容就是一些 HTML代码。\n- 第四列 `Initiator：请求源`。用来标记请求是由哪个对象或进程发起的。\n- 第五列 `Size：从服务器下载的文件和请求的资源大小`。如果是从缓存中取得的资源，则该列会显示 fromcache。\n- 第六列 `Time：发起请求到获取响应所用的总时间`。\n- 第七列 `Waterfall：网络请求的可视化瀑布流`。 我们点击这个条目即可看到其更详细的信息，如图所示。\n\n![详细信息](Screenshot_3.png)\n\n首先是`General`部分，`Request URL`为请求的URL，`Request Method`为请求的方法，`Status Code`为响应状态码，`Remote Address`为远程服务器的地址和端口，`Referrer Policy`为 Referrer判别策略。 \n\n再继续往下，可以看到，有`Response Headers`和`Request Headers`，这分别代表`响应头`和`请求头`。请求头里带有许多请求信息，例如`浏览器标识、Cookies、Host`等信息，这是请求的一部分，服务器会根据请求头内的信息判断请求是否合法，进而作出对应的响应。图中看到的`Response Headers`就是响应的一部分，例如其中包含了服务器的类型、文档类型、日期等信息，浏览器接受到响应后，会解析响应内容，进而呈现网页内容。\n\n## 请求\n\n**请求**，由客户端向服务端发出，可以分为4部分内容：`请求方法（Request Method`、`请求的网址（Request URL）`、`请求头（Request Headers）`、`请求体（Request Body）`。\n\n### 请求方法\n\n常见的请求方法有两种：`GET`和`POST`。 在浏览器中直接输入URL并回车，这便发起了一个`GET请求`，请求的参数会直接包含到URL里。例如，在百度中搜索Python，这就是一个GET请求，链接为`https://www.baidu.com/s?wd=Python`，其中URL中包 含了请求的参数信息，这里参数`wd`表示要搜寻的关键字。`POST请求`大多在表单提交时发起。比如，对于一个登录表单，输入用户名和密码后，点击“登录”按钮，这通常会发起一个`POST请求`，其数据通常 以表单的形式传输，而不会体现在URL中。\n\n`GET`和`POST`请求方法有如下区别。\n\n- `GET请求`中的参数包含在URL里面，数据可以在URL中看到，而`POST请求`的URL不会包含这些数据，数据都是通过表单形式传输的，会包含在请求体中。\n- `GET请求`提交的数据最多只有*1024字节*，而`POST请求`没有限制。 一般来说，登录时，需要提交用户名和密码，其中包含了敏感信息，使用`GET方式`请求的话，密码就会暴露在URL里面，造成密码泄露，所以这里最好以`POST方式`发送。上传文件时，由于文件内容比较大，也会选用`POST方式`。 我们平常遇到的绝大部分请求都是`GET`或`POST`请求，另外还有一些请求方法，如`HEAD`、`PUT`、`DELETE`、`OPTIONS`、`CONNECT`、`TRACE`等，我们简单将其总结为下表。\n\n| 方法 | 描述 |\n| :--- | :---- |\n| GET | 请求页面，并返回页面内容 |\n| HEAD | 类似于GET请求，只不过返回的响应中没有具体的内容，用于获取报头 |\n| POST | 大多用于表单提交或上传文件，数据包含在请求体中 |\n| PUT | 从客户端向服务器传送的数据取代指定文档中的内容 |\n| DELETE | 请求服务器删除指定的页面 |\n| CONNECT | 把服务器当作跳板，让服务器代替客户端访问其他网页 |\n| OPTIONS | 允许客户端查看服务器的性能 |\n| TRACE | 回显服务器收到的请求，主要用于测试或诊断 |\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 50%;\n    }\n</style>\n\n请求的网址，即统一资源定位符 URL，它可以唯一确定我们想请求的资源。\n\n### 请求头\n\n请求头，用来说明服务器要使用的附加信息，比较重要的信息有`Cookie`、`Referer`、`User-Agent`等。下面简要说明一些常用的头信息。\n\n- `Accept`：请求报头域，用于指定客户端可接受哪些类型的信息。\n- `Accept-Language`：指定客户端可接受的语言类型。\n- `Accept-Encoding`：指定客户端可接受的内容编码。\n- `Host`：用于指定请求资源的主机`IP`和端口号，其内容为请求URL的原始服务器或网关的位置。从 HTTP 1.1 版本开始，请求必须包含此内容。\n- `Cookie`：也常用复数形式`Cookies`，这是网站为了辨别用户进行会话跟踪而存储在用户本地的数据。它的主要功能是维持当前访问会话。例如，我们输入用户名和密码成功登录某个网站后，服务器会用会 话保存登录状态信息，后面我们每次刷新或请求该站点的其他页面时，会发现都是登录状态，这就是`Cookies`的功劳。`Cookies`里有信息标识了我们所对应的服务器的会话，每次浏览器在请求该站点的页 面时，都会在请求头中加上`Cookies`并将其发送给服务器，服务器通过`Cookies`识别出是我们自己，并且查出当前状态是登录状态，所以返回结果就是登录之后才能看到的网页内容。\n- `Referer`：此内容用来标识这个请求是从哪个页面发过来的，服务器可以拿到这一信息并做相应的处理，如做来源统计、防盗链处理等。\n- `User-Agent`：简称`UA`，它是一个特殊的字符串头，可以使服务器识别客户使用的操作系统及版本、浏览器及版本等信息。在做爬虫时加上此信息，可以伪装为浏览器；如果不加，很可能会被识别出为爬虫。\n- `Content-Type`：也叫互联网媒体类型`（Internet Media Type）`或者`MIME类型`，在`HTTP`协议消息头中，它用来表示具体请求中的媒体类型信息。例如，`text/html`代表`HTML`格式，`image/gif`代表`GIF`图片，`application/json`代表`JSON`类型，更多对应关系可以查看此对照表：`http://tool.oschina.net/commons`。\n\n因此，请求头是请求的重要组成部分，在写爬虫时，大部分情况下都需要设定请求头。\n\n### 请求体\n\n请请求体一般承载的内容是`POST`请求中的表单数据，而对于`GET`请求，请求体则为空。\n\n登录之前，我们填写了用户名和密码信息，提交时这些内容就会以表单数据的形式提交给服务器，此时需要注意`Request Headers`中指定`Content-Type`为`application/x-www-form-urlencoded`。只有设置`Content-Type`为`application/x-www-form-urlencoded`，才会以表单数据的形式提交。另外，我们也可以将`Content-Type`设置为`application/json`来提交`JSON`数据，或者设置为`multipart/form-data`来上传文件。 \n\n表格中列出了`Content-Type`和`POST`提交数据方式的关系。\n\n| Content-Type | 提交数据的方式 |\n| :--- | :---- |\n| application/x-www-form-urlencodeed | 表单数据 |\n| multipart/form-data | 表单文件上传 |\n| application/json | 序列化JSON数据 |\n| text/xml | XML数据 |\n\n在爬虫中，如果要构造`POST`请求，需要使用正确的`Content-Type`，并了解各种请求库的各个参数设置时使用的是哪种`Content-Type`，不然可能会导致`POST`提交后无法正常响应。\n\n## 响应\n\n响应，由服务端返回给客户端，可以分为三部分：`响应状态码（Response Status Code）`、`响应头（Response Headers）`和`响应体（Response Body）`。\n\n### 响应状态码\n\n响应状态码表示服务器的响应状态，如`200`代表服务器正常响应，`404`代表页面未找到，`500`代表服务器内部发生错误。在爬虫中，我们可以根据状态码来判断服务器响应状态，如状态码为`200`，则证明成功返 回数据，再进行进一步的处理，否则直接忽略。下表列出了常见的错误代码及错误原因。\n\n| 状态码 | 说明 | 详情 |\n| :---- | :---: | :----- |\n| 100 | 继续 | 请求者应当继续提出请求，服务器已收到请求的一部分，正在等待其余部分 |\n| 101 | 切换协议 | 请求者已要求服务器切换协议，服务器已确认并确认切换 |\n| 200 | 成功 | 服务器已成功处理了请求 |\n| 201 | 已创建 | 请求成功并且服务器创建了新的资源 |\n| 202 | 已接受 | 服务器已接受请求，但尚未处理 |\n| 203 | 非授权信息 | 服务器已经成功处理请求，但返回的信息可能来自另一个源 |\n| 204 | 无内容 | 服务器成功处理了请求，但没有返回任何内容 |\n| 205 | 重置内容 | 服务器成功处理了请求，但内容被重置 |\n| 206 | 部分内容 | 服务器成功处理了部分请求 |\n| 300 | 多种选择 | 针对请求，服务器可执行多种操作 |\n| 301 | 永久移动 | 请求的网页已永久移动到新位置，即永久重定向 |\n| 302 | 临时移动 | 请求的网页暂时跳转到其他页面，即暂时重定向 |\n| 303 | 查看其他位置 | 如果原来的请求是POST，重定向目标文档应当通过GET方式访问资源 |\n| 304 | 未修改 | 此次请求返回的网页未修改，继续使用上次的资源 |\n| 305 | 使用代理 | 请求者应该使用代理访问该网页 |\n| 307 | 临时重定向 | 请求的资源临时从其他位置响应 |\n| 400 | 错误请求 | 服务器无法解析该请求 |\n| 401 | 未授权 | 请求没有进行身份验证或验证未通过 |\n| 403 | 禁止访问 | 服务器拒绝此请求 |\n| 404 | 未找到 | 服务器找不到请求的网页 |\n| 405 | 方法禁用 | 服务器禁用了请求中指定的方法 |\n| 406 | 不接受 | 无法使用请求的内容响应请求的网页 |\n| 407 | 需要代理授权 | 请求者需要使用代理授权 |\n| 408 | 请求超时 | 服务器请求超时 |\n| 409 | 冲突 | 服务器在完成请求时发生冲突 |\n| 410 | 已删除 | 请求的资源已永久删除 |\n| 411 | 需要有效长度 | 服务器不接受不含有效内容长度标头字段的请求 |\n| 412 | 未满足前提条件 | 服务器未满足请求者在请求中设置的其中一个前提条件 |\n| 413 | 请求实体过大 | 请求实体过大，超出服务器的处理能力 |\n| 415 | 请求URL过长 | 请求的网址过长，服务器无法处理 |\n| 416 | 请求范围不符 | 页面无法提供请求页面支持 |\n| 417 | 未满足期望值 | 服务器为满足期望请求标头字段的要求 |\n| 500 | 服务器内部错误 | 服务器遇到错误，无法完成请求 |\n| 501 | 未实现 | 服务器不具备完成请求的功能 |\n| 502 | 错误网关 | 服务器作为网关或代理，从上游服务器收到无效响应 |\n| 503 | 服务不可用 | 服务器目前无法使用 |\n| 504 | 网关超时 | 服务器作为网关或代理，但是没有及时从上游服务器收到响应 |\n| 505 | HTTP版本不支持 | 服务器不支持请求中所用的HTTP协议版本 |\n\n响应头包含了服务器对请求的应答信息，如`Content-Type`、`Server`、`Set-Cookie`等。下面简要说明一些常用的响应头信息。 \n\n- `Date`：标识响应产生的时间。\n- `Last-Modified`：指定资源的最后修改时间。\n- `Content-Encoding`：指定响应内容的编码。\n- `Server`：包含服务器的信息，比如名称、版本号等。\n- `Content-Type`：文档类型，指定返回的数据类型是什么，如`text/html`代表返回`HTML`文档，`application/x-javascript`则代表返回`JavaScript`文件，`image/jpeg`则代表返回图片。\n- `Set-Cookie`：设置`Cookies`。响应头中的`Set-Cookie`告诉浏览器需要将此内容放在`Cookies`中，下次请求携带`Cookies`请求。\n- `Expires`：指定响应的过期时间，可以使代理服务器或浏览器将加载的内容更新到缓存中。如果再次访问时，就可以直接从缓存中加载，降低服务器负载，缩短加载时间。\n\n### 响应体\n\n最重要的当属响应体的内容了。响应的正文数据都在响应体中，比如请求网页时，它的响应体就是网页的`HTML`代码；请求一张图片时，它的响应体就是图片的二进制数据。我们做爬虫请求网页后，要解析的内容就是响应体，如图所示。\n\n![响应体](Screenshot_1.png)\n\n在浏览器开发者工具中点击`Response`，就可以看到网页的源代码，也就是响应体的内容，它是解析的目标。在做爬虫时，我们主要通过响应体得到网页的源代码、`JSON`数据等，然后从中做相应内容的提取。\n","source":"_posts/HTTP基本原理.md","raw":"---\ntitle: HTTP基本原理\ndate: 2021-05-09 20:48:23\ncategories: 爬虫\ntags:\n- http\n# sticky: 100\npic:\ncomments: true\ntoc: true\nonly:\n- home\n- category\n- tag\n---\n\n\n## URI和URL\n\n`URI （Uniform Resource Identifier）` 即**统一资源标志符**。\n`URL （Uniform Resource Locator` 即**统一资源定位符**。\n\n例如：\n`https://github.com/favicon.ico`既是一个URL，也是一个URI。用URL/URI来唯一指定了它的访问方式，这其中包括了访问协议Https，访问路径（即根目录）和资源名称`favicon.ico`。\n\nURL是URI的一个子集，也就是每个URL都是URI，但不是每个URI都是URL。\n\nURI还包括一个子类叫做URN（Universal Resource Name）即统一资源名称。但是在目前的互联网，URN的使用非常少，几乎所有的 URI都是URL，所以一般的网页链接我们可以称之为 URL，也可以称之为 URI。\n\n## 超文本\n\n`Hypertext`，我们在浏览器里看到的网页就是超文本解析而成的，其网页源代码是一系列 HTML代码，里面包含了一系列标签，比如`img`显示图片，`p`指定显示段落等。浏览器解析这些标签后，便形成了我们平常看到的网页，而网页的源代码`HTML`就可以称作超文本。\n\n## HTTP和HTTPS\n\n`HTTP`的全称是Hyper Text Transfer Protocol，中文名叫作**超文本传输协议**，HTTP协议是用于从网络传输超文本数据到本地浏览器的传送协议，它能保证高效而准确地传送超文本文档。HTTP由万维网协会（World Wide Web Consortium）和Internet工作小组IETF（Internet EngineeringTask Force）共同合作制定的规范，目前广泛使用的是`HTTP 1.1`版本。\n\n`HTTPS`的全称是`Hyper Text Transfer Protocol over Secure Socket Layer`，是以安全为目标HTTP通道，简单讲是HTTP的安全版，即HTTP下加入`SSL`层，简称为`HTTPS`。\n\n`HTTPS`的安全基础是`SSL`，因此通过它传输的内容都是经过`SSL`加密的，它的主要作用可以分为两种：\n\n- 建立一个信息安全通道，来保证数据传输的安全。\n- 确认网站的真实性，凡是使用了HTTPS的网站，都可以通过点击浏览器地址栏的锁头标志来查看网站认证之后的真实信息，也可以通过`CA`机构颁发的安全签章来查询。\n  \n现在越来越多的网站和 App 都已经向 HTTPS 方向发展。例如：\n\n- 苹果公司强制所有 iOS App 在 2017 年 1 月 1 日 前全部改为使用 HTTPS 加密，否则 App 就无法在应用商店上架。\n- 谷歌从 2017 年 1 月推出的 Chrome 56 开始，对未进行 HTTPS 加密的网址链接亮出风险提示，即在地址栏的显著位置提醒用户 “此网页不安全”。\n- 腾讯微信小程序的官方需求文档要求后台使用 HTTPS 请求进行网络通信，不满足条件的域名和协议无法请求。\n  \n因此，HTTPS 已经已经是大势所趋。\n\n## HTTP请求过程\n\n我们在浏览器中输入一个URL，回车之后便可以在浏览器中观察到页面内容。实际上，这个过程是浏览器向网站所在的服务器发送了一个请求，网站服务器接收到这个请求后进行处理和解析，然后返回对应的**响应**，接着传回给浏览器。响应里包含了页面的源代码等内容，浏览器再对其进行解析，便将网页呈现了出来，传输模型如图所示：\n\n![传输模型](1.png)\n\n此处客户端即代表我们自己的 PC 或手机浏览器，服务器即要访问的网站所在的服务器。\n\n为了更直观地说明这个过程，这里用浏览器的开发者模式下的`Network监听组件`来做演示，它可以显示访问当前请求网页时发生的所有网络请求和响应。打开浏览器（Chrome或Edge都可以），右击并选择 “检查”项，即可打开浏览器的开发者工具。这里访问百度`http://www.baidu.com/`，输入该 URL后回车，观察这个过程中发生了怎样的网络请求。可以看到，在`Network`页面下方 出现了一个个的条目，其中一个条目就代表一次发送请求和接收响应的过程，如图所示:\n\n![Network监听](Screenshot_2.png)\n\n我们先观察第一个网络请求，即`www.baidu.com`，其中各列的含义如下。\n\n- 第一列 `Name：请求的名称`，一般会将 URL的最后一部分内容当作名称。\n- 第二列 `Status：响应的状态码`，这里显示为 `200`，代表响应是正常的。通过状态码，我们可以判断发送了请求之后是否得到了正常的响应。 \n- 第三列 `Type：请求的文档类型`。这里为`document`，代表我们这次请求的是一个 HTML文档，内容就是一些 HTML代码。\n- 第四列 `Initiator：请求源`。用来标记请求是由哪个对象或进程发起的。\n- 第五列 `Size：从服务器下载的文件和请求的资源大小`。如果是从缓存中取得的资源，则该列会显示 fromcache。\n- 第六列 `Time：发起请求到获取响应所用的总时间`。\n- 第七列 `Waterfall：网络请求的可视化瀑布流`。 我们点击这个条目即可看到其更详细的信息，如图所示。\n\n![详细信息](Screenshot_3.png)\n\n首先是`General`部分，`Request URL`为请求的URL，`Request Method`为请求的方法，`Status Code`为响应状态码，`Remote Address`为远程服务器的地址和端口，`Referrer Policy`为 Referrer判别策略。 \n\n再继续往下，可以看到，有`Response Headers`和`Request Headers`，这分别代表`响应头`和`请求头`。请求头里带有许多请求信息，例如`浏览器标识、Cookies、Host`等信息，这是请求的一部分，服务器会根据请求头内的信息判断请求是否合法，进而作出对应的响应。图中看到的`Response Headers`就是响应的一部分，例如其中包含了服务器的类型、文档类型、日期等信息，浏览器接受到响应后，会解析响应内容，进而呈现网页内容。\n\n## 请求\n\n**请求**，由客户端向服务端发出，可以分为4部分内容：`请求方法（Request Method`、`请求的网址（Request URL）`、`请求头（Request Headers）`、`请求体（Request Body）`。\n\n### 请求方法\n\n常见的请求方法有两种：`GET`和`POST`。 在浏览器中直接输入URL并回车，这便发起了一个`GET请求`，请求的参数会直接包含到URL里。例如，在百度中搜索Python，这就是一个GET请求，链接为`https://www.baidu.com/s?wd=Python`，其中URL中包 含了请求的参数信息，这里参数`wd`表示要搜寻的关键字。`POST请求`大多在表单提交时发起。比如，对于一个登录表单，输入用户名和密码后，点击“登录”按钮，这通常会发起一个`POST请求`，其数据通常 以表单的形式传输，而不会体现在URL中。\n\n`GET`和`POST`请求方法有如下区别。\n\n- `GET请求`中的参数包含在URL里面，数据可以在URL中看到，而`POST请求`的URL不会包含这些数据，数据都是通过表单形式传输的，会包含在请求体中。\n- `GET请求`提交的数据最多只有*1024字节*，而`POST请求`没有限制。 一般来说，登录时，需要提交用户名和密码，其中包含了敏感信息，使用`GET方式`请求的话，密码就会暴露在URL里面，造成密码泄露，所以这里最好以`POST方式`发送。上传文件时，由于文件内容比较大，也会选用`POST方式`。 我们平常遇到的绝大部分请求都是`GET`或`POST`请求，另外还有一些请求方法，如`HEAD`、`PUT`、`DELETE`、`OPTIONS`、`CONNECT`、`TRACE`等，我们简单将其总结为下表。\n\n| 方法 | 描述 |\n| :--- | :---- |\n| GET | 请求页面，并返回页面内容 |\n| HEAD | 类似于GET请求，只不过返回的响应中没有具体的内容，用于获取报头 |\n| POST | 大多用于表单提交或上传文件，数据包含在请求体中 |\n| PUT | 从客户端向服务器传送的数据取代指定文档中的内容 |\n| DELETE | 请求服务器删除指定的页面 |\n| CONNECT | 把服务器当作跳板，让服务器代替客户端访问其他网页 |\n| OPTIONS | 允许客户端查看服务器的性能 |\n| TRACE | 回显服务器收到的请求，主要用于测试或诊断 |\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 50%;\n    }\n</style>\n\n请求的网址，即统一资源定位符 URL，它可以唯一确定我们想请求的资源。\n\n### 请求头\n\n请求头，用来说明服务器要使用的附加信息，比较重要的信息有`Cookie`、`Referer`、`User-Agent`等。下面简要说明一些常用的头信息。\n\n- `Accept`：请求报头域，用于指定客户端可接受哪些类型的信息。\n- `Accept-Language`：指定客户端可接受的语言类型。\n- `Accept-Encoding`：指定客户端可接受的内容编码。\n- `Host`：用于指定请求资源的主机`IP`和端口号，其内容为请求URL的原始服务器或网关的位置。从 HTTP 1.1 版本开始，请求必须包含此内容。\n- `Cookie`：也常用复数形式`Cookies`，这是网站为了辨别用户进行会话跟踪而存储在用户本地的数据。它的主要功能是维持当前访问会话。例如，我们输入用户名和密码成功登录某个网站后，服务器会用会 话保存登录状态信息，后面我们每次刷新或请求该站点的其他页面时，会发现都是登录状态，这就是`Cookies`的功劳。`Cookies`里有信息标识了我们所对应的服务器的会话，每次浏览器在请求该站点的页 面时，都会在请求头中加上`Cookies`并将其发送给服务器，服务器通过`Cookies`识别出是我们自己，并且查出当前状态是登录状态，所以返回结果就是登录之后才能看到的网页内容。\n- `Referer`：此内容用来标识这个请求是从哪个页面发过来的，服务器可以拿到这一信息并做相应的处理，如做来源统计、防盗链处理等。\n- `User-Agent`：简称`UA`，它是一个特殊的字符串头，可以使服务器识别客户使用的操作系统及版本、浏览器及版本等信息。在做爬虫时加上此信息，可以伪装为浏览器；如果不加，很可能会被识别出为爬虫。\n- `Content-Type`：也叫互联网媒体类型`（Internet Media Type）`或者`MIME类型`，在`HTTP`协议消息头中，它用来表示具体请求中的媒体类型信息。例如，`text/html`代表`HTML`格式，`image/gif`代表`GIF`图片，`application/json`代表`JSON`类型，更多对应关系可以查看此对照表：`http://tool.oschina.net/commons`。\n\n因此，请求头是请求的重要组成部分，在写爬虫时，大部分情况下都需要设定请求头。\n\n### 请求体\n\n请请求体一般承载的内容是`POST`请求中的表单数据，而对于`GET`请求，请求体则为空。\n\n登录之前，我们填写了用户名和密码信息，提交时这些内容就会以表单数据的形式提交给服务器，此时需要注意`Request Headers`中指定`Content-Type`为`application/x-www-form-urlencoded`。只有设置`Content-Type`为`application/x-www-form-urlencoded`，才会以表单数据的形式提交。另外，我们也可以将`Content-Type`设置为`application/json`来提交`JSON`数据，或者设置为`multipart/form-data`来上传文件。 \n\n表格中列出了`Content-Type`和`POST`提交数据方式的关系。\n\n| Content-Type | 提交数据的方式 |\n| :--- | :---- |\n| application/x-www-form-urlencodeed | 表单数据 |\n| multipart/form-data | 表单文件上传 |\n| application/json | 序列化JSON数据 |\n| text/xml | XML数据 |\n\n在爬虫中，如果要构造`POST`请求，需要使用正确的`Content-Type`，并了解各种请求库的各个参数设置时使用的是哪种`Content-Type`，不然可能会导致`POST`提交后无法正常响应。\n\n## 响应\n\n响应，由服务端返回给客户端，可以分为三部分：`响应状态码（Response Status Code）`、`响应头（Response Headers）`和`响应体（Response Body）`。\n\n### 响应状态码\n\n响应状态码表示服务器的响应状态，如`200`代表服务器正常响应，`404`代表页面未找到，`500`代表服务器内部发生错误。在爬虫中，我们可以根据状态码来判断服务器响应状态，如状态码为`200`，则证明成功返 回数据，再进行进一步的处理，否则直接忽略。下表列出了常见的错误代码及错误原因。\n\n| 状态码 | 说明 | 详情 |\n| :---- | :---: | :----- |\n| 100 | 继续 | 请求者应当继续提出请求，服务器已收到请求的一部分，正在等待其余部分 |\n| 101 | 切换协议 | 请求者已要求服务器切换协议，服务器已确认并确认切换 |\n| 200 | 成功 | 服务器已成功处理了请求 |\n| 201 | 已创建 | 请求成功并且服务器创建了新的资源 |\n| 202 | 已接受 | 服务器已接受请求，但尚未处理 |\n| 203 | 非授权信息 | 服务器已经成功处理请求，但返回的信息可能来自另一个源 |\n| 204 | 无内容 | 服务器成功处理了请求，但没有返回任何内容 |\n| 205 | 重置内容 | 服务器成功处理了请求，但内容被重置 |\n| 206 | 部分内容 | 服务器成功处理了部分请求 |\n| 300 | 多种选择 | 针对请求，服务器可执行多种操作 |\n| 301 | 永久移动 | 请求的网页已永久移动到新位置，即永久重定向 |\n| 302 | 临时移动 | 请求的网页暂时跳转到其他页面，即暂时重定向 |\n| 303 | 查看其他位置 | 如果原来的请求是POST，重定向目标文档应当通过GET方式访问资源 |\n| 304 | 未修改 | 此次请求返回的网页未修改，继续使用上次的资源 |\n| 305 | 使用代理 | 请求者应该使用代理访问该网页 |\n| 307 | 临时重定向 | 请求的资源临时从其他位置响应 |\n| 400 | 错误请求 | 服务器无法解析该请求 |\n| 401 | 未授权 | 请求没有进行身份验证或验证未通过 |\n| 403 | 禁止访问 | 服务器拒绝此请求 |\n| 404 | 未找到 | 服务器找不到请求的网页 |\n| 405 | 方法禁用 | 服务器禁用了请求中指定的方法 |\n| 406 | 不接受 | 无法使用请求的内容响应请求的网页 |\n| 407 | 需要代理授权 | 请求者需要使用代理授权 |\n| 408 | 请求超时 | 服务器请求超时 |\n| 409 | 冲突 | 服务器在完成请求时发生冲突 |\n| 410 | 已删除 | 请求的资源已永久删除 |\n| 411 | 需要有效长度 | 服务器不接受不含有效内容长度标头字段的请求 |\n| 412 | 未满足前提条件 | 服务器未满足请求者在请求中设置的其中一个前提条件 |\n| 413 | 请求实体过大 | 请求实体过大，超出服务器的处理能力 |\n| 415 | 请求URL过长 | 请求的网址过长，服务器无法处理 |\n| 416 | 请求范围不符 | 页面无法提供请求页面支持 |\n| 417 | 未满足期望值 | 服务器为满足期望请求标头字段的要求 |\n| 500 | 服务器内部错误 | 服务器遇到错误，无法完成请求 |\n| 501 | 未实现 | 服务器不具备完成请求的功能 |\n| 502 | 错误网关 | 服务器作为网关或代理，从上游服务器收到无效响应 |\n| 503 | 服务不可用 | 服务器目前无法使用 |\n| 504 | 网关超时 | 服务器作为网关或代理，但是没有及时从上游服务器收到响应 |\n| 505 | HTTP版本不支持 | 服务器不支持请求中所用的HTTP协议版本 |\n\n响应头包含了服务器对请求的应答信息，如`Content-Type`、`Server`、`Set-Cookie`等。下面简要说明一些常用的响应头信息。 \n\n- `Date`：标识响应产生的时间。\n- `Last-Modified`：指定资源的最后修改时间。\n- `Content-Encoding`：指定响应内容的编码。\n- `Server`：包含服务器的信息，比如名称、版本号等。\n- `Content-Type`：文档类型，指定返回的数据类型是什么，如`text/html`代表返回`HTML`文档，`application/x-javascript`则代表返回`JavaScript`文件，`image/jpeg`则代表返回图片。\n- `Set-Cookie`：设置`Cookies`。响应头中的`Set-Cookie`告诉浏览器需要将此内容放在`Cookies`中，下次请求携带`Cookies`请求。\n- `Expires`：指定响应的过期时间，可以使代理服务器或浏览器将加载的内容更新到缓存中。如果再次访问时，就可以直接从缓存中加载，降低服务器负载，缩短加载时间。\n\n### 响应体\n\n最重要的当属响应体的内容了。响应的正文数据都在响应体中，比如请求网页时，它的响应体就是网页的`HTML`代码；请求一张图片时，它的响应体就是图片的二进制数据。我们做爬虫请求网页后，要解析的内容就是响应体，如图所示。\n\n![响应体](Screenshot_1.png)\n\n在浏览器开发者工具中点击`Response`，就可以看到网页的源代码，也就是响应体的内容，它是解析的目标。在做爬虫时，我们主要通过响应体得到网页的源代码、`JSON`数据等，然后从中做相应内容的提取。\n","slug":"HTTP基本原理","published":1,"updated":"2021-06-15T03:24:11.442Z","layout":"post","photos":[],"link":"","_id":"ckq14rx3t007144ud8eh11ttk","content":"<h2 id=\"URI和URL\"><a href=\"#URI和URL\" class=\"headerlink\" title=\"URI和URL\"></a>URI和URL</h2><p><code>URI （Uniform Resource Identifier）</code> 即<strong>统一资源标志符</strong>。<br><code>URL （Uniform Resource Locator</code> 即<strong>统一资源定位符</strong>。</p>\n<p>例如：<br><code>https://github.com/favicon.ico</code>既是一个URL，也是一个URI。用URL/URI来唯一指定了它的访问方式，这其中包括了访问协议Https，访问路径（即根目录）和资源名称<code>favicon.ico</code>。</p>\n<p>URL是URI的一个子集，也就是每个URL都是URI，但不是每个URI都是URL。</p>\n<p>URI还包括一个子类叫做URN（Universal Resource Name）即统一资源名称。但是在目前的互联网，URN的使用非常少，几乎所有的 URI都是URL，所以一般的网页链接我们可以称之为 URL，也可以称之为 URI。</p>\n<h2 id=\"超文本\"><a href=\"#超文本\" class=\"headerlink\" title=\"超文本\"></a>超文本</h2><p><code>Hypertext</code>，我们在浏览器里看到的网页就是超文本解析而成的，其网页源代码是一系列 HTML代码，里面包含了一系列标签，比如<code>img</code>显示图片，<code>p</code>指定显示段落等。浏览器解析这些标签后，便形成了我们平常看到的网页，而网页的源代码<code>HTML</code>就可以称作超文本。</p>\n<h2 id=\"HTTP和HTTPS\"><a href=\"#HTTP和HTTPS\" class=\"headerlink\" title=\"HTTP和HTTPS\"></a>HTTP和HTTPS</h2><p><code>HTTP</code>的全称是Hyper Text Transfer Protocol，中文名叫作<strong>超文本传输协议</strong>，HTTP协议是用于从网络传输超文本数据到本地浏览器的传送协议，它能保证高效而准确地传送超文本文档。HTTP由万维网协会（World Wide Web Consortium）和Internet工作小组IETF（Internet EngineeringTask Force）共同合作制定的规范，目前广泛使用的是<code>HTTP 1.1</code>版本。</p>\n<p><code>HTTPS</code>的全称是<code>Hyper Text Transfer Protocol over Secure Socket Layer</code>，是以安全为目标HTTP通道，简单讲是HTTP的安全版，即HTTP下加入<code>SSL</code>层，简称为<code>HTTPS</code>。</p>\n<p><code>HTTPS</code>的安全基础是<code>SSL</code>，因此通过它传输的内容都是经过<code>SSL</code>加密的，它的主要作用可以分为两种：</p>\n<ul>\n<li>建立一个信息安全通道，来保证数据传输的安全。</li>\n<li>确认网站的真实性，凡是使用了HTTPS的网站，都可以通过点击浏览器地址栏的锁头标志来查看网站认证之后的真实信息，也可以通过<code>CA</code>机构颁发的安全签章来查询。</li>\n</ul>\n<p>现在越来越多的网站和 App 都已经向 HTTPS 方向发展。例如：</p>\n<ul>\n<li>苹果公司强制所有 iOS App 在 2017 年 1 月 1 日 前全部改为使用 HTTPS 加密，否则 App 就无法在应用商店上架。</li>\n<li>谷歌从 2017 年 1 月推出的 Chrome 56 开始，对未进行 HTTPS 加密的网址链接亮出风险提示，即在地址栏的显著位置提醒用户 “此网页不安全”。</li>\n<li>腾讯微信小程序的官方需求文档要求后台使用 HTTPS 请求进行网络通信，不满足条件的域名和协议无法请求。</li>\n</ul>\n<p>因此，HTTPS 已经已经是大势所趋。</p>\n<h2 id=\"HTTP请求过程\"><a href=\"#HTTP请求过程\" class=\"headerlink\" title=\"HTTP请求过程\"></a>HTTP请求过程</h2><p>我们在浏览器中输入一个URL，回车之后便可以在浏览器中观察到页面内容。实际上，这个过程是浏览器向网站所在的服务器发送了一个请求，网站服务器接收到这个请求后进行处理和解析，然后返回对应的<strong>响应</strong>，接着传回给浏览器。响应里包含了页面的源代码等内容，浏览器再对其进行解析，便将网页呈现了出来，传输模型如图所示：</p>\n<p><img src=\"1.png\" alt=\"传输模型\"></p>\n<p>此处客户端即代表我们自己的 PC 或手机浏览器，服务器即要访问的网站所在的服务器。</p>\n<p>为了更直观地说明这个过程，这里用浏览器的开发者模式下的<code>Network监听组件</code>来做演示，它可以显示访问当前请求网页时发生的所有网络请求和响应。打开浏览器（Chrome或Edge都可以），右击并选择 “检查”项，即可打开浏览器的开发者工具。这里访问百度<code>http://www.baidu.com/</code>，输入该 URL后回车，观察这个过程中发生了怎样的网络请求。可以看到，在<code>Network</code>页面下方 出现了一个个的条目，其中一个条目就代表一次发送请求和接收响应的过程，如图所示:</p>\n<p><img src=\"Screenshot_2.png\" alt=\"Network监听\"></p>\n<p>我们先观察第一个网络请求，即<code>www.baidu.com</code>，其中各列的含义如下。</p>\n<ul>\n<li>第一列 <code>Name：请求的名称</code>，一般会将 URL的最后一部分内容当作名称。</li>\n<li>第二列 <code>Status：响应的状态码</code>，这里显示为 <code>200</code>，代表响应是正常的。通过状态码，我们可以判断发送了请求之后是否得到了正常的响应。 </li>\n<li>第三列 <code>Type：请求的文档类型</code>。这里为<code>document</code>，代表我们这次请求的是一个 HTML文档，内容就是一些 HTML代码。</li>\n<li>第四列 <code>Initiator：请求源</code>。用来标记请求是由哪个对象或进程发起的。</li>\n<li>第五列 <code>Size：从服务器下载的文件和请求的资源大小</code>。如果是从缓存中取得的资源，则该列会显示 fromcache。</li>\n<li>第六列 <code>Time：发起请求到获取响应所用的总时间</code>。</li>\n<li>第七列 <code>Waterfall：网络请求的可视化瀑布流</code>。 我们点击这个条目即可看到其更详细的信息，如图所示。</li>\n</ul>\n<p><img src=\"Screenshot_3.png\" alt=\"详细信息\"></p>\n<p>首先是<code>General</code>部分，<code>Request URL</code>为请求的URL，<code>Request Method</code>为请求的方法，<code>Status Code</code>为响应状态码，<code>Remote Address</code>为远程服务器的地址和端口，<code>Referrer Policy</code>为 Referrer判别策略。 </p>\n<p>再继续往下，可以看到，有<code>Response Headers</code>和<code>Request Headers</code>，这分别代表<code>响应头</code>和<code>请求头</code>。请求头里带有许多请求信息，例如<code>浏览器标识、Cookies、Host</code>等信息，这是请求的一部分，服务器会根据请求头内的信息判断请求是否合法，进而作出对应的响应。图中看到的<code>Response Headers</code>就是响应的一部分，例如其中包含了服务器的类型、文档类型、日期等信息，浏览器接受到响应后，会解析响应内容，进而呈现网页内容。</p>\n<h2 id=\"请求\"><a href=\"#请求\" class=\"headerlink\" title=\"请求\"></a>请求</h2><p><strong>请求</strong>，由客户端向服务端发出，可以分为4部分内容：<code>请求方法（Request Method</code>、<code>请求的网址（Request URL）</code>、<code>请求头（Request Headers）</code>、<code>请求体（Request Body）</code>。</p>\n<h3 id=\"请求方法\"><a href=\"#请求方法\" class=\"headerlink\" title=\"请求方法\"></a>请求方法</h3><p>常见的请求方法有两种：<code>GET</code>和<code>POST</code>。 在浏览器中直接输入URL并回车，这便发起了一个<code>GET请求</code>，请求的参数会直接包含到URL里。例如，在百度中搜索Python，这就是一个GET请求，链接为<code>https://www.baidu.com/s?wd=Python</code>，其中URL中包 含了请求的参数信息，这里参数<code>wd</code>表示要搜寻的关键字。<code>POST请求</code>大多在表单提交时发起。比如，对于一个登录表单，输入用户名和密码后，点击“登录”按钮，这通常会发起一个<code>POST请求</code>，其数据通常 以表单的形式传输，而不会体现在URL中。</p>\n<p><code>GET</code>和<code>POST</code>请求方法有如下区别。</p>\n<ul>\n<li><code>GET请求</code>中的参数包含在URL里面，数据可以在URL中看到，而<code>POST请求</code>的URL不会包含这些数据，数据都是通过表单形式传输的，会包含在请求体中。</li>\n<li><code>GET请求</code>提交的数据最多只有<em>1024字节</em>，而<code>POST请求</code>没有限制。 一般来说，登录时，需要提交用户名和密码，其中包含了敏感信息，使用<code>GET方式</code>请求的话，密码就会暴露在URL里面，造成密码泄露，所以这里最好以<code>POST方式</code>发送。上传文件时，由于文件内容比较大，也会选用<code>POST方式</code>。 我们平常遇到的绝大部分请求都是<code>GET</code>或<code>POST</code>请求，另外还有一些请求方法，如<code>HEAD</code>、<code>PUT</code>、<code>DELETE</code>、<code>OPTIONS</code>、<code>CONNECT</code>、<code>TRACE</code>等，我们简单将其总结为下表。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">GET</td>\n<td align=\"left\">请求页面，并返回页面内容</td>\n</tr>\n<tr>\n<td align=\"left\">HEAD</td>\n<td align=\"left\">类似于GET请求，只不过返回的响应中没有具体的内容，用于获取报头</td>\n</tr>\n<tr>\n<td align=\"left\">POST</td>\n<td align=\"left\">大多用于表单提交或上传文件，数据包含在请求体中</td>\n</tr>\n<tr>\n<td align=\"left\">PUT</td>\n<td align=\"left\">从客户端向服务器传送的数据取代指定文档中的内容</td>\n</tr>\n<tr>\n<td align=\"left\">DELETE</td>\n<td align=\"left\">请求服务器删除指定的页面</td>\n</tr>\n<tr>\n<td align=\"left\">CONNECT</td>\n<td align=\"left\">把服务器当作跳板，让服务器代替客户端访问其他网页</td>\n</tr>\n<tr>\n<td align=\"left\">OPTIONS</td>\n<td align=\"left\">允许客户端查看服务器的性能</td>\n</tr>\n<tr>\n<td align=\"left\">TRACE</td>\n<td align=\"left\">回显服务器收到的请求，主要用于测试或诊断</td>\n</tr>\n</tbody></table>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 50%;\n    }\n</style>\n\n<p>请求的网址，即统一资源定位符 URL，它可以唯一确定我们想请求的资源。</p>\n<h3 id=\"请求头\"><a href=\"#请求头\" class=\"headerlink\" title=\"请求头\"></a>请求头</h3><p>请求头，用来说明服务器要使用的附加信息，比较重要的信息有<code>Cookie</code>、<code>Referer</code>、<code>User-Agent</code>等。下面简要说明一些常用的头信息。</p>\n<ul>\n<li><code>Accept</code>：请求报头域，用于指定客户端可接受哪些类型的信息。</li>\n<li><code>Accept-Language</code>：指定客户端可接受的语言类型。</li>\n<li><code>Accept-Encoding</code>：指定客户端可接受的内容编码。</li>\n<li><code>Host</code>：用于指定请求资源的主机<code>IP</code>和端口号，其内容为请求URL的原始服务器或网关的位置。从 HTTP 1.1 版本开始，请求必须包含此内容。</li>\n<li><code>Cookie</code>：也常用复数形式<code>Cookies</code>，这是网站为了辨别用户进行会话跟踪而存储在用户本地的数据。它的主要功能是维持当前访问会话。例如，我们输入用户名和密码成功登录某个网站后，服务器会用会 话保存登录状态信息，后面我们每次刷新或请求该站点的其他页面时，会发现都是登录状态，这就是<code>Cookies</code>的功劳。<code>Cookies</code>里有信息标识了我们所对应的服务器的会话，每次浏览器在请求该站点的页 面时，都会在请求头中加上<code>Cookies</code>并将其发送给服务器，服务器通过<code>Cookies</code>识别出是我们自己，并且查出当前状态是登录状态，所以返回结果就是登录之后才能看到的网页内容。</li>\n<li><code>Referer</code>：此内容用来标识这个请求是从哪个页面发过来的，服务器可以拿到这一信息并做相应的处理，如做来源统计、防盗链处理等。</li>\n<li><code>User-Agent</code>：简称<code>UA</code>，它是一个特殊的字符串头，可以使服务器识别客户使用的操作系统及版本、浏览器及版本等信息。在做爬虫时加上此信息，可以伪装为浏览器；如果不加，很可能会被识别出为爬虫。</li>\n<li><code>Content-Type</code>：也叫互联网媒体类型<code>（Internet Media Type）</code>或者<code>MIME类型</code>，在<code>HTTP</code>协议消息头中，它用来表示具体请求中的媒体类型信息。例如，<code>text/html</code>代表<code>HTML</code>格式，<code>image/gif</code>代表<code>GIF</code>图片，<code>application/json</code>代表<code>JSON</code>类型，更多对应关系可以查看此对照表：<code>http://tool.oschina.net/commons</code>。</li>\n</ul>\n<p>因此，请求头是请求的重要组成部分，在写爬虫时，大部分情况下都需要设定请求头。</p>\n<h3 id=\"请求体\"><a href=\"#请求体\" class=\"headerlink\" title=\"请求体\"></a>请求体</h3><p>请请求体一般承载的内容是<code>POST</code>请求中的表单数据，而对于<code>GET</code>请求，请求体则为空。</p>\n<p>登录之前，我们填写了用户名和密码信息，提交时这些内容就会以表单数据的形式提交给服务器，此时需要注意<code>Request Headers</code>中指定<code>Content-Type</code>为<code>application/x-www-form-urlencoded</code>。只有设置<code>Content-Type</code>为<code>application/x-www-form-urlencoded</code>，才会以表单数据的形式提交。另外，我们也可以将<code>Content-Type</code>设置为<code>application/json</code>来提交<code>JSON</code>数据，或者设置为<code>multipart/form-data</code>来上传文件。 </p>\n<p>表格中列出了<code>Content-Type</code>和<code>POST</code>提交数据方式的关系。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">Content-Type</th>\n<th align=\"left\">提交数据的方式</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">application/x-www-form-urlencodeed</td>\n<td align=\"left\">表单数据</td>\n</tr>\n<tr>\n<td align=\"left\">multipart/form-data</td>\n<td align=\"left\">表单文件上传</td>\n</tr>\n<tr>\n<td align=\"left\">application/json</td>\n<td align=\"left\">序列化JSON数据</td>\n</tr>\n<tr>\n<td align=\"left\">text/xml</td>\n<td align=\"left\">XML数据</td>\n</tr>\n</tbody></table>\n<p>在爬虫中，如果要构造<code>POST</code>请求，需要使用正确的<code>Content-Type</code>，并了解各种请求库的各个参数设置时使用的是哪种<code>Content-Type</code>，不然可能会导致<code>POST</code>提交后无法正常响应。</p>\n<h2 id=\"响应\"><a href=\"#响应\" class=\"headerlink\" title=\"响应\"></a>响应</h2><p>响应，由服务端返回给客户端，可以分为三部分：<code>响应状态码（Response Status Code）</code>、<code>响应头（Response Headers）</code>和<code>响应体（Response Body）</code>。</p>\n<h3 id=\"响应状态码\"><a href=\"#响应状态码\" class=\"headerlink\" title=\"响应状态码\"></a>响应状态码</h3><p>响应状态码表示服务器的响应状态，如<code>200</code>代表服务器正常响应，<code>404</code>代表页面未找到，<code>500</code>代表服务器内部发生错误。在爬虫中，我们可以根据状态码来判断服务器响应状态，如状态码为<code>200</code>，则证明成功返 回数据，再进行进一步的处理，否则直接忽略。下表列出了常见的错误代码及错误原因。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">状态码</th>\n<th align=\"center\">说明</th>\n<th align=\"left\">详情</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">100</td>\n<td align=\"center\">继续</td>\n<td align=\"left\">请求者应当继续提出请求，服务器已收到请求的一部分，正在等待其余部分</td>\n</tr>\n<tr>\n<td align=\"left\">101</td>\n<td align=\"center\">切换协议</td>\n<td align=\"left\">请求者已要求服务器切换协议，服务器已确认并确认切换</td>\n</tr>\n<tr>\n<td align=\"left\">200</td>\n<td align=\"center\">成功</td>\n<td align=\"left\">服务器已成功处理了请求</td>\n</tr>\n<tr>\n<td align=\"left\">201</td>\n<td align=\"center\">已创建</td>\n<td align=\"left\">请求成功并且服务器创建了新的资源</td>\n</tr>\n<tr>\n<td align=\"left\">202</td>\n<td align=\"center\">已接受</td>\n<td align=\"left\">服务器已接受请求，但尚未处理</td>\n</tr>\n<tr>\n<td align=\"left\">203</td>\n<td align=\"center\">非授权信息</td>\n<td align=\"left\">服务器已经成功处理请求，但返回的信息可能来自另一个源</td>\n</tr>\n<tr>\n<td align=\"left\">204</td>\n<td align=\"center\">无内容</td>\n<td align=\"left\">服务器成功处理了请求，但没有返回任何内容</td>\n</tr>\n<tr>\n<td align=\"left\">205</td>\n<td align=\"center\">重置内容</td>\n<td align=\"left\">服务器成功处理了请求，但内容被重置</td>\n</tr>\n<tr>\n<td align=\"left\">206</td>\n<td align=\"center\">部分内容</td>\n<td align=\"left\">服务器成功处理了部分请求</td>\n</tr>\n<tr>\n<td align=\"left\">300</td>\n<td align=\"center\">多种选择</td>\n<td align=\"left\">针对请求，服务器可执行多种操作</td>\n</tr>\n<tr>\n<td align=\"left\">301</td>\n<td align=\"center\">永久移动</td>\n<td align=\"left\">请求的网页已永久移动到新位置，即永久重定向</td>\n</tr>\n<tr>\n<td align=\"left\">302</td>\n<td align=\"center\">临时移动</td>\n<td align=\"left\">请求的网页暂时跳转到其他页面，即暂时重定向</td>\n</tr>\n<tr>\n<td align=\"left\">303</td>\n<td align=\"center\">查看其他位置</td>\n<td align=\"left\">如果原来的请求是POST，重定向目标文档应当通过GET方式访问资源</td>\n</tr>\n<tr>\n<td align=\"left\">304</td>\n<td align=\"center\">未修改</td>\n<td align=\"left\">此次请求返回的网页未修改，继续使用上次的资源</td>\n</tr>\n<tr>\n<td align=\"left\">305</td>\n<td align=\"center\">使用代理</td>\n<td align=\"left\">请求者应该使用代理访问该网页</td>\n</tr>\n<tr>\n<td align=\"left\">307</td>\n<td align=\"center\">临时重定向</td>\n<td align=\"left\">请求的资源临时从其他位置响应</td>\n</tr>\n<tr>\n<td align=\"left\">400</td>\n<td align=\"center\">错误请求</td>\n<td align=\"left\">服务器无法解析该请求</td>\n</tr>\n<tr>\n<td align=\"left\">401</td>\n<td align=\"center\">未授权</td>\n<td align=\"left\">请求没有进行身份验证或验证未通过</td>\n</tr>\n<tr>\n<td align=\"left\">403</td>\n<td align=\"center\">禁止访问</td>\n<td align=\"left\">服务器拒绝此请求</td>\n</tr>\n<tr>\n<td align=\"left\">404</td>\n<td align=\"center\">未找到</td>\n<td align=\"left\">服务器找不到请求的网页</td>\n</tr>\n<tr>\n<td align=\"left\">405</td>\n<td align=\"center\">方法禁用</td>\n<td align=\"left\">服务器禁用了请求中指定的方法</td>\n</tr>\n<tr>\n<td align=\"left\">406</td>\n<td align=\"center\">不接受</td>\n<td align=\"left\">无法使用请求的内容响应请求的网页</td>\n</tr>\n<tr>\n<td align=\"left\">407</td>\n<td align=\"center\">需要代理授权</td>\n<td align=\"left\">请求者需要使用代理授权</td>\n</tr>\n<tr>\n<td align=\"left\">408</td>\n<td align=\"center\">请求超时</td>\n<td align=\"left\">服务器请求超时</td>\n</tr>\n<tr>\n<td align=\"left\">409</td>\n<td align=\"center\">冲突</td>\n<td align=\"left\">服务器在完成请求时发生冲突</td>\n</tr>\n<tr>\n<td align=\"left\">410</td>\n<td align=\"center\">已删除</td>\n<td align=\"left\">请求的资源已永久删除</td>\n</tr>\n<tr>\n<td align=\"left\">411</td>\n<td align=\"center\">需要有效长度</td>\n<td align=\"left\">服务器不接受不含有效内容长度标头字段的请求</td>\n</tr>\n<tr>\n<td align=\"left\">412</td>\n<td align=\"center\">未满足前提条件</td>\n<td align=\"left\">服务器未满足请求者在请求中设置的其中一个前提条件</td>\n</tr>\n<tr>\n<td align=\"left\">413</td>\n<td align=\"center\">请求实体过大</td>\n<td align=\"left\">请求实体过大，超出服务器的处理能力</td>\n</tr>\n<tr>\n<td align=\"left\">415</td>\n<td align=\"center\">请求URL过长</td>\n<td align=\"left\">请求的网址过长，服务器无法处理</td>\n</tr>\n<tr>\n<td align=\"left\">416</td>\n<td align=\"center\">请求范围不符</td>\n<td align=\"left\">页面无法提供请求页面支持</td>\n</tr>\n<tr>\n<td align=\"left\">417</td>\n<td align=\"center\">未满足期望值</td>\n<td align=\"left\">服务器为满足期望请求标头字段的要求</td>\n</tr>\n<tr>\n<td align=\"left\">500</td>\n<td align=\"center\">服务器内部错误</td>\n<td align=\"left\">服务器遇到错误，无法完成请求</td>\n</tr>\n<tr>\n<td align=\"left\">501</td>\n<td align=\"center\">未实现</td>\n<td align=\"left\">服务器不具备完成请求的功能</td>\n</tr>\n<tr>\n<td align=\"left\">502</td>\n<td align=\"center\">错误网关</td>\n<td align=\"left\">服务器作为网关或代理，从上游服务器收到无效响应</td>\n</tr>\n<tr>\n<td align=\"left\">503</td>\n<td align=\"center\">服务不可用</td>\n<td align=\"left\">服务器目前无法使用</td>\n</tr>\n<tr>\n<td align=\"left\">504</td>\n<td align=\"center\">网关超时</td>\n<td align=\"left\">服务器作为网关或代理，但是没有及时从上游服务器收到响应</td>\n</tr>\n<tr>\n<td align=\"left\">505</td>\n<td align=\"center\">HTTP版本不支持</td>\n<td align=\"left\">服务器不支持请求中所用的HTTP协议版本</td>\n</tr>\n</tbody></table>\n<p>响应头包含了服务器对请求的应答信息，如<code>Content-Type</code>、<code>Server</code>、<code>Set-Cookie</code>等。下面简要说明一些常用的响应头信息。 </p>\n<ul>\n<li><code>Date</code>：标识响应产生的时间。</li>\n<li><code>Last-Modified</code>：指定资源的最后修改时间。</li>\n<li><code>Content-Encoding</code>：指定响应内容的编码。</li>\n<li><code>Server</code>：包含服务器的信息，比如名称、版本号等。</li>\n<li><code>Content-Type</code>：文档类型，指定返回的数据类型是什么，如<code>text/html</code>代表返回<code>HTML</code>文档，<code>application/x-javascript</code>则代表返回<code>JavaScript</code>文件，<code>image/jpeg</code>则代表返回图片。</li>\n<li><code>Set-Cookie</code>：设置<code>Cookies</code>。响应头中的<code>Set-Cookie</code>告诉浏览器需要将此内容放在<code>Cookies</code>中，下次请求携带<code>Cookies</code>请求。</li>\n<li><code>Expires</code>：指定响应的过期时间，可以使代理服务器或浏览器将加载的内容更新到缓存中。如果再次访问时，就可以直接从缓存中加载，降低服务器负载，缩短加载时间。</li>\n</ul>\n<h3 id=\"响应体\"><a href=\"#响应体\" class=\"headerlink\" title=\"响应体\"></a>响应体</h3><p>最重要的当属响应体的内容了。响应的正文数据都在响应体中，比如请求网页时，它的响应体就是网页的<code>HTML</code>代码；请求一张图片时，它的响应体就是图片的二进制数据。我们做爬虫请求网页后，要解析的内容就是响应体，如图所示。</p>\n<p><img src=\"Screenshot_1.png\" alt=\"响应体\"></p>\n<p>在浏览器开发者工具中点击<code>Response</code>，就可以看到网页的源代码，也就是响应体的内容，它是解析的目标。在做爬虫时，我们主要通过响应体得到网页的源代码、<code>JSON</code>数据等，然后从中做相应内容的提取。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"URI和URL\"><a href=\"#URI和URL\" class=\"headerlink\" title=\"URI和URL\"></a>URI和URL</h2><p><code>URI （Uniform Resource Identifier）</code> 即<strong>统一资源标志符</strong>。<br><code>URL （Uniform Resource Locator</code> 即<strong>统一资源定位符</strong>。</p>\n<p>例如：<br><code>https://github.com/favicon.ico</code>既是一个URL，也是一个URI。用URL/URI来唯一指定了它的访问方式，这其中包括了访问协议Https，访问路径（即根目录）和资源名称<code>favicon.ico</code>。</p>\n<p>URL是URI的一个子集，也就是每个URL都是URI，但不是每个URI都是URL。</p>\n<p>URI还包括一个子类叫做URN（Universal Resource Name）即统一资源名称。但是在目前的互联网，URN的使用非常少，几乎所有的 URI都是URL，所以一般的网页链接我们可以称之为 URL，也可以称之为 URI。</p>\n<h2 id=\"超文本\"><a href=\"#超文本\" class=\"headerlink\" title=\"超文本\"></a>超文本</h2><p><code>Hypertext</code>，我们在浏览器里看到的网页就是超文本解析而成的，其网页源代码是一系列 HTML代码，里面包含了一系列标签，比如<code>img</code>显示图片，<code>p</code>指定显示段落等。浏览器解析这些标签后，便形成了我们平常看到的网页，而网页的源代码<code>HTML</code>就可以称作超文本。</p>\n<h2 id=\"HTTP和HTTPS\"><a href=\"#HTTP和HTTPS\" class=\"headerlink\" title=\"HTTP和HTTPS\"></a>HTTP和HTTPS</h2><p><code>HTTP</code>的全称是Hyper Text Transfer Protocol，中文名叫作<strong>超文本传输协议</strong>，HTTP协议是用于从网络传输超文本数据到本地浏览器的传送协议，它能保证高效而准确地传送超文本文档。HTTP由万维网协会（World Wide Web Consortium）和Internet工作小组IETF（Internet EngineeringTask Force）共同合作制定的规范，目前广泛使用的是<code>HTTP 1.1</code>版本。</p>\n<p><code>HTTPS</code>的全称是<code>Hyper Text Transfer Protocol over Secure Socket Layer</code>，是以安全为目标HTTP通道，简单讲是HTTP的安全版，即HTTP下加入<code>SSL</code>层，简称为<code>HTTPS</code>。</p>\n<p><code>HTTPS</code>的安全基础是<code>SSL</code>，因此通过它传输的内容都是经过<code>SSL</code>加密的，它的主要作用可以分为两种：</p>\n<ul>\n<li>建立一个信息安全通道，来保证数据传输的安全。</li>\n<li>确认网站的真实性，凡是使用了HTTPS的网站，都可以通过点击浏览器地址栏的锁头标志来查看网站认证之后的真实信息，也可以通过<code>CA</code>机构颁发的安全签章来查询。</li>\n</ul>\n<p>现在越来越多的网站和 App 都已经向 HTTPS 方向发展。例如：</p>\n<ul>\n<li>苹果公司强制所有 iOS App 在 2017 年 1 月 1 日 前全部改为使用 HTTPS 加密，否则 App 就无法在应用商店上架。</li>\n<li>谷歌从 2017 年 1 月推出的 Chrome 56 开始，对未进行 HTTPS 加密的网址链接亮出风险提示，即在地址栏的显著位置提醒用户 “此网页不安全”。</li>\n<li>腾讯微信小程序的官方需求文档要求后台使用 HTTPS 请求进行网络通信，不满足条件的域名和协议无法请求。</li>\n</ul>\n<p>因此，HTTPS 已经已经是大势所趋。</p>\n<h2 id=\"HTTP请求过程\"><a href=\"#HTTP请求过程\" class=\"headerlink\" title=\"HTTP请求过程\"></a>HTTP请求过程</h2><p>我们在浏览器中输入一个URL，回车之后便可以在浏览器中观察到页面内容。实际上，这个过程是浏览器向网站所在的服务器发送了一个请求，网站服务器接收到这个请求后进行处理和解析，然后返回对应的<strong>响应</strong>，接着传回给浏览器。响应里包含了页面的源代码等内容，浏览器再对其进行解析，便将网页呈现了出来，传输模型如图所示：</p>\n<p><img src=\"1.png\" alt=\"传输模型\"></p>\n<p>此处客户端即代表我们自己的 PC 或手机浏览器，服务器即要访问的网站所在的服务器。</p>\n<p>为了更直观地说明这个过程，这里用浏览器的开发者模式下的<code>Network监听组件</code>来做演示，它可以显示访问当前请求网页时发生的所有网络请求和响应。打开浏览器（Chrome或Edge都可以），右击并选择 “检查”项，即可打开浏览器的开发者工具。这里访问百度<code>http://www.baidu.com/</code>，输入该 URL后回车，观察这个过程中发生了怎样的网络请求。可以看到，在<code>Network</code>页面下方 出现了一个个的条目，其中一个条目就代表一次发送请求和接收响应的过程，如图所示:</p>\n<p><img src=\"Screenshot_2.png\" alt=\"Network监听\"></p>\n<p>我们先观察第一个网络请求，即<code>www.baidu.com</code>，其中各列的含义如下。</p>\n<ul>\n<li>第一列 <code>Name：请求的名称</code>，一般会将 URL的最后一部分内容当作名称。</li>\n<li>第二列 <code>Status：响应的状态码</code>，这里显示为 <code>200</code>，代表响应是正常的。通过状态码，我们可以判断发送了请求之后是否得到了正常的响应。 </li>\n<li>第三列 <code>Type：请求的文档类型</code>。这里为<code>document</code>，代表我们这次请求的是一个 HTML文档，内容就是一些 HTML代码。</li>\n<li>第四列 <code>Initiator：请求源</code>。用来标记请求是由哪个对象或进程发起的。</li>\n<li>第五列 <code>Size：从服务器下载的文件和请求的资源大小</code>。如果是从缓存中取得的资源，则该列会显示 fromcache。</li>\n<li>第六列 <code>Time：发起请求到获取响应所用的总时间</code>。</li>\n<li>第七列 <code>Waterfall：网络请求的可视化瀑布流</code>。 我们点击这个条目即可看到其更详细的信息，如图所示。</li>\n</ul>\n<p><img src=\"Screenshot_3.png\" alt=\"详细信息\"></p>\n<p>首先是<code>General</code>部分，<code>Request URL</code>为请求的URL，<code>Request Method</code>为请求的方法，<code>Status Code</code>为响应状态码，<code>Remote Address</code>为远程服务器的地址和端口，<code>Referrer Policy</code>为 Referrer判别策略。 </p>\n<p>再继续往下，可以看到，有<code>Response Headers</code>和<code>Request Headers</code>，这分别代表<code>响应头</code>和<code>请求头</code>。请求头里带有许多请求信息，例如<code>浏览器标识、Cookies、Host</code>等信息，这是请求的一部分，服务器会根据请求头内的信息判断请求是否合法，进而作出对应的响应。图中看到的<code>Response Headers</code>就是响应的一部分，例如其中包含了服务器的类型、文档类型、日期等信息，浏览器接受到响应后，会解析响应内容，进而呈现网页内容。</p>\n<h2 id=\"请求\"><a href=\"#请求\" class=\"headerlink\" title=\"请求\"></a>请求</h2><p><strong>请求</strong>，由客户端向服务端发出，可以分为4部分内容：<code>请求方法（Request Method</code>、<code>请求的网址（Request URL）</code>、<code>请求头（Request Headers）</code>、<code>请求体（Request Body）</code>。</p>\n<h3 id=\"请求方法\"><a href=\"#请求方法\" class=\"headerlink\" title=\"请求方法\"></a>请求方法</h3><p>常见的请求方法有两种：<code>GET</code>和<code>POST</code>。 在浏览器中直接输入URL并回车，这便发起了一个<code>GET请求</code>，请求的参数会直接包含到URL里。例如，在百度中搜索Python，这就是一个GET请求，链接为<code>https://www.baidu.com/s?wd=Python</code>，其中URL中包 含了请求的参数信息，这里参数<code>wd</code>表示要搜寻的关键字。<code>POST请求</code>大多在表单提交时发起。比如，对于一个登录表单，输入用户名和密码后，点击“登录”按钮，这通常会发起一个<code>POST请求</code>，其数据通常 以表单的形式传输，而不会体现在URL中。</p>\n<p><code>GET</code>和<code>POST</code>请求方法有如下区别。</p>\n<ul>\n<li><code>GET请求</code>中的参数包含在URL里面，数据可以在URL中看到，而<code>POST请求</code>的URL不会包含这些数据，数据都是通过表单形式传输的，会包含在请求体中。</li>\n<li><code>GET请求</code>提交的数据最多只有<em>1024字节</em>，而<code>POST请求</code>没有限制。 一般来说，登录时，需要提交用户名和密码，其中包含了敏感信息，使用<code>GET方式</code>请求的话，密码就会暴露在URL里面，造成密码泄露，所以这里最好以<code>POST方式</code>发送。上传文件时，由于文件内容比较大，也会选用<code>POST方式</code>。 我们平常遇到的绝大部分请求都是<code>GET</code>或<code>POST</code>请求，另外还有一些请求方法，如<code>HEAD</code>、<code>PUT</code>、<code>DELETE</code>、<code>OPTIONS</code>、<code>CONNECT</code>、<code>TRACE</code>等，我们简单将其总结为下表。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">GET</td>\n<td align=\"left\">请求页面，并返回页面内容</td>\n</tr>\n<tr>\n<td align=\"left\">HEAD</td>\n<td align=\"left\">类似于GET请求，只不过返回的响应中没有具体的内容，用于获取报头</td>\n</tr>\n<tr>\n<td align=\"left\">POST</td>\n<td align=\"left\">大多用于表单提交或上传文件，数据包含在请求体中</td>\n</tr>\n<tr>\n<td align=\"left\">PUT</td>\n<td align=\"left\">从客户端向服务器传送的数据取代指定文档中的内容</td>\n</tr>\n<tr>\n<td align=\"left\">DELETE</td>\n<td align=\"left\">请求服务器删除指定的页面</td>\n</tr>\n<tr>\n<td align=\"left\">CONNECT</td>\n<td align=\"left\">把服务器当作跳板，让服务器代替客户端访问其他网页</td>\n</tr>\n<tr>\n<td align=\"left\">OPTIONS</td>\n<td align=\"left\">允许客户端查看服务器的性能</td>\n</tr>\n<tr>\n<td align=\"left\">TRACE</td>\n<td align=\"left\">回显服务器收到的请求，主要用于测试或诊断</td>\n</tr>\n</tbody></table>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 50%;\n    }\n</style>\n\n<p>请求的网址，即统一资源定位符 URL，它可以唯一确定我们想请求的资源。</p>\n<h3 id=\"请求头\"><a href=\"#请求头\" class=\"headerlink\" title=\"请求头\"></a>请求头</h3><p>请求头，用来说明服务器要使用的附加信息，比较重要的信息有<code>Cookie</code>、<code>Referer</code>、<code>User-Agent</code>等。下面简要说明一些常用的头信息。</p>\n<ul>\n<li><code>Accept</code>：请求报头域，用于指定客户端可接受哪些类型的信息。</li>\n<li><code>Accept-Language</code>：指定客户端可接受的语言类型。</li>\n<li><code>Accept-Encoding</code>：指定客户端可接受的内容编码。</li>\n<li><code>Host</code>：用于指定请求资源的主机<code>IP</code>和端口号，其内容为请求URL的原始服务器或网关的位置。从 HTTP 1.1 版本开始，请求必须包含此内容。</li>\n<li><code>Cookie</code>：也常用复数形式<code>Cookies</code>，这是网站为了辨别用户进行会话跟踪而存储在用户本地的数据。它的主要功能是维持当前访问会话。例如，我们输入用户名和密码成功登录某个网站后，服务器会用会 话保存登录状态信息，后面我们每次刷新或请求该站点的其他页面时，会发现都是登录状态，这就是<code>Cookies</code>的功劳。<code>Cookies</code>里有信息标识了我们所对应的服务器的会话，每次浏览器在请求该站点的页 面时，都会在请求头中加上<code>Cookies</code>并将其发送给服务器，服务器通过<code>Cookies</code>识别出是我们自己，并且查出当前状态是登录状态，所以返回结果就是登录之后才能看到的网页内容。</li>\n<li><code>Referer</code>：此内容用来标识这个请求是从哪个页面发过来的，服务器可以拿到这一信息并做相应的处理，如做来源统计、防盗链处理等。</li>\n<li><code>User-Agent</code>：简称<code>UA</code>，它是一个特殊的字符串头，可以使服务器识别客户使用的操作系统及版本、浏览器及版本等信息。在做爬虫时加上此信息，可以伪装为浏览器；如果不加，很可能会被识别出为爬虫。</li>\n<li><code>Content-Type</code>：也叫互联网媒体类型<code>（Internet Media Type）</code>或者<code>MIME类型</code>，在<code>HTTP</code>协议消息头中，它用来表示具体请求中的媒体类型信息。例如，<code>text/html</code>代表<code>HTML</code>格式，<code>image/gif</code>代表<code>GIF</code>图片，<code>application/json</code>代表<code>JSON</code>类型，更多对应关系可以查看此对照表：<code>http://tool.oschina.net/commons</code>。</li>\n</ul>\n<p>因此，请求头是请求的重要组成部分，在写爬虫时，大部分情况下都需要设定请求头。</p>\n<h3 id=\"请求体\"><a href=\"#请求体\" class=\"headerlink\" title=\"请求体\"></a>请求体</h3><p>请请求体一般承载的内容是<code>POST</code>请求中的表单数据，而对于<code>GET</code>请求，请求体则为空。</p>\n<p>登录之前，我们填写了用户名和密码信息，提交时这些内容就会以表单数据的形式提交给服务器，此时需要注意<code>Request Headers</code>中指定<code>Content-Type</code>为<code>application/x-www-form-urlencoded</code>。只有设置<code>Content-Type</code>为<code>application/x-www-form-urlencoded</code>，才会以表单数据的形式提交。另外，我们也可以将<code>Content-Type</code>设置为<code>application/json</code>来提交<code>JSON</code>数据，或者设置为<code>multipart/form-data</code>来上传文件。 </p>\n<p>表格中列出了<code>Content-Type</code>和<code>POST</code>提交数据方式的关系。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">Content-Type</th>\n<th align=\"left\">提交数据的方式</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">application/x-www-form-urlencodeed</td>\n<td align=\"left\">表单数据</td>\n</tr>\n<tr>\n<td align=\"left\">multipart/form-data</td>\n<td align=\"left\">表单文件上传</td>\n</tr>\n<tr>\n<td align=\"left\">application/json</td>\n<td align=\"left\">序列化JSON数据</td>\n</tr>\n<tr>\n<td align=\"left\">text/xml</td>\n<td align=\"left\">XML数据</td>\n</tr>\n</tbody></table>\n<p>在爬虫中，如果要构造<code>POST</code>请求，需要使用正确的<code>Content-Type</code>，并了解各种请求库的各个参数设置时使用的是哪种<code>Content-Type</code>，不然可能会导致<code>POST</code>提交后无法正常响应。</p>\n<h2 id=\"响应\"><a href=\"#响应\" class=\"headerlink\" title=\"响应\"></a>响应</h2><p>响应，由服务端返回给客户端，可以分为三部分：<code>响应状态码（Response Status Code）</code>、<code>响应头（Response Headers）</code>和<code>响应体（Response Body）</code>。</p>\n<h3 id=\"响应状态码\"><a href=\"#响应状态码\" class=\"headerlink\" title=\"响应状态码\"></a>响应状态码</h3><p>响应状态码表示服务器的响应状态，如<code>200</code>代表服务器正常响应，<code>404</code>代表页面未找到，<code>500</code>代表服务器内部发生错误。在爬虫中，我们可以根据状态码来判断服务器响应状态，如状态码为<code>200</code>，则证明成功返 回数据，再进行进一步的处理，否则直接忽略。下表列出了常见的错误代码及错误原因。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">状态码</th>\n<th align=\"center\">说明</th>\n<th align=\"left\">详情</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">100</td>\n<td align=\"center\">继续</td>\n<td align=\"left\">请求者应当继续提出请求，服务器已收到请求的一部分，正在等待其余部分</td>\n</tr>\n<tr>\n<td align=\"left\">101</td>\n<td align=\"center\">切换协议</td>\n<td align=\"left\">请求者已要求服务器切换协议，服务器已确认并确认切换</td>\n</tr>\n<tr>\n<td align=\"left\">200</td>\n<td align=\"center\">成功</td>\n<td align=\"left\">服务器已成功处理了请求</td>\n</tr>\n<tr>\n<td align=\"left\">201</td>\n<td align=\"center\">已创建</td>\n<td align=\"left\">请求成功并且服务器创建了新的资源</td>\n</tr>\n<tr>\n<td align=\"left\">202</td>\n<td align=\"center\">已接受</td>\n<td align=\"left\">服务器已接受请求，但尚未处理</td>\n</tr>\n<tr>\n<td align=\"left\">203</td>\n<td align=\"center\">非授权信息</td>\n<td align=\"left\">服务器已经成功处理请求，但返回的信息可能来自另一个源</td>\n</tr>\n<tr>\n<td align=\"left\">204</td>\n<td align=\"center\">无内容</td>\n<td align=\"left\">服务器成功处理了请求，但没有返回任何内容</td>\n</tr>\n<tr>\n<td align=\"left\">205</td>\n<td align=\"center\">重置内容</td>\n<td align=\"left\">服务器成功处理了请求，但内容被重置</td>\n</tr>\n<tr>\n<td align=\"left\">206</td>\n<td align=\"center\">部分内容</td>\n<td align=\"left\">服务器成功处理了部分请求</td>\n</tr>\n<tr>\n<td align=\"left\">300</td>\n<td align=\"center\">多种选择</td>\n<td align=\"left\">针对请求，服务器可执行多种操作</td>\n</tr>\n<tr>\n<td align=\"left\">301</td>\n<td align=\"center\">永久移动</td>\n<td align=\"left\">请求的网页已永久移动到新位置，即永久重定向</td>\n</tr>\n<tr>\n<td align=\"left\">302</td>\n<td align=\"center\">临时移动</td>\n<td align=\"left\">请求的网页暂时跳转到其他页面，即暂时重定向</td>\n</tr>\n<tr>\n<td align=\"left\">303</td>\n<td align=\"center\">查看其他位置</td>\n<td align=\"left\">如果原来的请求是POST，重定向目标文档应当通过GET方式访问资源</td>\n</tr>\n<tr>\n<td align=\"left\">304</td>\n<td align=\"center\">未修改</td>\n<td align=\"left\">此次请求返回的网页未修改，继续使用上次的资源</td>\n</tr>\n<tr>\n<td align=\"left\">305</td>\n<td align=\"center\">使用代理</td>\n<td align=\"left\">请求者应该使用代理访问该网页</td>\n</tr>\n<tr>\n<td align=\"left\">307</td>\n<td align=\"center\">临时重定向</td>\n<td align=\"left\">请求的资源临时从其他位置响应</td>\n</tr>\n<tr>\n<td align=\"left\">400</td>\n<td align=\"center\">错误请求</td>\n<td align=\"left\">服务器无法解析该请求</td>\n</tr>\n<tr>\n<td align=\"left\">401</td>\n<td align=\"center\">未授权</td>\n<td align=\"left\">请求没有进行身份验证或验证未通过</td>\n</tr>\n<tr>\n<td align=\"left\">403</td>\n<td align=\"center\">禁止访问</td>\n<td align=\"left\">服务器拒绝此请求</td>\n</tr>\n<tr>\n<td align=\"left\">404</td>\n<td align=\"center\">未找到</td>\n<td align=\"left\">服务器找不到请求的网页</td>\n</tr>\n<tr>\n<td align=\"left\">405</td>\n<td align=\"center\">方法禁用</td>\n<td align=\"left\">服务器禁用了请求中指定的方法</td>\n</tr>\n<tr>\n<td align=\"left\">406</td>\n<td align=\"center\">不接受</td>\n<td align=\"left\">无法使用请求的内容响应请求的网页</td>\n</tr>\n<tr>\n<td align=\"left\">407</td>\n<td align=\"center\">需要代理授权</td>\n<td align=\"left\">请求者需要使用代理授权</td>\n</tr>\n<tr>\n<td align=\"left\">408</td>\n<td align=\"center\">请求超时</td>\n<td align=\"left\">服务器请求超时</td>\n</tr>\n<tr>\n<td align=\"left\">409</td>\n<td align=\"center\">冲突</td>\n<td align=\"left\">服务器在完成请求时发生冲突</td>\n</tr>\n<tr>\n<td align=\"left\">410</td>\n<td align=\"center\">已删除</td>\n<td align=\"left\">请求的资源已永久删除</td>\n</tr>\n<tr>\n<td align=\"left\">411</td>\n<td align=\"center\">需要有效长度</td>\n<td align=\"left\">服务器不接受不含有效内容长度标头字段的请求</td>\n</tr>\n<tr>\n<td align=\"left\">412</td>\n<td align=\"center\">未满足前提条件</td>\n<td align=\"left\">服务器未满足请求者在请求中设置的其中一个前提条件</td>\n</tr>\n<tr>\n<td align=\"left\">413</td>\n<td align=\"center\">请求实体过大</td>\n<td align=\"left\">请求实体过大，超出服务器的处理能力</td>\n</tr>\n<tr>\n<td align=\"left\">415</td>\n<td align=\"center\">请求URL过长</td>\n<td align=\"left\">请求的网址过长，服务器无法处理</td>\n</tr>\n<tr>\n<td align=\"left\">416</td>\n<td align=\"center\">请求范围不符</td>\n<td align=\"left\">页面无法提供请求页面支持</td>\n</tr>\n<tr>\n<td align=\"left\">417</td>\n<td align=\"center\">未满足期望值</td>\n<td align=\"left\">服务器为满足期望请求标头字段的要求</td>\n</tr>\n<tr>\n<td align=\"left\">500</td>\n<td align=\"center\">服务器内部错误</td>\n<td align=\"left\">服务器遇到错误，无法完成请求</td>\n</tr>\n<tr>\n<td align=\"left\">501</td>\n<td align=\"center\">未实现</td>\n<td align=\"left\">服务器不具备完成请求的功能</td>\n</tr>\n<tr>\n<td align=\"left\">502</td>\n<td align=\"center\">错误网关</td>\n<td align=\"left\">服务器作为网关或代理，从上游服务器收到无效响应</td>\n</tr>\n<tr>\n<td align=\"left\">503</td>\n<td align=\"center\">服务不可用</td>\n<td align=\"left\">服务器目前无法使用</td>\n</tr>\n<tr>\n<td align=\"left\">504</td>\n<td align=\"center\">网关超时</td>\n<td align=\"left\">服务器作为网关或代理，但是没有及时从上游服务器收到响应</td>\n</tr>\n<tr>\n<td align=\"left\">505</td>\n<td align=\"center\">HTTP版本不支持</td>\n<td align=\"left\">服务器不支持请求中所用的HTTP协议版本</td>\n</tr>\n</tbody></table>\n<p>响应头包含了服务器对请求的应答信息，如<code>Content-Type</code>、<code>Server</code>、<code>Set-Cookie</code>等。下面简要说明一些常用的响应头信息。 </p>\n<ul>\n<li><code>Date</code>：标识响应产生的时间。</li>\n<li><code>Last-Modified</code>：指定资源的最后修改时间。</li>\n<li><code>Content-Encoding</code>：指定响应内容的编码。</li>\n<li><code>Server</code>：包含服务器的信息，比如名称、版本号等。</li>\n<li><code>Content-Type</code>：文档类型，指定返回的数据类型是什么，如<code>text/html</code>代表返回<code>HTML</code>文档，<code>application/x-javascript</code>则代表返回<code>JavaScript</code>文件，<code>image/jpeg</code>则代表返回图片。</li>\n<li><code>Set-Cookie</code>：设置<code>Cookies</code>。响应头中的<code>Set-Cookie</code>告诉浏览器需要将此内容放在<code>Cookies</code>中，下次请求携带<code>Cookies</code>请求。</li>\n<li><code>Expires</code>：指定响应的过期时间，可以使代理服务器或浏览器将加载的内容更新到缓存中。如果再次访问时，就可以直接从缓存中加载，降低服务器负载，缩短加载时间。</li>\n</ul>\n<h3 id=\"响应体\"><a href=\"#响应体\" class=\"headerlink\" title=\"响应体\"></a>响应体</h3><p>最重要的当属响应体的内容了。响应的正文数据都在响应体中，比如请求网页时，它的响应体就是网页的<code>HTML</code>代码；请求一张图片时，它的响应体就是图片的二进制数据。我们做爬虫请求网页后，要解析的内容就是响应体，如图所示。</p>\n<p><img src=\"Screenshot_1.png\" alt=\"响应体\"></p>\n<p>在浏览器开发者工具中点击<code>Response</code>，就可以看到网页的源代码，也就是响应体的内容，它是解析的目标。在做爬虫时，我们主要通过响应体得到网页的源代码、<code>JSON</code>数据等，然后从中做相应内容的提取。</p>\n"},{"title":"Pyquery的使用","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-22T16:49:30.000Z","pic":null,"_content":"\n## 准备工作\n\n`pyquery`是`Python`的第三方库，安装命令如下：\n\n```python\npip3 install pyquery\n```\n\n## 初始化\n\n解析`HTML`文本的时候，首先需要将其初始化为一个`pyquery`对象。它的初始化方式有多种，比如直接**传入字符串**、**传入`URL`**、**传入文件名**，等等。\n\n### 字符串初始化\n\n可以直接把`HTML`的内容当作参数来初始化`pyquery`对象。\n\n```python\nhtml = ''' \n<div>\n    <ul> \n        <li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li> \n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li> \n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li> \n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n    </ul> \n</div> \n''' \n\nfrom pyquery import PyQuery as pq \n\ndoc = pq(html) \n\nprint(doc('li'))\n```\n\n运行结果如下：\n\n```python\n<li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li> \n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li> \n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li> \n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n```\n\n引入`pyquery`这个对象，取别名为`pq`，然后声明了一个长`HTML`字符串，并将其当作参数传递给`pyquery`类，这样就成功完成了初始化。\n\n接下来，将初始化的对象传入`CSS`选择器。在这个实例中，传入`li`节点，这样就可以选择所有的`li`节点。\n\n### URL初始化 \n\n初始化的参数不仅可以以字符串的形式传递，还可以传入网页的`URL`，只需要指定参数为`url`即可：\n\n```python\nfrom pyquery import PyQuery as pq \n\ndoc = pq(url='https://www.holychan.ltd')\n\nprint(doc('title'))\n```\n\n```python\n<title>Holy的个人站点</title>\n```\n\n`pyquery`对象会首先请求这个`URL`，然后用得到的`HTML`内容完成初始化。这就相当于将网页的源代码以字符串的形式传递给`pyquery`类来初始化。\n\n它与下面的功能是相同的：\n\n```python\nfrom pyquery import PyQuery as pq\nimport requests\n\ndoc = pq(requests.get('https://www.holychan.ltd').text)\nprint(doc('title'))\n```\n\n### 文件初始化\n\n除了传递一个`URL`，还可以传递本地的文件名，参数指定为`filename`即可：\n\n```python\nfrom pyquery import PyQuery as pq\n\ndoc = pq(filename='demo.html')\nprint(doc('li'))\n```\n\n这里需要有一个本地`HTML`文件`demo.html`，其内容是待解析的`HTML`字符串。这样它会先读取本地的文件内容，然后将文件内容以字符串的形式传递给 `pyquery`类来初始化。\n\n以上3种方式均可初始化，当然最常用的初始化方式还是以字符串形式传递。\n\n## 基本CSS选择器\n\n```python\nhtml = '''\n<div id=\"container\">\n    <ul class=\"list\">\n        <li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n    </ul>\n</div> \n''' \nfrom pyquery import PyQuery as pq \ndoc = pq(html)\nprint(doc('#container .list li'))\nprint(type(doc('#container .list li')))\n```\n\n运行结果：\n\n```python\n<li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n\n<class 'pyquery.pyquery.PyQuery'>\n```\n\n初始化`pyquery`对象之后，传入`CSS`选择器`#container .list li`，它的意思是先选取`id`为`container`的节点，然后再选取其内部`class`为`list`的所有`li`节点，最后打印输出。成功获取到了符合条件的节点。将它的类型打印输出后发现，它的类型依然是`pyquery`类型。\n\n直接遍历这些节点，然后调用`text`方法，就可以获取节点的文本内容，代码示例如下：\n\n```python\nfor item in doc('#container .list li').items():\n    print(item.text())\n```\n\n结果如下：\n\n```python\nfirst item\nsecond item\nthird item\nfourth item\nfifth item\n```\n\n## 查找节点\n\n### 子节点\n\n查找子节点需要用到`find`方法，传入的参数是`CSS`选择器：\n\n```python\nhtml = '''\n<div id=\"container\">\n    <ul class=\"list\">\n        <li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n    </ul>\n</div> \n''' \n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\nitems = doc('.list')\nprint(type(items))\nprint(items)\nlis = items.find('li')\nprint(type(lis))\nprint(lis)\n```\n\n运行结果：\n\n```python\n<class 'pyquery.pyquery.PyQuery'>\n<ul class=\"list\">\n        <li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n    </ul>\n\n<class 'pyquery.pyquery.PyQuery'>\n<li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n```\n\n通过`.list`参数选取`class`为`list`的节点，然后调用`find`方法，传入`CSS`选择器，选取其内部的`li`节点，最后打印输出。可以发现，`find`方法会将符合条件的所有节点选择出来，结果的类型是`pyquery`类型。\n\n`find`的查找范围是节点的所有子孙节点，而如果我们只想查找子节点，那可以用`children`方法：\n\n```python\nlis = items.children()\nprint(type(lis))\nprint(lis)\n```\n\n运行结果：\n\n```python\n<class 'pyquery.pyquery.PyQuery'>\n<li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n```\n\n如果要筛选所有子节点中符合条件的节点，比如想筛选出子节点中`class`为`active`的节点，可以向`children`方法传入`CSS`选择器`.active`，代码如下：\n\n```python\nlis = items.children('.active')\nprint(lis)\n```\n\n结果如下：\n\n```python\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n```\n\n输出的结果做了筛选，留下了`class`为`active`的节点。\n\n### 父节点\n\n可以用`parent`方法获取某个节点的父节点：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\ndoc = pq(html)\nitems = doc('.list')\ncontainer = items.parent()\nprint(type(container))\nprint(container)\n```\n\n运行结果如下：\n\n```python\n<class 'pyquery.pyquery.PyQuery'>\n<div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n```\n\n用`.list`选取`class`为`list`的节点，然后调用`parent`方法得到其父节点，其类型依然是`pyquery`类型。这里的父节点是该节点的直接父节点，也就是说，它不会再去查找父节点的父节点，即祖先节点。\n\n如果你想获取某个祖先节点，该怎么办呢？可以用`parents`方法：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\ndoc = pq(html)\nitems = doc('.list')\ncontainer = items.parents()\nprint(type(container))\nprint(container)\n```\n\n运行结果如下：\n\n```python\n<class 'pyquery.pyquery.PyQuery'>\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div><div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n```\n\n输出结果有两个：一个是`class`为`wrap`的节点，一个是`id`为`container`的节点。也就是说，使用`parents`方法会返回所有的祖先节点。\n\n要筛选某个祖先节点的话，可以向`parents`方法传入`CSS`选择器，这样就会返回祖先节点中符合`CSS`选择器的节点：\n\n```python\nparent = items.parents('.wrap')\nprint(parent)\n```\n\n结果如下：\n\n```python\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n```\n\n输出结果少了一个节点，只保留了`class`为`wrap`的节点。\n\n### 兄弟节点\n\n要获取兄弟节点，可以使用`siblings`方法。这里还是以上面的`HTML`代码为例：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\nli = doc('.list .item-0.active')\nprint(li.siblings())\n```\n\n结果如下：\n\n```python\n<li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n```\n\n先选择`class`为`list`的节点，内部`class`为`item-0`和`active`的节点，也就是第3个`li`节点。很明显，它的兄弟节点有4个，那就是第`1`、`2`、`4`、`5 `个`li`节点。结果显示的正是4个兄弟节点。\n\n筛选某个兄弟节点，可以用`siblings`方法传入`CSS`选择器，这样就会从所有兄弟节点中挑选出符合条件的节点了：\n\n```python\nfrom pyquery import PyQuery as pq\ndoc = pq(html)\nli = doc('.list .item-0.active')\nprint(li.siblings('.active')) \n```\n\n筛选`class`为`active`的节点，从刚才的结果中可以观察到，`class`为`active`兄弟节点的是第4个`li`节点，所以结果应该是1个。运行结果：\n\n```python\n<li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n```\n\n## 遍历\n\n`pyquery`的选择结果既可能是多个节点，也可能是单个节点，类型都是`pyquery`类型，并没有返回列表。对于单个节点来说，可以直接打印输出，也可以直接转成字符串：\n\n```python\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\nli = doc('.item-0.active')\nprint(li)\nprint(str(li))\n```\n\n运行结果如下：\n\n```python\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n```\n\n对于有多个节点的结果，我们就需要用遍历来获取了。例如，如果要把每一个`li`节点进行遍历，需要调用`items`方法：\n\n```python\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\nlis = doc('li').items()\nprint(type(lis))\nfor li in lis:\n    print(li, type(li))\n```\n\n运行结果如下：\n\n```python\n<class 'generator'>\n<li class=\"item-0\">first item</li>\n             <class 'pyquery.pyquery.PyQuery'>\n<li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n             <class 'pyquery.pyquery.PyQuery'>\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n             <class 'pyquery.pyquery.PyQuery'>\n<li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n             <class 'pyquery.pyquery.PyQuery'>\n<li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n         <class 'pyquery.pyquery.PyQuery'>\n```\n\n调用`items`方法后，会得到一个生成器，遍历一下，就可以逐个得到`li`节点对象了，它的类型也是`pyquery`类型。每个`li`节点还可以调用前面所说的方法进行选择，比如继续查询子节点，寻找某个祖先节点等。\n\n## 获取信息\n\n提取到节点之后，最终目的是提取节点包含的信息。比较重要的信息有两类，一是获取属性，二是获取文本。\n\n### 获取属性\n\n提取到某个`pyquery`类型的节点后，就可以调用`attr`方法来获取属性：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\na = doc('.item-0.active a')\nprint(a, type(a))\nprint(a.attr('href'))\n```\n\n运行结果如下：\n\n```python\n<a href=\"link3.html\"><span class=\"bold\">third item</span></a> <class 'pyquery.pyquery.PyQuery'>\nlink3.html\n```\n\n首先选中`class`为`item-0`和`active`的`li`节点内的`a`节点，它的类型是`pyquery`类型。然后调用`attr`方法。在这个方法中传入属性的名称，就可以得到属性值了。此外，也可以通过调用`attr`属性来获取属性值，用法如下：\n\n```python\nprint(a.attr.href)\n```\n\n结果：`link3.html`，这两种方法的结果完全一样。\n\n### 获取文本\n\n获取节点之后的另一个主要操作就是获取其内部文本了，此时可以调用`text`方法来实现：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\na = doc('.item-0.active a')\nprint(a)\nprint(a.text())\n```\n\n运行结果如下：\n\n```python\n<a href=\"link3.html\"><span class=\"bold\">third item</span></a>\nthird item\n```\n\n首先选中一个`a`节点，然后调用`text`方法，就可以获取其内部的文本信息了。`text`会忽略节点内部包含的所有`HTML`，只返回纯文字内容。\n\n如果想要获取这个节点内部的`HTML`文本，就要用`html`方法：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\nli = doc('.item-0.active')\nprint(li)\nprint(li.html())\n``\n这里我们选中第3个`li`节点，然后调用`html`方法，它返回的结果应该是`li`节点内的所有`HTML`文本。运行结果如下：\n\n```python\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n<a href=\"link3.html\"><span class=\"bold\">third item</span></a>\n```\n\n如果我们选中的结果是多个节点，`text`或`html`方法会返回什么内容？我们用实例来看一下：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\nli = doc('li')\nprint(li.html())\nprint(li.text())\nprint(type(li.text()))\n```\n\n运行结果如下：\n\n```python\nfirst item\nfirst item second item third item fourth item fifth item\n<class 'str'>\n```\n\n`html`方法返回的是第1个`li`节点的内部`HTML`文本，而`text`则返回了所有的`li`节点内部的纯文本，中间用一个空格分割开，即返回结果是一个字符串。\n\n## 节点操作\n\n`pyquery`提供了一系列方法来对节点进行动态修改，比如为某个节点添加一个`class`，移除某个节点等，这些操作有时会为提取信息带来极大的便利。\n由于节点操作的方法太多，下面举几个典型的例子来说明它的用法。\n\n### addClass和removeClass\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\nli = doc('.item-0.active')\nprint(li)\nli.remove_class('active')\nprint(li)\nli.add_class('active')\nprint(li)\n```\n\n首先选中第3个`li`节点，然后调用`removeClass`方法，将`li`节点的`active`这`class`移除，第2步调用`addClass`方法，将`class`添加回来。每执行一次操作，就打印输出当前`li`节点的内容。\n\n运行结果如下：\n\n```python\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n\n<li class=\"item-0\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n```\n\n一共输出了3次。第2次输出时，`li`节点的`active`这个`class`被移除了，第3次`class`又添加回来了。`addClass`和`removeClass`方法可以动态改变节点的`class`属性。\n\n### attr、text、html\n\n除了操作`class`这个属性外，也可以用`attr`方法对属性进行操作。此外，还可以用`text`和`html`方法来改变节点内部的内容。示例如下：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\nli = doc('.item-0.active')\nprint(li)\nli.attr('name', 'link')\nprint(li)\nli.text('changed item')\nprint(li)\nli.html('<span>changed item</span>')\nprint(li)\n```\n\n首先选中`li`节点，然后调用`attr`方法来修改属性。该方法的第1个参数为属性名，第2个参数为属性值。最后调用`text`和`html`方法来改变节点内部的内容。3次操作后，分别打印输出当前的`li`节点。 运行结果如下：\n\n```python\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n\n<li class=\"item-0 active\" name=\"link\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n\n<li class=\"item-0 active\" name=\"link\">changed item</li>\n\n<li class=\"item-0 active\" name=\"link\"><span>changed item</span></li>\n```\n\n调用`attr`方法后，`li`节点多了一个原本不存在的属性`name`，其值为`link`。接着调用`text`方法传入文本，`li`节点内部的文本全被改为传入的字符串文本。最后，调用`html`方法传入`HTML`文本，`li`节点内部又变为传入的`HTML`文本了。\n\n使用`attr`方法时如果只传入第1个参数的属性名，则是获取这个属性值；如果传入第2个参数，可以用来修改属性值。使用`text`和`html`方法时如果不传参数，则是获取节点内纯文本和`HTML`文本，如果传入参数，则进行赋值。\n\n### remove\n\n`remove`方法就是移除，它有时会为信息的提取带来非常大的便利。下面有一段 HTML文本：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    hello, world\n    <p>This is a paragraph.</p>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\nwrap = doc('.wrap')\nprint(wrap.text())\n```\n\n想提取`“Hello, World”`这个字符串，该怎样操作呢？\n\n这里先直接尝试提取`class`为`wrap`的节点的内容，看看是不是我们想要的。\n\n运行结果如下：\n\n```python\nHello, World This is a paragraph.\n```\n\n这个结果还包含了内部的`p`节点的内容，也就是说`text`把所有的纯文本全提取出来了。\n\n如果想去掉`p`节点内部的文本，可以选择再把`p`节点内的文本提取一遍，然后从整个结果中移除这个子串，但这个做法明显比较烦琐。\n\n这时`remove`方法就可以派上用场了，可以接着这么做：\n\n```python\nwrap.find('p').remove()\nprint(wrap.text())\n```\n\n首先选中`p`节点，然后调用`remove`方法将其移除，这时`wrap`内部就只剩下`“Hello, World”`这句话了，最后利用`text`方法提取即可。\n\n其实还有很多其他节点操作的方法，比如`append`、`empty`和`prepend`等方法，详细的用法可以参考官方文档：[http://pyquery.readthedocs.io/en/latest/api.html](http://pyquery.readthedocs.io/en/latest/api.html)。\n\n## 伪类选择器\n\n`CSS`选择器之所以强大，还有一个很重要的原因，那就是它支持多种多样的伪类选择器，例如选择第一个节点、最后一个节点、奇偶数节点、包含某一文本的节点等。示例如下：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\ndoc = pq(html)\nli = doc('li:first-child')\nprint(li)\nli = doc('li:last-child')\nprint(li)\nli = doc('li:nth-child(2)')\nprint(li)\nli = doc('li:gt(2)')\nprint(li)\nli = doc('li:nth-child(2n)')\nprint(li)\nli = doc('li:contains(second)')\nprint(li)\n```\n\n在这个例子中使用了`CSS3`的伪类选择器，依次选择了第1个`li`节点、最后一个`li`节点、第2个`li`节点、第3个`li`之后的`li`节点、偶数位置的`li`节点、包含`second`文本的`li`节点。\n","source":"_posts/Pyquery的使用.md","raw":"---\ntitle: Pyquery的使用\ntags:\n  - pyquery\n  - python\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-23 00:49:30\ncategories: 爬虫\npic:\n---\n\n## 准备工作\n\n`pyquery`是`Python`的第三方库，安装命令如下：\n\n```python\npip3 install pyquery\n```\n\n## 初始化\n\n解析`HTML`文本的时候，首先需要将其初始化为一个`pyquery`对象。它的初始化方式有多种，比如直接**传入字符串**、**传入`URL`**、**传入文件名**，等等。\n\n### 字符串初始化\n\n可以直接把`HTML`的内容当作参数来初始化`pyquery`对象。\n\n```python\nhtml = ''' \n<div>\n    <ul> \n        <li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li> \n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li> \n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li> \n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n    </ul> \n</div> \n''' \n\nfrom pyquery import PyQuery as pq \n\ndoc = pq(html) \n\nprint(doc('li'))\n```\n\n运行结果如下：\n\n```python\n<li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li> \n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li> \n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li> \n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n```\n\n引入`pyquery`这个对象，取别名为`pq`，然后声明了一个长`HTML`字符串，并将其当作参数传递给`pyquery`类，这样就成功完成了初始化。\n\n接下来，将初始化的对象传入`CSS`选择器。在这个实例中，传入`li`节点，这样就可以选择所有的`li`节点。\n\n### URL初始化 \n\n初始化的参数不仅可以以字符串的形式传递，还可以传入网页的`URL`，只需要指定参数为`url`即可：\n\n```python\nfrom pyquery import PyQuery as pq \n\ndoc = pq(url='https://www.holychan.ltd')\n\nprint(doc('title'))\n```\n\n```python\n<title>Holy的个人站点</title>\n```\n\n`pyquery`对象会首先请求这个`URL`，然后用得到的`HTML`内容完成初始化。这就相当于将网页的源代码以字符串的形式传递给`pyquery`类来初始化。\n\n它与下面的功能是相同的：\n\n```python\nfrom pyquery import PyQuery as pq\nimport requests\n\ndoc = pq(requests.get('https://www.holychan.ltd').text)\nprint(doc('title'))\n```\n\n### 文件初始化\n\n除了传递一个`URL`，还可以传递本地的文件名，参数指定为`filename`即可：\n\n```python\nfrom pyquery import PyQuery as pq\n\ndoc = pq(filename='demo.html')\nprint(doc('li'))\n```\n\n这里需要有一个本地`HTML`文件`demo.html`，其内容是待解析的`HTML`字符串。这样它会先读取本地的文件内容，然后将文件内容以字符串的形式传递给 `pyquery`类来初始化。\n\n以上3种方式均可初始化，当然最常用的初始化方式还是以字符串形式传递。\n\n## 基本CSS选择器\n\n```python\nhtml = '''\n<div id=\"container\">\n    <ul class=\"list\">\n        <li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n    </ul>\n</div> \n''' \nfrom pyquery import PyQuery as pq \ndoc = pq(html)\nprint(doc('#container .list li'))\nprint(type(doc('#container .list li')))\n```\n\n运行结果：\n\n```python\n<li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n\n<class 'pyquery.pyquery.PyQuery'>\n```\n\n初始化`pyquery`对象之后，传入`CSS`选择器`#container .list li`，它的意思是先选取`id`为`container`的节点，然后再选取其内部`class`为`list`的所有`li`节点，最后打印输出。成功获取到了符合条件的节点。将它的类型打印输出后发现，它的类型依然是`pyquery`类型。\n\n直接遍历这些节点，然后调用`text`方法，就可以获取节点的文本内容，代码示例如下：\n\n```python\nfor item in doc('#container .list li').items():\n    print(item.text())\n```\n\n结果如下：\n\n```python\nfirst item\nsecond item\nthird item\nfourth item\nfifth item\n```\n\n## 查找节点\n\n### 子节点\n\n查找子节点需要用到`find`方法，传入的参数是`CSS`选择器：\n\n```python\nhtml = '''\n<div id=\"container\">\n    <ul class=\"list\">\n        <li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n    </ul>\n</div> \n''' \n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\nitems = doc('.list')\nprint(type(items))\nprint(items)\nlis = items.find('li')\nprint(type(lis))\nprint(lis)\n```\n\n运行结果：\n\n```python\n<class 'pyquery.pyquery.PyQuery'>\n<ul class=\"list\">\n        <li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n    </ul>\n\n<class 'pyquery.pyquery.PyQuery'>\n<li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n```\n\n通过`.list`参数选取`class`为`list`的节点，然后调用`find`方法，传入`CSS`选择器，选取其内部的`li`节点，最后打印输出。可以发现，`find`方法会将符合条件的所有节点选择出来，结果的类型是`pyquery`类型。\n\n`find`的查找范围是节点的所有子孙节点，而如果我们只想查找子节点，那可以用`children`方法：\n\n```python\nlis = items.children()\nprint(type(lis))\nprint(lis)\n```\n\n运行结果：\n\n```python\n<class 'pyquery.pyquery.PyQuery'>\n<li class=\"item-0\">first item</li>\n        <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n        <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n        <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n```\n\n如果要筛选所有子节点中符合条件的节点，比如想筛选出子节点中`class`为`active`的节点，可以向`children`方法传入`CSS`选择器`.active`，代码如下：\n\n```python\nlis = items.children('.active')\nprint(lis)\n```\n\n结果如下：\n\n```python\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n        <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n```\n\n输出的结果做了筛选，留下了`class`为`active`的节点。\n\n### 父节点\n\n可以用`parent`方法获取某个节点的父节点：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\ndoc = pq(html)\nitems = doc('.list')\ncontainer = items.parent()\nprint(type(container))\nprint(container)\n```\n\n运行结果如下：\n\n```python\n<class 'pyquery.pyquery.PyQuery'>\n<div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n```\n\n用`.list`选取`class`为`list`的节点，然后调用`parent`方法得到其父节点，其类型依然是`pyquery`类型。这里的父节点是该节点的直接父节点，也就是说，它不会再去查找父节点的父节点，即祖先节点。\n\n如果你想获取某个祖先节点，该怎么办呢？可以用`parents`方法：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\ndoc = pq(html)\nitems = doc('.list')\ncontainer = items.parents()\nprint(type(container))\nprint(container)\n```\n\n运行结果如下：\n\n```python\n<class 'pyquery.pyquery.PyQuery'>\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div><div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n```\n\n输出结果有两个：一个是`class`为`wrap`的节点，一个是`id`为`container`的节点。也就是说，使用`parents`方法会返回所有的祖先节点。\n\n要筛选某个祖先节点的话，可以向`parents`方法传入`CSS`选择器，这样就会返回祖先节点中符合`CSS`选择器的节点：\n\n```python\nparent = items.parents('.wrap')\nprint(parent)\n```\n\n结果如下：\n\n```python\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n```\n\n输出结果少了一个节点，只保留了`class`为`wrap`的节点。\n\n### 兄弟节点\n\n要获取兄弟节点，可以使用`siblings`方法。这里还是以上面的`HTML`代码为例：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\nli = doc('.list .item-0.active')\nprint(li.siblings())\n```\n\n结果如下：\n\n```python\n<li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n```\n\n先选择`class`为`list`的节点，内部`class`为`item-0`和`active`的节点，也就是第3个`li`节点。很明显，它的兄弟节点有4个，那就是第`1`、`2`、`4`、`5 `个`li`节点。结果显示的正是4个兄弟节点。\n\n筛选某个兄弟节点，可以用`siblings`方法传入`CSS`选择器，这样就会从所有兄弟节点中挑选出符合条件的节点了：\n\n```python\nfrom pyquery import PyQuery as pq\ndoc = pq(html)\nli = doc('.list .item-0.active')\nprint(li.siblings('.active')) \n```\n\n筛选`class`为`active`的节点，从刚才的结果中可以观察到，`class`为`active`兄弟节点的是第4个`li`节点，所以结果应该是1个。运行结果：\n\n```python\n<li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n```\n\n## 遍历\n\n`pyquery`的选择结果既可能是多个节点，也可能是单个节点，类型都是`pyquery`类型，并没有返回列表。对于单个节点来说，可以直接打印输出，也可以直接转成字符串：\n\n```python\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\nli = doc('.item-0.active')\nprint(li)\nprint(str(li))\n```\n\n运行结果如下：\n\n```python\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n```\n\n对于有多个节点的结果，我们就需要用遍历来获取了。例如，如果要把每一个`li`节点进行遍历，需要调用`items`方法：\n\n```python\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\nlis = doc('li').items()\nprint(type(lis))\nfor li in lis:\n    print(li, type(li))\n```\n\n运行结果如下：\n\n```python\n<class 'generator'>\n<li class=\"item-0\">first item</li>\n             <class 'pyquery.pyquery.PyQuery'>\n<li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n             <class 'pyquery.pyquery.PyQuery'>\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n             <class 'pyquery.pyquery.PyQuery'>\n<li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n             <class 'pyquery.pyquery.PyQuery'>\n<li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n         <class 'pyquery.pyquery.PyQuery'>\n```\n\n调用`items`方法后，会得到一个生成器，遍历一下，就可以逐个得到`li`节点对象了，它的类型也是`pyquery`类型。每个`li`节点还可以调用前面所说的方法进行选择，比如继续查询子节点，寻找某个祖先节点等。\n\n## 获取信息\n\n提取到节点之后，最终目的是提取节点包含的信息。比较重要的信息有两类，一是获取属性，二是获取文本。\n\n### 获取属性\n\n提取到某个`pyquery`类型的节点后，就可以调用`attr`方法来获取属性：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\na = doc('.item-0.active a')\nprint(a, type(a))\nprint(a.attr('href'))\n```\n\n运行结果如下：\n\n```python\n<a href=\"link3.html\"><span class=\"bold\">third item</span></a> <class 'pyquery.pyquery.PyQuery'>\nlink3.html\n```\n\n首先选中`class`为`item-0`和`active`的`li`节点内的`a`节点，它的类型是`pyquery`类型。然后调用`attr`方法。在这个方法中传入属性的名称，就可以得到属性值了。此外，也可以通过调用`attr`属性来获取属性值，用法如下：\n\n```python\nprint(a.attr.href)\n```\n\n结果：`link3.html`，这两种方法的结果完全一样。\n\n### 获取文本\n\n获取节点之后的另一个主要操作就是获取其内部文本了，此时可以调用`text`方法来实现：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\na = doc('.item-0.active a')\nprint(a)\nprint(a.text())\n```\n\n运行结果如下：\n\n```python\n<a href=\"link3.html\"><span class=\"bold\">third item</span></a>\nthird item\n```\n\n首先选中一个`a`节点，然后调用`text`方法，就可以获取其内部的文本信息了。`text`会忽略节点内部包含的所有`HTML`，只返回纯文字内容。\n\n如果想要获取这个节点内部的`HTML`文本，就要用`html`方法：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\nli = doc('.item-0.active')\nprint(li)\nprint(li.html())\n``\n这里我们选中第3个`li`节点，然后调用`html`方法，它返回的结果应该是`li`节点内的所有`HTML`文本。运行结果如下：\n\n```python\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n<a href=\"link3.html\"><span class=\"bold\">third item</span></a>\n```\n\n如果我们选中的结果是多个节点，`text`或`html`方法会返回什么内容？我们用实例来看一下：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\nli = doc('li')\nprint(li.html())\nprint(li.text())\nprint(type(li.text()))\n```\n\n运行结果如下：\n\n```python\nfirst item\nfirst item second item third item fourth item fifth item\n<class 'str'>\n```\n\n`html`方法返回的是第1个`li`节点的内部`HTML`文本，而`text`则返回了所有的`li`节点内部的纯文本，中间用一个空格分割开，即返回结果是一个字符串。\n\n## 节点操作\n\n`pyquery`提供了一系列方法来对节点进行动态修改，比如为某个节点添加一个`class`，移除某个节点等，这些操作有时会为提取信息带来极大的便利。\n由于节点操作的方法太多，下面举几个典型的例子来说明它的用法。\n\n### addClass和removeClass\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\nli = doc('.item-0.active')\nprint(li)\nli.remove_class('active')\nprint(li)\nli.add_class('active')\nprint(li)\n```\n\n首先选中第3个`li`节点，然后调用`removeClass`方法，将`li`节点的`active`这`class`移除，第2步调用`addClass`方法，将`class`添加回来。每执行一次操作，就打印输出当前`li`节点的内容。\n\n运行结果如下：\n\n```python\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n\n<li class=\"item-0\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n```\n\n一共输出了3次。第2次输出时，`li`节点的`active`这个`class`被移除了，第3次`class`又添加回来了。`addClass`和`removeClass`方法可以动态改变节点的`class`属性。\n\n### attr、text、html\n\n除了操作`class`这个属性外，也可以用`attr`方法对属性进行操作。此外，还可以用`text`和`html`方法来改变节点内部的内容。示例如下：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\n\nli = doc('.item-0.active')\nprint(li)\nli.attr('name', 'link')\nprint(li)\nli.text('changed item')\nprint(li)\nli.html('<span>changed item</span>')\nprint(li)\n```\n\n首先选中`li`节点，然后调用`attr`方法来修改属性。该方法的第1个参数为属性名，第2个参数为属性值。最后调用`text`和`html`方法来改变节点内部的内容。3次操作后，分别打印输出当前的`li`节点。 运行结果如下：\n\n```python\n<li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n\n<li class=\"item-0 active\" name=\"link\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n\n<li class=\"item-0 active\" name=\"link\">changed item</li>\n\n<li class=\"item-0 active\" name=\"link\"><span>changed item</span></li>\n```\n\n调用`attr`方法后，`li`节点多了一个原本不存在的属性`name`，其值为`link`。接着调用`text`方法传入文本，`li`节点内部的文本全被改为传入的字符串文本。最后，调用`html`方法传入`HTML`文本，`li`节点内部又变为传入的`HTML`文本了。\n\n使用`attr`方法时如果只传入第1个参数的属性名，则是获取这个属性值；如果传入第2个参数，可以用来修改属性值。使用`text`和`html`方法时如果不传参数，则是获取节点内纯文本和`HTML`文本，如果传入参数，则进行赋值。\n\n### remove\n\n`remove`方法就是移除，它有时会为信息的提取带来非常大的便利。下面有一段 HTML文本：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    hello, world\n    <p>This is a paragraph.</p>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\n\ndoc = pq(html)\nwrap = doc('.wrap')\nprint(wrap.text())\n```\n\n想提取`“Hello, World”`这个字符串，该怎样操作呢？\n\n这里先直接尝试提取`class`为`wrap`的节点的内容，看看是不是我们想要的。\n\n运行结果如下：\n\n```python\nHello, World This is a paragraph.\n```\n\n这个结果还包含了内部的`p`节点的内容，也就是说`text`把所有的纯文本全提取出来了。\n\n如果想去掉`p`节点内部的文本，可以选择再把`p`节点内的文本提取一遍，然后从整个结果中移除这个子串，但这个做法明显比较烦琐。\n\n这时`remove`方法就可以派上用场了，可以接着这么做：\n\n```python\nwrap.find('p').remove()\nprint(wrap.text())\n```\n\n首先选中`p`节点，然后调用`remove`方法将其移除，这时`wrap`内部就只剩下`“Hello, World”`这句话了，最后利用`text`方法提取即可。\n\n其实还有很多其他节点操作的方法，比如`append`、`empty`和`prepend`等方法，详细的用法可以参考官方文档：[http://pyquery.readthedocs.io/en/latest/api.html](http://pyquery.readthedocs.io/en/latest/api.html)。\n\n## 伪类选择器\n\n`CSS`选择器之所以强大，还有一个很重要的原因，那就是它支持多种多样的伪类选择器，例如选择第一个节点、最后一个节点、奇偶数节点、包含某一文本的节点等。示例如下：\n\n```python\nhtml = '''\n<div class=\"wrap\">\n    <div id=\"container\">\n        <ul class=\"list\">\n            <li class=\"item-0\">first item</li>\n            <li class=\"item-1\"><a href=\"link2.html\">second item</a></li>\n            <li class=\"item-0 active\"><a href=\"link3.html\"><span class=\"bold\">third item</span></a></li>\n            <li class=\"item-1 active\"><a href=\"link4.html\">fourth item</a></li>\n            <li class=\"item-0\"><a href=\"link5.html\">fifth item</a></li>\n        </ul>\n    </div>\n</div>\n'''\n\nfrom pyquery import PyQuery as pq\ndoc = pq(html)\nli = doc('li:first-child')\nprint(li)\nli = doc('li:last-child')\nprint(li)\nli = doc('li:nth-child(2)')\nprint(li)\nli = doc('li:gt(2)')\nprint(li)\nli = doc('li:nth-child(2n)')\nprint(li)\nli = doc('li:contains(second)')\nprint(li)\n```\n\n在这个例子中使用了`CSS3`的伪类选择器，依次选择了第1个`li`节点、最后一个`li`节点、第2个`li`节点、第3个`li`之后的`li`节点、偶数位置的`li`节点、包含`second`文本的`li`节点。\n","slug":"Pyquery的使用","published":1,"updated":"2021-06-15T03:24:11.474Z","layout":"post","photos":[],"link":"","_id":"ckq14rx3t007244ud3upigfwe","content":"<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p><code>pyquery</code>是<code>Python</code>的第三方库，安装命令如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install pyquery</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h2><p>解析<code>HTML</code>文本的时候，首先需要将其初始化为一个<code>pyquery</code>对象。它的初始化方式有多种，比如直接<strong>传入字符串</strong>、<strong>传入<code>URL</code><strong>、</strong>传入文件名</strong>，等等。</p>\n<h3 id=\"字符串初始化\"><a href=\"#字符串初始化\" class=\"headerlink\" title=\"字符串初始化\"></a>字符串初始化</h3><p>可以直接把<code>HTML</code>的内容当作参数来初始化<code>pyquery</code>对象。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27; </span></span><br><span class=\"line\"><span class=\"string\">&lt;div&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;ul&gt; </span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt; </span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/ul&gt; </span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt; </span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq </span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(doc(<span class=\"string\">&#x27;li&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt; </span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt; </span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt; </span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>引入<code>pyquery</code>这个对象，取别名为<code>pq</code>，然后声明了一个长<code>HTML</code>字符串，并将其当作参数传递给<code>pyquery</code>类，这样就成功完成了初始化。</p>\n<p>接下来，将初始化的对象传入<code>CSS</code>选择器。在这个实例中，传入<code>li</code>节点，这样就可以选择所有的<code>li</code>节点。</p>\n<h3 id=\"URL初始化\"><a href=\"#URL初始化\" class=\"headerlink\" title=\"URL初始化\"></a>URL初始化</h3><p>初始化的参数不仅可以以字符串的形式传递，还可以传入网页的<code>URL</code>，只需要指定参数为<code>url</code>即可：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq </span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(url=<span class=\"string\">&#x27;https://www.holychan.ltd&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(doc(<span class=\"string\">&#x27;title&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;title&gt;Holy的个人站点&lt;/title&gt;</span><br></pre></td></tr></table></figure>\n\n<p><code>pyquery</code>对象会首先请求这个<code>URL</code>，然后用得到的<code>HTML</code>内容完成初始化。这就相当于将网页的源代码以字符串的形式传递给<code>pyquery</code>类来初始化。</p>\n<p>它与下面的功能是相同的：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(requests.get(<span class=\"string\">&#x27;https://www.holychan.ltd&#x27;</span>).text)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(doc(<span class=\"string\">&#x27;title&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"文件初始化\"><a href=\"#文件初始化\" class=\"headerlink\" title=\"文件初始化\"></a>文件初始化</h3><p>除了传递一个<code>URL</code>，还可以传递本地的文件名，参数指定为<code>filename</code>即可：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(filename=<span class=\"string\">&#x27;demo.html&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(doc(<span class=\"string\">&#x27;li&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<p>这里需要有一个本地<code>HTML</code>文件<code>demo.html</code>，其内容是待解析的<code>HTML</code>字符串。这样它会先读取本地的文件内容，然后将文件内容以字符串的形式传递给 <code>pyquery</code>类来初始化。</p>\n<p>以上3种方式均可初始化，当然最常用的初始化方式还是以字符串形式传递。</p>\n<h2 id=\"基本CSS选择器\"><a href=\"#基本CSS选择器\" class=\"headerlink\" title=\"基本CSS选择器\"></a>基本CSS选择器</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt; </span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span> </span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq </span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(doc(<span class=\"string\">&#x27;#container .list li&#x27;</span>))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(doc(<span class=\"string\">&#x27;#container .list li&#x27;</span>)))</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>初始化<code>pyquery</code>对象之后，传入<code>CSS</code>选择器<code>#container .list li</code>，它的意思是先选取<code>id</code>为<code>container</code>的节点，然后再选取其内部<code>class</code>为<code>list</code>的所有<code>li</code>节点，最后打印输出。成功获取到了符合条件的节点。将它的类型打印输出后发现，它的类型依然是<code>pyquery</code>类型。</p>\n<p>直接遍历这些节点，然后调用<code>text</code>方法，就可以获取节点的文本内容，代码示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> doc(<span class=\"string\">&#x27;#container .list li&#x27;</span>).items():</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(item.text())</span><br></pre></td></tr></table></figure>\n\n<p>结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">first item</span><br><span class=\"line\">second item</span><br><span class=\"line\">third item</span><br><span class=\"line\">fourth item</span><br><span class=\"line\">fifth item</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"查找节点\"><a href=\"#查找节点\" class=\"headerlink\" title=\"查找节点\"></a>查找节点</h2><h3 id=\"子节点\"><a href=\"#子节点\" class=\"headerlink\" title=\"子节点\"></a>子节点</h3><p>查找子节点需要用到<code>find</code>方法，传入的参数是<code>CSS</code>选择器：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt; </span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">items = doc(<span class=\"string\">&#x27;.list&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(items))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(items)</span><br><span class=\"line\">lis = items.find(<span class=\"string\">&#x27;li&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(lis))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(lis)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">ul</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">list</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;/<span class=\"title\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>通过<code>.list</code>参数选取<code>class</code>为<code>list</code>的节点，然后调用<code>find</code>方法，传入<code>CSS</code>选择器，选取其内部的<code>li</code>节点，最后打印输出。可以发现，<code>find</code>方法会将符合条件的所有节点选择出来，结果的类型是<code>pyquery</code>类型。</p>\n<p><code>find</code>的查找范围是节点的所有子孙节点，而如果我们只想查找子节点，那可以用<code>children</code>方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lis = items.children()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(lis))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(lis)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果要筛选所有子节点中符合条件的节点，比如想筛选出子节点中<code>class</code>为<code>active</code>的节点，可以向<code>children</code>方法传入<code>CSS</code>选择器<code>.active</code>，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lis = items.children(<span class=\"string\">&#x27;.active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(lis)</span><br></pre></td></tr></table></figure>\n\n<p>结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>输出的结果做了筛选，留下了<code>class</code>为<code>active</code>的节点。</p>\n<h3 id=\"父节点\"><a href=\"#父节点\" class=\"headerlink\" title=\"父节点\"></a>父节点</h3><p>可以用<code>parent</code>方法获取某个节点的父节点：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\">items = doc(<span class=\"string\">&#x27;.list&#x27;</span>)</span><br><span class=\"line\">container = items.parent()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(container))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(container)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">div</span> <span class=\"title\">id</span>=&quot;<span class=\"title\">container</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">ul</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">list</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;/<span class=\"title\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;/<span class=\"title\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>用<code>.list</code>选取<code>class</code>为<code>list</code>的节点，然后调用<code>parent</code>方法得到其父节点，其类型依然是<code>pyquery</code>类型。这里的父节点是该节点的直接父节点，也就是说，它不会再去查找父节点的父节点，即祖先节点。</p>\n<p>如果你想获取某个祖先节点，该怎么办呢？可以用<code>parents</code>方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\">items = doc(<span class=\"string\">&#x27;.list&#x27;</span>)</span><br><span class=\"line\">container = items.parents()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(container))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(container)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">div</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">wrap</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;<span class=\"title\">div</span> <span class=\"title\">id</span>=&quot;<span class=\"title\">container</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">ul</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">list</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;/<span class=\"title\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;/<span class=\"title\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;/<span class=\"title\">div</span>&gt;&lt;<span class=\"title\">div</span> <span class=\"title\">id</span>=&quot;<span class=\"title\">container</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">ul</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">list</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;/<span class=\"title\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;/<span class=\"title\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>输出结果有两个：一个是<code>class</code>为<code>wrap</code>的节点，一个是<code>id</code>为<code>container</code>的节点。也就是说，使用<code>parents</code>方法会返回所有的祖先节点。</p>\n<p>要筛选某个祖先节点的话，可以向<code>parents</code>方法传入<code>CSS</code>选择器，这样就会返回祖先节点中符合<code>CSS</code>选择器的节点：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">parent = items.parents(<span class=\"string\">&#x27;.wrap&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(parent)</span><br></pre></td></tr></table></figure>\n\n<p>结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">wrap</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;<span class=\"title\">div</span> <span class=\"title\">id</span>=&quot;<span class=\"title\">container</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">ul</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">list</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;/<span class=\"title\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;/<span class=\"title\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;/<span class=\"title\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>输出结果少了一个节点，只保留了<code>class</code>为<code>wrap</code>的节点。</p>\n<h3 id=\"兄弟节点\"><a href=\"#兄弟节点\" class=\"headerlink\" title=\"兄弟节点\"></a>兄弟节点</h3><p>要获取兄弟节点，可以使用<code>siblings</code>方法。这里还是以上面的<code>HTML</code>代码为例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;.list .item-0.active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li.siblings())</span><br></pre></td></tr></table></figure>\n\n<p>结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>先选择<code>class</code>为<code>list</code>的节点，内部<code>class</code>为<code>item-0</code>和<code>active</code>的节点，也就是第3个<code>li</code>节点。很明显，它的兄弟节点有4个，那就是第<code>1</code>、<code>2</code>、<code>4</code>、<code>5 </code>个<code>li</code>节点。结果显示的正是4个兄弟节点。</p>\n<p>筛选某个兄弟节点，可以用<code>siblings</code>方法传入<code>CSS</code>选择器，这样就会从所有兄弟节点中挑选出符合条件的节点了：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;.list .item-0.active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li.siblings(<span class=\"string\">&#x27;.active&#x27;</span>)) </span><br></pre></td></tr></table></figure>\n\n<p>筛选<code>class</code>为<code>active</code>的节点，从刚才的结果中可以观察到，<code>class</code>为<code>active</code>兄弟节点的是第4个<code>li</code>节点，所以结果应该是1个。运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"遍历\"><a href=\"#遍历\" class=\"headerlink\" title=\"遍历\"></a>遍历</h2><p><code>pyquery</code>的选择结果既可能是多个节点，也可能是单个节点，类型都是<code>pyquery</code>类型，并没有返回列表。对于单个节点来说，可以直接打印输出，也可以直接转成字符串：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;.item-0.active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">str</span>(li))</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>对于有多个节点的结果，我们就需要用遍历来获取了。例如，如果要把每一个<code>li</code>节点进行遍历，需要调用<code>items</code>方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\">lis = doc(<span class=\"string\">&#x27;li&#x27;</span>).items()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(lis))</span><br><span class=\"line\"><span class=\"keyword\">for</span> li <span class=\"keyword\">in</span> lis:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(li, <span class=\"built_in\">type</span>(li))</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">generator</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">             &lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">             &lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">             &lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">             &lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">         &lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>调用<code>items</code>方法后，会得到一个生成器，遍历一下，就可以逐个得到<code>li</code>节点对象了，它的类型也是<code>pyquery</code>类型。每个<code>li</code>节点还可以调用前面所说的方法进行选择，比如继续查询子节点，寻找某个祖先节点等。</p>\n<h2 id=\"获取信息\"><a href=\"#获取信息\" class=\"headerlink\" title=\"获取信息\"></a>获取信息</h2><p>提取到节点之后，最终目的是提取节点包含的信息。比较重要的信息有两类，一是获取属性，二是获取文本。</p>\n<h3 id=\"获取属性\"><a href=\"#获取属性\" class=\"headerlink\" title=\"获取属性\"></a>获取属性</h3><p>提取到某个<code>pyquery</code>类型的节点后，就可以调用<code>attr</code>方法来获取属性：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">a = doc(<span class=\"string\">&#x27;.item-0.active a&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(a, <span class=\"built_in\">type</span>(a))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(a.attr(<span class=\"string\">&#x27;href&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;a href=<span class=\"string\">&quot;link3.html&quot;</span>&gt;&lt;span <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt; &lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">link3</span>.<span class=\"title\">html</span></span></span><br></pre></td></tr></table></figure>\n\n<p>首先选中<code>class</code>为<code>item-0</code>和<code>active</code>的<code>li</code>节点内的<code>a</code>节点，它的类型是<code>pyquery</code>类型。然后调用<code>attr</code>方法。在这个方法中传入属性的名称，就可以得到属性值了。此外，也可以通过调用<code>attr</code>属性来获取属性值，用法如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(a.attr.href)</span><br></pre></td></tr></table></figure>\n\n<p>结果：<code>link3.html</code>，这两种方法的结果完全一样。</p>\n<h3 id=\"获取文本\"><a href=\"#获取文本\" class=\"headerlink\" title=\"获取文本\"></a>获取文本</h3><p>获取节点之后的另一个主要操作就是获取其内部文本了，此时可以调用<code>text</code>方法来实现：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">a = doc(<span class=\"string\">&#x27;.item-0.active a&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(a)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(a.text())</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;a href=<span class=\"string\">&quot;link3.html&quot;</span>&gt;&lt;span <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">third</span> <span class=\"title\">item</span></span></span><br></pre></td></tr></table></figure>\n\n<p>首先选中一个<code>a</code>节点，然后调用<code>text</code>方法，就可以获取其内部的文本信息了。<code>text</code>会忽略节点内部包含的所有<code>HTML</code>，只返回纯文字内容。</p>\n<p>如果想要获取这个节点内部的<code>HTML</code>文本，就要用<code>html</code>方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;.item-0.active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li.html())</span><br><span class=\"line\">``</span><br><span class=\"line\">这里我们选中第<span class=\"number\">3</span>个`li`节点，然后调用`html`方法，它返回的结果应该是`li`节点内的所有`HTML`文本。运行结果如下：</span><br><span class=\"line\"></span><br><span class=\"line\">```python</span><br><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果我们选中的结果是多个节点，<code>text</code>或<code>html</code>方法会返回什么内容？我们用实例来看一下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;li&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li.html())</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li.text())</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(li.text()))</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">first item</span><br><span class=\"line\">first item second item third item fourth item fifth item</span><br><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">str</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>html</code>方法返回的是第1个<code>li</code>节点的内部<code>HTML</code>文本，而<code>text</code>则返回了所有的<code>li</code>节点内部的纯文本，中间用一个空格分割开，即返回结果是一个字符串。</p>\n<h2 id=\"节点操作\"><a href=\"#节点操作\" class=\"headerlink\" title=\"节点操作\"></a>节点操作</h2><p><code>pyquery</code>提供了一系列方法来对节点进行动态修改，比如为某个节点添加一个<code>class</code>，移除某个节点等，这些操作有时会为提取信息带来极大的便利。<br>由于节点操作的方法太多，下面举几个典型的例子来说明它的用法。</p>\n<h3 id=\"addClass和removeClass\"><a href=\"#addClass和removeClass\" class=\"headerlink\" title=\"addClass和removeClass\"></a>addClass和removeClass</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;.item-0.active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li.remove_class(<span class=\"string\">&#x27;active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li.add_class(<span class=\"string\">&#x27;active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br></pre></td></tr></table></figure>\n\n<p>首先选中第3个<code>li</code>节点，然后调用<code>removeClass</code>方法，将<code>li</code>节点的<code>active</code>这<code>class</code>移除，第2步调用<code>addClass</code>方法，将<code>class</code>添加回来。每执行一次操作，就打印输出当前<code>li</code>节点的内容。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>一共输出了3次。第2次输出时，<code>li</code>节点的<code>active</code>这个<code>class</code>被移除了，第3次<code>class</code>又添加回来了。<code>addClass</code>和<code>removeClass</code>方法可以动态改变节点的<code>class</code>属性。</p>\n<h3 id=\"attr、text、html\"><a href=\"#attr、text、html\" class=\"headerlink\" title=\"attr、text、html\"></a>attr、text、html</h3><p>除了操作<code>class</code>这个属性外，也可以用<code>attr</code>方法对属性进行操作。此外，还可以用<code>text</code>和<code>html</code>方法来改变节点内部的内容。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;.item-0.active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li.attr(<span class=\"string\">&#x27;name&#x27;</span>, <span class=\"string\">&#x27;link&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li.text(<span class=\"string\">&#x27;changed item&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li.html(<span class=\"string\">&#x27;&lt;span&gt;changed item&lt;/span&gt;&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br></pre></td></tr></table></figure>\n\n<p>首先选中<code>li</code>节点，然后调用<code>attr</code>方法来修改属性。该方法的第1个参数为属性名，第2个参数为属性值。最后调用<code>text</code>和<code>html</code>方法来改变节点内部的内容。3次操作后，分别打印输出当前的<code>li</code>节点。 运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot; <span class=\"title\">name</span>=&quot;<span class=\"title\">link</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot; <span class=\"title\">name</span>=&quot;<span class=\"title\">link</span>&quot;&gt;<span class=\"title\">changed</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot; <span class=\"title\">name</span>=&quot;<span class=\"title\">link</span>&quot;&gt;&lt;<span class=\"title\">span</span>&gt;<span class=\"title\">changed</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>调用<code>attr</code>方法后，<code>li</code>节点多了一个原本不存在的属性<code>name</code>，其值为<code>link</code>。接着调用<code>text</code>方法传入文本，<code>li</code>节点内部的文本全被改为传入的字符串文本。最后，调用<code>html</code>方法传入<code>HTML</code>文本，<code>li</code>节点内部又变为传入的<code>HTML</code>文本了。</p>\n<p>使用<code>attr</code>方法时如果只传入第1个参数的属性名，则是获取这个属性值；如果传入第2个参数，可以用来修改属性值。使用<code>text</code>和<code>html</code>方法时如果不传参数，则是获取节点内纯文本和<code>HTML</code>文本，如果传入参数，则进行赋值。</p>\n<h3 id=\"remove\"><a href=\"#remove\" class=\"headerlink\" title=\"remove\"></a>remove</h3><p><code>remove</code>方法就是移除，它有时会为信息的提取带来非常大的便利。下面有一段 HTML文本：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    hello, world</span></span><br><span class=\"line\"><span class=\"string\">    &lt;p&gt;This is a paragraph.&lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\">wrap = doc(<span class=\"string\">&#x27;.wrap&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(wrap.text())</span><br></pre></td></tr></table></figure>\n\n<p>想提取<code>“Hello, World”</code>这个字符串，该怎样操作呢？</p>\n<p>这里先直接尝试提取<code>class</code>为<code>wrap</code>的节点的内容，看看是不是我们想要的。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Hello, World This <span class=\"keyword\">is</span> a paragraph.</span><br></pre></td></tr></table></figure>\n\n<p>这个结果还包含了内部的<code>p</code>节点的内容，也就是说<code>text</code>把所有的纯文本全提取出来了。</p>\n<p>如果想去掉<code>p</code>节点内部的文本，可以选择再把<code>p</code>节点内的文本提取一遍，然后从整个结果中移除这个子串，但这个做法明显比较烦琐。</p>\n<p>这时<code>remove</code>方法就可以派上用场了，可以接着这么做：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wrap.find(<span class=\"string\">&#x27;p&#x27;</span>).remove()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(wrap.text())</span><br></pre></td></tr></table></figure>\n\n<p>首先选中<code>p</code>节点，然后调用<code>remove</code>方法将其移除，这时<code>wrap</code>内部就只剩下<code>“Hello, World”</code>这句话了，最后利用<code>text</code>方法提取即可。</p>\n<p>其实还有很多其他节点操作的方法，比如<code>append</code>、<code>empty</code>和<code>prepend</code>等方法，详细的用法可以参考官方文档：<a href=\"http://pyquery.readthedocs.io/en/latest/api.html\">http://pyquery.readthedocs.io/en/latest/api.html</a>。</p>\n<h2 id=\"伪类选择器\"><a href=\"#伪类选择器\" class=\"headerlink\" title=\"伪类选择器\"></a>伪类选择器</h2><p><code>CSS</code>选择器之所以强大，还有一个很重要的原因，那就是它支持多种多样的伪类选择器，例如选择第一个节点、最后一个节点、奇偶数节点、包含某一文本的节点等。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;li:first-child&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;li:last-child&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;li:nth-child(2)&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;li:gt(2)&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;li:nth-child(2n)&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;li:contains(second)&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br></pre></td></tr></table></figure>\n\n<p>在这个例子中使用了<code>CSS3</code>的伪类选择器，依次选择了第1个<code>li</code>节点、最后一个<code>li</code>节点、第2个<code>li</code>节点、第3个<code>li</code>之后的<code>li</code>节点、偶数位置的<code>li</code>节点、包含<code>second</code>文本的<code>li</code>节点。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p><code>pyquery</code>是<code>Python</code>的第三方库，安装命令如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install pyquery</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h2><p>解析<code>HTML</code>文本的时候，首先需要将其初始化为一个<code>pyquery</code>对象。它的初始化方式有多种，比如直接<strong>传入字符串</strong>、<strong>传入<code>URL</code><strong>、</strong>传入文件名</strong>，等等。</p>\n<h3 id=\"字符串初始化\"><a href=\"#字符串初始化\" class=\"headerlink\" title=\"字符串初始化\"></a>字符串初始化</h3><p>可以直接把<code>HTML</code>的内容当作参数来初始化<code>pyquery</code>对象。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27; </span></span><br><span class=\"line\"><span class=\"string\">&lt;div&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;ul&gt; </span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt; </span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/ul&gt; </span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt; </span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq </span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(doc(<span class=\"string\">&#x27;li&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt; </span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt; </span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt; </span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>引入<code>pyquery</code>这个对象，取别名为<code>pq</code>，然后声明了一个长<code>HTML</code>字符串，并将其当作参数传递给<code>pyquery</code>类，这样就成功完成了初始化。</p>\n<p>接下来，将初始化的对象传入<code>CSS</code>选择器。在这个实例中，传入<code>li</code>节点，这样就可以选择所有的<code>li</code>节点。</p>\n<h3 id=\"URL初始化\"><a href=\"#URL初始化\" class=\"headerlink\" title=\"URL初始化\"></a>URL初始化</h3><p>初始化的参数不仅可以以字符串的形式传递，还可以传入网页的<code>URL</code>，只需要指定参数为<code>url</code>即可：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq </span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(url=<span class=\"string\">&#x27;https://www.holychan.ltd&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(doc(<span class=\"string\">&#x27;title&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;title&gt;Holy的个人站点&lt;/title&gt;</span><br></pre></td></tr></table></figure>\n\n<p><code>pyquery</code>对象会首先请求这个<code>URL</code>，然后用得到的<code>HTML</code>内容完成初始化。这就相当于将网页的源代码以字符串的形式传递给<code>pyquery</code>类来初始化。</p>\n<p>它与下面的功能是相同的：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(requests.get(<span class=\"string\">&#x27;https://www.holychan.ltd&#x27;</span>).text)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(doc(<span class=\"string\">&#x27;title&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"文件初始化\"><a href=\"#文件初始化\" class=\"headerlink\" title=\"文件初始化\"></a>文件初始化</h3><p>除了传递一个<code>URL</code>，还可以传递本地的文件名，参数指定为<code>filename</code>即可：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(filename=<span class=\"string\">&#x27;demo.html&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(doc(<span class=\"string\">&#x27;li&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<p>这里需要有一个本地<code>HTML</code>文件<code>demo.html</code>，其内容是待解析的<code>HTML</code>字符串。这样它会先读取本地的文件内容，然后将文件内容以字符串的形式传递给 <code>pyquery</code>类来初始化。</p>\n<p>以上3种方式均可初始化，当然最常用的初始化方式还是以字符串形式传递。</p>\n<h2 id=\"基本CSS选择器\"><a href=\"#基本CSS选择器\" class=\"headerlink\" title=\"基本CSS选择器\"></a>基本CSS选择器</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt; </span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span> </span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq </span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(doc(<span class=\"string\">&#x27;#container .list li&#x27;</span>))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(doc(<span class=\"string\">&#x27;#container .list li&#x27;</span>)))</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>初始化<code>pyquery</code>对象之后，传入<code>CSS</code>选择器<code>#container .list li</code>，它的意思是先选取<code>id</code>为<code>container</code>的节点，然后再选取其内部<code>class</code>为<code>list</code>的所有<code>li</code>节点，最后打印输出。成功获取到了符合条件的节点。将它的类型打印输出后发现，它的类型依然是<code>pyquery</code>类型。</p>\n<p>直接遍历这些节点，然后调用<code>text</code>方法，就可以获取节点的文本内容，代码示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> doc(<span class=\"string\">&#x27;#container .list li&#x27;</span>).items():</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(item.text())</span><br></pre></td></tr></table></figure>\n\n<p>结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">first item</span><br><span class=\"line\">second item</span><br><span class=\"line\">third item</span><br><span class=\"line\">fourth item</span><br><span class=\"line\">fifth item</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"查找节点\"><a href=\"#查找节点\" class=\"headerlink\" title=\"查找节点\"></a>查找节点</h2><h3 id=\"子节点\"><a href=\"#子节点\" class=\"headerlink\" title=\"子节点\"></a>子节点</h3><p>查找子节点需要用到<code>find</code>方法，传入的参数是<code>CSS</code>选择器：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt; </span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">items = doc(<span class=\"string\">&#x27;.list&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(items))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(items)</span><br><span class=\"line\">lis = items.find(<span class=\"string\">&#x27;li&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(lis))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(lis)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">ul</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">list</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;/<span class=\"title\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>通过<code>.list</code>参数选取<code>class</code>为<code>list</code>的节点，然后调用<code>find</code>方法，传入<code>CSS</code>选择器，选取其内部的<code>li</code>节点，最后打印输出。可以发现，<code>find</code>方法会将符合条件的所有节点选择出来，结果的类型是<code>pyquery</code>类型。</p>\n<p><code>find</code>的查找范围是节点的所有子孙节点，而如果我们只想查找子节点，那可以用<code>children</code>方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lis = items.children()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(lis))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(lis)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果要筛选所有子节点中符合条件的节点，比如想筛选出子节点中<code>class</code>为<code>active</code>的节点，可以向<code>children</code>方法传入<code>CSS</code>选择器<code>.active</code>，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lis = items.children(<span class=\"string\">&#x27;.active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(lis)</span><br></pre></td></tr></table></figure>\n\n<p>结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>输出的结果做了筛选，留下了<code>class</code>为<code>active</code>的节点。</p>\n<h3 id=\"父节点\"><a href=\"#父节点\" class=\"headerlink\" title=\"父节点\"></a>父节点</h3><p>可以用<code>parent</code>方法获取某个节点的父节点：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\">items = doc(<span class=\"string\">&#x27;.list&#x27;</span>)</span><br><span class=\"line\">container = items.parent()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(container))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(container)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">div</span> <span class=\"title\">id</span>=&quot;<span class=\"title\">container</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">ul</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">list</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;/<span class=\"title\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;/<span class=\"title\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>用<code>.list</code>选取<code>class</code>为<code>list</code>的节点，然后调用<code>parent</code>方法得到其父节点，其类型依然是<code>pyquery</code>类型。这里的父节点是该节点的直接父节点，也就是说，它不会再去查找父节点的父节点，即祖先节点。</p>\n<p>如果你想获取某个祖先节点，该怎么办呢？可以用<code>parents</code>方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\">items = doc(<span class=\"string\">&#x27;.list&#x27;</span>)</span><br><span class=\"line\">container = items.parents()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(container))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(container)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">div</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">wrap</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;<span class=\"title\">div</span> <span class=\"title\">id</span>=&quot;<span class=\"title\">container</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">ul</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">list</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;/<span class=\"title\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;/<span class=\"title\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;/<span class=\"title\">div</span>&gt;&lt;<span class=\"title\">div</span> <span class=\"title\">id</span>=&quot;<span class=\"title\">container</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">ul</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">list</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;/<span class=\"title\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;/<span class=\"title\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>输出结果有两个：一个是<code>class</code>为<code>wrap</code>的节点，一个是<code>id</code>为<code>container</code>的节点。也就是说，使用<code>parents</code>方法会返回所有的祖先节点。</p>\n<p>要筛选某个祖先节点的话，可以向<code>parents</code>方法传入<code>CSS</code>选择器，这样就会返回祖先节点中符合<code>CSS</code>选择器的节点：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">parent = items.parents(<span class=\"string\">&#x27;.wrap&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(parent)</span><br></pre></td></tr></table></figure>\n\n<p>结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">wrap</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;<span class=\"title\">div</span> <span class=\"title\">id</span>=&quot;<span class=\"title\">container</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">ul</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">list</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;/<span class=\"title\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;/<span class=\"title\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;/<span class=\"title\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>输出结果少了一个节点，只保留了<code>class</code>为<code>wrap</code>的节点。</p>\n<h3 id=\"兄弟节点\"><a href=\"#兄弟节点\" class=\"headerlink\" title=\"兄弟节点\"></a>兄弟节点</h3><p>要获取兄弟节点，可以使用<code>siblings</code>方法。这里还是以上面的<code>HTML</code>代码为例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;.list .item-0.active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li.siblings())</span><br></pre></td></tr></table></figure>\n\n<p>结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>先选择<code>class</code>为<code>list</code>的节点，内部<code>class</code>为<code>item-0</code>和<code>active</code>的节点，也就是第3个<code>li</code>节点。很明显，它的兄弟节点有4个，那就是第<code>1</code>、<code>2</code>、<code>4</code>、<code>5 </code>个<code>li</code>节点。结果显示的正是4个兄弟节点。</p>\n<p>筛选某个兄弟节点，可以用<code>siblings</code>方法传入<code>CSS</code>选择器，这样就会从所有兄弟节点中挑选出符合条件的节点了：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;.list .item-0.active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li.siblings(<span class=\"string\">&#x27;.active&#x27;</span>)) </span><br></pre></td></tr></table></figure>\n\n<p>筛选<code>class</code>为<code>active</code>的节点，从刚才的结果中可以观察到，<code>class</code>为<code>active</code>兄弟节点的是第4个<code>li</code>节点，所以结果应该是1个。运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"遍历\"><a href=\"#遍历\" class=\"headerlink\" title=\"遍历\"></a>遍历</h2><p><code>pyquery</code>的选择结果既可能是多个节点，也可能是单个节点，类型都是<code>pyquery</code>类型，并没有返回列表。对于单个节点来说，可以直接打印输出，也可以直接转成字符串：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;.item-0.active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">str</span>(li))</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>对于有多个节点的结果，我们就需要用遍历来获取了。例如，如果要把每一个<code>li</code>节点进行遍历，需要调用<code>items</code>方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\">lis = doc(<span class=\"string\">&#x27;li&#x27;</span>).items()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(lis))</span><br><span class=\"line\"><span class=\"keyword\">for</span> li <span class=\"keyword\">in</span> lis:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(li, <span class=\"built_in\">type</span>(li))</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">generator</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;<span class=\"title\">first</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">             &lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link2</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">second</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">             &lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">             &lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-1 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link4</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fourth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">             &lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link5</span>.<span class=\"title\">html</span>&quot;&gt;<span class=\"title\">fifth</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">         &lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>调用<code>items</code>方法后，会得到一个生成器，遍历一下，就可以逐个得到<code>li</code>节点对象了，它的类型也是<code>pyquery</code>类型。每个<code>li</code>节点还可以调用前面所说的方法进行选择，比如继续查询子节点，寻找某个祖先节点等。</p>\n<h2 id=\"获取信息\"><a href=\"#获取信息\" class=\"headerlink\" title=\"获取信息\"></a>获取信息</h2><p>提取到节点之后，最终目的是提取节点包含的信息。比较重要的信息有两类，一是获取属性，二是获取文本。</p>\n<h3 id=\"获取属性\"><a href=\"#获取属性\" class=\"headerlink\" title=\"获取属性\"></a>获取属性</h3><p>提取到某个<code>pyquery</code>类型的节点后，就可以调用<code>attr</code>方法来获取属性：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">a = doc(<span class=\"string\">&#x27;.item-0.active a&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(a, <span class=\"built_in\">type</span>(a))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(a.attr(<span class=\"string\">&#x27;href&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;a href=<span class=\"string\">&quot;link3.html&quot;</span>&gt;&lt;span <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt; &lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">pyquery</span>.<span class=\"title\">pyquery</span>.<span class=\"title\">PyQuery</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">link3</span>.<span class=\"title\">html</span></span></span><br></pre></td></tr></table></figure>\n\n<p>首先选中<code>class</code>为<code>item-0</code>和<code>active</code>的<code>li</code>节点内的<code>a</code>节点，它的类型是<code>pyquery</code>类型。然后调用<code>attr</code>方法。在这个方法中传入属性的名称，就可以得到属性值了。此外，也可以通过调用<code>attr</code>属性来获取属性值，用法如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(a.attr.href)</span><br></pre></td></tr></table></figure>\n\n<p>结果：<code>link3.html</code>，这两种方法的结果完全一样。</p>\n<h3 id=\"获取文本\"><a href=\"#获取文本\" class=\"headerlink\" title=\"获取文本\"></a>获取文本</h3><p>获取节点之后的另一个主要操作就是获取其内部文本了，此时可以调用<code>text</code>方法来实现：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">a = doc(<span class=\"string\">&#x27;.item-0.active a&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(a)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(a.text())</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;a href=<span class=\"string\">&quot;link3.html&quot;</span>&gt;&lt;span <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">third</span> <span class=\"title\">item</span></span></span><br></pre></td></tr></table></figure>\n\n<p>首先选中一个<code>a</code>节点，然后调用<code>text</code>方法，就可以获取其内部的文本信息了。<code>text</code>会忽略节点内部包含的所有<code>HTML</code>，只返回纯文字内容。</p>\n<p>如果想要获取这个节点内部的<code>HTML</code>文本，就要用<code>html</code>方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;.item-0.active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li.html())</span><br><span class=\"line\">``</span><br><span class=\"line\">这里我们选中第<span class=\"number\">3</span>个`li`节点，然后调用`html`方法，它返回的结果应该是`li`节点内的所有`HTML`文本。运行结果如下：</span><br><span class=\"line\"></span><br><span class=\"line\">```python</span><br><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果我们选中的结果是多个节点，<code>text</code>或<code>html</code>方法会返回什么内容？我们用实例来看一下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;li&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li.html())</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li.text())</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(li.text()))</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">first item</span><br><span class=\"line\">first item second item third item fourth item fifth item</span><br><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">str</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>html</code>方法返回的是第1个<code>li</code>节点的内部<code>HTML</code>文本，而<code>text</code>则返回了所有的<code>li</code>节点内部的纯文本，中间用一个空格分割开，即返回结果是一个字符串。</p>\n<h2 id=\"节点操作\"><a href=\"#节点操作\" class=\"headerlink\" title=\"节点操作\"></a>节点操作</h2><p><code>pyquery</code>提供了一系列方法来对节点进行动态修改，比如为某个节点添加一个<code>class</code>，移除某个节点等，这些操作有时会为提取信息带来极大的便利。<br>由于节点操作的方法太多，下面举几个典型的例子来说明它的用法。</p>\n<h3 id=\"addClass和removeClass\"><a href=\"#addClass和removeClass\" class=\"headerlink\" title=\"addClass和removeClass\"></a>addClass和removeClass</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;.item-0.active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li.remove_class(<span class=\"string\">&#x27;active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li.add_class(<span class=\"string\">&#x27;active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br></pre></td></tr></table></figure>\n\n<p>首先选中第3个<code>li</code>节点，然后调用<code>removeClass</code>方法，将<code>li</code>节点的<code>active</code>这<code>class</code>移除，第2步调用<code>addClass</code>方法，将<code>class</code>添加回来。每执行一次操作，就打印输出当前<code>li</code>节点的内容。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>一共输出了3次。第2次输出时，<code>li</code>节点的<code>active</code>这个<code>class</code>被移除了，第3次<code>class</code>又添加回来了。<code>addClass</code>和<code>removeClass</code>方法可以动态改变节点的<code>class</code>属性。</p>\n<h3 id=\"attr、text、html\"><a href=\"#attr、text、html\" class=\"headerlink\" title=\"attr、text、html\"></a>attr、text、html</h3><p>除了操作<code>class</code>这个属性外，也可以用<code>attr</code>方法对属性进行操作。此外，还可以用<code>text</code>和<code>html</code>方法来改变节点内部的内容。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\"></span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;.item-0.active&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li.attr(<span class=\"string\">&#x27;name&#x27;</span>, <span class=\"string\">&#x27;link&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li.text(<span class=\"string\">&#x27;changed item&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li.html(<span class=\"string\">&#x27;&lt;span&gt;changed item&lt;/span&gt;&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br></pre></td></tr></table></figure>\n\n<p>首先选中<code>li</code>节点，然后调用<code>attr</code>方法来修改属性。该方法的第1个参数为属性名，第2个参数为属性值。最后调用<code>text</code>和<code>html</code>方法来改变节点内部的内容。3次操作后，分别打印输出当前的<code>li</code>节点。 运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot; <span class=\"title\">name</span>=&quot;<span class=\"title\">link</span>&quot;&gt;&lt;<span class=\"title\">a</span> <span class=\"title\">href</span>=&quot;<span class=\"title\">link3</span>.<span class=\"title\">html</span>&quot;&gt;&lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bold</span>&quot;&gt;<span class=\"title\">third</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">a</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot; <span class=\"title\">name</span>=&quot;<span class=\"title\">link</span>&quot;&gt;<span class=\"title\">changed</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">item</span>-0 <span class=\"title\">active</span>&quot; <span class=\"title\">name</span>=&quot;<span class=\"title\">link</span>&quot;&gt;&lt;<span class=\"title\">span</span>&gt;<span class=\"title\">changed</span> <span class=\"title\">item</span>&lt;/<span class=\"title\">span</span>&gt;&lt;/<span class=\"title\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>调用<code>attr</code>方法后，<code>li</code>节点多了一个原本不存在的属性<code>name</code>，其值为<code>link</code>。接着调用<code>text</code>方法传入文本，<code>li</code>节点内部的文本全被改为传入的字符串文本。最后，调用<code>html</code>方法传入<code>HTML</code>文本，<code>li</code>节点内部又变为传入的<code>HTML</code>文本了。</p>\n<p>使用<code>attr</code>方法时如果只传入第1个参数的属性名，则是获取这个属性值；如果传入第2个参数，可以用来修改属性值。使用<code>text</code>和<code>html</code>方法时如果不传参数，则是获取节点内纯文本和<code>HTML</code>文本，如果传入参数，则进行赋值。</p>\n<h3 id=\"remove\"><a href=\"#remove\" class=\"headerlink\" title=\"remove\"></a>remove</h3><p><code>remove</code>方法就是移除，它有时会为信息的提取带来非常大的便利。下面有一段 HTML文本：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    hello, world</span></span><br><span class=\"line\"><span class=\"string\">    &lt;p&gt;This is a paragraph.&lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"></span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\">wrap = doc(<span class=\"string\">&#x27;.wrap&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(wrap.text())</span><br></pre></td></tr></table></figure>\n\n<p>想提取<code>“Hello, World”</code>这个字符串，该怎样操作呢？</p>\n<p>这里先直接尝试提取<code>class</code>为<code>wrap</code>的节点的内容，看看是不是我们想要的。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Hello, World This <span class=\"keyword\">is</span> a paragraph.</span><br></pre></td></tr></table></figure>\n\n<p>这个结果还包含了内部的<code>p</code>节点的内容，也就是说<code>text</code>把所有的纯文本全提取出来了。</p>\n<p>如果想去掉<code>p</code>节点内部的文本，可以选择再把<code>p</code>节点内的文本提取一遍，然后从整个结果中移除这个子串，但这个做法明显比较烦琐。</p>\n<p>这时<code>remove</code>方法就可以派上用场了，可以接着这么做：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wrap.find(<span class=\"string\">&#x27;p&#x27;</span>).remove()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(wrap.text())</span><br></pre></td></tr></table></figure>\n\n<p>首先选中<code>p</code>节点，然后调用<code>remove</code>方法将其移除，这时<code>wrap</code>内部就只剩下<code>“Hello, World”</code>这句话了，最后利用<code>text</code>方法提取即可。</p>\n<p>其实还有很多其他节点操作的方法，比如<code>append</code>、<code>empty</code>和<code>prepend</code>等方法，详细的用法可以参考官方文档：<a href=\"http://pyquery.readthedocs.io/en/latest/api.html\">http://pyquery.readthedocs.io/en/latest/api.html</a>。</p>\n<h2 id=\"伪类选择器\"><a href=\"#伪类选择器\" class=\"headerlink\" title=\"伪类选择器\"></a>伪类选择器</h2><p><code>CSS</code>选择器之所以强大，还有一个很重要的原因，那就是它支持多种多样的伪类选择器，例如选择第一个节点、最后一个节点、奇偶数节点、包含某一文本的节点等。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;div class=&quot;wrap&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;div id=&quot;container&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;ul class=&quot;list&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\">doc = pq(html)</span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;li:first-child&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;li:last-child&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;li:nth-child(2)&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;li:gt(2)&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;li:nth-child(2n)&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br><span class=\"line\">li = doc(<span class=\"string\">&#x27;li:contains(second)&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(li)</span><br></pre></td></tr></table></figure>\n\n<p>在这个例子中使用了<code>CSS3</code>的伪类选择器，依次选择了第1个<code>li</code>节点、最后一个<code>li</code>节点、第2个<code>li</code>节点、第3个<code>li</code>之后的<code>li</code>节点、偶数位置的<code>li</code>节点、包含<code>second</code>文本的<code>li</code>节点。</p>\n"},{"title":"Requests库","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-17T11:53:38.000Z","pic":"requests-sidebar.png","_content":"\n> Requests is an elegant and simple HTTP library for Python, built for human beings.\n\n`Requests` 唯一的一个非转基因的 `Python HTTP` 库，人类可以安全享用。\n\n## 安装\n\n`Requests`是一个第三方的库，建议在虚拟环境中安装。\n\n```python\npip install requests\n```\n\n## 快速上手\n\n### 发送请求\n\n```python\n# 安装requests模块\n# pip install requests\n\n# 导入requests\nimport requests\n\n# 目标url\nurl = \"https://www.baidu.com\"\n\n# 向目标url发送请求\nresponse = requests.get(url)\n\n# 打印响应内容\nprint(response.text)\n```\n\n`Requests` 会自动解码来自服务器的内容。大多数 unicode 字符集都能被无缝地解码。\n\n请求发出后， `Requests` 会基于 `HTTP` 头部对响应的编码作出有根据的推测。当你访问 `response.text` 之时，`Requests` 会使用其推测的文本编码。你可以找出 `Requests` 使用了什么编码，并且能够使用 `response.encoding` 属性来改变它：\n\n```python\n# 设置响应编码方式\nresponse.encoding = 'ISO-8859-1'\n```\n\n### 二进制响应内容\n\n你也能以字节的方式访问请求响应体，对于非文本请求：\n\n```python\n# 打印响应内容, 二进制格式\nprint(response.content)`\n```\n\n### 传递 URL 参数\n\n你也许经常想为 `URL` 的查询字符串(query string)传递某种数据。如果你是手工构建 `URL`，那么数据会以键/值对的形式置于 `URL` 中，跟在一个问号的后面。例如，` httpbin.org/get?key=val`。 `Requests` 允许你使用 `params` 关键字参数，以一个字符串字典来提供这些参数。举例来说，如果你想传递` key1=value1` 和 `key2=value2` 到 `httpbin.org/get` ，那么你可以使用如下代码：\n\n```python\n>>> payload = {'key1': 'value1', 'key2': 'value2'}\n>>> r = requests.get(\"http://httpbin.org/get\", params=payload)\n```\n\n通过打印输出该 `URL`，你能看到 `URL` 已被正确编码：\n\n```python\n>>> print(r.url)\nhttp://httpbin.org/get?key2=value2&key1=value1\n```\n\n注意字典里值为 `None` 的键都不会被添加到 `URL` 的查询字符串里。\n\n你还可以将一个列表作为值传入：\n\n```python\n>>> payload = {'key1': 'value1', 'key2': ['value2', 'value3']}\n\n>>> r = requests.get('http://httpbin.org/get', params=payload)\n>>> print(r.url)\nhttp://httpbin.org/get?key1=value1&key2=value2&key2=value3\n```\n\n### JSON 响应内容\n\n`Requests` 中也有一个内置的 `JSON` 解码器，助你处理 `JSON` 数据：\n\n```python\n>>> import requests\n\n>>> r = requests.get('https://api.github.com/events')\n>>> r.json()\n[{u'repository': {u'open_issues': 0, u'url': 'https://github.com/...\n>>> r.status_code\n200\n```\n\n如果 `JSON` 解码失败， `r.json()` 就会抛出一个异常。例如，响应内容是 `401 (Unauthorized)`，尝试访问 `r.json()` 将会抛出 `ValueError: No JSON object could be decoded `异常。\n\n需要注意的是，成功调用 `r.json()` 并**不**意味着响应的成功。有的服务器会在失败的响应中包含一个 `JSON` 对象（比如` HTTP 500 `的错误细节）。这种 `JSON` 会被解码返回。要检查请求是否成功，请使用 `r.raise_for_status()` 或者检查 `r.status_code` 是否和你的期望相同。\n\n### 原始响应内容\n\n在某些情况下，如果你想获取来自服务器的原始套接字响应，那么你可以访问 `r.raw`。 如果你确实想这么干，那请你确保在初始请求中设置了 `stream=True`。具体你可以这么做：\n\n```python\n>>> r = requests.get('https://api.github.com/events', stream=True)\n>>> r.raw\n<urllib3.response.HTTPResponse object at 0x00000197FAA56AC0>\n>>> r.raw.read(10)\nb'\\x1f\\x8b\\x08\\x00\\x00\\x00\\x00\\x00\\x00\\x03'\n```\n\n但一般情况下，你应该以下面的模式将文本流保存到文件：\n\n```python\nwith open(filename, 'wb') as fd:\n    for chunk in r.iter_content(chunk_size):\n        fd.write(chunk)\n```\n\n使用 `Response.iter_content` 将会处理大量你直接使用 `Response.raw` 不得不处理的。 当流下载时，上面是优先推荐的获取内容方式。 \n\n### 定制请求头\n\n如果你想为请求添加 `HTTP` 头部，只要简单地传递一个 `dict` 给 `headers` 参数就可以了。\n\n例如，在前一个示例中我们没有指定 `content-type`:\n\n```python\n>>> url = 'https://api.github.com/some/endpoint'\n>>> headers = {'user-agent': 'my-app/0.0.1'}\n\n>>> r = requests.get(url, headers=headers)\n```\n\n注意: 定制 `header` 的优先级低于某些特定的信息源，例如：\n\n- 如果在 `.netrc` 中设置了用户认证信息，使用 `headers=` 设置的授权就不会生效。而如果设置了` auth=` 参数，`.netrc` 的设置就无效了。\n- 如果被重定向到别的主机，授权 `header` 就会被删除。\n- 代理授权 `header` 会被 URL 中提供的代理身份覆盖掉。\n- 在我们能判断内容长度的情况下，`header` 的 `Content-Length` 会被改写。\n\n更进一步讲，`Requests` 不会基于定制 `header` 的具体情况改变自己的行为。只不过在最后的请求中，所有的 `header` 信息都会被传递进去。\n\n注意: 所有的 head`er 值必须是 `string、bytestring` 或者 `unicode`。尽管传递 `unicode header` 也是允许的，但不建议这样做。\n\n### 更加复杂的 POST 请求\n\n通常，你想要发送一些编码为表单形式的数据——非常像一个 `HTML` 表单。要实现这个，只需简单地传递一个字典给 `data` 参数。你的数据字典在发出请求时会自动编码为表单形式：\n\n```python\n>>> payload = {'key1': 'value1', 'key2': 'value2'}\n\n>>> r = requests.post(\"http://httpbin.org/post\", data=payload)\n>>> print(r.text)\n{\n  ...\n  \"form\": {\n    \"key2\": \"value2\",\n    \"key1\": \"value1\"\n  },\n  ...\n}\n```\n\n你还可以为 `data` 参数传入一个元组列表。在表单中多个元素使用同一 `key` 的时候，这种方式尤其有效：\n\n```python\n>>> payload = (('key1', 'value1'), ('key1', 'value2'))\n>>> r = requests.post('http://httpbin.org/post', data=payload)\n>>> print(r.text)\n{\n  ...\n  \"form\": {\n    \"key1\": [\n      \"value1\",\n      \"value2\"\n    ]\n  },\n  ...\n```\n\n很多时候你想要发送的数据并非编码为表单形式的。如果你传递一个 `string` 而不是一个 `dict` ，那么数据会被直接发布出去。\n\n例如，`Github API v3` 接受编码为 `JSON` 的 `POST/PATCH` 数据：\n\n```python\n>>> import json\n\n>>> url = 'https://api.github.com/some/endpoint'\n>>> payload = {'some': 'data'}\n\n>>> r = requests.post(url, data=json.dumps(payload))\n```\n\n此处除了可以自行对 `dict` 进行编码，你还可以使用 `json` 参数直接传递，然后它就会被自动编码。这是 `2.4.2 `版的新加功能：\n\n```python\n>>> url = 'https://api.github.com/some/endpoint'\n>>> payload = {'some': 'data'}\n\n>>> r = requests.post(url, json=payload)\n```\n\n### 响应状态码\n\n可以检测响应状态码：\n\n```python\n>>> r = requests.get('http://httpbin.org/get')\n>>> r.status_code\n200\n```\n\n为方便引用，`Requests`还附带了一个内置的状态码查询对象：\n\n```\n>>> r.status_code == requests.codes.ok\nTrue\n```\n\n如果发送了一个错误请求(一个 4XX 客户端错误，或者 5XX 服务器错误响应)，我们可以通过 `Response.raise_for_status()` 来抛出异常：\n\n```\n>>> bad_r = requests.get('http://httpbin.org/status/404')\n>>> bad_r.status_code\n404\n\n>>> bad_r.raise_for_status()\nTraceback (most recent call last):\n  File \"requests/models.py\", line 832, in raise_for_status\n    raise http_error\nrequests.exceptions.HTTPError: 404 Client Error\n```\n\n如果响应对象 `r` 的 `status_code` 是 `200` ，当我们调用 `raise_for_status()` 时，得到的是：\n\n```python\n>>> r.raise_for_status()\nNone\n```\n\n### 响应头\n\n我们可以查看以一个 `Python` 字典形式展示的服务器响应头：\n\n```python\n>>> r.headers\n{\n    'content-encoding': 'gzip',\n    'transfer-encoding': 'chunked',\n    'connection': 'close',\n    'server': 'nginx/1.0.4',\n    'x-runtime': '148ms',\n    'etag': '\"e1ca502697e5c9317743dc078f67693f\"',\n    'content-type': 'application/json'\n}\n```\n\n但是这个字典比较特殊：它是仅为 `HTTP` 头部而生的。根据 `RFC 2616`， `HTTP` 头部是大小写不敏感的。\n\n因此，我们可以使用任意大写形式来访问这些响应头字段：\n\n```python\n>>> r.headers['Content-Type']\n'application/json'\n\n>>> r.headers.get('content-type')\n'application/json'\n```\n\n它还有一个特殊点，那就是服务器可以多次接受同一 `header`，每次都使用不同的值。\n\n### Cookie\n\n如果某个响应中包含一些 `cookie`，你可以快速访问它们：\n\n```python\n>>> url = 'http://www.baidu.com'\n>>> r = requests.get(url)\n>>> r.cookies\n<RequestsCookieJar[Cookie(version=0, name='BDORZ', value='27315', port=None, port_specified=False, domain='.baidu.com', domain_specified=True, domain_initial_dot=True, path='/', path_specified=True, secure=False, expires=1624028209, discard=False, comment=None, comment_url=None, rest={}, rfc2109=False)]>\n\n>>> r.cookies.get_dict()\n{'BDORZ': '27315'}\n```\n\n要想发送你的`cookies`到服务器，可以使用 `cookies` 参数：\n\n```\n>>> url = 'http://httpbin.org/cookies'\n>>> cookies = dict(cookies_are='working')\n\n>>> r = requests.get(url, cookies=cookies)\n>>> r.text\n'{\"cookies\": {\"cookies_are\": \"working\"}}'\n```\n\n`Cookie` 的返回对象为 `RequestsCookieJar` ，它的行为和字典类似，但接口更为完整，适合跨域名跨路径使用。你还可以把 `Cookie Jar` 传到 `Requests` 中：\n\n```python\n>>> jar = requests.cookies.RequestsCookieJar()\n>>> jar.set('tasty_cookie', 'yum', domain='httpbin.org', path='/cookies')\n>>> jar.set('gross_cookie', 'blech', domain='httpbin.org', path='/elsewhere')\n>>> url = 'http://httpbin.org/cookies'\n>>> r = requests.get(url, cookies=jar)\n>>> r.text\n'{\"cookies\": {\"tasty_cookie\": \"yum\"}}'\n```\n\n### 重定向与请求历史\n\n默认情况下，除了 `HEAD, Requests` 会自动处理所有重定向。\n\n可以使用响应对象的 `history` 方法来追踪重定向。\n\n`Response.history` 是一个 `Response` 对象的列表，为了完成请求而创建了这些对象。这个对象列表按照从最老到最近的请求进行排序。\n\n例如，Github 将所有的 `HTTP` 请求重定向到 `HTTPS`：\n\n```python\n>>> r = requests.get('http://github.com')\n\n>>> r.url\n'https://github.com/'\n\n>>> r.status_code\n200\n\n>>> r.history\n[<Response [301]>]\n```\n\n如果你使用的是`GET、OPTIONS、POST、PUT、PATCH` 或者 `DELETE`，那么你可以通过 `allow_redirects` 参数禁用重定向处理：\n\n```python\n>>> r = requests.get('http://github.com', allow_redirects=False)\n>>> r.status_code\n301\n>>> r.history\n[]\n```\n\n如果你使用了 `HEAD`，你也可以启用重定向：\n\n```python\n>>> r = requests.head('http://github.com', allow_redirects=True)\n>>> r.url\n'https://github.com/'\n>>> r.history\n[<Response [301]>]\n```\n\n### 超时处理\n\n你可以告诉 `requests` 在经过以 `timeout` 参数设定的秒数时间之后停止等待响应。基本上所有的生产代码都应该使用这一参数。如果不使用，你的程序可能会永远失去响应：\n\n```python\n>>> requests.get('http://github.com', timeout=0.001)\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nrequests.exceptions.Timeout: HTTPConnectionPool(host='github.com', port=80): Request timed out. (timeout=0.001)\n```\n\n> 注意\n `timeout` 仅对连接过程有效，与响应体的下载无关。 `timeout` 并不是整个下载响应的时间限制，而是如果服务器在 `timeout` 秒内没有应答，将会引发一个异常（更精确地说，是在 `timeout` 秒内没有从基础套接字上接收到任何字节的数据时）。\n\n### 错误与异常\n\n遇到网络问题（如：DNS 查询失败、拒绝连接等）时， `Requests` 会抛出一个 `ConnectionError` 异常。\n\n如果 `HTTP` 请求返回了不成功的状态码， `Response.raise_for_status()` 会抛出一个 `HTTPError` 异常。\n\n若请求超时，则抛出一个 `Timeout` 异常。\n\n若请求超过了设定的最大重定向次数，则会抛出一个 `TooManyRedirects` 异常。\n\n所有`Requests`显式抛出的异常都继承自`requests.exceptions.RequestException` 。\n\n\n## 高级用法\n\n接下来介绍一些 `requests` 的高级用法。\n\n### 会话对象\n\n会话对象让你能够跨请求保持某些参数。它也会在同一个 `Session` 实例发出的所有请求之间保持 `cookie` ， 期间使用 `urllib3` 的 `connection pooling` 功能。所以如果你向同一主机发送多个请求，底层的 `TCP` 连接将会被重用，从而带来显著的性能提升。\n\n会话对象具有主要的 `Requests API` 的所有方法。\n\n我们来跨请求保持一些 `cookie`:\n\n```python\nimport requests\n\n# 创建一个会话对象\ns = requests.Session()\n\ns.get('http://httpbin.org/cookies/set/sessioncookie/123456789')\n\nr = s.get(\"https://httpbin.org/cookies\")\n\nprint(r.text)\n\n# {\n#   \"cookies\": {\n#     \"sessioncookie\": \"123456789\"\n#   }\n# }\n```\n\n会话也可用来为请求方法提供缺省数据。这是通过为会话对象的属性提供数据来实现的：\n\n```python\ns = requests.Session()\ns.auth = ('user', 'pass')\ns.headers.update({'x-test': 'true'})\n\n# both 'x-test' and 'x-test2' are sent\ns.get('http://httpbin.org/headers', headers={'x-test2': 'true'})\n```\n\n\n任何你传递给请求方法的字典都会与已设置会话层数据合并。方法层的参数覆盖会话的参数。\n\n不过需要注意，就算使用了会话，方法级别的参数也不会被跨请求保持。下面的例子只会和第一个请求发送 `cookie` ，而非第二个：\n\n```python\ns = requests.Session()\n\nr = s.get('http://httpbin.org/cookies', cookies={'from-my': 'browser'})\nprint(r.text)\n# '{\"cookies\": {\"from-my\": \"browser\"}}'\n\nr = s.get('http://httpbin.org/cookies')\nprint(r.text)\n# '{\"cookies\": {}}'\n```\n\n如果你要手动为会话添加 `cookie` ，就使用 `Cookie utility` 函数 来操纵 `Session.cookies`。\n\n会话还可以用作前后文管理器：\n\n```python\nwith requests.Session() as s:\n    s.get('http://httpbin.org/cookies/set/sessioncookie/123456789')\n```\n\n这样就能确保 `with` 区块退出后会话能被关闭，即使发生了异常也一样。\n\n从字典参数中移除一个值\n有时你会想省略字典参数中一些会话层的键。要做到这一点，你只需简单地在方法层参数中将那个键的值设置为 `None` ，那个键就会被自动省略掉。\n\n### 请求与响应对象\n\n任何时候进行了类似 `requests.get()` 的调用，你都在做两件主要的事情。其一，你在构建一个 `Request` 对象， 该对象将被发送到某个服务器请求或查询一些资源。其二，一旦 `requests` 得到一个从服务器返回的响应就会产生一个 `Response` 对象。该响应对象包含服务器返回的所有信息，也包含你原来创建的 `Request` 对象。如下是一个简单的请求，从 `Baidu` 的服务器得到一些非常重要的信息：\n\n```python\n>>> r = requests.get(\"https://www.baidu.com\")\n``` \n\n如果想访问服务器返回给我们的响应头部信息，可以这样做：\n\n```python\n>>> r.headers\n{'Cache-Control': 'private, no-cache, no-store, proxy-revalidate, no-transform', 'Connection': 'keep-alive',\n        'Content-Encoding': 'gzip', 'Content-Type': 'text/html', 'Date': 'Thu, 17 Jun 2021 15:52:48 GMT',\n        'Last-Modified': 'Mon, 23 Jan 2017 13:23:55 GMT', 'Pragma': 'no-cache', 'Server': 'bfe/1.0.8.18',\n        'Set-Cookie': 'BDORZ=27315; max-age=86400; domain=.baidu.com; path=/', 'Transfer-Encoding': 'chunked'}\n```\n\n然而，如果想得到发送到服务器的请求的头部，我们可以简单地访问该请求，然后是该请求的头部：\n\n```python\n>>> r.request.headers\n{'User-Agent': 'python-requests/2.25.1', 'Accept-Encoding': 'gzip, deflate', 'Accept': '*/*',\n     'Connection': 'keep-alive'}\n```\n\n### 准备的请求 （Prepared Request）\n\n当你从 `API` 或者会话调用中收到一个 `Response` 对象时，`request` 属性其实是使用了 `PreparedRequest` 。有时在发送请求之前，你需要对 `body` 或者 `header` （或者别的什么东西）做一些额外处理，下面演示了一个简单的做法：\n\n```python\nfrom requests import Request, Session\n\ns = Session()\nreq = Request('GET', url,\n    data=data,\n    headers=header\n)\nprepped = req.prepare()\n\n# do something with prepped.body\n# do something with prepped.headers\n\nresp = s.send(prepped,\n    stream=stream,\n    verify=verify,\n    proxies=proxies,\n    cert=cert,\n    timeout=timeout\n)\n\nprint(resp.status_code)\n```\n\n由于你没有对 `Request` 对象做什么特殊事情，你立即准备和修改了 `PreparedRequest` 对象，然后把它和别的参数一起发送到 `requests.*` 或者 `Session.*`。\n\n然而，上述代码会失去 `Requests Session` 对象的一些优势， 尤其 `Session` 级别的状态，例如 `cookie` 就不会被应用到你的请求上去。要获取一个带有状态的 `PreparedRequest`， 请用 `Session.prepare_request()` 取代 `Request.prepare()` 的调用，如下所示：\n\n```python\nfrom requests import Request, Session\n\ns = Session()\nreq = Request('GET',  url,\n    data=data\n    headers=headers\n)\n\nprepped = s.prepare_request(req)\n\n# do something with prepped.body\n# do something with prepped.headers\n\nresp = s.send(prepped,\n    stream=stream,\n    verify=verify,\n    proxies=proxies,\n    cert=cert,\n    timeout=timeout\n)\n\nprint(resp.status_code)\n```\n\n### SSL 证书验证\n\n`Requests` 可以为 `HTTPS` 请求验证 `SSL` 证书，就像 `web` 浏览器一样。 `SSL` 验证默认是开启的，如果证书验证失败，`Requests` 会抛出 `SSLError`:\n\n```python\n>>> requests.get('https://requestb.in')\nrequests.exceptions.SSLError: hostname 'requestb.in' doesn't match either of '*.herokuapp.com', 'herokuapp.com'\n```\n\n在该域名上我没有设置 SSL(现在已经设置了，返回的`<Response [200]>`)，所以失败了。但 Github 设置了 SSL:\n\n```python\n>>> requests.get('https://github.com', verify=True)\n<Response [200]>\n```\n\n你可以为 `verify` 传入 `CA_BUNDLE` 文件的路径，或者包含可信任 `CA` 证书文件的文件夹路径：\n\n```python\n>>> requests.get('https://github.com', verify='/path/to/certfile')\n```\n\n或者将其保持在会话中：\n\n```\ns = requests.Session()\ns.verify = '/path/to/certfile'\n```\n\n**注解**\n\n如果 `verify` 设为文件夹路径，文件夹必须通过 `OpenSSL` 提供的 `c_rehash` 工具处理。\n\n你还可以通过 `REQUESTS_CA_BUNDLE` 环境变量定义可信任 `CA` 列表。\n\n如果你将 `verify` 设置为 `False`，`Requests` 也能忽略对 `SSL` 证书的验证。\n\n```python\n>>> requests.get('https://kennethreitz.org', verify=False)\n<Response [200]>\n```\n\n默认情况下， `verify` 是设置为 `True` 的。选项 `verify` 仅应用于主机证书。\n\n> 对于私有证书，你也可以传递一个 `CA_BUNDLE` 文件的路径给 `verify`。你也可以设置 `# REQUEST_CA_BUNDLE `环境变量。\n\n### 流式上传\n\n`Requests`支持流式上传，这允许你发送大的数据流或文件而无需先把它们读入内存。要使用流式上传，仅需为你的请求体提供一个类文件对象即可：\n\n```python\nwith open('massive-body') as f:\n    requests.post('http://some.url/streamed', data=f)\n```\n\n强烈建议你用`二进制模式（binary mode）`打开文件。这是因为 `requests` 可能会为你提供 `header` 中的 `Content-Length`，在这种情况下该值会被设为文件的字节数。如果你用文本模式打开文件，就可能碰到错误。\n\n### POST 多个分块编码的文件\n\n你可以在一个请求中发送多个文件。例如，假设你要上传多个图像文件到一个 `HTML` 表单，使用一个多文件 `field` 叫做 `\"images\"`:\n\n```html\n<input type=\"file\" name=\"images\" multiple=\"true\" required=\"true\"/>\n```\n\n要实现，只要把文件设到一个元组的列表中，其中元组结构为 `(form_field_name, file_info)`:\n\n```python\n>>> url = 'http://httpbin.org/post'\n>>> multiple_files = [\n        ('images', ('foo.png', open('foo.png', 'rb'), 'image/png')),\n        ('images', ('bar.png', open('bar.png', 'rb'), 'image/png'))]\n>>> r = requests.post(url, files=multiple_files)\n>>> r.text\n{\n  ...\n  'files': {'images': 'data:image/png;base64,iVBORw ....'}\n  'Content-Type': 'multipart/form-data; boundary=3131623adb2043caaeb5538cc7aa0b3a',\n  ...\n}\n```\n\n同样的，建议使用二进制打开文件。\n\n### 代理\n\n如果需要使用代理，你可以通过为任意请求方法提供 `proxies` 参数来配置单个请求:\n\n```python\nimport requests\n\nproxies = {\n  \"http\": \"http://10.10.1.10:3128\",\n  \"https\": \"http://10.10.1.10:1080\",\n}\n\nrequests.get(\"http://example.org\", proxies=proxies)\n```\n\n你也可以通过环境变量 `HTTP_PROXY` 和 `HTTPS_PROXY` 来配置代理。\n\n```python\n$ export HTTP_PROXY=\"http://10.10.1.10:3128\"\n$ export HTTPS_PROXY=\"http://10.10.1.10:1080\"\n\n$ python\n>>> import requests\n>>> requests.get(\"http://example.org\")\n```\n\n若你的代理需要使用`HTTP Basic Auth`，可以使用 `http://user:password@host/` 语法：\n\n```python\nproxies = {\n    \"http\": \"http://user:pass@10.10.1.10:3128/\",\n}\n```\n\n要为某个特定的连接方式或者主机设置代理，使用 `scheme://hostname` 作为 `key`， 它会针对指定的主机和连接方式进行匹配。\n\n```python\nproxies = {'http://10.20.1.128': 'http://10.10.1.10:5323'}\n```\n\n注意，代理 `URL` 必须包含连接方式。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","source":"_posts/Requests库的使用.md","raw":"---\ntitle: Requests库\ntags:\n  - requests\n  - http\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-17 19:53:38\ncategories: Python库\npic: requests-sidebar.png\n---\n\n> Requests is an elegant and simple HTTP library for Python, built for human beings.\n\n`Requests` 唯一的一个非转基因的 `Python HTTP` 库，人类可以安全享用。\n\n## 安装\n\n`Requests`是一个第三方的库，建议在虚拟环境中安装。\n\n```python\npip install requests\n```\n\n## 快速上手\n\n### 发送请求\n\n```python\n# 安装requests模块\n# pip install requests\n\n# 导入requests\nimport requests\n\n# 目标url\nurl = \"https://www.baidu.com\"\n\n# 向目标url发送请求\nresponse = requests.get(url)\n\n# 打印响应内容\nprint(response.text)\n```\n\n`Requests` 会自动解码来自服务器的内容。大多数 unicode 字符集都能被无缝地解码。\n\n请求发出后， `Requests` 会基于 `HTTP` 头部对响应的编码作出有根据的推测。当你访问 `response.text` 之时，`Requests` 会使用其推测的文本编码。你可以找出 `Requests` 使用了什么编码，并且能够使用 `response.encoding` 属性来改变它：\n\n```python\n# 设置响应编码方式\nresponse.encoding = 'ISO-8859-1'\n```\n\n### 二进制响应内容\n\n你也能以字节的方式访问请求响应体，对于非文本请求：\n\n```python\n# 打印响应内容, 二进制格式\nprint(response.content)`\n```\n\n### 传递 URL 参数\n\n你也许经常想为 `URL` 的查询字符串(query string)传递某种数据。如果你是手工构建 `URL`，那么数据会以键/值对的形式置于 `URL` 中，跟在一个问号的后面。例如，` httpbin.org/get?key=val`。 `Requests` 允许你使用 `params` 关键字参数，以一个字符串字典来提供这些参数。举例来说，如果你想传递` key1=value1` 和 `key2=value2` 到 `httpbin.org/get` ，那么你可以使用如下代码：\n\n```python\n>>> payload = {'key1': 'value1', 'key2': 'value2'}\n>>> r = requests.get(\"http://httpbin.org/get\", params=payload)\n```\n\n通过打印输出该 `URL`，你能看到 `URL` 已被正确编码：\n\n```python\n>>> print(r.url)\nhttp://httpbin.org/get?key2=value2&key1=value1\n```\n\n注意字典里值为 `None` 的键都不会被添加到 `URL` 的查询字符串里。\n\n你还可以将一个列表作为值传入：\n\n```python\n>>> payload = {'key1': 'value1', 'key2': ['value2', 'value3']}\n\n>>> r = requests.get('http://httpbin.org/get', params=payload)\n>>> print(r.url)\nhttp://httpbin.org/get?key1=value1&key2=value2&key2=value3\n```\n\n### JSON 响应内容\n\n`Requests` 中也有一个内置的 `JSON` 解码器，助你处理 `JSON` 数据：\n\n```python\n>>> import requests\n\n>>> r = requests.get('https://api.github.com/events')\n>>> r.json()\n[{u'repository': {u'open_issues': 0, u'url': 'https://github.com/...\n>>> r.status_code\n200\n```\n\n如果 `JSON` 解码失败， `r.json()` 就会抛出一个异常。例如，响应内容是 `401 (Unauthorized)`，尝试访问 `r.json()` 将会抛出 `ValueError: No JSON object could be decoded `异常。\n\n需要注意的是，成功调用 `r.json()` 并**不**意味着响应的成功。有的服务器会在失败的响应中包含一个 `JSON` 对象（比如` HTTP 500 `的错误细节）。这种 `JSON` 会被解码返回。要检查请求是否成功，请使用 `r.raise_for_status()` 或者检查 `r.status_code` 是否和你的期望相同。\n\n### 原始响应内容\n\n在某些情况下，如果你想获取来自服务器的原始套接字响应，那么你可以访问 `r.raw`。 如果你确实想这么干，那请你确保在初始请求中设置了 `stream=True`。具体你可以这么做：\n\n```python\n>>> r = requests.get('https://api.github.com/events', stream=True)\n>>> r.raw\n<urllib3.response.HTTPResponse object at 0x00000197FAA56AC0>\n>>> r.raw.read(10)\nb'\\x1f\\x8b\\x08\\x00\\x00\\x00\\x00\\x00\\x00\\x03'\n```\n\n但一般情况下，你应该以下面的模式将文本流保存到文件：\n\n```python\nwith open(filename, 'wb') as fd:\n    for chunk in r.iter_content(chunk_size):\n        fd.write(chunk)\n```\n\n使用 `Response.iter_content` 将会处理大量你直接使用 `Response.raw` 不得不处理的。 当流下载时，上面是优先推荐的获取内容方式。 \n\n### 定制请求头\n\n如果你想为请求添加 `HTTP` 头部，只要简单地传递一个 `dict` 给 `headers` 参数就可以了。\n\n例如，在前一个示例中我们没有指定 `content-type`:\n\n```python\n>>> url = 'https://api.github.com/some/endpoint'\n>>> headers = {'user-agent': 'my-app/0.0.1'}\n\n>>> r = requests.get(url, headers=headers)\n```\n\n注意: 定制 `header` 的优先级低于某些特定的信息源，例如：\n\n- 如果在 `.netrc` 中设置了用户认证信息，使用 `headers=` 设置的授权就不会生效。而如果设置了` auth=` 参数，`.netrc` 的设置就无效了。\n- 如果被重定向到别的主机，授权 `header` 就会被删除。\n- 代理授权 `header` 会被 URL 中提供的代理身份覆盖掉。\n- 在我们能判断内容长度的情况下，`header` 的 `Content-Length` 会被改写。\n\n更进一步讲，`Requests` 不会基于定制 `header` 的具体情况改变自己的行为。只不过在最后的请求中，所有的 `header` 信息都会被传递进去。\n\n注意: 所有的 head`er 值必须是 `string、bytestring` 或者 `unicode`。尽管传递 `unicode header` 也是允许的，但不建议这样做。\n\n### 更加复杂的 POST 请求\n\n通常，你想要发送一些编码为表单形式的数据——非常像一个 `HTML` 表单。要实现这个，只需简单地传递一个字典给 `data` 参数。你的数据字典在发出请求时会自动编码为表单形式：\n\n```python\n>>> payload = {'key1': 'value1', 'key2': 'value2'}\n\n>>> r = requests.post(\"http://httpbin.org/post\", data=payload)\n>>> print(r.text)\n{\n  ...\n  \"form\": {\n    \"key2\": \"value2\",\n    \"key1\": \"value1\"\n  },\n  ...\n}\n```\n\n你还可以为 `data` 参数传入一个元组列表。在表单中多个元素使用同一 `key` 的时候，这种方式尤其有效：\n\n```python\n>>> payload = (('key1', 'value1'), ('key1', 'value2'))\n>>> r = requests.post('http://httpbin.org/post', data=payload)\n>>> print(r.text)\n{\n  ...\n  \"form\": {\n    \"key1\": [\n      \"value1\",\n      \"value2\"\n    ]\n  },\n  ...\n```\n\n很多时候你想要发送的数据并非编码为表单形式的。如果你传递一个 `string` 而不是一个 `dict` ，那么数据会被直接发布出去。\n\n例如，`Github API v3` 接受编码为 `JSON` 的 `POST/PATCH` 数据：\n\n```python\n>>> import json\n\n>>> url = 'https://api.github.com/some/endpoint'\n>>> payload = {'some': 'data'}\n\n>>> r = requests.post(url, data=json.dumps(payload))\n```\n\n此处除了可以自行对 `dict` 进行编码，你还可以使用 `json` 参数直接传递，然后它就会被自动编码。这是 `2.4.2 `版的新加功能：\n\n```python\n>>> url = 'https://api.github.com/some/endpoint'\n>>> payload = {'some': 'data'}\n\n>>> r = requests.post(url, json=payload)\n```\n\n### 响应状态码\n\n可以检测响应状态码：\n\n```python\n>>> r = requests.get('http://httpbin.org/get')\n>>> r.status_code\n200\n```\n\n为方便引用，`Requests`还附带了一个内置的状态码查询对象：\n\n```\n>>> r.status_code == requests.codes.ok\nTrue\n```\n\n如果发送了一个错误请求(一个 4XX 客户端错误，或者 5XX 服务器错误响应)，我们可以通过 `Response.raise_for_status()` 来抛出异常：\n\n```\n>>> bad_r = requests.get('http://httpbin.org/status/404')\n>>> bad_r.status_code\n404\n\n>>> bad_r.raise_for_status()\nTraceback (most recent call last):\n  File \"requests/models.py\", line 832, in raise_for_status\n    raise http_error\nrequests.exceptions.HTTPError: 404 Client Error\n```\n\n如果响应对象 `r` 的 `status_code` 是 `200` ，当我们调用 `raise_for_status()` 时，得到的是：\n\n```python\n>>> r.raise_for_status()\nNone\n```\n\n### 响应头\n\n我们可以查看以一个 `Python` 字典形式展示的服务器响应头：\n\n```python\n>>> r.headers\n{\n    'content-encoding': 'gzip',\n    'transfer-encoding': 'chunked',\n    'connection': 'close',\n    'server': 'nginx/1.0.4',\n    'x-runtime': '148ms',\n    'etag': '\"e1ca502697e5c9317743dc078f67693f\"',\n    'content-type': 'application/json'\n}\n```\n\n但是这个字典比较特殊：它是仅为 `HTTP` 头部而生的。根据 `RFC 2616`， `HTTP` 头部是大小写不敏感的。\n\n因此，我们可以使用任意大写形式来访问这些响应头字段：\n\n```python\n>>> r.headers['Content-Type']\n'application/json'\n\n>>> r.headers.get('content-type')\n'application/json'\n```\n\n它还有一个特殊点，那就是服务器可以多次接受同一 `header`，每次都使用不同的值。\n\n### Cookie\n\n如果某个响应中包含一些 `cookie`，你可以快速访问它们：\n\n```python\n>>> url = 'http://www.baidu.com'\n>>> r = requests.get(url)\n>>> r.cookies\n<RequestsCookieJar[Cookie(version=0, name='BDORZ', value='27315', port=None, port_specified=False, domain='.baidu.com', domain_specified=True, domain_initial_dot=True, path='/', path_specified=True, secure=False, expires=1624028209, discard=False, comment=None, comment_url=None, rest={}, rfc2109=False)]>\n\n>>> r.cookies.get_dict()\n{'BDORZ': '27315'}\n```\n\n要想发送你的`cookies`到服务器，可以使用 `cookies` 参数：\n\n```\n>>> url = 'http://httpbin.org/cookies'\n>>> cookies = dict(cookies_are='working')\n\n>>> r = requests.get(url, cookies=cookies)\n>>> r.text\n'{\"cookies\": {\"cookies_are\": \"working\"}}'\n```\n\n`Cookie` 的返回对象为 `RequestsCookieJar` ，它的行为和字典类似，但接口更为完整，适合跨域名跨路径使用。你还可以把 `Cookie Jar` 传到 `Requests` 中：\n\n```python\n>>> jar = requests.cookies.RequestsCookieJar()\n>>> jar.set('tasty_cookie', 'yum', domain='httpbin.org', path='/cookies')\n>>> jar.set('gross_cookie', 'blech', domain='httpbin.org', path='/elsewhere')\n>>> url = 'http://httpbin.org/cookies'\n>>> r = requests.get(url, cookies=jar)\n>>> r.text\n'{\"cookies\": {\"tasty_cookie\": \"yum\"}}'\n```\n\n### 重定向与请求历史\n\n默认情况下，除了 `HEAD, Requests` 会自动处理所有重定向。\n\n可以使用响应对象的 `history` 方法来追踪重定向。\n\n`Response.history` 是一个 `Response` 对象的列表，为了完成请求而创建了这些对象。这个对象列表按照从最老到最近的请求进行排序。\n\n例如，Github 将所有的 `HTTP` 请求重定向到 `HTTPS`：\n\n```python\n>>> r = requests.get('http://github.com')\n\n>>> r.url\n'https://github.com/'\n\n>>> r.status_code\n200\n\n>>> r.history\n[<Response [301]>]\n```\n\n如果你使用的是`GET、OPTIONS、POST、PUT、PATCH` 或者 `DELETE`，那么你可以通过 `allow_redirects` 参数禁用重定向处理：\n\n```python\n>>> r = requests.get('http://github.com', allow_redirects=False)\n>>> r.status_code\n301\n>>> r.history\n[]\n```\n\n如果你使用了 `HEAD`，你也可以启用重定向：\n\n```python\n>>> r = requests.head('http://github.com', allow_redirects=True)\n>>> r.url\n'https://github.com/'\n>>> r.history\n[<Response [301]>]\n```\n\n### 超时处理\n\n你可以告诉 `requests` 在经过以 `timeout` 参数设定的秒数时间之后停止等待响应。基本上所有的生产代码都应该使用这一参数。如果不使用，你的程序可能会永远失去响应：\n\n```python\n>>> requests.get('http://github.com', timeout=0.001)\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nrequests.exceptions.Timeout: HTTPConnectionPool(host='github.com', port=80): Request timed out. (timeout=0.001)\n```\n\n> 注意\n `timeout` 仅对连接过程有效，与响应体的下载无关。 `timeout` 并不是整个下载响应的时间限制，而是如果服务器在 `timeout` 秒内没有应答，将会引发一个异常（更精确地说，是在 `timeout` 秒内没有从基础套接字上接收到任何字节的数据时）。\n\n### 错误与异常\n\n遇到网络问题（如：DNS 查询失败、拒绝连接等）时， `Requests` 会抛出一个 `ConnectionError` 异常。\n\n如果 `HTTP` 请求返回了不成功的状态码， `Response.raise_for_status()` 会抛出一个 `HTTPError` 异常。\n\n若请求超时，则抛出一个 `Timeout` 异常。\n\n若请求超过了设定的最大重定向次数，则会抛出一个 `TooManyRedirects` 异常。\n\n所有`Requests`显式抛出的异常都继承自`requests.exceptions.RequestException` 。\n\n\n## 高级用法\n\n接下来介绍一些 `requests` 的高级用法。\n\n### 会话对象\n\n会话对象让你能够跨请求保持某些参数。它也会在同一个 `Session` 实例发出的所有请求之间保持 `cookie` ， 期间使用 `urllib3` 的 `connection pooling` 功能。所以如果你向同一主机发送多个请求，底层的 `TCP` 连接将会被重用，从而带来显著的性能提升。\n\n会话对象具有主要的 `Requests API` 的所有方法。\n\n我们来跨请求保持一些 `cookie`:\n\n```python\nimport requests\n\n# 创建一个会话对象\ns = requests.Session()\n\ns.get('http://httpbin.org/cookies/set/sessioncookie/123456789')\n\nr = s.get(\"https://httpbin.org/cookies\")\n\nprint(r.text)\n\n# {\n#   \"cookies\": {\n#     \"sessioncookie\": \"123456789\"\n#   }\n# }\n```\n\n会话也可用来为请求方法提供缺省数据。这是通过为会话对象的属性提供数据来实现的：\n\n```python\ns = requests.Session()\ns.auth = ('user', 'pass')\ns.headers.update({'x-test': 'true'})\n\n# both 'x-test' and 'x-test2' are sent\ns.get('http://httpbin.org/headers', headers={'x-test2': 'true'})\n```\n\n\n任何你传递给请求方法的字典都会与已设置会话层数据合并。方法层的参数覆盖会话的参数。\n\n不过需要注意，就算使用了会话，方法级别的参数也不会被跨请求保持。下面的例子只会和第一个请求发送 `cookie` ，而非第二个：\n\n```python\ns = requests.Session()\n\nr = s.get('http://httpbin.org/cookies', cookies={'from-my': 'browser'})\nprint(r.text)\n# '{\"cookies\": {\"from-my\": \"browser\"}}'\n\nr = s.get('http://httpbin.org/cookies')\nprint(r.text)\n# '{\"cookies\": {}}'\n```\n\n如果你要手动为会话添加 `cookie` ，就使用 `Cookie utility` 函数 来操纵 `Session.cookies`。\n\n会话还可以用作前后文管理器：\n\n```python\nwith requests.Session() as s:\n    s.get('http://httpbin.org/cookies/set/sessioncookie/123456789')\n```\n\n这样就能确保 `with` 区块退出后会话能被关闭，即使发生了异常也一样。\n\n从字典参数中移除一个值\n有时你会想省略字典参数中一些会话层的键。要做到这一点，你只需简单地在方法层参数中将那个键的值设置为 `None` ，那个键就会被自动省略掉。\n\n### 请求与响应对象\n\n任何时候进行了类似 `requests.get()` 的调用，你都在做两件主要的事情。其一，你在构建一个 `Request` 对象， 该对象将被发送到某个服务器请求或查询一些资源。其二，一旦 `requests` 得到一个从服务器返回的响应就会产生一个 `Response` 对象。该响应对象包含服务器返回的所有信息，也包含你原来创建的 `Request` 对象。如下是一个简单的请求，从 `Baidu` 的服务器得到一些非常重要的信息：\n\n```python\n>>> r = requests.get(\"https://www.baidu.com\")\n``` \n\n如果想访问服务器返回给我们的响应头部信息，可以这样做：\n\n```python\n>>> r.headers\n{'Cache-Control': 'private, no-cache, no-store, proxy-revalidate, no-transform', 'Connection': 'keep-alive',\n        'Content-Encoding': 'gzip', 'Content-Type': 'text/html', 'Date': 'Thu, 17 Jun 2021 15:52:48 GMT',\n        'Last-Modified': 'Mon, 23 Jan 2017 13:23:55 GMT', 'Pragma': 'no-cache', 'Server': 'bfe/1.0.8.18',\n        'Set-Cookie': 'BDORZ=27315; max-age=86400; domain=.baidu.com; path=/', 'Transfer-Encoding': 'chunked'}\n```\n\n然而，如果想得到发送到服务器的请求的头部，我们可以简单地访问该请求，然后是该请求的头部：\n\n```python\n>>> r.request.headers\n{'User-Agent': 'python-requests/2.25.1', 'Accept-Encoding': 'gzip, deflate', 'Accept': '*/*',\n     'Connection': 'keep-alive'}\n```\n\n### 准备的请求 （Prepared Request）\n\n当你从 `API` 或者会话调用中收到一个 `Response` 对象时，`request` 属性其实是使用了 `PreparedRequest` 。有时在发送请求之前，你需要对 `body` 或者 `header` （或者别的什么东西）做一些额外处理，下面演示了一个简单的做法：\n\n```python\nfrom requests import Request, Session\n\ns = Session()\nreq = Request('GET', url,\n    data=data,\n    headers=header\n)\nprepped = req.prepare()\n\n# do something with prepped.body\n# do something with prepped.headers\n\nresp = s.send(prepped,\n    stream=stream,\n    verify=verify,\n    proxies=proxies,\n    cert=cert,\n    timeout=timeout\n)\n\nprint(resp.status_code)\n```\n\n由于你没有对 `Request` 对象做什么特殊事情，你立即准备和修改了 `PreparedRequest` 对象，然后把它和别的参数一起发送到 `requests.*` 或者 `Session.*`。\n\n然而，上述代码会失去 `Requests Session` 对象的一些优势， 尤其 `Session` 级别的状态，例如 `cookie` 就不会被应用到你的请求上去。要获取一个带有状态的 `PreparedRequest`， 请用 `Session.prepare_request()` 取代 `Request.prepare()` 的调用，如下所示：\n\n```python\nfrom requests import Request, Session\n\ns = Session()\nreq = Request('GET',  url,\n    data=data\n    headers=headers\n)\n\nprepped = s.prepare_request(req)\n\n# do something with prepped.body\n# do something with prepped.headers\n\nresp = s.send(prepped,\n    stream=stream,\n    verify=verify,\n    proxies=proxies,\n    cert=cert,\n    timeout=timeout\n)\n\nprint(resp.status_code)\n```\n\n### SSL 证书验证\n\n`Requests` 可以为 `HTTPS` 请求验证 `SSL` 证书，就像 `web` 浏览器一样。 `SSL` 验证默认是开启的，如果证书验证失败，`Requests` 会抛出 `SSLError`:\n\n```python\n>>> requests.get('https://requestb.in')\nrequests.exceptions.SSLError: hostname 'requestb.in' doesn't match either of '*.herokuapp.com', 'herokuapp.com'\n```\n\n在该域名上我没有设置 SSL(现在已经设置了，返回的`<Response [200]>`)，所以失败了。但 Github 设置了 SSL:\n\n```python\n>>> requests.get('https://github.com', verify=True)\n<Response [200]>\n```\n\n你可以为 `verify` 传入 `CA_BUNDLE` 文件的路径，或者包含可信任 `CA` 证书文件的文件夹路径：\n\n```python\n>>> requests.get('https://github.com', verify='/path/to/certfile')\n```\n\n或者将其保持在会话中：\n\n```\ns = requests.Session()\ns.verify = '/path/to/certfile'\n```\n\n**注解**\n\n如果 `verify` 设为文件夹路径，文件夹必须通过 `OpenSSL` 提供的 `c_rehash` 工具处理。\n\n你还可以通过 `REQUESTS_CA_BUNDLE` 环境变量定义可信任 `CA` 列表。\n\n如果你将 `verify` 设置为 `False`，`Requests` 也能忽略对 `SSL` 证书的验证。\n\n```python\n>>> requests.get('https://kennethreitz.org', verify=False)\n<Response [200]>\n```\n\n默认情况下， `verify` 是设置为 `True` 的。选项 `verify` 仅应用于主机证书。\n\n> 对于私有证书，你也可以传递一个 `CA_BUNDLE` 文件的路径给 `verify`。你也可以设置 `# REQUEST_CA_BUNDLE `环境变量。\n\n### 流式上传\n\n`Requests`支持流式上传，这允许你发送大的数据流或文件而无需先把它们读入内存。要使用流式上传，仅需为你的请求体提供一个类文件对象即可：\n\n```python\nwith open('massive-body') as f:\n    requests.post('http://some.url/streamed', data=f)\n```\n\n强烈建议你用`二进制模式（binary mode）`打开文件。这是因为 `requests` 可能会为你提供 `header` 中的 `Content-Length`，在这种情况下该值会被设为文件的字节数。如果你用文本模式打开文件，就可能碰到错误。\n\n### POST 多个分块编码的文件\n\n你可以在一个请求中发送多个文件。例如，假设你要上传多个图像文件到一个 `HTML` 表单，使用一个多文件 `field` 叫做 `\"images\"`:\n\n```html\n<input type=\"file\" name=\"images\" multiple=\"true\" required=\"true\"/>\n```\n\n要实现，只要把文件设到一个元组的列表中，其中元组结构为 `(form_field_name, file_info)`:\n\n```python\n>>> url = 'http://httpbin.org/post'\n>>> multiple_files = [\n        ('images', ('foo.png', open('foo.png', 'rb'), 'image/png')),\n        ('images', ('bar.png', open('bar.png', 'rb'), 'image/png'))]\n>>> r = requests.post(url, files=multiple_files)\n>>> r.text\n{\n  ...\n  'files': {'images': 'data:image/png;base64,iVBORw ....'}\n  'Content-Type': 'multipart/form-data; boundary=3131623adb2043caaeb5538cc7aa0b3a',\n  ...\n}\n```\n\n同样的，建议使用二进制打开文件。\n\n### 代理\n\n如果需要使用代理，你可以通过为任意请求方法提供 `proxies` 参数来配置单个请求:\n\n```python\nimport requests\n\nproxies = {\n  \"http\": \"http://10.10.1.10:3128\",\n  \"https\": \"http://10.10.1.10:1080\",\n}\n\nrequests.get(\"http://example.org\", proxies=proxies)\n```\n\n你也可以通过环境变量 `HTTP_PROXY` 和 `HTTPS_PROXY` 来配置代理。\n\n```python\n$ export HTTP_PROXY=\"http://10.10.1.10:3128\"\n$ export HTTPS_PROXY=\"http://10.10.1.10:1080\"\n\n$ python\n>>> import requests\n>>> requests.get(\"http://example.org\")\n```\n\n若你的代理需要使用`HTTP Basic Auth`，可以使用 `http://user:password@host/` 语法：\n\n```python\nproxies = {\n    \"http\": \"http://user:pass@10.10.1.10:3128/\",\n}\n```\n\n要为某个特定的连接方式或者主机设置代理，使用 `scheme://hostname` 作为 `key`， 它会针对指定的主机和连接方式进行匹配。\n\n```python\nproxies = {'http://10.20.1.128': 'http://10.10.1.10:5323'}\n```\n\n注意，代理 `URL` 必须包含连接方式。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","slug":"Requests库的使用","published":1,"updated":"2021-06-17T16:13:11.503Z","layout":"post","photos":[],"link":"","_id":"ckq14rx3u007544ud5q3r8vid","content":"<blockquote>\n<p>Requests is an elegant and simple HTTP library for Python, built for human beings.</p>\n</blockquote>\n<p><code>Requests</code> 唯一的一个非转基因的 <code>Python HTTP</code> 库，人类可以安全享用。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p><code>Requests</code>是一个第三方的库，建议在虚拟环境中安装。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install requests</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"快速上手\"><a href=\"#快速上手\" class=\"headerlink\" title=\"快速上手\"></a>快速上手</h2><h3 id=\"发送请求\"><a href=\"#发送请求\" class=\"headerlink\" title=\"发送请求\"></a>发送请求</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装requests模块</span></span><br><span class=\"line\"><span class=\"comment\"># pip install requests</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 导入requests</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 目标url</span></span><br><span class=\"line\">url = <span class=\"string\">&quot;https://www.baidu.com&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 向目标url发送请求</span></span><br><span class=\"line\">response = requests.get(url)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 打印响应内容</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(response.text)</span><br></pre></td></tr></table></figure>\n\n<p><code>Requests</code> 会自动解码来自服务器的内容。大多数 unicode 字符集都能被无缝地解码。</p>\n<p>请求发出后， <code>Requests</code> 会基于 <code>HTTP</code> 头部对响应的编码作出有根据的推测。当你访问 <code>response.text</code> 之时，<code>Requests</code> 会使用其推测的文本编码。你可以找出 <code>Requests</code> 使用了什么编码，并且能够使用 <code>response.encoding</code> 属性来改变它：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 设置响应编码方式</span></span><br><span class=\"line\">response.encoding = <span class=\"string\">&#x27;ISO-8859-1&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"二进制响应内容\"><a href=\"#二进制响应内容\" class=\"headerlink\" title=\"二进制响应内容\"></a>二进制响应内容</h3><p>你也能以字节的方式访问请求响应体，对于非文本请求：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 打印响应内容, 二进制格式</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(response.content)`</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"传递-URL-参数\"><a href=\"#传递-URL-参数\" class=\"headerlink\" title=\"传递 URL 参数\"></a>传递 URL 参数</h3><p>你也许经常想为 <code>URL</code> 的查询字符串(query string)传递某种数据。如果你是手工构建 <code>URL</code>，那么数据会以键/值对的形式置于 <code>URL</code> 中，跟在一个问号的后面。例如，<code> httpbin.org/get?key=val</code>。 <code>Requests</code> 允许你使用 <code>params</code> 关键字参数，以一个字符串字典来提供这些参数。举例来说，如果你想传递<code> key1=value1</code> 和 <code>key2=value2</code> 到 <code>httpbin.org/get</code> ，那么你可以使用如下代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>payload = &#123;<span class=\"string\">&#x27;key1&#x27;</span>: <span class=\"string\">&#x27;value1&#x27;</span>, <span class=\"string\">&#x27;key2&#x27;</span>: <span class=\"string\">&#x27;value2&#x27;</span>&#125;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&quot;http://httpbin.org/get&quot;</span>, params=payload)</span><br></pre></td></tr></table></figure>\n\n<p>通过打印输出该 <code>URL</code>，你能看到 <code>URL</code> 已被正确编码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">print</span>(r.url)</span><br><span class=\"line\">http://httpbin.org/get?key2=value2&amp;key1=value1</span><br></pre></td></tr></table></figure>\n\n<p>注意字典里值为 <code>None</code> 的键都不会被添加到 <code>URL</code> 的查询字符串里。</p>\n<p>你还可以将一个列表作为值传入：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>payload = &#123;<span class=\"string\">&#x27;key1&#x27;</span>: <span class=\"string\">&#x27;value1&#x27;</span>, <span class=\"string\">&#x27;key2&#x27;</span>: [<span class=\"string\">&#x27;value2&#x27;</span>, <span class=\"string\">&#x27;value3&#x27;</span>]&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&#x27;http://httpbin.org/get&#x27;</span>, params=payload)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">print</span>(r.url)</span><br><span class=\"line\">http://httpbin.org/get?key1=value1&amp;key2=value2&amp;key2=value3</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"JSON-响应内容\"><a href=\"#JSON-响应内容\" class=\"headerlink\" title=\"JSON 响应内容\"></a>JSON 响应内容</h3><p><code>Requests</code> 中也有一个内置的 <code>JSON</code> 解码器，助你处理 <code>JSON</code> 数据：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&#x27;https://api.github.com/events&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.json()</span><br><span class=\"line\">[&#123;<span class=\"string\">u&#x27;repository&#x27;</span>: &#123;<span class=\"string\">u&#x27;open_issues&#x27;</span>: <span class=\"number\">0</span>, <span class=\"string\">u&#x27;url&#x27;</span>: <span class=\"string\">&#x27;https://github.com/...</span></span><br><span class=\"line\"><span class=\"string\">&gt;&gt;&gt; r.status_code</span></span><br><span class=\"line\"><span class=\"string\">200</span></span><br></pre></td></tr></table></figure>\n\n<p>如果 <code>JSON</code> 解码失败， <code>r.json()</code> 就会抛出一个异常。例如，响应内容是 <code>401 (Unauthorized)</code>，尝试访问 <code>r.json()</code> 将会抛出 <code>ValueError: No JSON object could be decoded </code>异常。</p>\n<p>需要注意的是，成功调用 <code>r.json()</code> 并<strong>不</strong>意味着响应的成功。有的服务器会在失败的响应中包含一个 <code>JSON</code> 对象（比如<code>HTTP 500</code>的错误细节）。这种 <code>JSON</code> 会被解码返回。要检查请求是否成功，请使用 <code>r.raise_for_status()</code> 或者检查 <code>r.status_code</code> 是否和你的期望相同。</p>\n<h3 id=\"原始响应内容\"><a href=\"#原始响应内容\" class=\"headerlink\" title=\"原始响应内容\"></a>原始响应内容</h3><p>在某些情况下，如果你想获取来自服务器的原始套接字响应，那么你可以访问 <code>r.raw</code>。 如果你确实想这么干，那请你确保在初始请求中设置了 <code>stream=True</code>。具体你可以这么做：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&#x27;https://api.github.com/events&#x27;</span>, stream=<span class=\"literal\">True</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.raw</span><br><span class=\"line\">&lt;urllib3.response.HTTPResponse <span class=\"built_in\">object</span> at <span class=\"number\">0x00000197FAA56AC0</span>&gt;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.raw.read(<span class=\"number\">10</span>)</span><br><span class=\"line\"><span class=\"string\">b&#x27;\\x1f\\x8b\\x08\\x00\\x00\\x00\\x00\\x00\\x00\\x03&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>但一般情况下，你应该以下面的模式将文本流保存到文件：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(filename, <span class=\"string\">&#x27;wb&#x27;</span>) <span class=\"keyword\">as</span> fd:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> chunk <span class=\"keyword\">in</span> r.iter_content(chunk_size):</span><br><span class=\"line\">        fd.write(chunk)</span><br></pre></td></tr></table></figure>\n\n<p>使用 <code>Response.iter_content</code> 将会处理大量你直接使用 <code>Response.raw</code> 不得不处理的。 当流下载时，上面是优先推荐的获取内容方式。 </p>\n<h3 id=\"定制请求头\"><a href=\"#定制请求头\" class=\"headerlink\" title=\"定制请求头\"></a>定制请求头</h3><p>如果你想为请求添加 <code>HTTP</code> 头部，只要简单地传递一个 <code>dict</code> 给 <code>headers</code> 参数就可以了。</p>\n<p>例如，在前一个示例中我们没有指定 <code>content-type</code>:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>url = <span class=\"string\">&#x27;https://api.github.com/some/endpoint&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>headers = &#123;<span class=\"string\">&#x27;user-agent&#x27;</span>: <span class=\"string\">&#x27;my-app/0.0.1&#x27;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(url, headers=headers)</span><br></pre></td></tr></table></figure>\n\n<p>注意: 定制 <code>header</code> 的优先级低于某些特定的信息源，例如：</p>\n<ul>\n<li>如果在 <code>.netrc</code> 中设置了用户认证信息，使用 <code>headers=</code> 设置的授权就不会生效。而如果设置了<code> auth=</code> 参数，<code>.netrc</code> 的设置就无效了。</li>\n<li>如果被重定向到别的主机，授权 <code>header</code> 就会被删除。</li>\n<li>代理授权 <code>header</code> 会被 URL 中提供的代理身份覆盖掉。</li>\n<li>在我们能判断内容长度的情况下，<code>header</code> 的 <code>Content-Length</code> 会被改写。</li>\n</ul>\n<p>更进一步讲，<code>Requests</code> 不会基于定制 <code>header</code> 的具体情况改变自己的行为。只不过在最后的请求中，所有的 <code>header</code> 信息都会被传递进去。</p>\n<p>注意: 所有的 head<code>er 值必须是 </code>string、bytestring<code>或者</code>unicode<code>。尽管传递 </code>unicode header` 也是允许的，但不建议这样做。</p>\n<h3 id=\"更加复杂的-POST-请求\"><a href=\"#更加复杂的-POST-请求\" class=\"headerlink\" title=\"更加复杂的 POST 请求\"></a>更加复杂的 POST 请求</h3><p>通常，你想要发送一些编码为表单形式的数据——非常像一个 <code>HTML</code> 表单。要实现这个，只需简单地传递一个字典给 <code>data</code> 参数。你的数据字典在发出请求时会自动编码为表单形式：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>payload = &#123;<span class=\"string\">&#x27;key1&#x27;</span>: <span class=\"string\">&#x27;value1&#x27;</span>, <span class=\"string\">&#x27;key2&#x27;</span>: <span class=\"string\">&#x27;value2&#x27;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.post(<span class=\"string\">&quot;http://httpbin.org/post&quot;</span>, data=payload)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">print</span>(r.text)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"string\">&quot;form&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;key2&quot;</span>: <span class=\"string\">&quot;value2&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;key1&quot;</span>: <span class=\"string\">&quot;value1&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>你还可以为 <code>data</code> 参数传入一个元组列表。在表单中多个元素使用同一 <code>key</code> 的时候，这种方式尤其有效：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>payload = ((<span class=\"string\">&#x27;key1&#x27;</span>, <span class=\"string\">&#x27;value1&#x27;</span>), (<span class=\"string\">&#x27;key1&#x27;</span>, <span class=\"string\">&#x27;value2&#x27;</span>))</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.post(<span class=\"string\">&#x27;http://httpbin.org/post&#x27;</span>, data=payload)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">print</span>(r.text)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"string\">&quot;form&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;key1&quot;</span>: [</span><br><span class=\"line\">      <span class=\"string\">&quot;value1&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;value2&quot;</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  ...</span><br></pre></td></tr></table></figure>\n\n<p>很多时候你想要发送的数据并非编码为表单形式的。如果你传递一个 <code>string</code> 而不是一个 <code>dict</code> ，那么数据会被直接发布出去。</p>\n<p>例如，<code>Github API v3</code> 接受编码为 <code>JSON</code> 的 <code>POST/PATCH</code> 数据：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">import</span> json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>url = <span class=\"string\">&#x27;https://api.github.com/some/endpoint&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>payload = &#123;<span class=\"string\">&#x27;some&#x27;</span>: <span class=\"string\">&#x27;data&#x27;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.post(url, data=json.dumps(payload))</span><br></pre></td></tr></table></figure>\n\n<p>此处除了可以自行对 <code>dict</code> 进行编码，你还可以使用 <code>json</code> 参数直接传递，然后它就会被自动编码。这是 <code>2.4.2 </code>版的新加功能：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>url = <span class=\"string\">&#x27;https://api.github.com/some/endpoint&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>payload = &#123;<span class=\"string\">&#x27;some&#x27;</span>: <span class=\"string\">&#x27;data&#x27;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.post(url, json=payload)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"响应状态码\"><a href=\"#响应状态码\" class=\"headerlink\" title=\"响应状态码\"></a>响应状态码</h3><p>可以检测响应状态码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&#x27;http://httpbin.org/get&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.status_code</span><br><span class=\"line\"><span class=\"number\">200</span></span><br></pre></td></tr></table></figure>\n\n<p>为方便引用，<code>Requests</code>还附带了一个内置的状态码查询对象：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; r.status_code == requests.codes.ok</span><br><span class=\"line\">True</span><br></pre></td></tr></table></figure>\n\n<p>如果发送了一个错误请求(一个 4XX 客户端错误，或者 5XX 服务器错误响应)，我们可以通过 <code>Response.raise_for_status()</code> 来抛出异常：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; bad_r = requests.get(&#x27;http://httpbin.org/status/404&#x27;)</span><br><span class=\"line\">&gt;&gt;&gt; bad_r.status_code</span><br><span class=\"line\">404</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt; bad_r.raise_for_status()</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File &quot;requests/models.py&quot;, line 832, in raise_for_status</span><br><span class=\"line\">    raise http_error</span><br><span class=\"line\">requests.exceptions.HTTPError: 404 Client Error</span><br></pre></td></tr></table></figure>\n\n<p>如果响应对象 <code>r</code> 的 <code>status_code</code> 是 <code>200</code> ，当我们调用 <code>raise_for_status()</code> 时，得到的是：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.raise_for_status()</span><br><span class=\"line\"><span class=\"literal\">None</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"响应头\"><a href=\"#响应头\" class=\"headerlink\" title=\"响应头\"></a>响应头</h3><p>我们可以查看以一个 <code>Python</code> 字典形式展示的服务器响应头：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.headers</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;content-encoding&#x27;</span>: <span class=\"string\">&#x27;gzip&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;transfer-encoding&#x27;</span>: <span class=\"string\">&#x27;chunked&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;connection&#x27;</span>: <span class=\"string\">&#x27;close&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.0.4&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;x-runtime&#x27;</span>: <span class=\"string\">&#x27;148ms&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;etag&#x27;</span>: <span class=\"string\">&#x27;&quot;e1ca502697e5c9317743dc078f67693f&quot;&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;content-type&#x27;</span>: <span class=\"string\">&#x27;application/json&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>但是这个字典比较特殊：它是仅为 <code>HTTP</code> 头部而生的。根据 <code>RFC 2616</code>， <code>HTTP</code> 头部是大小写不敏感的。</p>\n<p>因此，我们可以使用任意大写形式来访问这些响应头字段：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.headers[<span class=\"string\">&#x27;Content-Type&#x27;</span>]</span><br><span class=\"line\"><span class=\"string\">&#x27;application/json&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.headers.get(<span class=\"string\">&#x27;content-type&#x27;</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;application/json&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>它还有一个特殊点，那就是服务器可以多次接受同一 <code>header</code>，每次都使用不同的值。</p>\n<h3 id=\"Cookie\"><a href=\"#Cookie\" class=\"headerlink\" title=\"Cookie\"></a>Cookie</h3><p>如果某个响应中包含一些 <code>cookie</code>，你可以快速访问它们：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>url = <span class=\"string\">&#x27;http://www.baidu.com&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(url)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.cookies</span><br><span class=\"line\">&lt;RequestsCookieJar[Cookie(version=<span class=\"number\">0</span>, name=<span class=\"string\">&#x27;BDORZ&#x27;</span>, value=<span class=\"string\">&#x27;27315&#x27;</span>, port=<span class=\"literal\">None</span>, port_specified=<span class=\"literal\">False</span>, domain=<span class=\"string\">&#x27;.baidu.com&#x27;</span>, domain_specified=<span class=\"literal\">True</span>, domain_initial_dot=<span class=\"literal\">True</span>, path=<span class=\"string\">&#x27;/&#x27;</span>, path_specified=<span class=\"literal\">True</span>, secure=<span class=\"literal\">False</span>, expires=<span class=\"number\">1624028209</span>, discard=<span class=\"literal\">False</span>, comment=<span class=\"literal\">None</span>, comment_url=<span class=\"literal\">None</span>, rest=&#123;&#125;, rfc2109=<span class=\"literal\">False</span>)]&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.cookies.get_dict()</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;BDORZ&#x27;</span>: <span class=\"string\">&#x27;27315&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>要想发送你的<code>cookies</code>到服务器，可以使用 <code>cookies</code> 参数：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; url = &#x27;http://httpbin.org/cookies&#x27;</span><br><span class=\"line\">&gt;&gt;&gt; cookies = dict(cookies_are=&#x27;working&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt; r = requests.get(url, cookies=cookies)</span><br><span class=\"line\">&gt;&gt;&gt; r.text</span><br><span class=\"line\">&#x27;&#123;&quot;cookies&quot;: &#123;&quot;cookies_are&quot;: &quot;working&quot;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>\n\n<p><code>Cookie</code> 的返回对象为 <code>RequestsCookieJar</code> ，它的行为和字典类似，但接口更为完整，适合跨域名跨路径使用。你还可以把 <code>Cookie Jar</code> 传到 <code>Requests</code> 中：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>jar = requests.cookies.RequestsCookieJar()</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>jar.<span class=\"built_in\">set</span>(<span class=\"string\">&#x27;tasty_cookie&#x27;</span>, <span class=\"string\">&#x27;yum&#x27;</span>, domain=<span class=\"string\">&#x27;httpbin.org&#x27;</span>, path=<span class=\"string\">&#x27;/cookies&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>jar.<span class=\"built_in\">set</span>(<span class=\"string\">&#x27;gross_cookie&#x27;</span>, <span class=\"string\">&#x27;blech&#x27;</span>, domain=<span class=\"string\">&#x27;httpbin.org&#x27;</span>, path=<span class=\"string\">&#x27;/elsewhere&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>url = <span class=\"string\">&#x27;http://httpbin.org/cookies&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(url, cookies=jar)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.text</span><br><span class=\"line\"><span class=\"string\">&#x27;&#123;&quot;cookies&quot;: &#123;&quot;tasty_cookie&quot;: &quot;yum&quot;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"重定向与请求历史\"><a href=\"#重定向与请求历史\" class=\"headerlink\" title=\"重定向与请求历史\"></a>重定向与请求历史</h3><p>默认情况下，除了 <code>HEAD, Requests</code> 会自动处理所有重定向。</p>\n<p>可以使用响应对象的 <code>history</code> 方法来追踪重定向。</p>\n<p><code>Response.history</code> 是一个 <code>Response</code> 对象的列表，为了完成请求而创建了这些对象。这个对象列表按照从最老到最近的请求进行排序。</p>\n<p>例如，Github 将所有的 <code>HTTP</code> 请求重定向到 <code>HTTPS</code>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&#x27;http://github.com&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.url</span><br><span class=\"line\"><span class=\"string\">&#x27;https://github.com/&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.status_code</span><br><span class=\"line\"><span class=\"number\">200</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.history</span><br><span class=\"line\">[&lt;Response [<span class=\"number\">301</span>]&gt;]</span><br></pre></td></tr></table></figure>\n\n<p>如果你使用的是<code>GET、OPTIONS、POST、PUT、PATCH</code> 或者 <code>DELETE</code>，那么你可以通过 <code>allow_redirects</code> 参数禁用重定向处理：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&#x27;http://github.com&#x27;</span>, allow_redirects=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.status_code</span><br><span class=\"line\"><span class=\"number\">301</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.history</span><br><span class=\"line\">[]</span><br></pre></td></tr></table></figure>\n\n<p>如果你使用了 <code>HEAD</code>，你也可以启用重定向：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.head(<span class=\"string\">&#x27;http://github.com&#x27;</span>, allow_redirects=<span class=\"literal\">True</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.url</span><br><span class=\"line\"><span class=\"string\">&#x27;https://github.com/&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.history</span><br><span class=\"line\">[&lt;Response [<span class=\"number\">301</span>]&gt;]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"超时处理\"><a href=\"#超时处理\" class=\"headerlink\" title=\"超时处理\"></a>超时处理</h3><p>你可以告诉 <code>requests</code> 在经过以 <code>timeout</code> 参数设定的秒数时间之后停止等待响应。基本上所有的生产代码都应该使用这一参数。如果不使用，你的程序可能会永远失去响应：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>requests.get(<span class=\"string\">&#x27;http://github.com&#x27;</span>, timeout=<span class=\"number\">0.001</span>)</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File <span class=\"string\">&quot;&lt;stdin&gt;&quot;</span>, line <span class=\"number\">1</span>, <span class=\"keyword\">in</span> &lt;module&gt;</span><br><span class=\"line\">requests.exceptions.Timeout: HTTPConnectionPool(host=<span class=\"string\">&#x27;github.com&#x27;</span>, port=<span class=\"number\">80</span>): Request timed out. (timeout=<span class=\"number\">0.001</span>)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意<br> <code>timeout</code> 仅对连接过程有效，与响应体的下载无关。 <code>timeout</code> 并不是整个下载响应的时间限制，而是如果服务器在 <code>timeout</code> 秒内没有应答，将会引发一个异常（更精确地说，是在 <code>timeout</code> 秒内没有从基础套接字上接收到任何字节的数据时）。</p>\n</blockquote>\n<h3 id=\"错误与异常\"><a href=\"#错误与异常\" class=\"headerlink\" title=\"错误与异常\"></a>错误与异常</h3><p>遇到网络问题（如：DNS 查询失败、拒绝连接等）时， <code>Requests</code> 会抛出一个 <code>ConnectionError</code> 异常。</p>\n<p>如果 <code>HTTP</code> 请求返回了不成功的状态码， <code>Response.raise_for_status()</code> 会抛出一个 <code>HTTPError</code> 异常。</p>\n<p>若请求超时，则抛出一个 <code>Timeout</code> 异常。</p>\n<p>若请求超过了设定的最大重定向次数，则会抛出一个 <code>TooManyRedirects</code> 异常。</p>\n<p>所有<code>Requests</code>显式抛出的异常都继承自<code>requests.exceptions.RequestException</code> 。</p>\n<h2 id=\"高级用法\"><a href=\"#高级用法\" class=\"headerlink\" title=\"高级用法\"></a>高级用法</h2><p>接下来介绍一些 <code>requests</code> 的高级用法。</p>\n<h3 id=\"会话对象\"><a href=\"#会话对象\" class=\"headerlink\" title=\"会话对象\"></a>会话对象</h3><p>会话对象让你能够跨请求保持某些参数。它也会在同一个 <code>Session</code> 实例发出的所有请求之间保持 <code>cookie</code> ， 期间使用 <code>urllib3</code> 的 <code>connection pooling</code> 功能。所以如果你向同一主机发送多个请求，底层的 <code>TCP</code> 连接将会被重用，从而带来显著的性能提升。</p>\n<p>会话对象具有主要的 <code>Requests API</code> 的所有方法。</p>\n<p>我们来跨请求保持一些 <code>cookie</code>:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建一个会话对象</span></span><br><span class=\"line\">s = requests.Session()</span><br><span class=\"line\"></span><br><span class=\"line\">s.get(<span class=\"string\">&#x27;http://httpbin.org/cookies/set/sessioncookie/123456789&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">r = s.get(<span class=\"string\">&quot;https://httpbin.org/cookies&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#   &quot;cookies&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     &quot;sessioncookie&quot;: &quot;123456789&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#   &#125;</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>会话也可用来为请求方法提供缺省数据。这是通过为会话对象的属性提供数据来实现的：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = requests.Session()</span><br><span class=\"line\">s.auth = (<span class=\"string\">&#x27;user&#x27;</span>, <span class=\"string\">&#x27;pass&#x27;</span>)</span><br><span class=\"line\">s.headers.update(&#123;<span class=\"string\">&#x27;x-test&#x27;</span>: <span class=\"string\">&#x27;true&#x27;</span>&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># both &#x27;x-test&#x27; and &#x27;x-test2&#x27; are sent</span></span><br><span class=\"line\">s.get(<span class=\"string\">&#x27;http://httpbin.org/headers&#x27;</span>, headers=&#123;<span class=\"string\">&#x27;x-test2&#x27;</span>: <span class=\"string\">&#x27;true&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n\n<p>任何你传递给请求方法的字典都会与已设置会话层数据合并。方法层的参数覆盖会话的参数。</p>\n<p>不过需要注意，就算使用了会话，方法级别的参数也不会被跨请求保持。下面的例子只会和第一个请求发送 <code>cookie</code> ，而非第二个：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = requests.Session()</span><br><span class=\"line\"></span><br><span class=\"line\">r = s.get(<span class=\"string\">&#x27;http://httpbin.org/cookies&#x27;</span>, cookies=&#123;<span class=\"string\">&#x27;from-my&#x27;</span>: <span class=\"string\">&#x27;browser&#x27;</span>&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br><span class=\"line\"><span class=\"comment\"># &#x27;&#123;&quot;cookies&quot;: &#123;&quot;from-my&quot;: &quot;browser&quot;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">r = s.get(<span class=\"string\">&#x27;http://httpbin.org/cookies&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br><span class=\"line\"><span class=\"comment\"># &#x27;&#123;&quot;cookies&quot;: &#123;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果你要手动为会话添加 <code>cookie</code> ，就使用 <code>Cookie utility</code> 函数 来操纵 <code>Session.cookies</code>。</p>\n<p>会话还可以用作前后文管理器：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">with</span> requests.Session() <span class=\"keyword\">as</span> s:</span><br><span class=\"line\">    s.get(<span class=\"string\">&#x27;http://httpbin.org/cookies/set/sessioncookie/123456789&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这样就能确保 <code>with</code> 区块退出后会话能被关闭，即使发生了异常也一样。</p>\n<p>从字典参数中移除一个值<br>有时你会想省略字典参数中一些会话层的键。要做到这一点，你只需简单地在方法层参数中将那个键的值设置为 <code>None</code> ，那个键就会被自动省略掉。</p>\n<h3 id=\"请求与响应对象\"><a href=\"#请求与响应对象\" class=\"headerlink\" title=\"请求与响应对象\"></a>请求与响应对象</h3><p>任何时候进行了类似 <code>requests.get()</code> 的调用，你都在做两件主要的事情。其一，你在构建一个 <code>Request</code> 对象， 该对象将被发送到某个服务器请求或查询一些资源。其二，一旦 <code>requests</code> 得到一个从服务器返回的响应就会产生一个 <code>Response</code> 对象。该响应对象包含服务器返回的所有信息，也包含你原来创建的 <code>Request</code> 对象。如下是一个简单的请求，从 <code>Baidu</code> 的服务器得到一些非常重要的信息：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&quot;https://www.baidu.com&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>如果想访问服务器返回给我们的响应头部信息，可以这样做：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.headers</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;Cache-Control&#x27;</span>: <span class=\"string\">&#x27;private, no-cache, no-store, proxy-revalidate, no-transform&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;Content-Encoding&#x27;</span>: <span class=\"string\">&#x27;gzip&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Thu, 17 Jun 2021 15:52:48 GMT&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Mon, 23 Jan 2017 13:23:55 GMT&#x27;</span>, <span class=\"string\">&#x27;Pragma&#x27;</span>: <span class=\"string\">&#x27;no-cache&#x27;</span>, <span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;bfe/1.0.8.18&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;Set-Cookie&#x27;</span>: <span class=\"string\">&#x27;BDORZ=27315; max-age=86400; domain=.baidu.com; path=/&#x27;</span>, <span class=\"string\">&#x27;Transfer-Encoding&#x27;</span>: <span class=\"string\">&#x27;chunked&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然而，如果想得到发送到服务器的请求的头部，我们可以简单地访问该请求，然后是该请求的头部：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.request.headers</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;User-Agent&#x27;</span>: <span class=\"string\">&#x27;python-requests/2.25.1&#x27;</span>, <span class=\"string\">&#x27;Accept-Encoding&#x27;</span>: <span class=\"string\">&#x27;gzip, deflate&#x27;</span>, <span class=\"string\">&#x27;Accept&#x27;</span>: <span class=\"string\">&#x27;*/*&#x27;</span>,</span><br><span class=\"line\">     <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"准备的请求-（Prepared-Request）\"><a href=\"#准备的请求-（Prepared-Request）\" class=\"headerlink\" title=\"准备的请求 （Prepared Request）\"></a>准备的请求 （Prepared Request）</h3><p>当你从 <code>API</code> 或者会话调用中收到一个 <code>Response</code> 对象时，<code>request</code> 属性其实是使用了 <code>PreparedRequest</code> 。有时在发送请求之前，你需要对 <code>body</code> 或者 <code>header</code> （或者别的什么东西）做一些额外处理，下面演示了一个简单的做法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> requests <span class=\"keyword\">import</span> Request, Session</span><br><span class=\"line\"></span><br><span class=\"line\">s = Session()</span><br><span class=\"line\">req = Request(<span class=\"string\">&#x27;GET&#x27;</span>, url,</span><br><span class=\"line\">    data=data,</span><br><span class=\"line\">    headers=header</span><br><span class=\"line\">)</span><br><span class=\"line\">prepped = req.prepare()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># do something with prepped.body</span></span><br><span class=\"line\"><span class=\"comment\"># do something with prepped.headers</span></span><br><span class=\"line\"></span><br><span class=\"line\">resp = s.send(prepped,</span><br><span class=\"line\">    stream=stream,</span><br><span class=\"line\">    verify=verify,</span><br><span class=\"line\">    proxies=proxies,</span><br><span class=\"line\">    cert=cert,</span><br><span class=\"line\">    timeout=timeout</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(resp.status_code)</span><br></pre></td></tr></table></figure>\n\n<p>由于你没有对 <code>Request</code> 对象做什么特殊事情，你立即准备和修改了 <code>PreparedRequest</code> 对象，然后把它和别的参数一起发送到 <code>requests.*</code> 或者 <code>Session.*</code>。</p>\n<p>然而，上述代码会失去 <code>Requests Session</code> 对象的一些优势， 尤其 <code>Session</code> 级别的状态，例如 <code>cookie</code> 就不会被应用到你的请求上去。要获取一个带有状态的 <code>PreparedRequest</code>， 请用 <code>Session.prepare_request()</code> 取代 <code>Request.prepare()</code> 的调用，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> requests <span class=\"keyword\">import</span> Request, Session</span><br><span class=\"line\"></span><br><span class=\"line\">s = Session()</span><br><span class=\"line\">req = Request(<span class=\"string\">&#x27;GET&#x27;</span>,  url,</span><br><span class=\"line\">    data=data</span><br><span class=\"line\">    headers=headers</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">prepped = s.prepare_request(req)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># do something with prepped.body</span></span><br><span class=\"line\"><span class=\"comment\"># do something with prepped.headers</span></span><br><span class=\"line\"></span><br><span class=\"line\">resp = s.send(prepped,</span><br><span class=\"line\">    stream=stream,</span><br><span class=\"line\">    verify=verify,</span><br><span class=\"line\">    proxies=proxies,</span><br><span class=\"line\">    cert=cert,</span><br><span class=\"line\">    timeout=timeout</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(resp.status_code)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"SSL-证书验证\"><a href=\"#SSL-证书验证\" class=\"headerlink\" title=\"SSL 证书验证\"></a>SSL 证书验证</h3><p><code>Requests</code> 可以为 <code>HTTPS</code> 请求验证 <code>SSL</code> 证书，就像 <code>web</code> 浏览器一样。 <code>SSL</code> 验证默认是开启的，如果证书验证失败，<code>Requests</code> 会抛出 <code>SSLError</code>:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>requests.get(<span class=\"string\">&#x27;https://requestb.in&#x27;</span>)</span><br><span class=\"line\">requests.exceptions.SSLError: hostname <span class=\"string\">&#x27;requestb.in&#x27;</span> doesn<span class=\"string\">&#x27;t match either of &#x27;</span>*.herokuapp.com<span class=\"string\">&#x27;, &#x27;</span>herokuapp.com<span class=\"string\">&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>在该域名上我没有设置 SSL(现在已经设置了，返回的<code>&lt;Response [200]&gt;</code>)，所以失败了。但 Github 设置了 SSL:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>requests.get(<span class=\"string\">&#x27;https://github.com&#x27;</span>, verify=<span class=\"literal\">True</span>)</span><br><span class=\"line\">&lt;Response [<span class=\"number\">200</span>]&gt;</span><br></pre></td></tr></table></figure>\n\n<p>你可以为 <code>verify</code> 传入 <code>CA_BUNDLE</code> 文件的路径，或者包含可信任 <code>CA</code> 证书文件的文件夹路径：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>requests.get(<span class=\"string\">&#x27;https://github.com&#x27;</span>, verify=<span class=\"string\">&#x27;/path/to/certfile&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>或者将其保持在会话中：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = requests.Session()</span><br><span class=\"line\">s.verify = &#x27;/path/to/certfile&#x27;</span><br></pre></td></tr></table></figure>\n\n<p><strong>注解</strong></p>\n<p>如果 <code>verify</code> 设为文件夹路径，文件夹必须通过 <code>OpenSSL</code> 提供的 <code>c_rehash</code> 工具处理。</p>\n<p>你还可以通过 <code>REQUESTS_CA_BUNDLE</code> 环境变量定义可信任 <code>CA</code> 列表。</p>\n<p>如果你将 <code>verify</code> 设置为 <code>False</code>，<code>Requests</code> 也能忽略对 <code>SSL</code> 证书的验证。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>requests.get(<span class=\"string\">&#x27;https://kennethreitz.org&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">&lt;Response [<span class=\"number\">200</span>]&gt;</span><br></pre></td></tr></table></figure>\n\n<p>默认情况下， <code>verify</code> 是设置为 <code>True</code> 的。选项 <code>verify</code> 仅应用于主机证书。</p>\n<blockquote>\n<p>对于私有证书，你也可以传递一个 <code>CA_BUNDLE</code> 文件的路径给 <code>verify</code>。你也可以设置 <code># REQUEST_CA_BUNDLE </code>环境变量。</p>\n</blockquote>\n<h3 id=\"流式上传\"><a href=\"#流式上传\" class=\"headerlink\" title=\"流式上传\"></a>流式上传</h3><p><code>Requests</code>支持流式上传，这允许你发送大的数据流或文件而无需先把它们读入内存。要使用流式上传，仅需为你的请求体提供一个类文件对象即可：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;massive-body&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    requests.post(<span class=\"string\">&#x27;http://some.url/streamed&#x27;</span>, data=f)</span><br></pre></td></tr></table></figure>\n\n<p>强烈建议你用<code>二进制模式（binary mode）</code>打开文件。这是因为 <code>requests</code> 可能会为你提供 <code>header</code> 中的 <code>Content-Length</code>，在这种情况下该值会被设为文件的字节数。如果你用文本模式打开文件，就可能碰到错误。</p>\n<h3 id=\"POST-多个分块编码的文件\"><a href=\"#POST-多个分块编码的文件\" class=\"headerlink\" title=\"POST 多个分块编码的文件\"></a>POST 多个分块编码的文件</h3><p>你可以在一个请求中发送多个文件。例如，假设你要上传多个图像文件到一个 <code>HTML</code> 表单，使用一个多文件 <code>field</code> 叫做 <code>&quot;images&quot;</code>:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;images&quot;</span> <span class=\"attr\">multiple</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">required</span>=<span class=\"string\">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>要实现，只要把文件设到一个元组的列表中，其中元组结构为 <code>(form_field_name, file_info)</code>:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>url = <span class=\"string\">&#x27;http://httpbin.org/post&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>multiple_files = [</span><br><span class=\"line\">        (<span class=\"string\">&#x27;images&#x27;</span>, (<span class=\"string\">&#x27;foo.png&#x27;</span>, <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;foo.png&#x27;</span>, <span class=\"string\">&#x27;rb&#x27;</span>), <span class=\"string\">&#x27;image/png&#x27;</span>)),</span><br><span class=\"line\">        (<span class=\"string\">&#x27;images&#x27;</span>, (<span class=\"string\">&#x27;bar.png&#x27;</span>, <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;bar.png&#x27;</span>, <span class=\"string\">&#x27;rb&#x27;</span>), <span class=\"string\">&#x27;image/png&#x27;</span>))]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.post(url, files=multiple_files)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.text</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"string\">&#x27;files&#x27;</span>: &#123;<span class=\"string\">&#x27;images&#x27;</span>: <span class=\"string\">&#x27;data:image/png;base64,iVBORw ....&#x27;</span>&#125;</span><br><span class=\"line\">  <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;multipart/form-data; boundary=3131623adb2043caaeb5538cc7aa0b3a&#x27;</span>,</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>同样的，建议使用二进制打开文件。</p>\n<h3 id=\"代理\"><a href=\"#代理\" class=\"headerlink\" title=\"代理\"></a>代理</h3><p>如果需要使用代理，你可以通过为任意请求方法提供 <code>proxies</code> 参数来配置单个请求:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">proxies = &#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;http&quot;</span>: <span class=\"string\">&quot;http://10.10.1.10:3128&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;https&quot;</span>: <span class=\"string\">&quot;http://10.10.1.10:1080&quot;</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">requests.get(<span class=\"string\">&quot;http://example.org&quot;</span>, proxies=proxies)</span><br></pre></td></tr></table></figure>\n\n<p>你也可以通过环境变量 <code>HTTP_PROXY</code> 和 <code>HTTPS_PROXY</code> 来配置代理。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ export HTTP_PROXY=<span class=\"string\">&quot;http://10.10.1.10:3128&quot;</span></span><br><span class=\"line\">$ export HTTPS_PROXY=<span class=\"string\">&quot;http://10.10.1.10:1080&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ python</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>requests.get(<span class=\"string\">&quot;http://example.org&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>若你的代理需要使用<code>HTTP Basic Auth</code>，可以使用 <code>http://user:password@host/</code> 语法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">proxies = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;http&quot;</span>: <span class=\"string\">&quot;http://user:pass@10.10.1.10:3128/&quot;</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>要为某个特定的连接方式或者主机设置代理，使用 <code>scheme://hostname</code> 作为 <code>key</code>， 它会针对指定的主机和连接方式进行匹配。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">proxies = &#123;<span class=\"string\">&#x27;http://10.20.1.128&#x27;</span>: <span class=\"string\">&#x27;http://10.10.1.10:5323&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>注意，代理 <code>URL</code> 必须包含连接方式。</p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>Requests is an elegant and simple HTTP library for Python, built for human beings.</p>\n</blockquote>\n<p><code>Requests</code> 唯一的一个非转基因的 <code>Python HTTP</code> 库，人类可以安全享用。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p><code>Requests</code>是一个第三方的库，建议在虚拟环境中安装。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install requests</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"快速上手\"><a href=\"#快速上手\" class=\"headerlink\" title=\"快速上手\"></a>快速上手</h2><h3 id=\"发送请求\"><a href=\"#发送请求\" class=\"headerlink\" title=\"发送请求\"></a>发送请求</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装requests模块</span></span><br><span class=\"line\"><span class=\"comment\"># pip install requests</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 导入requests</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 目标url</span></span><br><span class=\"line\">url = <span class=\"string\">&quot;https://www.baidu.com&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 向目标url发送请求</span></span><br><span class=\"line\">response = requests.get(url)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 打印响应内容</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(response.text)</span><br></pre></td></tr></table></figure>\n\n<p><code>Requests</code> 会自动解码来自服务器的内容。大多数 unicode 字符集都能被无缝地解码。</p>\n<p>请求发出后， <code>Requests</code> 会基于 <code>HTTP</code> 头部对响应的编码作出有根据的推测。当你访问 <code>response.text</code> 之时，<code>Requests</code> 会使用其推测的文本编码。你可以找出 <code>Requests</code> 使用了什么编码，并且能够使用 <code>response.encoding</code> 属性来改变它：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 设置响应编码方式</span></span><br><span class=\"line\">response.encoding = <span class=\"string\">&#x27;ISO-8859-1&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"二进制响应内容\"><a href=\"#二进制响应内容\" class=\"headerlink\" title=\"二进制响应内容\"></a>二进制响应内容</h3><p>你也能以字节的方式访问请求响应体，对于非文本请求：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 打印响应内容, 二进制格式</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(response.content)`</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"传递-URL-参数\"><a href=\"#传递-URL-参数\" class=\"headerlink\" title=\"传递 URL 参数\"></a>传递 URL 参数</h3><p>你也许经常想为 <code>URL</code> 的查询字符串(query string)传递某种数据。如果你是手工构建 <code>URL</code>，那么数据会以键/值对的形式置于 <code>URL</code> 中，跟在一个问号的后面。例如，<code> httpbin.org/get?key=val</code>。 <code>Requests</code> 允许你使用 <code>params</code> 关键字参数，以一个字符串字典来提供这些参数。举例来说，如果你想传递<code> key1=value1</code> 和 <code>key2=value2</code> 到 <code>httpbin.org/get</code> ，那么你可以使用如下代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>payload = &#123;<span class=\"string\">&#x27;key1&#x27;</span>: <span class=\"string\">&#x27;value1&#x27;</span>, <span class=\"string\">&#x27;key2&#x27;</span>: <span class=\"string\">&#x27;value2&#x27;</span>&#125;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&quot;http://httpbin.org/get&quot;</span>, params=payload)</span><br></pre></td></tr></table></figure>\n\n<p>通过打印输出该 <code>URL</code>，你能看到 <code>URL</code> 已被正确编码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">print</span>(r.url)</span><br><span class=\"line\">http://httpbin.org/get?key2=value2&amp;key1=value1</span><br></pre></td></tr></table></figure>\n\n<p>注意字典里值为 <code>None</code> 的键都不会被添加到 <code>URL</code> 的查询字符串里。</p>\n<p>你还可以将一个列表作为值传入：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>payload = &#123;<span class=\"string\">&#x27;key1&#x27;</span>: <span class=\"string\">&#x27;value1&#x27;</span>, <span class=\"string\">&#x27;key2&#x27;</span>: [<span class=\"string\">&#x27;value2&#x27;</span>, <span class=\"string\">&#x27;value3&#x27;</span>]&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&#x27;http://httpbin.org/get&#x27;</span>, params=payload)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">print</span>(r.url)</span><br><span class=\"line\">http://httpbin.org/get?key1=value1&amp;key2=value2&amp;key2=value3</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"JSON-响应内容\"><a href=\"#JSON-响应内容\" class=\"headerlink\" title=\"JSON 响应内容\"></a>JSON 响应内容</h3><p><code>Requests</code> 中也有一个内置的 <code>JSON</code> 解码器，助你处理 <code>JSON</code> 数据：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&#x27;https://api.github.com/events&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.json()</span><br><span class=\"line\">[&#123;<span class=\"string\">u&#x27;repository&#x27;</span>: &#123;<span class=\"string\">u&#x27;open_issues&#x27;</span>: <span class=\"number\">0</span>, <span class=\"string\">u&#x27;url&#x27;</span>: <span class=\"string\">&#x27;https://github.com/...</span></span><br><span class=\"line\"><span class=\"string\">&gt;&gt;&gt; r.status_code</span></span><br><span class=\"line\"><span class=\"string\">200</span></span><br></pre></td></tr></table></figure>\n\n<p>如果 <code>JSON</code> 解码失败， <code>r.json()</code> 就会抛出一个异常。例如，响应内容是 <code>401 (Unauthorized)</code>，尝试访问 <code>r.json()</code> 将会抛出 <code>ValueError: No JSON object could be decoded </code>异常。</p>\n<p>需要注意的是，成功调用 <code>r.json()</code> 并<strong>不</strong>意味着响应的成功。有的服务器会在失败的响应中包含一个 <code>JSON</code> 对象（比如<code>HTTP 500</code>的错误细节）。这种 <code>JSON</code> 会被解码返回。要检查请求是否成功，请使用 <code>r.raise_for_status()</code> 或者检查 <code>r.status_code</code> 是否和你的期望相同。</p>\n<h3 id=\"原始响应内容\"><a href=\"#原始响应内容\" class=\"headerlink\" title=\"原始响应内容\"></a>原始响应内容</h3><p>在某些情况下，如果你想获取来自服务器的原始套接字响应，那么你可以访问 <code>r.raw</code>。 如果你确实想这么干，那请你确保在初始请求中设置了 <code>stream=True</code>。具体你可以这么做：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&#x27;https://api.github.com/events&#x27;</span>, stream=<span class=\"literal\">True</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.raw</span><br><span class=\"line\">&lt;urllib3.response.HTTPResponse <span class=\"built_in\">object</span> at <span class=\"number\">0x00000197FAA56AC0</span>&gt;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.raw.read(<span class=\"number\">10</span>)</span><br><span class=\"line\"><span class=\"string\">b&#x27;\\x1f\\x8b\\x08\\x00\\x00\\x00\\x00\\x00\\x00\\x03&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>但一般情况下，你应该以下面的模式将文本流保存到文件：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(filename, <span class=\"string\">&#x27;wb&#x27;</span>) <span class=\"keyword\">as</span> fd:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> chunk <span class=\"keyword\">in</span> r.iter_content(chunk_size):</span><br><span class=\"line\">        fd.write(chunk)</span><br></pre></td></tr></table></figure>\n\n<p>使用 <code>Response.iter_content</code> 将会处理大量你直接使用 <code>Response.raw</code> 不得不处理的。 当流下载时，上面是优先推荐的获取内容方式。 </p>\n<h3 id=\"定制请求头\"><a href=\"#定制请求头\" class=\"headerlink\" title=\"定制请求头\"></a>定制请求头</h3><p>如果你想为请求添加 <code>HTTP</code> 头部，只要简单地传递一个 <code>dict</code> 给 <code>headers</code> 参数就可以了。</p>\n<p>例如，在前一个示例中我们没有指定 <code>content-type</code>:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>url = <span class=\"string\">&#x27;https://api.github.com/some/endpoint&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>headers = &#123;<span class=\"string\">&#x27;user-agent&#x27;</span>: <span class=\"string\">&#x27;my-app/0.0.1&#x27;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(url, headers=headers)</span><br></pre></td></tr></table></figure>\n\n<p>注意: 定制 <code>header</code> 的优先级低于某些特定的信息源，例如：</p>\n<ul>\n<li>如果在 <code>.netrc</code> 中设置了用户认证信息，使用 <code>headers=</code> 设置的授权就不会生效。而如果设置了<code> auth=</code> 参数，<code>.netrc</code> 的设置就无效了。</li>\n<li>如果被重定向到别的主机，授权 <code>header</code> 就会被删除。</li>\n<li>代理授权 <code>header</code> 会被 URL 中提供的代理身份覆盖掉。</li>\n<li>在我们能判断内容长度的情况下，<code>header</code> 的 <code>Content-Length</code> 会被改写。</li>\n</ul>\n<p>更进一步讲，<code>Requests</code> 不会基于定制 <code>header</code> 的具体情况改变自己的行为。只不过在最后的请求中，所有的 <code>header</code> 信息都会被传递进去。</p>\n<p>注意: 所有的 head<code>er 值必须是 </code>string、bytestring<code>或者</code>unicode<code>。尽管传递 </code>unicode header` 也是允许的，但不建议这样做。</p>\n<h3 id=\"更加复杂的-POST-请求\"><a href=\"#更加复杂的-POST-请求\" class=\"headerlink\" title=\"更加复杂的 POST 请求\"></a>更加复杂的 POST 请求</h3><p>通常，你想要发送一些编码为表单形式的数据——非常像一个 <code>HTML</code> 表单。要实现这个，只需简单地传递一个字典给 <code>data</code> 参数。你的数据字典在发出请求时会自动编码为表单形式：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>payload = &#123;<span class=\"string\">&#x27;key1&#x27;</span>: <span class=\"string\">&#x27;value1&#x27;</span>, <span class=\"string\">&#x27;key2&#x27;</span>: <span class=\"string\">&#x27;value2&#x27;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.post(<span class=\"string\">&quot;http://httpbin.org/post&quot;</span>, data=payload)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">print</span>(r.text)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"string\">&quot;form&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;key2&quot;</span>: <span class=\"string\">&quot;value2&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;key1&quot;</span>: <span class=\"string\">&quot;value1&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>你还可以为 <code>data</code> 参数传入一个元组列表。在表单中多个元素使用同一 <code>key</code> 的时候，这种方式尤其有效：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>payload = ((<span class=\"string\">&#x27;key1&#x27;</span>, <span class=\"string\">&#x27;value1&#x27;</span>), (<span class=\"string\">&#x27;key1&#x27;</span>, <span class=\"string\">&#x27;value2&#x27;</span>))</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.post(<span class=\"string\">&#x27;http://httpbin.org/post&#x27;</span>, data=payload)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"built_in\">print</span>(r.text)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"string\">&quot;form&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;key1&quot;</span>: [</span><br><span class=\"line\">      <span class=\"string\">&quot;value1&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;value2&quot;</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  ...</span><br></pre></td></tr></table></figure>\n\n<p>很多时候你想要发送的数据并非编码为表单形式的。如果你传递一个 <code>string</code> 而不是一个 <code>dict</code> ，那么数据会被直接发布出去。</p>\n<p>例如，<code>Github API v3</code> 接受编码为 <code>JSON</code> 的 <code>POST/PATCH</code> 数据：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">import</span> json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>url = <span class=\"string\">&#x27;https://api.github.com/some/endpoint&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>payload = &#123;<span class=\"string\">&#x27;some&#x27;</span>: <span class=\"string\">&#x27;data&#x27;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.post(url, data=json.dumps(payload))</span><br></pre></td></tr></table></figure>\n\n<p>此处除了可以自行对 <code>dict</code> 进行编码，你还可以使用 <code>json</code> 参数直接传递，然后它就会被自动编码。这是 <code>2.4.2 </code>版的新加功能：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>url = <span class=\"string\">&#x27;https://api.github.com/some/endpoint&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>payload = &#123;<span class=\"string\">&#x27;some&#x27;</span>: <span class=\"string\">&#x27;data&#x27;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.post(url, json=payload)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"响应状态码\"><a href=\"#响应状态码\" class=\"headerlink\" title=\"响应状态码\"></a>响应状态码</h3><p>可以检测响应状态码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&#x27;http://httpbin.org/get&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.status_code</span><br><span class=\"line\"><span class=\"number\">200</span></span><br></pre></td></tr></table></figure>\n\n<p>为方便引用，<code>Requests</code>还附带了一个内置的状态码查询对象：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; r.status_code == requests.codes.ok</span><br><span class=\"line\">True</span><br></pre></td></tr></table></figure>\n\n<p>如果发送了一个错误请求(一个 4XX 客户端错误，或者 5XX 服务器错误响应)，我们可以通过 <code>Response.raise_for_status()</code> 来抛出异常：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; bad_r = requests.get(&#x27;http://httpbin.org/status/404&#x27;)</span><br><span class=\"line\">&gt;&gt;&gt; bad_r.status_code</span><br><span class=\"line\">404</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt; bad_r.raise_for_status()</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File &quot;requests/models.py&quot;, line 832, in raise_for_status</span><br><span class=\"line\">    raise http_error</span><br><span class=\"line\">requests.exceptions.HTTPError: 404 Client Error</span><br></pre></td></tr></table></figure>\n\n<p>如果响应对象 <code>r</code> 的 <code>status_code</code> 是 <code>200</code> ，当我们调用 <code>raise_for_status()</code> 时，得到的是：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.raise_for_status()</span><br><span class=\"line\"><span class=\"literal\">None</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"响应头\"><a href=\"#响应头\" class=\"headerlink\" title=\"响应头\"></a>响应头</h3><p>我们可以查看以一个 <code>Python</code> 字典形式展示的服务器响应头：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.headers</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;content-encoding&#x27;</span>: <span class=\"string\">&#x27;gzip&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;transfer-encoding&#x27;</span>: <span class=\"string\">&#x27;chunked&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;connection&#x27;</span>: <span class=\"string\">&#x27;close&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.0.4&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;x-runtime&#x27;</span>: <span class=\"string\">&#x27;148ms&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;etag&#x27;</span>: <span class=\"string\">&#x27;&quot;e1ca502697e5c9317743dc078f67693f&quot;&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;content-type&#x27;</span>: <span class=\"string\">&#x27;application/json&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>但是这个字典比较特殊：它是仅为 <code>HTTP</code> 头部而生的。根据 <code>RFC 2616</code>， <code>HTTP</code> 头部是大小写不敏感的。</p>\n<p>因此，我们可以使用任意大写形式来访问这些响应头字段：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.headers[<span class=\"string\">&#x27;Content-Type&#x27;</span>]</span><br><span class=\"line\"><span class=\"string\">&#x27;application/json&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.headers.get(<span class=\"string\">&#x27;content-type&#x27;</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;application/json&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>它还有一个特殊点，那就是服务器可以多次接受同一 <code>header</code>，每次都使用不同的值。</p>\n<h3 id=\"Cookie\"><a href=\"#Cookie\" class=\"headerlink\" title=\"Cookie\"></a>Cookie</h3><p>如果某个响应中包含一些 <code>cookie</code>，你可以快速访问它们：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>url = <span class=\"string\">&#x27;http://www.baidu.com&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(url)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.cookies</span><br><span class=\"line\">&lt;RequestsCookieJar[Cookie(version=<span class=\"number\">0</span>, name=<span class=\"string\">&#x27;BDORZ&#x27;</span>, value=<span class=\"string\">&#x27;27315&#x27;</span>, port=<span class=\"literal\">None</span>, port_specified=<span class=\"literal\">False</span>, domain=<span class=\"string\">&#x27;.baidu.com&#x27;</span>, domain_specified=<span class=\"literal\">True</span>, domain_initial_dot=<span class=\"literal\">True</span>, path=<span class=\"string\">&#x27;/&#x27;</span>, path_specified=<span class=\"literal\">True</span>, secure=<span class=\"literal\">False</span>, expires=<span class=\"number\">1624028209</span>, discard=<span class=\"literal\">False</span>, comment=<span class=\"literal\">None</span>, comment_url=<span class=\"literal\">None</span>, rest=&#123;&#125;, rfc2109=<span class=\"literal\">False</span>)]&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.cookies.get_dict()</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;BDORZ&#x27;</span>: <span class=\"string\">&#x27;27315&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>要想发送你的<code>cookies</code>到服务器，可以使用 <code>cookies</code> 参数：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; url = &#x27;http://httpbin.org/cookies&#x27;</span><br><span class=\"line\">&gt;&gt;&gt; cookies = dict(cookies_are=&#x27;working&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt; r = requests.get(url, cookies=cookies)</span><br><span class=\"line\">&gt;&gt;&gt; r.text</span><br><span class=\"line\">&#x27;&#123;&quot;cookies&quot;: &#123;&quot;cookies_are&quot;: &quot;working&quot;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>\n\n<p><code>Cookie</code> 的返回对象为 <code>RequestsCookieJar</code> ，它的行为和字典类似，但接口更为完整，适合跨域名跨路径使用。你还可以把 <code>Cookie Jar</code> 传到 <code>Requests</code> 中：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>jar = requests.cookies.RequestsCookieJar()</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>jar.<span class=\"built_in\">set</span>(<span class=\"string\">&#x27;tasty_cookie&#x27;</span>, <span class=\"string\">&#x27;yum&#x27;</span>, domain=<span class=\"string\">&#x27;httpbin.org&#x27;</span>, path=<span class=\"string\">&#x27;/cookies&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>jar.<span class=\"built_in\">set</span>(<span class=\"string\">&#x27;gross_cookie&#x27;</span>, <span class=\"string\">&#x27;blech&#x27;</span>, domain=<span class=\"string\">&#x27;httpbin.org&#x27;</span>, path=<span class=\"string\">&#x27;/elsewhere&#x27;</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>url = <span class=\"string\">&#x27;http://httpbin.org/cookies&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(url, cookies=jar)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.text</span><br><span class=\"line\"><span class=\"string\">&#x27;&#123;&quot;cookies&quot;: &#123;&quot;tasty_cookie&quot;: &quot;yum&quot;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"重定向与请求历史\"><a href=\"#重定向与请求历史\" class=\"headerlink\" title=\"重定向与请求历史\"></a>重定向与请求历史</h3><p>默认情况下，除了 <code>HEAD, Requests</code> 会自动处理所有重定向。</p>\n<p>可以使用响应对象的 <code>history</code> 方法来追踪重定向。</p>\n<p><code>Response.history</code> 是一个 <code>Response</code> 对象的列表，为了完成请求而创建了这些对象。这个对象列表按照从最老到最近的请求进行排序。</p>\n<p>例如，Github 将所有的 <code>HTTP</code> 请求重定向到 <code>HTTPS</code>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&#x27;http://github.com&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.url</span><br><span class=\"line\"><span class=\"string\">&#x27;https://github.com/&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.status_code</span><br><span class=\"line\"><span class=\"number\">200</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.history</span><br><span class=\"line\">[&lt;Response [<span class=\"number\">301</span>]&gt;]</span><br></pre></td></tr></table></figure>\n\n<p>如果你使用的是<code>GET、OPTIONS、POST、PUT、PATCH</code> 或者 <code>DELETE</code>，那么你可以通过 <code>allow_redirects</code> 参数禁用重定向处理：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&#x27;http://github.com&#x27;</span>, allow_redirects=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.status_code</span><br><span class=\"line\"><span class=\"number\">301</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.history</span><br><span class=\"line\">[]</span><br></pre></td></tr></table></figure>\n\n<p>如果你使用了 <code>HEAD</code>，你也可以启用重定向：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.head(<span class=\"string\">&#x27;http://github.com&#x27;</span>, allow_redirects=<span class=\"literal\">True</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.url</span><br><span class=\"line\"><span class=\"string\">&#x27;https://github.com/&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.history</span><br><span class=\"line\">[&lt;Response [<span class=\"number\">301</span>]&gt;]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"超时处理\"><a href=\"#超时处理\" class=\"headerlink\" title=\"超时处理\"></a>超时处理</h3><p>你可以告诉 <code>requests</code> 在经过以 <code>timeout</code> 参数设定的秒数时间之后停止等待响应。基本上所有的生产代码都应该使用这一参数。如果不使用，你的程序可能会永远失去响应：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>requests.get(<span class=\"string\">&#x27;http://github.com&#x27;</span>, timeout=<span class=\"number\">0.001</span>)</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File <span class=\"string\">&quot;&lt;stdin&gt;&quot;</span>, line <span class=\"number\">1</span>, <span class=\"keyword\">in</span> &lt;module&gt;</span><br><span class=\"line\">requests.exceptions.Timeout: HTTPConnectionPool(host=<span class=\"string\">&#x27;github.com&#x27;</span>, port=<span class=\"number\">80</span>): Request timed out. (timeout=<span class=\"number\">0.001</span>)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意<br> <code>timeout</code> 仅对连接过程有效，与响应体的下载无关。 <code>timeout</code> 并不是整个下载响应的时间限制，而是如果服务器在 <code>timeout</code> 秒内没有应答，将会引发一个异常（更精确地说，是在 <code>timeout</code> 秒内没有从基础套接字上接收到任何字节的数据时）。</p>\n</blockquote>\n<h3 id=\"错误与异常\"><a href=\"#错误与异常\" class=\"headerlink\" title=\"错误与异常\"></a>错误与异常</h3><p>遇到网络问题（如：DNS 查询失败、拒绝连接等）时， <code>Requests</code> 会抛出一个 <code>ConnectionError</code> 异常。</p>\n<p>如果 <code>HTTP</code> 请求返回了不成功的状态码， <code>Response.raise_for_status()</code> 会抛出一个 <code>HTTPError</code> 异常。</p>\n<p>若请求超时，则抛出一个 <code>Timeout</code> 异常。</p>\n<p>若请求超过了设定的最大重定向次数，则会抛出一个 <code>TooManyRedirects</code> 异常。</p>\n<p>所有<code>Requests</code>显式抛出的异常都继承自<code>requests.exceptions.RequestException</code> 。</p>\n<h2 id=\"高级用法\"><a href=\"#高级用法\" class=\"headerlink\" title=\"高级用法\"></a>高级用法</h2><p>接下来介绍一些 <code>requests</code> 的高级用法。</p>\n<h3 id=\"会话对象\"><a href=\"#会话对象\" class=\"headerlink\" title=\"会话对象\"></a>会话对象</h3><p>会话对象让你能够跨请求保持某些参数。它也会在同一个 <code>Session</code> 实例发出的所有请求之间保持 <code>cookie</code> ， 期间使用 <code>urllib3</code> 的 <code>connection pooling</code> 功能。所以如果你向同一主机发送多个请求，底层的 <code>TCP</code> 连接将会被重用，从而带来显著的性能提升。</p>\n<p>会话对象具有主要的 <code>Requests API</code> 的所有方法。</p>\n<p>我们来跨请求保持一些 <code>cookie</code>:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建一个会话对象</span></span><br><span class=\"line\">s = requests.Session()</span><br><span class=\"line\"></span><br><span class=\"line\">s.get(<span class=\"string\">&#x27;http://httpbin.org/cookies/set/sessioncookie/123456789&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">r = s.get(<span class=\"string\">&quot;https://httpbin.org/cookies&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#   &quot;cookies&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     &quot;sessioncookie&quot;: &quot;123456789&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#   &#125;</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>会话也可用来为请求方法提供缺省数据。这是通过为会话对象的属性提供数据来实现的：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = requests.Session()</span><br><span class=\"line\">s.auth = (<span class=\"string\">&#x27;user&#x27;</span>, <span class=\"string\">&#x27;pass&#x27;</span>)</span><br><span class=\"line\">s.headers.update(&#123;<span class=\"string\">&#x27;x-test&#x27;</span>: <span class=\"string\">&#x27;true&#x27;</span>&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># both &#x27;x-test&#x27; and &#x27;x-test2&#x27; are sent</span></span><br><span class=\"line\">s.get(<span class=\"string\">&#x27;http://httpbin.org/headers&#x27;</span>, headers=&#123;<span class=\"string\">&#x27;x-test2&#x27;</span>: <span class=\"string\">&#x27;true&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n\n<p>任何你传递给请求方法的字典都会与已设置会话层数据合并。方法层的参数覆盖会话的参数。</p>\n<p>不过需要注意，就算使用了会话，方法级别的参数也不会被跨请求保持。下面的例子只会和第一个请求发送 <code>cookie</code> ，而非第二个：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = requests.Session()</span><br><span class=\"line\"></span><br><span class=\"line\">r = s.get(<span class=\"string\">&#x27;http://httpbin.org/cookies&#x27;</span>, cookies=&#123;<span class=\"string\">&#x27;from-my&#x27;</span>: <span class=\"string\">&#x27;browser&#x27;</span>&#125;)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br><span class=\"line\"><span class=\"comment\"># &#x27;&#123;&quot;cookies&quot;: &#123;&quot;from-my&quot;: &quot;browser&quot;&#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">r = s.get(<span class=\"string\">&#x27;http://httpbin.org/cookies&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br><span class=\"line\"><span class=\"comment\"># &#x27;&#123;&quot;cookies&quot;: &#123;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果你要手动为会话添加 <code>cookie</code> ，就使用 <code>Cookie utility</code> 函数 来操纵 <code>Session.cookies</code>。</p>\n<p>会话还可以用作前后文管理器：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">with</span> requests.Session() <span class=\"keyword\">as</span> s:</span><br><span class=\"line\">    s.get(<span class=\"string\">&#x27;http://httpbin.org/cookies/set/sessioncookie/123456789&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这样就能确保 <code>with</code> 区块退出后会话能被关闭，即使发生了异常也一样。</p>\n<p>从字典参数中移除一个值<br>有时你会想省略字典参数中一些会话层的键。要做到这一点，你只需简单地在方法层参数中将那个键的值设置为 <code>None</code> ，那个键就会被自动省略掉。</p>\n<h3 id=\"请求与响应对象\"><a href=\"#请求与响应对象\" class=\"headerlink\" title=\"请求与响应对象\"></a>请求与响应对象</h3><p>任何时候进行了类似 <code>requests.get()</code> 的调用，你都在做两件主要的事情。其一，你在构建一个 <code>Request</code> 对象， 该对象将被发送到某个服务器请求或查询一些资源。其二，一旦 <code>requests</code> 得到一个从服务器返回的响应就会产生一个 <code>Response</code> 对象。该响应对象包含服务器返回的所有信息，也包含你原来创建的 <code>Request</code> 对象。如下是一个简单的请求，从 <code>Baidu</code> 的服务器得到一些非常重要的信息：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.get(<span class=\"string\">&quot;https://www.baidu.com&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>如果想访问服务器返回给我们的响应头部信息，可以这样做：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.headers</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;Cache-Control&#x27;</span>: <span class=\"string\">&#x27;private, no-cache, no-store, proxy-revalidate, no-transform&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;Content-Encoding&#x27;</span>: <span class=\"string\">&#x27;gzip&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Thu, 17 Jun 2021 15:52:48 GMT&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Mon, 23 Jan 2017 13:23:55 GMT&#x27;</span>, <span class=\"string\">&#x27;Pragma&#x27;</span>: <span class=\"string\">&#x27;no-cache&#x27;</span>, <span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;bfe/1.0.8.18&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;Set-Cookie&#x27;</span>: <span class=\"string\">&#x27;BDORZ=27315; max-age=86400; domain=.baidu.com; path=/&#x27;</span>, <span class=\"string\">&#x27;Transfer-Encoding&#x27;</span>: <span class=\"string\">&#x27;chunked&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然而，如果想得到发送到服务器的请求的头部，我们可以简单地访问该请求，然后是该请求的头部：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.request.headers</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;User-Agent&#x27;</span>: <span class=\"string\">&#x27;python-requests/2.25.1&#x27;</span>, <span class=\"string\">&#x27;Accept-Encoding&#x27;</span>: <span class=\"string\">&#x27;gzip, deflate&#x27;</span>, <span class=\"string\">&#x27;Accept&#x27;</span>: <span class=\"string\">&#x27;*/*&#x27;</span>,</span><br><span class=\"line\">     <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"准备的请求-（Prepared-Request）\"><a href=\"#准备的请求-（Prepared-Request）\" class=\"headerlink\" title=\"准备的请求 （Prepared Request）\"></a>准备的请求 （Prepared Request）</h3><p>当你从 <code>API</code> 或者会话调用中收到一个 <code>Response</code> 对象时，<code>request</code> 属性其实是使用了 <code>PreparedRequest</code> 。有时在发送请求之前，你需要对 <code>body</code> 或者 <code>header</code> （或者别的什么东西）做一些额外处理，下面演示了一个简单的做法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> requests <span class=\"keyword\">import</span> Request, Session</span><br><span class=\"line\"></span><br><span class=\"line\">s = Session()</span><br><span class=\"line\">req = Request(<span class=\"string\">&#x27;GET&#x27;</span>, url,</span><br><span class=\"line\">    data=data,</span><br><span class=\"line\">    headers=header</span><br><span class=\"line\">)</span><br><span class=\"line\">prepped = req.prepare()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># do something with prepped.body</span></span><br><span class=\"line\"><span class=\"comment\"># do something with prepped.headers</span></span><br><span class=\"line\"></span><br><span class=\"line\">resp = s.send(prepped,</span><br><span class=\"line\">    stream=stream,</span><br><span class=\"line\">    verify=verify,</span><br><span class=\"line\">    proxies=proxies,</span><br><span class=\"line\">    cert=cert,</span><br><span class=\"line\">    timeout=timeout</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(resp.status_code)</span><br></pre></td></tr></table></figure>\n\n<p>由于你没有对 <code>Request</code> 对象做什么特殊事情，你立即准备和修改了 <code>PreparedRequest</code> 对象，然后把它和别的参数一起发送到 <code>requests.*</code> 或者 <code>Session.*</code>。</p>\n<p>然而，上述代码会失去 <code>Requests Session</code> 对象的一些优势， 尤其 <code>Session</code> 级别的状态，例如 <code>cookie</code> 就不会被应用到你的请求上去。要获取一个带有状态的 <code>PreparedRequest</code>， 请用 <code>Session.prepare_request()</code> 取代 <code>Request.prepare()</code> 的调用，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> requests <span class=\"keyword\">import</span> Request, Session</span><br><span class=\"line\"></span><br><span class=\"line\">s = Session()</span><br><span class=\"line\">req = Request(<span class=\"string\">&#x27;GET&#x27;</span>,  url,</span><br><span class=\"line\">    data=data</span><br><span class=\"line\">    headers=headers</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">prepped = s.prepare_request(req)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># do something with prepped.body</span></span><br><span class=\"line\"><span class=\"comment\"># do something with prepped.headers</span></span><br><span class=\"line\"></span><br><span class=\"line\">resp = s.send(prepped,</span><br><span class=\"line\">    stream=stream,</span><br><span class=\"line\">    verify=verify,</span><br><span class=\"line\">    proxies=proxies,</span><br><span class=\"line\">    cert=cert,</span><br><span class=\"line\">    timeout=timeout</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(resp.status_code)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"SSL-证书验证\"><a href=\"#SSL-证书验证\" class=\"headerlink\" title=\"SSL 证书验证\"></a>SSL 证书验证</h3><p><code>Requests</code> 可以为 <code>HTTPS</code> 请求验证 <code>SSL</code> 证书，就像 <code>web</code> 浏览器一样。 <code>SSL</code> 验证默认是开启的，如果证书验证失败，<code>Requests</code> 会抛出 <code>SSLError</code>:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>requests.get(<span class=\"string\">&#x27;https://requestb.in&#x27;</span>)</span><br><span class=\"line\">requests.exceptions.SSLError: hostname <span class=\"string\">&#x27;requestb.in&#x27;</span> doesn<span class=\"string\">&#x27;t match either of &#x27;</span>*.herokuapp.com<span class=\"string\">&#x27;, &#x27;</span>herokuapp.com<span class=\"string\">&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>在该域名上我没有设置 SSL(现在已经设置了，返回的<code>&lt;Response [200]&gt;</code>)，所以失败了。但 Github 设置了 SSL:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>requests.get(<span class=\"string\">&#x27;https://github.com&#x27;</span>, verify=<span class=\"literal\">True</span>)</span><br><span class=\"line\">&lt;Response [<span class=\"number\">200</span>]&gt;</span><br></pre></td></tr></table></figure>\n\n<p>你可以为 <code>verify</code> 传入 <code>CA_BUNDLE</code> 文件的路径，或者包含可信任 <code>CA</code> 证书文件的文件夹路径：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>requests.get(<span class=\"string\">&#x27;https://github.com&#x27;</span>, verify=<span class=\"string\">&#x27;/path/to/certfile&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>或者将其保持在会话中：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = requests.Session()</span><br><span class=\"line\">s.verify = &#x27;/path/to/certfile&#x27;</span><br></pre></td></tr></table></figure>\n\n<p><strong>注解</strong></p>\n<p>如果 <code>verify</code> 设为文件夹路径，文件夹必须通过 <code>OpenSSL</code> 提供的 <code>c_rehash</code> 工具处理。</p>\n<p>你还可以通过 <code>REQUESTS_CA_BUNDLE</code> 环境变量定义可信任 <code>CA</code> 列表。</p>\n<p>如果你将 <code>verify</code> 设置为 <code>False</code>，<code>Requests</code> 也能忽略对 <code>SSL</code> 证书的验证。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>requests.get(<span class=\"string\">&#x27;https://kennethreitz.org&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">&lt;Response [<span class=\"number\">200</span>]&gt;</span><br></pre></td></tr></table></figure>\n\n<p>默认情况下， <code>verify</code> 是设置为 <code>True</code> 的。选项 <code>verify</code> 仅应用于主机证书。</p>\n<blockquote>\n<p>对于私有证书，你也可以传递一个 <code>CA_BUNDLE</code> 文件的路径给 <code>verify</code>。你也可以设置 <code># REQUEST_CA_BUNDLE </code>环境变量。</p>\n</blockquote>\n<h3 id=\"流式上传\"><a href=\"#流式上传\" class=\"headerlink\" title=\"流式上传\"></a>流式上传</h3><p><code>Requests</code>支持流式上传，这允许你发送大的数据流或文件而无需先把它们读入内存。要使用流式上传，仅需为你的请求体提供一个类文件对象即可：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;massive-body&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    requests.post(<span class=\"string\">&#x27;http://some.url/streamed&#x27;</span>, data=f)</span><br></pre></td></tr></table></figure>\n\n<p>强烈建议你用<code>二进制模式（binary mode）</code>打开文件。这是因为 <code>requests</code> 可能会为你提供 <code>header</code> 中的 <code>Content-Length</code>，在这种情况下该值会被设为文件的字节数。如果你用文本模式打开文件，就可能碰到错误。</p>\n<h3 id=\"POST-多个分块编码的文件\"><a href=\"#POST-多个分块编码的文件\" class=\"headerlink\" title=\"POST 多个分块编码的文件\"></a>POST 多个分块编码的文件</h3><p>你可以在一个请求中发送多个文件。例如，假设你要上传多个图像文件到一个 <code>HTML</code> 表单，使用一个多文件 <code>field</code> 叫做 <code>&quot;images&quot;</code>:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;images&quot;</span> <span class=\"attr\">multiple</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">required</span>=<span class=\"string\">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>要实现，只要把文件设到一个元组的列表中，其中元组结构为 <code>(form_field_name, file_info)</code>:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>url = <span class=\"string\">&#x27;http://httpbin.org/post&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>multiple_files = [</span><br><span class=\"line\">        (<span class=\"string\">&#x27;images&#x27;</span>, (<span class=\"string\">&#x27;foo.png&#x27;</span>, <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;foo.png&#x27;</span>, <span class=\"string\">&#x27;rb&#x27;</span>), <span class=\"string\">&#x27;image/png&#x27;</span>)),</span><br><span class=\"line\">        (<span class=\"string\">&#x27;images&#x27;</span>, (<span class=\"string\">&#x27;bar.png&#x27;</span>, <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;bar.png&#x27;</span>, <span class=\"string\">&#x27;rb&#x27;</span>), <span class=\"string\">&#x27;image/png&#x27;</span>))]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r = requests.post(url, files=multiple_files)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>r.text</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"string\">&#x27;files&#x27;</span>: &#123;<span class=\"string\">&#x27;images&#x27;</span>: <span class=\"string\">&#x27;data:image/png;base64,iVBORw ....&#x27;</span>&#125;</span><br><span class=\"line\">  <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;multipart/form-data; boundary=3131623adb2043caaeb5538cc7aa0b3a&#x27;</span>,</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>同样的，建议使用二进制打开文件。</p>\n<h3 id=\"代理\"><a href=\"#代理\" class=\"headerlink\" title=\"代理\"></a>代理</h3><p>如果需要使用代理，你可以通过为任意请求方法提供 <code>proxies</code> 参数来配置单个请求:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">proxies = &#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;http&quot;</span>: <span class=\"string\">&quot;http://10.10.1.10:3128&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;https&quot;</span>: <span class=\"string\">&quot;http://10.10.1.10:1080&quot;</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">requests.get(<span class=\"string\">&quot;http://example.org&quot;</span>, proxies=proxies)</span><br></pre></td></tr></table></figure>\n\n<p>你也可以通过环境变量 <code>HTTP_PROXY</code> 和 <code>HTTPS_PROXY</code> 来配置代理。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ export HTTP_PROXY=<span class=\"string\">&quot;http://10.10.1.10:3128&quot;</span></span><br><span class=\"line\">$ export HTTPS_PROXY=<span class=\"string\">&quot;http://10.10.1.10:1080&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ python</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>requests.get(<span class=\"string\">&quot;http://example.org&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>若你的代理需要使用<code>HTTP Basic Auth</code>，可以使用 <code>http://user:password@host/</code> 语法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">proxies = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;http&quot;</span>: <span class=\"string\">&quot;http://user:pass@10.10.1.10:3128/&quot;</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>要为某个特定的连接方式或者主机设置代理，使用 <code>scheme://hostname</code> 作为 <code>key</code>， 它会针对指定的主机和连接方式进行匹配。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">proxies = &#123;<span class=\"string\">&#x27;http://10.20.1.128&#x27;</span>: <span class=\"string\">&#x27;http://10.10.1.10:5323&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>注意，代理 <code>URL</code> 必须包含连接方式。</p>\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n"},{"title":"Selenium的基本使用","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-25T13:15:51.000Z","pic":null,"_content":"\n在很多情况下，`Ajax`请求的接口通常会包含加密的参数，如`token`、`sign`等，如：[https://dynamic2.scrape.cuiqingcai.com/](https://dynamic2.scrape.cuiqingcai.com/)，它的`Ajax`接口是包含一个`token`参数的，如图所示。\n\n![](Screenshot_5.webp)\n\n由于接口的请求加上了`token`参数，如果不深入分析并找到`token`的构造逻辑，是难以直接模拟这些`Ajax`请求的。\n\n`Selenium`是一个自动化测试工具，利用它可以驱动浏览器执行特定的动作，如点击、下拉等操作，同时还可以获取浏览器当前呈现的页面源代码，做到可见即可爬。对于一些使用`JavaScript`动态渲染的页面来说，此种抓取方式非常有效。\n\n## 准备工作\n\n确保已经正确安装好了`Chrome`浏览器并配置好了`ChromeDriver`。另外，还需要正确安装好`Python`的`Selenium`库。\n\n### Selenium安装\n\n```python\npip3 install selenium\n```\n\n### chrome driver安装\n\n查看安装的浏览器版本，在`chrome`搜索栏输入`chrome://version/`，会显示带当前浏览器的版本信息。\n\n![](Screenshot_1.webp)\n\n在[https://npm.taobao.org/mirrors/chromedriver/](https://npm.taobao.org/mirrors/chromedriver/)下载对应版本的`chrome driver`，一定要对应，否则不能使用。\n\n![](Screenshot_2.webp)\n\n下载到本地后，将`chromedriver.exe`分别拷贝到`chrome.exe`和`python`安装路径下。\n\n![](Screenshot_3.webp)\n\n![](Screenshot_4.webp)\n\n以上，安装就完成了！\n\n## 基本使用\n\n首先来看一下`Selenium`有一些怎样的功能。示例如下：\n\n```python\nfrom selenium import webdriver\nfrom selenium.webdriver.common.by import By\nfrom selenium.webdriver.common.keys import Keys\nfrom selenium.webdriver.support import expected_conditions as EC\nfrom selenium.webdriver.support.wait import WebDriverWait\n\nbrowser = webdriver.Chrome()\ntry:\n    browser.get('https://www.baidu.com')\n    input = browser.find_element_by_id('kw')\n    input.send_keys('Python')\n    input.send_keys(Keys.ENTER)\n    wait = WebDriverWait(browser, 10)\n    wait.until(EC.presence_of_element_located((By.ID, 'content_left')))\n    print(browser.current_url)\n    print(browser.get_cookies())\n    print(browser.page_source)\nfinally:\n    browser.close()\n```\n\n运行代码后会自动弹出一个`Chrome`浏览器，浏览器会跳转到百度，然后在搜索框中输入`Python`，接着跳转到搜索结果页，如图所示。\n\n![](Screenshot_6.webp)\n\n此时在控制台的输出结果如下：\n\n```shell\nhref=\"http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_\" target=\"_blank\">你都用 <em>Python</em> 来做什么? - 知乎</a></h3><div class=\"c-row c-gap-top-small\"><div class=\"general_image_pic c-span3\" style=\"position:relative;top:2px;\"><a class=\"c-img c-img3 c-img-radius-large\" style=\"height:85px\" href=\"http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_\" target=\"_blank\"><img class=\"c-img c-img3 c-img-radius-large\" src=\"https://dss1.bdstatic.com/6OF1bjeh1BF3odCf/it/u=958012630,1445793633&amp;fm=218&amp;app=92&amp;f=JPEG?w=121&amp;h=75&amp;s=44A638725CB7469C82F4FFF40200D025\" style=\"height:85px;\"><span class=\"c-img-border c-img-radius-large\"></span></a></div><div class=\"c-span9 c-span-last\"><div class=\"c-abstract\"><span class=\" newTimeFactor_before_abs c-color-gray2 m\">2019年10月17日&nbsp;</span>所有项目的代码和数据在Github:interesting-<em>python</em> 如果你也想用<em>Python</em>获取数据,进行有趣的 \n数据分析,Alfred数据室应众多读者要求出品的《实战玩转<em>python</em>爬虫》课程将会是你的好帮手...</div><style>.user-avatar {\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        justify-content: flex-start;\n}</style><div class=\"f13 c-gap-top-xsmall se_st_footer user-avatar\"><a target=\"_blank\" href=\"http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_\" class=\"c-showurl c-color-gray\" style=\"text-decoration:none;position:relative;\"><div class=\"c-img c-img-circle c-gap-right-xsmall\" style=\"display: inline-block;width: 16px;height: 16px;position: relative;top: 3px;vertical-align:top;\"><span class=\"c-img-border c-img-source-border c-img-radius-large\"></span><img src=\"https://ss0.baidu.com/6ONWsjip0QIZ8tyhnq/it/u=493147230,3096476255&amp;fm=195&amp;app=88&amp;f=JPEG?w=200&amp;h=200\"></div>知乎</a><div class=\"c-tools c-gap-left\" id=\"tools_9637258987948217910_8\" data-tools=\"{&quot;title&quot;:&quot;你都用 Python 来做什么? - 知乎&quot;,&quot;url&quot;:&quot;http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_&quot;}\"><i class=\"c-icon f13\"></i></div><span class=\"c-icons-outer\"><span class=\"c-icons-inner\"></span></span><style>.snapshoot, .snapshoot:visited {\n        color: #9195A3!important;\n    }\n    .snapshoot:active, .snapshoot:hover {\n        color: #626675!important;\n    }</style><a data-click=\"{'rsv_snapshot':'1'}\" href=\"http://cache.baiducontent.com/c?m=JgFgeas2iHrh6pppvD-MHkvHPj9DsOz-wd718JIlv_IJy7d0KdQ2HvVIYznaRWwGrKHLEtVbqjR4uoZg6X_h4g62yFf5FgBVDUBkRfcWrOG&amp;p=8b2a9715d9c647f904aec5344f57&amp;newp=8b2a9729c5df1bb508e291784f4a92695d0fc20e3ad0d001298ffe0cc4241a1a1a3aecbf2c261600d7c279650aab4a5feff336743d0034f1f689df08d2ecce7e439b3b6e6a&amp;s=45c48cce2e2d7fbd&amp;user=baidu&amp;fm=sc&amp;query=Python&amp;qid=dc4c1a0300139b42&amp;p1=8\" target=\"_blank\" class=\"m c-gap-left c-color-gray kuaizhao snapshoot\">百度快照</a></div></div></div></div>\n```\n\n源代码过长，在此省略。可以看到，当前得到的`URL`、`Cookies`和源代码都是浏览器中的真实内容。所以说，如果用`Selenium`来驱动浏览器加载网页的话，就可以直接拿到`JavaScript`渲染的结果了，不用担心使用的是什么加密系统。\n\n了解一下`Selenium`的用法。\n\n## 声明浏览器对象\n\n`Selenium`支持非常多的浏览器，如`Chrome`、`Firefox`、`Edge`等，还有`Android`、`BlackBerry`等手机端的浏览器。\n\n可以用如下方式进行初始化：\n\n```python\nfrom selenium import webdriver\nbrowser = webdriver.Chrome()\nbrowser = webdriver.Firefox()\nbrowser = webdriver.Edge()\nbrowser = webdriver.Safari()\n```\n\n这样就完成了浏览器对象的初始化并将其赋值为`browser`对象。接下来，要做的就是调用`browser`对象，让其执行各个动作以模拟浏览器操作。\n\n## 访问页面\n\n可以用`get`方法请求页面，只需要把参数传入连接`URL`即可。比如，这里用`get`方法访问淘宝，代码如下：\n\n```python\nfrom selenium import webdriver\nbrowser = webdriver.Chrome()\nbrowser.get('https://www.taobao.com')\nprint(browser.page_source)\nbrowser.close()\n```\n\n运行后会弹出`Chrome`浏览器并且自动访问淘宝，然后控制台会输出淘宝页面的源代码，随后浏览器关闭。\n\n## 查找节点\n\n`Selenium`可以驱动浏览器完成各种操作，比如填充表单、模拟点击等。举个例子，当想要完成向某个输入框输入文字的操作时，首先需要知道这个输入框在哪，而 `Selenium`提供了一系列查找节点的方法，可以用这些方法来获取想要的节点，以便执行下一步动作或者提取信息。\n\n### 单个节点\n\n想要从淘宝页面中提取搜索框这个节点，首先要观察它的源代码。\n\n可以发现，它的`id`是`q`，`name`也是`q`，此外还有许多其他属性。此时就可以用多种方式获取它了。比如，`find_element_by_name`代表根据`name`值获取，`find_element_by_id`则是根据`id`获取，另外，还有根据`XPath`、`CSS`选择器等获取的方式。\n\n这里使用`3`种方式获取输入框，分别是根据`id`、`CSS`选择器和`XPath`获取，它们返回的结果完全一致。运行结果如下：\n\n```python\n<selenium.webdriver.remote.webelement.WebElement (session=\"fbca625cd8bb4eb98ae76bb68a23bd4f\",element=\"de630823-02d3-409a-ba19-4e892a0fad15\")> \n<selenium.webdriver.remote.webelement.WebElement (session=\"fbca625cd8bb4eb98ae76bb68a23bd4f\", element=\"de630823-02d3-409a-ba19-4e892a0fad15\")> \n[<selenium.webdriver.remote.webelement.WebElement (session=\"fbca625cd8bb4eb98ae76bb68a23bd4f\", element=\"de630823-02d3-409a-ba19-4e892a0fad15\")>]\n```\n\n这3个节点的类型是一致的，都是`WebElement`。\n\n这里列出所有获取单个节点的方法：\n\n```python\nfind_element_by_id \nfind_element_by_name \nfind_element_by_xpath \nfind_element_by_link_text \nfind_element_by_partial_link_text \nfind_element_by_tag_name \nfind_element_by_class_name \nfind_element_by_css_selector\n```\n\n### 多个节点\n\n多如果在网页中只查找一个目标，那么完全可以用`find_element`方法。但如果有多个节点需要查找，再用`find_element`方法，就只能得到第1个节点了。如果要查找所有满足条件的节点，需要用`find_elements`这样的 方法。注意，在这个方法的名称中， 注`element`多了一个多`s`，注意区分。\n\n举个例子，假如要查找淘宝左侧导航条的所有条目，就可以这样来实现：\n\n```python\nfrom selenium import webdriver\n\nbrowser = webdriver.Chrome()\nbrowser.get('https://www.taobao.com')\nlis = browser.find_elements_by_css_selector('.service-bd li')\nprint(lis)\nbrowser.close()\n```\n\n结果如下：\n\n```python\n[<selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"01e78303-6103-4f1a-96dc-0386a755a9f4\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"7a4e764e-9a05-4dad-9188-636512591835\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"16219266-ff57-4f42-95ab-4b8dbb4b811a\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"4f23598b-3ca6-4b20-9192-3e06e98984df\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"d837e630-e546-4f8b-babd-e3fdc539d2a6\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"1da195c9-d959-4d47-b729-21d8eac2756f\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"175c2217-dbe6-4d27-997f-58fbe46cbf1a\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"4747359f-d93c-4a7a-976e-501087d96e5f\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"2537bb34-3a26-4ccd-8f53-4ebbef5c70b2\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"04210bc7-ebba-44ef-8757-d88dfd0d023f\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"7bd1b6e4-31e5-4120-8017-afc59ca56f48\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"930a7b6c-26ff-468c-896e-6204b0555747\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"81305b6e-0893-46d2-b7a7-89a85c00132c\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"763237aa-5925-426d-9a76-90b3567870eb\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"60ca3595-3f74-4f1d-9224-7beb9e381a4b\")>]\n```\n\n得到的内容变成了列表类型，列表中的每个节点都是`WebElement`类型。\n\n也就是说，如果用`find_element`方法，只能获取匹配的第一个节点，结果是`WebElement`类型。如果用`find_elements`方法，则结果是列表类型，列表中的每个节点是`WebElement`类型。\n\n这里列出所有获取多个节点的方法：\n\n```python\nfind_elements_by_id\nfind_elements_by_name\nfind_elements_by_xpath\nfind_elements_by_link_text\nfind_elements_by_partial_link_text\nfind_elements_by_tag_name\nfind_elements_by_class_name\nfind_elements_by_css_selector\n```\n\n当然，也可以直接用`find_elements`方法来选择，这时可以这样写：\n\n```python\nlis = browser.find_elements(By.CSS_SELECTOR, '.service-bd li') \n```\n\n结果是完全一致的。\n\n### 节点交互\n\n`Selenium`可以驱动浏览器来执行一些操作，或者说可以让浏览器模拟执行一些动作。比较常见的用法有：输入文字时用`send_keys`方法，清空文字时用`clear`方法，点击按钮时用`click`方法。示例如下：\n\n```python\nimport time\n\nbrowser = webdriver.Chrome()\nbrowser.get('https://www.taobao.com')\ninput = browser.find_element_by_id('q')\ninput.send_keys('apple')\ntime.sleep(1)\ninput.clear()\ninput.send_keys('小米')\nbutton = browser.find_element_by_class_name('btn-search')\nbutton.click()\n```\n\n这里首先驱动浏览器打开淘宝，用`find_element_by_id`方法获取输入框，然后用`send_keys`方法输入`iPhone`文字，等待一秒后用`clear`方法清空输入框，接着再次调用`send_keys`方法输入`iPad`文字，之后再用`find_element_by_class_name`方法获取搜索按钮，最后调用`click`方法完成搜索动作。\n\n### 动作链\n\n在上面的实例中，一些交互动作都是针对某个节点执行的。比如，对于输入框，调用它的输入文字和清空文字方法；对于按钮，调用它的点击方法。其实，还有另外一些操作，它们没有特定的执行对象，比如鼠标拖拽、键盘按键等，这些动作用另一种方式来执行，那就是动作链。\n\n比如，现在要实现一个节点的拖拽操作，将某个节点从一处拖拽到另外一处，可以这样实现：\n\n```python\nfrom selenium import webdriver\nfrom selenium.webdriver import ActionChains\n\nbrowser = webdriver.Chrome()\nurl = 'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'\n\nbrowser.get(url)\nbrowser.switch_to.frame('iframeResult')\nsource = browser.find_element_by_css_selector(\"#draggable\")\ntarget = browser.find_element_by_css_selector(\"#droppable\")\nactions = ActionChains(browser)\nactions.drag_and_drop(source, target)\nactions.perform()\n```\n\n打开网页中的一个拖拽实例，依次选中要拖拽的节点和拖拽到的目标节点，接着声明`ActionChains`对象并将其赋值为`actions`变量，然后通过调用`actions`变量的`drag_and_drop`方法，再调用`perform`方法执行动作，此时就完成了拖拽操作，如图所示：\n\n![](Screenshot_7.webp)\n\n拖拽前页面：\n\n![](Screenshot_8.webp)\n\n### 执行执`JavaScript`\n\n`SeleniumAPI`并没有提供实现某些操作的方法，比如，下拉进度条。但它可以直接模拟运行`JavaScript`，此时使用`execute_script`方法即可实现，代码如下：\n\n```python\nfrom selenium import webdriver\nbrowser = webdriver.Chrome()\nbrowser.get('https://www.zhihu.com/explore')\nbrowser.execute_script('window.scrollTo(0, document.body.scrollHeight)')\nbrowser.execute_script('alert(\" To Bottom)')\n```\n\n这里利用`execute_script`方法将进度条下拉到最底部，然后弹出`alert`提示框。\n\n有了这个方法，基本上`API`没有提供的所有功能都可以用执行`JavaScript`的方式来实现了。\n\n## 获取节点信息\n\n`Selenium`已经提供了选择节点的方法，并且返回的是`WebElement`类型，那么它也有相关的方法和属性来直接提取节点信息，如属性、文本等。这样的话，就可以不用通过解析源代码来提取信息了，非常方便。\n\n### 获取属性\n\n可以使用`get_attribute`方法来获取节点的属性，但是前提是得先选中这个节点，示例如下：\n\n```python\nfrom selenium import webdriver\n\nbrowser = webdriver.Chrome()\nurl = 'https://www.baidu.com/'\nbrowser.get(url)\nlogo = browser.find_element_by_class_name('index-logo-src')\nprint(logo)\nprint(logo.get_attribute('src'))\n```\n\n运行之后，程序便会驱动浏览器打开该页面，然后获取`class`为`logo-image`的节点，最后打印出它的`src`属性。\n\n返回结果：\n\n```python\n<selenium.webdriver.remote.webelement.WebElement (session=\"c90d6158ff9e3e6ba88d5f9b9358a358\", element=\"c99170cd-b0c1-44b6-a0a0-f4ccf1105e91\")>\nhttps://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png\n```\n\n通过`get_attribute`方法，只需要传入想要获取的属性名，就可以得到它的值了。\n\n### 获取文本值\n\n每个`WebElement`节点都有`text`属性，直接调用这个属性就可以得到节点内部的文本信息，这相当于`pyquery`的`text`方法，示例如下：\n\n```python\nfrom selenium import webdriver\n\nbrowser = webdriver.Chrome()\nurl = 'https://holychan.ltd/archives/'\nbrowser.get(url)\ntitle = browser.find_element_by_class_name('title-h2')\nprint(title)\nprint(title.text)\n```\n\n结果如下：\n\n```python\n<selenium.webdriver.remote.webelement.WebElement (session=\"79f97c0aa935723e276438a5fff2610c\", element=\"b86ec344-cb00-4538-b9e9-8959a076bc75\")>\n文章归档\n```\n\n### 获取获ID、位置、标签名、大小\n\n`WebElement`节点还有一些其他属性，比如`id`属性可以获取节点`id`，`location`属性可以获取该节点在页面中的相对位置，`tag_name`属性可以获取标签名称，`size`属性可以获取节点的大小，也就是宽高，这些 属性有时候还是很有用的。示例如下：\n\n```python\nfrom selenium import webdriver\nbrowser = webdriver.Chrome() \nurl = 'https://dynamic2.scrape.cuiqingcai.com/' \nbrowser.get(url) \ninput = browser.find_element_by_class_name('logo-title') \nprint(input.id) \nprint(input.location) \nprint(input.tag_name) \nprint(input.size) \n```\n\n这里首先获得`class`为`logo-title`这个节点，然后调用其`id`、`location`、`tag_name`、`size`属性来获取对应的属性值。\n\n## 切换Frame\n\n网页中有一种节点叫作`iframe`，也就是子`Frame`，相当于页面的子页面，它的结构和外部网页的结构完全一致。`Selenium`打开页面后，默认是在父级`Frame`里面操作，而此时如果页面中还有子`Frame`，`Selenium`是不能获取到子`Frame`里面的节点的。这时就需要使用`switch_to.frame`方法来切换`Frame`。示例如下：\n\n```python\nfrom selenium import webdriver\nfrom selenium.common.exceptions import NoSuchElementException\nbrowser = webdriver.Chrome()\nurl = 'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'\nbrowser.get(url)\nbrowser.switch_to('iframeResult')\ntry:\n    logo = browser.find_element_by_class_name('logo')\nexcept NoSuchElementException:\n    print('No logo found')\nbrowser.switch_to.parent_frame()\nlogo = browser.find_element_by_class_name('logo')\nprint(logo)\nprint(logo.text)\n```\n\n控制台输出：\n\n```python\nNo logo found\n<selenium.webdriver.remote.webelement.WebElement (session=\"ce74c2d83e0aca64c9ef8c4540b2fe16\", element=\"1d2c3c25-bd01-4b9a-b11b-16b8534bf6c2\")>\nRUNOOB.COM\n```\n\n首先通过`switch_to.frame`方法切换到子`Frame`里面，然后尝试获取子`Frame`里的`logo`节点（这是不能找到的），如果找不到的话，就会抛出`NoSuchElementException`异常，异常被捕捉之后，就会输出`No logo found`。接下来，我们需要重新切换回父级`Frame`，然后再次重新获取节点，发现此时可以成功获取了。\n\n所以，当页面中包含子`Frame`时，如果想获取子`Frame`中的节点，需要先调用`switch_to.frame`方法切换到对应的`Frame`，然后再进行操作。\n\n## 延时等待\n\n在`Selenium`中，`get`方法会在网页框架加载结束后结束执行，此时如果获取`page_source`，可能并不是浏览器完全加载完成的页面，如果某些页面有额外的`Ajax`请求，在网页源代码中也不一定能成功获取 \\到。所以，这里需要延时等待一定时间，确保节点已经加载出来。\n\n这里等待的方式有两种：一种是隐式等待，一种是显式等待。\n\n### 隐式等待 \n\n当使用隐式等待执行测试的时候，如果`Selenium`没有在`DOM`中找到节点，将继续等待，超出设定时间后，则抛出找不到节点的异常。换句话说，隐式等待可以在我们查找节点而节点并没有立即出现的时候， 等待一段时间再查找`DOM`，默认的时间是`0`。示例如下：\n\n```python\nfrom selenium import webdriver\n\nbrowser = webdriver.Chrome()\nbrowser.implicitly_wait(10)\nbrowser.get('https://dynamic2. scrape.cuiqingcai.com/') \ninput = browser.find_element_by_class_name('logo-image') \nprint(input)\n```\n\n","source":"_posts/Selenium的基本使用.md","raw":"---\ntitle: Selenium的基本使用\ntags:\n  - selenium\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-25 21:15:51\ncategories: 爬虫\npic:\n---\n\n在很多情况下，`Ajax`请求的接口通常会包含加密的参数，如`token`、`sign`等，如：[https://dynamic2.scrape.cuiqingcai.com/](https://dynamic2.scrape.cuiqingcai.com/)，它的`Ajax`接口是包含一个`token`参数的，如图所示。\n\n![](Screenshot_5.webp)\n\n由于接口的请求加上了`token`参数，如果不深入分析并找到`token`的构造逻辑，是难以直接模拟这些`Ajax`请求的。\n\n`Selenium`是一个自动化测试工具，利用它可以驱动浏览器执行特定的动作，如点击、下拉等操作，同时还可以获取浏览器当前呈现的页面源代码，做到可见即可爬。对于一些使用`JavaScript`动态渲染的页面来说，此种抓取方式非常有效。\n\n## 准备工作\n\n确保已经正确安装好了`Chrome`浏览器并配置好了`ChromeDriver`。另外，还需要正确安装好`Python`的`Selenium`库。\n\n### Selenium安装\n\n```python\npip3 install selenium\n```\n\n### chrome driver安装\n\n查看安装的浏览器版本，在`chrome`搜索栏输入`chrome://version/`，会显示带当前浏览器的版本信息。\n\n![](Screenshot_1.webp)\n\n在[https://npm.taobao.org/mirrors/chromedriver/](https://npm.taobao.org/mirrors/chromedriver/)下载对应版本的`chrome driver`，一定要对应，否则不能使用。\n\n![](Screenshot_2.webp)\n\n下载到本地后，将`chromedriver.exe`分别拷贝到`chrome.exe`和`python`安装路径下。\n\n![](Screenshot_3.webp)\n\n![](Screenshot_4.webp)\n\n以上，安装就完成了！\n\n## 基本使用\n\n首先来看一下`Selenium`有一些怎样的功能。示例如下：\n\n```python\nfrom selenium import webdriver\nfrom selenium.webdriver.common.by import By\nfrom selenium.webdriver.common.keys import Keys\nfrom selenium.webdriver.support import expected_conditions as EC\nfrom selenium.webdriver.support.wait import WebDriverWait\n\nbrowser = webdriver.Chrome()\ntry:\n    browser.get('https://www.baidu.com')\n    input = browser.find_element_by_id('kw')\n    input.send_keys('Python')\n    input.send_keys(Keys.ENTER)\n    wait = WebDriverWait(browser, 10)\n    wait.until(EC.presence_of_element_located((By.ID, 'content_left')))\n    print(browser.current_url)\n    print(browser.get_cookies())\n    print(browser.page_source)\nfinally:\n    browser.close()\n```\n\n运行代码后会自动弹出一个`Chrome`浏览器，浏览器会跳转到百度，然后在搜索框中输入`Python`，接着跳转到搜索结果页，如图所示。\n\n![](Screenshot_6.webp)\n\n此时在控制台的输出结果如下：\n\n```shell\nhref=\"http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_\" target=\"_blank\">你都用 <em>Python</em> 来做什么? - 知乎</a></h3><div class=\"c-row c-gap-top-small\"><div class=\"general_image_pic c-span3\" style=\"position:relative;top:2px;\"><a class=\"c-img c-img3 c-img-radius-large\" style=\"height:85px\" href=\"http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_\" target=\"_blank\"><img class=\"c-img c-img3 c-img-radius-large\" src=\"https://dss1.bdstatic.com/6OF1bjeh1BF3odCf/it/u=958012630,1445793633&amp;fm=218&amp;app=92&amp;f=JPEG?w=121&amp;h=75&amp;s=44A638725CB7469C82F4FFF40200D025\" style=\"height:85px;\"><span class=\"c-img-border c-img-radius-large\"></span></a></div><div class=\"c-span9 c-span-last\"><div class=\"c-abstract\"><span class=\" newTimeFactor_before_abs c-color-gray2 m\">2019年10月17日&nbsp;</span>所有项目的代码和数据在Github:interesting-<em>python</em> 如果你也想用<em>Python</em>获取数据,进行有趣的 \n数据分析,Alfred数据室应众多读者要求出品的《实战玩转<em>python</em>爬虫》课程将会是你的好帮手...</div><style>.user-avatar {\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        justify-content: flex-start;\n}</style><div class=\"f13 c-gap-top-xsmall se_st_footer user-avatar\"><a target=\"_blank\" href=\"http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_\" class=\"c-showurl c-color-gray\" style=\"text-decoration:none;position:relative;\"><div class=\"c-img c-img-circle c-gap-right-xsmall\" style=\"display: inline-block;width: 16px;height: 16px;position: relative;top: 3px;vertical-align:top;\"><span class=\"c-img-border c-img-source-border c-img-radius-large\"></span><img src=\"https://ss0.baidu.com/6ONWsjip0QIZ8tyhnq/it/u=493147230,3096476255&amp;fm=195&amp;app=88&amp;f=JPEG?w=200&amp;h=200\"></div>知乎</a><div class=\"c-tools c-gap-left\" id=\"tools_9637258987948217910_8\" data-tools=\"{&quot;title&quot;:&quot;你都用 Python 来做什么? - 知乎&quot;,&quot;url&quot;:&quot;http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_&quot;}\"><i class=\"c-icon f13\"></i></div><span class=\"c-icons-outer\"><span class=\"c-icons-inner\"></span></span><style>.snapshoot, .snapshoot:visited {\n        color: #9195A3!important;\n    }\n    .snapshoot:active, .snapshoot:hover {\n        color: #626675!important;\n    }</style><a data-click=\"{'rsv_snapshot':'1'}\" href=\"http://cache.baiducontent.com/c?m=JgFgeas2iHrh6pppvD-MHkvHPj9DsOz-wd718JIlv_IJy7d0KdQ2HvVIYznaRWwGrKHLEtVbqjR4uoZg6X_h4g62yFf5FgBVDUBkRfcWrOG&amp;p=8b2a9715d9c647f904aec5344f57&amp;newp=8b2a9729c5df1bb508e291784f4a92695d0fc20e3ad0d001298ffe0cc4241a1a1a3aecbf2c261600d7c279650aab4a5feff336743d0034f1f689df08d2ecce7e439b3b6e6a&amp;s=45c48cce2e2d7fbd&amp;user=baidu&amp;fm=sc&amp;query=Python&amp;qid=dc4c1a0300139b42&amp;p1=8\" target=\"_blank\" class=\"m c-gap-left c-color-gray kuaizhao snapshoot\">百度快照</a></div></div></div></div>\n```\n\n源代码过长，在此省略。可以看到，当前得到的`URL`、`Cookies`和源代码都是浏览器中的真实内容。所以说，如果用`Selenium`来驱动浏览器加载网页的话，就可以直接拿到`JavaScript`渲染的结果了，不用担心使用的是什么加密系统。\n\n了解一下`Selenium`的用法。\n\n## 声明浏览器对象\n\n`Selenium`支持非常多的浏览器，如`Chrome`、`Firefox`、`Edge`等，还有`Android`、`BlackBerry`等手机端的浏览器。\n\n可以用如下方式进行初始化：\n\n```python\nfrom selenium import webdriver\nbrowser = webdriver.Chrome()\nbrowser = webdriver.Firefox()\nbrowser = webdriver.Edge()\nbrowser = webdriver.Safari()\n```\n\n这样就完成了浏览器对象的初始化并将其赋值为`browser`对象。接下来，要做的就是调用`browser`对象，让其执行各个动作以模拟浏览器操作。\n\n## 访问页面\n\n可以用`get`方法请求页面，只需要把参数传入连接`URL`即可。比如，这里用`get`方法访问淘宝，代码如下：\n\n```python\nfrom selenium import webdriver\nbrowser = webdriver.Chrome()\nbrowser.get('https://www.taobao.com')\nprint(browser.page_source)\nbrowser.close()\n```\n\n运行后会弹出`Chrome`浏览器并且自动访问淘宝，然后控制台会输出淘宝页面的源代码，随后浏览器关闭。\n\n## 查找节点\n\n`Selenium`可以驱动浏览器完成各种操作，比如填充表单、模拟点击等。举个例子，当想要完成向某个输入框输入文字的操作时，首先需要知道这个输入框在哪，而 `Selenium`提供了一系列查找节点的方法，可以用这些方法来获取想要的节点，以便执行下一步动作或者提取信息。\n\n### 单个节点\n\n想要从淘宝页面中提取搜索框这个节点，首先要观察它的源代码。\n\n可以发现，它的`id`是`q`，`name`也是`q`，此外还有许多其他属性。此时就可以用多种方式获取它了。比如，`find_element_by_name`代表根据`name`值获取，`find_element_by_id`则是根据`id`获取，另外，还有根据`XPath`、`CSS`选择器等获取的方式。\n\n这里使用`3`种方式获取输入框，分别是根据`id`、`CSS`选择器和`XPath`获取，它们返回的结果完全一致。运行结果如下：\n\n```python\n<selenium.webdriver.remote.webelement.WebElement (session=\"fbca625cd8bb4eb98ae76bb68a23bd4f\",element=\"de630823-02d3-409a-ba19-4e892a0fad15\")> \n<selenium.webdriver.remote.webelement.WebElement (session=\"fbca625cd8bb4eb98ae76bb68a23bd4f\", element=\"de630823-02d3-409a-ba19-4e892a0fad15\")> \n[<selenium.webdriver.remote.webelement.WebElement (session=\"fbca625cd8bb4eb98ae76bb68a23bd4f\", element=\"de630823-02d3-409a-ba19-4e892a0fad15\")>]\n```\n\n这3个节点的类型是一致的，都是`WebElement`。\n\n这里列出所有获取单个节点的方法：\n\n```python\nfind_element_by_id \nfind_element_by_name \nfind_element_by_xpath \nfind_element_by_link_text \nfind_element_by_partial_link_text \nfind_element_by_tag_name \nfind_element_by_class_name \nfind_element_by_css_selector\n```\n\n### 多个节点\n\n多如果在网页中只查找一个目标，那么完全可以用`find_element`方法。但如果有多个节点需要查找，再用`find_element`方法，就只能得到第1个节点了。如果要查找所有满足条件的节点，需要用`find_elements`这样的 方法。注意，在这个方法的名称中， 注`element`多了一个多`s`，注意区分。\n\n举个例子，假如要查找淘宝左侧导航条的所有条目，就可以这样来实现：\n\n```python\nfrom selenium import webdriver\n\nbrowser = webdriver.Chrome()\nbrowser.get('https://www.taobao.com')\nlis = browser.find_elements_by_css_selector('.service-bd li')\nprint(lis)\nbrowser.close()\n```\n\n结果如下：\n\n```python\n[<selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"01e78303-6103-4f1a-96dc-0386a755a9f4\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"7a4e764e-9a05-4dad-9188-636512591835\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"16219266-ff57-4f42-95ab-4b8dbb4b811a\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"4f23598b-3ca6-4b20-9192-3e06e98984df\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"d837e630-e546-4f8b-babd-e3fdc539d2a6\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"1da195c9-d959-4d47-b729-21d8eac2756f\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"175c2217-dbe6-4d27-997f-58fbe46cbf1a\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"4747359f-d93c-4a7a-976e-501087d96e5f\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"2537bb34-3a26-4ccd-8f53-4ebbef5c70b2\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"04210bc7-ebba-44ef-8757-d88dfd0d023f\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"7bd1b6e4-31e5-4120-8017-afc59ca56f48\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"930a7b6c-26ff-468c-896e-6204b0555747\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"81305b6e-0893-46d2-b7a7-89a85c00132c\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"763237aa-5925-426d-9a76-90b3567870eb\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"f9550f7bf1204e4d481803cf7a69c736\", element=\"60ca3595-3f74-4f1d-9224-7beb9e381a4b\")>]\n```\n\n得到的内容变成了列表类型，列表中的每个节点都是`WebElement`类型。\n\n也就是说，如果用`find_element`方法，只能获取匹配的第一个节点，结果是`WebElement`类型。如果用`find_elements`方法，则结果是列表类型，列表中的每个节点是`WebElement`类型。\n\n这里列出所有获取多个节点的方法：\n\n```python\nfind_elements_by_id\nfind_elements_by_name\nfind_elements_by_xpath\nfind_elements_by_link_text\nfind_elements_by_partial_link_text\nfind_elements_by_tag_name\nfind_elements_by_class_name\nfind_elements_by_css_selector\n```\n\n当然，也可以直接用`find_elements`方法来选择，这时可以这样写：\n\n```python\nlis = browser.find_elements(By.CSS_SELECTOR, '.service-bd li') \n```\n\n结果是完全一致的。\n\n### 节点交互\n\n`Selenium`可以驱动浏览器来执行一些操作，或者说可以让浏览器模拟执行一些动作。比较常见的用法有：输入文字时用`send_keys`方法，清空文字时用`clear`方法，点击按钮时用`click`方法。示例如下：\n\n```python\nimport time\n\nbrowser = webdriver.Chrome()\nbrowser.get('https://www.taobao.com')\ninput = browser.find_element_by_id('q')\ninput.send_keys('apple')\ntime.sleep(1)\ninput.clear()\ninput.send_keys('小米')\nbutton = browser.find_element_by_class_name('btn-search')\nbutton.click()\n```\n\n这里首先驱动浏览器打开淘宝，用`find_element_by_id`方法获取输入框，然后用`send_keys`方法输入`iPhone`文字，等待一秒后用`clear`方法清空输入框，接着再次调用`send_keys`方法输入`iPad`文字，之后再用`find_element_by_class_name`方法获取搜索按钮，最后调用`click`方法完成搜索动作。\n\n### 动作链\n\n在上面的实例中，一些交互动作都是针对某个节点执行的。比如，对于输入框，调用它的输入文字和清空文字方法；对于按钮，调用它的点击方法。其实，还有另外一些操作，它们没有特定的执行对象，比如鼠标拖拽、键盘按键等，这些动作用另一种方式来执行，那就是动作链。\n\n比如，现在要实现一个节点的拖拽操作，将某个节点从一处拖拽到另外一处，可以这样实现：\n\n```python\nfrom selenium import webdriver\nfrom selenium.webdriver import ActionChains\n\nbrowser = webdriver.Chrome()\nurl = 'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'\n\nbrowser.get(url)\nbrowser.switch_to.frame('iframeResult')\nsource = browser.find_element_by_css_selector(\"#draggable\")\ntarget = browser.find_element_by_css_selector(\"#droppable\")\nactions = ActionChains(browser)\nactions.drag_and_drop(source, target)\nactions.perform()\n```\n\n打开网页中的一个拖拽实例，依次选中要拖拽的节点和拖拽到的目标节点，接着声明`ActionChains`对象并将其赋值为`actions`变量，然后通过调用`actions`变量的`drag_and_drop`方法，再调用`perform`方法执行动作，此时就完成了拖拽操作，如图所示：\n\n![](Screenshot_7.webp)\n\n拖拽前页面：\n\n![](Screenshot_8.webp)\n\n### 执行执`JavaScript`\n\n`SeleniumAPI`并没有提供实现某些操作的方法，比如，下拉进度条。但它可以直接模拟运行`JavaScript`，此时使用`execute_script`方法即可实现，代码如下：\n\n```python\nfrom selenium import webdriver\nbrowser = webdriver.Chrome()\nbrowser.get('https://www.zhihu.com/explore')\nbrowser.execute_script('window.scrollTo(0, document.body.scrollHeight)')\nbrowser.execute_script('alert(\" To Bottom)')\n```\n\n这里利用`execute_script`方法将进度条下拉到最底部，然后弹出`alert`提示框。\n\n有了这个方法，基本上`API`没有提供的所有功能都可以用执行`JavaScript`的方式来实现了。\n\n## 获取节点信息\n\n`Selenium`已经提供了选择节点的方法，并且返回的是`WebElement`类型，那么它也有相关的方法和属性来直接提取节点信息，如属性、文本等。这样的话，就可以不用通过解析源代码来提取信息了，非常方便。\n\n### 获取属性\n\n可以使用`get_attribute`方法来获取节点的属性，但是前提是得先选中这个节点，示例如下：\n\n```python\nfrom selenium import webdriver\n\nbrowser = webdriver.Chrome()\nurl = 'https://www.baidu.com/'\nbrowser.get(url)\nlogo = browser.find_element_by_class_name('index-logo-src')\nprint(logo)\nprint(logo.get_attribute('src'))\n```\n\n运行之后，程序便会驱动浏览器打开该页面，然后获取`class`为`logo-image`的节点，最后打印出它的`src`属性。\n\n返回结果：\n\n```python\n<selenium.webdriver.remote.webelement.WebElement (session=\"c90d6158ff9e3e6ba88d5f9b9358a358\", element=\"c99170cd-b0c1-44b6-a0a0-f4ccf1105e91\")>\nhttps://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png\n```\n\n通过`get_attribute`方法，只需要传入想要获取的属性名，就可以得到它的值了。\n\n### 获取文本值\n\n每个`WebElement`节点都有`text`属性，直接调用这个属性就可以得到节点内部的文本信息，这相当于`pyquery`的`text`方法，示例如下：\n\n```python\nfrom selenium import webdriver\n\nbrowser = webdriver.Chrome()\nurl = 'https://holychan.ltd/archives/'\nbrowser.get(url)\ntitle = browser.find_element_by_class_name('title-h2')\nprint(title)\nprint(title.text)\n```\n\n结果如下：\n\n```python\n<selenium.webdriver.remote.webelement.WebElement (session=\"79f97c0aa935723e276438a5fff2610c\", element=\"b86ec344-cb00-4538-b9e9-8959a076bc75\")>\n文章归档\n```\n\n### 获取获ID、位置、标签名、大小\n\n`WebElement`节点还有一些其他属性，比如`id`属性可以获取节点`id`，`location`属性可以获取该节点在页面中的相对位置，`tag_name`属性可以获取标签名称，`size`属性可以获取节点的大小，也就是宽高，这些 属性有时候还是很有用的。示例如下：\n\n```python\nfrom selenium import webdriver\nbrowser = webdriver.Chrome() \nurl = 'https://dynamic2.scrape.cuiqingcai.com/' \nbrowser.get(url) \ninput = browser.find_element_by_class_name('logo-title') \nprint(input.id) \nprint(input.location) \nprint(input.tag_name) \nprint(input.size) \n```\n\n这里首先获得`class`为`logo-title`这个节点，然后调用其`id`、`location`、`tag_name`、`size`属性来获取对应的属性值。\n\n## 切换Frame\n\n网页中有一种节点叫作`iframe`，也就是子`Frame`，相当于页面的子页面，它的结构和外部网页的结构完全一致。`Selenium`打开页面后，默认是在父级`Frame`里面操作，而此时如果页面中还有子`Frame`，`Selenium`是不能获取到子`Frame`里面的节点的。这时就需要使用`switch_to.frame`方法来切换`Frame`。示例如下：\n\n```python\nfrom selenium import webdriver\nfrom selenium.common.exceptions import NoSuchElementException\nbrowser = webdriver.Chrome()\nurl = 'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'\nbrowser.get(url)\nbrowser.switch_to('iframeResult')\ntry:\n    logo = browser.find_element_by_class_name('logo')\nexcept NoSuchElementException:\n    print('No logo found')\nbrowser.switch_to.parent_frame()\nlogo = browser.find_element_by_class_name('logo')\nprint(logo)\nprint(logo.text)\n```\n\n控制台输出：\n\n```python\nNo logo found\n<selenium.webdriver.remote.webelement.WebElement (session=\"ce74c2d83e0aca64c9ef8c4540b2fe16\", element=\"1d2c3c25-bd01-4b9a-b11b-16b8534bf6c2\")>\nRUNOOB.COM\n```\n\n首先通过`switch_to.frame`方法切换到子`Frame`里面，然后尝试获取子`Frame`里的`logo`节点（这是不能找到的），如果找不到的话，就会抛出`NoSuchElementException`异常，异常被捕捉之后，就会输出`No logo found`。接下来，我们需要重新切换回父级`Frame`，然后再次重新获取节点，发现此时可以成功获取了。\n\n所以，当页面中包含子`Frame`时，如果想获取子`Frame`中的节点，需要先调用`switch_to.frame`方法切换到对应的`Frame`，然后再进行操作。\n\n## 延时等待\n\n在`Selenium`中，`get`方法会在网页框架加载结束后结束执行，此时如果获取`page_source`，可能并不是浏览器完全加载完成的页面，如果某些页面有额外的`Ajax`请求，在网页源代码中也不一定能成功获取 \\到。所以，这里需要延时等待一定时间，确保节点已经加载出来。\n\n这里等待的方式有两种：一种是隐式等待，一种是显式等待。\n\n### 隐式等待 \n\n当使用隐式等待执行测试的时候，如果`Selenium`没有在`DOM`中找到节点，将继续等待，超出设定时间后，则抛出找不到节点的异常。换句话说，隐式等待可以在我们查找节点而节点并没有立即出现的时候， 等待一段时间再查找`DOM`，默认的时间是`0`。示例如下：\n\n```python\nfrom selenium import webdriver\n\nbrowser = webdriver.Chrome()\nbrowser.implicitly_wait(10)\nbrowser.get('https://dynamic2. scrape.cuiqingcai.com/') \ninput = browser.find_element_by_class_name('logo-image') \nprint(input)\n```\n\n","slug":"Selenium的基本使用","published":1,"updated":"2021-06-15T03:24:11.475Z","layout":"post","photos":[],"link":"","_id":"ckq14rx3v007844ud314246v2","content":"<p>在很多情况下，<code>Ajax</code>请求的接口通常会包含加密的参数，如<code>token</code>、<code>sign</code>等，如：<a href=\"https://dynamic2.scrape.cuiqingcai.com/\">https://dynamic2.scrape.cuiqingcai.com/</a>，它的<code>Ajax</code>接口是包含一个<code>token</code>参数的，如图所示。</p>\n<p><img src=\"Screenshot_5.webp\"></p>\n<p>由于接口的请求加上了<code>token</code>参数，如果不深入分析并找到<code>token</code>的构造逻辑，是难以直接模拟这些<code>Ajax</code>请求的。</p>\n<p><code>Selenium</code>是一个自动化测试工具，利用它可以驱动浏览器执行特定的动作，如点击、下拉等操作，同时还可以获取浏览器当前呈现的页面源代码，做到可见即可爬。对于一些使用<code>JavaScript</code>动态渲染的页面来说，此种抓取方式非常有效。</p>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p>确保已经正确安装好了<code>Chrome</code>浏览器并配置好了<code>ChromeDriver</code>。另外，还需要正确安装好<code>Python</code>的<code>Selenium</code>库。</p>\n<h3 id=\"Selenium安装\"><a href=\"#Selenium安装\" class=\"headerlink\" title=\"Selenium安装\"></a>Selenium安装</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install selenium</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"chrome-driver安装\"><a href=\"#chrome-driver安装\" class=\"headerlink\" title=\"chrome driver安装\"></a>chrome driver安装</h3><p>查看安装的浏览器版本，在<code>chrome</code>搜索栏输入<code>chrome://version/</code>，会显示带当前浏览器的版本信息。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>在<a href=\"https://npm.taobao.org/mirrors/chromedriver/\">https://npm.taobao.org/mirrors/chromedriver/</a>下载对应版本的<code>chrome driver</code>，一定要对应，否则不能使用。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>下载到本地后，将<code>chromedriver.exe</code>分别拷贝到<code>chrome.exe</code>和<code>python</code>安装路径下。</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<p><img src=\"Screenshot_4.webp\"></p>\n<p>以上，安装就完成了！</p>\n<h2 id=\"基本使用\"><a href=\"#基本使用\" class=\"headerlink\" title=\"基本使用\"></a>基本使用</h2><p>首先来看一下<code>Selenium</code>有一些怎样的功能。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.by <span class=\"keyword\">import</span> By</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.keys <span class=\"keyword\">import</span> Keys</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support <span class=\"keyword\">import</span> expected_conditions <span class=\"keyword\">as</span> EC</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support.wait <span class=\"keyword\">import</span> WebDriverWait</span><br><span class=\"line\"></span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    browser.get(<span class=\"string\">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">input</span> = browser.find_element_by_id(<span class=\"string\">&#x27;kw&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">input</span>.send_keys(<span class=\"string\">&#x27;Python&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">input</span>.send_keys(Keys.ENTER)</span><br><span class=\"line\">    wait = WebDriverWait(browser, <span class=\"number\">10</span>)</span><br><span class=\"line\">    wait.until(EC.presence_of_element_located((By.ID, <span class=\"string\">&#x27;content_left&#x27;</span>)))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(browser.current_url)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(browser.get_cookies())</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(browser.page_source)</span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">    browser.close()</span><br></pre></td></tr></table></figure>\n\n<p>运行代码后会自动弹出一个<code>Chrome</code>浏览器，浏览器会跳转到百度，然后在搜索框中输入<code>Python</code>，接着跳转到搜索结果页，如图所示。</p>\n<p><img src=\"Screenshot_6.webp\"></p>\n<p>此时在控制台的输出结果如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">href=&quot;http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_&quot; target=&quot;_blank&quot;&gt;你都用 &lt;em&gt;Python&lt;/em&gt; 来做什么? - 知乎&lt;/a&gt;&lt;/h3&gt;&lt;div class=&quot;c-row c-gap-top-small&quot;&gt;&lt;div class=&quot;general_image_pic c-span3&quot; style=&quot;position:relative;top:2px;&quot;&gt;&lt;a class=&quot;c-img c-img3 c-img-radius-large&quot; style=&quot;height:85px&quot; href=&quot;http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_&quot; target=&quot;_blank&quot;&gt;&lt;img class=&quot;c-img c-img3 c-img-radius-large&quot; src=&quot;https://dss1.bdstatic.com/6OF1bjeh1BF3odCf/it/u=958012630,1445793633&amp;amp;fm=218&amp;amp;app=92&amp;amp;f=JPEG?w=121&amp;amp;h=75&amp;amp;s=44A638725CB7469C82F4FFF40200D025&quot; style=&quot;height:85px;&quot;&gt;&lt;span class=&quot;c-img-border c-img-radius-large&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;&lt;div class=&quot;c-span9 c-span-last&quot;&gt;&lt;div class=&quot;c-abstract&quot;&gt;&lt;span class=&quot; newTimeFactor_before_abs c-color-gray2 m&quot;&gt;2019年10月17日&amp;nbsp;&lt;/span&gt;所有项目的代码和数据在Github:interesting-&lt;em&gt;python&lt;/em&gt; 如果你也想用&lt;em&gt;Python&lt;/em&gt;获取数据,进行有趣的 </span><br><span class=\"line\">数据分析,Alfred数据室应众多读者要求出品的《实战玩转&lt;em&gt;python&lt;/em&gt;爬虫》课程将会是你的好帮手...&lt;/div&gt;&lt;style&gt;.user-avatar &#123;</span><br><span class=\"line\">        display: flex;</span><br><span class=\"line\">        flex-direction: row;</span><br><span class=\"line\">        align-items: center;</span><br><span class=\"line\">        justify-content: flex-start;</span><br><span class=\"line\">&#125;&lt;/style&gt;&lt;div class=&quot;f13 c-gap-top-xsmall se_st_footer user-avatar&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_&quot; class=&quot;c-showurl c-color-gray&quot; style=&quot;text-decoration:none;position:relative;&quot;&gt;&lt;div class=&quot;c-img c-img-circle c-gap-right-xsmall&quot; style=&quot;display: inline-block;width: 16px;height: 16px;position: relative;top: 3px;vertical-align:top;&quot;&gt;&lt;span class=&quot;c-img-border c-img-source-border c-img-radius-large&quot;&gt;&lt;/span&gt;&lt;img src=&quot;https://ss0.baidu.com/6ONWsjip0QIZ8tyhnq/it/u=493147230,3096476255&amp;amp;fm=195&amp;amp;app=88&amp;amp;f=JPEG?w=200&amp;amp;h=200&quot;&gt;&lt;/div&gt;知乎&lt;/a&gt;&lt;div class=&quot;c-tools c-gap-left&quot; id=&quot;tools_9637258987948217910_8&quot; data-tools=&quot;&#123;&amp;quot;title&amp;quot;:&amp;quot;你都用 Python 来做什么? - 知乎&amp;quot;,&amp;quot;url&amp;quot;:&amp;quot;http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_&amp;quot;&#125;&quot;&gt;&lt;i class=&quot;c-icon f13&quot;&gt;&lt;/i&gt;&lt;/div&gt;&lt;span class=&quot;c-icons-outer&quot;&gt;&lt;span class=&quot;c-icons-inner&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;style&gt;.snapshoot, .snapshoot:visited &#123;</span><br><span class=\"line\">        color: #9195A3!important;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    .snapshoot:active, .snapshoot:hover &#123;</span><br><span class=\"line\">        color: #626675!important;</span><br><span class=\"line\">    &#125;&lt;/style&gt;&lt;a data-click=&quot;&#123;&#x27;rsv_snapshot&#x27;:&#x27;1&#x27;&#125;&quot; href=&quot;http://cache.baiducontent.com/c?m=JgFgeas2iHrh6pppvD-MHkvHPj9DsOz-wd718JIlv_IJy7d0KdQ2HvVIYznaRWwGrKHLEtVbqjR4uoZg6X_h4g62yFf5FgBVDUBkRfcWrOG&amp;amp;p=8b2a9715d9c647f904aec5344f57&amp;amp;newp=8b2a9729c5df1bb508e291784f4a92695d0fc20e3ad0d001298ffe0cc4241a1a1a3aecbf2c261600d7c279650aab4a5feff336743d0034f1f689df08d2ecce7e439b3b6e6a&amp;amp;s=45c48cce2e2d7fbd&amp;amp;user=baidu&amp;amp;fm=sc&amp;amp;query=Python&amp;amp;qid=dc4c1a0300139b42&amp;amp;p1=8&quot; target=&quot;_blank&quot; class=&quot;m c-gap-left c-color-gray kuaizhao snapshoot&quot;&gt;百度快照&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>\n\n<p>源代码过长，在此省略。可以看到，当前得到的<code>URL</code>、<code>Cookies</code>和源代码都是浏览器中的真实内容。所以说，如果用<code>Selenium</code>来驱动浏览器加载网页的话，就可以直接拿到<code>JavaScript</code>渲染的结果了，不用担心使用的是什么加密系统。</p>\n<p>了解一下<code>Selenium</code>的用法。</p>\n<h2 id=\"声明浏览器对象\"><a href=\"#声明浏览器对象\" class=\"headerlink\" title=\"声明浏览器对象\"></a>声明浏览器对象</h2><p><code>Selenium</code>支持非常多的浏览器，如<code>Chrome</code>、<code>Firefox</code>、<code>Edge</code>等，还有<code>Android</code>、<code>BlackBerry</code>等手机端的浏览器。</p>\n<p>可以用如下方式进行初始化：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">browser = webdriver.Firefox()</span><br><span class=\"line\">browser = webdriver.Edge()</span><br><span class=\"line\">browser = webdriver.Safari()</span><br></pre></td></tr></table></figure>\n\n<p>这样就完成了浏览器对象的初始化并将其赋值为<code>browser</code>对象。接下来，要做的就是调用<code>browser</code>对象，让其执行各个动作以模拟浏览器操作。</p>\n<h2 id=\"访问页面\"><a href=\"#访问页面\" class=\"headerlink\" title=\"访问页面\"></a>访问页面</h2><p>可以用<code>get</code>方法请求页面，只需要把参数传入连接<code>URL</code>即可。比如，这里用<code>get</code>方法访问淘宝，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">browser.get(<span class=\"string\">&#x27;https://www.taobao.com&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(browser.page_source)</span><br><span class=\"line\">browser.close()</span><br></pre></td></tr></table></figure>\n\n<p>运行后会弹出<code>Chrome</code>浏览器并且自动访问淘宝，然后控制台会输出淘宝页面的源代码，随后浏览器关闭。</p>\n<h2 id=\"查找节点\"><a href=\"#查找节点\" class=\"headerlink\" title=\"查找节点\"></a>查找节点</h2><p><code>Selenium</code>可以驱动浏览器完成各种操作，比如填充表单、模拟点击等。举个例子，当想要完成向某个输入框输入文字的操作时，首先需要知道这个输入框在哪，而 <code>Selenium</code>提供了一系列查找节点的方法，可以用这些方法来获取想要的节点，以便执行下一步动作或者提取信息。</p>\n<h3 id=\"单个节点\"><a href=\"#单个节点\" class=\"headerlink\" title=\"单个节点\"></a>单个节点</h3><p>想要从淘宝页面中提取搜索框这个节点，首先要观察它的源代码。</p>\n<p>可以发现，它的<code>id</code>是<code>q</code>，<code>name</code>也是<code>q</code>，此外还有许多其他属性。此时就可以用多种方式获取它了。比如，<code>find_element_by_name</code>代表根据<code>name</code>值获取，<code>find_element_by_id</code>则是根据<code>id</code>获取，另外，还有根据<code>XPath</code>、<code>CSS</code>选择器等获取的方式。</p>\n<p>这里使用<code>3</code>种方式获取输入框，分别是根据<code>id</code>、<code>CSS</code>选择器和<code>XPath</code>获取，它们返回的结果完全一致。运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;fbca625cd8bb4eb98ae76bb68a23bd4f&quot;</span>,element=<span class=\"string\">&quot;de630823-02d3-409a-ba19-4e892a0fad15&quot;</span>)&gt; </span><br><span class=\"line\">&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;fbca625cd8bb4eb98ae76bb68a23bd4f&quot;</span>, element=<span class=\"string\">&quot;de630823-02d3-409a-ba19-4e892a0fad15&quot;</span>)&gt; </span><br><span class=\"line\">[&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;fbca625cd8bb4eb98ae76bb68a23bd4f&quot;</span>, element=<span class=\"string\">&quot;de630823-02d3-409a-ba19-4e892a0fad15&quot;</span>)&gt;]</span><br></pre></td></tr></table></figure>\n\n<p>这3个节点的类型是一致的，都是<code>WebElement</code>。</p>\n<p>这里列出所有获取单个节点的方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find_element_by_id </span><br><span class=\"line\">find_element_by_name </span><br><span class=\"line\">find_element_by_xpath </span><br><span class=\"line\">find_element_by_link_text </span><br><span class=\"line\">find_element_by_partial_link_text </span><br><span class=\"line\">find_element_by_tag_name </span><br><span class=\"line\">find_element_by_class_name </span><br><span class=\"line\">find_element_by_css_selector</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"多个节点\"><a href=\"#多个节点\" class=\"headerlink\" title=\"多个节点\"></a>多个节点</h3><p>多如果在网页中只查找一个目标，那么完全可以用<code>find_element</code>方法。但如果有多个节点需要查找，再用<code>find_element</code>方法，就只能得到第1个节点了。如果要查找所有满足条件的节点，需要用<code>find_elements</code>这样的 方法。注意，在这个方法的名称中， 注<code>element</code>多了一个多<code>s</code>，注意区分。</p>\n<p>举个例子，假如要查找淘宝左侧导航条的所有条目，就可以这样来实现：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"></span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">browser.get(<span class=\"string\">&#x27;https://www.taobao.com&#x27;</span>)</span><br><span class=\"line\">lis = browser.find_elements_by_css_selector(<span class=\"string\">&#x27;.service-bd li&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(lis)</span><br><span class=\"line\">browser.close()</span><br></pre></td></tr></table></figure>\n\n<p>结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;01e78303-6103-4f1a-96dc-0386a755a9f4&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;7a4e764e-9a05-4dad-9188-636512591835&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;16219266-ff57-4f42-95ab-4b8dbb4b811a&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;4f23598b-3ca6-4b20-9192-3e06e98984df&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;d837e630-e546-4f8b-babd-e3fdc539d2a6&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;1da195c9-d959-4d47-b729-21d8eac2756f&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;175c2217-dbe6-4d27-997f-58fbe46cbf1a&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;4747359f-d93c-4a7a-976e-501087d96e5f&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;2537bb34-3a26-4ccd-8f53-4ebbef5c70b2&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;04210bc7-ebba-44ef-8757-d88dfd0d023f&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;7bd1b6e4-31e5-4120-8017-afc59ca56f48&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;930a7b6c-26ff-468c-896e-6204b0555747&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;81305b6e-0893-46d2-b7a7-89a85c00132c&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;763237aa-5925-426d-9a76-90b3567870eb&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;60ca3595-3f74-4f1d-9224-7beb9e381a4b&quot;</span>)&gt;]</span><br></pre></td></tr></table></figure>\n\n<p>得到的内容变成了列表类型，列表中的每个节点都是<code>WebElement</code>类型。</p>\n<p>也就是说，如果用<code>find_element</code>方法，只能获取匹配的第一个节点，结果是<code>WebElement</code>类型。如果用<code>find_elements</code>方法，则结果是列表类型，列表中的每个节点是<code>WebElement</code>类型。</p>\n<p>这里列出所有获取多个节点的方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find_elements_by_id</span><br><span class=\"line\">find_elements_by_name</span><br><span class=\"line\">find_elements_by_xpath</span><br><span class=\"line\">find_elements_by_link_text</span><br><span class=\"line\">find_elements_by_partial_link_text</span><br><span class=\"line\">find_elements_by_tag_name</span><br><span class=\"line\">find_elements_by_class_name</span><br><span class=\"line\">find_elements_by_css_selector</span><br></pre></td></tr></table></figure>\n\n<p>当然，也可以直接用<code>find_elements</code>方法来选择，这时可以这样写：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lis = browser.find_elements(By.CSS_SELECTOR, <span class=\"string\">&#x27;.service-bd li&#x27;</span>) </span><br></pre></td></tr></table></figure>\n\n<p>结果是完全一致的。</p>\n<h3 id=\"节点交互\"><a href=\"#节点交互\" class=\"headerlink\" title=\"节点交互\"></a>节点交互</h3><p><code>Selenium</code>可以驱动浏览器来执行一些操作，或者说可以让浏览器模拟执行一些动作。比较常见的用法有：输入文字时用<code>send_keys</code>方法，清空文字时用<code>clear</code>方法，点击按钮时用<code>click</code>方法。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">browser.get(<span class=\"string\">&#x27;https://www.taobao.com&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">input</span> = browser.find_element_by_id(<span class=\"string\">&#x27;q&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">input</span>.send_keys(<span class=\"string\">&#x27;apple&#x27;</span>)</span><br><span class=\"line\">time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"built_in\">input</span>.clear()</span><br><span class=\"line\"><span class=\"built_in\">input</span>.send_keys(<span class=\"string\">&#x27;小米&#x27;</span>)</span><br><span class=\"line\">button = browser.find_element_by_class_name(<span class=\"string\">&#x27;btn-search&#x27;</span>)</span><br><span class=\"line\">button.click()</span><br></pre></td></tr></table></figure>\n\n<p>这里首先驱动浏览器打开淘宝，用<code>find_element_by_id</code>方法获取输入框，然后用<code>send_keys</code>方法输入<code>iPhone</code>文字，等待一秒后用<code>clear</code>方法清空输入框，接着再次调用<code>send_keys</code>方法输入<code>iPad</code>文字，之后再用<code>find_element_by_class_name</code>方法获取搜索按钮，最后调用<code>click</code>方法完成搜索动作。</p>\n<h3 id=\"动作链\"><a href=\"#动作链\" class=\"headerlink\" title=\"动作链\"></a>动作链</h3><p>在上面的实例中，一些交互动作都是针对某个节点执行的。比如，对于输入框，调用它的输入文字和清空文字方法；对于按钮，调用它的点击方法。其实，还有另外一些操作，它们没有特定的执行对象，比如鼠标拖拽、键盘按键等，这些动作用另一种方式来执行，那就是动作链。</p>\n<p>比如，现在要实现一个节点的拖拽操作，将某个节点从一处拖拽到另外一处，可以这样实现：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver <span class=\"keyword\">import</span> ActionChains</span><br><span class=\"line\"></span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">url = <span class=\"string\">&#x27;http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">browser.get(url)</span><br><span class=\"line\">browser.switch_to.frame(<span class=\"string\">&#x27;iframeResult&#x27;</span>)</span><br><span class=\"line\">source = browser.find_element_by_css_selector(<span class=\"string\">&quot;#draggable&quot;</span>)</span><br><span class=\"line\">target = browser.find_element_by_css_selector(<span class=\"string\">&quot;#droppable&quot;</span>)</span><br><span class=\"line\">actions = ActionChains(browser)</span><br><span class=\"line\">actions.drag_and_drop(source, target)</span><br><span class=\"line\">actions.perform()</span><br></pre></td></tr></table></figure>\n\n<p>打开网页中的一个拖拽实例，依次选中要拖拽的节点和拖拽到的目标节点，接着声明<code>ActionChains</code>对象并将其赋值为<code>actions</code>变量，然后通过调用<code>actions</code>变量的<code>drag_and_drop</code>方法，再调用<code>perform</code>方法执行动作，此时就完成了拖拽操作，如图所示：</p>\n<p><img src=\"Screenshot_7.webp\"></p>\n<p>拖拽前页面：</p>\n<p><img src=\"Screenshot_8.webp\"></p>\n<h3 id=\"执行执JavaScript\"><a href=\"#执行执JavaScript\" class=\"headerlink\" title=\"执行执JavaScript\"></a>执行执<code>JavaScript</code></h3><p><code>SeleniumAPI</code>并没有提供实现某些操作的方法，比如，下拉进度条。但它可以直接模拟运行<code>JavaScript</code>，此时使用<code>execute_script</code>方法即可实现，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">browser.get(<span class=\"string\">&#x27;https://www.zhihu.com/explore&#x27;</span>)</span><br><span class=\"line\">browser.execute_script(<span class=\"string\">&#x27;window.scrollTo(0, document.body.scrollHeight)&#x27;</span>)</span><br><span class=\"line\">browser.execute_script(<span class=\"string\">&#x27;alert(&quot; To Bottom)&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这里利用<code>execute_script</code>方法将进度条下拉到最底部，然后弹出<code>alert</code>提示框。</p>\n<p>有了这个方法，基本上<code>API</code>没有提供的所有功能都可以用执行<code>JavaScript</code>的方式来实现了。</p>\n<h2 id=\"获取节点信息\"><a href=\"#获取节点信息\" class=\"headerlink\" title=\"获取节点信息\"></a>获取节点信息</h2><p><code>Selenium</code>已经提供了选择节点的方法，并且返回的是<code>WebElement</code>类型，那么它也有相关的方法和属性来直接提取节点信息，如属性、文本等。这样的话，就可以不用通过解析源代码来提取信息了，非常方便。</p>\n<h3 id=\"获取属性\"><a href=\"#获取属性\" class=\"headerlink\" title=\"获取属性\"></a>获取属性</h3><p>可以使用<code>get_attribute</code>方法来获取节点的属性，但是前提是得先选中这个节点，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"></span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">url = <span class=\"string\">&#x27;https://www.baidu.com/&#x27;</span></span><br><span class=\"line\">browser.get(url)</span><br><span class=\"line\">logo = browser.find_element_by_class_name(<span class=\"string\">&#x27;index-logo-src&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(logo)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(logo.get_attribute(<span class=\"string\">&#x27;src&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<p>运行之后，程序便会驱动浏览器打开该页面，然后获取<code>class</code>为<code>logo-image</code>的节点，最后打印出它的<code>src</code>属性。</p>\n<p>返回结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;c90d6158ff9e3e6ba88d5f9b9358a358&quot;</span>, element=<span class=\"string\">&quot;c99170cd-b0c1-44b6-a0a0-f4ccf1105e91&quot;</span>)&gt;</span><br><span class=\"line\">https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png</span><br></pre></td></tr></table></figure>\n\n<p>通过<code>get_attribute</code>方法，只需要传入想要获取的属性名，就可以得到它的值了。</p>\n<h3 id=\"获取文本值\"><a href=\"#获取文本值\" class=\"headerlink\" title=\"获取文本值\"></a>获取文本值</h3><p>每个<code>WebElement</code>节点都有<code>text</code>属性，直接调用这个属性就可以得到节点内部的文本信息，这相当于<code>pyquery</code>的<code>text</code>方法，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"></span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">url = <span class=\"string\">&#x27;https://holychan.ltd/archives/&#x27;</span></span><br><span class=\"line\">browser.get(url)</span><br><span class=\"line\">title = browser.find_element_by_class_name(<span class=\"string\">&#x27;title-h2&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(title)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(title.text)</span><br></pre></td></tr></table></figure>\n\n<p>结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;79f97c0aa935723e276438a5fff2610c&quot;</span>, element=<span class=\"string\">&quot;b86ec344-cb00-4538-b9e9-8959a076bc75&quot;</span>)&gt;</span><br><span class=\"line\">文章归档</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"获取获ID、位置、标签名、大小\"><a href=\"#获取获ID、位置、标签名、大小\" class=\"headerlink\" title=\"获取获ID、位置、标签名、大小\"></a>获取获ID、位置、标签名、大小</h3><p><code>WebElement</code>节点还有一些其他属性，比如<code>id</code>属性可以获取节点<code>id</code>，<code>location</code>属性可以获取该节点在页面中的相对位置，<code>tag_name</code>属性可以获取标签名称，<code>size</code>属性可以获取节点的大小，也就是宽高，这些 属性有时候还是很有用的。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">browser = webdriver.Chrome() </span><br><span class=\"line\">url = <span class=\"string\">&#x27;https://dynamic2.scrape.cuiqingcai.com/&#x27;</span> </span><br><span class=\"line\">browser.get(url) </span><br><span class=\"line\"><span class=\"built_in\">input</span> = browser.find_element_by_class_name(<span class=\"string\">&#x27;logo-title&#x27;</span>) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">input</span>.<span class=\"built_in\">id</span>) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">input</span>.location) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">input</span>.tag_name) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">input</span>.size) </span><br></pre></td></tr></table></figure>\n\n<p>这里首先获得<code>class</code>为<code>logo-title</code>这个节点，然后调用其<code>id</code>、<code>location</code>、<code>tag_name</code>、<code>size</code>属性来获取对应的属性值。</p>\n<h2 id=\"切换Frame\"><a href=\"#切换Frame\" class=\"headerlink\" title=\"切换Frame\"></a>切换Frame</h2><p>网页中有一种节点叫作<code>iframe</code>，也就是子<code>Frame</code>，相当于页面的子页面，它的结构和外部网页的结构完全一致。<code>Selenium</code>打开页面后，默认是在父级<code>Frame</code>里面操作，而此时如果页面中还有子<code>Frame</code>，<code>Selenium</code>是不能获取到子<code>Frame</code>里面的节点的。这时就需要使用<code>switch_to.frame</code>方法来切换<code>Frame</code>。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.common.exceptions <span class=\"keyword\">import</span> NoSuchElementException</span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">url = <span class=\"string\">&#x27;http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable&#x27;</span></span><br><span class=\"line\">browser.get(url)</span><br><span class=\"line\">browser.switch_to(<span class=\"string\">&#x27;iframeResult&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    logo = browser.find_element_by_class_name(<span class=\"string\">&#x27;logo&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> NoSuchElementException:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;No logo found&#x27;</span>)</span><br><span class=\"line\">browser.switch_to.parent_frame()</span><br><span class=\"line\">logo = browser.find_element_by_class_name(<span class=\"string\">&#x27;logo&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(logo)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(logo.text)</span><br></pre></td></tr></table></figure>\n\n<p>控制台输出：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">No logo found</span><br><span class=\"line\">&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;ce74c2d83e0aca64c9ef8c4540b2fe16&quot;</span>, element=<span class=\"string\">&quot;1d2c3c25-bd01-4b9a-b11b-16b8534bf6c2&quot;</span>)&gt;</span><br><span class=\"line\">RUNOOB.COM</span><br></pre></td></tr></table></figure>\n\n<p>首先通过<code>switch_to.frame</code>方法切换到子<code>Frame</code>里面，然后尝试获取子<code>Frame</code>里的<code>logo</code>节点（这是不能找到的），如果找不到的话，就会抛出<code>NoSuchElementException</code>异常，异常被捕捉之后，就会输出<code>No logo found</code>。接下来，我们需要重新切换回父级<code>Frame</code>，然后再次重新获取节点，发现此时可以成功获取了。</p>\n<p>所以，当页面中包含子<code>Frame</code>时，如果想获取子<code>Frame</code>中的节点，需要先调用<code>switch_to.frame</code>方法切换到对应的<code>Frame</code>，然后再进行操作。</p>\n<h2 id=\"延时等待\"><a href=\"#延时等待\" class=\"headerlink\" title=\"延时等待\"></a>延时等待</h2><p>在<code>Selenium</code>中，<code>get</code>方法会在网页框架加载结束后结束执行，此时如果获取<code>page_source</code>，可能并不是浏览器完全加载完成的页面，如果某些页面有额外的<code>Ajax</code>请求，在网页源代码中也不一定能成功获取 \\到。所以，这里需要延时等待一定时间，确保节点已经加载出来。</p>\n<p>这里等待的方式有两种：一种是隐式等待，一种是显式等待。</p>\n<h3 id=\"隐式等待\"><a href=\"#隐式等待\" class=\"headerlink\" title=\"隐式等待\"></a>隐式等待</h3><p>当使用隐式等待执行测试的时候，如果<code>Selenium</code>没有在<code>DOM</code>中找到节点，将继续等待，超出设定时间后，则抛出找不到节点的异常。换句话说，隐式等待可以在我们查找节点而节点并没有立即出现的时候， 等待一段时间再查找<code>DOM</code>，默认的时间是<code>0</code>。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"></span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">browser.implicitly_wait(<span class=\"number\">10</span>)</span><br><span class=\"line\">browser.get(<span class=\"string\">&#x27;https://dynamic2. scrape.cuiqingcai.com/&#x27;</span>) </span><br><span class=\"line\"><span class=\"built_in\">input</span> = browser.find_element_by_class_name(<span class=\"string\">&#x27;logo-image&#x27;</span>) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">input</span>)</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<p>在很多情况下，<code>Ajax</code>请求的接口通常会包含加密的参数，如<code>token</code>、<code>sign</code>等，如：<a href=\"https://dynamic2.scrape.cuiqingcai.com/\">https://dynamic2.scrape.cuiqingcai.com/</a>，它的<code>Ajax</code>接口是包含一个<code>token</code>参数的，如图所示。</p>\n<p><img src=\"Screenshot_5.webp\"></p>\n<p>由于接口的请求加上了<code>token</code>参数，如果不深入分析并找到<code>token</code>的构造逻辑，是难以直接模拟这些<code>Ajax</code>请求的。</p>\n<p><code>Selenium</code>是一个自动化测试工具，利用它可以驱动浏览器执行特定的动作，如点击、下拉等操作，同时还可以获取浏览器当前呈现的页面源代码，做到可见即可爬。对于一些使用<code>JavaScript</code>动态渲染的页面来说，此种抓取方式非常有效。</p>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p>确保已经正确安装好了<code>Chrome</code>浏览器并配置好了<code>ChromeDriver</code>。另外，还需要正确安装好<code>Python</code>的<code>Selenium</code>库。</p>\n<h3 id=\"Selenium安装\"><a href=\"#Selenium安装\" class=\"headerlink\" title=\"Selenium安装\"></a>Selenium安装</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install selenium</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"chrome-driver安装\"><a href=\"#chrome-driver安装\" class=\"headerlink\" title=\"chrome driver安装\"></a>chrome driver安装</h3><p>查看安装的浏览器版本，在<code>chrome</code>搜索栏输入<code>chrome://version/</code>，会显示带当前浏览器的版本信息。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>在<a href=\"https://npm.taobao.org/mirrors/chromedriver/\">https://npm.taobao.org/mirrors/chromedriver/</a>下载对应版本的<code>chrome driver</code>，一定要对应，否则不能使用。</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>下载到本地后，将<code>chromedriver.exe</code>分别拷贝到<code>chrome.exe</code>和<code>python</code>安装路径下。</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<p><img src=\"Screenshot_4.webp\"></p>\n<p>以上，安装就完成了！</p>\n<h2 id=\"基本使用\"><a href=\"#基本使用\" class=\"headerlink\" title=\"基本使用\"></a>基本使用</h2><p>首先来看一下<code>Selenium</code>有一些怎样的功能。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.by <span class=\"keyword\">import</span> By</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.keys <span class=\"keyword\">import</span> Keys</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support <span class=\"keyword\">import</span> expected_conditions <span class=\"keyword\">as</span> EC</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support.wait <span class=\"keyword\">import</span> WebDriverWait</span><br><span class=\"line\"></span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    browser.get(<span class=\"string\">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">input</span> = browser.find_element_by_id(<span class=\"string\">&#x27;kw&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">input</span>.send_keys(<span class=\"string\">&#x27;Python&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">input</span>.send_keys(Keys.ENTER)</span><br><span class=\"line\">    wait = WebDriverWait(browser, <span class=\"number\">10</span>)</span><br><span class=\"line\">    wait.until(EC.presence_of_element_located((By.ID, <span class=\"string\">&#x27;content_left&#x27;</span>)))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(browser.current_url)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(browser.get_cookies())</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(browser.page_source)</span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">    browser.close()</span><br></pre></td></tr></table></figure>\n\n<p>运行代码后会自动弹出一个<code>Chrome</code>浏览器，浏览器会跳转到百度，然后在搜索框中输入<code>Python</code>，接着跳转到搜索结果页，如图所示。</p>\n<p><img src=\"Screenshot_6.webp\"></p>\n<p>此时在控制台的输出结果如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">href=&quot;http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_&quot; target=&quot;_blank&quot;&gt;你都用 &lt;em&gt;Python&lt;/em&gt; 来做什么? - 知乎&lt;/a&gt;&lt;/h3&gt;&lt;div class=&quot;c-row c-gap-top-small&quot;&gt;&lt;div class=&quot;general_image_pic c-span3&quot; style=&quot;position:relative;top:2px;&quot;&gt;&lt;a class=&quot;c-img c-img3 c-img-radius-large&quot; style=&quot;height:85px&quot; href=&quot;http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_&quot; target=&quot;_blank&quot;&gt;&lt;img class=&quot;c-img c-img3 c-img-radius-large&quot; src=&quot;https://dss1.bdstatic.com/6OF1bjeh1BF3odCf/it/u=958012630,1445793633&amp;amp;fm=218&amp;amp;app=92&amp;amp;f=JPEG?w=121&amp;amp;h=75&amp;amp;s=44A638725CB7469C82F4FFF40200D025&quot; style=&quot;height:85px;&quot;&gt;&lt;span class=&quot;c-img-border c-img-radius-large&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;&lt;div class=&quot;c-span9 c-span-last&quot;&gt;&lt;div class=&quot;c-abstract&quot;&gt;&lt;span class=&quot; newTimeFactor_before_abs c-color-gray2 m&quot;&gt;2019年10月17日&amp;nbsp;&lt;/span&gt;所有项目的代码和数据在Github:interesting-&lt;em&gt;python&lt;/em&gt; 如果你也想用&lt;em&gt;Python&lt;/em&gt;获取数据,进行有趣的 </span><br><span class=\"line\">数据分析,Alfred数据室应众多读者要求出品的《实战玩转&lt;em&gt;python&lt;/em&gt;爬虫》课程将会是你的好帮手...&lt;/div&gt;&lt;style&gt;.user-avatar &#123;</span><br><span class=\"line\">        display: flex;</span><br><span class=\"line\">        flex-direction: row;</span><br><span class=\"line\">        align-items: center;</span><br><span class=\"line\">        justify-content: flex-start;</span><br><span class=\"line\">&#125;&lt;/style&gt;&lt;div class=&quot;f13 c-gap-top-xsmall se_st_footer user-avatar&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_&quot; class=&quot;c-showurl c-color-gray&quot; style=&quot;text-decoration:none;position:relative;&quot;&gt;&lt;div class=&quot;c-img c-img-circle c-gap-right-xsmall&quot; style=&quot;display: inline-block;width: 16px;height: 16px;position: relative;top: 3px;vertical-align:top;&quot;&gt;&lt;span class=&quot;c-img-border c-img-source-border c-img-radius-large&quot;&gt;&lt;/span&gt;&lt;img src=&quot;https://ss0.baidu.com/6ONWsjip0QIZ8tyhnq/it/u=493147230,3096476255&amp;amp;fm=195&amp;amp;app=88&amp;amp;f=JPEG?w=200&amp;amp;h=200&quot;&gt;&lt;/div&gt;知乎&lt;/a&gt;&lt;div class=&quot;c-tools c-gap-left&quot; id=&quot;tools_9637258987948217910_8&quot; data-tools=&quot;&#123;&amp;quot;title&amp;quot;:&amp;quot;你都用 Python 来做什么? - 知乎&amp;quot;,&amp;quot;url&amp;quot;:&amp;quot;http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_&amp;quot;&#125;&quot;&gt;&lt;i class=&quot;c-icon f13&quot;&gt;&lt;/i&gt;&lt;/div&gt;&lt;span class=&quot;c-icons-outer&quot;&gt;&lt;span class=&quot;c-icons-inner&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;style&gt;.snapshoot, .snapshoot:visited &#123;</span><br><span class=\"line\">        color: #9195A3!important;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    .snapshoot:active, .snapshoot:hover &#123;</span><br><span class=\"line\">        color: #626675!important;</span><br><span class=\"line\">    &#125;&lt;/style&gt;&lt;a data-click=&quot;&#123;&#x27;rsv_snapshot&#x27;:&#x27;1&#x27;&#125;&quot; href=&quot;http://cache.baiducontent.com/c?m=JgFgeas2iHrh6pppvD-MHkvHPj9DsOz-wd718JIlv_IJy7d0KdQ2HvVIYznaRWwGrKHLEtVbqjR4uoZg6X_h4g62yFf5FgBVDUBkRfcWrOG&amp;amp;p=8b2a9715d9c647f904aec5344f57&amp;amp;newp=8b2a9729c5df1bb508e291784f4a92695d0fc20e3ad0d001298ffe0cc4241a1a1a3aecbf2c261600d7c279650aab4a5feff336743d0034f1f689df08d2ecce7e439b3b6e6a&amp;amp;s=45c48cce2e2d7fbd&amp;amp;user=baidu&amp;amp;fm=sc&amp;amp;query=Python&amp;amp;qid=dc4c1a0300139b42&amp;amp;p1=8&quot; target=&quot;_blank&quot; class=&quot;m c-gap-left c-color-gray kuaizhao snapshoot&quot;&gt;百度快照&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>\n\n<p>源代码过长，在此省略。可以看到，当前得到的<code>URL</code>、<code>Cookies</code>和源代码都是浏览器中的真实内容。所以说，如果用<code>Selenium</code>来驱动浏览器加载网页的话，就可以直接拿到<code>JavaScript</code>渲染的结果了，不用担心使用的是什么加密系统。</p>\n<p>了解一下<code>Selenium</code>的用法。</p>\n<h2 id=\"声明浏览器对象\"><a href=\"#声明浏览器对象\" class=\"headerlink\" title=\"声明浏览器对象\"></a>声明浏览器对象</h2><p><code>Selenium</code>支持非常多的浏览器，如<code>Chrome</code>、<code>Firefox</code>、<code>Edge</code>等，还有<code>Android</code>、<code>BlackBerry</code>等手机端的浏览器。</p>\n<p>可以用如下方式进行初始化：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">browser = webdriver.Firefox()</span><br><span class=\"line\">browser = webdriver.Edge()</span><br><span class=\"line\">browser = webdriver.Safari()</span><br></pre></td></tr></table></figure>\n\n<p>这样就完成了浏览器对象的初始化并将其赋值为<code>browser</code>对象。接下来，要做的就是调用<code>browser</code>对象，让其执行各个动作以模拟浏览器操作。</p>\n<h2 id=\"访问页面\"><a href=\"#访问页面\" class=\"headerlink\" title=\"访问页面\"></a>访问页面</h2><p>可以用<code>get</code>方法请求页面，只需要把参数传入连接<code>URL</code>即可。比如，这里用<code>get</code>方法访问淘宝，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">browser.get(<span class=\"string\">&#x27;https://www.taobao.com&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(browser.page_source)</span><br><span class=\"line\">browser.close()</span><br></pre></td></tr></table></figure>\n\n<p>运行后会弹出<code>Chrome</code>浏览器并且自动访问淘宝，然后控制台会输出淘宝页面的源代码，随后浏览器关闭。</p>\n<h2 id=\"查找节点\"><a href=\"#查找节点\" class=\"headerlink\" title=\"查找节点\"></a>查找节点</h2><p><code>Selenium</code>可以驱动浏览器完成各种操作，比如填充表单、模拟点击等。举个例子，当想要完成向某个输入框输入文字的操作时，首先需要知道这个输入框在哪，而 <code>Selenium</code>提供了一系列查找节点的方法，可以用这些方法来获取想要的节点，以便执行下一步动作或者提取信息。</p>\n<h3 id=\"单个节点\"><a href=\"#单个节点\" class=\"headerlink\" title=\"单个节点\"></a>单个节点</h3><p>想要从淘宝页面中提取搜索框这个节点，首先要观察它的源代码。</p>\n<p>可以发现，它的<code>id</code>是<code>q</code>，<code>name</code>也是<code>q</code>，此外还有许多其他属性。此时就可以用多种方式获取它了。比如，<code>find_element_by_name</code>代表根据<code>name</code>值获取，<code>find_element_by_id</code>则是根据<code>id</code>获取，另外，还有根据<code>XPath</code>、<code>CSS</code>选择器等获取的方式。</p>\n<p>这里使用<code>3</code>种方式获取输入框，分别是根据<code>id</code>、<code>CSS</code>选择器和<code>XPath</code>获取，它们返回的结果完全一致。运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;fbca625cd8bb4eb98ae76bb68a23bd4f&quot;</span>,element=<span class=\"string\">&quot;de630823-02d3-409a-ba19-4e892a0fad15&quot;</span>)&gt; </span><br><span class=\"line\">&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;fbca625cd8bb4eb98ae76bb68a23bd4f&quot;</span>, element=<span class=\"string\">&quot;de630823-02d3-409a-ba19-4e892a0fad15&quot;</span>)&gt; </span><br><span class=\"line\">[&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;fbca625cd8bb4eb98ae76bb68a23bd4f&quot;</span>, element=<span class=\"string\">&quot;de630823-02d3-409a-ba19-4e892a0fad15&quot;</span>)&gt;]</span><br></pre></td></tr></table></figure>\n\n<p>这3个节点的类型是一致的，都是<code>WebElement</code>。</p>\n<p>这里列出所有获取单个节点的方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find_element_by_id </span><br><span class=\"line\">find_element_by_name </span><br><span class=\"line\">find_element_by_xpath </span><br><span class=\"line\">find_element_by_link_text </span><br><span class=\"line\">find_element_by_partial_link_text </span><br><span class=\"line\">find_element_by_tag_name </span><br><span class=\"line\">find_element_by_class_name </span><br><span class=\"line\">find_element_by_css_selector</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"多个节点\"><a href=\"#多个节点\" class=\"headerlink\" title=\"多个节点\"></a>多个节点</h3><p>多如果在网页中只查找一个目标，那么完全可以用<code>find_element</code>方法。但如果有多个节点需要查找，再用<code>find_element</code>方法，就只能得到第1个节点了。如果要查找所有满足条件的节点，需要用<code>find_elements</code>这样的 方法。注意，在这个方法的名称中， 注<code>element</code>多了一个多<code>s</code>，注意区分。</p>\n<p>举个例子，假如要查找淘宝左侧导航条的所有条目，就可以这样来实现：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"></span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">browser.get(<span class=\"string\">&#x27;https://www.taobao.com&#x27;</span>)</span><br><span class=\"line\">lis = browser.find_elements_by_css_selector(<span class=\"string\">&#x27;.service-bd li&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(lis)</span><br><span class=\"line\">browser.close()</span><br></pre></td></tr></table></figure>\n\n<p>结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;01e78303-6103-4f1a-96dc-0386a755a9f4&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;7a4e764e-9a05-4dad-9188-636512591835&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;16219266-ff57-4f42-95ab-4b8dbb4b811a&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;4f23598b-3ca6-4b20-9192-3e06e98984df&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;d837e630-e546-4f8b-babd-e3fdc539d2a6&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;1da195c9-d959-4d47-b729-21d8eac2756f&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;175c2217-dbe6-4d27-997f-58fbe46cbf1a&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;4747359f-d93c-4a7a-976e-501087d96e5f&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;2537bb34-3a26-4ccd-8f53-4ebbef5c70b2&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;04210bc7-ebba-44ef-8757-d88dfd0d023f&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;7bd1b6e4-31e5-4120-8017-afc59ca56f48&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;930a7b6c-26ff-468c-896e-6204b0555747&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;81305b6e-0893-46d2-b7a7-89a85c00132c&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;763237aa-5925-426d-9a76-90b3567870eb&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class=\"string\">&quot;60ca3595-3f74-4f1d-9224-7beb9e381a4b&quot;</span>)&gt;]</span><br></pre></td></tr></table></figure>\n\n<p>得到的内容变成了列表类型，列表中的每个节点都是<code>WebElement</code>类型。</p>\n<p>也就是说，如果用<code>find_element</code>方法，只能获取匹配的第一个节点，结果是<code>WebElement</code>类型。如果用<code>find_elements</code>方法，则结果是列表类型，列表中的每个节点是<code>WebElement</code>类型。</p>\n<p>这里列出所有获取多个节点的方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find_elements_by_id</span><br><span class=\"line\">find_elements_by_name</span><br><span class=\"line\">find_elements_by_xpath</span><br><span class=\"line\">find_elements_by_link_text</span><br><span class=\"line\">find_elements_by_partial_link_text</span><br><span class=\"line\">find_elements_by_tag_name</span><br><span class=\"line\">find_elements_by_class_name</span><br><span class=\"line\">find_elements_by_css_selector</span><br></pre></td></tr></table></figure>\n\n<p>当然，也可以直接用<code>find_elements</code>方法来选择，这时可以这样写：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lis = browser.find_elements(By.CSS_SELECTOR, <span class=\"string\">&#x27;.service-bd li&#x27;</span>) </span><br></pre></td></tr></table></figure>\n\n<p>结果是完全一致的。</p>\n<h3 id=\"节点交互\"><a href=\"#节点交互\" class=\"headerlink\" title=\"节点交互\"></a>节点交互</h3><p><code>Selenium</code>可以驱动浏览器来执行一些操作，或者说可以让浏览器模拟执行一些动作。比较常见的用法有：输入文字时用<code>send_keys</code>方法，清空文字时用<code>clear</code>方法，点击按钮时用<code>click</code>方法。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">browser.get(<span class=\"string\">&#x27;https://www.taobao.com&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">input</span> = browser.find_element_by_id(<span class=\"string\">&#x27;q&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">input</span>.send_keys(<span class=\"string\">&#x27;apple&#x27;</span>)</span><br><span class=\"line\">time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"built_in\">input</span>.clear()</span><br><span class=\"line\"><span class=\"built_in\">input</span>.send_keys(<span class=\"string\">&#x27;小米&#x27;</span>)</span><br><span class=\"line\">button = browser.find_element_by_class_name(<span class=\"string\">&#x27;btn-search&#x27;</span>)</span><br><span class=\"line\">button.click()</span><br></pre></td></tr></table></figure>\n\n<p>这里首先驱动浏览器打开淘宝，用<code>find_element_by_id</code>方法获取输入框，然后用<code>send_keys</code>方法输入<code>iPhone</code>文字，等待一秒后用<code>clear</code>方法清空输入框，接着再次调用<code>send_keys</code>方法输入<code>iPad</code>文字，之后再用<code>find_element_by_class_name</code>方法获取搜索按钮，最后调用<code>click</code>方法完成搜索动作。</p>\n<h3 id=\"动作链\"><a href=\"#动作链\" class=\"headerlink\" title=\"动作链\"></a>动作链</h3><p>在上面的实例中，一些交互动作都是针对某个节点执行的。比如，对于输入框，调用它的输入文字和清空文字方法；对于按钮，调用它的点击方法。其实，还有另外一些操作，它们没有特定的执行对象，比如鼠标拖拽、键盘按键等，这些动作用另一种方式来执行，那就是动作链。</p>\n<p>比如，现在要实现一个节点的拖拽操作，将某个节点从一处拖拽到另外一处，可以这样实现：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver <span class=\"keyword\">import</span> ActionChains</span><br><span class=\"line\"></span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">url = <span class=\"string\">&#x27;http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">browser.get(url)</span><br><span class=\"line\">browser.switch_to.frame(<span class=\"string\">&#x27;iframeResult&#x27;</span>)</span><br><span class=\"line\">source = browser.find_element_by_css_selector(<span class=\"string\">&quot;#draggable&quot;</span>)</span><br><span class=\"line\">target = browser.find_element_by_css_selector(<span class=\"string\">&quot;#droppable&quot;</span>)</span><br><span class=\"line\">actions = ActionChains(browser)</span><br><span class=\"line\">actions.drag_and_drop(source, target)</span><br><span class=\"line\">actions.perform()</span><br></pre></td></tr></table></figure>\n\n<p>打开网页中的一个拖拽实例，依次选中要拖拽的节点和拖拽到的目标节点，接着声明<code>ActionChains</code>对象并将其赋值为<code>actions</code>变量，然后通过调用<code>actions</code>变量的<code>drag_and_drop</code>方法，再调用<code>perform</code>方法执行动作，此时就完成了拖拽操作，如图所示：</p>\n<p><img src=\"Screenshot_7.webp\"></p>\n<p>拖拽前页面：</p>\n<p><img src=\"Screenshot_8.webp\"></p>\n<h3 id=\"执行执JavaScript\"><a href=\"#执行执JavaScript\" class=\"headerlink\" title=\"执行执JavaScript\"></a>执行执<code>JavaScript</code></h3><p><code>SeleniumAPI</code>并没有提供实现某些操作的方法，比如，下拉进度条。但它可以直接模拟运行<code>JavaScript</code>，此时使用<code>execute_script</code>方法即可实现，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">browser.get(<span class=\"string\">&#x27;https://www.zhihu.com/explore&#x27;</span>)</span><br><span class=\"line\">browser.execute_script(<span class=\"string\">&#x27;window.scrollTo(0, document.body.scrollHeight)&#x27;</span>)</span><br><span class=\"line\">browser.execute_script(<span class=\"string\">&#x27;alert(&quot; To Bottom)&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这里利用<code>execute_script</code>方法将进度条下拉到最底部，然后弹出<code>alert</code>提示框。</p>\n<p>有了这个方法，基本上<code>API</code>没有提供的所有功能都可以用执行<code>JavaScript</code>的方式来实现了。</p>\n<h2 id=\"获取节点信息\"><a href=\"#获取节点信息\" class=\"headerlink\" title=\"获取节点信息\"></a>获取节点信息</h2><p><code>Selenium</code>已经提供了选择节点的方法，并且返回的是<code>WebElement</code>类型，那么它也有相关的方法和属性来直接提取节点信息，如属性、文本等。这样的话，就可以不用通过解析源代码来提取信息了，非常方便。</p>\n<h3 id=\"获取属性\"><a href=\"#获取属性\" class=\"headerlink\" title=\"获取属性\"></a>获取属性</h3><p>可以使用<code>get_attribute</code>方法来获取节点的属性，但是前提是得先选中这个节点，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"></span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">url = <span class=\"string\">&#x27;https://www.baidu.com/&#x27;</span></span><br><span class=\"line\">browser.get(url)</span><br><span class=\"line\">logo = browser.find_element_by_class_name(<span class=\"string\">&#x27;index-logo-src&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(logo)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(logo.get_attribute(<span class=\"string\">&#x27;src&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<p>运行之后，程序便会驱动浏览器打开该页面，然后获取<code>class</code>为<code>logo-image</code>的节点，最后打印出它的<code>src</code>属性。</p>\n<p>返回结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;c90d6158ff9e3e6ba88d5f9b9358a358&quot;</span>, element=<span class=\"string\">&quot;c99170cd-b0c1-44b6-a0a0-f4ccf1105e91&quot;</span>)&gt;</span><br><span class=\"line\">https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png</span><br></pre></td></tr></table></figure>\n\n<p>通过<code>get_attribute</code>方法，只需要传入想要获取的属性名，就可以得到它的值了。</p>\n<h3 id=\"获取文本值\"><a href=\"#获取文本值\" class=\"headerlink\" title=\"获取文本值\"></a>获取文本值</h3><p>每个<code>WebElement</code>节点都有<code>text</code>属性，直接调用这个属性就可以得到节点内部的文本信息，这相当于<code>pyquery</code>的<code>text</code>方法，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"></span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">url = <span class=\"string\">&#x27;https://holychan.ltd/archives/&#x27;</span></span><br><span class=\"line\">browser.get(url)</span><br><span class=\"line\">title = browser.find_element_by_class_name(<span class=\"string\">&#x27;title-h2&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(title)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(title.text)</span><br></pre></td></tr></table></figure>\n\n<p>结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;79f97c0aa935723e276438a5fff2610c&quot;</span>, element=<span class=\"string\">&quot;b86ec344-cb00-4538-b9e9-8959a076bc75&quot;</span>)&gt;</span><br><span class=\"line\">文章归档</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"获取获ID、位置、标签名、大小\"><a href=\"#获取获ID、位置、标签名、大小\" class=\"headerlink\" title=\"获取获ID、位置、标签名、大小\"></a>获取获ID、位置、标签名、大小</h3><p><code>WebElement</code>节点还有一些其他属性，比如<code>id</code>属性可以获取节点<code>id</code>，<code>location</code>属性可以获取该节点在页面中的相对位置，<code>tag_name</code>属性可以获取标签名称，<code>size</code>属性可以获取节点的大小，也就是宽高，这些 属性有时候还是很有用的。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">browser = webdriver.Chrome() </span><br><span class=\"line\">url = <span class=\"string\">&#x27;https://dynamic2.scrape.cuiqingcai.com/&#x27;</span> </span><br><span class=\"line\">browser.get(url) </span><br><span class=\"line\"><span class=\"built_in\">input</span> = browser.find_element_by_class_name(<span class=\"string\">&#x27;logo-title&#x27;</span>) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">input</span>.<span class=\"built_in\">id</span>) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">input</span>.location) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">input</span>.tag_name) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">input</span>.size) </span><br></pre></td></tr></table></figure>\n\n<p>这里首先获得<code>class</code>为<code>logo-title</code>这个节点，然后调用其<code>id</code>、<code>location</code>、<code>tag_name</code>、<code>size</code>属性来获取对应的属性值。</p>\n<h2 id=\"切换Frame\"><a href=\"#切换Frame\" class=\"headerlink\" title=\"切换Frame\"></a>切换Frame</h2><p>网页中有一种节点叫作<code>iframe</code>，也就是子<code>Frame</code>，相当于页面的子页面，它的结构和外部网页的结构完全一致。<code>Selenium</code>打开页面后，默认是在父级<code>Frame</code>里面操作，而此时如果页面中还有子<code>Frame</code>，<code>Selenium</code>是不能获取到子<code>Frame</code>里面的节点的。这时就需要使用<code>switch_to.frame</code>方法来切换<code>Frame</code>。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.common.exceptions <span class=\"keyword\">import</span> NoSuchElementException</span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">url = <span class=\"string\">&#x27;http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable&#x27;</span></span><br><span class=\"line\">browser.get(url)</span><br><span class=\"line\">browser.switch_to(<span class=\"string\">&#x27;iframeResult&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    logo = browser.find_element_by_class_name(<span class=\"string\">&#x27;logo&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> NoSuchElementException:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;No logo found&#x27;</span>)</span><br><span class=\"line\">browser.switch_to.parent_frame()</span><br><span class=\"line\">logo = browser.find_element_by_class_name(<span class=\"string\">&#x27;logo&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(logo)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(logo.text)</span><br></pre></td></tr></table></figure>\n\n<p>控制台输出：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">No logo found</span><br><span class=\"line\">&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class=\"string\">&quot;ce74c2d83e0aca64c9ef8c4540b2fe16&quot;</span>, element=<span class=\"string\">&quot;1d2c3c25-bd01-4b9a-b11b-16b8534bf6c2&quot;</span>)&gt;</span><br><span class=\"line\">RUNOOB.COM</span><br></pre></td></tr></table></figure>\n\n<p>首先通过<code>switch_to.frame</code>方法切换到子<code>Frame</code>里面，然后尝试获取子<code>Frame</code>里的<code>logo</code>节点（这是不能找到的），如果找不到的话，就会抛出<code>NoSuchElementException</code>异常，异常被捕捉之后，就会输出<code>No logo found</code>。接下来，我们需要重新切换回父级<code>Frame</code>，然后再次重新获取节点，发现此时可以成功获取了。</p>\n<p>所以，当页面中包含子<code>Frame</code>时，如果想获取子<code>Frame</code>中的节点，需要先调用<code>switch_to.frame</code>方法切换到对应的<code>Frame</code>，然后再进行操作。</p>\n<h2 id=\"延时等待\"><a href=\"#延时等待\" class=\"headerlink\" title=\"延时等待\"></a>延时等待</h2><p>在<code>Selenium</code>中，<code>get</code>方法会在网页框架加载结束后结束执行，此时如果获取<code>page_source</code>，可能并不是浏览器完全加载完成的页面，如果某些页面有额外的<code>Ajax</code>请求，在网页源代码中也不一定能成功获取 \\到。所以，这里需要延时等待一定时间，确保节点已经加载出来。</p>\n<p>这里等待的方式有两种：一种是隐式等待，一种是显式等待。</p>\n<h3 id=\"隐式等待\"><a href=\"#隐式等待\" class=\"headerlink\" title=\"隐式等待\"></a>隐式等待</h3><p>当使用隐式等待执行测试的时候，如果<code>Selenium</code>没有在<code>DOM</code>中找到节点，将继续等待，超出设定时间后，则抛出找不到节点的异常。换句话说，隐式等待可以在我们查找节点而节点并没有立即出现的时候， 等待一段时间再查找<code>DOM</code>，默认的时间是<code>0</code>。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"></span><br><span class=\"line\">browser = webdriver.Chrome()</span><br><span class=\"line\">browser.implicitly_wait(<span class=\"number\">10</span>)</span><br><span class=\"line\">browser.get(<span class=\"string\">&#x27;https://dynamic2. scrape.cuiqingcai.com/&#x27;</span>) </span><br><span class=\"line\"><span class=\"built_in\">input</span> = browser.find_element_by_class_name(<span class=\"string\">&#x27;logo-image&#x27;</span>) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">input</span>)</span><br></pre></td></tr></table></figure>\n\n"},{"title":"python多进程基本原理","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-17T12:04:49.000Z","pic":null,"_content":"\n## 多进程的含义\n\n多进程（`Process`）是具有一定独立功能的程序关于某个数据集合上的一次运行活动，是系统进行资源分配和调度的一个独立单位。\n\n顾名思义，多进程就是启用多个进程同时运行。由于进程是线程的集合，而且进程是由一个或多个线程构成的，所以多进程的运 行意味着有大于或等于进程数量的线程在运行。\n\n## Python多进程的优势\n\n由于进程中`GIL`的存在，`Python`中的多线程并不能很好地发挥多核优势，一个进程中的多个线程，在同一时刻只能有一个线程运行。\n\n对于多进程来说，每个进程都有属于自己的`GIL`，所以，在多核处理器下，多进程的运行是不会受`GIL`的影响的。因此，多进程能更好地发挥多核的优势。\n\n当然，对于爬虫这种`IO`密集型任务来说，多线程和多进程影响差别并不大。对于计算密集型任务来说，`Python`的多进程相比多线程，其多核运行效率会有成倍的提升。\n\n总的来说，`Python`的多进程整体来看是比多线程更有优势的。所以，在条件允许的情况下，能用多进程就尽量用多进程。\n\n不过值得注意的是，由于进程是系统进行资源分配和调度的一个独立单位，所以各个进程之间的数据是无法共享的，如多个进程无法共享一个全局变量，进程之间的数据共享需要有单独的机制来实现到。\n\n## 多进程的实现\n\n在`Python`中也有内置的库来实现多进程，它就是`multiprocessing`。\n\n`multiprocessing`提供了一系列的组件，如`Process（进程`、`Queue（队列）`、`Semaphore（信号量）`、`Pipe（管道）`、`Lock（锁）`、`Pool（进程池）`等，接下来让我们来了解下它们的使用方法。\n\n### 直接使用Process类\n\n在`multiprocessing`中，每一个进程都用一个`Process`类来表示。它的`API`调用如下：\n\n```python\nProcess([group [, target [, name [, args [, kwargs]]]]])\n```\n\n- `target`表示调用对象，你可以传入方法的名字。\n- `args`表示被调用对象的位置参数元组，比如`target`是函数`func`，他有两个参数`m`，`n`，那么`args`就传入`[m, n]`即可。\n- `kwargs`表示调用对象的字典。\n- `name`是别名，相当于给这个进程取一个名字。\n- `group`分组。\n  \n先用一个实例来感受一下：\n\n```python\nimport multiprocessing\n\ndef process(index):\n    print(f'process: {index}')\n\nif __name__ == '__main__':\n    for i in range(5):\n        p = multiprocessing.Process(target=process, args=(i,))\n        p.start()\n```\n\n这是一个实现多进程最基础的方式：通过创建`Process`来新建一个子进程，其中`target`参数传入方法名，`args`是方法的参数，是以 元组的形式传入，其和被调用的方法`process`的参数是一一对应的。\n\n> 注意：这里`args `必须要是一个元组，如果只有一个参数，那也要在元组第一个元素后面加一个逗号，如果没有逗号则和单个元素本身没有区别，无法构成元组，导致参数传递出现问题。\n\n创建完进程之后，我们通过调用`start`方法即可启动进程了。运行结果如下：\n\n```python\nprocess: 0\nprocess: 1\nprocess: 2\nprocess: 3\nprocess: 4\n```\n\n运行了`5`个子进程，每个进程都调用了`process`方法。`process`方法的`index`参数通过`Process`的`args`传入，分别是`0~4`这`5`个序号，最后打印出来，`5`个子进程运行结束。\n\n由于进程是`Python`中最小的资源分配单元，因此这些进程和线程不同，各个进程之间的数据是不会共享的，每启动一个进程，都会独立分配资源。\n\n在当前`CPU`核数足够的情况下，这些不同的进程会分配给不同的`CPU`核来运行，实现真正的并行执行。\n\n运行结果如下：\n\n```python\nCPU number: 4\nChild process name: Process-2 id: 12112\nChild process name: Process-3 id: 14708\nChild process name: Process-1 id: 11208\nChild process name: Process-5 id: 9968\nChild process name: Process-4 id: 11784\nProcess ended\nprocess: 0\nprocess: 1\nprocess: 2\nprocess: 3\nprocess: 4\n```\n\n通过`cpu_count`成功获取了`CPU`核心的数量：`4`个，不同的机器结果可能不同。通过 `active_children`获取到了当前正在活跃运行的进程列表。然后遍历每个进程，并将它们的*名称*和*进程号*打印出来了，这里进程号直接使用`pid`属性即可获取，进程名称直接通过`name`属性即可获取。\n\n## 继承继Process类\n\n在上面的例子中，创建进程是直接使用`Process`这个类来创建的，这是一种创建进程的方式。不过，创建进程的方式不止这一 种，同样，也可以像线程`Thread`一样来通过继承的方式创建一个进程类，进程的基本操作我们在子类的`run`方法中实现即可。\n\n通过一个实例来看一下：\n\n```python\nfrom multiprocessing import Process\nimport time\n\nclass MyProcess(Process):\n    def __init__(self, loop):\n        Process.__init__(self)\n        self.loop = loop\n\n    def run(self):\n        for count in range(self.loop):\n            time.sleep(1)\n            print(f'Pid: {self.pid} LoopCount: {count}')\n\nif __name__ == '__main__':\n    for i in range(2,5):\n        p = MyProcess(i)\n        p.start()\n```\n\n声明了一个构造方法，这个方法接收一个`loop`参数，代表循环次数，并将其设置为全局变量。在`run`方法中，又使用这个`loop`变量循环了`loop`次并打印了当前的进程号和循环次数。\n\n在调用时，用`range`方法得到了`2、3、4`三个数字，并把它们分别初始化了`MyProcess`进程，然后调用`start`方法将进程启动起来。\n\n> 注意：这里进程的执行逻辑需要在`run`方法中实现，启动进程需要调用`start`方法，调用之后`run`方法便会执行。\n\n运行结果如下：\n\n```python\nPid: 13728 LoopCount: 0\nPid: 13560 LoopCount: 0\nPid: 9908 LoopCount: 0 \nPid: 9908 LoopCount: 1\nPid: 13560 LoopCount: 1\nPid: 13728 LoopCount: 1\nPid: 13728 LoopCount: 2\nPid: 9908 LoopCount: 2\nPid: 13728 LoopCount: 3\n```\n\n三个进程分别打印出了`2、3、4`条结果，即进程`13560`打印了`2`次结果，进程`9908` 打印了`3`次结果，进程`13728`打印了`4`次结果。\n\n> 注意，这里的进程`pid`代表进程号，不同机器、不同时刻运行结果可能不同。 \n\n通过上面的方式，非常方便地实现了一个进程的定义。为了复用方便，可以把一些方法写在每个进程类里封装好，在使用时直接初始化一个进程类运行即可。\n\n## 守护进程\n\n在多进程中，同样存在守护进程的概念，如果一个进程被设置为守护进程，当父进程结束后，子进程会自动被终止，我们可以通过设置`daemon`属性来控制是否为守护进程。\n\n还是原来的例子，增加了`deamon`属性的设置：\n\n```python\nfrom multiprocessing import Process\nimport time\n\nclass MyProcess(Process):\n    def __init__(self, loop):\n        Process.__init__(self)\n        self.loop = loop\n\n    def run(self):\n        for count in range(self.loop):\n            time.sleep(1)\n            print(f'Pid: {self.pid} LoopCount: {count}')\n\nif __name__ == '__main__':\n    for i in range(2,5):\n        p = MyProcess(i)\n        p.daemon = True\n        p.start()\n    print('Main process is ended.')\n```\n\n运行结果如下：\n\n```python\nMain process is ended.\n```\n\n结果很简单，因为主进程没有做任何事情，直接输出一句话结束，所以在这时也直接终止了子进程的运行。\n\n这样可以有效防止无控制地生成子进程。这样的写法可以让我们在主进程运行结束后无需额外担心子进程是否关闭，避免了独立子进程的运行。\n\n## 进程等待\n\n上面的运行效果其实不太符合我们预期：主进程运行结束时，子进程（守护进程）也都退出了，子进程什么都没来得及执行。\n\n能不能让所有子进程都执行完了然后再结束呢？当然是可以的，只需要加入`join`方法即可，可以将代码改写如下：\n\n```python\n    process = []\n    for i in range(2,5):\n        p = MyProcess(i)\n        process.append(p)\n        p.daemon = True\n        p.start()\n    for p in process:\n        p.join()\n    print('Main process is ended.')\n```\n\n运行结果如下：\n\n```python\nPid: 13220 LoopCount: 0\nPid: 10488 LoopCount: 0\nPid: 4652 LoopCount: 0\nPid: 13220 LoopCount: 1\nPid: 10488 LoopCount: 1\nPid: 4652 LoopCount: 1\nPid: 10488 LoopCount: 2\nPid: 4652 LoopCount: 2\nPid: 4652 LoopCount: 3\nMain process is ended.\n```\n\n在调用`start`和`join`方法后，父进程就可以等待所有子进程都执行完毕后，再打印出结束的结果。\n\n默认情况下，`join`是无限期的。也就是说，如果有子进程没有运行完毕，主进程会一直等待。这种情况下，如果子进程出现问题陷入了死循环，主进程也会无限等待下去。怎么解决这个问题呢？可以给`join`方法传递一个超时参数，代表最长等待秒数。如果子进程没有在这个指定秒数之内完成，会被强制返回，主进程不再会等待。也就是说这个参数设置了主进程等待该子进程的最长时间。\n\n例如这里传入`1`，代表最长等待`1`秒，代码改写如下：\n\n```python\n    process = []\n    for i in range(2,5):\n        p = MyProcess(i)\n        process.append(p)\n        p.daemon = True\n        p.start()\n    for p in process:\n        p.join(1)\n```\n\n运行结果如下：\n\n```python\nPid: 11936 LoopCount: 0\nPid: 968 LoopCount: 0\nPid: 11572 LoopCount: 0\nPid: 11936 LoopCount: 1\nPid: 968 LoopCount: 1\nPid: 11572 LoopCount: 1\nMain process is ended.\n```\n\n可以看到，有的子进程本来要运行`3`秒，结果运行`1`秒就被强制返回了，由于是守护进程，该子进程被终止了。\n\n## 终止进程\n\n终止进程不止有守护进程这一种做法，我们也可以通过`terminate`方法来终止某个子进程，另外我们还可以通过`is_alive`方法判断进程是否还在运行。\n\n下面看一个实例：\n\n```python\nimport time\nimport multiprocessing\n\ndef process():\n    print('Starting')\n    time.sleep(5)\n    print('Finished')\n\nif __name__ == '__main__':\n    p = multiprocessing.Process(target=process)\n    print('Before:', p, p.is_alive())\n    \n    p.start()\n    print('During:', p, p.is_alive())\n\n    p.terminate()\n    print('Terminate:', p, p.is_alive())\n\n    p.join()\n    print('Joined:', p, p.is_alive())\n```\n\n用`Process`创建了一个进程，接着调用`start`方法启动这个进程，然后调用`terminate`方法将进程终止，最后调用`join`方法。\n\n另外，在进程运行不同的阶段，通过`is_alive`方法判断当前进程是否还在运行。\n\n运行结果如下：\n\n```python\nBefore: <Process(Process-1, initial)> False\nDuring: <Process(Process-1, started)> True\nTerminate: <Process(Process-1, started)> True       \nJoined: <Process(Process-1, stopped[SIGTERM])> False\n```\n\n这里有一个值得注意的地方，在调用`terminate`方法之后，我们用`is_alive`方法获取进程的状态发现依然还是运行状态。在调用`join`方法之后，`is_alive`方法获取进程的运行状态才变为终止状态。\n\n所以，在调用`terminate`方法之后，记得要调用一下`join`方法，这里调用`join`方法可以为进程提供时间来更新对象状态，用来反映出最终的进程终止效果。\n\n## 进程互斥锁\n\n```python\nfrom multiprocessing import Process, Lock\nimport time\n\nclass MyProcess(Process):\n    def __init__(self, loop, lock):\n        Process.__init__(self)\n        self.loop = loop\n        self.lock = lock\n    \n    def run(self):\n        for count in range(self.loop):\n            time.sleep(0.1)\n            self.lock.acquire()\n            print(f'Pid: {self.pid} LoopCount: {count}')\n            self.lock.release()\n\nif __name__ == '__main__':\n    lock = Lock()\n    for i in range(10, 15):\n        p = MyProcess(i, lock)\n        p.start()\n```\n\n在访问一些临界区资源时，使用`Lock`可以有效避免进程同时占用资源而导致的一些问题。\n\n## 信号量\n\n｀multiprocessing`库中的`Semaphore`来实现信号量，实现多个进程共享资源，同时限制可访问的进程数量。\n\n## 道管\n\n管道（`Pipe`）用来实现进程之间的通讯，管道可以是单向的，即`half-duplex`：一个进程负责发消息，另一个进程负责收消息；也可以是双向的`duplex`，即互相收发消息。 默认声明`Pipe`对象是双向管道，如果要创建单向管道，可以在初始化的时候传入`deplex`参数为`False`。\n\n```python\nfrom multiprocessing import Process, Pipe\n\nclass Consumer(Process):\n    def __init__(self, pipe):\n        Process.__init__(self)\n        self.pipe = pipe\n    \n    def run(self):\n        self.pipe.send('Cosumer Worlds')\n        print(f'Consumer Received: {self.pipe.recv()}')\n\nclass Producer(Process):\n    def __init__(self, pipe):\n        Process.__init__(self)\n        self.pipe = pipe\n    \n    def run(self):\n        print(f'Producer Received: {self.pipe.recv()}')\n        self.pipe.send('Producer Words')\n\nif __name__ == '__main__':\n    pipe = Pipe()\n    p = Producer(pipe[0])\n    c = Consumer(pipe[1])\n    p.daemon = c.daemon = True\n    p.start()\n    c.start()\n    p.join()\n    c.join()\n    print('Main Process Ended')\n```\n\n声明了一个默认为双向的管道，然后将管道的两端分别传给两个进程。两个进程互相收发。观察一下结果：\n\n```python\nProducer Received: Cosumer Worlds\nConsumer Received: Producer Words\nMain Process Ended\n```\n\n**管道**`Pipe`就像进程之间搭建的桥梁，利用它可以很方便地实现进程间通信。\n\n## 进程池\n\n> 假如现在我们遇到这么一个问题，我有`10000`个任务，每个任务需要启动一个进程来执行，并且一个进程运行完毕之后要紧接着 启动下一个进程，同时我还需要控制进程的并发数量，不能并发太高，不然`CPU`处理不过来（如果同时运行的进程能维持在一个 最高恒定值当然利用率是最高的）。\n\n那么我们该如何来实现这个需求呢？\n\n用`Process`和`Semaphore`可以实现，但是实现起来比较烦琐。这种需求在平时又是非常常见的。此时，我们就可以派上进程池了，即`multiprocessing`中的`Pool`。 `Pool`可以提供指定数量的进程，供用户调用，当有新的请求提交到`pool`中时，如果池还没有满，就会创建一个新的进程用来执行该请求；但如果池中的进程数已经达到规定最大值，那么该请求就会等待，直到池中有进程结束，才会创建新的进程来执行它。\n\n用一个实例来实现一下，代码如下：\n\n```python\nimport time\nfrom multiprocessing import Pool\n\ndef function(index):\n    print(f'Start process: {index}')\n    time.sleep(3)\n    print(f'End process {index}')\n\nif __name__ == '__main__':\n    pool = Pool(processes=3)\n    for i in range(4):\n        pool.apply_async(function, args=(i,))\n    print('Main Process started')\n    pool.close()\n    pool.join()\n    print('Main process ended')\n```\n\n声明了一个大小为`3`的进程池，通过`processes`参数来指定，如果不指定，那么会自动根据处理器内核来分配进程数。接着我们使用`apply_async`方法将进程添加进去，`args`可以用来传递参数。\n\n运行结果如下：\n\n```python\nMain Process started\nStart process: 0\nStart process: 1\nStart process: 2\nEnd process 0\nStart process: 3\nEnd process 1\nEnd process 2\nEnd process 3\nMain process ended\n```\n\n进程池大小为`3`，可以看到有`3`个进程同时执行，第4个进程在等待，在有进程运行完毕之后，第4个进程马上跟着运行，出现了如上的运行效果。\n\n最后，我们要记得调用`close`方法来关闭进程池，使其不再接受新的任务，然后调用`join`方法让主进程等待子进程的退出，等子进程运行完毕之后，主进程接着运行并结束。\n\n上面的写法多少有些烦琐，使用你进程池的`map`方法，可以将上述写法简化很多。\n\n`map`方法是怎么用的呢？第一个参数就是要启动的进程对应的执行方法，第`2`个参数是一个可迭代对象，其中的每个元素会被传递给这个执行方法。\n\n举个例子：现在有一个`list`，里面包含了很多`URL`，定义了一个方法用来抓取每个`URL`内容并解析，那么可以直接在`map`的第一个参数传入方法名，第`2`个参数传入`URL`数组。\n\n用一个实例来感受一下：\n\n```python\nfrom multiprocessing import Pool\nimport urllib.request\nimport urllib.error\n\ndef scrape(url):\n    try:\n        urllib.request.urlopen(url)\n        print(f'URL {url} scraped')\n    except (urllib.error.HTTPError, urllib.error.URLError):\n        print(f'URL {url} not scraped')\n\nif __name__ == '__main__':\n    pool = Pool(processes=3)\n    urls = [\n        'https://www.baidu.com',\n        'https://www.meituan.com',\n        'https://blog.csdn.net',\n        'https://xxxyxxx.net',\n    ]\n    pool.map(scrape, urls)\n    pool.close()\n```\n\n运行结果：\n\n```python\nURL https://www.baidu.com scraped\nURL https://xxxyxxx.net not scraped\nURL https://blog.csdn.net scraped\nURL https://www.meituan.com scraped\n```\n\n这样，就可以实现`3`个进程并行运行。不同的进程相互独立地输出了对应的爬取结果。\n","source":"_posts/python多进程基本原理.md","raw":"---\ntitle: python多进程基本原理\ntags:\n  - python\n  - multiprocessing\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-17 20:04:49\ncategories: Python\npic:\n---\n\n## 多进程的含义\n\n多进程（`Process`）是具有一定独立功能的程序关于某个数据集合上的一次运行活动，是系统进行资源分配和调度的一个独立单位。\n\n顾名思义，多进程就是启用多个进程同时运行。由于进程是线程的集合，而且进程是由一个或多个线程构成的，所以多进程的运 行意味着有大于或等于进程数量的线程在运行。\n\n## Python多进程的优势\n\n由于进程中`GIL`的存在，`Python`中的多线程并不能很好地发挥多核优势，一个进程中的多个线程，在同一时刻只能有一个线程运行。\n\n对于多进程来说，每个进程都有属于自己的`GIL`，所以，在多核处理器下，多进程的运行是不会受`GIL`的影响的。因此，多进程能更好地发挥多核的优势。\n\n当然，对于爬虫这种`IO`密集型任务来说，多线程和多进程影响差别并不大。对于计算密集型任务来说，`Python`的多进程相比多线程，其多核运行效率会有成倍的提升。\n\n总的来说，`Python`的多进程整体来看是比多线程更有优势的。所以，在条件允许的情况下，能用多进程就尽量用多进程。\n\n不过值得注意的是，由于进程是系统进行资源分配和调度的一个独立单位，所以各个进程之间的数据是无法共享的，如多个进程无法共享一个全局变量，进程之间的数据共享需要有单独的机制来实现到。\n\n## 多进程的实现\n\n在`Python`中也有内置的库来实现多进程，它就是`multiprocessing`。\n\n`multiprocessing`提供了一系列的组件，如`Process（进程`、`Queue（队列）`、`Semaphore（信号量）`、`Pipe（管道）`、`Lock（锁）`、`Pool（进程池）`等，接下来让我们来了解下它们的使用方法。\n\n### 直接使用Process类\n\n在`multiprocessing`中，每一个进程都用一个`Process`类来表示。它的`API`调用如下：\n\n```python\nProcess([group [, target [, name [, args [, kwargs]]]]])\n```\n\n- `target`表示调用对象，你可以传入方法的名字。\n- `args`表示被调用对象的位置参数元组，比如`target`是函数`func`，他有两个参数`m`，`n`，那么`args`就传入`[m, n]`即可。\n- `kwargs`表示调用对象的字典。\n- `name`是别名，相当于给这个进程取一个名字。\n- `group`分组。\n  \n先用一个实例来感受一下：\n\n```python\nimport multiprocessing\n\ndef process(index):\n    print(f'process: {index}')\n\nif __name__ == '__main__':\n    for i in range(5):\n        p = multiprocessing.Process(target=process, args=(i,))\n        p.start()\n```\n\n这是一个实现多进程最基础的方式：通过创建`Process`来新建一个子进程，其中`target`参数传入方法名，`args`是方法的参数，是以 元组的形式传入，其和被调用的方法`process`的参数是一一对应的。\n\n> 注意：这里`args `必须要是一个元组，如果只有一个参数，那也要在元组第一个元素后面加一个逗号，如果没有逗号则和单个元素本身没有区别，无法构成元组，导致参数传递出现问题。\n\n创建完进程之后，我们通过调用`start`方法即可启动进程了。运行结果如下：\n\n```python\nprocess: 0\nprocess: 1\nprocess: 2\nprocess: 3\nprocess: 4\n```\n\n运行了`5`个子进程，每个进程都调用了`process`方法。`process`方法的`index`参数通过`Process`的`args`传入，分别是`0~4`这`5`个序号，最后打印出来，`5`个子进程运行结束。\n\n由于进程是`Python`中最小的资源分配单元，因此这些进程和线程不同，各个进程之间的数据是不会共享的，每启动一个进程，都会独立分配资源。\n\n在当前`CPU`核数足够的情况下，这些不同的进程会分配给不同的`CPU`核来运行，实现真正的并行执行。\n\n运行结果如下：\n\n```python\nCPU number: 4\nChild process name: Process-2 id: 12112\nChild process name: Process-3 id: 14708\nChild process name: Process-1 id: 11208\nChild process name: Process-5 id: 9968\nChild process name: Process-4 id: 11784\nProcess ended\nprocess: 0\nprocess: 1\nprocess: 2\nprocess: 3\nprocess: 4\n```\n\n通过`cpu_count`成功获取了`CPU`核心的数量：`4`个，不同的机器结果可能不同。通过 `active_children`获取到了当前正在活跃运行的进程列表。然后遍历每个进程，并将它们的*名称*和*进程号*打印出来了，这里进程号直接使用`pid`属性即可获取，进程名称直接通过`name`属性即可获取。\n\n## 继承继Process类\n\n在上面的例子中，创建进程是直接使用`Process`这个类来创建的，这是一种创建进程的方式。不过，创建进程的方式不止这一 种，同样，也可以像线程`Thread`一样来通过继承的方式创建一个进程类，进程的基本操作我们在子类的`run`方法中实现即可。\n\n通过一个实例来看一下：\n\n```python\nfrom multiprocessing import Process\nimport time\n\nclass MyProcess(Process):\n    def __init__(self, loop):\n        Process.__init__(self)\n        self.loop = loop\n\n    def run(self):\n        for count in range(self.loop):\n            time.sleep(1)\n            print(f'Pid: {self.pid} LoopCount: {count}')\n\nif __name__ == '__main__':\n    for i in range(2,5):\n        p = MyProcess(i)\n        p.start()\n```\n\n声明了一个构造方法，这个方法接收一个`loop`参数，代表循环次数，并将其设置为全局变量。在`run`方法中，又使用这个`loop`变量循环了`loop`次并打印了当前的进程号和循环次数。\n\n在调用时，用`range`方法得到了`2、3、4`三个数字，并把它们分别初始化了`MyProcess`进程，然后调用`start`方法将进程启动起来。\n\n> 注意：这里进程的执行逻辑需要在`run`方法中实现，启动进程需要调用`start`方法，调用之后`run`方法便会执行。\n\n运行结果如下：\n\n```python\nPid: 13728 LoopCount: 0\nPid: 13560 LoopCount: 0\nPid: 9908 LoopCount: 0 \nPid: 9908 LoopCount: 1\nPid: 13560 LoopCount: 1\nPid: 13728 LoopCount: 1\nPid: 13728 LoopCount: 2\nPid: 9908 LoopCount: 2\nPid: 13728 LoopCount: 3\n```\n\n三个进程分别打印出了`2、3、4`条结果，即进程`13560`打印了`2`次结果，进程`9908` 打印了`3`次结果，进程`13728`打印了`4`次结果。\n\n> 注意，这里的进程`pid`代表进程号，不同机器、不同时刻运行结果可能不同。 \n\n通过上面的方式，非常方便地实现了一个进程的定义。为了复用方便，可以把一些方法写在每个进程类里封装好，在使用时直接初始化一个进程类运行即可。\n\n## 守护进程\n\n在多进程中，同样存在守护进程的概念，如果一个进程被设置为守护进程，当父进程结束后，子进程会自动被终止，我们可以通过设置`daemon`属性来控制是否为守护进程。\n\n还是原来的例子，增加了`deamon`属性的设置：\n\n```python\nfrom multiprocessing import Process\nimport time\n\nclass MyProcess(Process):\n    def __init__(self, loop):\n        Process.__init__(self)\n        self.loop = loop\n\n    def run(self):\n        for count in range(self.loop):\n            time.sleep(1)\n            print(f'Pid: {self.pid} LoopCount: {count}')\n\nif __name__ == '__main__':\n    for i in range(2,5):\n        p = MyProcess(i)\n        p.daemon = True\n        p.start()\n    print('Main process is ended.')\n```\n\n运行结果如下：\n\n```python\nMain process is ended.\n```\n\n结果很简单，因为主进程没有做任何事情，直接输出一句话结束，所以在这时也直接终止了子进程的运行。\n\n这样可以有效防止无控制地生成子进程。这样的写法可以让我们在主进程运行结束后无需额外担心子进程是否关闭，避免了独立子进程的运行。\n\n## 进程等待\n\n上面的运行效果其实不太符合我们预期：主进程运行结束时，子进程（守护进程）也都退出了，子进程什么都没来得及执行。\n\n能不能让所有子进程都执行完了然后再结束呢？当然是可以的，只需要加入`join`方法即可，可以将代码改写如下：\n\n```python\n    process = []\n    for i in range(2,5):\n        p = MyProcess(i)\n        process.append(p)\n        p.daemon = True\n        p.start()\n    for p in process:\n        p.join()\n    print('Main process is ended.')\n```\n\n运行结果如下：\n\n```python\nPid: 13220 LoopCount: 0\nPid: 10488 LoopCount: 0\nPid: 4652 LoopCount: 0\nPid: 13220 LoopCount: 1\nPid: 10488 LoopCount: 1\nPid: 4652 LoopCount: 1\nPid: 10488 LoopCount: 2\nPid: 4652 LoopCount: 2\nPid: 4652 LoopCount: 3\nMain process is ended.\n```\n\n在调用`start`和`join`方法后，父进程就可以等待所有子进程都执行完毕后，再打印出结束的结果。\n\n默认情况下，`join`是无限期的。也就是说，如果有子进程没有运行完毕，主进程会一直等待。这种情况下，如果子进程出现问题陷入了死循环，主进程也会无限等待下去。怎么解决这个问题呢？可以给`join`方法传递一个超时参数，代表最长等待秒数。如果子进程没有在这个指定秒数之内完成，会被强制返回，主进程不再会等待。也就是说这个参数设置了主进程等待该子进程的最长时间。\n\n例如这里传入`1`，代表最长等待`1`秒，代码改写如下：\n\n```python\n    process = []\n    for i in range(2,5):\n        p = MyProcess(i)\n        process.append(p)\n        p.daemon = True\n        p.start()\n    for p in process:\n        p.join(1)\n```\n\n运行结果如下：\n\n```python\nPid: 11936 LoopCount: 0\nPid: 968 LoopCount: 0\nPid: 11572 LoopCount: 0\nPid: 11936 LoopCount: 1\nPid: 968 LoopCount: 1\nPid: 11572 LoopCount: 1\nMain process is ended.\n```\n\n可以看到，有的子进程本来要运行`3`秒，结果运行`1`秒就被强制返回了，由于是守护进程，该子进程被终止了。\n\n## 终止进程\n\n终止进程不止有守护进程这一种做法，我们也可以通过`terminate`方法来终止某个子进程，另外我们还可以通过`is_alive`方法判断进程是否还在运行。\n\n下面看一个实例：\n\n```python\nimport time\nimport multiprocessing\n\ndef process():\n    print('Starting')\n    time.sleep(5)\n    print('Finished')\n\nif __name__ == '__main__':\n    p = multiprocessing.Process(target=process)\n    print('Before:', p, p.is_alive())\n    \n    p.start()\n    print('During:', p, p.is_alive())\n\n    p.terminate()\n    print('Terminate:', p, p.is_alive())\n\n    p.join()\n    print('Joined:', p, p.is_alive())\n```\n\n用`Process`创建了一个进程，接着调用`start`方法启动这个进程，然后调用`terminate`方法将进程终止，最后调用`join`方法。\n\n另外，在进程运行不同的阶段，通过`is_alive`方法判断当前进程是否还在运行。\n\n运行结果如下：\n\n```python\nBefore: <Process(Process-1, initial)> False\nDuring: <Process(Process-1, started)> True\nTerminate: <Process(Process-1, started)> True       \nJoined: <Process(Process-1, stopped[SIGTERM])> False\n```\n\n这里有一个值得注意的地方，在调用`terminate`方法之后，我们用`is_alive`方法获取进程的状态发现依然还是运行状态。在调用`join`方法之后，`is_alive`方法获取进程的运行状态才变为终止状态。\n\n所以，在调用`terminate`方法之后，记得要调用一下`join`方法，这里调用`join`方法可以为进程提供时间来更新对象状态，用来反映出最终的进程终止效果。\n\n## 进程互斥锁\n\n```python\nfrom multiprocessing import Process, Lock\nimport time\n\nclass MyProcess(Process):\n    def __init__(self, loop, lock):\n        Process.__init__(self)\n        self.loop = loop\n        self.lock = lock\n    \n    def run(self):\n        for count in range(self.loop):\n            time.sleep(0.1)\n            self.lock.acquire()\n            print(f'Pid: {self.pid} LoopCount: {count}')\n            self.lock.release()\n\nif __name__ == '__main__':\n    lock = Lock()\n    for i in range(10, 15):\n        p = MyProcess(i, lock)\n        p.start()\n```\n\n在访问一些临界区资源时，使用`Lock`可以有效避免进程同时占用资源而导致的一些问题。\n\n## 信号量\n\n｀multiprocessing`库中的`Semaphore`来实现信号量，实现多个进程共享资源，同时限制可访问的进程数量。\n\n## 道管\n\n管道（`Pipe`）用来实现进程之间的通讯，管道可以是单向的，即`half-duplex`：一个进程负责发消息，另一个进程负责收消息；也可以是双向的`duplex`，即互相收发消息。 默认声明`Pipe`对象是双向管道，如果要创建单向管道，可以在初始化的时候传入`deplex`参数为`False`。\n\n```python\nfrom multiprocessing import Process, Pipe\n\nclass Consumer(Process):\n    def __init__(self, pipe):\n        Process.__init__(self)\n        self.pipe = pipe\n    \n    def run(self):\n        self.pipe.send('Cosumer Worlds')\n        print(f'Consumer Received: {self.pipe.recv()}')\n\nclass Producer(Process):\n    def __init__(self, pipe):\n        Process.__init__(self)\n        self.pipe = pipe\n    \n    def run(self):\n        print(f'Producer Received: {self.pipe.recv()}')\n        self.pipe.send('Producer Words')\n\nif __name__ == '__main__':\n    pipe = Pipe()\n    p = Producer(pipe[0])\n    c = Consumer(pipe[1])\n    p.daemon = c.daemon = True\n    p.start()\n    c.start()\n    p.join()\n    c.join()\n    print('Main Process Ended')\n```\n\n声明了一个默认为双向的管道，然后将管道的两端分别传给两个进程。两个进程互相收发。观察一下结果：\n\n```python\nProducer Received: Cosumer Worlds\nConsumer Received: Producer Words\nMain Process Ended\n```\n\n**管道**`Pipe`就像进程之间搭建的桥梁，利用它可以很方便地实现进程间通信。\n\n## 进程池\n\n> 假如现在我们遇到这么一个问题，我有`10000`个任务，每个任务需要启动一个进程来执行，并且一个进程运行完毕之后要紧接着 启动下一个进程，同时我还需要控制进程的并发数量，不能并发太高，不然`CPU`处理不过来（如果同时运行的进程能维持在一个 最高恒定值当然利用率是最高的）。\n\n那么我们该如何来实现这个需求呢？\n\n用`Process`和`Semaphore`可以实现，但是实现起来比较烦琐。这种需求在平时又是非常常见的。此时，我们就可以派上进程池了，即`multiprocessing`中的`Pool`。 `Pool`可以提供指定数量的进程，供用户调用，当有新的请求提交到`pool`中时，如果池还没有满，就会创建一个新的进程用来执行该请求；但如果池中的进程数已经达到规定最大值，那么该请求就会等待，直到池中有进程结束，才会创建新的进程来执行它。\n\n用一个实例来实现一下，代码如下：\n\n```python\nimport time\nfrom multiprocessing import Pool\n\ndef function(index):\n    print(f'Start process: {index}')\n    time.sleep(3)\n    print(f'End process {index}')\n\nif __name__ == '__main__':\n    pool = Pool(processes=3)\n    for i in range(4):\n        pool.apply_async(function, args=(i,))\n    print('Main Process started')\n    pool.close()\n    pool.join()\n    print('Main process ended')\n```\n\n声明了一个大小为`3`的进程池，通过`processes`参数来指定，如果不指定，那么会自动根据处理器内核来分配进程数。接着我们使用`apply_async`方法将进程添加进去，`args`可以用来传递参数。\n\n运行结果如下：\n\n```python\nMain Process started\nStart process: 0\nStart process: 1\nStart process: 2\nEnd process 0\nStart process: 3\nEnd process 1\nEnd process 2\nEnd process 3\nMain process ended\n```\n\n进程池大小为`3`，可以看到有`3`个进程同时执行，第4个进程在等待，在有进程运行完毕之后，第4个进程马上跟着运行，出现了如上的运行效果。\n\n最后，我们要记得调用`close`方法来关闭进程池，使其不再接受新的任务，然后调用`join`方法让主进程等待子进程的退出，等子进程运行完毕之后，主进程接着运行并结束。\n\n上面的写法多少有些烦琐，使用你进程池的`map`方法，可以将上述写法简化很多。\n\n`map`方法是怎么用的呢？第一个参数就是要启动的进程对应的执行方法，第`2`个参数是一个可迭代对象，其中的每个元素会被传递给这个执行方法。\n\n举个例子：现在有一个`list`，里面包含了很多`URL`，定义了一个方法用来抓取每个`URL`内容并解析，那么可以直接在`map`的第一个参数传入方法名，第`2`个参数传入`URL`数组。\n\n用一个实例来感受一下：\n\n```python\nfrom multiprocessing import Pool\nimport urllib.request\nimport urllib.error\n\ndef scrape(url):\n    try:\n        urllib.request.urlopen(url)\n        print(f'URL {url} scraped')\n    except (urllib.error.HTTPError, urllib.error.URLError):\n        print(f'URL {url} not scraped')\n\nif __name__ == '__main__':\n    pool = Pool(processes=3)\n    urls = [\n        'https://www.baidu.com',\n        'https://www.meituan.com',\n        'https://blog.csdn.net',\n        'https://xxxyxxx.net',\n    ]\n    pool.map(scrape, urls)\n    pool.close()\n```\n\n运行结果：\n\n```python\nURL https://www.baidu.com scraped\nURL https://xxxyxxx.net not scraped\nURL https://blog.csdn.net scraped\nURL https://www.meituan.com scraped\n```\n\n这样，就可以实现`3`个进程并行运行。不同的进程相互独立地输出了对应的爬取结果。\n","slug":"python多进程基本原理","published":1,"updated":"2021-06-15T03:24:11.492Z","layout":"post","photos":[],"link":"","_id":"ckq14rx3v007b44ud8c72avd1","content":"<h2 id=\"多进程的含义\"><a href=\"#多进程的含义\" class=\"headerlink\" title=\"多进程的含义\"></a>多进程的含义</h2><p>多进程（<code>Process</code>）是具有一定独立功能的程序关于某个数据集合上的一次运行活动，是系统进行资源分配和调度的一个独立单位。</p>\n<p>顾名思义，多进程就是启用多个进程同时运行。由于进程是线程的集合，而且进程是由一个或多个线程构成的，所以多进程的运 行意味着有大于或等于进程数量的线程在运行。</p>\n<h2 id=\"Python多进程的优势\"><a href=\"#Python多进程的优势\" class=\"headerlink\" title=\"Python多进程的优势\"></a>Python多进程的优势</h2><p>由于进程中<code>GIL</code>的存在，<code>Python</code>中的多线程并不能很好地发挥多核优势，一个进程中的多个线程，在同一时刻只能有一个线程运行。</p>\n<p>对于多进程来说，每个进程都有属于自己的<code>GIL</code>，所以，在多核处理器下，多进程的运行是不会受<code>GIL</code>的影响的。因此，多进程能更好地发挥多核的优势。</p>\n<p>当然，对于爬虫这种<code>IO</code>密集型任务来说，多线程和多进程影响差别并不大。对于计算密集型任务来说，<code>Python</code>的多进程相比多线程，其多核运行效率会有成倍的提升。</p>\n<p>总的来说，<code>Python</code>的多进程整体来看是比多线程更有优势的。所以，在条件允许的情况下，能用多进程就尽量用多进程。</p>\n<p>不过值得注意的是，由于进程是系统进行资源分配和调度的一个独立单位，所以各个进程之间的数据是无法共享的，如多个进程无法共享一个全局变量，进程之间的数据共享需要有单独的机制来实现到。</p>\n<h2 id=\"多进程的实现\"><a href=\"#多进程的实现\" class=\"headerlink\" title=\"多进程的实现\"></a>多进程的实现</h2><p>在<code>Python</code>中也有内置的库来实现多进程，它就是<code>multiprocessing</code>。</p>\n<p><code>multiprocessing</code>提供了一系列的组件，如<code>Process（进程</code>、<code>Queue（队列）</code>、<code>Semaphore（信号量）</code>、<code>Pipe（管道）</code>、<code>Lock（锁）</code>、<code>Pool（进程池）</code>等，接下来让我们来了解下它们的使用方法。</p>\n<h3 id=\"直接使用Process类\"><a href=\"#直接使用Process类\" class=\"headerlink\" title=\"直接使用Process类\"></a>直接使用Process类</h3><p>在<code>multiprocessing</code>中，每一个进程都用一个<code>Process</code>类来表示。它的<code>API</code>调用如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Process([group [, target [, name [, args [, kwargs]]]]])</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>target</code>表示调用对象，你可以传入方法的名字。</li>\n<li><code>args</code>表示被调用对象的位置参数元组，比如<code>target</code>是函数<code>func</code>，他有两个参数<code>m</code>，<code>n</code>，那么<code>args</code>就传入<code>[m, n]</code>即可。</li>\n<li><code>kwargs</code>表示调用对象的字典。</li>\n<li><code>name</code>是别名，相当于给这个进程取一个名字。</li>\n<li><code>group</code>分组。</li>\n</ul>\n<p>先用一个实例来感受一下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> multiprocessing</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">process</span>(<span class=\"params\">index</span>):</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;process: <span class=\"subst\">&#123;index&#125;</span>&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">5</span>):</span><br><span class=\"line\">        p = multiprocessing.Process(target=process, args=(i,))</span><br><span class=\"line\">        p.start()</span><br></pre></td></tr></table></figure>\n\n<p>这是一个实现多进程最基础的方式：通过创建<code>Process</code>来新建一个子进程，其中<code>target</code>参数传入方法名，<code>args</code>是方法的参数，是以 元组的形式传入，其和被调用的方法<code>process</code>的参数是一一对应的。</p>\n<blockquote>\n<p>注意：这里<code>args </code>必须要是一个元组，如果只有一个参数，那也要在元组第一个元素后面加一个逗号，如果没有逗号则和单个元素本身没有区别，无法构成元组，导致参数传递出现问题。</p>\n</blockquote>\n<p>创建完进程之后，我们通过调用<code>start</code>方法即可启动进程了。运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">process: <span class=\"number\">0</span></span><br><span class=\"line\">process: <span class=\"number\">1</span></span><br><span class=\"line\">process: <span class=\"number\">2</span></span><br><span class=\"line\">process: <span class=\"number\">3</span></span><br><span class=\"line\">process: <span class=\"number\">4</span></span><br></pre></td></tr></table></figure>\n\n<p>运行了<code>5</code>个子进程，每个进程都调用了<code>process</code>方法。<code>process</code>方法的<code>index</code>参数通过<code>Process</code>的<code>args</code>传入，分别是<code>0~4</code>这<code>5</code>个序号，最后打印出来，<code>5</code>个子进程运行结束。</p>\n<p>由于进程是<code>Python</code>中最小的资源分配单元，因此这些进程和线程不同，各个进程之间的数据是不会共享的，每启动一个进程，都会独立分配资源。</p>\n<p>在当前<code>CPU</code>核数足够的情况下，这些不同的进程会分配给不同的<code>CPU</code>核来运行，实现真正的并行执行。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CPU number: <span class=\"number\">4</span></span><br><span class=\"line\">Child process name: Process-<span class=\"number\">2</span> <span class=\"built_in\">id</span>: <span class=\"number\">12112</span></span><br><span class=\"line\">Child process name: Process-<span class=\"number\">3</span> <span class=\"built_in\">id</span>: <span class=\"number\">14708</span></span><br><span class=\"line\">Child process name: Process-<span class=\"number\">1</span> <span class=\"built_in\">id</span>: <span class=\"number\">11208</span></span><br><span class=\"line\">Child process name: Process-<span class=\"number\">5</span> <span class=\"built_in\">id</span>: <span class=\"number\">9968</span></span><br><span class=\"line\">Child process name: Process-<span class=\"number\">4</span> <span class=\"built_in\">id</span>: <span class=\"number\">11784</span></span><br><span class=\"line\">Process ended</span><br><span class=\"line\">process: <span class=\"number\">0</span></span><br><span class=\"line\">process: <span class=\"number\">1</span></span><br><span class=\"line\">process: <span class=\"number\">2</span></span><br><span class=\"line\">process: <span class=\"number\">3</span></span><br><span class=\"line\">process: <span class=\"number\">4</span></span><br></pre></td></tr></table></figure>\n\n<p>通过<code>cpu_count</code>成功获取了<code>CPU</code>核心的数量：<code>4</code>个，不同的机器结果可能不同。通过 <code>active_children</code>获取到了当前正在活跃运行的进程列表。然后遍历每个进程，并将它们的<em>名称</em>和<em>进程号</em>打印出来了，这里进程号直接使用<code>pid</code>属性即可获取，进程名称直接通过<code>name</code>属性即可获取。</p>\n<h2 id=\"继承继Process类\"><a href=\"#继承继Process类\" class=\"headerlink\" title=\"继承继Process类\"></a>继承继Process类</h2><p>在上面的例子中，创建进程是直接使用<code>Process</code>这个类来创建的，这是一种创建进程的方式。不过，创建进程的方式不止这一 种，同样，也可以像线程<code>Thread</code>一样来通过继承的方式创建一个进程类，进程的基本操作我们在子类的<code>run</code>方法中实现即可。</p>\n<p>通过一个实例来看一下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> multiprocessing <span class=\"keyword\">import</span> Process</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyProcess</span>(<span class=\"params\">Process</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, loop</span>):</span></span><br><span class=\"line\">        Process.__init__(self)</span><br><span class=\"line\">        self.loop = loop</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">run</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> count <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(self.loop):</span><br><span class=\"line\">            time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Pid: <span class=\"subst\">&#123;self.pid&#125;</span> LoopCount: <span class=\"subst\">&#123;count&#125;</span>&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">2</span>,<span class=\"number\">5</span>):</span><br><span class=\"line\">        p = MyProcess(i)</span><br><span class=\"line\">        p.start()</span><br></pre></td></tr></table></figure>\n\n<p>声明了一个构造方法，这个方法接收一个<code>loop</code>参数，代表循环次数，并将其设置为全局变量。在<code>run</code>方法中，又使用这个<code>loop</code>变量循环了<code>loop</code>次并打印了当前的进程号和循环次数。</p>\n<p>在调用时，用<code>range</code>方法得到了<code>2、3、4</code>三个数字，并把它们分别初始化了<code>MyProcess</code>进程，然后调用<code>start</code>方法将进程启动起来。</p>\n<blockquote>\n<p>注意：这里进程的执行逻辑需要在<code>run</code>方法中实现，启动进程需要调用<code>start</code>方法，调用之后<code>run</code>方法便会执行。</p>\n</blockquote>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Pid: <span class=\"number\">13728</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">13560</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">9908</span> LoopCount: <span class=\"number\">0</span> </span><br><span class=\"line\">Pid: <span class=\"number\">9908</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">13560</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">13728</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">13728</span> LoopCount: <span class=\"number\">2</span></span><br><span class=\"line\">Pid: <span class=\"number\">9908</span> LoopCount: <span class=\"number\">2</span></span><br><span class=\"line\">Pid: <span class=\"number\">13728</span> LoopCount: <span class=\"number\">3</span></span><br></pre></td></tr></table></figure>\n\n<p>三个进程分别打印出了<code>2、3、4</code>条结果，即进程<code>13560</code>打印了<code>2</code>次结果，进程<code>9908</code> 打印了<code>3</code>次结果，进程<code>13728</code>打印了<code>4</code>次结果。</p>\n<blockquote>\n<p>注意，这里的进程<code>pid</code>代表进程号，不同机器、不同时刻运行结果可能不同。 </p>\n</blockquote>\n<p>通过上面的方式，非常方便地实现了一个进程的定义。为了复用方便，可以把一些方法写在每个进程类里封装好，在使用时直接初始化一个进程类运行即可。</p>\n<h2 id=\"守护进程\"><a href=\"#守护进程\" class=\"headerlink\" title=\"守护进程\"></a>守护进程</h2><p>在多进程中，同样存在守护进程的概念，如果一个进程被设置为守护进程，当父进程结束后，子进程会自动被终止，我们可以通过设置<code>daemon</code>属性来控制是否为守护进程。</p>\n<p>还是原来的例子，增加了<code>deamon</code>属性的设置：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> multiprocessing <span class=\"keyword\">import</span> Process</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyProcess</span>(<span class=\"params\">Process</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, loop</span>):</span></span><br><span class=\"line\">        Process.__init__(self)</span><br><span class=\"line\">        self.loop = loop</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">run</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> count <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(self.loop):</span><br><span class=\"line\">            time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Pid: <span class=\"subst\">&#123;self.pid&#125;</span> LoopCount: <span class=\"subst\">&#123;count&#125;</span>&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">2</span>,<span class=\"number\">5</span>):</span><br><span class=\"line\">        p = MyProcess(i)</span><br><span class=\"line\">        p.daemon = <span class=\"literal\">True</span></span><br><span class=\"line\">        p.start()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Main process is ended.&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Main process <span class=\"keyword\">is</span> ended.</span><br></pre></td></tr></table></figure>\n\n<p>结果很简单，因为主进程没有做任何事情，直接输出一句话结束，所以在这时也直接终止了子进程的运行。</p>\n<p>这样可以有效防止无控制地生成子进程。这样的写法可以让我们在主进程运行结束后无需额外担心子进程是否关闭，避免了独立子进程的运行。</p>\n<h2 id=\"进程等待\"><a href=\"#进程等待\" class=\"headerlink\" title=\"进程等待\"></a>进程等待</h2><p>上面的运行效果其实不太符合我们预期：主进程运行结束时，子进程（守护进程）也都退出了，子进程什么都没来得及执行。</p>\n<p>能不能让所有子进程都执行完了然后再结束呢？当然是可以的，只需要加入<code>join</code>方法即可，可以将代码改写如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">process = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">2</span>,<span class=\"number\">5</span>):</span><br><span class=\"line\">    p = MyProcess(i)</span><br><span class=\"line\">    process.append(p)</span><br><span class=\"line\">    p.daemon = <span class=\"literal\">True</span></span><br><span class=\"line\">    p.start()</span><br><span class=\"line\"><span class=\"keyword\">for</span> p <span class=\"keyword\">in</span> process:</span><br><span class=\"line\">    p.join()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Main process is ended.&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Pid: <span class=\"number\">13220</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">10488</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">4652</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">13220</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">10488</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">4652</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">10488</span> LoopCount: <span class=\"number\">2</span></span><br><span class=\"line\">Pid: <span class=\"number\">4652</span> LoopCount: <span class=\"number\">2</span></span><br><span class=\"line\">Pid: <span class=\"number\">4652</span> LoopCount: <span class=\"number\">3</span></span><br><span class=\"line\">Main process <span class=\"keyword\">is</span> ended.</span><br></pre></td></tr></table></figure>\n\n<p>在调用<code>start</code>和<code>join</code>方法后，父进程就可以等待所有子进程都执行完毕后，再打印出结束的结果。</p>\n<p>默认情况下，<code>join</code>是无限期的。也就是说，如果有子进程没有运行完毕，主进程会一直等待。这种情况下，如果子进程出现问题陷入了死循环，主进程也会无限等待下去。怎么解决这个问题呢？可以给<code>join</code>方法传递一个超时参数，代表最长等待秒数。如果子进程没有在这个指定秒数之内完成，会被强制返回，主进程不再会等待。也就是说这个参数设置了主进程等待该子进程的最长时间。</p>\n<p>例如这里传入<code>1</code>，代表最长等待<code>1</code>秒，代码改写如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">process = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">2</span>,<span class=\"number\">5</span>):</span><br><span class=\"line\">    p = MyProcess(i)</span><br><span class=\"line\">    process.append(p)</span><br><span class=\"line\">    p.daemon = <span class=\"literal\">True</span></span><br><span class=\"line\">    p.start()</span><br><span class=\"line\"><span class=\"keyword\">for</span> p <span class=\"keyword\">in</span> process:</span><br><span class=\"line\">    p.join(<span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Pid: <span class=\"number\">11936</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">968</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">11572</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">11936</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">968</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">11572</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Main process <span class=\"keyword\">is</span> ended.</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，有的子进程本来要运行<code>3</code>秒，结果运行<code>1</code>秒就被强制返回了，由于是守护进程，该子进程被终止了。</p>\n<h2 id=\"终止进程\"><a href=\"#终止进程\" class=\"headerlink\" title=\"终止进程\"></a>终止进程</h2><p>终止进程不止有守护进程这一种做法，我们也可以通过<code>terminate</code>方法来终止某个子进程，另外我们还可以通过<code>is_alive</code>方法判断进程是否还在运行。</p>\n<p>下面看一个实例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> multiprocessing</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">process</span>():</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Starting&#x27;</span>)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">5</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Finished&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    p = multiprocessing.Process(target=process)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Before:&#x27;</span>, p, p.is_alive())</span><br><span class=\"line\">    </span><br><span class=\"line\">    p.start()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;During:&#x27;</span>, p, p.is_alive())</span><br><span class=\"line\"></span><br><span class=\"line\">    p.terminate()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Terminate:&#x27;</span>, p, p.is_alive())</span><br><span class=\"line\"></span><br><span class=\"line\">    p.join()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Joined:&#x27;</span>, p, p.is_alive())</span><br></pre></td></tr></table></figure>\n\n<p>用<code>Process</code>创建了一个进程，接着调用<code>start</code>方法启动这个进程，然后调用<code>terminate</code>方法将进程终止，最后调用<code>join</code>方法。</p>\n<p>另外，在进程运行不同的阶段，通过<code>is_alive</code>方法判断当前进程是否还在运行。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Before: &lt;Process(Process-<span class=\"number\">1</span>, initial)&gt; <span class=\"literal\">False</span></span><br><span class=\"line\">During: &lt;Process(Process-<span class=\"number\">1</span>, started)&gt; <span class=\"literal\">True</span></span><br><span class=\"line\">Terminate: &lt;Process(Process-<span class=\"number\">1</span>, started)&gt; <span class=\"literal\">True</span>       </span><br><span class=\"line\">Joined: &lt;Process(Process-<span class=\"number\">1</span>, stopped[SIGTERM])&gt; <span class=\"literal\">False</span></span><br></pre></td></tr></table></figure>\n\n<p>这里有一个值得注意的地方，在调用<code>terminate</code>方法之后，我们用<code>is_alive</code>方法获取进程的状态发现依然还是运行状态。在调用<code>join</code>方法之后，<code>is_alive</code>方法获取进程的运行状态才变为终止状态。</p>\n<p>所以，在调用<code>terminate</code>方法之后，记得要调用一下<code>join</code>方法，这里调用<code>join</code>方法可以为进程提供时间来更新对象状态，用来反映出最终的进程终止效果。</p>\n<h2 id=\"进程互斥锁\"><a href=\"#进程互斥锁\" class=\"headerlink\" title=\"进程互斥锁\"></a>进程互斥锁</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> multiprocessing <span class=\"keyword\">import</span> Process, Lock</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyProcess</span>(<span class=\"params\">Process</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, loop, lock</span>):</span></span><br><span class=\"line\">        Process.__init__(self)</span><br><span class=\"line\">        self.loop = loop</span><br><span class=\"line\">        self.lock = lock</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">run</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> count <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(self.loop):</span><br><span class=\"line\">            time.sleep(<span class=\"number\">0.1</span>)</span><br><span class=\"line\">            self.lock.acquire()</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Pid: <span class=\"subst\">&#123;self.pid&#125;</span> LoopCount: <span class=\"subst\">&#123;count&#125;</span>&#x27;</span>)</span><br><span class=\"line\">            self.lock.release()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    lock = Lock()</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>, <span class=\"number\">15</span>):</span><br><span class=\"line\">        p = MyProcess(i, lock)</span><br><span class=\"line\">        p.start()</span><br></pre></td></tr></table></figure>\n\n<p>在访问一些临界区资源时，使用<code>Lock</code>可以有效避免进程同时占用资源而导致的一些问题。</p>\n<h2 id=\"信号量\"><a href=\"#信号量\" class=\"headerlink\" title=\"信号量\"></a>信号量</h2><p>｀multiprocessing<code>库中的</code>Semaphore`来实现信号量，实现多个进程共享资源，同时限制可访问的进程数量。</p>\n<h2 id=\"道管\"><a href=\"#道管\" class=\"headerlink\" title=\"道管\"></a>道管</h2><p>管道（<code>Pipe</code>）用来实现进程之间的通讯，管道可以是单向的，即<code>half-duplex</code>：一个进程负责发消息，另一个进程负责收消息；也可以是双向的<code>duplex</code>，即互相收发消息。 默认声明<code>Pipe</code>对象是双向管道，如果要创建单向管道，可以在初始化的时候传入<code>deplex</code>参数为<code>False</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> multiprocessing <span class=\"keyword\">import</span> Process, Pipe</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Consumer</span>(<span class=\"params\">Process</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, pipe</span>):</span></span><br><span class=\"line\">        Process.__init__(self)</span><br><span class=\"line\">        self.pipe = pipe</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">run</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        self.pipe.send(<span class=\"string\">&#x27;Cosumer Worlds&#x27;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Consumer Received: <span class=\"subst\">&#123;self.pipe.recv()&#125;</span>&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Producer</span>(<span class=\"params\">Process</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, pipe</span>):</span></span><br><span class=\"line\">        Process.__init__(self)</span><br><span class=\"line\">        self.pipe = pipe</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">run</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Producer Received: <span class=\"subst\">&#123;self.pipe.recv()&#125;</span>&#x27;</span>)</span><br><span class=\"line\">        self.pipe.send(<span class=\"string\">&#x27;Producer Words&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    pipe = Pipe()</span><br><span class=\"line\">    p = Producer(pipe[<span class=\"number\">0</span>])</span><br><span class=\"line\">    c = Consumer(pipe[<span class=\"number\">1</span>])</span><br><span class=\"line\">    p.daemon = c.daemon = <span class=\"literal\">True</span></span><br><span class=\"line\">    p.start()</span><br><span class=\"line\">    c.start()</span><br><span class=\"line\">    p.join()</span><br><span class=\"line\">    c.join()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Main Process Ended&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>声明了一个默认为双向的管道，然后将管道的两端分别传给两个进程。两个进程互相收发。观察一下结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Producer Received: Cosumer Worlds</span><br><span class=\"line\">Consumer Received: Producer Words</span><br><span class=\"line\">Main Process Ended</span><br></pre></td></tr></table></figure>\n\n<p><strong>管道</strong><code>Pipe</code>就像进程之间搭建的桥梁，利用它可以很方便地实现进程间通信。</p>\n<h2 id=\"进程池\"><a href=\"#进程池\" class=\"headerlink\" title=\"进程池\"></a>进程池</h2><blockquote>\n<p>假如现在我们遇到这么一个问题，我有<code>10000</code>个任务，每个任务需要启动一个进程来执行，并且一个进程运行完毕之后要紧接着 启动下一个进程，同时我还需要控制进程的并发数量，不能并发太高，不然<code>CPU</code>处理不过来（如果同时运行的进程能维持在一个 最高恒定值当然利用率是最高的）。</p>\n</blockquote>\n<p>那么我们该如何来实现这个需求呢？</p>\n<p>用<code>Process</code>和<code>Semaphore</code>可以实现，但是实现起来比较烦琐。这种需求在平时又是非常常见的。此时，我们就可以派上进程池了，即<code>multiprocessing</code>中的<code>Pool</code>。 <code>Pool</code>可以提供指定数量的进程，供用户调用，当有新的请求提交到<code>pool</code>中时，如果池还没有满，就会创建一个新的进程用来执行该请求；但如果池中的进程数已经达到规定最大值，那么该请求就会等待，直到池中有进程结束，才会创建新的进程来执行它。</p>\n<p>用一个实例来实现一下，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">from</span> multiprocessing <span class=\"keyword\">import</span> Pool</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">function</span>(<span class=\"params\">index</span>):</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Start process: <span class=\"subst\">&#123;index&#125;</span>&#x27;</span>)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">3</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;End process <span class=\"subst\">&#123;index&#125;</span>&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    pool = Pool(processes=<span class=\"number\">3</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">4</span>):</span><br><span class=\"line\">        pool.apply_async(function, args=(i,))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Main Process started&#x27;</span>)</span><br><span class=\"line\">    pool.close()</span><br><span class=\"line\">    pool.join()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Main process ended&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>声明了一个大小为<code>3</code>的进程池，通过<code>processes</code>参数来指定，如果不指定，那么会自动根据处理器内核来分配进程数。接着我们使用<code>apply_async</code>方法将进程添加进去，<code>args</code>可以用来传递参数。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Main Process started</span><br><span class=\"line\">Start process: <span class=\"number\">0</span></span><br><span class=\"line\">Start process: <span class=\"number\">1</span></span><br><span class=\"line\">Start process: <span class=\"number\">2</span></span><br><span class=\"line\">End process <span class=\"number\">0</span></span><br><span class=\"line\">Start process: <span class=\"number\">3</span></span><br><span class=\"line\">End process <span class=\"number\">1</span></span><br><span class=\"line\">End process <span class=\"number\">2</span></span><br><span class=\"line\">End process <span class=\"number\">3</span></span><br><span class=\"line\">Main process ended</span><br></pre></td></tr></table></figure>\n\n<p>进程池大小为<code>3</code>，可以看到有<code>3</code>个进程同时执行，第4个进程在等待，在有进程运行完毕之后，第4个进程马上跟着运行，出现了如上的运行效果。</p>\n<p>最后，我们要记得调用<code>close</code>方法来关闭进程池，使其不再接受新的任务，然后调用<code>join</code>方法让主进程等待子进程的退出，等子进程运行完毕之后，主进程接着运行并结束。</p>\n<p>上面的写法多少有些烦琐，使用你进程池的<code>map</code>方法，可以将上述写法简化很多。</p>\n<p><code>map</code>方法是怎么用的呢？第一个参数就是要启动的进程对应的执行方法，第<code>2</code>个参数是一个可迭代对象，其中的每个元素会被传递给这个执行方法。</p>\n<p>举个例子：现在有一个<code>list</code>，里面包含了很多<code>URL</code>，定义了一个方法用来抓取每个<code>URL</code>内容并解析，那么可以直接在<code>map</code>的第一个参数传入方法名，第<code>2</code>个参数传入<code>URL</code>数组。</p>\n<p>用一个实例来感受一下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> multiprocessing <span class=\"keyword\">import</span> Pool</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.request</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.error</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scrape</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        urllib.request.urlopen(url)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;URL <span class=\"subst\">&#123;url&#125;</span> scraped&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> (urllib.error.HTTPError, urllib.error.URLError):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;URL <span class=\"subst\">&#123;url&#125;</span> not scraped&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    pool = Pool(processes=<span class=\"number\">3</span>)</span><br><span class=\"line\">    urls = [</span><br><span class=\"line\">        <span class=\"string\">&#x27;https://www.baidu.com&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;https://www.meituan.com&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;https://blog.csdn.net&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;https://xxxyxxx.net&#x27;</span>,</span><br><span class=\"line\">    ]</span><br><span class=\"line\">    pool.<span class=\"built_in\">map</span>(scrape, urls)</span><br><span class=\"line\">    pool.close()</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">URL https://www.baidu.com scraped</span><br><span class=\"line\">URL https://xxxyxxx.net <span class=\"keyword\">not</span> scraped</span><br><span class=\"line\">URL https://blog.csdn.net scraped</span><br><span class=\"line\">URL https://www.meituan.com scraped</span><br></pre></td></tr></table></figure>\n\n<p>这样，就可以实现<code>3</code>个进程并行运行。不同的进程相互独立地输出了对应的爬取结果。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"多进程的含义\"><a href=\"#多进程的含义\" class=\"headerlink\" title=\"多进程的含义\"></a>多进程的含义</h2><p>多进程（<code>Process</code>）是具有一定独立功能的程序关于某个数据集合上的一次运行活动，是系统进行资源分配和调度的一个独立单位。</p>\n<p>顾名思义，多进程就是启用多个进程同时运行。由于进程是线程的集合，而且进程是由一个或多个线程构成的，所以多进程的运 行意味着有大于或等于进程数量的线程在运行。</p>\n<h2 id=\"Python多进程的优势\"><a href=\"#Python多进程的优势\" class=\"headerlink\" title=\"Python多进程的优势\"></a>Python多进程的优势</h2><p>由于进程中<code>GIL</code>的存在，<code>Python</code>中的多线程并不能很好地发挥多核优势，一个进程中的多个线程，在同一时刻只能有一个线程运行。</p>\n<p>对于多进程来说，每个进程都有属于自己的<code>GIL</code>，所以，在多核处理器下，多进程的运行是不会受<code>GIL</code>的影响的。因此，多进程能更好地发挥多核的优势。</p>\n<p>当然，对于爬虫这种<code>IO</code>密集型任务来说，多线程和多进程影响差别并不大。对于计算密集型任务来说，<code>Python</code>的多进程相比多线程，其多核运行效率会有成倍的提升。</p>\n<p>总的来说，<code>Python</code>的多进程整体来看是比多线程更有优势的。所以，在条件允许的情况下，能用多进程就尽量用多进程。</p>\n<p>不过值得注意的是，由于进程是系统进行资源分配和调度的一个独立单位，所以各个进程之间的数据是无法共享的，如多个进程无法共享一个全局变量，进程之间的数据共享需要有单独的机制来实现到。</p>\n<h2 id=\"多进程的实现\"><a href=\"#多进程的实现\" class=\"headerlink\" title=\"多进程的实现\"></a>多进程的实现</h2><p>在<code>Python</code>中也有内置的库来实现多进程，它就是<code>multiprocessing</code>。</p>\n<p><code>multiprocessing</code>提供了一系列的组件，如<code>Process（进程</code>、<code>Queue（队列）</code>、<code>Semaphore（信号量）</code>、<code>Pipe（管道）</code>、<code>Lock（锁）</code>、<code>Pool（进程池）</code>等，接下来让我们来了解下它们的使用方法。</p>\n<h3 id=\"直接使用Process类\"><a href=\"#直接使用Process类\" class=\"headerlink\" title=\"直接使用Process类\"></a>直接使用Process类</h3><p>在<code>multiprocessing</code>中，每一个进程都用一个<code>Process</code>类来表示。它的<code>API</code>调用如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Process([group [, target [, name [, args [, kwargs]]]]])</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>target</code>表示调用对象，你可以传入方法的名字。</li>\n<li><code>args</code>表示被调用对象的位置参数元组，比如<code>target</code>是函数<code>func</code>，他有两个参数<code>m</code>，<code>n</code>，那么<code>args</code>就传入<code>[m, n]</code>即可。</li>\n<li><code>kwargs</code>表示调用对象的字典。</li>\n<li><code>name</code>是别名，相当于给这个进程取一个名字。</li>\n<li><code>group</code>分组。</li>\n</ul>\n<p>先用一个实例来感受一下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> multiprocessing</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">process</span>(<span class=\"params\">index</span>):</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;process: <span class=\"subst\">&#123;index&#125;</span>&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">5</span>):</span><br><span class=\"line\">        p = multiprocessing.Process(target=process, args=(i,))</span><br><span class=\"line\">        p.start()</span><br></pre></td></tr></table></figure>\n\n<p>这是一个实现多进程最基础的方式：通过创建<code>Process</code>来新建一个子进程，其中<code>target</code>参数传入方法名，<code>args</code>是方法的参数，是以 元组的形式传入，其和被调用的方法<code>process</code>的参数是一一对应的。</p>\n<blockquote>\n<p>注意：这里<code>args </code>必须要是一个元组，如果只有一个参数，那也要在元组第一个元素后面加一个逗号，如果没有逗号则和单个元素本身没有区别，无法构成元组，导致参数传递出现问题。</p>\n</blockquote>\n<p>创建完进程之后，我们通过调用<code>start</code>方法即可启动进程了。运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">process: <span class=\"number\">0</span></span><br><span class=\"line\">process: <span class=\"number\">1</span></span><br><span class=\"line\">process: <span class=\"number\">2</span></span><br><span class=\"line\">process: <span class=\"number\">3</span></span><br><span class=\"line\">process: <span class=\"number\">4</span></span><br></pre></td></tr></table></figure>\n\n<p>运行了<code>5</code>个子进程，每个进程都调用了<code>process</code>方法。<code>process</code>方法的<code>index</code>参数通过<code>Process</code>的<code>args</code>传入，分别是<code>0~4</code>这<code>5</code>个序号，最后打印出来，<code>5</code>个子进程运行结束。</p>\n<p>由于进程是<code>Python</code>中最小的资源分配单元，因此这些进程和线程不同，各个进程之间的数据是不会共享的，每启动一个进程，都会独立分配资源。</p>\n<p>在当前<code>CPU</code>核数足够的情况下，这些不同的进程会分配给不同的<code>CPU</code>核来运行，实现真正的并行执行。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CPU number: <span class=\"number\">4</span></span><br><span class=\"line\">Child process name: Process-<span class=\"number\">2</span> <span class=\"built_in\">id</span>: <span class=\"number\">12112</span></span><br><span class=\"line\">Child process name: Process-<span class=\"number\">3</span> <span class=\"built_in\">id</span>: <span class=\"number\">14708</span></span><br><span class=\"line\">Child process name: Process-<span class=\"number\">1</span> <span class=\"built_in\">id</span>: <span class=\"number\">11208</span></span><br><span class=\"line\">Child process name: Process-<span class=\"number\">5</span> <span class=\"built_in\">id</span>: <span class=\"number\">9968</span></span><br><span class=\"line\">Child process name: Process-<span class=\"number\">4</span> <span class=\"built_in\">id</span>: <span class=\"number\">11784</span></span><br><span class=\"line\">Process ended</span><br><span class=\"line\">process: <span class=\"number\">0</span></span><br><span class=\"line\">process: <span class=\"number\">1</span></span><br><span class=\"line\">process: <span class=\"number\">2</span></span><br><span class=\"line\">process: <span class=\"number\">3</span></span><br><span class=\"line\">process: <span class=\"number\">4</span></span><br></pre></td></tr></table></figure>\n\n<p>通过<code>cpu_count</code>成功获取了<code>CPU</code>核心的数量：<code>4</code>个，不同的机器结果可能不同。通过 <code>active_children</code>获取到了当前正在活跃运行的进程列表。然后遍历每个进程，并将它们的<em>名称</em>和<em>进程号</em>打印出来了，这里进程号直接使用<code>pid</code>属性即可获取，进程名称直接通过<code>name</code>属性即可获取。</p>\n<h2 id=\"继承继Process类\"><a href=\"#继承继Process类\" class=\"headerlink\" title=\"继承继Process类\"></a>继承继Process类</h2><p>在上面的例子中，创建进程是直接使用<code>Process</code>这个类来创建的，这是一种创建进程的方式。不过，创建进程的方式不止这一 种，同样，也可以像线程<code>Thread</code>一样来通过继承的方式创建一个进程类，进程的基本操作我们在子类的<code>run</code>方法中实现即可。</p>\n<p>通过一个实例来看一下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> multiprocessing <span class=\"keyword\">import</span> Process</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyProcess</span>(<span class=\"params\">Process</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, loop</span>):</span></span><br><span class=\"line\">        Process.__init__(self)</span><br><span class=\"line\">        self.loop = loop</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">run</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> count <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(self.loop):</span><br><span class=\"line\">            time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Pid: <span class=\"subst\">&#123;self.pid&#125;</span> LoopCount: <span class=\"subst\">&#123;count&#125;</span>&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">2</span>,<span class=\"number\">5</span>):</span><br><span class=\"line\">        p = MyProcess(i)</span><br><span class=\"line\">        p.start()</span><br></pre></td></tr></table></figure>\n\n<p>声明了一个构造方法，这个方法接收一个<code>loop</code>参数，代表循环次数，并将其设置为全局变量。在<code>run</code>方法中，又使用这个<code>loop</code>变量循环了<code>loop</code>次并打印了当前的进程号和循环次数。</p>\n<p>在调用时，用<code>range</code>方法得到了<code>2、3、4</code>三个数字，并把它们分别初始化了<code>MyProcess</code>进程，然后调用<code>start</code>方法将进程启动起来。</p>\n<blockquote>\n<p>注意：这里进程的执行逻辑需要在<code>run</code>方法中实现，启动进程需要调用<code>start</code>方法，调用之后<code>run</code>方法便会执行。</p>\n</blockquote>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Pid: <span class=\"number\">13728</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">13560</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">9908</span> LoopCount: <span class=\"number\">0</span> </span><br><span class=\"line\">Pid: <span class=\"number\">9908</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">13560</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">13728</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">13728</span> LoopCount: <span class=\"number\">2</span></span><br><span class=\"line\">Pid: <span class=\"number\">9908</span> LoopCount: <span class=\"number\">2</span></span><br><span class=\"line\">Pid: <span class=\"number\">13728</span> LoopCount: <span class=\"number\">3</span></span><br></pre></td></tr></table></figure>\n\n<p>三个进程分别打印出了<code>2、3、4</code>条结果，即进程<code>13560</code>打印了<code>2</code>次结果，进程<code>9908</code> 打印了<code>3</code>次结果，进程<code>13728</code>打印了<code>4</code>次结果。</p>\n<blockquote>\n<p>注意，这里的进程<code>pid</code>代表进程号，不同机器、不同时刻运行结果可能不同。 </p>\n</blockquote>\n<p>通过上面的方式，非常方便地实现了一个进程的定义。为了复用方便，可以把一些方法写在每个进程类里封装好，在使用时直接初始化一个进程类运行即可。</p>\n<h2 id=\"守护进程\"><a href=\"#守护进程\" class=\"headerlink\" title=\"守护进程\"></a>守护进程</h2><p>在多进程中，同样存在守护进程的概念，如果一个进程被设置为守护进程，当父进程结束后，子进程会自动被终止，我们可以通过设置<code>daemon</code>属性来控制是否为守护进程。</p>\n<p>还是原来的例子，增加了<code>deamon</code>属性的设置：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> multiprocessing <span class=\"keyword\">import</span> Process</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyProcess</span>(<span class=\"params\">Process</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, loop</span>):</span></span><br><span class=\"line\">        Process.__init__(self)</span><br><span class=\"line\">        self.loop = loop</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">run</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> count <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(self.loop):</span><br><span class=\"line\">            time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Pid: <span class=\"subst\">&#123;self.pid&#125;</span> LoopCount: <span class=\"subst\">&#123;count&#125;</span>&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">2</span>,<span class=\"number\">5</span>):</span><br><span class=\"line\">        p = MyProcess(i)</span><br><span class=\"line\">        p.daemon = <span class=\"literal\">True</span></span><br><span class=\"line\">        p.start()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Main process is ended.&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Main process <span class=\"keyword\">is</span> ended.</span><br></pre></td></tr></table></figure>\n\n<p>结果很简单，因为主进程没有做任何事情，直接输出一句话结束，所以在这时也直接终止了子进程的运行。</p>\n<p>这样可以有效防止无控制地生成子进程。这样的写法可以让我们在主进程运行结束后无需额外担心子进程是否关闭，避免了独立子进程的运行。</p>\n<h2 id=\"进程等待\"><a href=\"#进程等待\" class=\"headerlink\" title=\"进程等待\"></a>进程等待</h2><p>上面的运行效果其实不太符合我们预期：主进程运行结束时，子进程（守护进程）也都退出了，子进程什么都没来得及执行。</p>\n<p>能不能让所有子进程都执行完了然后再结束呢？当然是可以的，只需要加入<code>join</code>方法即可，可以将代码改写如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">process = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">2</span>,<span class=\"number\">5</span>):</span><br><span class=\"line\">    p = MyProcess(i)</span><br><span class=\"line\">    process.append(p)</span><br><span class=\"line\">    p.daemon = <span class=\"literal\">True</span></span><br><span class=\"line\">    p.start()</span><br><span class=\"line\"><span class=\"keyword\">for</span> p <span class=\"keyword\">in</span> process:</span><br><span class=\"line\">    p.join()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Main process is ended.&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Pid: <span class=\"number\">13220</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">10488</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">4652</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">13220</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">10488</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">4652</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">10488</span> LoopCount: <span class=\"number\">2</span></span><br><span class=\"line\">Pid: <span class=\"number\">4652</span> LoopCount: <span class=\"number\">2</span></span><br><span class=\"line\">Pid: <span class=\"number\">4652</span> LoopCount: <span class=\"number\">3</span></span><br><span class=\"line\">Main process <span class=\"keyword\">is</span> ended.</span><br></pre></td></tr></table></figure>\n\n<p>在调用<code>start</code>和<code>join</code>方法后，父进程就可以等待所有子进程都执行完毕后，再打印出结束的结果。</p>\n<p>默认情况下，<code>join</code>是无限期的。也就是说，如果有子进程没有运行完毕，主进程会一直等待。这种情况下，如果子进程出现问题陷入了死循环，主进程也会无限等待下去。怎么解决这个问题呢？可以给<code>join</code>方法传递一个超时参数，代表最长等待秒数。如果子进程没有在这个指定秒数之内完成，会被强制返回，主进程不再会等待。也就是说这个参数设置了主进程等待该子进程的最长时间。</p>\n<p>例如这里传入<code>1</code>，代表最长等待<code>1</code>秒，代码改写如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">process = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">2</span>,<span class=\"number\">5</span>):</span><br><span class=\"line\">    p = MyProcess(i)</span><br><span class=\"line\">    process.append(p)</span><br><span class=\"line\">    p.daemon = <span class=\"literal\">True</span></span><br><span class=\"line\">    p.start()</span><br><span class=\"line\"><span class=\"keyword\">for</span> p <span class=\"keyword\">in</span> process:</span><br><span class=\"line\">    p.join(<span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Pid: <span class=\"number\">11936</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">968</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">11572</span> LoopCount: <span class=\"number\">0</span></span><br><span class=\"line\">Pid: <span class=\"number\">11936</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">968</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Pid: <span class=\"number\">11572</span> LoopCount: <span class=\"number\">1</span></span><br><span class=\"line\">Main process <span class=\"keyword\">is</span> ended.</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，有的子进程本来要运行<code>3</code>秒，结果运行<code>1</code>秒就被强制返回了，由于是守护进程，该子进程被终止了。</p>\n<h2 id=\"终止进程\"><a href=\"#终止进程\" class=\"headerlink\" title=\"终止进程\"></a>终止进程</h2><p>终止进程不止有守护进程这一种做法，我们也可以通过<code>terminate</code>方法来终止某个子进程，另外我们还可以通过<code>is_alive</code>方法判断进程是否还在运行。</p>\n<p>下面看一个实例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> multiprocessing</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">process</span>():</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Starting&#x27;</span>)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">5</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Finished&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    p = multiprocessing.Process(target=process)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Before:&#x27;</span>, p, p.is_alive())</span><br><span class=\"line\">    </span><br><span class=\"line\">    p.start()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;During:&#x27;</span>, p, p.is_alive())</span><br><span class=\"line\"></span><br><span class=\"line\">    p.terminate()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Terminate:&#x27;</span>, p, p.is_alive())</span><br><span class=\"line\"></span><br><span class=\"line\">    p.join()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Joined:&#x27;</span>, p, p.is_alive())</span><br></pre></td></tr></table></figure>\n\n<p>用<code>Process</code>创建了一个进程，接着调用<code>start</code>方法启动这个进程，然后调用<code>terminate</code>方法将进程终止，最后调用<code>join</code>方法。</p>\n<p>另外，在进程运行不同的阶段，通过<code>is_alive</code>方法判断当前进程是否还在运行。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Before: &lt;Process(Process-<span class=\"number\">1</span>, initial)&gt; <span class=\"literal\">False</span></span><br><span class=\"line\">During: &lt;Process(Process-<span class=\"number\">1</span>, started)&gt; <span class=\"literal\">True</span></span><br><span class=\"line\">Terminate: &lt;Process(Process-<span class=\"number\">1</span>, started)&gt; <span class=\"literal\">True</span>       </span><br><span class=\"line\">Joined: &lt;Process(Process-<span class=\"number\">1</span>, stopped[SIGTERM])&gt; <span class=\"literal\">False</span></span><br></pre></td></tr></table></figure>\n\n<p>这里有一个值得注意的地方，在调用<code>terminate</code>方法之后，我们用<code>is_alive</code>方法获取进程的状态发现依然还是运行状态。在调用<code>join</code>方法之后，<code>is_alive</code>方法获取进程的运行状态才变为终止状态。</p>\n<p>所以，在调用<code>terminate</code>方法之后，记得要调用一下<code>join</code>方法，这里调用<code>join</code>方法可以为进程提供时间来更新对象状态，用来反映出最终的进程终止效果。</p>\n<h2 id=\"进程互斥锁\"><a href=\"#进程互斥锁\" class=\"headerlink\" title=\"进程互斥锁\"></a>进程互斥锁</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> multiprocessing <span class=\"keyword\">import</span> Process, Lock</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyProcess</span>(<span class=\"params\">Process</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, loop, lock</span>):</span></span><br><span class=\"line\">        Process.__init__(self)</span><br><span class=\"line\">        self.loop = loop</span><br><span class=\"line\">        self.lock = lock</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">run</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> count <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(self.loop):</span><br><span class=\"line\">            time.sleep(<span class=\"number\">0.1</span>)</span><br><span class=\"line\">            self.lock.acquire()</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Pid: <span class=\"subst\">&#123;self.pid&#125;</span> LoopCount: <span class=\"subst\">&#123;count&#125;</span>&#x27;</span>)</span><br><span class=\"line\">            self.lock.release()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    lock = Lock()</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>, <span class=\"number\">15</span>):</span><br><span class=\"line\">        p = MyProcess(i, lock)</span><br><span class=\"line\">        p.start()</span><br></pre></td></tr></table></figure>\n\n<p>在访问一些临界区资源时，使用<code>Lock</code>可以有效避免进程同时占用资源而导致的一些问题。</p>\n<h2 id=\"信号量\"><a href=\"#信号量\" class=\"headerlink\" title=\"信号量\"></a>信号量</h2><p>｀multiprocessing<code>库中的</code>Semaphore`来实现信号量，实现多个进程共享资源，同时限制可访问的进程数量。</p>\n<h2 id=\"道管\"><a href=\"#道管\" class=\"headerlink\" title=\"道管\"></a>道管</h2><p>管道（<code>Pipe</code>）用来实现进程之间的通讯，管道可以是单向的，即<code>half-duplex</code>：一个进程负责发消息，另一个进程负责收消息；也可以是双向的<code>duplex</code>，即互相收发消息。 默认声明<code>Pipe</code>对象是双向管道，如果要创建单向管道，可以在初始化的时候传入<code>deplex</code>参数为<code>False</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> multiprocessing <span class=\"keyword\">import</span> Process, Pipe</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Consumer</span>(<span class=\"params\">Process</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, pipe</span>):</span></span><br><span class=\"line\">        Process.__init__(self)</span><br><span class=\"line\">        self.pipe = pipe</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">run</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        self.pipe.send(<span class=\"string\">&#x27;Cosumer Worlds&#x27;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Consumer Received: <span class=\"subst\">&#123;self.pipe.recv()&#125;</span>&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Producer</span>(<span class=\"params\">Process</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, pipe</span>):</span></span><br><span class=\"line\">        Process.__init__(self)</span><br><span class=\"line\">        self.pipe = pipe</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">run</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Producer Received: <span class=\"subst\">&#123;self.pipe.recv()&#125;</span>&#x27;</span>)</span><br><span class=\"line\">        self.pipe.send(<span class=\"string\">&#x27;Producer Words&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    pipe = Pipe()</span><br><span class=\"line\">    p = Producer(pipe[<span class=\"number\">0</span>])</span><br><span class=\"line\">    c = Consumer(pipe[<span class=\"number\">1</span>])</span><br><span class=\"line\">    p.daemon = c.daemon = <span class=\"literal\">True</span></span><br><span class=\"line\">    p.start()</span><br><span class=\"line\">    c.start()</span><br><span class=\"line\">    p.join()</span><br><span class=\"line\">    c.join()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Main Process Ended&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>声明了一个默认为双向的管道，然后将管道的两端分别传给两个进程。两个进程互相收发。观察一下结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Producer Received: Cosumer Worlds</span><br><span class=\"line\">Consumer Received: Producer Words</span><br><span class=\"line\">Main Process Ended</span><br></pre></td></tr></table></figure>\n\n<p><strong>管道</strong><code>Pipe</code>就像进程之间搭建的桥梁，利用它可以很方便地实现进程间通信。</p>\n<h2 id=\"进程池\"><a href=\"#进程池\" class=\"headerlink\" title=\"进程池\"></a>进程池</h2><blockquote>\n<p>假如现在我们遇到这么一个问题，我有<code>10000</code>个任务，每个任务需要启动一个进程来执行，并且一个进程运行完毕之后要紧接着 启动下一个进程，同时我还需要控制进程的并发数量，不能并发太高，不然<code>CPU</code>处理不过来（如果同时运行的进程能维持在一个 最高恒定值当然利用率是最高的）。</p>\n</blockquote>\n<p>那么我们该如何来实现这个需求呢？</p>\n<p>用<code>Process</code>和<code>Semaphore</code>可以实现，但是实现起来比较烦琐。这种需求在平时又是非常常见的。此时，我们就可以派上进程池了，即<code>multiprocessing</code>中的<code>Pool</code>。 <code>Pool</code>可以提供指定数量的进程，供用户调用，当有新的请求提交到<code>pool</code>中时，如果池还没有满，就会创建一个新的进程用来执行该请求；但如果池中的进程数已经达到规定最大值，那么该请求就会等待，直到池中有进程结束，才会创建新的进程来执行它。</p>\n<p>用一个实例来实现一下，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">from</span> multiprocessing <span class=\"keyword\">import</span> Pool</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">function</span>(<span class=\"params\">index</span>):</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Start process: <span class=\"subst\">&#123;index&#125;</span>&#x27;</span>)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">3</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;End process <span class=\"subst\">&#123;index&#125;</span>&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    pool = Pool(processes=<span class=\"number\">3</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">4</span>):</span><br><span class=\"line\">        pool.apply_async(function, args=(i,))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Main Process started&#x27;</span>)</span><br><span class=\"line\">    pool.close()</span><br><span class=\"line\">    pool.join()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Main process ended&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>声明了一个大小为<code>3</code>的进程池，通过<code>processes</code>参数来指定，如果不指定，那么会自动根据处理器内核来分配进程数。接着我们使用<code>apply_async</code>方法将进程添加进去，<code>args</code>可以用来传递参数。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Main Process started</span><br><span class=\"line\">Start process: <span class=\"number\">0</span></span><br><span class=\"line\">Start process: <span class=\"number\">1</span></span><br><span class=\"line\">Start process: <span class=\"number\">2</span></span><br><span class=\"line\">End process <span class=\"number\">0</span></span><br><span class=\"line\">Start process: <span class=\"number\">3</span></span><br><span class=\"line\">End process <span class=\"number\">1</span></span><br><span class=\"line\">End process <span class=\"number\">2</span></span><br><span class=\"line\">End process <span class=\"number\">3</span></span><br><span class=\"line\">Main process ended</span><br></pre></td></tr></table></figure>\n\n<p>进程池大小为<code>3</code>，可以看到有<code>3</code>个进程同时执行，第4个进程在等待，在有进程运行完毕之后，第4个进程马上跟着运行，出现了如上的运行效果。</p>\n<p>最后，我们要记得调用<code>close</code>方法来关闭进程池，使其不再接受新的任务，然后调用<code>join</code>方法让主进程等待子进程的退出，等子进程运行完毕之后，主进程接着运行并结束。</p>\n<p>上面的写法多少有些烦琐，使用你进程池的<code>map</code>方法，可以将上述写法简化很多。</p>\n<p><code>map</code>方法是怎么用的呢？第一个参数就是要启动的进程对应的执行方法，第<code>2</code>个参数是一个可迭代对象，其中的每个元素会被传递给这个执行方法。</p>\n<p>举个例子：现在有一个<code>list</code>，里面包含了很多<code>URL</code>，定义了一个方法用来抓取每个<code>URL</code>内容并解析，那么可以直接在<code>map</code>的第一个参数传入方法名，第<code>2</code>个参数传入<code>URL</code>数组。</p>\n<p>用一个实例来感受一下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> multiprocessing <span class=\"keyword\">import</span> Pool</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.request</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.error</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scrape</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        urllib.request.urlopen(url)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;URL <span class=\"subst\">&#123;url&#125;</span> scraped&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> (urllib.error.HTTPError, urllib.error.URLError):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;URL <span class=\"subst\">&#123;url&#125;</span> not scraped&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    pool = Pool(processes=<span class=\"number\">3</span>)</span><br><span class=\"line\">    urls = [</span><br><span class=\"line\">        <span class=\"string\">&#x27;https://www.baidu.com&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;https://www.meituan.com&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;https://blog.csdn.net&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;https://xxxyxxx.net&#x27;</span>,</span><br><span class=\"line\">    ]</span><br><span class=\"line\">    pool.<span class=\"built_in\">map</span>(scrape, urls)</span><br><span class=\"line\">    pool.close()</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">URL https://www.baidu.com scraped</span><br><span class=\"line\">URL https://xxxyxxx.net <span class=\"keyword\">not</span> scraped</span><br><span class=\"line\">URL https://blog.csdn.net scraped</span><br><span class=\"line\">URL https://www.meituan.com scraped</span><br></pre></td></tr></table></figure>\n\n<p>这样，就可以实现<code>3</code>个进程并行运行。不同的进程相互独立地输出了对应的爬取结果。</p>\n"},{"title":"requests库的基本使用","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-18T07:44:10.000Z","pic":null,"_content":"\n## 安装\n\n`requests`是一个第三方库，使用`pip`下载安装。\n\n```python\npip3 install requests\n```\n\n## 实例引入\n\n用`Python`写爬虫的第一步就是模拟发起一个请求，把网页的源代码获取下来。\n\n在浏览器中输入一个`URL`并回车，实际上就是让浏览器帮我们发起一个`GET`类型的`HTTP`请求，浏览器得到源代码后，把它渲染出来就可以看到网页内容了。\n\n那如果想用`requests`来获取源代码，应该怎么办呢？很简单，`requests`这个库提供了一个`get`方法，调用这个方法，并传入对应的`URL`就能得到网页的源代码。\n\n比如这里有一个示例网站:[https://static1.scrape.cuiqingcai.com/](https://static1.scrape.cuiqingcai.com/)，其内容如下：\n\n![示列网站](Screenshot_2.webp)\n\n这个网站展示了一些电影数据，如果想要把这个网页里面的数据爬下来，比如获取各个电影的名称、上映时间等信息，然后把它存下来的话，该怎么做呢？\n\n第一步当然就是获取它的网页源代码了。\n\n可以用`requests`这个库轻松地完成这个过程，代码的写法是这样的：\n\n```python\nimport requests\n\nr = requests.get(url='https://static1.scrape.cuiqingcai.com/', verify=False)\nprint(r.text)\n```\n\n输出结果如下：\n\n```html\n<html lang=\"en\">\n<head>\n  \n  <meta charset=\"utf-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <link rel=\"icon\" href=\"/static/img/favicon.ico\">\n  <title>Scrape | Movie</title>\n  \n\n  <link href=\"/static/css/app.css\" type=\"text/css\" rel=\"stylesheet\">\n  \n<link href=\"/static/css/index.css\" type=\"text/css\" rel=\"stylesheet\">\n\n</head>\n<body>\n<div id=\"app\">\n  <div data-v-74e8b908=\"\" class=\"el-row\" id=\"header\">\n    <div data-v-74e8b908=\"\" class=\"container el-col el-col-18 el-col-offset-3\">\n      <div data-v-74e8b908=\"\" class=\"el-row\">\n        <div data-v-74e8b908=\"\" class=\"logo el-col el-col-4\">\n          <a data-v-74e8b908=\"\" href=\"/\" class=\"router-link-exact-active router-link-active\">\n            <img data-v-74e8b908=\"\" src=\"/static/img/logo.png\" class=\"logo-image\">\n            <span data-v-74e8b908=\"\" class=\"logo-title\">Scrape</span>\n          </a>\n        </div>\n      </div>\n    </div>\n  </div>\n    \n...\n\n         <li class=\"number\">\n              <a href=\"/page/7\">7</a>\n            </li>\n            \n            \n            \n            <li class=\"number\">\n              <a href=\"/page/8\">8</a>\n            </li>\n            \n            \n            \n            <li class=\"number\">\n              <a href=\"/page/9\">9</a>\n            </li>\n            \n            \n            \n            <li class=\"number\">\n              <a href=\"/page/10\">10</a>\n            </li>\n            \n            \n          </ul>\n          \n          <a href=\"/page/2\" class=\"next\">\n            <button type=\"button\" class=\"btn-next\"><i class=\"el-icon el-icon-arrow-right\"></i></button>\n          </a>\n          \n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n\n</div>\n</body>\n\nProcess finished with exit code 0\n\n```\n\n由于网页内容比较多，这里省略了大部分内容。\n\n不过看运行结果，我们已经成功获取网页的`HTML`源代码，里面包含了电影的标题、类型、上映时间，等等。\n\n把网页源代码获取下来之后，下一步我们把想要的数据提取出来，数据的爬取就完成了。\n\n## 请求\n\n`HTTP`中最常见的请求之一就是`GET`请求。\n\n### `GET`请求\n\n换一个示例网站，其`URL`为[http://httpbin.org/get](http://httpbin.org/get)，如果客户端发起的是`GET`请求的话，该网站会判断并返回相应的请求信息，包括 `Headers`、`IP`等。 我们还是用相同的方法来发起一个`GET请求`，代码如下：\n\n```python\nimport requests\n\nr = requests.get(url='http://httpbin.org/get', verify=False)\nprint(r.text)\n```\n\n返回结果：\n\n```html\n{\n  \"args\": {}, \n  \"headers\": {\n    \"Accept\": \"*/*\",\n    \"Accept-Encoding\": \"gzip, deflate\",\n    \"Host\": \"httpbin.org\",\n    \"User-Agent\": \"python-requests/2.25.1\",\n    \"X-Amzn-Trace-Id\": \"Root=1-60a3a8ad-070f8b95711f7821709e24ed\"\n  },\n  \"origin\": \"202.62.113.207\",\n  \"url\": \"http://httpbin.org/get\"\n}\n```\n\n可以发现，成功发起了`GET`请求，也通过这个网站的返回结果得到了请求所携带的信息，包括`Headers`、`URL`、`IP`，等等。\n\n对于`GET`请求，我们知道`URL`后面是可以跟上一些参数的，如果我们现在想添加两个参数，其中`name`是`germey`，`age`是`25`，`URL`就可以写成如下内容：\n\n```python\nhttp://httpbin.org/get?name=germey&age=25\n```\n\n要构造这个请求链接，是不是要直接写成这样呢？\n\n```python\nr = requests.get('http://httpbin.org/get?name=germey&age=25')\n```\n\n这样也可以，但如果这些参数还需要手动拼接，未免有点不人性化。\n\n一般情况下，这种信息我们利用`params`这个参数就可以直接传递了，示例如下：\n\n```python\nimport requests\n\ndata = {\n    'name': 'holy',\n    'age': 25\n}\n\nr = requests.get(url='http://httpbin.org/get', params=data, verify=False)\nprint(r.text)\n```\n\n返回结果：\n\n```html\n{\n  \"args\": {\n    \"age\": \"25\",\n    \"name\": \"holy\"\n  },\n  \"headers\": {\n    \"Accept\": \"*/*\",\n    \"Accept-Encoding\": \"gzip, deflate\",\n    \"Host\": \"httpbin.org\",\n    \"User-Agent\": \"python-requests/2.25.1\",\n    \"X-Amzn-Trace-Id\": \"Root=1-60a3ab05-51321f5c7eeb7b0573bb5510\"\n  },\n  \"origin\": \"202.62.113.207\",\n  \"url\": \"http://httpbin.org/get?name=holy&age=25\"\n}\n```\n\n把`URL`参数通过字典的形式传给`get`方法的`params`参数，通过返回信息可以判断，请求的链接自动被构造成了：*http://httpbin.org/get?age=22&name=germey*。\n\n网页的返回类型实际上是`str`类型，但是它很特殊，是`JSON`格式的。所以，如果想直接解析返回结果，得到一个`JSON`格式的数据的话，可以直接调用`json`方法。\n\n示例如下：\n\n```python\nimport requests\n\ndata = {\n    'name': 'holy',\n    'age': 25\n}\n\nr = requests.get(url='http://httpbin.org/get', params=data, verify=False)\nprint(type(r.text))\nprint(r.json())\nprint(type(r.json()))\n```\n\n结果如下：\n\n```shell\n<class 'str'>\n{'args': {'age': '25', 'name': 'holy'}, 'headers': {'Accept': '*/*', 'Accept-Encoding': 'gzip, deflate', 'Host': 'httpbin.org', 'User-Agent': 'python-requests/2.25.1', 'X-Amzn-Trace-Id': 'Root=1-60a3ac52-425e713a2907d0302f298070'}, 'origin': '202.62.113.207', 'url': 'http://httpbin.org/get?name=holy&age=25'}\n<class 'dict'>\n```\n\n调用`json`方法，就可以将返回结果是`JSON`格式的字符串转化为字典。 但需要注意的是，如果返回结果不是`JSON`格式，便会出现解析错误，抛出`json.decoder.JSONDecodeError`异常。\n\n### 抓取网页\n\n上面的请求链接返回的是`JSON`形式的字符串，那么如果请求普通的网页，则肯定能获得相应的内容。下面以本课时最初的实例页面为例，我们再加上一点提取信息的逻辑，将代码完善成如下的样子：\n\n```python\nimport requests\nimport re\n\nr = requests.get('https://static1.scrape.cuiqingcai.com/', verify=False)\npattern = re.compile('<h2.*?>(.*?)</h2>', re.S)\ntitles = re.findall(pattern, r.text)\nprint(titles)\n```\n\n运行结果：\n\n```python\n['霸王别姬 - Farewell My Concubine', '这个杀手不太冷 - Léon', '肖申克的救赎 - The Shawshank Redemption', '泰坦尼克号 - Titanic', '罗马假日 - Roman Holiday', '唐伯虎点秋香 - Flirting Scholar', '乱世佳人 - Gone with the Wind', '喜剧之王 - The King of Comedy', ' 楚门的世界 - The Truman Show', '狮子王 - The Lion King']\n```\n\n### 抓取二进制数据\n\n抓取的是网站的一个页面，实际上它返回的是一个`HTML`文档。如果想抓取图片、音频、视频等文件，应该怎么办呢？\n\n图片、音频、视频这些文件本质上都是由**二进制码**组成的，由于有特定的保存格式和对应的解析方式，我们才可以看到这些形形色色的多媒体。所以，想要抓取它们，就要拿到它们的二进制数据。\n\n下面以 GitHub 的站点图标为例来看一下：\n\n```python\nimport requests\n\nr = requests.get('https://github.com/favicon.ico')\nprint(r.text)\nprint(r.content)\n```\n\n这里抓取的内容是站点图标，也就是在浏览器每一个标签上显示的小图标。\n\n前者出现了乱码，后者结果前带有一个`b`，这代表是`bytes`类型的数据。\n\n由于图片是二进制数据，所以前者在打印时转化为`str`类型，也就是图片直接转化为字符串，这当然会出现乱码。\n\n上面返回的结果我们并不能看懂，它实际上是图片的二进制数据，没关系，将刚才提取到的信息保存下来就好了，代码如下：\n\n```python\nimport requests \n\nr = requests.get('https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png', verify=False) \n\nwith open('baidu.png', 'wb') as f: \n    f.write(r.content)\n```\n\n这里用了`open`方法，它的第一个参数是文件名称，第二个参数代表以二进制的形式打开，可以向文件里写入二进制数据。\n\n运行结束之后，可以发现在文件夹中出现了名为`baidu.png`的图标。\n\n### 添加添headers\n\n在发起一个`HTTP`请求的时候，会有一个请求头`Request Headers`，那么这个怎么来设置呢？\n\n很简单，使用`headers`参数就可以完成了。\n\n在刚才的实例中，是没有设置`Request Headers`信息的，如果不设置，某些网站会发现这不是一个正常的浏览器发起的请求，网站可能会返回异常的结果，导致网页抓取失败。\n\n要添加`Headers`信息，比如添加一个`User-Agent`字段，可以这么写：\n\n```python\nimport requests\n\nheaders = { \n    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36'\n}\n\nr = requests.get('https://static1.scrape.cuiqingcai.com/', headers=headers, verify=False) \n\nprint(r.text)\n```\n\n当然，我们可以在`headers`这个参数中任意添加其他的字段信息。\n\n### POST请求\n\n使用`requests`实现`post`请求，示例如下：\n\n```python\nimport requests\n\ndata = {'name':'germey', 'age':'25'}\nr = requests.post(\"http://httpbin.org/post\", data=data)\n\nprint(r.text)\n```\n\n这里还是请求[http://httpbin.org/post](http://httpbin.org/post)，该网站可以判断如果请求是`POST`方式，就把相关请求信息返回。\n\n运行结果如下：\n\n```python\n{\n  \"args\": {},\n  \"data\": \"\",\n  \"files\": {},\n  \"form\": {\n    \"age\": \"25\",\n    \"name\": \"germey\"\n  },\n  \"headers\": {\n    \"Accept\": \"*/*\",\n    \"Accept-Encoding\": \"gzip, deflate\",\n    \"Content-Length\": \"18\",\n    \"Content-Type\": \"application/x-www-form-urlencoded\",\n    \"Host\": \"httpbin.org\",\n    \"User-Agent\": \"python-requests/2.25.1\",\n    \"X-Amzn-Trace-Id\": \"Root=1-60a402c2-68a523624a9ca353207a3a5e\"\n  },\n  \"json\": null,\n  \"origin\": \"202.62.113.207\",\n  \"url\": \"http://httpbin.org/post\"\n}\n```\n\n### 响应\n\n发送请求后，得到的就是响应，即`Response`。\n\n在上面的实例中，使用`text`和`content`获取了响应的内容。此外，还有很多属性和方法可以用来获取其他信息，比如`状态码`、`响应头`、`Cookies`等。示例如下:\n\n```python\nimport requests\n\nr = requests.get('https://static1.scrape.cuiqingcai.com/', verify=False)\n\nprint(type(r.status_code), r.status_code)\nprint(type(r.headers), r.headers)\nprint(type(r.cookies), r.cookies)\nprint(type(r.url), r.url)\nprint(type(r.history), r.history)\n```\n\n这里分别打印输出`status_code`属性得到状态码，输出`headers`属性得到响应头，输出`cookies`属性得到`Cookies`，输出`url`属性得到`URL`，输出`history`属性得到请求历史。\n\n运行结果如下：\n\n```python\n<class 'int'> 200\n<class 'requests.structures.CaseInsensitiveDict'> {'Date': 'Wed, 19 May 2021 12:52:03 GMT', 'Content-Type': 'text/html; charset=utf-8', 'Content-Length': '41538', 'Connection': 'keep-alive', 'X-Frame-Options': 'DENY', 'X-Content-Type-Options': 'nosniff', 'Expires': 'Wed, 19 May 2021 13:01:46 GMT', 'Cache-Control': 'max-age=600', 'Strict-Transport-Security': 'max-age=15724800; includeSubDomains'}\n<class 'requests.cookies.RequestsCookieJar'> <RequestsCookieJar[]>\n<class 'str'> https://static1.scrape.cuiqingcai.com/\n<class 'list'> []\n```\n\n`headers`和`cookies`这两个属性得到的结果分别是`CaseInsensitiveDict`和`RequestsCookieJar`类型。\n\n状态码是用来表示响应状态的，比如返回`200`代表我们得到的响应是没问题的，上面的例子正好输出的结果也是`200`，所以可以通过判断`Response`的状态码来确认是否爬取成功。\n\n`requests`还提供了一个内置的状态码查询对象`requests.codes`，用法示例如下：\n\n```python\nimport requests\n\nr = requests.get('https://static1.scrape.cuiqingcai.com/', verify=False)\nexit() if not r.status_code == requests.codes.ok else print('Request successfully')\n```\n\n这里通过比较返回码和内置的成功的返回码，来保证请求得到了正常响应，输出成功请求的消息，否则程序终止，这里我们用`requests.codes.ok`得到的是成功的状态码`200`。\n\n这样的话，我们就不用再在程序里面写状态码对应的数字了，用字符串表示状态码会显得更加直观。\n\n下面列出了返回码和相应的查询条件：\n\n```python\n# 信息性状态码\n100: ('continue',),\n101: ('switching_protocols',),\n102: ('processing',),\n103: ('checkpoint',),\n122: ('uri_too_long', 'request_uri_too_long'),\n\n# 成功状态码\n200: ('ok', 'okay', 'all_ok', 'all_okay', 'all_good', '\\\\o/', '✓'),\n201: ('created',),\n202: ('accepted',),\n203: ('non_authoritative_info', 'non_authoritative_information'),\n204: ('no_content',),\n205: ('reset_content', 'reset'),\n206: ('partial_content', 'partial'),\n207: ('multi_status', 'multiple_status', 'multi_stati', 'multiple_stati'),\n208: ('already_reported',),\n226: ('im_used',),\n\n# 重定向状态码\n300: ('multiple_choices',),\n301: ('moved_permanently', 'moved', '\\\\o-'),\n302: ('found',),\n303: ('see_other', 'other'),\n304: ('not_modified',),\n305: ('use_proxy',),\n306: ('switch_proxy',),\n307: ('temporary_redirect', 'temporary_moved', 'temporary'),\n308: ('permanent_redirect', 'resume_incomplete', 'resume',), # These 2 to be removed in 3.0 \n\n# 客户端错误状态码 \n400: ('bad_request', 'bad'), \n401: ('unauthorized',), \n402: ('payment_required', 'payment'), \n403: ('forbidden',), \n404: ('not_found', '-o-'), \n405: ('method_not_allowed', 'not_allowed'), \n406: ('not_acceptable',), \n407: ('proxy_authentication_required', 'proxy_auth', 'proxy_authentication'),\n408: ('request_timeout', 'timeout'), \n409: ('conflict',),\n410: ('gone',),\n411: ('length_required',),\n412: ('precondition_failed', 'precondition'),\n413: ('request_entity_too_large',),\n414: ('request_uri_too_large',),\n415: ('unsupported_media_type', 'unsupported_media', 'media_type'),\n416: ('requested_range_not_satisfiable', 'requested_range', 'range_not_satisfiable'),\n417: ('expectation_failed',),\n418: ('im_a_teapot', 'teapot', 'i_am_a_teapot'),\n421: ('misdirected_request',),\n422: ('unprocessable_entity', 'unprocessable'),\n423: ('locked',),\n424: ('failed_dependency', 'dependency'),\n425: ('unordered_collection', 'unordered'),\n426: ('upgrade_required', 'upgrade'),\n428: ('precondition_required', 'precondition'),\n429: ('too_many_requests', 'too_many'),\n431: ('header_fields_too_large', 'fields_too_large'),\n444: ('no_response', 'none'),\n449: ('retry_with', 'retry'),\n450: ('blocked_by_windows_parental_controls', 'parental_controls'),\n451: ('unavailable_for_legal_reasons', 'legal_reasons'),\n499: ('client_closed_request',), \n\n# 服务端错误状态码\n500: ('internal_server_error', 'server_error', '/o\\\\', '✗'),\n501: ('not_implemented',),\n502: ('bad_gateway',),\n503: ('service_unavailable', 'unavailable'),\n504: ('gateway_timeout',),\n505: ('http_version_not_supported', 'http_version'),\n506: ('variant_also_negotiates',),\n507: ('insufficient_storage',),\n509: ('bandwidth_limit_exceeded', 'bandwidth'),\n510: ('not_extended',),\n511: ('network_authentication_required', 'network_auth', 'network_authentication')\n```\n\n比如，如果想判断结果是不是`404`状态，可以用`requests.codes.not_found`来比对。\n\n## 高级用法\n\n刚才，了解`requests`的基本用法，如基本的`GET、POST`请求以及`Response`对象。当然`requests`能做到的不仅这些，它几乎可以完成`HTTP`的所有操作。\n\n下面来了解下`requests`的一些高级用法，如文件上传、`Cookies`设置、代理设置等。\n\n### 文件上传\n\n`requests`可以模拟提交一些数据。假如有的网站需要上传文件，也可以用它来实现，示例如下：\n\n```python\nimport requests\n\nfiles = {'file':open('baidu.png', 'rb')}\nr = requests.post('http://httpbin.org/post', files=files)\nprint(r.text)\n```\n\n要注意的是，`baidu.png`需要和当前脚本在同一目录下。如果有其他文件，当然也可以使用其他文件来上传，更改下代码即可。运行结果如下：\n\n```shell  \n{\n  \"args\": {}, \n  \"data\": \"\", \n  \"files\": {\n    \"file\": \"data:application/octet-stream;base64,iVBORw0KGgoAAAANSU......\"\n  },\n  \"form\": {},\n  \"headers\": {\n    \"Accept\": \"*/*\",\n    \"Accept-Encoding\": \"gzip, deflate\",\n    \"Content-Length\": \"15589\",\n    \"Content-Type\": \"multipart/form-data; boundary=7e0556b094615781fff3b0ed4316dccd\",\n    \"Host\": \"httpbin.org\",\n    \"User-Agent\": \"python-requests/2.25.1\",\n    \"X-Amzn-Trace-Id\": \"Root=1-60a72501-36f606570785cb9d4356df71\"\n  },\n  \"json\": null,\n  \"origin\": \"202.62.112.143\",\n  \"url\": \"http://httpbin.org/post\"\n}\n```\n\n以上省略部分内容，这个网站会返回响应，里面包含`files`这个字段，而`form`字段是空的，这证明文件上传部分会单独有一个`files`字段来标识。\n\n### Cookies\n\n获取`Cookies`。\n\n```python\nimport requests\n\nr = requests.get('http://www.baidu.com')\nprint(r.cookies)\nfor key, value in r.cookies.items():\n    print(key + '=' + value)\n```\n\n运行结果如下：\n\n```shell\n<RequestsCookieJar[<Cookie BDORZ=27315 for .baidu.com/>]>\nBDORZ=27315\n```\n\n调用`cookies`属性即可成功得到`Cookies`，可以发现它是`RequestCookieJar`类型。然后用`items` 方法将其转化为元组组成的列表，遍历输出每一个`Cookie`的名称和值，实现`Cookie`的遍历解析。\n\n可以直接用`Cookie`来维持登录状态，下面我们以`GitHub`为例来说明一下，首先我们登录`GitHub`，然后将`Headers`中的`Cookie`内容复制下来，如图所示：\n\n![](Screenshot_1.webp)\n\n可以替换成你自己的`Cookie`，将其设置到`Headers`里面，然后发送请求。\n\n### Session维持\n\n在`requests`中，如果直接利用`get`或`post`等方法的确可以做到模拟网页的请求，但是这实际上是相当于不同的`Session`，相当于你用两个浏览器打开了不同的页面。\n\n设想这样一个场景，第一个请求利用`post`方法登录了某个网站，第二次想获取成功登录后的自己的个人信息，又用了一次`get`方法去请求个人信息页面。实际上，这相当于打开了两个浏览器，是两个完全不相关的`Session`，能成功获取个人信息吗？当然不能。\n\n解决这个问题的主要方法就是维持同一个`Session`，相当于打开一个新的浏览器选项卡而不是新开一个浏览器。但我又不想每次设置`Cookies`，那该怎么办呢？这时候就有了新的利器——**`Session`对象**。 利用它，可以方便地维护一个`Session`，而且不用担心`Cookies`的问题，它会帮我们自动处理好。示例如下：\n\n```python\nimport requests\n\nrequests.get('http://httpbin.org/cookies/set/number/123456789', verify=False)\nr = requests.get('http://httpbin.org/cookies', verify=False)\n\nprint(r.text)\n```\n\n运行结果如下：\n\n```python\n{\n  \"cookies\": {}\n}\n```\n\n这并不行。再用 Session试试看：\n\n```python\nimport requests\n\ns = requests.Session()\ns.get('http://httpbin.org/cookies/set/number/123456789')\nr = s.get('http://httpbin.org/cookies')\n\nprint(r.text)\n```\n\n运行结果如下：\n\n```python\n{\n  \"cookies\": {\n    \"number\": \"123456789\"\n  }\n}\n```\n\n利用`Session`，可以做到模拟同一个`Session`而不用担心`Cookies`的问题。它通常用于模拟登录成功之后再进行下一步的操作。\n\n### SSL证书验证\n\n现在很多网站都要求使用`HTTPS`协议，但是有些网站可能并没有设置好`HTTPS`证书，或者网站的`HTTPS`证书不被`CA`机构认可，这时候，这些网站可能就会出现`SSL`证书错误的提示。\n\n比如示例网站：[https://static2.scrape.cuiqingcai.com/](https://static2.scrape.cuiqingcai.com/)。 用浏览器打开这个`URL`，则会提示**「您的连接不是私密连接」**这样的错误，如图所示：\n\n![示例网站](Screenshot_3.webp)\n\n那如果我们一定要爬取这个网站怎么办呢？我们可以使用`verify`参数控制是否验证证书，如果将其设置为`False`，在请求时就不会再验证证书是否有效。如果不加`verify`参数的话，默认值是`True`，会自动验证。\n\n改写代码如下：\n\n```python\nimport requests\nresponse = requests.get('https://static2.scrape.cuiqingcai.com/', verify=False) \nprint(response.status_code) \n```\n\n这样就会打印出请求成功的状态码：\n\n```python\n/usr/local/lib/python3.7/site-packages/urllib3/connectionpool.py:857: InsecureRequestWarning: Unverified HTTPS request is being made. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html\nInsecureRequestWarning) 200 \n```\n\n不过发现报了一个警告，它建议我们给它指定证书。可以通过设置忽略警告的方式来屏蔽这个警告：\n\n```python\nimport requests from requests.packages \nimport urllib3 \n\nurllib3.disable_warnings() \nresponse = requests.get('https://static2.scrape.cuiqingcai.com/', verify=False) \nprint(response.status_code)\n```\n\n或者通过捕获警告到日志的方式忽略警告：\n\n```python\nimport logging \nimport requests \n\nlogging.captureWarnings(True) \nresponse = requests.get('https://static2.scrape.cuiqingcai.com/', verify=False) \nprint(response.status_code)\n```\n\n当然，也可以指定一个本地证书用作客户端证书，这可以是单个文件（包含密钥和证书）或一个包含两个文件路径的元组： \n\n```python\nimport requests response = requests.get('https://static2.scrape.cuiqingcai.com/', cert=('/path/server.crt', '/path/server.key')) \nprint(response.status_code)\n```\n\n上面的代码是演示实例，要有`crt`和`key`文件，并且指定它们的路径。另外注意，本地私有证书的`key`必须是解密状态，加密状态的`key`是不支持的。\n\n### 超时时间\n\n在本机网络状况不好或者服务器网络响应延迟甚至无响应时，可能会等待很久才能收到响应，甚至到最后收不到响应而报错。为了防止服务器不能及时响应，应该设置一个超时时间，即超过了这个时间还没有得到响应，那就报错。这需要用到`timeout`参数。这个时间的计算是发出请求到服务器返回响应的时间。示例如下：\n\n```python\nimport requests \nr = requests.get('https://httpbin.org/get', timeout=1) \nprint(r.status_code)\n```\n\n通过这样的方式将超时时间设置为`1`秒，如果`1`秒内没有响应，那就抛出异常。\n\n实际上，请求分为两个阶段，即连接`（connect）`和读取`（read）`。 上面设置的`timeout`将用作连接和读取这二者的`timeout`总和。\n\n如果要分别指定，就可以传入一个元组：\n\n```python\nr = requests.get('https://httpbin.org/get', timeout=(5, 30))\n```\n\n如果想永久等待，可以直接将`timeout`设置为`None`，或者不设置直接留空，因为默认是`None`。这样的话，如果服务器还在运行，但是响应特别慢，那就慢慢等吧，它永远不会返回超时错误的。其用法如下：\n\n```python\nr = requests.get('https://httpbin.org/get', timeout=None) \n```\n\n或直接不加参数：\n\n```python\nr = requests.get('https://httpbin.org/get')\n```\n\n###　身份认证\n\n在访问某些设置了身份认证的网站时，例如：[https://static3.scrape.cuiqingcai.com/](https://static3.scrape.cuiqingcai.com/)，我们可能会遇到这样的认证窗口，如图所示：\n\n![认证](Screenshot_4.webp)\n\n如果遇到了这种情况，那就是这个网站启用了基本身份认证，英文叫作`HTTP Basic Access Authentication`，它是一种用来允许网页浏览器或其他客户端程序在请求时提供**用户名**和**口令形式**的身份凭证的一种登录验证方式。 如果遇到了这种情况，怎么用`reqeusts`来爬取呢，当然也有办法。\n\n可以使用`requests`自带的身份认证功能，通过`auth`参数即可设置，示例如下：\n\n```python\nimport requests\nfrom requests.auth import HTTPBasicAuth\n\nr = requests.get('https://static3.scrape.cuiqingcai.com/', auth=HTTPBasicAuth('admin', 'admin'), verify=False)\nprint(r.status_code)\n```\n\n成功的话，返回状态码`200`。\n\n如果参数都传一个`HTTPBasicAuth`类，就显得有点烦琐了，所以`requests`提供了一个更简单的写法，可以直接传一个元组，它会默认使用`HTTPBasicAuth`这个类来认证。\n\n上面的代码可以直接简写如下：\n\n```python\nimport requests\nr = requests.get('https://static3.scrape.cuiqingcai.com/', auth=('admin', 'admin'))\nprint(r.status_code)\n```\n\n此外，`requests`还提供了其他认证方式，如`OAuth`认证，不过此时需要安装`oauth`包，安装命令如下：\n\n```python\npip3 install requests_oauthlib\n```\n\n使用`OAuth1`认证的方法如下：\n\n```python\nimport requests from requests_oauthlib \nimport OAuth1 \nurl = 'https://api.twitter.com/1.1/account/verify_credentials.json' \nauth = OAuth1('YOUR_APP_KEY', 'YOUR_APP_SECRET', 'USER_OAUTH_TOKEN', 'USER_OAUTH_TOKEN_SECRET')\nrequests.get(url, auth=auth) \n```\n\n更多详细的功能就可以参考`requests_oauthlib`的官方文档：[https://requests-oauthlib.readthedocs.org/](https://requests-oauthlib.readthedocs.org/)，不再赘述。\n\n### 代理设置\n\n某些网站在测试的时候请求几次，能正常获取内容。但是对于大规模且频繁的请求，网站可能会弹出验证码，或者跳转到登录认证页面，更甚者可能会直接封禁客户端的`IP`，导致一定时间段内无法访问。\n\n为了防止这种情况发生，我们需要设置代理来解决这个问题，这就需要用到`proxies`参数。可以用这样的方式设置：\n\n```python\nimport requests\nproxies = { \n  'http': 'http://10.10.10.10:1080', \n  'https': 'http://10.10.10.10:1080', \n}\nrequests.get('https://httpbin.org/get', proxies=proxies) \n```\n\n当然，直接运行这个实例或许行不通，因为这个代理可能是无效的，可以直接搜索寻找有效的代理并替换试验一下。\n\n若代理需要使用上文所述的身份认证，可以使用类似`ttp://user:password@host:port`这样的语法来设置代理，示例如下：\n\n```python\nimport requests\nproxies = {'https': 'http://user:password@10.10.10.10:1080/',} \nrequests.get('https://httpbin.org/get', proxies=proxies)\n```\n\n除了基本的`HTTP`代理外，`requests`还支持`SOCKS`协议的代理。\n\n首先，需要安装`socks`这个库：\n\n```python\npip3 install \"requests[socks]\"\n```\n\n然后就可以使用`SOCKS`协议代理了，示例如下：\n\n```python\nimport requests\nproxies = { \n  'http': 'socks5://user:password@host:port', \n  'https': 'socks5://user:password@host:port' \n}\nrequests.get('https://httpbin.org/get', proxies=proxies)\n```\n","source":"_posts/requests库的基本使用.md","raw":"---\ntitle: requests库的基本使用\ntags:\n  - python\n  - requests\n  - 爬虫\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-18 15:44:10\ncategories: 爬虫\npic:\n---\n\n## 安装\n\n`requests`是一个第三方库，使用`pip`下载安装。\n\n```python\npip3 install requests\n```\n\n## 实例引入\n\n用`Python`写爬虫的第一步就是模拟发起一个请求，把网页的源代码获取下来。\n\n在浏览器中输入一个`URL`并回车，实际上就是让浏览器帮我们发起一个`GET`类型的`HTTP`请求，浏览器得到源代码后，把它渲染出来就可以看到网页内容了。\n\n那如果想用`requests`来获取源代码，应该怎么办呢？很简单，`requests`这个库提供了一个`get`方法，调用这个方法，并传入对应的`URL`就能得到网页的源代码。\n\n比如这里有一个示例网站:[https://static1.scrape.cuiqingcai.com/](https://static1.scrape.cuiqingcai.com/)，其内容如下：\n\n![示列网站](Screenshot_2.webp)\n\n这个网站展示了一些电影数据，如果想要把这个网页里面的数据爬下来，比如获取各个电影的名称、上映时间等信息，然后把它存下来的话，该怎么做呢？\n\n第一步当然就是获取它的网页源代码了。\n\n可以用`requests`这个库轻松地完成这个过程，代码的写法是这样的：\n\n```python\nimport requests\n\nr = requests.get(url='https://static1.scrape.cuiqingcai.com/', verify=False)\nprint(r.text)\n```\n\n输出结果如下：\n\n```html\n<html lang=\"en\">\n<head>\n  \n  <meta charset=\"utf-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <link rel=\"icon\" href=\"/static/img/favicon.ico\">\n  <title>Scrape | Movie</title>\n  \n\n  <link href=\"/static/css/app.css\" type=\"text/css\" rel=\"stylesheet\">\n  \n<link href=\"/static/css/index.css\" type=\"text/css\" rel=\"stylesheet\">\n\n</head>\n<body>\n<div id=\"app\">\n  <div data-v-74e8b908=\"\" class=\"el-row\" id=\"header\">\n    <div data-v-74e8b908=\"\" class=\"container el-col el-col-18 el-col-offset-3\">\n      <div data-v-74e8b908=\"\" class=\"el-row\">\n        <div data-v-74e8b908=\"\" class=\"logo el-col el-col-4\">\n          <a data-v-74e8b908=\"\" href=\"/\" class=\"router-link-exact-active router-link-active\">\n            <img data-v-74e8b908=\"\" src=\"/static/img/logo.png\" class=\"logo-image\">\n            <span data-v-74e8b908=\"\" class=\"logo-title\">Scrape</span>\n          </a>\n        </div>\n      </div>\n    </div>\n  </div>\n    \n...\n\n         <li class=\"number\">\n              <a href=\"/page/7\">7</a>\n            </li>\n            \n            \n            \n            <li class=\"number\">\n              <a href=\"/page/8\">8</a>\n            </li>\n            \n            \n            \n            <li class=\"number\">\n              <a href=\"/page/9\">9</a>\n            </li>\n            \n            \n            \n            <li class=\"number\">\n              <a href=\"/page/10\">10</a>\n            </li>\n            \n            \n          </ul>\n          \n          <a href=\"/page/2\" class=\"next\">\n            <button type=\"button\" class=\"btn-next\"><i class=\"el-icon el-icon-arrow-right\"></i></button>\n          </a>\n          \n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n\n</div>\n</body>\n\nProcess finished with exit code 0\n\n```\n\n由于网页内容比较多，这里省略了大部分内容。\n\n不过看运行结果，我们已经成功获取网页的`HTML`源代码，里面包含了电影的标题、类型、上映时间，等等。\n\n把网页源代码获取下来之后，下一步我们把想要的数据提取出来，数据的爬取就完成了。\n\n## 请求\n\n`HTTP`中最常见的请求之一就是`GET`请求。\n\n### `GET`请求\n\n换一个示例网站，其`URL`为[http://httpbin.org/get](http://httpbin.org/get)，如果客户端发起的是`GET`请求的话，该网站会判断并返回相应的请求信息，包括 `Headers`、`IP`等。 我们还是用相同的方法来发起一个`GET请求`，代码如下：\n\n```python\nimport requests\n\nr = requests.get(url='http://httpbin.org/get', verify=False)\nprint(r.text)\n```\n\n返回结果：\n\n```html\n{\n  \"args\": {}, \n  \"headers\": {\n    \"Accept\": \"*/*\",\n    \"Accept-Encoding\": \"gzip, deflate\",\n    \"Host\": \"httpbin.org\",\n    \"User-Agent\": \"python-requests/2.25.1\",\n    \"X-Amzn-Trace-Id\": \"Root=1-60a3a8ad-070f8b95711f7821709e24ed\"\n  },\n  \"origin\": \"202.62.113.207\",\n  \"url\": \"http://httpbin.org/get\"\n}\n```\n\n可以发现，成功发起了`GET`请求，也通过这个网站的返回结果得到了请求所携带的信息，包括`Headers`、`URL`、`IP`，等等。\n\n对于`GET`请求，我们知道`URL`后面是可以跟上一些参数的，如果我们现在想添加两个参数，其中`name`是`germey`，`age`是`25`，`URL`就可以写成如下内容：\n\n```python\nhttp://httpbin.org/get?name=germey&age=25\n```\n\n要构造这个请求链接，是不是要直接写成这样呢？\n\n```python\nr = requests.get('http://httpbin.org/get?name=germey&age=25')\n```\n\n这样也可以，但如果这些参数还需要手动拼接，未免有点不人性化。\n\n一般情况下，这种信息我们利用`params`这个参数就可以直接传递了，示例如下：\n\n```python\nimport requests\n\ndata = {\n    'name': 'holy',\n    'age': 25\n}\n\nr = requests.get(url='http://httpbin.org/get', params=data, verify=False)\nprint(r.text)\n```\n\n返回结果：\n\n```html\n{\n  \"args\": {\n    \"age\": \"25\",\n    \"name\": \"holy\"\n  },\n  \"headers\": {\n    \"Accept\": \"*/*\",\n    \"Accept-Encoding\": \"gzip, deflate\",\n    \"Host\": \"httpbin.org\",\n    \"User-Agent\": \"python-requests/2.25.1\",\n    \"X-Amzn-Trace-Id\": \"Root=1-60a3ab05-51321f5c7eeb7b0573bb5510\"\n  },\n  \"origin\": \"202.62.113.207\",\n  \"url\": \"http://httpbin.org/get?name=holy&age=25\"\n}\n```\n\n把`URL`参数通过字典的形式传给`get`方法的`params`参数，通过返回信息可以判断，请求的链接自动被构造成了：*http://httpbin.org/get?age=22&name=germey*。\n\n网页的返回类型实际上是`str`类型，但是它很特殊，是`JSON`格式的。所以，如果想直接解析返回结果，得到一个`JSON`格式的数据的话，可以直接调用`json`方法。\n\n示例如下：\n\n```python\nimport requests\n\ndata = {\n    'name': 'holy',\n    'age': 25\n}\n\nr = requests.get(url='http://httpbin.org/get', params=data, verify=False)\nprint(type(r.text))\nprint(r.json())\nprint(type(r.json()))\n```\n\n结果如下：\n\n```shell\n<class 'str'>\n{'args': {'age': '25', 'name': 'holy'}, 'headers': {'Accept': '*/*', 'Accept-Encoding': 'gzip, deflate', 'Host': 'httpbin.org', 'User-Agent': 'python-requests/2.25.1', 'X-Amzn-Trace-Id': 'Root=1-60a3ac52-425e713a2907d0302f298070'}, 'origin': '202.62.113.207', 'url': 'http://httpbin.org/get?name=holy&age=25'}\n<class 'dict'>\n```\n\n调用`json`方法，就可以将返回结果是`JSON`格式的字符串转化为字典。 但需要注意的是，如果返回结果不是`JSON`格式，便会出现解析错误，抛出`json.decoder.JSONDecodeError`异常。\n\n### 抓取网页\n\n上面的请求链接返回的是`JSON`形式的字符串，那么如果请求普通的网页，则肯定能获得相应的内容。下面以本课时最初的实例页面为例，我们再加上一点提取信息的逻辑，将代码完善成如下的样子：\n\n```python\nimport requests\nimport re\n\nr = requests.get('https://static1.scrape.cuiqingcai.com/', verify=False)\npattern = re.compile('<h2.*?>(.*?)</h2>', re.S)\ntitles = re.findall(pattern, r.text)\nprint(titles)\n```\n\n运行结果：\n\n```python\n['霸王别姬 - Farewell My Concubine', '这个杀手不太冷 - Léon', '肖申克的救赎 - The Shawshank Redemption', '泰坦尼克号 - Titanic', '罗马假日 - Roman Holiday', '唐伯虎点秋香 - Flirting Scholar', '乱世佳人 - Gone with the Wind', '喜剧之王 - The King of Comedy', ' 楚门的世界 - The Truman Show', '狮子王 - The Lion King']\n```\n\n### 抓取二进制数据\n\n抓取的是网站的一个页面，实际上它返回的是一个`HTML`文档。如果想抓取图片、音频、视频等文件，应该怎么办呢？\n\n图片、音频、视频这些文件本质上都是由**二进制码**组成的，由于有特定的保存格式和对应的解析方式，我们才可以看到这些形形色色的多媒体。所以，想要抓取它们，就要拿到它们的二进制数据。\n\n下面以 GitHub 的站点图标为例来看一下：\n\n```python\nimport requests\n\nr = requests.get('https://github.com/favicon.ico')\nprint(r.text)\nprint(r.content)\n```\n\n这里抓取的内容是站点图标，也就是在浏览器每一个标签上显示的小图标。\n\n前者出现了乱码，后者结果前带有一个`b`，这代表是`bytes`类型的数据。\n\n由于图片是二进制数据，所以前者在打印时转化为`str`类型，也就是图片直接转化为字符串，这当然会出现乱码。\n\n上面返回的结果我们并不能看懂，它实际上是图片的二进制数据，没关系，将刚才提取到的信息保存下来就好了，代码如下：\n\n```python\nimport requests \n\nr = requests.get('https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png', verify=False) \n\nwith open('baidu.png', 'wb') as f: \n    f.write(r.content)\n```\n\n这里用了`open`方法，它的第一个参数是文件名称，第二个参数代表以二进制的形式打开，可以向文件里写入二进制数据。\n\n运行结束之后，可以发现在文件夹中出现了名为`baidu.png`的图标。\n\n### 添加添headers\n\n在发起一个`HTTP`请求的时候，会有一个请求头`Request Headers`，那么这个怎么来设置呢？\n\n很简单，使用`headers`参数就可以完成了。\n\n在刚才的实例中，是没有设置`Request Headers`信息的，如果不设置，某些网站会发现这不是一个正常的浏览器发起的请求，网站可能会返回异常的结果，导致网页抓取失败。\n\n要添加`Headers`信息，比如添加一个`User-Agent`字段，可以这么写：\n\n```python\nimport requests\n\nheaders = { \n    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36'\n}\n\nr = requests.get('https://static1.scrape.cuiqingcai.com/', headers=headers, verify=False) \n\nprint(r.text)\n```\n\n当然，我们可以在`headers`这个参数中任意添加其他的字段信息。\n\n### POST请求\n\n使用`requests`实现`post`请求，示例如下：\n\n```python\nimport requests\n\ndata = {'name':'germey', 'age':'25'}\nr = requests.post(\"http://httpbin.org/post\", data=data)\n\nprint(r.text)\n```\n\n这里还是请求[http://httpbin.org/post](http://httpbin.org/post)，该网站可以判断如果请求是`POST`方式，就把相关请求信息返回。\n\n运行结果如下：\n\n```python\n{\n  \"args\": {},\n  \"data\": \"\",\n  \"files\": {},\n  \"form\": {\n    \"age\": \"25\",\n    \"name\": \"germey\"\n  },\n  \"headers\": {\n    \"Accept\": \"*/*\",\n    \"Accept-Encoding\": \"gzip, deflate\",\n    \"Content-Length\": \"18\",\n    \"Content-Type\": \"application/x-www-form-urlencoded\",\n    \"Host\": \"httpbin.org\",\n    \"User-Agent\": \"python-requests/2.25.1\",\n    \"X-Amzn-Trace-Id\": \"Root=1-60a402c2-68a523624a9ca353207a3a5e\"\n  },\n  \"json\": null,\n  \"origin\": \"202.62.113.207\",\n  \"url\": \"http://httpbin.org/post\"\n}\n```\n\n### 响应\n\n发送请求后，得到的就是响应，即`Response`。\n\n在上面的实例中，使用`text`和`content`获取了响应的内容。此外，还有很多属性和方法可以用来获取其他信息，比如`状态码`、`响应头`、`Cookies`等。示例如下:\n\n```python\nimport requests\n\nr = requests.get('https://static1.scrape.cuiqingcai.com/', verify=False)\n\nprint(type(r.status_code), r.status_code)\nprint(type(r.headers), r.headers)\nprint(type(r.cookies), r.cookies)\nprint(type(r.url), r.url)\nprint(type(r.history), r.history)\n```\n\n这里分别打印输出`status_code`属性得到状态码，输出`headers`属性得到响应头，输出`cookies`属性得到`Cookies`，输出`url`属性得到`URL`，输出`history`属性得到请求历史。\n\n运行结果如下：\n\n```python\n<class 'int'> 200\n<class 'requests.structures.CaseInsensitiveDict'> {'Date': 'Wed, 19 May 2021 12:52:03 GMT', 'Content-Type': 'text/html; charset=utf-8', 'Content-Length': '41538', 'Connection': 'keep-alive', 'X-Frame-Options': 'DENY', 'X-Content-Type-Options': 'nosniff', 'Expires': 'Wed, 19 May 2021 13:01:46 GMT', 'Cache-Control': 'max-age=600', 'Strict-Transport-Security': 'max-age=15724800; includeSubDomains'}\n<class 'requests.cookies.RequestsCookieJar'> <RequestsCookieJar[]>\n<class 'str'> https://static1.scrape.cuiqingcai.com/\n<class 'list'> []\n```\n\n`headers`和`cookies`这两个属性得到的结果分别是`CaseInsensitiveDict`和`RequestsCookieJar`类型。\n\n状态码是用来表示响应状态的，比如返回`200`代表我们得到的响应是没问题的，上面的例子正好输出的结果也是`200`，所以可以通过判断`Response`的状态码来确认是否爬取成功。\n\n`requests`还提供了一个内置的状态码查询对象`requests.codes`，用法示例如下：\n\n```python\nimport requests\n\nr = requests.get('https://static1.scrape.cuiqingcai.com/', verify=False)\nexit() if not r.status_code == requests.codes.ok else print('Request successfully')\n```\n\n这里通过比较返回码和内置的成功的返回码，来保证请求得到了正常响应，输出成功请求的消息，否则程序终止，这里我们用`requests.codes.ok`得到的是成功的状态码`200`。\n\n这样的话，我们就不用再在程序里面写状态码对应的数字了，用字符串表示状态码会显得更加直观。\n\n下面列出了返回码和相应的查询条件：\n\n```python\n# 信息性状态码\n100: ('continue',),\n101: ('switching_protocols',),\n102: ('processing',),\n103: ('checkpoint',),\n122: ('uri_too_long', 'request_uri_too_long'),\n\n# 成功状态码\n200: ('ok', 'okay', 'all_ok', 'all_okay', 'all_good', '\\\\o/', '✓'),\n201: ('created',),\n202: ('accepted',),\n203: ('non_authoritative_info', 'non_authoritative_information'),\n204: ('no_content',),\n205: ('reset_content', 'reset'),\n206: ('partial_content', 'partial'),\n207: ('multi_status', 'multiple_status', 'multi_stati', 'multiple_stati'),\n208: ('already_reported',),\n226: ('im_used',),\n\n# 重定向状态码\n300: ('multiple_choices',),\n301: ('moved_permanently', 'moved', '\\\\o-'),\n302: ('found',),\n303: ('see_other', 'other'),\n304: ('not_modified',),\n305: ('use_proxy',),\n306: ('switch_proxy',),\n307: ('temporary_redirect', 'temporary_moved', 'temporary'),\n308: ('permanent_redirect', 'resume_incomplete', 'resume',), # These 2 to be removed in 3.0 \n\n# 客户端错误状态码 \n400: ('bad_request', 'bad'), \n401: ('unauthorized',), \n402: ('payment_required', 'payment'), \n403: ('forbidden',), \n404: ('not_found', '-o-'), \n405: ('method_not_allowed', 'not_allowed'), \n406: ('not_acceptable',), \n407: ('proxy_authentication_required', 'proxy_auth', 'proxy_authentication'),\n408: ('request_timeout', 'timeout'), \n409: ('conflict',),\n410: ('gone',),\n411: ('length_required',),\n412: ('precondition_failed', 'precondition'),\n413: ('request_entity_too_large',),\n414: ('request_uri_too_large',),\n415: ('unsupported_media_type', 'unsupported_media', 'media_type'),\n416: ('requested_range_not_satisfiable', 'requested_range', 'range_not_satisfiable'),\n417: ('expectation_failed',),\n418: ('im_a_teapot', 'teapot', 'i_am_a_teapot'),\n421: ('misdirected_request',),\n422: ('unprocessable_entity', 'unprocessable'),\n423: ('locked',),\n424: ('failed_dependency', 'dependency'),\n425: ('unordered_collection', 'unordered'),\n426: ('upgrade_required', 'upgrade'),\n428: ('precondition_required', 'precondition'),\n429: ('too_many_requests', 'too_many'),\n431: ('header_fields_too_large', 'fields_too_large'),\n444: ('no_response', 'none'),\n449: ('retry_with', 'retry'),\n450: ('blocked_by_windows_parental_controls', 'parental_controls'),\n451: ('unavailable_for_legal_reasons', 'legal_reasons'),\n499: ('client_closed_request',), \n\n# 服务端错误状态码\n500: ('internal_server_error', 'server_error', '/o\\\\', '✗'),\n501: ('not_implemented',),\n502: ('bad_gateway',),\n503: ('service_unavailable', 'unavailable'),\n504: ('gateway_timeout',),\n505: ('http_version_not_supported', 'http_version'),\n506: ('variant_also_negotiates',),\n507: ('insufficient_storage',),\n509: ('bandwidth_limit_exceeded', 'bandwidth'),\n510: ('not_extended',),\n511: ('network_authentication_required', 'network_auth', 'network_authentication')\n```\n\n比如，如果想判断结果是不是`404`状态，可以用`requests.codes.not_found`来比对。\n\n## 高级用法\n\n刚才，了解`requests`的基本用法，如基本的`GET、POST`请求以及`Response`对象。当然`requests`能做到的不仅这些，它几乎可以完成`HTTP`的所有操作。\n\n下面来了解下`requests`的一些高级用法，如文件上传、`Cookies`设置、代理设置等。\n\n### 文件上传\n\n`requests`可以模拟提交一些数据。假如有的网站需要上传文件，也可以用它来实现，示例如下：\n\n```python\nimport requests\n\nfiles = {'file':open('baidu.png', 'rb')}\nr = requests.post('http://httpbin.org/post', files=files)\nprint(r.text)\n```\n\n要注意的是，`baidu.png`需要和当前脚本在同一目录下。如果有其他文件，当然也可以使用其他文件来上传，更改下代码即可。运行结果如下：\n\n```shell  \n{\n  \"args\": {}, \n  \"data\": \"\", \n  \"files\": {\n    \"file\": \"data:application/octet-stream;base64,iVBORw0KGgoAAAANSU......\"\n  },\n  \"form\": {},\n  \"headers\": {\n    \"Accept\": \"*/*\",\n    \"Accept-Encoding\": \"gzip, deflate\",\n    \"Content-Length\": \"15589\",\n    \"Content-Type\": \"multipart/form-data; boundary=7e0556b094615781fff3b0ed4316dccd\",\n    \"Host\": \"httpbin.org\",\n    \"User-Agent\": \"python-requests/2.25.1\",\n    \"X-Amzn-Trace-Id\": \"Root=1-60a72501-36f606570785cb9d4356df71\"\n  },\n  \"json\": null,\n  \"origin\": \"202.62.112.143\",\n  \"url\": \"http://httpbin.org/post\"\n}\n```\n\n以上省略部分内容，这个网站会返回响应，里面包含`files`这个字段，而`form`字段是空的，这证明文件上传部分会单独有一个`files`字段来标识。\n\n### Cookies\n\n获取`Cookies`。\n\n```python\nimport requests\n\nr = requests.get('http://www.baidu.com')\nprint(r.cookies)\nfor key, value in r.cookies.items():\n    print(key + '=' + value)\n```\n\n运行结果如下：\n\n```shell\n<RequestsCookieJar[<Cookie BDORZ=27315 for .baidu.com/>]>\nBDORZ=27315\n```\n\n调用`cookies`属性即可成功得到`Cookies`，可以发现它是`RequestCookieJar`类型。然后用`items` 方法将其转化为元组组成的列表，遍历输出每一个`Cookie`的名称和值，实现`Cookie`的遍历解析。\n\n可以直接用`Cookie`来维持登录状态，下面我们以`GitHub`为例来说明一下，首先我们登录`GitHub`，然后将`Headers`中的`Cookie`内容复制下来，如图所示：\n\n![](Screenshot_1.webp)\n\n可以替换成你自己的`Cookie`，将其设置到`Headers`里面，然后发送请求。\n\n### Session维持\n\n在`requests`中，如果直接利用`get`或`post`等方法的确可以做到模拟网页的请求，但是这实际上是相当于不同的`Session`，相当于你用两个浏览器打开了不同的页面。\n\n设想这样一个场景，第一个请求利用`post`方法登录了某个网站，第二次想获取成功登录后的自己的个人信息，又用了一次`get`方法去请求个人信息页面。实际上，这相当于打开了两个浏览器，是两个完全不相关的`Session`，能成功获取个人信息吗？当然不能。\n\n解决这个问题的主要方法就是维持同一个`Session`，相当于打开一个新的浏览器选项卡而不是新开一个浏览器。但我又不想每次设置`Cookies`，那该怎么办呢？这时候就有了新的利器——**`Session`对象**。 利用它，可以方便地维护一个`Session`，而且不用担心`Cookies`的问题，它会帮我们自动处理好。示例如下：\n\n```python\nimport requests\n\nrequests.get('http://httpbin.org/cookies/set/number/123456789', verify=False)\nr = requests.get('http://httpbin.org/cookies', verify=False)\n\nprint(r.text)\n```\n\n运行结果如下：\n\n```python\n{\n  \"cookies\": {}\n}\n```\n\n这并不行。再用 Session试试看：\n\n```python\nimport requests\n\ns = requests.Session()\ns.get('http://httpbin.org/cookies/set/number/123456789')\nr = s.get('http://httpbin.org/cookies')\n\nprint(r.text)\n```\n\n运行结果如下：\n\n```python\n{\n  \"cookies\": {\n    \"number\": \"123456789\"\n  }\n}\n```\n\n利用`Session`，可以做到模拟同一个`Session`而不用担心`Cookies`的问题。它通常用于模拟登录成功之后再进行下一步的操作。\n\n### SSL证书验证\n\n现在很多网站都要求使用`HTTPS`协议，但是有些网站可能并没有设置好`HTTPS`证书，或者网站的`HTTPS`证书不被`CA`机构认可，这时候，这些网站可能就会出现`SSL`证书错误的提示。\n\n比如示例网站：[https://static2.scrape.cuiqingcai.com/](https://static2.scrape.cuiqingcai.com/)。 用浏览器打开这个`URL`，则会提示**「您的连接不是私密连接」**这样的错误，如图所示：\n\n![示例网站](Screenshot_3.webp)\n\n那如果我们一定要爬取这个网站怎么办呢？我们可以使用`verify`参数控制是否验证证书，如果将其设置为`False`，在请求时就不会再验证证书是否有效。如果不加`verify`参数的话，默认值是`True`，会自动验证。\n\n改写代码如下：\n\n```python\nimport requests\nresponse = requests.get('https://static2.scrape.cuiqingcai.com/', verify=False) \nprint(response.status_code) \n```\n\n这样就会打印出请求成功的状态码：\n\n```python\n/usr/local/lib/python3.7/site-packages/urllib3/connectionpool.py:857: InsecureRequestWarning: Unverified HTTPS request is being made. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html\nInsecureRequestWarning) 200 \n```\n\n不过发现报了一个警告，它建议我们给它指定证书。可以通过设置忽略警告的方式来屏蔽这个警告：\n\n```python\nimport requests from requests.packages \nimport urllib3 \n\nurllib3.disable_warnings() \nresponse = requests.get('https://static2.scrape.cuiqingcai.com/', verify=False) \nprint(response.status_code)\n```\n\n或者通过捕获警告到日志的方式忽略警告：\n\n```python\nimport logging \nimport requests \n\nlogging.captureWarnings(True) \nresponse = requests.get('https://static2.scrape.cuiqingcai.com/', verify=False) \nprint(response.status_code)\n```\n\n当然，也可以指定一个本地证书用作客户端证书，这可以是单个文件（包含密钥和证书）或一个包含两个文件路径的元组： \n\n```python\nimport requests response = requests.get('https://static2.scrape.cuiqingcai.com/', cert=('/path/server.crt', '/path/server.key')) \nprint(response.status_code)\n```\n\n上面的代码是演示实例，要有`crt`和`key`文件，并且指定它们的路径。另外注意，本地私有证书的`key`必须是解密状态，加密状态的`key`是不支持的。\n\n### 超时时间\n\n在本机网络状况不好或者服务器网络响应延迟甚至无响应时，可能会等待很久才能收到响应，甚至到最后收不到响应而报错。为了防止服务器不能及时响应，应该设置一个超时时间，即超过了这个时间还没有得到响应，那就报错。这需要用到`timeout`参数。这个时间的计算是发出请求到服务器返回响应的时间。示例如下：\n\n```python\nimport requests \nr = requests.get('https://httpbin.org/get', timeout=1) \nprint(r.status_code)\n```\n\n通过这样的方式将超时时间设置为`1`秒，如果`1`秒内没有响应，那就抛出异常。\n\n实际上，请求分为两个阶段，即连接`（connect）`和读取`（read）`。 上面设置的`timeout`将用作连接和读取这二者的`timeout`总和。\n\n如果要分别指定，就可以传入一个元组：\n\n```python\nr = requests.get('https://httpbin.org/get', timeout=(5, 30))\n```\n\n如果想永久等待，可以直接将`timeout`设置为`None`，或者不设置直接留空，因为默认是`None`。这样的话，如果服务器还在运行，但是响应特别慢，那就慢慢等吧，它永远不会返回超时错误的。其用法如下：\n\n```python\nr = requests.get('https://httpbin.org/get', timeout=None) \n```\n\n或直接不加参数：\n\n```python\nr = requests.get('https://httpbin.org/get')\n```\n\n###　身份认证\n\n在访问某些设置了身份认证的网站时，例如：[https://static3.scrape.cuiqingcai.com/](https://static3.scrape.cuiqingcai.com/)，我们可能会遇到这样的认证窗口，如图所示：\n\n![认证](Screenshot_4.webp)\n\n如果遇到了这种情况，那就是这个网站启用了基本身份认证，英文叫作`HTTP Basic Access Authentication`，它是一种用来允许网页浏览器或其他客户端程序在请求时提供**用户名**和**口令形式**的身份凭证的一种登录验证方式。 如果遇到了这种情况，怎么用`reqeusts`来爬取呢，当然也有办法。\n\n可以使用`requests`自带的身份认证功能，通过`auth`参数即可设置，示例如下：\n\n```python\nimport requests\nfrom requests.auth import HTTPBasicAuth\n\nr = requests.get('https://static3.scrape.cuiqingcai.com/', auth=HTTPBasicAuth('admin', 'admin'), verify=False)\nprint(r.status_code)\n```\n\n成功的话，返回状态码`200`。\n\n如果参数都传一个`HTTPBasicAuth`类，就显得有点烦琐了，所以`requests`提供了一个更简单的写法，可以直接传一个元组，它会默认使用`HTTPBasicAuth`这个类来认证。\n\n上面的代码可以直接简写如下：\n\n```python\nimport requests\nr = requests.get('https://static3.scrape.cuiqingcai.com/', auth=('admin', 'admin'))\nprint(r.status_code)\n```\n\n此外，`requests`还提供了其他认证方式，如`OAuth`认证，不过此时需要安装`oauth`包，安装命令如下：\n\n```python\npip3 install requests_oauthlib\n```\n\n使用`OAuth1`认证的方法如下：\n\n```python\nimport requests from requests_oauthlib \nimport OAuth1 \nurl = 'https://api.twitter.com/1.1/account/verify_credentials.json' \nauth = OAuth1('YOUR_APP_KEY', 'YOUR_APP_SECRET', 'USER_OAUTH_TOKEN', 'USER_OAUTH_TOKEN_SECRET')\nrequests.get(url, auth=auth) \n```\n\n更多详细的功能就可以参考`requests_oauthlib`的官方文档：[https://requests-oauthlib.readthedocs.org/](https://requests-oauthlib.readthedocs.org/)，不再赘述。\n\n### 代理设置\n\n某些网站在测试的时候请求几次，能正常获取内容。但是对于大规模且频繁的请求，网站可能会弹出验证码，或者跳转到登录认证页面，更甚者可能会直接封禁客户端的`IP`，导致一定时间段内无法访问。\n\n为了防止这种情况发生，我们需要设置代理来解决这个问题，这就需要用到`proxies`参数。可以用这样的方式设置：\n\n```python\nimport requests\nproxies = { \n  'http': 'http://10.10.10.10:1080', \n  'https': 'http://10.10.10.10:1080', \n}\nrequests.get('https://httpbin.org/get', proxies=proxies) \n```\n\n当然，直接运行这个实例或许行不通，因为这个代理可能是无效的，可以直接搜索寻找有效的代理并替换试验一下。\n\n若代理需要使用上文所述的身份认证，可以使用类似`ttp://user:password@host:port`这样的语法来设置代理，示例如下：\n\n```python\nimport requests\nproxies = {'https': 'http://user:password@10.10.10.10:1080/',} \nrequests.get('https://httpbin.org/get', proxies=proxies)\n```\n\n除了基本的`HTTP`代理外，`requests`还支持`SOCKS`协议的代理。\n\n首先，需要安装`socks`这个库：\n\n```python\npip3 install \"requests[socks]\"\n```\n\n然后就可以使用`SOCKS`协议代理了，示例如下：\n\n```python\nimport requests\nproxies = { \n  'http': 'socks5://user:password@host:port', \n  'https': 'socks5://user:password@host:port' \n}\nrequests.get('https://httpbin.org/get', proxies=proxies)\n```\n","slug":"requests库的基本使用","published":1,"updated":"2021-06-15T03:24:11.496Z","layout":"post","photos":[],"link":"","_id":"ckq14rx3w007f44udclyzgk0i","content":"<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p><code>requests</code>是一个第三方库，使用<code>pip</code>下载安装。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install requests</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实例引入\"><a href=\"#实例引入\" class=\"headerlink\" title=\"实例引入\"></a>实例引入</h2><p>用<code>Python</code>写爬虫的第一步就是模拟发起一个请求，把网页的源代码获取下来。</p>\n<p>在浏览器中输入一个<code>URL</code>并回车，实际上就是让浏览器帮我们发起一个<code>GET</code>类型的<code>HTTP</code>请求，浏览器得到源代码后，把它渲染出来就可以看到网页内容了。</p>\n<p>那如果想用<code>requests</code>来获取源代码，应该怎么办呢？很简单，<code>requests</code>这个库提供了一个<code>get</code>方法，调用这个方法，并传入对应的<code>URL</code>就能得到网页的源代码。</p>\n<p>比如这里有一个示例网站:<a href=\"https://static1.scrape.cuiqingcai.com/\">https://static1.scrape.cuiqingcai.com/</a>，其内容如下：</p>\n<p><img src=\"Screenshot_2.webp\" alt=\"示列网站\"></p>\n<p>这个网站展示了一些电影数据，如果想要把这个网页里面的数据爬下来，比如获取各个电影的名称、上映时间等信息，然后把它存下来的话，该怎么做呢？</p>\n<p>第一步当然就是获取它的网页源代码了。</p>\n<p>可以用<code>requests</code>这个库轻松地完成这个过程，代码的写法是这样的：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(url=<span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>输出结果如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width,initial-scale=1&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;icon&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/static/img/favicon.ico&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Scrape | Movie<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/static/css/app.css&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/css&quot;</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/static/css/index.css&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/css&quot;</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-v-74e8b908</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;el-row&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;header&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-v-74e8b908</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container el-col el-col-18 el-col-offset-3&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-v-74e8b908</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;el-row&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-v-74e8b908</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;logo el-col el-col-4&quot;</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">data-v-74e8b908</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;router-link-exact-active router-link-active&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">data-v-74e8b908</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;/static/img/logo.png&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;logo-image&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">data-v-74e8b908</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;logo-title&quot;</span>&gt;</span>Scrape<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;number&quot;</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/page/7&quot;</span>&gt;</span>7<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;number&quot;</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/page/8&quot;</span>&gt;</span>8<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;number&quot;</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/page/9&quot;</span>&gt;</span>9<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;number&quot;</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/page/10&quot;</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">          </span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/page/2&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;next&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;button&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-next&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;el-icon el-icon-arrow-right&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">          </span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">Process finished with exit code 0</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>由于网页内容比较多，这里省略了大部分内容。</p>\n<p>不过看运行结果，我们已经成功获取网页的<code>HTML</code>源代码，里面包含了电影的标题、类型、上映时间，等等。</p>\n<p>把网页源代码获取下来之后，下一步我们把想要的数据提取出来，数据的爬取就完成了。</p>\n<h2 id=\"请求\"><a href=\"#请求\" class=\"headerlink\" title=\"请求\"></a>请求</h2><p><code>HTTP</code>中最常见的请求之一就是<code>GET</code>请求。</p>\n<h3 id=\"GET请求\"><a href=\"#GET请求\" class=\"headerlink\" title=\"GET请求\"></a><code>GET</code>请求</h3><p>换一个示例网站，其<code>URL</code>为<a href=\"http://httpbin.org/get\">http://httpbin.org/get</a>，如果客户端发起的是<code>GET</code>请求的话，该网站会判断并返回相应的请求信息，包括 <code>Headers</code>、<code>IP</code>等。 我们还是用相同的方法来发起一个<code>GET请求</code>，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(url=<span class=\"string\">&#x27;http://httpbin.org/get&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>返回结果：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;args&quot;: &#123;&#125;, </span><br><span class=\"line\">  &quot;headers&quot;: &#123;</span><br><span class=\"line\">    &quot;Accept&quot;: &quot;*/*&quot;,</span><br><span class=\"line\">    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,</span><br><span class=\"line\">    &quot;Host&quot;: &quot;httpbin.org&quot;,</span><br><span class=\"line\">    &quot;User-Agent&quot;: &quot;python-requests/2.25.1&quot;,</span><br><span class=\"line\">    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-60a3a8ad-070f8b95711f7821709e24ed&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;origin&quot;: &quot;202.62.113.207&quot;,</span><br><span class=\"line\">  &quot;url&quot;: &quot;http://httpbin.org/get&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以发现，成功发起了<code>GET</code>请求，也通过这个网站的返回结果得到了请求所携带的信息，包括<code>Headers</code>、<code>URL</code>、<code>IP</code>，等等。</p>\n<p>对于<code>GET</code>请求，我们知道<code>URL</code>后面是可以跟上一些参数的，如果我们现在想添加两个参数，其中<code>name</code>是<code>germey</code>，<code>age</code>是<code>25</code>，<code>URL</code>就可以写成如下内容：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://httpbin.org/get?name=germey&amp;age=<span class=\"number\">25</span></span><br></pre></td></tr></table></figure>\n\n<p>要构造这个请求链接，是不是要直接写成这样呢？</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;http://httpbin.org/get?name=germey&amp;age=25&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这样也可以，但如果这些参数还需要手动拼接，未免有点不人性化。</p>\n<p>一般情况下，这种信息我们利用<code>params</code>这个参数就可以直接传递了，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">data = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;holy&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"number\">25</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(url=<span class=\"string\">&#x27;http://httpbin.org/get&#x27;</span>, params=data, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>返回结果：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;args&quot;: &#123;</span><br><span class=\"line\">    &quot;age&quot;: &quot;25&quot;,</span><br><span class=\"line\">    &quot;name&quot;: &quot;holy&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;headers&quot;: &#123;</span><br><span class=\"line\">    &quot;Accept&quot;: &quot;*/*&quot;,</span><br><span class=\"line\">    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,</span><br><span class=\"line\">    &quot;Host&quot;: &quot;httpbin.org&quot;,</span><br><span class=\"line\">    &quot;User-Agent&quot;: &quot;python-requests/2.25.1&quot;,</span><br><span class=\"line\">    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-60a3ab05-51321f5c7eeb7b0573bb5510&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;origin&quot;: &quot;202.62.113.207&quot;,</span><br><span class=\"line\">  &quot;url&quot;: &quot;http://httpbin.org/get?name=holy&amp;age=25&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>把<code>URL</code>参数通过字典的形式传给<code>get</code>方法的<code>params</code>参数，通过返回信息可以判断，请求的链接自动被构造成了：<em><a href=\"http://httpbin.org/get?age=22&amp;name=germey\">http://httpbin.org/get?age=22&amp;name=germey</a></em>。</p>\n<p>网页的返回类型实际上是<code>str</code>类型，但是它很特殊，是<code>JSON</code>格式的。所以，如果想直接解析返回结果，得到一个<code>JSON</code>格式的数据的话，可以直接调用<code>json</code>方法。</p>\n<p>示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">data = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;holy&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"number\">25</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(url=<span class=\"string\">&#x27;http://httpbin.org/get&#x27;</span>, params=data, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(r.text))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.json())</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(r.json()))</span><br></pre></td></tr></table></figure>\n\n<p>结果如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;class &#x27;str&#x27;&gt;</span><br><span class=\"line\">&#123;&#x27;args&#x27;: &#123;&#x27;age&#x27;: &#x27;25&#x27;, &#x27;name&#x27;: &#x27;holy&#x27;&#125;, &#x27;headers&#x27;: &#123;&#x27;Accept&#x27;: &#x27;*/*&#x27;, &#x27;Accept-Encoding&#x27;: &#x27;gzip, deflate&#x27;, &#x27;Host&#x27;: &#x27;httpbin.org&#x27;, &#x27;User-Agent&#x27;: &#x27;python-requests/2.25.1&#x27;, &#x27;X-Amzn-Trace-Id&#x27;: &#x27;Root=1-60a3ac52-425e713a2907d0302f298070&#x27;&#125;, &#x27;origin&#x27;: &#x27;202.62.113.207&#x27;, &#x27;url&#x27;: &#x27;http://httpbin.org/get?name=holy&amp;age=25&#x27;&#125;</span><br><span class=\"line\">&lt;class &#x27;dict&#x27;&gt;</span><br></pre></td></tr></table></figure>\n\n<p>调用<code>json</code>方法，就可以将返回结果是<code>JSON</code>格式的字符串转化为字典。 但需要注意的是，如果返回结果不是<code>JSON</code>格式，便会出现解析错误，抛出<code>json.decoder.JSONDecodeError</code>异常。</p>\n<h3 id=\"抓取网页\"><a href=\"#抓取网页\" class=\"headerlink\" title=\"抓取网页\"></a>抓取网页</h3><p>上面的请求链接返回的是<code>JSON</code>形式的字符串，那么如果请求普通的网页，则肯定能获得相应的内容。下面以本课时最初的实例页面为例，我们再加上一点提取信息的逻辑，将代码完善成如下的样子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">pattern = re.<span class=\"built_in\">compile</span>(<span class=\"string\">&#x27;&lt;h2.*?&gt;(.*?)&lt;/h2&gt;&#x27;</span>, re.S)</span><br><span class=\"line\">titles = re.findall(pattern, r.text)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(titles)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">&#x27;霸王别姬 - Farewell My Concubine&#x27;</span>, <span class=\"string\">&#x27;这个杀手不太冷 - Léon&#x27;</span>, <span class=\"string\">&#x27;肖申克的救赎 - The Shawshank Redemption&#x27;</span>, <span class=\"string\">&#x27;泰坦尼克号 - Titanic&#x27;</span>, <span class=\"string\">&#x27;罗马假日 - Roman Holiday&#x27;</span>, <span class=\"string\">&#x27;唐伯虎点秋香 - Flirting Scholar&#x27;</span>, <span class=\"string\">&#x27;乱世佳人 - Gone with the Wind&#x27;</span>, <span class=\"string\">&#x27;喜剧之王 - The King of Comedy&#x27;</span>, <span class=\"string\">&#x27; 楚门的世界 - The Truman Show&#x27;</span>, <span class=\"string\">&#x27;狮子王 - The Lion King&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"抓取二进制数据\"><a href=\"#抓取二进制数据\" class=\"headerlink\" title=\"抓取二进制数据\"></a>抓取二进制数据</h3><p>抓取的是网站的一个页面，实际上它返回的是一个<code>HTML</code>文档。如果想抓取图片、音频、视频等文件，应该怎么办呢？</p>\n<p>图片、音频、视频这些文件本质上都是由<strong>二进制码</strong>组成的，由于有特定的保存格式和对应的解析方式，我们才可以看到这些形形色色的多媒体。所以，想要抓取它们，就要拿到它们的二进制数据。</p>\n<p>下面以 GitHub 的站点图标为例来看一下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://github.com/favicon.ico&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.content)</span><br></pre></td></tr></table></figure>\n\n<p>这里抓取的内容是站点图标，也就是在浏览器每一个标签上显示的小图标。</p>\n<p>前者出现了乱码，后者结果前带有一个<code>b</code>，这代表是<code>bytes</code>类型的数据。</p>\n<p>由于图片是二进制数据，所以前者在打印时转化为<code>str</code>类型，也就是图片直接转化为字符串，这当然会出现乱码。</p>\n<p>上面返回的结果我们并不能看懂，它实际上是图片的二进制数据，没关系，将刚才提取到的信息保存下来就好了，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests </span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png&#x27;</span>, verify=<span class=\"literal\">False</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;baidu.png&#x27;</span>, <span class=\"string\">&#x27;wb&#x27;</span>) <span class=\"keyword\">as</span> f: </span><br><span class=\"line\">    f.write(r.content)</span><br></pre></td></tr></table></figure>\n\n<p>这里用了<code>open</code>方法，它的第一个参数是文件名称，第二个参数代表以二进制的形式打开，可以向文件里写入二进制数据。</p>\n<p>运行结束之后，可以发现在文件夹中出现了名为<code>baidu.png</code>的图标。</p>\n<h3 id=\"添加添headers\"><a href=\"#添加添headers\" class=\"headerlink\" title=\"添加添headers\"></a>添加添headers</h3><p>在发起一个<code>HTTP</code>请求的时候，会有一个请求头<code>Request Headers</code>，那么这个怎么来设置呢？</p>\n<p>很简单，使用<code>headers</code>参数就可以完成了。</p>\n<p>在刚才的实例中，是没有设置<code>Request Headers</code>信息的，如果不设置，某些网站会发现这不是一个正常的浏览器发起的请求，网站可能会返回异常的结果，导致网页抓取失败。</p>\n<p>要添加<code>Headers</code>信息，比如添加一个<code>User-Agent</code>字段，可以这么写：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">headers = &#123; </span><br><span class=\"line\">    <span class=\"string\">&#x27;User-Agent&#x27;</span>: <span class=\"string\">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, headers=headers, verify=<span class=\"literal\">False</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>当然，我们可以在<code>headers</code>这个参数中任意添加其他的字段信息。</p>\n<h3 id=\"POST请求\"><a href=\"#POST请求\" class=\"headerlink\" title=\"POST请求\"></a>POST请求</h3><p>使用<code>requests</code>实现<code>post</code>请求，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">data = &#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;germey&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;25&#x27;</span>&#125;</span><br><span class=\"line\">r = requests.post(<span class=\"string\">&quot;http://httpbin.org/post&quot;</span>, data=data)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>这里还是请求<a href=\"http://httpbin.org/post\">http://httpbin.org/post</a>，该网站可以判断如果请求是<code>POST</code>方式，就把相关请求信息返回。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;args&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;data&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;files&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;form&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;age&quot;</span>: <span class=\"string\">&quot;25&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;germey&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;headers&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;Accept&quot;</span>: <span class=\"string\">&quot;*/*&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;Accept-Encoding&quot;</span>: <span class=\"string\">&quot;gzip, deflate&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;Content-Length&quot;</span>: <span class=\"string\">&quot;18&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;Content-Type&quot;</span>: <span class=\"string\">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;Host&quot;</span>: <span class=\"string\">&quot;httpbin.org&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;User-Agent&quot;</span>: <span class=\"string\">&quot;python-requests/2.25.1&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;X-Amzn-Trace-Id&quot;</span>: <span class=\"string\">&quot;Root=1-60a402c2-68a523624a9ca353207a3a5e&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;json&quot;</span>: null,</span><br><span class=\"line\">  <span class=\"string\">&quot;origin&quot;</span>: <span class=\"string\">&quot;202.62.113.207&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;url&quot;</span>: <span class=\"string\">&quot;http://httpbin.org/post&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"响应\"><a href=\"#响应\" class=\"headerlink\" title=\"响应\"></a>响应</h3><p>发送请求后，得到的就是响应，即<code>Response</code>。</p>\n<p>在上面的实例中，使用<code>text</code>和<code>content</code>获取了响应的内容。此外，还有很多属性和方法可以用来获取其他信息，比如<code>状态码</code>、<code>响应头</code>、<code>Cookies</code>等。示例如下:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(r.status_code), r.status_code)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(r.headers), r.headers)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(r.cookies), r.cookies)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(r.url), r.url)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(r.history), r.history)</span><br></pre></td></tr></table></figure>\n\n<p>这里分别打印输出<code>status_code</code>属性得到状态码，输出<code>headers</code>属性得到响应头，输出<code>cookies</code>属性得到<code>Cookies</code>，输出<code>url</code>属性得到<code>URL</code>，输出<code>history</code>属性得到请求历史。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">int</span>&#x27;&gt; 200</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">requests</span>.<span class=\"title\">structures</span>.<span class=\"title\">CaseInsensitiveDict</span>&#x27;&gt; &#123;&#x27;<span class=\"title\">Date</span>&#x27;:</span> <span class=\"string\">&#x27;Wed, 19 May 2021 12:52:03 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html; charset=utf-8&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;41538&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;X-Frame-Options&#x27;</span>: <span class=\"string\">&#x27;DENY&#x27;</span>, <span class=\"string\">&#x27;X-Content-Type-Options&#x27;</span>: <span class=\"string\">&#x27;nosniff&#x27;</span>, <span class=\"string\">&#x27;Expires&#x27;</span>: <span class=\"string\">&#x27;Wed, 19 May 2021 13:01:46 GMT&#x27;</span>, <span class=\"string\">&#x27;Cache-Control&#x27;</span>: <span class=\"string\">&#x27;max-age=600&#x27;</span>, <span class=\"string\">&#x27;Strict-Transport-Security&#x27;</span>: <span class=\"string\">&#x27;max-age=15724800; includeSubDomains&#x27;</span>&#125;</span><br><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">requests</span>.<span class=\"title\">cookies</span>.<span class=\"title\">RequestsCookieJar</span>&#x27;&gt; &lt;<span class=\"title\">RequestsCookieJar</span>[]&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">str</span>&#x27;&gt; <span class=\"title\">https</span>:</span>//static1.scrape.cuiqingcai.com/</span><br><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">list</span>&#x27;&gt; []</span></span><br></pre></td></tr></table></figure>\n\n<p><code>headers</code>和<code>cookies</code>这两个属性得到的结果分别是<code>CaseInsensitiveDict</code>和<code>RequestsCookieJar</code>类型。</p>\n<p>状态码是用来表示响应状态的，比如返回<code>200</code>代表我们得到的响应是没问题的，上面的例子正好输出的结果也是<code>200</code>，所以可以通过判断<code>Response</code>的状态码来确认是否爬取成功。</p>\n<p><code>requests</code>还提供了一个内置的状态码查询对象<code>requests.codes</code>，用法示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">exit() <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> r.status_code == requests.codes.ok <span class=\"keyword\">else</span> <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Request successfully&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这里通过比较返回码和内置的成功的返回码，来保证请求得到了正常响应，输出成功请求的消息，否则程序终止，这里我们用<code>requests.codes.ok</code>得到的是成功的状态码<code>200</code>。</p>\n<p>这样的话，我们就不用再在程序里面写状态码对应的数字了，用字符串表示状态码会显得更加直观。</p>\n<p>下面列出了返回码和相应的查询条件：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 信息性状态码</span></span><br><span class=\"line\"><span class=\"number\">100</span>: (<span class=\"string\">&#x27;continue&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">101</span>: (<span class=\"string\">&#x27;switching_protocols&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">102</span>: (<span class=\"string\">&#x27;processing&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">103</span>: (<span class=\"string\">&#x27;checkpoint&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">122</span>: (<span class=\"string\">&#x27;uri_too_long&#x27;</span>, <span class=\"string\">&#x27;request_uri_too_long&#x27;</span>),</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 成功状态码</span></span><br><span class=\"line\"><span class=\"number\">200</span>: (<span class=\"string\">&#x27;ok&#x27;</span>, <span class=\"string\">&#x27;okay&#x27;</span>, <span class=\"string\">&#x27;all_ok&#x27;</span>, <span class=\"string\">&#x27;all_okay&#x27;</span>, <span class=\"string\">&#x27;all_good&#x27;</span>, <span class=\"string\">&#x27;\\\\o/&#x27;</span>, <span class=\"string\">&#x27;✓&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">201</span>: (<span class=\"string\">&#x27;created&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">202</span>: (<span class=\"string\">&#x27;accepted&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">203</span>: (<span class=\"string\">&#x27;non_authoritative_info&#x27;</span>, <span class=\"string\">&#x27;non_authoritative_information&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">204</span>: (<span class=\"string\">&#x27;no_content&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">205</span>: (<span class=\"string\">&#x27;reset_content&#x27;</span>, <span class=\"string\">&#x27;reset&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">206</span>: (<span class=\"string\">&#x27;partial_content&#x27;</span>, <span class=\"string\">&#x27;partial&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">207</span>: (<span class=\"string\">&#x27;multi_status&#x27;</span>, <span class=\"string\">&#x27;multiple_status&#x27;</span>, <span class=\"string\">&#x27;multi_stati&#x27;</span>, <span class=\"string\">&#x27;multiple_stati&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">208</span>: (<span class=\"string\">&#x27;already_reported&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">226</span>: (<span class=\"string\">&#x27;im_used&#x27;</span>,),</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重定向状态码</span></span><br><span class=\"line\"><span class=\"number\">300</span>: (<span class=\"string\">&#x27;multiple_choices&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">301</span>: (<span class=\"string\">&#x27;moved_permanently&#x27;</span>, <span class=\"string\">&#x27;moved&#x27;</span>, <span class=\"string\">&#x27;\\\\o-&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">302</span>: (<span class=\"string\">&#x27;found&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">303</span>: (<span class=\"string\">&#x27;see_other&#x27;</span>, <span class=\"string\">&#x27;other&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">304</span>: (<span class=\"string\">&#x27;not_modified&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">305</span>: (<span class=\"string\">&#x27;use_proxy&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">306</span>: (<span class=\"string\">&#x27;switch_proxy&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">307</span>: (<span class=\"string\">&#x27;temporary_redirect&#x27;</span>, <span class=\"string\">&#x27;temporary_moved&#x27;</span>, <span class=\"string\">&#x27;temporary&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">308</span>: (<span class=\"string\">&#x27;permanent_redirect&#x27;</span>, <span class=\"string\">&#x27;resume_incomplete&#x27;</span>, <span class=\"string\">&#x27;resume&#x27;</span>,), <span class=\"comment\"># These 2 to be removed in 3.0 </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 客户端错误状态码 </span></span><br><span class=\"line\"><span class=\"number\">400</span>: (<span class=\"string\">&#x27;bad_request&#x27;</span>, <span class=\"string\">&#x27;bad&#x27;</span>), </span><br><span class=\"line\"><span class=\"number\">401</span>: (<span class=\"string\">&#x27;unauthorized&#x27;</span>,), </span><br><span class=\"line\"><span class=\"number\">402</span>: (<span class=\"string\">&#x27;payment_required&#x27;</span>, <span class=\"string\">&#x27;payment&#x27;</span>), </span><br><span class=\"line\"><span class=\"number\">403</span>: (<span class=\"string\">&#x27;forbidden&#x27;</span>,), </span><br><span class=\"line\"><span class=\"number\">404</span>: (<span class=\"string\">&#x27;not_found&#x27;</span>, <span class=\"string\">&#x27;-o-&#x27;</span>), </span><br><span class=\"line\"><span class=\"number\">405</span>: (<span class=\"string\">&#x27;method_not_allowed&#x27;</span>, <span class=\"string\">&#x27;not_allowed&#x27;</span>), </span><br><span class=\"line\"><span class=\"number\">406</span>: (<span class=\"string\">&#x27;not_acceptable&#x27;</span>,), </span><br><span class=\"line\"><span class=\"number\">407</span>: (<span class=\"string\">&#x27;proxy_authentication_required&#x27;</span>, <span class=\"string\">&#x27;proxy_auth&#x27;</span>, <span class=\"string\">&#x27;proxy_authentication&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">408</span>: (<span class=\"string\">&#x27;request_timeout&#x27;</span>, <span class=\"string\">&#x27;timeout&#x27;</span>), </span><br><span class=\"line\"><span class=\"number\">409</span>: (<span class=\"string\">&#x27;conflict&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">410</span>: (<span class=\"string\">&#x27;gone&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">411</span>: (<span class=\"string\">&#x27;length_required&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">412</span>: (<span class=\"string\">&#x27;precondition_failed&#x27;</span>, <span class=\"string\">&#x27;precondition&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">413</span>: (<span class=\"string\">&#x27;request_entity_too_large&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">414</span>: (<span class=\"string\">&#x27;request_uri_too_large&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">415</span>: (<span class=\"string\">&#x27;unsupported_media_type&#x27;</span>, <span class=\"string\">&#x27;unsupported_media&#x27;</span>, <span class=\"string\">&#x27;media_type&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">416</span>: (<span class=\"string\">&#x27;requested_range_not_satisfiable&#x27;</span>, <span class=\"string\">&#x27;requested_range&#x27;</span>, <span class=\"string\">&#x27;range_not_satisfiable&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">417</span>: (<span class=\"string\">&#x27;expectation_failed&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">418</span>: (<span class=\"string\">&#x27;im_a_teapot&#x27;</span>, <span class=\"string\">&#x27;teapot&#x27;</span>, <span class=\"string\">&#x27;i_am_a_teapot&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">421</span>: (<span class=\"string\">&#x27;misdirected_request&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">422</span>: (<span class=\"string\">&#x27;unprocessable_entity&#x27;</span>, <span class=\"string\">&#x27;unprocessable&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">423</span>: (<span class=\"string\">&#x27;locked&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">424</span>: (<span class=\"string\">&#x27;failed_dependency&#x27;</span>, <span class=\"string\">&#x27;dependency&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">425</span>: (<span class=\"string\">&#x27;unordered_collection&#x27;</span>, <span class=\"string\">&#x27;unordered&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">426</span>: (<span class=\"string\">&#x27;upgrade_required&#x27;</span>, <span class=\"string\">&#x27;upgrade&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">428</span>: (<span class=\"string\">&#x27;precondition_required&#x27;</span>, <span class=\"string\">&#x27;precondition&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">429</span>: (<span class=\"string\">&#x27;too_many_requests&#x27;</span>, <span class=\"string\">&#x27;too_many&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">431</span>: (<span class=\"string\">&#x27;header_fields_too_large&#x27;</span>, <span class=\"string\">&#x27;fields_too_large&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">444</span>: (<span class=\"string\">&#x27;no_response&#x27;</span>, <span class=\"string\">&#x27;none&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">449</span>: (<span class=\"string\">&#x27;retry_with&#x27;</span>, <span class=\"string\">&#x27;retry&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">450</span>: (<span class=\"string\">&#x27;blocked_by_windows_parental_controls&#x27;</span>, <span class=\"string\">&#x27;parental_controls&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">451</span>: (<span class=\"string\">&#x27;unavailable_for_legal_reasons&#x27;</span>, <span class=\"string\">&#x27;legal_reasons&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">499</span>: (<span class=\"string\">&#x27;client_closed_request&#x27;</span>,), </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 服务端错误状态码</span></span><br><span class=\"line\"><span class=\"number\">500</span>: (<span class=\"string\">&#x27;internal_server_error&#x27;</span>, <span class=\"string\">&#x27;server_error&#x27;</span>, <span class=\"string\">&#x27;/o\\\\&#x27;</span>, <span class=\"string\">&#x27;✗&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">501</span>: (<span class=\"string\">&#x27;not_implemented&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">502</span>: (<span class=\"string\">&#x27;bad_gateway&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">503</span>: (<span class=\"string\">&#x27;service_unavailable&#x27;</span>, <span class=\"string\">&#x27;unavailable&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">504</span>: (<span class=\"string\">&#x27;gateway_timeout&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">505</span>: (<span class=\"string\">&#x27;http_version_not_supported&#x27;</span>, <span class=\"string\">&#x27;http_version&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">506</span>: (<span class=\"string\">&#x27;variant_also_negotiates&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">507</span>: (<span class=\"string\">&#x27;insufficient_storage&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">509</span>: (<span class=\"string\">&#x27;bandwidth_limit_exceeded&#x27;</span>, <span class=\"string\">&#x27;bandwidth&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">510</span>: (<span class=\"string\">&#x27;not_extended&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">511</span>: (<span class=\"string\">&#x27;network_authentication_required&#x27;</span>, <span class=\"string\">&#x27;network_auth&#x27;</span>, <span class=\"string\">&#x27;network_authentication&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>比如，如果想判断结果是不是<code>404</code>状态，可以用<code>requests.codes.not_found</code>来比对。</p>\n<h2 id=\"高级用法\"><a href=\"#高级用法\" class=\"headerlink\" title=\"高级用法\"></a>高级用法</h2><p>刚才，了解<code>requests</code>的基本用法，如基本的<code>GET、POST</code>请求以及<code>Response</code>对象。当然<code>requests</code>能做到的不仅这些，它几乎可以完成<code>HTTP</code>的所有操作。</p>\n<p>下面来了解下<code>requests</code>的一些高级用法，如文件上传、<code>Cookies</code>设置、代理设置等。</p>\n<h3 id=\"文件上传\"><a href=\"#文件上传\" class=\"headerlink\" title=\"文件上传\"></a>文件上传</h3><p><code>requests</code>可以模拟提交一些数据。假如有的网站需要上传文件，也可以用它来实现，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">files = &#123;<span class=\"string\">&#x27;file&#x27;</span>:<span class=\"built_in\">open</span>(<span class=\"string\">&#x27;baidu.png&#x27;</span>, <span class=\"string\">&#x27;rb&#x27;</span>)&#125;</span><br><span class=\"line\">r = requests.post(<span class=\"string\">&#x27;http://httpbin.org/post&#x27;</span>, files=files)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>要注意的是，<code>baidu.png</code>需要和当前脚本在同一目录下。如果有其他文件，当然也可以使用其他文件来上传，更改下代码即可。运行结果如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;args&quot;: &#123;&#125;, </span><br><span class=\"line\">  &quot;data&quot;: &quot;&quot;, </span><br><span class=\"line\">  &quot;files&quot;: &#123;</span><br><span class=\"line\">    &quot;file&quot;: &quot;data:application/octet-stream;base64,iVBORw0KGgoAAAANSU......&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;form&quot;: &#123;&#125;,</span><br><span class=\"line\">  &quot;headers&quot;: &#123;</span><br><span class=\"line\">    &quot;Accept&quot;: &quot;*/*&quot;,</span><br><span class=\"line\">    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,</span><br><span class=\"line\">    &quot;Content-Length&quot;: &quot;15589&quot;,</span><br><span class=\"line\">    &quot;Content-Type&quot;: &quot;multipart/form-data; boundary=7e0556b094615781fff3b0ed4316dccd&quot;,</span><br><span class=\"line\">    &quot;Host&quot;: &quot;httpbin.org&quot;,</span><br><span class=\"line\">    &quot;User-Agent&quot;: &quot;python-requests/2.25.1&quot;,</span><br><span class=\"line\">    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-60a72501-36f606570785cb9d4356df71&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;json&quot;: null,</span><br><span class=\"line\">  &quot;origin&quot;: &quot;202.62.112.143&quot;,</span><br><span class=\"line\">  &quot;url&quot;: &quot;http://httpbin.org/post&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>以上省略部分内容，这个网站会返回响应，里面包含<code>files</code>这个字段，而<code>form</code>字段是空的，这证明文件上传部分会单独有一个<code>files</code>字段来标识。</p>\n<h3 id=\"Cookies\"><a href=\"#Cookies\" class=\"headerlink\" title=\"Cookies\"></a>Cookies</h3><p>获取<code>Cookies</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;http://www.baidu.com&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.cookies)</span><br><span class=\"line\"><span class=\"keyword\">for</span> key, value <span class=\"keyword\">in</span> r.cookies.items():</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(key + <span class=\"string\">&#x27;=&#x27;</span> + value)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;RequestsCookieJar[&lt;Cookie BDORZ=27315 for .baidu.com/&gt;]&gt;</span><br><span class=\"line\">BDORZ=27315</span><br></pre></td></tr></table></figure>\n\n<p>调用<code>cookies</code>属性即可成功得到<code>Cookies</code>，可以发现它是<code>RequestCookieJar</code>类型。然后用<code>items</code> 方法将其转化为元组组成的列表，遍历输出每一个<code>Cookie</code>的名称和值，实现<code>Cookie</code>的遍历解析。</p>\n<p>可以直接用<code>Cookie</code>来维持登录状态，下面我们以<code>GitHub</code>为例来说明一下，首先我们登录<code>GitHub</code>，然后将<code>Headers</code>中的<code>Cookie</code>内容复制下来，如图所示：</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>可以替换成你自己的<code>Cookie</code>，将其设置到<code>Headers</code>里面，然后发送请求。</p>\n<h3 id=\"Session维持\"><a href=\"#Session维持\" class=\"headerlink\" title=\"Session维持\"></a>Session维持</h3><p>在<code>requests</code>中，如果直接利用<code>get</code>或<code>post</code>等方法的确可以做到模拟网页的请求，但是这实际上是相当于不同的<code>Session</code>，相当于你用两个浏览器打开了不同的页面。</p>\n<p>设想这样一个场景，第一个请求利用<code>post</code>方法登录了某个网站，第二次想获取成功登录后的自己的个人信息，又用了一次<code>get</code>方法去请求个人信息页面。实际上，这相当于打开了两个浏览器，是两个完全不相关的<code>Session</code>，能成功获取个人信息吗？当然不能。</p>\n<p>解决这个问题的主要方法就是维持同一个<code>Session</code>，相当于打开一个新的浏览器选项卡而不是新开一个浏览器。但我又不想每次设置<code>Cookies</code>，那该怎么办呢？这时候就有了新的利器——**<code>Session</code>对象**。 利用它，可以方便地维护一个<code>Session</code>，而且不用担心<code>Cookies</code>的问题，它会帮我们自动处理好。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">requests.get(<span class=\"string\">&#x27;http://httpbin.org/cookies/set/number/123456789&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;http://httpbin.org/cookies&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;cookies&quot;</span>: &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这并不行。再用 Session试试看：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">s = requests.Session()</span><br><span class=\"line\">s.get(<span class=\"string\">&#x27;http://httpbin.org/cookies/set/number/123456789&#x27;</span>)</span><br><span class=\"line\">r = s.get(<span class=\"string\">&#x27;http://httpbin.org/cookies&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;cookies&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;number&quot;</span>: <span class=\"string\">&quot;123456789&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>利用<code>Session</code>，可以做到模拟同一个<code>Session</code>而不用担心<code>Cookies</code>的问题。它通常用于模拟登录成功之后再进行下一步的操作。</p>\n<h3 id=\"SSL证书验证\"><a href=\"#SSL证书验证\" class=\"headerlink\" title=\"SSL证书验证\"></a>SSL证书验证</h3><p>现在很多网站都要求使用<code>HTTPS</code>协议，但是有些网站可能并没有设置好<code>HTTPS</code>证书，或者网站的<code>HTTPS</code>证书不被<code>CA</code>机构认可，这时候，这些网站可能就会出现<code>SSL</code>证书错误的提示。</p>\n<p>比如示例网站：<a href=\"https://static2.scrape.cuiqingcai.com/\">https://static2.scrape.cuiqingcai.com/</a>。 用浏览器打开这个<code>URL</code>，则会提示<strong>「您的连接不是私密连接」</strong>这样的错误，如图所示：</p>\n<p><img src=\"Screenshot_3.webp\" alt=\"示例网站\"></p>\n<p>那如果我们一定要爬取这个网站怎么办呢？我们可以使用<code>verify</code>参数控制是否验证证书，如果将其设置为<code>False</code>，在请求时就不会再验证证书是否有效。如果不加<code>verify</code>参数的话，默认值是<code>True</code>，会自动验证。</p>\n<p>改写代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\">response = requests.get(<span class=\"string\">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class=\"literal\">False</span>) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(response.status_code) </span><br></pre></td></tr></table></figure>\n\n<p>这样就会打印出请求成功的状态码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/lib/python3<span class=\"number\">.7</span>/site-packages/urllib3/connectionpool.py:<span class=\"number\">857</span>: InsecureRequestWarning: Unverified HTTPS request <span class=\"keyword\">is</span> being made. Adding certificate verification <span class=\"keyword\">is</span> strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html</span><br><span class=\"line\">InsecureRequestWarning) <span class=\"number\">200</span> </span><br></pre></td></tr></table></figure>\n\n<p>不过发现报了一个警告，它建议我们给它指定证书。可以通过设置忽略警告的方式来屏蔽这个警告：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests <span class=\"keyword\">from</span> requests.packages </span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib3 </span><br><span class=\"line\"></span><br><span class=\"line\">urllib3.disable_warnings() </span><br><span class=\"line\">response = requests.get(<span class=\"string\">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class=\"literal\">False</span>) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(response.status_code)</span><br></pre></td></tr></table></figure>\n\n<p>或者通过捕获警告到日志的方式忽略警告：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> logging </span><br><span class=\"line\"><span class=\"keyword\">import</span> requests </span><br><span class=\"line\"></span><br><span class=\"line\">logging.captureWarnings(<span class=\"literal\">True</span>) </span><br><span class=\"line\">response = requests.get(<span class=\"string\">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class=\"literal\">False</span>) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(response.status_code)</span><br></pre></td></tr></table></figure>\n\n<p>当然，也可以指定一个本地证书用作客户端证书，这可以是单个文件（包含密钥和证书）或一个包含两个文件路径的元组： </p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests response = requests.get(<span class=\"string\">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, cert=(<span class=\"string\">&#x27;/path/server.crt&#x27;</span>, <span class=\"string\">&#x27;/path/server.key&#x27;</span>)) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(response.status_code)</span><br></pre></td></tr></table></figure>\n\n<p>上面的代码是演示实例，要有<code>crt</code>和<code>key</code>文件，并且指定它们的路径。另外注意，本地私有证书的<code>key</code>必须是解密状态，加密状态的<code>key</code>是不支持的。</p>\n<h3 id=\"超时时间\"><a href=\"#超时时间\" class=\"headerlink\" title=\"超时时间\"></a>超时时间</h3><p>在本机网络状况不好或者服务器网络响应延迟甚至无响应时，可能会等待很久才能收到响应，甚至到最后收不到响应而报错。为了防止服务器不能及时响应，应该设置一个超时时间，即超过了这个时间还没有得到响应，那就报错。这需要用到<code>timeout</code>参数。这个时间的计算是发出请求到服务器返回响应的时间。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests </span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://httpbin.org/get&#x27;</span>, timeout=<span class=\"number\">1</span>) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.status_code)</span><br></pre></td></tr></table></figure>\n\n<p>通过这样的方式将超时时间设置为<code>1</code>秒，如果<code>1</code>秒内没有响应，那就抛出异常。</p>\n<p>实际上，请求分为两个阶段，即连接<code>（connect）</code>和读取<code>（read）</code>。 上面设置的<code>timeout</code>将用作连接和读取这二者的<code>timeout</code>总和。</p>\n<p>如果要分别指定，就可以传入一个元组：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://httpbin.org/get&#x27;</span>, timeout=(<span class=\"number\">5</span>, <span class=\"number\">30</span>))</span><br></pre></td></tr></table></figure>\n\n<p>如果想永久等待，可以直接将<code>timeout</code>设置为<code>None</code>，或者不设置直接留空，因为默认是<code>None</code>。这样的话，如果服务器还在运行，但是响应特别慢，那就慢慢等吧，它永远不会返回超时错误的。其用法如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://httpbin.org/get&#x27;</span>, timeout=<span class=\"literal\">None</span>) </span><br></pre></td></tr></table></figure>\n\n<p>或直接不加参数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://httpbin.org/get&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"身份认证\"><a href=\"#身份认证\" class=\"headerlink\" title=\"身份认证\"></a>身份认证</h3><p>在访问某些设置了身份认证的网站时，例如：<a href=\"https://static3.scrape.cuiqingcai.com/\">https://static3.scrape.cuiqingcai.com/</a>，我们可能会遇到这样的认证窗口，如图所示：</p>\n<p><img src=\"Screenshot_4.webp\" alt=\"认证\"></p>\n<p>如果遇到了这种情况，那就是这个网站启用了基本身份认证，英文叫作<code>HTTP Basic Access Authentication</code>，它是一种用来允许网页浏览器或其他客户端程序在请求时提供<strong>用户名</strong>和<strong>口令形式</strong>的身份凭证的一种登录验证方式。 如果遇到了这种情况，怎么用<code>reqeusts</code>来爬取呢，当然也有办法。</p>\n<p>可以使用<code>requests</code>自带的身份认证功能，通过<code>auth</code>参数即可设置，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> requests.auth <span class=\"keyword\">import</span> HTTPBasicAuth</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://static3.scrape.cuiqingcai.com/&#x27;</span>, auth=HTTPBasicAuth(<span class=\"string\">&#x27;admin&#x27;</span>, <span class=\"string\">&#x27;admin&#x27;</span>), verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.status_code)</span><br></pre></td></tr></table></figure>\n\n<p>成功的话，返回状态码<code>200</code>。</p>\n<p>如果参数都传一个<code>HTTPBasicAuth</code>类，就显得有点烦琐了，所以<code>requests</code>提供了一个更简单的写法，可以直接传一个元组，它会默认使用<code>HTTPBasicAuth</code>这个类来认证。</p>\n<p>上面的代码可以直接简写如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://static3.scrape.cuiqingcai.com/&#x27;</span>, auth=(<span class=\"string\">&#x27;admin&#x27;</span>, <span class=\"string\">&#x27;admin&#x27;</span>))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.status_code)</span><br></pre></td></tr></table></figure>\n\n<p>此外，<code>requests</code>还提供了其他认证方式，如<code>OAuth</code>认证，不过此时需要安装<code>oauth</code>包，安装命令如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install requests_oauthlib</span><br></pre></td></tr></table></figure>\n\n<p>使用<code>OAuth1</code>认证的方法如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests <span class=\"keyword\">from</span> requests_oauthlib </span><br><span class=\"line\"><span class=\"keyword\">import</span> OAuth1 </span><br><span class=\"line\">url = <span class=\"string\">&#x27;https://api.twitter.com/1.1/account/verify_credentials.json&#x27;</span> </span><br><span class=\"line\">auth = OAuth1(<span class=\"string\">&#x27;YOUR_APP_KEY&#x27;</span>, <span class=\"string\">&#x27;YOUR_APP_SECRET&#x27;</span>, <span class=\"string\">&#x27;USER_OAUTH_TOKEN&#x27;</span>, <span class=\"string\">&#x27;USER_OAUTH_TOKEN_SECRET&#x27;</span>)</span><br><span class=\"line\">requests.get(url, auth=auth) </span><br></pre></td></tr></table></figure>\n\n<p>更多详细的功能就可以参考<code>requests_oauthlib</code>的官方文档：<a href=\"https://requests-oauthlib.readthedocs.org/\">https://requests-oauthlib.readthedocs.org/</a>，不再赘述。</p>\n<h3 id=\"代理设置\"><a href=\"#代理设置\" class=\"headerlink\" title=\"代理设置\"></a>代理设置</h3><p>某些网站在测试的时候请求几次，能正常获取内容。但是对于大规模且频繁的请求，网站可能会弹出验证码，或者跳转到登录认证页面，更甚者可能会直接封禁客户端的<code>IP</code>，导致一定时间段内无法访问。</p>\n<p>为了防止这种情况发生，我们需要设置代理来解决这个问题，这就需要用到<code>proxies</code>参数。可以用这样的方式设置：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\">proxies = &#123; </span><br><span class=\"line\">  <span class=\"string\">&#x27;http&#x27;</span>: <span class=\"string\">&#x27;http://10.10.10.10:1080&#x27;</span>, </span><br><span class=\"line\">  <span class=\"string\">&#x27;https&#x27;</span>: <span class=\"string\">&#x27;http://10.10.10.10:1080&#x27;</span>, </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">requests.get(<span class=\"string\">&#x27;https://httpbin.org/get&#x27;</span>, proxies=proxies) </span><br></pre></td></tr></table></figure>\n\n<p>当然，直接运行这个实例或许行不通，因为这个代理可能是无效的，可以直接搜索寻找有效的代理并替换试验一下。</p>\n<p>若代理需要使用上文所述的身份认证，可以使用类似<code>ttp://user:password@host:port</code>这样的语法来设置代理，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\">proxies = &#123;<span class=\"string\">&#x27;https&#x27;</span>: <span class=\"string\">&#x27;http://user:password@10.10.10.10:1080/&#x27;</span>,&#125; </span><br><span class=\"line\">requests.get(<span class=\"string\">&#x27;https://httpbin.org/get&#x27;</span>, proxies=proxies)</span><br></pre></td></tr></table></figure>\n\n<p>除了基本的<code>HTTP</code>代理外，<code>requests</code>还支持<code>SOCKS</code>协议的代理。</p>\n<p>首先，需要安装<code>socks</code>这个库：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install <span class=\"string\">&quot;requests[socks]&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>然后就可以使用<code>SOCKS</code>协议代理了，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\">proxies = &#123; </span><br><span class=\"line\">  <span class=\"string\">&#x27;http&#x27;</span>: <span class=\"string\">&#x27;socks5://user:password@host:port&#x27;</span>, </span><br><span class=\"line\">  <span class=\"string\">&#x27;https&#x27;</span>: <span class=\"string\">&#x27;socks5://user:password@host:port&#x27;</span> </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">requests.get(<span class=\"string\">&#x27;https://httpbin.org/get&#x27;</span>, proxies=proxies)</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p><code>requests</code>是一个第三方库，使用<code>pip</code>下载安装。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install requests</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实例引入\"><a href=\"#实例引入\" class=\"headerlink\" title=\"实例引入\"></a>实例引入</h2><p>用<code>Python</code>写爬虫的第一步就是模拟发起一个请求，把网页的源代码获取下来。</p>\n<p>在浏览器中输入一个<code>URL</code>并回车，实际上就是让浏览器帮我们发起一个<code>GET</code>类型的<code>HTTP</code>请求，浏览器得到源代码后，把它渲染出来就可以看到网页内容了。</p>\n<p>那如果想用<code>requests</code>来获取源代码，应该怎么办呢？很简单，<code>requests</code>这个库提供了一个<code>get</code>方法，调用这个方法，并传入对应的<code>URL</code>就能得到网页的源代码。</p>\n<p>比如这里有一个示例网站:<a href=\"https://static1.scrape.cuiqingcai.com/\">https://static1.scrape.cuiqingcai.com/</a>，其内容如下：</p>\n<p><img src=\"Screenshot_2.webp\" alt=\"示列网站\"></p>\n<p>这个网站展示了一些电影数据，如果想要把这个网页里面的数据爬下来，比如获取各个电影的名称、上映时间等信息，然后把它存下来的话，该怎么做呢？</p>\n<p>第一步当然就是获取它的网页源代码了。</p>\n<p>可以用<code>requests</code>这个库轻松地完成这个过程，代码的写法是这样的：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(url=<span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>输出结果如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width,initial-scale=1&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;icon&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/static/img/favicon.ico&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Scrape | Movie<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/static/css/app.css&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/css&quot;</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/static/css/index.css&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/css&quot;</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-v-74e8b908</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;el-row&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;header&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-v-74e8b908</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container el-col el-col-18 el-col-offset-3&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-v-74e8b908</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;el-row&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-v-74e8b908</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;logo el-col el-col-4&quot;</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">data-v-74e8b908</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;router-link-exact-active router-link-active&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">data-v-74e8b908</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;/static/img/logo.png&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;logo-image&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">data-v-74e8b908</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;logo-title&quot;</span>&gt;</span>Scrape<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;number&quot;</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/page/7&quot;</span>&gt;</span>7<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;number&quot;</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/page/8&quot;</span>&gt;</span>8<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;number&quot;</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/page/9&quot;</span>&gt;</span>9<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;number&quot;</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/page/10&quot;</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">          </span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/page/2&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;next&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;button&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-next&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;el-icon el-icon-arrow-right&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">          </span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">Process finished with exit code 0</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>由于网页内容比较多，这里省略了大部分内容。</p>\n<p>不过看运行结果，我们已经成功获取网页的<code>HTML</code>源代码，里面包含了电影的标题、类型、上映时间，等等。</p>\n<p>把网页源代码获取下来之后，下一步我们把想要的数据提取出来，数据的爬取就完成了。</p>\n<h2 id=\"请求\"><a href=\"#请求\" class=\"headerlink\" title=\"请求\"></a>请求</h2><p><code>HTTP</code>中最常见的请求之一就是<code>GET</code>请求。</p>\n<h3 id=\"GET请求\"><a href=\"#GET请求\" class=\"headerlink\" title=\"GET请求\"></a><code>GET</code>请求</h3><p>换一个示例网站，其<code>URL</code>为<a href=\"http://httpbin.org/get\">http://httpbin.org/get</a>，如果客户端发起的是<code>GET</code>请求的话，该网站会判断并返回相应的请求信息，包括 <code>Headers</code>、<code>IP</code>等。 我们还是用相同的方法来发起一个<code>GET请求</code>，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(url=<span class=\"string\">&#x27;http://httpbin.org/get&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>返回结果：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;args&quot;: &#123;&#125;, </span><br><span class=\"line\">  &quot;headers&quot;: &#123;</span><br><span class=\"line\">    &quot;Accept&quot;: &quot;*/*&quot;,</span><br><span class=\"line\">    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,</span><br><span class=\"line\">    &quot;Host&quot;: &quot;httpbin.org&quot;,</span><br><span class=\"line\">    &quot;User-Agent&quot;: &quot;python-requests/2.25.1&quot;,</span><br><span class=\"line\">    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-60a3a8ad-070f8b95711f7821709e24ed&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;origin&quot;: &quot;202.62.113.207&quot;,</span><br><span class=\"line\">  &quot;url&quot;: &quot;http://httpbin.org/get&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以发现，成功发起了<code>GET</code>请求，也通过这个网站的返回结果得到了请求所携带的信息，包括<code>Headers</code>、<code>URL</code>、<code>IP</code>，等等。</p>\n<p>对于<code>GET</code>请求，我们知道<code>URL</code>后面是可以跟上一些参数的，如果我们现在想添加两个参数，其中<code>name</code>是<code>germey</code>，<code>age</code>是<code>25</code>，<code>URL</code>就可以写成如下内容：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://httpbin.org/get?name=germey&amp;age=<span class=\"number\">25</span></span><br></pre></td></tr></table></figure>\n\n<p>要构造这个请求链接，是不是要直接写成这样呢？</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;http://httpbin.org/get?name=germey&amp;age=25&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这样也可以，但如果这些参数还需要手动拼接，未免有点不人性化。</p>\n<p>一般情况下，这种信息我们利用<code>params</code>这个参数就可以直接传递了，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">data = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;holy&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"number\">25</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(url=<span class=\"string\">&#x27;http://httpbin.org/get&#x27;</span>, params=data, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>返回结果：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;args&quot;: &#123;</span><br><span class=\"line\">    &quot;age&quot;: &quot;25&quot;,</span><br><span class=\"line\">    &quot;name&quot;: &quot;holy&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;headers&quot;: &#123;</span><br><span class=\"line\">    &quot;Accept&quot;: &quot;*/*&quot;,</span><br><span class=\"line\">    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,</span><br><span class=\"line\">    &quot;Host&quot;: &quot;httpbin.org&quot;,</span><br><span class=\"line\">    &quot;User-Agent&quot;: &quot;python-requests/2.25.1&quot;,</span><br><span class=\"line\">    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-60a3ab05-51321f5c7eeb7b0573bb5510&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;origin&quot;: &quot;202.62.113.207&quot;,</span><br><span class=\"line\">  &quot;url&quot;: &quot;http://httpbin.org/get?name=holy&amp;age=25&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>把<code>URL</code>参数通过字典的形式传给<code>get</code>方法的<code>params</code>参数，通过返回信息可以判断，请求的链接自动被构造成了：<em><a href=\"http://httpbin.org/get?age=22&amp;name=germey\">http://httpbin.org/get?age=22&amp;name=germey</a></em>。</p>\n<p>网页的返回类型实际上是<code>str</code>类型，但是它很特殊，是<code>JSON</code>格式的。所以，如果想直接解析返回结果，得到一个<code>JSON</code>格式的数据的话，可以直接调用<code>json</code>方法。</p>\n<p>示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">data = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;holy&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"number\">25</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(url=<span class=\"string\">&#x27;http://httpbin.org/get&#x27;</span>, params=data, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(r.text))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.json())</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(r.json()))</span><br></pre></td></tr></table></figure>\n\n<p>结果如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;class &#x27;str&#x27;&gt;</span><br><span class=\"line\">&#123;&#x27;args&#x27;: &#123;&#x27;age&#x27;: &#x27;25&#x27;, &#x27;name&#x27;: &#x27;holy&#x27;&#125;, &#x27;headers&#x27;: &#123;&#x27;Accept&#x27;: &#x27;*/*&#x27;, &#x27;Accept-Encoding&#x27;: &#x27;gzip, deflate&#x27;, &#x27;Host&#x27;: &#x27;httpbin.org&#x27;, &#x27;User-Agent&#x27;: &#x27;python-requests/2.25.1&#x27;, &#x27;X-Amzn-Trace-Id&#x27;: &#x27;Root=1-60a3ac52-425e713a2907d0302f298070&#x27;&#125;, &#x27;origin&#x27;: &#x27;202.62.113.207&#x27;, &#x27;url&#x27;: &#x27;http://httpbin.org/get?name=holy&amp;age=25&#x27;&#125;</span><br><span class=\"line\">&lt;class &#x27;dict&#x27;&gt;</span><br></pre></td></tr></table></figure>\n\n<p>调用<code>json</code>方法，就可以将返回结果是<code>JSON</code>格式的字符串转化为字典。 但需要注意的是，如果返回结果不是<code>JSON</code>格式，便会出现解析错误，抛出<code>json.decoder.JSONDecodeError</code>异常。</p>\n<h3 id=\"抓取网页\"><a href=\"#抓取网页\" class=\"headerlink\" title=\"抓取网页\"></a>抓取网页</h3><p>上面的请求链接返回的是<code>JSON</code>形式的字符串，那么如果请求普通的网页，则肯定能获得相应的内容。下面以本课时最初的实例页面为例，我们再加上一点提取信息的逻辑，将代码完善成如下的样子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">pattern = re.<span class=\"built_in\">compile</span>(<span class=\"string\">&#x27;&lt;h2.*?&gt;(.*?)&lt;/h2&gt;&#x27;</span>, re.S)</span><br><span class=\"line\">titles = re.findall(pattern, r.text)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(titles)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">&#x27;霸王别姬 - Farewell My Concubine&#x27;</span>, <span class=\"string\">&#x27;这个杀手不太冷 - Léon&#x27;</span>, <span class=\"string\">&#x27;肖申克的救赎 - The Shawshank Redemption&#x27;</span>, <span class=\"string\">&#x27;泰坦尼克号 - Titanic&#x27;</span>, <span class=\"string\">&#x27;罗马假日 - Roman Holiday&#x27;</span>, <span class=\"string\">&#x27;唐伯虎点秋香 - Flirting Scholar&#x27;</span>, <span class=\"string\">&#x27;乱世佳人 - Gone with the Wind&#x27;</span>, <span class=\"string\">&#x27;喜剧之王 - The King of Comedy&#x27;</span>, <span class=\"string\">&#x27; 楚门的世界 - The Truman Show&#x27;</span>, <span class=\"string\">&#x27;狮子王 - The Lion King&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"抓取二进制数据\"><a href=\"#抓取二进制数据\" class=\"headerlink\" title=\"抓取二进制数据\"></a>抓取二进制数据</h3><p>抓取的是网站的一个页面，实际上它返回的是一个<code>HTML</code>文档。如果想抓取图片、音频、视频等文件，应该怎么办呢？</p>\n<p>图片、音频、视频这些文件本质上都是由<strong>二进制码</strong>组成的，由于有特定的保存格式和对应的解析方式，我们才可以看到这些形形色色的多媒体。所以，想要抓取它们，就要拿到它们的二进制数据。</p>\n<p>下面以 GitHub 的站点图标为例来看一下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://github.com/favicon.ico&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.content)</span><br></pre></td></tr></table></figure>\n\n<p>这里抓取的内容是站点图标，也就是在浏览器每一个标签上显示的小图标。</p>\n<p>前者出现了乱码，后者结果前带有一个<code>b</code>，这代表是<code>bytes</code>类型的数据。</p>\n<p>由于图片是二进制数据，所以前者在打印时转化为<code>str</code>类型，也就是图片直接转化为字符串，这当然会出现乱码。</p>\n<p>上面返回的结果我们并不能看懂，它实际上是图片的二进制数据，没关系，将刚才提取到的信息保存下来就好了，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests </span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png&#x27;</span>, verify=<span class=\"literal\">False</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;baidu.png&#x27;</span>, <span class=\"string\">&#x27;wb&#x27;</span>) <span class=\"keyword\">as</span> f: </span><br><span class=\"line\">    f.write(r.content)</span><br></pre></td></tr></table></figure>\n\n<p>这里用了<code>open</code>方法，它的第一个参数是文件名称，第二个参数代表以二进制的形式打开，可以向文件里写入二进制数据。</p>\n<p>运行结束之后，可以发现在文件夹中出现了名为<code>baidu.png</code>的图标。</p>\n<h3 id=\"添加添headers\"><a href=\"#添加添headers\" class=\"headerlink\" title=\"添加添headers\"></a>添加添headers</h3><p>在发起一个<code>HTTP</code>请求的时候，会有一个请求头<code>Request Headers</code>，那么这个怎么来设置呢？</p>\n<p>很简单，使用<code>headers</code>参数就可以完成了。</p>\n<p>在刚才的实例中，是没有设置<code>Request Headers</code>信息的，如果不设置，某些网站会发现这不是一个正常的浏览器发起的请求，网站可能会返回异常的结果，导致网页抓取失败。</p>\n<p>要添加<code>Headers</code>信息，比如添加一个<code>User-Agent</code>字段，可以这么写：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">headers = &#123; </span><br><span class=\"line\">    <span class=\"string\">&#x27;User-Agent&#x27;</span>: <span class=\"string\">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, headers=headers, verify=<span class=\"literal\">False</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>当然，我们可以在<code>headers</code>这个参数中任意添加其他的字段信息。</p>\n<h3 id=\"POST请求\"><a href=\"#POST请求\" class=\"headerlink\" title=\"POST请求\"></a>POST请求</h3><p>使用<code>requests</code>实现<code>post</code>请求，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">data = &#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;germey&#x27;</span>, <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;25&#x27;</span>&#125;</span><br><span class=\"line\">r = requests.post(<span class=\"string\">&quot;http://httpbin.org/post&quot;</span>, data=data)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>这里还是请求<a href=\"http://httpbin.org/post\">http://httpbin.org/post</a>，该网站可以判断如果请求是<code>POST</code>方式，就把相关请求信息返回。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;args&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;data&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;files&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;form&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;age&quot;</span>: <span class=\"string\">&quot;25&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;germey&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;headers&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;Accept&quot;</span>: <span class=\"string\">&quot;*/*&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;Accept-Encoding&quot;</span>: <span class=\"string\">&quot;gzip, deflate&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;Content-Length&quot;</span>: <span class=\"string\">&quot;18&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;Content-Type&quot;</span>: <span class=\"string\">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;Host&quot;</span>: <span class=\"string\">&quot;httpbin.org&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;User-Agent&quot;</span>: <span class=\"string\">&quot;python-requests/2.25.1&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;X-Amzn-Trace-Id&quot;</span>: <span class=\"string\">&quot;Root=1-60a402c2-68a523624a9ca353207a3a5e&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;json&quot;</span>: null,</span><br><span class=\"line\">  <span class=\"string\">&quot;origin&quot;</span>: <span class=\"string\">&quot;202.62.113.207&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;url&quot;</span>: <span class=\"string\">&quot;http://httpbin.org/post&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"响应\"><a href=\"#响应\" class=\"headerlink\" title=\"响应\"></a>响应</h3><p>发送请求后，得到的就是响应，即<code>Response</code>。</p>\n<p>在上面的实例中，使用<code>text</code>和<code>content</code>获取了响应的内容。此外，还有很多属性和方法可以用来获取其他信息，比如<code>状态码</code>、<code>响应头</code>、<code>Cookies</code>等。示例如下:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(r.status_code), r.status_code)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(r.headers), r.headers)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(r.cookies), r.cookies)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(r.url), r.url)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(r.history), r.history)</span><br></pre></td></tr></table></figure>\n\n<p>这里分别打印输出<code>status_code</code>属性得到状态码，输出<code>headers</code>属性得到响应头，输出<code>cookies</code>属性得到<code>Cookies</code>，输出<code>url</code>属性得到<code>URL</code>，输出<code>history</code>属性得到请求历史。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">int</span>&#x27;&gt; 200</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">requests</span>.<span class=\"title\">structures</span>.<span class=\"title\">CaseInsensitiveDict</span>&#x27;&gt; &#123;&#x27;<span class=\"title\">Date</span>&#x27;:</span> <span class=\"string\">&#x27;Wed, 19 May 2021 12:52:03 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html; charset=utf-8&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;41538&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;X-Frame-Options&#x27;</span>: <span class=\"string\">&#x27;DENY&#x27;</span>, <span class=\"string\">&#x27;X-Content-Type-Options&#x27;</span>: <span class=\"string\">&#x27;nosniff&#x27;</span>, <span class=\"string\">&#x27;Expires&#x27;</span>: <span class=\"string\">&#x27;Wed, 19 May 2021 13:01:46 GMT&#x27;</span>, <span class=\"string\">&#x27;Cache-Control&#x27;</span>: <span class=\"string\">&#x27;max-age=600&#x27;</span>, <span class=\"string\">&#x27;Strict-Transport-Security&#x27;</span>: <span class=\"string\">&#x27;max-age=15724800; includeSubDomains&#x27;</span>&#125;</span><br><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">requests</span>.<span class=\"title\">cookies</span>.<span class=\"title\">RequestsCookieJar</span>&#x27;&gt; &lt;<span class=\"title\">RequestsCookieJar</span>[]&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">str</span>&#x27;&gt; <span class=\"title\">https</span>:</span>//static1.scrape.cuiqingcai.com/</span><br><span class=\"line\">&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">list</span>&#x27;&gt; []</span></span><br></pre></td></tr></table></figure>\n\n<p><code>headers</code>和<code>cookies</code>这两个属性得到的结果分别是<code>CaseInsensitiveDict</code>和<code>RequestsCookieJar</code>类型。</p>\n<p>状态码是用来表示响应状态的，比如返回<code>200</code>代表我们得到的响应是没问题的，上面的例子正好输出的结果也是<code>200</code>，所以可以通过判断<code>Response</code>的状态码来确认是否爬取成功。</p>\n<p><code>requests</code>还提供了一个内置的状态码查询对象<code>requests.codes</code>，用法示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">exit() <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> r.status_code == requests.codes.ok <span class=\"keyword\">else</span> <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Request successfully&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这里通过比较返回码和内置的成功的返回码，来保证请求得到了正常响应，输出成功请求的消息，否则程序终止，这里我们用<code>requests.codes.ok</code>得到的是成功的状态码<code>200</code>。</p>\n<p>这样的话，我们就不用再在程序里面写状态码对应的数字了，用字符串表示状态码会显得更加直观。</p>\n<p>下面列出了返回码和相应的查询条件：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 信息性状态码</span></span><br><span class=\"line\"><span class=\"number\">100</span>: (<span class=\"string\">&#x27;continue&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">101</span>: (<span class=\"string\">&#x27;switching_protocols&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">102</span>: (<span class=\"string\">&#x27;processing&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">103</span>: (<span class=\"string\">&#x27;checkpoint&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">122</span>: (<span class=\"string\">&#x27;uri_too_long&#x27;</span>, <span class=\"string\">&#x27;request_uri_too_long&#x27;</span>),</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 成功状态码</span></span><br><span class=\"line\"><span class=\"number\">200</span>: (<span class=\"string\">&#x27;ok&#x27;</span>, <span class=\"string\">&#x27;okay&#x27;</span>, <span class=\"string\">&#x27;all_ok&#x27;</span>, <span class=\"string\">&#x27;all_okay&#x27;</span>, <span class=\"string\">&#x27;all_good&#x27;</span>, <span class=\"string\">&#x27;\\\\o/&#x27;</span>, <span class=\"string\">&#x27;✓&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">201</span>: (<span class=\"string\">&#x27;created&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">202</span>: (<span class=\"string\">&#x27;accepted&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">203</span>: (<span class=\"string\">&#x27;non_authoritative_info&#x27;</span>, <span class=\"string\">&#x27;non_authoritative_information&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">204</span>: (<span class=\"string\">&#x27;no_content&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">205</span>: (<span class=\"string\">&#x27;reset_content&#x27;</span>, <span class=\"string\">&#x27;reset&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">206</span>: (<span class=\"string\">&#x27;partial_content&#x27;</span>, <span class=\"string\">&#x27;partial&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">207</span>: (<span class=\"string\">&#x27;multi_status&#x27;</span>, <span class=\"string\">&#x27;multiple_status&#x27;</span>, <span class=\"string\">&#x27;multi_stati&#x27;</span>, <span class=\"string\">&#x27;multiple_stati&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">208</span>: (<span class=\"string\">&#x27;already_reported&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">226</span>: (<span class=\"string\">&#x27;im_used&#x27;</span>,),</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重定向状态码</span></span><br><span class=\"line\"><span class=\"number\">300</span>: (<span class=\"string\">&#x27;multiple_choices&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">301</span>: (<span class=\"string\">&#x27;moved_permanently&#x27;</span>, <span class=\"string\">&#x27;moved&#x27;</span>, <span class=\"string\">&#x27;\\\\o-&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">302</span>: (<span class=\"string\">&#x27;found&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">303</span>: (<span class=\"string\">&#x27;see_other&#x27;</span>, <span class=\"string\">&#x27;other&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">304</span>: (<span class=\"string\">&#x27;not_modified&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">305</span>: (<span class=\"string\">&#x27;use_proxy&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">306</span>: (<span class=\"string\">&#x27;switch_proxy&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">307</span>: (<span class=\"string\">&#x27;temporary_redirect&#x27;</span>, <span class=\"string\">&#x27;temporary_moved&#x27;</span>, <span class=\"string\">&#x27;temporary&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">308</span>: (<span class=\"string\">&#x27;permanent_redirect&#x27;</span>, <span class=\"string\">&#x27;resume_incomplete&#x27;</span>, <span class=\"string\">&#x27;resume&#x27;</span>,), <span class=\"comment\"># These 2 to be removed in 3.0 </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 客户端错误状态码 </span></span><br><span class=\"line\"><span class=\"number\">400</span>: (<span class=\"string\">&#x27;bad_request&#x27;</span>, <span class=\"string\">&#x27;bad&#x27;</span>), </span><br><span class=\"line\"><span class=\"number\">401</span>: (<span class=\"string\">&#x27;unauthorized&#x27;</span>,), </span><br><span class=\"line\"><span class=\"number\">402</span>: (<span class=\"string\">&#x27;payment_required&#x27;</span>, <span class=\"string\">&#x27;payment&#x27;</span>), </span><br><span class=\"line\"><span class=\"number\">403</span>: (<span class=\"string\">&#x27;forbidden&#x27;</span>,), </span><br><span class=\"line\"><span class=\"number\">404</span>: (<span class=\"string\">&#x27;not_found&#x27;</span>, <span class=\"string\">&#x27;-o-&#x27;</span>), </span><br><span class=\"line\"><span class=\"number\">405</span>: (<span class=\"string\">&#x27;method_not_allowed&#x27;</span>, <span class=\"string\">&#x27;not_allowed&#x27;</span>), </span><br><span class=\"line\"><span class=\"number\">406</span>: (<span class=\"string\">&#x27;not_acceptable&#x27;</span>,), </span><br><span class=\"line\"><span class=\"number\">407</span>: (<span class=\"string\">&#x27;proxy_authentication_required&#x27;</span>, <span class=\"string\">&#x27;proxy_auth&#x27;</span>, <span class=\"string\">&#x27;proxy_authentication&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">408</span>: (<span class=\"string\">&#x27;request_timeout&#x27;</span>, <span class=\"string\">&#x27;timeout&#x27;</span>), </span><br><span class=\"line\"><span class=\"number\">409</span>: (<span class=\"string\">&#x27;conflict&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">410</span>: (<span class=\"string\">&#x27;gone&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">411</span>: (<span class=\"string\">&#x27;length_required&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">412</span>: (<span class=\"string\">&#x27;precondition_failed&#x27;</span>, <span class=\"string\">&#x27;precondition&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">413</span>: (<span class=\"string\">&#x27;request_entity_too_large&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">414</span>: (<span class=\"string\">&#x27;request_uri_too_large&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">415</span>: (<span class=\"string\">&#x27;unsupported_media_type&#x27;</span>, <span class=\"string\">&#x27;unsupported_media&#x27;</span>, <span class=\"string\">&#x27;media_type&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">416</span>: (<span class=\"string\">&#x27;requested_range_not_satisfiable&#x27;</span>, <span class=\"string\">&#x27;requested_range&#x27;</span>, <span class=\"string\">&#x27;range_not_satisfiable&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">417</span>: (<span class=\"string\">&#x27;expectation_failed&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">418</span>: (<span class=\"string\">&#x27;im_a_teapot&#x27;</span>, <span class=\"string\">&#x27;teapot&#x27;</span>, <span class=\"string\">&#x27;i_am_a_teapot&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">421</span>: (<span class=\"string\">&#x27;misdirected_request&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">422</span>: (<span class=\"string\">&#x27;unprocessable_entity&#x27;</span>, <span class=\"string\">&#x27;unprocessable&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">423</span>: (<span class=\"string\">&#x27;locked&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">424</span>: (<span class=\"string\">&#x27;failed_dependency&#x27;</span>, <span class=\"string\">&#x27;dependency&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">425</span>: (<span class=\"string\">&#x27;unordered_collection&#x27;</span>, <span class=\"string\">&#x27;unordered&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">426</span>: (<span class=\"string\">&#x27;upgrade_required&#x27;</span>, <span class=\"string\">&#x27;upgrade&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">428</span>: (<span class=\"string\">&#x27;precondition_required&#x27;</span>, <span class=\"string\">&#x27;precondition&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">429</span>: (<span class=\"string\">&#x27;too_many_requests&#x27;</span>, <span class=\"string\">&#x27;too_many&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">431</span>: (<span class=\"string\">&#x27;header_fields_too_large&#x27;</span>, <span class=\"string\">&#x27;fields_too_large&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">444</span>: (<span class=\"string\">&#x27;no_response&#x27;</span>, <span class=\"string\">&#x27;none&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">449</span>: (<span class=\"string\">&#x27;retry_with&#x27;</span>, <span class=\"string\">&#x27;retry&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">450</span>: (<span class=\"string\">&#x27;blocked_by_windows_parental_controls&#x27;</span>, <span class=\"string\">&#x27;parental_controls&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">451</span>: (<span class=\"string\">&#x27;unavailable_for_legal_reasons&#x27;</span>, <span class=\"string\">&#x27;legal_reasons&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">499</span>: (<span class=\"string\">&#x27;client_closed_request&#x27;</span>,), </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 服务端错误状态码</span></span><br><span class=\"line\"><span class=\"number\">500</span>: (<span class=\"string\">&#x27;internal_server_error&#x27;</span>, <span class=\"string\">&#x27;server_error&#x27;</span>, <span class=\"string\">&#x27;/o\\\\&#x27;</span>, <span class=\"string\">&#x27;✗&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">501</span>: (<span class=\"string\">&#x27;not_implemented&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">502</span>: (<span class=\"string\">&#x27;bad_gateway&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">503</span>: (<span class=\"string\">&#x27;service_unavailable&#x27;</span>, <span class=\"string\">&#x27;unavailable&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">504</span>: (<span class=\"string\">&#x27;gateway_timeout&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">505</span>: (<span class=\"string\">&#x27;http_version_not_supported&#x27;</span>, <span class=\"string\">&#x27;http_version&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">506</span>: (<span class=\"string\">&#x27;variant_also_negotiates&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">507</span>: (<span class=\"string\">&#x27;insufficient_storage&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">509</span>: (<span class=\"string\">&#x27;bandwidth_limit_exceeded&#x27;</span>, <span class=\"string\">&#x27;bandwidth&#x27;</span>),</span><br><span class=\"line\"><span class=\"number\">510</span>: (<span class=\"string\">&#x27;not_extended&#x27;</span>,),</span><br><span class=\"line\"><span class=\"number\">511</span>: (<span class=\"string\">&#x27;network_authentication_required&#x27;</span>, <span class=\"string\">&#x27;network_auth&#x27;</span>, <span class=\"string\">&#x27;network_authentication&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>比如，如果想判断结果是不是<code>404</code>状态，可以用<code>requests.codes.not_found</code>来比对。</p>\n<h2 id=\"高级用法\"><a href=\"#高级用法\" class=\"headerlink\" title=\"高级用法\"></a>高级用法</h2><p>刚才，了解<code>requests</code>的基本用法，如基本的<code>GET、POST</code>请求以及<code>Response</code>对象。当然<code>requests</code>能做到的不仅这些，它几乎可以完成<code>HTTP</code>的所有操作。</p>\n<p>下面来了解下<code>requests</code>的一些高级用法，如文件上传、<code>Cookies</code>设置、代理设置等。</p>\n<h3 id=\"文件上传\"><a href=\"#文件上传\" class=\"headerlink\" title=\"文件上传\"></a>文件上传</h3><p><code>requests</code>可以模拟提交一些数据。假如有的网站需要上传文件，也可以用它来实现，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">files = &#123;<span class=\"string\">&#x27;file&#x27;</span>:<span class=\"built_in\">open</span>(<span class=\"string\">&#x27;baidu.png&#x27;</span>, <span class=\"string\">&#x27;rb&#x27;</span>)&#125;</span><br><span class=\"line\">r = requests.post(<span class=\"string\">&#x27;http://httpbin.org/post&#x27;</span>, files=files)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>要注意的是，<code>baidu.png</code>需要和当前脚本在同一目录下。如果有其他文件，当然也可以使用其他文件来上传，更改下代码即可。运行结果如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;args&quot;: &#123;&#125;, </span><br><span class=\"line\">  &quot;data&quot;: &quot;&quot;, </span><br><span class=\"line\">  &quot;files&quot;: &#123;</span><br><span class=\"line\">    &quot;file&quot;: &quot;data:application/octet-stream;base64,iVBORw0KGgoAAAANSU......&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;form&quot;: &#123;&#125;,</span><br><span class=\"line\">  &quot;headers&quot;: &#123;</span><br><span class=\"line\">    &quot;Accept&quot;: &quot;*/*&quot;,</span><br><span class=\"line\">    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,</span><br><span class=\"line\">    &quot;Content-Length&quot;: &quot;15589&quot;,</span><br><span class=\"line\">    &quot;Content-Type&quot;: &quot;multipart/form-data; boundary=7e0556b094615781fff3b0ed4316dccd&quot;,</span><br><span class=\"line\">    &quot;Host&quot;: &quot;httpbin.org&quot;,</span><br><span class=\"line\">    &quot;User-Agent&quot;: &quot;python-requests/2.25.1&quot;,</span><br><span class=\"line\">    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-60a72501-36f606570785cb9d4356df71&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;json&quot;: null,</span><br><span class=\"line\">  &quot;origin&quot;: &quot;202.62.112.143&quot;,</span><br><span class=\"line\">  &quot;url&quot;: &quot;http://httpbin.org/post&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>以上省略部分内容，这个网站会返回响应，里面包含<code>files</code>这个字段，而<code>form</code>字段是空的，这证明文件上传部分会单独有一个<code>files</code>字段来标识。</p>\n<h3 id=\"Cookies\"><a href=\"#Cookies\" class=\"headerlink\" title=\"Cookies\"></a>Cookies</h3><p>获取<code>Cookies</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;http://www.baidu.com&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.cookies)</span><br><span class=\"line\"><span class=\"keyword\">for</span> key, value <span class=\"keyword\">in</span> r.cookies.items():</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(key + <span class=\"string\">&#x27;=&#x27;</span> + value)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;RequestsCookieJar[&lt;Cookie BDORZ=27315 for .baidu.com/&gt;]&gt;</span><br><span class=\"line\">BDORZ=27315</span><br></pre></td></tr></table></figure>\n\n<p>调用<code>cookies</code>属性即可成功得到<code>Cookies</code>，可以发现它是<code>RequestCookieJar</code>类型。然后用<code>items</code> 方法将其转化为元组组成的列表，遍历输出每一个<code>Cookie</code>的名称和值，实现<code>Cookie</code>的遍历解析。</p>\n<p>可以直接用<code>Cookie</code>来维持登录状态，下面我们以<code>GitHub</code>为例来说明一下，首先我们登录<code>GitHub</code>，然后将<code>Headers</code>中的<code>Cookie</code>内容复制下来，如图所示：</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>可以替换成你自己的<code>Cookie</code>，将其设置到<code>Headers</code>里面，然后发送请求。</p>\n<h3 id=\"Session维持\"><a href=\"#Session维持\" class=\"headerlink\" title=\"Session维持\"></a>Session维持</h3><p>在<code>requests</code>中，如果直接利用<code>get</code>或<code>post</code>等方法的确可以做到模拟网页的请求，但是这实际上是相当于不同的<code>Session</code>，相当于你用两个浏览器打开了不同的页面。</p>\n<p>设想这样一个场景，第一个请求利用<code>post</code>方法登录了某个网站，第二次想获取成功登录后的自己的个人信息，又用了一次<code>get</code>方法去请求个人信息页面。实际上，这相当于打开了两个浏览器，是两个完全不相关的<code>Session</code>，能成功获取个人信息吗？当然不能。</p>\n<p>解决这个问题的主要方法就是维持同一个<code>Session</code>，相当于打开一个新的浏览器选项卡而不是新开一个浏览器。但我又不想每次设置<code>Cookies</code>，那该怎么办呢？这时候就有了新的利器——**<code>Session</code>对象**。 利用它，可以方便地维护一个<code>Session</code>，而且不用担心<code>Cookies</code>的问题，它会帮我们自动处理好。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">requests.get(<span class=\"string\">&#x27;http://httpbin.org/cookies/set/number/123456789&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;http://httpbin.org/cookies&#x27;</span>, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;cookies&quot;</span>: &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这并不行。再用 Session试试看：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">s = requests.Session()</span><br><span class=\"line\">s.get(<span class=\"string\">&#x27;http://httpbin.org/cookies/set/number/123456789&#x27;</span>)</span><br><span class=\"line\">r = s.get(<span class=\"string\">&#x27;http://httpbin.org/cookies&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;cookies&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;number&quot;</span>: <span class=\"string\">&quot;123456789&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>利用<code>Session</code>，可以做到模拟同一个<code>Session</code>而不用担心<code>Cookies</code>的问题。它通常用于模拟登录成功之后再进行下一步的操作。</p>\n<h3 id=\"SSL证书验证\"><a href=\"#SSL证书验证\" class=\"headerlink\" title=\"SSL证书验证\"></a>SSL证书验证</h3><p>现在很多网站都要求使用<code>HTTPS</code>协议，但是有些网站可能并没有设置好<code>HTTPS</code>证书，或者网站的<code>HTTPS</code>证书不被<code>CA</code>机构认可，这时候，这些网站可能就会出现<code>SSL</code>证书错误的提示。</p>\n<p>比如示例网站：<a href=\"https://static2.scrape.cuiqingcai.com/\">https://static2.scrape.cuiqingcai.com/</a>。 用浏览器打开这个<code>URL</code>，则会提示<strong>「您的连接不是私密连接」</strong>这样的错误，如图所示：</p>\n<p><img src=\"Screenshot_3.webp\" alt=\"示例网站\"></p>\n<p>那如果我们一定要爬取这个网站怎么办呢？我们可以使用<code>verify</code>参数控制是否验证证书，如果将其设置为<code>False</code>，在请求时就不会再验证证书是否有效。如果不加<code>verify</code>参数的话，默认值是<code>True</code>，会自动验证。</p>\n<p>改写代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\">response = requests.get(<span class=\"string\">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class=\"literal\">False</span>) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(response.status_code) </span><br></pre></td></tr></table></figure>\n\n<p>这样就会打印出请求成功的状态码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/lib/python3<span class=\"number\">.7</span>/site-packages/urllib3/connectionpool.py:<span class=\"number\">857</span>: InsecureRequestWarning: Unverified HTTPS request <span class=\"keyword\">is</span> being made. Adding certificate verification <span class=\"keyword\">is</span> strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html</span><br><span class=\"line\">InsecureRequestWarning) <span class=\"number\">200</span> </span><br></pre></td></tr></table></figure>\n\n<p>不过发现报了一个警告，它建议我们给它指定证书。可以通过设置忽略警告的方式来屏蔽这个警告：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests <span class=\"keyword\">from</span> requests.packages </span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib3 </span><br><span class=\"line\"></span><br><span class=\"line\">urllib3.disable_warnings() </span><br><span class=\"line\">response = requests.get(<span class=\"string\">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class=\"literal\">False</span>) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(response.status_code)</span><br></pre></td></tr></table></figure>\n\n<p>或者通过捕获警告到日志的方式忽略警告：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> logging </span><br><span class=\"line\"><span class=\"keyword\">import</span> requests </span><br><span class=\"line\"></span><br><span class=\"line\">logging.captureWarnings(<span class=\"literal\">True</span>) </span><br><span class=\"line\">response = requests.get(<span class=\"string\">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class=\"literal\">False</span>) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(response.status_code)</span><br></pre></td></tr></table></figure>\n\n<p>当然，也可以指定一个本地证书用作客户端证书，这可以是单个文件（包含密钥和证书）或一个包含两个文件路径的元组： </p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests response = requests.get(<span class=\"string\">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, cert=(<span class=\"string\">&#x27;/path/server.crt&#x27;</span>, <span class=\"string\">&#x27;/path/server.key&#x27;</span>)) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(response.status_code)</span><br></pre></td></tr></table></figure>\n\n<p>上面的代码是演示实例，要有<code>crt</code>和<code>key</code>文件，并且指定它们的路径。另外注意，本地私有证书的<code>key</code>必须是解密状态，加密状态的<code>key</code>是不支持的。</p>\n<h3 id=\"超时时间\"><a href=\"#超时时间\" class=\"headerlink\" title=\"超时时间\"></a>超时时间</h3><p>在本机网络状况不好或者服务器网络响应延迟甚至无响应时，可能会等待很久才能收到响应，甚至到最后收不到响应而报错。为了防止服务器不能及时响应，应该设置一个超时时间，即超过了这个时间还没有得到响应，那就报错。这需要用到<code>timeout</code>参数。这个时间的计算是发出请求到服务器返回响应的时间。示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests </span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://httpbin.org/get&#x27;</span>, timeout=<span class=\"number\">1</span>) </span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.status_code)</span><br></pre></td></tr></table></figure>\n\n<p>通过这样的方式将超时时间设置为<code>1</code>秒，如果<code>1</code>秒内没有响应，那就抛出异常。</p>\n<p>实际上，请求分为两个阶段，即连接<code>（connect）</code>和读取<code>（read）</code>。 上面设置的<code>timeout</code>将用作连接和读取这二者的<code>timeout</code>总和。</p>\n<p>如果要分别指定，就可以传入一个元组：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://httpbin.org/get&#x27;</span>, timeout=(<span class=\"number\">5</span>, <span class=\"number\">30</span>))</span><br></pre></td></tr></table></figure>\n\n<p>如果想永久等待，可以直接将<code>timeout</code>设置为<code>None</code>，或者不设置直接留空，因为默认是<code>None</code>。这样的话，如果服务器还在运行，但是响应特别慢，那就慢慢等吧，它永远不会返回超时错误的。其用法如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://httpbin.org/get&#x27;</span>, timeout=<span class=\"literal\">None</span>) </span><br></pre></td></tr></table></figure>\n\n<p>或直接不加参数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://httpbin.org/get&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"身份认证\"><a href=\"#身份认证\" class=\"headerlink\" title=\"身份认证\"></a>身份认证</h3><p>在访问某些设置了身份认证的网站时，例如：<a href=\"https://static3.scrape.cuiqingcai.com/\">https://static3.scrape.cuiqingcai.com/</a>，我们可能会遇到这样的认证窗口，如图所示：</p>\n<p><img src=\"Screenshot_4.webp\" alt=\"认证\"></p>\n<p>如果遇到了这种情况，那就是这个网站启用了基本身份认证，英文叫作<code>HTTP Basic Access Authentication</code>，它是一种用来允许网页浏览器或其他客户端程序在请求时提供<strong>用户名</strong>和<strong>口令形式</strong>的身份凭证的一种登录验证方式。 如果遇到了这种情况，怎么用<code>reqeusts</code>来爬取呢，当然也有办法。</p>\n<p>可以使用<code>requests</code>自带的身份认证功能，通过<code>auth</code>参数即可设置，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> requests.auth <span class=\"keyword\">import</span> HTTPBasicAuth</span><br><span class=\"line\"></span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://static3.scrape.cuiqingcai.com/&#x27;</span>, auth=HTTPBasicAuth(<span class=\"string\">&#x27;admin&#x27;</span>, <span class=\"string\">&#x27;admin&#x27;</span>), verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.status_code)</span><br></pre></td></tr></table></figure>\n\n<p>成功的话，返回状态码<code>200</code>。</p>\n<p>如果参数都传一个<code>HTTPBasicAuth</code>类，就显得有点烦琐了，所以<code>requests</code>提供了一个更简单的写法，可以直接传一个元组，它会默认使用<code>HTTPBasicAuth</code>这个类来认证。</p>\n<p>上面的代码可以直接简写如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\">r = requests.get(<span class=\"string\">&#x27;https://static3.scrape.cuiqingcai.com/&#x27;</span>, auth=(<span class=\"string\">&#x27;admin&#x27;</span>, <span class=\"string\">&#x27;admin&#x27;</span>))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.status_code)</span><br></pre></td></tr></table></figure>\n\n<p>此外，<code>requests</code>还提供了其他认证方式，如<code>OAuth</code>认证，不过此时需要安装<code>oauth</code>包，安装命令如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install requests_oauthlib</span><br></pre></td></tr></table></figure>\n\n<p>使用<code>OAuth1</code>认证的方法如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests <span class=\"keyword\">from</span> requests_oauthlib </span><br><span class=\"line\"><span class=\"keyword\">import</span> OAuth1 </span><br><span class=\"line\">url = <span class=\"string\">&#x27;https://api.twitter.com/1.1/account/verify_credentials.json&#x27;</span> </span><br><span class=\"line\">auth = OAuth1(<span class=\"string\">&#x27;YOUR_APP_KEY&#x27;</span>, <span class=\"string\">&#x27;YOUR_APP_SECRET&#x27;</span>, <span class=\"string\">&#x27;USER_OAUTH_TOKEN&#x27;</span>, <span class=\"string\">&#x27;USER_OAUTH_TOKEN_SECRET&#x27;</span>)</span><br><span class=\"line\">requests.get(url, auth=auth) </span><br></pre></td></tr></table></figure>\n\n<p>更多详细的功能就可以参考<code>requests_oauthlib</code>的官方文档：<a href=\"https://requests-oauthlib.readthedocs.org/\">https://requests-oauthlib.readthedocs.org/</a>，不再赘述。</p>\n<h3 id=\"代理设置\"><a href=\"#代理设置\" class=\"headerlink\" title=\"代理设置\"></a>代理设置</h3><p>某些网站在测试的时候请求几次，能正常获取内容。但是对于大规模且频繁的请求，网站可能会弹出验证码，或者跳转到登录认证页面，更甚者可能会直接封禁客户端的<code>IP</code>，导致一定时间段内无法访问。</p>\n<p>为了防止这种情况发生，我们需要设置代理来解决这个问题，这就需要用到<code>proxies</code>参数。可以用这样的方式设置：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\">proxies = &#123; </span><br><span class=\"line\">  <span class=\"string\">&#x27;http&#x27;</span>: <span class=\"string\">&#x27;http://10.10.10.10:1080&#x27;</span>, </span><br><span class=\"line\">  <span class=\"string\">&#x27;https&#x27;</span>: <span class=\"string\">&#x27;http://10.10.10.10:1080&#x27;</span>, </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">requests.get(<span class=\"string\">&#x27;https://httpbin.org/get&#x27;</span>, proxies=proxies) </span><br></pre></td></tr></table></figure>\n\n<p>当然，直接运行这个实例或许行不通，因为这个代理可能是无效的，可以直接搜索寻找有效的代理并替换试验一下。</p>\n<p>若代理需要使用上文所述的身份认证，可以使用类似<code>ttp://user:password@host:port</code>这样的语法来设置代理，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\">proxies = &#123;<span class=\"string\">&#x27;https&#x27;</span>: <span class=\"string\">&#x27;http://user:password@10.10.10.10:1080/&#x27;</span>,&#125; </span><br><span class=\"line\">requests.get(<span class=\"string\">&#x27;https://httpbin.org/get&#x27;</span>, proxies=proxies)</span><br></pre></td></tr></table></figure>\n\n<p>除了基本的<code>HTTP</code>代理外，<code>requests</code>还支持<code>SOCKS</code>协议的代理。</p>\n<p>首先，需要安装<code>socks</code>这个库：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install <span class=\"string\">&quot;requests[socks]&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>然后就可以使用<code>SOCKS</code>协议代理了，示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\">proxies = &#123; </span><br><span class=\"line\">  <span class=\"string\">&#x27;http&#x27;</span>: <span class=\"string\">&#x27;socks5://user:password@host:port&#x27;</span>, </span><br><span class=\"line\">  <span class=\"string\">&#x27;https&#x27;</span>: <span class=\"string\">&#x27;socks5://user:password@host:port&#x27;</span> </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">requests.get(<span class=\"string\">&#x27;https://httpbin.org/get&#x27;</span>, proxies=proxies)</span><br></pre></td></tr></table></figure>\n"},{"title":"request、pyquest和pymongodb案例实战","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-23T13:12:36.000Z","pic":null,"_content":"\n## 准备工作\n\n在本节课开始之前，我们需要做好如下的准备工作：\n\n- 安装好`Python3`（最低为 3.6 版本），并能成功运行`Python3`程序。\n- 了解`Python`多进程的基本原理。\n- 了解`PythonHTTP`请求库`requests`的基本用法。\n- 了解正则表达式的用法和`Python`中正则表达式库`re`的基本用法。\n- 了解`PythonHTML`解析库`pyquery`的基本用法。\n- 了解`MongoDB`并安装和启动`MongoDB`服务。\n- 了解`Python`的`MongoDB`操作库`PyMongo`的基本用法。\n\n## 爬虫目标\n\n一个基本的静态网站作为案例进行爬取，需要爬取的链接为：[https://static1.scrape.cuiqingcai.com/](https://static1.scrape.cuiqingcai.com/)，这个网站里面包含了一些电影信息。\n\n要完成的目标是：\n\n- 用`requests`爬取这个站点每一页的电影列表，顺着列表再爬取每个电影的详情页。\n- 用`pyquery`和正则表达式提取每部电影的名称、封面、类别、上映时间、评分、剧情简介等内容。\n- 把以上爬取的内容存入`MongoDB`数据库。\n- 使用多进程实现爬取的加速。\n\n### 爬取列表页\n\n爬取的第一步肯定要从列表页入手，首先观察一下列表页的结构和翻页规则。在浏览器中访问[](https://static1.scrape.cuiqingcai.com/)，然后打开浏览器开发者工具，观察每一个电影信息区块对应的`HTML`，以及进入到详情页的`URL`是怎样的，如图所示：\n\n![](Screenshot_1.webp)\n\n每部电影对应的区块都是一个`div`节点，它的`class`属性都有`el-card`这个值。每个列表页有10个这样的`div`节点，也就对应着10部电影的信息。\n\n再分析下从列表页是怎么进入到详情页的，选中电影的名称，看下结果：\n\n![](Screenshot_2.webp)\n\n这个名称实际上是一个`h2`节点，其内部的文字就是电影的标题。`h2`节点的外面包含了一个`a`节点，这个`a`节点带有`href`属性，这就是一个超链接，其中`href`的值为`/detail/1`，这是一个相对网站的根`URL`[https://static1.scrape.cuiqingcai.com/](https://static1.scrape.cuiqingcai.com/)路径，加上网站的根`URL`就构成了[https://static1.scrape.cuiqingcai.com/detail/1](https://static1.scrape.cuiqingcai.com/detail/1)，也就是这部电影详情页的`URL`。这样只需要提取这个`href`属性就能构造出详情页的`URL`并接着爬取了。\n\n接下来分析下翻页的逻辑，拉到页面的最下方，可以看到分页页码，如图所示：\n\n![](Screenshot_3.webp)\n\n页面显示一共有`100`条数据，10页的内容，因此页码最多是10。接着我们点击第2页，如图所示：\n\n![](Screenshot_4.webp)\n\n可以看到网页的`URL`变成了`https://static1.scrape.cuiqingcai.com/page/2`，相比根`URL`多了`/page/2`这部分内容。网页的结构还是和原来一模一样，所以我们可以和第1页一样处理。\n\n接着查看第3页、第4页等内容，可以发现有这么一个规律，每一页的`URL`最后分别变成了`/page/3`、`/page/4`。所以，`/page`后面跟的就是列表页的页码，当然第1页也是一样，在根`URL`后面加上`/page/1`也是能访问的，只不过网站做了一下处理，默认的页码是1，所以显示第1页的内容。\n\n分析到这里，逻辑基本就清晰了。\n\n如果要完成列表页的爬取，可以这么实现：\n\n- 遍历页码构造`10`页的索引页`URL`。\n- 从每个索引页分析提取出每个电影的详情页`URL`。\n\n先定义一些基础的变量，并引入一些必要的库，写法如下：\n\n```python\nimport requests\nimport logging\nimport re\nimport pymongo\nfrom pyquery import PyQuery as pq\nfrom urllib.parse import urljoin\n\nlogging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s: %(message)s')\n\nBASE_URL = 'https://static1.scrape.cuiqingcai.com'\nTOTAL_PAGE = 10\n```\n\n引入`requests`用来爬取页面，`logging`用来输出信息，`re`用来实现正则表达式解析，`pyquery`用来直接解析网页，`pymongo`用来实现`MongoDB`存储，`urljoin`用来做`URL`的拼接。\n\n接着定义日志输出级别和输出格式，完成之后再定义`BASE_URL`为当前站点的根`URL`，`TOTAL_PAGE`为需要爬取的总页码数量。\n\n定义好了之后，来实现一个页面爬取的方法，实现如下：\n\n```python\ndef scrape_page(url):\n    logging.info('scraping %s...', url)\n    try:\n        response = requests.get(url, verify=False)\n        if response.status_code == 200:\n            return response.text\n        logging.error('get invalid status code %s while scraping %s', response.status_code, url)\n    except requests.RequestException:\n        logging.error('error occurred while scraping %s', url, exc_info=True)\n```\n\n考虑到不仅要爬取列表页，还要爬取详情页，在这里定义一个较通用的爬取页面的方法，叫作`scrape_page`，它接收一个`url`参数，返回页面的`html`代码。\n\n首先判断状态码是不是`200`，如果是，则直接返回页面的`HTML`代码，如果不是，则会输出错误日志信息。另外，这里实现了`requests`的异常处理，如果出现了爬取异常，则会输出对应的错误日志信息。这时将`logging`的`error`方法的`exc_info`参数设置为`True`则可以打印出`Traceback`错误堆栈信息。 \n\n有了`scrape_page`方法之后，给这个方法传入一个`url`，正常情况下它就可以返回页面的`HTML`代码。\n\n在这个基础上，来定义列表页的爬取方法吧，实现如下：\n\n```python\ndef scrape_index(page):\n    index_url = f'{BASE_URL}/page/{page}'\n    return scrape_page(index_url)\n```\n\n方法名称叫作`scrape_index`，这个方法会接收一个`page`参数，即列表页的页码，在方法里面实现列表页的`URL`拼接，然后调用`scrape_page`方法爬取即可得到列表页的`HTML`代码了。\n\n获取了`HTML`代码后，下一步就是解析列表页，并得到每部电影的详情页的`URL`了，实现如下：\n\n```python\ndef parse_index(html):\n    doc = pq(html)\n    links = doc('.el-card .name')\n    for link in links.items():\n        href = link.attr('href')\n        detail_url = urljoin(BASE_URL, href)\n        logging.info('get detail info %s', detail_url)\n        yield detail_url\n```\n\n这里我们定义了`parse_index`方法，它接收一个`html`参数，即列表页的`HTML`代码。接着用`pyquery`新建一个`PyQuery`对象，完成之后再用`.el-card .name`选择器选出来每个电影名称对应的超链接节点。遍历这些节点，通过调用`attr`方法并传入`href`获得详情页的`URL`路径，得到的`href`就是上文所说的类似`/detail/1`这样的结果。这并不是一个完整的`URL`，所以需要借助`urljoin`方法把`BASE_URL`和`href`拼接起来，获得详情页的完整`URL`，得到的结果就是类似`https://static1.scrape.cuiqingcai.com/detail/1`这样完整的`URL`了，最后`yield`返回即可。\n\n通过调用`parse_index`方法传入列表页的`HTML`代码就可以获得该列表页所有电影的详情页`URL`了，接下来把上面的方法串联调用一下，实现如下：\n\n```python\ndef main():\n    for page in range(1, TOTAL_PAGE+1):\n        index_html = scrape_index(page)\n        detail_urls = parse_index((index_html))\n        logging.info('detail urls %s', list(detail_urls))\n\nif __name__ == '__main__':\n    main()\n```\n\n定义了`main`方法来完成上面所有方法的调用，首先使用`range`方法遍历一下页码，得到的`page`是`1~10`，接着把`page`变量传给`scrape_index`方法，得到列表页的`HTML`，赋值为`index_html`变量。接下来再将`index_html`变量传给`parse_index`方法，得到列表页所有电影的详情页`URL`，赋值为`detail_urls`，结果是一个生成器，调用`list`方法就可以将其输出出来。\n\n```python\n2021-05-23 23:23:04,059 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/1\n2021-05-23 23:23:04,060 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/2\n2021-05-23 23:23:04,061 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/3\n2021-05-23 23:23:04,062 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/4\n2021-05-23 23:23:04,063 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/5\n2021-05-23 23:23:04,064 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/6\n2021-05-23 23:23:04,065 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/7\n2021-05-23 23:23:04,067 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/8\n2021-05-23 23:23:04,070 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/9\n2021-05-23 23:23:04,072 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/10\n2021-05-23 23:23:04,074 - INFO: detail urls ['https://static1.scrape.cuiqingcai.com/detail/1', 'https://static1.scrape.cuiqingcai.com/detail/2', 'https://static1.scrape.cuiqingcai.com/detail/3', 'https://static1.scrape.cuiqingcai.com/detail/4', 'https://static1.scrape.cuiqingcai.com/detail/5', 'https://static1.scrape.cuiqingcai.com/detail/6', 'https://static1.scrape.cuiqingcai.com/detail/7', 'https://static1.scrape.cuiqingcai.com/detail/8', 'https://static1.scrape.cuiqingcai.com/detail/9', 'https://static1.scrape.cuiqingcai.com/detail/10']\n2021-05-23 23:23:04,076 - INFO: scraping https://static1.scrape.cuiqingcai.com/page/2...\n....\n```\n\n由于输出内容比较多，这里只贴了一部分。可以看到，在这个过程中程序首先爬取了第`1`页列表页，然后得到了对应详情页的每个`URL`，接着再接着爬第2页、第3页，一直到第10页，依次输出了每一页的详情页`URL`。这样，就成功获取到所有电影详情页`URL`。\n\n### 爬取详情页\n\n首先观察一下详情页的`HTML`代码，如图所示：\n\n![](Screenshot_5.webp)\n\n经过分析，要提取的内容和对应的节点信息如下：\n\n- 封面：是一个`img`节点，其`class`属性为`cover`。\n- 名称：是一个`h2`节点，其内容便是名称。\n- 类别：是`span`节点，其内容便是类别\n- 内容，其外侧是`button`节点，再外侧则是`class`为`categories`的`div`节点。\n- 上映时间：是`span`节点，其内容包含了上映时间，其外侧是包含了`class`为`info`的`div`节点。但注意这个`div`前面还有一个`class`为`info`的`div`节点，可以使用其内容来区分，也可以使用`nth-child`或`nth- of-type`这样的选择器来区分。另外提取结果中还多了「上映」二字，可以用正则表达式把日期提取出来。\n- 评分：是一个`p`节点，其内容便是评分，`p`节点的`class`属性为`score`。\n- 剧情简介：是一个`p`节点，其内容便是\n- 剧情简介，其外侧是`class`为`drama`的`div`节点。\n\n刚才已经成功获取了详情页的`URL`，接下来要定义一个详情页的爬取方法，实现如下：\n\n```python\ndef scrape_detail(url): \n    return scrape_page(url)\n```\n\n定义了一个`scrape_detail`方法，它接收一个`url`参数，并通过调用`scrape_page`方法获得网页源代码。由于刚才已经实现了`scrape_page`方法，所以在这里不用再写一遍页面爬取的逻辑，直接调用即可，这就做到了代码复用。\n\n单独定义一个`scrape_detail`方法在逻辑上会显得更清晰，而且以后如果想要对`scrape_detail`方法进行改动，比如添加日志输出或是增加预处理，都可以在 `scrape_detail`里面实现，而不用改动`scrape_page`方法，灵活性会更好。\n\n详情页的爬取方法已经实现了，接着就是详情页的解析了，实现如下：\n\n```python\ndef parse_detail(html):\n    \"\"\"详情页的解析\"\"\"\n    doc = pq(html)\n    cover = doc('img.cover').attr('src')\n    name = doc('a > h2').text()\n    categories = [item.text() for item in doc('.categories button span').items()]\n    published_at = doc('.info:contains(上映)').text()\n    published_at = re.search('(\\d{4}-\\d{2}-\\d{2})', published_at).group(1) \\\n        if published_at and re.search('\\d{4}-\\d{2}-\\d{2}', published_at) else None\n    drama = doc('.drama p').text()\n    score = doc('p.score').text()\n    score = float(score) if score else None\n    return{\n        'cover': cover,\n        'name': name,\n        'categories': categories,\n        'published_at': published_at,\n        'drama': drama,\n        'score': score\n    }\n```\n\n定义了`parse_detail`方法用于解析详情页，它接收一个`html`参数，解析其中的内容，并以字典的形式返回结果。每个字段的解析情况如下所述：\n\n- `cove`r：封面，直接选取`class`为`cover`的`img`节点，并调用`attr`方法获取`src`属性的内容即可。\n- `name`：名称，直接选取`a`节点的直接子节点`h2`节点，并调用`text`方法提取其文本内容即可得到名称。\n- `categories`：类别，由于类别是多个，所以这里首先用`.categories button span`选取了`class`为`categories`的节点内部的`span`节点，其结果是多个，所以这里进行了遍历，取出了每个`span`节点的文本内容，得到的便是列表形式的类别。\n- `published_at`：上映时间，由于`pyquery`支持使用`:contains`直接指定包含的文本内容并进行提取，且每个上映时间信息都包含了「上映」二字，所以这里就直接使用`:contains(上映)`提取了`class`为`info`的`div`节点。提取之后，得到的结果类似「1993-07-26 上映」这样，并不想要「上映」这两个字，所以又调用了正则表达式把日期单独提取出来了。当然这里也可以直接使用`strip`或`replace`方法把多余的文字去掉。\n- `drama`：直接提取`class`为`drama`的节点内部的`p`节点的文本即可。\n- `score`：直接提取`class`为`score`的`p`节点的文本即可，由于提取结果是字符串，所以我们需要把它转成浮点数，即``float`类型。\n\n上述字段提取完毕之后，构造一个字典返回。这样，成功完成了详情页的提取和分析了。\n\n将main方法稍微改写一下，增加这两个方法的调用，改写如下：\n\n```python\ndef main():\n    for page in range(1, TOTAL_PAGE+1):\n        index_html = scrape_index(page)\n        detail_urls = parse_index((index_html))\n        for detail_url in detail_urls:\n            detail_html = scrape_detail(detail_url)\n            data = parse_detail(detail_html)\n            logging.info('get detail data %s', data)\n```\n\n首先遍历了`detail_urls`，获取了每个详情页的`URL`，然后依次调用了`scrape_detail`和`parse_detail`方法，最后得到了每个详情页的提取结果，赋值为`data`并输出。\n\n运行结果如下：\n\n```python\n2021-05-24 12:46:31,432 - INFO: get detail data {'cover': 'https://p0.meituan.net/movie/b0d986a8bf89278afbb19f6abaef70f31206570.jpg@464w_644h_1e_1c', 'name': \"辛德勒的名单 - Schindler's List\", 'categories': ['剧情', '历史', '战争'], 'published_at': '1993-11-30', 'drama': '1939年，波兰在纳粹德国的统治下，党卫军对犹太人进行了隔离统治。德国商人奥斯卡·辛德勒（连姆·尼森 饰）来到德军统治下的克拉科夫，开设了一间搪瓷厂，生产军需用品。凭着出众的社交能力和大量的金钱，辛德勒和德军建立了良好 的关系，他的工厂雇用犹太人工作，大发战争财。1943年，克拉科夫的犹太人遭到了惨绝人寰的大屠杀，辛德勒目睹这一切，受到了极大的震撼，他贿赂军官，让自己的工厂成为集中营的附属劳役营，在那些疯狂屠杀的日子里，他的工厂也成为了犹太人的避难所。1944年，德国战败前夕，屠杀犹太人的行动越发疯狂，辛德勒向德军军官开出了1200人的名单，倾家荡产买下了这些犹太人的生命。在那些暗无天日的岁月里，拯救一个人，就是拯救全世界。', 'score': 9.5}\n```\n\n可以看到，已经成功提取出每部电影的基本信息，包括封面、名称、类别，等等。\n\n## 保存到MongoDB\n\n请确保现在有一个可以正常连接和使用的`MongoDB`数据库。 将数据导入`MongoDB`需要用到`PyMongo`这个库，这个在最开始已经引入过了。那么接下来我们定义一下 `MongoDB`的连接配置，实现如下：\n\n```python\nMONGO_CONNECTION_STRING = 'mongodb://localhost:27017'\nMONGO_DB_NAME = 'movies'\nMONGO_COLLECTIONS_NAME = 'movies'\n\nclient = pymongo.MongoClient(MONGO_CONNECTION_STRING)\ndb = client['movies']\ncollection = db['movies']\n```\n\n在这里声明了几个变量，介绍如下：\n\n- `MONGO_CONNECTION_STRING`：`MongoDB`的连接字符串，里面定义了`MongoDB`的基本连接信息，如`host`、`port`，还可以定义用户名密码等内容。\n- `MONGO_DB_NAME`：`MongoDB`数据库的名称。\n- `MONGO_COLLECTION_NAME`：`MongoDB`的集合名称。\n\n这里用`MongoClient`声明了一个连接对象，然后依次声明了存储的数据库和集合。接下来，再实现一个将数据保存到`MongoDB`的方法，实现如下：\n\n```python\ndef save_data(data):\n    collection.update_one({\n        'name': data.get('name')\n    },{\n        '$set': data\n    }, upsert=True)\n```\n\n声明了一个`save_data`方法，它接收一个`data`参数，也就是我们刚才提取的电影详情信息。在方法里面，调用了`update_one`方法，第1个参数是**查询条件**，即根据`name`进行查询；第2个参数是`data`对象本身，也就是所有的数据，这里用`$set`操作符表示更新操作；第3个参数很关键，这里实际上是`upsert`参数，如果把这个设置为 `True`，则可以做到存在即更新，不存在即插入的功能，更新会根据第一个参数设置的`name`字段，所以这样可以防止数据库中出现同名的电影数据。\n\n> 注：实际上电影可能有同名，但该场景下的爬取数据没有同名情况，当然这里更重要的是实现`MongoDB`的去重操作。\n\n接下来将`main`方法稍微改写一下就好了，改写如下：\n\n```python\ndef main():\n    for page in range(1, TOTAL_PAGE+1):\n        index_html = scrape_index(page)\n        detail_urls = parse_index((index_html))\n        for detail_url in detail_urls:\n            detail_html = scrape_detail(detail_url)\n            data = parse_detail(detail_html)\n            logging.info('get detail data %s\\n', data)\n            logging.info('saving data to mongodb')\n            save_data(data)\n            logging.info('data saved successfully\\n')\n```\n\n重新运行，输出结果：\n\n```python\n......\n2021-05-24 13:16:46,882 - INFO: get detail data {'cover': 'https://p0.meituan.net/movie/58782fa5439c25d764713f711ebecd1e201941.jpg@464w_644h_1e_1c', 'name': '魂断蓝桥 - Waterloo Bridge', 'categories': ['剧情', '爱情', '战争'], 'published_at': '1940-05-17', 'drama': '第一次世界大战期间，回国度假的陆军中 \n尉罗伊（罗伯特·泰勒 饰）在滑铁卢桥上邂逅了舞蹈演员玛拉（费雯·丽 饰），两人彼此倾心，爱情迅速升温。就在两人决定结婚之时，罗伊应招回营地，两人被迫分离。由\n于错过剧团演出，玛拉被开除，只能和好友相依为命。不久玛拉得知罗伊阵亡的消息，几欲崩溃，备受打击。失去爱情的玛拉感到一切都失去了意义，为了生存，她和好友不\n得不沦为妓女。然而命运弄人，就在此时玛拉竟然再次遇到了罗伊。虽然为罗伊的生还兴奋不已，玛拉却因自己的失身陷入痛苦之中。感到一切难以挽回的玛拉潸然离开，独\n自来到两人最初相遇的地点——滑铁卢桥上…', 'score': 9.5}\n\n2021-05-24 13:16:46,885 - INFO: saving data to mongodb\n2021-05-24 13:16:46,889 - INFO: data saved successfully\n```\n\n运行完毕之后我们可以使用`MongoDB`客户端工具可视化查看已经爬取到的数据，结果如下：\n\n![](Screenshot_6.webp)\n\n## 多进程加速\n\n由于整个的爬取是单进程的，而且只能逐条爬取，速度稍微有点慢，有没有方法来对整个爬取过程进行加速呢？\n\n在前面学习了多进程的基本原理和使用方法，下面就来实践一下多进程的爬取。\n\n由于一共有`10`页详情页，并且这`10`页内容是互不干扰的，所以可以一页开一个进程来爬取。由于这`10`个列表页页码正好可以提前构造成一个列表，所以可以选用多进程里面的进程池`Pool`来实现这个过程。\n\n这里需要改写下`main`方法的调用，实现如下：\n\n```python\ndef main(page):\n    for page in range(1, TOTAL_PAGE+1):\n        index_html = scrape_index(page)\n        detail_urls = parse_index((index_html))\n        for detail_url in detail_urls:\n            detail_html = scrape_detail(detail_url)\n            data = parse_detail(detail_html)\n            logging.info('get detail data %s\\n', data)\n            logging.info('saving data to mongodb')\n            save_data(data)\n            logging.info('data saved successfully\\n')\n\n\nif __name__ == '__main__':\n    pool = multiprocessing.Pool()\n    pages = range(1, TOTAL_PAGE + 1)\n    pool.map(main, pages)\n    pool.close()\n    pool.join()\n```\n\n这里首先给`main`方法添加一个参数`page`，用以表示列表页的页码。接着声明了一个进程池，并声明`pages`为所有需要遍历的页码，即`1~10`。最后调用`map`方法，第1个参数就是需要被调用的方法，第2个参数就是`pages`，即需要遍历的页码。\n\n这样`pages`就会被依次遍历。把`1~10`这10个页码分别传递给`main`方法，并把每次的调用变成一个进程，加入到进程池中执行，进程池会根据当前运行环境来决定运行多少进程。\n\n运行输出结果和之前类似，但是可以明显看到加了多进程执行之后，爬取速度快了非常多。可以清空一下之前的`MongoDB`数据，可以发现数据依然可以被正常保存到`MongoDB`数据库中。\n","source":"_posts/request、pyquest和pymongodb案例实战.md","raw":"---\ntitle: request、pyquest和pymongodb案例实战\ntags:\n  - request\n  - pyquest\n  - pymongodb\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-23 21:12:36\ncategories: 爬虫\npic:\n---\n\n## 准备工作\n\n在本节课开始之前，我们需要做好如下的准备工作：\n\n- 安装好`Python3`（最低为 3.6 版本），并能成功运行`Python3`程序。\n- 了解`Python`多进程的基本原理。\n- 了解`PythonHTTP`请求库`requests`的基本用法。\n- 了解正则表达式的用法和`Python`中正则表达式库`re`的基本用法。\n- 了解`PythonHTML`解析库`pyquery`的基本用法。\n- 了解`MongoDB`并安装和启动`MongoDB`服务。\n- 了解`Python`的`MongoDB`操作库`PyMongo`的基本用法。\n\n## 爬虫目标\n\n一个基本的静态网站作为案例进行爬取，需要爬取的链接为：[https://static1.scrape.cuiqingcai.com/](https://static1.scrape.cuiqingcai.com/)，这个网站里面包含了一些电影信息。\n\n要完成的目标是：\n\n- 用`requests`爬取这个站点每一页的电影列表，顺着列表再爬取每个电影的详情页。\n- 用`pyquery`和正则表达式提取每部电影的名称、封面、类别、上映时间、评分、剧情简介等内容。\n- 把以上爬取的内容存入`MongoDB`数据库。\n- 使用多进程实现爬取的加速。\n\n### 爬取列表页\n\n爬取的第一步肯定要从列表页入手，首先观察一下列表页的结构和翻页规则。在浏览器中访问[](https://static1.scrape.cuiqingcai.com/)，然后打开浏览器开发者工具，观察每一个电影信息区块对应的`HTML`，以及进入到详情页的`URL`是怎样的，如图所示：\n\n![](Screenshot_1.webp)\n\n每部电影对应的区块都是一个`div`节点，它的`class`属性都有`el-card`这个值。每个列表页有10个这样的`div`节点，也就对应着10部电影的信息。\n\n再分析下从列表页是怎么进入到详情页的，选中电影的名称，看下结果：\n\n![](Screenshot_2.webp)\n\n这个名称实际上是一个`h2`节点，其内部的文字就是电影的标题。`h2`节点的外面包含了一个`a`节点，这个`a`节点带有`href`属性，这就是一个超链接，其中`href`的值为`/detail/1`，这是一个相对网站的根`URL`[https://static1.scrape.cuiqingcai.com/](https://static1.scrape.cuiqingcai.com/)路径，加上网站的根`URL`就构成了[https://static1.scrape.cuiqingcai.com/detail/1](https://static1.scrape.cuiqingcai.com/detail/1)，也就是这部电影详情页的`URL`。这样只需要提取这个`href`属性就能构造出详情页的`URL`并接着爬取了。\n\n接下来分析下翻页的逻辑，拉到页面的最下方，可以看到分页页码，如图所示：\n\n![](Screenshot_3.webp)\n\n页面显示一共有`100`条数据，10页的内容，因此页码最多是10。接着我们点击第2页，如图所示：\n\n![](Screenshot_4.webp)\n\n可以看到网页的`URL`变成了`https://static1.scrape.cuiqingcai.com/page/2`，相比根`URL`多了`/page/2`这部分内容。网页的结构还是和原来一模一样，所以我们可以和第1页一样处理。\n\n接着查看第3页、第4页等内容，可以发现有这么一个规律，每一页的`URL`最后分别变成了`/page/3`、`/page/4`。所以，`/page`后面跟的就是列表页的页码，当然第1页也是一样，在根`URL`后面加上`/page/1`也是能访问的，只不过网站做了一下处理，默认的页码是1，所以显示第1页的内容。\n\n分析到这里，逻辑基本就清晰了。\n\n如果要完成列表页的爬取，可以这么实现：\n\n- 遍历页码构造`10`页的索引页`URL`。\n- 从每个索引页分析提取出每个电影的详情页`URL`。\n\n先定义一些基础的变量，并引入一些必要的库，写法如下：\n\n```python\nimport requests\nimport logging\nimport re\nimport pymongo\nfrom pyquery import PyQuery as pq\nfrom urllib.parse import urljoin\n\nlogging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s: %(message)s')\n\nBASE_URL = 'https://static1.scrape.cuiqingcai.com'\nTOTAL_PAGE = 10\n```\n\n引入`requests`用来爬取页面，`logging`用来输出信息，`re`用来实现正则表达式解析，`pyquery`用来直接解析网页，`pymongo`用来实现`MongoDB`存储，`urljoin`用来做`URL`的拼接。\n\n接着定义日志输出级别和输出格式，完成之后再定义`BASE_URL`为当前站点的根`URL`，`TOTAL_PAGE`为需要爬取的总页码数量。\n\n定义好了之后，来实现一个页面爬取的方法，实现如下：\n\n```python\ndef scrape_page(url):\n    logging.info('scraping %s...', url)\n    try:\n        response = requests.get(url, verify=False)\n        if response.status_code == 200:\n            return response.text\n        logging.error('get invalid status code %s while scraping %s', response.status_code, url)\n    except requests.RequestException:\n        logging.error('error occurred while scraping %s', url, exc_info=True)\n```\n\n考虑到不仅要爬取列表页，还要爬取详情页，在这里定义一个较通用的爬取页面的方法，叫作`scrape_page`，它接收一个`url`参数，返回页面的`html`代码。\n\n首先判断状态码是不是`200`，如果是，则直接返回页面的`HTML`代码，如果不是，则会输出错误日志信息。另外，这里实现了`requests`的异常处理，如果出现了爬取异常，则会输出对应的错误日志信息。这时将`logging`的`error`方法的`exc_info`参数设置为`True`则可以打印出`Traceback`错误堆栈信息。 \n\n有了`scrape_page`方法之后，给这个方法传入一个`url`，正常情况下它就可以返回页面的`HTML`代码。\n\n在这个基础上，来定义列表页的爬取方法吧，实现如下：\n\n```python\ndef scrape_index(page):\n    index_url = f'{BASE_URL}/page/{page}'\n    return scrape_page(index_url)\n```\n\n方法名称叫作`scrape_index`，这个方法会接收一个`page`参数，即列表页的页码，在方法里面实现列表页的`URL`拼接，然后调用`scrape_page`方法爬取即可得到列表页的`HTML`代码了。\n\n获取了`HTML`代码后，下一步就是解析列表页，并得到每部电影的详情页的`URL`了，实现如下：\n\n```python\ndef parse_index(html):\n    doc = pq(html)\n    links = doc('.el-card .name')\n    for link in links.items():\n        href = link.attr('href')\n        detail_url = urljoin(BASE_URL, href)\n        logging.info('get detail info %s', detail_url)\n        yield detail_url\n```\n\n这里我们定义了`parse_index`方法，它接收一个`html`参数，即列表页的`HTML`代码。接着用`pyquery`新建一个`PyQuery`对象，完成之后再用`.el-card .name`选择器选出来每个电影名称对应的超链接节点。遍历这些节点，通过调用`attr`方法并传入`href`获得详情页的`URL`路径，得到的`href`就是上文所说的类似`/detail/1`这样的结果。这并不是一个完整的`URL`，所以需要借助`urljoin`方法把`BASE_URL`和`href`拼接起来，获得详情页的完整`URL`，得到的结果就是类似`https://static1.scrape.cuiqingcai.com/detail/1`这样完整的`URL`了，最后`yield`返回即可。\n\n通过调用`parse_index`方法传入列表页的`HTML`代码就可以获得该列表页所有电影的详情页`URL`了，接下来把上面的方法串联调用一下，实现如下：\n\n```python\ndef main():\n    for page in range(1, TOTAL_PAGE+1):\n        index_html = scrape_index(page)\n        detail_urls = parse_index((index_html))\n        logging.info('detail urls %s', list(detail_urls))\n\nif __name__ == '__main__':\n    main()\n```\n\n定义了`main`方法来完成上面所有方法的调用，首先使用`range`方法遍历一下页码，得到的`page`是`1~10`，接着把`page`变量传给`scrape_index`方法，得到列表页的`HTML`，赋值为`index_html`变量。接下来再将`index_html`变量传给`parse_index`方法，得到列表页所有电影的详情页`URL`，赋值为`detail_urls`，结果是一个生成器，调用`list`方法就可以将其输出出来。\n\n```python\n2021-05-23 23:23:04,059 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/1\n2021-05-23 23:23:04,060 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/2\n2021-05-23 23:23:04,061 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/3\n2021-05-23 23:23:04,062 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/4\n2021-05-23 23:23:04,063 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/5\n2021-05-23 23:23:04,064 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/6\n2021-05-23 23:23:04,065 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/7\n2021-05-23 23:23:04,067 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/8\n2021-05-23 23:23:04,070 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/9\n2021-05-23 23:23:04,072 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/10\n2021-05-23 23:23:04,074 - INFO: detail urls ['https://static1.scrape.cuiqingcai.com/detail/1', 'https://static1.scrape.cuiqingcai.com/detail/2', 'https://static1.scrape.cuiqingcai.com/detail/3', 'https://static1.scrape.cuiqingcai.com/detail/4', 'https://static1.scrape.cuiqingcai.com/detail/5', 'https://static1.scrape.cuiqingcai.com/detail/6', 'https://static1.scrape.cuiqingcai.com/detail/7', 'https://static1.scrape.cuiqingcai.com/detail/8', 'https://static1.scrape.cuiqingcai.com/detail/9', 'https://static1.scrape.cuiqingcai.com/detail/10']\n2021-05-23 23:23:04,076 - INFO: scraping https://static1.scrape.cuiqingcai.com/page/2...\n....\n```\n\n由于输出内容比较多，这里只贴了一部分。可以看到，在这个过程中程序首先爬取了第`1`页列表页，然后得到了对应详情页的每个`URL`，接着再接着爬第2页、第3页，一直到第10页，依次输出了每一页的详情页`URL`。这样，就成功获取到所有电影详情页`URL`。\n\n### 爬取详情页\n\n首先观察一下详情页的`HTML`代码，如图所示：\n\n![](Screenshot_5.webp)\n\n经过分析，要提取的内容和对应的节点信息如下：\n\n- 封面：是一个`img`节点，其`class`属性为`cover`。\n- 名称：是一个`h2`节点，其内容便是名称。\n- 类别：是`span`节点，其内容便是类别\n- 内容，其外侧是`button`节点，再外侧则是`class`为`categories`的`div`节点。\n- 上映时间：是`span`节点，其内容包含了上映时间，其外侧是包含了`class`为`info`的`div`节点。但注意这个`div`前面还有一个`class`为`info`的`div`节点，可以使用其内容来区分，也可以使用`nth-child`或`nth- of-type`这样的选择器来区分。另外提取结果中还多了「上映」二字，可以用正则表达式把日期提取出来。\n- 评分：是一个`p`节点，其内容便是评分，`p`节点的`class`属性为`score`。\n- 剧情简介：是一个`p`节点，其内容便是\n- 剧情简介，其外侧是`class`为`drama`的`div`节点。\n\n刚才已经成功获取了详情页的`URL`，接下来要定义一个详情页的爬取方法，实现如下：\n\n```python\ndef scrape_detail(url): \n    return scrape_page(url)\n```\n\n定义了一个`scrape_detail`方法，它接收一个`url`参数，并通过调用`scrape_page`方法获得网页源代码。由于刚才已经实现了`scrape_page`方法，所以在这里不用再写一遍页面爬取的逻辑，直接调用即可，这就做到了代码复用。\n\n单独定义一个`scrape_detail`方法在逻辑上会显得更清晰，而且以后如果想要对`scrape_detail`方法进行改动，比如添加日志输出或是增加预处理，都可以在 `scrape_detail`里面实现，而不用改动`scrape_page`方法，灵活性会更好。\n\n详情页的爬取方法已经实现了，接着就是详情页的解析了，实现如下：\n\n```python\ndef parse_detail(html):\n    \"\"\"详情页的解析\"\"\"\n    doc = pq(html)\n    cover = doc('img.cover').attr('src')\n    name = doc('a > h2').text()\n    categories = [item.text() for item in doc('.categories button span').items()]\n    published_at = doc('.info:contains(上映)').text()\n    published_at = re.search('(\\d{4}-\\d{2}-\\d{2})', published_at).group(1) \\\n        if published_at and re.search('\\d{4}-\\d{2}-\\d{2}', published_at) else None\n    drama = doc('.drama p').text()\n    score = doc('p.score').text()\n    score = float(score) if score else None\n    return{\n        'cover': cover,\n        'name': name,\n        'categories': categories,\n        'published_at': published_at,\n        'drama': drama,\n        'score': score\n    }\n```\n\n定义了`parse_detail`方法用于解析详情页，它接收一个`html`参数，解析其中的内容，并以字典的形式返回结果。每个字段的解析情况如下所述：\n\n- `cove`r：封面，直接选取`class`为`cover`的`img`节点，并调用`attr`方法获取`src`属性的内容即可。\n- `name`：名称，直接选取`a`节点的直接子节点`h2`节点，并调用`text`方法提取其文本内容即可得到名称。\n- `categories`：类别，由于类别是多个，所以这里首先用`.categories button span`选取了`class`为`categories`的节点内部的`span`节点，其结果是多个，所以这里进行了遍历，取出了每个`span`节点的文本内容，得到的便是列表形式的类别。\n- `published_at`：上映时间，由于`pyquery`支持使用`:contains`直接指定包含的文本内容并进行提取，且每个上映时间信息都包含了「上映」二字，所以这里就直接使用`:contains(上映)`提取了`class`为`info`的`div`节点。提取之后，得到的结果类似「1993-07-26 上映」这样，并不想要「上映」这两个字，所以又调用了正则表达式把日期单独提取出来了。当然这里也可以直接使用`strip`或`replace`方法把多余的文字去掉。\n- `drama`：直接提取`class`为`drama`的节点内部的`p`节点的文本即可。\n- `score`：直接提取`class`为`score`的`p`节点的文本即可，由于提取结果是字符串，所以我们需要把它转成浮点数，即``float`类型。\n\n上述字段提取完毕之后，构造一个字典返回。这样，成功完成了详情页的提取和分析了。\n\n将main方法稍微改写一下，增加这两个方法的调用，改写如下：\n\n```python\ndef main():\n    for page in range(1, TOTAL_PAGE+1):\n        index_html = scrape_index(page)\n        detail_urls = parse_index((index_html))\n        for detail_url in detail_urls:\n            detail_html = scrape_detail(detail_url)\n            data = parse_detail(detail_html)\n            logging.info('get detail data %s', data)\n```\n\n首先遍历了`detail_urls`，获取了每个详情页的`URL`，然后依次调用了`scrape_detail`和`parse_detail`方法，最后得到了每个详情页的提取结果，赋值为`data`并输出。\n\n运行结果如下：\n\n```python\n2021-05-24 12:46:31,432 - INFO: get detail data {'cover': 'https://p0.meituan.net/movie/b0d986a8bf89278afbb19f6abaef70f31206570.jpg@464w_644h_1e_1c', 'name': \"辛德勒的名单 - Schindler's List\", 'categories': ['剧情', '历史', '战争'], 'published_at': '1993-11-30', 'drama': '1939年，波兰在纳粹德国的统治下，党卫军对犹太人进行了隔离统治。德国商人奥斯卡·辛德勒（连姆·尼森 饰）来到德军统治下的克拉科夫，开设了一间搪瓷厂，生产军需用品。凭着出众的社交能力和大量的金钱，辛德勒和德军建立了良好 的关系，他的工厂雇用犹太人工作，大发战争财。1943年，克拉科夫的犹太人遭到了惨绝人寰的大屠杀，辛德勒目睹这一切，受到了极大的震撼，他贿赂军官，让自己的工厂成为集中营的附属劳役营，在那些疯狂屠杀的日子里，他的工厂也成为了犹太人的避难所。1944年，德国战败前夕，屠杀犹太人的行动越发疯狂，辛德勒向德军军官开出了1200人的名单，倾家荡产买下了这些犹太人的生命。在那些暗无天日的岁月里，拯救一个人，就是拯救全世界。', 'score': 9.5}\n```\n\n可以看到，已经成功提取出每部电影的基本信息，包括封面、名称、类别，等等。\n\n## 保存到MongoDB\n\n请确保现在有一个可以正常连接和使用的`MongoDB`数据库。 将数据导入`MongoDB`需要用到`PyMongo`这个库，这个在最开始已经引入过了。那么接下来我们定义一下 `MongoDB`的连接配置，实现如下：\n\n```python\nMONGO_CONNECTION_STRING = 'mongodb://localhost:27017'\nMONGO_DB_NAME = 'movies'\nMONGO_COLLECTIONS_NAME = 'movies'\n\nclient = pymongo.MongoClient(MONGO_CONNECTION_STRING)\ndb = client['movies']\ncollection = db['movies']\n```\n\n在这里声明了几个变量，介绍如下：\n\n- `MONGO_CONNECTION_STRING`：`MongoDB`的连接字符串，里面定义了`MongoDB`的基本连接信息，如`host`、`port`，还可以定义用户名密码等内容。\n- `MONGO_DB_NAME`：`MongoDB`数据库的名称。\n- `MONGO_COLLECTION_NAME`：`MongoDB`的集合名称。\n\n这里用`MongoClient`声明了一个连接对象，然后依次声明了存储的数据库和集合。接下来，再实现一个将数据保存到`MongoDB`的方法，实现如下：\n\n```python\ndef save_data(data):\n    collection.update_one({\n        'name': data.get('name')\n    },{\n        '$set': data\n    }, upsert=True)\n```\n\n声明了一个`save_data`方法，它接收一个`data`参数，也就是我们刚才提取的电影详情信息。在方法里面，调用了`update_one`方法，第1个参数是**查询条件**，即根据`name`进行查询；第2个参数是`data`对象本身，也就是所有的数据，这里用`$set`操作符表示更新操作；第3个参数很关键，这里实际上是`upsert`参数，如果把这个设置为 `True`，则可以做到存在即更新，不存在即插入的功能，更新会根据第一个参数设置的`name`字段，所以这样可以防止数据库中出现同名的电影数据。\n\n> 注：实际上电影可能有同名，但该场景下的爬取数据没有同名情况，当然这里更重要的是实现`MongoDB`的去重操作。\n\n接下来将`main`方法稍微改写一下就好了，改写如下：\n\n```python\ndef main():\n    for page in range(1, TOTAL_PAGE+1):\n        index_html = scrape_index(page)\n        detail_urls = parse_index((index_html))\n        for detail_url in detail_urls:\n            detail_html = scrape_detail(detail_url)\n            data = parse_detail(detail_html)\n            logging.info('get detail data %s\\n', data)\n            logging.info('saving data to mongodb')\n            save_data(data)\n            logging.info('data saved successfully\\n')\n```\n\n重新运行，输出结果：\n\n```python\n......\n2021-05-24 13:16:46,882 - INFO: get detail data {'cover': 'https://p0.meituan.net/movie/58782fa5439c25d764713f711ebecd1e201941.jpg@464w_644h_1e_1c', 'name': '魂断蓝桥 - Waterloo Bridge', 'categories': ['剧情', '爱情', '战争'], 'published_at': '1940-05-17', 'drama': '第一次世界大战期间，回国度假的陆军中 \n尉罗伊（罗伯特·泰勒 饰）在滑铁卢桥上邂逅了舞蹈演员玛拉（费雯·丽 饰），两人彼此倾心，爱情迅速升温。就在两人决定结婚之时，罗伊应招回营地，两人被迫分离。由\n于错过剧团演出，玛拉被开除，只能和好友相依为命。不久玛拉得知罗伊阵亡的消息，几欲崩溃，备受打击。失去爱情的玛拉感到一切都失去了意义，为了生存，她和好友不\n得不沦为妓女。然而命运弄人，就在此时玛拉竟然再次遇到了罗伊。虽然为罗伊的生还兴奋不已，玛拉却因自己的失身陷入痛苦之中。感到一切难以挽回的玛拉潸然离开，独\n自来到两人最初相遇的地点——滑铁卢桥上…', 'score': 9.5}\n\n2021-05-24 13:16:46,885 - INFO: saving data to mongodb\n2021-05-24 13:16:46,889 - INFO: data saved successfully\n```\n\n运行完毕之后我们可以使用`MongoDB`客户端工具可视化查看已经爬取到的数据，结果如下：\n\n![](Screenshot_6.webp)\n\n## 多进程加速\n\n由于整个的爬取是单进程的，而且只能逐条爬取，速度稍微有点慢，有没有方法来对整个爬取过程进行加速呢？\n\n在前面学习了多进程的基本原理和使用方法，下面就来实践一下多进程的爬取。\n\n由于一共有`10`页详情页，并且这`10`页内容是互不干扰的，所以可以一页开一个进程来爬取。由于这`10`个列表页页码正好可以提前构造成一个列表，所以可以选用多进程里面的进程池`Pool`来实现这个过程。\n\n这里需要改写下`main`方法的调用，实现如下：\n\n```python\ndef main(page):\n    for page in range(1, TOTAL_PAGE+1):\n        index_html = scrape_index(page)\n        detail_urls = parse_index((index_html))\n        for detail_url in detail_urls:\n            detail_html = scrape_detail(detail_url)\n            data = parse_detail(detail_html)\n            logging.info('get detail data %s\\n', data)\n            logging.info('saving data to mongodb')\n            save_data(data)\n            logging.info('data saved successfully\\n')\n\n\nif __name__ == '__main__':\n    pool = multiprocessing.Pool()\n    pages = range(1, TOTAL_PAGE + 1)\n    pool.map(main, pages)\n    pool.close()\n    pool.join()\n```\n\n这里首先给`main`方法添加一个参数`page`，用以表示列表页的页码。接着声明了一个进程池，并声明`pages`为所有需要遍历的页码，即`1~10`。最后调用`map`方法，第1个参数就是需要被调用的方法，第2个参数就是`pages`，即需要遍历的页码。\n\n这样`pages`就会被依次遍历。把`1~10`这10个页码分别传递给`main`方法，并把每次的调用变成一个进程，加入到进程池中执行，进程池会根据当前运行环境来决定运行多少进程。\n\n运行输出结果和之前类似，但是可以明显看到加了多进程执行之后，爬取速度快了非常多。可以清空一下之前的`MongoDB`数据，可以发现数据依然可以被正常保存到`MongoDB`数据库中。\n","slug":"request、pyquest和pymongodb案例实战","published":1,"updated":"2021-06-15T03:24:11.503Z","layout":"post","photos":[],"link":"","_id":"ckq14rx3x007i44udcdju8zq2","content":"<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p>在本节课开始之前，我们需要做好如下的准备工作：</p>\n<ul>\n<li>安装好<code>Python3</code>（最低为 3.6 版本），并能成功运行<code>Python3</code>程序。</li>\n<li>了解<code>Python</code>多进程的基本原理。</li>\n<li>了解<code>PythonHTTP</code>请求库<code>requests</code>的基本用法。</li>\n<li>了解正则表达式的用法和<code>Python</code>中正则表达式库<code>re</code>的基本用法。</li>\n<li>了解<code>PythonHTML</code>解析库<code>pyquery</code>的基本用法。</li>\n<li>了解<code>MongoDB</code>并安装和启动<code>MongoDB</code>服务。</li>\n<li>了解<code>Python</code>的<code>MongoDB</code>操作库<code>PyMongo</code>的基本用法。</li>\n</ul>\n<h2 id=\"爬虫目标\"><a href=\"#爬虫目标\" class=\"headerlink\" title=\"爬虫目标\"></a>爬虫目标</h2><p>一个基本的静态网站作为案例进行爬取，需要爬取的链接为：<a href=\"https://static1.scrape.cuiqingcai.com/\">https://static1.scrape.cuiqingcai.com/</a>，这个网站里面包含了一些电影信息。</p>\n<p>要完成的目标是：</p>\n<ul>\n<li>用<code>requests</code>爬取这个站点每一页的电影列表，顺着列表再爬取每个电影的详情页。</li>\n<li>用<code>pyquery</code>和正则表达式提取每部电影的名称、封面、类别、上映时间、评分、剧情简介等内容。</li>\n<li>把以上爬取的内容存入<code>MongoDB</code>数据库。</li>\n<li>使用多进程实现爬取的加速。</li>\n</ul>\n<h3 id=\"爬取列表页\"><a href=\"#爬取列表页\" class=\"headerlink\" title=\"爬取列表页\"></a>爬取列表页</h3><p>爬取的第一步肯定要从列表页入手，首先观察一下列表页的结构和翻页规则。在浏览器中访问<a href=\"https://static1.scrape.cuiqingcai.com/\"></a>，然后打开浏览器开发者工具，观察每一个电影信息区块对应的<code>HTML</code>，以及进入到详情页的<code>URL</code>是怎样的，如图所示：</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>每部电影对应的区块都是一个<code>div</code>节点，它的<code>class</code>属性都有<code>el-card</code>这个值。每个列表页有10个这样的<code>div</code>节点，也就对应着10部电影的信息。</p>\n<p>再分析下从列表页是怎么进入到详情页的，选中电影的名称，看下结果：</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>这个名称实际上是一个<code>h2</code>节点，其内部的文字就是电影的标题。<code>h2</code>节点的外面包含了一个<code>a</code>节点，这个<code>a</code>节点带有<code>href</code>属性，这就是一个超链接，其中<code>href</code>的值为<code>/detail/1</code>，这是一个相对网站的根<code>URL</code><a href=\"https://static1.scrape.cuiqingcai.com/\">https://static1.scrape.cuiqingcai.com/</a>路径，加上网站的根<code>URL</code>就构成了<a href=\"https://static1.scrape.cuiqingcai.com/detail/1\">https://static1.scrape.cuiqingcai.com/detail/1</a>，也就是这部电影详情页的<code>URL</code>。这样只需要提取这个<code>href</code>属性就能构造出详情页的<code>URL</code>并接着爬取了。</p>\n<p>接下来分析下翻页的逻辑，拉到页面的最下方，可以看到分页页码，如图所示：</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<p>页面显示一共有<code>100</code>条数据，10页的内容，因此页码最多是10。接着我们点击第2页，如图所示：</p>\n<p><img src=\"Screenshot_4.webp\"></p>\n<p>可以看到网页的<code>URL</code>变成了<code>https://static1.scrape.cuiqingcai.com/page/2</code>，相比根<code>URL</code>多了<code>/page/2</code>这部分内容。网页的结构还是和原来一模一样，所以我们可以和第1页一样处理。</p>\n<p>接着查看第3页、第4页等内容，可以发现有这么一个规律，每一页的<code>URL</code>最后分别变成了<code>/page/3</code>、<code>/page/4</code>。所以，<code>/page</code>后面跟的就是列表页的页码，当然第1页也是一样，在根<code>URL</code>后面加上<code>/page/1</code>也是能访问的，只不过网站做了一下处理，默认的页码是1，所以显示第1页的内容。</p>\n<p>分析到这里，逻辑基本就清晰了。</p>\n<p>如果要完成列表页的爬取，可以这么实现：</p>\n<ul>\n<li>遍历页码构造<code>10</code>页的索引页<code>URL</code>。</li>\n<li>从每个索引页分析提取出每个电影的详情页<code>URL</code>。</li>\n</ul>\n<p>先定义一些基础的变量，并引入一些必要的库，写法如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> pymongo</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"><span class=\"keyword\">from</span> urllib.parse <span class=\"keyword\">import</span> urljoin</span><br><span class=\"line\"></span><br><span class=\"line\">logging.basicConfig(level=logging.INFO, <span class=\"built_in\">format</span>=<span class=\"string\">&#x27;%(asctime)s - %(levelname)s: %(message)s&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">BASE_URL = <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com&#x27;</span></span><br><span class=\"line\">TOTAL_PAGE = <span class=\"number\">10</span></span><br></pre></td></tr></table></figure>\n\n<p>引入<code>requests</code>用来爬取页面，<code>logging</code>用来输出信息，<code>re</code>用来实现正则表达式解析，<code>pyquery</code>用来直接解析网页，<code>pymongo</code>用来实现<code>MongoDB</code>存储，<code>urljoin</code>用来做<code>URL</code>的拼接。</p>\n<p>接着定义日志输出级别和输出格式，完成之后再定义<code>BASE_URL</code>为当前站点的根<code>URL</code>，<code>TOTAL_PAGE</code>为需要爬取的总页码数量。</p>\n<p>定义好了之后，来实现一个页面爬取的方法，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scrape_page</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    logging.info(<span class=\"string\">&#x27;scraping %s...&#x27;</span>, url)</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        response = requests.get(url, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> response.status_code == <span class=\"number\">200</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> response.text</span><br><span class=\"line\">        logging.error(<span class=\"string\">&#x27;get invalid status code %s while scraping %s&#x27;</span>, response.status_code, url)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> requests.RequestException:</span><br><span class=\"line\">        logging.error(<span class=\"string\">&#x27;error occurred while scraping %s&#x27;</span>, url, exc_info=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n<p>考虑到不仅要爬取列表页，还要爬取详情页，在这里定义一个较通用的爬取页面的方法，叫作<code>scrape_page</code>，它接收一个<code>url</code>参数，返回页面的<code>html</code>代码。</p>\n<p>首先判断状态码是不是<code>200</code>，如果是，则直接返回页面的<code>HTML</code>代码，如果不是，则会输出错误日志信息。另外，这里实现了<code>requests</code>的异常处理，如果出现了爬取异常，则会输出对应的错误日志信息。这时将<code>logging</code>的<code>error</code>方法的<code>exc_info</code>参数设置为<code>True</code>则可以打印出<code>Traceback</code>错误堆栈信息。 </p>\n<p>有了<code>scrape_page</code>方法之后，给这个方法传入一个<code>url</code>，正常情况下它就可以返回页面的<code>HTML</code>代码。</p>\n<p>在这个基础上，来定义列表页的爬取方法吧，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scrape_index</span>(<span class=\"params\">page</span>):</span></span><br><span class=\"line\">    index_url = <span class=\"string\">f&#x27;<span class=\"subst\">&#123;BASE_URL&#125;</span>/page/<span class=\"subst\">&#123;page&#125;</span>&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> scrape_page(index_url)</span><br></pre></td></tr></table></figure>\n\n<p>方法名称叫作<code>scrape_index</code>，这个方法会接收一个<code>page</code>参数，即列表页的页码，在方法里面实现列表页的<code>URL</code>拼接，然后调用<code>scrape_page</code>方法爬取即可得到列表页的<code>HTML</code>代码了。</p>\n<p>获取了<code>HTML</code>代码后，下一步就是解析列表页，并得到每部电影的详情页的<code>URL</code>了，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse_index</span>(<span class=\"params\">html</span>):</span></span><br><span class=\"line\">    doc = pq(html)</span><br><span class=\"line\">    links = doc(<span class=\"string\">&#x27;.el-card .name&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> link <span class=\"keyword\">in</span> links.items():</span><br><span class=\"line\">        href = link.attr(<span class=\"string\">&#x27;href&#x27;</span>)</span><br><span class=\"line\">        detail_url = urljoin(BASE_URL, href)</span><br><span class=\"line\">        logging.info(<span class=\"string\">&#x27;get detail info %s&#x27;</span>, detail_url)</span><br><span class=\"line\">        <span class=\"keyword\">yield</span> detail_url</span><br></pre></td></tr></table></figure>\n\n<p>这里我们定义了<code>parse_index</code>方法，它接收一个<code>html</code>参数，即列表页的<code>HTML</code>代码。接着用<code>pyquery</code>新建一个<code>PyQuery</code>对象，完成之后再用<code>.el-card .name</code>选择器选出来每个电影名称对应的超链接节点。遍历这些节点，通过调用<code>attr</code>方法并传入<code>href</code>获得详情页的<code>URL</code>路径，得到的<code>href</code>就是上文所说的类似<code>/detail/1</code>这样的结果。这并不是一个完整的<code>URL</code>，所以需要借助<code>urljoin</code>方法把<code>BASE_URL</code>和<code>href</code>拼接起来，获得详情页的完整<code>URL</code>，得到的结果就是类似<code>https://static1.scrape.cuiqingcai.com/detail/1</code>这样完整的<code>URL</code>了，最后<code>yield</code>返回即可。</p>\n<p>通过调用<code>parse_index</code>方法传入列表页的<code>HTML</code>代码就可以获得该列表页所有电影的详情页<code>URL</code>了，接下来把上面的方法串联调用一下，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_PAGE+<span class=\"number\">1</span>):</span><br><span class=\"line\">        index_html = scrape_index(page)</span><br><span class=\"line\">        detail_urls = parse_index((index_html))</span><br><span class=\"line\">        logging.info(<span class=\"string\">&#x27;detail urls %s&#x27;</span>, <span class=\"built_in\">list</span>(detail_urls))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n<p>定义了<code>main</code>方法来完成上面所有方法的调用，首先使用<code>range</code>方法遍历一下页码，得到的<code>page</code>是<code>1~10</code>，接着把<code>page</code>变量传给<code>scrape_index</code>方法，得到列表页的<code>HTML</code>，赋值为<code>index_html</code>变量。接下来再将<code>index_html</code>变量传给<code>parse_index</code>方法，得到列表页所有电影的详情页<code>URL</code>，赋值为<code>detail_urls</code>，结果是一个生成器，调用<code>list</code>方法就可以将其输出出来。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,059 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,060 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,061 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,062 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,063 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,064 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">6</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,065 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">7</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,067 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">8</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,070 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">9</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,072 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,074 - INFO: detail urls [<span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/1&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/2&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/3&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/4&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/5&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/6&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/7&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/8&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/9&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/10&#x27;</span>]</span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,076 - INFO: scraping https://static1.scrape.cuiqingcai.com/page/<span class=\"number\">2.</span>..</span><br><span class=\"line\">....</span><br></pre></td></tr></table></figure>\n\n<p>由于输出内容比较多，这里只贴了一部分。可以看到，在这个过程中程序首先爬取了第<code>1</code>页列表页，然后得到了对应详情页的每个<code>URL</code>，接着再接着爬第2页、第3页，一直到第10页，依次输出了每一页的详情页<code>URL</code>。这样，就成功获取到所有电影详情页<code>URL</code>。</p>\n<h3 id=\"爬取详情页\"><a href=\"#爬取详情页\" class=\"headerlink\" title=\"爬取详情页\"></a>爬取详情页</h3><p>首先观察一下详情页的<code>HTML</code>代码，如图所示：</p>\n<p><img src=\"Screenshot_5.webp\"></p>\n<p>经过分析，要提取的内容和对应的节点信息如下：</p>\n<ul>\n<li>封面：是一个<code>img</code>节点，其<code>class</code>属性为<code>cover</code>。</li>\n<li>名称：是一个<code>h2</code>节点，其内容便是名称。</li>\n<li>类别：是<code>span</code>节点，其内容便是类别</li>\n<li>内容，其外侧是<code>button</code>节点，再外侧则是<code>class</code>为<code>categories</code>的<code>div</code>节点。</li>\n<li>上映时间：是<code>span</code>节点，其内容包含了上映时间，其外侧是包含了<code>class</code>为<code>info</code>的<code>div</code>节点。但注意这个<code>div</code>前面还有一个<code>class</code>为<code>info</code>的<code>div</code>节点，可以使用其内容来区分，也可以使用<code>nth-child</code>或<code>nth- of-type</code>这样的选择器来区分。另外提取结果中还多了「上映」二字，可以用正则表达式把日期提取出来。</li>\n<li>评分：是一个<code>p</code>节点，其内容便是评分，<code>p</code>节点的<code>class</code>属性为<code>score</code>。</li>\n<li>剧情简介：是一个<code>p</code>节点，其内容便是</li>\n<li>剧情简介，其外侧是<code>class</code>为<code>drama</code>的<code>div</code>节点。</li>\n</ul>\n<p>刚才已经成功获取了详情页的<code>URL</code>，接下来要定义一个详情页的爬取方法，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scrape_detail</span>(<span class=\"params\">url</span>):</span> </span><br><span class=\"line\">    <span class=\"keyword\">return</span> scrape_page(url)</span><br></pre></td></tr></table></figure>\n\n<p>定义了一个<code>scrape_detail</code>方法，它接收一个<code>url</code>参数，并通过调用<code>scrape_page</code>方法获得网页源代码。由于刚才已经实现了<code>scrape_page</code>方法，所以在这里不用再写一遍页面爬取的逻辑，直接调用即可，这就做到了代码复用。</p>\n<p>单独定义一个<code>scrape_detail</code>方法在逻辑上会显得更清晰，而且以后如果想要对<code>scrape_detail</code>方法进行改动，比如添加日志输出或是增加预处理，都可以在 <code>scrape_detail</code>里面实现，而不用改动<code>scrape_page</code>方法，灵活性会更好。</p>\n<p>详情页的爬取方法已经实现了，接着就是详情页的解析了，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse_detail</span>(<span class=\"params\">html</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;详情页的解析&quot;&quot;&quot;</span></span><br><span class=\"line\">    doc = pq(html)</span><br><span class=\"line\">    cover = doc(<span class=\"string\">&#x27;img.cover&#x27;</span>).attr(<span class=\"string\">&#x27;src&#x27;</span>)</span><br><span class=\"line\">    name = doc(<span class=\"string\">&#x27;a &gt; h2&#x27;</span>).text()</span><br><span class=\"line\">    categories = [item.text() <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> doc(<span class=\"string\">&#x27;.categories button span&#x27;</span>).items()]</span><br><span class=\"line\">    published_at = doc(<span class=\"string\">&#x27;.info:contains(上映)&#x27;</span>).text()</span><br><span class=\"line\">    published_at = re.search(<span class=\"string\">&#x27;(\\d&#123;4&#125;-\\d&#123;2&#125;-\\d&#123;2&#125;)&#x27;</span>, published_at).group(<span class=\"number\">1</span>) \\</span><br><span class=\"line\">        <span class=\"keyword\">if</span> published_at <span class=\"keyword\">and</span> re.search(<span class=\"string\">&#x27;\\d&#123;4&#125;-\\d&#123;2&#125;-\\d&#123;2&#125;&#x27;</span>, published_at) <span class=\"keyword\">else</span> <span class=\"literal\">None</span></span><br><span class=\"line\">    drama = doc(<span class=\"string\">&#x27;.drama p&#x27;</span>).text()</span><br><span class=\"line\">    score = doc(<span class=\"string\">&#x27;p.score&#x27;</span>).text()</span><br><span class=\"line\">    score = <span class=\"built_in\">float</span>(score) <span class=\"keyword\">if</span> score <span class=\"keyword\">else</span> <span class=\"literal\">None</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span>&#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;cover&#x27;</span>: cover,</span><br><span class=\"line\">        <span class=\"string\">&#x27;name&#x27;</span>: name,</span><br><span class=\"line\">        <span class=\"string\">&#x27;categories&#x27;</span>: categories,</span><br><span class=\"line\">        <span class=\"string\">&#x27;published_at&#x27;</span>: published_at,</span><br><span class=\"line\">        <span class=\"string\">&#x27;drama&#x27;</span>: drama,</span><br><span class=\"line\">        <span class=\"string\">&#x27;score&#x27;</span>: score</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>定义了<code>parse_detail</code>方法用于解析详情页，它接收一个<code>html</code>参数，解析其中的内容，并以字典的形式返回结果。每个字段的解析情况如下所述：</p>\n<ul>\n<li><code>cove</code>r：封面，直接选取<code>class</code>为<code>cover</code>的<code>img</code>节点，并调用<code>attr</code>方法获取<code>src</code>属性的内容即可。</li>\n<li><code>name</code>：名称，直接选取<code>a</code>节点的直接子节点<code>h2</code>节点，并调用<code>text</code>方法提取其文本内容即可得到名称。</li>\n<li><code>categories</code>：类别，由于类别是多个，所以这里首先用<code>.categories button span</code>选取了<code>class</code>为<code>categories</code>的节点内部的<code>span</code>节点，其结果是多个，所以这里进行了遍历，取出了每个<code>span</code>节点的文本内容，得到的便是列表形式的类别。</li>\n<li><code>published_at</code>：上映时间，由于<code>pyquery</code>支持使用<code>:contains</code>直接指定包含的文本内容并进行提取，且每个上映时间信息都包含了「上映」二字，所以这里就直接使用<code>:contains(上映)</code>提取了<code>class</code>为<code>info</code>的<code>div</code>节点。提取之后，得到的结果类似「1993-07-26 上映」这样，并不想要「上映」这两个字，所以又调用了正则表达式把日期单独提取出来了。当然这里也可以直接使用<code>strip</code>或<code>replace</code>方法把多余的文字去掉。</li>\n<li><code>drama</code>：直接提取<code>class</code>为<code>drama</code>的节点内部的<code>p</code>节点的文本即可。</li>\n<li><code>score</code>：直接提取<code>class</code>为<code>score</code>的<code>p</code>节点的文本即可，由于提取结果是字符串，所以我们需要把它转成浮点数，即``float`类型。</li>\n</ul>\n<p>上述字段提取完毕之后，构造一个字典返回。这样，成功完成了详情页的提取和分析了。</p>\n<p>将main方法稍微改写一下，增加这两个方法的调用，改写如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_PAGE+<span class=\"number\">1</span>):</span><br><span class=\"line\">        index_html = scrape_index(page)</span><br><span class=\"line\">        detail_urls = parse_index((index_html))</span><br><span class=\"line\">        <span class=\"keyword\">for</span> detail_url <span class=\"keyword\">in</span> detail_urls:</span><br><span class=\"line\">            detail_html = scrape_detail(detail_url)</span><br><span class=\"line\">            data = parse_detail(detail_html)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;get detail data %s&#x27;</span>, data)</span><br></pre></td></tr></table></figure>\n\n<p>首先遍历了<code>detail_urls</code>，获取了每个详情页的<code>URL</code>，然后依次调用了<code>scrape_detail</code>和<code>parse_detail</code>方法，最后得到了每个详情页的提取结果，赋值为<code>data</code>并输出。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">24</span> <span class=\"number\">12</span>:<span class=\"number\">46</span>:<span class=\"number\">31</span>,<span class=\"number\">432</span> - INFO: get detail data &#123;<span class=\"string\">&#x27;cover&#x27;</span>: <span class=\"string\">&#x27;https://p0.meituan.net/movie/b0d986a8bf89278afbb19f6abaef70f31206570.jpg@464w_644h_1e_1c&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&quot;辛德勒的名单 - Schindler&#x27;s List&quot;</span>, <span class=\"string\">&#x27;categories&#x27;</span>: [<span class=\"string\">&#x27;剧情&#x27;</span>, <span class=\"string\">&#x27;历史&#x27;</span>, <span class=\"string\">&#x27;战争&#x27;</span>], <span class=\"string\">&#x27;published_at&#x27;</span>: <span class=\"string\">&#x27;1993-11-30&#x27;</span>, <span class=\"string\">&#x27;drama&#x27;</span>: <span class=\"string\">&#x27;1939年，波兰在纳粹德国的统治下，党卫军对犹太人进行了隔离统治。德国商人奥斯卡·辛德勒（连姆·尼森 饰）来到德军统治下的克拉科夫，开设了一间搪瓷厂，生产军需用品。凭着出众的社交能力和大量的金钱，辛德勒和德军建立了良好 的关系，他的工厂雇用犹太人工作，大发战争财。1943年，克拉科夫的犹太人遭到了惨绝人寰的大屠杀，辛德勒目睹这一切，受到了极大的震撼，他贿赂军官，让自己的工厂成为集中营的附属劳役营，在那些疯狂屠杀的日子里，他的工厂也成为了犹太人的避难所。1944年，德国战败前夕，屠杀犹太人的行动越发疯狂，辛德勒向德军军官开出了1200人的名单，倾家荡产买下了这些犹太人的生命。在那些暗无天日的岁月里，拯救一个人，就是拯救全世界。&#x27;</span>, <span class=\"string\">&#x27;score&#x27;</span>: <span class=\"number\">9.5</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，已经成功提取出每部电影的基本信息，包括封面、名称、类别，等等。</p>\n<h2 id=\"保存到MongoDB\"><a href=\"#保存到MongoDB\" class=\"headerlink\" title=\"保存到MongoDB\"></a>保存到MongoDB</h2><p>请确保现在有一个可以正常连接和使用的<code>MongoDB</code>数据库。 将数据导入<code>MongoDB</code>需要用到<code>PyMongo</code>这个库，这个在最开始已经引入过了。那么接下来我们定义一下 <code>MongoDB</code>的连接配置，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MONGO_CONNECTION_STRING = <span class=\"string\">&#x27;mongodb://localhost:27017&#x27;</span></span><br><span class=\"line\">MONGO_DB_NAME = <span class=\"string\">&#x27;movies&#x27;</span></span><br><span class=\"line\">MONGO_COLLECTIONS_NAME = <span class=\"string\">&#x27;movies&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">client = pymongo.MongoClient(MONGO_CONNECTION_STRING)</span><br><span class=\"line\">db = client[<span class=\"string\">&#x27;movies&#x27;</span>]</span><br><span class=\"line\">collection = db[<span class=\"string\">&#x27;movies&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>在这里声明了几个变量，介绍如下：</p>\n<ul>\n<li><code>MONGO_CONNECTION_STRING</code>：<code>MongoDB</code>的连接字符串，里面定义了<code>MongoDB</code>的基本连接信息，如<code>host</code>、<code>port</code>，还可以定义用户名密码等内容。</li>\n<li><code>MONGO_DB_NAME</code>：<code>MongoDB</code>数据库的名称。</li>\n<li><code>MONGO_COLLECTION_NAME</code>：<code>MongoDB</code>的集合名称。</li>\n</ul>\n<p>这里用<code>MongoClient</code>声明了一个连接对象，然后依次声明了存储的数据库和集合。接下来，再实现一个将数据保存到<code>MongoDB</code>的方法，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">save_data</span>(<span class=\"params\">data</span>):</span></span><br><span class=\"line\">    collection.update_one(&#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;name&#x27;</span>: data.get(<span class=\"string\">&#x27;name&#x27;</span>)</span><br><span class=\"line\">    &#125;,&#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;$set&#x27;</span>: data</span><br><span class=\"line\">    &#125;, upsert=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n<p>声明了一个<code>save_data</code>方法，它接收一个<code>data</code>参数，也就是我们刚才提取的电影详情信息。在方法里面，调用了<code>update_one</code>方法，第1个参数是<strong>查询条件</strong>，即根据<code>name</code>进行查询；第2个参数是<code>data</code>对象本身，也就是所有的数据，这里用<code>$set</code>操作符表示更新操作；第3个参数很关键，这里实际上是<code>upsert</code>参数，如果把这个设置为 <code>True</code>，则可以做到存在即更新，不存在即插入的功能，更新会根据第一个参数设置的<code>name</code>字段，所以这样可以防止数据库中出现同名的电影数据。</p>\n<blockquote>\n<p>注：实际上电影可能有同名，但该场景下的爬取数据没有同名情况，当然这里更重要的是实现<code>MongoDB</code>的去重操作。</p>\n</blockquote>\n<p>接下来将<code>main</code>方法稍微改写一下就好了，改写如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_PAGE+<span class=\"number\">1</span>):</span><br><span class=\"line\">        index_html = scrape_index(page)</span><br><span class=\"line\">        detail_urls = parse_index((index_html))</span><br><span class=\"line\">        <span class=\"keyword\">for</span> detail_url <span class=\"keyword\">in</span> detail_urls:</span><br><span class=\"line\">            detail_html = scrape_detail(detail_url)</span><br><span class=\"line\">            data = parse_detail(detail_html)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;get detail data %s\\n&#x27;</span>, data)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;saving data to mongodb&#x27;</span>)</span><br><span class=\"line\">            save_data(data)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;data saved successfully\\n&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>重新运行，输出结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">......</span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">24</span> <span class=\"number\">13</span>:<span class=\"number\">16</span>:<span class=\"number\">46</span>,<span class=\"number\">882</span> - INFO: get detail data &#123;<span class=\"string\">&#x27;cover&#x27;</span>: <span class=\"string\">&#x27;https://p0.meituan.net/movie/58782fa5439c25d764713f711ebecd1e201941.jpg@464w_644h_1e_1c&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;魂断蓝桥 - Waterloo Bridge&#x27;</span>, <span class=\"string\">&#x27;categories&#x27;</span>: [<span class=\"string\">&#x27;剧情&#x27;</span>, <span class=\"string\">&#x27;爱情&#x27;</span>, <span class=\"string\">&#x27;战争&#x27;</span>], <span class=\"string\">&#x27;published_at&#x27;</span>: <span class=\"string\">&#x27;1940-05-17&#x27;</span>, <span class=\"string\">&#x27;drama&#x27;</span>: <span class=\"string\">&#x27;第一次世界大战期间，回国度假的陆军中 </span></span><br><span class=\"line\"><span class=\"string\">尉罗伊（罗伯特·泰勒 饰）在滑铁卢桥上邂逅了舞蹈演员玛拉（费雯·丽 饰），两人彼此倾心，爱情迅速升温。就在两人决定结婚之时，罗伊应招回营地，两人被迫分离。由</span></span><br><span class=\"line\"><span class=\"string\">于错过剧团演出，玛拉被开除，只能和好友相依为命。不久玛拉得知罗伊阵亡的消息，几欲崩溃，备受打击。失去爱情的玛拉感到一切都失去了意义，为了生存，她和好友不</span></span><br><span class=\"line\"><span class=\"string\">得不沦为妓女。然而命运弄人，就在此时玛拉竟然再次遇到了罗伊。虽然为罗伊的生还兴奋不已，玛拉却因自己的失身陷入痛苦之中。感到一切难以挽回的玛拉潸然离开，独</span></span><br><span class=\"line\"><span class=\"string\">自来到两人最初相遇的地点——滑铁卢桥上…&#x27;</span>, <span class=\"string\">&#x27;score&#x27;</span>: <span class=\"number\">9.5</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">24</span> <span class=\"number\">13</span>:<span class=\"number\">16</span>:<span class=\"number\">46</span>,<span class=\"number\">885</span> - INFO: saving data to mongodb</span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">24</span> <span class=\"number\">13</span>:<span class=\"number\">16</span>:<span class=\"number\">46</span>,<span class=\"number\">889</span> - INFO: data saved successfully</span><br></pre></td></tr></table></figure>\n\n<p>运行完毕之后我们可以使用<code>MongoDB</code>客户端工具可视化查看已经爬取到的数据，结果如下：</p>\n<p><img src=\"Screenshot_6.webp\"></p>\n<h2 id=\"多进程加速\"><a href=\"#多进程加速\" class=\"headerlink\" title=\"多进程加速\"></a>多进程加速</h2><p>由于整个的爬取是单进程的，而且只能逐条爬取，速度稍微有点慢，有没有方法来对整个爬取过程进行加速呢？</p>\n<p>在前面学习了多进程的基本原理和使用方法，下面就来实践一下多进程的爬取。</p>\n<p>由于一共有<code>10</code>页详情页，并且这<code>10</code>页内容是互不干扰的，所以可以一页开一个进程来爬取。由于这<code>10</code>个列表页页码正好可以提前构造成一个列表，所以可以选用多进程里面的进程池<code>Pool</code>来实现这个过程。</p>\n<p>这里需要改写下<code>main</code>方法的调用，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>(<span class=\"params\">page</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_PAGE+<span class=\"number\">1</span>):</span><br><span class=\"line\">        index_html = scrape_index(page)</span><br><span class=\"line\">        detail_urls = parse_index((index_html))</span><br><span class=\"line\">        <span class=\"keyword\">for</span> detail_url <span class=\"keyword\">in</span> detail_urls:</span><br><span class=\"line\">            detail_html = scrape_detail(detail_url)</span><br><span class=\"line\">            data = parse_detail(detail_html)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;get detail data %s\\n&#x27;</span>, data)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;saving data to mongodb&#x27;</span>)</span><br><span class=\"line\">            save_data(data)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;data saved successfully\\n&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    pool = multiprocessing.Pool()</span><br><span class=\"line\">    pages = <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_PAGE + <span class=\"number\">1</span>)</span><br><span class=\"line\">    pool.<span class=\"built_in\">map</span>(main, pages)</span><br><span class=\"line\">    pool.close()</span><br><span class=\"line\">    pool.join()</span><br></pre></td></tr></table></figure>\n\n<p>这里首先给<code>main</code>方法添加一个参数<code>page</code>，用以表示列表页的页码。接着声明了一个进程池，并声明<code>pages</code>为所有需要遍历的页码，即<code>1~10</code>。最后调用<code>map</code>方法，第1个参数就是需要被调用的方法，第2个参数就是<code>pages</code>，即需要遍历的页码。</p>\n<p>这样<code>pages</code>就会被依次遍历。把<code>1~10</code>这10个页码分别传递给<code>main</code>方法，并把每次的调用变成一个进程，加入到进程池中执行，进程池会根据当前运行环境来决定运行多少进程。</p>\n<p>运行输出结果和之前类似，但是可以明显看到加了多进程执行之后，爬取速度快了非常多。可以清空一下之前的<code>MongoDB</code>数据，可以发现数据依然可以被正常保存到<code>MongoDB</code>数据库中。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p>在本节课开始之前，我们需要做好如下的准备工作：</p>\n<ul>\n<li>安装好<code>Python3</code>（最低为 3.6 版本），并能成功运行<code>Python3</code>程序。</li>\n<li>了解<code>Python</code>多进程的基本原理。</li>\n<li>了解<code>PythonHTTP</code>请求库<code>requests</code>的基本用法。</li>\n<li>了解正则表达式的用法和<code>Python</code>中正则表达式库<code>re</code>的基本用法。</li>\n<li>了解<code>PythonHTML</code>解析库<code>pyquery</code>的基本用法。</li>\n<li>了解<code>MongoDB</code>并安装和启动<code>MongoDB</code>服务。</li>\n<li>了解<code>Python</code>的<code>MongoDB</code>操作库<code>PyMongo</code>的基本用法。</li>\n</ul>\n<h2 id=\"爬虫目标\"><a href=\"#爬虫目标\" class=\"headerlink\" title=\"爬虫目标\"></a>爬虫目标</h2><p>一个基本的静态网站作为案例进行爬取，需要爬取的链接为：<a href=\"https://static1.scrape.cuiqingcai.com/\">https://static1.scrape.cuiqingcai.com/</a>，这个网站里面包含了一些电影信息。</p>\n<p>要完成的目标是：</p>\n<ul>\n<li>用<code>requests</code>爬取这个站点每一页的电影列表，顺着列表再爬取每个电影的详情页。</li>\n<li>用<code>pyquery</code>和正则表达式提取每部电影的名称、封面、类别、上映时间、评分、剧情简介等内容。</li>\n<li>把以上爬取的内容存入<code>MongoDB</code>数据库。</li>\n<li>使用多进程实现爬取的加速。</li>\n</ul>\n<h3 id=\"爬取列表页\"><a href=\"#爬取列表页\" class=\"headerlink\" title=\"爬取列表页\"></a>爬取列表页</h3><p>爬取的第一步肯定要从列表页入手，首先观察一下列表页的结构和翻页规则。在浏览器中访问<a href=\"https://static1.scrape.cuiqingcai.com/\"></a>，然后打开浏览器开发者工具，观察每一个电影信息区块对应的<code>HTML</code>，以及进入到详情页的<code>URL</code>是怎样的，如图所示：</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>每部电影对应的区块都是一个<code>div</code>节点，它的<code>class</code>属性都有<code>el-card</code>这个值。每个列表页有10个这样的<code>div</code>节点，也就对应着10部电影的信息。</p>\n<p>再分析下从列表页是怎么进入到详情页的，选中电影的名称，看下结果：</p>\n<p><img src=\"Screenshot_2.webp\"></p>\n<p>这个名称实际上是一个<code>h2</code>节点，其内部的文字就是电影的标题。<code>h2</code>节点的外面包含了一个<code>a</code>节点，这个<code>a</code>节点带有<code>href</code>属性，这就是一个超链接，其中<code>href</code>的值为<code>/detail/1</code>，这是一个相对网站的根<code>URL</code><a href=\"https://static1.scrape.cuiqingcai.com/\">https://static1.scrape.cuiqingcai.com/</a>路径，加上网站的根<code>URL</code>就构成了<a href=\"https://static1.scrape.cuiqingcai.com/detail/1\">https://static1.scrape.cuiqingcai.com/detail/1</a>，也就是这部电影详情页的<code>URL</code>。这样只需要提取这个<code>href</code>属性就能构造出详情页的<code>URL</code>并接着爬取了。</p>\n<p>接下来分析下翻页的逻辑，拉到页面的最下方，可以看到分页页码，如图所示：</p>\n<p><img src=\"Screenshot_3.webp\"></p>\n<p>页面显示一共有<code>100</code>条数据，10页的内容，因此页码最多是10。接着我们点击第2页，如图所示：</p>\n<p><img src=\"Screenshot_4.webp\"></p>\n<p>可以看到网页的<code>URL</code>变成了<code>https://static1.scrape.cuiqingcai.com/page/2</code>，相比根<code>URL</code>多了<code>/page/2</code>这部分内容。网页的结构还是和原来一模一样，所以我们可以和第1页一样处理。</p>\n<p>接着查看第3页、第4页等内容，可以发现有这么一个规律，每一页的<code>URL</code>最后分别变成了<code>/page/3</code>、<code>/page/4</code>。所以，<code>/page</code>后面跟的就是列表页的页码，当然第1页也是一样，在根<code>URL</code>后面加上<code>/page/1</code>也是能访问的，只不过网站做了一下处理，默认的页码是1，所以显示第1页的内容。</p>\n<p>分析到这里，逻辑基本就清晰了。</p>\n<p>如果要完成列表页的爬取，可以这么实现：</p>\n<ul>\n<li>遍历页码构造<code>10</code>页的索引页<code>URL</code>。</li>\n<li>从每个索引页分析提取出每个电影的详情页<code>URL</code>。</li>\n</ul>\n<p>先定义一些基础的变量，并引入一些必要的库，写法如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> pymongo</span><br><span class=\"line\"><span class=\"keyword\">from</span> pyquery <span class=\"keyword\">import</span> PyQuery <span class=\"keyword\">as</span> pq</span><br><span class=\"line\"><span class=\"keyword\">from</span> urllib.parse <span class=\"keyword\">import</span> urljoin</span><br><span class=\"line\"></span><br><span class=\"line\">logging.basicConfig(level=logging.INFO, <span class=\"built_in\">format</span>=<span class=\"string\">&#x27;%(asctime)s - %(levelname)s: %(message)s&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">BASE_URL = <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com&#x27;</span></span><br><span class=\"line\">TOTAL_PAGE = <span class=\"number\">10</span></span><br></pre></td></tr></table></figure>\n\n<p>引入<code>requests</code>用来爬取页面，<code>logging</code>用来输出信息，<code>re</code>用来实现正则表达式解析，<code>pyquery</code>用来直接解析网页，<code>pymongo</code>用来实现<code>MongoDB</code>存储，<code>urljoin</code>用来做<code>URL</code>的拼接。</p>\n<p>接着定义日志输出级别和输出格式，完成之后再定义<code>BASE_URL</code>为当前站点的根<code>URL</code>，<code>TOTAL_PAGE</code>为需要爬取的总页码数量。</p>\n<p>定义好了之后，来实现一个页面爬取的方法，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scrape_page</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    logging.info(<span class=\"string\">&#x27;scraping %s...&#x27;</span>, url)</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        response = requests.get(url, verify=<span class=\"literal\">False</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> response.status_code == <span class=\"number\">200</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> response.text</span><br><span class=\"line\">        logging.error(<span class=\"string\">&#x27;get invalid status code %s while scraping %s&#x27;</span>, response.status_code, url)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> requests.RequestException:</span><br><span class=\"line\">        logging.error(<span class=\"string\">&#x27;error occurred while scraping %s&#x27;</span>, url, exc_info=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n<p>考虑到不仅要爬取列表页，还要爬取详情页，在这里定义一个较通用的爬取页面的方法，叫作<code>scrape_page</code>，它接收一个<code>url</code>参数，返回页面的<code>html</code>代码。</p>\n<p>首先判断状态码是不是<code>200</code>，如果是，则直接返回页面的<code>HTML</code>代码，如果不是，则会输出错误日志信息。另外，这里实现了<code>requests</code>的异常处理，如果出现了爬取异常，则会输出对应的错误日志信息。这时将<code>logging</code>的<code>error</code>方法的<code>exc_info</code>参数设置为<code>True</code>则可以打印出<code>Traceback</code>错误堆栈信息。 </p>\n<p>有了<code>scrape_page</code>方法之后，给这个方法传入一个<code>url</code>，正常情况下它就可以返回页面的<code>HTML</code>代码。</p>\n<p>在这个基础上，来定义列表页的爬取方法吧，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scrape_index</span>(<span class=\"params\">page</span>):</span></span><br><span class=\"line\">    index_url = <span class=\"string\">f&#x27;<span class=\"subst\">&#123;BASE_URL&#125;</span>/page/<span class=\"subst\">&#123;page&#125;</span>&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> scrape_page(index_url)</span><br></pre></td></tr></table></figure>\n\n<p>方法名称叫作<code>scrape_index</code>，这个方法会接收一个<code>page</code>参数，即列表页的页码，在方法里面实现列表页的<code>URL</code>拼接，然后调用<code>scrape_page</code>方法爬取即可得到列表页的<code>HTML</code>代码了。</p>\n<p>获取了<code>HTML</code>代码后，下一步就是解析列表页，并得到每部电影的详情页的<code>URL</code>了，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse_index</span>(<span class=\"params\">html</span>):</span></span><br><span class=\"line\">    doc = pq(html)</span><br><span class=\"line\">    links = doc(<span class=\"string\">&#x27;.el-card .name&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> link <span class=\"keyword\">in</span> links.items():</span><br><span class=\"line\">        href = link.attr(<span class=\"string\">&#x27;href&#x27;</span>)</span><br><span class=\"line\">        detail_url = urljoin(BASE_URL, href)</span><br><span class=\"line\">        logging.info(<span class=\"string\">&#x27;get detail info %s&#x27;</span>, detail_url)</span><br><span class=\"line\">        <span class=\"keyword\">yield</span> detail_url</span><br></pre></td></tr></table></figure>\n\n<p>这里我们定义了<code>parse_index</code>方法，它接收一个<code>html</code>参数，即列表页的<code>HTML</code>代码。接着用<code>pyquery</code>新建一个<code>PyQuery</code>对象，完成之后再用<code>.el-card .name</code>选择器选出来每个电影名称对应的超链接节点。遍历这些节点，通过调用<code>attr</code>方法并传入<code>href</code>获得详情页的<code>URL</code>路径，得到的<code>href</code>就是上文所说的类似<code>/detail/1</code>这样的结果。这并不是一个完整的<code>URL</code>，所以需要借助<code>urljoin</code>方法把<code>BASE_URL</code>和<code>href</code>拼接起来，获得详情页的完整<code>URL</code>，得到的结果就是类似<code>https://static1.scrape.cuiqingcai.com/detail/1</code>这样完整的<code>URL</code>了，最后<code>yield</code>返回即可。</p>\n<p>通过调用<code>parse_index</code>方法传入列表页的<code>HTML</code>代码就可以获得该列表页所有电影的详情页<code>URL</code>了，接下来把上面的方法串联调用一下，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_PAGE+<span class=\"number\">1</span>):</span><br><span class=\"line\">        index_html = scrape_index(page)</span><br><span class=\"line\">        detail_urls = parse_index((index_html))</span><br><span class=\"line\">        logging.info(<span class=\"string\">&#x27;detail urls %s&#x27;</span>, <span class=\"built_in\">list</span>(detail_urls))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n<p>定义了<code>main</code>方法来完成上面所有方法的调用，首先使用<code>range</code>方法遍历一下页码，得到的<code>page</code>是<code>1~10</code>，接着把<code>page</code>变量传给<code>scrape_index</code>方法，得到列表页的<code>HTML</code>，赋值为<code>index_html</code>变量。接下来再将<code>index_html</code>变量传给<code>parse_index</code>方法，得到列表页所有电影的详情页<code>URL</code>，赋值为<code>detail_urls</code>，结果是一个生成器，调用<code>list</code>方法就可以将其输出出来。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,059 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,060 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,061 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,062 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,063 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,064 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">6</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,065 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">7</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,067 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">8</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,070 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">9</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,072 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,074 - INFO: detail urls [<span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/1&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/2&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/3&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/4&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/5&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/6&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/7&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/8&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/9&#x27;</span>, <span class=\"string\">&#x27;https://static1.scrape.cuiqingcai.com/detail/10&#x27;</span>]</span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">23</span> <span class=\"number\">23</span>:<span class=\"number\">23</span>:04,076 - INFO: scraping https://static1.scrape.cuiqingcai.com/page/<span class=\"number\">2.</span>..</span><br><span class=\"line\">....</span><br></pre></td></tr></table></figure>\n\n<p>由于输出内容比较多，这里只贴了一部分。可以看到，在这个过程中程序首先爬取了第<code>1</code>页列表页，然后得到了对应详情页的每个<code>URL</code>，接着再接着爬第2页、第3页，一直到第10页，依次输出了每一页的详情页<code>URL</code>。这样，就成功获取到所有电影详情页<code>URL</code>。</p>\n<h3 id=\"爬取详情页\"><a href=\"#爬取详情页\" class=\"headerlink\" title=\"爬取详情页\"></a>爬取详情页</h3><p>首先观察一下详情页的<code>HTML</code>代码，如图所示：</p>\n<p><img src=\"Screenshot_5.webp\"></p>\n<p>经过分析，要提取的内容和对应的节点信息如下：</p>\n<ul>\n<li>封面：是一个<code>img</code>节点，其<code>class</code>属性为<code>cover</code>。</li>\n<li>名称：是一个<code>h2</code>节点，其内容便是名称。</li>\n<li>类别：是<code>span</code>节点，其内容便是类别</li>\n<li>内容，其外侧是<code>button</code>节点，再外侧则是<code>class</code>为<code>categories</code>的<code>div</code>节点。</li>\n<li>上映时间：是<code>span</code>节点，其内容包含了上映时间，其外侧是包含了<code>class</code>为<code>info</code>的<code>div</code>节点。但注意这个<code>div</code>前面还有一个<code>class</code>为<code>info</code>的<code>div</code>节点，可以使用其内容来区分，也可以使用<code>nth-child</code>或<code>nth- of-type</code>这样的选择器来区分。另外提取结果中还多了「上映」二字，可以用正则表达式把日期提取出来。</li>\n<li>评分：是一个<code>p</code>节点，其内容便是评分，<code>p</code>节点的<code>class</code>属性为<code>score</code>。</li>\n<li>剧情简介：是一个<code>p</code>节点，其内容便是</li>\n<li>剧情简介，其外侧是<code>class</code>为<code>drama</code>的<code>div</code>节点。</li>\n</ul>\n<p>刚才已经成功获取了详情页的<code>URL</code>，接下来要定义一个详情页的爬取方法，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">scrape_detail</span>(<span class=\"params\">url</span>):</span> </span><br><span class=\"line\">    <span class=\"keyword\">return</span> scrape_page(url)</span><br></pre></td></tr></table></figure>\n\n<p>定义了一个<code>scrape_detail</code>方法，它接收一个<code>url</code>参数，并通过调用<code>scrape_page</code>方法获得网页源代码。由于刚才已经实现了<code>scrape_page</code>方法，所以在这里不用再写一遍页面爬取的逻辑，直接调用即可，这就做到了代码复用。</p>\n<p>单独定义一个<code>scrape_detail</code>方法在逻辑上会显得更清晰，而且以后如果想要对<code>scrape_detail</code>方法进行改动，比如添加日志输出或是增加预处理，都可以在 <code>scrape_detail</code>里面实现，而不用改动<code>scrape_page</code>方法，灵活性会更好。</p>\n<p>详情页的爬取方法已经实现了，接着就是详情页的解析了，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse_detail</span>(<span class=\"params\">html</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;详情页的解析&quot;&quot;&quot;</span></span><br><span class=\"line\">    doc = pq(html)</span><br><span class=\"line\">    cover = doc(<span class=\"string\">&#x27;img.cover&#x27;</span>).attr(<span class=\"string\">&#x27;src&#x27;</span>)</span><br><span class=\"line\">    name = doc(<span class=\"string\">&#x27;a &gt; h2&#x27;</span>).text()</span><br><span class=\"line\">    categories = [item.text() <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> doc(<span class=\"string\">&#x27;.categories button span&#x27;</span>).items()]</span><br><span class=\"line\">    published_at = doc(<span class=\"string\">&#x27;.info:contains(上映)&#x27;</span>).text()</span><br><span class=\"line\">    published_at = re.search(<span class=\"string\">&#x27;(\\d&#123;4&#125;-\\d&#123;2&#125;-\\d&#123;2&#125;)&#x27;</span>, published_at).group(<span class=\"number\">1</span>) \\</span><br><span class=\"line\">        <span class=\"keyword\">if</span> published_at <span class=\"keyword\">and</span> re.search(<span class=\"string\">&#x27;\\d&#123;4&#125;-\\d&#123;2&#125;-\\d&#123;2&#125;&#x27;</span>, published_at) <span class=\"keyword\">else</span> <span class=\"literal\">None</span></span><br><span class=\"line\">    drama = doc(<span class=\"string\">&#x27;.drama p&#x27;</span>).text()</span><br><span class=\"line\">    score = doc(<span class=\"string\">&#x27;p.score&#x27;</span>).text()</span><br><span class=\"line\">    score = <span class=\"built_in\">float</span>(score) <span class=\"keyword\">if</span> score <span class=\"keyword\">else</span> <span class=\"literal\">None</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span>&#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;cover&#x27;</span>: cover,</span><br><span class=\"line\">        <span class=\"string\">&#x27;name&#x27;</span>: name,</span><br><span class=\"line\">        <span class=\"string\">&#x27;categories&#x27;</span>: categories,</span><br><span class=\"line\">        <span class=\"string\">&#x27;published_at&#x27;</span>: published_at,</span><br><span class=\"line\">        <span class=\"string\">&#x27;drama&#x27;</span>: drama,</span><br><span class=\"line\">        <span class=\"string\">&#x27;score&#x27;</span>: score</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>定义了<code>parse_detail</code>方法用于解析详情页，它接收一个<code>html</code>参数，解析其中的内容，并以字典的形式返回结果。每个字段的解析情况如下所述：</p>\n<ul>\n<li><code>cove</code>r：封面，直接选取<code>class</code>为<code>cover</code>的<code>img</code>节点，并调用<code>attr</code>方法获取<code>src</code>属性的内容即可。</li>\n<li><code>name</code>：名称，直接选取<code>a</code>节点的直接子节点<code>h2</code>节点，并调用<code>text</code>方法提取其文本内容即可得到名称。</li>\n<li><code>categories</code>：类别，由于类别是多个，所以这里首先用<code>.categories button span</code>选取了<code>class</code>为<code>categories</code>的节点内部的<code>span</code>节点，其结果是多个，所以这里进行了遍历，取出了每个<code>span</code>节点的文本内容，得到的便是列表形式的类别。</li>\n<li><code>published_at</code>：上映时间，由于<code>pyquery</code>支持使用<code>:contains</code>直接指定包含的文本内容并进行提取，且每个上映时间信息都包含了「上映」二字，所以这里就直接使用<code>:contains(上映)</code>提取了<code>class</code>为<code>info</code>的<code>div</code>节点。提取之后，得到的结果类似「1993-07-26 上映」这样，并不想要「上映」这两个字，所以又调用了正则表达式把日期单独提取出来了。当然这里也可以直接使用<code>strip</code>或<code>replace</code>方法把多余的文字去掉。</li>\n<li><code>drama</code>：直接提取<code>class</code>为<code>drama</code>的节点内部的<code>p</code>节点的文本即可。</li>\n<li><code>score</code>：直接提取<code>class</code>为<code>score</code>的<code>p</code>节点的文本即可，由于提取结果是字符串，所以我们需要把它转成浮点数，即``float`类型。</li>\n</ul>\n<p>上述字段提取完毕之后，构造一个字典返回。这样，成功完成了详情页的提取和分析了。</p>\n<p>将main方法稍微改写一下，增加这两个方法的调用，改写如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_PAGE+<span class=\"number\">1</span>):</span><br><span class=\"line\">        index_html = scrape_index(page)</span><br><span class=\"line\">        detail_urls = parse_index((index_html))</span><br><span class=\"line\">        <span class=\"keyword\">for</span> detail_url <span class=\"keyword\">in</span> detail_urls:</span><br><span class=\"line\">            detail_html = scrape_detail(detail_url)</span><br><span class=\"line\">            data = parse_detail(detail_html)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;get detail data %s&#x27;</span>, data)</span><br></pre></td></tr></table></figure>\n\n<p>首先遍历了<code>detail_urls</code>，获取了每个详情页的<code>URL</code>，然后依次调用了<code>scrape_detail</code>和<code>parse_detail</code>方法，最后得到了每个详情页的提取结果，赋值为<code>data</code>并输出。</p>\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">24</span> <span class=\"number\">12</span>:<span class=\"number\">46</span>:<span class=\"number\">31</span>,<span class=\"number\">432</span> - INFO: get detail data &#123;<span class=\"string\">&#x27;cover&#x27;</span>: <span class=\"string\">&#x27;https://p0.meituan.net/movie/b0d986a8bf89278afbb19f6abaef70f31206570.jpg@464w_644h_1e_1c&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&quot;辛德勒的名单 - Schindler&#x27;s List&quot;</span>, <span class=\"string\">&#x27;categories&#x27;</span>: [<span class=\"string\">&#x27;剧情&#x27;</span>, <span class=\"string\">&#x27;历史&#x27;</span>, <span class=\"string\">&#x27;战争&#x27;</span>], <span class=\"string\">&#x27;published_at&#x27;</span>: <span class=\"string\">&#x27;1993-11-30&#x27;</span>, <span class=\"string\">&#x27;drama&#x27;</span>: <span class=\"string\">&#x27;1939年，波兰在纳粹德国的统治下，党卫军对犹太人进行了隔离统治。德国商人奥斯卡·辛德勒（连姆·尼森 饰）来到德军统治下的克拉科夫，开设了一间搪瓷厂，生产军需用品。凭着出众的社交能力和大量的金钱，辛德勒和德军建立了良好 的关系，他的工厂雇用犹太人工作，大发战争财。1943年，克拉科夫的犹太人遭到了惨绝人寰的大屠杀，辛德勒目睹这一切，受到了极大的震撼，他贿赂军官，让自己的工厂成为集中营的附属劳役营，在那些疯狂屠杀的日子里，他的工厂也成为了犹太人的避难所。1944年，德国战败前夕，屠杀犹太人的行动越发疯狂，辛德勒向德军军官开出了1200人的名单，倾家荡产买下了这些犹太人的生命。在那些暗无天日的岁月里，拯救一个人，就是拯救全世界。&#x27;</span>, <span class=\"string\">&#x27;score&#x27;</span>: <span class=\"number\">9.5</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，已经成功提取出每部电影的基本信息，包括封面、名称、类别，等等。</p>\n<h2 id=\"保存到MongoDB\"><a href=\"#保存到MongoDB\" class=\"headerlink\" title=\"保存到MongoDB\"></a>保存到MongoDB</h2><p>请确保现在有一个可以正常连接和使用的<code>MongoDB</code>数据库。 将数据导入<code>MongoDB</code>需要用到<code>PyMongo</code>这个库，这个在最开始已经引入过了。那么接下来我们定义一下 <code>MongoDB</code>的连接配置，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MONGO_CONNECTION_STRING = <span class=\"string\">&#x27;mongodb://localhost:27017&#x27;</span></span><br><span class=\"line\">MONGO_DB_NAME = <span class=\"string\">&#x27;movies&#x27;</span></span><br><span class=\"line\">MONGO_COLLECTIONS_NAME = <span class=\"string\">&#x27;movies&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">client = pymongo.MongoClient(MONGO_CONNECTION_STRING)</span><br><span class=\"line\">db = client[<span class=\"string\">&#x27;movies&#x27;</span>]</span><br><span class=\"line\">collection = db[<span class=\"string\">&#x27;movies&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>在这里声明了几个变量，介绍如下：</p>\n<ul>\n<li><code>MONGO_CONNECTION_STRING</code>：<code>MongoDB</code>的连接字符串，里面定义了<code>MongoDB</code>的基本连接信息，如<code>host</code>、<code>port</code>，还可以定义用户名密码等内容。</li>\n<li><code>MONGO_DB_NAME</code>：<code>MongoDB</code>数据库的名称。</li>\n<li><code>MONGO_COLLECTION_NAME</code>：<code>MongoDB</code>的集合名称。</li>\n</ul>\n<p>这里用<code>MongoClient</code>声明了一个连接对象，然后依次声明了存储的数据库和集合。接下来，再实现一个将数据保存到<code>MongoDB</code>的方法，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">save_data</span>(<span class=\"params\">data</span>):</span></span><br><span class=\"line\">    collection.update_one(&#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;name&#x27;</span>: data.get(<span class=\"string\">&#x27;name&#x27;</span>)</span><br><span class=\"line\">    &#125;,&#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;$set&#x27;</span>: data</span><br><span class=\"line\">    &#125;, upsert=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n<p>声明了一个<code>save_data</code>方法，它接收一个<code>data</code>参数，也就是我们刚才提取的电影详情信息。在方法里面，调用了<code>update_one</code>方法，第1个参数是<strong>查询条件</strong>，即根据<code>name</code>进行查询；第2个参数是<code>data</code>对象本身，也就是所有的数据，这里用<code>$set</code>操作符表示更新操作；第3个参数很关键，这里实际上是<code>upsert</code>参数，如果把这个设置为 <code>True</code>，则可以做到存在即更新，不存在即插入的功能，更新会根据第一个参数设置的<code>name</code>字段，所以这样可以防止数据库中出现同名的电影数据。</p>\n<blockquote>\n<p>注：实际上电影可能有同名，但该场景下的爬取数据没有同名情况，当然这里更重要的是实现<code>MongoDB</code>的去重操作。</p>\n</blockquote>\n<p>接下来将<code>main</code>方法稍微改写一下就好了，改写如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_PAGE+<span class=\"number\">1</span>):</span><br><span class=\"line\">        index_html = scrape_index(page)</span><br><span class=\"line\">        detail_urls = parse_index((index_html))</span><br><span class=\"line\">        <span class=\"keyword\">for</span> detail_url <span class=\"keyword\">in</span> detail_urls:</span><br><span class=\"line\">            detail_html = scrape_detail(detail_url)</span><br><span class=\"line\">            data = parse_detail(detail_html)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;get detail data %s\\n&#x27;</span>, data)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;saving data to mongodb&#x27;</span>)</span><br><span class=\"line\">            save_data(data)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;data saved successfully\\n&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>重新运行，输出结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">......</span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">24</span> <span class=\"number\">13</span>:<span class=\"number\">16</span>:<span class=\"number\">46</span>,<span class=\"number\">882</span> - INFO: get detail data &#123;<span class=\"string\">&#x27;cover&#x27;</span>: <span class=\"string\">&#x27;https://p0.meituan.net/movie/58782fa5439c25d764713f711ebecd1e201941.jpg@464w_644h_1e_1c&#x27;</span>, <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;魂断蓝桥 - Waterloo Bridge&#x27;</span>, <span class=\"string\">&#x27;categories&#x27;</span>: [<span class=\"string\">&#x27;剧情&#x27;</span>, <span class=\"string\">&#x27;爱情&#x27;</span>, <span class=\"string\">&#x27;战争&#x27;</span>], <span class=\"string\">&#x27;published_at&#x27;</span>: <span class=\"string\">&#x27;1940-05-17&#x27;</span>, <span class=\"string\">&#x27;drama&#x27;</span>: <span class=\"string\">&#x27;第一次世界大战期间，回国度假的陆军中 </span></span><br><span class=\"line\"><span class=\"string\">尉罗伊（罗伯特·泰勒 饰）在滑铁卢桥上邂逅了舞蹈演员玛拉（费雯·丽 饰），两人彼此倾心，爱情迅速升温。就在两人决定结婚之时，罗伊应招回营地，两人被迫分离。由</span></span><br><span class=\"line\"><span class=\"string\">于错过剧团演出，玛拉被开除，只能和好友相依为命。不久玛拉得知罗伊阵亡的消息，几欲崩溃，备受打击。失去爱情的玛拉感到一切都失去了意义，为了生存，她和好友不</span></span><br><span class=\"line\"><span class=\"string\">得不沦为妓女。然而命运弄人，就在此时玛拉竟然再次遇到了罗伊。虽然为罗伊的生还兴奋不已，玛拉却因自己的失身陷入痛苦之中。感到一切难以挽回的玛拉潸然离开，独</span></span><br><span class=\"line\"><span class=\"string\">自来到两人最初相遇的地点——滑铁卢桥上…&#x27;</span>, <span class=\"string\">&#x27;score&#x27;</span>: <span class=\"number\">9.5</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">24</span> <span class=\"number\">13</span>:<span class=\"number\">16</span>:<span class=\"number\">46</span>,<span class=\"number\">885</span> - INFO: saving data to mongodb</span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">24</span> <span class=\"number\">13</span>:<span class=\"number\">16</span>:<span class=\"number\">46</span>,<span class=\"number\">889</span> - INFO: data saved successfully</span><br></pre></td></tr></table></figure>\n\n<p>运行完毕之后我们可以使用<code>MongoDB</code>客户端工具可视化查看已经爬取到的数据，结果如下：</p>\n<p><img src=\"Screenshot_6.webp\"></p>\n<h2 id=\"多进程加速\"><a href=\"#多进程加速\" class=\"headerlink\" title=\"多进程加速\"></a>多进程加速</h2><p>由于整个的爬取是单进程的，而且只能逐条爬取，速度稍微有点慢，有没有方法来对整个爬取过程进行加速呢？</p>\n<p>在前面学习了多进程的基本原理和使用方法，下面就来实践一下多进程的爬取。</p>\n<p>由于一共有<code>10</code>页详情页，并且这<code>10</code>页内容是互不干扰的，所以可以一页开一个进程来爬取。由于这<code>10</code>个列表页页码正好可以提前构造成一个列表，所以可以选用多进程里面的进程池<code>Pool</code>来实现这个过程。</p>\n<p>这里需要改写下<code>main</code>方法的调用，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>(<span class=\"params\">page</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_PAGE+<span class=\"number\">1</span>):</span><br><span class=\"line\">        index_html = scrape_index(page)</span><br><span class=\"line\">        detail_urls = parse_index((index_html))</span><br><span class=\"line\">        <span class=\"keyword\">for</span> detail_url <span class=\"keyword\">in</span> detail_urls:</span><br><span class=\"line\">            detail_html = scrape_detail(detail_url)</span><br><span class=\"line\">            data = parse_detail(detail_html)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;get detail data %s\\n&#x27;</span>, data)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;saving data to mongodb&#x27;</span>)</span><br><span class=\"line\">            save_data(data)</span><br><span class=\"line\">            logging.info(<span class=\"string\">&#x27;data saved successfully\\n&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    pool = multiprocessing.Pool()</span><br><span class=\"line\">    pages = <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_PAGE + <span class=\"number\">1</span>)</span><br><span class=\"line\">    pool.<span class=\"built_in\">map</span>(main, pages)</span><br><span class=\"line\">    pool.close()</span><br><span class=\"line\">    pool.join()</span><br></pre></td></tr></table></figure>\n\n<p>这里首先给<code>main</code>方法添加一个参数<code>page</code>，用以表示列表页的页码。接着声明了一个进程池，并声明<code>pages</code>为所有需要遍历的页码，即<code>1~10</code>。最后调用<code>map</code>方法，第1个参数就是需要被调用的方法，第2个参数就是<code>pages</code>，即需要遍历的页码。</p>\n<p>这样<code>pages</code>就会被依次遍历。把<code>1~10</code>这10个页码分别传递给<code>main</code>方法，并把每次的调用变成一个进程，加入到进程池中执行，进程池会根据当前运行环境来决定运行多少进程。</p>\n<p>运行输出结果和之前类似，但是可以明显看到加了多进程执行之后，爬取速度快了非常多。可以清空一下之前的<code>MongoDB</code>数据，可以发现数据依然可以被正常保存到<code>MongoDB</code>数据库中。</p>\n"},{"title":"spider的用法","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-07T16:49:45.000Z","pic":null,"_content":"\n## Spider 的用法\n\n在 `Scrapy` 中，要抓取网站的链接配置、抓取逻辑、解析逻辑等其实都是在 `Spider` 中配置的。\n\n### Spider运行流程\n\n在实现 `Scrapy` 爬虫项目时，最核心的类便是 `Spider` 类了，它定义了如何爬取某个网站的流程和解析方式。简单来讲， `Spider` 要做的事就是如下两件： \n\n- 定义爬取网站的动作； \n- 分析爬取下来的网页。 \n\n对于 `Spider` 类来说，整个爬取循环如下所述。 \n\n- 以初始的 `URL` 初始化 `Request` ，并设置回调函数。 当\n- 该 `Request` 成功请求并返回时，将生成 `Response` ，并作为参数传给该回调函数。 \n- 在回调函数内分析返回的网页内容。返回结果可以有两种形式，一种是解析到的有效结果返回字典或 `Item` 对象。下一步可经过处理后（或直接）保存，另一种是解析到的下一个（如下一页）链接，可以 利用此链接构造 `Request` 并设置新的回调函数，返回 `Request` 。 \n- 如果返回的是字典或 `Item` 对象，可通过 `Feed Exports` 等形式存入文件，如果设置了 `Pipeline` 的话，可以经由 `Pipeline` 处理（如过滤、修正等）并保存。 \n- 如果返回的是 `Reqeust` ，那么 `Request` 执行成功得到 `Response` 之后会再次传递给 `Request` 中定义的回调函数，可以再次使用选择器来分析新得到的网页内容，并根据分析的数据生成 `Item` 。 通过以上几步循环往复进行，便完成了站点的爬取。\n\n### Spider类分析\n\n`Spider` 继承自 `scrapy.spiders.Spider` ，这个类是最简单最基本的 `Spider` 类，每个其他的 `Spider` 必须继承自这个类，还有后面要说明的一些特殊 `Spider` 类也都是继承自它。 这个类里提供了 `start_requests` 方法的默认实现，读取并请求 `start_urls` 属性，并根据返回的结果调用 `parse` 方法解析结果。另外它还有一些基础属性，下面对其进行讲解。\n\n- `name` ：爬虫名称，是定义 `Spider` 名字的字符串。Spider 的名字定义了 Scrapy如何定位并初始化 Spider，所以其必须是唯一的。 不过我们可以生成多个相同的 Spider 实例，这没有任何限制。 name 是 Spider 最重要的属性，而且是必需的。如果该 Spider 爬取单个网站，一个常见的做法是以该网站的域名名称来命名 Spider。例如，如果 Spider 爬取 mywebsite.com，该 Spider 通常会被命名为 mywebsite。 \n- allowed_domains：允许爬取的域名，是可选配置，不在此范围的链接不会被跟进爬取。 \n- `start_urls` ：起始 `URL` 列表，当我们没有实现 `start_requests` 方法时，默认会从这个列表开始抓取。 \n- `custom_settings` ：这是一个字典，是专属于本 `Spider` 的配置，此设置会覆盖项目全局的设置，而且此设置必须在初始化前被更新，所以它必须定义成类变量。 \n- `crawler` ：此属性是由 `from_crawler` 方法设置的，代表的是本 `Spider` 类对应的 `Crawler` 对象， `Crawler` 对象中包含了很多项目组件，利用它我们可以获取项目的一些配置信息，如最常见的就是获取项目的设置信息，即 `Settings` 。 \n- `settings` ：是一个 `Settings` 对象，利用它我们可以直接获取项目的全局设置变量。 \n\n除了一些基础属性， `Spider` 还有一些常用的方法，在此介绍如下。 \n\n- `start_requests` ：此方法用于生成初始请求，它必须返回一个可迭代对象，此方法会默认使用 `start_urls` 里面的 `URL` 来构造 `Request` ，而且 `Request` 是 `GET` 请求方式。如果我们想在启动时以 `POST` 方式访问某个 站点，可以直接重写这个方法，发送 `POST` 请求时我们使用 `FormRequest` 即可。 \n- `parse` ：当 `Response` 没有指定回调函数时，该方法会默认被调用，它负责处理 `Response` ，处理返回结果，并从中提取出想要的数据和下一步的请求，然后返回。该方法需要返回一个包含 `Request` 或 `Item` 的可迭代对象。 \n- `closed` ：当 `Spider` 关闭时，该方法会被调用，在这里一般会定义释放资源的一些操作或其他收尾操作。\n\n## Selector 的用法\n\n`Scrapy` 还提供了自己的数据提取方法，即 `Selector（选择器）` 。 `Selector` 是基于 `lxml` 构建的，支持 `XPath选择器` 、 `CSS选择器` ，以及 `正则表达式` ，功能全面，解析速度和准确度非常高。\n\n### 直接使用\n\n`Selector` 是一个可以独立使用的模块。我们可以直接利用 `Selector` 这个类来构建一个选择器对象，然后调用它的相关方法如 `xpath、css` 等来提取数据。 \n\n例如，针对一段 HTML代码，我们可以用如下方式构建 `Selector` 对象来提取数据： \n\n```python\nfrom scrapy import Selector\n\nbody = '''\n<html>\n    <head>\n        <title>Hello World</title>\n    </head>\n    <body>\n    </body>\n</html>\n'''\n\nselectot = Selector(text=body)\ntitle = selectot.xpath(\"//title/text()\").extract_first()\nprint(title)\n\n#Hello World \n```\n\n这里我们没有在 `Scrapy` 框架中运行，而是把 `Scrapy` 中的 `Selector` 单独拿出来使用了，构建的时候传入 `text` 参数，就生成了一个 `Selector` 选择器对象，然后就可以像前面我们所用的 `Scrapy` 中的解析方式一样，调用 `xpath、css` 等方法来提取了。 在这里我们查找的是源代码中的 `title` 中的文本，在 `XPath选择器` 最后加 `text` 方法就可以实现文本的提取了。\n\n### Scrapy Shell\n\n由于 `Selector` 主要是与 `Scrapy` 结合使用，如 `Scrapy` 的回调函数中的参数 `response` 直接调用 `xpath()` 或者 `css()` 方法来提取数据，所以在这里我们借助 `Scrapy Shell` 来模拟 `Scrapy` 请求的过程，来讲解相关的提取方法。\n\n我们用官方文档的一个样例页面来做演示：[http://doc.scrapy.org/en/latest/_static/selectors-sample1.html](http://doc.scrapy.org/en/latest/_static/selectors-sample1.html)。 \n\n开启 `Scrapy Shell`，在命令行中输入如下命令： \n\n```shell\nscrapy shell http://doc.scrapy.org/en/latest/_static/selectors-sample1.html\n```\n\n这样我们就进入了 `Scrapy Shell` 模式。这个过程其实是 `Scrapy` 发起了一次请求，请求的 `URL` 就是刚才命令行下输入的 `URL` ，然后把一些可操作的变量传递给我们，如 `request、response` 等。\n\n输出结果：\n\n```python\nC:\\Users\\espho\\PycharmProjects\\PythonProjs\\python模块\\Scrapy框架>scrapy shell http://doc.scrapy.org/en/latest/_static/selectors-sample1.html\n2021-06-08 13:47:02 [scrapy.utils.log] INFO: Scrapy 2.5.0 started (bot: scrapybot)\n2021-06-08 13:47:02 [scrapy.utils.log] INFO: Versions: lxml 4.6.3.0, libxml2 2.9.5, cssselect 1.1.0, parsel 1.6.0, w3lib 1.22.0, Twisted 21.2.0, Python 3.8.7 (tags/v3.8.7:6503f05, Dec 21 2020, 17:59:51) [MSC v.1928 64 bit (AMD64)], pyOpenSSL 20.0.1 (OpenSSL 1.1.1k  25 Mar 2021), cryptography 3.4.7, Platform Windows-10-10.0.19041-SP0\n2021-06-08 13:47:02 [scrapy.utils.log] DEBUG: Using reactor: twisted.internet.selectreactor.SelectReactor\n2021-06-08 13:47:02 [scrapy.crawler] INFO: Overridden settings:\n{'DUPEFILTER_CLASS': 'scrapy.dupefilters.BaseDupeFilter',\n 'LOGSTATS_INTERVAL': 0}\n2021-06-08 13:47:02 [scrapy.extensions.telnet] INFO: Telnet Password: b22034a15ef07be9\n2021-06-08 13:47:02 [scrapy.middleware] INFO: Enabled extensions:\n['scrapy.extensions.corestats.CoreStats',\n 'scrapy.extensions.telnet.TelnetConsole']\n2021-06-08 13:47:02 [scrapy.middleware] INFO: Enabled downloader middlewares:\n['scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware',\n 'scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware',\n 'scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware',\n 'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware',\n 'scrapy.downloadermiddlewares.retry.RetryMiddleware',\n 'scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware',\n 'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware',\n 'scrapy.downloadermiddlewares.redirect.RedirectMiddleware',\n 'scrapy.downloadermiddlewares.cookies.CookiesMiddleware',\n 'scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware',\n 'scrapy.downloadermiddlewares.stats.DownloaderStats']\n2021-06-08 13:47:02 [scrapy.middleware] INFO: Enabled spider middlewares:\n['scrapy.spidermiddlewares.httperror.HttpErrorMiddleware',\n 'scrapy.spidermiddlewares.offsite.OffsiteMiddleware',\n 'scrapy.spidermiddlewares.referer.RefererMiddleware',\n 'scrapy.spidermiddlewares.urllength.UrlLengthMiddleware',\n 'scrapy.spidermiddlewares.depth.DepthMiddleware']\n2021-06-08 13:47:02 [scrapy.middleware] INFO: Enabled item pipelines:\n[]\n2021-06-08 13:47:02 [scrapy.extensions.telnet] INFO: Telnet console listening on 127.0.0.1:6023\n2021-06-08 13:47:02 [scrapy.core.engine] INFO: Spider opened\n2021-06-08 13:47:03 [scrapy.downloadermiddlewares.redirect] DEBUG: Redirecting (302) to <GET https://doc.scrapy.org/en/latest/_static/selectors-sample1.html> from <GET http://doc.scrapy.org/en/latest/_static/selectors-sample1.html>\n2021-06-08 13:47:04 [scrapy.core.engine] DEBUG: Crawled (200) <GET https://doc.scrapy.org/en/latest/_static/selectors-sample1.html> (referer: None)\n2021-06-08 13:47:06 [asyncio] DEBUG: Using proactor: IocpProactor\n[s] Available Scrapy objects:\n[s]   scrapy     scrapy module (contains scrapy.Request, scrapy.Selector, etc)\n[s]   crawler    <scrapy.crawler.Crawler object at 0x0000010ADFBBE220>\n[s]   item       {}\n[s]   request    <GET http://doc.scrapy.org/en/latest/_static/selectors-sample1.html>\n[s]   response   <200 https://doc.scrapy.org/en/latest/_static/selectors-sample1.html>\n[s]   settings   <scrapy.settings.Settings object at 0x0000010ADFBBE2B0>\n[s]   spider     <DefaultSpider 'default' at 0x10ae002fdc0>\n[s] Useful shortcuts:\n[s]   fetch(url[, redirect=True]) Fetch URL and update local objects (by default, redirects are followed)\n[s]   fetch(req)                  Fetch a scrapy.Request and update local objects\n[s]   shelp()           Shell help (print this help)\n[s]   view(response)    View response in a browser\n2021-06-08 13:47:06 [asyncio] DEBUG: Using proactor: IocpProactor\nIn [1]: \n```\n\n可以在命令行模式下输入命令调用对象的一些操作方法，回车之后实时显示结果。这与 `Python` 的命令行交互模式是类似的。\n\n```python\nIn [2]: response.url\nOut[2]: 'https://doc.scrapy.org/en/latest/_static/selectors-sample1.html'\nIn [3]: response.text\nOut[3]: \"<html>\\n <head>\\n  <base href='http://example.com/' />\\n  <title>Example website</title>\\n </head>\\n <body>\\n  <div id='images'>\\n   <a href='image1.html'>Name: My image 1 <br /><img src='image1_thumb.jpg' /></a>\\n   <a href='image2.html'>Name: My image 2 <br /><img src='image2_thumb.jpg' /></a>\\n   <a href='image3.html'>Name: My image 3 <br /><img src='image3_thumb.jpg' /></a>\\n   <a href='image4.html'>Name: My image 4 <br /><img src='image4_thumb.jpg' /></a>\\n   <a href='image5.html'>Name: My image 5 <br /><img src='image5_thumb.jpg' /></a>\\n  </div>\\n </body>\\n</html>\\n\\n\"\n```\n\n### XPath选择器\n\n进入 `Scrapy Shell` 之后，我们将主要操作 `response` 变量来进行解析。因为我们解析的是 `HTML` `代码，Selector` 将自动使用 `HTML`语法来分析。 `response` 有一个属性 `selector`，我们调用 `response.selector` 返回的内容就相当于用 `response` 的 `text` 构造了一个 `Selector` 对象。通过这个 `Selector` 对象我们可以调用解析方法如 `xpath、css` 等，通过向方法传入 `XPath`或 `CSS` 选择器参数就可以实现信息的提取。 我们用一个实例感受一下，如下所示：\n\n```python\nIn [4]: response.selector\nOut[4]: <Selector xpath=None data='<html>\\n <head>\\n  <base href=\"http://e...'>\n\nIn [6]: result = response.selector.xpath(\"//a\")\n\nIn [7]: result\nOut[7]: \n[<Selector xpath='//a' data='<a href=\"image1.html\">Name: My image ...'>,\n <Selector xpath='//a' data='<a href=\"image2.html\">Name: My image ...'>,\n <Selector xpath='//a' data='<a href=\"image3.html\">Name: My image ...'>,\n <Selector xpath='//a' data='<a href=\"image4.html\">Name: My image ...'>,\n <Selector xpath='//a' data='<a href=\"image5.html\">Name: My image ...'>]\n```\n\n打印结果的形式是 `Selector` 组成的列表，其实它是 `SelectorList` 类型， `SelectorList` 和 `Selector` 都可以继续调用 `xpath` 和 `css` 等方法来进一步提取数据。 在上面的例子中，我们提取了 `a` 节点。接下来，我们尝试继续调用 `xpath` 方法来提取 `a` 节点内包含的 `img` 节点，如下所示：\n\n```python\nIn [8]: result.xpath(\"./img\")\nOut[8]: \n[<Selector xpath='./img' data='<img src=\"image1_thumb.jpg\">'>,\n <Selector xpath='./img' data='<img src=\"image2_thumb.jpg\">'>,\n <Selector xpath='./img' data='<img src=\"image3_thumb.jpg\">'>,\n <Selector xpath='./img' data='<img src=\"image4_thumb.jpg\">'>,\n <Selector xpath='./img' data='<img src=\"image5_thumb.jpg\">'>]\n ```\n\n我们获得了 `a` 节点里面的所有 `img`节点，结果为 `5`。\n\n选择器的最前方加 `.（点）`，这代表提取元素内部的数据，如果没有加点，则代表从根节点开始提取。此处我们用了 `./img`的提取方式，则代表从 `a` 节点里进行提取。如果此处我们用 `//img`，则还 是从 `html节点`里进行提取。 \n\n我们刚才使用了 `response.selector.xpath`方法对数据进行了提取。`Scrapy`提供了两个实用的快捷方法，`response.xpath`和 `response.css`，它们二者的功能完全等同于 `response.selector.xpath`和 `response.selector.css`。方便起 见，后面我们统一直接调用 `response` 的 `xpath`和 `css` 方法进行选择。 现在我们得到的是 `SelectorList` 类型的变量，该变量是由 `Selector` 对象组成的列表。我们可以用索引单独取出其中某个 `Selector` 元素，如下所示：\n\n```python\nIn [9]: result[0]\nOut[9]: <Selector xpath='//a' data='<a href=\"image1.html\">Name: My image ...'>\n```\n可以像操作列表一样操作这个 `SelectorList` 。但是现在获取的内容是 `Selector` 或者 `SelectorList` 类型，并不是真正的文本内容。那么具体的内容怎么提取呢？ 比如我们现在想提取出 `a` 节点元素，就可以利用 `extract` 方法，如下所示：\n\n```python\nIn [10]: result[0].extract()\nOut[10]: '<a href=\"image1.html\">Name: My image 1 <br><img src=\"image1_thumb.jpg\"></a>'\n```\n\n这里使用了 `extract` 方法，我们就可以把真实需要的内容获取下来。\n\n还可以改写 `XPath` 表达式，来选取节点的内部文本和属性，如下所示：\n\n```python\nIn [11]: response.xpath('//a/text()').extract()\nOut[11]: \n['Name: My image 1 ',\n 'Name: My image 2 ',\n 'Name: My image 3 ',\n 'Name: My image 4 ',\n 'Name: My image 5 ']\n\nIn [12]: response.xpath('//a/@href').extract()\nOut[12]: ['image1.html', 'image2.html', 'image3.html', 'image4.html', 'image5.html']\n```\n\n只需要再加一层` /text()` 就可以获取节点的内部文本，或者加一层 `/@href`就可以获取节点的 `href属性`。其中，`@` 符号后面内容就是要获取的属性名称。\n\n现在我们可以用一个规则把所有符合要求的节点都获取下来，返回的类型是列表类型。\n \n但是这里有一个问题：如果符合要求的节点只有一个，那么返回的结果会是什么呢？我们再用一个实例来感受一下，如下所示：\n\n```python\nIn [13]: response.xpath('//a[@href=\"image1.html\"]/text()').extract()\nOut[13]: ['Name: My image 1 ']\n```\n\n用属性限制了匹配的范围，使 `XPath`只可以匹配到一个元素。然后用 `extract` 方法提取结果，其结果还是一个列表形式，其文本是列表的第一个元素。但很多情况下，我们其实想要的数据就是第一个元素内容，这里我们通过加一个索引来获取，如下所示： \n\n```python\n'Name: My image 1 ' \n```\n\n但是，这个写法很明显是有风险的。一旦 `XPath`有问题，那么 `extract` 后的结果可能是一个空列表。如果我们再用索引来获取，那不就可能会导致数组越界吗？ 所以，另外一个方法可以专门提取单个元素，它叫作 `extract_first`。我们可以改写上面的例子如下所示：\n\n```python\nIn [14]: response.xpath('//a[@href=\"image1.html\"]/text()').extract_first()\nOut[14]: 'Name: My image 1 '\n```\n\n直接利用 `extract_first` 方法将匹配的第一个结果提取出来，同时我们也不用担心数组越界的问题。也可以给`extract_first()`传递一个默认值，找不到的话会使用默认值。\n\n### CSS 选择器 \n\n接下来，我们看看 `CSS` 选择器的用法。`Scrapy`的选择器同时还对接了 `CSS` 选择器，使用 `response.css()` 方法可以使用 `CSS` 选择器来选择对应的元素。\n\n例如在上文我们选取了所有的 `a` 节点，那么 `CSS` 选择器同样可以做到，如下所示：\n\n```python\nIn [15]: response.css('a')\nOut[15]: \n[<Selector xpath='descendant-or-self::a' data='<a href=\"image1.html\">Name: My image ...'>,\n <Selector xpath='descendant-or-self::a' data='<a href=\"image2.html\">Name: My image ...'>,\n <Selector xpath='descendant-or-self::a' data='<a href=\"image3.html\">Name: My image ...'>,\n <Selector xpath='descendant-or-self::a' data='<a href=\"image4.html\">Name: My image ...'>,\n <Selector xpath='descendant-or-self::a' data='<a href=\"image5.html\">Name: My image ...'>]\n```\n\n同样，调用 `extract` 方法就可以提取出节点，如下所示：\n\n```python\nIn [16]: response.css('a').extract()\nOut[16]: \n['<a href=\"image1.html\">Name: My image 1 <br><img src=\"image1_thumb.jpg\"></a>',\n '<a href=\"image2.html\">Name: My image 2 <br><img src=\"image2_thumb.jpg\"></a>',\n '<a href=\"image3.html\">Name: My image 3 <br><img src=\"image3_thumb.jpg\"></a>',\n '<a href=\"image4.html\">Name: My image 4 <br><img src=\"image4_thumb.jpg\"></a>',\n '<a href=\"image5.html\">Name: My image 5 <br><img src=\"image5_thumb.jpg\"></a>']\n```\n\n用法和 `XPath选择`是完全一样的。另外，我们也可以进行属性选择和嵌套选择，如下所示：\n\n```python\nIn [17]: response.css('a[href=\"image4.html\"]').extract()\nOut[17]: ['<a href=\"image4.html\">Name: My image 4 <br><img src=\"image4_thumb.jpg\"></a>']\nIn [18]: response.css('a[href=\"image4.html\"] img').extract()\nOut[18]: ['<img src=\"image4_thumb.jpg\">']\n```\n\n也可以使用 `extract_first()` 方法提取列表的第一个元素，如下所示：\n\n```python\nIn [19]: response.css('a[href=\"image4.html\"] img').extract_first()\nOut[19]: '<img src=\"image4_thumb.jpg\">'\n```\n\n接下来的两个用法不太一样。节点的内部文本和属性的获取是这样实现的，如下所示：\n\n```python\nIn [21]: response.css('a[href=\"image4.html\"]::text').extract_first()\nOut[21]: 'Name: My image 4 '\nIn [22]: response.css('a[href=\"image4.html\"] img::attr(src)').extract_first()\nOut[22]: 'image4_thumb.jpg'\n```\n\n获取文本和属性需要用 `::text` 和 `::attr()` 的写法。而其他库如 `BeautifulSoup` 或 `PyQuery` 都有单独的方法。\n\n`CSS 选择器`和 `XPath选择器`一样可以嵌套选择。我们可以先用 `XPath选择器`选中所有 `a` 节点，再利用 `CSS 选择器`选中 `img节点`，再用 `XPath选择器`获取属性。我们用一个实例来感受一下，如下所示：\n\n```python\nIn [23]: response.xpath('//a').css('img').xpath('@src')\nOut[23]: \n[<Selector xpath='@src' data='image1_thumb.jpg'>,\n <Selector xpath='@src' data='image2_thumb.jpg'>,\n <Selector xpath='@src' data='image3_thumb.jpg'>,\n <Selector xpath='@src' data='image4_thumb.jpg'>,\n <Selector xpath='@src' data='image5_thumb.jpg'>]\nIn [24]: response.xpath('//a').css('img').xpath('@src').extract_first()\nOut[24]: 'image1_thumb.jpg'\n```\n\n可以随意使用 `xpath` 和 `css` 方法二者自由组合实现嵌套查询，二者是完全兼容的。\n\n### 正则匹配\n\n`Scrapy`的选择器还支持正则匹配。比如，在示例的 `a` 节点中的文本类似于 `Name:My image 1`，现在我们只想把 `Name:`后面的内容提取出来，这时就可以借助 `re` 方法，实现如下：\n\n```python\nIn [27]: response.xpath('//a/text()').re('\\s(.*):\\s(.*)')\nOut[27]: ['My image 1 ', 'My image 2 ', 'My image 3 ', 'My image 4 ', 'My image 5 ']\n```\n\n给 `re` 方法传入一个正则表达式，其中 `(.*)` 就是要匹配的内容，输出的结果就是正则表达式匹配的分组，结果会依次输出。 如果同时存在两个分组，那么结果依然会被按序输出，如下所示：\n\n```python\nIn [32]: response.xpath('//a/text()').re('(.*?):\\s(.*)')\nOut[32]: \n['Name',\n 'My image 1 ',\n 'Name',\n 'My image 2 ',\n 'Name',\n 'My image 3 ',\n 'Name',\n 'My image 4 ',\n 'Name',\n 'My image 5 ']\n```\n\n类似 `extract_first` 方法，`re_first` 方法可以选取列表的第一个元素，用法如下：\n\n```python\nIn [35]: response.xpath('//a/text()').re_first('(.*?):\\s(.*)')\nOut[35]: 'Name'\n```\n\n不论正则匹配了几个分组，结果都会等于列表的第一个元素。 值得注意的是， `response` 对象不能直接调用 `re` 和 `re_first` 方法。如果想要对全文进行正则匹配，可以先调用 `xpath` 方法然后再进行正则匹配，如下所示：\n\n```python\nIn [36]: response.xpath('.').re('Name:\\s(.*)<br>')\nOut[36]: ['My image 1 ', 'My image 2 ', 'My image 3 ', 'My image 4 ', 'My image 5 ']\n\nIn [37]:  response.xpath('.').re_first('Name:\\s(.*)<br>')\nOut[37]: 'My image 1 \n```\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","source":"_posts/spider的用法.md","raw":"---\ntitle: spider的用法\ntags:\n  - scarpy\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-08 00:49:45\ncategories: 爬虫\npic:\n---\n\n## Spider 的用法\n\n在 `Scrapy` 中，要抓取网站的链接配置、抓取逻辑、解析逻辑等其实都是在 `Spider` 中配置的。\n\n### Spider运行流程\n\n在实现 `Scrapy` 爬虫项目时，最核心的类便是 `Spider` 类了，它定义了如何爬取某个网站的流程和解析方式。简单来讲， `Spider` 要做的事就是如下两件： \n\n- 定义爬取网站的动作； \n- 分析爬取下来的网页。 \n\n对于 `Spider` 类来说，整个爬取循环如下所述。 \n\n- 以初始的 `URL` 初始化 `Request` ，并设置回调函数。 当\n- 该 `Request` 成功请求并返回时，将生成 `Response` ，并作为参数传给该回调函数。 \n- 在回调函数内分析返回的网页内容。返回结果可以有两种形式，一种是解析到的有效结果返回字典或 `Item` 对象。下一步可经过处理后（或直接）保存，另一种是解析到的下一个（如下一页）链接，可以 利用此链接构造 `Request` 并设置新的回调函数，返回 `Request` 。 \n- 如果返回的是字典或 `Item` 对象，可通过 `Feed Exports` 等形式存入文件，如果设置了 `Pipeline` 的话，可以经由 `Pipeline` 处理（如过滤、修正等）并保存。 \n- 如果返回的是 `Reqeust` ，那么 `Request` 执行成功得到 `Response` 之后会再次传递给 `Request` 中定义的回调函数，可以再次使用选择器来分析新得到的网页内容，并根据分析的数据生成 `Item` 。 通过以上几步循环往复进行，便完成了站点的爬取。\n\n### Spider类分析\n\n`Spider` 继承自 `scrapy.spiders.Spider` ，这个类是最简单最基本的 `Spider` 类，每个其他的 `Spider` 必须继承自这个类，还有后面要说明的一些特殊 `Spider` 类也都是继承自它。 这个类里提供了 `start_requests` 方法的默认实现，读取并请求 `start_urls` 属性，并根据返回的结果调用 `parse` 方法解析结果。另外它还有一些基础属性，下面对其进行讲解。\n\n- `name` ：爬虫名称，是定义 `Spider` 名字的字符串。Spider 的名字定义了 Scrapy如何定位并初始化 Spider，所以其必须是唯一的。 不过我们可以生成多个相同的 Spider 实例，这没有任何限制。 name 是 Spider 最重要的属性，而且是必需的。如果该 Spider 爬取单个网站，一个常见的做法是以该网站的域名名称来命名 Spider。例如，如果 Spider 爬取 mywebsite.com，该 Spider 通常会被命名为 mywebsite。 \n- allowed_domains：允许爬取的域名，是可选配置，不在此范围的链接不会被跟进爬取。 \n- `start_urls` ：起始 `URL` 列表，当我们没有实现 `start_requests` 方法时，默认会从这个列表开始抓取。 \n- `custom_settings` ：这是一个字典，是专属于本 `Spider` 的配置，此设置会覆盖项目全局的设置，而且此设置必须在初始化前被更新，所以它必须定义成类变量。 \n- `crawler` ：此属性是由 `from_crawler` 方法设置的，代表的是本 `Spider` 类对应的 `Crawler` 对象， `Crawler` 对象中包含了很多项目组件，利用它我们可以获取项目的一些配置信息，如最常见的就是获取项目的设置信息，即 `Settings` 。 \n- `settings` ：是一个 `Settings` 对象，利用它我们可以直接获取项目的全局设置变量。 \n\n除了一些基础属性， `Spider` 还有一些常用的方法，在此介绍如下。 \n\n- `start_requests` ：此方法用于生成初始请求，它必须返回一个可迭代对象，此方法会默认使用 `start_urls` 里面的 `URL` 来构造 `Request` ，而且 `Request` 是 `GET` 请求方式。如果我们想在启动时以 `POST` 方式访问某个 站点，可以直接重写这个方法，发送 `POST` 请求时我们使用 `FormRequest` 即可。 \n- `parse` ：当 `Response` 没有指定回调函数时，该方法会默认被调用，它负责处理 `Response` ，处理返回结果，并从中提取出想要的数据和下一步的请求，然后返回。该方法需要返回一个包含 `Request` 或 `Item` 的可迭代对象。 \n- `closed` ：当 `Spider` 关闭时，该方法会被调用，在这里一般会定义释放资源的一些操作或其他收尾操作。\n\n## Selector 的用法\n\n`Scrapy` 还提供了自己的数据提取方法，即 `Selector（选择器）` 。 `Selector` 是基于 `lxml` 构建的，支持 `XPath选择器` 、 `CSS选择器` ，以及 `正则表达式` ，功能全面，解析速度和准确度非常高。\n\n### 直接使用\n\n`Selector` 是一个可以独立使用的模块。我们可以直接利用 `Selector` 这个类来构建一个选择器对象，然后调用它的相关方法如 `xpath、css` 等来提取数据。 \n\n例如，针对一段 HTML代码，我们可以用如下方式构建 `Selector` 对象来提取数据： \n\n```python\nfrom scrapy import Selector\n\nbody = '''\n<html>\n    <head>\n        <title>Hello World</title>\n    </head>\n    <body>\n    </body>\n</html>\n'''\n\nselectot = Selector(text=body)\ntitle = selectot.xpath(\"//title/text()\").extract_first()\nprint(title)\n\n#Hello World \n```\n\n这里我们没有在 `Scrapy` 框架中运行，而是把 `Scrapy` 中的 `Selector` 单独拿出来使用了，构建的时候传入 `text` 参数，就生成了一个 `Selector` 选择器对象，然后就可以像前面我们所用的 `Scrapy` 中的解析方式一样，调用 `xpath、css` 等方法来提取了。 在这里我们查找的是源代码中的 `title` 中的文本，在 `XPath选择器` 最后加 `text` 方法就可以实现文本的提取了。\n\n### Scrapy Shell\n\n由于 `Selector` 主要是与 `Scrapy` 结合使用，如 `Scrapy` 的回调函数中的参数 `response` 直接调用 `xpath()` 或者 `css()` 方法来提取数据，所以在这里我们借助 `Scrapy Shell` 来模拟 `Scrapy` 请求的过程，来讲解相关的提取方法。\n\n我们用官方文档的一个样例页面来做演示：[http://doc.scrapy.org/en/latest/_static/selectors-sample1.html](http://doc.scrapy.org/en/latest/_static/selectors-sample1.html)。 \n\n开启 `Scrapy Shell`，在命令行中输入如下命令： \n\n```shell\nscrapy shell http://doc.scrapy.org/en/latest/_static/selectors-sample1.html\n```\n\n这样我们就进入了 `Scrapy Shell` 模式。这个过程其实是 `Scrapy` 发起了一次请求，请求的 `URL` 就是刚才命令行下输入的 `URL` ，然后把一些可操作的变量传递给我们，如 `request、response` 等。\n\n输出结果：\n\n```python\nC:\\Users\\espho\\PycharmProjects\\PythonProjs\\python模块\\Scrapy框架>scrapy shell http://doc.scrapy.org/en/latest/_static/selectors-sample1.html\n2021-06-08 13:47:02 [scrapy.utils.log] INFO: Scrapy 2.5.0 started (bot: scrapybot)\n2021-06-08 13:47:02 [scrapy.utils.log] INFO: Versions: lxml 4.6.3.0, libxml2 2.9.5, cssselect 1.1.0, parsel 1.6.0, w3lib 1.22.0, Twisted 21.2.0, Python 3.8.7 (tags/v3.8.7:6503f05, Dec 21 2020, 17:59:51) [MSC v.1928 64 bit (AMD64)], pyOpenSSL 20.0.1 (OpenSSL 1.1.1k  25 Mar 2021), cryptography 3.4.7, Platform Windows-10-10.0.19041-SP0\n2021-06-08 13:47:02 [scrapy.utils.log] DEBUG: Using reactor: twisted.internet.selectreactor.SelectReactor\n2021-06-08 13:47:02 [scrapy.crawler] INFO: Overridden settings:\n{'DUPEFILTER_CLASS': 'scrapy.dupefilters.BaseDupeFilter',\n 'LOGSTATS_INTERVAL': 0}\n2021-06-08 13:47:02 [scrapy.extensions.telnet] INFO: Telnet Password: b22034a15ef07be9\n2021-06-08 13:47:02 [scrapy.middleware] INFO: Enabled extensions:\n['scrapy.extensions.corestats.CoreStats',\n 'scrapy.extensions.telnet.TelnetConsole']\n2021-06-08 13:47:02 [scrapy.middleware] INFO: Enabled downloader middlewares:\n['scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware',\n 'scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware',\n 'scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware',\n 'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware',\n 'scrapy.downloadermiddlewares.retry.RetryMiddleware',\n 'scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware',\n 'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware',\n 'scrapy.downloadermiddlewares.redirect.RedirectMiddleware',\n 'scrapy.downloadermiddlewares.cookies.CookiesMiddleware',\n 'scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware',\n 'scrapy.downloadermiddlewares.stats.DownloaderStats']\n2021-06-08 13:47:02 [scrapy.middleware] INFO: Enabled spider middlewares:\n['scrapy.spidermiddlewares.httperror.HttpErrorMiddleware',\n 'scrapy.spidermiddlewares.offsite.OffsiteMiddleware',\n 'scrapy.spidermiddlewares.referer.RefererMiddleware',\n 'scrapy.spidermiddlewares.urllength.UrlLengthMiddleware',\n 'scrapy.spidermiddlewares.depth.DepthMiddleware']\n2021-06-08 13:47:02 [scrapy.middleware] INFO: Enabled item pipelines:\n[]\n2021-06-08 13:47:02 [scrapy.extensions.telnet] INFO: Telnet console listening on 127.0.0.1:6023\n2021-06-08 13:47:02 [scrapy.core.engine] INFO: Spider opened\n2021-06-08 13:47:03 [scrapy.downloadermiddlewares.redirect] DEBUG: Redirecting (302) to <GET https://doc.scrapy.org/en/latest/_static/selectors-sample1.html> from <GET http://doc.scrapy.org/en/latest/_static/selectors-sample1.html>\n2021-06-08 13:47:04 [scrapy.core.engine] DEBUG: Crawled (200) <GET https://doc.scrapy.org/en/latest/_static/selectors-sample1.html> (referer: None)\n2021-06-08 13:47:06 [asyncio] DEBUG: Using proactor: IocpProactor\n[s] Available Scrapy objects:\n[s]   scrapy     scrapy module (contains scrapy.Request, scrapy.Selector, etc)\n[s]   crawler    <scrapy.crawler.Crawler object at 0x0000010ADFBBE220>\n[s]   item       {}\n[s]   request    <GET http://doc.scrapy.org/en/latest/_static/selectors-sample1.html>\n[s]   response   <200 https://doc.scrapy.org/en/latest/_static/selectors-sample1.html>\n[s]   settings   <scrapy.settings.Settings object at 0x0000010ADFBBE2B0>\n[s]   spider     <DefaultSpider 'default' at 0x10ae002fdc0>\n[s] Useful shortcuts:\n[s]   fetch(url[, redirect=True]) Fetch URL and update local objects (by default, redirects are followed)\n[s]   fetch(req)                  Fetch a scrapy.Request and update local objects\n[s]   shelp()           Shell help (print this help)\n[s]   view(response)    View response in a browser\n2021-06-08 13:47:06 [asyncio] DEBUG: Using proactor: IocpProactor\nIn [1]: \n```\n\n可以在命令行模式下输入命令调用对象的一些操作方法，回车之后实时显示结果。这与 `Python` 的命令行交互模式是类似的。\n\n```python\nIn [2]: response.url\nOut[2]: 'https://doc.scrapy.org/en/latest/_static/selectors-sample1.html'\nIn [3]: response.text\nOut[3]: \"<html>\\n <head>\\n  <base href='http://example.com/' />\\n  <title>Example website</title>\\n </head>\\n <body>\\n  <div id='images'>\\n   <a href='image1.html'>Name: My image 1 <br /><img src='image1_thumb.jpg' /></a>\\n   <a href='image2.html'>Name: My image 2 <br /><img src='image2_thumb.jpg' /></a>\\n   <a href='image3.html'>Name: My image 3 <br /><img src='image3_thumb.jpg' /></a>\\n   <a href='image4.html'>Name: My image 4 <br /><img src='image4_thumb.jpg' /></a>\\n   <a href='image5.html'>Name: My image 5 <br /><img src='image5_thumb.jpg' /></a>\\n  </div>\\n </body>\\n</html>\\n\\n\"\n```\n\n### XPath选择器\n\n进入 `Scrapy Shell` 之后，我们将主要操作 `response` 变量来进行解析。因为我们解析的是 `HTML` `代码，Selector` 将自动使用 `HTML`语法来分析。 `response` 有一个属性 `selector`，我们调用 `response.selector` 返回的内容就相当于用 `response` 的 `text` 构造了一个 `Selector` 对象。通过这个 `Selector` 对象我们可以调用解析方法如 `xpath、css` 等，通过向方法传入 `XPath`或 `CSS` 选择器参数就可以实现信息的提取。 我们用一个实例感受一下，如下所示：\n\n```python\nIn [4]: response.selector\nOut[4]: <Selector xpath=None data='<html>\\n <head>\\n  <base href=\"http://e...'>\n\nIn [6]: result = response.selector.xpath(\"//a\")\n\nIn [7]: result\nOut[7]: \n[<Selector xpath='//a' data='<a href=\"image1.html\">Name: My image ...'>,\n <Selector xpath='//a' data='<a href=\"image2.html\">Name: My image ...'>,\n <Selector xpath='//a' data='<a href=\"image3.html\">Name: My image ...'>,\n <Selector xpath='//a' data='<a href=\"image4.html\">Name: My image ...'>,\n <Selector xpath='//a' data='<a href=\"image5.html\">Name: My image ...'>]\n```\n\n打印结果的形式是 `Selector` 组成的列表，其实它是 `SelectorList` 类型， `SelectorList` 和 `Selector` 都可以继续调用 `xpath` 和 `css` 等方法来进一步提取数据。 在上面的例子中，我们提取了 `a` 节点。接下来，我们尝试继续调用 `xpath` 方法来提取 `a` 节点内包含的 `img` 节点，如下所示：\n\n```python\nIn [8]: result.xpath(\"./img\")\nOut[8]: \n[<Selector xpath='./img' data='<img src=\"image1_thumb.jpg\">'>,\n <Selector xpath='./img' data='<img src=\"image2_thumb.jpg\">'>,\n <Selector xpath='./img' data='<img src=\"image3_thumb.jpg\">'>,\n <Selector xpath='./img' data='<img src=\"image4_thumb.jpg\">'>,\n <Selector xpath='./img' data='<img src=\"image5_thumb.jpg\">'>]\n ```\n\n我们获得了 `a` 节点里面的所有 `img`节点，结果为 `5`。\n\n选择器的最前方加 `.（点）`，这代表提取元素内部的数据，如果没有加点，则代表从根节点开始提取。此处我们用了 `./img`的提取方式，则代表从 `a` 节点里进行提取。如果此处我们用 `//img`，则还 是从 `html节点`里进行提取。 \n\n我们刚才使用了 `response.selector.xpath`方法对数据进行了提取。`Scrapy`提供了两个实用的快捷方法，`response.xpath`和 `response.css`，它们二者的功能完全等同于 `response.selector.xpath`和 `response.selector.css`。方便起 见，后面我们统一直接调用 `response` 的 `xpath`和 `css` 方法进行选择。 现在我们得到的是 `SelectorList` 类型的变量，该变量是由 `Selector` 对象组成的列表。我们可以用索引单独取出其中某个 `Selector` 元素，如下所示：\n\n```python\nIn [9]: result[0]\nOut[9]: <Selector xpath='//a' data='<a href=\"image1.html\">Name: My image ...'>\n```\n可以像操作列表一样操作这个 `SelectorList` 。但是现在获取的内容是 `Selector` 或者 `SelectorList` 类型，并不是真正的文本内容。那么具体的内容怎么提取呢？ 比如我们现在想提取出 `a` 节点元素，就可以利用 `extract` 方法，如下所示：\n\n```python\nIn [10]: result[0].extract()\nOut[10]: '<a href=\"image1.html\">Name: My image 1 <br><img src=\"image1_thumb.jpg\"></a>'\n```\n\n这里使用了 `extract` 方法，我们就可以把真实需要的内容获取下来。\n\n还可以改写 `XPath` 表达式，来选取节点的内部文本和属性，如下所示：\n\n```python\nIn [11]: response.xpath('//a/text()').extract()\nOut[11]: \n['Name: My image 1 ',\n 'Name: My image 2 ',\n 'Name: My image 3 ',\n 'Name: My image 4 ',\n 'Name: My image 5 ']\n\nIn [12]: response.xpath('//a/@href').extract()\nOut[12]: ['image1.html', 'image2.html', 'image3.html', 'image4.html', 'image5.html']\n```\n\n只需要再加一层` /text()` 就可以获取节点的内部文本，或者加一层 `/@href`就可以获取节点的 `href属性`。其中，`@` 符号后面内容就是要获取的属性名称。\n\n现在我们可以用一个规则把所有符合要求的节点都获取下来，返回的类型是列表类型。\n \n但是这里有一个问题：如果符合要求的节点只有一个，那么返回的结果会是什么呢？我们再用一个实例来感受一下，如下所示：\n\n```python\nIn [13]: response.xpath('//a[@href=\"image1.html\"]/text()').extract()\nOut[13]: ['Name: My image 1 ']\n```\n\n用属性限制了匹配的范围，使 `XPath`只可以匹配到一个元素。然后用 `extract` 方法提取结果，其结果还是一个列表形式，其文本是列表的第一个元素。但很多情况下，我们其实想要的数据就是第一个元素内容，这里我们通过加一个索引来获取，如下所示： \n\n```python\n'Name: My image 1 ' \n```\n\n但是，这个写法很明显是有风险的。一旦 `XPath`有问题，那么 `extract` 后的结果可能是一个空列表。如果我们再用索引来获取，那不就可能会导致数组越界吗？ 所以，另外一个方法可以专门提取单个元素，它叫作 `extract_first`。我们可以改写上面的例子如下所示：\n\n```python\nIn [14]: response.xpath('//a[@href=\"image1.html\"]/text()').extract_first()\nOut[14]: 'Name: My image 1 '\n```\n\n直接利用 `extract_first` 方法将匹配的第一个结果提取出来，同时我们也不用担心数组越界的问题。也可以给`extract_first()`传递一个默认值，找不到的话会使用默认值。\n\n### CSS 选择器 \n\n接下来，我们看看 `CSS` 选择器的用法。`Scrapy`的选择器同时还对接了 `CSS` 选择器，使用 `response.css()` 方法可以使用 `CSS` 选择器来选择对应的元素。\n\n例如在上文我们选取了所有的 `a` 节点，那么 `CSS` 选择器同样可以做到，如下所示：\n\n```python\nIn [15]: response.css('a')\nOut[15]: \n[<Selector xpath='descendant-or-self::a' data='<a href=\"image1.html\">Name: My image ...'>,\n <Selector xpath='descendant-or-self::a' data='<a href=\"image2.html\">Name: My image ...'>,\n <Selector xpath='descendant-or-self::a' data='<a href=\"image3.html\">Name: My image ...'>,\n <Selector xpath='descendant-or-self::a' data='<a href=\"image4.html\">Name: My image ...'>,\n <Selector xpath='descendant-or-self::a' data='<a href=\"image5.html\">Name: My image ...'>]\n```\n\n同样，调用 `extract` 方法就可以提取出节点，如下所示：\n\n```python\nIn [16]: response.css('a').extract()\nOut[16]: \n['<a href=\"image1.html\">Name: My image 1 <br><img src=\"image1_thumb.jpg\"></a>',\n '<a href=\"image2.html\">Name: My image 2 <br><img src=\"image2_thumb.jpg\"></a>',\n '<a href=\"image3.html\">Name: My image 3 <br><img src=\"image3_thumb.jpg\"></a>',\n '<a href=\"image4.html\">Name: My image 4 <br><img src=\"image4_thumb.jpg\"></a>',\n '<a href=\"image5.html\">Name: My image 5 <br><img src=\"image5_thumb.jpg\"></a>']\n```\n\n用法和 `XPath选择`是完全一样的。另外，我们也可以进行属性选择和嵌套选择，如下所示：\n\n```python\nIn [17]: response.css('a[href=\"image4.html\"]').extract()\nOut[17]: ['<a href=\"image4.html\">Name: My image 4 <br><img src=\"image4_thumb.jpg\"></a>']\nIn [18]: response.css('a[href=\"image4.html\"] img').extract()\nOut[18]: ['<img src=\"image4_thumb.jpg\">']\n```\n\n也可以使用 `extract_first()` 方法提取列表的第一个元素，如下所示：\n\n```python\nIn [19]: response.css('a[href=\"image4.html\"] img').extract_first()\nOut[19]: '<img src=\"image4_thumb.jpg\">'\n```\n\n接下来的两个用法不太一样。节点的内部文本和属性的获取是这样实现的，如下所示：\n\n```python\nIn [21]: response.css('a[href=\"image4.html\"]::text').extract_first()\nOut[21]: 'Name: My image 4 '\nIn [22]: response.css('a[href=\"image4.html\"] img::attr(src)').extract_first()\nOut[22]: 'image4_thumb.jpg'\n```\n\n获取文本和属性需要用 `::text` 和 `::attr()` 的写法。而其他库如 `BeautifulSoup` 或 `PyQuery` 都有单独的方法。\n\n`CSS 选择器`和 `XPath选择器`一样可以嵌套选择。我们可以先用 `XPath选择器`选中所有 `a` 节点，再利用 `CSS 选择器`选中 `img节点`，再用 `XPath选择器`获取属性。我们用一个实例来感受一下，如下所示：\n\n```python\nIn [23]: response.xpath('//a').css('img').xpath('@src')\nOut[23]: \n[<Selector xpath='@src' data='image1_thumb.jpg'>,\n <Selector xpath='@src' data='image2_thumb.jpg'>,\n <Selector xpath='@src' data='image3_thumb.jpg'>,\n <Selector xpath='@src' data='image4_thumb.jpg'>,\n <Selector xpath='@src' data='image5_thumb.jpg'>]\nIn [24]: response.xpath('//a').css('img').xpath('@src').extract_first()\nOut[24]: 'image1_thumb.jpg'\n```\n\n可以随意使用 `xpath` 和 `css` 方法二者自由组合实现嵌套查询，二者是完全兼容的。\n\n### 正则匹配\n\n`Scrapy`的选择器还支持正则匹配。比如，在示例的 `a` 节点中的文本类似于 `Name:My image 1`，现在我们只想把 `Name:`后面的内容提取出来，这时就可以借助 `re` 方法，实现如下：\n\n```python\nIn [27]: response.xpath('//a/text()').re('\\s(.*):\\s(.*)')\nOut[27]: ['My image 1 ', 'My image 2 ', 'My image 3 ', 'My image 4 ', 'My image 5 ']\n```\n\n给 `re` 方法传入一个正则表达式，其中 `(.*)` 就是要匹配的内容，输出的结果就是正则表达式匹配的分组，结果会依次输出。 如果同时存在两个分组，那么结果依然会被按序输出，如下所示：\n\n```python\nIn [32]: response.xpath('//a/text()').re('(.*?):\\s(.*)')\nOut[32]: \n['Name',\n 'My image 1 ',\n 'Name',\n 'My image 2 ',\n 'Name',\n 'My image 3 ',\n 'Name',\n 'My image 4 ',\n 'Name',\n 'My image 5 ']\n```\n\n类似 `extract_first` 方法，`re_first` 方法可以选取列表的第一个元素，用法如下：\n\n```python\nIn [35]: response.xpath('//a/text()').re_first('(.*?):\\s(.*)')\nOut[35]: 'Name'\n```\n\n不论正则匹配了几个分组，结果都会等于列表的第一个元素。 值得注意的是， `response` 对象不能直接调用 `re` 和 `re_first` 方法。如果想要对全文进行正则匹配，可以先调用 `xpath` 方法然后再进行正则匹配，如下所示：\n\n```python\nIn [36]: response.xpath('.').re('Name:\\s(.*)<br>')\nOut[36]: ['My image 1 ', 'My image 2 ', 'My image 3 ', 'My image 4 ', 'My image 5 ']\n\nIn [37]:  response.xpath('.').re_first('Name:\\s(.*)<br>')\nOut[37]: 'My image 1 \n```\n\n[//]:#(设置表格整体居中显示)\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","slug":"spider的用法","published":1,"updated":"2021-06-15T15:47:31.601Z","layout":"post","photos":[],"link":"","_id":"ckq14rx3y007m44ud459u6xz1","content":"<h2 id=\"Spider-的用法\"><a href=\"#Spider-的用法\" class=\"headerlink\" title=\"Spider 的用法\"></a>Spider 的用法</h2><p>在 <code>Scrapy</code> 中，要抓取网站的链接配置、抓取逻辑、解析逻辑等其实都是在 <code>Spider</code> 中配置的。</p>\n<h3 id=\"Spider运行流程\"><a href=\"#Spider运行流程\" class=\"headerlink\" title=\"Spider运行流程\"></a>Spider运行流程</h3><p>在实现 <code>Scrapy</code> 爬虫项目时，最核心的类便是 <code>Spider</code> 类了，它定义了如何爬取某个网站的流程和解析方式。简单来讲， <code>Spider</code> 要做的事就是如下两件： </p>\n<ul>\n<li>定义爬取网站的动作； </li>\n<li>分析爬取下来的网页。 </li>\n</ul>\n<p>对于 <code>Spider</code> 类来说，整个爬取循环如下所述。 </p>\n<ul>\n<li>以初始的 <code>URL</code> 初始化 <code>Request</code> ，并设置回调函数。 当</li>\n<li>该 <code>Request</code> 成功请求并返回时，将生成 <code>Response</code> ，并作为参数传给该回调函数。 </li>\n<li>在回调函数内分析返回的网页内容。返回结果可以有两种形式，一种是解析到的有效结果返回字典或 <code>Item</code> 对象。下一步可经过处理后（或直接）保存，另一种是解析到的下一个（如下一页）链接，可以 利用此链接构造 <code>Request</code> 并设置新的回调函数，返回 <code>Request</code> 。 </li>\n<li>如果返回的是字典或 <code>Item</code> 对象，可通过 <code>Feed Exports</code> 等形式存入文件，如果设置了 <code>Pipeline</code> 的话，可以经由 <code>Pipeline</code> 处理（如过滤、修正等）并保存。 </li>\n<li>如果返回的是 <code>Reqeust</code> ，那么 <code>Request</code> 执行成功得到 <code>Response</code> 之后会再次传递给 <code>Request</code> 中定义的回调函数，可以再次使用选择器来分析新得到的网页内容，并根据分析的数据生成 <code>Item</code> 。 通过以上几步循环往复进行，便完成了站点的爬取。</li>\n</ul>\n<h3 id=\"Spider类分析\"><a href=\"#Spider类分析\" class=\"headerlink\" title=\"Spider类分析\"></a>Spider类分析</h3><p><code>Spider</code> 继承自 <code>scrapy.spiders.Spider</code> ，这个类是最简单最基本的 <code>Spider</code> 类，每个其他的 <code>Spider</code> 必须继承自这个类，还有后面要说明的一些特殊 <code>Spider</code> 类也都是继承自它。 这个类里提供了 <code>start_requests</code> 方法的默认实现，读取并请求 <code>start_urls</code> 属性，并根据返回的结果调用 <code>parse</code> 方法解析结果。另外它还有一些基础属性，下面对其进行讲解。</p>\n<ul>\n<li><code>name</code> ：爬虫名称，是定义 <code>Spider</code> 名字的字符串。Spider 的名字定义了 Scrapy如何定位并初始化 Spider，所以其必须是唯一的。 不过我们可以生成多个相同的 Spider 实例，这没有任何限制。 name 是 Spider 最重要的属性，而且是必需的。如果该 Spider 爬取单个网站，一个常见的做法是以该网站的域名名称来命名 Spider。例如，如果 Spider 爬取 mywebsite.com，该 Spider 通常会被命名为 mywebsite。 </li>\n<li>allowed_domains：允许爬取的域名，是可选配置，不在此范围的链接不会被跟进爬取。 </li>\n<li><code>start_urls</code> ：起始 <code>URL</code> 列表，当我们没有实现 <code>start_requests</code> 方法时，默认会从这个列表开始抓取。 </li>\n<li><code>custom_settings</code> ：这是一个字典，是专属于本 <code>Spider</code> 的配置，此设置会覆盖项目全局的设置，而且此设置必须在初始化前被更新，所以它必须定义成类变量。 </li>\n<li><code>crawler</code> ：此属性是由 <code>from_crawler</code> 方法设置的，代表的是本 <code>Spider</code> 类对应的 <code>Crawler</code> 对象， <code>Crawler</code> 对象中包含了很多项目组件，利用它我们可以获取项目的一些配置信息，如最常见的就是获取项目的设置信息，即 <code>Settings</code> 。 </li>\n<li><code>settings</code> ：是一个 <code>Settings</code> 对象，利用它我们可以直接获取项目的全局设置变量。 </li>\n</ul>\n<p>除了一些基础属性， <code>Spider</code> 还有一些常用的方法，在此介绍如下。 </p>\n<ul>\n<li><code>start_requests</code> ：此方法用于生成初始请求，它必须返回一个可迭代对象，此方法会默认使用 <code>start_urls</code> 里面的 <code>URL</code> 来构造 <code>Request</code> ，而且 <code>Request</code> 是 <code>GET</code> 请求方式。如果我们想在启动时以 <code>POST</code> 方式访问某个 站点，可以直接重写这个方法，发送 <code>POST</code> 请求时我们使用 <code>FormRequest</code> 即可。 </li>\n<li><code>parse</code> ：当 <code>Response</code> 没有指定回调函数时，该方法会默认被调用，它负责处理 <code>Response</code> ，处理返回结果，并从中提取出想要的数据和下一步的请求，然后返回。该方法需要返回一个包含 <code>Request</code> 或 <code>Item</code> 的可迭代对象。 </li>\n<li><code>closed</code> ：当 <code>Spider</code> 关闭时，该方法会被调用，在这里一般会定义释放资源的一些操作或其他收尾操作。</li>\n</ul>\n<h2 id=\"Selector-的用法\"><a href=\"#Selector-的用法\" class=\"headerlink\" title=\"Selector 的用法\"></a>Selector 的用法</h2><p><code>Scrapy</code> 还提供了自己的数据提取方法，即 <code>Selector（选择器）</code> 。 <code>Selector</code> 是基于 <code>lxml</code> 构建的，支持 <code>XPath选择器</code> 、 <code>CSS选择器</code> ，以及 <code>正则表达式</code> ，功能全面，解析速度和准确度非常高。</p>\n<h3 id=\"直接使用\"><a href=\"#直接使用\" class=\"headerlink\" title=\"直接使用\"></a>直接使用</h3><p><code>Selector</code> 是一个可以独立使用的模块。我们可以直接利用 <code>Selector</code> 这个类来构建一个选择器对象，然后调用它的相关方法如 <code>xpath、css</code> 等来提取数据。 </p>\n<p>例如，针对一段 HTML代码，我们可以用如下方式构建 <code>Selector</code> 对象来提取数据： </p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> scrapy <span class=\"keyword\">import</span> Selector</span><br><span class=\"line\"></span><br><span class=\"line\">body = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;html&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;head&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;title&gt;Hello World&lt;/title&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/head&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;body&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/body&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/html&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">selectot = Selector(text=body)</span><br><span class=\"line\">title = selectot.xpath(<span class=\"string\">&quot;//title/text()&quot;</span>).extract_first()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(title)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Hello World </span></span><br></pre></td></tr></table></figure>\n\n<p>这里我们没有在 <code>Scrapy</code> 框架中运行，而是把 <code>Scrapy</code> 中的 <code>Selector</code> 单独拿出来使用了，构建的时候传入 <code>text</code> 参数，就生成了一个 <code>Selector</code> 选择器对象，然后就可以像前面我们所用的 <code>Scrapy</code> 中的解析方式一样，调用 <code>xpath、css</code> 等方法来提取了。 在这里我们查找的是源代码中的 <code>title</code> 中的文本，在 <code>XPath选择器</code> 最后加 <code>text</code> 方法就可以实现文本的提取了。</p>\n<h3 id=\"Scrapy-Shell\"><a href=\"#Scrapy-Shell\" class=\"headerlink\" title=\"Scrapy Shell\"></a>Scrapy Shell</h3><p>由于 <code>Selector</code> 主要是与 <code>Scrapy</code> 结合使用，如 <code>Scrapy</code> 的回调函数中的参数 <code>response</code> 直接调用 <code>xpath()</code> 或者 <code>css()</code> 方法来提取数据，所以在这里我们借助 <code>Scrapy Shell</code> 来模拟 <code>Scrapy</code> 请求的过程，来讲解相关的提取方法。</p>\n<p>我们用官方文档的一个样例页面来做演示：<a href=\"http://doc.scrapy.org/en/latest/_static/selectors-sample1.html\">http://doc.scrapy.org/en/latest/_static/selectors-sample1.html</a>。 </p>\n<p>开启 <code>Scrapy Shell</code>，在命令行中输入如下命令： </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy shell http://doc.scrapy.org/en/latest/_static/selectors-sample1.html</span><br></pre></td></tr></table></figure>\n\n<p>这样我们就进入了 <code>Scrapy Shell</code> 模式。这个过程其实是 <code>Scrapy</code> 发起了一次请求，请求的 <code>URL</code> 就是刚才命令行下输入的 <code>URL</code> ，然后把一些可操作的变量传递给我们，如 <code>request、response</code> 等。</p>\n<p>输出结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\Users\\espho\\PycharmProjects\\PythonProjs\\python模块\\Scrapy框架&gt;scrapy shell http://doc.scrapy.org/en/latest/_static/selectors-sample1.html</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.utils.log] INFO: Scrapy <span class=\"number\">2.5</span><span class=\"number\">.0</span> started (bot: scrapybot)</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.utils.log] INFO: Versions: lxml <span class=\"number\">4.6</span><span class=\"number\">.3</span><span class=\"number\">.0</span>, libxml2 <span class=\"number\">2.9</span><span class=\"number\">.5</span>, cssselect <span class=\"number\">1.1</span><span class=\"number\">.0</span>, parsel <span class=\"number\">1.6</span><span class=\"number\">.0</span>, w3lib <span class=\"number\">1.22</span><span class=\"number\">.0</span>, Twisted <span class=\"number\">21.2</span><span class=\"number\">.0</span>, Python <span class=\"number\">3.8</span><span class=\"number\">.7</span> (tags/v3<span class=\"number\">.8</span><span class=\"number\">.7</span>:6503f05, Dec <span class=\"number\">21</span> <span class=\"number\">2020</span>, <span class=\"number\">17</span>:<span class=\"number\">59</span>:<span class=\"number\">51</span>) [MSC v<span class=\"number\">.1928</span> <span class=\"number\">64</span> bit (AMD64)], pyOpenSSL <span class=\"number\">20.0</span><span class=\"number\">.1</span> (OpenSSL <span class=\"number\">1.1</span><span class=\"number\">.1</span>k  <span class=\"number\">25</span> Mar <span class=\"number\">2021</span>), cryptography <span class=\"number\">3.4</span><span class=\"number\">.7</span>, Platform Windows-<span class=\"number\">10</span>-<span class=\"number\">10.0</span><span class=\"number\">.19041</span>-SP0</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.utils.log] DEBUG: Using reactor: twisted.internet.selectreactor.SelectReactor</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.crawler] INFO: Overridden settings:</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;DUPEFILTER_CLASS&#x27;</span>: <span class=\"string\">&#x27;scrapy.dupefilters.BaseDupeFilter&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;LOGSTATS_INTERVAL&#x27;</span>: <span class=\"number\">0</span>&#125;</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.extensions.telnet] INFO: Telnet Password: b22034a15ef07be9</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.middleware] INFO: Enabled extensions:</span><br><span class=\"line\">[<span class=\"string\">&#x27;scrapy.extensions.corestats.CoreStats&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.extensions.telnet.TelnetConsole&#x27;</span>]</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.middleware] INFO: Enabled downloader middlewares:</span><br><span class=\"line\">[<span class=\"string\">&#x27;scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.useragent.UserAgentMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.retry.RetryMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.redirect.RedirectMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.cookies.CookiesMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.stats.DownloaderStats&#x27;</span>]</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.middleware] INFO: Enabled spider middlewares:</span><br><span class=\"line\">[<span class=\"string\">&#x27;scrapy.spidermiddlewares.httperror.HttpErrorMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.spidermiddlewares.offsite.OffsiteMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.spidermiddlewares.referer.RefererMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.spidermiddlewares.urllength.UrlLengthMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.spidermiddlewares.depth.DepthMiddleware&#x27;</span>]</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.middleware] INFO: Enabled item pipelines:</span><br><span class=\"line\">[]</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.extensions.telnet] INFO: Telnet console listening on <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">6023</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.core.engine] INFO: Spider opened</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:03 [scrapy.downloadermiddlewares.redirect] DEBUG: Redirecting (<span class=\"number\">302</span>) to &lt;GET https://doc.scrapy.org/en/latest/_static/selectors-sample1.html&gt; <span class=\"keyword\">from</span> &lt;GET http://doc.scrapy.org/en/latest/_static/selectors-sample1.html&gt;</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:04 [scrapy.core.engine] DEBUG: Crawled (<span class=\"number\">200</span>) &lt;GET https://doc.scrapy.org/en/latest/_static/selectors-sample1.html&gt; (referer: <span class=\"literal\">None</span>)</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:06 [asyncio] DEBUG: Using proactor: IocpProactor</span><br><span class=\"line\">[s] Available Scrapy objects:</span><br><span class=\"line\">[s]   scrapy     scrapy module (contains scrapy.Request, scrapy.Selector, etc)</span><br><span class=\"line\">[s]   crawler    &lt;scrapy.crawler.Crawler <span class=\"built_in\">object</span> at <span class=\"number\">0x0000010ADFBBE220</span>&gt;</span><br><span class=\"line\">[s]   item       &#123;&#125;</span><br><span class=\"line\">[s]   request    &lt;GET http://doc.scrapy.org/en/latest/_static/selectors-sample1.html&gt;</span><br><span class=\"line\">[s]   response   &lt;<span class=\"number\">200</span> https://doc.scrapy.org/en/latest/_static/selectors-sample1.html&gt;</span><br><span class=\"line\">[s]   settings   &lt;scrapy.settings.Settings <span class=\"built_in\">object</span> at <span class=\"number\">0x0000010ADFBBE2B0</span>&gt;</span><br><span class=\"line\">[s]   spider     &lt;DefaultSpider <span class=\"string\">&#x27;default&#x27;</span> at <span class=\"number\">0x10ae002fdc0</span>&gt;</span><br><span class=\"line\">[s] Useful shortcuts:</span><br><span class=\"line\">[s]   fetch(url[, redirect=<span class=\"literal\">True</span>]) Fetch URL <span class=\"keyword\">and</span> update local objects (by default, redirects are followed)</span><br><span class=\"line\">[s]   fetch(req)                  Fetch a scrapy.Request <span class=\"keyword\">and</span> update local objects</span><br><span class=\"line\">[s]   shelp()           Shell <span class=\"built_in\">help</span> (<span class=\"built_in\">print</span> this <span class=\"built_in\">help</span>)</span><br><span class=\"line\">[s]   view(response)    View response <span class=\"keyword\">in</span> a browser</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:06 [asyncio] DEBUG: Using proactor: IocpProactor</span><br><span class=\"line\">In [<span class=\"number\">1</span>]: </span><br></pre></td></tr></table></figure>\n\n<p>可以在命令行模式下输入命令调用对象的一些操作方法，回车之后实时显示结果。这与 <code>Python</code> 的命令行交互模式是类似的。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">2</span>]: response.url</span><br><span class=\"line\">Out[<span class=\"number\">2</span>]: <span class=\"string\">&#x27;https://doc.scrapy.org/en/latest/_static/selectors-sample1.html&#x27;</span></span><br><span class=\"line\">In [<span class=\"number\">3</span>]: response.text</span><br><span class=\"line\">Out[<span class=\"number\">3</span>]: <span class=\"string\">&quot;&lt;html&gt;\\n &lt;head&gt;\\n  &lt;base href=&#x27;http://example.com/&#x27; /&gt;\\n  &lt;title&gt;Example website&lt;/title&gt;\\n &lt;/head&gt;\\n &lt;body&gt;\\n  &lt;div id=&#x27;images&#x27;&gt;\\n   &lt;a href=&#x27;image1.html&#x27;&gt;Name: My image 1 &lt;br /&gt;&lt;img src=&#x27;image1_thumb.jpg&#x27; /&gt;&lt;/a&gt;\\n   &lt;a href=&#x27;image2.html&#x27;&gt;Name: My image 2 &lt;br /&gt;&lt;img src=&#x27;image2_thumb.jpg&#x27; /&gt;&lt;/a&gt;\\n   &lt;a href=&#x27;image3.html&#x27;&gt;Name: My image 3 &lt;br /&gt;&lt;img src=&#x27;image3_thumb.jpg&#x27; /&gt;&lt;/a&gt;\\n   &lt;a href=&#x27;image4.html&#x27;&gt;Name: My image 4 &lt;br /&gt;&lt;img src=&#x27;image4_thumb.jpg&#x27; /&gt;&lt;/a&gt;\\n   &lt;a href=&#x27;image5.html&#x27;&gt;Name: My image 5 &lt;br /&gt;&lt;img src=&#x27;image5_thumb.jpg&#x27; /&gt;&lt;/a&gt;\\n  &lt;/div&gt;\\n &lt;/body&gt;\\n&lt;/html&gt;\\n\\n&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"XPath选择器\"><a href=\"#XPath选择器\" class=\"headerlink\" title=\"XPath选择器\"></a>XPath选择器</h3><p>进入 <code>Scrapy Shell</code> 之后，我们将主要操作 <code>response</code> 变量来进行解析。因为我们解析的是 <code>HTML</code> <code>代码，Selector</code> 将自动使用 <code>HTML</code>语法来分析。 <code>response</code> 有一个属性 <code>selector</code>，我们调用 <code>response.selector</code> 返回的内容就相当于用 <code>response</code> 的 <code>text</code> 构造了一个 <code>Selector</code> 对象。通过这个 <code>Selector</code> 对象我们可以调用解析方法如 <code>xpath、css</code> 等，通过向方法传入 <code>XPath</code>或 <code>CSS</code> 选择器参数就可以实现信息的提取。 我们用一个实例感受一下，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">4</span>]: response.selector</span><br><span class=\"line\">Out[<span class=\"number\">4</span>]: &lt;Selector xpath=<span class=\"literal\">None</span> data=<span class=\"string\">&#x27;&lt;html&gt;\\n &lt;head&gt;\\n  &lt;base href=&quot;http://e...&#x27;</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">6</span>]: result = response.selector.xpath(<span class=\"string\">&quot;//a&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">7</span>]: result</span><br><span class=\"line\">Out[<span class=\"number\">7</span>]: </span><br><span class=\"line\">[&lt;Selector xpath=<span class=\"string\">&#x27;//a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image1.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;//a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image2.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;//a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image3.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;//a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image4.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;//a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image5.html&quot;&gt;Name: My image ...&#x27;</span>&gt;]</span><br></pre></td></tr></table></figure>\n\n<p>打印结果的形式是 <code>Selector</code> 组成的列表，其实它是 <code>SelectorList</code> 类型， <code>SelectorList</code> 和 <code>Selector</code> 都可以继续调用 <code>xpath</code> 和 <code>css</code> 等方法来进一步提取数据。 在上面的例子中，我们提取了 <code>a</code> 节点。接下来，我们尝试继续调用 <code>xpath</code> 方法来提取 <code>a</code> 节点内包含的 <code>img</code> 节点，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">8</span>]: result.xpath(<span class=\"string\">&quot;./img&quot;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">8</span>]: </span><br><span class=\"line\">[&lt;Selector xpath=<span class=\"string\">&#x27;./img&#x27;</span> data=<span class=\"string\">&#x27;&lt;img src=&quot;image1_thumb.jpg&quot;&gt;&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;./img&#x27;</span> data=<span class=\"string\">&#x27;&lt;img src=&quot;image2_thumb.jpg&quot;&gt;&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;./img&#x27;</span> data=<span class=\"string\">&#x27;&lt;img src=&quot;image3_thumb.jpg&quot;&gt;&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;./img&#x27;</span> data=<span class=\"string\">&#x27;&lt;img src=&quot;image4_thumb.jpg&quot;&gt;&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;./img&#x27;</span> data=<span class=\"string\">&#x27;&lt;img src=&quot;image5_thumb.jpg&quot;&gt;&#x27;</span>&gt;]</span><br></pre></td></tr></table></figure>\n\n<p>我们获得了 <code>a</code> 节点里面的所有 <code>img</code>节点，结果为 <code>5</code>。</p>\n<p>选择器的最前方加 <code>.（点）</code>，这代表提取元素内部的数据，如果没有加点，则代表从根节点开始提取。此处我们用了 <code>./img</code>的提取方式，则代表从 <code>a</code> 节点里进行提取。如果此处我们用 <code>//img</code>，则还 是从 <code>html节点</code>里进行提取。 </p>\n<p>我们刚才使用了 <code>response.selector.xpath</code>方法对数据进行了提取。<code>Scrapy</code>提供了两个实用的快捷方法，<code>response.xpath</code>和 <code>response.css</code>，它们二者的功能完全等同于 <code>response.selector.xpath</code>和 <code>response.selector.css</code>。方便起 见，后面我们统一直接调用 <code>response</code> 的 <code>xpath</code>和 <code>css</code> 方法进行选择。 现在我们得到的是 <code>SelectorList</code> 类型的变量，该变量是由 <code>Selector</code> 对象组成的列表。我们可以用索引单独取出其中某个 <code>Selector</code> 元素，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">9</span>]: result[<span class=\"number\">0</span>]</span><br><span class=\"line\">Out[<span class=\"number\">9</span>]: &lt;Selector xpath=<span class=\"string\">&#x27;//a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image1.html&quot;&gt;Name: My image ...&#x27;</span>&gt;</span><br></pre></td></tr></table></figure>\n<p>可以像操作列表一样操作这个 <code>SelectorList</code> 。但是现在获取的内容是 <code>Selector</code> 或者 <code>SelectorList</code> 类型，并不是真正的文本内容。那么具体的内容怎么提取呢？ 比如我们现在想提取出 <code>a</code> 节点元素，就可以利用 <code>extract</code> 方法，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">10</span>]: result[<span class=\"number\">0</span>].extract()</span><br><span class=\"line\">Out[<span class=\"number\">10</span>]: <span class=\"string\">&#x27;&lt;a href=&quot;image1.html&quot;&gt;Name: My image 1 &lt;br&gt;&lt;img src=&quot;image1_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>这里使用了 <code>extract</code> 方法，我们就可以把真实需要的内容获取下来。</p>\n<p>还可以改写 <code>XPath</code> 表达式，来选取节点的内部文本和属性，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">11</span>]: response.xpath(<span class=\"string\">&#x27;//a/text()&#x27;</span>).extract()</span><br><span class=\"line\">Out[<span class=\"number\">11</span>]: </span><br><span class=\"line\">[<span class=\"string\">&#x27;Name: My image 1 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name: My image 2 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name: My image 3 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name: My image 4 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name: My image 5 &#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">12</span>]: response.xpath(<span class=\"string\">&#x27;//a/@href&#x27;</span>).extract()</span><br><span class=\"line\">Out[<span class=\"number\">12</span>]: [<span class=\"string\">&#x27;image1.html&#x27;</span>, <span class=\"string\">&#x27;image2.html&#x27;</span>, <span class=\"string\">&#x27;image3.html&#x27;</span>, <span class=\"string\">&#x27;image4.html&#x27;</span>, <span class=\"string\">&#x27;image5.html&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>只需要再加一层<code> /text()</code> 就可以获取节点的内部文本，或者加一层 <code>/@href</code>就可以获取节点的 <code>href属性</code>。其中，<code>@</code> 符号后面内容就是要获取的属性名称。</p>\n<p>现在我们可以用一个规则把所有符合要求的节点都获取下来，返回的类型是列表类型。</p>\n<p>但是这里有一个问题：如果符合要求的节点只有一个，那么返回的结果会是什么呢？我们再用一个实例来感受一下，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">13</span>]: response.xpath(<span class=\"string\">&#x27;//a[@href=&quot;image1.html&quot;]/text()&#x27;</span>).extract()</span><br><span class=\"line\">Out[<span class=\"number\">13</span>]: [<span class=\"string\">&#x27;Name: My image 1 &#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>用属性限制了匹配的范围，使 <code>XPath</code>只可以匹配到一个元素。然后用 <code>extract</code> 方法提取结果，其结果还是一个列表形式，其文本是列表的第一个元素。但很多情况下，我们其实想要的数据就是第一个元素内容，这里我们通过加一个索引来获取，如下所示： </p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;Name: My image 1 &#x27;</span> </span><br></pre></td></tr></table></figure>\n\n<p>但是，这个写法很明显是有风险的。一旦 <code>XPath</code>有问题，那么 <code>extract</code> 后的结果可能是一个空列表。如果我们再用索引来获取，那不就可能会导致数组越界吗？ 所以，另外一个方法可以专门提取单个元素，它叫作 <code>extract_first</code>。我们可以改写上面的例子如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">14</span>]: response.xpath(<span class=\"string\">&#x27;//a[@href=&quot;image1.html&quot;]/text()&#x27;</span>).extract_first()</span><br><span class=\"line\">Out[<span class=\"number\">14</span>]: <span class=\"string\">&#x27;Name: My image 1 &#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>直接利用 <code>extract_first</code> 方法将匹配的第一个结果提取出来，同时我们也不用担心数组越界的问题。也可以给<code>extract_first()</code>传递一个默认值，找不到的话会使用默认值。</p>\n<h3 id=\"CSS-选择器\"><a href=\"#CSS-选择器\" class=\"headerlink\" title=\"CSS 选择器\"></a>CSS 选择器</h3><p>接下来，我们看看 <code>CSS</code> 选择器的用法。<code>Scrapy</code>的选择器同时还对接了 <code>CSS</code> 选择器，使用 <code>response.css()</code> 方法可以使用 <code>CSS</code> 选择器来选择对应的元素。</p>\n<p>例如在上文我们选取了所有的 <code>a</code> 节点，那么 <code>CSS</code> 选择器同样可以做到，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">15</span>]: response.css(<span class=\"string\">&#x27;a&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">15</span>]: </span><br><span class=\"line\">[&lt;Selector xpath=<span class=\"string\">&#x27;descendant-or-self::a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image1.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;descendant-or-self::a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image2.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;descendant-or-self::a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image3.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;descendant-or-self::a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image4.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;descendant-or-self::a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image5.html&quot;&gt;Name: My image ...&#x27;</span>&gt;]</span><br></pre></td></tr></table></figure>\n\n<p>同样，调用 <code>extract</code> 方法就可以提取出节点，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">16</span>]: response.css(<span class=\"string\">&#x27;a&#x27;</span>).extract()</span><br><span class=\"line\">Out[<span class=\"number\">16</span>]: </span><br><span class=\"line\">[<span class=\"string\">&#x27;&lt;a href=&quot;image1.html&quot;&gt;Name: My image 1 &lt;br&gt;&lt;img src=&quot;image1_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;&lt;a href=&quot;image2.html&quot;&gt;Name: My image 2 &lt;br&gt;&lt;img src=&quot;image2_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;&lt;a href=&quot;image3.html&quot;&gt;Name: My image 3 &lt;br&gt;&lt;img src=&quot;image3_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;&lt;a href=&quot;image4.html&quot;&gt;Name: My image 4 &lt;br&gt;&lt;img src=&quot;image4_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;&lt;a href=&quot;image5.html&quot;&gt;Name: My image 5 &lt;br&gt;&lt;img src=&quot;image5_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>用法和 <code>XPath选择</code>是完全一样的。另外，我们也可以进行属性选择和嵌套选择，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">17</span>]: response.css(<span class=\"string\">&#x27;a[href=&quot;image4.html&quot;]&#x27;</span>).extract()</span><br><span class=\"line\">Out[<span class=\"number\">17</span>]: [<span class=\"string\">&#x27;&lt;a href=&quot;image4.html&quot;&gt;Name: My image 4 &lt;br&gt;&lt;img src=&quot;image4_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>]</span><br><span class=\"line\">In [<span class=\"number\">18</span>]: response.css(<span class=\"string\">&#x27;a[href=&quot;image4.html&quot;] img&#x27;</span>).extract()</span><br><span class=\"line\">Out[<span class=\"number\">18</span>]: [<span class=\"string\">&#x27;&lt;img src=&quot;image4_thumb.jpg&quot;&gt;&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>也可以使用 <code>extract_first()</code> 方法提取列表的第一个元素，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">19</span>]: response.css(<span class=\"string\">&#x27;a[href=&quot;image4.html&quot;] img&#x27;</span>).extract_first()</span><br><span class=\"line\">Out[<span class=\"number\">19</span>]: <span class=\"string\">&#x27;&lt;img src=&quot;image4_thumb.jpg&quot;&gt;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>接下来的两个用法不太一样。节点的内部文本和属性的获取是这样实现的，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">21</span>]: response.css(<span class=\"string\">&#x27;a[href=&quot;image4.html&quot;]::text&#x27;</span>).extract_first()</span><br><span class=\"line\">Out[<span class=\"number\">21</span>]: <span class=\"string\">&#x27;Name: My image 4 &#x27;</span></span><br><span class=\"line\">In [<span class=\"number\">22</span>]: response.css(<span class=\"string\">&#x27;a[href=&quot;image4.html&quot;] img::attr(src)&#x27;</span>).extract_first()</span><br><span class=\"line\">Out[<span class=\"number\">22</span>]: <span class=\"string\">&#x27;image4_thumb.jpg&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>获取文本和属性需要用 <code>::text</code> 和 <code>::attr()</code> 的写法。而其他库如 <code>BeautifulSoup</code> 或 <code>PyQuery</code> 都有单独的方法。</p>\n<p><code>CSS 选择器</code>和 <code>XPath选择器</code>一样可以嵌套选择。我们可以先用 <code>XPath选择器</code>选中所有 <code>a</code> 节点，再利用 <code>CSS 选择器</code>选中 <code>img节点</code>，再用 <code>XPath选择器</code>获取属性。我们用一个实例来感受一下，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">23</span>]: response.xpath(<span class=\"string\">&#x27;//a&#x27;</span>).css(<span class=\"string\">&#x27;img&#x27;</span>).xpath(<span class=\"string\">&#x27;@src&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">23</span>]: </span><br><span class=\"line\">[&lt;Selector xpath=<span class=\"string\">&#x27;@src&#x27;</span> data=<span class=\"string\">&#x27;image1_thumb.jpg&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;@src&#x27;</span> data=<span class=\"string\">&#x27;image2_thumb.jpg&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;@src&#x27;</span> data=<span class=\"string\">&#x27;image3_thumb.jpg&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;@src&#x27;</span> data=<span class=\"string\">&#x27;image4_thumb.jpg&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;@src&#x27;</span> data=<span class=\"string\">&#x27;image5_thumb.jpg&#x27;</span>&gt;]</span><br><span class=\"line\">In [<span class=\"number\">24</span>]: response.xpath(<span class=\"string\">&#x27;//a&#x27;</span>).css(<span class=\"string\">&#x27;img&#x27;</span>).xpath(<span class=\"string\">&#x27;@src&#x27;</span>).extract_first()</span><br><span class=\"line\">Out[<span class=\"number\">24</span>]: <span class=\"string\">&#x27;image1_thumb.jpg&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>可以随意使用 <code>xpath</code> 和 <code>css</code> 方法二者自由组合实现嵌套查询，二者是完全兼容的。</p>\n<h3 id=\"正则匹配\"><a href=\"#正则匹配\" class=\"headerlink\" title=\"正则匹配\"></a>正则匹配</h3><p><code>Scrapy</code>的选择器还支持正则匹配。比如，在示例的 <code>a</code> 节点中的文本类似于 <code>Name:My image 1</code>，现在我们只想把 <code>Name:</code>后面的内容提取出来，这时就可以借助 <code>re</code> 方法，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">27</span>]: response.xpath(<span class=\"string\">&#x27;//a/text()&#x27;</span>).re(<span class=\"string\">&#x27;\\s(.*):\\s(.*)&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">27</span>]: [<span class=\"string\">&#x27;My image 1 &#x27;</span>, <span class=\"string\">&#x27;My image 2 &#x27;</span>, <span class=\"string\">&#x27;My image 3 &#x27;</span>, <span class=\"string\">&#x27;My image 4 &#x27;</span>, <span class=\"string\">&#x27;My image 5 &#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>给 <code>re</code> 方法传入一个正则表达式，其中 <code>(.*)</code> 就是要匹配的内容，输出的结果就是正则表达式匹配的分组，结果会依次输出。 如果同时存在两个分组，那么结果依然会被按序输出，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">32</span>]: response.xpath(<span class=\"string\">&#x27;//a/text()&#x27;</span>).re(<span class=\"string\">&#x27;(.*?):\\s(.*)&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">32</span>]: </span><br><span class=\"line\">[<span class=\"string\">&#x27;Name&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;My image 1 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;My image 2 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;My image 3 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;My image 4 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;My image 5 &#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>类似 <code>extract_first</code> 方法，<code>re_first</code> 方法可以选取列表的第一个元素，用法如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">35</span>]: response.xpath(<span class=\"string\">&#x27;//a/text()&#x27;</span>).re_first(<span class=\"string\">&#x27;(.*?):\\s(.*)&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">35</span>]: <span class=\"string\">&#x27;Name&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>不论正则匹配了几个分组，结果都会等于列表的第一个元素。 值得注意的是， <code>response</code> 对象不能直接调用 <code>re</code> 和 <code>re_first</code> 方法。如果想要对全文进行正则匹配，可以先调用 <code>xpath</code> 方法然后再进行正则匹配，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">36</span>]: response.xpath(<span class=\"string\">&#x27;.&#x27;</span>).re(<span class=\"string\">&#x27;Name:\\s(.*)&lt;br&gt;&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">36</span>]: [<span class=\"string\">&#x27;My image 1 &#x27;</span>, <span class=\"string\">&#x27;My image 2 &#x27;</span>, <span class=\"string\">&#x27;My image 3 &#x27;</span>, <span class=\"string\">&#x27;My image 4 &#x27;</span>, <span class=\"string\">&#x27;My image 5 &#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">37</span>]:  response.xpath(<span class=\"string\">&#x27;.&#x27;</span>).re_first(<span class=\"string\">&#x27;Name:\\s(.*)&lt;br&gt;&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">37</span>]: <span class=\"string\">&#x27;My image 1 </span></span><br></pre></td></tr></table></figure>\n\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Spider-的用法\"><a href=\"#Spider-的用法\" class=\"headerlink\" title=\"Spider 的用法\"></a>Spider 的用法</h2><p>在 <code>Scrapy</code> 中，要抓取网站的链接配置、抓取逻辑、解析逻辑等其实都是在 <code>Spider</code> 中配置的。</p>\n<h3 id=\"Spider运行流程\"><a href=\"#Spider运行流程\" class=\"headerlink\" title=\"Spider运行流程\"></a>Spider运行流程</h3><p>在实现 <code>Scrapy</code> 爬虫项目时，最核心的类便是 <code>Spider</code> 类了，它定义了如何爬取某个网站的流程和解析方式。简单来讲， <code>Spider</code> 要做的事就是如下两件： </p>\n<ul>\n<li>定义爬取网站的动作； </li>\n<li>分析爬取下来的网页。 </li>\n</ul>\n<p>对于 <code>Spider</code> 类来说，整个爬取循环如下所述。 </p>\n<ul>\n<li>以初始的 <code>URL</code> 初始化 <code>Request</code> ，并设置回调函数。 当</li>\n<li>该 <code>Request</code> 成功请求并返回时，将生成 <code>Response</code> ，并作为参数传给该回调函数。 </li>\n<li>在回调函数内分析返回的网页内容。返回结果可以有两种形式，一种是解析到的有效结果返回字典或 <code>Item</code> 对象。下一步可经过处理后（或直接）保存，另一种是解析到的下一个（如下一页）链接，可以 利用此链接构造 <code>Request</code> 并设置新的回调函数，返回 <code>Request</code> 。 </li>\n<li>如果返回的是字典或 <code>Item</code> 对象，可通过 <code>Feed Exports</code> 等形式存入文件，如果设置了 <code>Pipeline</code> 的话，可以经由 <code>Pipeline</code> 处理（如过滤、修正等）并保存。 </li>\n<li>如果返回的是 <code>Reqeust</code> ，那么 <code>Request</code> 执行成功得到 <code>Response</code> 之后会再次传递给 <code>Request</code> 中定义的回调函数，可以再次使用选择器来分析新得到的网页内容，并根据分析的数据生成 <code>Item</code> 。 通过以上几步循环往复进行，便完成了站点的爬取。</li>\n</ul>\n<h3 id=\"Spider类分析\"><a href=\"#Spider类分析\" class=\"headerlink\" title=\"Spider类分析\"></a>Spider类分析</h3><p><code>Spider</code> 继承自 <code>scrapy.spiders.Spider</code> ，这个类是最简单最基本的 <code>Spider</code> 类，每个其他的 <code>Spider</code> 必须继承自这个类，还有后面要说明的一些特殊 <code>Spider</code> 类也都是继承自它。 这个类里提供了 <code>start_requests</code> 方法的默认实现，读取并请求 <code>start_urls</code> 属性，并根据返回的结果调用 <code>parse</code> 方法解析结果。另外它还有一些基础属性，下面对其进行讲解。</p>\n<ul>\n<li><code>name</code> ：爬虫名称，是定义 <code>Spider</code> 名字的字符串。Spider 的名字定义了 Scrapy如何定位并初始化 Spider，所以其必须是唯一的。 不过我们可以生成多个相同的 Spider 实例，这没有任何限制。 name 是 Spider 最重要的属性，而且是必需的。如果该 Spider 爬取单个网站，一个常见的做法是以该网站的域名名称来命名 Spider。例如，如果 Spider 爬取 mywebsite.com，该 Spider 通常会被命名为 mywebsite。 </li>\n<li>allowed_domains：允许爬取的域名，是可选配置，不在此范围的链接不会被跟进爬取。 </li>\n<li><code>start_urls</code> ：起始 <code>URL</code> 列表，当我们没有实现 <code>start_requests</code> 方法时，默认会从这个列表开始抓取。 </li>\n<li><code>custom_settings</code> ：这是一个字典，是专属于本 <code>Spider</code> 的配置，此设置会覆盖项目全局的设置，而且此设置必须在初始化前被更新，所以它必须定义成类变量。 </li>\n<li><code>crawler</code> ：此属性是由 <code>from_crawler</code> 方法设置的，代表的是本 <code>Spider</code> 类对应的 <code>Crawler</code> 对象， <code>Crawler</code> 对象中包含了很多项目组件，利用它我们可以获取项目的一些配置信息，如最常见的就是获取项目的设置信息，即 <code>Settings</code> 。 </li>\n<li><code>settings</code> ：是一个 <code>Settings</code> 对象，利用它我们可以直接获取项目的全局设置变量。 </li>\n</ul>\n<p>除了一些基础属性， <code>Spider</code> 还有一些常用的方法，在此介绍如下。 </p>\n<ul>\n<li><code>start_requests</code> ：此方法用于生成初始请求，它必须返回一个可迭代对象，此方法会默认使用 <code>start_urls</code> 里面的 <code>URL</code> 来构造 <code>Request</code> ，而且 <code>Request</code> 是 <code>GET</code> 请求方式。如果我们想在启动时以 <code>POST</code> 方式访问某个 站点，可以直接重写这个方法，发送 <code>POST</code> 请求时我们使用 <code>FormRequest</code> 即可。 </li>\n<li><code>parse</code> ：当 <code>Response</code> 没有指定回调函数时，该方法会默认被调用，它负责处理 <code>Response</code> ，处理返回结果，并从中提取出想要的数据和下一步的请求，然后返回。该方法需要返回一个包含 <code>Request</code> 或 <code>Item</code> 的可迭代对象。 </li>\n<li><code>closed</code> ：当 <code>Spider</code> 关闭时，该方法会被调用，在这里一般会定义释放资源的一些操作或其他收尾操作。</li>\n</ul>\n<h2 id=\"Selector-的用法\"><a href=\"#Selector-的用法\" class=\"headerlink\" title=\"Selector 的用法\"></a>Selector 的用法</h2><p><code>Scrapy</code> 还提供了自己的数据提取方法，即 <code>Selector（选择器）</code> 。 <code>Selector</code> 是基于 <code>lxml</code> 构建的，支持 <code>XPath选择器</code> 、 <code>CSS选择器</code> ，以及 <code>正则表达式</code> ，功能全面，解析速度和准确度非常高。</p>\n<h3 id=\"直接使用\"><a href=\"#直接使用\" class=\"headerlink\" title=\"直接使用\"></a>直接使用</h3><p><code>Selector</code> 是一个可以独立使用的模块。我们可以直接利用 <code>Selector</code> 这个类来构建一个选择器对象，然后调用它的相关方法如 <code>xpath、css</code> 等来提取数据。 </p>\n<p>例如，针对一段 HTML代码，我们可以用如下方式构建 <code>Selector</code> 对象来提取数据： </p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> scrapy <span class=\"keyword\">import</span> Selector</span><br><span class=\"line\"></span><br><span class=\"line\">body = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;html&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;head&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;title&gt;Hello World&lt;/title&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/head&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;body&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/body&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/html&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">selectot = Selector(text=body)</span><br><span class=\"line\">title = selectot.xpath(<span class=\"string\">&quot;//title/text()&quot;</span>).extract_first()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(title)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Hello World </span></span><br></pre></td></tr></table></figure>\n\n<p>这里我们没有在 <code>Scrapy</code> 框架中运行，而是把 <code>Scrapy</code> 中的 <code>Selector</code> 单独拿出来使用了，构建的时候传入 <code>text</code> 参数，就生成了一个 <code>Selector</code> 选择器对象，然后就可以像前面我们所用的 <code>Scrapy</code> 中的解析方式一样，调用 <code>xpath、css</code> 等方法来提取了。 在这里我们查找的是源代码中的 <code>title</code> 中的文本，在 <code>XPath选择器</code> 最后加 <code>text</code> 方法就可以实现文本的提取了。</p>\n<h3 id=\"Scrapy-Shell\"><a href=\"#Scrapy-Shell\" class=\"headerlink\" title=\"Scrapy Shell\"></a>Scrapy Shell</h3><p>由于 <code>Selector</code> 主要是与 <code>Scrapy</code> 结合使用，如 <code>Scrapy</code> 的回调函数中的参数 <code>response</code> 直接调用 <code>xpath()</code> 或者 <code>css()</code> 方法来提取数据，所以在这里我们借助 <code>Scrapy Shell</code> 来模拟 <code>Scrapy</code> 请求的过程，来讲解相关的提取方法。</p>\n<p>我们用官方文档的一个样例页面来做演示：<a href=\"http://doc.scrapy.org/en/latest/_static/selectors-sample1.html\">http://doc.scrapy.org/en/latest/_static/selectors-sample1.html</a>。 </p>\n<p>开启 <code>Scrapy Shell</code>，在命令行中输入如下命令： </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scrapy shell http://doc.scrapy.org/en/latest/_static/selectors-sample1.html</span><br></pre></td></tr></table></figure>\n\n<p>这样我们就进入了 <code>Scrapy Shell</code> 模式。这个过程其实是 <code>Scrapy</code> 发起了一次请求，请求的 <code>URL</code> 就是刚才命令行下输入的 <code>URL</code> ，然后把一些可操作的变量传递给我们，如 <code>request、response</code> 等。</p>\n<p>输出结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\Users\\espho\\PycharmProjects\\PythonProjs\\python模块\\Scrapy框架&gt;scrapy shell http://doc.scrapy.org/en/latest/_static/selectors-sample1.html</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.utils.log] INFO: Scrapy <span class=\"number\">2.5</span><span class=\"number\">.0</span> started (bot: scrapybot)</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.utils.log] INFO: Versions: lxml <span class=\"number\">4.6</span><span class=\"number\">.3</span><span class=\"number\">.0</span>, libxml2 <span class=\"number\">2.9</span><span class=\"number\">.5</span>, cssselect <span class=\"number\">1.1</span><span class=\"number\">.0</span>, parsel <span class=\"number\">1.6</span><span class=\"number\">.0</span>, w3lib <span class=\"number\">1.22</span><span class=\"number\">.0</span>, Twisted <span class=\"number\">21.2</span><span class=\"number\">.0</span>, Python <span class=\"number\">3.8</span><span class=\"number\">.7</span> (tags/v3<span class=\"number\">.8</span><span class=\"number\">.7</span>:6503f05, Dec <span class=\"number\">21</span> <span class=\"number\">2020</span>, <span class=\"number\">17</span>:<span class=\"number\">59</span>:<span class=\"number\">51</span>) [MSC v<span class=\"number\">.1928</span> <span class=\"number\">64</span> bit (AMD64)], pyOpenSSL <span class=\"number\">20.0</span><span class=\"number\">.1</span> (OpenSSL <span class=\"number\">1.1</span><span class=\"number\">.1</span>k  <span class=\"number\">25</span> Mar <span class=\"number\">2021</span>), cryptography <span class=\"number\">3.4</span><span class=\"number\">.7</span>, Platform Windows-<span class=\"number\">10</span>-<span class=\"number\">10.0</span><span class=\"number\">.19041</span>-SP0</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.utils.log] DEBUG: Using reactor: twisted.internet.selectreactor.SelectReactor</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.crawler] INFO: Overridden settings:</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;DUPEFILTER_CLASS&#x27;</span>: <span class=\"string\">&#x27;scrapy.dupefilters.BaseDupeFilter&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;LOGSTATS_INTERVAL&#x27;</span>: <span class=\"number\">0</span>&#125;</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.extensions.telnet] INFO: Telnet Password: b22034a15ef07be9</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.middleware] INFO: Enabled extensions:</span><br><span class=\"line\">[<span class=\"string\">&#x27;scrapy.extensions.corestats.CoreStats&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.extensions.telnet.TelnetConsole&#x27;</span>]</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.middleware] INFO: Enabled downloader middlewares:</span><br><span class=\"line\">[<span class=\"string\">&#x27;scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.useragent.UserAgentMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.retry.RetryMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.redirect.RedirectMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.cookies.CookiesMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.downloadermiddlewares.stats.DownloaderStats&#x27;</span>]</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.middleware] INFO: Enabled spider middlewares:</span><br><span class=\"line\">[<span class=\"string\">&#x27;scrapy.spidermiddlewares.httperror.HttpErrorMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.spidermiddlewares.offsite.OffsiteMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.spidermiddlewares.referer.RefererMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.spidermiddlewares.urllength.UrlLengthMiddleware&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;scrapy.spidermiddlewares.depth.DepthMiddleware&#x27;</span>]</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.middleware] INFO: Enabled item pipelines:</span><br><span class=\"line\">[]</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.extensions.telnet] INFO: Telnet console listening on <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">6023</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:02 [scrapy.core.engine] INFO: Spider opened</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:03 [scrapy.downloadermiddlewares.redirect] DEBUG: Redirecting (<span class=\"number\">302</span>) to &lt;GET https://doc.scrapy.org/en/latest/_static/selectors-sample1.html&gt; <span class=\"keyword\">from</span> &lt;GET http://doc.scrapy.org/en/latest/_static/selectors-sample1.html&gt;</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:04 [scrapy.core.engine] DEBUG: Crawled (<span class=\"number\">200</span>) &lt;GET https://doc.scrapy.org/en/latest/_static/selectors-sample1.html&gt; (referer: <span class=\"literal\">None</span>)</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:06 [asyncio] DEBUG: Using proactor: IocpProactor</span><br><span class=\"line\">[s] Available Scrapy objects:</span><br><span class=\"line\">[s]   scrapy     scrapy module (contains scrapy.Request, scrapy.Selector, etc)</span><br><span class=\"line\">[s]   crawler    &lt;scrapy.crawler.Crawler <span class=\"built_in\">object</span> at <span class=\"number\">0x0000010ADFBBE220</span>&gt;</span><br><span class=\"line\">[s]   item       &#123;&#125;</span><br><span class=\"line\">[s]   request    &lt;GET http://doc.scrapy.org/en/latest/_static/selectors-sample1.html&gt;</span><br><span class=\"line\">[s]   response   &lt;<span class=\"number\">200</span> https://doc.scrapy.org/en/latest/_static/selectors-sample1.html&gt;</span><br><span class=\"line\">[s]   settings   &lt;scrapy.settings.Settings <span class=\"built_in\">object</span> at <span class=\"number\">0x0000010ADFBBE2B0</span>&gt;</span><br><span class=\"line\">[s]   spider     &lt;DefaultSpider <span class=\"string\">&#x27;default&#x27;</span> at <span class=\"number\">0x10ae002fdc0</span>&gt;</span><br><span class=\"line\">[s] Useful shortcuts:</span><br><span class=\"line\">[s]   fetch(url[, redirect=<span class=\"literal\">True</span>]) Fetch URL <span class=\"keyword\">and</span> update local objects (by default, redirects are followed)</span><br><span class=\"line\">[s]   fetch(req)                  Fetch a scrapy.Request <span class=\"keyword\">and</span> update local objects</span><br><span class=\"line\">[s]   shelp()           Shell <span class=\"built_in\">help</span> (<span class=\"built_in\">print</span> this <span class=\"built_in\">help</span>)</span><br><span class=\"line\">[s]   view(response)    View response <span class=\"keyword\">in</span> a browser</span><br><span class=\"line\"><span class=\"number\">2021</span>-06-08 <span class=\"number\">13</span>:<span class=\"number\">47</span>:06 [asyncio] DEBUG: Using proactor: IocpProactor</span><br><span class=\"line\">In [<span class=\"number\">1</span>]: </span><br></pre></td></tr></table></figure>\n\n<p>可以在命令行模式下输入命令调用对象的一些操作方法，回车之后实时显示结果。这与 <code>Python</code> 的命令行交互模式是类似的。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">2</span>]: response.url</span><br><span class=\"line\">Out[<span class=\"number\">2</span>]: <span class=\"string\">&#x27;https://doc.scrapy.org/en/latest/_static/selectors-sample1.html&#x27;</span></span><br><span class=\"line\">In [<span class=\"number\">3</span>]: response.text</span><br><span class=\"line\">Out[<span class=\"number\">3</span>]: <span class=\"string\">&quot;&lt;html&gt;\\n &lt;head&gt;\\n  &lt;base href=&#x27;http://example.com/&#x27; /&gt;\\n  &lt;title&gt;Example website&lt;/title&gt;\\n &lt;/head&gt;\\n &lt;body&gt;\\n  &lt;div id=&#x27;images&#x27;&gt;\\n   &lt;a href=&#x27;image1.html&#x27;&gt;Name: My image 1 &lt;br /&gt;&lt;img src=&#x27;image1_thumb.jpg&#x27; /&gt;&lt;/a&gt;\\n   &lt;a href=&#x27;image2.html&#x27;&gt;Name: My image 2 &lt;br /&gt;&lt;img src=&#x27;image2_thumb.jpg&#x27; /&gt;&lt;/a&gt;\\n   &lt;a href=&#x27;image3.html&#x27;&gt;Name: My image 3 &lt;br /&gt;&lt;img src=&#x27;image3_thumb.jpg&#x27; /&gt;&lt;/a&gt;\\n   &lt;a href=&#x27;image4.html&#x27;&gt;Name: My image 4 &lt;br /&gt;&lt;img src=&#x27;image4_thumb.jpg&#x27; /&gt;&lt;/a&gt;\\n   &lt;a href=&#x27;image5.html&#x27;&gt;Name: My image 5 &lt;br /&gt;&lt;img src=&#x27;image5_thumb.jpg&#x27; /&gt;&lt;/a&gt;\\n  &lt;/div&gt;\\n &lt;/body&gt;\\n&lt;/html&gt;\\n\\n&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"XPath选择器\"><a href=\"#XPath选择器\" class=\"headerlink\" title=\"XPath选择器\"></a>XPath选择器</h3><p>进入 <code>Scrapy Shell</code> 之后，我们将主要操作 <code>response</code> 变量来进行解析。因为我们解析的是 <code>HTML</code> <code>代码，Selector</code> 将自动使用 <code>HTML</code>语法来分析。 <code>response</code> 有一个属性 <code>selector</code>，我们调用 <code>response.selector</code> 返回的内容就相当于用 <code>response</code> 的 <code>text</code> 构造了一个 <code>Selector</code> 对象。通过这个 <code>Selector</code> 对象我们可以调用解析方法如 <code>xpath、css</code> 等，通过向方法传入 <code>XPath</code>或 <code>CSS</code> 选择器参数就可以实现信息的提取。 我们用一个实例感受一下，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">4</span>]: response.selector</span><br><span class=\"line\">Out[<span class=\"number\">4</span>]: &lt;Selector xpath=<span class=\"literal\">None</span> data=<span class=\"string\">&#x27;&lt;html&gt;\\n &lt;head&gt;\\n  &lt;base href=&quot;http://e...&#x27;</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">6</span>]: result = response.selector.xpath(<span class=\"string\">&quot;//a&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">7</span>]: result</span><br><span class=\"line\">Out[<span class=\"number\">7</span>]: </span><br><span class=\"line\">[&lt;Selector xpath=<span class=\"string\">&#x27;//a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image1.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;//a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image2.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;//a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image3.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;//a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image4.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;//a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image5.html&quot;&gt;Name: My image ...&#x27;</span>&gt;]</span><br></pre></td></tr></table></figure>\n\n<p>打印结果的形式是 <code>Selector</code> 组成的列表，其实它是 <code>SelectorList</code> 类型， <code>SelectorList</code> 和 <code>Selector</code> 都可以继续调用 <code>xpath</code> 和 <code>css</code> 等方法来进一步提取数据。 在上面的例子中，我们提取了 <code>a</code> 节点。接下来，我们尝试继续调用 <code>xpath</code> 方法来提取 <code>a</code> 节点内包含的 <code>img</code> 节点，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">8</span>]: result.xpath(<span class=\"string\">&quot;./img&quot;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">8</span>]: </span><br><span class=\"line\">[&lt;Selector xpath=<span class=\"string\">&#x27;./img&#x27;</span> data=<span class=\"string\">&#x27;&lt;img src=&quot;image1_thumb.jpg&quot;&gt;&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;./img&#x27;</span> data=<span class=\"string\">&#x27;&lt;img src=&quot;image2_thumb.jpg&quot;&gt;&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;./img&#x27;</span> data=<span class=\"string\">&#x27;&lt;img src=&quot;image3_thumb.jpg&quot;&gt;&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;./img&#x27;</span> data=<span class=\"string\">&#x27;&lt;img src=&quot;image4_thumb.jpg&quot;&gt;&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;./img&#x27;</span> data=<span class=\"string\">&#x27;&lt;img src=&quot;image5_thumb.jpg&quot;&gt;&#x27;</span>&gt;]</span><br></pre></td></tr></table></figure>\n\n<p>我们获得了 <code>a</code> 节点里面的所有 <code>img</code>节点，结果为 <code>5</code>。</p>\n<p>选择器的最前方加 <code>.（点）</code>，这代表提取元素内部的数据，如果没有加点，则代表从根节点开始提取。此处我们用了 <code>./img</code>的提取方式，则代表从 <code>a</code> 节点里进行提取。如果此处我们用 <code>//img</code>，则还 是从 <code>html节点</code>里进行提取。 </p>\n<p>我们刚才使用了 <code>response.selector.xpath</code>方法对数据进行了提取。<code>Scrapy</code>提供了两个实用的快捷方法，<code>response.xpath</code>和 <code>response.css</code>，它们二者的功能完全等同于 <code>response.selector.xpath</code>和 <code>response.selector.css</code>。方便起 见，后面我们统一直接调用 <code>response</code> 的 <code>xpath</code>和 <code>css</code> 方法进行选择。 现在我们得到的是 <code>SelectorList</code> 类型的变量，该变量是由 <code>Selector</code> 对象组成的列表。我们可以用索引单独取出其中某个 <code>Selector</code> 元素，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">9</span>]: result[<span class=\"number\">0</span>]</span><br><span class=\"line\">Out[<span class=\"number\">9</span>]: &lt;Selector xpath=<span class=\"string\">&#x27;//a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image1.html&quot;&gt;Name: My image ...&#x27;</span>&gt;</span><br></pre></td></tr></table></figure>\n<p>可以像操作列表一样操作这个 <code>SelectorList</code> 。但是现在获取的内容是 <code>Selector</code> 或者 <code>SelectorList</code> 类型，并不是真正的文本内容。那么具体的内容怎么提取呢？ 比如我们现在想提取出 <code>a</code> 节点元素，就可以利用 <code>extract</code> 方法，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">10</span>]: result[<span class=\"number\">0</span>].extract()</span><br><span class=\"line\">Out[<span class=\"number\">10</span>]: <span class=\"string\">&#x27;&lt;a href=&quot;image1.html&quot;&gt;Name: My image 1 &lt;br&gt;&lt;img src=&quot;image1_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>这里使用了 <code>extract</code> 方法，我们就可以把真实需要的内容获取下来。</p>\n<p>还可以改写 <code>XPath</code> 表达式，来选取节点的内部文本和属性，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">11</span>]: response.xpath(<span class=\"string\">&#x27;//a/text()&#x27;</span>).extract()</span><br><span class=\"line\">Out[<span class=\"number\">11</span>]: </span><br><span class=\"line\">[<span class=\"string\">&#x27;Name: My image 1 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name: My image 2 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name: My image 3 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name: My image 4 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name: My image 5 &#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">12</span>]: response.xpath(<span class=\"string\">&#x27;//a/@href&#x27;</span>).extract()</span><br><span class=\"line\">Out[<span class=\"number\">12</span>]: [<span class=\"string\">&#x27;image1.html&#x27;</span>, <span class=\"string\">&#x27;image2.html&#x27;</span>, <span class=\"string\">&#x27;image3.html&#x27;</span>, <span class=\"string\">&#x27;image4.html&#x27;</span>, <span class=\"string\">&#x27;image5.html&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>只需要再加一层<code> /text()</code> 就可以获取节点的内部文本，或者加一层 <code>/@href</code>就可以获取节点的 <code>href属性</code>。其中，<code>@</code> 符号后面内容就是要获取的属性名称。</p>\n<p>现在我们可以用一个规则把所有符合要求的节点都获取下来，返回的类型是列表类型。</p>\n<p>但是这里有一个问题：如果符合要求的节点只有一个，那么返回的结果会是什么呢？我们再用一个实例来感受一下，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">13</span>]: response.xpath(<span class=\"string\">&#x27;//a[@href=&quot;image1.html&quot;]/text()&#x27;</span>).extract()</span><br><span class=\"line\">Out[<span class=\"number\">13</span>]: [<span class=\"string\">&#x27;Name: My image 1 &#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>用属性限制了匹配的范围，使 <code>XPath</code>只可以匹配到一个元素。然后用 <code>extract</code> 方法提取结果，其结果还是一个列表形式，其文本是列表的第一个元素。但很多情况下，我们其实想要的数据就是第一个元素内容，这里我们通过加一个索引来获取，如下所示： </p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;Name: My image 1 &#x27;</span> </span><br></pre></td></tr></table></figure>\n\n<p>但是，这个写法很明显是有风险的。一旦 <code>XPath</code>有问题，那么 <code>extract</code> 后的结果可能是一个空列表。如果我们再用索引来获取，那不就可能会导致数组越界吗？ 所以，另外一个方法可以专门提取单个元素，它叫作 <code>extract_first</code>。我们可以改写上面的例子如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">14</span>]: response.xpath(<span class=\"string\">&#x27;//a[@href=&quot;image1.html&quot;]/text()&#x27;</span>).extract_first()</span><br><span class=\"line\">Out[<span class=\"number\">14</span>]: <span class=\"string\">&#x27;Name: My image 1 &#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>直接利用 <code>extract_first</code> 方法将匹配的第一个结果提取出来，同时我们也不用担心数组越界的问题。也可以给<code>extract_first()</code>传递一个默认值，找不到的话会使用默认值。</p>\n<h3 id=\"CSS-选择器\"><a href=\"#CSS-选择器\" class=\"headerlink\" title=\"CSS 选择器\"></a>CSS 选择器</h3><p>接下来，我们看看 <code>CSS</code> 选择器的用法。<code>Scrapy</code>的选择器同时还对接了 <code>CSS</code> 选择器，使用 <code>response.css()</code> 方法可以使用 <code>CSS</code> 选择器来选择对应的元素。</p>\n<p>例如在上文我们选取了所有的 <code>a</code> 节点，那么 <code>CSS</code> 选择器同样可以做到，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">15</span>]: response.css(<span class=\"string\">&#x27;a&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">15</span>]: </span><br><span class=\"line\">[&lt;Selector xpath=<span class=\"string\">&#x27;descendant-or-self::a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image1.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;descendant-or-self::a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image2.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;descendant-or-self::a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image3.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;descendant-or-self::a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image4.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;descendant-or-self::a&#x27;</span> data=<span class=\"string\">&#x27;&lt;a href=&quot;image5.html&quot;&gt;Name: My image ...&#x27;</span>&gt;]</span><br></pre></td></tr></table></figure>\n\n<p>同样，调用 <code>extract</code> 方法就可以提取出节点，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">16</span>]: response.css(<span class=\"string\">&#x27;a&#x27;</span>).extract()</span><br><span class=\"line\">Out[<span class=\"number\">16</span>]: </span><br><span class=\"line\">[<span class=\"string\">&#x27;&lt;a href=&quot;image1.html&quot;&gt;Name: My image 1 &lt;br&gt;&lt;img src=&quot;image1_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;&lt;a href=&quot;image2.html&quot;&gt;Name: My image 2 &lt;br&gt;&lt;img src=&quot;image2_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;&lt;a href=&quot;image3.html&quot;&gt;Name: My image 3 &lt;br&gt;&lt;img src=&quot;image3_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;&lt;a href=&quot;image4.html&quot;&gt;Name: My image 4 &lt;br&gt;&lt;img src=&quot;image4_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;&lt;a href=&quot;image5.html&quot;&gt;Name: My image 5 &lt;br&gt;&lt;img src=&quot;image5_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>用法和 <code>XPath选择</code>是完全一样的。另外，我们也可以进行属性选择和嵌套选择，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">17</span>]: response.css(<span class=\"string\">&#x27;a[href=&quot;image4.html&quot;]&#x27;</span>).extract()</span><br><span class=\"line\">Out[<span class=\"number\">17</span>]: [<span class=\"string\">&#x27;&lt;a href=&quot;image4.html&quot;&gt;Name: My image 4 &lt;br&gt;&lt;img src=&quot;image4_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>]</span><br><span class=\"line\">In [<span class=\"number\">18</span>]: response.css(<span class=\"string\">&#x27;a[href=&quot;image4.html&quot;] img&#x27;</span>).extract()</span><br><span class=\"line\">Out[<span class=\"number\">18</span>]: [<span class=\"string\">&#x27;&lt;img src=&quot;image4_thumb.jpg&quot;&gt;&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>也可以使用 <code>extract_first()</code> 方法提取列表的第一个元素，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">19</span>]: response.css(<span class=\"string\">&#x27;a[href=&quot;image4.html&quot;] img&#x27;</span>).extract_first()</span><br><span class=\"line\">Out[<span class=\"number\">19</span>]: <span class=\"string\">&#x27;&lt;img src=&quot;image4_thumb.jpg&quot;&gt;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>接下来的两个用法不太一样。节点的内部文本和属性的获取是这样实现的，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">21</span>]: response.css(<span class=\"string\">&#x27;a[href=&quot;image4.html&quot;]::text&#x27;</span>).extract_first()</span><br><span class=\"line\">Out[<span class=\"number\">21</span>]: <span class=\"string\">&#x27;Name: My image 4 &#x27;</span></span><br><span class=\"line\">In [<span class=\"number\">22</span>]: response.css(<span class=\"string\">&#x27;a[href=&quot;image4.html&quot;] img::attr(src)&#x27;</span>).extract_first()</span><br><span class=\"line\">Out[<span class=\"number\">22</span>]: <span class=\"string\">&#x27;image4_thumb.jpg&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>获取文本和属性需要用 <code>::text</code> 和 <code>::attr()</code> 的写法。而其他库如 <code>BeautifulSoup</code> 或 <code>PyQuery</code> 都有单独的方法。</p>\n<p><code>CSS 选择器</code>和 <code>XPath选择器</code>一样可以嵌套选择。我们可以先用 <code>XPath选择器</code>选中所有 <code>a</code> 节点，再利用 <code>CSS 选择器</code>选中 <code>img节点</code>，再用 <code>XPath选择器</code>获取属性。我们用一个实例来感受一下，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">23</span>]: response.xpath(<span class=\"string\">&#x27;//a&#x27;</span>).css(<span class=\"string\">&#x27;img&#x27;</span>).xpath(<span class=\"string\">&#x27;@src&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">23</span>]: </span><br><span class=\"line\">[&lt;Selector xpath=<span class=\"string\">&#x27;@src&#x27;</span> data=<span class=\"string\">&#x27;image1_thumb.jpg&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;@src&#x27;</span> data=<span class=\"string\">&#x27;image2_thumb.jpg&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;@src&#x27;</span> data=<span class=\"string\">&#x27;image3_thumb.jpg&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;@src&#x27;</span> data=<span class=\"string\">&#x27;image4_thumb.jpg&#x27;</span>&gt;,</span><br><span class=\"line\"> &lt;Selector xpath=<span class=\"string\">&#x27;@src&#x27;</span> data=<span class=\"string\">&#x27;image5_thumb.jpg&#x27;</span>&gt;]</span><br><span class=\"line\">In [<span class=\"number\">24</span>]: response.xpath(<span class=\"string\">&#x27;//a&#x27;</span>).css(<span class=\"string\">&#x27;img&#x27;</span>).xpath(<span class=\"string\">&#x27;@src&#x27;</span>).extract_first()</span><br><span class=\"line\">Out[<span class=\"number\">24</span>]: <span class=\"string\">&#x27;image1_thumb.jpg&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>可以随意使用 <code>xpath</code> 和 <code>css</code> 方法二者自由组合实现嵌套查询，二者是完全兼容的。</p>\n<h3 id=\"正则匹配\"><a href=\"#正则匹配\" class=\"headerlink\" title=\"正则匹配\"></a>正则匹配</h3><p><code>Scrapy</code>的选择器还支持正则匹配。比如，在示例的 <code>a</code> 节点中的文本类似于 <code>Name:My image 1</code>，现在我们只想把 <code>Name:</code>后面的内容提取出来，这时就可以借助 <code>re</code> 方法，实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">27</span>]: response.xpath(<span class=\"string\">&#x27;//a/text()&#x27;</span>).re(<span class=\"string\">&#x27;\\s(.*):\\s(.*)&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">27</span>]: [<span class=\"string\">&#x27;My image 1 &#x27;</span>, <span class=\"string\">&#x27;My image 2 &#x27;</span>, <span class=\"string\">&#x27;My image 3 &#x27;</span>, <span class=\"string\">&#x27;My image 4 &#x27;</span>, <span class=\"string\">&#x27;My image 5 &#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>给 <code>re</code> 方法传入一个正则表达式，其中 <code>(.*)</code> 就是要匹配的内容，输出的结果就是正则表达式匹配的分组，结果会依次输出。 如果同时存在两个分组，那么结果依然会被按序输出，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">32</span>]: response.xpath(<span class=\"string\">&#x27;//a/text()&#x27;</span>).re(<span class=\"string\">&#x27;(.*?):\\s(.*)&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">32</span>]: </span><br><span class=\"line\">[<span class=\"string\">&#x27;Name&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;My image 1 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;My image 2 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;My image 3 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;My image 4 &#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;Name&#x27;</span>,</span><br><span class=\"line\"> <span class=\"string\">&#x27;My image 5 &#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>类似 <code>extract_first</code> 方法，<code>re_first</code> 方法可以选取列表的第一个元素，用法如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">35</span>]: response.xpath(<span class=\"string\">&#x27;//a/text()&#x27;</span>).re_first(<span class=\"string\">&#x27;(.*?):\\s(.*)&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">35</span>]: <span class=\"string\">&#x27;Name&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>不论正则匹配了几个分组，结果都会等于列表的第一个元素。 值得注意的是， <code>response</code> 对象不能直接调用 <code>re</code> 和 <code>re_first</code> 方法。如果想要对全文进行正则匹配，可以先调用 <code>xpath</code> 方法然后再进行正则匹配，如下所示：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">36</span>]: response.xpath(<span class=\"string\">&#x27;.&#x27;</span>).re(<span class=\"string\">&#x27;Name:\\s(.*)&lt;br&gt;&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">36</span>]: [<span class=\"string\">&#x27;My image 1 &#x27;</span>, <span class=\"string\">&#x27;My image 2 &#x27;</span>, <span class=\"string\">&#x27;My image 3 &#x27;</span>, <span class=\"string\">&#x27;My image 4 &#x27;</span>, <span class=\"string\">&#x27;My image 5 &#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">37</span>]:  response.xpath(<span class=\"string\">&#x27;.&#x27;</span>).re_first(<span class=\"string\">&#x27;Name:\\s(.*)&lt;br&gt;&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">37</span>]: <span class=\"string\">&#x27;My image 1 </span></span><br></pre></td></tr></table></figure>\n\n<style>\n    table\n    {\n        margin: auto;\n        font-size: 80%;\n    }\n</style>\n\n\n"},{"title":"异步爬虫的原理和解析","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-05-31T09:03:41.000Z","pic":null,"_content":"\n## 实列引入\n\n看这么一个示例网站：[https://static4.scrape.cuiqingcai.com/](https://static4.scrape.cuiqingcai.com/)，如图所示。\n\n![](Screenshot_1.webp)\n\n这个网站在内部实现返回响应的逻辑的时候特意加了 5 秒的延迟，也就是说如果我们用 `requests` 来爬取其中某个页面的话，至少需要 5 秒才能得到响应。\n\n下面我们来用 `requests` 写一个遍历程序，直接遍历 `1~100` 部电影数据，代码实现如下：\n\n```python\nimport requests\nimport logging\nimport time\n\nlogging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s: %(message)s') \n\nTOTAL_NUMBER = 100 \nBASE_URL = 'https://static4.scrape.cuiqingcai.com/detail/{id}'\n\nstart_time = time.time() \n\nfor id in range(1, TOTAL_NUMBER + 1): \n    url = BASE_URL.format(id=id) \n    logging.info('scraping %s', url) \n    response = requests.get(url, verify=False) \n    end_time = time.time() \n    \nlogging.info('total time %s seconds', end_time - start_time)\n```\n\n运行结果如下：\n\n```python\n2021-05-31 17:42:33,963 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/1\n2021-05-31 17:42:41,377 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/2\n2021-05-31 17:42:47,221 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/3\n2021-05-31 17:42:52,603 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/4\n2021-05-31 17:42:59,745 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/5\n2021-05-31 17:43:06,403 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/6\n2021-05-31 17:43:12,190 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/7\n2021-05-31 17:43:20,517 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/8\n2021-05-31 17:43:25,804 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/9\n...\n```\n\n每个页面都至少要等待 5 秒才能加载出来，因此 100 个页面至少要花费 500 秒的时间，总的爬取时间最终为 513.6 秒，将近 9 分钟。\n\n## 基本了解\n\n### 阻塞\n\n阻塞状态指程序未得到所需计算资源时被挂起的状态。程序在等待某个操作完成期间，自身无法继续处理其他的事情，则称该程序在该操作上是阻塞的。\n\n常见的阻塞形式有：网络 `I/O` 阻塞、磁盘 `I/O` 阻塞、用户输入阻塞等。阻塞是无处不在的，包括 `CPU` 切换上下文时，所有的进程都无法真正处理事情，它们也会被阻塞。如果是多核 `CPU` 则正在执行上下文切换操作的核不可被利用。\n\n### 非阻塞\n\n非程序在等待某操作过程中，自身不被阻塞，可以继续处理其他的事情，则称该程序在该操作上是非阻塞的。\n\n非阻塞并不是在任何程序级别、任何情况下都可以存在的。仅当程序封装的级别可以囊括独立的子程序单元时，它才可能存在非阻塞状态。\n\n非阻塞的存在是因为阻塞存在，正因为某个操作阻塞导致的耗时与效率低下，才要把它变成非阻塞的。\n\n### 同步\n\n不同程序单元为了完成某个任务，在执行过程中需靠某种通信方式以协调一致，我们称这些程序单元是同步执行的。\n\n例如购物系统中更新商品库存，需要用“行锁”作为通信信号，让不同的更新请求强制排队顺序执行，那更新库存的操作是同步的。\n\n简言之，同步意味着有序。\n\n### 异步\n\n为完成某个任务，不同程序单元之间过程中无需通信协调，也能完成任务的方式，不相关的程序单元之间可以是异步的。\n\n例如，爬虫下载网页。调度程序调用下载程序后，即可调度其他任务，而无需与该下载任务保持通信以协调行为。不同网页的下载、保存等操作都是无关的，也无需相互通知协调。这些异步操作的完成时刻并不确定。\n\n简言之，异步意味着无序。\n\n### 多进程\n\n多进程就是利用 `CPU` 的多核优势，在同一时间并行地执行多个任务，可以大大提高执行效率。\n\n### 协程\n\n协程，英文叫作 `Coroutine`，又称微线程、纤程，协程是一种用户态的轻量级线程。\n\n协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈。因此协程能保留上一次调用时的状态，即所有局部状态的一 个特定组合，每次过程重入时，就相当于进入上一次调用的状态。\n\n协程本质上是个单进程，协程相对于多进程来说，无需线程上下文切换的开销，无需原子操作锁定及同步的开销，编程模型也非常简单。\n\n可以使用协程来实现异步操作，比如在网络爬虫场景下，发出一个请求之后，需要等待一定的时间才能得到响应，但其实在这个等待过程中，程序可以干许多其他的事情，等到响应得到之后才切换回 来继续处理，这样可以充分利用 `CPU` 和其他资源，这就是协程的优势。\n\n## 协程用法 \n\n从 Python 3.4 开始，Python中加入了协程的概念，但这个版本的协程还是以生成器对象为基础的，在 Python 3.5 则增加了 `async/await`，使得协程的实现更加方便。 Python中使用协程最常用的库莫过于 `asyncio`，所以本文会以 `asyncio` 为基础来介绍协程的使用。\n\n首先需要了解下面几个概念。\n\n- `event_loop`：事件循环，相当于一个无限循环，我们可以把一些函数注册到这个事件循环上，当满足条件发生的时候，就会调用对应的处理方法。\n- `coroutine`：中文翻译叫协程，在 `Python中`常指代为协程对象类型，可以将协程对象注册到时间循环中，它会被事件循环调用。可以使用 `async` 关键字来定义一个方法，这个方法在调用时不会立即 被执行，而是返回一个协程对象。\n- `task`：任务，它是对协程对象的进一步封装，包含了任务的各个状态。\n- `future`：代表将来执行或没有执行的任务的结果，实际上和 `task` 没有本质区别。 \n\n另外还需要了解 `async/await` 关键字，它是从 `Python 3.5` 才出现的，专门用于定义协程。其中，`async` 定义一个协程，`await` 用来挂起阻塞方法的执行。\n\n### 定义协程\n\n```python\nimport asyncio  # 引入asyncio包\n\nasync def execute(x):   # 使用async定义一个exexute方法\n    print('Number:', x)\n\ncoroutine = execute(1)  # 直接调用这个方法，没有直接执行，返回协程对象\nprint('返回的协程对象：', coroutine)\nprint('After calling execute')\nloop = asyncio.get_event_loop()     # 创建事件循环loop\nloop.run_until_complete(coroutine)  # 调用loop对象的run_until_complete方法将协程注册到事件循环中\nprint('After calling loop')\n```\n\n运行结果：\n\n```python\n返回的协程对象： <coroutine object execute at 0x0000015A83EAE740>\nAfter calling execute\nNumber: 1\nAfter calling loop\n```\n\n`async`定义的方法无法直接执行，会变成一个协程对象，必须注册到事件循环中才可以执行。\n\n协程对象可以进一步的被封装成`task`对象，如下：\n\n```python\nimport asyncio\n\nasync def execute(x):\n    print('Number', x)\n    return x\n\ncoroutine = execute(1)\nprint('协程对象:', coroutine)\nprint('After calling execute')\nloop = asyncio.get_event_loop()\ntask = loop.create_task(coroutine)\nprint('Task对象', task)\nloop.run_until_complete(task)\nprint('Task对象:', task)\nprint('After calling loop')\n```\n\n运行结果：\n\n```python\n协程对象: <coroutine object execute at 0x00000180F83EE6C0>\nAfter calling execute\nTask对象 <Task pending name='Task-1' coro=<execute() running at secondeCourse.py:3>>\nNumber 1\nTask对象: <Task finished name='Task-1' coro=<execute() done, defined at secondeCourse.py:3> result=1>\nAfter calling loop\n```\n\n可以看到定义了loop对象之后，调用它的create_task方法将coroutine对象转化成task对象，随后打印发现它是pending状态。接着将task对象添加到事件循环中执行，之后再打印输出一下task对象，它的状态就变成了finished，同时可以看到result变成了1，就是定义的execute方法返回的结果。\n\n还有另外的方法可以定义task对象，直接通过ayncio的ensure_future方法，返回结果也是task对象。\n\n```python\nimport asyncio\n\nasync def execute(x):\n    print('Number', x)\n    return x\n\ncoroutine = execute(1)\nprint('协程对象:', coroutine)\nprint('After calling execute')\ntask = asyncio.ensure_future(coroutine)\nprint('Task对象', task)\nloop = asyncio.get_event_loop()\nloop.run_until_complete(task)\nprint('Task对象:', task)\nprint('After calling loop')\n```\n\n运行结果：\n\n```python\n协程对象: <coroutine object execute at 0x00000180F83EE6C0>\nAfter calling execute\nTask对象 <Task pending name='Task-1' coro=<execute() running at secondeCourse.py:3>>\nNumber 1\nTask对象: <Task finished name='Task-1' coro=<execute() done, defined at secondeCourse.py:3> result=1>\nAfter calling loop\n```\n\n其运行效果都是一样的。\n\n### 绑定回调\n\n可以为某个task绑定回调函数。\n\n```python\nimport asyncio\nimport requests\n\nasync def request():\n    url = 'https://www.baidu.com'\n    status = requests.get(url)\n    return status\n\ndef callback(task):\n    print('task状态：', task.result())\n\ncoroutine = request()\ntask = asyncio.ensure_future(coroutine)     # 创建task对象\ntask.add_done_callback(callback)    # 添加task回调函数\nprint('Task对象：', task)\n\nloop = asyncio.get_event_loop()\nloop.run_until_complete(task)\n\nprint(\"Taskd对象：\", task)\n```\n\n运行结果：\n\n```python\nTask对象： <Task pending name='Task-1' coro=<request() running at task_callback.py:9]>\ntask状态： <Response [200]>\nTaskd对象： <Task finished name='Task-1' coro=<request() done, defined at task_callback.py:4> result=<Response [200]>>\n```\n\n调用add_done_task方法，将callback方法传递给封装好的task对象，当task对象执行完毕后就可以调用callback方法，同时task对象还会作为参数传递给callback方法，调用task对象的result方法就可以获取返回结果。\n\n### 多任务协程\n\n如果要执行过次请求，可以顶一个task列表，然后使用asyncio的wait方法。\n\n```python\nimport asyncio\nimport requests\n\nasync def request():\n    url = 'https://www.baidu.com'\n    status = requests.get(url)\n    return status\n\ntasks = [asyncio.ensure_future(request()) for _ in range(5)]    # 创建包含5个task的列表\nprint('Tasks:\\n', tasks)\n\nloop = asyncio.get_event_loop()\nloop.run_until_complete(asyncio.wait(tasks))\n\nfor task in tasks:\n    print('Task results:\\n', task.result())\n```\n\n运行结果：\n\n```python\nTasks:\n [<Task pending name='Task-1' coro=<request() running at 多任务协程.py:4>>, <Task pending name='Task-2' coro=<request() running at 多任务协程.py:4>>, <Task pending name='Task-3' coro=<request() running at 多任务协程.py:4>>, <Task pending name='Task-4' coro=<request() running at 多任务协程.py:4>>, <Task pending name='Task-5' coro=<request() running at 多任务协程.py:4>>]\nTask results:\n <Response [200]>\nTask results:\n <Response [200]>\nTask results:\n <Response [200]>\nTask results:\n <Response [200]>\nTask results:\n <Response [200]>\n```\n\n可以看到五个任务被顺次执行了，并得到了运行结果。\n\n## 使用aiohttp\n\naiohttp是一个支持异步请求的库，利用它和asyncio配合可以实现异步请求操作。\n\n安装：\n\n```python\npip install aiohttp\n```\n\n```python\nimport asyncio\nimport aiohttp\nimport time\n\nstart = time.time()\n\n\nasync def get(url):\n    session = aiohttp.ClientSession()   # 创建异步会话\n    response = await session.get(url)   # 异步会话请求返回的响应体\n    await response.text()\n    await session.close()\n    return response\n\n\nasync def request():\n    url = 'https://holychan.ltd'\n    print('等待获取网站信息')\n    response = await get(url)\n    print('获取来自', url, '的响应', response)\n\n\ntasks = [asyncio.ensure_future(request()) for _ in range(10)]\nloop = asyncio.get_event_loop()\nloop.run_until_complete(asyncio.wait(tasks))\n\nend = time.time()\nprint('总共耗时：', end - start)\n```\n\n运行结果如下：\n\n```python\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n总共耗时： 1.3632490634918213\n```\n\n代码里面我们使用了`await`，后面跟了 get 方法，在执行这 10 个协程的时候，如果遇到了`awai`t，那么就会将当前协程挂起，转而去执行其他的协程，直到其他的协程也挂起或执行完毕，再进行下一个协程的执行。\n\n开始运行时，时间循环会运行第一个`task`，针对第一个 `task` 来说，当执行到第一个 `await` 跟着的 get 方法时，它被挂起，但这个 get 方法第一步的执行是非阻塞的，挂起之后立马被唤醒，所以立即又进入执行， 创建了 ClientSession对象，接着遇到了第二个 await，调用了 `session.get` 请求方法，然后就被挂起了，由于请求需要耗时很久，所以一直没有被唤醒。\n\n当第一个 task 被挂起了，那接下来该怎么办呢？事件循环会寻找当前未被挂起的协程继续执行，于是就转而执行第二个 task 了，也是一样的流程操作，直到执行了第十个 task 的 `session.get` 方法之后，全部的 task 都被挂起了。所有 task 都已经处于挂起状态，怎么办？只好等待了。几个请求几乎同时都有了响应，然后几个 task 也被唤醒接着执行，输出请求结果。\n\n以百度为例，来测试下并发数量为 1、3、5、10、...、500 的情况下的耗时情况，代码如下：\n\n```python\nimport asyncio\nimport aiohttp\nimport time\n\ndef test(number):\n    start = time.time()\n    \n    async def get(url):\n        session = aiohttp.ClientSession()\n        response =await session.get(url)\n        await response.text()\n        await session.close()\n        return response\n\n    async def request():\n        url = \"https://www.baidu.com\"\n        await get(url)\n        \n    tasks = [asyncio.ensure_future(request()) for _ in range(number)]\n    loop = asyncio.get_event_loop()\n    loop.run_until_complete(asyncio.wait(tasks))\n\n    end = time.time()\n    print('Number:', number, 'Cost time:', end - start)\n\nfor number in [1, 3, 5, 7, 9, 10, 50, 100, 200, 500]:\n    test(number)\n```\n\n运行结果如下：\n\n```python\nNumber: 1 Cost time: 0.36544227600097656\nNumber: 3 Cost time: 0.24126696586608887\nNumber: 5 Cost time: 0.248154878616333\nNumber: 7 Cost time: 0.2729628086090088\nNumber: 9 Cost time: 0.46077466011047363\nNumber: 10 Cost time: 0.2601125240325928\nNumber: 50 Cost time: 0.5060205459594727\nNumber: 100 Cost time: 0.4680452346801758\nNumber: 500 Cost time: 2.809006929397583\n```\n\n可以看到，即使增加了并发数量，但在服务器能承受高并发的前提下，其爬取速度几乎不太受影响。","source":"_posts/异步爬虫的原理和解析.md","raw":"---\ntitle: 异步爬虫的原理和解析\ntags:\n  - python\n  - asyncio\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-05-31 17:03:41\ncategories: 爬虫\npic:\n---\n\n## 实列引入\n\n看这么一个示例网站：[https://static4.scrape.cuiqingcai.com/](https://static4.scrape.cuiqingcai.com/)，如图所示。\n\n![](Screenshot_1.webp)\n\n这个网站在内部实现返回响应的逻辑的时候特意加了 5 秒的延迟，也就是说如果我们用 `requests` 来爬取其中某个页面的话，至少需要 5 秒才能得到响应。\n\n下面我们来用 `requests` 写一个遍历程序，直接遍历 `1~100` 部电影数据，代码实现如下：\n\n```python\nimport requests\nimport logging\nimport time\n\nlogging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s: %(message)s') \n\nTOTAL_NUMBER = 100 \nBASE_URL = 'https://static4.scrape.cuiqingcai.com/detail/{id}'\n\nstart_time = time.time() \n\nfor id in range(1, TOTAL_NUMBER + 1): \n    url = BASE_URL.format(id=id) \n    logging.info('scraping %s', url) \n    response = requests.get(url, verify=False) \n    end_time = time.time() \n    \nlogging.info('total time %s seconds', end_time - start_time)\n```\n\n运行结果如下：\n\n```python\n2021-05-31 17:42:33,963 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/1\n2021-05-31 17:42:41,377 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/2\n2021-05-31 17:42:47,221 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/3\n2021-05-31 17:42:52,603 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/4\n2021-05-31 17:42:59,745 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/5\n2021-05-31 17:43:06,403 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/6\n2021-05-31 17:43:12,190 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/7\n2021-05-31 17:43:20,517 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/8\n2021-05-31 17:43:25,804 - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/9\n...\n```\n\n每个页面都至少要等待 5 秒才能加载出来，因此 100 个页面至少要花费 500 秒的时间，总的爬取时间最终为 513.6 秒，将近 9 分钟。\n\n## 基本了解\n\n### 阻塞\n\n阻塞状态指程序未得到所需计算资源时被挂起的状态。程序在等待某个操作完成期间，自身无法继续处理其他的事情，则称该程序在该操作上是阻塞的。\n\n常见的阻塞形式有：网络 `I/O` 阻塞、磁盘 `I/O` 阻塞、用户输入阻塞等。阻塞是无处不在的，包括 `CPU` 切换上下文时，所有的进程都无法真正处理事情，它们也会被阻塞。如果是多核 `CPU` 则正在执行上下文切换操作的核不可被利用。\n\n### 非阻塞\n\n非程序在等待某操作过程中，自身不被阻塞，可以继续处理其他的事情，则称该程序在该操作上是非阻塞的。\n\n非阻塞并不是在任何程序级别、任何情况下都可以存在的。仅当程序封装的级别可以囊括独立的子程序单元时，它才可能存在非阻塞状态。\n\n非阻塞的存在是因为阻塞存在，正因为某个操作阻塞导致的耗时与效率低下，才要把它变成非阻塞的。\n\n### 同步\n\n不同程序单元为了完成某个任务，在执行过程中需靠某种通信方式以协调一致，我们称这些程序单元是同步执行的。\n\n例如购物系统中更新商品库存，需要用“行锁”作为通信信号，让不同的更新请求强制排队顺序执行，那更新库存的操作是同步的。\n\n简言之，同步意味着有序。\n\n### 异步\n\n为完成某个任务，不同程序单元之间过程中无需通信协调，也能完成任务的方式，不相关的程序单元之间可以是异步的。\n\n例如，爬虫下载网页。调度程序调用下载程序后，即可调度其他任务，而无需与该下载任务保持通信以协调行为。不同网页的下载、保存等操作都是无关的，也无需相互通知协调。这些异步操作的完成时刻并不确定。\n\n简言之，异步意味着无序。\n\n### 多进程\n\n多进程就是利用 `CPU` 的多核优势，在同一时间并行地执行多个任务，可以大大提高执行效率。\n\n### 协程\n\n协程，英文叫作 `Coroutine`，又称微线程、纤程，协程是一种用户态的轻量级线程。\n\n协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈。因此协程能保留上一次调用时的状态，即所有局部状态的一 个特定组合，每次过程重入时，就相当于进入上一次调用的状态。\n\n协程本质上是个单进程，协程相对于多进程来说，无需线程上下文切换的开销，无需原子操作锁定及同步的开销，编程模型也非常简单。\n\n可以使用协程来实现异步操作，比如在网络爬虫场景下，发出一个请求之后，需要等待一定的时间才能得到响应，但其实在这个等待过程中，程序可以干许多其他的事情，等到响应得到之后才切换回 来继续处理，这样可以充分利用 `CPU` 和其他资源，这就是协程的优势。\n\n## 协程用法 \n\n从 Python 3.4 开始，Python中加入了协程的概念，但这个版本的协程还是以生成器对象为基础的，在 Python 3.5 则增加了 `async/await`，使得协程的实现更加方便。 Python中使用协程最常用的库莫过于 `asyncio`，所以本文会以 `asyncio` 为基础来介绍协程的使用。\n\n首先需要了解下面几个概念。\n\n- `event_loop`：事件循环，相当于一个无限循环，我们可以把一些函数注册到这个事件循环上，当满足条件发生的时候，就会调用对应的处理方法。\n- `coroutine`：中文翻译叫协程，在 `Python中`常指代为协程对象类型，可以将协程对象注册到时间循环中，它会被事件循环调用。可以使用 `async` 关键字来定义一个方法，这个方法在调用时不会立即 被执行，而是返回一个协程对象。\n- `task`：任务，它是对协程对象的进一步封装，包含了任务的各个状态。\n- `future`：代表将来执行或没有执行的任务的结果，实际上和 `task` 没有本质区别。 \n\n另外还需要了解 `async/await` 关键字，它是从 `Python 3.5` 才出现的，专门用于定义协程。其中，`async` 定义一个协程，`await` 用来挂起阻塞方法的执行。\n\n### 定义协程\n\n```python\nimport asyncio  # 引入asyncio包\n\nasync def execute(x):   # 使用async定义一个exexute方法\n    print('Number:', x)\n\ncoroutine = execute(1)  # 直接调用这个方法，没有直接执行，返回协程对象\nprint('返回的协程对象：', coroutine)\nprint('After calling execute')\nloop = asyncio.get_event_loop()     # 创建事件循环loop\nloop.run_until_complete(coroutine)  # 调用loop对象的run_until_complete方法将协程注册到事件循环中\nprint('After calling loop')\n```\n\n运行结果：\n\n```python\n返回的协程对象： <coroutine object execute at 0x0000015A83EAE740>\nAfter calling execute\nNumber: 1\nAfter calling loop\n```\n\n`async`定义的方法无法直接执行，会变成一个协程对象，必须注册到事件循环中才可以执行。\n\n协程对象可以进一步的被封装成`task`对象，如下：\n\n```python\nimport asyncio\n\nasync def execute(x):\n    print('Number', x)\n    return x\n\ncoroutine = execute(1)\nprint('协程对象:', coroutine)\nprint('After calling execute')\nloop = asyncio.get_event_loop()\ntask = loop.create_task(coroutine)\nprint('Task对象', task)\nloop.run_until_complete(task)\nprint('Task对象:', task)\nprint('After calling loop')\n```\n\n运行结果：\n\n```python\n协程对象: <coroutine object execute at 0x00000180F83EE6C0>\nAfter calling execute\nTask对象 <Task pending name='Task-1' coro=<execute() running at secondeCourse.py:3>>\nNumber 1\nTask对象: <Task finished name='Task-1' coro=<execute() done, defined at secondeCourse.py:3> result=1>\nAfter calling loop\n```\n\n可以看到定义了loop对象之后，调用它的create_task方法将coroutine对象转化成task对象，随后打印发现它是pending状态。接着将task对象添加到事件循环中执行，之后再打印输出一下task对象，它的状态就变成了finished，同时可以看到result变成了1，就是定义的execute方法返回的结果。\n\n还有另外的方法可以定义task对象，直接通过ayncio的ensure_future方法，返回结果也是task对象。\n\n```python\nimport asyncio\n\nasync def execute(x):\n    print('Number', x)\n    return x\n\ncoroutine = execute(1)\nprint('协程对象:', coroutine)\nprint('After calling execute')\ntask = asyncio.ensure_future(coroutine)\nprint('Task对象', task)\nloop = asyncio.get_event_loop()\nloop.run_until_complete(task)\nprint('Task对象:', task)\nprint('After calling loop')\n```\n\n运行结果：\n\n```python\n协程对象: <coroutine object execute at 0x00000180F83EE6C0>\nAfter calling execute\nTask对象 <Task pending name='Task-1' coro=<execute() running at secondeCourse.py:3>>\nNumber 1\nTask对象: <Task finished name='Task-1' coro=<execute() done, defined at secondeCourse.py:3> result=1>\nAfter calling loop\n```\n\n其运行效果都是一样的。\n\n### 绑定回调\n\n可以为某个task绑定回调函数。\n\n```python\nimport asyncio\nimport requests\n\nasync def request():\n    url = 'https://www.baidu.com'\n    status = requests.get(url)\n    return status\n\ndef callback(task):\n    print('task状态：', task.result())\n\ncoroutine = request()\ntask = asyncio.ensure_future(coroutine)     # 创建task对象\ntask.add_done_callback(callback)    # 添加task回调函数\nprint('Task对象：', task)\n\nloop = asyncio.get_event_loop()\nloop.run_until_complete(task)\n\nprint(\"Taskd对象：\", task)\n```\n\n运行结果：\n\n```python\nTask对象： <Task pending name='Task-1' coro=<request() running at task_callback.py:9]>\ntask状态： <Response [200]>\nTaskd对象： <Task finished name='Task-1' coro=<request() done, defined at task_callback.py:4> result=<Response [200]>>\n```\n\n调用add_done_task方法，将callback方法传递给封装好的task对象，当task对象执行完毕后就可以调用callback方法，同时task对象还会作为参数传递给callback方法，调用task对象的result方法就可以获取返回结果。\n\n### 多任务协程\n\n如果要执行过次请求，可以顶一个task列表，然后使用asyncio的wait方法。\n\n```python\nimport asyncio\nimport requests\n\nasync def request():\n    url = 'https://www.baidu.com'\n    status = requests.get(url)\n    return status\n\ntasks = [asyncio.ensure_future(request()) for _ in range(5)]    # 创建包含5个task的列表\nprint('Tasks:\\n', tasks)\n\nloop = asyncio.get_event_loop()\nloop.run_until_complete(asyncio.wait(tasks))\n\nfor task in tasks:\n    print('Task results:\\n', task.result())\n```\n\n运行结果：\n\n```python\nTasks:\n [<Task pending name='Task-1' coro=<request() running at 多任务协程.py:4>>, <Task pending name='Task-2' coro=<request() running at 多任务协程.py:4>>, <Task pending name='Task-3' coro=<request() running at 多任务协程.py:4>>, <Task pending name='Task-4' coro=<request() running at 多任务协程.py:4>>, <Task pending name='Task-5' coro=<request() running at 多任务协程.py:4>>]\nTask results:\n <Response [200]>\nTask results:\n <Response [200]>\nTask results:\n <Response [200]>\nTask results:\n <Response [200]>\nTask results:\n <Response [200]>\n```\n\n可以看到五个任务被顺次执行了，并得到了运行结果。\n\n## 使用aiohttp\n\naiohttp是一个支持异步请求的库，利用它和asyncio配合可以实现异步请求操作。\n\n安装：\n\n```python\npip install aiohttp\n```\n\n```python\nimport asyncio\nimport aiohttp\nimport time\n\nstart = time.time()\n\n\nasync def get(url):\n    session = aiohttp.ClientSession()   # 创建异步会话\n    response = await session.get(url)   # 异步会话请求返回的响应体\n    await response.text()\n    await session.close()\n    return response\n\n\nasync def request():\n    url = 'https://holychan.ltd'\n    print('等待获取网站信息')\n    response = await get(url)\n    print('获取来自', url, '的响应', response)\n\n\ntasks = [asyncio.ensure_future(request()) for _ in range(10)]\nloop = asyncio.get_event_loop()\nloop.run_until_complete(asyncio.wait(tasks))\n\nend = time.time()\nprint('总共耗时：', end - start)\n```\n\n运行结果如下：\n\n```python\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n等待获取网站信息\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n获取来自 https://holychan.ltd 的响应 <ClientResponse(https://holychan.ltd) [200 OK]>\n<CIMultiDictProxy('Server': 'nginx/1.14.1', 'Date': 'Tue, 01 Jun 2021 17:45:48 GMT', 'Content-Type': 'text/html', 'Content-Length': '44552', 'Last-Modified': 'Tue, \n01 Jun 2021 10:06:04 GMT', 'Connection': 'keep-alive', 'Etag': '\"60b6068c-ae08\"', 'Accept-Ranges': 'bytes')>\n\n总共耗时： 1.3632490634918213\n```\n\n代码里面我们使用了`await`，后面跟了 get 方法，在执行这 10 个协程的时候，如果遇到了`awai`t，那么就会将当前协程挂起，转而去执行其他的协程，直到其他的协程也挂起或执行完毕，再进行下一个协程的执行。\n\n开始运行时，时间循环会运行第一个`task`，针对第一个 `task` 来说，当执行到第一个 `await` 跟着的 get 方法时，它被挂起，但这个 get 方法第一步的执行是非阻塞的，挂起之后立马被唤醒，所以立即又进入执行， 创建了 ClientSession对象，接着遇到了第二个 await，调用了 `session.get` 请求方法，然后就被挂起了，由于请求需要耗时很久，所以一直没有被唤醒。\n\n当第一个 task 被挂起了，那接下来该怎么办呢？事件循环会寻找当前未被挂起的协程继续执行，于是就转而执行第二个 task 了，也是一样的流程操作，直到执行了第十个 task 的 `session.get` 方法之后，全部的 task 都被挂起了。所有 task 都已经处于挂起状态，怎么办？只好等待了。几个请求几乎同时都有了响应，然后几个 task 也被唤醒接着执行，输出请求结果。\n\n以百度为例，来测试下并发数量为 1、3、5、10、...、500 的情况下的耗时情况，代码如下：\n\n```python\nimport asyncio\nimport aiohttp\nimport time\n\ndef test(number):\n    start = time.time()\n    \n    async def get(url):\n        session = aiohttp.ClientSession()\n        response =await session.get(url)\n        await response.text()\n        await session.close()\n        return response\n\n    async def request():\n        url = \"https://www.baidu.com\"\n        await get(url)\n        \n    tasks = [asyncio.ensure_future(request()) for _ in range(number)]\n    loop = asyncio.get_event_loop()\n    loop.run_until_complete(asyncio.wait(tasks))\n\n    end = time.time()\n    print('Number:', number, 'Cost time:', end - start)\n\nfor number in [1, 3, 5, 7, 9, 10, 50, 100, 200, 500]:\n    test(number)\n```\n\n运行结果如下：\n\n```python\nNumber: 1 Cost time: 0.36544227600097656\nNumber: 3 Cost time: 0.24126696586608887\nNumber: 5 Cost time: 0.248154878616333\nNumber: 7 Cost time: 0.2729628086090088\nNumber: 9 Cost time: 0.46077466011047363\nNumber: 10 Cost time: 0.2601125240325928\nNumber: 50 Cost time: 0.5060205459594727\nNumber: 100 Cost time: 0.4680452346801758\nNumber: 500 Cost time: 2.809006929397583\n```\n\n可以看到，即使增加了并发数量，但在服务器能承受高并发的前提下，其爬取速度几乎不太受影响。","slug":"异步爬虫的原理和解析","published":1,"updated":"2021-06-15T15:47:31.617Z","layout":"post","photos":[],"link":"","_id":"ckq14rx3y007p44ud2cchdwsb","content":"<h2 id=\"实列引入\"><a href=\"#实列引入\" class=\"headerlink\" title=\"实列引入\"></a>实列引入</h2><p>看这么一个示例网站：<a href=\"https://static4.scrape.cuiqingcai.com/\">https://static4.scrape.cuiqingcai.com/</a>，如图所示。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>这个网站在内部实现返回响应的逻辑的时候特意加了 5 秒的延迟，也就是说如果我们用 <code>requests</code> 来爬取其中某个页面的话，至少需要 5 秒才能得到响应。</p>\n<p>下面我们来用 <code>requests</code> 写一个遍历程序，直接遍历 <code>1~100</code> 部电影数据，代码实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\">logging.basicConfig(level=logging.INFO, <span class=\"built_in\">format</span>=<span class=\"string\">&#x27;%(asctime)s - %(levelname)s: %(message)s&#x27;</span>) </span><br><span class=\"line\"></span><br><span class=\"line\">TOTAL_NUMBER = <span class=\"number\">100</span> </span><br><span class=\"line\">BASE_URL = <span class=\"string\">&#x27;https://static4.scrape.cuiqingcai.com/detail/&#123;id&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">start_time = time.time() </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> <span class=\"built_in\">id</span> <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_NUMBER + <span class=\"number\">1</span>): </span><br><span class=\"line\">    url = BASE_URL.<span class=\"built_in\">format</span>(<span class=\"built_in\">id</span>=<span class=\"built_in\">id</span>) </span><br><span class=\"line\">    logging.info(<span class=\"string\">&#x27;scraping %s&#x27;</span>, url) </span><br><span class=\"line\">    response = requests.get(url, verify=<span class=\"literal\">False</span>) </span><br><span class=\"line\">    end_time = time.time() </span><br><span class=\"line\">    </span><br><span class=\"line\">logging.info(<span class=\"string\">&#x27;total time %s seconds&#x27;</span>, end_time - start_time)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">42</span>:<span class=\"number\">33</span>,<span class=\"number\">963</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">42</span>:<span class=\"number\">41</span>,<span class=\"number\">377</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">42</span>:<span class=\"number\">47</span>,<span class=\"number\">221</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">42</span>:<span class=\"number\">52</span>,<span class=\"number\">603</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">42</span>:<span class=\"number\">59</span>,<span class=\"number\">745</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">43</span>:06,<span class=\"number\">403</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">6</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">43</span>:<span class=\"number\">12</span>,<span class=\"number\">190</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">7</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">43</span>:<span class=\"number\">20</span>,<span class=\"number\">517</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">8</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">43</span>:<span class=\"number\">25</span>,<span class=\"number\">804</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">9</span></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>每个页面都至少要等待 5 秒才能加载出来，因此 100 个页面至少要花费 500 秒的时间，总的爬取时间最终为 513.6 秒，将近 9 分钟。</p>\n<h2 id=\"基本了解\"><a href=\"#基本了解\" class=\"headerlink\" title=\"基本了解\"></a>基本了解</h2><h3 id=\"阻塞\"><a href=\"#阻塞\" class=\"headerlink\" title=\"阻塞\"></a>阻塞</h3><p>阻塞状态指程序未得到所需计算资源时被挂起的状态。程序在等待某个操作完成期间，自身无法继续处理其他的事情，则称该程序在该操作上是阻塞的。</p>\n<p>常见的阻塞形式有：网络 <code>I/O</code> 阻塞、磁盘 <code>I/O</code> 阻塞、用户输入阻塞等。阻塞是无处不在的，包括 <code>CPU</code> 切换上下文时，所有的进程都无法真正处理事情，它们也会被阻塞。如果是多核 <code>CPU</code> 则正在执行上下文切换操作的核不可被利用。</p>\n<h3 id=\"非阻塞\"><a href=\"#非阻塞\" class=\"headerlink\" title=\"非阻塞\"></a>非阻塞</h3><p>非程序在等待某操作过程中，自身不被阻塞，可以继续处理其他的事情，则称该程序在该操作上是非阻塞的。</p>\n<p>非阻塞并不是在任何程序级别、任何情况下都可以存在的。仅当程序封装的级别可以囊括独立的子程序单元时，它才可能存在非阻塞状态。</p>\n<p>非阻塞的存在是因为阻塞存在，正因为某个操作阻塞导致的耗时与效率低下，才要把它变成非阻塞的。</p>\n<h3 id=\"同步\"><a href=\"#同步\" class=\"headerlink\" title=\"同步\"></a>同步</h3><p>不同程序单元为了完成某个任务，在执行过程中需靠某种通信方式以协调一致，我们称这些程序单元是同步执行的。</p>\n<p>例如购物系统中更新商品库存，需要用“行锁”作为通信信号，让不同的更新请求强制排队顺序执行，那更新库存的操作是同步的。</p>\n<p>简言之，同步意味着有序。</p>\n<h3 id=\"异步\"><a href=\"#异步\" class=\"headerlink\" title=\"异步\"></a>异步</h3><p>为完成某个任务，不同程序单元之间过程中无需通信协调，也能完成任务的方式，不相关的程序单元之间可以是异步的。</p>\n<p>例如，爬虫下载网页。调度程序调用下载程序后，即可调度其他任务，而无需与该下载任务保持通信以协调行为。不同网页的下载、保存等操作都是无关的，也无需相互通知协调。这些异步操作的完成时刻并不确定。</p>\n<p>简言之，异步意味着无序。</p>\n<h3 id=\"多进程\"><a href=\"#多进程\" class=\"headerlink\" title=\"多进程\"></a>多进程</h3><p>多进程就是利用 <code>CPU</code> 的多核优势，在同一时间并行地执行多个任务，可以大大提高执行效率。</p>\n<h3 id=\"协程\"><a href=\"#协程\" class=\"headerlink\" title=\"协程\"></a>协程</h3><p>协程，英文叫作 <code>Coroutine</code>，又称微线程、纤程，协程是一种用户态的轻量级线程。</p>\n<p>协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈。因此协程能保留上一次调用时的状态，即所有局部状态的一 个特定组合，每次过程重入时，就相当于进入上一次调用的状态。</p>\n<p>协程本质上是个单进程，协程相对于多进程来说，无需线程上下文切换的开销，无需原子操作锁定及同步的开销，编程模型也非常简单。</p>\n<p>可以使用协程来实现异步操作，比如在网络爬虫场景下，发出一个请求之后，需要等待一定的时间才能得到响应，但其实在这个等待过程中，程序可以干许多其他的事情，等到响应得到之后才切换回 来继续处理，这样可以充分利用 <code>CPU</code> 和其他资源，这就是协程的优势。</p>\n<h2 id=\"协程用法\"><a href=\"#协程用法\" class=\"headerlink\" title=\"协程用法\"></a>协程用法</h2><p>从 Python 3.4 开始，Python中加入了协程的概念，但这个版本的协程还是以生成器对象为基础的，在 Python 3.5 则增加了 <code>async/await</code>，使得协程的实现更加方便。 Python中使用协程最常用的库莫过于 <code>asyncio</code>，所以本文会以 <code>asyncio</code> 为基础来介绍协程的使用。</p>\n<p>首先需要了解下面几个概念。</p>\n<ul>\n<li><code>event_loop</code>：事件循环，相当于一个无限循环，我们可以把一些函数注册到这个事件循环上，当满足条件发生的时候，就会调用对应的处理方法。</li>\n<li><code>coroutine</code>：中文翻译叫协程，在 <code>Python中</code>常指代为协程对象类型，可以将协程对象注册到时间循环中，它会被事件循环调用。可以使用 <code>async</code> 关键字来定义一个方法，这个方法在调用时不会立即 被执行，而是返回一个协程对象。</li>\n<li><code>task</code>：任务，它是对协程对象的进一步封装，包含了任务的各个状态。</li>\n<li><code>future</code>：代表将来执行或没有执行的任务的结果，实际上和 <code>task</code> 没有本质区别。 </li>\n</ul>\n<p>另外还需要了解 <code>async/await</code> 关键字，它是从 <code>Python 3.5</code> 才出现的，专门用于定义协程。其中，<code>async</code> 定义一个协程，<code>await</code> 用来挂起阻塞方法的执行。</p>\n<h3 id=\"定义协程\"><a href=\"#定义协程\" class=\"headerlink\" title=\"定义协程\"></a>定义协程</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio  <span class=\"comment\"># 引入asyncio包</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">execute</span>(<span class=\"params\">x</span>):</span>   <span class=\"comment\"># 使用async定义一个exexute方法</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Number:&#x27;</span>, x)</span><br><span class=\"line\"></span><br><span class=\"line\">coroutine = execute(<span class=\"number\">1</span>)  <span class=\"comment\"># 直接调用这个方法，没有直接执行，返回协程对象</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;返回的协程对象：&#x27;</span>, coroutine)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;After calling execute&#x27;</span>)</span><br><span class=\"line\">loop = asyncio.get_event_loop()     <span class=\"comment\"># 创建事件循环loop</span></span><br><span class=\"line\">loop.run_until_complete(coroutine)  <span class=\"comment\"># 调用loop对象的run_until_complete方法将协程注册到事件循环中</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;After calling loop&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">返回的协程对象： &lt;coroutine <span class=\"built_in\">object</span> execute at <span class=\"number\">0x0000015A83EAE740</span>&gt;</span><br><span class=\"line\">After calling execute</span><br><span class=\"line\">Number: <span class=\"number\">1</span></span><br><span class=\"line\">After calling loop</span><br></pre></td></tr></table></figure>\n\n<p><code>async</code>定义的方法无法直接执行，会变成一个协程对象，必须注册到事件循环中才可以执行。</p>\n<p>协程对象可以进一步的被封装成<code>task</code>对象，如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">execute</span>(<span class=\"params\">x</span>):</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Number&#x27;</span>, x)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x</span><br><span class=\"line\"></span><br><span class=\"line\">coroutine = execute(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;协程对象:&#x27;</span>, coroutine)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;After calling execute&#x27;</span>)</span><br><span class=\"line\">loop = asyncio.get_event_loop()</span><br><span class=\"line\">task = loop.create_task(coroutine)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Task对象&#x27;</span>, task)</span><br><span class=\"line\">loop.run_until_complete(task)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Task对象:&#x27;</span>, task)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;After calling loop&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">协程对象: &lt;coroutine <span class=\"built_in\">object</span> execute at <span class=\"number\">0x00000180F83EE6C0</span>&gt;</span><br><span class=\"line\">After calling execute</span><br><span class=\"line\">Task对象 &lt;Task pending name=<span class=\"string\">&#x27;Task-1&#x27;</span> coro=&lt;execute() running at secondeCourse.py:<span class=\"number\">3</span>&gt;&gt;</span><br><span class=\"line\">Number <span class=\"number\">1</span></span><br><span class=\"line\">Task对象: &lt;Task finished name=<span class=\"string\">&#x27;Task-1&#x27;</span> coro=&lt;execute() done, defined at secondeCourse.py:<span class=\"number\">3</span>&gt; result=<span class=\"number\">1</span>&gt;</span><br><span class=\"line\">After calling loop</span><br></pre></td></tr></table></figure>\n\n<p>可以看到定义了loop对象之后，调用它的create_task方法将coroutine对象转化成task对象，随后打印发现它是pending状态。接着将task对象添加到事件循环中执行，之后再打印输出一下task对象，它的状态就变成了finished，同时可以看到result变成了1，就是定义的execute方法返回的结果。</p>\n<p>还有另外的方法可以定义task对象，直接通过ayncio的ensure_future方法，返回结果也是task对象。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">execute</span>(<span class=\"params\">x</span>):</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Number&#x27;</span>, x)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x</span><br><span class=\"line\"></span><br><span class=\"line\">coroutine = execute(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;协程对象:&#x27;</span>, coroutine)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;After calling execute&#x27;</span>)</span><br><span class=\"line\">task = asyncio.ensure_future(coroutine)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Task对象&#x27;</span>, task)</span><br><span class=\"line\">loop = asyncio.get_event_loop()</span><br><span class=\"line\">loop.run_until_complete(task)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Task对象:&#x27;</span>, task)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;After calling loop&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">协程对象: &lt;coroutine <span class=\"built_in\">object</span> execute at <span class=\"number\">0x00000180F83EE6C0</span>&gt;</span><br><span class=\"line\">After calling execute</span><br><span class=\"line\">Task对象 &lt;Task pending name=<span class=\"string\">&#x27;Task-1&#x27;</span> coro=&lt;execute() running at secondeCourse.py:<span class=\"number\">3</span>&gt;&gt;</span><br><span class=\"line\">Number <span class=\"number\">1</span></span><br><span class=\"line\">Task对象: &lt;Task finished name=<span class=\"string\">&#x27;Task-1&#x27;</span> coro=&lt;execute() done, defined at secondeCourse.py:<span class=\"number\">3</span>&gt; result=<span class=\"number\">1</span>&gt;</span><br><span class=\"line\">After calling loop</span><br></pre></td></tr></table></figure>\n\n<p>其运行效果都是一样的。</p>\n<h3 id=\"绑定回调\"><a href=\"#绑定回调\" class=\"headerlink\" title=\"绑定回调\"></a>绑定回调</h3><p>可以为某个task绑定回调函数。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">request</span>():</span></span><br><span class=\"line\">    url = <span class=\"string\">&#x27;https://www.baidu.com&#x27;</span></span><br><span class=\"line\">    status = requests.get(url)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> status</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">callback</span>(<span class=\"params\">task</span>):</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;task状态：&#x27;</span>, task.result())</span><br><span class=\"line\"></span><br><span class=\"line\">coroutine = request()</span><br><span class=\"line\">task = asyncio.ensure_future(coroutine)     <span class=\"comment\"># 创建task对象</span></span><br><span class=\"line\">task.add_done_callback(callback)    <span class=\"comment\"># 添加task回调函数</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Task对象：&#x27;</span>, task)</span><br><span class=\"line\"></span><br><span class=\"line\">loop = asyncio.get_event_loop()</span><br><span class=\"line\">loop.run_until_complete(task)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;Taskd对象：&quot;</span>, task)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Task对象： &lt;Task pending name=<span class=\"string\">&#x27;Task-1&#x27;</span> coro=&lt;request() running at task_callback.py:<span class=\"number\">9</span>]&gt;</span><br><span class=\"line\">task状态： &lt;Response [<span class=\"number\">200</span>]&gt;</span><br><span class=\"line\">Taskd对象： &lt;Task finished name=<span class=\"string\">&#x27;Task-1&#x27;</span> coro=&lt;request() done, defined at task_callback.py:<span class=\"number\">4</span>&gt; result=&lt;Response [<span class=\"number\">200</span>]&gt;&gt;</span><br></pre></td></tr></table></figure>\n\n<p>调用add_done_task方法，将callback方法传递给封装好的task对象，当task对象执行完毕后就可以调用callback方法，同时task对象还会作为参数传递给callback方法，调用task对象的result方法就可以获取返回结果。</p>\n<h3 id=\"多任务协程\"><a href=\"#多任务协程\" class=\"headerlink\" title=\"多任务协程\"></a>多任务协程</h3><p>如果要执行过次请求，可以顶一个task列表，然后使用asyncio的wait方法。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">request</span>():</span></span><br><span class=\"line\">    url = <span class=\"string\">&#x27;https://www.baidu.com&#x27;</span></span><br><span class=\"line\">    status = requests.get(url)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> status</span><br><span class=\"line\"></span><br><span class=\"line\">tasks = [asyncio.ensure_future(request()) <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">5</span>)]    <span class=\"comment\"># 创建包含5个task的列表</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Tasks:\\n&#x27;</span>, tasks)</span><br><span class=\"line\"></span><br><span class=\"line\">loop = asyncio.get_event_loop()</span><br><span class=\"line\">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> task <span class=\"keyword\">in</span> tasks:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Task results:\\n&#x27;</span>, task.result())</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Tasks:</span><br><span class=\"line\"> [&lt;Task pending name=<span class=\"string\">&#x27;Task-1&#x27;</span> coro=&lt;request() running at 多任务协程.py:<span class=\"number\">4</span>&gt;&gt;, &lt;Task pending name=<span class=\"string\">&#x27;Task-2&#x27;</span> coro=&lt;request() running at 多任务协程.py:<span class=\"number\">4</span>&gt;&gt;, &lt;Task pending name=<span class=\"string\">&#x27;Task-3&#x27;</span> coro=&lt;request() running at 多任务协程.py:<span class=\"number\">4</span>&gt;&gt;, &lt;Task pending name=<span class=\"string\">&#x27;Task-4&#x27;</span> coro=&lt;request() running at 多任务协程.py:<span class=\"number\">4</span>&gt;&gt;, &lt;Task pending name=<span class=\"string\">&#x27;Task-5&#x27;</span> coro=&lt;request() running at 多任务协程.py:<span class=\"number\">4</span>&gt;&gt;]</span><br><span class=\"line\">Task results:</span><br><span class=\"line\"> &lt;Response [<span class=\"number\">200</span>]&gt;</span><br><span class=\"line\">Task results:</span><br><span class=\"line\"> &lt;Response [<span class=\"number\">200</span>]&gt;</span><br><span class=\"line\">Task results:</span><br><span class=\"line\"> &lt;Response [<span class=\"number\">200</span>]&gt;</span><br><span class=\"line\">Task results:</span><br><span class=\"line\"> &lt;Response [<span class=\"number\">200</span>]&gt;</span><br><span class=\"line\">Task results:</span><br><span class=\"line\"> &lt;Response [<span class=\"number\">200</span>]&gt;</span><br></pre></td></tr></table></figure>\n\n<p>可以看到五个任务被顺次执行了，并得到了运行结果。</p>\n<h2 id=\"使用aiohttp\"><a href=\"#使用aiohttp\" class=\"headerlink\" title=\"使用aiohttp\"></a>使用aiohttp</h2><p>aiohttp是一个支持异步请求的库，利用它和asyncio配合可以实现异步请求操作。</p>\n<p>安装：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install aiohttp</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> aiohttp</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\">start = time.time()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    session = aiohttp.ClientSession()   <span class=\"comment\"># 创建异步会话</span></span><br><span class=\"line\">    response = <span class=\"keyword\">await</span> session.get(url)   <span class=\"comment\"># 异步会话请求返回的响应体</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> response.text()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> session.close()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">request</span>():</span></span><br><span class=\"line\">    url = <span class=\"string\">&#x27;https://holychan.ltd&#x27;</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;等待获取网站信息&#x27;</span>)</span><br><span class=\"line\">    response = <span class=\"keyword\">await</span> get(url)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;获取来自&#x27;</span>, url, <span class=\"string\">&#x27;的响应&#x27;</span>, response)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">tasks = [asyncio.ensure_future(request()) <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>)]</span><br><span class=\"line\">loop = asyncio.get_event_loop()</span><br><span class=\"line\">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class=\"line\"></span><br><span class=\"line\">end = time.time()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;总共耗时：&#x27;</span>, end - start)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">总共耗时： <span class=\"number\">1.3632490634918213</span></span><br></pre></td></tr></table></figure>\n\n<p>代码里面我们使用了<code>await</code>，后面跟了 get 方法，在执行这 10 个协程的时候，如果遇到了<code>awai</code>t，那么就会将当前协程挂起，转而去执行其他的协程，直到其他的协程也挂起或执行完毕，再进行下一个协程的执行。</p>\n<p>开始运行时，时间循环会运行第一个<code>task</code>，针对第一个 <code>task</code> 来说，当执行到第一个 <code>await</code> 跟着的 get 方法时，它被挂起，但这个 get 方法第一步的执行是非阻塞的，挂起之后立马被唤醒，所以立即又进入执行， 创建了 ClientSession对象，接着遇到了第二个 await，调用了 <code>session.get</code> 请求方法，然后就被挂起了，由于请求需要耗时很久，所以一直没有被唤醒。</p>\n<p>当第一个 task 被挂起了，那接下来该怎么办呢？事件循环会寻找当前未被挂起的协程继续执行，于是就转而执行第二个 task 了，也是一样的流程操作，直到执行了第十个 task 的 <code>session.get</code> 方法之后，全部的 task 都被挂起了。所有 task 都已经处于挂起状态，怎么办？只好等待了。几个请求几乎同时都有了响应，然后几个 task 也被唤醒接着执行，输出请求结果。</p>\n<p>以百度为例，来测试下并发数量为 1、3、5、10、…、500 的情况下的耗时情况，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> aiohttp</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">test</span>(<span class=\"params\">number</span>):</span></span><br><span class=\"line\">    start = time.time()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">        session = aiohttp.ClientSession()</span><br><span class=\"line\">        response =<span class=\"keyword\">await</span> session.get(url)</span><br><span class=\"line\">        <span class=\"keyword\">await</span> response.text()</span><br><span class=\"line\">        <span class=\"keyword\">await</span> session.close()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">request</span>():</span></span><br><span class=\"line\">        url = <span class=\"string\">&quot;https://www.baidu.com&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">await</span> get(url)</span><br><span class=\"line\">        </span><br><span class=\"line\">    tasks = [asyncio.ensure_future(request()) <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(number)]</span><br><span class=\"line\">    loop = asyncio.get_event_loop()</span><br><span class=\"line\">    loop.run_until_complete(asyncio.wait(tasks))</span><br><span class=\"line\"></span><br><span class=\"line\">    end = time.time()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Number:&#x27;</span>, number, <span class=\"string\">&#x27;Cost time:&#x27;</span>, end - start)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> number <span class=\"keyword\">in</span> [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>, <span class=\"number\">9</span>, <span class=\"number\">10</span>, <span class=\"number\">50</span>, <span class=\"number\">100</span>, <span class=\"number\">200</span>, <span class=\"number\">500</span>]:</span><br><span class=\"line\">    test(number)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Number: <span class=\"number\">1</span> Cost time: <span class=\"number\">0.36544227600097656</span></span><br><span class=\"line\">Number: <span class=\"number\">3</span> Cost time: <span class=\"number\">0.24126696586608887</span></span><br><span class=\"line\">Number: <span class=\"number\">5</span> Cost time: <span class=\"number\">0.248154878616333</span></span><br><span class=\"line\">Number: <span class=\"number\">7</span> Cost time: <span class=\"number\">0.2729628086090088</span></span><br><span class=\"line\">Number: <span class=\"number\">9</span> Cost time: <span class=\"number\">0.46077466011047363</span></span><br><span class=\"line\">Number: <span class=\"number\">10</span> Cost time: <span class=\"number\">0.2601125240325928</span></span><br><span class=\"line\">Number: <span class=\"number\">50</span> Cost time: <span class=\"number\">0.5060205459594727</span></span><br><span class=\"line\">Number: <span class=\"number\">100</span> Cost time: <span class=\"number\">0.4680452346801758</span></span><br><span class=\"line\">Number: <span class=\"number\">500</span> Cost time: <span class=\"number\">2.809006929397583</span></span><br></pre></td></tr></table></figure>\n\n<p>可以看到，即使增加了并发数量，但在服务器能承受高并发的前提下，其爬取速度几乎不太受影响。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"实列引入\"><a href=\"#实列引入\" class=\"headerlink\" title=\"实列引入\"></a>实列引入</h2><p>看这么一个示例网站：<a href=\"https://static4.scrape.cuiqingcai.com/\">https://static4.scrape.cuiqingcai.com/</a>，如图所示。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>这个网站在内部实现返回响应的逻辑的时候特意加了 5 秒的延迟，也就是说如果我们用 <code>requests</code> 来爬取其中某个页面的话，至少需要 5 秒才能得到响应。</p>\n<p>下面我们来用 <code>requests</code> 写一个遍历程序，直接遍历 <code>1~100</code> 部电影数据，代码实现如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\">logging.basicConfig(level=logging.INFO, <span class=\"built_in\">format</span>=<span class=\"string\">&#x27;%(asctime)s - %(levelname)s: %(message)s&#x27;</span>) </span><br><span class=\"line\"></span><br><span class=\"line\">TOTAL_NUMBER = <span class=\"number\">100</span> </span><br><span class=\"line\">BASE_URL = <span class=\"string\">&#x27;https://static4.scrape.cuiqingcai.com/detail/&#123;id&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">start_time = time.time() </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> <span class=\"built_in\">id</span> <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, TOTAL_NUMBER + <span class=\"number\">1</span>): </span><br><span class=\"line\">    url = BASE_URL.<span class=\"built_in\">format</span>(<span class=\"built_in\">id</span>=<span class=\"built_in\">id</span>) </span><br><span class=\"line\">    logging.info(<span class=\"string\">&#x27;scraping %s&#x27;</span>, url) </span><br><span class=\"line\">    response = requests.get(url, verify=<span class=\"literal\">False</span>) </span><br><span class=\"line\">    end_time = time.time() </span><br><span class=\"line\">    </span><br><span class=\"line\">logging.info(<span class=\"string\">&#x27;total time %s seconds&#x27;</span>, end_time - start_time)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">42</span>:<span class=\"number\">33</span>,<span class=\"number\">963</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">42</span>:<span class=\"number\">41</span>,<span class=\"number\">377</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">42</span>:<span class=\"number\">47</span>,<span class=\"number\">221</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">42</span>:<span class=\"number\">52</span>,<span class=\"number\">603</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">42</span>:<span class=\"number\">59</span>,<span class=\"number\">745</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">43</span>:06,<span class=\"number\">403</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">6</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">43</span>:<span class=\"number\">12</span>,<span class=\"number\">190</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">7</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">43</span>:<span class=\"number\">20</span>,<span class=\"number\">517</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">8</span></span><br><span class=\"line\"><span class=\"number\">2021</span>-05-<span class=\"number\">31</span> <span class=\"number\">17</span>:<span class=\"number\">43</span>:<span class=\"number\">25</span>,<span class=\"number\">804</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class=\"number\">9</span></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>每个页面都至少要等待 5 秒才能加载出来，因此 100 个页面至少要花费 500 秒的时间，总的爬取时间最终为 513.6 秒，将近 9 分钟。</p>\n<h2 id=\"基本了解\"><a href=\"#基本了解\" class=\"headerlink\" title=\"基本了解\"></a>基本了解</h2><h3 id=\"阻塞\"><a href=\"#阻塞\" class=\"headerlink\" title=\"阻塞\"></a>阻塞</h3><p>阻塞状态指程序未得到所需计算资源时被挂起的状态。程序在等待某个操作完成期间，自身无法继续处理其他的事情，则称该程序在该操作上是阻塞的。</p>\n<p>常见的阻塞形式有：网络 <code>I/O</code> 阻塞、磁盘 <code>I/O</code> 阻塞、用户输入阻塞等。阻塞是无处不在的，包括 <code>CPU</code> 切换上下文时，所有的进程都无法真正处理事情，它们也会被阻塞。如果是多核 <code>CPU</code> 则正在执行上下文切换操作的核不可被利用。</p>\n<h3 id=\"非阻塞\"><a href=\"#非阻塞\" class=\"headerlink\" title=\"非阻塞\"></a>非阻塞</h3><p>非程序在等待某操作过程中，自身不被阻塞，可以继续处理其他的事情，则称该程序在该操作上是非阻塞的。</p>\n<p>非阻塞并不是在任何程序级别、任何情况下都可以存在的。仅当程序封装的级别可以囊括独立的子程序单元时，它才可能存在非阻塞状态。</p>\n<p>非阻塞的存在是因为阻塞存在，正因为某个操作阻塞导致的耗时与效率低下，才要把它变成非阻塞的。</p>\n<h3 id=\"同步\"><a href=\"#同步\" class=\"headerlink\" title=\"同步\"></a>同步</h3><p>不同程序单元为了完成某个任务，在执行过程中需靠某种通信方式以协调一致，我们称这些程序单元是同步执行的。</p>\n<p>例如购物系统中更新商品库存，需要用“行锁”作为通信信号，让不同的更新请求强制排队顺序执行，那更新库存的操作是同步的。</p>\n<p>简言之，同步意味着有序。</p>\n<h3 id=\"异步\"><a href=\"#异步\" class=\"headerlink\" title=\"异步\"></a>异步</h3><p>为完成某个任务，不同程序单元之间过程中无需通信协调，也能完成任务的方式，不相关的程序单元之间可以是异步的。</p>\n<p>例如，爬虫下载网页。调度程序调用下载程序后，即可调度其他任务，而无需与该下载任务保持通信以协调行为。不同网页的下载、保存等操作都是无关的，也无需相互通知协调。这些异步操作的完成时刻并不确定。</p>\n<p>简言之，异步意味着无序。</p>\n<h3 id=\"多进程\"><a href=\"#多进程\" class=\"headerlink\" title=\"多进程\"></a>多进程</h3><p>多进程就是利用 <code>CPU</code> 的多核优势，在同一时间并行地执行多个任务，可以大大提高执行效率。</p>\n<h3 id=\"协程\"><a href=\"#协程\" class=\"headerlink\" title=\"协程\"></a>协程</h3><p>协程，英文叫作 <code>Coroutine</code>，又称微线程、纤程，协程是一种用户态的轻量级线程。</p>\n<p>协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈。因此协程能保留上一次调用时的状态，即所有局部状态的一 个特定组合，每次过程重入时，就相当于进入上一次调用的状态。</p>\n<p>协程本质上是个单进程，协程相对于多进程来说，无需线程上下文切换的开销，无需原子操作锁定及同步的开销，编程模型也非常简单。</p>\n<p>可以使用协程来实现异步操作，比如在网络爬虫场景下，发出一个请求之后，需要等待一定的时间才能得到响应，但其实在这个等待过程中，程序可以干许多其他的事情，等到响应得到之后才切换回 来继续处理，这样可以充分利用 <code>CPU</code> 和其他资源，这就是协程的优势。</p>\n<h2 id=\"协程用法\"><a href=\"#协程用法\" class=\"headerlink\" title=\"协程用法\"></a>协程用法</h2><p>从 Python 3.4 开始，Python中加入了协程的概念，但这个版本的协程还是以生成器对象为基础的，在 Python 3.5 则增加了 <code>async/await</code>，使得协程的实现更加方便。 Python中使用协程最常用的库莫过于 <code>asyncio</code>，所以本文会以 <code>asyncio</code> 为基础来介绍协程的使用。</p>\n<p>首先需要了解下面几个概念。</p>\n<ul>\n<li><code>event_loop</code>：事件循环，相当于一个无限循环，我们可以把一些函数注册到这个事件循环上，当满足条件发生的时候，就会调用对应的处理方法。</li>\n<li><code>coroutine</code>：中文翻译叫协程，在 <code>Python中</code>常指代为协程对象类型，可以将协程对象注册到时间循环中，它会被事件循环调用。可以使用 <code>async</code> 关键字来定义一个方法，这个方法在调用时不会立即 被执行，而是返回一个协程对象。</li>\n<li><code>task</code>：任务，它是对协程对象的进一步封装，包含了任务的各个状态。</li>\n<li><code>future</code>：代表将来执行或没有执行的任务的结果，实际上和 <code>task</code> 没有本质区别。 </li>\n</ul>\n<p>另外还需要了解 <code>async/await</code> 关键字，它是从 <code>Python 3.5</code> 才出现的，专门用于定义协程。其中，<code>async</code> 定义一个协程，<code>await</code> 用来挂起阻塞方法的执行。</p>\n<h3 id=\"定义协程\"><a href=\"#定义协程\" class=\"headerlink\" title=\"定义协程\"></a>定义协程</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio  <span class=\"comment\"># 引入asyncio包</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">execute</span>(<span class=\"params\">x</span>):</span>   <span class=\"comment\"># 使用async定义一个exexute方法</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Number:&#x27;</span>, x)</span><br><span class=\"line\"></span><br><span class=\"line\">coroutine = execute(<span class=\"number\">1</span>)  <span class=\"comment\"># 直接调用这个方法，没有直接执行，返回协程对象</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;返回的协程对象：&#x27;</span>, coroutine)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;After calling execute&#x27;</span>)</span><br><span class=\"line\">loop = asyncio.get_event_loop()     <span class=\"comment\"># 创建事件循环loop</span></span><br><span class=\"line\">loop.run_until_complete(coroutine)  <span class=\"comment\"># 调用loop对象的run_until_complete方法将协程注册到事件循环中</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;After calling loop&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">返回的协程对象： &lt;coroutine <span class=\"built_in\">object</span> execute at <span class=\"number\">0x0000015A83EAE740</span>&gt;</span><br><span class=\"line\">After calling execute</span><br><span class=\"line\">Number: <span class=\"number\">1</span></span><br><span class=\"line\">After calling loop</span><br></pre></td></tr></table></figure>\n\n<p><code>async</code>定义的方法无法直接执行，会变成一个协程对象，必须注册到事件循环中才可以执行。</p>\n<p>协程对象可以进一步的被封装成<code>task</code>对象，如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">execute</span>(<span class=\"params\">x</span>):</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Number&#x27;</span>, x)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x</span><br><span class=\"line\"></span><br><span class=\"line\">coroutine = execute(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;协程对象:&#x27;</span>, coroutine)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;After calling execute&#x27;</span>)</span><br><span class=\"line\">loop = asyncio.get_event_loop()</span><br><span class=\"line\">task = loop.create_task(coroutine)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Task对象&#x27;</span>, task)</span><br><span class=\"line\">loop.run_until_complete(task)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Task对象:&#x27;</span>, task)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;After calling loop&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">协程对象: &lt;coroutine <span class=\"built_in\">object</span> execute at <span class=\"number\">0x00000180F83EE6C0</span>&gt;</span><br><span class=\"line\">After calling execute</span><br><span class=\"line\">Task对象 &lt;Task pending name=<span class=\"string\">&#x27;Task-1&#x27;</span> coro=&lt;execute() running at secondeCourse.py:<span class=\"number\">3</span>&gt;&gt;</span><br><span class=\"line\">Number <span class=\"number\">1</span></span><br><span class=\"line\">Task对象: &lt;Task finished name=<span class=\"string\">&#x27;Task-1&#x27;</span> coro=&lt;execute() done, defined at secondeCourse.py:<span class=\"number\">3</span>&gt; result=<span class=\"number\">1</span>&gt;</span><br><span class=\"line\">After calling loop</span><br></pre></td></tr></table></figure>\n\n<p>可以看到定义了loop对象之后，调用它的create_task方法将coroutine对象转化成task对象，随后打印发现它是pending状态。接着将task对象添加到事件循环中执行，之后再打印输出一下task对象，它的状态就变成了finished，同时可以看到result变成了1，就是定义的execute方法返回的结果。</p>\n<p>还有另外的方法可以定义task对象，直接通过ayncio的ensure_future方法，返回结果也是task对象。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">execute</span>(<span class=\"params\">x</span>):</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Number&#x27;</span>, x)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x</span><br><span class=\"line\"></span><br><span class=\"line\">coroutine = execute(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;协程对象:&#x27;</span>, coroutine)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;After calling execute&#x27;</span>)</span><br><span class=\"line\">task = asyncio.ensure_future(coroutine)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Task对象&#x27;</span>, task)</span><br><span class=\"line\">loop = asyncio.get_event_loop()</span><br><span class=\"line\">loop.run_until_complete(task)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Task对象:&#x27;</span>, task)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;After calling loop&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">协程对象: &lt;coroutine <span class=\"built_in\">object</span> execute at <span class=\"number\">0x00000180F83EE6C0</span>&gt;</span><br><span class=\"line\">After calling execute</span><br><span class=\"line\">Task对象 &lt;Task pending name=<span class=\"string\">&#x27;Task-1&#x27;</span> coro=&lt;execute() running at secondeCourse.py:<span class=\"number\">3</span>&gt;&gt;</span><br><span class=\"line\">Number <span class=\"number\">1</span></span><br><span class=\"line\">Task对象: &lt;Task finished name=<span class=\"string\">&#x27;Task-1&#x27;</span> coro=&lt;execute() done, defined at secondeCourse.py:<span class=\"number\">3</span>&gt; result=<span class=\"number\">1</span>&gt;</span><br><span class=\"line\">After calling loop</span><br></pre></td></tr></table></figure>\n\n<p>其运行效果都是一样的。</p>\n<h3 id=\"绑定回调\"><a href=\"#绑定回调\" class=\"headerlink\" title=\"绑定回调\"></a>绑定回调</h3><p>可以为某个task绑定回调函数。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">request</span>():</span></span><br><span class=\"line\">    url = <span class=\"string\">&#x27;https://www.baidu.com&#x27;</span></span><br><span class=\"line\">    status = requests.get(url)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> status</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">callback</span>(<span class=\"params\">task</span>):</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;task状态：&#x27;</span>, task.result())</span><br><span class=\"line\"></span><br><span class=\"line\">coroutine = request()</span><br><span class=\"line\">task = asyncio.ensure_future(coroutine)     <span class=\"comment\"># 创建task对象</span></span><br><span class=\"line\">task.add_done_callback(callback)    <span class=\"comment\"># 添加task回调函数</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Task对象：&#x27;</span>, task)</span><br><span class=\"line\"></span><br><span class=\"line\">loop = asyncio.get_event_loop()</span><br><span class=\"line\">loop.run_until_complete(task)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;Taskd对象：&quot;</span>, task)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Task对象： &lt;Task pending name=<span class=\"string\">&#x27;Task-1&#x27;</span> coro=&lt;request() running at task_callback.py:<span class=\"number\">9</span>]&gt;</span><br><span class=\"line\">task状态： &lt;Response [<span class=\"number\">200</span>]&gt;</span><br><span class=\"line\">Taskd对象： &lt;Task finished name=<span class=\"string\">&#x27;Task-1&#x27;</span> coro=&lt;request() done, defined at task_callback.py:<span class=\"number\">4</span>&gt; result=&lt;Response [<span class=\"number\">200</span>]&gt;&gt;</span><br></pre></td></tr></table></figure>\n\n<p>调用add_done_task方法，将callback方法传递给封装好的task对象，当task对象执行完毕后就可以调用callback方法，同时task对象还会作为参数传递给callback方法，调用task对象的result方法就可以获取返回结果。</p>\n<h3 id=\"多任务协程\"><a href=\"#多任务协程\" class=\"headerlink\" title=\"多任务协程\"></a>多任务协程</h3><p>如果要执行过次请求，可以顶一个task列表，然后使用asyncio的wait方法。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">request</span>():</span></span><br><span class=\"line\">    url = <span class=\"string\">&#x27;https://www.baidu.com&#x27;</span></span><br><span class=\"line\">    status = requests.get(url)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> status</span><br><span class=\"line\"></span><br><span class=\"line\">tasks = [asyncio.ensure_future(request()) <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">5</span>)]    <span class=\"comment\"># 创建包含5个task的列表</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Tasks:\\n&#x27;</span>, tasks)</span><br><span class=\"line\"></span><br><span class=\"line\">loop = asyncio.get_event_loop()</span><br><span class=\"line\">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> task <span class=\"keyword\">in</span> tasks:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Task results:\\n&#x27;</span>, task.result())</span><br></pre></td></tr></table></figure>\n\n<p>运行结果：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Tasks:</span><br><span class=\"line\"> [&lt;Task pending name=<span class=\"string\">&#x27;Task-1&#x27;</span> coro=&lt;request() running at 多任务协程.py:<span class=\"number\">4</span>&gt;&gt;, &lt;Task pending name=<span class=\"string\">&#x27;Task-2&#x27;</span> coro=&lt;request() running at 多任务协程.py:<span class=\"number\">4</span>&gt;&gt;, &lt;Task pending name=<span class=\"string\">&#x27;Task-3&#x27;</span> coro=&lt;request() running at 多任务协程.py:<span class=\"number\">4</span>&gt;&gt;, &lt;Task pending name=<span class=\"string\">&#x27;Task-4&#x27;</span> coro=&lt;request() running at 多任务协程.py:<span class=\"number\">4</span>&gt;&gt;, &lt;Task pending name=<span class=\"string\">&#x27;Task-5&#x27;</span> coro=&lt;request() running at 多任务协程.py:<span class=\"number\">4</span>&gt;&gt;]</span><br><span class=\"line\">Task results:</span><br><span class=\"line\"> &lt;Response [<span class=\"number\">200</span>]&gt;</span><br><span class=\"line\">Task results:</span><br><span class=\"line\"> &lt;Response [<span class=\"number\">200</span>]&gt;</span><br><span class=\"line\">Task results:</span><br><span class=\"line\"> &lt;Response [<span class=\"number\">200</span>]&gt;</span><br><span class=\"line\">Task results:</span><br><span class=\"line\"> &lt;Response [<span class=\"number\">200</span>]&gt;</span><br><span class=\"line\">Task results:</span><br><span class=\"line\"> &lt;Response [<span class=\"number\">200</span>]&gt;</span><br></pre></td></tr></table></figure>\n\n<p>可以看到五个任务被顺次执行了，并得到了运行结果。</p>\n<h2 id=\"使用aiohttp\"><a href=\"#使用aiohttp\" class=\"headerlink\" title=\"使用aiohttp\"></a>使用aiohttp</h2><p>aiohttp是一个支持异步请求的库，利用它和asyncio配合可以实现异步请求操作。</p>\n<p>安装：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install aiohttp</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> aiohttp</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\">start = time.time()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    session = aiohttp.ClientSession()   <span class=\"comment\"># 创建异步会话</span></span><br><span class=\"line\">    response = <span class=\"keyword\">await</span> session.get(url)   <span class=\"comment\"># 异步会话请求返回的响应体</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> response.text()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> session.close()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">request</span>():</span></span><br><span class=\"line\">    url = <span class=\"string\">&#x27;https://holychan.ltd&#x27;</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;等待获取网站信息&#x27;</span>)</span><br><span class=\"line\">    response = <span class=\"keyword\">await</span> get(url)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;获取来自&#x27;</span>, url, <span class=\"string\">&#x27;的响应&#x27;</span>, response)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">tasks = [asyncio.ensure_future(request()) <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>)]</span><br><span class=\"line\">loop = asyncio.get_event_loop()</span><br><span class=\"line\">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class=\"line\"></span><br><span class=\"line\">end = time.time()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;总共耗时：&#x27;</span>, end - start)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">等待获取网站信息</span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class=\"number\">200</span> OK]&gt;</span><br><span class=\"line\">&lt;CIMultiDictProxy(<span class=\"string\">&#x27;Server&#x27;</span>: <span class=\"string\">&#x27;nginx/1.14.1&#x27;</span>, <span class=\"string\">&#x27;Date&#x27;</span>: <span class=\"string\">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/html&#x27;</span>, <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"string\">&#x27;44552&#x27;</span>, <span class=\"string\">&#x27;Last-Modified&#x27;</span>: <span class=\"string\">&#x27;Tue, </span></span><br><span class=\"line\"><span class=\"string\">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class=\"string\">&#x27;Connection&#x27;</span>: <span class=\"string\">&#x27;keep-alive&#x27;</span>, <span class=\"string\">&#x27;Etag&#x27;</span>: <span class=\"string\">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class=\"string\">&#x27;Accept-Ranges&#x27;</span>: <span class=\"string\">&#x27;bytes&#x27;</span>)&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">总共耗时： <span class=\"number\">1.3632490634918213</span></span><br></pre></td></tr></table></figure>\n\n<p>代码里面我们使用了<code>await</code>，后面跟了 get 方法，在执行这 10 个协程的时候，如果遇到了<code>awai</code>t，那么就会将当前协程挂起，转而去执行其他的协程，直到其他的协程也挂起或执行完毕，再进行下一个协程的执行。</p>\n<p>开始运行时，时间循环会运行第一个<code>task</code>，针对第一个 <code>task</code> 来说，当执行到第一个 <code>await</code> 跟着的 get 方法时，它被挂起，但这个 get 方法第一步的执行是非阻塞的，挂起之后立马被唤醒，所以立即又进入执行， 创建了 ClientSession对象，接着遇到了第二个 await，调用了 <code>session.get</code> 请求方法，然后就被挂起了，由于请求需要耗时很久，所以一直没有被唤醒。</p>\n<p>当第一个 task 被挂起了，那接下来该怎么办呢？事件循环会寻找当前未被挂起的协程继续执行，于是就转而执行第二个 task 了，也是一样的流程操作，直到执行了第十个 task 的 <code>session.get</code> 方法之后，全部的 task 都被挂起了。所有 task 都已经处于挂起状态，怎么办？只好等待了。几个请求几乎同时都有了响应，然后几个 task 也被唤醒接着执行，输出请求结果。</p>\n<p>以百度为例，来测试下并发数量为 1、3、5、10、…、500 的情况下的耗时情况，代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> aiohttp</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">test</span>(<span class=\"params\">number</span>):</span></span><br><span class=\"line\">    start = time.time()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">        session = aiohttp.ClientSession()</span><br><span class=\"line\">        response =<span class=\"keyword\">await</span> session.get(url)</span><br><span class=\"line\">        <span class=\"keyword\">await</span> response.text()</span><br><span class=\"line\">        <span class=\"keyword\">await</span> session.close()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">request</span>():</span></span><br><span class=\"line\">        url = <span class=\"string\">&quot;https://www.baidu.com&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">await</span> get(url)</span><br><span class=\"line\">        </span><br><span class=\"line\">    tasks = [asyncio.ensure_future(request()) <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(number)]</span><br><span class=\"line\">    loop = asyncio.get_event_loop()</span><br><span class=\"line\">    loop.run_until_complete(asyncio.wait(tasks))</span><br><span class=\"line\"></span><br><span class=\"line\">    end = time.time()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Number:&#x27;</span>, number, <span class=\"string\">&#x27;Cost time:&#x27;</span>, end - start)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> number <span class=\"keyword\">in</span> [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>, <span class=\"number\">9</span>, <span class=\"number\">10</span>, <span class=\"number\">50</span>, <span class=\"number\">100</span>, <span class=\"number\">200</span>, <span class=\"number\">500</span>]:</span><br><span class=\"line\">    test(number)</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Number: <span class=\"number\">1</span> Cost time: <span class=\"number\">0.36544227600097656</span></span><br><span class=\"line\">Number: <span class=\"number\">3</span> Cost time: <span class=\"number\">0.24126696586608887</span></span><br><span class=\"line\">Number: <span class=\"number\">5</span> Cost time: <span class=\"number\">0.248154878616333</span></span><br><span class=\"line\">Number: <span class=\"number\">7</span> Cost time: <span class=\"number\">0.2729628086090088</span></span><br><span class=\"line\">Number: <span class=\"number\">9</span> Cost time: <span class=\"number\">0.46077466011047363</span></span><br><span class=\"line\">Number: <span class=\"number\">10</span> Cost time: <span class=\"number\">0.2601125240325928</span></span><br><span class=\"line\">Number: <span class=\"number\">50</span> Cost time: <span class=\"number\">0.5060205459594727</span></span><br><span class=\"line\">Number: <span class=\"number\">100</span> Cost time: <span class=\"number\">0.4680452346801758</span></span><br><span class=\"line\">Number: <span class=\"number\">500</span> Cost time: <span class=\"number\">2.809006929397583</span></span><br></pre></td></tr></table></figure>\n\n<p>可以看到，即使增加了并发数量，但在服务器能承受高并发的前提下，其爬取速度几乎不太受影响。</p>\n"},{"title":"经典豆瓣TOP250爬取","comments":1,"toc":true,"only":["home","category","tag"],"date":"2021-06-04T13:34:51.000Z","pic":null,"_content":"\n## 经典案例\n\n每个学习爬虫的人都爬过的豆瓣电影TOP250，先看下[长什么样](https://movie.douban.com/top250)。\n\n![](Screenshot_1.webp)\n\n开爬。\n\n## 分析\n\n查看源代码，所有的数据都在页面源代码中，直接用requests请求拿过来页面源代码，再通过re匹配即可。\n\n```python\nimport requests\nimport re\nimport csv\nimport codecs\n\n# 要抓取的目标网址，豆瓣电影TOP250\nBASE_URL = \"https://movie.douban.com/top250\"\n\n\ndef request(url):\n    \"\"\"获取页面源代码\n        url: 目标网址\n        return: 页面源码\"\"\"\n    headers = {\n        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.77 Safari/537.36 Edg/91.0.864.37\"\n    }\n    response = requests.get(url=url, headers=headers)\n    page_content = response.text\n    return page_content\n\n\ndef parse(page_content):\n    \"\"\"解析页面\"\"\"\n    partern = re.compile(\n        r'<li>.*?<div class=\"item\">.*?<img width=\"100\".*?src=\"(?P<image_url>.*?)\"'\n        r'.*?<span class=\"title\">(?P<name>.*?)'\n        r'</span>.*?<p class=\"\">.*?<br>(?P<year>.*?)&nbsp.*?<span class=\"rating_num\" property=\"v:average\">(?P<score>.*?)</span>.*?'\n        r'<span>(?P<number>.*?)人评价</span>', re.S)\n\n    parse_result = partern.finditer(page_content)\n    for item in parse_result:\n        # print(item.group(\"name\"))\n        # print(item.group(\"year\").strip())\n        # print(item.group(\"score\"))\n        # print(item.group(\"number\"))\n        # print(item.group(\"image_url\"))\n        dic = item.groupdict()\n        dic['year'] = dic['year'].strip()\n        csv_writer(\"data.csv\", dic.values())\n\n\ndef csv_writer(filename: str, value: object):\n    \"\"\"csv写入函数\"\"\"\n    f = codecs.open(filename, mode=\"a\", encoding=\"utf-8\")\n    csvwriter = csv.writer(f)\n    csvwriter.writerow(value)\n    f.close()\n\n\nif __name__ == '__main__':\n    for i in range(10):\n        target_url = BASE_URL + '?start={}&filter='.format(str(i * 25))\n        # print(target_url)\n        page_content = request(target_url)\n        parse(page_content)\n```\n\n保存到data.csv\n\n```csv\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p480747492.jpg,肖申克的救赎,1994,9.7,2363296\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2561716440.jpg,霸王别姬,1993,9.6,1759688\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2372307693.jpg,阿甘正传,1994,9.5,1780693\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p511118051.jpg,这个杀手不太冷,1994,9.4,1953794\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p457760035.jpg,泰坦尼克号,1997,9.4,1741778\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2578474613.jpg,美丽人生,1997,9.6,1094798\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2557573348.jpg,千与千寻,2001,9.4,1857168\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p492406163.jpg,辛德勒的名单,1993,9.5,908938\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2616355133.jpg,盗梦空间,2010,9.3,1717903\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p524964039.jpg,忠犬八公的故事,2009,9.4,1180113\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2614988097.jpg,星际穿越,2014,9.3,1390653\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p479682972.jpg,楚门的世界,1998,9.3,1307123\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2574551676.jpg,海上钢琴师,1998,9.3,1395475\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p579729551.jpg,三傻大闹宝莱坞,2009,9.2,1568001\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1461851991.jpg,机器人总动员,2008,9.3,1103099\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1910824951.jpg,放牛班的春天,2004,9.3,1087370\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2564556863.jpg,无间道,2002,9.3,1058718\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2614500649.jpg,疯狂动物城,2016,9.2,1535791\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2455050536.jpg,大话西游之大圣娶亲,1995,9.2,1270103\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1363250216.jpg,熔炉,2011,9.3,770798\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p616779645.jpg,教父,1972,9.3,772761\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2614359276.jpg,当幸福来敲门,2006,9.1,1260649\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2540924496.jpg,龙猫,1988,9.2,1051778\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p501177648.jpg,怦然心动,2010,9.1,1492708\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1505392928.jpg,控方证人,1957,9.6,371278\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1454261925.jpg,触不可及,2011,9.3,828170\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p462657443.jpg,蝙蝠侠：黑暗骑士,2008,9.2,861486\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p452089833.jpg,末代皇帝,1987,9.3,665966\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2614500706.jpg,寻梦环游记,2017,9.1,1307556\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2524040532.jpg,活着,1994,9.3,669518\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2642829472.jpg,指环王3：王者无敌,2003,9.2,653616\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p1963126880.jpg,乱世佳人,1939,9.3,567787\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2555295759.jpg,何以为家,2018,9.1,830389\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2614949805.jpg,哈利·波特与魔法石,2001,9.1,882053\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p485887754.jpg,飞屋环游记,2009,9.0,1098265\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2118532944.jpg,素媛,2013,9.3,544710\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2401676338.jpg,摔跤吧！爸爸,2016,9.0,1298769\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1784592701.jpg,少年派的奇幻漂流,2012,9.1,1148125\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2173577632.jpg,十二怒汉,1957,9.4,381454\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2174346180.jpg,哈尔的移动城堡,2004,9.1,819033\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2553104888.jpg,鬼子来了,2000,9.3,508031\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2561305376.jpg,我不是药神,2018,9.0,1726641\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2561721372.jpg,大话西游之月光宝盒,1995,9.0,1011850\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1446261379.jpg,天空之城,1986,9.1,689301\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2550757929.jpg,闻香识女人,1992,9.1,706224\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2189265085.jpg,罗马假日,1953,9.0,800710\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2640236255.jpg,指环王2：双塔奇兵,2002,9.1,609036\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p453924541.jpg,猫鼠游戏,2002,9.1,734119\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2653054340.jpg,天堂电影院,1988,9.2,525154\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2158166535.jpg,辩护人,2013,9.2,500175\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2640234840.jpg,指环王1：护戒使者,2001,9.1,693680\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2184505167.jpg,大闹天宫,1961(中国大陆) / 1964(中国大陆) / 1978(中国大陆) / 2004(中国大陆),9.4,340208\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p792376093.jpg,钢琴家,2002,9.2,457919\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2277799019.jpg,狮子王,1994,9.1,679213\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2194138787.jpg,教父2,1974,9.2,433973\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2575465690.jpg,死亡诗社,1989,9.1,571996\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910926158.jpg,搏击俱乐部,1999,9.0,704145\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p451926968.jpg,黑客帝国,1999,9.0,659879\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1512562287.jpg,让子弹飞,2010,8.9,1337990\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2549177902.jpg,绿皮书,2018,8.9,1284278\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1910899751.jpg,饮食男女,1994,9.1,485412\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p1665997400.jpg,美丽心灵,2001,9.0,625114\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2554525534.jpg,海蒂和爷爷,2015,9.2,377506\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1808872109.jpg,窃听风暴,2006,9.2,462123\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p792443418.jpg,两杆大烟枪,1998,9.1,498097\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2192535722.jpg,本杰明·巴顿奇事,2008,8.9,811159\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2648230660.jpg,情书,1995,8.9,820384\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2498971355.jpg,看不见的客人,2016,8.8,998583\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p792238287.jpg,飞越疯人院,1975,9.1,473438\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1473670352.jpg,穿条纹睡衣的男孩,2008,9.1,425919\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2441988159.jpg,西西里的美丽传说,2000,8.9,801233\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1014542496.jpg,拯救大兵瑞恩,1998,9.0,530981\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2165511465.jpg,小鞋子,1997,9.2,333521\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p453788577.jpg,音乐之声,1965,9.1,491814\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2634997853.jpg,阿凡达,2009,8.8,1160560\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2559579779.jpg,海豚湾,2009,9.3,311697\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p480383375.jpg,致命魔术,2006,8.9,706971\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p477229647.jpg,美国往事,1984,9.2,340334\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1593414327.jpg,沉默的羔羊,1991,8.9,702654\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1832875827.jpg,禁闭岛,2010,8.8,779670\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2209066019.jpg,蝴蝶效应,2004,8.8,765655\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1910902213.jpg,低俗小说,1994,8.9,682056\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p480965695.jpg,心灵捕手,1997,8.9,577385\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2178872593.jpg,布达佩斯大饭店,2014,8.9,731182\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2219586434.jpg,七宗罪,1995,8.8,794001\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p465939041.jpg,春光乍泄,1997,8.9,515164\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p917846733.jpg,哈利·波特与死亡圣器(下),2011,8.9,639906\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2263408369.jpg,摩登时代,1936,9.3,237607\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p884763596.jpg,被嫌弃的松子的一生,2006,8.9,602295\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2579932167.jpg,喜剧之王,1999,8.8,788367\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2558364386.jpg,致命ID,2003,8.8,657787\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p657823840.jpg,杀人回忆,2003,8.9,557770\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1596085504.jpg,加勒比海盗,2003,8.8,715622\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p480956937.jpg,剪刀手爱德华,1990,8.7,898594\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2004174709.jpg,勇敢的心,1995,8.9,490782\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1546987967.jpg,狩猎,2012,9.1,306982\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2505525050.jpg,请以你的名字呼唤我,2017,8.9,557338\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p456825720.jpg,红辣椒,2006,9.0,349004\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2604889017.jpg,断背山,2005,8.8,600191\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1816276065.jpg,7号房的礼物,2013,8.9,446140\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2447590313.jpg,天使爱美丽,2001,8.7,848389\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1613191025.jpg,幽灵公主,1997,8.9,442085\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2564498893.jpg,小森林 夏秋篇,2014,9.0,349196\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2220184425.jpg,第六感,1999,8.9,451081\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2564685215.jpg,阳光灿烂的日子,1994,8.8,511391\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p792381411.jpg,重庆森林,1994,8.8,652297\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1305562621.jpg,超脱,2011,8.9,408428\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2219011938.jpg,功夫,2004,8.7,839875\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2357915564.jpg,唐伯虎点秋香,1993,8.7,864732\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2555762374.jpg,爱在黎明破晓前,1995,8.8,512829\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2544912792.jpg,人生果实,2017,9.5,139445\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2215147728.jpg,小森林 冬春篇,2015,9.0,313078\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2567845803.jpg,一一,2000,9.1,293722\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1706428744.jpg,蝙蝠侠：黑暗骑士崛起,2012,8.8,589732\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2620392435.jpg,菊次郎的夏天,1999,8.8,470519\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2635433927.jpg,入殓师,2008,8.9,483243\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2221768894.jpg,消失的爱人,2014,8.7,741730\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p661160053.jpg,无人知晓,2004,9.1,242934\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2414157745.jpg,倩女幽魂,1987,8.7,605138\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2614500883.jpg,超能陆战队,2014,8.7,826422\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p456692072.jpg,侧耳倾听,1995,8.9,379215\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910812549.jpg,哈利·波特与阿兹卡班的囚徒,2004,8.8,512727\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2190556408.jpg,完美的世界,1993,9.1,233065\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p617533616.jpg,借东西的小人阿莉埃蒂,2010,8.8,448723\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2223011274.jpg,甜蜜蜜,1996,8.9,427414\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1675053073.jpg,萤火之森,2011,8.9,423345\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2561542458.jpg,爱在日落黄昏时,2004,8.9,425918\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2210954024.jpg,驯龙高手,2010,8.7,628179\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p488255145.jpg,玛丽和马克思,2009,8.9,367547\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p854757687.jpg,幸福终点站,2004,8.8,449926\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p689520756.jpg,告白,2010,8.7,584313\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2515539487.jpg,天书奇谭,1983(中国大陆),9.2,191303\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p692813374.jpg,大鱼,2003,8.8,474379\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2609063925.jpg,射雕英雄传之东成西就,1993,8.7,533159\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1374786017.jpg,阳光姐妹淘,2011,8.8,509665\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p1082651990.jpg,哈利·波特与密室,2002,8.7,537063\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2513247938.jpg,怪兽电力公司,2001,8.7,539086\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2016930906.jpg,恐怖直播,2013,8.7,533277\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p792776858.jpg,神偷奶爸,2010,8.6,797755\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2070153774.jpg,时空恋旅人,2013,8.8,484144\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1283675359.jpg,玩具总动员3,2010,8.9,415735\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2016401659.jpg,傲慢与偏见,2005,8.7,640438\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2169664351.jpg,教父3,1990,8.9,289948\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2360940399.jpg,釜山行,2016,8.6,959976\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2532803206.jpg,哪吒闹海,1979,9.1,207231\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2398141939.jpg,血战钢锯岭,2016,8.7,657406\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2406624993.jpg,一个叫欧维的男人决定去死,2015,8.9,342088\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1800813767.jpg,被解救的姜戈,2012,8.8,495236\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2215886505.jpg,七武士,1954,9.3,157351\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2249048907.jpg,喜宴,1993,8.9,280196\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1351050722.jpg,未麻的部屋,1997,9.0,239227\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2565332644.jpg,电锯惊魂,2004,8.7,425479\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p652417775.jpg,我是山姆,2001,9.0,259653\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2516578307.jpg,头号玩家,2018,8.6,1138578\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1917567652.jpg,风之谷,1984,8.9,307063\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p455677490.jpg,上帝之城,2002,9.0,255707\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2504997087.jpg,英雄本色,1986,8.7,426643\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p792223507.jpg,谍影重重3,2007,8.8,351487\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1867084027.jpg,疯狂原始人,2013,8.7,712391\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p470419493.jpg,卢旺达饭店,2004,8.9,257402\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2510081688.jpg,三块广告牌,2017,8.7,684406\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1903379979.jpg,新世界,2013,8.9,300798\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1910828286.jpg,花样年华,2000,8.7,475583\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2255040492.jpg,模仿游戏,2014,8.7,504705\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2597918718.jpg,纵横四海,1991,8.8,338906\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p443461818.jpg,黑客帝国3：矩阵革命,2003,8.8,353561\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2166160837.jpg,达拉斯买家俱乐部,2013,8.8,369844\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p456666151.jpg,岁月神偷,2010,8.7,502534\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2276780256.jpg,心迷宫,2014,8.7,409481\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2266293606.jpg,头脑特工队,2015,8.7,488191\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2395733377.jpg,你的名字。,2016,8.4,1134874\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p641688453.jpg,记忆碎片,2000,8.7,508006\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2603716224.jpg,忠犬八公物语,1987,9.2,157136\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2584519452.jpg,荒蛮故事,2014,8.8,353965\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2561439800.jpg,寄生虫,2019,8.8,1125278\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2603364117.jpg,海街日记,2015,8.8,347104\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p475600770.jpg,真爱至上,2003,8.6,600244\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2220776342.jpg,爆裂鼓手,2014,8.7,465097\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2434249040.jpg,贫民窟的百万富翁,2008,8.6,630016\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1982176012.jpg,东邪西毒,1994,8.6,488030\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1021883305.jpg,惊魂记,1960,9.0,209421\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2237136718.jpg,萤火虫之墓,1988,8.7,352414\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p735391084.jpg,哈利·波特与火焰杯,2005,8.6,463960\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2549648344.jpg,黑天鹅,2010,8.6,687717\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2530599636.jpg,小偷家族,2018,8.7,684571\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p767586451.jpg,绿里奇迹,1999,8.9,249136\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1735642656.jpg,无敌破坏王,2012,8.7,437272\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p709670262.jpg,你看起来好像很好吃,2010,8.9,279807\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910895719.jpg,冰川时代,2002,8.6,515039\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2074715729.jpg,爱在午夜降临前,2013,8.8,291034\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p648370300.jpg,九品芝麻官,1994,8.6,499623\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2353324612.jpg,雨人,1988,8.7,342625\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p712241453.jpg,疯狂的石头,2006,8.5,663816\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p483604864.jpg,恋恋笔记本,2004,8.5,542020\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p462470694.jpg,恐怖游轮,2009,8.5,655305\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1612355875.jpg,雨中曲,1952,9.0,170988\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p456676352.jpg,魔女宅急便,1989,8.7,378741\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2507709428.jpg,奇迹男孩,2017,8.6,472600\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p453716305.jpg,色，戒,2007,8.5,579145\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2399597512.jpg,虎口脱险,1966,8.9,198517\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2421855655.jpg,海边的曼彻斯特,2016,8.6,399115\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2560717825.jpg,2001太空漫游,1968,8.8,243088\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p792257137.jpg,人工智能,2001,8.7,362744\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2170238828.jpg,城市之光,1931,9.3,110942\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2363208684.jpg,可可西里,2004,8.8,244594\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2457609817.jpg,二十二,2015,8.7,242128\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2259715855.jpg,房间,2015,8.8,321691\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1598883511.jpg,罗生门,1950,8.8,252804\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1910909085.jpg,终结者2：审判日,1991,8.7,287626\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1505312273.jpg,初恋这件小事,2010,8.4,845669\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2505928032.jpg,大佛普拉斯,2017,8.7,341343\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1481879628.jpg,遗愿清单,2007,8.7,331269\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2549558913.jpg,波西米亚狂想曲,2018,8.7,478280\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p848381236.jpg,牯岭街少年杀人事件,1991,8.9,215299\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p988260245.jpg,源代码,2011,8.5,681677\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2351134499.jpg,魂断蓝桥,1940,8.8,228810\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1421018669.jpg,新龙门客栈,1992,8.6,364204\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2570901292.jpg,青蛇,1993,8.6,423044\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2236181653.jpg,疯狂的麦克斯4：狂暴之路,2015,8.6,429756\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2575043939.jpg,无耻混蛋,2009,8.6,392522\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1244017073.jpg,血钻,2006,8.7,302450\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2375245718.jpg,步履不停,2008,8.8,221179\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1023654037.jpg,燃情岁月,1994,8.8,241510\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2559581324.jpg,海洋,2009,9.1,140256\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p456703618.jpg,东京教父,2003,9.0,150187\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p958008320.jpg,无间道2,2003,8.6,346646\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2187896734.jpg,彗星来的那一夜,2013,8.5,432217\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p667644866.jpg,谍影重重2,2004,8.7,294670\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2079334286.jpg,穿越时空的少女,2006,8.6,326398\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p792282381.jpg,战争之王,2005,8.7,292534\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2525770523.jpg,阿飞正传,1990,8.5,412037\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1973489335.jpg,地球上的星星,2007,8.9,173201\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2522331945.jpg,完美陌生人,2016,8.5,451049\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1597183981.jpg,谍影重重,2002,8.6,352151\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2571500223.jpg,香水,2006,8.5,464907\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2195672555.jpg,千钧一发,1997,8.8,217710\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p443461390.jpg,黑客帝国2：重装上阵,2003,8.6,312981\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1925331564.jpg,东京物语,1953,9.2,109758\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2627847859.jpg,崖上的波妞,2008,8.6,382805\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1075591188.jpg,我爱你,2011,9.1,135121\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1140984198.jpg,朗读者,2008,8.6,397681\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2250287733.jpg,再次出发之纽约遇见你,2013,8.6,351101\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2393044761.jpg,驴得水,2016,8.3,765089\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2263822658.jpg,聚焦,2015,8.8,234727\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1344888983.jpg,浪潮,2008,8.7,228081\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p513567548.jpg,猜火车,1996,8.5,363994\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2510956726.jpg,小萝莉的猴神大叔,2015,8.4,412418\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2561545031.jpg,追随,1998,8.9,152188\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p1910900710.jpg,黑鹰坠落,2001,8.7,244341\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2542848758.jpg,网络谜踪,2018,8.5,439379\n```\n","source":"_posts/经典豆瓣TOP250爬取.md","raw":"---\ntitle: 经典豆瓣TOP250爬取\ntags:\n  - re\n  - requests\ncomments: true\ntoc: true\nonly:\n  - home\n  - category\n  - tag\ndate: 2021-06-04 21:34:51\ncategories: 爬虫\npic:\n---\n\n## 经典案例\n\n每个学习爬虫的人都爬过的豆瓣电影TOP250，先看下[长什么样](https://movie.douban.com/top250)。\n\n![](Screenshot_1.webp)\n\n开爬。\n\n## 分析\n\n查看源代码，所有的数据都在页面源代码中，直接用requests请求拿过来页面源代码，再通过re匹配即可。\n\n```python\nimport requests\nimport re\nimport csv\nimport codecs\n\n# 要抓取的目标网址，豆瓣电影TOP250\nBASE_URL = \"https://movie.douban.com/top250\"\n\n\ndef request(url):\n    \"\"\"获取页面源代码\n        url: 目标网址\n        return: 页面源码\"\"\"\n    headers = {\n        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.77 Safari/537.36 Edg/91.0.864.37\"\n    }\n    response = requests.get(url=url, headers=headers)\n    page_content = response.text\n    return page_content\n\n\ndef parse(page_content):\n    \"\"\"解析页面\"\"\"\n    partern = re.compile(\n        r'<li>.*?<div class=\"item\">.*?<img width=\"100\".*?src=\"(?P<image_url>.*?)\"'\n        r'.*?<span class=\"title\">(?P<name>.*?)'\n        r'</span>.*?<p class=\"\">.*?<br>(?P<year>.*?)&nbsp.*?<span class=\"rating_num\" property=\"v:average\">(?P<score>.*?)</span>.*?'\n        r'<span>(?P<number>.*?)人评价</span>', re.S)\n\n    parse_result = partern.finditer(page_content)\n    for item in parse_result:\n        # print(item.group(\"name\"))\n        # print(item.group(\"year\").strip())\n        # print(item.group(\"score\"))\n        # print(item.group(\"number\"))\n        # print(item.group(\"image_url\"))\n        dic = item.groupdict()\n        dic['year'] = dic['year'].strip()\n        csv_writer(\"data.csv\", dic.values())\n\n\ndef csv_writer(filename: str, value: object):\n    \"\"\"csv写入函数\"\"\"\n    f = codecs.open(filename, mode=\"a\", encoding=\"utf-8\")\n    csvwriter = csv.writer(f)\n    csvwriter.writerow(value)\n    f.close()\n\n\nif __name__ == '__main__':\n    for i in range(10):\n        target_url = BASE_URL + '?start={}&filter='.format(str(i * 25))\n        # print(target_url)\n        page_content = request(target_url)\n        parse(page_content)\n```\n\n保存到data.csv\n\n```csv\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p480747492.jpg,肖申克的救赎,1994,9.7,2363296\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2561716440.jpg,霸王别姬,1993,9.6,1759688\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2372307693.jpg,阿甘正传,1994,9.5,1780693\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p511118051.jpg,这个杀手不太冷,1994,9.4,1953794\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p457760035.jpg,泰坦尼克号,1997,9.4,1741778\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2578474613.jpg,美丽人生,1997,9.6,1094798\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2557573348.jpg,千与千寻,2001,9.4,1857168\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p492406163.jpg,辛德勒的名单,1993,9.5,908938\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2616355133.jpg,盗梦空间,2010,9.3,1717903\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p524964039.jpg,忠犬八公的故事,2009,9.4,1180113\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2614988097.jpg,星际穿越,2014,9.3,1390653\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p479682972.jpg,楚门的世界,1998,9.3,1307123\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2574551676.jpg,海上钢琴师,1998,9.3,1395475\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p579729551.jpg,三傻大闹宝莱坞,2009,9.2,1568001\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1461851991.jpg,机器人总动员,2008,9.3,1103099\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1910824951.jpg,放牛班的春天,2004,9.3,1087370\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2564556863.jpg,无间道,2002,9.3,1058718\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2614500649.jpg,疯狂动物城,2016,9.2,1535791\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2455050536.jpg,大话西游之大圣娶亲,1995,9.2,1270103\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1363250216.jpg,熔炉,2011,9.3,770798\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p616779645.jpg,教父,1972,9.3,772761\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2614359276.jpg,当幸福来敲门,2006,9.1,1260649\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2540924496.jpg,龙猫,1988,9.2,1051778\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p501177648.jpg,怦然心动,2010,9.1,1492708\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1505392928.jpg,控方证人,1957,9.6,371278\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1454261925.jpg,触不可及,2011,9.3,828170\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p462657443.jpg,蝙蝠侠：黑暗骑士,2008,9.2,861486\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p452089833.jpg,末代皇帝,1987,9.3,665966\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2614500706.jpg,寻梦环游记,2017,9.1,1307556\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2524040532.jpg,活着,1994,9.3,669518\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2642829472.jpg,指环王3：王者无敌,2003,9.2,653616\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p1963126880.jpg,乱世佳人,1939,9.3,567787\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2555295759.jpg,何以为家,2018,9.1,830389\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2614949805.jpg,哈利·波特与魔法石,2001,9.1,882053\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p485887754.jpg,飞屋环游记,2009,9.0,1098265\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2118532944.jpg,素媛,2013,9.3,544710\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2401676338.jpg,摔跤吧！爸爸,2016,9.0,1298769\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1784592701.jpg,少年派的奇幻漂流,2012,9.1,1148125\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2173577632.jpg,十二怒汉,1957,9.4,381454\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2174346180.jpg,哈尔的移动城堡,2004,9.1,819033\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2553104888.jpg,鬼子来了,2000,9.3,508031\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2561305376.jpg,我不是药神,2018,9.0,1726641\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2561721372.jpg,大话西游之月光宝盒,1995,9.0,1011850\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1446261379.jpg,天空之城,1986,9.1,689301\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2550757929.jpg,闻香识女人,1992,9.1,706224\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2189265085.jpg,罗马假日,1953,9.0,800710\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2640236255.jpg,指环王2：双塔奇兵,2002,9.1,609036\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p453924541.jpg,猫鼠游戏,2002,9.1,734119\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2653054340.jpg,天堂电影院,1988,9.2,525154\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2158166535.jpg,辩护人,2013,9.2,500175\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2640234840.jpg,指环王1：护戒使者,2001,9.1,693680\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2184505167.jpg,大闹天宫,1961(中国大陆) / 1964(中国大陆) / 1978(中国大陆) / 2004(中国大陆),9.4,340208\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p792376093.jpg,钢琴家,2002,9.2,457919\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2277799019.jpg,狮子王,1994,9.1,679213\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2194138787.jpg,教父2,1974,9.2,433973\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2575465690.jpg,死亡诗社,1989,9.1,571996\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910926158.jpg,搏击俱乐部,1999,9.0,704145\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p451926968.jpg,黑客帝国,1999,9.0,659879\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1512562287.jpg,让子弹飞,2010,8.9,1337990\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2549177902.jpg,绿皮书,2018,8.9,1284278\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1910899751.jpg,饮食男女,1994,9.1,485412\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p1665997400.jpg,美丽心灵,2001,9.0,625114\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2554525534.jpg,海蒂和爷爷,2015,9.2,377506\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1808872109.jpg,窃听风暴,2006,9.2,462123\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p792443418.jpg,两杆大烟枪,1998,9.1,498097\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2192535722.jpg,本杰明·巴顿奇事,2008,8.9,811159\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2648230660.jpg,情书,1995,8.9,820384\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2498971355.jpg,看不见的客人,2016,8.8,998583\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p792238287.jpg,飞越疯人院,1975,9.1,473438\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1473670352.jpg,穿条纹睡衣的男孩,2008,9.1,425919\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2441988159.jpg,西西里的美丽传说,2000,8.9,801233\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1014542496.jpg,拯救大兵瑞恩,1998,9.0,530981\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2165511465.jpg,小鞋子,1997,9.2,333521\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p453788577.jpg,音乐之声,1965,9.1,491814\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2634997853.jpg,阿凡达,2009,8.8,1160560\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2559579779.jpg,海豚湾,2009,9.3,311697\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p480383375.jpg,致命魔术,2006,8.9,706971\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p477229647.jpg,美国往事,1984,9.2,340334\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1593414327.jpg,沉默的羔羊,1991,8.9,702654\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1832875827.jpg,禁闭岛,2010,8.8,779670\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2209066019.jpg,蝴蝶效应,2004,8.8,765655\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1910902213.jpg,低俗小说,1994,8.9,682056\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p480965695.jpg,心灵捕手,1997,8.9,577385\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2178872593.jpg,布达佩斯大饭店,2014,8.9,731182\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2219586434.jpg,七宗罪,1995,8.8,794001\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p465939041.jpg,春光乍泄,1997,8.9,515164\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p917846733.jpg,哈利·波特与死亡圣器(下),2011,8.9,639906\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2263408369.jpg,摩登时代,1936,9.3,237607\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p884763596.jpg,被嫌弃的松子的一生,2006,8.9,602295\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2579932167.jpg,喜剧之王,1999,8.8,788367\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2558364386.jpg,致命ID,2003,8.8,657787\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p657823840.jpg,杀人回忆,2003,8.9,557770\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1596085504.jpg,加勒比海盗,2003,8.8,715622\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p480956937.jpg,剪刀手爱德华,1990,8.7,898594\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2004174709.jpg,勇敢的心,1995,8.9,490782\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1546987967.jpg,狩猎,2012,9.1,306982\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2505525050.jpg,请以你的名字呼唤我,2017,8.9,557338\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p456825720.jpg,红辣椒,2006,9.0,349004\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2604889017.jpg,断背山,2005,8.8,600191\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1816276065.jpg,7号房的礼物,2013,8.9,446140\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2447590313.jpg,天使爱美丽,2001,8.7,848389\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1613191025.jpg,幽灵公主,1997,8.9,442085\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2564498893.jpg,小森林 夏秋篇,2014,9.0,349196\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2220184425.jpg,第六感,1999,8.9,451081\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2564685215.jpg,阳光灿烂的日子,1994,8.8,511391\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p792381411.jpg,重庆森林,1994,8.8,652297\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1305562621.jpg,超脱,2011,8.9,408428\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2219011938.jpg,功夫,2004,8.7,839875\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2357915564.jpg,唐伯虎点秋香,1993,8.7,864732\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2555762374.jpg,爱在黎明破晓前,1995,8.8,512829\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2544912792.jpg,人生果实,2017,9.5,139445\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2215147728.jpg,小森林 冬春篇,2015,9.0,313078\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2567845803.jpg,一一,2000,9.1,293722\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1706428744.jpg,蝙蝠侠：黑暗骑士崛起,2012,8.8,589732\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2620392435.jpg,菊次郎的夏天,1999,8.8,470519\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2635433927.jpg,入殓师,2008,8.9,483243\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2221768894.jpg,消失的爱人,2014,8.7,741730\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p661160053.jpg,无人知晓,2004,9.1,242934\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2414157745.jpg,倩女幽魂,1987,8.7,605138\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2614500883.jpg,超能陆战队,2014,8.7,826422\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p456692072.jpg,侧耳倾听,1995,8.9,379215\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910812549.jpg,哈利·波特与阿兹卡班的囚徒,2004,8.8,512727\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2190556408.jpg,完美的世界,1993,9.1,233065\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p617533616.jpg,借东西的小人阿莉埃蒂,2010,8.8,448723\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2223011274.jpg,甜蜜蜜,1996,8.9,427414\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1675053073.jpg,萤火之森,2011,8.9,423345\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2561542458.jpg,爱在日落黄昏时,2004,8.9,425918\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2210954024.jpg,驯龙高手,2010,8.7,628179\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p488255145.jpg,玛丽和马克思,2009,8.9,367547\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p854757687.jpg,幸福终点站,2004,8.8,449926\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p689520756.jpg,告白,2010,8.7,584313\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2515539487.jpg,天书奇谭,1983(中国大陆),9.2,191303\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p692813374.jpg,大鱼,2003,8.8,474379\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2609063925.jpg,射雕英雄传之东成西就,1993,8.7,533159\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1374786017.jpg,阳光姐妹淘,2011,8.8,509665\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p1082651990.jpg,哈利·波特与密室,2002,8.7,537063\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2513247938.jpg,怪兽电力公司,2001,8.7,539086\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2016930906.jpg,恐怖直播,2013,8.7,533277\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p792776858.jpg,神偷奶爸,2010,8.6,797755\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2070153774.jpg,时空恋旅人,2013,8.8,484144\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1283675359.jpg,玩具总动员3,2010,8.9,415735\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2016401659.jpg,傲慢与偏见,2005,8.7,640438\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2169664351.jpg,教父3,1990,8.9,289948\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2360940399.jpg,釜山行,2016,8.6,959976\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2532803206.jpg,哪吒闹海,1979,9.1,207231\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2398141939.jpg,血战钢锯岭,2016,8.7,657406\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2406624993.jpg,一个叫欧维的男人决定去死,2015,8.9,342088\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1800813767.jpg,被解救的姜戈,2012,8.8,495236\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2215886505.jpg,七武士,1954,9.3,157351\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2249048907.jpg,喜宴,1993,8.9,280196\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1351050722.jpg,未麻的部屋,1997,9.0,239227\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2565332644.jpg,电锯惊魂,2004,8.7,425479\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p652417775.jpg,我是山姆,2001,9.0,259653\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2516578307.jpg,头号玩家,2018,8.6,1138578\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1917567652.jpg,风之谷,1984,8.9,307063\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p455677490.jpg,上帝之城,2002,9.0,255707\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2504997087.jpg,英雄本色,1986,8.7,426643\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p792223507.jpg,谍影重重3,2007,8.8,351487\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1867084027.jpg,疯狂原始人,2013,8.7,712391\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p470419493.jpg,卢旺达饭店,2004,8.9,257402\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2510081688.jpg,三块广告牌,2017,8.7,684406\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1903379979.jpg,新世界,2013,8.9,300798\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1910828286.jpg,花样年华,2000,8.7,475583\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2255040492.jpg,模仿游戏,2014,8.7,504705\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2597918718.jpg,纵横四海,1991,8.8,338906\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p443461818.jpg,黑客帝国3：矩阵革命,2003,8.8,353561\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2166160837.jpg,达拉斯买家俱乐部,2013,8.8,369844\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p456666151.jpg,岁月神偷,2010,8.7,502534\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2276780256.jpg,心迷宫,2014,8.7,409481\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2266293606.jpg,头脑特工队,2015,8.7,488191\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2395733377.jpg,你的名字。,2016,8.4,1134874\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p641688453.jpg,记忆碎片,2000,8.7,508006\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2603716224.jpg,忠犬八公物语,1987,9.2,157136\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2584519452.jpg,荒蛮故事,2014,8.8,353965\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2561439800.jpg,寄生虫,2019,8.8,1125278\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2603364117.jpg,海街日记,2015,8.8,347104\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p475600770.jpg,真爱至上,2003,8.6,600244\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2220776342.jpg,爆裂鼓手,2014,8.7,465097\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p2434249040.jpg,贫民窟的百万富翁,2008,8.6,630016\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1982176012.jpg,东邪西毒,1994,8.6,488030\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1021883305.jpg,惊魂记,1960,9.0,209421\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2237136718.jpg,萤火虫之墓,1988,8.7,352414\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p735391084.jpg,哈利·波特与火焰杯,2005,8.6,463960\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2549648344.jpg,黑天鹅,2010,8.6,687717\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2530599636.jpg,小偷家族,2018,8.7,684571\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p767586451.jpg,绿里奇迹,1999,8.9,249136\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1735642656.jpg,无敌破坏王,2012,8.7,437272\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p709670262.jpg,你看起来好像很好吃,2010,8.9,279807\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910895719.jpg,冰川时代,2002,8.6,515039\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2074715729.jpg,爱在午夜降临前,2013,8.8,291034\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p648370300.jpg,九品芝麻官,1994,8.6,499623\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2353324612.jpg,雨人,1988,8.7,342625\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p712241453.jpg,疯狂的石头,2006,8.5,663816\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p483604864.jpg,恋恋笔记本,2004,8.5,542020\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p462470694.jpg,恐怖游轮,2009,8.5,655305\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1612355875.jpg,雨中曲,1952,9.0,170988\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p456676352.jpg,魔女宅急便,1989,8.7,378741\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2507709428.jpg,奇迹男孩,2017,8.6,472600\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p453716305.jpg,色，戒,2007,8.5,579145\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2399597512.jpg,虎口脱险,1966,8.9,198517\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2421855655.jpg,海边的曼彻斯特,2016,8.6,399115\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2560717825.jpg,2001太空漫游,1968,8.8,243088\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p792257137.jpg,人工智能,2001,8.7,362744\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2170238828.jpg,城市之光,1931,9.3,110942\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2363208684.jpg,可可西里,2004,8.8,244594\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2457609817.jpg,二十二,2015,8.7,242128\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2259715855.jpg,房间,2015,8.8,321691\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1598883511.jpg,罗生门,1950,8.8,252804\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1910909085.jpg,终结者2：审判日,1991,8.7,287626\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1505312273.jpg,初恋这件小事,2010,8.4,845669\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2505928032.jpg,大佛普拉斯,2017,8.7,341343\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1481879628.jpg,遗愿清单,2007,8.7,331269\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2549558913.jpg,波西米亚狂想曲,2018,8.7,478280\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p848381236.jpg,牯岭街少年杀人事件,1991,8.9,215299\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p988260245.jpg,源代码,2011,8.5,681677\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2351134499.jpg,魂断蓝桥,1940,8.8,228810\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1421018669.jpg,新龙门客栈,1992,8.6,364204\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2570901292.jpg,青蛇,1993,8.6,423044\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2236181653.jpg,疯狂的麦克斯4：狂暴之路,2015,8.6,429756\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2575043939.jpg,无耻混蛋,2009,8.6,392522\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1244017073.jpg,血钻,2006,8.7,302450\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2375245718.jpg,步履不停,2008,8.8,221179\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1023654037.jpg,燃情岁月,1994,8.8,241510\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2559581324.jpg,海洋,2009,9.1,140256\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p456703618.jpg,东京教父,2003,9.0,150187\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p958008320.jpg,无间道2,2003,8.6,346646\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2187896734.jpg,彗星来的那一夜,2013,8.5,432217\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p667644866.jpg,谍影重重2,2004,8.7,294670\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2079334286.jpg,穿越时空的少女,2006,8.6,326398\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p792282381.jpg,战争之王,2005,8.7,292534\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2525770523.jpg,阿飞正传,1990,8.5,412037\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1973489335.jpg,地球上的星星,2007,8.9,173201\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2522331945.jpg,完美陌生人,2016,8.5,451049\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1597183981.jpg,谍影重重,2002,8.6,352151\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2571500223.jpg,香水,2006,8.5,464907\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2195672555.jpg,千钧一发,1997,8.8,217710\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p443461390.jpg,黑客帝国2：重装上阵,2003,8.6,312981\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p1925331564.jpg,东京物语,1953,9.2,109758\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2627847859.jpg,崖上的波妞,2008,8.6,382805\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1075591188.jpg,我爱你,2011,9.1,135121\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p1140984198.jpg,朗读者,2008,8.6,397681\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2250287733.jpg,再次出发之纽约遇见你,2013,8.6,351101\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2393044761.jpg,驴得水,2016,8.3,765089\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2263822658.jpg,聚焦,2015,8.8,234727\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p1344888983.jpg,浪潮,2008,8.7,228081\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p513567548.jpg,猜火车,1996,8.5,363994\nhttps://img9.doubanio.com/view/photo/s_ratio_poster/public/p2510956726.jpg,小萝莉的猴神大叔,2015,8.4,412418\nhttps://img2.doubanio.com/view/photo/s_ratio_poster/public/p2561545031.jpg,追随,1998,8.9,152188\nhttps://img3.doubanio.com/view/photo/s_ratio_poster/public/p1910900710.jpg,黑鹰坠落,2001,8.7,244341\nhttps://img1.doubanio.com/view/photo/s_ratio_poster/public/p2542848758.jpg,网络谜踪,2018,8.5,439379\n```\n","slug":"经典豆瓣TOP250爬取","published":1,"updated":"2021-06-15T15:47:31.641Z","layout":"post","photos":[],"link":"","_id":"ckq14rx3z007t44udatvs4se9","content":"<h2 id=\"经典案例\"><a href=\"#经典案例\" class=\"headerlink\" title=\"经典案例\"></a>经典案例</h2><p>每个学习爬虫的人都爬过的豆瓣电影TOP250，先看下<a href=\"https://movie.douban.com/top250\">长什么样</a>。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>开爬。</p>\n<h2 id=\"分析\"><a href=\"#分析\" class=\"headerlink\" title=\"分析\"></a>分析</h2><p>查看源代码，所有的数据都在页面源代码中，直接用requests请求拿过来页面源代码，再通过re匹配即可。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> csv</span><br><span class=\"line\"><span class=\"keyword\">import</span> codecs</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 要抓取的目标网址，豆瓣电影TOP250</span></span><br><span class=\"line\">BASE_URL = <span class=\"string\">&quot;https://movie.douban.com/top250&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">request</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;获取页面源代码</span></span><br><span class=\"line\"><span class=\"string\">        url: 目标网址</span></span><br><span class=\"line\"><span class=\"string\">        return: 页面源码&quot;&quot;&quot;</span></span><br><span class=\"line\">    headers = &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;User-Agent&quot;</span>: <span class=\"string\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.77 Safari/537.36 Edg/91.0.864.37&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    response = requests.get(url=url, headers=headers)</span><br><span class=\"line\">    page_content = response.text</span><br><span class=\"line\">    <span class=\"keyword\">return</span> page_content</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse</span>(<span class=\"params\">page_content</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;解析页面&quot;&quot;&quot;</span></span><br><span class=\"line\">    partern = re.<span class=\"built_in\">compile</span>(</span><br><span class=\"line\">        <span class=\"string\">r&#x27;&lt;li&gt;.*?&lt;div class=&quot;item&quot;&gt;.*?&lt;img width=&quot;100&quot;.*?src=&quot;(?P&lt;image_url&gt;.*?)&quot;&#x27;</span></span><br><span class=\"line\">        <span class=\"string\">r&#x27;.*?&lt;span class=&quot;title&quot;&gt;(?P&lt;name&gt;.*?)&#x27;</span></span><br><span class=\"line\">        <span class=\"string\">r&#x27;&lt;/span&gt;.*?&lt;p class=&quot;&quot;&gt;.*?&lt;br&gt;(?P&lt;year&gt;.*?)&amp;nbsp.*?&lt;span class=&quot;rating_num&quot; property=&quot;v:average&quot;&gt;(?P&lt;score&gt;.*?)&lt;/span&gt;.*?&#x27;</span></span><br><span class=\"line\">        <span class=\"string\">r&#x27;&lt;span&gt;(?P&lt;number&gt;.*?)人评价&lt;/span&gt;&#x27;</span>, re.S)</span><br><span class=\"line\"></span><br><span class=\"line\">    parse_result = partern.finditer(page_content)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> parse_result:</span><br><span class=\"line\">        <span class=\"comment\"># print(item.group(&quot;name&quot;))</span></span><br><span class=\"line\">        <span class=\"comment\"># print(item.group(&quot;year&quot;).strip())</span></span><br><span class=\"line\">        <span class=\"comment\"># print(item.group(&quot;score&quot;))</span></span><br><span class=\"line\">        <span class=\"comment\"># print(item.group(&quot;number&quot;))</span></span><br><span class=\"line\">        <span class=\"comment\"># print(item.group(&quot;image_url&quot;))</span></span><br><span class=\"line\">        dic = item.groupdict()</span><br><span class=\"line\">        dic[<span class=\"string\">&#x27;year&#x27;</span>] = dic[<span class=\"string\">&#x27;year&#x27;</span>].strip()</span><br><span class=\"line\">        csv_writer(<span class=\"string\">&quot;data.csv&quot;</span>, dic.values())</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">csv_writer</span>(<span class=\"params\">filename: <span class=\"built_in\">str</span>, value: <span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;csv写入函数&quot;&quot;&quot;</span></span><br><span class=\"line\">    f = codecs.<span class=\"built_in\">open</span>(filename, mode=<span class=\"string\">&quot;a&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>)</span><br><span class=\"line\">    csvwriter = csv.writer(f)</span><br><span class=\"line\">    csvwriter.writerow(value)</span><br><span class=\"line\">    f.close()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>):</span><br><span class=\"line\">        target_url = BASE_URL + <span class=\"string\">&#x27;?start=&#123;&#125;&amp;filter=&#x27;</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">str</span>(i * <span class=\"number\">25</span>))</span><br><span class=\"line\">        <span class=\"comment\"># print(target_url)</span></span><br><span class=\"line\">        page_content = request(target_url)</span><br><span class=\"line\">        parse(page_content)</span><br></pre></td></tr></table></figure>\n\n<p>保存到data.csv</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p480747492.jpg,肖申克的救赎,1994,9.7,2363296</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2561716440.jpg,霸王别姬,1993,9.6,1759688</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2372307693.jpg,阿甘正传,1994,9.5,1780693</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p511118051.jpg,这个杀手不太冷,1994,9.4,1953794</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p457760035.jpg,泰坦尼克号,1997,9.4,1741778</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2578474613.jpg,美丽人生,1997,9.6,1094798</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2557573348.jpg,千与千寻,2001,9.4,1857168</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p492406163.jpg,辛德勒的名单,1993,9.5,908938</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2616355133.jpg,盗梦空间,2010,9.3,1717903</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p524964039.jpg,忠犬八公的故事,2009,9.4,1180113</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2614988097.jpg,星际穿越,2014,9.3,1390653</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p479682972.jpg,楚门的世界,1998,9.3,1307123</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2574551676.jpg,海上钢琴师,1998,9.3,1395475</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p579729551.jpg,三傻大闹宝莱坞,2009,9.2,1568001</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1461851991.jpg,机器人总动员,2008,9.3,1103099</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1910824951.jpg,放牛班的春天,2004,9.3,1087370</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2564556863.jpg,无间道,2002,9.3,1058718</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2614500649.jpg,疯狂动物城,2016,9.2,1535791</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2455050536.jpg,大话西游之大圣娶亲,1995,9.2,1270103</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1363250216.jpg,熔炉,2011,9.3,770798</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p616779645.jpg,教父,1972,9.3,772761</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2614359276.jpg,当幸福来敲门,2006,9.1,1260649</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2540924496.jpg,龙猫,1988,9.2,1051778</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p501177648.jpg,怦然心动,2010,9.1,1492708</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1505392928.jpg,控方证人,1957,9.6,371278</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1454261925.jpg,触不可及,2011,9.3,828170</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p462657443.jpg,蝙蝠侠：黑暗骑士,2008,9.2,861486</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p452089833.jpg,末代皇帝,1987,9.3,665966</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2614500706.jpg,寻梦环游记,2017,9.1,1307556</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2524040532.jpg,活着,1994,9.3,669518</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2642829472.jpg,指环王3：王者无敌,2003,9.2,653616</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1963126880.jpg,乱世佳人,1939,9.3,567787</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2555295759.jpg,何以为家,2018,9.1,830389</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2614949805.jpg,哈利·波特与魔法石,2001,9.1,882053</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p485887754.jpg,飞屋环游记,2009,9.0,1098265</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2118532944.jpg,素媛,2013,9.3,544710</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2401676338.jpg,摔跤吧！爸爸,2016,9.0,1298769</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1784592701.jpg,少年派的奇幻漂流,2012,9.1,1148125</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2173577632.jpg,十二怒汉,1957,9.4,381454</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2174346180.jpg,哈尔的移动城堡,2004,9.1,819033</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2553104888.jpg,鬼子来了,2000,9.3,508031</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2561305376.jpg,我不是药神,2018,9.0,1726641</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2561721372.jpg,大话西游之月光宝盒,1995,9.0,1011850</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1446261379.jpg,天空之城,1986,9.1,689301</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2550757929.jpg,闻香识女人,1992,9.1,706224</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2189265085.jpg,罗马假日,1953,9.0,800710</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2640236255.jpg,指环王2：双塔奇兵,2002,9.1,609036</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p453924541.jpg,猫鼠游戏,2002,9.1,734119</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2653054340.jpg,天堂电影院,1988,9.2,525154</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2158166535.jpg,辩护人,2013,9.2,500175</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2640234840.jpg,指环王1：护戒使者,2001,9.1,693680</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2184505167.jpg,大闹天宫,1961(中国大陆) / 1964(中国大陆) / 1978(中国大陆) / 2004(中国大陆),9.4,340208</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p792376093.jpg,钢琴家,2002,9.2,457919</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2277799019.jpg,狮子王,1994,9.1,679213</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2194138787.jpg,教父2,1974,9.2,433973</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2575465690.jpg,死亡诗社,1989,9.1,571996</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910926158.jpg,搏击俱乐部,1999,9.0,704145</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p451926968.jpg,黑客帝国,1999,9.0,659879</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1512562287.jpg,让子弹飞,2010,8.9,1337990</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2549177902.jpg,绿皮书,2018,8.9,1284278</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1910899751.jpg,饮食男女,1994,9.1,485412</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1665997400.jpg,美丽心灵,2001,9.0,625114</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2554525534.jpg,海蒂和爷爷,2015,9.2,377506</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1808872109.jpg,窃听风暴,2006,9.2,462123</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p792443418.jpg,两杆大烟枪,1998,9.1,498097</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2192535722.jpg,本杰明·巴顿奇事,2008,8.9,811159</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2648230660.jpg,情书,1995,8.9,820384</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2498971355.jpg,看不见的客人,2016,8.8,998583</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p792238287.jpg,飞越疯人院,1975,9.1,473438</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1473670352.jpg,穿条纹睡衣的男孩,2008,9.1,425919</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2441988159.jpg,西西里的美丽传说,2000,8.9,801233</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1014542496.jpg,拯救大兵瑞恩,1998,9.0,530981</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2165511465.jpg,小鞋子,1997,9.2,333521</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p453788577.jpg,音乐之声,1965,9.1,491814</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2634997853.jpg,阿凡达,2009,8.8,1160560</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2559579779.jpg,海豚湾,2009,9.3,311697</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p480383375.jpg,致命魔术,2006,8.9,706971</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p477229647.jpg,美国往事,1984,9.2,340334</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1593414327.jpg,沉默的羔羊,1991,8.9,702654</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1832875827.jpg,禁闭岛,2010,8.8,779670</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2209066019.jpg,蝴蝶效应,2004,8.8,765655</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1910902213.jpg,低俗小说,1994,8.9,682056</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p480965695.jpg,心灵捕手,1997,8.9,577385</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2178872593.jpg,布达佩斯大饭店,2014,8.9,731182</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2219586434.jpg,七宗罪,1995,8.8,794001</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p465939041.jpg,春光乍泄,1997,8.9,515164</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p917846733.jpg,哈利·波特与死亡圣器(下),2011,8.9,639906</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2263408369.jpg,摩登时代,1936,9.3,237607</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p884763596.jpg,被嫌弃的松子的一生,2006,8.9,602295</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2579932167.jpg,喜剧之王,1999,8.8,788367</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2558364386.jpg,致命ID,2003,8.8,657787</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p657823840.jpg,杀人回忆,2003,8.9,557770</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1596085504.jpg,加勒比海盗,2003,8.8,715622</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p480956937.jpg,剪刀手爱德华,1990,8.7,898594</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2004174709.jpg,勇敢的心,1995,8.9,490782</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1546987967.jpg,狩猎,2012,9.1,306982</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2505525050.jpg,请以你的名字呼唤我,2017,8.9,557338</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p456825720.jpg,红辣椒,2006,9.0,349004</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2604889017.jpg,断背山,2005,8.8,600191</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1816276065.jpg,7号房的礼物,2013,8.9,446140</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2447590313.jpg,天使爱美丽,2001,8.7,848389</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1613191025.jpg,幽灵公主,1997,8.9,442085</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2564498893.jpg,小森林 夏秋篇,2014,9.0,349196</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2220184425.jpg,第六感,1999,8.9,451081</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2564685215.jpg,阳光灿烂的日子,1994,8.8,511391</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p792381411.jpg,重庆森林,1994,8.8,652297</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1305562621.jpg,超脱,2011,8.9,408428</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2219011938.jpg,功夫,2004,8.7,839875</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2357915564.jpg,唐伯虎点秋香,1993,8.7,864732</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2555762374.jpg,爱在黎明破晓前,1995,8.8,512829</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2544912792.jpg,人生果实,2017,9.5,139445</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2215147728.jpg,小森林 冬春篇,2015,9.0,313078</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2567845803.jpg,一一,2000,9.1,293722</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1706428744.jpg,蝙蝠侠：黑暗骑士崛起,2012,8.8,589732</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2620392435.jpg,菊次郎的夏天,1999,8.8,470519</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2635433927.jpg,入殓师,2008,8.9,483243</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2221768894.jpg,消失的爱人,2014,8.7,741730</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p661160053.jpg,无人知晓,2004,9.1,242934</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2414157745.jpg,倩女幽魂,1987,8.7,605138</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2614500883.jpg,超能陆战队,2014,8.7,826422</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p456692072.jpg,侧耳倾听,1995,8.9,379215</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910812549.jpg,哈利·波特与阿兹卡班的囚徒,2004,8.8,512727</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2190556408.jpg,完美的世界,1993,9.1,233065</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p617533616.jpg,借东西的小人阿莉埃蒂,2010,8.8,448723</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2223011274.jpg,甜蜜蜜,1996,8.9,427414</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1675053073.jpg,萤火之森,2011,8.9,423345</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2561542458.jpg,爱在日落黄昏时,2004,8.9,425918</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2210954024.jpg,驯龙高手,2010,8.7,628179</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p488255145.jpg,玛丽和马克思,2009,8.9,367547</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p854757687.jpg,幸福终点站,2004,8.8,449926</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p689520756.jpg,告白,2010,8.7,584313</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2515539487.jpg,天书奇谭,1983(中国大陆),9.2,191303</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p692813374.jpg,大鱼,2003,8.8,474379</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2609063925.jpg,射雕英雄传之东成西就,1993,8.7,533159</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1374786017.jpg,阳光姐妹淘,2011,8.8,509665</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1082651990.jpg,哈利·波特与密室,2002,8.7,537063</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2513247938.jpg,怪兽电力公司,2001,8.7,539086</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2016930906.jpg,恐怖直播,2013,8.7,533277</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p792776858.jpg,神偷奶爸,2010,8.6,797755</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2070153774.jpg,时空恋旅人,2013,8.8,484144</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1283675359.jpg,玩具总动员3,2010,8.9,415735</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2016401659.jpg,傲慢与偏见,2005,8.7,640438</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2169664351.jpg,教父3,1990,8.9,289948</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2360940399.jpg,釜山行,2016,8.6,959976</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2532803206.jpg,哪吒闹海,1979,9.1,207231</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2398141939.jpg,血战钢锯岭,2016,8.7,657406</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2406624993.jpg,一个叫欧维的男人决定去死,2015,8.9,342088</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1800813767.jpg,被解救的姜戈,2012,8.8,495236</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2215886505.jpg,七武士,1954,9.3,157351</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2249048907.jpg,喜宴,1993,8.9,280196</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1351050722.jpg,未麻的部屋,1997,9.0,239227</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2565332644.jpg,电锯惊魂,2004,8.7,425479</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p652417775.jpg,我是山姆,2001,9.0,259653</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2516578307.jpg,头号玩家,2018,8.6,1138578</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1917567652.jpg,风之谷,1984,8.9,307063</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p455677490.jpg,上帝之城,2002,9.0,255707</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2504997087.jpg,英雄本色,1986,8.7,426643</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p792223507.jpg,谍影重重3,2007,8.8,351487</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1867084027.jpg,疯狂原始人,2013,8.7,712391</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p470419493.jpg,卢旺达饭店,2004,8.9,257402</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2510081688.jpg,三块广告牌,2017,8.7,684406</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1903379979.jpg,新世界,2013,8.9,300798</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1910828286.jpg,花样年华,2000,8.7,475583</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2255040492.jpg,模仿游戏,2014,8.7,504705</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2597918718.jpg,纵横四海,1991,8.8,338906</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p443461818.jpg,黑客帝国3：矩阵革命,2003,8.8,353561</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2166160837.jpg,达拉斯买家俱乐部,2013,8.8,369844</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p456666151.jpg,岁月神偷,2010,8.7,502534</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2276780256.jpg,心迷宫,2014,8.7,409481</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2266293606.jpg,头脑特工队,2015,8.7,488191</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2395733377.jpg,你的名字。,2016,8.4,1134874</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p641688453.jpg,记忆碎片,2000,8.7,508006</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2603716224.jpg,忠犬八公物语,1987,9.2,157136</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2584519452.jpg,荒蛮故事,2014,8.8,353965</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2561439800.jpg,寄生虫,2019,8.8,1125278</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2603364117.jpg,海街日记,2015,8.8,347104</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p475600770.jpg,真爱至上,2003,8.6,600244</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2220776342.jpg,爆裂鼓手,2014,8.7,465097</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2434249040.jpg,贫民窟的百万富翁,2008,8.6,630016</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1982176012.jpg,东邪西毒,1994,8.6,488030</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1021883305.jpg,惊魂记,1960,9.0,209421</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2237136718.jpg,萤火虫之墓,1988,8.7,352414</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p735391084.jpg,哈利·波特与火焰杯,2005,8.6,463960</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2549648344.jpg,黑天鹅,2010,8.6,687717</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2530599636.jpg,小偷家族,2018,8.7,684571</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p767586451.jpg,绿里奇迹,1999,8.9,249136</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1735642656.jpg,无敌破坏王,2012,8.7,437272</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p709670262.jpg,你看起来好像很好吃,2010,8.9,279807</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910895719.jpg,冰川时代,2002,8.6,515039</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2074715729.jpg,爱在午夜降临前,2013,8.8,291034</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p648370300.jpg,九品芝麻官,1994,8.6,499623</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2353324612.jpg,雨人,1988,8.7,342625</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p712241453.jpg,疯狂的石头,2006,8.5,663816</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p483604864.jpg,恋恋笔记本,2004,8.5,542020</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p462470694.jpg,恐怖游轮,2009,8.5,655305</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1612355875.jpg,雨中曲,1952,9.0,170988</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p456676352.jpg,魔女宅急便,1989,8.7,378741</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2507709428.jpg,奇迹男孩,2017,8.6,472600</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p453716305.jpg,色，戒,2007,8.5,579145</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2399597512.jpg,虎口脱险,1966,8.9,198517</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2421855655.jpg,海边的曼彻斯特,2016,8.6,399115</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2560717825.jpg,2001太空漫游,1968,8.8,243088</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p792257137.jpg,人工智能,2001,8.7,362744</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2170238828.jpg,城市之光,1931,9.3,110942</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2363208684.jpg,可可西里,2004,8.8,244594</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2457609817.jpg,二十二,2015,8.7,242128</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2259715855.jpg,房间,2015,8.8,321691</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1598883511.jpg,罗生门,1950,8.8,252804</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1910909085.jpg,终结者2：审判日,1991,8.7,287626</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1505312273.jpg,初恋这件小事,2010,8.4,845669</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2505928032.jpg,大佛普拉斯,2017,8.7,341343</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1481879628.jpg,遗愿清单,2007,8.7,331269</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2549558913.jpg,波西米亚狂想曲,2018,8.7,478280</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p848381236.jpg,牯岭街少年杀人事件,1991,8.9,215299</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p988260245.jpg,源代码,2011,8.5,681677</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2351134499.jpg,魂断蓝桥,1940,8.8,228810</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1421018669.jpg,新龙门客栈,1992,8.6,364204</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2570901292.jpg,青蛇,1993,8.6,423044</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2236181653.jpg,疯狂的麦克斯4：狂暴之路,2015,8.6,429756</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2575043939.jpg,无耻混蛋,2009,8.6,392522</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1244017073.jpg,血钻,2006,8.7,302450</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2375245718.jpg,步履不停,2008,8.8,221179</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1023654037.jpg,燃情岁月,1994,8.8,241510</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2559581324.jpg,海洋,2009,9.1,140256</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p456703618.jpg,东京教父,2003,9.0,150187</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p958008320.jpg,无间道2,2003,8.6,346646</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2187896734.jpg,彗星来的那一夜,2013,8.5,432217</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p667644866.jpg,谍影重重2,2004,8.7,294670</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2079334286.jpg,穿越时空的少女,2006,8.6,326398</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p792282381.jpg,战争之王,2005,8.7,292534</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2525770523.jpg,阿飞正传,1990,8.5,412037</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1973489335.jpg,地球上的星星,2007,8.9,173201</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2522331945.jpg,完美陌生人,2016,8.5,451049</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1597183981.jpg,谍影重重,2002,8.6,352151</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2571500223.jpg,香水,2006,8.5,464907</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2195672555.jpg,千钧一发,1997,8.8,217710</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p443461390.jpg,黑客帝国2：重装上阵,2003,8.6,312981</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1925331564.jpg,东京物语,1953,9.2,109758</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2627847859.jpg,崖上的波妞,2008,8.6,382805</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1075591188.jpg,我爱你,2011,9.1,135121</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1140984198.jpg,朗读者,2008,8.6,397681</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2250287733.jpg,再次出发之纽约遇见你,2013,8.6,351101</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2393044761.jpg,驴得水,2016,8.3,765089</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2263822658.jpg,聚焦,2015,8.8,234727</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1344888983.jpg,浪潮,2008,8.7,228081</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p513567548.jpg,猜火车,1996,8.5,363994</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2510956726.jpg,小萝莉的猴神大叔,2015,8.4,412418</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2561545031.jpg,追随,1998,8.9,152188</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1910900710.jpg,黑鹰坠落,2001,8.7,244341</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2542848758.jpg,网络谜踪,2018,8.5,439379</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"经典案例\"><a href=\"#经典案例\" class=\"headerlink\" title=\"经典案例\"></a>经典案例</h2><p>每个学习爬虫的人都爬过的豆瓣电影TOP250，先看下<a href=\"https://movie.douban.com/top250\">长什么样</a>。</p>\n<p><img src=\"Screenshot_1.webp\"></p>\n<p>开爬。</p>\n<h2 id=\"分析\"><a href=\"#分析\" class=\"headerlink\" title=\"分析\"></a>分析</h2><p>查看源代码，所有的数据都在页面源代码中，直接用requests请求拿过来页面源代码，再通过re匹配即可。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> csv</span><br><span class=\"line\"><span class=\"keyword\">import</span> codecs</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 要抓取的目标网址，豆瓣电影TOP250</span></span><br><span class=\"line\">BASE_URL = <span class=\"string\">&quot;https://movie.douban.com/top250&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">request</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;获取页面源代码</span></span><br><span class=\"line\"><span class=\"string\">        url: 目标网址</span></span><br><span class=\"line\"><span class=\"string\">        return: 页面源码&quot;&quot;&quot;</span></span><br><span class=\"line\">    headers = &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;User-Agent&quot;</span>: <span class=\"string\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.77 Safari/537.36 Edg/91.0.864.37&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    response = requests.get(url=url, headers=headers)</span><br><span class=\"line\">    page_content = response.text</span><br><span class=\"line\">    <span class=\"keyword\">return</span> page_content</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">parse</span>(<span class=\"params\">page_content</span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;解析页面&quot;&quot;&quot;</span></span><br><span class=\"line\">    partern = re.<span class=\"built_in\">compile</span>(</span><br><span class=\"line\">        <span class=\"string\">r&#x27;&lt;li&gt;.*?&lt;div class=&quot;item&quot;&gt;.*?&lt;img width=&quot;100&quot;.*?src=&quot;(?P&lt;image_url&gt;.*?)&quot;&#x27;</span></span><br><span class=\"line\">        <span class=\"string\">r&#x27;.*?&lt;span class=&quot;title&quot;&gt;(?P&lt;name&gt;.*?)&#x27;</span></span><br><span class=\"line\">        <span class=\"string\">r&#x27;&lt;/span&gt;.*?&lt;p class=&quot;&quot;&gt;.*?&lt;br&gt;(?P&lt;year&gt;.*?)&amp;nbsp.*?&lt;span class=&quot;rating_num&quot; property=&quot;v:average&quot;&gt;(?P&lt;score&gt;.*?)&lt;/span&gt;.*?&#x27;</span></span><br><span class=\"line\">        <span class=\"string\">r&#x27;&lt;span&gt;(?P&lt;number&gt;.*?)人评价&lt;/span&gt;&#x27;</span>, re.S)</span><br><span class=\"line\"></span><br><span class=\"line\">    parse_result = partern.finditer(page_content)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> parse_result:</span><br><span class=\"line\">        <span class=\"comment\"># print(item.group(&quot;name&quot;))</span></span><br><span class=\"line\">        <span class=\"comment\"># print(item.group(&quot;year&quot;).strip())</span></span><br><span class=\"line\">        <span class=\"comment\"># print(item.group(&quot;score&quot;))</span></span><br><span class=\"line\">        <span class=\"comment\"># print(item.group(&quot;number&quot;))</span></span><br><span class=\"line\">        <span class=\"comment\"># print(item.group(&quot;image_url&quot;))</span></span><br><span class=\"line\">        dic = item.groupdict()</span><br><span class=\"line\">        dic[<span class=\"string\">&#x27;year&#x27;</span>] = dic[<span class=\"string\">&#x27;year&#x27;</span>].strip()</span><br><span class=\"line\">        csv_writer(<span class=\"string\">&quot;data.csv&quot;</span>, dic.values())</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">csv_writer</span>(<span class=\"params\">filename: <span class=\"built_in\">str</span>, value: <span class=\"built_in\">object</span></span>):</span></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;csv写入函数&quot;&quot;&quot;</span></span><br><span class=\"line\">    f = codecs.<span class=\"built_in\">open</span>(filename, mode=<span class=\"string\">&quot;a&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>)</span><br><span class=\"line\">    csvwriter = csv.writer(f)</span><br><span class=\"line\">    csvwriter.writerow(value)</span><br><span class=\"line\">    f.close()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>):</span><br><span class=\"line\">        target_url = BASE_URL + <span class=\"string\">&#x27;?start=&#123;&#125;&amp;filter=&#x27;</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">str</span>(i * <span class=\"number\">25</span>))</span><br><span class=\"line\">        <span class=\"comment\"># print(target_url)</span></span><br><span class=\"line\">        page_content = request(target_url)</span><br><span class=\"line\">        parse(page_content)</span><br></pre></td></tr></table></figure>\n\n<p>保存到data.csv</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p480747492.jpg,肖申克的救赎,1994,9.7,2363296</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2561716440.jpg,霸王别姬,1993,9.6,1759688</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2372307693.jpg,阿甘正传,1994,9.5,1780693</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p511118051.jpg,这个杀手不太冷,1994,9.4,1953794</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p457760035.jpg,泰坦尼克号,1997,9.4,1741778</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2578474613.jpg,美丽人生,1997,9.6,1094798</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2557573348.jpg,千与千寻,2001,9.4,1857168</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p492406163.jpg,辛德勒的名单,1993,9.5,908938</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2616355133.jpg,盗梦空间,2010,9.3,1717903</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p524964039.jpg,忠犬八公的故事,2009,9.4,1180113</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2614988097.jpg,星际穿越,2014,9.3,1390653</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p479682972.jpg,楚门的世界,1998,9.3,1307123</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2574551676.jpg,海上钢琴师,1998,9.3,1395475</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p579729551.jpg,三傻大闹宝莱坞,2009,9.2,1568001</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1461851991.jpg,机器人总动员,2008,9.3,1103099</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1910824951.jpg,放牛班的春天,2004,9.3,1087370</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2564556863.jpg,无间道,2002,9.3,1058718</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2614500649.jpg,疯狂动物城,2016,9.2,1535791</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2455050536.jpg,大话西游之大圣娶亲,1995,9.2,1270103</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1363250216.jpg,熔炉,2011,9.3,770798</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p616779645.jpg,教父,1972,9.3,772761</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2614359276.jpg,当幸福来敲门,2006,9.1,1260649</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2540924496.jpg,龙猫,1988,9.2,1051778</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p501177648.jpg,怦然心动,2010,9.1,1492708</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1505392928.jpg,控方证人,1957,9.6,371278</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1454261925.jpg,触不可及,2011,9.3,828170</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p462657443.jpg,蝙蝠侠：黑暗骑士,2008,9.2,861486</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p452089833.jpg,末代皇帝,1987,9.3,665966</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2614500706.jpg,寻梦环游记,2017,9.1,1307556</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2524040532.jpg,活着,1994,9.3,669518</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2642829472.jpg,指环王3：王者无敌,2003,9.2,653616</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1963126880.jpg,乱世佳人,1939,9.3,567787</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2555295759.jpg,何以为家,2018,9.1,830389</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2614949805.jpg,哈利·波特与魔法石,2001,9.1,882053</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p485887754.jpg,飞屋环游记,2009,9.0,1098265</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2118532944.jpg,素媛,2013,9.3,544710</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2401676338.jpg,摔跤吧！爸爸,2016,9.0,1298769</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1784592701.jpg,少年派的奇幻漂流,2012,9.1,1148125</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2173577632.jpg,十二怒汉,1957,9.4,381454</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2174346180.jpg,哈尔的移动城堡,2004,9.1,819033</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2553104888.jpg,鬼子来了,2000,9.3,508031</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2561305376.jpg,我不是药神,2018,9.0,1726641</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2561721372.jpg,大话西游之月光宝盒,1995,9.0,1011850</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1446261379.jpg,天空之城,1986,9.1,689301</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2550757929.jpg,闻香识女人,1992,9.1,706224</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2189265085.jpg,罗马假日,1953,9.0,800710</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2640236255.jpg,指环王2：双塔奇兵,2002,9.1,609036</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p453924541.jpg,猫鼠游戏,2002,9.1,734119</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2653054340.jpg,天堂电影院,1988,9.2,525154</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2158166535.jpg,辩护人,2013,9.2,500175</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2640234840.jpg,指环王1：护戒使者,2001,9.1,693680</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2184505167.jpg,大闹天宫,1961(中国大陆) / 1964(中国大陆) / 1978(中国大陆) / 2004(中国大陆),9.4,340208</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p792376093.jpg,钢琴家,2002,9.2,457919</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2277799019.jpg,狮子王,1994,9.1,679213</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2194138787.jpg,教父2,1974,9.2,433973</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2575465690.jpg,死亡诗社,1989,9.1,571996</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910926158.jpg,搏击俱乐部,1999,9.0,704145</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p451926968.jpg,黑客帝国,1999,9.0,659879</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1512562287.jpg,让子弹飞,2010,8.9,1337990</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2549177902.jpg,绿皮书,2018,8.9,1284278</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1910899751.jpg,饮食男女,1994,9.1,485412</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1665997400.jpg,美丽心灵,2001,9.0,625114</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2554525534.jpg,海蒂和爷爷,2015,9.2,377506</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1808872109.jpg,窃听风暴,2006,9.2,462123</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p792443418.jpg,两杆大烟枪,1998,9.1,498097</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2192535722.jpg,本杰明·巴顿奇事,2008,8.9,811159</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2648230660.jpg,情书,1995,8.9,820384</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2498971355.jpg,看不见的客人,2016,8.8,998583</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p792238287.jpg,飞越疯人院,1975,9.1,473438</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1473670352.jpg,穿条纹睡衣的男孩,2008,9.1,425919</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2441988159.jpg,西西里的美丽传说,2000,8.9,801233</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1014542496.jpg,拯救大兵瑞恩,1998,9.0,530981</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2165511465.jpg,小鞋子,1997,9.2,333521</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p453788577.jpg,音乐之声,1965,9.1,491814</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2634997853.jpg,阿凡达,2009,8.8,1160560</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2559579779.jpg,海豚湾,2009,9.3,311697</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p480383375.jpg,致命魔术,2006,8.9,706971</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p477229647.jpg,美国往事,1984,9.2,340334</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1593414327.jpg,沉默的羔羊,1991,8.9,702654</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1832875827.jpg,禁闭岛,2010,8.8,779670</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2209066019.jpg,蝴蝶效应,2004,8.8,765655</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1910902213.jpg,低俗小说,1994,8.9,682056</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p480965695.jpg,心灵捕手,1997,8.9,577385</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2178872593.jpg,布达佩斯大饭店,2014,8.9,731182</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2219586434.jpg,七宗罪,1995,8.8,794001</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p465939041.jpg,春光乍泄,1997,8.9,515164</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p917846733.jpg,哈利·波特与死亡圣器(下),2011,8.9,639906</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2263408369.jpg,摩登时代,1936,9.3,237607</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p884763596.jpg,被嫌弃的松子的一生,2006,8.9,602295</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2579932167.jpg,喜剧之王,1999,8.8,788367</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2558364386.jpg,致命ID,2003,8.8,657787</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p657823840.jpg,杀人回忆,2003,8.9,557770</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1596085504.jpg,加勒比海盗,2003,8.8,715622</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p480956937.jpg,剪刀手爱德华,1990,8.7,898594</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2004174709.jpg,勇敢的心,1995,8.9,490782</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1546987967.jpg,狩猎,2012,9.1,306982</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2505525050.jpg,请以你的名字呼唤我,2017,8.9,557338</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p456825720.jpg,红辣椒,2006,9.0,349004</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2604889017.jpg,断背山,2005,8.8,600191</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1816276065.jpg,7号房的礼物,2013,8.9,446140</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2447590313.jpg,天使爱美丽,2001,8.7,848389</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1613191025.jpg,幽灵公主,1997,8.9,442085</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2564498893.jpg,小森林 夏秋篇,2014,9.0,349196</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2220184425.jpg,第六感,1999,8.9,451081</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2564685215.jpg,阳光灿烂的日子,1994,8.8,511391</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p792381411.jpg,重庆森林,1994,8.8,652297</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1305562621.jpg,超脱,2011,8.9,408428</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2219011938.jpg,功夫,2004,8.7,839875</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2357915564.jpg,唐伯虎点秋香,1993,8.7,864732</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2555762374.jpg,爱在黎明破晓前,1995,8.8,512829</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2544912792.jpg,人生果实,2017,9.5,139445</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2215147728.jpg,小森林 冬春篇,2015,9.0,313078</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2567845803.jpg,一一,2000,9.1,293722</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1706428744.jpg,蝙蝠侠：黑暗骑士崛起,2012,8.8,589732</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2620392435.jpg,菊次郎的夏天,1999,8.8,470519</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2635433927.jpg,入殓师,2008,8.9,483243</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2221768894.jpg,消失的爱人,2014,8.7,741730</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p661160053.jpg,无人知晓,2004,9.1,242934</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2414157745.jpg,倩女幽魂,1987,8.7,605138</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2614500883.jpg,超能陆战队,2014,8.7,826422</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p456692072.jpg,侧耳倾听,1995,8.9,379215</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910812549.jpg,哈利·波特与阿兹卡班的囚徒,2004,8.8,512727</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2190556408.jpg,完美的世界,1993,9.1,233065</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p617533616.jpg,借东西的小人阿莉埃蒂,2010,8.8,448723</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2223011274.jpg,甜蜜蜜,1996,8.9,427414</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1675053073.jpg,萤火之森,2011,8.9,423345</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2561542458.jpg,爱在日落黄昏时,2004,8.9,425918</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2210954024.jpg,驯龙高手,2010,8.7,628179</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p488255145.jpg,玛丽和马克思,2009,8.9,367547</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p854757687.jpg,幸福终点站,2004,8.8,449926</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p689520756.jpg,告白,2010,8.7,584313</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2515539487.jpg,天书奇谭,1983(中国大陆),9.2,191303</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p692813374.jpg,大鱼,2003,8.8,474379</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2609063925.jpg,射雕英雄传之东成西就,1993,8.7,533159</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1374786017.jpg,阳光姐妹淘,2011,8.8,509665</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1082651990.jpg,哈利·波特与密室,2002,8.7,537063</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2513247938.jpg,怪兽电力公司,2001,8.7,539086</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2016930906.jpg,恐怖直播,2013,8.7,533277</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p792776858.jpg,神偷奶爸,2010,8.6,797755</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2070153774.jpg,时空恋旅人,2013,8.8,484144</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1283675359.jpg,玩具总动员3,2010,8.9,415735</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2016401659.jpg,傲慢与偏见,2005,8.7,640438</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2169664351.jpg,教父3,1990,8.9,289948</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2360940399.jpg,釜山行,2016,8.6,959976</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2532803206.jpg,哪吒闹海,1979,9.1,207231</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2398141939.jpg,血战钢锯岭,2016,8.7,657406</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2406624993.jpg,一个叫欧维的男人决定去死,2015,8.9,342088</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1800813767.jpg,被解救的姜戈,2012,8.8,495236</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2215886505.jpg,七武士,1954,9.3,157351</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2249048907.jpg,喜宴,1993,8.9,280196</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1351050722.jpg,未麻的部屋,1997,9.0,239227</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2565332644.jpg,电锯惊魂,2004,8.7,425479</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p652417775.jpg,我是山姆,2001,9.0,259653</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2516578307.jpg,头号玩家,2018,8.6,1138578</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1917567652.jpg,风之谷,1984,8.9,307063</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p455677490.jpg,上帝之城,2002,9.0,255707</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2504997087.jpg,英雄本色,1986,8.7,426643</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p792223507.jpg,谍影重重3,2007,8.8,351487</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1867084027.jpg,疯狂原始人,2013,8.7,712391</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p470419493.jpg,卢旺达饭店,2004,8.9,257402</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2510081688.jpg,三块广告牌,2017,8.7,684406</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1903379979.jpg,新世界,2013,8.9,300798</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1910828286.jpg,花样年华,2000,8.7,475583</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2255040492.jpg,模仿游戏,2014,8.7,504705</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2597918718.jpg,纵横四海,1991,8.8,338906</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p443461818.jpg,黑客帝国3：矩阵革命,2003,8.8,353561</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2166160837.jpg,达拉斯买家俱乐部,2013,8.8,369844</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p456666151.jpg,岁月神偷,2010,8.7,502534</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2276780256.jpg,心迷宫,2014,8.7,409481</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2266293606.jpg,头脑特工队,2015,8.7,488191</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2395733377.jpg,你的名字。,2016,8.4,1134874</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p641688453.jpg,记忆碎片,2000,8.7,508006</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2603716224.jpg,忠犬八公物语,1987,9.2,157136</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2584519452.jpg,荒蛮故事,2014,8.8,353965</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2561439800.jpg,寄生虫,2019,8.8,1125278</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2603364117.jpg,海街日记,2015,8.8,347104</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p475600770.jpg,真爱至上,2003,8.6,600244</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2220776342.jpg,爆裂鼓手,2014,8.7,465097</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2434249040.jpg,贫民窟的百万富翁,2008,8.6,630016</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1982176012.jpg,东邪西毒,1994,8.6,488030</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1021883305.jpg,惊魂记,1960,9.0,209421</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2237136718.jpg,萤火虫之墓,1988,8.7,352414</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p735391084.jpg,哈利·波特与火焰杯,2005,8.6,463960</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2549648344.jpg,黑天鹅,2010,8.6,687717</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2530599636.jpg,小偷家族,2018,8.7,684571</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p767586451.jpg,绿里奇迹,1999,8.9,249136</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1735642656.jpg,无敌破坏王,2012,8.7,437272</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p709670262.jpg,你看起来好像很好吃,2010,8.9,279807</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910895719.jpg,冰川时代,2002,8.6,515039</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2074715729.jpg,爱在午夜降临前,2013,8.8,291034</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p648370300.jpg,九品芝麻官,1994,8.6,499623</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2353324612.jpg,雨人,1988,8.7,342625</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p712241453.jpg,疯狂的石头,2006,8.5,663816</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p483604864.jpg,恋恋笔记本,2004,8.5,542020</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p462470694.jpg,恐怖游轮,2009,8.5,655305</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1612355875.jpg,雨中曲,1952,9.0,170988</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p456676352.jpg,魔女宅急便,1989,8.7,378741</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2507709428.jpg,奇迹男孩,2017,8.6,472600</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p453716305.jpg,色，戒,2007,8.5,579145</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2399597512.jpg,虎口脱险,1966,8.9,198517</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2421855655.jpg,海边的曼彻斯特,2016,8.6,399115</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2560717825.jpg,2001太空漫游,1968,8.8,243088</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p792257137.jpg,人工智能,2001,8.7,362744</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2170238828.jpg,城市之光,1931,9.3,110942</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2363208684.jpg,可可西里,2004,8.8,244594</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2457609817.jpg,二十二,2015,8.7,242128</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2259715855.jpg,房间,2015,8.8,321691</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1598883511.jpg,罗生门,1950,8.8,252804</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1910909085.jpg,终结者2：审判日,1991,8.7,287626</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1505312273.jpg,初恋这件小事,2010,8.4,845669</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2505928032.jpg,大佛普拉斯,2017,8.7,341343</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1481879628.jpg,遗愿清单,2007,8.7,331269</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2549558913.jpg,波西米亚狂想曲,2018,8.7,478280</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p848381236.jpg,牯岭街少年杀人事件,1991,8.9,215299</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p988260245.jpg,源代码,2011,8.5,681677</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2351134499.jpg,魂断蓝桥,1940,8.8,228810</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1421018669.jpg,新龙门客栈,1992,8.6,364204</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2570901292.jpg,青蛇,1993,8.6,423044</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2236181653.jpg,疯狂的麦克斯4：狂暴之路,2015,8.6,429756</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2575043939.jpg,无耻混蛋,2009,8.6,392522</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1244017073.jpg,血钻,2006,8.7,302450</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2375245718.jpg,步履不停,2008,8.8,221179</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1023654037.jpg,燃情岁月,1994,8.8,241510</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2559581324.jpg,海洋,2009,9.1,140256</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p456703618.jpg,东京教父,2003,9.0,150187</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p958008320.jpg,无间道2,2003,8.6,346646</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2187896734.jpg,彗星来的那一夜,2013,8.5,432217</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p667644866.jpg,谍影重重2,2004,8.7,294670</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2079334286.jpg,穿越时空的少女,2006,8.6,326398</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p792282381.jpg,战争之王,2005,8.7,292534</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2525770523.jpg,阿飞正传,1990,8.5,412037</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1973489335.jpg,地球上的星星,2007,8.9,173201</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2522331945.jpg,完美陌生人,2016,8.5,451049</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1597183981.jpg,谍影重重,2002,8.6,352151</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2571500223.jpg,香水,2006,8.5,464907</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2195672555.jpg,千钧一发,1997,8.8,217710</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p443461390.jpg,黑客帝国2：重装上阵,2003,8.6,312981</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1925331564.jpg,东京物语,1953,9.2,109758</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2627847859.jpg,崖上的波妞,2008,8.6,382805</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1075591188.jpg,我爱你,2011,9.1,135121</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1140984198.jpg,朗读者,2008,8.6,397681</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2250287733.jpg,再次出发之纽约遇见你,2013,8.6,351101</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2393044761.jpg,驴得水,2016,8.3,765089</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2263822658.jpg,聚焦,2015,8.8,234727</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1344888983.jpg,浪潮,2008,8.7,228081</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p513567548.jpg,猜火车,1996,8.5,363994</span><br><span class=\"line\">https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2510956726.jpg,小萝莉的猴神大叔,2015,8.4,412418</span><br><span class=\"line\">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2561545031.jpg,追随,1998,8.9,152188</span><br><span class=\"line\">https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1910900710.jpg,黑鹰坠落,2001,8.7,244341</span><br><span class=\"line\">https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2542848758.jpg,网络谜踪,2018,8.5,439379</span><br></pre></td></tr></table></figure>\n"}],"PostAsset":[{"_id":"source/_posts/Ajax爬取案例实战/Screenshot_1.webp","post":"ckq14rx1m000144ud120ngx2k","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/Ajax爬取案例实战/Screenshot_2.webp","post":"ckq14rx1m000144ud120ngx2k","slug":"Screenshot_2.webp","modified":1,"renderable":1},{"_id":"source/_posts/Ajax爬取案例实战/Screenshot_3.webp","post":"ckq14rx1m000144ud120ngx2k","slug":"Screenshot_3.webp","modified":1,"renderable":1},{"_id":"source/_posts/Ajax爬取案例实战/Screenshot_4.webp","post":"ckq14rx1m000144ud120ngx2k","slug":"Screenshot_4.webp","modified":1,"renderable":1},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_1.webp","post":"ckq14rx1p000244ud8p7lapr2","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_2.webp","post":"ckq14rx1p000244ud8p7lapr2","slug":"Screenshot_2.webp","modified":1,"renderable":1},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_3.webp","post":"ckq14rx1p000244ud8p7lapr2","slug":"Screenshot_3.webp","modified":1,"renderable":1},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_4.webp","post":"ckq14rx1p000244ud8p7lapr2","slug":"Screenshot_4.webp","modified":1,"renderable":1},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_5.webp","post":"ckq14rx1p000244ud8p7lapr2","slug":"Screenshot_5.webp","modified":1,"renderable":1},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_6.webp","post":"ckq14rx1p000244ud8p7lapr2","slug":"Screenshot_6.webp","modified":1,"renderable":1},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_7.webp","post":"ckq14rx1p000244ud8p7lapr2","slug":"Screenshot_7.webp","modified":1,"renderable":1},{"_id":"source/_posts/Ajax的原理和解析/Screenshot_8.webp","post":"ckq14rx1p000244ud8p7lapr2","slug":"Screenshot_8.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-Django-Admin/1.PNG","post":"ckq14rx1s000644udhqh10rqa","slug":"1.PNG","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-Django-Admin/2.PNG","post":"ckq14rx1s000644udhqh10rqa","slug":"2.PNG","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-Django-Admin/3.PNG","post":"ckq14rx1s000644udhqh10rqa","slug":"3.PNG","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-Django-Admin/4.PNG","post":"ckq14rx1s000644udhqh10rqa","slug":"4.PNG","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-Django-Admin/5.PNG","post":"ckq14rx1s000644udhqh10rqa","slug":"5.PNG","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-Django-Admin/Screenshot_8.webp","post":"ckq14rx1s000644udhqh10rqa","slug":"Screenshot_8.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-模型设计/Screenshot_1.webp","post":"ckq14rx1w000a44ud6rrc2nrr","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-模型设计/Screenshot_8.webp","post":"ckq14rx1w000a44ud6rrc2nrr","slug":"Screenshot_8.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-URL分发/1.PNG","post":"ckq14rx1t000744ud5hc8bryn","slug":"1.PNG","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-URL分发/Screenshot_8.webp","post":"ckq14rx1t000744ud5hc8bryn","slug":"Screenshot_8.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-系统设计/Screenshot_1.webp","post":"ckq14rx1x000b44uddd9z6z1t","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-系统设计/Screenshot_2.webp","post":"ckq14rx1x000b44uddd9z6z1t","slug":"Screenshot_2.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-系统设计/Screenshot_3.webp","post":"ckq14rx1x000b44uddd9z6z1t","slug":"Screenshot_3.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-系统设计/Screenshot_4.webp","post":"ckq14rx1x000b44uddd9z6z1t","slug":"Screenshot_4.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-系统设计/Screenshot_5.webp","post":"ckq14rx1x000b44uddd9z6z1t","slug":"Screenshot_5.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-系统设计/Screenshot_6.webp","post":"ckq14rx1x000b44uddd9z6z1t","slug":"Screenshot_6.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-系统设计/Screenshot_7.webp","post":"ckq14rx1x000b44uddd9z6z1t","slug":"Screenshot_7.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-系统设计/Screenshot_8.webp","post":"ckq14rx1x000b44uddd9z6z1t","slug":"Screenshot_8.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-视图函数/Screenshot_1.webp","post":"ckq14rx1z000f44ud0sl942m4","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-视图函数/Screenshot_2.webp","post":"ckq14rx1z000f44ud0sl942m4","slug":"Screenshot_2.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-视图函数/Screenshot_3.webp","post":"ckq14rx1z000f44ud0sl942m4","slug":"Screenshot_3.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-视图函数/Screenshot_8.webp","post":"ckq14rx1z000f44ud0sl942m4","slug":"Screenshot_8.webp","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-静态文件设置/1.PNG","post":"ckq14rx1z000h44ud0j9o1lug","slug":"1.PNG","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-静态文件设置/2.PNG","post":"ckq14rx1z000h44ud0j9o1lug","slug":"2.PNG","modified":1,"renderable":1},{"_id":"source/_posts/Django入门-静态文件设置/Screenshot_8.webp","post":"ckq14rx1z000h44ud0j9o1lug","slug":"Screenshot_8.webp","modified":1,"renderable":1},{"_id":"source/_posts/FastAPI安装和使用/Screenshot_1.webp","post":"ckq14rx21000m44ud97bxbmz4","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/FastAPI安装和使用/Screenshot_2.webp","post":"ckq14rx21000m44ud97bxbmz4","slug":"Screenshot_2.webp","modified":1,"renderable":1},{"_id":"source/_posts/FastAPI教程-路径参数/Screenshot_1.webp","post":"ckq14rx23000r44ud9msme734","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/Nginx配置详解/1.jpg","post":"ckq14rx28001944ud3d8ecghf","slug":"1.jpg","modified":1,"renderable":1},{"_id":"source/_posts/Nginx配置详解/2.jpg","post":"ckq14rx28001944ud3d8ecghf","slug":"2.jpg","modified":1,"renderable":1},{"_id":"source/_posts/Nginx配置详解/3.jpg","post":"ckq14rx28001944ud3d8ecghf","slug":"3.jpg","modified":1,"renderable":1},{"_id":"source/_posts/Pyppeteer的使用/example.webp","post":"ckq14rx29001b44udfzos2d06","slug":"example.webp","modified":1,"renderable":1},{"_id":"source/_posts/Pyppeteer的使用/example1.webp","post":"ckq14rx29001b44udfzos2d06","slug":"example1.webp","modified":1,"renderable":1},{"_id":"source/_posts/django入门及环境搭建/Screenshot_1.webp","post":"ckq14rx2d001p44udgygwas9u","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/django入门及环境搭建/Screenshot_8.webp","post":"ckq14rx2d001p44udgygwas9u","slug":"Screenshot_8.webp","modified":1,"renderable":1},{"_id":"source/_posts/go语言的下载和安装/Screenshot_1.webp","post":"ckq14rx2g002044ud1tqu689z","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/go语言的下载和安装/Screenshot_2.webp","post":"ckq14rx2g002044ud1tqu689z","slug":"Screenshot_2.webp","modified":1,"renderable":1},{"_id":"source/_posts/python的内置类型/Screenshot_1.webp","post":"ckq14rx2l002c44udesx65y7q","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/scrapy框架介绍/Screenshot_1.webp","post":"ckq14rx2n002k44udb8h68u35","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/scrapy的基本使用/Screenshot_1.webp","post":"ckq14rx2o002n44udc5qo24uz","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/scrapy的基本使用/Screenshot_2.webp","post":"ckq14rx2o002n44udc5qo24uz","slug":"Screenshot_2.webp","modified":1,"renderable":1},{"_id":"source/_posts/scrapy的基本使用/Screenshot_3.webp","post":"ckq14rx2o002n44udc5qo24uz","slug":"Screenshot_3.webp","modified":1,"renderable":1},{"_id":"source/_posts/web网页基础/Screenshot_1.png","post":"ckq14rx2p002s44udeu8v0gzv","slug":"Screenshot_1.png","modified":1,"renderable":1},{"_id":"source/_posts/优美图库抓取/Screenshot_1.webp","post":"ckq14rx2q002v44ud2ndzc7i1","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/南瑞103协议详解/Screenshot_1.webp","post":"ckq14rx2r003044udgx6d6emv","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/南瑞103协议详解/Screenshot_2.webp","post":"ckq14rx2r003044udgx6d6emv","slug":"Screenshot_2.webp","modified":1,"renderable":1},{"_id":"source/_posts/南瑞103协议详解/Screenshot_3.webp","post":"ckq14rx2r003044udgx6d6emv","slug":"Screenshot_3.webp","modified":1,"renderable":1},{"_id":"source/_posts/南瑞103协议详解/Screenshot_4.webp","post":"ckq14rx2r003044udgx6d6emv","slug":"Screenshot_4.webp","modified":1,"renderable":1},{"_id":"source/_posts/南瑞103协议详解/Screenshot_5.webp","post":"ckq14rx2r003044udgx6d6emv","slug":"Screenshot_5.webp","modified":1,"renderable":1},{"_id":"source/_posts/基于docker部署code-server/Screenshot_1.webp","post":"ckq14rx2w003g44ud16kte82a","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_1.webp","post":"ckq14rx2w003j44udd8w6c77k","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_10.webp","post":"ckq14rx2w003j44udd8w6c77k","slug":"Screenshot_10.webp","modified":1,"renderable":1},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_11.webp","post":"ckq14rx2w003j44udd8w6c77k","slug":"Screenshot_11.webp","modified":1,"renderable":1},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_12.webp","post":"ckq14rx2w003j44udd8w6c77k","slug":"Screenshot_12.webp","modified":1,"renderable":1},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_2.webp","post":"ckq14rx2w003j44udd8w6c77k","slug":"Screenshot_2.webp","modified":1,"renderable":1},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_3.webp","post":"ckq14rx2w003j44udd8w6c77k","slug":"Screenshot_3.webp","modified":1,"renderable":1},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_4.webp","post":"ckq14rx2w003j44udd8w6c77k","slug":"Screenshot_4.webp","modified":1,"renderable":1},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_5.webp","post":"ckq14rx2w003j44udd8w6c77k","slug":"Screenshot_5.webp","modified":1,"renderable":1},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_6.webp","post":"ckq14rx2w003j44udd8w6c77k","slug":"Screenshot_6.webp","modified":1,"renderable":1},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_7.webp","post":"ckq14rx2w003j44udd8w6c77k","slug":"Screenshot_7.webp","modified":1,"renderable":1},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_8.webp","post":"ckq14rx2w003j44udd8w6c77k","slug":"Screenshot_8.webp","modified":1,"renderable":1},{"_id":"source/_posts/抓取网易云音乐热评/Screenshot_9.webp","post":"ckq14rx2w003j44udd8w6c77k","slug":"Screenshot_9.webp","modified":1,"renderable":1},{"_id":"source/_posts/正则表达式/Screenshot_1.webp","post":"ckq14rx2x003n44udd6goao03","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/深度优先和广度优先算法/1.gif","post":"ckq14rx2y003q44uddwlygsre","slug":"1.gif","modified":1,"renderable":1},{"_id":"source/_posts/深度优先和广度优先算法/1.PNG","post":"ckq14rx2y003q44uddwlygsre","slug":"1.PNG","modified":1,"renderable":1},{"_id":"source/_posts/深度优先和广度优先算法/2.gif","post":"ckq14rx2y003q44uddwlygsre","slug":"2.gif","modified":1,"renderable":1},{"_id":"source/_posts/深度优先和广度优先算法/2.PNG","post":"ckq14rx2y003q44uddwlygsre","slug":"2.PNG","modified":1,"renderable":1},{"_id":"source/_posts/深度优先和广度优先算法/3.PNG","post":"ckq14rx2y003q44uddwlygsre","slug":"3.PNG","modified":1,"renderable":1},{"_id":"source/_posts/深度优先和广度优先算法/4.PNG","post":"ckq14rx2y003q44uddwlygsre","slug":"4.PNG","modified":1,"renderable":1},{"_id":"source/_posts/深度优先和广度优先算法/5.png","post":"ckq14rx2y003q44uddwlygsre","slug":"5.png","modified":1,"renderable":1},{"_id":"source/_posts/深度优先和广度优先算法/6.png","post":"ckq14rx2y003q44uddwlygsre","slug":"6.png","modified":1,"renderable":1},{"_id":"source/_posts/腾讯云主机CPU占用百分百/Screenshot_1.webp","post":"ckq14rx3n006y44uddspf14b9","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/HTTP基本原理/1.png","post":"ckq14rx3t007144ud8eh11ttk","slug":"1.png","modified":1,"renderable":1},{"_id":"source/_posts/HTTP基本原理/Screenshot_1.png","post":"ckq14rx3t007144ud8eh11ttk","slug":"Screenshot_1.png","modified":1,"renderable":1},{"_id":"source/_posts/HTTP基本原理/Screenshot_2.png","post":"ckq14rx3t007144ud8eh11ttk","slug":"Screenshot_2.png","modified":1,"renderable":1},{"_id":"source/_posts/HTTP基本原理/Screenshot_3.png","post":"ckq14rx3t007144ud8eh11ttk","slug":"Screenshot_3.png","modified":1,"renderable":1},{"_id":"source/_posts/HTTP基本原理/webp_0.webp","post":"ckq14rx3t007144ud8eh11ttk","slug":"webp_0.webp","modified":1,"renderable":1},{"_id":"source/_posts/Requests库的使用/requests-sidebar.png","post":"ckq14rx3u007544ud5q3r8vid","slug":"requests-sidebar.png","modified":1,"renderable":1},{"_id":"source/_posts/Selenium的基本使用/Screenshot_1.webp","post":"ckq14rx3v007844ud314246v2","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/Selenium的基本使用/Screenshot_2.webp","post":"ckq14rx3v007844ud314246v2","slug":"Screenshot_2.webp","modified":1,"renderable":1},{"_id":"source/_posts/Selenium的基本使用/Screenshot_3.webp","post":"ckq14rx3v007844ud314246v2","slug":"Screenshot_3.webp","modified":1,"renderable":1},{"_id":"source/_posts/Selenium的基本使用/Screenshot_4.webp","post":"ckq14rx3v007844ud314246v2","slug":"Screenshot_4.webp","modified":1,"renderable":1},{"_id":"source/_posts/Selenium的基本使用/Screenshot_5.webp","post":"ckq14rx3v007844ud314246v2","slug":"Screenshot_5.webp","modified":1,"renderable":1},{"_id":"source/_posts/Selenium的基本使用/Screenshot_6.webp","post":"ckq14rx3v007844ud314246v2","slug":"Screenshot_6.webp","modified":1,"renderable":1},{"_id":"source/_posts/Selenium的基本使用/Screenshot_7.webp","post":"ckq14rx3v007844ud314246v2","slug":"Screenshot_7.webp","modified":1,"renderable":1},{"_id":"source/_posts/Selenium的基本使用/Screenshot_8.webp","post":"ckq14rx3v007844ud314246v2","slug":"Screenshot_8.webp","modified":1,"renderable":1},{"_id":"source/_posts/requests库的基本使用/Screenshot_1.webp","post":"ckq14rx3w007f44udclyzgk0i","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/requests库的基本使用/Screenshot_2.webp","post":"ckq14rx3w007f44udclyzgk0i","slug":"Screenshot_2.webp","modified":1,"renderable":1},{"_id":"source/_posts/requests库的基本使用/Screenshot_3.webp","post":"ckq14rx3w007f44udclyzgk0i","slug":"Screenshot_3.webp","modified":1,"renderable":1},{"_id":"source/_posts/requests库的基本使用/Screenshot_4.webp","post":"ckq14rx3w007f44udclyzgk0i","slug":"Screenshot_4.webp","modified":1,"renderable":1},{"_id":"source/_posts/request、pyquest和pymongodb案例实战/Screenshot_1.webp","post":"ckq14rx3x007i44udcdju8zq2","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/request、pyquest和pymongodb案例实战/Screenshot_2.webp","post":"ckq14rx3x007i44udcdju8zq2","slug":"Screenshot_2.webp","modified":1,"renderable":1},{"_id":"source/_posts/request、pyquest和pymongodb案例实战/Screenshot_3.webp","post":"ckq14rx3x007i44udcdju8zq2","slug":"Screenshot_3.webp","modified":1,"renderable":1},{"_id":"source/_posts/request、pyquest和pymongodb案例实战/Screenshot_4.webp","post":"ckq14rx3x007i44udcdju8zq2","slug":"Screenshot_4.webp","modified":1,"renderable":1},{"_id":"source/_posts/request、pyquest和pymongodb案例实战/Screenshot_5.webp","post":"ckq14rx3x007i44udcdju8zq2","slug":"Screenshot_5.webp","modified":1,"renderable":1},{"_id":"source/_posts/request、pyquest和pymongodb案例实战/Screenshot_6.webp","post":"ckq14rx3x007i44udcdju8zq2","slug":"Screenshot_6.webp","modified":1,"renderable":1},{"_id":"source/_posts/异步爬虫的原理和解析/Screenshot_1.webp","post":"ckq14rx3y007p44ud2cchdwsb","slug":"Screenshot_1.webp","modified":1,"renderable":1},{"_id":"source/_posts/经典豆瓣TOP250爬取/Screenshot_1.webp","post":"ckq14rx3z007t44udatvs4se9","slug":"Screenshot_1.webp","modified":1,"renderable":1}],"PostCategory":[{"post_id":"ckq14rx1m000144ud120ngx2k","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx1y000d44ud4i53gfmv"},{"post_id":"ckq14rx1p000244ud8p7lapr2","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx20000i44ud7om03x06"},{"post_id":"ckq14rx1s000544ude5b5cn5h","category_id":"ckq14rx1y000c44ud8jga9xix","_id":"ckq14rx22000o44uddf3o66c8"},{"post_id":"ckq14rx1s000644udhqh10rqa","category_id":"ckq14rx20000k44udgpeg6as5","_id":"ckq14rx24000w44ud487e9vv2"},{"post_id":"ckq14rx1t000744ud5hc8bryn","category_id":"ckq14rx20000k44udgpeg6as5","_id":"ckq14rx26001144ud425n967g"},{"post_id":"ckq14rx1w000a44ud6rrc2nrr","category_id":"ckq14rx20000k44udgpeg6as5","_id":"ckq14rx28001744ud927sawjy"},{"post_id":"ckq14rx1x000b44uddd9z6z1t","category_id":"ckq14rx20000k44udgpeg6as5","_id":"ckq14rx2a001d44ud9yyy810o"},{"post_id":"ckq14rx27001544ud4npbh07d","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx2b001g44udcsvnhm03"},{"post_id":"ckq14rx1z000f44ud0sl942m4","category_id":"ckq14rx20000k44udgpeg6as5","_id":"ckq14rx2c001k44udf5uz9a7e"},{"post_id":"ckq14rx29001b44udfzos2d06","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx2d001o44udf7qy2v5f"},{"post_id":"ckq14rx2b001e44ud5od5dy24","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx2e001q44ud98dy4cnh"},{"post_id":"ckq14rx1z000h44ud0j9o1lug","category_id":"ckq14rx20000k44udgpeg6as5","_id":"ckq14rx2f001u44ude5arcs8m"},{"post_id":"ckq14rx2c001i44udb2h8161p","category_id":"ckq14rx1y000c44ud8jga9xix","_id":"ckq14rx2g001x44udbj911opc"},{"post_id":"ckq14rx2d001m44udc7qx4dem","category_id":"ckq14rx1y000c44ud8jga9xix","_id":"ckq14rx2h002244ud98fcdea8"},{"post_id":"ckq14rx21000m44ud97bxbmz4","category_id":"ckq14rx2c001j44udc6y48fnd","_id":"ckq14rx2j002544ud4qq851o3"},{"post_id":"ckq14rx2d001p44udgygwas9u","category_id":"ckq14rx20000k44udgpeg6as5","_id":"ckq14rx2l002a44ude2tofjcb"},{"post_id":"ckq14rx21000n44udfelrbuw0","category_id":"ckq14rx2c001j44udc6y48fnd","_id":"ckq14rx2l002d44ud1u9sdt36"},{"post_id":"ckq14rx23000r44ud9msme734","category_id":"ckq14rx2c001j44udc6y48fnd","_id":"ckq14rx2n002i44udakf18m7a"},{"post_id":"ckq14rx2h002444ud1xjj6ao6","category_id":"ckq14rx1y000c44ud8jga9xix","_id":"ckq14rx2n002l44ud72xu3sxv"},{"post_id":"ckq14rx23000t44ud3y854fmi","category_id":"ckq14rx2k002744ud5pr69hjb","_id":"ckq14rx2p002q44ud7o61cwoh"},{"post_id":"ckq14rx2m002f44udc6r0e9dp","category_id":"ckq14rx1y000c44ud8jga9xix","_id":"ckq14rx2p002t44ud9feddtx2"},{"post_id":"ckq14rx2n002k44udb8h68u35","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx2r002y44udhn8e3bti"},{"post_id":"ckq14rx25000y44udgmmrg69i","category_id":"ckq14rx2k002744ud5pr69hjb","_id":"ckq14rx2s003144udh7z52y38"},{"post_id":"ckq14rx2o002n44udc5qo24uz","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx2u003644ud1gsbe9yq"},{"post_id":"ckq14rx2p002s44udeu8v0gzv","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx2u003944ude9eo0l9l"},{"post_id":"ckq14rx25000z44uda4nbfdlh","category_id":"ckq14rx2o002o44udgwswc3zs","_id":"ckq14rx2v003e44udchprftu8"},{"post_id":"ckq14rx2q002v44ud2ndzc7i1","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx2w003h44ud259728uc"},{"post_id":"ckq14rx26001344udgg5jh0hc","category_id":"ckq14rx2o002o44udgwswc3zs","_id":"ckq14rx2x003k44ud6dl9csov"},{"post_id":"ckq14rx2s003344ud4pk93oai","category_id":"ckq14rx2o002o44udgwswc3zs","_id":"ckq14rx2y003p44uda7mtdq24"},{"post_id":"ckq14rx2u003844ud7ct5fkxg","category_id":"ckq14rx2o002o44udgwswc3zs","_id":"ckq14rx2z003s44ud8poggwng"},{"post_id":"ckq14rx28001944ud3d8ecghf","category_id":"ckq14rx2t003444ud2g08gl0v","_id":"ckq14rx30003x44udce2hajmd"},{"post_id":"ckq14rx2e001s44udbzgcbtjj","category_id":"ckq14rx2v003d44ud3fojfuk8","_id":"ckq14rx31004044ud5pey9n9m"},{"post_id":"ckq14rx2w003j44udd8w6c77k","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx32004444uddd9d240f"},{"post_id":"ckq14rx2x003n44udd6goao03","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx32004644ud42wv5vi1"},{"post_id":"ckq14rx2f001w44ud5mwg942g","category_id":"ckq14rx2x003m44ud2x6af9gp","_id":"ckq14rx32004944ud91uv02nf"},{"post_id":"ckq14rx2z003u44ud18r7dvmj","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx33004b44udami22vki"},{"post_id":"ckq14rx30003y44ud0k0yctqj","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx33004e44udei9kbi54"},{"post_id":"ckq14rx2g002044ud1tqu689z","category_id":"ckq14rx30003v44udc6jz64nc","_id":"ckq14rx33004g44ud1tsm1kl1"},{"post_id":"ckq14rx2k002844ud9kdmc7e0","category_id":"ckq14rx31004244ud0taw4tcg","_id":"ckq14rx33004j44ud0o994m5z"},{"post_id":"ckq14rx2l002c44udesx65y7q","category_id":"ckq14rx31004244ud0taw4tcg","_id":"ckq14rx34004l44udfh0pepyh"},{"post_id":"ckq14rx2r003044udgx6d6emv","category_id":"ckq14rx33004d44udbh755d59","_id":"ckq14rx34004n44udf7rkexto"},{"post_id":"ckq14rx2v003b44udf8rz5b76","category_id":"ckq14rx33004k44ud3x2zb5eb","_id":"ckq14rx35004r44udh3sk5ceh"},{"post_id":"ckq14rx2w003g44ud16kte82a","category_id":"ckq14rx33004k44ud3x2zb5eb","_id":"ckq14rx36004u44udf777gajd"},{"post_id":"ckq14rx2y003q44uddwlygsre","category_id":"ckq14rx34004q44uddy738q0y","_id":"ckq14rx37004z44ud8v1ha0ur"},{"post_id":"ckq14rx3n006y44uddspf14b9","category_id":"ckq14rx2v003d44ud3fojfuk8","_id":"ckq14rx3u007344uddd8g3kc4"},{"post_id":"ckq14rx3r006z44ud1pa96ed6","category_id":"ckq14rx2o002o44udgwswc3zs","_id":"ckq14rx3u007644udabna9gjl"},{"post_id":"ckq14rx3t007144ud8eh11ttk","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx3v007944udd6eu6okt"},{"post_id":"ckq14rx3t007244ud3upigfwe","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx3w007c44ud6apydyhv"},{"post_id":"ckq14rx3u007544ud5q3r8vid","category_id":"ckq14rx1y000c44ud8jga9xix","_id":"ckq14rx3w007g44udapa73dyy"},{"post_id":"ckq14rx3v007844ud314246v2","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx3x007j44udeizbe9hy"},{"post_id":"ckq14rx3v007b44ud8c72avd1","category_id":"ckq14rx31004244ud0taw4tcg","_id":"ckq14rx3y007n44udf3kf2exr"},{"post_id":"ckq14rx3w007f44udclyzgk0i","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx3z007q44udc1ml5dcd"},{"post_id":"ckq14rx3x007i44udcdju8zq2","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx3z007u44uddwdp116z"},{"post_id":"ckq14rx3y007m44ud459u6xz1","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx40007w44ud50y10ebj"},{"post_id":"ckq14rx3y007p44ud2cchdwsb","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx40007y44udcp17cm9k"},{"post_id":"ckq14rx3z007t44udatvs4se9","category_id":"ckq14rx1q000344udc1k119cg","_id":"ckq14rx40008144udaag1gj36"}],"PostTag":[{"post_id":"ckq14rx1m000144ud120ngx2k","tag_id":"ckq14rx1r000444udf180gwe7","_id":"ckq14rx1z000g44udey6h81pr"},{"post_id":"ckq14rx1m000144ud120ngx2k","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx20000j44ud96xzgj0v"},{"post_id":"ckq14rx1p000244ud8p7lapr2","tag_id":"ckq14rx1r000444udf180gwe7","_id":"ckq14rx23000s44ud4mxwe07k"},{"post_id":"ckq14rx1p000244ud8p7lapr2","tag_id":"ckq14rx20000l44udaiuk13px","_id":"ckq14rx24000u44udeeja969x"},{"post_id":"ckq14rx1s000544ude5b5cn5h","tag_id":"ckq14rx22000q44ud806hbqov","_id":"ckq14rx27001444ud7orwflt0"},{"post_id":"ckq14rx1s000544ude5b5cn5h","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx28001844ud0vfkcqko"},{"post_id":"ckq14rx1s000644udhqh10rqa","tag_id":"ckq14rx26001244uddnegdwwd","_id":"ckq14rx2c001h44udd7j8f9k0"},{"post_id":"ckq14rx1s000644udhqh10rqa","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx2c001l44udfigl4tkd"},{"post_id":"ckq14rx2d001p44udgygwas9u","tag_id":"ckq14rx26001244uddnegdwwd","_id":"ckq14rx2f001v44udd9p4gd6e"},{"post_id":"ckq14rx2d001p44udgygwas9u","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx2g001y44ud7jsaawea"},{"post_id":"ckq14rx1t000744ud5hc8bryn","tag_id":"ckq14rx26001244uddnegdwwd","_id":"ckq14rx2h002344uddi3xdgic"},{"post_id":"ckq14rx1t000744ud5hc8bryn","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx2j002644ud4e2feajp"},{"post_id":"ckq14rx1w000a44ud6rrc2nrr","tag_id":"ckq14rx26001244uddnegdwwd","_id":"ckq14rx2l002b44udgxhsdv46"},{"post_id":"ckq14rx1w000a44ud6rrc2nrr","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx2l002e44ud3ao806kt"},{"post_id":"ckq14rx1x000b44uddd9z6z1t","tag_id":"ckq14rx26001244uddnegdwwd","_id":"ckq14rx2n002j44ud2cbt51nb"},{"post_id":"ckq14rx2l002c44udesx65y7q","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx2n002m44uddxjnh3v2"},{"post_id":"ckq14rx1z000f44ud0sl942m4","tag_id":"ckq14rx26001244uddnegdwwd","_id":"ckq14rx2p002r44udgmw7crrg"},{"post_id":"ckq14rx1z000h44ud0j9o1lug","tag_id":"ckq14rx26001244uddnegdwwd","_id":"ckq14rx2q002u44ud0s0vamex"},{"post_id":"ckq14rx1z000h44ud0j9o1lug","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx2r002z44ud10d4bea1"},{"post_id":"ckq14rx21000m44ud97bxbmz4","tag_id":"ckq14rx2o002p44udcv0y8mle","_id":"ckq14rx2s003244ud4jc4a5ay"},{"post_id":"ckq14rx21000m44ud97bxbmz4","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx2u003744ud063e1ppj"},{"post_id":"ckq14rx21000n44udfelrbuw0","tag_id":"ckq14rx2o002p44udcv0y8mle","_id":"ckq14rx2u003a44uddapya0dm"},{"post_id":"ckq14rx21000n44udfelrbuw0","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx2w003f44ud33ql6r99"},{"post_id":"ckq14rx23000r44ud9msme734","tag_id":"ckq14rx2o002p44udcv0y8mle","_id":"ckq14rx2w003i44udfw3r1of4"},{"post_id":"ckq14rx23000t44ud3y854fmi","tag_id":"ckq14rx2v003c44udapot1wpd","_id":"ckq14rx2y003o44ud2rqycyoz"},{"post_id":"ckq14rx23000t44ud3y854fmi","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx2z003r44udanfbdx98"},{"post_id":"ckq14rx2w003j44udd8w6c77k","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx30003w44ud0wj1cq1h"},{"post_id":"ckq14rx25000y44udgmmrg69i","tag_id":"ckq14rx2v003c44udapot1wpd","_id":"ckq14rx31003z44ud2x3qenti"},{"post_id":"ckq14rx2y003q44uddwlygsre","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx32004344ud9gwq0c5m"},{"post_id":"ckq14rx25000z44uda4nbfdlh","tag_id":"ckq14rx2z003t44ud0f48cjy9","_id":"ckq14rx32004544ud9yf0gyu7"},{"post_id":"ckq14rx26001344udgg5jh0hc","tag_id":"ckq14rx2z003t44ud0f48cjy9","_id":"ckq14rx32004a44udessgf4rq"},{"post_id":"ckq14rx27001544ud4npbh07d","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx33004f44ud8hwf9epn"},{"post_id":"ckq14rx27001544ud4npbh07d","tag_id":"ckq14rx32004744ud1qimbly1","_id":"ckq14rx33004h44ud7ccmaa1t"},{"post_id":"ckq14rx28001944ud3d8ecghf","tag_id":"ckq14rx33004c44uddllp3ibc","_id":"ckq14rx36004s44udc38350jp"},{"post_id":"ckq14rx28001944ud3d8ecghf","tag_id":"ckq14rx33004i44ud11vucag4","_id":"ckq14rx36004t44ud659ge22q"},{"post_id":"ckq14rx28001944ud3d8ecghf","tag_id":"ckq14rx34004m44ud2nov4967","_id":"ckq14rx36004w44ud4slj9qan"},{"post_id":"ckq14rx29001b44udfzos2d06","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx36004x44ud7lfgdz4v"},{"post_id":"ckq14rx29001b44udfzos2d06","tag_id":"ckq14rx34004p44udax1s1e1n","_id":"ckq14rx37005044ud3l1o2fqj"},{"post_id":"ckq14rx2b001e44ud5od5dy24","tag_id":"ckq14rx34004m44ud2nov4967","_id":"ckq14rx37005244ud2uynfgrd"},{"post_id":"ckq14rx2b001e44ud5od5dy24","tag_id":"ckq14rx36004y44ud8lxp8efk","_id":"ckq14rx37005344ud81z4g714"},{"post_id":"ckq14rx2c001i44udb2h8161p","tag_id":"ckq14rx37005144ud3abi7ive","_id":"ckq14rx37005644udes0v9cl9"},{"post_id":"ckq14rx2c001i44udb2h8161p","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx37005744udc16h1n4l"},{"post_id":"ckq14rx2c001i44udb2h8161p","tag_id":"ckq14rx37005444ud4o7qcb4h","_id":"ckq14rx38005944ud9j5g2c5v"},{"post_id":"ckq14rx2d001m44udc7qx4dem","tag_id":"ckq14rx37005544ud15oagb7r","_id":"ckq14rx38005a44ud96ur9y5m"},{"post_id":"ckq14rx2d001m44udc7qx4dem","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx38005c44udftat1uwr"},{"post_id":"ckq14rx2e001s44udbzgcbtjj","tag_id":"ckq14rx38005844ud955kel0d","_id":"ckq14rx38005e44ud4ooph52f"},{"post_id":"ckq14rx2e001s44udbzgcbtjj","tag_id":"ckq14rx38005b44ud8f2s6kc0","_id":"ckq14rx38005f44ud1r175b3b"},{"post_id":"ckq14rx2f001w44ud5mwg942g","tag_id":"ckq14rx38005d44ud4zkaclbs","_id":"ckq14rx39005h44ud31ms6h5h"},{"post_id":"ckq14rx2g002044ud1tqu689z","tag_id":"ckq14rx38005g44ud6uh76ts8","_id":"ckq14rx39005j44ud1dtfbz83"},{"post_id":"ckq14rx2h002444ud1xjj6ao6","tag_id":"ckq14rx39005i44udhsbj2tkq","_id":"ckq14rx39005l44udcqi10lsv"},{"post_id":"ckq14rx2k002844ud9kdmc7e0","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx39005o44udbkgi9pki"},{"post_id":"ckq14rx2k002844ud9kdmc7e0","tag_id":"ckq14rx39005k44udclol5wjp","_id":"ckq14rx3a005p44ud6l6h9hnu"},{"post_id":"ckq14rx2k002844ud9kdmc7e0","tag_id":"ckq14rx39005m44ud0f5o5u3j","_id":"ckq14rx3a005r44ud0nur2q4j"},{"post_id":"ckq14rx2m002f44udc6r0e9dp","tag_id":"ckq14rx39005n44ud4281f3gf","_id":"ckq14rx3a005s44ud4fcwbk9q"},{"post_id":"ckq14rx2m002f44udc6r0e9dp","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx3a005u44ud0ncsan29"},{"post_id":"ckq14rx2n002k44udb8h68u35","tag_id":"ckq14rx3a005q44udg4ib8tf2","_id":"ckq14rx3a005v44ud05sp3r6i"},{"post_id":"ckq14rx2n002k44udb8h68u35","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx3a005x44udgk25c9ag"},{"post_id":"ckq14rx2o002n44udc5qo24uz","tag_id":"ckq14rx3a005q44udg4ib8tf2","_id":"ckq14rx3b005y44uda0p8clgf"},{"post_id":"ckq14rx2p002s44udeu8v0gzv","tag_id":"ckq14rx3a005w44udewc9g7kv","_id":"ckq14rx3b006144ud1oyh5aam"},{"post_id":"ckq14rx2p002s44udeu8v0gzv","tag_id":"ckq14rx3b005z44ud41p485a3","_id":"ckq14rx3b006244udca9a6zgv"},{"post_id":"ckq14rx2p002s44udeu8v0gzv","tag_id":"ckq14rx20000l44udaiuk13px","_id":"ckq14rx3b006444udbdau5xkp"},{"post_id":"ckq14rx2q002v44ud2ndzc7i1","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx3b006544ud6ftqhurj"},{"post_id":"ckq14rx2q002v44ud2ndzc7i1","tag_id":"ckq14rx22000q44ud806hbqov","_id":"ckq14rx3c006744udgt6ghh61"},{"post_id":"ckq14rx2q002v44ud2ndzc7i1","tag_id":"ckq14rx3b006044ud51r9a85u","_id":"ckq14rx3c006844ud3f3z87uh"},{"post_id":"ckq14rx2r003044udgx6d6emv","tag_id":"ckq14rx3b006344ud5i154zr9","_id":"ckq14rx3d006a44uda1uqe9jv"},{"post_id":"ckq14rx2s003344ud4pk93oai","tag_id":"ckq14rx2z003t44ud0f48cjy9","_id":"ckq14rx3d006b44ud112e3x3s"},{"post_id":"ckq14rx2u003844ud7ct5fkxg","tag_id":"ckq14rx3c006944udhqz65zah","_id":"ckq14rx3f006e44ud2ifu8sjm"},{"post_id":"ckq14rx2u003844ud7ct5fkxg","tag_id":"ckq14rx38005b44ud8f2s6kc0","_id":"ckq14rx3f006f44udch5483m9"},{"post_id":"ckq14rx2v003b44udf8rz5b76","tag_id":"ckq14rx38005b44ud8f2s6kc0","_id":"ckq14rx3f006i44udhnh3b32c"},{"post_id":"ckq14rx2v003b44udf8rz5b76","tag_id":"ckq14rx3f006g44udfft8484i","_id":"ckq14rx3f006j44uddjtt0ssj"},{"post_id":"ckq14rx2w003g44ud16kte82a","tag_id":"ckq14rx38005b44ud8f2s6kc0","_id":"ckq14rx3g006m44udhxgn11fv"},{"post_id":"ckq14rx2w003g44ud16kte82a","tag_id":"ckq14rx3f006k44ud68pzaqsl","_id":"ckq14rx3g006n44ud9i7ngvoe"},{"post_id":"ckq14rx2x003n44udd6goao03","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx3g006p44udamd21kmx"},{"post_id":"ckq14rx2x003n44udd6goao03","tag_id":"ckq14rx39005n44ud4281f3gf","_id":"ckq14rx3g006q44udb4008nvi"},{"post_id":"ckq14rx2z003u44ud18r7dvmj","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx3h006s44ud29cjb4qa"},{"post_id":"ckq14rx2z003u44ud18r7dvmj","tag_id":"ckq14rx3g006o44ud52nt4go0","_id":"ckq14rx3h006t44uda26k69dq"},{"post_id":"ckq14rx30003y44ud0k0yctqj","tag_id":"ckq14rx34004m44ud2nov4967","_id":"ckq14rx3h006v44ud1i805b6l"},{"post_id":"ckq14rx30003y44ud0k0yctqj","tag_id":"ckq14rx3h006u44ud5zdx57w3","_id":"ckq14rx3h006w44ud7exd59nt"},{"post_id":"ckq14rx30003y44ud0k0yctqj","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx3h006x44ud53no4i91"},{"post_id":"ckq14rx3t007144ud8eh11ttk","tag_id":"ckq14rx34004m44ud2nov4967","_id":"ckq14rx3u007444ud9aj90f8v"},{"post_id":"ckq14rx3u007544ud5q3r8vid","tag_id":"ckq14rx3b006044ud51r9a85u","_id":"ckq14rx3v007a44ud6waw90uu"},{"post_id":"ckq14rx3u007544ud5q3r8vid","tag_id":"ckq14rx34004m44ud2nov4967","_id":"ckq14rx3w007e44ud0sr87m8x"},{"post_id":"ckq14rx3n006y44uddspf14b9","tag_id":"ckq14rx3s007044ud2b0x5hxm","_id":"ckq14rx3x007h44ud6qgk3zki"},{"post_id":"ckq14rx3n006y44uddspf14b9","tag_id":"ckq14rx38005844ud955kel0d","_id":"ckq14rx3x007l44ud038z8xkx"},{"post_id":"ckq14rx3n006y44uddspf14b9","tag_id":"ckq14rx3u007744ud4i2dbwyj","_id":"ckq14rx3y007o44udd30h16w5"},{"post_id":"ckq14rx3w007f44udclyzgk0i","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx3z007r44ud2ps1hmsf"},{"post_id":"ckq14rx3w007f44udclyzgk0i","tag_id":"ckq14rx3b006044ud51r9a85u","_id":"ckq14rx3z007v44udabsv5gop"},{"post_id":"ckq14rx3w007f44udclyzgk0i","tag_id":"ckq14rx3h006u44ud5zdx57w3","_id":"ckq14rx40007x44ud333g97zn"},{"post_id":"ckq14rx3r006z44ud1pa96ed6","tag_id":"ckq14rx3w007d44ud7aur0s5r","_id":"ckq14rx40008044ud061qe7by"},{"post_id":"ckq14rx3r006z44ud1pa96ed6","tag_id":"ckq14rx3x007k44ud7j0x0t5e","_id":"ckq14rx40008244ud9kbh0r3i"},{"post_id":"ckq14rx3y007p44ud2cchdwsb","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx40008444udbjv9azrn"},{"post_id":"ckq14rx3y007p44ud2cchdwsb","tag_id":"ckq14rx37005544ud15oagb7r","_id":"ckq14rx40008544ud5mtscqob"},{"post_id":"ckq14rx3z007t44udatvs4se9","tag_id":"ckq14rx39005n44ud4281f3gf","_id":"ckq14rx41008744ud41fkarjc"},{"post_id":"ckq14rx3z007t44udatvs4se9","tag_id":"ckq14rx3b006044ud51r9a85u","_id":"ckq14rx41008844ud22jccm23"},{"post_id":"ckq14rx3t007244ud3upigfwe","tag_id":"ckq14rx3z007s44ud408x1z5a","_id":"ckq14rx41008944ud2zn2as1b"},{"post_id":"ckq14rx3t007244ud3upigfwe","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx41008b44ud5q9l24qn"},{"post_id":"ckq14rx3v007844ud314246v2","tag_id":"ckq14rx40007z44ud5nuvgoil","_id":"ckq14rx41008c44ud3s7cdvkt"},{"post_id":"ckq14rx3v007b44ud8c72avd1","tag_id":"ckq14rx1u000944udb4h6b2ac","_id":"ckq14rx41008e44ud5bw73ztw"},{"post_id":"ckq14rx3v007b44ud8c72avd1","tag_id":"ckq14rx40008344udavilfha2","_id":"ckq14rx41008f44udbm0y5aae"},{"post_id":"ckq14rx3x007i44udcdju8zq2","tag_id":"ckq14rx40008644udgqt1c16s","_id":"ckq14rx42008h44udf6wneyxc"},{"post_id":"ckq14rx3x007i44udcdju8zq2","tag_id":"ckq14rx41008a44ud4nfghjsk","_id":"ckq14rx42008i44udaaojee23"},{"post_id":"ckq14rx3x007i44udcdju8zq2","tag_id":"ckq14rx41008d44ud81iecr6e","_id":"ckq14rx42008j44ud3q757bnx"},{"post_id":"ckq14rx3y007m44ud459u6xz1","tag_id":"ckq14rx41008g44udd6uycjbb","_id":"ckq14rx42008k44ud18md0rfd"}],"Tag":[{"name":"ajax","_id":"ckq14rx1r000444udf180gwe7"},{"name":"python","_id":"ckq14rx1u000944udb4h6b2ac"},{"name":"javascript","_id":"ckq14rx20000l44udaiuk13px"},{"name":"bs4","_id":"ckq14rx22000q44ud806hbqov"},{"name":"django","_id":"ckq14rx26001244uddnegdwwd"},{"name":"fastapi","_id":"ckq14rx2o002p44udcv0y8mle"},{"name":"flask","_id":"ckq14rx2v003c44udapot1wpd"},{"name":"Hexo","_id":"ckq14rx2z003t44ud0f48cjy9"},{"name":"mongodb","_id":"ckq14rx32004744ud1qimbly1"},{"name":"Nginx","_id":"ckq14rx33004c44uddllp3ibc"},{"name":"负载均衡","_id":"ckq14rx33004i44ud11vucag4"},{"name":"http","_id":"ckq14rx34004m44ud2nov4967"},{"name":"pypprteer","_id":"ckq14rx34004p44udax1s1e1n"},{"name":"web","_id":"ckq14rx36004y44ud8lxp8efk"},{"name":"xpath","_id":"ckq14rx37005144ud3abi7ive"},{"name":"lxml","_id":"ckq14rx37005444ud4o7qcb4h"},{"name":"asyncio","_id":"ckq14rx37005544ud15oagb7r"},{"name":"linux","_id":"ckq14rx38005844ud955kel0d"},{"name":"docker","_id":"ckq14rx38005b44ud8f2s6kc0"},{"name":"Git","_id":"ckq14rx38005d44ud4zkaclbs"},{"name":"go","_id":"ckq14rx38005g44ud6uh76ts8"},{"name":"logging","_id":"ckq14rx39005i44udhsbj2tkq"},{"name":"多线程","_id":"ckq14rx39005k44udclol5wjp"},{"name":"threading","_id":"ckq14rx39005m44ud0f5o5u3j"},{"name":"re","_id":"ckq14rx39005n44ud4281f3gf"},{"name":"scrapy","_id":"ckq14rx3a005q44udg4ib8tf2"},{"name":"html","_id":"ckq14rx3a005w44udewc9g7kv"},{"name":"css","_id":"ckq14rx3b005z44ud41p485a3"},{"name":"requests","_id":"ckq14rx3b006044ud51r9a85u"},{"name":"pscada","_id":"ckq14rx3b006344ud5i154zr9"},{"name":"nextCloud","_id":"ckq14rx3c006944udhqz65zah"},{"name":"redis","_id":"ckq14rx3f006g44udfft8484i"},{"name":"vscode","_id":"ckq14rx3f006k44ud68pzaqsl"},{"name":"MD5","_id":"ckq14rx3g006o44ud52nt4go0"},{"name":"爬虫","_id":"ckq14rx3h006u44ud5zdx57w3"},{"name":"git","_id":"ckq14rx3s007044ud2b0x5hxm"},{"name":"病毒","_id":"ckq14rx3u007744ud4i2dbwyj"},{"name":"nginx","_id":"ckq14rx3w007d44ud7aur0s5r"},{"name":"https","_id":"ckq14rx3x007k44ud7j0x0t5e"},{"name":"pyquery","_id":"ckq14rx3z007s44ud408x1z5a"},{"name":"selenium","_id":"ckq14rx40007z44ud5nuvgoil"},{"name":"multiprocessing","_id":"ckq14rx40008344udavilfha2"},{"name":"request","_id":"ckq14rx40008644udgqt1c16s"},{"name":"pyquest","_id":"ckq14rx41008a44ud4nfghjsk"},{"name":"pymongodb","_id":"ckq14rx41008d44ud81iecr6e"},{"name":"scarpy","_id":"ckq14rx41008g44udd6uycjbb"}]}}