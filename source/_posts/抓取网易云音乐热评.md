---
title: 抓取网易云音乐热评
tags:
  - python
comments: true
toc: true
only:
  - home
  - category
  - tag
date: 2021-06-10 21:00:14
categories: 爬虫
pic:
---

查看页面源代码，发现源代码中并不含有热评。通过工具抓包查看请求，数据是通过后端数据库请求过来的。

![](Screenshot_1.webp)

查看标头可以发现，这条获取热评的请求传递的参数是加密的。

![](Screenshot_2.webp)

首先，我们要找到未加密的参数。

通过查看请求程序，可以看到当前网页调用了那些JS脚本执行过程，从下往上调用。

![](Screenshot_3.webp)

查看最上面的JS脚本，这是产生请求的最后一个脚本，看看这个脚本里面有什么。

![](Screenshot_4.webp)

点开后，咋一看没法理解，这是经过压缩后的JS脚本，没关系，点击左下方的`{}`优质打印，就是格式化该脚本。

![](Screenshot_5.webp)

通过查看JS脚本，发现`send`函数，设置断点。

![](Screenshot_6.webp)

重新刷新页面，可以看到所有的变量，找到`request`中的`url`为`/weapi/cdns?csrf_token=`，不是我们想要的地址，继续刷新，

![](Screenshot_7.webp)

直到出现`https://music.163.com/weapi/comment/resource/comments/get?csrf_token=`，这就是我们想要的`url`。

![](Screenshot_8.webp)

从上图中可以看到，`params`参数是经过加密的，接着往上分析。

![](Screenshot_9.webp)

查看这里，`d7e`参数，查看这里的`params`依旧是加密的。接着往回找，是谁调用的`b7g.bsO0x`函数。

![](Screenshot_10.webp)

这里可以看到`params`参数依旧是加密的。

![](Screenshot_11.webp)

找到这里就可以看到`params`参数没有加密，说明加密过程就在` t7m.be7X`函数中完成。

![](Screenshot_12.webp)



然后，把参数按照网易的规则进行加密处理，得到两个参数`params`和`encSecKry`。

最后，请求到网易，拿到评论信息。











[//]:#(设置表格整体居中显示)
<style>
    table
    {
        margin: auto;
        font-size: 80%;
    }
</style>


