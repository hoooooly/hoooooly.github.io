<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>feapder框架上手体验</title>
    <link href="/2021/09/15/feapder%E6%A1%86%E6%9E%B6%E4%B8%8A%E6%89%8B%E4%BD%93%E9%AA%8C/"/>
    <url>/2021/09/15/feapder%E6%A1%86%E6%9E%B6%E4%B8%8A%E6%89%8B%E4%BD%93%E9%AA%8C/</url>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><strong>feapder</strong> 是一款上手简单，功能强大的Python爬虫框架，使用方式类似scrapy，方便由scrapy框架切换过来，框架内置3种爬虫：</p><ul><li><code>AirSpider</code>爬虫比较轻量，学习成本低。面对一些数据量较少，无需断点续爬，无需分布式采集的需求，可采用此爬虫。</li><li><code>Spider</code>是一款基于redis的分布式爬虫，适用于海量数据采集，支持断点续爬、爬虫报警、数据自动入库等功能</li><li><code>BatchSpider</code>是一款分布式批次爬虫，对于需要周期性采集的数据，优先考虑使用本爬虫。</li></ul><p><strong>feapder</strong>支持<strong>断点续爬</strong>、<strong>数据防丢</strong>、<strong>监控报警</strong>、<strong>浏览器渲染下载</strong>、数据自动入库<strong>Mysql</strong>或<strong>Mongo</strong>，还可通过编写<a href="http://boris.org.cn/feapder/#/source_code/pipeline">pipeline</a>对接其他存储</p><ul><li>官方文档：<a href="http://feapder.com/">http://feapder.com</a></li><li>国内文档：<a href="https://boris-code.gitee.io/feapder">https://boris-code.gitee.io/feapder</a></li><li>github：<a href="https://github.com/Boris-code/feapder">https://github.com/Boris-code/feapder</a></li><li>更新日志：<a href="https://github.com/Boris-code/feapder/releases">https://github.com/Boris-code/feapder/releases</a></li><li>爬虫管理系统：<a href="https://boris.org.cn/feapder/#/feapder_platform/%E7%88%AC%E8%99%AB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F">https://boris.org.cn/feapder/#/feapder_platform/爬虫管理系统</a></li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="安装要求"><a href="#安装要求" class="headerlink" title="安装要求"></a>安装要求</h3><ul><li>Python 3.6.0+</li><li>Works on Linux, Windows, macOS</li></ul><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><p>这里使用pip安装即可。如果要安装完整版<code>pip3 install feapder[all]</code>，可能会报错参见[官方文档](<a href="http://boris.org.cn/feapder/#/question/%E5%AE%89%E8%A3%85%E9%97%AE%E9%A2%98">安装问题 - feapder-document (boris.org.cn)</a>)。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip3 install feapder<br></code></pre></div></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>创建一个爬虫</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">feapder create -s first_spider<br></code></pre></div></td></tr></table></figure><p>创建后的爬虫代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> feapder<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FirstSpider</span>(<span class="hljs-params">feapder.AirSpider</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start_requests</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">yield</span> feapder.Request(<span class="hljs-string">&quot;https://www.baidu.com&quot;</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, request, response</span>):</span><br>        <span class="hljs-built_in">print</span>(response)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    FirstSpider().start()<br></code></pre></div></td></tr></table></figure><p>直接运行，打印如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shel">C:\Users\q\AppData\Local\Programs\Python\Python39\python.exe D:/PycharmProjects/Spider_learning/feapder_eaxmple/first/first_spider.py<br>2021-09-15 15:17:03.613 | DEBUG    | feapder.core.parser_control:run:464 - parser 等待任务...<br>2021-09-15 15:17:04.625 | DEBUG    | feapder.network.request:get_response:305 - <br>                -------------- FirstSpider.parse request for ----------------<br>                url  = https://www.baidu.com<br>                method = GET<br>                body = &#123;&#x27;timeout&#x27;: 22, &#x27;stream&#x27;: True, &#x27;verify&#x27;: False, &#x27;headers&#x27;: &#123;&#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.16 Safari/537.36&#x27;&#125;&#125;<br>                <br>&lt;Response [200]&gt;<br>2021-09-15 15:17:04.908 | DEBUG    | feapder.core.parser_control:run:464 - parser 等待任务...<br>2021-09-15 15:17:08.663 | INFO     | feapder.core.spiders.air_spider:run:104 - 无任务，爬虫结束<br></code></pre></div></td></tr></table></figure><p>输出日志还是中文的，应该是国人开发的框架。</p><h2 id="上手"><a href="#上手" class="headerlink" title="上手"></a>上手</h2><p>测下官方文档中的列子，手刃<a href="https://www.qiushibaike.com/8hr/page/1/">糗事百科 - 超搞笑的原创糗事笑话分享社区 (qiushibaike.com)</a></p><p>直接在上面创建的项目中修改start_requests：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FirstSpider</span>(<span class="hljs-params">feapder.AirSpider</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start_requests</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">20</span>):<br>            <span class="hljs-keyword">yield</span> feapder.Request(<span class="hljs-string">&quot;https://www.qiushibaike.com/8hr/page/&#123;&#125;/&quot;</span>.<span class="hljs-built_in">format</span>(i))<br></code></pre></div></td></tr></table></figure><p>再改改parse：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, request, response</span>):</span><br>    article_list = response.xpath(<span class="hljs-string">&#x27;//a[@class=&quot;recmd-content&quot;]&#x27;</span>)<br>    <span class="hljs-keyword">for</span> article <span class="hljs-keyword">in</span> article_list:<br>        title = article.xpath(<span class="hljs-string">&quot;./text()&quot;</span>).extract_first()<br>        url = article.xpath(<span class="hljs-string">&quot;./@href&quot;</span>).extract_first()<br>        <span class="hljs-built_in">print</span>(title, url)<br></code></pre></div></td></tr></table></figure><p><img src="feapder%E6%A1%86%E6%9E%B6%E4%B8%8A%E6%89%8B%E4%BD%93%E9%AA%8C/image-20210915153021188.png"></p><p>细心的把文章的连接都给补全了。</p><p>提取详情页：</p><p>在parse中添加回调函数：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">yield</span> feapder.Request(<br>                url, callback=self.parse_detail, title=title<br>            )  <span class="hljs-comment"># callback 为回调函数</span><br></code></pre></div></td></tr></table></figure><p>再定义一个parse_detail进行详情页的解析。</p><blockquote><p>注意： 这是设置response.encoding_errors = ‘ignore’    # 无视编码错误，避免报错</p></blockquote><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_detail</span>(<span class="hljs-params">self, request, response</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    解析详情</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    response.encoding_errors = <span class="hljs-string">&#x27;ignore&#x27;</span><span class="hljs-comment"># 无视编码错误</span><br>    <span class="hljs-comment"># esponse.code = &#x27;网页编码&#x27; #  已将encoding简写为code，指定编码格式</span><br>    <span class="hljs-comment"># 取url</span><br>    url = request.url<br>    <span class="hljs-comment"># 取title</span><br>    title = request.title<br>    <span class="hljs-comment"># 解析正文</span><br>    content = response.xpath(<span class="hljs-string">&#x27;string(//div[@class=&quot;content&quot;])&#x27;</span>).extract_first()  <span class="hljs-comment"># string 表达式是取某个标签下的文本，包括子标签文本</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;url&quot;</span>, url)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;title&quot;</span>, title)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;content&quot;</span>, content)<br></code></pre></div></td></tr></table></figure><p>嫌弃跑的太慢? 我们可以加一个参数轻松解决，这是开15个线程。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    SpiderTest(thread_count=<span class="hljs-number">15</span>).start()<br></code></pre></div></td></tr></table></figure><p><img src="feapder%E6%A1%86%E6%9E%B6%E4%B8%8A%E6%89%8B%E4%BD%93%E9%AA%8C/image-20210915153728403.png"></p><p>不得不说，确实很方便，对于这种没有限制的网站傻瓜式爬取。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>爬虫</tag>
      
      <tag>feapder</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用python实现下载器</title>
    <link href="/2021/09/03/%E4%BD%BF%E7%94%A8python%E5%AE%9E%E7%8E%B0%E4%B8%8B%E8%BD%BD%E5%99%A8/"/>
    <url>/2021/09/03/%E4%BD%BF%E7%94%A8python%E5%AE%9E%E7%8E%B0%E4%B8%8B%E8%BD%BD%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="需要安装的库"><a href="#需要安装的库" class="headerlink" title="需要安装的库"></a>需要安装的库</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">tqdm<br>requests<br>retry<br>multitasking<br></code></pre></div></td></tr></table></figure><p><code>Tqdm</code> 是一个快速，可扩展的Python进度条，可以在 Python 长循环中添加一个进度提示信息，用户只需要封装任意的迭代器 <code>tqdm(iterator)</code>。</p><p><code>retry</code>是一个用于错误处理的模块，功能类似<code>try-except</code>。</p><p>安装：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install tqdm requests multitasking retry<br></code></pre></div></td></tr></table></figure><p>找个文件下载下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">https://issuecdn.baidupcs.com/issue/netdisk/yunguanjia/BaiduNetdisk_7<span class="hljs-number">.2</span><span class="hljs-number">.8</span><span class="hljs-number">.9</span>.exe<br></code></pre></div></td></tr></table></figure><h2 id="简易版下载器"><a href="#简易版下载器" class="headerlink" title="简易版下载器"></a>简易版下载器</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;https://issuecdn.baidupcs.com/issue/netdisk/yunguanjia/BaiduNetdisk_7.2.8.9.exe&quot;</span><br><span class="hljs-comment"># 文件名</span><br>file_name = <span class="hljs-string">&quot;BaiduNetdisk_7.2.8.9.exe&quot;</span><br><span class="hljs-comment"># 请求头</span><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36 QIHU 360SE&#x27;</span><br>&#125;<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正在下载文件......&#x27;</span>)<br><span class="hljs-comment"># 发起请求</span><br>response = requests.get(url, headers=headers)<br><br>content = response.content<br><br><span class="hljs-comment"># 以wb形式打开文件</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_name, mode=<span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-comment"># 写入响应内容</span><br>    f.write(content)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;文件下载成功！文件名<span class="hljs-subst">&#123;file_name&#125;</span>&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>输出结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">正在下载文件......<br>文件下载成功！文件名BaiduNetdisk_7<span class="hljs-number">.2</span><span class="hljs-number">.8</span><span class="hljs-number">.9</span>.exe<br></code></pre></div></td></tr></table></figure><p>打开代码运行目录即可看到文件：<code>BaiduNetdisk_7.2.8.9.exe</code></p><h2 id="带进度条的文件下载器"><a href="#带进度条的文件下载器" class="headerlink" title="带进度条的文件下载器"></a>带进度条的文件下载器</h2><h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><p><strong>获取文件大小</strong> 首先要知道文件的大小和每次写入文件的大小。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&#x27;https://issuecdn.baidupcs.com/issue/netdisk/yunguanjia/BaiduNetdisk_7.2.8.9.exe&#x27;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36 QIHU 360SE&#x27;</span><br>&#125;<br><br>response = requests.head(url, headers=headers)<br><span class="hljs-comment"># 文件大小</span><br>file_size = response.headers.get(<span class="hljs-string">&#x27;Content-Length&#x27;</span>)<br><span class="hljs-keyword">if</span> file_size <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>    file_size = <span class="hljs-built_in">int</span>(file_size)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;文件的大小:<span class="hljs-subst">&#123;file_size&#125;</span>&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>输出结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">文件的大小:<span class="hljs-number">67765560</span><br></code></pre></div></td></tr></table></figure><h3 id="分块获取响应内容"><a href="#分块获取响应内容" class="headerlink" title="分块获取响应内容"></a>分块获取响应内容</h3><p>一次获取整个文件，进度条的进度就没什么意义，所以分段连续地读取响应知道读取完毕这样才是比较合理的。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&#x27;https://issuecdn.baidupcs.com/issue/netdisk/yunguanjia/BaiduNetdisk_7.2.8.9.exe&#x27;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36 QIHU 360SE&#x27;</span><br>&#125;<br><br><span class="hljs-comment"># 发起head请求，即只获取响应头信息</span><br>head = requests.head(url, headers=headers)<br><span class="hljs-comment"># 文件大小，以B为单位</span><br>file_size = head.headers.get(<span class="hljs-string">&#x27;Content-Length&#x27;</span>)<br><span class="hljs-keyword">if</span> file_size <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>    file_size = <span class="hljs-built_in">int</span>(file_size)<br>response = requests.get(url, headers=headers, stream=<span class="hljs-literal">True</span>)<br><span class="hljs-comment"># 一块文件的大小</span><br>chunk_size = <span class="hljs-number">2048</span><br><span class="hljs-comment"># 记录已经读取的文件大小</span><br>read = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> response.iter_content(chunk_size=chunk_size):<br>    read += chunk_size<br>    read = <span class="hljs-built_in">min</span>(read, file_size)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;已读取: <span class="hljs-subst">&#123;read&#125;</span> 总大小: <span class="hljs-subst">&#123;file_size&#125;</span>&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>输出结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">已读取: <span class="hljs-number">2048</span> 总大小: <span class="hljs-number">67765560</span><br>已读取: <span class="hljs-number">4096</span> 总大小: <span class="hljs-number">67765560</span><br>已读取: <span class="hljs-number">6144</span> 总大小: <span class="hljs-number">67765560</span><br>已读取: <span class="hljs-number">8192</span> 总大小: <span class="hljs-number">67765560</span><br>...<br></code></pre></div></td></tr></table></figure><h4 id="一个-tqdm-的使用例子"><a href="#一个-tqdm-的使用例子" class="headerlink" title="一个 tqdm 的使用例子"></a><strong>一个 tqdm 的使用例子</strong></h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br>total = <span class="hljs-number">100</span><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(total)):<br>    time.sleep(<span class="hljs-number">0.1</span>)<br></code></pre></div></td></tr></table></figure><p><img src="Animation.gif"></p><p>如果想一次更新指定次数个进度怎么办呢？比如说进度总共是 100 ，每 10 个刷新一次进度。</p><p><strong>实现代码例子如下</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><span class="hljs-comment"># 总进度</span><br>total = <span class="hljs-number">100</span><br><span class="hljs-comment"># 每次刷新的进度</span><br>step = <span class="hljs-number">10</span><br><span class="hljs-comment"># 总共要刷新的次数</span><br>flush_count = total//step<br>bar = tqdm(total=total)<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(flush_count):<br>    time.sleep(<span class="hljs-number">0.1</span>)<br>    bar.update(step)<br>bar.close()<br></code></pre></div></td></tr></table></figure><p>以上代码可实现 每 10 个单位刷新一次直进度满 100。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><span class="hljs-comment"># 总进度</span><br>total = <span class="hljs-number">100</span><br><span class="hljs-comment"># 每次刷新的进度</span><br>step = <span class="hljs-number">10</span><br><span class="hljs-comment"># 总共刷新的次数</span><br>flush_count = total//step<br>bar = tqdm(total=total)<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(flush_count):<br>    time.sleep(<span class="hljs-number">0.1</span>)<br>    bar.update(step)<br>bar.close()<br></code></pre></div></td></tr></table></figure><h2 id="下载器实现进度条"><a href="#下载器实现进度条" class="headerlink" title="下载器实现进度条"></a>下载器实现进度条</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><br><span class="hljs-comment"># 目标URL</span><br>url = <span class="hljs-string">&quot;https://issuecdn.baidupcs.com/issue/netdisk/yunguanjia/BaiduNetdisk_7.2.8.9.exe&quot;</span><br><span class="hljs-comment"># 文件名</span><br>file_name = <span class="hljs-string">&quot;BaiduNetdisk_7.2.8.9.exe&quot;</span><br><span class="hljs-comment"># 请求头</span><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36 QIHU 360SE&#x27;</span><br>&#125;<br><span class="hljs-comment"># 发起head请求，获取响应头部信息</span><br>head = requests.head(url, headers=headers)<br><span class="hljs-comment"># 文件大小</span><br>file_size = head.headers.get(<span class="hljs-string">&#x27;Content-Length&#x27;</span>)<br><span class="hljs-keyword">if</span> file_size <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>    file_size = <span class="hljs-built_in">int</span>(file_size)<br><br>response = requests.get(url, headers=headers, stream=<span class="hljs-literal">True</span>)<br><span class="hljs-comment"># 一块文件的大小</span><br>chunk_size = <span class="hljs-number">1024</span><br>bar = tqdm(total=file_size, desc=<span class="hljs-string">f&quot;下载文件<span class="hljs-subst">&#123;file_name&#125;</span>&quot;</span>)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_name, mode=<span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-comment"># 写入分块文件</span><br>    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> response.iter_content(chunk_size=chunk_size):<br>        f.write(chunk)<br>        bar.update(chunk_size)<br><span class="hljs-comment"># 关闭进度条</span><br>bar.close()<br></code></pre></div></td></tr></table></figure><p><img src="Animation-16306593412281.gif"></p><p>这样就成功实现了进度条下载器。</p><h2 id="单进程实现"><a href="#单进程实现" class="headerlink" title="单进程实现"></a>单进程实现</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">download</span>(<span class="hljs-params">url: <span class="hljs-built_in">str</span>, filename: <span class="hljs-built_in">str</span></span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    根据文件链和文件名下载文件</span><br><span class="hljs-string"></span><br><span class="hljs-string">    url:文件直链</span><br><span class="hljs-string">    filename:文件名（文件路径）</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    headers = &#123;<br>        <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36 QIHU 360SE&#x27;</span><br>    &#125;<br><br>    <span class="hljs-comment"># 获取响应头部信息</span><br>    head = requests.head(url, headers=headers)<br><br>    file_size = head.headers.get(<span class="hljs-string">&#x27;Content-Length&#x27;</span>)<br>    <span class="hljs-keyword">if</span> file_size <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        file_size = <span class="hljs-built_in">int</span>(file_size)<br><br>    response = requests.get(url, headers=headers, stream=<span class="hljs-literal">True</span>)<br><br>    chunk_size = <span class="hljs-number">1024</span><br>    bar = tqdm(total=file_size, desc=<span class="hljs-string">f&#x27;下载文件<span class="hljs-subst">&#123;filename&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, mode=<span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-comment"># 写入分块文件</span><br>        <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> response.iter_content(chunk_size=chunk_size):<br>            f.write(chunk)<br>            bar.update(chunk_size)<br>    bar.close()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    url = <span class="hljs-string">&#x27;https://issuecdn.baidupcs.com/issue/netdisk/yunguanjia/BaiduNetdisk_7.2.8.9.exe&#x27;</span><br>    filename = <span class="hljs-string">&#x27;BaiduNetdisk.exe&#x27;</span><br>    download(url, filename)<br></code></pre></div></td></tr></table></figure><h2 id="多线程文件下载器"><a href="#多线程文件下载器" class="headerlink" title="多线程文件下载器"></a>多线程文件下载器</h2><h3 id="多线程和单线程比较"><a href="#多线程和单线程比较" class="headerlink" title="多线程和单线程比较"></a>多线程和单线程比较</h3><p>单线程程序</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">say</span>(<span class="hljs-params">number: <span class="hljs-built_in">int</span></span>):</span><br>    <span class="hljs-built_in">print</span>(number)<br>    time.sleep(<span class="hljs-number">0.5</span>)<br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>    say(i)<br></code></pre></div></td></tr></table></figure><p>输出如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-number">0</span><br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">3</span><br><span class="hljs-number">4</span><br></code></pre></div></td></tr></table></figure><p>这段程序耗时在 2.5 秒左右。 如果我们使用多线程呢？每一次操作均开启一个线程，结果会怎样？</p><p>首先，安装一个多线程库，简化写法：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">pip install multitasking<br></code></pre></div></td></tr></table></figure><p>使用它之后，我们只需要给自定义的函数前面加上一行代码（装饰器）即可在调用函数时，为被调用的这个函数开启新的线程。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> multiprocessing<br><span class="hljs-keyword">import</span> signal<br><br><span class="hljs-comment"># ctrl + c 终止已经开启的全部线程</span><br><span class="hljs-keyword">import</span> multitasking<br><br>signal.signal(signal.SIGINT, multitasking.killall)<br><br><br><span class="hljs-meta">@multitasking.task</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">say</span>(<span class="hljs-params">number: <span class="hljs-built_in">int</span></span>):</span><br>    <span class="hljs-built_in">print</span>(number)<br>    time.sleep(<span class="hljs-number">0.5</span>)<br><br><br>start_time = time.time()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>    say(i)<br><span class="hljs-comment"># 等待线程全部执行完成</span><br>multitasking.wait_for_tasks()<br>end_time = time.time()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;耗时：&quot;</span>, end_time - start_time, <span class="hljs-string">&quot;秒&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>输出结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-number">0</span><br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">3</span><br><span class="hljs-number">4</span><br>耗时： <span class="hljs-number">0.5024490356445312</span> 秒<br></code></pre></div></td></tr></table></figure><p>同样是每 0.5 秒输出一个数字，上面的代码因为使用多线程，耗时只有 0.5 秒左右，而之前的单线程版本耗时是 2.5 秒左右。</p><p>要实现多线程下载同一个文件，就需要为每一个线程分配属于自己的任务，比如一个100B文件，总共分配五个线程，每个线程下载20B。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 总大小</span><br>total = <span class="hljs-number">100</span><br><span class="hljs-comment"># 每一块的大小</span><br>step = <span class="hljs-number">20</span><br><span class="hljs-comment"># 分多块</span><br>parts = [(start, <span class="hljs-built_in">min</span>(start+step,total)) <span class="hljs-keyword">for</span> start <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, total, step)]<br><span class="hljs-built_in">print</span>(parts)<br></code></pre></div></td></tr></table></figure><p>运行上面的代码，会达到以下输出</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs text">[(0, 20), (20, 40), (40, 60), (60, 80), (80, 100)]<br></code></pre></div></td></tr></table></figure><p>了能够更好地维护代码，我们可以尝试把它抽取为函数，示例如下</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">split</span>(<span class="hljs-params">start: <span class="hljs-built_in">int</span>, end: <span class="hljs-built_in">int</span>, step: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">list</span>[<span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">int</span>, <span class="hljs-built_in">int</span>]]:</span><br>    parts = [(start, <span class="hljs-built_in">min</span>(start+step, end))<br>             <span class="hljs-keyword">for</span> start <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, end, step)]<br><br>    <span class="hljs-keyword">return</span> parts<br><br><br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;__main__&quot;</span> == __name__:<br>    <span class="hljs-comment"># 起始位置</span><br>    start = <span class="hljs-number">1</span><br>    <span class="hljs-comment"># 终止位置</span><br>    total = <span class="hljs-number">102</span><br>    <span class="hljs-comment"># 区间长度</span><br>    step = <span class="hljs-number">20</span><br>    parts = split(start, total, step)<br>    <span class="hljs-built_in">print</span>(parts)<br></code></pre></div></td></tr></table></figure><p>以上操作是为了后续分段下载文件做准备。</p><h3 id="下载部分文件"><a href="#下载部分文件" class="headerlink" title="下载部分文件"></a>下载部分文件</h3><p>演示如何下载某一部分的文件</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># 起始位置</span><br>start = <span class="hljs-number">0</span><br><span class="hljs-comment"># 终止位置</span><br>end = <span class="hljs-number">10000</span><br><span class="hljs-comment"># 每次读取大小</span><br>chunk_size = <span class="hljs-number">1024</span><br><span class="hljs-comment"># 记录下载位置</span><br>seek = start<br><span class="hljs-comment"># 请求头</span><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36 QIHU 360SE&#x27;</span><br>&#125;<br><span class="hljs-comment"># 设定下载的范围</span><br>headers[<span class="hljs-string">&#x27;Range&#x27;</span>] = <span class="hljs-string">f&#x27;bytes=<span class="hljs-subst">&#123;start&#125;</span>-<span class="hljs-subst">&#123;end&#125;</span>&#x27;</span><br><span class="hljs-comment"># 下载链接</span><br>url = <span class="hljs-string">&#x27;https://issuecdn.baidupcs.com/issue/netdisk/yunguanjia/BaiduNetdisk_7.2.8.9.exe&#x27;</span><br><br>response = requests.get(url, headers=headers, stream=<span class="hljs-literal">True</span>)<br><span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> response.iter_content(chunk_size=chunk_size):<br>    _seek = <span class="hljs-built_in">min</span>(seek + chunk_size, end)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;下载: <span class="hljs-subst">&#123;seek&#125;</span>-<span class="hljs-subst">&#123;_seek&#125;</span>&#x27;</span>)<br>    seek = _seek<br></code></pre></div></td></tr></table></figure><p>输出情况：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">下载: <span class="hljs-number">0</span>-<span class="hljs-number">1024</span><br>下载: <span class="hljs-number">1024</span>-<span class="hljs-number">2048</span><br>下载: <span class="hljs-number">2048</span>-<span class="hljs-number">3072</span><br>下载: <span class="hljs-number">3072</span>-<span class="hljs-number">4096</span><br>下载: <span class="hljs-number">4096</span>-<span class="hljs-number">5120</span><br>下载: <span class="hljs-number">5120</span>-<span class="hljs-number">6144</span><br>下载: <span class="hljs-number">6144</span>-<span class="hljs-number">7168</span><br>下载: <span class="hljs-number">7168</span>-<span class="hljs-number">8192</span><br>下载: <span class="hljs-number">8192</span>-<span class="hljs-number">9216</span><br>下载: <span class="hljs-number">9216</span>-<span class="hljs-number">10000</span><br></code></pre></div></td></tr></table></figure><h3 id="多线程下载文件"><a href="#多线程下载文件" class="headerlink" title="多线程下载文件"></a>多线程下载文件</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests  <span class="hljs-comment"># 发起网络请求库</span><br><span class="hljs-keyword">import</span> multitasking  <span class="hljs-comment"># 用于多线程操作</span><br><span class="hljs-keyword">import</span> signal<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm  <span class="hljs-comment"># 显示进度条库</span><br><span class="hljs-keyword">from</span> retry <span class="hljs-keyword">import</span> retry  <span class="hljs-comment"># 导入retry库方便出错重试</span><br><br>signal.signal(signal.SIGINT, multitasking.killall)<br><br><span class="hljs-comment"># 请求头</span><br>headers = &#123;<br>    <span class="hljs-string">&quot;user-agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Mobile Safari/537.36 Edg/92.0.902.84&quot;</span><br>&#125;<br><br><span class="hljs-comment"># 定义1MB等于多少B</span><br>MB = <span class="hljs-number">1024</span> ** <span class="hljs-number">2</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">split</span>(<span class="hljs-params">start: <span class="hljs-built_in">int</span>, end: <span class="hljs-built_in">int</span>, step: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">list</span>[<span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">int</span>, <span class="hljs-built_in">int</span>]]:</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    :description 分块</span><br><span class="hljs-string">    :param start 起始字节</span><br><span class="hljs-string">    :param end  终止字节</span><br><span class="hljs-string">    :param step 步长</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    parts = [(start, <span class="hljs-built_in">min</span>(start + step, end)) <span class="hljs-keyword">for</span> start <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, end, step)]<br>    <span class="hljs-keyword">return</span> parts<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_file_size</span>(<span class="hljs-params">url: <span class="hljs-built_in">str</span>, raise_error: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span></span>) -&gt; <span class="hljs-built_in">int</span>:</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    :description 获取文件大小</span><br><span class="hljs-string">    :param url</span><br><span class="hljs-string">    :param raise_error</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    response = requests.head(url)<br>    file_size = response.headers.get(<span class="hljs-string">&#x27;Content-Length&#x27;</span>)<br>    <span class="hljs-keyword">if</span> file_size <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">if</span> raise_error <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;该文件不支持多线程下载&quot;</span>)<br>        <span class="hljs-keyword">return</span> file_size<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(file_size)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">download</span>(<span class="hljs-params">url: <span class="hljs-built_in">str</span>, file_name: <span class="hljs-built_in">str</span>, retry_times: <span class="hljs-built_in">int</span> = <span class="hljs-number">3</span>, each_size=<span class="hljs-number">16</span> * MB</span>) -&gt; <span class="hljs-literal">None</span>:</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    :description    根据文件直链和文件名下载文件</span><br><span class="hljs-string">    :param url  文件直链</span><br><span class="hljs-string">    :param file_name    文件名</span><br><span class="hljs-string">    :param retry_times  重试次数, 默认3次</span><br><span class="hljs-string">    :param each_size 每次下载大小</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    f = <span class="hljs-built_in">open</span>(file_name, <span class="hljs-string">&#x27;wb&#x27;</span>)<br>    file_size = get_file_size(url)<br><br><span class="hljs-meta">    @retry(<span class="hljs-params">tries=retry_times</span>)</span><br><span class="hljs-meta">    @multitasking.task</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start_download</span>(<span class="hljs-params">start: <span class="hljs-built_in">int</span>, end: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-literal">None</span>:</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        :description 根据文件起止位置下载文件</span><br><span class="hljs-string">        :param start   开始位置</span><br><span class="hljs-string">        :param end  结束位置</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        _headers = headers.copy()<br>        <span class="hljs-comment"># 分段下载的核心</span><br>        _headers[<span class="hljs-string">&#x27;Range&#x27;</span>] = <span class="hljs-string">f&#x27;bytes=<span class="hljs-subst">&#123;start&#125;</span>-<span class="hljs-subst">&#123;end&#125;</span>&#x27;</span><br>        <span class="hljs-comment"># 发起请求获取流式响应</span><br>        response = requests.get(url, headers=_headers, stream=<span class="hljs-literal">True</span>)<br>        <span class="hljs-comment"># 每次读取的流式响应大小</span><br>        chunk_size = <span class="hljs-number">1024</span><br>        <span class="hljs-comment"># 暂存获取的响应，后续循环写入</span><br>        chunks = []<br>        <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> response.iter_content(chunk_size=chunk_size):<br>            <span class="hljs-comment"># 把获取的响应存到列表中</span><br>            chunks.append(chunk)<br>            <span class="hljs-comment"># 更新进度条</span><br>            bar.update(chunk_size)<br>        f.seek(start)<br>        <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> chunks:<br>            f.write(chunk)<br>        <span class="hljs-comment"># 释放写入的资源</span><br>        <span class="hljs-keyword">del</span> chunks<br><br>    session = requests.Session()<br>    <span class="hljs-comment"># 分块文件如果比文件大，就取文件大小为分块大小</span><br>    each_size = <span class="hljs-built_in">min</span>(each_size, file_size)<br><br>    <span class="hljs-comment"># 分块</span><br>    parts = split(<span class="hljs-number">0</span>, file_size, each_size)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;分快数：<span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(parts)&#125;</span>&#x27;</span>)<br>    <span class="hljs-comment"># 创建进度条</span><br>    bar = tqdm(total=file_size, desc=<span class="hljs-string">f&#x27;下载文件：<span class="hljs-subst">&#123;file_name&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> parts:<br>        start, end = part<br>        start_download(start, end)<br>    <span class="hljs-comment"># 等待全部线程结束</span><br>    multitasking.wait_for_tasks()<br><br>    f.close()<br>    bar.close()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    url = <span class="hljs-string">&#x27;https://issuecdn.baidupcs.com/issue/netdisk/yunguanjia/BaiduNetdisk_7.2.8.9.exe&#x27;</span><br>    file_name = <span class="hljs-string">&#x27;BaiduNetdisk_7.2.8.9.exe&#x27;</span><br>    download(url, file_name)<br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>download</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Go语言中的切片</title>
    <link href="/2021/08/31/Go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E5%88%87%E7%89%87/"/>
    <url>/2021/08/31/Go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E5%88%87%E7%89%87/</url>
    
    <content type="html"><![CDATA[<h1 id="Go语言中的切片"><a href="#Go语言中的切片" class="headerlink" title="Go语言中的切片"></a>Go语言中的切片</h1><h2 id="切片的基本介绍"><a href="#切片的基本介绍" class="headerlink" title="切片的基本介绍"></a>切片的基本介绍</h2><p>切片，slice</p><p>是数组的一个引用，因此切片是引用类型，在进行传值时，遵守引用传递的机制。</p><p>切片的使用和数组类似，遍历切片、访问切片的元素和求切片长度len(slice)都一样。</p><p>切片的长度是可以变化的，因此切片是一个可以动态变化的数组。</p><p>定义的基本语法：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> 切片名 []类型<br>比如：<span class="hljs-keyword">var</span> a []<span class="hljs-keyword">int</span><br></code></pre></div></td></tr></table></figure><h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><p>演示一个切片的基本使用：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br><span class="hljs-keyword">var</span> intArr [<span class="hljs-number">5</span>]<span class="hljs-keyword">int</span> = [...]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">22</span>, <span class="hljs-number">33</span>, <span class="hljs-number">66</span>, <span class="hljs-number">99</span>&#125;<br><span class="hljs-comment">// 声明/定义一个切片</span><br>slice := intArr[<span class="hljs-number">1</span>:<span class="hljs-number">3</span>]<br>fmt.Println(<span class="hljs-string">&quot;intArr&quot;</span>, intArr) <span class="hljs-comment">//intArr [1 22 33 66 99]</span><br>fmt.Println(<span class="hljs-string">&quot;slice 的元素是 =&quot;</span>, slice) <span class="hljs-comment">//slice 的元素是 = [22 33]</span><br>fmt.Println(<span class="hljs-string">&quot;slice 的元素个数 =&quot;</span>, <span class="hljs-built_in">len</span>(slice)) <span class="hljs-comment">//slice 的元素个数 = 2</span><br>fmt.Println(<span class="hljs-string">&quot;slice 的容量 =&quot;</span>, <span class="hljs-built_in">cap</span>(slice)) <span class="hljs-comment">//slice 的容量 = 4</span><br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="切片在内存中形式（重要）"><a href="#切片在内存中形式（重要）" class="headerlink" title="切片在内存中形式（重要）"></a>切片在内存中形式（重要）</h2><h3 id="基本的介绍："><a href="#基本的介绍：" class="headerlink" title="基本的介绍："></a>基本的介绍：</h3><p><img src="image-20210831205851193.png"></p><p>slice的确是一个引用类型</p><p>slice从底层来说，其实是一个数据结构（结构体）</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> slice <span class="hljs-keyword">struct</span>&#123;<br>    ptr *[<span class="hljs-number">2</span>]<span class="hljs-keyword">int</span><br>    <span class="hljs-built_in">len</span> <span class="hljs-keyword">int</span><br>    <span class="hljs-built_in">cap</span> <span class="hljs-keyword">int</span><br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="切片的使用"><a href="#切片的使用" class="headerlink" title="切片的使用"></a>切片的使用</h2><ul><li>方式一：</li></ul><p>第一种方式：定义一个切片，然后让切片去引用一个已经创建好的数组。</p><ul><li>方式二：</li></ul><p>第二种方式：通过make来创建切片</p><p>基本语法：<code>var 切片名 []type = make([]type, len, [cap])</code></p><p>参数说明：<code>type</code>数据类型，<code>len</code>大小，<code>cap</code>指定切片容量，可选，如果你分配了<code>cap</code>，则要求<code>cap&gt;=len</code></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> slice1 []<span class="hljs-keyword">float64</span> = <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">float64</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>)<br>slice1[<span class="hljs-number">1</span>] = <span class="hljs-number">10</span><br>slice1[<span class="hljs-number">3</span>] = <span class="hljs-number">10</span><br>fmt.Println(slice1) <span class="hljs-comment">//[0 10 0 10 0]</span><br>fmt.Println(<span class="hljs-string">&quot;slice1的size=&quot;</span>, <span class="hljs-built_in">len</span>(slice1)) <span class="hljs-comment">//slice1的size= 5</span><br>fmt.Println(<span class="hljs-string">&quot;slice的cap=&quot;</span>, <span class="hljs-built_in">cap</span>(slice1)) <span class="hljs-comment">//slice的cap= 10</span><br></code></pre></div></td></tr></table></figure><p><img src="image-20210831211122280.png"></p><p>1）通过make方式创建切片可以指定切片的大小和容量</p><p>2）如果没有给切片的各个元素赋值，那么就会使用默认值</p><p>3）通过make方式创建的切片对应的数组是由make底层维护，对外不可见，即只能通过slice访问各个元素</p><ul><li>方式三</li></ul><p>第3种方式：定义一个切片，直接就指定具体数组，使用原理类似make的方式。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> strSlice []<span class="hljs-keyword">string</span> = []<span class="hljs-keyword">string</span>&#123;<span class="hljs-string">&quot;tom&quot;</span>, <span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-string">&quot;mary&quot;</span>&#125;<br>fmt.Println(<span class="hljs-string">&quot;strSlice=&quot;</span>, strSlice) <span class="hljs-comment">//strSlice= [tom jack mary]</span><br>fmt.Println(<span class="hljs-string">&quot;strSlice size=&quot;</span>, <span class="hljs-built_in">len</span>(strSlice)) <span class="hljs-comment">//strSlice size= 3</span><br>fmt.Println(<span class="hljs-string">&quot;strSlice cap=&quot;</span>, <span class="hljs-built_in">cap</span>(strSlice)) <span class="hljs-comment">//strSlice cap= 3</span><br></code></pre></div></td></tr></table></figure><p>方式1是直接引用数组，这个数组是事先存在的，程序员是可见的。</p><p>方式2是通过make来创建切片，make也会创建一个数组，是由切片在底层进行维护，程序员是看不见的。make创建切片的示意图∶</p><p><img src="image-20210831212029532.png"></p><h2 id="切片的遍历"><a href="#切片的遍历" class="headerlink" title="切片的遍历"></a>切片的遍历</h2><p>切片的偏历和数组一样，也有两种方式</p><ul><li>for循环常规方式遍历</li><li>for-range结构遍历切片</li></ul><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> arr [<span class="hljs-number">5</span>]<span class="hljs-keyword">int</span> = [...]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>&#125;<br>slice := arr[<span class="hljs-number">1</span>:<span class="hljs-number">4</span>]<br><span class="hljs-comment">// 传统方式</span><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(slice); i++ &#123;<br>fmt.Printf(<span class="hljs-string">&quot;slice[%v]=%v&quot;</span>, i, slice[i])<br>&#125;<br>fmt.Println()<br><span class="hljs-comment">// 使用for-range方式遍历切片</span><br><span class="hljs-keyword">for</span> i, v := <span class="hljs-keyword">range</span> slice &#123;<br>fmt.Printf(<span class="hljs-string">&quot;i=%v v=%v\n&quot;</span>, i, v)<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="切片的使用的注意事项"><a href="#切片的使用的注意事项" class="headerlink" title="切片的使用的注意事项"></a>切片的使用的注意事项</h2><p>1）切片初始化时<code>var slice = arr[startIndex:endIndex]</code></p><p>说明：从<code>arr</code>数组下标为<code>startIndex</code>，取到下标为<code>endIndex</code>的元素</p><p>2）切片初始化时，仍然不能越界。范围在<code>[0-len(arr)]</code>之间，但是可以动态增长。</p><p><code>var slice = arr[0:end]</code> 可以简写 <code>var slice = arr[:end]</code></p><p>3）cap是一个内置函数，用于统计切片的容量，即最大可以存放多少元素。</p><p>4）切片定义完后，还不能使用，因为本身是一个空的，需要让其引用到一个数组，或者make一个空间供切片来使用。</p><p>5）切片可以继续切片。</p><p>6）用append内置函数，可以对切片进行动态追加。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">slice = <span class="hljs-built_in">append</span>(slice, <span class="hljs-number">400</span>, <span class="hljs-number">500</span>, <span class="hljs-number">600</span>)<br>fmt.Println(<span class="hljs-string">&quot;slice&quot;</span>, slice) <span class="hljs-comment">//slice [20 30 40 400 500 600]</span><br>slice = <span class="hljs-built_in">append</span>(slice, slice...)<br>fmt.Println(slice) <span class="hljs-comment">// [20 30 40 400 500 600 20 30 40 400 500 600]</span><br></code></pre></div></td></tr></table></figure><p>7）切片的拷贝操作</p><p>切片使用copy内置函数完成拷贝，举例说明</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> newslice = <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">int</span>, <span class="hljs-number">10</span>)<br><span class="hljs-built_in">copy</span>(newslice, slice)<br>fmt.Println(<span class="hljs-string">&quot;newslice=&quot;</span>, newslice) <span class="hljs-comment">//newslice= [20 30 40 400 500 600 20 30 40 400]</span><br></code></pre></div></td></tr></table></figure><h2 id="string和slice"><a href="#string和slice" class="headerlink" title="string和slice"></a>string和slice</h2><p>1）string底层是一个byte数组，因此string也可以进行切片处理</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">str := <span class="hljs-string">&quot;hello@outlook.com&quot;</span><br>slice := str[<span class="hljs-number">6</span>:]<br>fmt.Println(<span class="hljs-string">&quot;slice=&quot;</span>, slice) <span class="hljs-comment">//slice= outlook.com</span><br></code></pre></div></td></tr></table></figure><p>2）string是不可以改变的，不能通过str[0]=’z’方式来修改字符串</p><p>3）如果要修改字符串，可以先将string-&gt;[]byte/或者[]rune-&gt;修改-&gt;重写转成string</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">arr1 := []<span class="hljs-keyword">byte</span>(str)<br>arr1[<span class="hljs-number">0</span>] = <span class="hljs-string">&#x27;H&#x27;</span><br>str = <span class="hljs-keyword">string</span>(arr1)<br>fmt.Println(str) <span class="hljs-comment">//Hello@outlook.com</span><br><br><span class="hljs-comment">// 如果要处理中文，就必须转成[]rune</span><br>arr2 := []<span class="hljs-keyword">rune</span>(str)<br>arr2[<span class="hljs-number">0</span>] = <span class="hljs-string">&#x27;陈&#x27;</span><br>str = <span class="hljs-keyword">string</span>(arr2)<br>fmt.Println(str) <span class="hljs-comment">//陈ello@outlook.com</span><br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>切片</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>go语言字符串常用的系统函数</title>
    <link href="/2021/08/30/go%E8%AF%AD%E8%A8%80%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E7%94%A8%E7%9A%84%E7%B3%BB%E7%BB%9F%E5%87%BD%E6%95%B0/"/>
    <url>/2021/08/30/go%E8%AF%AD%E8%A8%80%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E7%94%A8%E7%9A%84%E7%B3%BB%E7%BB%9F%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="字符串常用的系统函数"><a href="#字符串常用的系统函数" class="headerlink" title="字符串常用的系统函数"></a>字符串常用的系统函数</h1><p>1）统计字符串的长度，按字节<code>len(str)</code></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">str := <span class="hljs-string">&quot;hello world&quot;</span><br>fmt.Println(<span class="hljs-string">&quot;str len =&quot;</span>, <span class="hljs-built_in">len</span>(str)) <span class="hljs-comment">// str len = 11</span><br></code></pre></div></td></tr></table></figure><p>2）字符串遍历，同时处理有中文的问题<code>r:=[]rune(str)</code></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">str2 := <span class="hljs-string">&quot;hello世界&quot;</span><br>r := []<span class="hljs-keyword">rune</span>(str2)<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(r); i++ &#123;<br>   fmt.Printf(<span class="hljs-string">&quot;字符=%c\n&quot;</span>, r[i])<br>&#125;<br><span class="hljs-comment">//字符=h</span><br><span class="hljs-comment">//字符=e</span><br><span class="hljs-comment">//字符=l</span><br><span class="hljs-comment">//字符=l</span><br><span class="hljs-comment">//字符=o</span><br><span class="hljs-comment">//字符=世</span><br><span class="hljs-comment">//字符=界</span><br></code></pre></div></td></tr></table></figure><p>3）字符串转整数<code>n,err := strconv.Atoi(&quot;12&quot;)</code></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">str3 := <span class="hljs-string">&quot;121242354&quot;</span><br>n, err := strconv.Atoi(str3)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span>&#123;<br>   fmt.Println(<span class="hljs-string">&quot;转换错误&quot;</span>)<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>   fmt.Println(n) <span class="hljs-comment">//121242354</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>4）整数转字符串<code>str=strconv.Itoa(123)</code>)</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">str4 := strconv.Itoa(<span class="hljs-number">1234</span>)<br>fmt.Printf(<span class="hljs-string">&quot;str=%v, str=%T&quot;</span>, str4, str4) <span class="hljs-comment">//str=1234, str=string</span><br></code></pre></div></td></tr></table></figure><p>5）字符串转[]byte:<code>var bytes = []byte(&quot;hello go&quot;)</code></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> bytes = []<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;hello go&quot;</span>)<br>fmt.Printf(<span class="hljs-string">&quot;bytes=%v\n&quot;</span>, bytes) <span class="hljs-comment">//str=1234, str=stringbytes=[104 101 108 108 111 32 103 111]</span><br></code></pre></div></td></tr></table></figure><p>6）[]byte转字符串：<code>str = string([]byte&#123;97,98,99&#125;)</code></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">str5 := <span class="hljs-keyword">string</span>([]<span class="hljs-keyword">byte</span>&#123;<span class="hljs-number">97</span>,<span class="hljs-number">98</span>,<span class="hljs-number">99</span>&#125;)<br>fmt.Printf(<span class="hljs-string">&quot;str5=%v\n&quot;</span>, str5) <span class="hljs-comment">//str5=abc</span><br></code></pre></div></td></tr></table></figure><p>7）十进制转2，8，16进制：<code>str = strconv.FormatInt(123, 2) //2-&gt;8,16</code></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">fmt.Println(strconv.FormatInt(<span class="hljs-number">25</span>, <span class="hljs-number">2</span>)) <span class="hljs-comment">//11001</span><br>fmt.Println(strconv.FormatInt(<span class="hljs-number">25</span>, <span class="hljs-number">8</span>)) <span class="hljs-comment">//31</span><br>fmt.Println(strconv.FormatInt(<span class="hljs-number">25</span>, <span class="hljs-number">16</span>)) <span class="hljs-comment">//19</span><br></code></pre></div></td></tr></table></figure><p>8）查找子串是否在指定的字符串中：<code>strings.Contains(&quot;seafood&quot;, &quot;foo&quot;) //true</code></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">b := strings.Contains(<span class="hljs-string">&quot;seafood&quot;</span>, <span class="hljs-string">&quot;food&quot;</span>)<br>fmt.Printf(<span class="hljs-string">&quot;b=%v\n&quot;</span>, b) <span class="hljs-comment">//b=true</span><br></code></pre></div></td></tr></table></figure><p>9）统计一个字符串有几个指定的子串：<code>strings.Count(&quot;ceheese&quot;, &quot;e&quot;) //4</code></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">num := strings.Count(<span class="hljs-string">&quot;chinese&quot;</span>, <span class="hljs-string">&quot;e&quot;</span>)<br>fmt.Println(num) <span class="hljs-comment">//2</span><br></code></pre></div></td></tr></table></figure><p>10）不区分大小写的字符串比较（=+是区分字母大小写的）∶ <code>fmt.Println（strings.EqualFold（&quot;abc&quot;，&quot;Ab&quot;)//true</code></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">b := strings.EqualFold(<span class="hljs-string">&quot;abc&quot;</span>, <span class="hljs-string">&quot;aBc&quot;</span>)<br>fmt.Printf(<span class="hljs-string">&quot;%v\n&quot;</span>, b) <span class="hljs-comment">//true</span><br>fmt.Println(<span class="hljs-string">&quot;结果&quot;</span>, <span class="hljs-string">&quot;abc&quot;</span> == <span class="hljs-string">&quot;ABc&quot;</span>) <span class="hljs-comment">//false</span><br></code></pre></div></td></tr></table></figure><p>11）返回子串在字符串第一次出现的 index值，如果没有返回-1∶</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">index := strings.Index(<span class="hljs-string">&quot;hello abc&quot;</span>, <span class="hljs-string">&quot;abc&quot;</span>)<br>fmt.Printf(<span class="hljs-string">&quot;index=%v\n&quot;</span>, index) <span class="hljs-comment">//index=6</span><br></code></pre></div></td></tr></table></figure><p>12）返回子串在字符串最后一次出现的 index，如没有返回-1∶</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">index = strings.LastIndex(<span class="hljs-string">&quot;go golang&quot;</span>, <span class="hljs-string">&quot;go&quot;</span>)<br>fmt.Printf(<span class="hljs-string">&quot;index=%v\n&quot;</span>, index) <span class="hljs-comment">//index=3</span><br></code></pre></div></td></tr></table></figure><p>13）将指定的子串替换成 另外一个子串，第三个参数可选择替换几个，如果为-1全部替换：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">str := <span class="hljs-string">&quot;go go hello&quot;</span><br>str2 := strings.Replace(str, <span class="hljs-string">&quot;go&quot;</span>, <span class="hljs-string">&quot;holy&quot;</span>, <span class="hljs-number">-1</span>)<br>fmt.Printf(<span class="hljs-string">&quot;str=%v, str2=%v\n&quot;</span>, str, str2) <span class="hljs-comment">//str=go go hello, str2=holy holy hello</span><br></code></pre></div></td></tr></table></figure><p>14）按 照指定 的某个字 符，为分割标识，将 一个 字符串拆分成字符串 数组∶ <code>strings.Split(&quot;hello,wold,ok&quot;,&quot;,&quot;)</code></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">strArr := strings.Split(<span class="hljs-string">&quot;hello, world, holy&quot;</span>, <span class="hljs-string">&quot;,&quot;</span>)<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(strArr); i++ &#123;<br>   fmt.Printf(<span class="hljs-string">&quot;str[%v]=%v\n&quot;</span>, i, strArr[i])<br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;strArr=%v\n&quot;</span>, strArr)<br></code></pre></div></td></tr></table></figure><p>15）将字符串的字母进行大小写的转换∶</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">str := <span class="hljs-string">&quot;golang hello&quot;</span><br>str = strings.ToLower(str)<br>fmt.Printf(<span class="hljs-string">&quot;str=%v\n&quot;</span>, str) <span class="hljs-comment">//str=golang hello</span><br>str = strings.ToUpper(str)<br>fmt.Printf(<span class="hljs-string">&quot;str=%v\n&quot;</span>, str) <span class="hljs-comment">//str=GOLANG HELLO</span><br></code></pre></div></td></tr></table></figure><p>16）将字符串左右两边的空格去掉∶ </p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">str = strings.TrimSpace(<span class="hljs-string">&quot; d you  f   hello     &quot;</span>)<br>fmt.Printf(<span class="hljs-string">&quot;str=%v\n&quot;</span>, str) <span class="hljs-comment">//str=d you  f   hello</span><br></code></pre></div></td></tr></table></figure><p>17）将字符串左右两边指定的字符去掉 ∶</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">str = strings.Trim(<span class="hljs-string">&quot;!hello!&quot;</span>, <span class="hljs-string">&quot;!&quot;</span>)<br>fmt.Printf(<span class="hljs-string">&quot;str=%v\n&quot;</span>, str) <span class="hljs-comment">//str=hello</span><br></code></pre></div></td></tr></table></figure><p>18）将字符串左边指定的字符去掉 ∶</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">str = strings.TrimLeft(<span class="hljs-string">&quot;!hello!&quot;</span>, <span class="hljs-string">&quot;!&quot;</span>)<br>fmt.Printf(<span class="hljs-string">&quot;str=%v\n&quot;</span>, str) <span class="hljs-comment">//str=hello!</span><br></code></pre></div></td></tr></table></figure><p>19）将字符串右边指定的字符去掉∶</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">str = strings.TrimRight(<span class="hljs-string">&quot;!hello!&quot;</span>, <span class="hljs-string">&quot;!&quot;</span>)<br>fmt.Printf(<span class="hljs-string">&quot;str=%v\n&quot;</span>, str) <span class="hljs-comment">//str=hello!</span><br></code></pre></div></td></tr></table></figure><p>20）判断字符串是否以指定的字符串开头 :</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">b := strings.HasPrefix(<span class="hljs-string">&quot;ftp://192.168.10.1&quot;</span>, <span class="hljs-string">&quot;ftp://&quot;</span>)<br>fmt.Printf(<span class="hljs-string">&quot;b=%v\n&quot;</span>, b) <span class="hljs-comment">//b=true</span><br></code></pre></div></td></tr></table></figure><p>21）判断字符串是否以指定的字符串结束 :</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">b = strings.HasSuffix(<span class="hljs-string">&quot;ftp://192.168.10.1&quot;</span>, <span class="hljs-string">&quot;192.168.10.1&quot;</span>)<br>fmt.Printf(<span class="hljs-string">&quot;b=%v\n&quot;</span>, b) <span class="hljs-comment">//b=true</span><br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>go语言中函数参数的传递方式</title>
    <link href="/2021/08/30/go%E8%AF%AD%E8%A8%80%E4%B8%AD%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E7%9A%84%E4%BC%A0%E9%80%92%E6%96%B9%E5%BC%8F/"/>
    <url>/2021/08/30/go%E8%AF%AD%E8%A8%80%E4%B8%AD%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E7%9A%84%E4%BC%A0%E9%80%92%E6%96%B9%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="函数参数的传递方式"><a href="#函数参数的传递方式" class="headerlink" title="函数参数的传递方式"></a>函数参数的传递方式</h1><h2 id="两种传递方式"><a href="#两种传递方式" class="headerlink" title="两种传递方式"></a>两种传递方式</h2><p>1）值传递</p><p>2）引用传递</p><p>不论是值传递还是引用传递，传给函数的都是变量的副本，不同的是值传递的是值的拷贝，引用传递的是地址的拷贝，一般来说地址拷贝效率高。</p><h2 id="值类型和引用类型"><a href="#值类型和引用类型" class="headerlink" title="值类型和引用类型"></a>值类型和引用类型</h2><p>1）值类型：基本数据类型 int 系列，float系列，bool，string、数组和结构体struct</p><p>2）引用类型：指针、slice切片、map、管道chan、interface等都是引用类型</p><h2 id="值传递和引用传递使用特点"><a href="#值传递和引用传递使用特点" class="headerlink" title="值传递和引用传递使用特点"></a>值传递和引用传递使用特点</h2><p>1）值类型默认是值传递：变量直接存储存值，内存通常在栈中分配</p><p>2）引用类型默认是引用传递：变量存储的是一个地址，这个地址对应的空间才是真正存储数值，内存通常在堆上分配，当没有任何变量引用这个地址时，改地址对应的数据空间就成为一个垃圾，有<code>GC</code>来回收。</p><p>3）如果希望函数内的变量能够修改函数外的变量，可以传入变量的地址&amp;，函数内以指针的方式操作变量。从效果上类似引用。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">var</span> a <span class="hljs-keyword">int</span> = <span class="hljs-number">100</span><br><span class="hljs-keyword">var</span> b <span class="hljs-keyword">int</span> = <span class="hljs-number">100</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getVar</span><span class="hljs-params">(x *<span class="hljs-keyword">int</span>)</span> <span class="hljs-title">int</span></span>&#123;<br>   *x = <span class="hljs-number">1000</span><br>   <span class="hljs-keyword">return</span> *x<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getVar2</span><span class="hljs-params">(x <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">int</span></span>&#123;<br>   x = <span class="hljs-number">200</span><br>   <span class="hljs-keyword">return</span> x<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>  &#123;<br>   fmt.Println(a) <span class="hljs-comment">//100</span><br>   fmt.Println(getVar(&amp;a)) <span class="hljs-comment">//1000</span><br>   fmt.Println(a) <span class="hljs-comment">//1000</span><br>   fmt.Println(b) <span class="hljs-comment">//100</span><br>   fmt.Println(getVar2(b)) <span class="hljs-comment">//200</span><br>   fmt.Println(b) <span class="hljs-comment">//100</span><br><br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="变量作用域"><a href="#变量作用域" class="headerlink" title="变量作用域"></a>变量作用域</h2><p>1）函数内部声明/定义的变量叫局部变量，作用域仅限于函数内部。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">area</span><span class="hljs-params">()</span><span class="hljs-params">(<span class="hljs-keyword">string</span>, <span class="hljs-keyword">int</span>)</span></span>&#123;<br>   <span class="hljs-comment">// name,age定义在函数内部</span><br>   name := <span class="hljs-string">&quot;holy&quot;</span><br>   age:=<span class="hljs-number">25</span><br>   <span class="hljs-keyword">return</span> name, age<br>&#125;<br></code></pre></div></td></tr></table></figure><p>2）函数外部声明/定义的变量叫全局变量，作用域在整个包都有效，如果其首字母大写，则作用域在整个程序有效。</p><p>3）如果变量在一个代码块中，比如for/if中，那么这个变量的作用域就在该代码块</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Beego的MVC架构</title>
    <link href="/2021/08/29/Beego%E7%9A%84MVC%E6%9E%B6%E6%9E%84/"/>
    <url>/2021/08/29/Beego%E7%9A%84MVC%E6%9E%B6%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<h1 id="beego-的-MVC-架构介绍"><a href="#beego-的-MVC-架构介绍" class="headerlink" title="beego 的 MVC 架构介绍"></a>beego 的 MVC 架构介绍</h1><p>beego 是一个典型的 MVC 框架，它的整个执行逻辑如下图所示：</p><p><img src="detail.png"></p><p>通过文字来描述如下：</p><ol><li>在监听的端口接收数据，默认监听在 8080 端口。</li><li>用户请求到达 8080 端口之后进入 beego 的处理逻辑。</li><li>初始化 Context 对象，根据请求判断是否为 WebSocket 请求，如果是的话设置 Input，同时判断请求的方法是否在标准请求方法中（GET、POST、PUT、DELETE、PATCH、OPTIONS、HEAD），防止用户的恶意伪造请求攻击造成不必要的影响。</li><li>执行 BeforeRouter 过滤器，当然在 beego 里面有开关设置。如果用户设置了过滤器，那么该开关打开，这样可以提高在没有开启过滤器的情况下提高执行效率。如果在执行过滤器过程中，responseWriter 已经有数据输出了，那么就提前结束该请求，直接跳转到监控判断。</li><li>开始执行静态文件的处理，查看用户的请求 URL 是否和注册在静态文件处理 StaticDir 中的 prefix 是否匹配。如果匹配的话，采用 <code>http</code> 包中默认的 ServeFile 来处理静态文件。</li><li>如果不是静态文件开始初始化 session 模块(如果开启 session 的话)，这个里面大家需要注意，如果你的 BeforeRouter 过滤器用到了 session 就会报错，你应该把它加入到 AfterStatic 过滤器中。</li><li>开始执行 AfterStatic 过滤器，如果在执行过滤器过程中，responseWriter 已经有数据输出了，那么就提前结束该请求，直接跳转到监控判断。</li><li>执行过过滤器之后，开始从固定的路由规则中查找和请求 URL 相匹配的对象。这个匹配是全匹配规则，即如果用户请求的 URL 是 <code>/hello/world</code>，那么固定规则中 <code>/hello</code> 是不会匹配的，只有完全匹配才算匹配。如果匹配的话就进入逻辑执行，如果不匹配进入下一环节的正则匹配。</li><li>正则匹配是进行正则的全匹配，这个正则是按照用户添加 beego 路由顺序来进行匹配的，也就是说，如果你在添加路由的时候你的顺序影响你的匹配。和固定匹配一样，如果匹配的话就进行逻辑执行，如果不匹配进入 Auto 匹配。</li><li>如果用户注册了 AutoRouter，那么会通过 <code>controller/method</code> 这样的方式去查找对应的 Controller 和他内置的方法，如果找到就开始执行逻辑，如果找不到就跳转到监控判断。</li><li>如果找到 Controller 的话，那么就开始执行逻辑，首先执行 BeforeExec 过滤器，如果在执行过滤器过程中，responseWriter 已经有数据输出了，那么就提前结束该请求，直接跳转到监控判断。</li><li>Controller 开始执行 Init 函数，初始化基本的一些信息，这个函数一般都是 beego.Controller 的初始化，不建议用户继承的时候修改该函数。</li><li>是否开启了 XSRF，开启的话就调用 Controller 的 XsrfToken，然后如果是 POST 请求就调用 CheckXsrfCookie 方法。</li><li>继续执行 Controller 的 Prepare 函数，这个函数一般是预留给用户的，用来做 Controller 里面的一些参数初始化之类的工作。如果在初始化中 responseWriter 有输出，那么就直接进入 Finish 函数逻辑。</li><li>如果没有输出的话，那么根据用户注册的方法执行相应的逻辑，如果用户没有注册，那么就调用 http.Method 对应的方法（Get/Post 等）。执行相应的逻辑，例如数据读取，数据赋值，模板显示之类的，或者直接输出 JSON 或者 XML。</li><li>如果 responseWriter 没有输出，那么就调用 Render 函数进行模板输出。</li><li>执行 Controller 的 Finish 函数，这个函数是预留给用户用来重写的，用于释放一些资源。释放在 Init 中初始化的信息数据。</li><li>执行 AfterExec 过滤器，如果有输出的话就跳转到监控判断逻辑。</li><li>执行 Controller 的 Destructor，用于释放 Init 中初始化的一些数据。</li><li>如果这一路执行下来都没有找到路由，那么会调用 404 显示找不到该页面。</li><li>最后所有的逻辑都汇聚到了监控判断，如果用户开启了监控模块（默认是开启一个 8088 端口用于进程内监控），这样就会把访问的请求链接扔给监控程序去记录当前访问的 QPS，对应的链接访问的执行时间，请求链接等。</li></ol><h1 id="controller-设计"><a href="#controller-设计" class="headerlink" title="controller 设计"></a>controller 设计</h1><h1 id="参数配置"><a href="#参数配置" class="headerlink" title="参数配置"></a>参数配置</h1><p>beego 目前支持 INI、XML、JSON、YAML 格式的配置文件解析，但是默认采用了 INI 格式解析，用户可以通过简单的配置就可以获得很大的灵活性。</p><h2 id="默认配置解析"><a href="#默认配置解析" class="headerlink" title="默认配置解析"></a>默认配置解析</h2><p>beego 默认会解析当前应用下的 <code>conf/app.conf</code> 文件。</p><p>通过这个文件你可以初始化很多 beego 的默认参数：</p><figure class="highlight ini"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">appname</span> = beepkg<br><span class="hljs-attr">httpaddr</span> = <span class="hljs-string">&quot;127.0.0.1&quot;</span><br><span class="hljs-attr">httpport</span> = <span class="hljs-number">9090</span><br><span class="hljs-attr">runmode</span> =<span class="hljs-string">&quot;dev&quot;</span><br><span class="hljs-attr">autorender</span> = <span class="hljs-literal">false</span><br><span class="hljs-attr">recoverpanic</span> = <span class="hljs-literal">false</span><br><span class="hljs-attr">viewspath</span> = <span class="hljs-string">&quot;myview&quot;</span><br></code></pre></div></td></tr></table></figure><p>它们都维护在结构体 <code>beego/server/web#Config</code> 。</p><p>上面这些参数会替换 beego 默认的一些参数, beego 的参数主要有哪些呢？请参考<a href="https://godoc.org/github.com/beego/beego#pkg-constants">https://godoc.org/github.com/beego/beego#pkg-constants</a> 。</p><p>BConfig 就是 beego 里面的默认的配置，也是结构体 <code>beego/server/web#Config</code> 的实例。</p><p>你也可以直接通过<code>web.BConfig.AppName=&quot;beepkg&quot;</code>这样来修改，和上面的配置效果一样，只是一个在代码里面写死了，而配置文件就会显得更加灵活。</p><p>你也可以在配置文件中配置应用需要用的一些配置信息，例如下面所示的数据库信息：</p><figure class="highlight ini"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">mysqluser</span> = <span class="hljs-string">&quot;root&quot;</span><br><span class="hljs-attr">mysqlpass</span> = <span class="hljs-string">&quot;rootpass&quot;</span><br><span class="hljs-attr">mysqlurls</span> = <span class="hljs-string">&quot;127.0.0.1&quot;</span><br><span class="hljs-attr">mysqldb</span>   = <span class="hljs-string">&quot;beego&quot;</span><br></code></pre></div></td></tr></table></figure><p>那么你就可以通过如下的方式获取设置的配置信息:</p><figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus">web<span class="hljs-selector-class">.AppConfig</span><span class="hljs-selector-class">.String</span>(<span class="hljs-string">&quot;mysqluser&quot;</span>)<br>web<span class="hljs-selector-class">.AppConfig</span><span class="hljs-selector-class">.String</span>(<span class="hljs-string">&quot;mysqlpass&quot;</span>)<br>web<span class="hljs-selector-class">.AppConfig</span><span class="hljs-selector-class">.String</span>(<span class="hljs-string">&quot;mysqlurls&quot;</span>)<br>web<span class="hljs-selector-class">.AppConfig</span><span class="hljs-selector-class">.String</span>(<span class="hljs-string">&quot;mysqldb&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>AppConfig 的方法如下：</p><ul><li>Set(key, val string) error</li><li>String(key string) string</li><li>Strings(key string) []string</li><li>Int(key string) (int, error)</li><li>Int64(key string) (int64, error)</li><li>Bool(key string) (bool, error)</li><li>Float(key string) (float64, error)</li><li>DefaultString(key string, defaultVal string) string</li><li>DefaultStrings(key string, defaultVal []string)</li><li>DefaultInt(key string, defaultVal int) int</li><li>DefaultInt64(key string, defaultVal int64) int64</li><li>DefaultBool(key string, defaultVal bool) bool</li><li>DefaultFloat(key string, defaultVal float64) float64</li><li>DIY(key string) (interface{}, error)</li><li>GetSection(section string) (map[string]string, error)</li><li>SaveConfigFile(filename string) error</li></ul><p>在使用 ini 类型的配置文件中, key 支持 section::key 模式.</p><p>你可以用 Default* 方法返回默认值.</p><p>你也可以参考 <a href="https://beego.me/zh-CN/module/config.md">配置模块</a></p><h3 id="不同级别的配置"><a href="#不同级别的配置" class="headerlink" title="不同级别的配置"></a>不同级别的配置</h3><p>在配置文件里面支持 section，可以有不同的 Runmode 的配置，默认优先读取 runmode 下的配置信息，例如下面的配置文件：</p><figure class="highlight ini"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">appname</span> = beepkg<br><span class="hljs-attr">httpaddr</span> = <span class="hljs-string">&quot;127.0.0.1&quot;</span><br><span class="hljs-attr">httpport</span> = <span class="hljs-number">9090</span><br><span class="hljs-attr">runmode</span> =<span class="hljs-string">&quot;dev&quot;</span><br><span class="hljs-attr">autorender</span> = <span class="hljs-literal">false</span><br><span class="hljs-attr">recoverpanic</span> = <span class="hljs-literal">false</span><br><span class="hljs-attr">viewspath</span> = <span class="hljs-string">&quot;myview&quot;</span><br><br><span class="hljs-section">[dev]</span><br><span class="hljs-attr">httpport</span> = <span class="hljs-number">8080</span><br><span class="hljs-section">[prod]</span><br><span class="hljs-attr">httpport</span> = <span class="hljs-number">8088</span><br><span class="hljs-section">[test]</span><br><span class="hljs-attr">httpport</span> = <span class="hljs-number">8888</span><br></code></pre></div></td></tr></table></figure><p>上面的配置文件就是在不同的 runmode 下解析不同的配置，例如在 dev 模式下，httpport 是 8080，在 prod 模式下是 8088，在 test 模式下是 8888。其他配置文件同理。解析的时候优先解析 runmode 下的配置，然后解析默认的配置。</p><p>读取不同模式下配置参数的方法是“模式::配置参数名”，比如：beego.AppConfig.String(“dev::mysqluser”)。</p><p>对于自定义的参数，需使用 GetConfig(typ, key string, defaultVal interface{}) 来获取指定 runmode 下的配置（需 1.4.0 以上版本），typ 为参数类型，key 为参数名, defaultVal 为默认值。</p><h3 id="多个配置文件"><a href="#多个配置文件" class="headerlink" title="多个配置文件"></a>多个配置文件</h3><p>INI 格式配置支持 <code>include</code> 方式，引用多个配置文件，例如下面的两个配置文件效果同上：</p><p>app.conf</p><figure class="highlight makefile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile">appname = beepkg<br>httpaddr = <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>httpport = 9090<br><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;app2.conf&quot;</span><br></code></pre></div></td></tr></table></figure><p>app2.conf</p><figure class="highlight ini"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">runmode</span> =<span class="hljs-string">&quot;dev&quot;</span><br><span class="hljs-attr">autorender</span> = <span class="hljs-literal">false</span><br><span class="hljs-attr">recoverpanic</span> = <span class="hljs-literal">false</span><br><span class="hljs-attr">viewspath</span> = <span class="hljs-string">&quot;myview&quot;</span><br><br><span class="hljs-section">[dev]</span><br><span class="hljs-attr">httpport</span> = <span class="hljs-number">8080</span><br><span class="hljs-section">[prod]</span><br><span class="hljs-attr">httpport</span> = <span class="hljs-number">8088</span><br><span class="hljs-section">[test]</span><br><span class="hljs-attr">httpport</span> = <span class="hljs-number">8888</span><br></code></pre></div></td></tr></table></figure><h3 id="支持环境变量配置"><a href="#支持环境变量配置" class="headerlink" title="支持环境变量配置"></a>支持环境变量配置</h3><p>配置文件解析支持从环境变量中获取配置项，配置项格式：<code>$&#123;环境变量&#125;</code>。例如下面的配置中优先使用环境变量中配置的 runmode 和 httpport，如果有配置环境变量 ProRunMode 则优先使用该环境变量值。如果不存在或者为空，则使用 “dev” 作为 runmode。</p><p>app.conf</p><figure class="highlight ini"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">runmode</span>  = <span class="hljs-string">&quot;$&#123;ProRunMode||dev&#125;&quot;</span><br><span class="hljs-attr">httpport</span> = <span class="hljs-string">&quot;$&#123;ProPort||9090&#125;&quot;</span><br></code></pre></div></td></tr></table></figure><h3 id="系统默认参数"><a href="#系统默认参数" class="headerlink" title="系统默认参数"></a>系统默认参数</h3><p>beego 中带有很多可配置的参数，我们来一一认识一下它们，这样有利于我们在接下来的 beego 开发中可以充分的发挥他们的作用(你可以通过在 <code>conf/app.conf</code> 中设置对应的值，不区分大小写)：</p><h4 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h4><ul><li>BConfig<br>保存了所有 beego 里面的系统默认参数，你可以通过 <code>web.BConfig</code> 来访问和修改底下的所有配置信息.</li></ul><blockquote><blockquote><p>配置文件路径，默认是应用程序对应的目录下的 <code>conf/app.conf</code>，用户可以在程序代码中加载自己的配置文件<br><code>beego.LoadAppConfig(&quot;ini&quot;, &quot;conf/app2.conf&quot;)</code><br>也可以加载多个文件，只要你调用多次就可以了，如果后面的文件和前面的 key 冲突，那么以最新加载的为最新值</p></blockquote></blockquote><h4 id="App-配置"><a href="#App-配置" class="headerlink" title="App 配置"></a>App 配置</h4><ul><li><p>AppName</p><p>应用名称，默认是 beego。通过 <code>bee new</code> 创建的是创建的项目名。</p><p><code>web.BConfig.AppName = &quot;beego&quot;</code></p></li><li><p>RunMode</p><p>应用的运行模式，可选值为 <code>prod</code>, <code>dev</code> 或者 <code>test</code>. 默认是 <code>dev</code>, 为开发模式，在开发模式下出错会提示友好的出错页面，如前面错误描述中所述。</p><p><code>web.BConfig.RunMode = &quot;dev&quot;</code></p></li><li><p>RouterCaseSensitive</p><p>是否路由忽略大小写匹配，默认是 true，区分大小写</p><p><code>web.BConfig.RouterCaseSensitive = true</code></p></li><li><p>ServerName</p><p>beego 服务器默认在请求的时候输出 server 为 beego。</p><p><code>web.BConfig.ServerName = &quot;beego&quot;</code></p></li><li><p>RecoverPanic</p><p>是否异常恢复，默认值为 true，即当应用出现异常的情况，通过 recover 恢复回来，而不会导致应用异常退出。</p><p><code>web.BConfig.RecoverPanic = true</code></p></li><li><p>CopyRequestBody</p><p>是否允许在 HTTP 请求时，返回原始请求体数据字节，默认为 false （GET or HEAD or 上传文件请求除外）。</p><p><code>web.BConfig.CopyRequestBody = false</code></p></li><li><p>EnableGzip</p><p>是否开启 gzip 支持，默认为 false 不支持 gzip，一旦开启了 gzip，那么在模板输出的内容会进行 gzip 或者 zlib 压缩，根据用户的 Accept-Encoding 来判断。</p><p><code>web.BConfig.EnableGzip = false</code></p><p>Gzip允许用户自定义压缩级别、压缩长度阈值和针对请求类型压缩:</p><ol><li>压缩级别, <code>gzipCompressLevel = 9</code>,取值为 1~9,如果不设置为 1(最快压缩)</li><li>压缩长度阈值, <code>gzipMinLength = 256</code>,当原始内容长度大于此阈值时才开启压缩,默认为 20B(ngnix默认长度)</li><li>请求类型, <code>includedMethods = get;post</code>,针对哪些请求类型进行压缩,默认只针对 GET 请求压缩</li></ol></li><li><p>MaxMemory</p><p>文件上传默认内存缓存大小，默认值是 <code>1 &lt;&lt; 26</code>(64M)。</p><p><code>web.BConfig.MaxMemory = 1 &lt;&lt; 26</code></p></li><li><p>EnableErrorsShow</p><p>是否显示系统错误信息，默认为 true。</p><p><code>web.BConfig.EnableErrorsShow = true</code></p></li><li><p>EnableErrorsRender</p><p>是否将错误信息进行渲染，默认值为 true，即出错会提示友好的出错页面，对于 API 类型的应用可能需要将该选项设置为 false 以阻止在 <code>dev</code> 模式下不必要的模板渲染信息返回。</p></li></ul><h4 id="Web配置"><a href="#Web配置" class="headerlink" title="Web配置"></a>Web配置</h4><ul><li><p>AutoRender</p><p>是否模板自动渲染，默认值为 true，对于 API 类型的应用，应用需要把该选项设置为 false，不需要渲染模板。</p><p><code>web.BConfig.WebConfig.AutoRender = true</code></p></li><li><p>EnableDocs</p><p>是否开启文档内置功能，默认是 false</p><p><code>web.BConfig.WebConfig.EnableDocs = true</code></p></li><li><p>FlashName</p><p>Flash 数据设置时 Cookie 的名称，默认是 BEEGO_FLASH</p><p><code>web.BConfig.WebConfig.FlashName = &quot;BEEGO_FLASH&quot;</code></p></li><li><p>FlashSeperator</p><p>Flash 数据的分隔符，默认是 BEEGOFLASH</p><p><code>web.BConfig.WebConfig.FlashSeparator = &quot;BEEGOFLASH&quot;</code></p></li><li><p>DirectoryIndex</p><p>是否开启静态目录的列表显示，默认不显示目录，返回 403 错误。</p><p><code>web.BConfig.WebConfig.DirectoryIndex = false</code></p></li><li><p>StaticDir</p><p>静态文件目录设置，默认是static</p><p>可配置单个或多个目录:</p><ol><li>单个目录, <code>StaticDir = download</code>. 相当于 <code>beego.SetStaticPath(&quot;/download&quot;,&quot;download&quot;)</code></li><li>多个目录, <code>StaticDir = download:down download2:down2</code>. 相当于 <code>beego.SetStaticPath(&quot;/download&quot;,&quot;down&quot;)</code> 和 <code>beego.SetStaticPath(&quot;/download2&quot;,&quot;down2&quot;)</code></li></ol><p><code>web.BConfig.WebConfig.StaticDir</code></p></li><li><p>StaticExtensionsToGzip</p><p>允许哪些后缀名的静态文件进行 gzip 压缩，默认支持 .css 和 .js</p><p><code>web.BConfig.WebConfig.StaticExtensionsToGzip = []string&#123;&quot;.css&quot;, &quot;.js&quot;&#125;</code></p><p>等价 config 文件中</p><figure class="highlight ini"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">StaticExtensionsToGzip</span> = .css, .js<br></code></pre></div></td></tr></table></figure></li><li><p>TemplateLeft</p><p>模板左标签，默认值是<code>&#123;&#123;`。  `web.BConfig.WebConfig.TemplateLeft="&#123;&#123;"`- TemplateRight  模板右标签，默认值是`&#125;&#125;</code>。</p><p><code>web.BConfig.WebConfig.TemplateRight=&quot;&#125;&#125;&quot;</code></p></li><li><p>ViewsPath</p><p>模板路径，默认值是 views。</p><p><code>web.BConfig.WebConfig.ViewsPath=&quot;views&quot;</code></p></li><li><p>EnableXSRF</p><p>是否开启 XSRF，默认为 false，不开启。</p><p><code>web.BConfig.WebConfig.EnableXSRF = false</code></p></li><li><p>XSRFKEY</p><p>XSRF 的 key 信息，默认值是 beegoxsrf。 EnableXSRF＝true 才有效</p><p><code>web.BConfig.WebConfig.XSRFKEY = &quot;beegoxsrf&quot;</code></p></li><li><p>XSRFExpire</p><p>XSRF 过期时间，默认值是 0，不过期。</p><p><code>web.BConfig.WebConfig.XSRFExpire = 0</code></p></li><li><p>CommentRouterPath</p><p>CommentRouterPath 注解路由所在位置。默认值是<code>controllers</code>。 Beego 会在启动的时候扫描下面的文件生成了路由。<br><code>web.BConfig.WebConfig.CommentRouterPath = &quot;controllers&quot;</code></p></li></ul><h4 id="监听配置"><a href="#监听配置" class="headerlink" title="监听配置"></a>监听配置</h4><ul><li><p>Graceful</p><p>是否开启热升级，默认是 false，关闭热升级。</p><p><code>web.BConfig.Listen.Graceful=false</code></p></li><li><p>ServerTimeOut</p><p>设置 HTTP 的超时时间，默认是 0，不超时。</p><p><code>web.BConfig.Listen.ServerTimeOut=0</code></p></li><li><p>ListenTCP4</p><p>监听本地网络地址类型，默认是TCP6，可以通过设置为true设置为TCP4。</p><p><code>web.BConfig.Listen.ListenTCP4 = true</code></p></li><li><p>EnableHTTP</p><p>是否启用 HTTP 监听，默认是 true。</p><p><code>web.BConfig.Listen.EnableHTTP = true</code></p></li><li><p>HTTPAddr</p><p>应用监听地址，默认为空，监听所有的网卡 IP。</p><p><code>web.BConfig.Listen.HTTPAddr = &quot;&quot;</code></p></li><li><p>HTTPPort</p><p>应用监听端口，默认为 8080。</p><p><code>web.BConfig.Listen.HTTPPort = 8080</code></p></li><li><p>EnableHTTPS</p><p>是否启用 HTTPS，默认是 false 关闭。当需要启用时，先设置 EnableHTTPS = true，并设置 <code>HTTPSCertFile</code> 和 <code>HTTPSKeyFile</code></p><p><code>web.BConfig.Listen.EnableHTTPS = false</code></p></li><li><p>HTTPSAddr</p><p>应用监听地址，默认为空，监听所有的网卡 IP。</p><p><code>web.BConfig.Listen.HTTPSAddr = &quot;&quot;</code></p></li><li><p>HTTPSPort</p><p>应用监听端口，默认为 10443</p><p><code>web.BConfig.Listen.HTTPSPort = 10443</code></p></li><li><p>HTTPSCertFile</p><p>开启 HTTPS 后，ssl 证书路径，默认为空。</p><p><code>web.BConfig.Listen.HTTPSCertFile = &quot;conf/ssl.crt&quot;</code></p></li><li><p>HTTPSKeyFile</p><p>开启 HTTPS 之后，SSL 证书 keyfile 的路径。</p><p><code>web.BConfig.Listen.HTTPSKeyFile = &quot;conf/ssl.key&quot;</code></p></li><li><p>EnableAdmin</p><p>是否开启进程内监控模块，默认 false 关闭。</p><p><code>web.BConfig.Listen.EnableAdmin = false</code></p></li><li><p>AdminAddr</p><p>监控程序监听的地址，默认值是 localhost 。</p><p><code>web.BConfig.Listen.AdminAddr = &quot;localhost&quot;</code></p></li><li><p>AdminPort</p><p>监控程序监听的地址，默认值是 8088 。</p><p><code>web.BConfig.Listen.AdminPort = 8088</code></p></li><li><p>EnableFcgi</p><p>是否启用 fastcgi ， 默认是 false。</p><p><code>web.BConfig.Listen.EnableFcgi = false</code></p></li><li><p>EnableStdIo</p><p>通过fastcgi 标准I/O，启用 fastcgi 后才生效，默认 false。</p><p><code>web.BConfig.Listen.EnableStdIo = false</code></p></li></ul><h4 id="Session配置"><a href="#Session配置" class="headerlink" title="Session配置"></a>Session配置</h4><ul><li><p>SessionOn</p><p>session 是否开启，默认是 false。</p><p><code>web.BConfig.WebConfig.Session.SessionOn = false</code></p></li><li><p>SessionProvider</p><p>session 的引擎，默认是 memory，详细参见 <code>session 模块</code>。</p><p><code>web.BConfig.WebConfig.Session.SessionProvider = &quot;&quot;</code></p></li><li><p>SessionName</p><p>存在客户端的 cookie 名称，默认值是 beegosessionID。</p><p><code>web.BConfig.WebConfig.Session.SessionName = &quot;beegosessionID&quot;</code></p></li><li><p>SessionGCMaxLifetime</p><p>session 过期时间，默认值是 3600 秒。</p><p><code>web.BConfig.WebConfig.Session.SessionGCMaxLifetime = 3600</code></p></li><li><p>SessionProviderConfig</p><p>配置信息，根据不同的引擎设置不同的配置信息，详细的配置请看下面的引擎设置，详细参见 <a href="https://beego.me/zh-CN/module/session.md">session 模块</a></p></li><li><p>SessionCookieLifeTime</p><p>session 默认存在客户端的 cookie 的时间，默认值是 3600 秒。</p><p><code>web.BConfig.WebConfig.Session.SessionCookieLifeTime = 3600</code></p></li><li><p>SessionAutoSetCookie</p><p>是否开启SetCookie, 默认值 true 开启。</p><p><code>web.BConfig.WebConfig.Session.SessionAutoSetCookie = true</code></p></li><li><p>SessionDomain</p><p>session cookie 存储域名, 默认空。</p><p><code>web.BConfig.WebConfig.Session.SessionDomain = &quot;&quot;</code></p></li></ul><h4 id="Log配置"><a href="#Log配置" class="headerlink" title="Log配置"></a>Log配置</h4><figure class="highlight autohotkey"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs autohotkey">log详细配置，请参见 `logs 模块`。<br></code></pre></div></td></tr></table></figure><ul><li><p>AccessLogs</p><p>是否输出日志到 Log，默认在 prod 模式下不会输出日志，默认为 false 不输出日志。此参数不支持配置文件配置。</p><p><code>web.BConfig.Log.AccessLogs = false</code></p></li><li><p>FileLineNum</p><p>是否在日志里面显示文件名和输出日志行号，默认 true。此参数不支持配置文件配置。</p><p><code>web.BConfig.Log.FileLineNum = true</code></p></li><li><p>Outputs</p><p>日志输出配置，参考 logs 模块，console file 等配置，此参数不支持配置文件配置。</p><p><code>web.BConfig.Log.Outputs = map[string]string&#123;&quot;console&quot;: &quot;&quot;&#125;</code></p><p>or</p><p><code>web.BConfig.Log.Outputs[&quot;console&quot;] = &quot;&quot;</code></p></li></ul><h1 id="路由设置"><a href="#路由设置" class="headerlink" title="路由设置"></a>路由设置</h1><p>什么是路由设置呢？前面介绍的 MVC 结构执行时，介绍过 beego 存在三种方式的路由:固定路由、正则路由、自动路由，接下来详细的讲解如何使用这三种路由。</p><h2 id="基础路由"><a href="#基础路由" class="headerlink" title="基础路由"></a>基础路由</h2><p>从 beego 1.2 版本开始支持了基本的 RESTful 函数式路由,应用中的大多数路由都会定义在 <code>routers/router.go</code> 文件中。最简单的 beego 路由由 URI 和闭包函数组成。</p><h3 id="基本-GET-路由"><a href="#基本-GET-路由" class="headerlink" title="基本 GET 路由"></a>基本 GET 路由</h3><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">web.Get(<span class="hljs-string">&quot;/&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *context.Context)</span></span>&#123;<br>     ctx.Output.Body([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;hello world&quot;</span>))<br>&#125;)<br></code></pre></div></td></tr></table></figure><h3 id="基本-POST-路由"><a href="#基本-POST-路由" class="headerlink" title="基本 POST 路由"></a>基本 POST 路由</h3><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">web.Post(<span class="hljs-string">&quot;/alice&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *context.Context)</span></span>&#123;<br>     ctx.Output.Body([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;bob&quot;</span>))<br>&#125;)<br></code></pre></div></td></tr></table></figure><h3 id="注册一个可以响应任何-HTTP-的路由"><a href="#注册一个可以响应任何-HTTP-的路由" class="headerlink" title="注册一个可以响应任何 HTTP 的路由"></a>注册一个可以响应任何 HTTP 的路由</h3><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">web.Any(<span class="hljs-string">&quot;/foo&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *context.Context)</span></span>&#123;<br>     ctx.Output.Body([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;bar&quot;</span>))<br>&#125;)<br></code></pre></div></td></tr></table></figure><h3 id="所有的支持的基础函数如下所示"><a href="#所有的支持的基础函数如下所示" class="headerlink" title="所有的支持的基础函数如下所示"></a>所有的支持的基础函数如下所示</h3><ul><li>web.Get(router, web.HandleFunc)</li><li>web.Post(router, web.HandleFunc)</li><li>web.Put(router, web.HandleFunc)</li><li>web.Patch(router, web.HandleFunc)</li><li>web.Head(router, web.HandleFunc)</li><li>web.Options(router, web.HandleFunc)</li><li>web.Delete(router, web.HandleFunc)</li><li>web.Any(router, web.HandleFunc)</li></ul><h3 id="支持自定义的-handler-实现"><a href="#支持自定义的-handler-实现" class="headerlink" title="支持自定义的 handler 实现"></a>支持自定义的 handler 实现</h3><p>有些时候我们已经实现了一些 rpc 的应用,但是想要集成到 beego 中,或者其他的 httpserver 应用,集成到 beego 中来.现在可以很方便的集成:</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">s := rpc.NewServer()<br>s.RegisterCodec(json.NewCodec(), <span class="hljs-string">&quot;application/json&quot;</span>)<br>s.RegisterService(<span class="hljs-built_in">new</span>(HelloService), <span class="hljs-string">&quot;&quot;</span>)<br>web.Handler(<span class="hljs-string">&quot;/rpc&quot;</span>, s)<br></code></pre></div></td></tr></table></figure><p><code>web.Handler(router, http.Handler)</code> 这个函数是关键,第一个参数表示路由 URI, 第二个就是你自己实现的 <code>http.Handler</code>, 注册之后就会把所有 rpc 作为前缀的请求分发到 <code>http.Handler</code> 中进行处理.</p><p>这个函数其实还有第三个参数就是是否是前缀匹配,默认是 false, 如果设置了 true, 那么就会在路由匹配的时候前缀匹配,即 <code>/rpc/user</code> 这样的也会匹配去运行</p><h3 id="路由参数"><a href="#路由参数" class="headerlink" title="路由参数"></a>路由参数</h3><p>后面会讲到固定路由,正则路由,这些参数一样适用于上面的这些函数</p><h2 id="RESTful-Controller-路由"><a href="#RESTful-Controller-路由" class="headerlink" title="RESTful Controller 路由"></a>RESTful Controller 路由</h2><p>在介绍这三种 beego 的路由实现之前先介绍 RESTful，我们知道 RESTful 是一种目前 API 开发中广泛采用的形式，beego 默认就是支持这样的请求方法，也就是用户 Get 请求就执行 Get 方法，Post 请求就执行 Post 方法。因此默认的路由是这样 RESTful 的请求方式。</p><h2 id="固定路由"><a href="#固定路由" class="headerlink" title="固定路由"></a>固定路由</h2><p>固定路由也就是全匹配的路由，如下所示：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">web.Router(<span class="hljs-string">&quot;/&quot;</span>, &amp;controllers.MainController&#123;&#125;)<br>web.Router(<span class="hljs-string">&quot;/admin&quot;</span>, &amp;admin.UserController&#123;&#125;)<br>web.Router(<span class="hljs-string">&quot;/admin/index&quot;</span>, &amp;admin.ArticleController&#123;&#125;)<br>web.Router(<span class="hljs-string">&quot;/admin/addpkg&quot;</span>, &amp;admin.AddController&#123;&#125;)<br></code></pre></div></td></tr></table></figure><p>如上所示的路由就是我们最常用的路由方式，一个固定的路由，一个控制器，然后根据用户请求方法不同请求控制器中对应的方法，典型的 RESTful 方式。</p><h2 id="正则路由"><a href="#正则路由" class="headerlink" title="正则路由"></a>正则路由</h2><p>为了用户更加方便的路由设置，beego 参考了 sinatra 的路由实现，支持多种方式的路由：</p><ul><li><p>web.Router(“/api/?:id”, &amp;controllers.RController{})</p><p>默认匹配 //例如对于URL”/api/123”可以匹配成功，此时变量”:id”值为”123”，URL”/api/“可正常匹配</p></li><li><p>web.Router(“/api/:id”, &amp;controllers.RController{})</p><p>默认匹配 //例如对于URL”/api/123”可以匹配成功，此时变量”:id”值为”123”，但URL”/api/“匹配失败</p></li><li><p>web.Router(“/api/:id([0-9]+)“, &amp;controllers.RController{})</p><p>自定义正则匹配 //例如对于URL”/api/123”可以匹配成功，此时变量”:id”值为”123”</p></li><li><p>web.Router(“/user/:username([\w]+)“, &amp;controllers.RController{})</p><p>正则字符串匹配 //例如对于URL”/user/astaxie”可以匹配成功，此时变量”:username”值为”astaxie”</p></li><li><p>web.Router(“/download/*.*”, &amp;controllers.RController{})</p><p>*匹配方式 //例如对于URL”/download/file/api.xml”可以匹配成功，此时变量”:path”值为”file/api”， “:ext”值为”xml”</p></li><li><p>web.Router(“/download/ceshi/*“, &amp;controllers.RController{})</p><p>*全匹配方式 //例如对于URL”/download/ceshi/file/api.json”可以匹配成功，此时变量”:splat”值为”file/api.json”</p></li><li><p>web.Router(“/:id:int”, &amp;controllers.RController{})</p><p>int 类型设置方式，匹配 :id为int 类型，框架帮你实现了正则 ([0-9]+)</p></li><li><p>web.Router(“/:hi:string”, &amp;controllers.RController{})</p><p>string 类型设置方式，匹配 :hi 为 string 类型。框架帮你实现了正则 ([\w]+)</p></li><li><p>web.Router(“/cms_:id([0-9]+).html”, &amp;controllers.CmsController{})</p><p>带有前缀的自定义正则 //匹配 :id 为正则类型。匹配 cms_123.html 这样的 url :id = 123</p></li></ul><p>可以在 Controller 中通过如下方式获取上面的变量：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">this.Ctx.Input.Param(<span class="hljs-string">&quot;:id&quot;</span>)<br>this.Ctx.Input.Param(<span class="hljs-string">&quot;:username&quot;</span>)<br>this.Ctx.Input.Param(<span class="hljs-string">&quot;:splat&quot;</span>)<br>this.Ctx.Input.Param(<span class="hljs-string">&quot;:path&quot;</span>)<br>this.Ctx.Input.Param(<span class="hljs-string">&quot;:ext&quot;</span>)<br></code></pre></div></td></tr></table></figure><h2 id="自定义方法及-RESTful-规则"><a href="#自定义方法及-RESTful-规则" class="headerlink" title="自定义方法及 RESTful 规则"></a>自定义方法及 RESTful 规则</h2><p>上面列举的是默认的请求方法名（请求的 method 和函数名一致，例如 <code>GET</code> 请求执行 <code>Get</code> 函数，<code>POST</code> 请求执行 <code>Post</code> 函数），如果用户期望自定义函数名，那么可以使用如下方式：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">web.Router(<span class="hljs-string">&quot;/&quot;</span>,&amp;IndexController&#123;&#125;,<span class="hljs-string">&quot;*:Index&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>使用第三个参数，第三个参数就是用来设置对应 method 到函数名，定义如下</p><ul><li><code>*</code>表示任意的 method 都执行该函数</li><li>使用 httpmethod:funcname 格式来展示</li><li>多个不同的格式使用 <code>;</code> 分割</li><li>多个 method 对应同一个 funcname，method 之间通过 <code>,</code> 来分割</li></ul><p>以下是一个 RESTful 的设计示例：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">web.Router(<span class="hljs-string">&quot;/api/food&quot;</span>,&amp;RestController&#123;&#125;,<span class="hljs-string">&quot;get:ListFood&quot;</span>)<br>web.Router(<span class="hljs-string">&quot;/api/food&quot;</span>,&amp;RestController&#123;&#125;,<span class="hljs-string">&quot;post:CreateFood&quot;</span>)<br>web.Router(<span class="hljs-string">&quot;/api/food&quot;</span>,&amp;RestController&#123;&#125;,<span class="hljs-string">&quot;put:UpdateFood&quot;</span>)<br>web.Router(<span class="hljs-string">&quot;/api/food&quot;</span>,&amp;RestController&#123;&#125;,<span class="hljs-string">&quot;delete:DeleteFood&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>以下是多个 HTTP Method 指向同一个函数的示例：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">web.Router(<span class="hljs-string">&quot;/api&quot;</span>,&amp;RestController&#123;&#125;,<span class="hljs-string">&quot;get,post:ApiFunc&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>以下是不同的 method 对应不同的函数，通过 ; 进行分割的示例：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">web.Router(<span class="hljs-string">&quot;/api/food&quot;</span>,&amp;RestController&#123;&#125;,<span class="hljs-string">&quot;get:ListFood;post:CreateFood;put:UpdateFood;delete:DeleteFood&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>可用的 HTTP Method：</p><ul><li>*: 包含以下所有的函数</li><li>get: GET 请求</li><li>post: POST 请求</li><li>put: PUT 请求</li><li>delete: DELETE 请求</li><li>patch: PATCH 请求</li><li>options: OPTIONS 请求</li><li>head: HEAD 请求</li></ul><p>如果同时存在 * 和对应的 HTTP Method，那么优先执行 HTTP Method 的方法，例如同时注册了如下所示的路由：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">web.Router(<span class="hljs-string">&quot;/simple&quot;</span>,&amp;SimpleController&#123;&#125;,<span class="hljs-string">&quot;*:AllFunc;post:PostFunc&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>那么执行 <code>POST</code> 请求的时候，执行 <code>PostFunc</code> 而不执行 <code>AllFunc</code>。</p><blockquote><blockquote><blockquote><p>自定义函数的路由默认不支持 RESTful 的方法，也就是如果你设置了 <code>web.Router(&quot;/api&quot;,&amp;RestController&#123;&#125;,&quot;post:ApiFunc&quot;)</code> 这样的路由，如果请求的方法是 <code>POST</code>，那么不会默认去执行 <code>Post</code> 函数。</p></blockquote></blockquote></blockquote><h2 id="自动匹配"><a href="#自动匹配" class="headerlink" title="自动匹配"></a>自动匹配</h2><p>用户首先需要把需要路由的控制器注册到自动路由中：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">web.AutoRouter(&amp;controllers.ObjectController&#123;&#125;)<br></code></pre></div></td></tr></table></figure><p>那么 beego 就会通过反射获取该结构体中所有的实现方法，你就可以通过如下的方式访问到对应的方法中：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">/object/login   调用 ObjectController 中的 Login 方法<br>/object/logout  调用 ObjectController 中的 Logout 方法<br></code></pre></div></td></tr></table></figure><p>除了前缀两个 <code>/:controller/:method</code> 的匹配之外，剩下的 url beego 会帮你自动化解析为参数，保存在 <code>this.Ctx.Input.Params</code> 当中：</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">/object/</span>blog<span class="hljs-regexp">/2013/</span><span class="hljs-number">09</span>/<span class="hljs-number">12</span>  调用 ObjectController 中的 Blog 方法，参数如下：map[<span class="hljs-number">0</span>:<span class="hljs-number">2013</span> <span class="hljs-number">1</span>:<span class="hljs-number">09</span> <span class="hljs-number">2</span>:<span class="hljs-number">12</span>]<br></code></pre></div></td></tr></table></figure><p>方法名在内部是保存了用户设置的，例如 Login，url 匹配的时候都会转化为小写，所以，<code>/object/LOGIN</code> 这样的 <code>url</code> 也一样可以路由到用户定义的 <code>Login</code> 方法中【实际在1.10.1版本中测试，不会转化大小写，即只能匹配<code>/object/login</code>，其他均不能正常识别】。</p><p>现在已经可以通过自动识别出来下面类似的所有 url，都会把请求分发到 <code>controller</code> 的 <code>simple</code> 方法：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">/controller/simple<br>/controller/simple.html<br>/controller/simple.json<br>/controller/simple.xml<br></code></pre></div></td></tr></table></figure><p>可以通过 <code>this.Ctx.Input.Param(&quot;:ext&quot;)</code> 获取后缀名。</p><h2 id="注解路由"><a href="#注解路由" class="headerlink" title="注解路由"></a>注解路由</h2><p>从2.0开始，我们使用配置<code>CommentRouterPath</code>来配置注解路由的扫描路径。在<code>dev</code>环境下，我们将自动扫描该配置指向的目录及其子目录，生成路由文件。</p><p>生成之后，用户需要显示 Include 相应地 controller。注意， controller 的 method 方法上面须有 router 注释（// @router），详细的使用请看下面的例子：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// CMS API</span><br><span class="hljs-keyword">type</span> CMSController <span class="hljs-keyword">struct</span> &#123;<br>    web.Controller<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *CMSController)</span> <span class="hljs-title">URLMapping</span><span class="hljs-params">()</span></span> &#123;<br>    c.Mapping(<span class="hljs-string">&quot;StaticBlock&quot;</span>, c.StaticBlock)<br>    c.Mapping(<span class="hljs-string">&quot;AllBlock&quot;</span>, c.AllBlock)<br>&#125;<br><br><br><span class="hljs-comment">// @router /staticblock/:key [get]</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *CMSController)</span> <span class="hljs-title">StaticBlock</span><span class="hljs-params">()</span></span> &#123;<br><br>&#125;<br><br><span class="hljs-comment">// @router /all/:key [get]</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *CMSController)</span> <span class="hljs-title">AllBlock</span><span class="hljs-params">()</span></span> &#123;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><p>可以在 <code>router.go</code> 中通过如下方式注册路由：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">web.Include(&amp;CMSController&#123;&#125;)<br></code></pre></div></td></tr></table></figure><p>web 自动会进行源码分析，注意只会在 dev 模式下进行生成，生成的路由放在 “/routers/commentsRouter.go” 文件中。</p><p>这样上面的路由就支持了如下的路由：</p><ul><li>GET /staticblock/:key</li><li>GET /all/:key</li></ul><p>其实效果和自己通过 Router 函数注册是一样的：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">web.Router(<span class="hljs-string">&quot;/staticblock/:key&quot;</span>, &amp;CMSController&#123;&#125;, <span class="hljs-string">&quot;get:StaticBlock&quot;</span>)<br>web.Router(<span class="hljs-string">&quot;/all/:key&quot;</span>, &amp;CMSController&#123;&#125;, <span class="hljs-string">&quot;get:AllBlock&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>同时大家注意到新版本里面增加了 URLMapping 这个函数，这是新增加的函数，用户如果没有进行注册，那么就会通过反射来执行对应的函数，如果注册了就会通过 interface 来进行执行函数，性能上面会提升很多。</p><h2 id="方法表达式路由"><a href="#方法表达式路由" class="headerlink" title="方法表达式路由"></a>方法表达式路由</h2><p>方法表达式路由与上面的RESTful基本相似，区别是无需在传入http method和controller方法（如：<code>&quot;get:StaticBlock&quot;</code>）。<br>只需要通过golang的method expression进行传入方法表达式。如果方法是receiver是非指针，则直接使用 <code>包名.Controller.Method</code> 方法 传入，<br>如果receiver是指针，则使用 <code>(*包名.Controller).Method</code> 进行传参。假如在同包下，包名可进行省略。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> BaseController <span class="hljs-keyword">struct</span> &#123;<br>    web.Controller<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b BaseController)</span> <span class="hljs-title">Ping</span><span class="hljs-params">()</span></span> &#123;<br>    b.Data[<span class="hljs-string">&quot;json&quot;</span>] = <span class="hljs-string">&quot;pong&quot;</span><br>    b.ServeJSON()<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b *BaseController)</span> <span class="hljs-title">PingPointer</span><span class="hljs-params">()</span></span> &#123;<br>    b.Data[<span class="hljs-string">&quot;json&quot;</span>] = <span class="hljs-string">&quot;pong_pointer&quot;</span><br>    b.ServeJSON()<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    web.CtrlGet(<span class="hljs-string">&quot;/ping&quot;</span>, BaseController.Ping)<br>    web.CtrlGet(<span class="hljs-string">&quot;/ping_pointer&quot;</span>, (*BaseController).PingPointer)<br>    web.Run()<br>&#125;<br></code></pre></div></td></tr></table></figure><p>共有以下几种函数：</p><ul><li>web.CtrlGet(router, pkg.controller.method)</li><li>web.CtrlPost(router, pkg.controller.method)</li><li>web.CtrlPut(router, pkg.controller.method)</li><li>web.CtrlPatch(router, pkg.controller.method)</li><li>web.CtrlHead(router, pkg.controller.method)</li><li>web.CtrlOptions(router, pkg.controller.method)</li><li>web.CtrlDelete(router, pkg.controller.method)</li><li>web.CtrlAny(router, pkg.controller.method)</li></ul><p>同时也支持namespace的使用：</p><ul><li>web.NSCtrlGet</li><li>web.NSCtrlPost</li><li>……</li></ul><h2 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h2><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">//初始化 namespace</span><br>ns :=<br>web.NewNamespace(<span class="hljs-string">&quot;/v1&quot;</span>,<br>    web.NSCond(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *context.Context)</span> <span class="hljs-title">bool</span></span> &#123;<br>        <span class="hljs-keyword">if</span> ctx.Input.Domain() == <span class="hljs-string">&quot;api.beego.me&quot;</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>    &#125;),<br>    web.NSBefore(auth),<br>    web.NSGet(<span class="hljs-string">&quot;/notallowed&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *context.Context)</span></span> &#123;<br>        ctx.Output.Body([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;notAllowed&quot;</span>))<br>    &#125;),<br>    web.NSRouter(<span class="hljs-string">&quot;/version&quot;</span>, &amp;AdminController&#123;&#125;, <span class="hljs-string">&quot;get:ShowAPIVersion&quot;</span>),<br>    web.NSRouter(<span class="hljs-string">&quot;/changepassword&quot;</span>, &amp;UserController&#123;&#125;),<br>    web.NSNamespace(<span class="hljs-string">&quot;/shop&quot;</span>,<br>        web.NSBefore(sentry),<br>        web.NSGet(<span class="hljs-string">&quot;/:id&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *context.Context)</span></span> &#123;<br>            ctx.Output.Body([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;notAllowed&quot;</span>))<br>        &#125;),<br>    ),<br>    web.NSNamespace(<span class="hljs-string">&quot;/cms&quot;</span>,<br>        web.NSInclude(<br>            &amp;controllers.MainController&#123;&#125;,<br>            &amp;controllers.CMSController&#123;&#125;,<br>            &amp;controllers.BlockController&#123;&#125;,<br>        ),<br>    ),<br>)<br><span class="hljs-comment">//注册 namespace</span><br>web.AddNamespace(ns)<br></code></pre></div></td></tr></table></figure><p>上面这个代码支持了如下这样的请求 URL</p><ul><li>GET /v1/notallowed</li><li>GET /v1/version</li><li>GET /v1/changepassword</li><li>POST /v1/changepassword</li><li>GET /v1/shop/123</li><li>GET /v1/cms/ 对应 MainController、CMSController、BlockController 中的注解路由</li></ul><p>而且还支持前置过滤,条件判断,无限嵌套 namespace</p><p>namespace 的接口如下:</p><ul><li><p>NewNamespace(prefix string, funcs …interface{})</p><p>初始化 namespace 对象,下面这些函数都是 namespace 对象的方法,但是强烈推荐使用 NS 开头的相应函数注册，因为这样更容易通过 gofmt 工具看的更清楚路由的级别关系</p></li><li><p>NSCond(cond namespaceCond)</p><p>支持满足条件的就执行该 namespace, 不满足就不执行</p></li><li><p>NSBefore(filiterList …FilterFunc)</p></li><li><p>NSAfter(filiterList …FilterFunc)</p><p>上面分别对应 beforeRouter 和 FinishRouter 两个过滤器，可以同时注册多个过滤器</p></li><li><p>NSInclude(cList …ControllerInterface)</p></li><li><p>NSRouter(rootpath string, c ControllerInterface, mappingMethods …string)</p></li><li><p>NSGet(rootpath string, f HandleFunc)</p></li><li><p>NSPost(rootpath string, f HandleFunc)</p></li><li><p>NSDelete(rootpath string, f HandleFunc)</p></li><li><p>NSPut(rootpath string, f HandleFunc)</p></li><li><p>NSHead(rootpath string, f HandleFunc)</p></li><li><p>NSOptions(rootpath string, f HandleFunc)</p></li><li><p>NSPatch(rootpath string, f HandleFunc)</p></li><li><p>NSAny(rootpath string, f HandleFunc)</p></li><li><p>NSHandler(rootpath string, h http.Handler)</p></li><li><p>NSAutoRouter(c ControllerInterface)</p></li><li><p>NSAutoPrefix(prefix string, c ControllerInterface)</p><p>上面这些都是设置路由的函数,详细的使用和上面 beego 的对应函数是一样的</p></li><li><p>NSNamespace(prefix string, params …innnerNamespace)</p><p>嵌套其他 namespace</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gos">ns :=<br>web.NewNamespace(&quot;/v1&quot;,<br>    web.NSNamespace(&quot;/shop&quot;,<br>        web.NSGet(&quot;/:id&quot;, func(ctx *context.Context) &#123;<br>            ctx.Output.Body([]byte(&quot;shopinfo&quot;))<br>        &#125;),<br>    ),<br>    web.NSNamespace(&quot;/order&quot;,<br>        web.NSGet(&quot;/:id&quot;, func(ctx *context.Context) &#123;<br>            ctx.Output.Body([]byte(&quot;orderinfo&quot;))<br>        &#125;),<br>    ),<br>    web.NSNamespace(&quot;/crm&quot;,<br>        web.NSGet(&quot;/:id&quot;, func(ctx *context.Context) &#123;<br>            ctx.Output.Body([]byte(&quot;crminfo&quot;))<br>        &#125;),<br>    ),<br>)<br></code></pre></div></td></tr></table></figure></li></ul><p>下面这些函数都是属于 *Namespace 对象的方法：不建议直接使用，当然效果和上面的 NS 开头的函数是一样的，只是上面的方式更优雅，写出来的代码更容易看得懂</p><ul><li><p>Cond(cond namespaceCond)</p><p>支持满足条件的就执行该 namespace, 不满足就不执行,例如你可以根据域名来控制 namespace</p></li><li><p>Filter(action string, filter FilterFunc)</p><p>action 表示你需要执行的位置, before 和 after 分别表示执行逻辑之前和执行逻辑之后的 filter</p></li><li><p>Router(rootpath string, c ControllerInterface, mappingMethods …string)</p></li><li><p>AutoRouter(c ControllerInterface)</p></li><li><p>AutoPrefix(prefix string, c ControllerInterface)</p></li><li><p>Get(rootpath string, f HandleFunc)</p></li><li><p>Post(rootpath string, f HandleFunc)</p></li><li><p>Delete(rootpath string, f HandleFunc)</p></li><li><p>Put(rootpath string, f HandleFunc)</p></li><li><p>Head(rootpath string, f HandleFunc)</p></li><li><p>Options(rootpath string, f HandleFunc)</p></li><li><p>Patch(rootpath string, f HandleFunc)</p></li><li><p>Any(rootpath string, f HandleFunc)</p></li><li><p>Handler(rootpath string, h http.Handler)</p><p>上面这些都是设置路由的函数,详细的使用和上面 beego 的对应函数是一样的</p></li><li><p>Namespace(ns …*Namespace)</p></li></ul><p>更多的例子代码：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">//APIS</span><br>ns :=<br>    web.NewNamespace(<span class="hljs-string">&quot;/api&quot;</span>,<br>        <span class="hljs-comment">//此处正式版时改为验证加密请求</span><br>        web.NSCond(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *context.Context)</span> <span class="hljs-title">bool</span></span> &#123;<br>            <span class="hljs-keyword">if</span> ua := ctx.Input.Request.UserAgent(); ua != <span class="hljs-string">&quot;&quot;</span> &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>        &#125;),<br>        web.NSNamespace(<span class="hljs-string">&quot;/ios&quot;</span>,<br>            <span class="hljs-comment">//CRUD Create(创建)、Read(读取)、Update(更新)和Delete(删除)</span><br>            web.NSNamespace(<span class="hljs-string">&quot;/create&quot;</span>,<br>                <span class="hljs-comment">// /api/ios/create/node/</span><br>                web.NSRouter(<span class="hljs-string">&quot;/node&quot;</span>, &amp;apis.CreateNodeHandler&#123;&#125;),<br>                <span class="hljs-comment">// /api/ios/create/topic/</span><br>                web.NSRouter(<span class="hljs-string">&quot;/topic&quot;</span>, &amp;apis.CreateTopicHandler&#123;&#125;),<br>            ),<br>            web.NSNamespace(<span class="hljs-string">&quot;/read&quot;</span>,<br>                web.NSRouter(<span class="hljs-string">&quot;/node&quot;</span>, &amp;apis.ReadNodeHandler&#123;&#125;),<br>                web.NSRouter(<span class="hljs-string">&quot;/topic&quot;</span>, &amp;apis.ReadTopicHandler&#123;&#125;),<br>            ),<br>            web.NSNamespace(<span class="hljs-string">&quot;/update&quot;</span>,<br>                web.NSRouter(<span class="hljs-string">&quot;/node&quot;</span>, &amp;apis.UpdateNodeHandler&#123;&#125;),<br>                web.NSRouter(<span class="hljs-string">&quot;/topic&quot;</span>, &amp;apis.UpdateTopicHandler&#123;&#125;),<br>            ),<br>            web.NSNamespace(<span class="hljs-string">&quot;/delete&quot;</span>,<br>                web.NSRouter(<span class="hljs-string">&quot;/node&quot;</span>, &amp;apis.DeleteNodeHandler&#123;&#125;),<br>                web.NSRouter(<span class="hljs-string">&quot;/topic&quot;</span>, &amp;apis.DeleteTopicHandler&#123;&#125;),<br>            )<br>        ),<br>    )<br><br>web.AddNamespace(ns)<br></code></pre></div></td></tr></table></figure><h1 id="控制器介绍"><a href="#控制器介绍" class="headerlink" title="控制器介绍"></a>控制器介绍</h1><p>基于 beego 的 Controller 设计，只需要匿名组合 <code>beego.Controller</code> 就可以了，如下所示：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> your_package<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;github.com/beego/beego/v2/server/web&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> xxxController <span class="hljs-keyword">struct</span> &#123;<br>        web.Controller<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="控制器方法"><a href="#控制器方法" class="headerlink" title="控制器方法"></a>控制器方法</h2><p><code>web.Controller</code> 实现了接口 <code>web.ControllerInterface</code>，<code>web.ControllerInterface</code> 定义了如下函数：</p><ul><li><p>Init(ctx *context.Context, controllerName, actionName string, app interface{})</p><p>这个函数主要初始化了 Context、相应的 Controller 名称，模板名，初始化模板参数的容器 Data，app 即为当前执行的 Controller 的 reflecttype，这个 app 可以用来执行子类的方法。</p></li><li><p>Prepare()</p><p>这个函数主要是为了用户扩展用的，这个函数会在下面定义的这些 Method 方法之前执行，用户可以重写这个函数实现类似用户验证之类。</p></li><li><p>Get()</p><p>如果用户请求的 HTTP Method 是 GET，那么就执行该函数，默认是 405，用户继承的子 struct 中可以实现了该方法以处理 Get 请求。</p></li><li><p>Post()</p><p>如果用户请求的 HTTP Method 是 POST，那么就执行该函数，默认是 405，用户继承的子 struct 中可以实现了该方法以处理 Post 请求。</p></li><li><p>Delete()</p><p>如果用户请求的 HTTP Method 是 DELETE，那么就执行该函数，默认是 405，用户继承的子 struct 中可以实现了该方法以处理 Delete 请求。</p></li><li><p>Put()</p><p>如果用户请求的 HTTP Method 是 PUT，那么就执行该函数，默认是 405，用户继承的子 struct 中可以实现了该方法以处理 Put 请求.</p></li><li><p>Head()</p><p>如果用户请求的 HTTP Method 是 HEAD，那么就执行该函数，默认是 405，用户继承的子 struct 中可以实现了该方法以处理 Head 请求。</p></li><li><p>Patch()</p><p>如果用户请求的 HTTP Method 是 PATCH，那么就执行该函数，默认是 405，用户继承的子 struct 中可以实现了该方法以处理 Patch 请求.</p></li><li><p>Options()</p><p>如果用户请求的HTTP Method是OPTIONS，那么就执行该函数，默认是 405，用户继承的子 struct 中可以实现了该方法以处理 Options 请求。</p></li><li><p>Finish()</p><p>这个函数是在执行完相应的 HTTP Method 方法之后执行的，默认是空，用户可以在子 struct 中重写这个函数，执行例如数据库关闭，清理数据之类的工作。</p></li><li><p>Trace() error</p><p>如果用户请求的 HTTP Method 是 Trace，那么就执行该函数，默认是 405，用户继承的子 struct 中可以实现了该方法以处理 Head 请求。</p></li><li><p>Render() error</p><p>这个函数主要用来实现渲染模板，如果 beego.AutoRender 为 true 的情况下才会执行。</p></li><li><p>Mapping(method string, fn func())</p><p>注册一个方法。一般而言， method 是合法的 HTTP 方法名。当然，用户注册自己特定的业务逻辑方法，而后手动调用。</p></li><li><p>HandlerFunc(fnname string) bool</p><p>在前面 Mapping 方法里面注册的方法，可以通过该方法来使用。只会返回调用是否成功的信息——一般而言，只有方法不存在才会返回 false</p></li><li><p>RenderBytes() ([]byte, error)</p><p>将模板渲染成字节数组。需要注意的是，该方法并未检测<code>EnableRender</code>设置。并且，和<code>Render</code>方法相比，它并未将结果输出到<code>Response</code>。</p></li><li><p>RenderString() (string, error)</p><p>类似于<code>RenderBytes</code>方法。只是将结果转化为了<code>string</code>。</p></li><li><p>Redirect(url string, code int)</p><p>重定向。<code>url</code>是目的地址。</p></li><li><p>SetData(data interface{})</p><p>将<code>data</code>存储在控制的数据中。一般而言，你不会考虑用到这个方法。</p></li><li><p>Abort(code string)</p><p>中断当前方法的执行，直接返回该状态码，类似于<code>CustomAbort</code>。参考<a href="https://beego.me/docs/mvc/controller/errors.md">errors</a></p></li><li><p>CustomAbort(status int, body string)</p><p>中断方法执行，直接返回该状态码和信息。参考<a href="https://beego.me/docs/mvc/controller/errors.md">errors</a></p></li><li><p>StopRun()</p><p>直接触发<code>panic</code>。</p></li><li><p>ServeXXX(encoding …bool) error</p><p>返回特性类型的响应。目前我们支持 JSON，JSONP，XML，YAML。参考<a href="https://beego.me/docs/mvc/controller/jsonxml.md">输出格式</a></p></li><li><p>ServeFormatted(encoding …bool) error</p><p>返回响应。其格式由客户端的<code>Accept</code>选项指定。参考<a href="https://beego.me/docs/mvc/controller/jsonxml.md">输出格式</a></p></li><li><p>Input() (url.Values, error)</p><p>返回传入的参数。</p></li><li><p>ParseForm(obj interface{}) error</p><p>将表单反序列化到 obj 对象中。</p></li><li><p>GetXXX(key string, def…) XXX, err</p><p>从传入参数中，读取某个值。如果传入了默认值，那么在读取不到的情况下，返回默认值，否则返回错误。XXX 可以是 golang 所支持的基本类型，或者是 string, File 对象</p></li><li><p>SaveToFile(fromfile, tofile string) error</p><p>将上传的文件保存到文件系统中。其中<code>fromfile</code>是上传的文件的名字。</p></li><li><p>SetSession(name interface{}, value interface{}) error</p><p>往<code>Session</code>中设置值。</p></li><li><p>GetSession(name interface{}) interface{}</p><p>从<code>Session</code>中读取值。</p></li><li><p>DelSession(name interface{}) error</p><p>从<code>Session</code>中删除某项。</p></li><li><p>SessionRegenerateID() error</p><p>重新生成一个<code>SessionId</code>。</p></li><li><p>DestroySession() error</p><p>销毁<code>Session</code></p></li><li><p>IsAjax() bool</p><p>是否是 Ajax 请求</p></li><li><p>GetSecureCookie(Secret, key string) (string, bool)</p><p>从<code>Cookie</code>中读取数据。<code>bool</code>返回值，表达是否取到了数据。</p></li><li><p>SetSecureCookie(Secret, name, value string, others …interface{})</p><p>设置<code>Cookie</code>。</p></li><li><p>XSRFToken() string</p><p>创建一个<code>CSRF</code> token.</p></li><li><p>CheckXSRFCookie() bool</p><p>检测是否有<code>CSRF</code> token</p></li></ul><h2 id="子类扩展"><a href="#子类扩展" class="headerlink" title="子类扩展"></a>子类扩展</h2><p>通过子 struct 的方法重写，用户就可以实现自己的逻辑，接下来我们看一个实际的例子：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> AddController <span class="hljs-keyword">struct</span> &#123;<br>    web.Controller<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *AddController)</span> <span class="hljs-title">Prepare</span><span class="hljs-params">()</span></span> &#123;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *AddController)</span> <span class="hljs-title">Get</span><span class="hljs-params">()</span></span> &#123;<br>    this.Data[<span class="hljs-string">&quot;content&quot;</span>] = <span class="hljs-string">&quot;value&quot;</span><br>    this.Layout = <span class="hljs-string">&quot;admin/layout.html&quot;</span><br>    this.TplName = <span class="hljs-string">&quot;admin/add.tpl&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *AddController)</span> <span class="hljs-title">Post</span><span class="hljs-params">()</span></span> &#123;<br>    pkgname := this.GetString(<span class="hljs-string">&quot;pkgname&quot;</span>)<br>    content := this.GetString(<span class="hljs-string">&quot;content&quot;</span>)<br>    pk := models.GetCruPkg(pkgname)<br>    <span class="hljs-keyword">if</span> pk.Id == <span class="hljs-number">0</span> &#123;<br>        <span class="hljs-keyword">var</span> pp models.PkgEntity<br>        pp.Pid = <span class="hljs-number">0</span><br>        pp.Pathname = pkgname<br>        pp.Intro = pkgname<br>        models.InsertPkg(pp)<br>        pk = models.GetCruPkg(pkgname)<br>    &#125;<br>    <span class="hljs-keyword">var</span> at models.Article<br>    at.Pkgid = pk.Id<br>    at.Content = content<br>    models.InsertArticle(at)<br>    this.Ctx.Redirect(<span class="hljs-number">302</span>, <span class="hljs-string">&quot;/admin/index&quot;</span>)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>从上面的例子可以看出来，通过重写方法可以实现对应 method 的逻辑，实现 RESTFul 结构的逻辑处理。</p><p>下面我们再来看一种比较流行的架构，首先实现一个自己的基类 baseController，实现一些初始化的方法，然后其他所有的逻辑继承自该基类：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> NestPreparer <span class="hljs-keyword">interface</span> &#123;<br>        NestPrepare()<br>&#125;<br><br><span class="hljs-comment">// baseRouter implemented global settings for all other routers.</span><br><span class="hljs-keyword">type</span> baseController <span class="hljs-keyword">struct</span> &#123;<br>        web.Controller<br>        i18n.Locale<br>        user    models.User<br>        isLogin <span class="hljs-keyword">bool</span><br>&#125;<br><span class="hljs-comment">// Prepare implemented Prepare method for baseRouter.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *baseController)</span> <span class="hljs-title">Prepare</span><span class="hljs-params">()</span></span> &#123;<br><br>        <span class="hljs-comment">// page start time</span><br>        this.Data[<span class="hljs-string">&quot;PageStartTime&quot;</span>] = time.Now()<br><br>        <span class="hljs-comment">// Setting properties.</span><br>        this.Data[<span class="hljs-string">&quot;AppDescription&quot;</span>] = utils.AppDescription<br>        this.Data[<span class="hljs-string">&quot;AppKeywords&quot;</span>] = utils.AppKeywords<br>        this.Data[<span class="hljs-string">&quot;AppName&quot;</span>] = utils.AppName<br>        this.Data[<span class="hljs-string">&quot;AppVer&quot;</span>] = utils.AppVer<br>        this.Data[<span class="hljs-string">&quot;AppUrl&quot;</span>] = utils.AppUrl<br>        this.Data[<span class="hljs-string">&quot;AppLogo&quot;</span>] = utils.AppLogo<br>        this.Data[<span class="hljs-string">&quot;AvatarURL&quot;</span>] = utils.AvatarURL<br>        this.Data[<span class="hljs-string">&quot;IsProMode&quot;</span>] = utils.IsProMode<br><br>        <span class="hljs-keyword">if</span> app, ok := this.AppController.(NestPreparer); ok &#123;<br>                app.NestPrepare()<br>        &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>上面定义了基类，大概是初始化了一些变量，最后有一个 Init 函数中那个 app 的应用，判断当前运行的 Controller 是否是 NestPreparer 实现，如果是的话调用子类的方法，下面我们来看一下 NestPreparer 的实现：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> BaseAdminRouter <span class="hljs-keyword">struct</span> &#123;<br>    baseController<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *BaseAdminRouter)</span> <span class="hljs-title">NestPrepare</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">if</span> this.CheckActiveRedirect() &#123;<br>            <span class="hljs-keyword">return</span><br>    &#125;<br><br>    <span class="hljs-comment">// if user isn&#x27;t admin, then logout user</span><br>    <span class="hljs-keyword">if</span> !this.user.IsAdmin &#123;<br>            models.LogoutUser(&amp;this.Controller)<br><br>            <span class="hljs-comment">// write flash message</span><br>            this.FlashWrite(<span class="hljs-string">&quot;NotPermit&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>)<br><br>            this.Redirect(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-number">302</span>)<br>            <span class="hljs-keyword">return</span><br>    &#125;<br><br>    <span class="hljs-comment">// current in admin page</span><br>    this.Data[<span class="hljs-string">&quot;IsAdmin&quot;</span>] = <span class="hljs-literal">true</span><br><br>    <span class="hljs-keyword">if</span> app, ok := this.AppController.(ModelPreparer); ok &#123;<br>            app.ModelPrepare()<br>            <span class="hljs-keyword">return</span><br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *BaseAdminRouter)</span> <span class="hljs-title">Get</span><span class="hljs-params">()</span></span>&#123;<br>    this.TplName = <span class="hljs-string">&quot;Get.tpl&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *BaseAdminRouter)</span> <span class="hljs-title">Post</span><span class="hljs-params">()</span></span>&#123;<br>    this.TplName = <span class="hljs-string">&quot;Post.tpl&quot;</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>这样我们的执行器执行的逻辑是这样的，首先执行 Prepare，这个就是 Go 语言中 struct 中寻找方法的顺序，依次往父类寻找。执行 <code>BaseAdminRouter</code> 时，查找他是否有 <code>Prepare</code> 方法，没有就寻找 <code>baseController</code>，找到了，那么就执行逻辑，然后在 <code>baseController</code> 里面的 <code>this.AppController</code> 即为当前执行的控制器 <code>BaseAdminRouter</code>，因为会执行 <code>BaseAdminRouter.NestPrepare</code> 方法。然后开始执行相应的 Get 方法或者 Post 方法。</p><h2 id="提前终止运行"><a href="#提前终止运行" class="headerlink" title="提前终止运行"></a>提前终止运行</h2><p>我们应用中经常会遇到这样的情况，在 Prepare 阶段进行判断，如果用户认证不通过，就输出一段信息，然后直接中止进程，之后的 Post、Get 之类的不再执行，那么如何终止呢？可以使用 <code>StopRun</code> 来终止执行逻辑，可以在任意的地方执行。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> RController <span class="hljs-keyword">struct</span> &#123;<br>    beego.Controller<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *RController)</span> <span class="hljs-title">Prepare</span><span class="hljs-params">()</span></span> &#123;<br>    this.Data[<span class="hljs-string">&quot;json&quot;</span>] = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;astaxie&quot;</span>&#125;<br>    this.ServeJSON()<br>    this.StopRun()<br>&#125;<br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Beego</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>beego</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Beego框架入门</title>
    <link href="/2021/08/29/Beego%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8/"/>
    <url>/2021/08/29/Beego%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="beego-简介"><a href="#beego-简介" class="headerlink" title="beego 简介"></a>beego 简介</h1><p>beego 是一个快速开发 Go 应用的 HTTP 框架，他可以用来快速开发 API、Web 及后端服务等各种应用，是一个 RESTful 的框架，主要设计灵感来源于 tornado、sinatra 和 flask 这三个框架，但是结合了 Go 本身的一些特性（interface、struct 嵌入等）而设计的一个框架。</p><h2 id="beego-的架构"><a href="#beego-的架构" class="headerlink" title="beego 的架构"></a>beego 的架构</h2><p>beego 的整体设计架构如下所示：</p><p><img src="architecture.png"></p><p>beego 是基于八大独立的模块构建的，是一个高度解耦的框架。当初设计 beego 的时候就是考虑功能模块化，用户即使不使用 beego 的 HTTP 逻辑，也依旧可以使用这些独立模块，例如：你可以使用 cache 模块来做你的缓存逻辑；使用日志模块来记录你的操作信息；使用 config 模块来解析你各种格式的文件。所以 beego 不仅可以用于 HTTP 类的应用开发，在你的 socket 游戏开发中也是很有用的模块，这也是 beego 为什么受欢迎的一个原因。</p><h2 id="beego-的执行逻辑"><a href="#beego-的执行逻辑" class="headerlink" title="beego 的执行逻辑"></a>beego 的执行逻辑</h2><p>既然 beego 是基于这些模块构建的，那么它的执行逻辑是怎么样的呢？beego 是一个典型的 MVC 架构，它的执行逻辑如下图所示：</p><p><img src="flow.png"></p><h2 id="beego-项目结构"><a href="#beego-项目结构" class="headerlink" title="beego 项目结构"></a>beego 项目结构</h2><p>一般的 beego 项目的目录如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">├── conf<br>│   └── app.conf<br>├── controllers<br>│   ├── admin<br>│   └── default.go<br>├── main.go<br>├── models<br>│   └── models.go<br>├── static<br>│   ├── css<br>│   ├── ico<br>│   ├── img<br>│   └── js<br>└── views<br>    ├── admin<br>    └── index.tpl<br></code></pre></div></td></tr></table></figure><p>从上面的目录结构我们可以看出来 M（models 目录）、V（views 目录）和 C（controllers 目录）的结构， <code>main.go</code> 是入口文件。</p><h1 id="bee-工具简介"><a href="#bee-工具简介" class="headerlink" title="bee 工具简介"></a>bee 工具简介</h1><p>bee 工具是一个为了协助快速开发 beego 项目而创建的项目，通过 bee 您可以很容易的进行 beego 项目的创建、热编译、开发、测试、和部署。</p><h2 id="bee-工具的安装"><a href="#bee-工具的安装" class="headerlink" title="bee 工具的安装"></a>bee 工具的安装</h2><p>您可以通过如下的方式安装 bee 工具：</p><figure class="highlight vim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vim"><span class="hljs-keyword">go</span> <span class="hljs-built_in">get</span> -<span class="hljs-keyword">u</span> github.<span class="hljs-keyword">com</span>/beego/bee/v2<br></code></pre></div></td></tr></table></figure><p>安装完之后，<code>bee</code> 可执行文件默认存放在 <code>$GOPATH/bin</code> 里面，所以您需要把 <code>$GOPATH/bin</code> 添加到您的环境变量中，才可以进行下一步。</p><blockquote><blockquote><blockquote><p>如果你本机设置了 <code>GOBIN</code>，那么上面的<code>bee</code>命令就会安装到 <code>GOBIN</code> 目录下，所以我们需要在环境变量中添加相关的配置信息，如何添加可以查看这篇文档: <a href="https://beego.me/docs/install/env.md">bee 环境变量配置</a></p><h2 id="bee-工具命令详解"><a href="#bee-工具命令详解" class="headerlink" title="bee 工具命令详解"></a>bee 工具命令详解</h2></blockquote></blockquote></blockquote><p>我们在命令行输入 <code>bee</code>，可以看到如下的信息：</p><figure class="highlight applescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs applescript">Bee <span class="hljs-keyword">is</span> a Fast <span class="hljs-keyword">and</span> Flexible tool <span class="hljs-keyword">for</span> managing your Beego Web Application.<br><br>Usage:<br><br>    bee command [arguments]<br><br>The commands are:<br><br>    <span class="hljs-built_in">version</span>     show <span class="hljs-keyword">the</span> bee &amp; beego <span class="hljs-built_in">version</span><br>    migrate     <span class="hljs-built_in">run</span> database migrations<br>    api         create an api <span class="hljs-built_in">application</span> base <span class="hljs-keyword">on</span> beego framework<br>    bale        packs non-Go files <span class="hljs-keyword">to</span> Go source files    <br>    new         create an <span class="hljs-built_in">application</span> base <span class="hljs-keyword">on</span> beego framework<br>    <span class="hljs-built_in">run</span>         <span class="hljs-built_in">run</span> <span class="hljs-keyword">the</span> app which can hot compile<br>    pack        compress an beego project<br>    fix         Fixes your <span class="hljs-built_in">application</span> <span class="hljs-keyword">by</span> making <span class="hljs-keyword">it</span> compatible <span class="hljs-keyword">with</span> newer versions <span class="hljs-keyword">of</span> Beego<br>    dlv         Start a debugging session using Delve<br>    dockerize   Generates a Dockerfile <span class="hljs-keyword">for</span> your Beego <span class="hljs-built_in">application</span><br>    generate    Source code generator<br>    hprose      Creates an RPC <span class="hljs-built_in">application</span> based <span class="hljs-keyword">on</span> Hprose <span class="hljs-keyword">and</span> Beego frameworks<br>    pack        Compresses a Beego <span class="hljs-built_in">application</span> <span class="hljs-keyword">into</span> a single <span class="hljs-built_in">file</span><br>    rs          Run customized scripts<br>    <span class="hljs-built_in">run</span>         Run <span class="hljs-keyword">the</span> <span class="hljs-built_in">application</span> <span class="hljs-keyword">by</span> starting a <span class="hljs-keyword">local</span> development server<br>    server      serving static content <span class="hljs-keyword">over</span> HTTP <span class="hljs-keyword">on</span> port<br>    <br>Use bee help [command] <span class="hljs-keyword">for</span> more information <span class="hljs-keyword">about</span> a command.<br>    <br></code></pre></div></td></tr></table></figure><h3 id="new-命令"><a href="#new-命令" class="headerlink" title="new 命令"></a><code>new</code> 命令</h3><p><code>new</code> 命令是新建一个 Web 项目，我们在命令行下执行 <code>bee new &lt;项目名&gt;</code> 就可以创建一个新的项目。但是注意该命令必须在 <code>$GOPATH/src</code> 下执行。最后会在 <code>$GOPATH/src</code> 相应目录下生成如下目录结构的项目：</p><figure class="highlight gradle"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gradle">bee <span class="hljs-keyword">new</span> myproject<br>[INFO] Creating application...<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/myproject/</span><br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/myproject/</span>conf/<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/myproject/</span>controllers/<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/myproject/m</span>odels/<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/myproject/</span><span class="hljs-keyword">static</span>/<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/myproject/</span><span class="hljs-keyword">static</span><span class="hljs-regexp">/js/</span><br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/myproject/</span><span class="hljs-keyword">static</span><span class="hljs-regexp">/css/</span><br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/myproject/</span><span class="hljs-keyword">static</span><span class="hljs-regexp">/img/</span><br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/myproject/</span>views/<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/myproject/</span>conf/app.conf<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/myproject/</span>controllers/<span class="hljs-keyword">default</span>.go<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/myproject/</span>views/index.tpl<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/myproject/m</span>ain.go<br><span class="hljs-number">13</span>-<span class="hljs-number">11</span>-<span class="hljs-number">25</span> <span class="hljs-number">09</span>:<span class="hljs-number">50</span>:<span class="hljs-number">39</span> [SUCC] <span class="hljs-keyword">New</span> application successfully created!<br>myproject<br>├── conf<br>│   └── app.conf<br>├── controllers<br>│   └── <span class="hljs-keyword">default</span>.go<br>├── main.go<br>├── models<br>├── routers<br>│   └── router.go<br>├── <span class="hljs-keyword">static</span><br>│   ├── css<br>│   ├── img<br>│   └── js<br>├── tests<br>│   └── default_test.go<br>└── views<br>    └── index.tpl<br><br><span class="hljs-number">8</span> directories, <span class="hljs-number">4</span> files<br></code></pre></div></td></tr></table></figure><h3 id="api-命令"><a href="#api-命令" class="headerlink" title="api 命令"></a><code>api</code> 命令</h3><p>上面的 <code>new</code> 命令是用来新建 Web 项目，不过很多用户使用 beego 来开发 API 应用。所以这个 <code>api</code> 命令就是用来创建 API 应用的，执行命令之后如下所示：</p><figure class="highlight gradle"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gradle">bee api apiproject<br>create app folder: <span class="hljs-regexp">/gopath/</span>src/apiproject<br>create conf: <span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/apiproject/</span>conf<br>create controllers: <span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/apiproject/</span>controllers<br>create models: <span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/apiproject/m</span>odels<br>create tests: <span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/apiproject/</span>tests<br>create conf app.conf: <span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/apiproject/</span>conf/app.conf<br>create controllers <span class="hljs-keyword">default</span>.go: <span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/apiproject/</span>controllers/<span class="hljs-keyword">default</span>.go<br>create tests <span class="hljs-keyword">default</span>.go: <span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/apiproject/</span>tests/default_test.go<br>create models object.go: <span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/apiproject/m</span>odels/object.go<br>create main.go: <span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/apiproject/m</span>ain.go<br></code></pre></div></td></tr></table></figure><p>这个项目的目录结构如下：</p><figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus">apiproject<br>├── conf<br>│   └── app<span class="hljs-selector-class">.conf</span><br>├── controllers<br>│   └── <span class="hljs-selector-tag">object</span><span class="hljs-selector-class">.go</span><br>│   └── user<span class="hljs-selector-class">.go</span><br>├── docs<br>│   └── doc<span class="hljs-selector-class">.go</span><br>├── <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.go</span><br>├── models<br>│   └── <span class="hljs-selector-tag">object</span><span class="hljs-selector-class">.go</span><br>│   └── user<span class="hljs-selector-class">.go</span><br>├── routers<br>│   └── router<span class="hljs-selector-class">.go</span><br>└── tests<br>    └── default_test.go<br></code></pre></div></td></tr></table></figure><p>从上面的目录我们可以看到和 Web 项目相比，少了 static 和 views 目录，多了一个 test 模块，用来做单元测试的。</p><p>同时，该命令还支持一些自定义参数自动连接数据库创建相关 model 和 controller:<br><code>bee api [appname] [-tables=&quot;&quot;] [-driver=mysql] [-conn=&quot;root:&lt;password&gt;@tcp(127.0.0.1:3306)/test&quot;]</code><br>如果 conn 参数为空则创建一个示例项目，否则将基于链接信息链接数据库创建项目。</p><h3 id="run-命令"><a href="#run-命令" class="headerlink" title="run 命令"></a><code>run</code> 命令</h3><p>我们在开发 Go 项目的时候最大的问题是经常需要自己手动去编译再运行，<code>bee run</code> 命令是监控 beego 的项目，通过 <a href="https://github.com/howeyc/fsnotify">fsnotify</a>监控文件系统。但是注意该命令必须在 <code>$GOPATH/src/appname</code> 下执行。<br>这样我们在开发过程中就可以实时的看到项目修改之后的效果：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">PS D:\<span class="hljs-keyword">go</span>\src\Beego_learn\quickstart&gt; bee run<br>______<br>| ___ \<br>| |_/ /  ___   ___<br>| ___ \ / _ \ / _ \<br>| |_/ /|  __/|  __/<br>\____/  \___| \___| v2<span class="hljs-number">.0</span><span class="hljs-number">.2</span><br><span class="hljs-number">2021</span>/<span class="hljs-number">08</span>/<span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">18</span> INFO     ▶ <span class="hljs-number">0001</span> Using <span class="hljs-string">&#x27;quickstart&#x27;</span> as <span class="hljs-string">&#x27;appname&#x27;</span><br><span class="hljs-number">2021</span>/<span class="hljs-number">08</span>/<span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">18</span> INFO     ▶ <span class="hljs-number">0002</span> Initializing watcher...<br><span class="hljs-number">2021</span>/<span class="hljs-number">08</span>/<span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">20</span> SUCCESS  ▶ <span class="hljs-number">0003</span> Built Successfully!<br><span class="hljs-number">2021</span>/<span class="hljs-number">08</span>/<span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">20</span> INFO     ▶ <span class="hljs-number">0004</span> Restarting <span class="hljs-string">&#x27;quickstart.exe&#x27;</span>...<br><span class="hljs-number">2021</span>/<span class="hljs-number">08</span>/<span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">20</span> SUCCESS  ▶ <span class="hljs-number">0005</span> <span class="hljs-string">&#x27;./quickstart.exe&#x27;</span> is running...<br><span class="hljs-number">2021</span>/<span class="hljs-number">08</span>/<span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">22.845</span> [I] [parser.<span class="hljs-keyword">go</span>:<span class="hljs-number">413</span>]  generate router from comments<br><br><span class="hljs-number">2021</span>/<span class="hljs-number">08</span>/<span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">22.857</span> [I] [server.<span class="hljs-keyword">go</span>:<span class="hljs-number">241</span>]  http server Running on http:<span class="hljs-comment">//:8080</span><br></code></pre></div></td></tr></table></figure><p>我们打开浏览器就可以看到效果 <code>http://localhost:8080/</code>:</p><p><img src="https://beego.me/docs/images/beerun.png"></p><p>如果我们修改了 <code>Controller</code> 下面的 <code>default.go</code> 文件，我们就可以看到命令行输出：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">quickstart/controllers<br>quickstart/routers<br>quickstart<br><span class="hljs-number">2021</span>/<span class="hljs-number">08</span>/<span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">59</span>:<span class="hljs-number">12</span> SUCCESS  ▶ <span class="hljs-number">0006</span> Built Successfully!<br><span class="hljs-number">2021</span>/<span class="hljs-number">08</span>/<span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">59</span>:<span class="hljs-number">12</span> INFO     ▶ <span class="hljs-number">0007</span> Restarting <span class="hljs-string">&#x27;quickstart.exe&#x27;</span>...<br><span class="hljs-number">2021</span>/<span class="hljs-number">08</span>/<span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">59</span>:<span class="hljs-number">12</span> SUCCESS  ▶ <span class="hljs-number">0008</span> <span class="hljs-string">&#x27;./quickstart.exe&#x27;</span> is running...<br><span class="hljs-number">2021</span>/<span class="hljs-number">08</span>/<span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">59</span>:<span class="hljs-number">15.385</span> [I] [parser.<span class="hljs-keyword">go</span>:<span class="hljs-number">413</span>]  generate router from comments<br><br><span class="hljs-number">2021</span>/<span class="hljs-number">08</span>/<span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">59</span>:<span class="hljs-number">15.397</span> [I] [server.<span class="hljs-keyword">go</span>:<span class="hljs-number">241</span>]  http server Running on http:<span class="hljs-comment">//:8080</span><br></code></pre></div></td></tr></table></figure><p>刷新浏览器我们看到新的修改内容已经输出。</p><h3 id="pack-命令"><a href="#pack-命令" class="headerlink" title="pack 命令"></a><code>pack</code> 命令</h3><p><code>pack</code> 目录用来发布应用的时候打包，会把项目打包成 zip 包，这样我们部署的时候直接把打包之后的项目上传，解压就可以部署了：</p><figure class="highlight gradle"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gradle">bee pack<br>app path: <span class="hljs-regexp">/gopath/</span>src/apiproject<br>GOOS darwin GOARCH amd64<br>build apiproject<br>build success<br><span class="hljs-keyword">exclude</span> prefix:<br><span class="hljs-keyword">exclude</span> suffix: .go:.DS_Store:.tmp<br><span class="hljs-keyword">file</span> <span class="hljs-keyword">write</span> to `<span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/apiproject/</span>apiproject.tar.gz`<br></code></pre></div></td></tr></table></figure><p>我们可以看到目录下有如下的压缩文件：</p><figure class="highlight tap"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs tap">rwxr-xr-x <span class="hljs-number"> 1 </span>astaxie  staff <span class="hljs-number"> 8995376 </span>11<span class="hljs-number"> 25 </span>22:46 apiproject<br>-rw-r--r-- <span class="hljs-number"> 1 </span>astaxie  staff <span class="hljs-number"> 2240288 </span>11<span class="hljs-number"> 25 </span>22:58 apiproject.tar.gz<br>drwxr-xr-x <span class="hljs-number"> 3 </span>astaxie  staff     <span class="hljs-number"> 102 </span>11<span class="hljs-number"> 25 </span>22:31 conf<br>drwxr-xr-x <span class="hljs-number"> 3 </span>astaxie  staff     <span class="hljs-number"> 102 </span>11<span class="hljs-number"> 25 </span>22:31 controllers<br>-rw-r--r-- <span class="hljs-number"> 1 </span>astaxie  staff     <span class="hljs-number"> 509 </span>11<span class="hljs-number"> 25 </span>22:31 main.go<br>drwxr-xr-x <span class="hljs-number"> 3 </span>astaxie  staff     <span class="hljs-number"> 102 </span>11<span class="hljs-number"> 25 </span>22:31 models<br>drwxr-xr-x <span class="hljs-number"> 3 </span>astaxie  staff     <span class="hljs-number"> 102 </span>11<span class="hljs-number"> 25 </span>22:31 tests<br></code></pre></div></td></tr></table></figure><h3 id="bale-命令"><a href="#bale-命令" class="headerlink" title="bale 命令"></a><code>bale</code> 命令</h3><p>这个命令目前仅限内部使用，具体实现方案未完善，主要用来压缩所有的静态文件变成一个变量申明文件，全部编译到二进制文件里面，用户发布的时候携带静态文件，包括 js、css、img 和 views。最后在启动运行时进行非覆盖式的自解压。</p><h3 id="version-命令"><a href="#version-命令" class="headerlink" title="version 命令"></a><code>version</code> 命令</h3><p>这个命令是动态获取 bee、beego 和 Go 的版本，这样一旦用户出现错误，可以通过该命令来查看当前的版本</p><figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">$</span> <span class="hljs-string">bee version</span><br><span class="hljs-attr">bee</span>   :<span class="hljs-string">1.2.2</span><br><span class="hljs-attr">beego</span> :<span class="hljs-string">1.4.2</span><br><span class="hljs-attr">Go</span>    :<span class="hljs-string">go version go1.3.3 darwin/amd64</span><br></code></pre></div></td></tr></table></figure><p>需要注意的是，目前 <code>bee version</code> 会试图输出当前<code>beego</code>的版本。</p><p>但是目前这个实现有点坑，它是通过读取<code>$GOPATH/src/astaxie/beego</code>下的文件来进行的。</p><p>这意味着，如果你本地并没有下载<code>beego</code>源码，或者放置的位置不对，<code>bee</code>都无法输出<code>beego</code>的版本信息。</p><h3 id="generate-命令"><a href="#generate-命令" class="headerlink" title="generate 命令"></a><code>generate</code> 命令</h3><p>这个命令是用来自动化的生成代码的，包含了从数据库一键生成 model，还包含了 scaffold 的，通过这个命令，让大家开发代码不再慢</p><figure class="highlight verilog"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs verilog">bee <span class="hljs-keyword">generate</span> scaffold [scaffoldname] [-fields=<span class="hljs-string">&quot;&quot;</span>] [-driver=mysql] [-conn=<span class="hljs-string">&quot;root:@tcp(127.0.0.1:3306)/test&quot;</span>]<br>    The <span class="hljs-keyword">generate</span> scaffold command will <span class="hljs-keyword">do</span> a number of things <span class="hljs-keyword">for</span> you.<br>    -fields: a list of <span class="hljs-keyword">table</span> fields. Format: field:<span class="hljs-keyword">type</span>, ...<br>    -driver: [mysql | postgres | sqlite], the <span class="hljs-keyword">default</span> is mysql<br>    -conn:   the connection <span class="hljs-keyword">string</span> used by the driver, the <span class="hljs-keyword">default</span> is root:@tcp(<span class="hljs-number">127</span><span class="hljs-variable">.0</span><span class="hljs-variable">.0</span><span class="hljs-variable">.1</span>:<span class="hljs-number">3306</span>)/test<br>    example: bee <span class="hljs-keyword">generate</span> scaffold post -fields=<span class="hljs-string">&quot;title:string,body:text&quot;</span><br><br>bee <span class="hljs-keyword">generate</span> model [modelname] [-fields=<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-keyword">generate</span> RESTful model based on fields<br>    -fields: a list of <span class="hljs-keyword">table</span> fields. Format: field:<span class="hljs-keyword">type</span>, ...<br><br>bee <span class="hljs-keyword">generate</span> controller [controllerfile]<br>    <span class="hljs-keyword">generate</span> RESTful controllers<br><br>bee <span class="hljs-keyword">generate</span> view [viewpath]<br>    <span class="hljs-keyword">generate</span> CRUD view in viewpath<br><br>bee <span class="hljs-keyword">generate</span> migration [migrationfile] [-fields=<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-keyword">generate</span> migration file <span class="hljs-keyword">for</span> making database schema update<br>    -fields: a list of <span class="hljs-keyword">table</span> fields. Format: field:<span class="hljs-keyword">type</span>, ...<br><br>bee <span class="hljs-keyword">generate</span> docs<br>    <span class="hljs-keyword">generate</span> swagger doc file<br><br>bee <span class="hljs-keyword">generate</span> test [routerfile]<br>    <span class="hljs-keyword">generate</span> testcase<br><br>bee <span class="hljs-keyword">generate</span> appcode [-tables=<span class="hljs-string">&quot;&quot;</span>] [-driver=mysql] [-conn=<span class="hljs-string">&quot;root:@tcp(127.0.0.1:3306)/test&quot;</span>] [-level=<span class="hljs-number">3</span>]<br>    <span class="hljs-keyword">generate</span> appcode based on an existing database<br>    -tables: a list of <span class="hljs-keyword">table</span> names separated by &#x27;,&#x27;, <span class="hljs-keyword">default</span> is empty, indicating all tables<br>    -driver: [mysql | postgres | sqlite], the <span class="hljs-keyword">default</span> is mysql<br>    -conn:   the connection <span class="hljs-keyword">string</span> used by the driver.<br>             <span class="hljs-keyword">default</span> <span class="hljs-keyword">for</span> mysql:    root:@tcp(<span class="hljs-number">127</span><span class="hljs-variable">.0</span><span class="hljs-variable">.0</span><span class="hljs-variable">.1</span>:<span class="hljs-number">3306</span>)/test<br>             <span class="hljs-keyword">default</span> <span class="hljs-keyword">for</span> postgres: postgres:<span class="hljs-comment">//postgres:postgres@127.0.0.1:5432/postgres</span><br>    -level:  [<span class="hljs-number">1</span> | <span class="hljs-number">2</span> | <span class="hljs-number">3</span>], <span class="hljs-number">1</span> = models; <span class="hljs-number">2</span> = models,controllers; <span class="hljs-number">3</span> = models,controllers,router<br></code></pre></div></td></tr></table></figure><h3 id="migrate-命令"><a href="#migrate-命令" class="headerlink" title="migrate 命令"></a><code>migrate</code> 命令</h3><p>这个命令是应用的数据库迁移命令，主要是用来每次应用升级，降级的SQL管理。</p><figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql">bee migrate [-driver=mysql] [-conn=&quot;root:@tcp(127.0.0.1:3306)/test&quot;]<br>    run <span class="hljs-keyword">all</span> outstanding migrations<br>    -driver: [mysql | postgresql | sqlite], the <span class="hljs-keyword">default</span> <span class="hljs-keyword">is</span> mysql<br>    -conn:   the <span class="hljs-keyword">connection</span> string used <span class="hljs-keyword">by</span> the driver, the <span class="hljs-keyword">default</span> <span class="hljs-keyword">is</span> root:@tcp(<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">3306</span>)/test<br><br>bee migrate <span class="hljs-keyword">rollback</span> [-driver=mysql] [-conn=&quot;root:@tcp(127.0.0.1:3306)/test&quot;]<br>    <span class="hljs-keyword">rollback</span> the last migration operation<br>    -driver: [mysql | postgresql | sqlite], the <span class="hljs-keyword">default</span> <span class="hljs-keyword">is</span> mysql<br>    -conn:   the <span class="hljs-keyword">connection</span> string used <span class="hljs-keyword">by</span> the driver, the <span class="hljs-keyword">default</span> <span class="hljs-keyword">is</span> root:@tcp(<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">3306</span>)/test<br><br>bee migrate <span class="hljs-keyword">reset</span> [-driver=mysql] [-conn=&quot;root:@tcp(127.0.0.1:3306)/test&quot;]<br>    <span class="hljs-keyword">rollback</span> <span class="hljs-keyword">all</span> migrations<br>    -driver: [mysql | postgresql | sqlite], the <span class="hljs-keyword">default</span> <span class="hljs-keyword">is</span> mysql<br>    -conn:   the <span class="hljs-keyword">connection</span> string used <span class="hljs-keyword">by</span> the driver, the <span class="hljs-keyword">default</span> <span class="hljs-keyword">is</span> root:@tcp(<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">3306</span>)/test<br><br>bee migrate <span class="hljs-keyword">refresh</span> [-driver=mysql] [-conn=&quot;root:@tcp(127.0.0.1:3306)/test&quot;]<br>    <span class="hljs-keyword">rollback</span> <span class="hljs-keyword">all</span> migrations <span class="hljs-keyword">and</span> run them <span class="hljs-keyword">all</span> again<br>    -driver: [mysql | postgresql | sqlite], the <span class="hljs-keyword">default</span> <span class="hljs-keyword">is</span> mysql<br>    -conn:   the <span class="hljs-keyword">connection</span> string used <span class="hljs-keyword">by</span> the driver, the <span class="hljs-keyword">default</span> <span class="hljs-keyword">is</span> root:@tcp(<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">3306</span>)/test<br></code></pre></div></td></tr></table></figure><h3 id="dockerize-命令"><a href="#dockerize-命令" class="headerlink" title="dockerize 命令"></a><code>dockerize</code> 命令</h3><p>这个命令可以通过生成Dockerfile文件来实现docker化你的应用。</p><p>例子:<br>生成一个以1.6.4版本Go环境为基础镜像的Dockerfile,并暴露9000端口:</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">$ bee dockerize -image=<span class="hljs-string">&quot;library/golang:1.6.4&quot;</span> -expose=<span class="hljs-number">9000</span><br>______<br>| ___ \<br>| |_<span class="hljs-regexp">/ /</span>  ___   ___<br>| ___ \ <span class="hljs-regexp">/ _ \ /</span> _ \<br>| |_<span class="hljs-regexp">/ /</span>|  __<span class="hljs-regexp">/|  __/</span><br>\____/  \___| \___| v1.<span class="hljs-number">6.2</span><br><span class="hljs-number">2016</span><span class="hljs-regexp">/12/</span><span class="hljs-number">26</span> <span class="hljs-number">22</span>:<span class="hljs-number">34</span>:<span class="hljs-number">54</span> INFO     ▶ <span class="hljs-number">0001</span> Generating Dockerfile...<br><span class="hljs-number">2016</span><span class="hljs-regexp">/12/</span><span class="hljs-number">26</span> <span class="hljs-number">22</span>:<span class="hljs-number">34</span>:<span class="hljs-number">54</span> SUCCESS  ▶ <span class="hljs-number">0002</span> Dockerfile generated.<br></code></pre></div></td></tr></table></figure><p>更多帮助信息可执行<code>bee help dockerize</code>.</p><h2 id="bee-工具配置文件"><a href="#bee-工具配置文件" class="headerlink" title="bee 工具配置文件"></a>bee 工具配置文件</h2><p>您可能已经注意到，在 bee 工具的源码目录下有一个 <code>bee.json</code> 文件，这个文件是针对 bee 工具的一些行为进行配置。该功能还未完全开发完成，不过其中的一些选项已经可以使用：</p><ul><li><code>&quot;version&quot;: 0</code>：配置文件版本，用于对比是否发生不兼容的配置格式版本。</li><li><code>&quot;go_install&quot;: false</code>：如果您的包均使用完整的导入路径（例如：<code>github.com/user/repo/subpkg</code>）,则可以启用该选项来进行 <code>go install</code> 操作，加快构建操作。</li><li><code>&quot;watch_ext&quot;: []</code>：用于监控其它类型的文件（默认只监控后缀为 <code>.go</code> 的文件）。</li><li><code>&quot;dir_structure&quot;:&#123;&#125;</code>：如果您的目录名与默认的 MVC 架构的不同，则可以使用该选项进行修改。</li><li><code>&quot;cmd_args&quot;: []</code>：如果您需要在每次启动时加入启动参数，则可以使用该选项。</li><li><code>&quot;envs&quot;: []</code>：如果您需要在每次启动时设置临时环境变量参数，则可以使用该选项。</li></ul><h1 id="Beego-的安装"><a href="#Beego-的安装" class="headerlink" title="Beego 的安装"></a>Beego 的安装</h1><p>beego 的安装是典型的 Go 安装包的形式：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">go get github.com/beego/beego/v2<br></code></pre></div></td></tr></table></figure><p>常见问题：</p><ul><li><p>git 没有安装，请自行安装不同平台的 git，如何安装请自行搜索。</p></li><li><p>git https 无法获取，请配置本地的 git，关闭 https 验证：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git config --global http.sslVerify false<br></code></pre></div></td></tr></table></figure></li></ul><h1 id="beego-的升级"><a href="#beego-的升级" class="headerlink" title="beego 的升级"></a>beego 的升级</h1><p>beego 升级分为 go 方式升级和源码下载升级：</p><ul><li><p>Go 升级,通过该方式用户可以升级 beego 框架，强烈推荐该方式：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">go get -u github.com/beego/beego/v2<br></code></pre></div></td></tr></table></figure></li><li><p>源码下载升级，用户访问 <code>https://github.com/beego/beego</code> ,下载源码，然后覆盖到 <code>$GOPATH/src/github.com/beego/beego</code> 目录，然后通过本地执行安装就可以升级了：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">go install  github.com/beego/beego/v2<br></code></pre></div></td></tr></table></figure></li></ul><h1 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h1><p>beego 的项目基本都是通过 <code>bee</code> 命令来创建的，所以在创建项目之前确保你已经安装了 bee 工具和 beego。如果你还没有安装，那么请查阅 <a href="https://beego.me/docs/install">beego 的安装</a> 和 <a href="https://beego.me/docs/install/bee.md">bee 工具的安装</a>。</p><p>现在一切就绪我们就可以开始创建项目了，打开终端，进入 <code>$GOPATH/src</code> 所在的目录：</p><figure class="highlight gradle"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gradle">➜  src  bee <span class="hljs-keyword">new</span> quickstart<br>[INFO] Creating application...<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/</span><br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/</span>conf/<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/</span>controllers/<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/m</span>odels/<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/</span>routers/<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/</span>tests/<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/</span><span class="hljs-keyword">static</span>/<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/</span><span class="hljs-keyword">static</span><span class="hljs-regexp">/js/</span><br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/</span><span class="hljs-keyword">static</span><span class="hljs-regexp">/css/</span><br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/</span><span class="hljs-keyword">static</span><span class="hljs-regexp">/img/</span><br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/</span>views/<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/</span>conf/app.conf<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/</span>controllers/<span class="hljs-keyword">default</span>.go<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/</span>views/index.tpl<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/</span>routers/router.go<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/</span>tests/default_test.go<br><span class="hljs-regexp">/gopath/</span>src<span class="hljs-regexp">/quickstart/m</span>ain.go<br><span class="hljs-number">2014</span><span class="hljs-regexp">/11/</span><span class="hljs-number">06</span> <span class="hljs-number">18</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09</span> [SUCC] <span class="hljs-keyword">New</span> application successfully created!<br></code></pre></div></td></tr></table></figure><p>通过一个简单的命令就创建了一个 beego 项目。他的目录结构如下所示</p><figure class="highlight ada"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ada">quickstart<br>|<span class="hljs-comment">-- conf</span><br>|   `<span class="hljs-comment">-- app.conf</span><br>|<span class="hljs-comment">-- controllers</span><br>|   `<span class="hljs-comment">-- default.go</span><br>|<span class="hljs-comment">-- main.go</span><br>|<span class="hljs-comment">-- models</span><br>|<span class="hljs-comment">-- routers</span><br>|   `<span class="hljs-comment">-- router.go</span><br>|<span class="hljs-comment">-- static</span><br>|   |<span class="hljs-comment">-- css</span><br>|   |<span class="hljs-comment">-- img</span><br>|   `<span class="hljs-comment">-- js</span><br>|<span class="hljs-comment">-- tests</span><br>|   `<span class="hljs-comment">-- default_test.go</span><br>`<span class="hljs-comment">-- views</span><br>    `<span class="hljs-comment">-- index.tpl</span><br></code></pre></div></td></tr></table></figure><p>从目录结构中我们也可以看出来这是一个典型的 MVC 架构的应用，<code>main.go</code> 是入口文件。</p><h2 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h2><p>beego 项目创建之后，我们还需要初始化<code>go.mod</code>文件。进入目录之后，使用<code>go mod init</code>初始化模块依赖。</p><p>接着我们就开始运行项目，首先进入创建的项目，我们使用 <code>bee run</code> 来运行该项目，这样就可以做到热编译的效果：</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">PS D:\go\src\Beego_learn\quickstart&gt; bee run<br>______<br>| ___ \<br>| |_<span class="hljs-regexp">/ /</span>  ___   ___<br>| ___ \ <span class="hljs-regexp">/ _ \ /</span> _ \<br>| |_<span class="hljs-regexp">/ /</span>|  __<span class="hljs-regexp">/|  __/</span><br>\____/  \___| \___| v2.<span class="hljs-number">0.2</span><br><span class="hljs-number">2021</span><span class="hljs-regexp">/08/</span><span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">18</span> INFO     ▶ <span class="hljs-number">0001</span> Using <span class="hljs-string">&#x27;quickstart&#x27;</span> as <span class="hljs-string">&#x27;appname&#x27;</span><br><span class="hljs-number">2021</span><span class="hljs-regexp">/08/</span><span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">18</span> INFO     ▶ <span class="hljs-number">0002</span> Initializing watcher...<br><span class="hljs-number">2021</span><span class="hljs-regexp">/08/</span><span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">20</span> SUCCESS  ▶ <span class="hljs-number">0003</span> Built Successfully!<br><span class="hljs-number">2021</span><span class="hljs-regexp">/08/</span><span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">20</span> INFO     ▶ <span class="hljs-number">0004</span> Restarting <span class="hljs-string">&#x27;quickstart.exe&#x27;</span>...<br><span class="hljs-number">2021</span><span class="hljs-regexp">/08/</span><span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">20</span> SUCCESS  ▶ <span class="hljs-number">0005</span> <span class="hljs-string">&#x27;./quickstart.exe&#x27;</span> is running...<br><span class="hljs-number">2021</span><span class="hljs-regexp">/08/</span><span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">22.845</span> [I] [parser.go:<span class="hljs-number">413</span>]  generate router from comments<br><br><span class="hljs-number">2021</span><span class="hljs-regexp">/08/</span><span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">58</span>:<span class="hljs-number">22.857</span> [I] [server.go:<span class="hljs-number">241</span>]  http server Running on http:<span class="hljs-regexp">//</span>:<span class="hljs-number">8080</span><br></code></pre></div></td></tr></table></figure><p>这样我们的应用已经在 <code>8080</code> 端口(beego 的默认端口)跑起来了，打开浏览器看看效果：</p><p><img src="beerun.png"></p><h1 id="项目路由设置"><a href="#项目路由设置" class="headerlink" title="项目路由设置"></a>项目路由设置</h1><p>前面我们已经创建了 beego 项目，而且我们也看到它已经运行起来了，那么是如何运行起来的呢？让我们从入口文件先分析起来吧：</p><figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">main</span><br><br><span class="hljs-selector-tag">import</span> (<br>    _ <span class="hljs-string">&quot;quickstart/routers&quot;</span><br>    beego <span class="hljs-string">&quot;github.com/beego/beego/v2/server/web&quot;</span><br>)<br><br><span class="hljs-selector-tag">func</span> <span class="hljs-selector-tag">main</span>() &#123;<br>    <span class="hljs-selector-tag">beego</span><span class="hljs-selector-class">.Run</span>()<br>&#125;<br></code></pre></div></td></tr></table></figure><p>我们看到 main 函数是入口函数，但是我们知道 Go 的执行过程是如下图所示的方式：</p><p><img src="image-20210829153057181.png"></p><p>这里我们就看到了我们引入了一个包 <code>_ &quot;quickstart/routers&quot;</code>,这个包只引入执行了里面的 init 函数，那么让我们看看这个里面做了什么事情：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> routers<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;quickstart/controllers&quot;</span><br>    beego <span class="hljs-string">&quot;github.com/beego/beego/v2/server/web&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;<br>    beego.Router(<span class="hljs-string">&quot;/&quot;</span>, &amp;controllers.MainController&#123;&#125;)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>路由包里面我们看到执行了路由注册 <code>web.Router</code>, 这个函数的功能是映射 URL 到 controller，第一个参数是 URL (用户请求的地址)，这里我们注册的是 <code>/</code>，也就是我们访问的不带任何参数的 URL，第二个参数是对应的 Controller，也就是我们即将把请求分发到那个控制器来执行相应的逻辑，我们可以执行类似的方式注册如下路由：</p><figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">bee</span><span class="hljs-selector-class">.Router</span>(<span class="hljs-string">&quot;/user&quot;</span>, &amp;controllers.UserController&#123;&#125;)<br></code></pre></div></td></tr></table></figure><p>这样用户就可以通过访问 <code>/user</code> 去执行 <code>UserController</code> 的逻辑。这就是我们所谓的路由，更多更复杂的路由规则请查询 <a href="https://beego.me/docs/mvc/controller/router.md">web 的路由设置</a></p><p>再回来看看 main 函数里面的 <code>web.Run</code>， <code>web.Run</code> 执行之后，我们看到的效果好像只是监听服务端口这个过程，但是它内部做了很多事情：</p><ul><li><p>解析配置文件</p><p>beego 会自动解析在 conf 目录下面的配置文件 <code>app.conf</code>，通过修改配置文件相关的属性，我们可以定义：开启的端口，是否开启 session，应用名称等信息。</p></li><li><p>执行用户的 hookfunc</p><p>beego 会执行用户注册的 hookfunc，默认的已经存在了注册 mime，用户可以通过函数 <code>AddAPPStartHook</code> 注册自己的启动函数。</p></li><li><p>是否开启 session</p><p>会根据上面配置文件的分析之后判断是否开启 session，如果开启的话就初始化全局的 session。</p></li><li><p>是否编译模板</p><p>beego 会在启动的时候根据配置把 views 目录下的所有模板进行预编译，然后存在 map 里面，这样可以有效的提高模板运行的效率，无需进行多次编译。</p></li><li><p>是否开启文档功能</p><p>根据 EnableDocs 配置判断是否开启内置的文档路由功能</p></li><li><p>是否启动管理模块</p><p>beego 目前做了一个很酷的模块，应用内<a href="https://beego.me/docs/advantage/monitor.md">监控模块</a>，会在 8088 端口做一个内部监听，我们可以通过这个端口查询到 QPS、CPU、内存、GC、goroutine、thread 等统计信息。</p></li><li><p>监听服务端口</p><p>这是最后一步也就是我们看到的访问 8080 看到的网页端口，内部其实调用了 <code>ListenAndServe</code>，充分利用了 goroutine 的优势</p></li></ul><p>一旦 run 起来之后，我们的服务就监听在两个端口了，一个服务端口 8080 作为对外服务，另一个 8088 端口实行对内监控。</p><p>通过这个代码的分析我们了解了 beego 运行起来的过程，以及内部的一些机制。接下来让我们去剥离 Controller 如何来处理逻辑的。</p><h1 id="controller-逻辑"><a href="#controller-逻辑" class="headerlink" title="controller 逻辑"></a>controller 逻辑</h1><p>前面我们了解了如何把用户的请求分发到控制器，这小节我们就介绍大家如何来写控制器，首先我们还是从源码分析入手：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> controllers<br><br><span class="hljs-keyword">import</span> (<br>        beego <span class="hljs-string">&quot;github.com/beego/beego/v2/server/web&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> MainController <span class="hljs-keyword">struct</span> &#123;<br>        beego.Controller<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(this *MainController)</span> <span class="hljs-title">Get</span><span class="hljs-params">()</span></span> &#123;<br>        this.Data[<span class="hljs-string">&quot;Website&quot;</span>] = <span class="hljs-string">&quot;beego.me&quot;</span><br>        this.Data[<span class="hljs-string">&quot;Email&quot;</span>] = <span class="hljs-string">&quot;astaxie@gmail.com&quot;</span><br>        this.TplName = <span class="hljs-string">&quot;index.tpl&quot;</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>上面的代码显示首先我们声明了一个控制器 <code>MainController</code>，这个控制器里面组合了 <code>web.Controller</code>，这就是 Go 的组合方式，也就是 <code>MainController</code> 自动拥有了所有 <code>web.Controller</code> 的方法。</p><p>而 <code>web.Controller</code> 拥有很多方法，其中包括 <code>Init</code>、<code>Prepare</code>、<code>Post</code>、<code>Get</code>、<code>Delete</code>、<code>Head</code> 等方法。我们可以通过重写的方式来实现这些方法，而我们上面的代码就是重写了 <code>Get</code> 方法。</p><p>我们先前介绍过 beego 是一个 RESTful 的框架，所以我们的请求默认是执行对应 <code>req.Method</code> 的方法。例如浏览器的是 <code>GET</code> 请求，那么默认就会执行 <code>MainController</code> 下的 <code>Get</code> 方法。这样我们上面的 Get 方法就会被执行到，这样就进入了我们的逻辑处理。（用户可以改变这个行为，通过注册自定义的函数名，更加详细的请参考<a href="https://beego.me/docs/mvc/controller/router.md#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95%E5%8F%8A-restful-%E8%A7%84%E5%88%99">路由设置</a>）</p><p>里面的代码是需要执行的逻辑，这里只是简单的输出数据，我们可以通过各种方式获取数据，然后赋值到 <code>this.Data</code> 中，这是一个用来存储输出数据的 map，可以赋值任意类型的值，这里我们只是简单举例输出两个字符串。</p><p>最后一个就是需要去渲染的模板，<code>this.TplName</code> 就是需要渲染的模板，这里指定了 <code>index.tpl</code>，如果用户不设置该参数，那么默认会去到模板目录的 <code>Controller/&lt;方法名&gt;.tpl</code> 查找，例如上面的方法会去 <code>maincontroller/get.tpl</code> ***(文件、文件夹必须小写)***。</p><p>用户设置了模板之后系统会自动的调用 <code>Render</code> 函数（这个函数是在 <code>web.Controller</code> 中实现的），所以无需用户自己来调用渲染。</p><p>当然也可以不使用模版，直接用 <code>this.Ctx.WriteString</code> 输出字符串，如：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">func (<span class="hljs-built_in">this</span> *MainController) <span class="hljs-function"><span class="hljs-title">Get</span>(<span class="hljs-params"></span>)</span> &#123;<br>        <span class="hljs-built_in">this</span>.Ctx.WriteString(<span class="hljs-string">&quot;hello&quot;</span>)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>至此我们的控制器分析基本完成了，接下来让我们看看如何来编写 model。</p><p>我们知道 Web 应用中我们用的最多的就是数据库操作，而 model 层一般用来做这些操作，我们的 <code>bee new</code> 例子不存在 Model 的演示，但是 <code>bee api</code> 应用中存在 model 的应用。说的简单一点，如果您的应用足够简单，那么 Controller 可以处理一切的逻辑，如果您的逻辑里面存在着可以复用的东西，那么就抽取出来变成一个模块。因此 Model 就是逐步抽象的过程，一般我们会在 Model 里面处理一些数据读取，如下是一个日志分析应用中的代码片段：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> models<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;path/filepath&quot;</span><br>    <span class="hljs-string">&quot;strings&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> (<br>    NotPV []<span class="hljs-keyword">string</span> = []<span class="hljs-keyword">string</span>&#123;<span class="hljs-string">&quot;css&quot;</span>, <span class="hljs-string">&quot;js&quot;</span>, <span class="hljs-string">&quot;class&quot;</span>, <span class="hljs-string">&quot;gif&quot;</span>, <span class="hljs-string">&quot;jpg&quot;</span>, <span class="hljs-string">&quot;jpeg&quot;</span>, <span class="hljs-string">&quot;png&quot;</span>, <span class="hljs-string">&quot;bmp&quot;</span>, <span class="hljs-string">&quot;ico&quot;</span>, <span class="hljs-string">&quot;rss&quot;</span>, <span class="hljs-string">&quot;xml&quot;</span>, <span class="hljs-string">&quot;swf&quot;</span>&#125;<br>)<br><br><span class="hljs-keyword">const</span> big = <span class="hljs-number">0xFFFFFF</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LogPV</span><span class="hljs-params">(urls <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">bool</span></span> &#123;<br>    ext := filepath.Ext(urls)<br>    <span class="hljs-keyword">if</span> ext == <span class="hljs-string">&quot;&quot;</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>    &#125;<br>    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> NotPV &#123;<br>        <span class="hljs-keyword">if</span> v == strings.ToLower(ext) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>所以如果您的应用足够简单，那么就不需要 Model 了；如果你的模块开始多了，需要复用，需要逻辑分离了，那么 Model 是必不可少的。接下来我们将分析如何编写 View 层的东西。</p><h1 id="View-编写"><a href="#View-编写" class="headerlink" title="View 编写"></a>View 编写</h1><p>在前面编写 Controller 的时候，我们在 Get 里面写过这样的语句 <code>this.TplName = &quot;index.tpl&quot;</code>，设置显示的模板文件，默认支持 <code>tpl</code> 和 <code>html</code> 的后缀名，如果想设置其他后缀你可以调用 <code>beego.AddTemplateExt</code> 接口设置，那么模板如何来显示相应的数据呢？beego 采用了 Go 语言默认的模板引擎，所以和 Go 的模板语法一样，Go 模板的详细使用方法请参考<a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/07.4.md">《Go Web 编程》模板使用指南</a></p><p>我们看看快速入门里面的代码（去掉了 css 样式）：</p><figure class="highlight handlebars"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs handlebars"><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span></span><br><span class="xml"></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Beego<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html; charset=utf-8&quot;</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;hero-unit&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background-color:#A9F16C&quot;</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;hero-text&quot;</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome to Beego!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;description&quot;</span>&gt;</span></span><br><span class="xml">                            Beego is a simple &amp; powerful Go web framework which is inspired by tornado and sinatra.</span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br><span class="xml">                            Official website: <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://</span></span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">.Website</span>&#125;&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">.Website</span>&#125;&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br><span class="xml">                            Contact me: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">.Email</span>&#125;&#125;</span><span class="xml"></span><br><span class="xml">                        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></code></pre></div></td></tr></table></figure><p>我们在 Controller 里面把数据赋值给了 data（map 类型），然后我们在模板中就直接通过 key 访问 <code>.Website</code> 和 <code>.Email</code> 。这样就做到了数据的输出。接下来我们讲解如何让静态文件输出。</p><h1 id="静态文件处理"><a href="#静态文件处理" class="headerlink" title="静态文件处理"></a>静态文件处理</h1><p>前面我们介绍了如何输出静态页面，但是我们的网页往往包含了很多的静态文件，包括图片、JS、CSS 等，刚才创建的应用里面就创建了如下目录：</p><figure class="highlight actionscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs actionscript">├── <span class="hljs-keyword">static</span><br>    │   ├── css<br>    │   ├── img<br>    │   └── js<br></code></pre></div></td></tr></table></figure><p>beego 默认注册了 static 目录为静态处理的目录，注册样式：URL 前缀和映射的目录（在<code>/main.go</code>文件中<code>web.Run()</code>之前加入）：</p><figure class="highlight prolog"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs prolog"><span class="hljs-symbol">StaticDir</span>[<span class="hljs-string">&quot;/static&quot;</span>] = <span class="hljs-string">&quot;static&quot;</span><br></code></pre></div></td></tr></table></figure><p>用户可以设置多个静态文件处理目录，例如你有多个文件下载目录 download1、download2，你可以这样映射（在 <code>/main.go</code> 文件中 <code>beego.Run()</code> 之前加入）：</p><figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">beego</span><span class="hljs-selector-class">.SetStaticPath</span>(<span class="hljs-string">&quot;/down1&quot;</span>, <span class="hljs-string">&quot;download1&quot;</span>)<br><span class="hljs-selector-tag">beego</span><span class="hljs-selector-class">.SetStaticPath</span>(<span class="hljs-string">&quot;/down2&quot;</span>, <span class="hljs-string">&quot;download2&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>这样用户访问 URL <code>http://localhost:8080/down1/123.txt</code> 则会请求 download1 目录下的 123.txt 文件。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Beego</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>beego</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>搞定Go语言流程控制</title>
    <link href="/2021/08/29/%E6%90%9E%E5%AE%9AGo%E8%AF%AD%E8%A8%80%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/"/>
    <url>/2021/08/29/%E6%90%9E%E5%AE%9AGo%E8%AF%AD%E8%A8%80%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h1><h2 id="流程控制：if-else"><a href="#流程控制：if-else" class="headerlink" title="流程控制：if-else"></a>流程控制：if-else</h2><h3 id="条件语句模型"><a href="#条件语句模型" class="headerlink" title="条件语句模型"></a>条件语句模型</h3><p>Go里的流程控制方法还是挺丰富，整理了下有如下这么多种：</p><ul><li>if - else 条件语句</li><li>switch - case 选择语句</li><li>for - range 循环语句</li><li>goto 无条件跳转语句</li><li>defer 延迟执行</li></ul><p>先看if-else语句：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">if</span> 条件 <span class="hljs-number">1</span> &#123;<br>  分支 <span class="hljs-number">1</span><br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> 条件 <span class="hljs-number">2</span> &#123;<br>  分支 <span class="hljs-number">2</span><br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> 条件 ... &#123;<br>  分支 ...<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  分支 <span class="hljs-keyword">else</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>Go编译器，对于 <code>&#123;</code> 和 <code>&#125;</code> 的位置有严格的要求，它要求 else if （或 else）和 两边的花括号，必须在同一行。</p><p>Go是 强类型，所以要求你条件表达式必须严格返回布尔型的数据（nil 和 0 和 1 都不行。</p><h3 id="单分支判断"><a href="#单分支判断" class="headerlink" title="单分支判断"></a>单分支判断</h3><p>只有一个 if ，没有 else</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>age := <span class="hljs-number">20</span><br><span class="hljs-keyword">if</span> age &gt; <span class="hljs-number">18</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;你已经是个大孩子了&quot;</span>)<br>&#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>如果条件里需要满足多个条件，可以使用 <code>&amp;&amp;</code> 和 <code>||</code></p><ul><li><code>&amp;&amp;</code>：表示且，左右都需要为true，最终结果才能为 true，否则为 false</li><li><code>||</code>：表示或，左右只要有一个为true，最终结果即为true，否则 为 false</li></ul><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>age := <span class="hljs-number">20</span><br>gender := <span class="hljs-string">&quot;male&quot;</span><br><span class="hljs-keyword">if</span> age &gt; <span class="hljs-number">18</span> &amp;&amp; gender == <span class="hljs-string">&quot;male&quot;</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;你已经是个大男孩子了&quot;</span>)<br>&#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="多分支判断"><a href="#多分支判断" class="headerlink" title="多分支判断"></a>多分支判断</h3><p>if - else</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    age := <span class="hljs-number">20</span><br>    <span class="hljs-keyword">if</span> age &gt; <span class="hljs-number">18</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;已经成年了&quot;</span>)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;还未成年&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>if - else if - else</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    age := <span class="hljs-number">20</span><br>    <span class="hljs-keyword">if</span> age &gt; <span class="hljs-number">18</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;已经成年了&quot;</span>)<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> age &gt;<span class="hljs-number">12</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;已经是青少年了&quot;</span>)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;还不是青少年&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="高级写法"><a href="#高级写法" class="headerlink" title="高级写法"></a>高级写法</h3><p>在 if 里可以允许先运行一个表达式，取得变量后，再对其进行判断，比如第一个例子里代码也可以写成这样</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">if</span> age := <span class="hljs-number">20</span>;age &gt; <span class="hljs-number">18</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;已经成年了&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="流程控制：switch-case"><a href="#流程控制：switch-case" class="headerlink" title="流程控制：switch-case"></a>流程控制：switch-case</h2><h3 id="语句模型"><a href="#语句模型" class="headerlink" title="语句模型"></a>语句模型</h3><p>Go 里的选择语句模型是这样的</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">switch</span> 表达式 &#123;<br>    <span class="hljs-keyword">case</span> 表达式<span class="hljs-number">1</span>:<br>        代码块<br>    <span class="hljs-keyword">case</span> 表达式<span class="hljs-number">2</span>:<br>        代码块<br>    <span class="hljs-keyword">case</span> 表达式<span class="hljs-number">3</span>:<br>        代码块<br>    <span class="hljs-keyword">case</span> 表达式<span class="hljs-number">4</span>:<br>        代码块<br>    <span class="hljs-keyword">case</span> 表达式<span class="hljs-number">5</span>:<br>        代码块<br>    <span class="hljs-keyword">default</span>:<br>        代码块<br>&#125;<br></code></pre></div></td></tr></table></figure><p>拿 switch 后的表达式分别和 case 后的表达式进行对比，只要有一个 case 满足条件，就会执行对应的代码块，然后直接退出 switch - case ，如果 一个都没有满足，才会执行 default 的代码块。</p><h3 id="最简单的示例"><a href="#最简单的示例" class="headerlink" title="最简单的示例"></a>最简单的示例</h3><p>switch 后接一个你要判断变量 <code>education</code> （学历），然后 case 会拿这个 变量去和它后面的表达式（可能是常量、变量、表达式等）进行判等。</p><p>如果相等，就执行相应的代码块。如果不相等，就接着下一个 case。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">mport <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    education := <span class="hljs-string">&quot;本科&quot;</span><br><br>    <span class="hljs-keyword">switch</span> education &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;博士&quot;</span>:<br>        fmt.Println(<span class="hljs-string">&quot;我是博士&quot;</span>)<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;研究生&quot;</span>:<br>        fmt.Println(<span class="hljs-string">&quot;我是研究生&quot;</span>)<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;本科&quot;</span>:<br>        fmt.Println(<span class="hljs-string">&quot;我是本科生&quot;</span>)<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;大专&quot;</span>:<br>        fmt.Println(<span class="hljs-string">&quot;我是大专生&quot;</span>)<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;高中&quot;</span>:<br>        fmt.Println(<span class="hljs-string">&quot;我是高中生&quot;</span>)<br>    <span class="hljs-keyword">default</span>:<br>        fmt.Println(<span class="hljs-string">&quot;学历未达标..&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">我是本科生<br></code></pre></div></td></tr></table></figure><h3 id="一个-case-多个条件"><a href="#一个-case-多个条件" class="headerlink" title="一个 case 多个条件"></a>一个 case 多个条件</h3><p>case 后可以接多个多个条件，多个条件之间是 <code>或</code> 的关系，用逗号相隔。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    month := <span class="hljs-number">2</span><br><br>    <span class="hljs-keyword">switch</span> month &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>:<br>        fmt.Println(<span class="hljs-string">&quot;春天&quot;</span>)<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>:<br>        fmt.Println(<span class="hljs-string">&quot;夏天&quot;</span>)<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>:<br>        fmt.Println(<span class="hljs-string">&quot;秋天&quot;</span>)<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>:<br>        fmt.Println(<span class="hljs-string">&quot;冬天&quot;</span>)<br>    <span class="hljs-keyword">default</span>:<br>        fmt.Println(<span class="hljs-string">&quot;输入有误...&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">冬天<br></code></pre></div></td></tr></table></figure><h3 id="case-条件常量不能重复"><a href="#case-条件常量不能重复" class="headerlink" title="case 条件常量不能重复"></a>case 条件常量不能重复</h3><p>当 case 后接的是常量时，该常量只能出现一次。</p><p>以下两种情况，在编译时，都会报错： duplicate case “male” in switch</p><p><strong>错误案例一</strong></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">gender := <span class="hljs-string">&quot;male&quot;</span><br><br><span class="hljs-keyword">switch</span> gender &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;male&quot;</span>:<br>        fmt.Println(<span class="hljs-string">&quot;男性&quot;</span>)<br>    <span class="hljs-comment">// 与上面重复</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;male&quot;</span>:<br>        fmt.Println(<span class="hljs-string">&quot;男性&quot;</span>)<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;female&quot;</span>:<br>        fmt.Println(<span class="hljs-string">&quot;女性&quot;</span>)<br>&#125;<br></code></pre></div></td></tr></table></figure><p><strong>错误案例二</strong></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">gender := <span class="hljs-string">&quot;male&quot;</span><br><br><span class="hljs-keyword">switch</span> gender &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;male&quot;</span>, <span class="hljs-string">&quot;male&quot;</span>:<br>        fmt.Println(<span class="hljs-string">&quot;男性&quot;</span>)<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;female&quot;</span>:<br>        fmt.Println(<span class="hljs-string">&quot;女性&quot;</span>)<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="switch-后可接函数"><a href="#switch-后可接函数" class="headerlink" title="switch 后可接函数"></a>switch 后可接函数</h3><p>switch 后面可以接一个函数，只要保证 case 后的值类型与函数的返回值 一致即可。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-comment">// 判断一个同学是否有挂科记录的函数</span><br><span class="hljs-comment">// 返回值是布尔类型</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getResult</span><span class="hljs-params">(args ...<span class="hljs-keyword">int</span>)</span> <span class="hljs-title">bool</span></span> &#123;<br>    <span class="hljs-keyword">for</span> _, i := <span class="hljs-keyword">range</span> args &#123;<br>        <span class="hljs-keyword">if</span> i &lt; <span class="hljs-number">60</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    chinese := <span class="hljs-number">80</span><br>    english := <span class="hljs-number">50</span><br>    math := <span class="hljs-number">100</span><br><br>    <span class="hljs-keyword">switch</span> getResult(chinese, english, math) &#123;<br>    <span class="hljs-comment">// case 后也必须 是布尔类型</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-literal">true</span>:<br>        fmt.Println(<span class="hljs-string">&quot;该同学所有成绩都合格&quot;</span>)<br>    <span class="hljs-keyword">case</span> <span class="hljs-literal">false</span>:<br>        fmt.Println(<span class="hljs-string">&quot;该同学有挂科记录&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="switch-可不接表达式"><a href="#switch-可不接表达式" class="headerlink" title="switch 可不接表达式"></a>switch 可不接表达式</h3><p>switch 后可以不接任何变量、表达式、函数。</p><p>当不接任何东西时，switch - case 就相当于 if - elseif - else</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">score := <span class="hljs-number">30</span><br><br><span class="hljs-keyword">switch</span> &#123;<br>    <span class="hljs-keyword">case</span> score &gt;= <span class="hljs-number">95</span> &amp;&amp; score &lt;= <span class="hljs-number">100</span>:<br>        fmt.Println(<span class="hljs-string">&quot;优秀&quot;</span>)<br>    <span class="hljs-keyword">case</span> score &gt;= <span class="hljs-number">80</span>:<br>        fmt.Println(<span class="hljs-string">&quot;良好&quot;</span>)<br>    <span class="hljs-keyword">case</span> score &gt;= <span class="hljs-number">60</span>:<br>        fmt.Println(<span class="hljs-string">&quot;合格&quot;</span>)<br>    <span class="hljs-keyword">case</span> score &gt;= <span class="hljs-number">0</span>:<br>        fmt.Println(<span class="hljs-string">&quot;不合格&quot;</span>)<br>    <span class="hljs-keyword">default</span>:<br>        fmt.Println(<span class="hljs-string">&quot;输入有误...&quot;</span>)<br></code></pre></div></td></tr></table></figure><h3 id="switch-的穿透能力"><a href="#switch-的穿透能力" class="headerlink" title="switch 的穿透能力"></a>switch 的穿透能力</h3><p>正常情况下 switch - case 的执行顺序是：只要有一个 case 满足条件，就会直接退出 switch - case ，如果 一个都没有满足，才会执行 default 的代码块。</p><p>但是有一种情况是例外。</p><p>那就是当 case 使用关键字 <code>fallthrough</code> 开启穿透能力的时候。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">s := <span class="hljs-string">&quot;hello&quot;</span><br><span class="hljs-keyword">switch</span> &#123;<br><span class="hljs-keyword">case</span> s == <span class="hljs-string">&quot;hello&quot;</span>:<br>    fmt.Println(<span class="hljs-string">&quot;hello&quot;</span>)<br>    <span class="hljs-keyword">fallthrough</span><br><span class="hljs-keyword">case</span> s != <span class="hljs-string">&quot;world&quot;</span>:<br>    fmt.Println(<span class="hljs-string">&quot;world&quot;</span>)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>代码输出如下：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">hello<br>world<br></code></pre></div></td></tr></table></figure><p>需要注意的是，<code>fallthrough</code> 只能穿透一层，意思是它让你直接执行下一个case的语句，而且不需要判断条件。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">s := <span class="hljs-string">&quot;hello&quot;</span><br><span class="hljs-keyword">switch</span> &#123;<br><span class="hljs-keyword">case</span> s == <span class="hljs-string">&quot;hello&quot;</span>:<br>    fmt.Println(<span class="hljs-string">&quot;hello&quot;</span>)<br>    <span class="hljs-keyword">fallthrough</span><br><span class="hljs-keyword">case</span> s == <span class="hljs-string">&quot;xxxx&quot;</span>:<br>    fmt.Println(<span class="hljs-string">&quot;xxxx&quot;</span>)<br><span class="hljs-keyword">case</span> s != <span class="hljs-string">&quot;world&quot;</span>:<br>    fmt.Println(<span class="hljs-string">&quot;world&quot;</span>)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下，并不会输出 <code>world</code>（即使它符合条件）</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">hello<br>xxxx<br></code></pre></div></td></tr></table></figure><h2 id="流程控制：for-循环"><a href="#流程控制：for-循环" class="headerlink" title="流程控制：for 循环"></a>流程控制：for 循环</h2><h3 id="语句模型-1"><a href="#语句模型-1" class="headerlink" title="语句模型"></a>语句模型</h3><p>这是 for 循环的基本模型。</p><figure class="highlight coq"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs coq"><span class="hljs-keyword">for</span> [condition |  <span class="hljs-type">( init</span>; condition; increment ) | <span class="hljs-type">Range</span>]<br>&#123;<br>   statement(s);<br>&#125;<br></code></pre></div></td></tr></table></figure><p>可以看到 for 后面，可以接三种类型的表达式。</p><ol><li>接一个条件表达式</li><li>接三个表达式</li><li>接一个 range 表达式</li></ol><p>但其实还有第四种</p><ol><li>不接表达式</li></ol><h3 id="接一个条件表达式"><a href="#接一个条件表达式" class="headerlink" title="接一个条件表达式"></a>接一个条件表达式</h3><p>打印 1 到 5 的数值。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">a := <span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> a &lt;= <span class="hljs-number">5</span> &#123;<br>    fmt.Println(a)<br>    a ++<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下:</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">3</span><br><span class="hljs-number">4</span><br><span class="hljs-number">5</span><br></code></pre></div></td></tr></table></figure><h3 id="接三个表达式"><a href="#接三个表达式" class="headerlink" title="接三个表达式"></a>接三个表达式</h3><p>for 后面，紧接着三个表达式，使用 <code>;</code> 分隔。</p><p>这三个表达式，各有各的用途</p><ul><li>第一个表达式：初始化控制变量，在整个循环生命周期内，只运行一次；</li><li>第二个表达式：设置循环控制条件，当返回true，继续循环，返回false，结束循环；</li><li>第三个表达式：每次循完开始（除第一次）时，给控制变量增量或减量。</li></ul><p>这边的例子和上面的例子，是等价的。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++ &#123;<br>        fmt.Println(i)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">3</span><br><span class="hljs-number">4</span><br><span class="hljs-number">5</span><br></code></pre></div></td></tr></table></figure><h3 id="不接表达式：无限循环"><a href="#不接表达式：无限循环" class="headerlink" title="不接表达式：无限循环"></a>不接表达式：无限循环</h3><p>在 Go 语言中，没有 while 循环，如果要实现无限循环，也完全可以 for 来实现。</p><p>当你不加任何的判断条件时， 就相当于你每次的判断都为 true，程序就会一直处于运行状态，但是一般我们并不会让程序处于死循环，在满足一定的条件下，可以使用关键字 <code>break</code> 退出循环体，也可以使用 <code>continue</code> 直接跳到下一循环。</p><p>下面两种写法都是无限循环的写法。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">for</span> &#123;<br>    代码块<br>&#125;<br><br><span class="hljs-comment">// 等价于</span><br><span class="hljs-keyword">for</span> ;; &#123;<br>    代码块<br>&#125;<br></code></pre></div></td></tr></table></figure><p>举个例子</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> i <span class="hljs-keyword">int</span> = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> &#123;<br>        <span class="hljs-keyword">if</span> i &gt; <span class="hljs-number">5</span> &#123;<br>            <span class="hljs-keyword">break</span><br>        &#125;<br>        fmt.Printf(<span class="hljs-string">&quot;hello, %d\n&quot;</span>, i)<br>        i++<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">hello, <span class="hljs-number">1</span><br>hello, <span class="hljs-number">2</span><br>hello, <span class="hljs-number">3</span><br>hello, <span class="hljs-number">4</span><br>hello, <span class="hljs-number">5</span><br></code></pre></div></td></tr></table></figure><h3 id="接-for-range-语句"><a href="#接-for-range-语句" class="headerlink" title="接 for-range 语句"></a>接 for-range 语句</h3><p>遍历一个可迭代对象，是一个很常用的操作。在 Go 可以使用 for-range 的方式来实现。</p><p>range 后可接数组、切片，字符串等</p><p>由于 range 会返回两个值：索引和数据，若你后面的代码用不到索引，需要使用 <code>_</code> 表示 。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    myarr := [...]<span class="hljs-keyword">string</span>&#123;<span class="hljs-string">&quot;world&quot;</span>, <span class="hljs-string">&quot;python&quot;</span>, <span class="hljs-string">&quot;go&quot;</span>&#125;<br>    <span class="hljs-keyword">for</span> _, item := <span class="hljs-keyword">range</span> myarr &#123;<br>        fmt.Printf(<span class="hljs-string">&quot;hello, %s\n&quot;</span>, item)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight autohotkey"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs autohotkey"><span class="hljs-built_in">hello,</span> world<br><span class="hljs-built_in">hello,</span> python<br><span class="hljs-built_in">hello,</span> go<br></code></pre></div></td></tr></table></figure><p>如果你用一个变量来接收的话，接收到的是索引</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    myarr := [...]<span class="hljs-keyword">string</span>&#123;<span class="hljs-string">&quot;world&quot;</span>, <span class="hljs-string">&quot;python&quot;</span>, <span class="hljs-string">&quot;go&quot;</span>&#125;<br>    <span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> myarr &#123;<br>        fmt.Printf(<span class="hljs-string">&quot;hello, %v\n&quot;</span>, i)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">hello</span>, <span class="hljs-number">0</span><br><span class="hljs-attribute">hello</span>, <span class="hljs-number">1</span><br><span class="hljs-attribute">hello</span>, <span class="hljs-number">2</span><br></code></pre></div></td></tr></table></figure><h2 id="流程控制：goto-无条件跳转"><a href="#流程控制：goto-无条件跳转" class="headerlink" title="流程控制：goto 无条件跳转"></a>流程控制：goto 无条件跳转</h2><h3 id="基本模型"><a href="#基本模型" class="headerlink" title="基本模型"></a>基本模型</h3><p><code>goto</code> 顾言思义，是跳转的意思。</p><p>goto 后接一个标签，这个标签的意义是告诉 Go程序下一步要执行哪里的代码。</p><p>所以这个标签如何放置，放置在哪里，是 goto 里最需要注意的。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">goto</span> 标签;<br>...<br>...<br>标签: 表达式;<br></code></pre></div></td></tr></table></figure><h3 id="最简单的示例-1"><a href="#最简单的示例-1" class="headerlink" title="最简单的示例"></a>最简单的示例</h3><p><code>goto</code> 可以打破原有代码执行顺序，直接跳转到某一行执行代码。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><br>    <span class="hljs-keyword">goto</span> flag<br>    fmt.Println(<span class="hljs-string">&quot;B&quot;</span>)<br>flag:<br>    fmt.Println(<span class="hljs-string">&quot;A&quot;</span>)<br><br>&#125;<br></code></pre></div></td></tr></table></figure><p>执行结果，并不会输出 B ，而只会输出 A</p><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">A</span><br></code></pre></div></td></tr></table></figure><h3 id="如何使用？"><a href="#如何使用？" class="headerlink" title="如何使用？"></a>如何使用？</h3><p><code>goto</code> 语句通常与条件语句配合使用。可用来实现条件转移， 构成循环，跳出循环体等功能。</p><p>这边举一个例子，用 <code>goto</code> 的方式来实现一个打印 1到5 的循环。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    i := <span class="hljs-number">1</span><br>flag:<br>    <span class="hljs-keyword">if</span> i &lt;= <span class="hljs-number">5</span> &#123;<br>        fmt.Println(i)<br>        i++<br>        <span class="hljs-keyword">goto</span> flag<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs">1<br>2<br>3<br>4<br>5<br></code></pre></div></td></tr></table></figure><p>再举个例子，使用 goto 实现 类型 break 的效果。</p><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css">import &quot;fmt&quot;<br><br>func <span class="hljs-selector-tag">main</span>() &#123;<br>    <span class="hljs-selector-tag">i</span> := <span class="hljs-number">1</span><br>    for &#123;<br>        if i &gt; <span class="hljs-number">5</span> &#123;<br>            goto flag<br>        &#125;<br>        fmt<span class="hljs-selector-class">.Println</span>(<span class="hljs-selector-tag">i</span>)<br>        <span class="hljs-selector-tag">i</span>++<br>    &#125;<br>flag:<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs">1<br>2<br>3<br>4<br>5<br></code></pre></div></td></tr></table></figure><p>最后再举个例子，使用 goto 实现 类型 continue的效果，打印 1到10 的所有偶数。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    i := <span class="hljs-number">1</span><br>flag:<br>    <span class="hljs-keyword">for</span> i &lt;= <span class="hljs-number">10</span> &#123;<br>        <span class="hljs-keyword">if</span> i%<span class="hljs-number">2</span> == <span class="hljs-number">1</span> &#123;<br>            i++<br>            <span class="hljs-keyword">goto</span> flag<br>        &#125;<br>        fmt.Println(i)<br>        i++<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs">2<br>4<br>6<br>8<br>10<br></code></pre></div></td></tr></table></figure><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>goto语句与标签之间不能有变量声明，否则编译错误。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    fmt.Println(<span class="hljs-string">&quot;start&quot;</span>)<br>    <span class="hljs-keyword">goto</span> flag<br>    <span class="hljs-keyword">var</span> say = <span class="hljs-string">&quot;hello oldboy&quot;</span><br>    fmt.Println(say)<br>flag:<br>    fmt.Println(<span class="hljs-string">&quot;end&quot;</span>)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>编译错误</p><figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus">.\<span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.go</span>:<span class="hljs-number">7</span>:<span class="hljs-number">7</span>: goto flag jumps over declaration of say at .\<span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.go</span>:<span class="hljs-number">8</span>:<span class="hljs-number">6</span><br></code></pre></div></td></tr></table></figure><h2 id="流程控制：defer-延迟语句"><a href="#流程控制：defer-延迟语句" class="headerlink" title="流程控制：defer 延迟语句"></a>流程控制：defer 延迟语句</h2><h3 id="延迟调用"><a href="#延迟调用" class="headerlink" title="延迟调用"></a>延迟调用</h3><p>defer 的用法很简单，只要在后面跟一个函数的调用，就能实现将这个 <code>xxx</code> 函数的调用延迟到当前函数执行完后再执行。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">defer</span> xxx()<br></code></pre></div></td></tr></table></figure><p>这是一个很简单的例子，可以很快帮助你理解 defer 的使用效果。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">myfunc</span><span class="hljs-params">()</span></span> &#123;<br>    fmt.Println(<span class="hljs-string">&quot;B&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">defer</span> myfunc()<br>    fmt.Println(<span class="hljs-string">&quot;A&quot;</span>)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">A<br>B<br></code></pre></div></td></tr></table></figure><p>当然了，对于上面这个例子可以简写为成如下，输出结果是一致的</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">defer</span> fmt.Println(<span class="hljs-string">&quot;B&quot;</span>)<br>    fmt.Println(<span class="hljs-string">&quot;A&quot;</span>)<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="即时求值的变量快照"><a href="#即时求值的变量快照" class="headerlink" title="即时求值的变量快照"></a>即时求值的变量快照</h3><p>使用 defer 只是延时调用函数，此时传递给函数里的变量，不应该受到后续程序的影响。</p><p>比如这边的例子</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    name := <span class="hljs-string">&quot;go&quot;</span><br>    <span class="hljs-keyword">defer</span> fmt.Println(name) <span class="hljs-comment">// 输出: go</span><br><br>    name = <span class="hljs-string">&quot;python&quot;</span><br>    fmt.Println(name)      <span class="hljs-comment">// 输出: python</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下，可见给 name 重新赋值为 <code>python</code>，后续调用 defer 的时候，仍然使用未重新赋值的变量值，就好在 defer 这里，给所有的这是做了一个快照一样。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">python<br><span class="hljs-keyword">go</span><br></code></pre></div></td></tr></table></figure><p>如果 defer 后面跟的是匿名函数，情况会有所不同， defer 会取到最后的变量值</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    name := <span class="hljs-string">&quot;go&quot;</span><br>    <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>&#123;<br>    fmt.Println(name) <span class="hljs-comment">// 输出: python</span><br>&#125;()<br>    name = <span class="hljs-string">&quot;python&quot;</span><br>    fmt.Println(name)      <span class="hljs-comment">// 输出: python</span><br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="多个defer-反序调用"><a href="#多个defer-反序调用" class="headerlink" title="多个defer 反序调用"></a>多个defer 反序调用</h3><p>当我们在一个函数里使用了 多个defer，那么这些defer 的执行函数是如何的呢？</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br><br>   <span class="hljs-keyword">defer</span> b()<br>   fmt.Println(<span class="hljs-string">&quot;function main&quot;</span>)<br>   <span class="hljs-keyword">defer</span> a()<br>   <span class="hljs-keyword">defer</span> c()<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">a</span><span class="hljs-params">()</span></span>&#123;<br>   fmt.Println(<span class="hljs-string">&quot;function a&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">b</span><span class="hljs-params">()</span></span>&#123;<br>   fmt.Println(<span class="hljs-string">&quot;function b&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">c</span><span class="hljs-params">()</span></span>&#123;<br>   fmt.Println(<span class="hljs-string">&quot;function c&quot;</span>)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下，可见 多个defer 是反序调用的，有点类似栈一样，后进先出。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">function main<br>function c<br>function a<br>function b<br></code></pre></div></td></tr></table></figure><h3 id="defer-与-return-孰先孰后"><a href="#defer-与-return-孰先孰后" class="headerlink" title="defer 与 return 孰先孰后"></a>defer 与 return 孰先孰后</h3><p>defer 和 return 到底是哪个先调用？</p><p>使用下面这段代码，可以很容易的观察出来</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">var</span> name <span class="hljs-keyword">string</span> = <span class="hljs-string">&quot;go&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">myfunc</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<br>    <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>        name = <span class="hljs-string">&quot;python&quot;</span><br>    &#125;()<br><br>    fmt.Printf(<span class="hljs-string">&quot;myfunc 函数里的name：%s\n&quot;</span>, name)<br>    <span class="hljs-keyword">return</span> name<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    myname := myfunc()<br>    fmt.Printf(<span class="hljs-string">&quot;main 函数里的name: %s\n&quot;</span>, name)<br>    fmt.Println(<span class="hljs-string">&quot;main 函数里的myname: &quot;</span>, myname)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">myfunc 函数里的name：<span class="hljs-keyword">go</span><br>main 函数里的name: python<br>main 函数里的myname:  <span class="hljs-keyword">go</span><br></code></pre></div></td></tr></table></figure><p>来一起理解一下这段代码，第一行很直观，name 此时还是全局变量，值还是go</p><p>第二行也不难理解，在 defer 里改变了这个全局变量，此时name的值已经变成了 python</p><p>重点在第三行，为什么输出的是 go ？</p><p>解释只有一个，那就是 defer 是return 后才调用的。所以在执行 defer 前，<code>myname</code> 已经被赋值成 go 了。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>搞定go语言数据类型</title>
    <link href="/2021/08/28/go%E8%AF%AD%E8%A8%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
    <url>/2021/08/28/go%E8%AF%AD%E8%A8%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><p>先上图：</p><p><img src="image-20210828185246317.png"></p><h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><h2 id="格式化输出"><a href="#格式化输出" class="headerlink" title="格式化输出"></a>格式化输出</h2><p>通用：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">%v值的默认格式表示<br>%+v类似%v，但输出结构体是会增加字段名<br>%#v值的Go语法表示<br>%T值的类型的Go语法表示<br>%%百分号<br></code></pre></div></td></tr></table></figure><p>布尔值：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">%t单词<span class="hljs-literal">true</span>或<span class="hljs-literal">false</span><br></code></pre></div></td></tr></table></figure><p>进制数：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">%b表示为二进制<br>%c该值对应的unicode码值<br>%d表示为十进制<br>%o表示为八进制<br>%q该值对应单引号括起来的<span class="hljs-keyword">go</span>语法字符字面值，必要时会采用安全的转义表示<br>%x表示为十六进制，使用a-f<br>%X 表示为十六进制，使用A-F<br>%U表示为Unicode格式：U+<span class="hljs-number">1234</span>，等价于<span class="hljs-string">&quot;U+%04X&quot;</span><br></code></pre></div></td></tr></table></figure><p>浮点数与复数的两个组分：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">%b无小数部分、二进制指数的科学计数法<br>%e科学计数法，如<span class="hljs-number">-1234.456e+78</span><br>%E科学计数法，如<span class="hljs-number">-1234.456E+78</span><br>%f有小数部分但无指数部分，如<span class="hljs-number">123.456</span><br>%F等价于%f<br></code></pre></div></td></tr></table></figure><h2 id="变量定义和使用"><a href="#变量定义和使用" class="headerlink" title="变量定义和使用"></a>变量定义和使用</h2><p><strong>第一种</strong> ：一行声明一个变量</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> &lt;name&gt; &lt;<span class="hljs-keyword">type</span>&gt;<br></code></pre></div></td></tr></table></figure><p>其中 var 是关键字（固定不变），name 是变量名，type 是类型。</p><p>使用 var ，虽然只指定了类型，但是 Go 会对其进行隐式初始化，比如 string 类型就初始化为空字符串，int 类型就初始化为0，float 就初始化为 0.0，bool类型就初始化为false，指针类型就初始化为 nil。</p><p>也可以在声明时顺便赋值。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> name <span class="hljs-keyword">string</span> = <span class="hljs-string">&quot;I lovw the world&quot;</span><br></code></pre></div></td></tr></table></figure><p><strong>第二种</strong>：多个变量一起声明</p><p>声明多个变量，除了可以按照上面写成多行之外，还可以写成下面这样</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> (<br>    name <span class="hljs-keyword">string</span><br>    age <span class="hljs-keyword">int</span><br>    gender <span class="hljs-keyword">string</span><br>)<br></code></pre></div></td></tr></table></figure><p><strong>第三种</strong>：声明和初始化一个变量</p><p>使用 <code>:=</code> （推导声明写法或者短类型声明法：编译器会自动根据右值类型推断出左值的对应类型。），可以声明一个变量，并对其进行（显式）初始化。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">name := <span class="hljs-string">&quot;Go编程时光&quot;</span><br><br><span class="hljs-comment">// 等价于</span><br><br><span class="hljs-keyword">var</span> name <span class="hljs-keyword">string</span> = <span class="hljs-string">&quot;hello&quot;</span><br><br><span class="hljs-comment">// 等价于</span><br><br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&quot;hello&quot;</span><br></code></pre></div></td></tr></table></figure><p>但这种方法有个限制就是，只能用于<strong>函数</strong>内部</p><p><strong>第四种</strong>：声明和初始化多个变量</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">name, age := <span class="hljs-string">&quot;wangbm&quot;</span>, <span class="hljs-number">28</span><br></code></pre></div></td></tr></table></figure><p>这种方法，也经常用于变量的交换</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> a <span class="hljs-keyword">int</span> = <span class="hljs-number">100</span><br><span class="hljs-keyword">var</span> b <span class="hljs-keyword">int</span> = <span class="hljs-number">200</span><br>b, a = a, b<br></code></pre></div></td></tr></table></figure><p><strong>第五种</strong>：new 函数声明一个指针变量</p><p>在这里要先讲一下，指针的相关内容。</p><p>变量分为两种 <code>普通变量</code> 和 <code>指针变量</code></p><p>普通变量，存放的是数据本身，而指针变量存放的是数据的地址。</p><p>如下代码，age 是一个普通变量，存放的内容是 28，而 ptr 是 存放变量age值的内存地址：<code>0xc000010098</code></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>  &#123;<br>    <span class="hljs-keyword">var</span> age <span class="hljs-keyword">int</span> = <span class="hljs-number">28</span><br>    <span class="hljs-keyword">var</span> ptr = &amp;age  <span class="hljs-comment">// &amp;后面接变量名，表示取出该变量的内存地址</span><br>    fmt.Println(<span class="hljs-string">&quot;age: &quot;</span>, age)<br>    fmt.Println(<span class="hljs-string">&quot;ptr: &quot;</span>, ptr)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">age</span>:  <span class="hljs-number">28</span><br><span class="hljs-attribute">ptr</span>:  <span class="hljs-number">0</span>xc<span class="hljs-number">000010098</span><br></code></pre></div></td></tr></table></figure><p>而这里要说的 new 函数，是 Go 里的一个内建函数。</p><p>使用表达式 new(Type) 将创建一个Type类型的匿名变量，初始化为Type类型的零值，然后返回变量地址，返回的指针类型为<code>*Type</code>。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>  &#123;<br>    ptr := <span class="hljs-built_in">new</span>(<span class="hljs-keyword">int</span>)<br>    fmt.Println(<span class="hljs-string">&quot;ptr address: &quot;</span>, ptr)<br>    fmt.Println(<span class="hljs-string">&quot;ptr value: &quot;</span>, *ptr)  <span class="hljs-comment">// * 后面接指针变量，表示从内存地址中取出值</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">ptr</span> address:  <span class="hljs-number">0</span>xc<span class="hljs-number">000010098</span><br><span class="hljs-attribute">ptr</span> value:  <span class="hljs-number">0</span><br></code></pre></div></td></tr></table></figure><p>用new创建变量和普通变量声明语句方式创建变量没有什么区别，除了不需要声明一个临时变量的名字外，我们还可以在表达式中使用new(Type)。换言之，new函数类似是一种语法糖，而不是一个新的基础概念。</p><p>如下两种写法，可以说是等价的</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// 使用 new</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newInt</span><span class="hljs-params">()</span> *<span class="hljs-title">int</span></span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">new</span>(<span class="hljs-keyword">int</span>)<br>&#125;<br><br><span class="hljs-comment">// 使用传统的方式</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newInt</span><span class="hljs-params">()</span> *<span class="hljs-title">int</span></span> &#123;<br>    <span class="hljs-keyword">var</span> dummy <span class="hljs-keyword">int</span><br>    <span class="hljs-keyword">return</span> &amp;dummy<br>&#125;<br></code></pre></div></td></tr></table></figure><p>以上不管哪种方法，变量/常量都只能声明一次，声明多次，编译就会报错。</p><p>但也有例外，这就要说到一个特殊变量：<strong>匿名变量</strong>，也称作占位符，或者空白标识符，用下划线表示。</p><p>匿名变量，优点有三：</p><ul><li>不分配内存，不占用内存空间</li><li>不需要你为命名无用的变量名而纠结</li><li>多次声明不会有任何问题</li></ul><p>通常我们用匿名接收必须接收，但是又不会用到的值。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetData</span><span class="hljs-params">()</span> <span class="hljs-params">(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>)</span></span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>, <span class="hljs-number">200</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    a, _ := GetData()<br>    _, b := GetData()<br>    fmt.Println(a, b)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>原文连接：<a href="https://golang.iswbm.com/c01/c01_02.html">1.2 五种变量创建的方法 — Go编程时光 1.0.0 documentation (iswbm.com)</a>]()</p><h1 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h1><p>定义常量：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">const</span> constantName [<span class="hljs-keyword">type</span>] = value<br></code></pre></div></td></tr></table></figure><p><code>const</code>：定义常量的关键字</p><p><code>constantName</code>：常量名称</p><p><code>type</code>：常量类型</p><p><code>value</code>：常量的值</p><h1 id="整数类型"><a href="#整数类型" class="headerlink" title="整数类型"></a>整数类型</h1><p>Go语言中，整数类型可以分成10个类型。</p><p><img src="20200120204329.png"></p><p><code>int</code> 和 <code>uint</code> 的区别就在于一个 <code>u</code>，有 <code>u</code> 说明是无符号，没有 <code>u</code> 代表有符号。</p><p><strong>解释这个符号的区别</strong></p><p>以 <code>int8</code> 和 <code>uint8</code> 举例，8 代表 8个bit，能表示的数值个数有 2^8 = 256。</p><p><code>uint8</code> 是无符号，能表示的都是正数，0-255，刚好256个数。</p><p><code>int8</code> 是有符号，既可以正数，也可以负数，那怎么办？对半分呗，-128-127，也刚好 256个数。</p><p><code>int8</code> <code>int16</code> <code>int32</code> <code>int64</code> 这几个类型的最后都有一个数值，这表明了它们能表示的数值个数是固定的。</p><p>而 int 并没有指定它的位数，说明它的大小，是可以变化的，那根据什么变化呢？</p><ul><li>当你在32位的系统下，int 和 <code>uint</code> 都占用 4个字节，也就是32位。</li><li>若你在64位的系统下，int 和 <code>uint</code> 都占用 8个字节，也就是64位。</li></ul><p>出于这个原因，在某些场景下，你应当避免使用 int 和 <code>uint</code> ，而使用更加精确的 <code>int32</code> 和 <code>int64</code>，比如在二进制传输、读写文件的结构描述（为了保持文件的结构不会受到不同编译目标平台字节长度的影响）</p><p><strong>不同进制的表示方法</strong></p><p>出于习惯，在初始化数据类型为整型的变量时，我们会使用10进制的表示法，因为它最直观，比如这样，表示整数10.</p><figure class="highlight dart"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dart"><span class="hljs-keyword">var</span> <span class="hljs-built_in">num</span> <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span><br></code></pre></div></td></tr></table></figure><p>不过，你要清楚，你一样可以使用其他进制来表示一个整数，这里以比较常用的2进制、8进制和16进制举例。</p><p>2进制：以<code>0b</code>或<code>0B</code>为前缀</p><figure class="highlight maxima"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs maxima"><span class="hljs-built_in">var</span> num01 int = <span class="hljs-number">0b1100</span><br></code></pre></div></td></tr></table></figure><p>8进制：以<code>0o</code>或者 <code>0O</code>为前缀</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">var</span> num<span class="hljs-number">02</span> int = <span class="hljs-number">0</span>o<span class="hljs-number">14</span><br></code></pre></div></td></tr></table></figure><p>16进制：以<code>0x</code> 为前缀</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">var</span> num<span class="hljs-number">03</span> int = <span class="hljs-number">0</span>xC<br></code></pre></div></td></tr></table></figure><p>下面用一段代码分别使用二进制、8进制、16进制来表示 10 进制的数值：12</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> num01 <span class="hljs-keyword">int</span> = <span class="hljs-number">0</span>b1100<br>    <span class="hljs-keyword">var</span> num02 <span class="hljs-keyword">int</span> = <span class="hljs-number">0</span>o14<br>    <span class="hljs-keyword">var</span> num03 <span class="hljs-keyword">int</span> = <span class="hljs-number">0xC</span><br><br>    fmt.Printf(<span class="hljs-string">&quot;2进制数 %b 表示的是: %d \n&quot;</span>, num01, num01)<br>    fmt.Printf(<span class="hljs-string">&quot;8进制数 %o 表示的是: %d \n&quot;</span>, num02, num02)<br>    fmt.Printf(<span class="hljs-string">&quot;16进制数 %X 表示的是: %d \n&quot;</span>, num03, num03)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-number">2</span>进制数 <span class="hljs-number">1100</span> 表示的是: <span class="hljs-number">12</span><br><span class="hljs-number">8</span>进制数 <span class="hljs-number">14</span> 表示的是: <span class="hljs-number">12</span><br><span class="hljs-number">16</span>进制数 C 表示的是: <span class="hljs-number">12</span><br></code></pre></div></td></tr></table></figure><p>以上代码用过了 <code>fmt</code> 包的格式化功能，你可以参考这里去看上面的代码</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">%b    表示为二进制<br>%c    该值对应的unicode码值<br>%d    表示为十进制<br>%o    表示为八进制<br>%q    该值对应的单引号括起来的<span class="hljs-keyword">go</span>语法字符字面值，必要时会采用安全的转义表示<br>%x    表示为十六进制，使用a-f<br>%X    表示为十六进制，使用A-F<br>%U    表示为Unicode格式：U+<span class="hljs-number">1234</span>，等价于<span class="hljs-string">&quot;U+%04X&quot;</span><br>%E    用科学计数法表示<br>%f    用浮点数表示<br></code></pre></div></td></tr></table></figure><h1 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h1><p>浮点数类型的值一般由整数部分、小数点“<code>.</code>”和小数部分组成。</p><p>其中，整数部分和小数部分均由10进制表示法表示。不过还有另一种表示方法。那就是在其中加入指数部分。指数部分由“E”或“e”以及一个带正负号的10进制数组成。比如，<code>3.7E-2</code>表示浮点数<code>0.037</code>。又比如，<code>3.7E+1</code>表示浮点数<code>37</code>。</p><p>有时候，浮点数类型值的表示也可以被简化。比如，<code>37.0</code>可以被简化为<code>37</code>。又比如，<code>0.037</code>可以被简化为<code>.037</code>。</p><p>有一点需要注意，在Go语言里，浮点数的相关部分只能由10进制表示法表示，而不能由8进制表示法或16进制表示法表示。比如，<code>03.7</code>表示的一定是浮点数<code>3.7</code>。</p><h3 id="float32-和-float64"><a href="#float32-和-float64" class="headerlink" title="float32 和 float64"></a><code>float32</code> 和 <code>float64</code></h3><p>Go语言中提供了两种精度的浮点数 <code>float32</code> 和 <code>float64</code>。</p><p>**<code>float32</code>*<em>，也即我们常说的单精度，存储占用4个字节，也即4</em>8=32位，其中1位用来符号，8位用来指数，剩下的23位表示尾数</p><p><img src="v2-749cc641eb4d5dafd085e8c23f8826aa_hd.jpg"></p><p>**<code>float64</code>*<em>，也即我们熟悉的双精度，存储占用8个字节，也即8</em>8=64位，其中1位用来符号，11位用来指数，剩下的52位表示尾数</p><p><img src="v2-48240f0e1e0dd33ec89100cbe2d30707_hd.jpg"></p><p><strong>那么精度是什么意思？有效位有多少位？</strong></p><p>精度主要取决于尾数部分的位数。</p><p>对于 <code>float32</code>（单精度）来说，表示尾数的为23位，除去全部为0的情况以外，最小为2^-23，约等于1.19*10^-7，所以float小数部分只能精确到后面6位，加上小数点前的一位，即有效数字为7位。</p><p>同理 <code>float64</code>（单精度）的尾数部分为 52位，最小为2^-52，约为2.22*10^-16，所以精确到小数点后15位，加上小数点前的一位，有效位数为16位。</p><p>通过以上，可以总结出以下几点：</p><p><strong>一、float32 和 float64 可以表示的数值很多</strong></p><p>浮点数类型的取值范围可以从很微小到很巨大。浮点数取值范围的极限值可以在 math 包中找到：</p><ul><li>常量 <code>math.MaxFloat32</code> 表示 <code>float32</code> 能取到的最大数值，大约是 <code>3.4e38</code>；</li><li>常量 <code>math.MaxFloat64</code> 表示 <code>float64</code> 能取到的最大数值，大约是 <code>1.8e308</code>；</li><li><code>float32</code> 和 <code>float64</code> 能表示的最小值分别为 <code>1.4e-45</code> 和 <code>4.9e-324</code>。</li></ul><p><strong>二、数值很大但精度有限</strong></p><p>人家虽然能表示的数值很大，但精度位却没有那么大。</p><ul><li><code>float32</code>的精度只能提供大约6个十进制数（表示后科学计数法后，小数点后6位）的精度</li><li><code>float64</code>的精度能提供大约15个十进制数（表示后科学计数法后，小数点后15位）的精度</li></ul><p>这里的精度是什么意思呢？</p><p>比如 10000018这个数，用 <code>float32</code> 的类型来表示的话，由于其有效位是7位，将10000018 表示成科学计数法，就是 1.0000018 * 10^7，能精确到小数点后面6位。</p><p>此时用科学计数法表示后，小数点后有7位，刚刚满足我们的精度要求，意思是什么呢？此时你对这个数进行+1或者-1等数学运算，都能保证计算结果是精确的</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-keyword">var</span> myfloat <span class="hljs-keyword">float32</span> = <span class="hljs-number">10000018</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>  &#123;<br>    fmt.Println(<span class="hljs-string">&quot;myfloat: &quot;</span>, myfloat)<br>    fmt.Println(<span class="hljs-string">&quot;myfloat: &quot;</span>, myfloat+<span class="hljs-number">1</span>)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">myfloat:  <span class="hljs-number">1.0000018e+07</span><br>myfloat:  <span class="hljs-number">1.0000019e+07</span><br></code></pre></div></td></tr></table></figure><h1 id="byte、rune与字符串"><a href="#byte、rune与字符串" class="headerlink" title="byte、rune与字符串"></a>byte、rune与字符串</h1><h2 id="byte与rune"><a href="#byte与rune" class="headerlink" title="byte与rune"></a>byte与rune</h2><p><strong>byte</strong>，占用1个节字，就 8 个比特位（2^8 = 256，因此 byte 的表示范围 0-&gt;255），所以它和 <code>uint8</code> 类型本质上没有区别，它表示的是 <code>ACSII</code> 表中的一个字符。</p><p>如下这段代码，分别定义了 byte 类型和 uint8 类型的变量 a 和 b</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> a <span class="hljs-keyword">byte</span> = <span class="hljs-number">65</span><br>    <span class="hljs-comment">// 8进制写法: var a byte = &#x27;\101&#x27;     其中 \ 是固定前缀</span><br>    <span class="hljs-comment">// 16进制写法: var a byte = &#x27;\x41&#x27;    其中 \x 是固定前缀</span><br><br>    <span class="hljs-keyword">var</span> b <span class="hljs-keyword">uint8</span> = <span class="hljs-number">66</span><br>    fmt.Printf(<span class="hljs-string">&quot;a 的值: %c \nb 的值: %c&quot;</span>, a, b)<br><br>    <span class="hljs-comment">// 或者使用 string 函数</span><br>    <span class="hljs-comment">// fmt.Println(&quot;a 的值: &quot;, string(a),&quot; \nb 的值: &quot;, string(b))</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>在 ASCII 表中，由于字母 A 的ASCII 的编号为 65 ，字母 B 的ASCII 编号为 66，所以上面的代码也可以写成这样：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> a <span class="hljs-keyword">byte</span> = <span class="hljs-string">&#x27;A&#x27;</span><br>    <span class="hljs-keyword">var</span> b <span class="hljs-keyword">uint8</span> = <span class="hljs-string">&#x27;B&#x27;</span><br>    fmt.Printf(<span class="hljs-string">&quot;a 的值: %c \nb 的值: %c&quot;</span>, a, b)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>他们的输出结果都是一样的。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">a 的值: A<br>b 的值: B<br></code></pre></div></td></tr></table></figure><p><strong>rune</strong>，占用4个字节，共32位比特位，所以它和 <code>int32</code> 本质上也没有区别。它表示的是一个 Unicode字符（Unicode是一个可以表示世界范围内的绝大部分字符的编码规范）。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;unsafe&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> a <span class="hljs-keyword">byte</span> = <span class="hljs-string">&#x27;A&#x27;</span><br>    <span class="hljs-keyword">var</span> b <span class="hljs-keyword">rune</span> = <span class="hljs-string">&#x27;B&#x27;</span><br>    fmt.Printf(<span class="hljs-string">&quot;a 占用 %d 个字节数\nb 占用 %d 个字节数&quot;</span>, unsafe.Sizeof(a), unsafe.Sizeof(b))<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">a</span> 占用 <span class="hljs-number">1</span> 个字节数<br><span class="hljs-attribute">b</span> 占用 <span class="hljs-number">4</span> 个字节数<br></code></pre></div></td></tr></table></figure><p>由于 byte 类型能表示的值是有限，只有 2^8=256 个。所以如果你想表示中文的话，你只能使用 rune 类型。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> name <span class="hljs-keyword">rune</span> = <span class="hljs-string">&#x27;中&#x27;</span><br></code></pre></div></td></tr></table></figure><p>或许你已经发现，上面我们在定义字符时，不管是 byte 还是 rune ，我都是使用单引号，而没使用双引号。</p><p>对于从 Python 转过来的人，这里一定要注意了，在 Go 中单引号与 双引号并不是等价的。</p><p>单引号用来表示字符，在上面的例子里，如果你使用双引号，就意味着你要定义一个字符串，赋值时与前面声明的会不一致，这样在编译的时候就会出错。</p><figure class="highlight ada"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ada">cannot <span class="hljs-keyword">use</span> <span class="hljs-string">&quot;A&quot;</span> (<span class="hljs-keyword">type</span> <span class="hljs-type">string) </span>as <span class="hljs-keyword">type</span> <span class="hljs-type">byte </span><span class="hljs-keyword">in</span> assignment<br></code></pre></div></td></tr></table></figure><p>上面我说了，<code>byte</code> 和 <code>uint8</code> 没有区别，<code>rune</code> 和 <code>uint32</code> 没有区别，那为什么还要多出一个 byte 和 rune 类型呢？</p><p>理由很简单，因为<code>uint8</code> 和 <code>uint32</code> ，直观上让人以为这是一个数值，但是实际上，它也可以表示一个字符，所以为了消除这种直观错觉，就诞生了 byte 和 rune 这两个别名类型。</p><h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p>字符串，可以说是大家很熟悉的数据类型之一。定义方法很简单</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> mystr <span class="hljs-keyword">string</span> = <span class="hljs-string">&quot;hello&quot;</span><br></code></pre></div></td></tr></table></figure><p>上面说的byte 和 rune 都是字符类型，若多个字符放在一起，就组成了字符串，也就是这里要说的 string 类型。</p><p>比如 <code>hello</code> ，对照 <code>ascii</code> 编码表，每个字母对应的编号是：104,101,108,108,111</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> str <span class="hljs-keyword">string</span> = <span class="hljs-string">&quot;hello&quot;</span><br><span class="hljs-keyword">var</span> mystr [<span class="hljs-number">5</span>]<span class="hljs-keyword">byte</span> = [<span class="hljs-number">5</span>]<span class="hljs-keyword">byte</span>&#123;<span class="hljs-number">104</span>, <span class="hljs-number">101</span>, <span class="hljs-number">108</span>, <span class="hljs-number">108</span>, <span class="hljs-number">111</span>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;str:%s\n&quot;</span>, str)<br>fmt.Printf(<span class="hljs-string">&quot;mystr:%s\n&quot;</span>, mystr)<br></code></pre></div></td></tr></table></figure><p>输出如下，<code>str</code>和 <code>mystr</code>输出一样，说明了 string 的本质，其实是一个 byte数组</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">str:hello<br>mystr:hello<br></code></pre></div></td></tr></table></figure><p>表示字符串除了双引号，也可以用反引号。</p><p>大多情况下，二者并没有区别，但如果你的字符串中有转义字符<code>\</code> ，这里就要注意了，它们是有区别的。</p><p>使用反引号包裹的字符串，相当于 Python 中的 raw 字符串，会忽略里面的转义。</p><p>比如我想表示 <code>\r\n</code> 这个 字符串，使用双引号是这样写的，这种叫解释型表示法</p><figure class="highlight lsl"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs lsl">var mystr01 <span class="hljs-type">string</span> = <span class="hljs-string">&quot;<span class="hljs-subst">\\</span>r<span class="hljs-subst">\\</span>n&quot;</span><br></code></pre></div></td></tr></table></figure><p>而使用反引号，就方便多了，所见即所得，这种叫原生型表示法</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> mystr02 <span class="hljs-keyword">string</span> = <span class="hljs-string">`\r\n`</span><br></code></pre></div></td></tr></table></figure><p>他们的打印结果 都是一样的</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> mystr01 <span class="hljs-keyword">string</span> = <span class="hljs-string">&quot;\\r\\n&quot;</span><br>    <span class="hljs-keyword">var</span> mystr02 <span class="hljs-keyword">string</span> = <span class="hljs-string">`\r\n`</span><br>    fmt.Println(mystr01)<br>    fmt.Println(mystr02)<br>&#125;<br><br><span class="hljs-comment">// output</span><br>\r\n<br>\r\n<br></code></pre></div></td></tr></table></figure><p>同时反引号可以不写换行符（因为没法写）来表示一个多行的字符串。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> hello <span class="hljs-keyword">string</span> = <span class="hljs-string">`你好呀！</span><br><span class="hljs-string">你一定可以学好golang的`</span><br>fmt.Println(hello)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">你好呀！<br>你一定可以学好golang的<br></code></pre></div></td></tr></table></figure><h1 id="数组和切片"><a href="#数组和切片" class="headerlink" title="数组和切片"></a>数组和切片</h1><h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>数组是一个由固定长度的特定类型元素组成的序列，一个数组可以由零个或多个元素组成。因为数组的长度是固定的，所以在Go语言中很少直接使用数组。</p><p>声明数组，并给该数组里的每个元素赋值（索引值的最小有效值和其他大多数语言一样是 0，不是1）</p><figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus"><span class="hljs-comment">// [3] 里的3 表示该数组的元素个数及容量</span><br><span class="hljs-selector-tag">var</span> arr <span class="hljs-selector-attr">[3]</span>int<br>arr<span class="hljs-selector-attr">[0]</span> = <span class="hljs-number">1</span><br>arr<span class="hljs-selector-attr">[1]</span> = <span class="hljs-number">2</span><br>arr<span class="hljs-selector-attr">[2]</span> = <span class="hljs-number">3</span><br></code></pre></div></td></tr></table></figure><p>声明并直接初始化数组</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// 第一种方法</span><br><span class="hljs-keyword">var</span> arr [<span class="hljs-number">3</span>]<span class="hljs-keyword">int</span> = [<span class="hljs-number">3</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;<br><br><span class="hljs-comment">// 第二种方法</span><br>arr := [<span class="hljs-number">3</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;<br></code></pre></div></td></tr></table></figure><p>上面的 3 表示数组的元素个数 ，万一你哪天想往该数组中增加元素，你得对应修改这个数字，为了避免这种硬编码，你可以这样写，使用 <code>...</code> 让Go语言自己根据实际情况来分配空间。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">arr := [...]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;<br></code></pre></div></td></tr></table></figure><p><code>[3]int</code> 和 <code>[4]int</code> 虽然都是数组，但他们却是不同的类型，使用 fmt 的 <code>%T</code> 可以查得。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    arr01 := [...]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br>    arr02 := [...]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;<br>    fmt.Printf(<span class="hljs-string">&quot;%d 的类型是: %T\n&quot;</span>, arr01, arr01)<br>    fmt.Printf(<span class="hljs-string">&quot;%d 的类型是: %T&quot;</span>, arr02, arr02)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出 如下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span>] 的类型是: [<span class="hljs-number">3</span>]<span class="hljs-keyword">int</span><br>[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span>] 的类型是: [<span class="hljs-number">4</span>]<span class="hljs-keyword">int</span><br></code></pre></div></td></tr></table></figure><p>如果你觉得每次写 <code>[3]int</code> 有点麻烦，你可以为 <code>[3]int</code> 定义一个类型字面量，也就是别名类型。</p><p>使用 <code>type</code> 关键字可以定义一个类型字面量，后面只要你想定义一个容器大小为3，元素类型为int的数组 ，都可以使用这个别名类型。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">type</span> arr3 [<span class="hljs-number">3</span>]<span class="hljs-keyword">int</span><br><br>    myarr := arr3&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;<br>    fmt.Printf(<span class="hljs-string">&quot;%d 的类型是: %T&quot;</span>, myarr, myarr)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出 如下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span>] 的类型是: main.arr3<br></code></pre></div></td></tr></table></figure><p>其实定义数组还有一种偷懒的方法，比如下面这行代码</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">arr:=[<span class="hljs-number">4</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">2</span>:<span class="hljs-number">3</span>&#125;<br></code></pre></div></td></tr></table></figure><p>打印 arr，会是</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">3</span> <span class="hljs-number">0</span>]<br></code></pre></div></td></tr></table></figure><p>可以看出<code>[4]int&#123;2:3&#125;</code>，4表示数组有4个元素，2 和 3 分别表示该数组索引为2（初始索引为0）的值为3，而其他没有指定值的，就是 int 类型的零值，即0。</p><h2 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h2><p>切片（Slice）与数组一样，也是可以容纳若干类型相同的元素的容器。与数组不同的是，无法通过切片类型来确定其值的长度。每个切片值都会将数组作为其底层数据结构。我们也把这样的数组称为切片的底层数组。</p><p>切片是对数组的一个连续片段的引用，所以切片是一个<strong>引用类型</strong>，这个片段可以是整个数组，也可以是由起始和终止索引标识的一些项的子集，需要注意的是，终止索引标识的项不包括在切片内（意思是这是个<strong>左闭右开的区间</strong>）</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    myarr := [...]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br>    fmt.Printf(<span class="hljs-string">&quot;%d 的类型是: %T&quot;</span>, myarr[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>], myarr[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>])<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出 如下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">[<span class="hljs-number">1</span> <span class="hljs-number">2</span>] 的类型是: []<span class="hljs-keyword">int</span><br></code></pre></div></td></tr></table></figure><p>切片的构造，有四种方式</p><ol><li><p>对数组进行片段截取，主要有如下两种写法</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// 定义一个数组</span><br>myarr := [<span class="hljs-number">5</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>&#125;<br><br><span class="hljs-comment">// 【第一种】</span><br><span class="hljs-comment">// 1 表示从索引1开始，直到到索引为 2 (3-1)的元素</span><br>mysli1 := myarr[<span class="hljs-number">1</span>:<span class="hljs-number">3</span>]<br><br><span class="hljs-comment">// 【第二种】</span><br><span class="hljs-comment">// 1 表示从索引1开始，直到到索引为 2 (3-1)的元素</span><br>mysli2 := myarr[<span class="hljs-number">1</span>:<span class="hljs-number">3</span>:<span class="hljs-number">4</span>]<br></code></pre></div></td></tr></table></figure><p>如果你把上面的 <code>mysli1</code> 和 <code>mysli2</code> 打印出来，会发现他们居然是一样的。那第二种的 <code>myarr[1:3:4]</code> 的 4有什么用呢？</p><p>在切片时，若不指定第三个数，那么切片终止索引会一直到原数组的最后一个数。而如果指定了第三个数，那么切片终止索引只会到原数组的该索引值。</p><p>用下面这段代码来验证一下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    myarr := [<span class="hljs-number">5</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>&#125;<br>    fmt.Printf(<span class="hljs-string">&quot;myarr 的长度为：%d，容量为：%d\n&quot;</span>, <span class="hljs-built_in">len</span>(myarr), <span class="hljs-built_in">cap</span>(myarr))<br><br>    mysli1 := myarr[<span class="hljs-number">1</span>:<span class="hljs-number">3</span>]<br>    fmt.Printf(<span class="hljs-string">&quot;mysli1 的长度为：%d，容量为：%d\n&quot;</span>, <span class="hljs-built_in">len</span>(mysli1), <span class="hljs-built_in">cap</span>(mysli1))<br>    fmt.Println(mysli1)<br><br>    mysli2 := myarr[<span class="hljs-number">1</span>:<span class="hljs-number">3</span>:<span class="hljs-number">4</span>]<br>    fmt.Printf(<span class="hljs-string">&quot;mysli2 的长度为：%d，容量为：%d\n&quot;</span>, <span class="hljs-built_in">len</span>(mysli2), <span class="hljs-built_in">cap</span>(mysli2))<br>    fmt.Println(mysli2)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下，说明切片的第三个数，影响的只是切片的容量，而不会影响长度</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">myarr</span> 的长度为：<span class="hljs-number">5</span>，容量为：<span class="hljs-number">5</span><br><span class="hljs-attribute">mysli1</span> 的长度为：<span class="hljs-number">2</span>，容量为：<span class="hljs-number">4</span><span class="hljs-meta"></span><br><span class="hljs-meta">[2 3]</span><br><span class="hljs-attribute">mysli2</span> 的长度为：<span class="hljs-number">2</span>，容量为：<span class="hljs-number">3</span><span class="hljs-meta"></span><br><span class="hljs-meta">[2 3]</span><br></code></pre></div></td></tr></table></figure></li><li><p>从头声明赋值（例子如下）</p></li></ol><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// 声明字符串切片</span><br><span class="hljs-keyword">var</span> strList []<span class="hljs-keyword">string</span><br><br><span class="hljs-comment">// 声明整型切片</span><br><span class="hljs-keyword">var</span> numList []<span class="hljs-keyword">int</span><br><br><span class="hljs-comment">// 声明一个空切片</span><br><span class="hljs-keyword">var</span> numListEmpty = []<span class="hljs-keyword">int</span>&#123;&#125;<br></code></pre></div></td></tr></table></figure><ol start="3"><li><p>使用 make 函数构造，make 函数的格式：<code>make( []Type, size, cap )</code></p><p>这个函数刚好指出了，一个切片具备的三个要素：类型（Type），长度（size），容量（cap）</p></li></ol><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br> <span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br> a := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">int</span>, <span class="hljs-number">2</span>)<br> b := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">int</span>, <span class="hljs-number">2</span>, <span class="hljs-number">10</span>)<br> fmt.Println(a, b)<br> fmt.Println(<span class="hljs-built_in">len</span>(a), <span class="hljs-built_in">len</span>(b))<br> fmt.Println(<span class="hljs-built_in">cap</span>(a), <span class="hljs-built_in">cap</span>(b))<br>&#125;<br></code></pre></div></td></tr></table></figure><p>​        输出 如下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">[<span class="hljs-number">0</span> <span class="hljs-number">0</span>] [<span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br><span class="hljs-number">2</span> <span class="hljs-number">2</span><br><span class="hljs-number">2</span> <span class="hljs-number">10</span><br></code></pre></div></td></tr></table></figure><ol><li><p>使用和数组一样，偷懒的方法</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br> <span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    a := []<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">4</span>:<span class="hljs-number">2</span>&#125;<br>    fmt.Println(a)<br>    fmt.Println(<span class="hljs-built_in">len</span>(a), <span class="hljs-built_in">cap</span>(a))<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">2</span>]<br><span class="hljs-number">5</span> <span class="hljs-number">5</span><br></code></pre></div></td></tr></table></figure></li></ol><p>关于 len 和 cap 的概念，可能不好理解 ，这里举个例子：</p><ul><li>公司名，相当于字面量，也就是变量名。</li><li>公司里的所有工位，相当于已分配到的内存空间</li><li>公司里的员工，相当于元素。</li><li>cap 代表你这个公司最多可以容纳多少员工</li><li>len 代表你这个公司当前有多少个员工</li></ul><p>由于 切片是引用类型，所以你不对它进行赋值的话，它的零值（默认值）是 nil</p><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml">var myarr <span class="hljs-literal">[]</span><span class="hljs-built_in">int</span><br>fmt.<span class="hljs-constructor">Println(<span class="hljs-params">myarr</span> <span class="hljs-operator">==</span> <span class="hljs-params">nil</span>)</span><br><span class="hljs-comment">// true</span><br></code></pre></div></td></tr></table></figure><p>数组 与 切片 有相同点，它们都是可以容纳若干类型相同的元素的容器</p><p>也有不同点，数组的容器大小固定，而切片本身是引用类型，它更像是 Python 中的 list ，我们可以对它 append 进行元素的添加。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    myarr := []<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>&#125;<br>    <span class="hljs-comment">// 追加一个元素</span><br>    myarr = <span class="hljs-built_in">append</span>(myarr, <span class="hljs-number">2</span>)<br>    <span class="hljs-comment">// 追加多个元素</span><br>    myarr = <span class="hljs-built_in">append</span>(myarr, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<br>    <span class="hljs-comment">// 追加一个切片, ... 表示解包，不能省略</span><br>    myarr = <span class="hljs-built_in">append</span>(myarr, []<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">7</span>, <span class="hljs-number">8</span>&#125;...)<br>    <span class="hljs-comment">// 在第一个位置插入元素</span><br>    myarr = <span class="hljs-built_in">append</span>([]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">0</span>&#125;, myarr...)<br>    <span class="hljs-comment">// 在中间插入一个切片(两个元素)</span><br>    myarr = <span class="hljs-built_in">append</span>(myarr[:<span class="hljs-number">5</span>], <span class="hljs-built_in">append</span>([]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">5</span>,<span class="hljs-number">6</span>&#125;, myarr[<span class="hljs-number">5</span>:]...)...)<br>    fmt.Println(myarr)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出 如下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">[<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span>]<br></code></pre></div></td></tr></table></figure><h1 id="字典与布尔类型"><a href="#字典与布尔类型" class="headerlink" title="字典与布尔类型"></a>字典与布尔类型</h1><h2 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h2><p>字典（Map 类型），是由若干个 <code>key:value</code> 这样的键值对映射组合在一起的数据结构。</p><p>它是哈希表的一个实现，这就要求它的每个映射里的key，都是唯一的，可以使用 <code>==</code> 和 <code>!=</code> 来进行判等操作，换句话说就是key必须是可哈希的。</p><p>什么叫可哈希的？简单来说，一个不可变对象，都可以用一个哈希值来唯一表示，这样的不可变对象，比如字符串类型的对象（可以说除了切片、 字典，函数之外的其他内建类型都算）。</p><p>意思就是，你的 key 不能是切片，不能是字典，不能是函数。。</p><p>字典由key和value组成，它们各自有各自的类型。</p><p>在声明字典时，必须指定好你的key和value是什么类型的，然后使用 map 关键字来告诉Go这是一个字典。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">map</span>[KEY_TYPE]VALUE_TYPE<br></code></pre></div></td></tr></table></figure><h3 id="声明初始化字典"><a href="#声明初始化字典" class="headerlink" title="声明初始化字典"></a>声明初始化字典</h3><p>三种声明并初始化字典的方法</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// 第一种方法</span><br><span class="hljs-keyword">var</span> scores <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span> = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-string">&quot;english&quot;</span>: <span class="hljs-number">80</span>, <span class="hljs-string">&quot;chinese&quot;</span>: <span class="hljs-number">85</span>&#125;<br><br><span class="hljs-comment">// 第二种方法</span><br>scores := <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-string">&quot;english&quot;</span>: <span class="hljs-number">80</span>, <span class="hljs-string">&quot;chinese&quot;</span>: <span class="hljs-number">85</span>&#125;<br><br><span class="hljs-comment">// 第三种方法</span><br>scores := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span>)<br>scores[<span class="hljs-string">&quot;english&quot;</span>] = <span class="hljs-number">80</span><br>scores[<span class="hljs-string">&quot;chinese&quot;</span>] = <span class="hljs-number">85</span><br></code></pre></div></td></tr></table></figure><p>要注意的是，第一种方法如果拆分成多步（声明、初始化、再赋值），和其他两种有很大的不一样了，相对会比较麻烦。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 声明一个名为 score 的字典</span><br>    <span class="hljs-keyword">var</span> scores <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span><br><br>    <span class="hljs-comment">// 未初始化的 score 的零值为nil，无法直接进行赋值</span><br>    <span class="hljs-keyword">if</span> scores == <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-comment">// 需要使用 make 函数先对其初始化</span><br>        scores = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span>)<br>    &#125;<br><br>    <span class="hljs-comment">// 经过初始化后，就可以直接赋值</span><br>    scores[<span class="hljs-string">&quot;chinese&quot;</span>] = <span class="hljs-number">90</span><br>    fmt.Println(scores)<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="字典的相关操作"><a href="#字典的相关操作" class="headerlink" title="字典的相关操作"></a><strong>字典的相关操作</strong></h3><p>添加元素</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">scores[<span class="hljs-string">&quot;math&quot;</span>] = <span class="hljs-number">95</span><br></code></pre></div></td></tr></table></figure><p>更新元素，若key已存在，则直接更新value</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">scores</span>[<span class="hljs-string">&quot;math&quot;</span>] = <span class="hljs-number">100</span><br></code></pre></div></td></tr></table></figure><p>读取元素，直接使用 <code>[key]</code> 即可 ，如果 key 不存在，也不报错，会返回其value-type 的零值。</p><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml">fmt.<span class="hljs-constructor">Println(<span class="hljs-params">scores</span>[<span class="hljs-string">&quot;math&quot;</span>])</span><br></code></pre></div></td></tr></table></figure><p>删除元素，使用 delete 函数，如果 key 不存在，delete 函数会静默处理，不会报错。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-built_in">delete</span>(scores, <span class="hljs-string">&quot;math&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>当访问一个不存在的key时，并不会直接报错，而是会返回这个 value 的零值，如果 value的类型是int，就返回0。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    scores := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span>)<br>    fmt.Println(scores[<span class="hljs-string">&quot;english&quot;</span>]) <span class="hljs-comment">// 输出 0</span><br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="判断-key-是否存在"><a href="#判断-key-是否存在" class="headerlink" title="判断 key 是否存在"></a>判断 key 是否存在</h3><p>当key不存在，会返回value-type的零值 ，所以你不能通过返回的结果是否是零值来判断对应的 key 是否存在，因为 key 对应的 value 值可能恰好就是零值。</p><p>其实字典的下标读取可以返回两个值，使用第二个返回值都表示对应的 key 是否存在，若存在ok为true，若不存在，则ok为false</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    scores := <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-string">&quot;english&quot;</span>: <span class="hljs-number">80</span>, <span class="hljs-string">&quot;chinese&quot;</span>: <span class="hljs-number">85</span>&#125;<br>    math, ok := scores[<span class="hljs-string">&quot;math&quot;</span>]<br>    <span class="hljs-keyword">if</span> ok &#123;<br>        fmt.Printf(<span class="hljs-string">&quot;math 的值是: %d&quot;</span>, math)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;math 不存在&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>我们将上面的代码再优化一下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    scores := <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-string">&quot;english&quot;</span>: <span class="hljs-number">80</span>, <span class="hljs-string">&quot;chinese&quot;</span>: <span class="hljs-number">85</span>&#125;<br>    <span class="hljs-keyword">if</span> math, ok := scores[<span class="hljs-string">&quot;math&quot;</span>]; ok &#123;<br>        fmt.Printf(<span class="hljs-string">&quot;math 的值是: %d&quot;</span>, math)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;math 不存在&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="如何对字典进行循环"><a href="#如何对字典进行循环" class="headerlink" title="如何对字典进行循环"></a><strong>如何对字典进行循环</strong></h3><p>Go 语言中没有提供类似 Python 的 keys() 和 values() 这样方便的函数，想要获取，你得自己循环。</p><p>循环还分三种</p><ol><li>获取 key 和 value</li></ol><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    scores := <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-string">&quot;english&quot;</span>: <span class="hljs-number">80</span>, <span class="hljs-string">&quot;chinese&quot;</span>: <span class="hljs-number">85</span>&#125;<br><br>    <span class="hljs-keyword">for</span> subject, score := <span class="hljs-keyword">range</span> scores &#123;<br>        fmt.Printf(<span class="hljs-string">&quot;key: %s, value: %d\n&quot;</span>, subject, score)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ol><li>只获取key，这里注意不用占用符。</li></ol><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    scores := <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-string">&quot;english&quot;</span>: <span class="hljs-number">80</span>, <span class="hljs-string">&quot;chinese&quot;</span>: <span class="hljs-number">85</span>&#125;<br><br>    <span class="hljs-keyword">for</span> subject := <span class="hljs-keyword">range</span> scores &#123;<br>        fmt.Printf(<span class="hljs-string">&quot;key: %s\n&quot;</span>, subject)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ol><li>只获取 value，用一个占位符替代。</li></ol><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    scores := <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-string">&quot;english&quot;</span>: <span class="hljs-number">80</span>, <span class="hljs-string">&quot;chinese&quot;</span>: <span class="hljs-number">85</span>&#125;<br><br>    <span class="hljs-keyword">for</span> _, score := <span class="hljs-keyword">range</span> scores &#123;<br>        fmt.Printf(<span class="hljs-string">&quot;value: %d\n&quot;</span>, score)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="布尔类型"><a href="#布尔类型" class="headerlink" title="布尔类型"></a>布尔类型</h2><p>关于布尔值，无非就两个值：true 和 false。只是这两个值，在不同的语言里可能不同。</p><p>在 Python 中，真值用 True 表示，与 1 相等，假值用 False 表示，与 0 相等</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">&gt;&gt;&gt; True == <span class="hljs-number">1</span><br>True<br>&gt;&gt;&gt; False == <span class="hljs-number">0</span><br>True<br>&gt;&gt;&gt;<br></code></pre></div></td></tr></table></figure><p>而在 Go 中，真值用 true 表示，不但不与 1 相等，并且更加严格，不同类型无法进行比较，而假值用 false 表示，同样与 0 无法比较。</p><p>Go 中确实不如 Python 那样灵活，<code>bool</code> 与 <code>int</code> 不能直接转换，如果要转换，需要你自己实现函数。</p><p><strong>bool 转 int</strong></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">bool2int</span><span class="hljs-params">(b <span class="hljs-keyword">bool</span>)</span> <span class="hljs-title">int</span></span> &#123;<br>    <span class="hljs-keyword">if</span> b &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p><strong>int 转 bool</strong></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">int2bool</span><span class="hljs-params">(i <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">bool</span></span> &#123;<br>    <span class="hljs-keyword">return</span> i != <span class="hljs-number">0</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>在 Python 中使用 not 对逻辑值取反，而 Go 中使用 <code>!</code> 符号</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">var</span> male <span class="hljs-keyword">bool</span> = <span class="hljs-literal">true</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>  &#123;<br>    fmt.Println( !male == <span class="hljs-literal">false</span>)<br>    <span class="hljs-comment">// 或者</span><br>    fmt.Println( male != <span class="hljs-literal">false</span>)<br>&#125;<br><br><span class="hljs-comment">// output: true</span><br></code></pre></div></td></tr></table></figure><p>一个 if 判断语句，有可能不只一个判断条件，在 Python 中是使用 <code>and</code> 和 <code>or</code> 来执行逻辑运算</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">&gt;&gt;&gt; age = <span class="hljs-number">15</span><br>&gt;&gt;&gt; gender = <span class="hljs-string">&quot;male&quot;</span><br>&gt;&gt;&gt;<br>&gt;&gt;&gt; gender == <span class="hljs-string">&quot;male&quot;</span> and age &gt;<span class="hljs-number">18</span><br>False<br></code></pre></div></td></tr></table></figure><p>而在 Go 语言中，则使用 <code>&amp;&amp;</code> 表示<code>且</code>，用 <code>||</code> 表示<code>或</code>，并且有短路行为（即左边表达式已经可以确认整个表达式的值，那么右边将不会再被求值。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">var</span> age <span class="hljs-keyword">int</span> = <span class="hljs-number">15</span><br><span class="hljs-keyword">var</span> gender <span class="hljs-keyword">string</span> = <span class="hljs-string">&quot;male&quot;</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>  &#123;<br>    <span class="hljs-comment">//  &amp;&amp; 两边的表达式都会执行</span><br>    fmt.Println( age &gt; <span class="hljs-number">18</span> &amp;&amp; gender == <span class="hljs-string">&quot;male&quot;</span>)<br>    <span class="hljs-comment">// gender == &quot;male&quot; 并不会执行</span><br>    fmt.Println( age &lt; <span class="hljs-number">18</span> || gender == <span class="hljs-string">&quot;male&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// output: false</span><br><span class="hljs-comment">// output: true</span><br></code></pre></div></td></tr></table></figure><h1 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h1><h2 id="什么是指针"><a href="#什么是指针" class="headerlink" title="什么是指针"></a>什么是指针</h2><p>当我们定义一个变量 name</p><figure class="highlight applescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs applescript">var <span class="hljs-built_in">name</span> <span class="hljs-built_in">string</span> = <span class="hljs-string">&quot;hello&quot;</span><br></code></pre></div></td></tr></table></figure><p>此时，name 是变量名，它只是编程语言中方便程序员编写和理解代码的一个标签。</p><p>当我们访问这个标签时，机算机会返回给我们它指向的内存地址里存储的值：<code>hello</code>。</p><p>出于某些需要，我们会将这个内存地址赋值给另一个变量名，通常叫做 <code>ptr</code>（pointer的简写），而这个变量，我们称之为指针变量。</p><p>换句话说，指针变量（一个标签）的值是指针，也就是内存地址。</p><p>根据变量指向的值，是否是内存地址，我把变量分为两种：</p><ul><li>普通变量：存数据值本身</li><li>指针变量：存值的内存地址</li></ul><h3 id="指针的创建"><a href="#指针的创建" class="headerlink" title="指针的创建"></a>指针的创建</h3><p>指针创建有三种方法</p><p><strong>第一种方法</strong></p><p>先定义对应的变量，再通过变量取得内存地址，创建指针</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// 定义普通变量</span><br>aint := <span class="hljs-number">1</span><br><span class="hljs-comment">// 定义指针变量</span><br>ptr := &amp;aint<br></code></pre></div></td></tr></table></figure><p><strong>第二种方法</strong></p><p>先创建指针，分配好内存后，再给指针指向的内存地址写入对应的值。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// 创建指针</span><br>astr := <span class="hljs-built_in">new</span>(<span class="hljs-keyword">string</span>)<br><span class="hljs-comment">// 给指针赋值</span><br>*astr = <span class="hljs-string">&quot;hello&quot;</span><br></code></pre></div></td></tr></table></figure><p><strong>第三种方法</strong></p><p>先声明一个指针变量，再从其他变量取得内存地址赋值给它</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">aint := <span class="hljs-number">1</span><br><span class="hljs-keyword">var</span> bint *<span class="hljs-keyword">int</span>  <span class="hljs-comment">// 声明一个指针</span><br>bint = &amp;aint   <span class="hljs-comment">// 初始化</span><br></code></pre></div></td></tr></table></figure><p>上面的三段代码中，指针的操作都离不开这两个符号：</p><ul><li><code>&amp;</code> ：从一个普通变量中取得内存地址</li><li><code>*</code>：当<code>*</code>在赋值操作符（=）的右边，是从一个指针变量中取得变量值，当<code>*</code>在赋值操作符（=）的左边，是指该指针指向的变量</li></ul><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    aint := <span class="hljs-number">1</span>     <span class="hljs-comment">// 定义普通变量</span><br>    ptr := &amp;aint  <span class="hljs-comment">// 定义指针变量</span><br>    fmt.Println(<span class="hljs-string">&quot;普通变量存储的是：&quot;</span>, aint)<br>    fmt.Println(<span class="hljs-string">&quot;普通变量存储的是：&quot;</span>, *ptr)<br>    fmt.Println(<span class="hljs-string">&quot;指针变量存储的是：&quot;</span>, &amp;aint)<br>    fmt.Println(<span class="hljs-string">&quot;指针变量存储的是：&quot;</span>, ptr)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight dns"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dns">普通变量存储的是： <span class="hljs-number">1</span><br>普通变量存储的是： <span class="hljs-number">1</span><br>指针变量存储的是： <span class="hljs-number">0</span>xc<span class="hljs-number">0000100a0</span><br>指针变量存储的是： <span class="hljs-number">0</span>xc<span class="hljs-number">0000100a0</span><br></code></pre></div></td></tr></table></figure><p>要想打印指针指向的内存地址，方法有两种</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// 第一种</span><br>fmt.Printf(<span class="hljs-string">&quot;%p&quot;</span>, ptr)<br><br><span class="hljs-comment">// 第二种</span><br>fmt.Println(ptr)<br></code></pre></div></td></tr></table></figure><h2 id="指针的类型"><a href="#指针的类型" class="headerlink" title="指针的类型"></a>指针的类型</h2><p>我们知道字符串的类型是 string，整型是int，那么指针如何表示呢？</p><p>写段代码试验一下就知道了</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    astr := <span class="hljs-string">&quot;hello&quot;</span><br>    aint := <span class="hljs-number">1</span><br>    abool := <span class="hljs-literal">false</span><br>    arune := <span class="hljs-string">&#x27;a&#x27;</span><br>    afloat := <span class="hljs-number">1.2</span><br><br>    fmt.Printf(<span class="hljs-string">&quot;astr 指针类型是：%T\n&quot;</span>, &amp;astr)<br>    fmt.Printf(<span class="hljs-string">&quot;aint 指针类型是：%T\n&quot;</span>, &amp;aint)<br>    fmt.Printf(<span class="hljs-string">&quot;abool 指针类型是：%T\n&quot;</span>, &amp;abool)<br>    fmt.Printf(<span class="hljs-string">&quot;arune 指针类型是：%T\n&quot;</span>, &amp;arune)<br>    fmt.Printf(<span class="hljs-string">&quot;afloat 指针类型是：%T\n&quot;</span>, &amp;afloat)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下，可以发现用 <code>*</code>+所指向变量值的数据类型，就是对应的指针类型。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">astr 指针类型是：*<span class="hljs-keyword">string</span><br>aint 指针类型是：*<span class="hljs-keyword">int</span><br>abool 指针类型是：*<span class="hljs-keyword">bool</span><br>arune 指针类型是：*<span class="hljs-keyword">int32</span><br>afloat 指针类型是：*<span class="hljs-keyword">float64</span><br></code></pre></div></td></tr></table></figure><p>所以若我们定义一个只接收指针类型的参数的函数，可以这么写</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">test</span><span class="hljs-params">(ptr *<span class="hljs-keyword">int</span>)</span></span>  &#123;<br>    fmt.Println(*ptr)<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="指针的零值"><a href="#指针的零值" class="headerlink" title="指针的零值"></a>指针的零值</h2><p>当指针声明后，没有进行初始化，其零值是 nil。</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    a := <span class="hljs-number">25</span><br>    <span class="hljs-keyword">var</span> b *<span class="hljs-keyword">int</span>  <span class="hljs-comment">// 声明一个指针</span><br><br>    <span class="hljs-keyword">if</span> b == <span class="hljs-literal">nil</span> &#123;<br>        fmt.Println(b)<br>        b = &amp;a  <span class="hljs-comment">// 初始化：将a的内存地址给b</span><br>        fmt.Println(b)<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>输出如下</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">&lt;<span class="hljs-literal">nil</span>&gt;<br><span class="hljs-number">0xc0000100a0</span><br></code></pre></div></td></tr></table></figure><h2 id="指针与切片"><a href="#指针与切片" class="headerlink" title="指针与切片"></a>指针与切片</h2><p>切片与指针一样，都是引用类型。</p><p>如果我们想通过一个函数改变一个数组的值，有两种方法</p><ol><li>将这个数组的切片做为参数传给函数</li><li>将这个数组的指针做为参数传给函数</li></ol><p>尽管二者都可以实现我们的目的，但是按照 Go 语言的使用习惯，建议使用第一种方法，因为第一种方法，写出来的代码会更加简洁，易读。具体你可以参数下面两种方法的代码实现</p><p><strong>使用切片</strong></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">modify</span><span class="hljs-params">(sls []<span class="hljs-keyword">int</span>)</span></span> &#123;<br>    sls[<span class="hljs-number">0</span>] = <span class="hljs-number">90</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    a := [<span class="hljs-number">3</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">89</span>, <span class="hljs-number">90</span>, <span class="hljs-number">91</span>&#125;<br>    modify(a[:])<br>    fmt.Println(a)<br>&#125;<br></code></pre></div></td></tr></table></figure><p><strong>使用指针</strong></p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">modify</span><span class="hljs-params">(arr *[3]<span class="hljs-keyword">int</span>)</span></span> &#123;<br>    (*arr)[<span class="hljs-number">0</span>] = <span class="hljs-number">90</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    a := [<span class="hljs-number">3</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">89</span>, <span class="hljs-number">90</span>, <span class="hljs-number">91</span>&#125;<br>    modify(&amp;a)<br>    fmt.Println(a)<br>&#125;<br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Go语言入门</title>
    <link href="/2021/08/28/Go%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8/"/>
    <url>/2021/08/28/Go%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="语言特性"><a href="#语言特性" class="headerlink" title="语言特性"></a>语言特性</h2><ul><li>闭包与匿名函数</li><li>错误处理</li><li>函数多返回值</li><li>自动垃圾回收</li><li>接口与类型</li><li>并发编程</li><li>反射</li></ul><h2 id="安装环境变量"><a href="#安装环境变量" class="headerlink" title="安装环境变量"></a>安装环境变量</h2><p>使用<code>go env</code>可以查看所有的环境变量。</p><h3 id="GOROOT"><a href="#GOROOT" class="headerlink" title="GOROOT"></a><code>GOROOT</code></h3><p><code>GOROOT</code> 表示 Go 语言的安装目录。</p><p><code>GOROOT</code> 的作用是用来索引 <code>Go</code> 语言的安装目录下的相关资源，比如 bin 目录的工具（如 <code>go</code> 命令），<code>src</code> 目录下的源码等。</p><h3 id="GOPATH"><a href="#GOPATH" class="headerlink" title="GOPATH"></a><code>GOPATH</code></h3><p><code>GOPATH</code> 用于指定我们的开发工作区，可以有多个。</p><p>按照 Go 开发规范，<code>GOPATH</code> 目录下一般分为三个子目录 <code>src</code>，<code>pkg</code>，<code>bin</code>。</p><p><code>src</code> 目录存放我们需要开发的项目源码，<code>pkg</code> 存放依赖的包和编译后的静态库文件，<code>bin</code> 放源代码编译后台的可执行文件。</p><p>注意：<br>（1）如果 <code>GOPATH</code> 未显示设置，则默认为用户主目录中名为 go 的子目录。Unix 下为<code>$HOME/go，Windows</code> 下为<code>%USERPROFILE%\go</code>（一般为<code>C:\Users\YourName\go</code>），Plan 9 下为<code>$home/go</code>。</p><p>（2）使用模块时，<code>GOPATH</code> 不再用于解析导入，但是它仍然用于存储下载的源代码（在<code>GOPATH/pkg/mod</code>中）和编译的命令（在<code>GOPATH/bin</code>中）。</p><p>（3）使用命令<code>go help gopath</code>可查看 <code>GOPATH</code> 详细说明。</p><h3 id="GO111MODULE"><a href="#GO111MODULE" class="headerlink" title="GO111MODULE"></a><code>GO111MODULE</code></h3><p>在 <code>go1.11</code> 的时候推出了这个 <code>go modules</code> 来解决依赖管理的问题。</p><p>通过变量 <code>GO111MODULE</code> 来控制 <code>Go Module</code> 的开启和关闭，取值 off、on 或 auto。</p><p>从 <code>Go 1.13</code> 开始，<code>Go Module</code> 作为 <code>Golang</code> 中的标准包管理器。</p><h3 id="GOPROXY"><a href="#GOPROXY" class="headerlink" title="GOPROXY"></a><code>GOPROXY</code></h3><p><code>go get</code> 下载依赖时使用的代理地址列表，使用逗号 <code>,</code>或竖杠 |`)分隔。</p><p>当用 go 命令查找依赖模块时，它会按顺序访问 <code>GOPROXY</code> 列表中的每个代理，直到收到成功的响应或出现终端错误。</p><p><code>GOPROXY</code> 中可能会存在两个关键字来代替代理URL：</p><figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go">off:不允许从任何源下载依赖的模块<br>direct:直接从版本控制存储库下载，而不是使用模块代理<br></code></pre></div></td></tr></table></figure><p><code>GOPROXY</code> 缺省值为<code>https://proxy.golang.org,direct</code></p><h3 id="GOPRIVATE"><a href="#GOPRIVATE" class="headerlink" title="GOPRIVATE"></a><code>GOPRIVATE</code></h3><p><code>go get</code> 通过代理服务拉取仓库时，因为代理服务不可能访问到私有仓库（一般为企业内部代码管理平台），会出现 404 错误。</p><p><code>go1.13</code> 版本提供了一个方便的解决方案：<code>GOPRIVATE</code> 环境变量。</p><p>如：<code>set GOPRIVATE=gitlab.com,git.woa.com</code></p><h3 id="GOBIN"><a href="#GOBIN" class="headerlink" title="GOBIN"></a><code>GOBIN</code></h3><p>用于存储我们使用<code>go install</code>命令安装的程序。</p><p>如果没有设置 <code>GOBIN</code>，程序一般会安装到为<code>GOPATH/bin</code>目录。</p><h3 id="GOOS"><a href="#GOOS" class="headerlink" title="GOOS"></a><code>GOOS</code></h3><p>当前的操作系统。例如 <code>linux</code>、<code>darwin</code>、<code>windows</code>、<code>netbsd</code>、<code>freebsd</code>、<code>openbsd</code>、<code>solaris</code>、<code>plan9</code> 等。 <code>mac os</code>对应的值是 <code>darwin</code>。</p><h3 id="GOARCH"><a href="#GOARCH" class="headerlink" title="GOARCH"></a><code>GOARCH</code></h3><p>表示 CPU 架构。如 <code>amd64</code>、<code>386</code>、<code>arm</code>、<code>ppc64</code> 等。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>数据存入数据库</title>
    <link href="/2021/08/17/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <url>/2021/08/17/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    
    <content type="html"><![CDATA[<h1 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h1><p>SQLite是一个文件型轻量级数据库，它的处理速度很快，在数据量不是很大的情况下，使用SQLite足够了。</p><p>首先，创建一个供Scrapy使用的SQLite数据库，取名为<code>scrapy.db</code>：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">[root@VM-<span class="hljs-number">8</span>-<span class="hljs-number">16</span>-centos SQL]<span class="hljs-comment"># sqlite3 scrapy.db</span><br></code></pre></div></td></tr></table></figure><p>接下来，在客户端中创建数据表（Table）：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">CREATE TABLE books(<br>upc CHAR(<span class="hljs-number">16</span>) NOT NULL PRIMARY KEY,<br>    name VARCHAR(<span class="hljs-number">256</span>) NOT NULL,<br>    price VARCHAR(<span class="hljs-number">16</span>) NOT NULL,<br>    review_rating INT,<br>    review_num INT,<br>    stock INT<br>);<br></code></pre></div></td></tr></table></figure><p>在Python中访问SQLite数据库可使用Python标准库中的<code>sqlite3</code>模块。下面是使用<code>sqlite3</code>模块将数据写入SQLite数据库的简单示例：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sqlite3<br><br><span class="hljs-comment"># 连接数据库</span><br>conn = sqlite3.connect(<span class="hljs-string">&#x27;scrapy.db&#x27;</span>)<br><br><span class="hljs-comment"># 创建corosr对象，用来执行SQL语句</span><br>cur = conn.cursor()<br><br><span class="hljs-comment"># 创建数据表</span><br>cur.execute(<span class="hljs-string">&#x27;CREATE TABLE person(name VARCHAR(32), age INT, sex char(1))&#x27;</span>)<br><br><span class="hljs-comment"># 插入一条数据</span><br>cur.execute(<span class="hljs-string">&#x27;INSERT INTO person VALUES  (?, ?, ?)&#x27;</span>, (<span class="hljs-string">&#x27;陈浩&#x27;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&#x27;M&#x27;</span>))<br><br><span class="hljs-comment"># 保存变更，提交保存</span><br>conn.commit()<br><br><span class="hljs-comment"># 关闭连接</span><br>conn.close()<br></code></pre></div></td></tr></table></figure><p>了解了在Python中如何操作SQLite数据库后，接下来编写一个能将爬取到的数据写入SQLite数据库的<code>Item Pipeline</code>。在<code>pipelines.py</code>中实现<code>SQLitePipeline</code>的代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sqlite3<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SQLitePipeline</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">open_spider</span>(<span class="hljs-params">self, spider</span>):</span><br>        db_name = spider.settings.get(<span class="hljs-string">&#x27;SQLITE_DB_NAME&#x27;</span>, <span class="hljs-string">&#x27;scrapy_defaut.db&#x27;</span>)<br>        self.db_conn = sqlite3.connect(db_name)<br>        self.db_cur = self.db_conn.cursor()<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">close</span>(<span class="hljs-params">self, spider</span>):</span><br>        self.db_conn.commit()<br>        self.db_conn.close()<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_item</span>(<span class="hljs-params">self, item, spider</span>):</span><br>        self.insert_db(item)<br>        <span class="hljs-keyword">return</span> item<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">insert_db</span>(<span class="hljs-params">self, item</span>):</span><br>        values = (<br>            item[<span class="hljs-string">&#x27;upc&#x27;</span>],<br>            item[<span class="hljs-string">&#x27;name&#x27;</span>],<br>            item[<span class="hljs-string">&#x27;price&#x27;</span>],<br>            item[<span class="hljs-string">&#x27;review_rating&#x27;</span>],<br>            item[<span class="hljs-string">&#x27;review_num&#x27;</span>],<br>            item[<span class="hljs-string">&#x27;stock&#x27;</span>],<br>        )<br><br>        sql = <span class="hljs-string">&#x27;INSERT INTO books VALUES (?, ?, ?, ?, ?, ?)&#x27;</span><br><br>        self.db_cur.execute(sql, values)<br><br>        <span class="hljs-comment"># 每插入一条就commit一次会影响效率</span><br>        self.db_conn.commit()<br></code></pre></div></td></tr></table></figure><p>上述代码：</p><ul><li><code>open_spider</code>方法在开始爬取数据之前被调用，在该方法中通过<code>spider.settings</code>对象读取用户在配置文件中指定的数据库，然后建立与数据库的连接，将得到的Connection对象和Cursor对象分别赋值给<code>self.db_conn</code>和<code>self.db_cur</code>，以便之后使用。</li><li><code>process_item</code>方法处理爬取到的每一项数据，在该方法中调用insert_db方法，执行插入数据操作的SQL语句。但需要注意的是，在insert_db中并没有调用连接对象的commit方法，也就意味着此时数据并没有实际写入数据库。如果每插入一条数据都调用一次commit方法，会严重降低程序执行效率，并且我们对数据插入数据库的实时性并没有什么要求，因此可以在爬取完全部数据后再调用commit方法。</li><li><code>close_spider</code>方法在爬取完全部数据后被调用，在该方法中，调用连接对象的commit方法将之前所有的插入数据操作一次性提交给数据库，然后关闭连接对象。</li></ul><p>在配置文件<code>settings.py</code>中指定我们所要使用的SQLite数据库，并启用<code>SQLitePipeline</code>：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">SQLITE_DB_NAME = <span class="hljs-string">&#x27;scrapy.db&#x27;</span><br>ITEM_PIPELINES = &#123;<br>    <span class="hljs-string">&#x27;example.pipelines.SQLitePipeline&#x27;</span>: <span class="hljs-number">400</span>,<br>&#125;<br></code></pre></div></td></tr></table></figure><p>运行爬虫。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Scrapy爬取动态页面-scrapy-splash</title>
    <link href="/2021/08/15/Scrapy%E7%88%AC%E5%8F%96%E5%8A%A8%E6%80%81%E9%A1%B5%E9%9D%A2/"/>
    <url>/2021/08/15/Scrapy%E7%88%AC%E5%8F%96%E5%8A%A8%E6%80%81%E9%A1%B5%E9%9D%A2/</url>
    
    <content type="html"><![CDATA[<p>在现实中，目前绝大多数网站的页面都是动态页面，动态页面中的部分内容是浏览器运行页面中的<code>JavaScript</code>脚本动态生成的，爬取相对困难，这一章来学习如何爬取动态页面。</p><p>先来看一个简单的动态页面的例子，在浏览器中打开<a href="http://quotes.toscrape.com/js%EF%BC%8C%E6%98%BE%E7%A4%BA%E5%A6%82%E5%9B%BE%E6%89%80%E7%A4%BA%E3%80%82">http://quotes.toscrape.com/js，显示如图所示。</a></p><p><img src="image-20210815094432155.png"></p><p>页面中有10条名人名言，每一条都包含在一个<code>&lt;div class=&quot;quote&quot;&gt;</code>元素中。在<code>scrapy shell</code>环境下尝试爬取页面中的名人名言：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">$ scrapy shell http://quotes.toscrape.com/js<br><span class="hljs-meta">&gt;&gt;&gt; </span>response.css(<span class="hljs-string">&#x27;div.quote&#x27;</span>)<br>[]<br></code></pre></div></td></tr></table></figure><p><img src="image-20210815094734907.png"></p><p>爬取失败了，在页面中没有找到任何包含名人名言的<code>&lt;divclass=&quot;quote&quot;&gt;</code>元素。这些<code>&lt;div class=&quot;quote&quot;&gt;</code>就是动态内容，从服务器下载的页面中并不包含它们（所以我们爬取失败），浏览器执行了页面中的一段<code>JavaScript</code>代码后，它们才被生成出来。</p><p><img src="image-20210815094857124.png"></p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">var</span> data = [<br>&#123;<br>    <span class="hljs-string">&quot;tags&quot;</span>: [<br>        <span class="hljs-string">&quot;change&quot;</span>,<br>        <span class="hljs-string">&quot;deep-thoughts&quot;</span>,<br>        <span class="hljs-string">&quot;thinking&quot;</span>,<br>        <span class="hljs-string">&quot;world&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;author&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Albert Einstein&quot;</span>,<br>        <span class="hljs-string">&quot;goodreads_link&quot;</span>: <span class="hljs-string">&quot;/author/show/9810.Albert_Einstein&quot;</span>,<br>        <span class="hljs-string">&quot;slug&quot;</span>: <span class="hljs-string">&quot;Albert-Einstein&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;\u201cThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.\u201d&quot;</span><br>&#125;,<br>&#123;<br>    <span class="hljs-string">&quot;tags&quot;</span>: [<br>        <span class="hljs-string">&quot;abilities&quot;</span>,<br>        <span class="hljs-string">&quot;choices&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;author&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;J.K. Rowling&quot;</span>,<br>        <span class="hljs-string">&quot;goodreads_link&quot;</span>: <span class="hljs-string">&quot;/author/show/1077326.J_K_Rowling&quot;</span>,<br>        <span class="hljs-string">&quot;slug&quot;</span>: <span class="hljs-string">&quot;J-K-Rowling&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;\u201cIt is our choices, Harry, that show what we truly are, far more than our abilities.\u201d&quot;</span><br>&#125;,<br>&#123;<br>    <span class="hljs-string">&quot;tags&quot;</span>: [<br>        <span class="hljs-string">&quot;inspirational&quot;</span>,<br>        <span class="hljs-string">&quot;life&quot;</span>,<br>        <span class="hljs-string">&quot;live&quot;</span>,<br>        <span class="hljs-string">&quot;miracle&quot;</span>,<br>        <span class="hljs-string">&quot;miracles&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;author&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Albert Einstein&quot;</span>,<br>        <span class="hljs-string">&quot;goodreads_link&quot;</span>: <span class="hljs-string">&quot;/author/show/9810.Albert_Einstein&quot;</span>,<br>        <span class="hljs-string">&quot;slug&quot;</span>: <span class="hljs-string">&quot;Albert-Einstein&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;\u201cThere are only two ways to live your life. One is as though nothing is a miracle. The other is as though everything is a miracle.\u201d&quot;</span><br>&#125;,<br>&#123;<br>    <span class="hljs-string">&quot;tags&quot;</span>: [<br>        <span class="hljs-string">&quot;aliteracy&quot;</span>,<br>        <span class="hljs-string">&quot;books&quot;</span>,<br>        <span class="hljs-string">&quot;classic&quot;</span>,<br>        <span class="hljs-string">&quot;humor&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;author&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Jane Austen&quot;</span>,<br>        <span class="hljs-string">&quot;goodreads_link&quot;</span>: <span class="hljs-string">&quot;/author/show/1265.Jane_Austen&quot;</span>,<br>        <span class="hljs-string">&quot;slug&quot;</span>: <span class="hljs-string">&quot;Jane-Austen&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;\u201cThe person, be it gentleman or lady, who has not pleasure in a good novel, must be intolerably stupid.\u201d&quot;</span><br>&#125;,<br>&#123;<br>    <span class="hljs-string">&quot;tags&quot;</span>: [<br>        <span class="hljs-string">&quot;be-yourself&quot;</span>,<br>        <span class="hljs-string">&quot;inspirational&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;author&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Marilyn Monroe&quot;</span>,<br>        <span class="hljs-string">&quot;goodreads_link&quot;</span>: <span class="hljs-string">&quot;/author/show/82952.Marilyn_Monroe&quot;</span>,<br>        <span class="hljs-string">&quot;slug&quot;</span>: <span class="hljs-string">&quot;Marilyn-Monroe&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;\u201cImperfection is beauty, madness is genius and it&#x27;s better to be absolutely ridiculous than absolutely boring.\u201d&quot;</span><br>&#125;,<br>&#123;<br>    <span class="hljs-string">&quot;tags&quot;</span>: [<br>        <span class="hljs-string">&quot;adulthood&quot;</span>,<br>        <span class="hljs-string">&quot;success&quot;</span>,<br>        <span class="hljs-string">&quot;value&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;author&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Albert Einstein&quot;</span>,<br>        <span class="hljs-string">&quot;goodreads_link&quot;</span>: <span class="hljs-string">&quot;/author/show/9810.Albert_Einstein&quot;</span>,<br>        <span class="hljs-string">&quot;slug&quot;</span>: <span class="hljs-string">&quot;Albert-Einstein&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;\u201cTry not to become a man of success. Rather become a man of value.\u201d&quot;</span><br>&#125;,<br>&#123;<br>    <span class="hljs-string">&quot;tags&quot;</span>: [<br>        <span class="hljs-string">&quot;life&quot;</span>,<br>        <span class="hljs-string">&quot;love&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;author&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Andr\u00e9 Gide&quot;</span>,<br>        <span class="hljs-string">&quot;goodreads_link&quot;</span>: <span class="hljs-string">&quot;/author/show/7617.Andr_Gide&quot;</span>,<br>        <span class="hljs-string">&quot;slug&quot;</span>: <span class="hljs-string">&quot;Andre-Gide&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;\u201cIt is better to be hated for what you are than to be loved for what you are not.\u201d&quot;</span><br>&#125;,<br>&#123;<br>    <span class="hljs-string">&quot;tags&quot;</span>: [<br>        <span class="hljs-string">&quot;edison&quot;</span>,<br>        <span class="hljs-string">&quot;failure&quot;</span>,<br>        <span class="hljs-string">&quot;inspirational&quot;</span>,<br>        <span class="hljs-string">&quot;paraphrased&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;author&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Thomas A. Edison&quot;</span>,<br>        <span class="hljs-string">&quot;goodreads_link&quot;</span>: <span class="hljs-string">&quot;/author/show/3091287.Thomas_A_Edison&quot;</span>,<br>        <span class="hljs-string">&quot;slug&quot;</span>: <span class="hljs-string">&quot;Thomas-A-Edison&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;\u201cI have not failed. I&#x27;ve just found 10,000 ways that won&#x27;t work.\u201d&quot;</span><br>&#125;,<br>&#123;<br>    <span class="hljs-string">&quot;tags&quot;</span>: [<br>        <span class="hljs-string">&quot;misattributed-eleanor-roosevelt&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;author&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Eleanor Roosevelt&quot;</span>,<br>        <span class="hljs-string">&quot;goodreads_link&quot;</span>: <span class="hljs-string">&quot;/author/show/44566.Eleanor_Roosevelt&quot;</span>,<br>        <span class="hljs-string">&quot;slug&quot;</span>: <span class="hljs-string">&quot;Eleanor-Roosevelt&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;\u201cA woman is like a tea bag; you never know how strong it is until it&#x27;s in hot water.\u201d&quot;</span><br>&#125;,<br>&#123;<br>    <span class="hljs-string">&quot;tags&quot;</span>: [<br>        <span class="hljs-string">&quot;humor&quot;</span>,<br>        <span class="hljs-string">&quot;obvious&quot;</span>,<br>        <span class="hljs-string">&quot;simile&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;author&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Steve Martin&quot;</span>,<br>        <span class="hljs-string">&quot;goodreads_link&quot;</span>: <span class="hljs-string">&quot;/author/show/7103.Steve_Martin&quot;</span>,<br>        <span class="hljs-string">&quot;slug&quot;</span>: <span class="hljs-string">&quot;Steve-Martin&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;\u201cA day without sunshine is like, you know, night.\u201d&quot;</span><br>&#125;];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> data) &#123;<br>        <span class="hljs-keyword">var</span> d = data[i];<br>        <span class="hljs-keyword">var</span> tags = $.map(d[<span class="hljs-string">&#x27;tags&#x27;</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&lt;a class=&#x27;tag&#x27;&gt;&quot;</span> + t + <span class="hljs-string">&quot;&lt;/a&gt;&quot;</span>;<br>        &#125;).join(<span class="hljs-string">&quot; &quot;</span>);<br>        <span class="hljs-built_in">document</span>.write(<span class="hljs-string">&quot;&lt;div class=&#x27;quote&#x27;&gt;&lt;span class=&#x27;text&#x27;&gt;&quot;</span> + d[<span class="hljs-string">&#x27;text&#x27;</span>] + <span class="hljs-string">&quot;&lt;/span&gt;&lt;span&gt;by &lt;small class=&#x27;author&#x27;&gt;&quot;</span> + d[<span class="hljs-string">&#x27;author&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>] + <span class="hljs-string">&quot;&lt;/small&gt;&lt;/span&gt;&lt;div class=&#x27;tags&#x27;&gt;Tags: &quot;</span> + tags + <span class="hljs-string">&quot;&lt;/div&gt;&lt;/div&gt;&quot;</span>);<br>        &#125;<br></code></pre></div></td></tr></table></figure><p>所有名人名言信息被保存在数组data中，最后的for循环迭代data中的每项信息，使用<code>document.write</code>生成每条名人名言对应的<code>&lt;div class=&quot;quote&quot;&gt;</code>元素。</p><p>上面是动态网页中最简单的一个例子，数据被硬编码于<code>JavaScript</code>代码中，实际中更常见的是<code>JavaScript</code>通过HTTP请求跟网站动态交互获取数据（<code>AJAX</code>），然后使用数据更新HTML页面。爬取此类动态网页需要先执行页面中的<code>JavaScript</code>代码渲染页面，再进行爬取。</p><h2 id="Splash渲染引擎"><a href="#Splash渲染引擎" class="headerlink" title="Splash渲染引擎"></a>Splash渲染引擎</h2><p>Splash是<code>Scrapy</code>官方推荐的JavaScript渲染引擎，它是使用<code>Webkit</code>开发的轻量级无界面浏览器，提供基于HTTP接口的JavaScript渲染服务，支持以下功能：</p><p>为用户返回经过渲染的HTML页面或页面截图。</p><ul><li>并发渲染多个页面。</li><li> 关闭图片加载，加速渲染。</li><li> 在页面中执行用户自定义的JavaScript代码。</li><li>执行用户自定义的渲染脚本（<code>lua</code>），功能类似于<code>PhantomJS</code>。</li></ul><p>首先安装<code>Splash</code>，在<code>linux</code>下使用<code>docker</code>安装十分方便：</p><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">sudo</span> docker pull scrapinghub/splash<br></code></pre></div></td></tr></table></figure><p>安装完成后，在本机的8050和8051端口开启Splash服务：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">[root@VM-8-16-centos docker]#  sudo docker run -it -p 8050:8050 --rm scrapinghub/splash<br>2021-08-15 02:22:30+0000 [-] Log opened.<br>2021-08-15 02:22:30.880640 [-] Xvfb is started: [&#x27;Xvfb&#x27;, &#x27;:1396582278&#x27;, &#x27;-screen&#x27;, &#x27;0&#x27;, &#x27;1024x768x24&#x27;, &#x27;-nolisten&#x27;, &#x27;tcp&#x27;]<br>QStandardPaths: XDG_RUNTIME_DIR not set, defaulting to &#x27;/tmp/runtime-splash&#x27;<br>2021-08-15 02:22:31.273181 [-] Splash version: 3.5<br>2021-08-15 02:22:32.250100 [-] Qt 5.14.1, PyQt 5.14.2, WebKit 602.1, Chromium 77.0.3865.129, sip 4.19.22, Twisted 19.7.0, Lua 5.2<br>2021-08-15 02:22:32.251646 [-] Python 3.6.9 (default, Jul 17 2020, 12:50:27) [GCC 8.4.0]<br>2021-08-15 02:22:32.251796 [-] Open files limit: 1048576<br>2021-08-15 02:22:32.251837 [-] Can&#x27;t bump open files limit<br>2021-08-15 02:22:32.352114 [-] proxy profiles support is enabled, proxy profiles path: /etc/splash/proxy-profiles<br>2021-08-15 02:22:32.353014 [-] memory cache: enabled, private mode: enabled, js cross-domain access: disabled<br>2021-08-15 02:22:32.735663 [-] verbosity=1, slots=20, argument_cache_max_entries=500, max-timeout=90.0<br>2021-08-15 02:22:32.735875 [-] Web UI: enabled, Lua: enabled (sandbox: enabled), Webkit: enabled, Chromium: enabled<br>2021-08-15 02:22:32.736222 [-] Site starting on 8050<br>2021-08-15 02:22:32.737289 [-] Starting factory &lt;twisted.web.server.Site object at 0x7f1700b435c0&gt;<br>2021-08-15 02:22:32.740763 [-] Server listening on http://0.0.0.0:8050<br></code></pre></div></td></tr></table></figure><p>Splash功能丰富，包含多个服务端点，由于篇幅有限，这里只介绍其中两个最常用的端点：</p><ul><li><code>render.html</code>提供<code>JavaScript</code>页面渲染服务。</li><li><code>execute</code>执行用户自定义的渲染脚本（<code>lua</code>），利用该端点可在页面中执行JavaScript代码。</li></ul><p>Splash文档地址：<a href="http://splash.readthedocs.io/en/latest/api.html%E3%80%82">http://splash.readthedocs.io/en/latest/api.html。</a></p><h3 id="render-html端点"><a href="#render-html端点" class="headerlink" title="render.html端点"></a><code>render.html</code>端点</h3><p>JavaScript页面渲染服务是<code>Splash</code>中最基础的服务:</p><table><thead><tr><th>服务端点</th><th>render.html</th></tr></thead><tbody><tr><td>请求地址</td><td><a href="http://localhost:8050/render.html">http://localhost:8050/render.html</a></td></tr><tr><td>请求方式</td><td>GET/POST</td></tr><tr><td>返回类型</td><td>html</td></tr></tbody></table><p><code>render.html</code>端点支持的参数:</p><table><thead><tr><th>参数</th><th>是否必选</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>url</td><td>必选</td><td>string</td><td>需要渲染页面的url</td></tr><tr><td>timeout</td><td>可选</td><td>float</td><td>渲染页面的超时时间</td></tr><tr><td>proxy</td><td>可选</td><td>string</td><td>代理服务器地址</td></tr><tr><td>wait</td><td>可选</td><td>float</td><td>等待页面渲染的时间</td></tr><tr><td>images</td><td>可选</td><td>interger</td><td>是否下载图片，默认为1</td></tr><tr><td>js_source</td><td>可选</td><td>string</td><td>用户自定义的JavaScript代码，在页面渲染前执行</td></tr></tbody></table><p>下面是使用requests库调用render.html端点服务对页面<a href="http://quotes.toscrape.com/js/%E8%BF%9B%E8%A1%8C%E6%B8%B2%E6%9F%93%E7%9A%84%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%E3%80%82">http://quotes.toscrape.com/js/进行渲染的示例代码。</a></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> requests<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> scrapy.selector <span class="hljs-keyword">import</span> Selector<br><span class="hljs-meta">&gt;&gt;&gt; </span>splash_url = <span class="hljs-string">&#x27;http://localhost:8050/render.html&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>args = &#123;<span class="hljs-string">&#x27;url&#x27;</span>: <span class="hljs-string">&#x27;http://quotes.toscrape.com/js&#x27;</span>, <span class="hljs-string">&#x27;timeout&#x27;</span>: <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;image&#x27;</span>: <span class="hljs-number">0</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>response = requests.get(splash_url, params=args)<br><span class="hljs-meta">&gt;&gt;&gt; </span>sel = Selector(response)<br><span class="hljs-meta">&gt;&gt;&gt; </span>sel.css(<span class="hljs-string">&#x27;div.quote span.text::text&#x27;</span>).extract()<br>[<span class="hljs-string">&#x27;“The world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.”&#x27;</span>, <span class="hljs-string">&#x27;“It is our choices, Harry, that show what we truly are, far more than our abilities.”&#x27;</span>, <span class="hljs-string">&#x27;“There are only two ways to live your life. One is as though nothing is a miracle. The other is as though everything is a miracle.”&#x27;</span>, <span class="hljs-string">&#x27;“The person, be it gentleman or lady, who has not pleasure in a good novel, must be intolerably stupid.”&#x27;</span>, <span class="hljs-string">&quot;“Imperfection is beauty, madness is genius and it&#x27;s better to be absolutely ridiculous than absolutely boring.”&quot;</span>, <span class="hljs-string">&#x27;“Try not to become a man of success. Rather become a man of value.”&#x27;</span>, <span class="hljs-string">&#x27;“It is better to be hated for what you are than to be loved for what you are not.”&#x27;</span>, <span class="hljs-string">&quot;“I have not failed. I&#x27;ve just found 10,000 ways that won&#x27;t work.”&quot;</span>, <span class="hljs-string">&quot;“A woman is like a tea bag; you never know how strong it is until it&#x27;s in hot water.”&quot;</span>, <span class="hljs-string">&#x27;“A day without sunshine is like, you know, night.”&#x27;</span>]<br></code></pre></div></td></tr></table></figure><p>在上述代码中，依据文档中的描述设置参数<code>url</code>、<code>timeout</code>、<code>images</code>，然后发送HTTP请求到服务接口地址。从运行结果看出，页面渲染成功，我们爬取到了页面中的10条名人名言。</p><h3 id="execute端点"><a href="#execute端点" class="headerlink" title="execute端点"></a>execute端点</h3><p>在爬取某些页面时，我们想在页面中执行一些用户自定义的JavaScript代码，例如，用JavaScript模拟点击页面中的按钮，或调用页面中的JavaScript函数与服务器交互，利用Splash的execute端点提供的服务可以实现这样的功能。</p><table><thead><tr><th>服务端点</th><th>execute</th></tr></thead><tbody><tr><td>请求地址</td><td><a href="http://localhost:8050/execute">http://localhost:8050/execute</a></td></tr><tr><td>请求方式</td><td>POST</td></tr><tr><td>返回类型</td><td>自定义</td></tr></tbody></table><p>execute端点支持的参数：</p><table><thead><tr><th>参数</th><th>必选/可选</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>lua_source</td><td>必选</td><td>string</td><td>用户自定义的lua脚本</td></tr><tr><td>timeout</td><td>可选</td><td>float</td><td>渲染页面的超时时间</td></tr><tr><td>proxy</td><td>可选</td><td>string</td><td>代理服务器地址</td></tr></tbody></table><p>可以将execute端点的服务看作一个可用<code>lua</code>语言编程的浏览器，功能类似于<code>PhantomJS</code>。使用时需传递一个用户自定义的<code>lua</code>脚本给Splash，该<code>lua</code>脚本中包含用户想要模拟的浏览器行为，例如：</p><ul><li>打开某<code>url</code>地址的页面</li><li>等待页面加载及渲染</li><li>执行JavaScript代码</li><li>获取HTTP响应头部</li><li>获取Cookie</li></ul><p>下面是使用requests库调用execute端点服务的示例代码。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> requests<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> json<br><span class="hljs-meta">&gt;&gt;&gt; </span>lua_scrpit = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string"><span class="hljs-meta">... </span>    function main(splash)</span><br><span class="hljs-string"><span class="hljs-meta">... </span>        splash:go(&quot;http://example.com&quot;)</span><br><span class="hljs-string"><span class="hljs-meta">... </span>        splash: wait(0.5)</span><br><span class="hljs-string"><span class="hljs-meta">... </span>        local title=splash:evaljs(&quot;document.title&quot;)</span><br><span class="hljs-string"><span class="hljs-meta">... </span>        return&#123;title=title)</span><br><span class="hljs-string"><span class="hljs-meta">... </span>    end</span><br><span class="hljs-string"><span class="hljs-meta">... </span>&#x27;&#x27;&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>splash_url = <span class="hljs-string">&#x27;http://localhost:8050/execute&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>headers = &#123;<span class="hljs-string">&#x27;content-type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>data = json.dumps(&#123;<span class="hljs-string">&#x27;lua_source&#x27;</span>: lua_scrpit&#125;)<br><span class="hljs-meta">&gt;&gt;&gt; </span>response = requests.post(splash_url, headers=headers, data=data)<br><span class="hljs-meta">&gt;&gt;&gt; </span>response<br>&lt;Response [<span class="hljs-number">400</span>]&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>response.json()<br>&#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-number">400</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;ScriptError&#x27;</span>, <span class="hljs-string">&#x27;description&#x27;</span>: <span class="hljs-string">&#x27;Error happened while executing Lua script&#x27;</span>, <span class="hljs-string">&#x27;info&#x27;</span>: &#123;<span class="hljs-string">&#x27;source&#x27;</span>: <span class="hljs-string">&#x27;[string &quot;...&quot;]&#x27;</span>, <span class="hljs-string">&#x27;line_number&#x27;</span>: <span class="hljs-number">6</span>, <span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&quot;&#x27;&#125;&#x27; expected near &#x27;)&#x27;&quot;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LUA_INIT_ERROR&#x27;</span>, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;[string &quot;...&quot;]:6: \&#x27;&#125;\&#x27; expected near \&#x27;)\&#x27;&#x27;</span>&#125;&#125;<br></code></pre></div></td></tr></table></figure><p>用户自定义的<code>lua</code>脚本中必须包含一个<code>main</code>函数作为程序入口，<code>main</code>函数被调用时会传入一个<code>splash</code>对象（<code>lua</code>中的对象），用户可以调用该对象上的方法操纵<code>Splash</code>。例如，在上面的例子中，先调用go方法打开某页面，再调用wait方法等待页面渲染，然后调用<code>evaljs</code>方法执行一个JavaScript表达式，并将结果转化为相应的<code>lua</code>对象，最终Splash根据main函数的返回值构造HTTP响应返回给用户，main函数的返回值可以是字符串，也可以是<code>lua</code>中的表（类似Python字典），表会被编码成<code>json</code>串。</p><p>splash对象常用的属性和方法。</p><ul><li><p><code>splash.args</code>属性</p><p>用户传入参数的表，通过该属性可以访问用户传入的参数，如<code>splash.args.url</code>、<code>splash.args.wait</code>。</p></li><li><p> <code>splash.js_enabled</code>属性</p></li></ul><p>  用于开启/禁止JavaScript渲染，默认为true。</p><ul><li><p><code>splash.images_enabled</code>属性</p><p>用于开启/禁止图片加载，默认为true。</p></li><li><p><code>splash:go</code>方法</p><p><code>splash:go&#123;url, baseurl=nil, headers=nil, http_method=&quot;GET&quot;,body=nil, formdata=nil&#125;</code></p><p>类似于在浏览器中打开某url地址的页面，页面所需资源会被加载，并进行JavaScript渲染，可以通过参数指定HTTP请求头部、请求方法、表单数据等。</p></li><li><p><code>splash:wait</code>方法</p><p><code>splash:wait&#123;time, cancel_on_redirect=false, cancel_on_error=true&#125;</code></p><p>等待页面渲染，time参数为等待的秒数。</p></li><li><p><code>splash:evaljs</code>方法</p><p><code>splash:evaljs(snippet)</code></p><p>在当前页面下，执行一段JavaScript代码，并返回最后一句表达式的值。</p></li><li><p> <code>splash:runjs</code>方法</p></li></ul><p>  <code>splash:runjs(snippet)</code></p><p>  在当前页面下，执行一段JavaScript代码，与evaljs方法相比，该函数只执行JavaScript代码，不返回值。</p><ul><li><p><code>splash:url</code>方法</p><p><code>splash:url()</code></p><p>获取当前页面的<code>url</code>。</p></li><li><p><code>splash:html</code>方法</p><p><code>splash:html()</code></p><p>获取当前页面的HTML文本。</p></li><li><p><code>splash:get_cookies</code>方法</p><p><code>splash:get_cookies()</code></p><p>获取全部Cookie信息．</p></li></ul><h2 id="在Scrapy中使用Splash"><a href="#在Scrapy中使用Splash" class="headerlink" title="在Scrapy中使用Splash"></a>在Scrapy中使用Splash</h2><p>如何在<code>Scrapy</code>中调用<code>Splash</code>服务，Python库的<code>scrapy-splash</code>是非常好的选择。</p><p>使用pip安装<code>scrapy-splash</code>：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install scrapy-splash<br></code></pre></div></td></tr></table></figure><p>在项目环境中讲解<code>scrapy-splash</code>的使用，创建一个<code>Scrapy</code>项目，取名为<code>splash_examples</code>：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy startproject scrapy-splash<br></code></pre></div></td></tr></table></figure><p>首先在项目配置文件<code>settings.py</code>中对<code>scrapy-splash</code>进行配置，添加内容如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># Splash服务器地址</span><br>SPLASH_URL = <span class="hljs-string">&#x27;http://localhost:8050&#x27;</span><br><br><span class="hljs-comment"># 开启Splash的两个下载中间件并调整HttpCompressionMiddleware的次序</span><br>DOWNLOADER_MIDDLEWARES = &#123;<br>    <span class="hljs-string">&#x27;scrapy_splash.SplashCookiesMiddleware&#x27;</span>: <span class="hljs-number">723</span>,<br>    <span class="hljs-string">&#x27;scrapy_splash.SplashMiddleware&#x27;</span>: <span class="hljs-number">725</span>,<br>    <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware&#x27;</span>: <span class="hljs-number">810</span>,<br>&#125;<br><br><span class="hljs-comment"># 设置去重过滤器</span><br>DUPEFILTER_CLASS = <span class="hljs-string">&#x27;scrapy_splash.SplashAwareDupeFilter&#x27;</span><br><br><span class="hljs-comment"># 用来支持cache_args(可选）</span><br>SPIDER_MIDDLEWARES = &#123;<br>    <span class="hljs-string">&#x27;scrapy_splash.SplashDeduplicateArgsMiddleware&#x27;</span>: <span class="hljs-number">100</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>编写Spider代码过程中，使用<code>scrapy_splash</code>调用Splash服务非常简单，<code>scrapy_splash</code>中定义了一个<code>SplashRequest</code>类，用户只需使用<code>scrapy_splash.SplashRequest</code>（替代<code>scrapy.Request</code>）提交请求即可。下面是<code>SplashRequest</code>构造器方法中的一些常用参数。</p><ul><li><p><code>url</code></p><p>与<code>scrapy.Request</code>中的<code>url</code>相同，也就是待爬取页面的<code>url</code>（注意，不是Splash服务器地址）。</p></li><li><p><code>headers</code></p><p>与<code>scrapy.Request</code>中的<code>headers</code>相同。</p></li><li><p><code>cookies</code></p><p>与<code>scrapy.Request</code>中的<code>cookies</code>相同。</p></li><li><p><code>args</code></p><p>传递给Splash的参数（除<code>url</code>以外），如<code>wait</code>、<code>timeout</code>、<code>images</code>、<code>js_source</code>等。</p></li><li><p><code>cache_args</code></p><p>如果<code>args</code>中的某些参数每次调用都重复传递并且数据量较大（例如一段JavaScript代码），此时可以把该参数名填入<code>cache_args</code>列表中，让Splash服务器缓存该参数，如<code>SplashRequest(url,args= &#123;&#39;js_source&#39;: js,&#39;wait&#39;: 0.5&#125;, cache_args = [&#39;js_source&#39;])</code>。</p></li><li><p><code>endpointSplash</code></p><p>服务端点，默认为<code>’render.html&#39;</code>，即JavaScript页面渲染服务，该参数可以设置为<code>’render.json&#39;</code>、<code>&#39;render.har&#39;</code>、<code>&#39;render.png&#39;</code>、<code>&#39;render.jpeg&#39;</code>、<code>&#39;execute’</code>等</p></li><li><p><code>splash_url</code></p><p>Splash服务器地址，默认为None，即使用配置文件中<code>SPLASH_URL</code>的地址。</p></li></ul><h2 id="项目实战：爬取toscrape中的名人名言"><a href="#项目实战：爬取toscrape中的名人名言" class="headerlink" title="项目实战：爬取toscrape中的名人名言"></a>项目实战：爬取toscrape中的名人名言</h2><p>首先，在<code>splash_examples</code>项目目录下创建Spider：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy genspider quotes quotes.toscrape.com<br></code></pre></div></td></tr></table></figure><p>接下来只需使用Splash的<code>render.html</code>端点渲染页面，再进行爬取即可实现<code>QuotesSpider</code>，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-keyword">import</span> scrapy<br><span class="hljs-keyword">from</span> scrapy_splash <span class="hljs-keyword">import</span> SplashRequest<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuotesSpider</span>(<span class="hljs-params">scrapy.Spider</span>):</span><br>    name = <span class="hljs-string">&#x27;quotes&#x27;</span><br>    allowed_domains = [<span class="hljs-string">&#x27;quotes.toscrape.com&#x27;</span>]<br>    start_urls = [<span class="hljs-string">&#x27;http://quotes.toscrape.com/js/&#x27;</span>]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start_requests</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> self.start_urls:<br>            <span class="hljs-comment"># 不下载图片，超时时间3秒</span><br>            <span class="hljs-keyword">yield</span> SplashRequest(url, args=&#123;<span class="hljs-string">&#x27;images&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;timeout&#x27;</span>: <span class="hljs-number">3</span>&#125;)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span><br>        <span class="hljs-keyword">for</span> sel <span class="hljs-keyword">in</span> response.css(<span class="hljs-string">&#x27;div.quote&#x27;</span>):<br>            quote = sel.css(<span class="hljs-string">&#x27;span.text::text&#x27;</span>).extract_first()<br>            author = sel.css(<span class="hljs-string">&#x27;small.author::text&#x27;</span>).extract_first()<br>            <span class="hljs-keyword">yield</span> &#123;<span class="hljs-string">&#x27;quote&#x27;</span>: quote, <span class="hljs-string">&#x27;author&#x27;</span>: author&#125;<br>        href = response.css(<span class="hljs-string">&#x27;li.next &gt; a::attr(href)&#x27;</span>).extract_first()<br>        <span class="hljs-keyword">if</span> href:<br>            url = response.urljoin(href)<br>            <span class="hljs-keyword">yield</span> SplashRequest(url, args=&#123;<span class="hljs-string">&#x27;images&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;timeout&#x27;</span>: <span class="hljs-number">3</span>&#125;)<br></code></pre></div></td></tr></table></figure><p>上述代码中，使用<code>SplashRequest</code>提交请求，在<code>SplashRequest</code>的构造器中无须传递<code>endpoint</code>参数，因为该参数默认值便是<code>’render.html&#39;</code>。使用<code>args</code>参数禁止<code>Splash</code>加载图片，并设置渲染超时时间。</p><p>运行爬虫，观察结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(Spiders) [root@VM-<span class="hljs-number">8</span>-<span class="hljs-number">16</span>-centos splash_examples]<span class="hljs-comment"># scrapy crawl quotes -o quotes.csv</span><br>(Spiders) [root@VM-<span class="hljs-number">8</span>-<span class="hljs-number">16</span>-centos splash_examples]<span class="hljs-comment"># cat quotes.csv </span><br>quote,author<br>“The world <span class="hljs-keyword">as</span> we have created it <span class="hljs-keyword">is</span> a process of our thinking. It cannot be changed without changing our thinking.”,Albert Einstein<br><span class="hljs-string">&quot;“It is our choices, Harry, that show what we truly are, far more than our abilities.”&quot;</span>,J.K. Rowling<br>“There are only two ways to live your life. One <span class="hljs-keyword">is</span> <span class="hljs-keyword">as</span> though nothing <span class="hljs-keyword">is</span> a miracle. The other <span class="hljs-keyword">is</span> <span class="hljs-keyword">as</span> though everything <span class="hljs-keyword">is</span> a miracle.”,Albert Einstein<br><span class="hljs-string">&quot;“The person, be it gentleman or lady, who has not pleasure in a good novel, must be intolerably stupid.”&quot;</span>,Jane Austen<br><span class="hljs-string">&quot;“Imperfection is beauty, madness is genius and it&#x27;s better to be absolutely ridiculous than absolutely boring.”&quot;</span>,Marilyn Monroe<br>“Try <span class="hljs-keyword">not</span> to become a man of success. Rather become a man of value.”,Albert Einstein<br>“It <span class="hljs-keyword">is</span> better to be hated <span class="hljs-keyword">for</span> what you are than to be loved <span class="hljs-keyword">for</span> what you are <span class="hljs-keyword">not</span>.”,André Gide<br><span class="hljs-string">&quot;“I have not failed. I&#x27;ve just found 10,000 ways that won&#x27;t work.”&quot;</span>,Thomas A. Edison<br>“A woman <span class="hljs-keyword">is</span> like a tea bag; you never know how strong it <span class="hljs-keyword">is</span> until it<span class="hljs-string">&#x27;s in hot water.”,Eleanor Roosevelt</span><br><span class="hljs-string">&quot;“A day without sunshine is like, you know, night.”&quot;,Steve Martin</span><br><span class="hljs-string">&quot;“This life is what you make it. No matter what, you&#x27;</span>re going to mess up sometimes, it<span class="hljs-string">&#x27;s a universal truth. But the good part is you get to decide how you&#x27;</span>re going to mess it up. Girls will be your friends - they<span class="hljs-string">&#x27;ll act like it anyway. But just remember, some come, some go. The ones that stay with you through everything - they&#x27;</span>re your true best friends. Don<span class="hljs-string">&#x27;t let go of them. Also remember, sisters make the best friends in the world. As for lovers, well, they&#x27;</span>ll come <span class="hljs-keyword">and</span> go too. And baby, I hate to say it, most of them - actually pretty much <span class="hljs-built_in">all</span> of them are going to <span class="hljs-keyword">break</span> your heart, but you can<span class="hljs-string">&#x27;t give up because if you give up, you&#x27;</span>ll never find your soulmate. Yo<span class="hljs-string">u&#x27;ll never find that half who makes you whole and that goes for everything. Just because you fail once, doesn&#x27;</span>t mean yo<span class="hljs-string">u&#x27;re gonna fail at everything. Keep trying, hold on, and always, always, always believe in yourself, because if you don&#x27;</span>t, then who will, sweetie? So keep your head high, keep your chin up, <span class="hljs-keyword">and</span> most importantly, keep smiling, because life<span class="hljs-string">&#x27;s a beautiful thing and there&#x27;</span>s so much to smile about.”<span class="hljs-string">&quot;,Marilyn Monroe</span><br><span class="hljs-string">...</span><br></code></pre></div></td></tr></table></figure><p>运行结果显示，我们成功爬取了10个页面中的100条名人名言。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>scrapy</tag>
      
      <tag>splash</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cookie登录</title>
    <link href="/2021/08/14/Cookie%E7%99%BB%E5%BD%95/"/>
    <url>/2021/08/14/Cookie%E7%99%BB%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p>在使用浏览器登录网站后，包含用户身份信息的<code>Cookie</code>会被浏览器保存在本地，如果<code>Scrapy</code>爬虫能直接使用浏览器中的<code>Cookie</code>发送<code>HTTP</code>请求，就可以绕过提交表单登录的步骤。</p><h2 id="获取浏览器Cookie"><a href="#获取浏览器Cookie" class="headerlink" title="获取浏览器Cookie"></a>获取浏览器Cookie</h2><p>使用第三方Python库<code>browsercookie</code>可以获取Chrome和Firefox浏览器中的Cookie。</p><p>使用pip安装<code>browsercookie</code>：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install browsercookie<br></code></pre></div></td></tr></table></figure><p><code>browsercookie</code>的使用非常简单，示例代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cookie</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>爬取matplotlib例子源码文件</title>
    <link href="/2021/08/14/%E7%88%AC%E5%8F%96matplotlib%E4%BE%8B%E5%AD%90%E6%BA%90%E7%A0%81%E6%96%87%E4%BB%B6/"/>
    <url>/2021/08/14/%E7%88%AC%E5%8F%96matplotlib%E4%BE%8B%E5%AD%90%E6%BA%90%E7%A0%81%E6%96%87%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="项目实战：爬取matplotlib例子源码文件"><a href="#项目实战：爬取matplotlib例子源码文件" class="headerlink" title="项目实战：爬取matplotlib例子源码文件"></a>项目实战：爬取matplotlib例子源码文件</h1><p>matplotlib是一个非常著名的Python绘图库，广泛应用于科学计算和数据分析等领域。在matplotlib网站上提供了许多应用例子代码，在浏览器中访问<a href="https://matplotlib.org/2.0.2/examples/index.html">Matplotlib Examples — Matplotlib 2.0.2 documentation</a>，可看到下图页面。</p><p><img src="image-20210814140923483.png"></p><p>其中有几百个例子，被分成多个类别，单击第一个例子，进入其页面，如图所示。</p><img src="/image-20210814141011589.png" style="zoom:67%;" /><p>用户可以在每个例子页面中阅读源码，也可以点击页面中的<code>source code</code>按钮下载源码文件。如果我们想把所有例子的源码文件都下载到本地，可以编写一个爬虫程序完成这个任务。</p><h2 id="项目需求"><a href="#项目需求" class="headerlink" title="项目需求"></a>项目需求</h2><p>下载<a href="http://matplotlib.org网站中所有例子的源码文件到本地./">http://matplotlib.org网站中所有例子的源码文件到本地。</a></p><h2 id="页面分析"><a href="#页面分析" class="headerlink" title="页面分析"></a>页面分析</h2><p>先来看如何在例子列表页面<a href="https://matplotlib.org/2.0.2/examples/index.html">https://matplotlib.org/2.0.2/examples/index.html</a>中获取所有例子页面的链接。使用<code>scrapy shell</code>命令下载页面，然后调用<code>view</code>函数在浏览器中查看页面，如图所示。</p><p><img src="image-20210814141609306.png"></p><p>观察发现，所有例子页面的链接都在<code>&lt;div class=&quot;toctree-wrappercompound&quot;&gt;</code>下的每一个<code>&lt;li class=&quot;toctree-l2&quot;&gt;</code>中，例如：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;a <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">reference</span> <span class="hljs-title">internal</span>&quot; <span class="hljs-title">href</span>=&quot;<span class="hljs-title">animation</span>/<span class="hljs-title">index</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">animation</span> <span class="hljs-title">Examples</span>&lt;/<span class="hljs-title">a</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>使用<code>LinkExtractor</code>提取所有例子页面的链接，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> scrapy.linkextractors <span class="hljs-keyword">import</span> LinkExtractor<br><span class="hljs-meta">&gt;&gt;&gt; </span>le = LinkExtractor(restrict_css=<span class="hljs-string">&#x27;div.toctree-wrapper.compound li.toctree-l2&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>links = le.extract_links(response)<br><span class="hljs-meta">&gt;&gt;&gt; </span>[link.url <span class="hljs-keyword">for</span> link <span class="hljs-keyword">in</span> links]<br>[<span class="hljs-string">&#x27;https://matplotlib.org/2.0.2/examples/animation/animate_decay.html&#x27;</span>, <span class="hljs-string">&#x27;https://matplotlib.org/2.0.2/examples/animation/basic_example.html&#x27;</span>, <span class="hljs-string">&#x27;https</span><br><span class="hljs-string">://matplotlib.org/2.0.2/examples/animation/basic_example_writer.html&#x27;</span>, <span class="hljs-string">&#x27;https://matplotlib.org/2.0.2/examples/animation/bayes_update.html&#x27;</span>, <span class="hljs-string">&#x27;https:</span><br><span class="hljs-string">//matplotlib.org/2.0.2/examples/animation/double_pendulum_animated.html&#x27;</span>, <span class="hljs-string">&#x27;https://matplotlib.org/2.0.2/examples/animation/dynamic_image.html&#x27;</span>, <span class="hljs-string">&#x27;ht</span><br><span class="hljs-string">tps://matplotlib.org/2.0.2/examples/animation/dynamic_image2.html&#x27;</span>, <br> ...<br></code></pre></div></td></tr></table></figure><p>例子列表页面分析完毕，总共找到了507个例子。</p><p>接下来分析例子页面。调用fetch函数下载第一个例子页面，并调用view函数在浏览器中查看页面，如图所示。</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pyt">&gt;&gt;&gt; fetch(&#x27;https://matplotlib.org/2.0.2/examples/animation/animate_decay.html&#x27;)<br>2021-08-14 15:00:33 [scrapy.core.engine] DEBUG: Crawled (200) &lt;GET https://matplotlib.org/2.0.2/examples/animation/animate_decay.html&gt; (referer: No<br>ne)<br>&gt;&gt;&gt; view(response)<br>True<br></code></pre></div></td></tr></table></figure><p><img src="image-20210814150107493.png"></p><p>在一个例子页面中，例子源码文件的下载地址可在<code>&lt;a class=&quot;referenceexternal&quot;&gt;</code>中找到：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>href = response.css(<span class="hljs-string">&#x27;a.reference.external::attr(href)&#x27;</span>).extract_first()<br><span class="hljs-meta">&gt;&gt;&gt; </span>href<br><span class="hljs-string">&#x27;animate_decay.py&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>response.urljoin(href)<br><span class="hljs-string">&#x27;https://matplotlib.org/2.0.2/examples/animation/animate_decay.py&#x27;</span><br></code></pre></div></td></tr></table></figure><p>到此，页面分析的工作完成了。</p><h3 id="编码实现"><a href="#编码实现" class="headerlink" title="编码实现"></a>编码实现</h3><p>接下来，我们按以下4步完成该项目：</p><p>（1）创建Scrapy项目，并使用<code>scrapy genspider</code>命令创建<code>Spider</code>。</p><p>（2）在配置文件中启用FilesPipeline，并指定文件下载目录。</p><p>（3）实现<code>ExampleItem</code>（可选）。</p><p>（4）实现<code>ExamplesSpider</code>。</p><p><strong>步骤01</strong> 首先创建<code>Scrapy</code>项目，取名为<code>matplotlib_examples</code>，再使用<code>scrapygenspider</code>命令创建<code>Spider</code>：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">$ scrapy startproject matplotlib_examples<br>$ cd matplotlib_examples<br>$ scrapy genspider examples matplotlib.org<br></code></pre></div></td></tr></table></figure><p><strong>步骤02</strong> 在配置文件<code>settings.py</code>中启用<code>FilesPipeline</code>，并指定文件下载目录，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">ITEM_PIPELINES = &#123;<br>    <span class="hljs-string">&#x27;scrapy.pipelines.files.FilesPipeline&#x27;</span>: <span class="hljs-number">1</span>,<br>&#125;<br>FILES_STORE = <span class="hljs-string">&#x27;examples_src&#x27;</span><br></code></pre></div></td></tr></table></figure><p><strong>步骤03</strong> 实现<code>ExampleItem</code>，需定义<code>file_urls</code>和<code>files</code>两个字段，在<code>items.py</code>中完成如下代码：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExampleItem</span>(<span class="hljs-params">scrapy.Item</span>):</span><br>    file_urls = scrapy.Field()<br>    files = scrapy.Field()<br></code></pre></div></td></tr></table></figure><p><strong>步骤04</strong> 实现<code>ExamplesSpider</code>。首先设置起始爬取点：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> scrapy<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExamplesSpider</span>(<span class="hljs-params">scrapy.Spider</span>):</span><br>    name = <span class="hljs-string">&#x27;examples&#x27;</span><br>    allowed_domains = [<span class="hljs-string">&#x27;matplotlib.org&#x27;</span>]<br>    start_urls = [<span class="hljs-string">&#x27;https://matplotlib.org/2.0.2/examples/index.html&#x27;</span>]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span><br>        <span class="hljs-keyword">pass</span><br></code></pre></div></td></tr></table></figure><p><code>parse</code>方法是例子列表页面的解析函数，在该方法中提取每个例子页面的链接，用其构造<code>Request</code>对象并提交，实现parse方法的代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> scrapy<br><span class="hljs-keyword">from</span> scrapy.linkextractors <span class="hljs-keyword">import</span> LinkExtractor<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExamplesSpider</span>(<span class="hljs-params">scrapy.Spider</span>):</span><br>    name = <span class="hljs-string">&#x27;examples&#x27;</span><br>    allowed_domains = [<span class="hljs-string">&#x27;matplotlib.org&#x27;</span>]<br>    start_urls = [<span class="hljs-string">&#x27;https://matplotlib.org/2.0.2/examples/index.html&#x27;</span>]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span><br>        le = LinkExtractor(restrict_css=<span class="hljs-string">&#x27;div.toctree-wrapper.compound&#x27;</span>, deny=<span class="hljs-string">&#x27;/index.html&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(le.extract_links(response)))<br>        <span class="hljs-keyword">for</span> link <span class="hljs-keyword">in</span> le.extract_links(response):<br>            <span class="hljs-keyword">yield</span> scrapy.Request(link.url, callback=self.parse_example)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_example</span>(<span class="hljs-params">self, response</span>):</span><br>        <span class="hljs-keyword">pass</span><br></code></pre></div></td></tr></table></figure><p>面代码中，我们将例子页面的解析函数设置为<code>parse_example</code>方法，下面来实现这个方法。例子页面中包含了例子源码文件的下载链接，在<code>parse_example</code>方法中获取源码文件的url，将其放入一个列表，赋给<code>ExampleItem</code>的<code>file_urls</code>字段。实现<code>parse_example</code>方法的代码如下：</p> <figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> scrapy<br><span class="hljs-keyword">from</span> scrapy.linkextractors <span class="hljs-keyword">import</span> LinkExtractor<br><span class="hljs-keyword">from</span> ..items <span class="hljs-keyword">import</span> ExampleItem<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExamplesSpider</span>(<span class="hljs-params">scrapy.Spider</span>):</span><br>    name = <span class="hljs-string">&#x27;examples&#x27;</span><br>    allowed_domains = [<span class="hljs-string">&#x27;matplotlib.org&#x27;</span>]<br>    start_urls = [<span class="hljs-string">&#x27;https://matplotlib.org/2.0.2/examples/index.html&#x27;</span>]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span><br>        le = LinkExtractor(restrict_css=<span class="hljs-string">&#x27;div.toctree-wrapper.compound&#x27;</span>, deny=<span class="hljs-string">&#x27;/index.html&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(le.extract_links(response)))<br>        <span class="hljs-keyword">for</span> link <span class="hljs-keyword">in</span> le.extract_links(response):<br>            <span class="hljs-keyword">yield</span> scrapy.Request(link.url, callback=self.parse_example)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_example</span>(<span class="hljs-params">self, response</span>):</span><br>        href = response.css(<span class="hljs-string">&#x27;a.reference.external::attr(href)&#x27;</span>).extract_first()<br>        url = response.urljoin(href)<br>        example = ExampleItem()<br>        example[<span class="hljs-string">&#x27;file_urls&#x27;</span>] = [url]<br>        <span class="hljs-keyword">return</span> example<br></code></pre></div></td></tr></table></figure><p>编码完成后，运行爬虫，并观察结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy crawl examples -o examples.json<br></code></pre></div></td></tr></table></figure><p>运行结束后，在文件examples.json中可以查看到文件下载结果信息：</p><p><img src="image-20210814160121208.png"></p><p>再来查看文件下载目录exmaples_src：</p><p><img src="image-20210814155737440.png"></p><p>507个源码文件被下载到了<code>examples_src/full</code>目录下，并且每个文件的名字都是一串长度相等的奇怪数字，这些数字是下载文件url的<code>sha1</code>散列值。</p><p>这种命名方式可以防止重名的文件相互覆盖，但这样的文件名太不直观了，无法从文件名了解文件内容，我们期望把这些例子文件按照类别下载到不同目录下，为完成这个任务，可以写一个单独的脚本，依据<code>examples.json</code>文件中的信息将文件重命名，也可以修改<code>FilesPipeline</code>为文件命名的规则，这里采用后一种方式。</p><p>阅读<code>FilesPipeline</code>的源码发现，原来是其中的<code>file_path</code>方法决定了文件的命名，相关代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">file_path</span>(<span class="hljs-params">self, request, response=<span class="hljs-literal">None</span>, info=<span class="hljs-literal">None</span>, *, item=<span class="hljs-literal">None</span></span>):</span><br>    media_guid = hashlib.sha1(to_bytes(request.url)).hexdigest()<br>    media_ext = os.path.splitext(request.url)[<span class="hljs-number">1</span>]<br>    <span class="hljs-comment"># Handles empty and wild extensions by trying to guess the</span><br>    <span class="hljs-comment"># mime type then extension or default to empty string otherwise</span><br>    <span class="hljs-keyword">if</span> media_ext <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> mimetypes.types_map:<br>        media_ext = <span class="hljs-string">&#x27;&#x27;</span><br>        media_type = mimetypes.guess_type(request.url)[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">if</span> media_type:<br>            media_ext = mimetypes.guess_extension(media_type)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;full/<span class="hljs-subst">&#123;media_guid&#125;</span><span class="hljs-subst">&#123;media_ext&#125;</span>&#x27;</span><br></code></pre></div></td></tr></table></figure><p>现在，我们实现一个<code>FilesPipeline</code>的子类，覆写<code>file_path</code>方法来实现所期望的文件命名规则，这些源码文件url<code>的</code>最后两部分是类别和文件名，例如：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">https://matplotlib.org/<span class="hljs-number">2.0</span><span class="hljs-number">.2</span>/examples/animation/(animate_decay.py)<br></code></pre></div></td></tr></table></figure><p>可用以上括号中的部分作为文件路径，在<code>pipelines.py</code>实现<code>MyFilesPipeline</code>，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urlparse<br><span class="hljs-keyword">from</span> os.path <span class="hljs-keyword">import</span> basename, dirname, join<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFilePipline</span>(<span class="hljs-params">FilesPipeline</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">file_path</span>(<span class="hljs-params">self, request, response=<span class="hljs-literal">None</span>, info=<span class="hljs-literal">None</span></span>):</span><br>        path = urlparse(request.url).path<br>        <span class="hljs-keyword">return</span> join(basename(dirname(path)), basename(path))<br></code></pre></div></td></tr></table></figure><p>修改配置文件，使用<code>MyFilesPipeline</code>替代<code>FilesPipeline</code>：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">ITEM_PIPELINES = &#123;<br>    <span class="hljs-comment"># &#x27;scrapy.pipelines.files.FilesPipeline&#x27;: 1,</span><br>    <span class="hljs-string">&#x27;matplotlib_examples.pipelines.MyFilePipline&#x27;</span>: <span class="hljs-number">1</span>,<br>&#125;<br></code></pre></div></td></tr></table></figure><p>删除之前下载的所有文件，重新运行爬虫后，再来查看<code>examples_src</code>目录：</p><p><img src="image-20210814161729928.png"></p><p>从上述结果看出，507个文件按类别被下载到26个目录下，这正是我们所期望的。</p><p>到此，文件下载的项目完成了。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>scrapy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Scrapy下载文件和图片</title>
    <link href="/2021/08/14/Scrapy%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E5%92%8C%E5%9B%BE%E7%89%87/"/>
    <url>/2021/08/14/Scrapy%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E5%92%8C%E5%9B%BE%E7%89%87/</url>
    
    <content type="html"><![CDATA[<h1 id="下载文件和图片"><a href="#下载文件和图片" class="headerlink" title="下载文件和图片"></a>下载文件和图片</h1><h2 id="FilesPipeline和ImagesPipeline"><a href="#FilesPipeline和ImagesPipeline" class="headerlink" title="FilesPipeline和ImagesPipeline"></a><code>FilesPipeline</code>和<code>ImagesPipeline</code></h2><p><code>Scrapy</code>框架内部提供了两个<code>Item Pipeline</code>，专门用于下载文件和图片：</p><ul><li><code>FilesPipeline</code></li><li><code>ImagesPipeline</code></li></ul><p>我们可以将这两个<code>Item Pipeline</code>看作特殊的下载器，用户使用时只需要通过<code>item</code>的一个特殊字段将要下载文件或图片的<code>url</code>传递给它们，它们会自动将文件或图片下载到本地，并将下载结果信息存入<code>item</code>的另一个特殊字段，以便用户在导出文件中查阅。</p><h3 id="FilesPipeline使用说明"><a href="#FilesPipeline使用说明" class="headerlink" title="FilesPipeline使用说明"></a><code>FilesPipeline</code>使用说明</h3><p>通过一个简单的例子讲解<code>FilesPipeline</code>的使用，在如下页面中可以下载多本<code>PDF</code>格式的小说：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    ...<br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/sg.pdf&quot;</span>&gt;</span>下载《三国演义》<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/shz.pdf&quot;</span>&gt;</span>下载《水浒传》<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/hlm.pdf&quot;</span>&gt;</span>下载《红楼梦》<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>使用<code>FilesPipeline</code>下载页面中所有<code>PDF</code>文件，可按以下步骤进行：</p><p><strong>步骤</strong>01 在配置文件<code>settings.py</code>中启用<code>FilesPipeline</code>，通常将其置于其他<code>ItemPipeline</code>之前：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">ITEM_PIPELINES = &#123;<span class="hljs-string">&#x27;scrapy.piplines.files.FilesPipline&#x27;</span>: <span class="hljs-number">1</span>&#125;<br></code></pre></div></td></tr></table></figure><p><strong>步骤02</strong> 在配置文件<code>settings.py</code>中，使用<code>FILES_STORE</code>指定文件下载目录，如：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">FILES_STORE = <span class="hljs-string">&#x27;/home/Dowload/Scrapy&#x27;</span><br></code></pre></div></td></tr></table></figure><p><code>步骤</code>03 在<code>Spider</code>解析一个包含文件下载链接的页面时，将所有需要下载文件的<code>url</code>地址收集到一个列表，赋给<code>item</code>的<code>file_urls</code>字段（<code>item[&#39;file_urls&#39;]</code>）。<code>FilesPipeline</code>在处理每一项<code>item</code>时，会读取<code>item[&#39;file_urls&#39;]</code>，对其中每一个<code>url</code>进行下载，<code>Spider</code>示例代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DownloadBoosSpider</span>(<span class="hljs-params">scrapy.Spider</span>):</span><br>    ...<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span><br>        item = &#123;&#125;<br>        <span class="hljs-comment"># 下载列表</span><br>        item[<span class="hljs-string">&#x27;file_urls&#x27;</span>] = []<br>        <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> response.xpath(<span class="hljs-string">&#x27;//a/@href&#x27;</span>).extract():<br>            download_url = response.urljoin(url)<br>            <span class="hljs-comment"># 将url填入列表</span><br>            item[<span class="hljs-string">&#x27;file_urls&#x27;</span>].append((download_url))<br>        <span class="hljs-keyword">yield</span> item<br></code></pre></div></td></tr></table></figure><p>当<code>FilesPipeline</code>下载完<code>item[&#39;file_urls&#39;]</code>中的所有文件后，会将各文件的下载结果信息收集到另一个列表，赋给<code>item</code>的<code>files</code>字段（<code>item[&#39;files&#39;]</code>）。下载结果信息包括以下内容：</p><ul><li><code>Path</code>文件下载到本地的路径（相对于<code>FILES_STORE</code>的相对路径）。</li><li> <code>Checksum</code>文件的校验和。</li><li> <code>url</code>文件的<code>url</code>地址。</li></ul><h3 id="ImagesPipeline使用说明"><a href="#ImagesPipeline使用说明" class="headerlink" title="ImagesPipeline使用说明"></a><code>ImagesPipeline</code>使用说明</h3><p>图片也是文件，所以下载图片本质上也是下载文件，<code>ImagesPipeline</code>是<code>FilesPipeline</code>的子类，使用上和<code>FilesPipeline</code>大同小异，只是在所使用的<code>item</code>字段和配置选项上略有差别。</p><table><thead><tr><th></th><th>FilePipLine</th><th>ImagePipline</th></tr></thead><tbody><tr><td>导入路径</td><td>scrapy.piplines.files.FilesPipline</td><td>scrapy.piplines.ImagesPipeline</td></tr><tr><td>Item字段</td><td>file_urls,files</td><td>image_urls,umage</td></tr><tr><td>下载目录</td><td>FILES_STORE</td><td>IMAGES_STORE</td></tr></tbody></table><p><code>ImagesPipeline</code>在<code>FilesPipleline</code>的基础上针对图片增加了一些特有的功能：</p><ul><li><p>为图片生成缩略图</p><p>开启该功能，只需在配置文件<code>settings.py</code>中设置<code>IMAGES_THUMBS</code>，它是一个字典，每一项的值是缩略图的尺寸，代码如下：</p></li></ul><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">IMAGES_THUMBS = &#123;<br>    <span class="hljs-string">&#x27;small&#x27;</span>: (<span class="hljs-number">50</span>, <span class="hljs-number">50</span>),<br>    <span class="hljs-string">&#x27;big&#x27;</span>: (<span class="hljs-number">270</span>, <span class="hljs-number">270</span>)<br>&#125;<br></code></pre></div></td></tr></table></figure><p>开启该功能后，下载一张图片时，本地会出现3张图片（1张原图片，2张缩略图）。</p><ul><li><p>过滤掉尺寸过小的图片</p><p>开启该功能，需在配置文件<code>settings.py</code>中设置<code>IMAGES_MIN_WIDTH</code>和<code>IMAGES_MIN_HEIGHT</code>，它们分别指定图片最小的宽和高，代码如下：</p></li></ul><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">IMAGES_MIN_WIDTH = <span class="hljs-number">10</span><br>IMAGES_MIN_HEIGHT = <span class="hljs-number">10</span><br></code></pre></div></td></tr></table></figure><p>开启该功能后，如果下载了一张105×200的图片，该图片就会被抛弃掉，因为它的宽度不符合标准。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>scrapy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>office学习</title>
    <link href="/2021/08/11/office%E5%AD%A6%E4%B9%A0/"/>
    <url>/2021/08/11/office%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="office-excel-怎么显示设置小数位数"><a href="#office-excel-怎么显示设置小数位数" class="headerlink" title="office excel 怎么显示设置小数位数"></a>office excel 怎么显示设置小数位数</h1><p>首先打开任一excel表格。</p><p><img src="image-20210811220957850.png"></p><p>选中要调整小数位数的单元格区域。</p><p><img src="image-20210811221135558.png"></p><p>方法1：点击 “开始” → “数字” 上面的 “增加小数位数” 或 “减少小数位数”来调整单元格小数位数。</p><p><img src="image-20210811221254448.png"></p><p>方法2：在选中的单元格区域，单击鼠标右键，在右键菜单中选择“设置单元格格式”，在弹出的对话框中，选择“数字”→“百分比”→ 选择小数位数。</p><p><img src="image-20210811221351056.png"></p><p><img src="image-20210811221451503.png"></p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Scrapy项目练习爬取books</title>
    <link href="/2021/08/11/Scrapy%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0%E7%88%AC%E5%8F%96books/"/>
    <url>/2021/08/11/Scrapy%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0%E7%88%AC%E5%8F%96books/</url>
    
    <content type="html"><![CDATA[<h2 id="项目需求"><a href="#项目需求" class="headerlink" title="项目需求"></a>项目需求</h2><p>目标网站：<a href="http://books.toscrape.com/">http://books.toscrape.com</a></p><p>网站截图：</p><p><img src="image-20210812145527146.png"></p><p>项目目标：</p><p>爬取<a href="http://books.toscrape.com网站中的书籍信息./">http://books.toscrape.com网站中的书籍信息。</a></p><p>（1）其中每一本书的信息包括：</p><p>​        ➢ 书名</p><p>​        ➢ 价格</p><p>​        ➢ 评价等级</p><p>​        ➢ 产品编码</p><p>​        ➢ 库存量</p><p>​        ➢ 评价数量</p><p>（2）将爬取的结果保存到<code>csv</code>文件中。</p><img src="image-20210812145846244.png" /><h2 id="页面分析"><a href="#页面分析" class="headerlink" title="页面分析"></a>页面分析</h2><p>首先，我们对一本书的页面进行分析。在进行页面分析时，除了之前使用过的<code>Chrome</code>开发者工具外，另一个常用的工具是<code>scrapy shell &lt;URL&gt;</code>命令，它使用户可以在交互式命令行下操作一个<code>Scrapy</code>爬虫，通常我们利用该工具进行前期爬取实验，从而提高开发效率。</p><p>接下来分析第一本书的页面，以页面的<code>url</code>地址为参数运行<code>scrapy shell</code>命令：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv) $ scrapy shell https://books.toscrape.com/catalogue/a-light-<span class="hljs-keyword">in</span>-the-attic_1000/index.html<br><span class="hljs-number">2021</span>-08-<span class="hljs-number">12</span> <span class="hljs-number">15</span>:04:<span class="hljs-number">28</span> [scrapy.utils.log] INFO: Scrapy <span class="hljs-number">2.5</span><span class="hljs-number">.0</span> started (bot: books)<br><span class="hljs-number">2021</span>-08-<span class="hljs-number">12</span> <span class="hljs-number">15</span>:04:<span class="hljs-number">28</span> [scrapy.utils.log] INFO: Versions: lxml <span class="hljs-number">4.6</span><span class="hljs-number">.3</span><span class="hljs-number">.0</span>, libxml2 <span class="hljs-number">2.9</span><span class="hljs-number">.5</span>, cssselect <span class="hljs-number">1.1</span><span class="hljs-number">.0</span>, parsel <span class="hljs-number">1.6</span><span class="hljs-number">.0</span>, w3lib <span class="hljs-number">1.22</span><span class="hljs-number">.0</span>, Twisted <span class="hljs-number">21.7</span><span class="hljs-number">.0</span>, Py<br>thon <span class="hljs-number">3.9</span><span class="hljs-number">.5</span> (tags/v3<span class="hljs-number">.9</span><span class="hljs-number">.5</span>:0a7dcbd, May  <span class="hljs-number">3</span> <span class="hljs-number">2021</span>, <span class="hljs-number">17</span>:<span class="hljs-number">27</span>:<span class="hljs-number">52</span>) [MSC v<span class="hljs-number">.1928</span> <span class="hljs-number">64</span> bit (AMD64)], pyOpenSSL <span class="hljs-number">20.0</span><span class="hljs-number">.1</span> (OpenSSL <span class="hljs-number">1.1</span><span class="hljs-number">.1</span>k  <span class="hljs-number">25</span> Mar <span class="hljs-number">2021</span>), cryptography <span class="hljs-number">3</span><br><span class="hljs-number">.4</span><span class="hljs-number">.7</span>, Platform Windows-<span class="hljs-number">10</span>-<span class="hljs-number">10.0</span><span class="hljs-number">.19041</span>-SP0<br><span class="hljs-number">2021</span>-08-<span class="hljs-number">12</span> <span class="hljs-number">15</span>:04:<span class="hljs-number">28</span> [scrapy.utils.log] DEBUG: Using reactor: twisted.internet.selectreactor.SelectReactor<br><span class="hljs-number">2021</span>-08-<span class="hljs-number">12</span> <span class="hljs-number">15</span>:04:<span class="hljs-number">28</span> [scrapy.crawler] INFO: Overridden settings:<br>&#123;<span class="hljs-string">&#x27;BOT_NAME&#x27;</span>: <span class="hljs-string">&#x27;books&#x27;</span>,<br> <span class="hljs-string">&#x27;DUPEFILTER_CLASS&#x27;</span>: <span class="hljs-string">&#x27;scrapy.dupefilters.BaseDupeFilter&#x27;</span>,<br> <span class="hljs-string">&#x27;LOGSTATS_INTERVAL&#x27;</span>: <span class="hljs-number">0</span>,<br> <span class="hljs-string">&#x27;NEWSPIDER_MODULE&#x27;</span>: <span class="hljs-string">&#x27;books.spiders&#x27;</span>,<br> <span class="hljs-string">&#x27;ROBOTSTXT_OBEY&#x27;</span>: <span class="hljs-literal">True</span>,<br> <span class="hljs-string">&#x27;SPIDER_MODULES&#x27;</span>: [<span class="hljs-string">&#x27;books.spiders&#x27;</span>]&#125;<br><span class="hljs-number">2021</span>-08-<span class="hljs-number">12</span> <span class="hljs-number">15</span>:04:<span class="hljs-number">28</span> [scrapy.extensions.telnet] INFO: Telnet Password: a610410a1da32370<br><span class="hljs-number">2021</span>-08-<span class="hljs-number">12</span> <span class="hljs-number">15</span>:04:<span class="hljs-number">28</span> [scrapy.middleware] INFO: Enabled extensions:<br>[<span class="hljs-string">&#x27;scrapy.extensions.corestats.CoreStats&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.extensions.telnet.TelnetConsole&#x27;</span>]<br><span class="hljs-number">2021</span>-08-<span class="hljs-number">12</span> <span class="hljs-number">15</span>:04:<span class="hljs-number">29</span> [scrapy.middleware] INFO: Enabled downloader middlewares:<br>[<span class="hljs-string">&#x27;scrapy.downloadermiddlewares.robotstxt.RobotsTxtMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.useragent.UserAgentMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.retry.RetryMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.redirect.RedirectMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.cookies.CookiesMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.stats.DownloaderStats&#x27;</span>]<br><span class="hljs-number">2021</span>-08-<span class="hljs-number">12</span> <span class="hljs-number">15</span>:04:<span class="hljs-number">29</span> [scrapy.middleware] INFO: Enabled spider middlewares:<br>[<span class="hljs-string">&#x27;scrapy.spidermiddlewares.httperror.HttpErrorMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.spidermiddlewares.offsite.OffsiteMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.spidermiddlewares.referer.RefererMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.spidermiddlewares.urllength.UrlLengthMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.spidermiddlewares.depth.DepthMiddleware&#x27;</span>]<br><span class="hljs-number">2021</span>-08-<span class="hljs-number">12</span> <span class="hljs-number">15</span>:04:<span class="hljs-number">29</span> [scrapy.middleware] INFO: Enabled item pipelines:<br>[]<br><span class="hljs-number">2021</span>-08-<span class="hljs-number">12</span> <span class="hljs-number">15</span>:04:<span class="hljs-number">29</span> [scrapy.extensions.telnet] INFO: Telnet console listening on <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6023</span><br><span class="hljs-number">2021</span>-08-<span class="hljs-number">12</span> <span class="hljs-number">15</span>:04:<span class="hljs-number">29</span> [scrapy.core.engine] INFO: Spider opened<br><span class="hljs-number">2021</span>-08-<span class="hljs-number">12</span> <span class="hljs-number">15</span>:04:<span class="hljs-number">31</span> [scrapy.core.engine] DEBUG: Crawled (<span class="hljs-number">404</span>) &lt;GET https://books.toscrape.com/robots.txt&gt; (referer: <span class="hljs-literal">None</span>)<br><span class="hljs-number">2021</span>-08-<span class="hljs-number">12</span> <span class="hljs-number">15</span>:04:<span class="hljs-number">32</span> [scrapy.core.engine] DEBUG: Crawled (<span class="hljs-number">200</span>) &lt;GET https://books.toscrape.com/catalogue/a-light-<span class="hljs-keyword">in</span>-the-attic_1000/index.html&gt; (referer: <span class="hljs-literal">None</span>)<br>[s] Available Scrapy objects:<br>[s]   scrapy     scrapy module (contains scrapy.Request, scrapy.Selector, etc)<br>[s]   crawler    &lt;scrapy.crawler.Crawler <span class="hljs-built_in">object</span> at <span class="hljs-number">0x00000172F53B3100</span>&gt;<br>[s]   item       &#123;&#125;<br>[s]   request    &lt;GET https://books.toscrape.com/catalogue/a-light-<span class="hljs-keyword">in</span>-the-attic_1000/index.html&gt;<br>[s]   response   &lt;<span class="hljs-number">200</span> https://books.toscrape.com/catalogue/a-light-<span class="hljs-keyword">in</span>-the-attic_1000/index.html&gt;<br>[s]   settings   &lt;scrapy.settings.Settings <span class="hljs-built_in">object</span> at <span class="hljs-number">0x00000172F53AF940</span>&gt;<br>[s]   spider     &lt;DefaultSpider <span class="hljs-string">&#x27;default&#x27;</span> at <span class="hljs-number">0x172f56b95b0</span>&gt;<br>[s] Useful shortcuts:<br>[s]   fetch(url[, redirect=<span class="hljs-literal">True</span>]) Fetch URL <span class="hljs-keyword">and</span> update local objects (by default, redirects are followed)<br>[s]   fetch(req)                  Fetch a scrapy.Request <span class="hljs-keyword">and</span> update local objects<br>[s]   shelp()           Shell <span class="hljs-built_in">help</span> (<span class="hljs-built_in">print</span> this <span class="hljs-built_in">help</span>)<br>[s]   view(response)    View response <span class="hljs-keyword">in</span> a browser<br></code></pre></div></td></tr></table></figure><p>运行这条命令后，<code>scrapy shell</code>会使用<code>url</code>参数构造一个<code>Request</code>对象，并提交给<code>Scrapy</code>引擎，页面下载完成后，程序进入一个<code>python shell</code>当中，在此环境中已经创建好了一些变量（对象和函数），以下几个最为常用：</p><p>● request最近一次下载对应的Request对象。</p><p>● response最近一次下载对应的Response对象。</p><p>● <code>fetch(req_or_url)</code>该函数用于下载页面，可传入一个Request对象或<code>url</code>字符串，调用后会更新变量request和response。</p><p>● <code>view(response)</code>该函数用于在浏览器中显示response中的页面。</p><p>接下来，在<code>scrapy shell</code>中调用<code>view</code>函数，在浏览器中显示response所包含的页面：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">view(response)<br></code></pre></div></td></tr></table></figure><p>可能在很多时候，使用view函数打开的页面和在浏览器直接输入<code>url</code>打开的页面看起来是一样的，但需要知道的是，前者是由<code>Scrapy</code>爬虫下载的页面，而后者是由浏览器下载的页面，有时它们是不同的。在进行页面分析时，使用view函数更加可靠。</p><p><img src="image-20210812152753401.png"></p><p>从图中看出，我们可在<code>&lt;div class=&quot;col-sm-6 product_main&quot;&gt;</code>中提取书名、价格、评价等级，在<code>scrapy shell</code>中尝试提取这些信息:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>sel = response.css(<span class="hljs-string">&#x27;div.product_main&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>sel.xpath(<span class="hljs-string">&#x27;./h1/text()&#x27;</span>).extract_first()<br><span class="hljs-string">&#x27;A Light in the Attic&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>sel.css(<span class="hljs-string">&#x27;p.price_color::text&#x27;</span>).extract_first()<br><span class="hljs-string">&#x27;£51.77&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>sel.css(<span class="hljs-string">&#x27;p.star-rating::attr(class)&#x27;</span>).re_first(<span class="hljs-string">&#x27;star-rating ([A-Za-z]+)&#x27;</span>)<br><span class="hljs-string">&#x27;Three&#x27;</span><br></code></pre></div></td></tr></table></figure><p><img src="image-20210812223121867.png"></p><p>另外，可在页面下端位置的<code>&lt;table class=&quot;table table-striped&quot;&gt;</code>中提取产品编码、库存量、评价数量，在<code>scrapy shell</code>中尝试提取这些信息：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>sel.xpath(<span class="hljs-string">&#x27;(.//tr)[1]/td/text()&#x27;</span>).extract_first()<br><span class="hljs-string">&#x27;a897fe39b1053632&#x27;</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>sel.xpath(<span class="hljs-string">&#x27;(.//tr)[last()-1]/td/text()&#x27;</span>).re_first(<span class="hljs-string">&#x27;\((\d+) available\)&#x27;</span>)<br><span class="hljs-string">&#x27;22&#x27;</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>sel.xpath(<span class="hljs-string">&#x27;(.//tr)[last()]/td/text()&#x27;</span>).extract_first()<br><span class="hljs-string">&#x27;0&#x27;</span><br></code></pre></div></td></tr></table></figure><p>分析完书籍页面后，接着分析如何在书籍列表页面中提取每一个书籍页面的链接。在<code>scrapy shell</code>中，先调用<code>fetch</code>函数下载第一个书籍列表页面（<a href="http://books.toscrape.com/%EF%BC%89%EF%BC%8C%E4%B8%8B%E8%BD%BD%E5%AE%8C%E6%88%90%E5%90%8E%E5%86%8D%E8%B0%83%E7%94%A8view%E5%87%BD%E6%95%B0%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E6%9F%A5%E7%9C%8B%E9%A1%B5%E9%9D%A2%EF%BC%9A">http://books.toscrape.com/），下载完成后再调用view函数在浏览器中查看页面：</a></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>fetch(<span class="hljs-string">&#x27;http://books.toscrape.com/&#x27;</span>)<br><span class="hljs-number">2021</span>-08-<span class="hljs-number">12</span> <span class="hljs-number">22</span>:<span class="hljs-number">43</span>:09 [scrapy.core.engine] DEBUG: Crawled (<span class="hljs-number">200</span>) &lt;GET http://books.toscrape.com/&gt; (referer: <span class="hljs-literal">None</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>view(response)<br><span class="hljs-literal">True</span><br></code></pre></div></td></tr></table></figure><p><img src="image-20210812224736039.png"></p><p>每个书籍页面的链接可以在每个<code>&lt;article class=&quot;product_pod&quot;&gt;</code>中找到，在<code>scrapy shell</code>中使用<code>LinkExtractor</code>提取这些链接：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> scrapy.linkextractors <span class="hljs-keyword">import</span> LinkExtractor<br><span class="hljs-meta">&gt;&gt;&gt; </span>le = LinkExtractor(restrict_css=<span class="hljs-string">&#x27;article.product_pod&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>le.extract_links(response)<br>[Link(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/a-light-in-the-attic_1000/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Link(url=<span class="hljs-string">&#x27;http://books</span><br><span class="hljs-string">.toscrape.com/catalogue/tipping-the-velvet_999/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Link(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/so</span><br><span class="hljs-string">umission_998/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Link(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/sharp-objects_997/index.html&#x27;</span>, text=<br><span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Link(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/sapiens-a-brief-history-of-humankind_996/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, frag<br>ment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Link(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/the-requiem-red_995/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Lin<br>k(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/the-dirty-little-secrets-of-getting-your-dream-job_994/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span><br>), Link(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/the-coming-woman-a-novel-based-on-the-life-of-the-infamous-feminist-victoria-woodhull_993/index.ht</span><br><span class="hljs-string">ml&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Link(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/the-boys-in-the-boat-nine-americans-and-their-epic-quest-</span><br><span class="hljs-string">for-gold-at-the-1936-berlin-olympics_992/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Link(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/the-blac</span><br><span class="hljs-string">k-maria_991/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Link(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/starving-hearts-triangular-trade-tril</span><br><span class="hljs-string">ogy-1_990/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Link(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/shakespeares-sonnets_989/index.html&#x27;</span>, t<br>ext=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Link(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/set-me-free_988/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=Fal<br>se), Link(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/scott-pilgrims-precious-little-life-scott-pilgrim-1_987/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofol<br>low=<span class="hljs-literal">False</span>), Link(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/rip-it-up-and-start-again_986/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Link(ur<br>l=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/our-band-could-be-your-life-scenes-from-the-american-indie-underground-1981-1991_985/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, f<br>ragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Link(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/olio_984/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Link(url=<span class="hljs-string">&#x27;h</span><br><span class="hljs-string">ttp://books.toscrape.com/catalogue/mesaerion-the-best-science-fiction-stories-1800-1849_983/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Lin<br>k(url=<span class="hljs-string">&#x27;http://books.toscrape.com/catalogue/libertarianism-for-beginners_982/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>), Link(url=<span class="hljs-string">&#x27;http://bo</span><br><span class="hljs-string">oks.toscrape.com/catalogue/its-only-the-himalayas_981/index.html&#x27;</span>, text=<span class="hljs-string">&#x27;&#x27;</span>, fragment=<span class="hljs-string">&#x27;&#x27;</span>, nofollow=<span class="hljs-literal">False</span>)]<br></code></pre></div></td></tr></table></figure><h2 id="编码实现"><a href="#编码实现" class="headerlink" title="编码实现"></a>编码实现</h2><p>首先创建一个<code>Scrapy</code>项目，取名为<code>toscrape_book</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy startproject toscrape_book<br></code></pre></div></td></tr></table></figure><p>通常，我们不需要手工创建Spider文件以及Spider类，可以使用<code>scrapygenspider&lt;SPIDER_NAME&gt; &lt;DOMAIN&gt;</code>命令生成（根据模板）它们，该命令的两个参数分别是Spider的名字和所要爬取的域（网站）：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">cd toscrape_book<br>scrapy genspider books books.toscrape.com<br></code></pre></div></td></tr></table></figure><p>运行后，<code>scrapy genspider</code>命令创建了文件<code>toscrape_book/spiders/books.py</code>，并在其中创建了一个<code>BooksSpider</code>类，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> scrapy<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BooksSpider</span>(<span class="hljs-params">scrapy.Spider</span>):</span><br>    name = <span class="hljs-string">&#x27;books&#x27;</span><br>    allowed_domains = [<span class="hljs-string">&#x27;books.toscrape.com&#x27;</span>]<br>    start_urls = [<span class="hljs-string">&#x27;http://books.toscrape.com/&#x27;</span>]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span><br>        <span class="hljs-keyword">pass</span><br></code></pre></div></td></tr></table></figure><p>实现Spider之前，先定义封装书籍信息的Item类，在<code>toscrape_book/items.py</code>中添加如下代码：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> scrapy<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookItem</span>(<span class="hljs-params">scrapy.Item</span>):</span><br>    name = scrapy.Field()  <span class="hljs-comment"># 书名</span><br>    price = scrapy.Field()  <span class="hljs-comment"># 价格</span><br>    review_rating = scrapy.Field()  <span class="hljs-comment"># 评价等级1-5星</span><br>    review_num = scrapy.Field()  <span class="hljs-comment"># 评价数量</span><br>    upc = scrapy.Field()       <span class="hljs-comment"># 产品编码</span><br>    stock = scrapy.Field()  <span class="hljs-comment"># 库存量</span><br></code></pre></div></td></tr></table></figure><p>接下来，按以下5步完成<code>BooksSpider</code>。</p><ul><li><strong>步骤01</strong> 继承Spider创建<code>BooksSpider</code>类（已完成）。</li><li><strong>步骤02</strong> 为Spider取名（已完成）。</li><li><strong>步骤03</strong> 指定起始爬取点（已完成）。</li><li><strong>步骤04</strong> 实现书籍列表页面的解析函数。</li><li><strong>步骤05</strong> 实现书籍页面的解析函数。</li></ul><p>其中前3步已经由<code>scrapy genspider</code>命令帮我们完成，不需做任何修改。</p><p>第4步和第5步的工作是实现两个页面解析函数，因为起始爬取点是一个书籍列表页面，我们就将parse方法作为书籍列表页面的解析函数，另外，还需要添加一个<code>parse_book</code>方法作为书籍页面的解析函数，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BooksSpider</span>(<span class="hljs-params">scrapy.Spider</span>):</span><br>    name = <span class="hljs-string">&#x27;books&#x27;</span><br>    allowed_domains = [<span class="hljs-string">&#x27;books.toscrape.com&#x27;</span>]<br>    start_urls = [<span class="hljs-string">&#x27;http://books.toscrape.com/&#x27;</span>]<br><br>    <span class="hljs-comment"># 书籍列表页面的解析函数</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span><br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-comment"># 数据页面的解析函数</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_book</span>(<span class="hljs-params">self, response</span>):</span><br>        <span class="hljs-keyword">pass</span><br></code></pre></div></td></tr></table></figure><p>先来完成第4步，实现书籍列表页面的解析函数（parse方法），需要完成以下两个任务：</p><p>（1）提取页面中每一个书籍页面的链接，用它们构造Request对象并提交。</p><p>（2）提取页面中下一个书籍列表页面的链接，用其构造Request对象并提交。提取链接的具体细节在页面分析时已经讨论过，实现代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> scrapy<br><span class="hljs-keyword">from</span> scrapy.linkextractors <span class="hljs-keyword">import</span> LinkExtractor<br><span class="hljs-keyword">from</span> ..items <span class="hljs-keyword">import</span> BookItem<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BooksSpider</span>(<span class="hljs-params">scrapy.Spider</span>):</span><br>    name = <span class="hljs-string">&#x27;books&#x27;</span><br>    allowed_domains = [<span class="hljs-string">&#x27;books.toscrape.com&#x27;</span>]<br>    start_urls = [<span class="hljs-string">&#x27;http://books.toscrape.com/&#x27;</span>]<br><br>    <span class="hljs-comment"># 书籍列表页面的解析函数</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span><br>        <span class="hljs-comment"># 提取书籍列表中的每本书的连接</span><br>        le = LinkExtractor(restrict_css=<span class="hljs-string">&#x27;article.product_pod h3&#x27;</span>)<br>        <span class="hljs-keyword">for</span> link <span class="hljs-keyword">in</span> le.extract_links(response):<br>            time.sleep(<span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">yield</span> scrapy.Request(link.url, callback=self.parse_book)<br><br>        <span class="hljs-comment"># 提取“下一页的链接”</span><br>        le = LinkExtractor(restrict_css=<span class="hljs-string">&#x27;ul.page li.next&#x27;</span>)<br>        links = le.extract_links(response)<br>        <span class="hljs-keyword">if</span> links:<br>            next_url = links[<span class="hljs-number">0</span>].url<br>            <span class="hljs-keyword">yield</span> scrapy.Request(next_url, callback=self.parse)<br><br>    <span class="hljs-comment"># 数据页面的解析函数</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_book</span>(<span class="hljs-params">self, response</span>):</span><br>        book = BookItem()<br>        sel = response.css(<span class="hljs-string">&#x27;div.product_main&#x27;</span>)<br>        book[<span class="hljs-string">&#x27;name&#x27;</span>] = sel.xpath(<span class="hljs-string">&#x27;./h1/text()&#x27;</span>).extract_first()<br>        book[<span class="hljs-string">&#x27;price&#x27;</span>] = sel.css(<span class="hljs-string">&#x27;p.price_color::text&#x27;</span>).extract_first()<br>        book[<span class="hljs-string">&#x27;review_rating&#x27;</span>] = sel.css(<span class="hljs-string">&#x27;p.star-rating::attr(class)&#x27;</span>).re_first(<span class="hljs-string">&#x27;star-rating ([A-Za-z]+)&#x27;</span>)<br>        sel = response.css(<span class="hljs-string">&#x27;table.table.table-striped&#x27;</span>)<br>        book[<span class="hljs-string">&#x27;upc&#x27;</span>] = sel.xpath(<span class="hljs-string">&#x27;(.//tr)[1]/td/text()&#x27;</span>).extract_first()<br>        book[<span class="hljs-string">&#x27;stock&#x27;</span>] = sel.xpath(<span class="hljs-string">&#x27;(.//tr)[last()-1]/td/text()&#x27;</span>).re_first(<span class="hljs-string">&#x27;\((\d+) available\)&#x27;</span>)<br>        book[<span class="hljs-string">&#x27;review_num&#x27;</span>] = sel.xpath(<span class="hljs-string">&#x27;(.//tr)[last()]/td/text()&#x27;</span>).extract_first()<br><br>        <span class="hljs-keyword">yield</span> book<br></code></pre></div></td></tr></table></figure><p>完成代码后，运行爬虫并观察结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy crawl books -o books.csv --nolog<br></code></pre></div></td></tr></table></figure><p><img src="image-20210813004618596.png"></p><p>从以上结果中看出，我们成功地爬取了网站中1000本书的详细信息，但也有让人不满意的地方，比如·文件中各列的次序是随机的，看起来比较混乱，可在配置文件<code>settings.py</code>中使用<code>FEED_EXPORT_FIELDS</code>指定各列的次序：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">FEED_EXPORT_FIELDS = [<span class="hljs-string">&#x27;upc&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;price&#x27;</span>, <span class="hljs-string">&#x27;stock&#x27;</span>, <span class="hljs-string">&#x27;review_rating&#x27;</span>, <span class="hljs-string">&#x27;review_num&#x27;</span>]<br></code></pre></div></td></tr></table></figure><p><img src="image-20210813005148137.png"></p><p>另外，结果中评价等级字段的值是<code>One</code>、<code>Two</code>、<code>Three</code>……这样的单词，而不是阿拉伯数字，阅读起来不是很直观。下面实现一个<code>Item Pipeline</code>，将评价等级字段由单词映射到数字。在<code>pipelines.py</code>中实现<code>BookPipeline</code>，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ToscrapeBookPipeline</span>:</span><br>    review_rating_map = &#123;<br>        <span class="hljs-string">&#x27;One&#x27;</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-string">&#x27;Two&#x27;</span>: <span class="hljs-number">2</span>,<br>        <span class="hljs-string">&#x27;Three&#x27;</span>: <span class="hljs-number">3</span>,<br>        <span class="hljs-string">&#x27;Four&#x27;</span>: <span class="hljs-number">4</span>,<br>        <span class="hljs-string">&#x27;Five&#x27;</span>: <span class="hljs-number">5</span>,<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_item</span>(<span class="hljs-params">self, item, spider</span>):</span><br>        rating = item.get(<span class="hljs-string">&#x27;review_rating&#x27;</span>)<br>        <span class="hljs-keyword">if</span> rating:<br>            item[<span class="hljs-string">&#x27;review_rating&#x27;</span>] = self.review_rating_map[rating]<br>        <span class="hljs-keyword">return</span> item<br></code></pre></div></td></tr></table></figure><p>在配置文件<code>settings.py</code>中启用<code>BookPipeline</code>：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">ITEM_PIPELINES = &#123;<br>    <span class="hljs-string">&#x27;toscrape_book.pipelines.ToscrapeBookPipeline&#x27;</span>: <span class="hljs-number">300</span>,<br>&#125;<br></code></pre></div></td></tr></table></figure><p>重新运行爬虫，并观察结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy crawl books -o book.csv<br></code></pre></div></td></tr></table></figure><p><img src="image-20210814120407993.png"></p><p>此时，各字段已按指定次序排列，并且评价等级字段的值是我们所期望的阿拉伯数字。到此为止，整个项目完成了。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>scrapy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flask的身份验证扩展</title>
    <link href="/2021/08/06/Flask%E7%9A%84%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E6%89%A9%E5%B1%95/"/>
    <url>/2021/08/06/Flask%E7%9A%84%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E6%89%A9%E5%B1%95/</url>
    
    <content type="html"><![CDATA[<h2 id="密码安全性"><a href="#密码安全性" class="headerlink" title="密码安全性"></a>密码安全性</h2><p>设计Web应用时，人们往往会忽视数据库中用户信息的安全性。如果攻击者入侵服务器，攫取了数据库，用户的安全就处在风险之中，而且这个风险超乎你的想象。众所周知，多数用户会在不同的网站中使用相同的密码。因此，即便不保存任何敏感信息，攻击者获得存储在数据库中的密码之后，也能访问用户在其他网站中的账户。</p><p>若想保证数据库中用户密码的安全，关键在于不存储密码本身，而是存储密码的<strong>散列值</strong>。计算密码散列值的函数接收密码作为输入，添加<strong>随机内容（盐值）</strong>之后，使用多种单向加密算法转换密码，最终得到一个和原始密码没有关系的字符序列，而且无法还原成原始密码。核对密码时，密码散列值可代替原始密码，因为计算散列值的函数是可复现的：只要输入（密码和盐值）一样，结果就一样。</p><h3 id="使用Werkzeug计算密码散列值"><a href="#使用Werkzeug计算密码散列值" class="headerlink" title="使用Werkzeug计算密码散列值"></a>使用<code>Werkzeug</code>计算密码散列值</h3><p><code>Werkzeug</code>中的<code>security</code>模块实现了密码散列值的计算。这一功能的实现只需要两个函数，分别用在注册和核对两个阶段。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">generate_password_hash(password, method=<span class="hljs-string">&#x27;pbkdf2:sha256&#x27;</span>, salt_length=<span class="hljs-number">8</span>)<br></code></pre></div></td></tr></table></figure><p>这个函数的输入为原始密码，返回密码散列值的字符串形式，供存入用户数据库。<code>method</code>和<code>salt_length</code>的默认值就能满足大多数需求。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">check_password_hash(<span class="hljs-built_in">hash</span>, password)<br></code></pre></div></td></tr></table></figure><p>这个函数的参数是从数据库中取回的密码散列值和用户输入的密码。返回值为<code>True</code>时表明用户输入的密码正确。</p><p>在创建的User模型的基础上添加密码散列所需的改动，在User模型中加入密码散列。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>(<span class="hljs-params">db.Model</span>):</span><br>    <span class="hljs-comment"># ...</span><br>    password_hash = db.Column(db.String(<span class="hljs-number">128</span>))<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">password</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">&#x27;密码不可读&#x27;</span>)<br><br><span class="hljs-meta">    @password.setter</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">password</span>(<span class="hljs-params">self, password</span>):</span><br>        self.password_hash = generate_password_hash(password)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">verify_password</span>(<span class="hljs-params">self, password</span>):</span><br>        <span class="hljs-keyword">return</span> check_password_hash(self.password_hash, password)<br></code></pre></div></td></tr></table></figure><p>计算密码散列值的函数通过名为<code>password</code>的只写属性实现。设定这个属性的值时，赋值方法会调用<code>Werkzeug</code>提供的<code>generate_password_hash()</code>函数，并把得到的结果写入<code>password_hash</code>字段。如果试图读取<code>password</code>属性的值，则会返回错误，原因很明显，因为生成散列值后就无法还原成原来的密码了。</p><p><code>verify_password()</code>方法接受一个参数（即密码），将其传给<code>Werkzeug</code>提供的<code>check_password_hash()</code>函数，与存储在<code>User</code>模型中的密码散列值进行比对。如果这个方法返回<code>True</code>，表明密码是正确的。</p><p>密码散列功能已经完成，下面在shell中测试一下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv) $ flask shell<br><span class="hljs-meta">&gt;&gt;&gt; </span>u = User()<br><span class="hljs-meta">&gt;&gt;&gt; </span>u.password = <span class="hljs-string">&#x27;cat&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>u.password<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;console&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>  File <span class="hljs-string">&quot;D:\PycharmProjects\Flask_Projects\flasky\app\models.py&quot;</span>, line <span class="hljs-number">17</span>, <span class="hljs-keyword">in</span> password<br>    <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">&#x27;密码不可读&#x27;</span>)<br>AttributeError: 密码不可读<br><span class="hljs-meta">&gt;&gt;&gt; </span>u.password_hash<br><span class="hljs-string">&#x27;pbkdf2:sha256:260000$ylvTADdsUn6mFJv8$824d40ef026f79bf2413ee16b7a9ecacfdac124428ae285574a56136f0bbde60&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>u.verify_password(<span class="hljs-string">&#x27;cat&#x27;</span>)<br><span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>u.verify_password(<span class="hljs-string">&#x27;dog&#x27;</span>)<br><span class="hljs-literal">False</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>u2 = User()<br><span class="hljs-meta">&gt;&gt;&gt; </span>u2.password=<span class="hljs-string">&#x27;cat&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>u2.password_hash<br><span class="hljs-string">&#x27;pbkdf2:sha256:260000$e3x8WYKw4KVueaUS$e93b63b9cbfb0e719a9b177970cc3815470d2bcbd59079236ef5873a753cc007&#x27;</span><br></code></pre></div></td></tr></table></figure><p>注意，尝试访问<code>password</code>属性会返回<code>AttributeError</code>。另外，即使用户<code>u</code>和<code>u2</code>使用了相同的密码，它们的密码散列值也完全不一样。为了确保这个功能今后依然能使用，我们可以把上述手动测试的过程写成单元测试，以便重复执行。在<code>tests</code>包中新建一个模块，编写3个新测试，测试最近对<code>User</code>模型所做的改动。</p><p> <code>tests/test user model.py：</code>密码散列测试</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> unittest<br><br><span class="hljs-keyword">from</span> app.models <span class="hljs-keyword">import</span> User<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserModelTestCase</span>(<span class="hljs-params">unittest.TestCase</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_password_setter</span>(<span class="hljs-params">self</span>):</span><br>        u = User(password=<span class="hljs-string">&#x27;cat&#x27;</span>)<br>        self.assertTrue(u.password_hash <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_no_password_getter</span>(<span class="hljs-params">self</span>):</span><br>        u = User(password=<span class="hljs-string">&#x27;cat&#x27;</span>)<br>        <span class="hljs-keyword">with</span> self.assertRaises(AttributeError):<br>            u.password<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_password_verification</span>(<span class="hljs-params">self</span>):</span><br>        u = User(password=<span class="hljs-string">&#x27;cat&#x27;</span>)<br>        self.assertTrue(u.verify_password(<span class="hljs-string">&#x27;cat&#x27;</span>))<br>        self.assertFalse(u.verify_password(<span class="hljs-string">&#x27;dog&#x27;</span>))<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_password_salts_are_random</span>(<span class="hljs-params">self</span>):</span><br>        u = User(password=<span class="hljs-string">&#x27;cat&#x27;</span>)<br>        u2 = User(password=<span class="hljs-string">&#x27;cat&#x27;</span>)<br>        self.assertTrue(u.password_hash != u2.password_hash)<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">test_app_exists (test_basics.BasicsTestCase) ... &lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">config</span>.<span class="hljs-title">TestConfig</span>&#x27;&gt;</span><br><span class="hljs-class"><span class="hljs-title">ok</span></span><br><span class="hljs-class"><span class="hljs-title">test_app_is_testing</span> (<span class="hljs-params">test_basics.BasicsTestCase</span>) ... &lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">config</span>.<span class="hljs-title">TestConfig</span>&#x27;&gt;</span><br><span class="hljs-class"><span class="hljs-title">ok</span></span><br><span class="hljs-class"><span class="hljs-title">test_no_password_getter</span> (<span class="hljs-params">test_user_model.UserModelTestCase</span>) ... <span class="hljs-title">ok</span></span><br><span class="hljs-class"><span class="hljs-title">test_password_salts_are_random</span> (<span class="hljs-params">test_user_model.UserModelTestCase</span>) ... <span class="hljs-title">ok</span></span><br><span class="hljs-class"><span class="hljs-title">test_password_setter</span> (<span class="hljs-params">test_user_model.UserModelTestCase</span>) ... <span class="hljs-title">ok</span></span><br><span class="hljs-class"><span class="hljs-title">test_password_verification</span> (<span class="hljs-params">test_user_model.UserModelTestCase</span>) ... <span class="hljs-title">ok</span></span><br><span class="hljs-class"></span><br><span class="hljs-class">----------------------------------------------------------------------</span><br><span class="hljs-class"><span class="hljs-title">Ran</span> 6 <span class="hljs-title">tests</span> <span class="hljs-title">in</span> 1.092<span class="hljs-title">s</span></span><br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-title">OK</span></span><br></code></pre></div></td></tr></table></figure><p>每次想确认一切功能是否正常时，就可以运行单元测试组件。通过自动化测试验证功能不费吹灰之力，因此应该经常运行，确保以后的改动不会破坏现在可用的功能。</p><h2 id="创建身份认证蓝本"><a href="#创建身份认证蓝本" class="headerlink" title="创建身份认证蓝本"></a>创建身份认证蓝本</h2><p>我们在第7章介绍过蓝本，把创建应用的过程移入工厂函数后，可使用蓝本在全局作用域中定义路由。本节将在一个新蓝本中定义与用户身份验证子系统相关的路由，这个蓝本名为<code>auth</code>。把应用的不同子系统放在不同的蓝本中，有利于保持代码整洁有序。</p><p><code>auth</code>蓝本保存在同名Python包中。这个蓝本的包构造函数创建蓝本对象，再从<code>views.py</code>模块中导入路由。</p><p><code>app/auth/__init__.py</code>：创建身份验证蓝本</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Blueprint<br><br>auth = Blueprint(<span class="hljs-string">&#x27;auth&#x27;</span>, __name__)<br><br><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views<br></code></pre></div></td></tr></table></figure><p><code>app/auth/views.py</code>模块导入蓝本，然后使用蓝本的<code>route</code>装饰器定义与身份验证相关的路由。这段代码添加了一个<code>/login</code>路由，渲染同名占位模板。</p><p><code>app/auth/views.py</code>：身份验证蓝本中的路由和视图函数。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template<br><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> auth<br><br><br><span class="hljs-meta">@auth.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span>():</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;auth/login.html&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>注意，为<code>render_template()</code>指定的模板文件保存在<code>auth</code>目录中。这个目录必须在<code>app/templates</code>中创建，因为Flask期望模板的路径是相对于应用的模板目录而言的。把蓝本中用到的模板放在单独的子目录中，能避免与<code>main</code>蓝本或以后添加的蓝本发生冲突。</p><blockquote><p>也可以配置蓝本使用专门的目录保存模板。如果配置了多个模板目录，那么<code>render_template()</code>函数会先搜索应用的模板目录，然后再搜索蓝本的模板目录。</p></blockquote><p><code>auth</code>蓝本要在<code>create_app()</code>工厂函数中附加到应用上。</p><p><code>app/__init__.py</code>：注册身份验证蓝本:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_app</span>(<span class="hljs-params">config_name</span>):</span><br>    <span class="hljs-comment"># ...</span><br>    <br>    <span class="hljs-comment"># 注册身份验证蓝本</span><br>    <span class="hljs-keyword">from</span> .auth <span class="hljs-keyword">import</span> auth <span class="hljs-keyword">as</span> auth_blueprint<br>    app.register_blueprint(auth_blueprint, url_prefix=<span class="hljs-string">&#x27;/auth&#x27;</span>)<br><br>    <span class="hljs-keyword">return</span> app<br></code></pre></div></td></tr></table></figure><p>注册蓝本时使用的<code>url_prefix</code>是可选参数。如果使用了这个参数，注册后蓝本中定义的所有路由都会加上指定的前缀，即这个例子中的<code>/auth</code>。例如，<code>/login</code>路由会注册成<code>/auth/login</code>，在开发Web服务器中，完整的URL就变成了<code>http://localhost:5000/auth/login</code>。</p><h2 id="使用Flask-Login验证用户身份"><a href="#使用Flask-Login验证用户身份" class="headerlink" title="使用Flask-Login验证用户身份"></a>使用Flask-Login验证用户身份</h2><p>安装扩展：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv) $ pip install flask-login<br></code></pre></div></td></tr></table></figure><h3 id="准备用于登录的用户模型"><a href="#准备用于登录的用户模型" class="headerlink" title="准备用于登录的用户模型"></a>准备用于登录的用户模型</h3><p><code>Flask-Login</code>的运转需要应用中有<code>User</code>对象。要想使用<code>Flask-Login</code>扩展，应用的<code>User</code>模型必须实现几个属性和方法：</p><table><thead><tr><th>属性/方法</th><th>说明</th></tr></thead><tbody><tr><td>is_authenticated</td><td>如果用户提供的登录凭据有效，必须返回True，否则返回False</td></tr><tr><td>is_active</td><td>如果允许用户登录，必须返回True，否则返回False。如果想禁用账户，可以返回False</td></tr><tr><td>is_anonymous</td><td>对普通用户必须返回False，如果是表示匿名用户的特殊用户对象，应该返回True</td></tr><tr><td>get_id()</td><td>必须返回用户的唯一标识符，使用Unicode编码字符串</td></tr></tbody></table><p>这些属性和方法可以直接在模型类中实现，不过还有一种更简单的替代方案。<code>Flask-Login</code>提供了一个<code>UserMixin</code>类，其中包含默认实现，能满足多数需求。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask_login <span class="hljs-keyword">import</span> UserMixin<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>(<span class="hljs-params">UserMixin, db.Model</span>):</span><br>    __tablename__ = <span class="hljs-string">&#x27;users&#x27;</span><br>    <span class="hljs-built_in">id</span> = db.Column(db.Integer, primary_key=<span class="hljs-literal">True</span>)<br>    email = db.Column(db.Integer, primary_key=<span class="hljs-literal">True</span>)<br>    username = db.Column(db.String(<span class="hljs-number">64</span>), unique=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>)<br>    role_id = db.Column(db.Integer, db.ForeignKey(<span class="hljs-string">&#x27;roles.id&#x27;</span>))<br>    password_hash = db.Column(db.String(<span class="hljs-number">128</span>))<br></code></pre></div></td></tr></table></figure><p>注意，这个示例中还添加了<code>email</code>字段。在这个应用中，用户使用电子邮件地址登录，因为相对于用户名而言，用户更不容易忘记自己的电子邮件地址。</p><p><code>Flask-Login</code>在应用的工厂函数中初始化：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask_login <span class="hljs-keyword">import</span> LoginManager<br> <span class="hljs-comment"># ...</span><br> <br>login_manager = LoginManager()<br>login_manager.login_view = <span class="hljs-string">&#x27;auth.login&#x27;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_app</span>(<span class="hljs-params">config_name</span>):</span><br>    <span class="hljs-comment"># ...</span><br>    login_manager.init_app(app)<br>    <span class="hljs-comment"># ...</span><br></code></pre></div></td></tr></table></figure><p><code>LoginManager</code>对象的<code>login_view</code>属性用于设置登录页面的端点。匿名用户尝试访问受保护的页面时，<code>Flask-Login</code>将重定向到登录页面。因为登录路由在蓝本中定义，所以要在前面加上蓝本的名称。</p><p>最后，<code>Flask-Login</code>要求应用指定一个函数，在扩展需要从数据库中获取指定标识符对应的用户时调用。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> login_manager<br><br><span class="hljs-meta">@login_manager.user_loader</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_user</span>(<span class="hljs-params">user_id</span>):</span><br>    <span class="hljs-keyword">return</span> User.query.get(<span class="hljs-built_in">int</span>(user_id))<br></code></pre></div></td></tr></table></figure><p><code>login_manager.user_loader</code>装饰器把这个函数注册给Flask-Login，在这个扩展需要获取已登录用户的信息时调用。传入的用户标识符是个字符串，因此这个函数先把标识符转换成整数，然后传给<code>Flask-SQLAlchemy</code>查询，加载用户。正常情况下，这个函数的返回值必须是用户对象；如果用户标识符无效，或者出现了其他错误，则返回None。</p><h3 id="保护路由"><a href="#保护路由" class="headerlink" title="保护路由"></a>保护路由</h3><p>为了保护路由，只让通过身份验证的用户访问，Flask-Login提供了一个<code>loginrequired</code>装饰器。其用法演示如下</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask_login <span class="hljs-keyword">import</span> login_required<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/secert&#x27;</span></span>)</span><br><span class="hljs-meta">@login_required</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">secert</span>():</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Only authenticated users are allowed!&#x27;</span><br></code></pre></div></td></tr></table></figure><p>多个函数装饰器可以叠加使用。函数上有多个装饰器时，各装饰器只对随后的装饰器和目标函数起作用。在这个示例中，secret()函数受<code>login_required</code>装饰器的保护，禁止未授权的用户访问，得到的函数又注册为一个Flask路由。如果调换两个装饰器，得到的结果将是错的，因为原始函数先注册为路由，然后才从<code>login_required</code>装饰器接收到额外的属性。</p><p>得益于<code>login_required</code>装饰器，如果未通过身份验证的用户访问这个路由，Flask-Login将拦截请求，把用户发往登录页面。</p><h3 id="添加登录表单"><a href="#添加登录表单" class="headerlink" title="添加登录表单"></a>添加登录表单</h3><p>呈现给用户的登录表单中包含一个用于输入电子邮件地址的文本字段、一个密码字段、一个“记住我”复选框和一个提交按钮。</p><p><code>app/auth/forms.py</code>：登录表单</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask_wtf <span class="hljs-keyword">import</span> FlaskForm<br><span class="hljs-keyword">from</span> wtforms <span class="hljs-keyword">import</span> StringField, PasswordField, BooleanField, SubmitField<br><span class="hljs-keyword">from</span> wtforms.validators <span class="hljs-keyword">import</span> DataRequired, Length, Email<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginForm</span>(<span class="hljs-params">FlaskForm</span>):</span><br>    email = StringField(<span class="hljs-string">&#x27;邮箱&#x27;</span>, validators=[DataRequired(), Length(<span class="hljs-number">1</span>, <span class="hljs-number">64</span>), Email()])<br>    password = PasswordField(<span class="hljs-string">&#x27;密码&#x27;</span>, validators=[DataRequired()])<br>    remember_me = BooleanField(<span class="hljs-string">&#x27;保持登录&#x27;</span>)<br>    submit = SubmitField(<span class="hljs-string">&#x27;登录&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p><code>PasswordField</code>类表示属性为<code>type=&quot;password&quot;</code>的<code>&lt;input&gt;</code>元素。<code>BooleanField</code>类表示复选框。电子邮件字段用到了<code>WTForms</code>提供的<code>Length()</code>、<code>Email()</code>和<code>DataRequired()</code>这3个验证函数，不仅确保这个字段有值，而且必须是有效的。提供验证函数列表时，<code>WTForms</code>将按照指定的顺序执行各个验证函数。倘若验证失败，显示的错误消息将是首个失败的验证函数的消息。</p><p><img src="image-20210809134438984.png"></p><p>登录页面使用的模板保存在<code>auth/login.html</code>文件中。这个模板只需使用Flask-Bootstrap提供的<code>wtf.quick_form()</code>宏渲染表单即可。</p><p><code>base.html</code>模板中的导航栏可以使用<code>Jinja2</code>条件语句判断当前用户的登录状态，分别显示<code>登录</code>或<code>退出</code>链接。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav navbar-nav navbar-right&quot;</span>&gt;</span><br>    &#123;% if current_user.is_authenticated %&#125;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123; url_for(&#x27;auth.logout&#x27;) &#125;&#125;&quot;</span>&gt;</span>退出<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    &#123;% else %&#125;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123; url_for(&#x27;auth.login&#x27;) &#125;&#125;&quot;</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    &#123;% endif %&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>判断条件中的变量<code>current_user</code>由Flask-Login定义，在视图函数和模板中自动可用。这个变量的值是当前登录的用户，如果用户未登录，则是一个匿名用户代理对象。匿名用户对象的<code>is_authenticated</code>属性值是False，所以通过<code>current_user.is_authenticated</code>表达式就能判断当前用户是否登录。</p><p><img src="image-20210809135311391.png"></p><h3 id="登入用户"><a href="#登入用户" class="headerlink" title="登入用户"></a>登入用户</h3><p>视图函数<code>login()</code>的实现。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">@auth.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span>():</span><br>    login_form = LoginForm()<br>    <span class="hljs-keyword">if</span> login_form.validate_on_submit():<br>        user = User.query.filter_by(email=login_form.email.data).first()<br>        <span class="hljs-keyword">if</span> user <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> user.verify_password(login_form.password.data):<br>            login_user(user, login_form.remember_me.data)<br>            <span class="hljs-built_in">next</span> = request.args.get(<span class="hljs-string">&#x27;next&#x27;</span>)<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">next</span> <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">next</span>.startswith(<span class="hljs-string">&#x27;/&#x27;</span>):<br>                <span class="hljs-built_in">next</span> = url_for(<span class="hljs-string">&#x27;main.index&#x27;</span>)<br>            <span class="hljs-keyword">return</span> redirect(<span class="hljs-built_in">next</span>)<br>        flash(<span class="hljs-string">&#x27;无效的用户名或密码&#x27;</span>)<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;/auth/login.html&#x27;</span>, login_form=login_form)<br></code></pre></div></td></tr></table></figure><p>这个视图函数创建了一个<code>LoginForm</code>对象，用法和第4章中的那个简单表单一样。当请求类型是GET时，视图函数直接渲染模板，即显示表单。当表单通过POST请求提交时，<code>Flask-WT</code>F的<code>validate_on_submit()</code>函数会验证表单数据，然后尝试登入用户。</p><p>为了登入用户，视图函数首先使用表单中填写的电子邮件地址从数据库中加载用户。如果电子邮件地址对应的用户存在，再调用用户对象的<code>verify_password()</code>方法，其参数是表单中填写的密码。如果密码正确，调用Flask-Login的<code>login_user()</code>函数，在用户会话中把用户标记为已登录。<code>login_user()</code>函数的参数是要登录的用户，以及可选的“记住我”布尔值，“记住我”也在表单中勾选。如果这个字段的值为False，关闭浏览器后用户会话就过期了，所以下次用户访问时要重新登录。如果值为True，那么会在用户浏览器中写入一个长期有效的cookie，使用这个<code>cookie</code>可以复现用户会话。<code>cookie</code>默认记住一年，可以使用可选的<code>REMEMBERCOOKIE_DURATION</code>配置选项更改这个值。</p><p>如果用户输入的电子邮件地址或密码不正确，应用会设定一个闪现消息，并再次渲染表单，让用户再次尝试登录。</p><h3 id="退出用户"><a href="#退出用户" class="headerlink" title="退出用户"></a>退出用户</h3><p><code>app/auth/views.py</code>：退出路由</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask_login <span class="hljs-keyword">import</span> login_required, logout_user<br><br><span class="hljs-meta">@auth.route(<span class="hljs-params"><span class="hljs-string">&#x27;/logout&#x27;</span></span>)</span><br><span class="hljs-meta">@login_required</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logout</span>():</span><br>    logout_user()<br>    flash(<span class="hljs-string">&#x27;您已退出！&#x27;</span>)<br>    <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;main.index&#x27;</span>))<br></code></pre></div></td></tr></table></figure><p>为了登出用户，这个视图函数调用Flask-Login的<code>logout_user()</code>函数，删除并重设用户会话。随后会显示一个闪现消息，确认这次操作，然后重定向到首页，这样就成功退出了。</p><h3 id="登录测试"><a href="#登录测试" class="headerlink" title="登录测试"></a>登录测试</h3><p>为验证登录功能可用，可以更新首页，使用已登录用户的名字显示一个欢迎消息。</p><p><code>app/templates/index.html</code>：为已登录的用户显示一个欢迎消息。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;% block content %&#125;<br>    &lt;h1&gt;Hello word,<br>        &#123;% <span class="hljs-keyword">if</span> current_user.is_authenticated %&#125;<br>            &#123;&#123; current_user.username &#125;&#125;<br>        &#123;% <span class="hljs-keyword">else</span> %&#125;<br>            Stranger<br>        &#123;% endif %&#125;<br>    &lt;/h1&gt;<br>&#123;% endblock %&#125;<br></code></pre></div></td></tr></table></figure><p>这个模板再次使用<code>current_user.username</code>判断用户是否已经登录。</p><p>因为还未实现用户注册功能，所以目前只能在<code>shell</code>中注册新用户：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv) $ flask shell<br><span class="hljs-meta">&gt;&gt;&gt; </span>u = User(email=<span class="hljs-string">&#x27;espholychan@outlook.com&#x27;</span>,username=<span class="hljs-string">&#x27;holy&#x27;</span>,password=<span class="hljs-string">&#x27;123&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.add(u)<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.commit()<br></code></pre></div></td></tr></table></figure><p>刚刚创建的用户现在可以登录了。用户登录后显示的首页如图所示。</p><p><img src="image-20210809172042915.png"></p><h2 id="注册新用户"><a href="#注册新用户" class="headerlink" title="注册新用户"></a>注册新用户</h2><p>如果新用户想成为应用的成员，必须在应用中注册，这样应用才能识别并登入用户。应用的登录页面中要显示一个链接，把用户带到注册页面，让用户输入电子邮件地址、用户名和密码。</p><h3 id="添加用户注册表单"><a href="#添加用户注册表单" class="headerlink" title="添加用户注册表单"></a>添加用户注册表单</h3><p>注册页面中的表单要求用户输入电子邮件地址、用户名和密码。</p><p><code>app/auth/forms.py</code>：用户注册表单</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask_wtf <span class="hljs-keyword">import</span> FlaskForm<br><span class="hljs-keyword">from</span> wtforms <span class="hljs-keyword">import</span> StringField, PasswordField, BooleanField, SubmitField, ValidationError<br><span class="hljs-keyword">from</span> wtforms.validators <span class="hljs-keyword">import</span> DataRequired, Length, Email, Regexp, EqualTo<br><span class="hljs-keyword">from</span> ..models <span class="hljs-keyword">import</span> User<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginForm</span>(<span class="hljs-params">FlaskForm</span>):</span><br>    email = StringField(<span class="hljs-string">&#x27;邮箱&#x27;</span>, validators=[DataRequired(), Length(<span class="hljs-number">1</span>, <span class="hljs-number">64</span>), Email()])<br>    password = PasswordField(<span class="hljs-string">&#x27;密码&#x27;</span>, validators=[DataRequired()])<br>    remember_me = BooleanField(<span class="hljs-string">&#x27;保持登录&#x27;</span>)<br>    submit = SubmitField(<span class="hljs-string">&#x27;登录&#x27;</span>)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RegistrationForm</span>(<span class="hljs-params">FlaskForm</span>):</span><br>    email = StringField(<span class="hljs-string">&#x27;邮箱&#x27;</span>, validators=[DataRequired(), Length(<span class="hljs-number">1</span>, <span class="hljs-number">64</span>), Email()])<br>    username = StringField(<span class="hljs-string">&#x27;用户名&#x27;</span>, validators=[DataRequired(), Length(<span class="hljs-number">1</span>, <span class="hljs-number">64</span>),<br>                                              Regexp(<span class="hljs-string">&#x27;[A-Za-z][A-Za-z0-9.]*$&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;用户名必须含有字母数字或下划线&#x27;</span>)])<br>    password = PasswordField(<span class="hljs-string">&#x27;密码&#x27;</span>, validators=[DataRequired(), EqualTo(<span class="hljs-string">&#x27;password2&#x27;</span>, message=<span class="hljs-string">&#x27;密码必须一致&#x27;</span>)])<br>    password2 = PasswordField(<span class="hljs-string">&#x27;确认密码&#x27;</span>, validators=[DataRequired()])<br>    submit = SubmitField(<span class="hljs-string">&#x27;注册&#x27;</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validate_email</span>(<span class="hljs-params">self, field</span>):</span><br>        <span class="hljs-keyword">if</span> User.query.filter_by(email=field.data).first():<br>            <span class="hljs-keyword">raise</span> ValidationError(<span class="hljs-string">&#x27;邮箱已经被注册。&#x27;</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validate_user</span>(<span class="hljs-params">self, field</span>):</span><br>        <span class="hljs-keyword">if</span> User.query.filter_by(username=field.data).first():<br>            <span class="hljs-keyword">raise</span> ValidationError(<span class="hljs-string">&quot;用户已存在。&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>这个表单使用<code>WTForms</code>提供的<code>Regexp</code>验证函数，确保<code>username</code>字段的值以字母开头，而且只包含字母、数字、下划线和点号。这个验证函数中正则表达式后面的两个参数分别是正则表达式的标志和验证失败时显示的错误消息。</p><p>为了安全起见，密码要输入两次。此时要验证两个密码字段中的值是否一致，这种验证可使用<code>WTForms</code>提供的另一验证函数实现，即<code>EqualTo</code>。这个验证函数要附属到两个密码字段中的一个上，另一个字段则作为参数传入。</p><p>这个表单还有两个自定义的验证函数，以方法的形式实现。如果表单类中定义了以<code>validate</code>开头且后面跟着字段名的方法，这个方法就和常规的验证函数一起调用。本例分别为<code>email</code>和<code>username</code>字段定义了验证函数，确保填写的值在数据库中没出现过。自定义的验证函数要想表示验证失败，可以抛出<code>ValidationError</code>异常，其参数就是错误消息。显示这个表单的模板是<code>/templates/auth/register.html</code>。与登录模板一样，这个模板也使用<code>wtf.quick form()</code>渲染表单。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;% extends <span class="hljs-string">&#x27;base.html&#x27;</span> %&#125;<br>&#123;% <span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;bootstrap/wtf.html&#x27;</span> <span class="hljs-keyword">as</span> wtf %&#125;<br><br><br>&#123;% block title %&#125;注册&#123;% endblock %&#125;<br><br>&#123;% block content %&#125;<br>    &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">container</span>&quot;&gt;</span><br><span class="hljs-class">        &#123;% <span class="hljs-title">for</span> <span class="hljs-title">message</span> <span class="hljs-title">in</span> <span class="hljs-title">get_flashed_messages</span>() %&#125;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">alert</span> <span class="hljs-title">alert</span>-<span class="hljs-title">warning</span>&quot;&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">button</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">button</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">close</span>&quot;&gt;&amp;<span class="hljs-title">times</span>;&lt;/<span class="hljs-title">button</span>&gt;</span><br><span class="hljs-class">                &#123;&#123; <span class="hljs-title">message</span> &#125;&#125;</span><br><span class="hljs-class">            &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">        &#123;% <span class="hljs-title">endfor</span> %&#125;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">col</span>&quot;&gt;</span><br><span class="hljs-class">            &#123;&#123; <span class="hljs-title">wtf</span>.<span class="hljs-title">quick_form</span>(<span class="hljs-params">login_form</span>) &#125;&#125;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">&#123;% <span class="hljs-title">endblock</span> %&#125;</span><br></code></pre></div></td></tr></table></figure><p>登录页面要显示一个指向注册页面的链接，让没有账户的用户能轻松找到注册页面。</p><p><code>app/templates/auth/login.html</code>：链接到注册页面</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br>    新用户？<br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123; url_for(&#x27;auth.register&#x27;) &#125;&#125;&quot;</span>&gt;</span>点击注册用户<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="注册新用户-1"><a href="#注册新用户-1" class="headerlink" title="注册新用户"></a>注册新用户</h3><p>处理用户注册的过程没有什么难以理解的地方。提交注册表单，通过验证后，系统使用用户填写的信息在数据库中添加一个新用户。</p><p><code>app/auth/views.py</code>：用户注册路由。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">@auth.route(<span class="hljs-params"><span class="hljs-string">&#x27;/register&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">register</span>():</span><br>    register_form = RegistrationForm()<br>    <span class="hljs-keyword">if</span> register_form.validate_on_submit():<br>        user = User(email=register_form.email.data,<br>                    username=register_form.username.data,<br>                    password=register_form.password.data)<br>        db.session.add(user)<br>        db.session.commit()<br>        flash(<span class="hljs-string">&quot;注册成功，跳转登录！&quot;</span>)<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;auth.login&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;/auth/register.html&#x27;</span>, register_form=register_form<br></code></pre></div></td></tr></table></figure><p><img src="image-20210809230811876.png"></p><h2 id="确认账户"><a href="#确认账户" class="headerlink" title="确认账户"></a>确认账户</h2><p>对于某些特定类型的应用，有必要确认注册时用户提供的信息是否正确。常见要求是能通过提供的电子邮件地址与用户取得联系。</p><p>为了确认电子邮件地址，用户注册后，应用会立即发送一封确认邮件。新账户先被标记成待确认状态，用户按照邮件中的说明操作后，才能证明自己可以收到电子邮件。账户确认过程中，往往会要求用户点击一个包含确认令牌的特殊<code>URL</code>链接。</p><h3 id="使用itsdangerous生成确认令牌"><a href="#使用itsdangerous生成确认令牌" class="headerlink" title="使用itsdangerous生成确认令牌"></a>使用itsdangerous生成确认令牌</h3><p>确认邮件中最简单的确认链接是<code>http://www.example.com/auth/confirm/&lt;id&gt;</code>这种形式的URL，其中<code>&lt;id&gt;</code>是数据库分配给用户的数字id。用户点击链接后，处理这个路由的视图函数将确认收到的用户id，然后将用户状态更新为已确认。</p><p>但这种实现方式显然不是很安全，只要用户能判断确认链接的格式，就可以随便指定URL中的数字，从而确认任意账户。解决方法是把URL中的<code>&lt;id&gt;</code>换成包含相同信息的令牌，但是只有服务器才能生成有效的确认URL。</p><p>Flask使用加密的签名cookie保护用户会话，以防止被篡改。用户会话cookie中有一个由<code>itsdangerous</code>包生成的加密签名。如果用户会话的内容被篡改，签名将不再与内容匹配，这样会使Flask销毁会话，然后重建一个。同样的方法也可用在确认令牌上。</p><p>下面这个简短的shell会话展示如何使用<code>itsdangerous</code>包生成包含用户id的签名令牌：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> itsdangerous <span class="hljs-keyword">import</span> TimedJSONWebSignatureSerializer <span class="hljs-keyword">as</span> Serializer<br><span class="hljs-meta">&gt;&gt;&gt; </span>s = Serializer(app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>], expires_in=<span class="hljs-number">3600</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>token = s.dumps(&#123;<span class="hljs-string">&#x27;confirm&#x27;</span>:<span class="hljs-number">23</span>&#125;)<br><span class="hljs-meta">&gt;&gt;&gt; </span>token<br><span class="hljs-string">b&#x27;eyJhbGciOiJIUzUxMiIsImlhdCI6MTYyODY0ODMzNywiZXhwIjoxNjI4NjUxOTM3fQ.eyJjb25maXJtIjoyM30.uSG3P9YYEkkwwYF9AYO0vWqyC81uYLu0lLlm-3p6SE4</span><br><span class="hljs-string">IyH-oZqg4ygGslzdh0ammAfujT26JLq-TCAw7cVWgzw&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>data = s.loads(token)<br><span class="hljs-meta">&gt;&gt;&gt; </span>data<br>&#123;<span class="hljs-string">&#x27;confirm&#x27;</span>: <span class="hljs-number">23</span>&#125;<br></code></pre></div></td></tr></table></figure><p><code>itsdangerous</code>提供了多种生成令牌的方法。其中，<code>TimedJSONWebSignatureSerializer</code>类生成具有过期时间的<code>JSON Web</code>签名（<code>JWS</code>）。这个类的构造函数接收的参数是一个密钥，在Flask应用中可使用<code>SECRET_KEY</code>设置。</p><p><code>dumps()</code>方法为指定的数据生成一个加密签名，然后再对数据和签名进行序列化，生成令牌字符串。<code>expires_in</code>参数设置令牌的过期时间，单位为秒。</p><p>为了解码令牌，序列化对象提供了<code>loads()</code>方法，其唯一的参数是令牌字符串。这个方法会检验签名和过期时间，如果都有效，则返回原始数据。如果提供给<code>loads()</code>方法的令牌无效或是过期了，则抛出异常。</p><p>我们可以把这种生成和检验令牌的功能添加到User模型中，<code>app/models.py</code>：确认用户账户：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> itsdangerous <span class="hljs-keyword">import</span> TimedJSONWebSignatureSerializer <span class="hljs-keyword">as</span> Serializer<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> current_app<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>(<span class="hljs-params">UserMixin, db.Model</span>):</span><br>    <span class="hljs-comment"># ...</span><br>    <br>    comfirmed = db.Column(db.Boolean, default=<span class="hljs-literal">False</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate_confitmation_token</span>(<span class="hljs-params">self, expiration=<span class="hljs-number">3600</span></span>):</span><br>        s = Serializer(current_app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>], expires_in=expiration)<br>        <span class="hljs-keyword">return</span> s.dumps(&#123;<span class="hljs-string">&#x27;confirm&#x27;</span>: self.<span class="hljs-built_in">id</span>&#125;).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">confirm</span>(<span class="hljs-params">self, token</span>):</span><br>        s = Serializer(current_app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>])<br>        <span class="hljs-keyword">try</span>:<br>            data = s.loads((token.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)))<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">if</span> data.get(<span class="hljs-string">&#x27;confirm&#x27;</span>) != self.<span class="hljs-built_in">id</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        self.comfirmed = <span class="hljs-literal">True</span><br>        db.session.add(self)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br></code></pre></div></td></tr></table></figure><p><code>generate_confitmation_token()</code>方法生成一个令牌，有效期默认为一小时。<code>confirm()</code>方法检验令牌，如果检验通过，就把用户模型中新添加的<code>confirmed</code>属性设为True。除了检验令牌，<code>confirm()</code>方法还检查令牌中的id是否与存储在<code>current_user</code>中的已登录用户匹配。这样能确保为一个用户生成的确认令牌无法用于确认其他用户。</p><h3 id="发送确认邮件"><a href="#发送确认邮件" class="headerlink" title="发送确认邮件"></a>发送确认邮件</h3><p>当前的<code>/register</code>路由把新用户添加到数据库中之后，会重定向到<code>/index</code>。在重定向之前，这个路由现在需要发送确认邮件。</p><p><code>app/auth/views.py</code>：能发送确认邮件的注册路由。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">@auth.route(<span class="hljs-params"><span class="hljs-string">&#x27;/register&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">register</span>():</span><br>    register_form = RegistrationForm()<br>    <span class="hljs-keyword">if</span> register_form.validate_on_submit():<br>        user = User(email=register_form.email.data,<br>                    username=register_form.username.data,<br>                    password=register_form.password.data)<br>        db.session.add(user)<br>        db.session.commit()<br>        token = user.generate_confitmation_token()<br>        send_mail(user.email, <span class="hljs-string">&#x27;确认你的用户信息&#x27;</span>, <span class="hljs-string">&#x27;auth/email/confirm&#x27;</span>, user=user, token=token)<br>        flash(<span class="hljs-string">&quot;确认信息已经发送到你的邮箱，请确认！&quot;</span>)<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;main.index&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;/auth/register.html&#x27;</span>, register_form=register_form)<br></code></pre></div></td></tr></table></figure><p>注意，在发送确认邮件之前要调用<code>db.session.commit()</code>。之所以这么做，是因为提交之后才能赋予新用户id值，而确认令牌需要用到id。</p><p>身份验证蓝本使用的电子邮件模板保存在<code>templates/auth/email</code>目录中，以便与HTML模板区分开来。</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs txt">你好， &#123;&#123; user.name &#125;&#125;!<br><br>欢迎来到Flasky!<br><br>点击下面的链接来确认你的账户信息：<br>&#123;&#123; url_for(&#x27;auth.confirm&#x27;, token=token, external=True) &#125;&#125;<br><br>不用回复！<br></code></pre></div></td></tr></table></figure><p>默认情况下，<code>url_for()</code>生成相对URL，例如<code>url_for(&#39;auth.confirm&#39;, token=&#39;abc&#39;)</code>返回的字符串是<code>’/auth/confirm/abc&#39;</code>。这显然不是能够在电子邮件中发送的正确URL，因为只有URL的路径部分。相对URL在网页的上下文中可以正常使用，因为浏览器会添加当前页面的主机名和端口号，将其转换成绝对URL。但是通过电子邮件发送的URL并没有这种上下文。添加到<code>url_for()</code>函数中的<code>external=True</code>参数要求应用生成完全限定的URL，包括协议<code>（http://或https://）</code>、主机名和端口。</p><p><code>app/auth/views.py</code>：确认用户的账户</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask_login <span class="hljs-keyword">import</span> current_user<br><span class="hljs-meta">@auth.route(<span class="hljs-params"><span class="hljs-string">&#x27;/confirm/&lt;token&gt;&#x27;</span></span>)</span><br><span class="hljs-meta">@login_required</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">confirm</span>(<span class="hljs-params">token</span>):</span><br>    <span class="hljs-keyword">if</span> current_user.confirmed:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;main.index&#x27;</span>))<br>    <span class="hljs-keyword">if</span> current_user.confirm(token):<br>        db.session.commit()<br>        flash(<span class="hljs-string">&#x27;您的账户已经确认，谢谢！&#x27;</span>)<br>    <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;main.index&#x27;</span>))<br></code></pre></div></td></tr></table></figure><p>Flask-Login提供的<code>login_required</code>装饰器会保护这个路由，因此，用户点击确认邮件中的链接后，要先登录，然后才能执行这个视图函数。</p><p>这个函数先检查已登录的用户是否已经确认过，如果确认过，则重定向到首页，因为很显然此时不用做什么操作。这样处理可以避免用户不小心多次点击确认令牌带来的额外工作。</p><p>由于令牌确认完全在User模型中完成，所以视图函数只需调用<code>confirm()</code>方法即可，然后再根据确认结果显示不同的闪现消息。确认成功后，User模型中<code>confirmed</code>属性的值会被修改并添加到会话中，然后提交数据库会话。</p><p>各个应用可以自行决定用户确认账户之前可以做哪些操作。比如，允许未确认的用户登录，但只显示一个页面，要求用户在获取进一步访问权限之前先确认账户。</p><p>这一步可使用Flask提供的<code>before_request</code>钩子完成。对蓝本来说，<code>before_request</code>钩子只能应用到属于蓝本的请求上。若想在蓝本中使用针对应用全局请求的钩子，必须使用<code>before_app_request</code>装饰器。</p><p><code>app/auth/views.py</code>：使用<code>before_app_request</code>处理程序过滤未确认的账户:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">@auth.before_request</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">before_request</span>():</span><br>    <span class="hljs-keyword">if</span> current_user.is_authenticated \<br>            <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> current_user.confirmed \<br>            <span class="hljs-keyword">and</span> request.blueprint != <span class="hljs-string">&#x27;auth&#x27;</span> \<br>            <span class="hljs-keyword">and</span> request.endpoint != <span class="hljs-string">&#x27;static&#x27;</span>:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;auth.unconfirmed&#x27;</span>))<br><br><br><span class="hljs-meta">@auth.route(<span class="hljs-params"><span class="hljs-string">&#x27;/unconfirmed&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unconfirmed</span>():</span><br>    <span class="hljs-keyword">if</span> current_user.is_anonymous <span class="hljs-keyword">or</span> current_user.confirmed:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;main.index&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;auth/unconfirmed/html&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>同时满足以下3个条件时，<code>before_app_request</code>处理程序会拦截请求。</p><p>(1) 用户已登录（<code>current user.is authenticated</code>的值为True）。</p><p>(2) 用户的账户还未确认。</p><p>(3) 请求的URL不在身份验证蓝本中，而且也不是对静态文件的请求。要赋予用户访问身份验证路由的权限，因为这些路由的作用是让用户确认账户或执行其他账户管理操作。如果请求满足以上条件，会被重定向到<code>/auth/unconfirmed</code>路由，显示一个确认账户相关信息的页面。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">@auth.route(<span class="hljs-params"><span class="hljs-string">&#x27;/confirm&#x27;</span></span>)</span><br><span class="hljs-meta">@login_required</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">resend_confirmation</span>():</span><br>    token = current_user.generate_confirmtion_token()<br>    send_mail(current_user.email, <span class="hljs-string">&#x27;确认你的账户&#x27;</span>, <span class="hljs-string">&#x27;auth/email/confirm&#x27;</span>, user=current_user, token=token)<br>    flash(<span class="hljs-string">&#x27;新的确认信息已经发送到你的邮箱&#x27;</span>)<br>    <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;main.index&#x27;</span>))<br></code></pre></div></td></tr></table></figure><p>这个路由为<code>current_user</code>（即已登录的用户，也是目标用户）重做了一遍注册路由中的操作。这个路由也用<code>login_required</code>保护，确保只有通过身份验证的用户才能再次请求发送确认邮件。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Flask</category>
      
    </categories>
    
    
    <tags>
      
      <tag>flask</tag>
      
      <tag>flask-login</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>大型应用的结构</title>
    <link href="/2021/08/05/%E5%A4%A7%E5%9E%8B%E5%BA%94%E7%94%A8%E7%9A%84%E7%BB%93%E6%9E%84/"/>
    <url>/2021/08/05/%E5%A4%A7%E5%9E%8B%E5%BA%94%E7%94%A8%E7%9A%84%E7%BB%93%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<h1 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h1><p>多文件<code>Flask</code>应用的基本结构：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">├─app/<br>   ├─__init__.py<br>   ├─email.py<br>   ├─models.py<br>   ├─main/<br>      ├─__init__.py<br>      ├─errors.py<br>      ├─forms.py<br>     ├─views.py<br>   ├─static/<br>   └─templates/<br>├─migrations/<br>├─tests/<br>   ├─__init__.py<br>   ├─test.py<br>├─venv/<br>├─requirements.txt<br>├─config.py<br>├─flasky.py<br></code></pre></div></td></tr></table></figure><p>这种结构有4个顶级文件夹：</p><ul><li> Flask应用一般保存在名为<code>app</code>的包中；</li><li>和之前一样，数据库迁移脚本在<code>migrations</code>文件夹中；</li><li>单元测试在<code>tests</code>包中编写；•</li><li>和之前一样，Python虚拟环境在<code>venv</code>文件夹中。</li></ul><p>此外，这种结构还多了一些新文件：</p><ul><li><code>requirements.txt</code>列出了所有依赖包，便于在其他计算机中重新生成相同的虚拟环境；</li><li><code>config.py</code>存储配置；•</li><li><code>flasky.py</code>定义<code>Flask</code>应用实例，同时还有一些辅助管理应用的任务。</li></ul><h2 id="配置选项"><a href="#配置选项" class="headerlink" title="配置选项"></a>配置选项</h2><p>应用经常需要设定多个配置。这方面最好的例子就是开发、测试和生产环境要使用不同的数据库，这样才不会彼此影响。</p><p><code>config.py</code>应用的配置：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br>basedir = os.path.abspath(os.path.dirname(__file__))<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span>:</span><br>    SECRET_KEY = os.environ.get(<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;hard to guess&#x27;</span><br>    MAIL_SERVER = os.environ.get(<span class="hljs-string">&#x27;MAIL_SERVER&#x27;</span>, <span class="hljs-string">&#x27;smtp.googlemail.com&#x27;</span>)<br>    MAIL_PORT = os.environ.get(<span class="hljs-string">&#x27;MAIL_PORT&#x27;</span>, <span class="hljs-string">&#x27;587&#x27;</span>)<br>    MAIL_USE_TLS = os.environ.get(<span class="hljs-string">&#x27;MAIL_USE_TLS&#x27;</span>, <span class="hljs-string">&#x27;true&#x27;</span>).lower() <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;true&#x27;</span>, <span class="hljs-string">&#x27;on&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>]<br>    MAIL_USERNAME = os.environ.get(<span class="hljs-string">&#x27;MAIL_USERNAME&#x27;</span>)<br>    MAIL_PASSWORD = os.environ.get(<span class="hljs-string">&#x27;MAIL_PASSWORD&#x27;</span>)<br>    <span class="hljs-comment"># 数据库</span><br>    SQLALCHEMY_TRACK_MODIFICATIONS = <span class="hljs-literal">False</span><br><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init_app</span>(<span class="hljs-params">app</span>):</span><br>        <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DevelopmentConfig</span>(<span class="hljs-params">Config</span>):</span><br>    DEBUG = <span class="hljs-literal">True</span><br>    SQLALCHEMY_DATABASE_URI = os.environ.get(<span class="hljs-string">&#x27;DEV_DATABASE_URI&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;sqlite:///&#x27;</span> + os.path.join(basedir,<br>                                                                                                <span class="hljs-string">&#x27;data-dev.sqlite&#x27;</span>)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestConfig</span>(<span class="hljs-params">Config</span>):</span><br>    TESTING = <span class="hljs-literal">True</span><br>    SQLALCHEMY_DATABASE_URI = os.environ.get(<span class="hljs-string">&#x27;TEST_DATABASE_URI&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;sqlite:///&#x27;</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProductionConfig</span>(<span class="hljs-params">Config</span>):</span><br>    SQLALCHEMY_DATABASE_URI = os.environ.get(<span class="hljs-string">&#x27;DATABASE_URI&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;sqlite:///&#x27;</span> + os.path.join(basedir,<br><br>                                                                                            <span class="hljs-string">&#x27;data.sqlite&#x27;</span>)<br><br><br>config = &#123;<br>    <span class="hljs-string">&#x27;development&#x27;</span>: DevelopmentConfig,<br>    <span class="hljs-string">&#x27;testing&#x27;</span>: TestConfig,<br>    <span class="hljs-string">&#x27;production&#x27;</span>: ProductionConfig,<br>    <span class="hljs-string">&#x27;default&#x27;</span>: DevelopmentConfig,<br>&#125;<br></code></pre></div></td></tr></table></figure><p>基类<code>Config</code>中包含通用配置，各个子类分别定义专用的配置。如果需要，你还可添加其他配置类。</p><p>为了让配置方式更灵活且更安全，多数配置都可以从环境变量中导入。例如，<code>SECRET_KEY</code>的值，这是个敏感信息，可以在环境中设定，但系统也提供了一个默认值，以防环境中没有定义。通常，在开发过程中可以使用这些设置的默认值，但是在生产服务器中应该通过环境变量设定各个值。</p><blockquote><p>千万不要把密码或其他机密信息写在纳入版本控制的配置文件中。</p></blockquote><p>在3个子类中，<code>SQLALCHEMY_DATABASE_URI</code>变量都被指定了不同的值。这样应用就可以在不同的环境中使用不同的数据库。把不同环境的数据库区分开是十分必要的，因为你肯定不想让单元测试修改日常开发中使用的数据库。</p><p>开发环境和生产环境都配置了邮件服务器。为了再给应用提供一种定制配置的方式，<code>Config</code>类及其子类可以定义<code>init_app()</code>类方法，其参数为应用实例。现在，基类<code>Config</code>中的<code>init_app()</code>方法为空。</p><p>在这个配置脚本末尾，<code>config</code>字典中注册了不同的配置环境，而且还注册了一个默认配置（这里注册为开发环境）</p><h2 id="应用包"><a href="#应用包" class="headerlink" title="应用包"></a>应用包</h2><p>应用包用于存放应用的所有代码、模板和静态文件。我们可以把这个包直接称为<code>app</code>（应用），如果有需求，也可使用一个应用专属的名称。<code>templates</code>和<code>static</code>目录现在是应用包的一部分，因此要把二者移到<code>app</code>包中。数据库模型和电子邮件支持函数也要移到这个包中，分别保存为<code>app/models.py</code>和<code>app/email.py</code>。</p><h3 id="使用应用工厂函数"><a href="#使用应用工厂函数" class="headerlink" title="使用应用工厂函数"></a>使用应用工厂函数</h3><p>在单个文件中开发应用是很方便，但却有个很大的缺点：应用在全局作用域中创建，无法动态修改配置。运行脚本时，应用实例已经创建，再修改配置为时已晚。这一点对单元测试尤其重要，因为有时为了提高测试覆盖度，必须在不同的配置下运行应用。</p><p>这个问题的解决方法是延迟创建应用实例，把创建过程移到可显式调用的<code>工厂函数</code>中。这种方法不仅可以给脚本留出配置应用的时间，还能够创建多个应用实例，为测试提供便利。</p><p><code>app/__init__.py</code>应用包构造文件：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template<br><span class="hljs-keyword">from</span> flask_bootstrap <span class="hljs-keyword">import</span> Bootstrap<br><span class="hljs-keyword">from</span> flask_moment <span class="hljs-keyword">import</span> Moment<br><span class="hljs-keyword">from</span> flask_sqlalchemy <span class="hljs-keyword">import</span> SQLAlchemy<br><span class="hljs-keyword">from</span> ..config <span class="hljs-keyword">import</span> config<br><br>bootstrap = Bootstrap()<br>moment = Moment()<br>db = SQLAlchemy()<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_app</span>(<span class="hljs-params">config_name</span>):</span><br>    app = Flask(__name__)<br>    app.config.from_object(config[config_name])<br>    config[config_name].init_app(app)<br><br>    bootstrap.init_app(app)<br>    moment.init_app(app)<br>    db.init_app(app)<br><br>    <span class="hljs-comment"># 添加路由和自定义错误页面</span><br><br>    <span class="hljs-keyword">return</span> app<br></code></pre></div></td></tr></table></figure><p>构造文件导入了大多数正在使用的Flask扩展。由于尚未初始化所需的应用实例，所以创建扩展类时没有向构造函数传入参数，因此扩展并未真正初始化。<code>createapp()</code>函数是应用的工厂函数，接受一个参数，是应用使用的配置名。配置类在<code>config.py</code>文件中定义，其中保存的配置可以使用<code>Flask app.config</code>配置对象提供的<code>from_object()</code>方法直接导入应用。至于配置对象，则可以通过名称从<code>config</code>字典中选择。应用创建并配置好后，就能初始化扩展了。在之前创建的扩展对象上调用<code>init_app()</code>便可以完成初始化。</p><p>现在，应用在这个工厂函数中初始化，使用Flask配置对象的<code>from_object()</code>方法，其参数为<code>config.py</code>中定义的某个配置类。此外，这里还调用了所选配置的<code>init_app()</code>方法，以便执行更复杂的初始化过程。工厂函数返回创建的应用示例，不过要注意，现在工厂函数创建的应用还不完整，因为没有路由和自定义的错误页面处理程序。</p><h3 id="在蓝本中实现应用功能"><a href="#在蓝本中实现应用功能" class="headerlink" title="在蓝本中实现应用功能"></a>在蓝本中实现应用功能</h3><p>转换成应用工厂函数的操作让定义路由变复杂了。在单脚本应用中，应用实例存在于全局作用域中，路由可以直接使用<code>app.route</code>装饰器定义。但现在应用在运行时创建，只有调用<code>create_app()</code>之后才能使用<code>app.route</code>装饰器，这时定义路由就太晚了。自定义的错误页面处理程序也面临相同的问题，因为错误页面处理程序使用<code>app.errorhandler</code>装饰器定义。幸好，Flask使用<strong>蓝本（blueprint）</strong>提供了更好的解决方法。蓝本和应用类似，也可以定义路由和错误处理程序。不同的是，在蓝本中定义的路由和错误处理程序处于休眠状态，直到蓝本注册到应用上之后，它们才真正成为应用的一部分。使用位于全局作用域中的蓝本时，定义路由和错误处理程序的方法几乎与单脚本应用一样。</p><p>与应用一样，蓝本可以在单个文件中定义，也可使用更结构化的方式在包中的多个模块中创建。为了获得最大的灵活性，我们将在应用包中创建一个子包，用于保存应用的第一个蓝本。</p><p><code>app/main/__init__.py</code>：创建主蓝本</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Blueprint<br><br>main = Blueprint(<span class="hljs-string">&#x27;main&#x27;</span>, __name__)<br><br><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views, errors<br></code></pre></div></td></tr></table></figure><p>蓝本通过实例化一个<code>Blueprint</code>类对象创建。这个构造函数有两个必须指定的参数：蓝本的名称和蓝本所在的包或模块。与应用一样，多数情况下第二个参数使用Python的<code>__name__</code>变量即可。</p><p>应用的路由保存在包里的<code>app/main/views.py</code>模块中，而错误处理程序保存在<code>app/main/errors.py</code>模块中。导入这两个模块就能把路由和错误处理程序与蓝本关联起来。注意，这些模块在<code>app/main/ init .py</code>脚本的末尾导入，这是为了避免循环导入依赖，因为在<code>app/main/views.py</code>和<code>app/main/errors.py</code>中还要导入<code>main</code>蓝本，所以除非循环引用出现在定义<code>main</code>之后，否则会致使导入出错。</p><p>蓝本在工厂函数<code>create_app()</code>中注册到应用上。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_app</span>(<span class="hljs-params">config_name</span>):</span><br>    <span class="hljs-comment"># ...</span><br><br>    <span class="hljs-comment"># 注册主蓝本</span><br>    <span class="hljs-keyword">from</span> .main <span class="hljs-keyword">import</span> main <span class="hljs-keyword">as</span> main_blueprint<br>    app.register_blueprint(main_blueprint)<br></code></pre></div></td></tr></table></figure><p>在<code>app/main/errors.py</code>：主蓝本中定义的错误处理程序：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template<br><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> main<br><br><br><span class="hljs-meta">@main.app_errorhandler(<span class="hljs-params"><span class="hljs-number">404</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">page_not_found</span>(<span class="hljs-params">e</span>):</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;404.html&#x27;</span>), <span class="hljs-number">404</span><br><br><br><span class="hljs-meta">@main.app_errorhandler(<span class="hljs-params"><span class="hljs-number">500</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">internal_server_error</span>(<span class="hljs-params">e</span>):</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;500.html&#x27;</span>), <span class="hljs-number">500</span><br></code></pre></div></td></tr></table></figure><p>在蓝本中编写错误处理程序稍有不同，如果使用<code>errorhandler</code>装饰器，那么只有蓝本中的错误才能触发处理程序。要想注册应用全局的错误处理程序，必须使用<code>app_errorhandler</code>装饰器。</p><p>在<code>app/main/views.py</code>：主蓝本中定义的应用路由。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template, session, redirect, url_for<br><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> main<br><span class="hljs-keyword">from</span> .forms <span class="hljs-keyword">import</span> NameForm<br><span class="hljs-keyword">from</span> .. <span class="hljs-keyword">import</span> db<br><span class="hljs-keyword">from</span> ..models <span class="hljs-keyword">import</span> User<br><br><br><span class="hljs-meta">@main.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    form = NameForm()<br>    <span class="hljs-keyword">if</span> form.validate_on_submit():<br>        <span class="hljs-comment"># ...</span><br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, name=session.get(<span class="hljs-string">&#x27;name&#x27;</span>), known=session.get(<span class="hljs-string">&#x27;known&#x27;</span>, <span class="hljs-literal">False</span>),<br>                           current_time=datetime.utcnow())<br></code></pre></div></td></tr></table></figure><p>在蓝本中编写视图函数主要有两点不同：第一，与前面的错误处理程序一样，路由装饰器由蓝本提供，因此使用的是<code>main.route</code>，而非<code>app.route</code>；第二，<code>url_for()</code>函数的用法不同。你可能还记得，<code>url_for()</code>函数的第一个参数是路由的端点名，在应用的路由中，默认为视图函数的名称。例如，在单脚本应用中，<code>index()</code>视图函数的URL可使用<code>url_for(&#39;index&#39;)</code>获取。</p><p>在蓝本中就不一样了，Flask会为蓝本中的全部端点加上一个命名空间，这样就可以在不同的蓝本中使用相同的端点名定义视图函数，而不产生冲突。命名空间是蓝本的名称（<strong>Blueprint构造函数的第一个参数</strong>），而且它与端点名之间以一个点号分隔。因此，视图函数<code>index()</code>注册的端点名是<code>main.index</code>，其URL使用<code>urlfor(&#39;main.index&#39;)</code>获取。</p><p><code>url_for()</code>函数还支持一种简写的端点形式，在蓝本中可以省略蓝本名，例如<code>url_for(&#39;.index&#39;)</code>。在这种写法中，使用当前请求的蓝本名补足端点名。这意味着，同一蓝本中的重定向可以使用简写形式，但跨蓝本的重定向必须使用带有蓝本名的完全限定端点名。为了完成对应用包的修改，还要把表单对象移到蓝本中，保存在<code>app/main/forms.py</code>模块里。</p><h2 id="应用脚本"><a href="#应用脚本" class="headerlink" title="应用脚本"></a>应用脚本</h2><p>应用实例在顶级目录中的<code>flasky.py</code>模块里定义。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> app <span class="hljs-keyword">import</span> create_app, db<br><span class="hljs-keyword">from</span> app.models <span class="hljs-keyword">import</span> User, Role<br><span class="hljs-keyword">from</span> flask_migrate <span class="hljs-keyword">import</span> Migrate<br><br>app = create_app(os.getenv(<span class="hljs-string">&#x27;FLASK_CONFIG&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;default&#x27;</span>)<br>migrate = Migrate(app, db)<br><br><br><span class="hljs-meta">@app.shell_context_processor</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_shell_context</span>():</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">dict</span>(db=db, User=User, Role=Role)<br></code></pre></div></td></tr></table></figure><p>这个脚本先创建一个应用实例。如果已经定义了环境变量<code>FLASK_CONFIG</code>，则从中读取配置名；否则使用默认配置。然后初始化<code>Flask-Migrate</code>和为<code>Python shell</code>定义的上下文。</p><p>相应地修改<code>FLASK_APP</code>环境变量，以便flask命令找到应用实例。此外，还可以设置<code>FLASK_DEBUG=1</code>，启用Flask的调试模式。<code>Linux</code>和<code>macOS</code>用户这样做：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv) $ export FLASK_APP=flasky.py<br>(venv) $ export FLASK_DEBUG=<span class="hljs-number">1</span><br></code></pre></div></td></tr></table></figure><p><code>windows</code>用户：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv) $ <span class="hljs-built_in">set</span> FLASK_APP=flasky.py<br>(venv) $ <span class="hljs-built_in">set</span> FLASK_DEBUG=<span class="hljs-number">1</span><br></code></pre></div></td></tr></table></figure><h2 id="需求文件"><a href="#需求文件" class="headerlink" title="需求文件"></a>需求文件</h2><p>应用中最好有个<code>requirements.txt</code>文件，用于记录所有依赖包及其精确的版本号。如果要在另一台计算机上重新生成虚拟环境，这个文件的重要性就体现出来了，例如部署应用时使用的设备。这个文件可由<code>pip</code>自动生成，使用的命令如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv) $ pip freeze &gt;requirements.txt<br></code></pre></div></td></tr></table></figure><p>如果你想创建这个虚拟环境的完整副本，先创建一个新的虚拟环境，然后在其中运行下述命令：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv) $ pip install -r requirements.txt<br></code></pre></div></td></tr></table></figure><h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> unittest<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> current_app<br><span class="hljs-keyword">from</span> app <span class="hljs-keyword">import</span> create_app, db<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasicsTestCase</span>(<span class="hljs-params">unittest.TestCase</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setUp</span>(<span class="hljs-params">self</span>):</span><br>        self.app = create_app(<span class="hljs-string">&#x27;testing&#x27;</span>)<br>        self.app_context = self.app.app_context()<br>        self.app_context.push()<br>        db.create_all()<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">tearDown</span>(<span class="hljs-params">self</span>):</span><br>        db.session.remove()<br>        db.drop_all()<br>        self.app_context.pop()<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_app_exists</span>(<span class="hljs-params">self</span>):</span><br>        self.assertFalse(current_app <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>)<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_app_is_testing</span>(<span class="hljs-params">self</span>):</span><br>        self.assertTrue(current_app.config[<span class="hljs-string">&#x27;TESTING&#x27;</span>])<br></code></pre></div></td></tr></table></figure><p>这些测试使用Python标准库中的<code>unittest</code>包编写。测试用例类的<code>setUp()</code>和<code>tearDown()</code>方法分别在各测试之前和之后运行。名称以test开头的方法都作为测试运行。</p><p><code>setUp()</code>方法尝试创建一个测试环境，尽量与正常运行应用所需的环境一致。首先，使用测试配置创建应用，然后激活上下文。这一步的作用是确保能在测试中使用<code>current_app</code>，就像普通请求一样。然后，使用<code>Flask-SQLAlchemy</code>的<code>createall()</code>方法创建一个全新的数据库，供测试使用。数据库和应用上下文在<code>tearDown()</code>方法中删除。</p><p>第一个测试确保应用实例存在。第二个测试确保应用在测试配置中运行。若想把<code>tests</code>目录作为包来使用，要添加<code>tests/init.py</code>模块，不过这个文件可以为空，因为<code>unittest</code>包会扫描所有模块，找出测试。</p><p>为了运行单元测试，可以在<code>flasky.py</code>脚本中添加一个自定义命令。</p><p><code>flasky.py</code>：启动单元测试的命令</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">@app.cli.command()</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span>():</span><br>    <span class="hljs-string">&quot;&quot;&quot;运行单元测试&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">import</span> unittest<br>    tests = unittest.TestLoader().discover(<span class="hljs-string">&#x27;tests&#x27;</span>)<br>    unittest.TextTestRunner(verbosity=<span class="hljs-number">2</span>).run(tests)<br></code></pre></div></td></tr></table></figure><p><code>app.cli.command</code>装饰器把自定义命令变得很简单。被装饰的函数名就是命令名，函数的文档字符串会显示在帮助消息中。<code>test()</code>函数的定义体中调用了<code>unittest</code>包提供的测试运行程序。单元测试可使用下面的命令运行：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv) $ flask test<br>&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">config</span>.<span class="hljs-title">DevelopmentConfig</span>&#x27;&gt;</span><br><span class="hljs-class"><span class="hljs-title">test_app_exists</span> (<span class="hljs-params">test_basics.BasicsTestCase</span>) ... &lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">config</span>.<span class="hljs-title">TestConfig</span>&#x27;&gt;</span><br><span class="hljs-class"><span class="hljs-title">ok</span></span><br><span class="hljs-class"><span class="hljs-title">test_app_is_testing</span> (<span class="hljs-params">test_basics.BasicsTestCase</span>) ... &lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">config</span>.<span class="hljs-title">TestConfig</span>&#x27;&gt;</span><br><span class="hljs-class"><span class="hljs-title">ok</span></span><br><span class="hljs-class"></span><br><span class="hljs-class">----------------------------------------------------------------------</span><br><span class="hljs-class"><span class="hljs-title">Ran</span> 2 <span class="hljs-title">tests</span> <span class="hljs-title">in</span> 0.043<span class="hljs-title">s</span></span><br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-title">OK</span></span><br></code></pre></div></td></tr></table></figure><h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><p>选从环境变量中读取数据库的URL，同时还提供了一个默认的<code>SQLite</code>数据库作为备用。3种配置环境中的环境变量名和<code>SQLite</code>数据库文件名都不一样。例如，在开发环境中，数据库URL从环境变量<code>DEV_DATABASE_URI</code>中读取，如果没有定义这个环境变量，则使用名为<code>data-dev.sqlite</code>的<code>SQLite</code>数据库。不管从哪里获取数据库URL，都要在新数据库中创建数据表。如果使用<code>Flask-Migrate</code>跟踪迁移，可使用下述命令创建数据表或者升级到最新修订版本。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv) $ flask db init<br>&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">config</span>.<span class="hljs-title">DevelopmentConfig</span>&#x27;&gt;</span><br><span class="hljs-class"><span class="hljs-title">Creating</span> <span class="hljs-title">directory</span> <span class="hljs-title">D</span>:</span>\PycharmProjects\Flask_Projects\flasky\migrations\versions ...  done<br>Generating D:\PycharmProjects\Flask_Projects\flasky\migrations\alembic.ini ...  done<br>Generating D:\PycharmProjects\Flask_Projects\flasky\migrations\env.py ...  done<br>Generating D:\PycharmProjects\Flask_Projects\flasky\migrations\README ...  done<br>Generating D:\PycharmProjects\Flask_Projects\flasky\migrations\script.py.mako ...  done<br>Please edit configuration/connection/logging settings <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;D:\\PycharmProjects\\Flask_Projects\\flasky\\migrations\\alembic.ini&#x27;</span> before proceeding.<br></code></pre></div></td></tr></table></figure><p>迁移：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv) $ flask db migrate<br>&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">config</span>.<span class="hljs-title">DevelopmentConfig</span>&#x27;&gt;</span><br><span class="hljs-class"><span class="hljs-title">INFO</span>  [<span class="hljs-title">alembic</span>.<span class="hljs-title">runtime</span>.<span class="hljs-title">migration</span>] <span class="hljs-title">Context</span> <span class="hljs-title">impl</span> <span class="hljs-title">SQLiteImpl</span>.</span><br><span class="hljs-class"><span class="hljs-title">INFO</span>  [<span class="hljs-title">alembic</span>.<span class="hljs-title">runtime</span>.<span class="hljs-title">migration</span>] <span class="hljs-title">Will</span> <span class="hljs-title">assume</span> <span class="hljs-title">non</span>-<span class="hljs-title">transactional</span> <span class="hljs-title">DDL</span>.</span><br><span class="hljs-class"><span class="hljs-title">INFO</span>  [<span class="hljs-title">alembic</span>.<span class="hljs-title">autogenerate</span>.<span class="hljs-title">compare</span>] <span class="hljs-title">Detected</span> <span class="hljs-title">added</span> <span class="hljs-title">table</span> &#x27;<span class="hljs-title">roles</span>&#x27;</span><br><span class="hljs-class"><span class="hljs-title">INFO</span>  [<span class="hljs-title">alembic</span>.<span class="hljs-title">autogenerate</span>.<span class="hljs-title">compare</span>] <span class="hljs-title">Detected</span> <span class="hljs-title">added</span> <span class="hljs-title">table</span> &#x27;<span class="hljs-title">users</span>&#x27;</span><br><span class="hljs-class"><span class="hljs-title">INFO</span>  [<span class="hljs-title">alembic</span>.<span class="hljs-title">autogenerate</span>.<span class="hljs-title">compare</span>] <span class="hljs-title">Detected</span> <span class="hljs-title">added</span> <span class="hljs-title">index</span> &#x27;<span class="hljs-title">ix_users_username</span>&#x27; <span class="hljs-title">on</span> &#x27;[&#x27;<span class="hljs-title">username</span>&#x27;]&#x27;</span><br><span class="hljs-class"><span class="hljs-title">Generating</span> <span class="hljs-title">D</span>:</span>\PycharmProjects\Flask_Projects\flasky\migrations\versions\94427408a3d4_.py ...  done<br></code></pre></div></td></tr></table></figure><p>更新：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv) $ flask db upgrade<br></code></pre></div></td></tr></table></figure><h2 id="运行应用"><a href="#运行应用" class="headerlink" title="运行应用"></a>运行应用</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv) $ flask run<br></code></pre></div></td></tr></table></figure><p>每次启动一个新的命令提示符会话，都要设定<code>FLASK_APP</code>和<code>FLASK_DEBUG</code>环境变量，这有点麻烦。你可以做些配置，让系统自动设定这些变量。如果你使用<code>bash</code>，可以把环境变量添加到<code>~/.bashrc</code>文件中。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Flask</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>flask</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flask-Mail实现邮件功能</title>
    <link href="/2021/08/05/Flask-Mail%E5%AE%9E%E7%8E%B0%E9%82%AE%E4%BB%B6%E5%8A%9F%E8%83%BD/"/>
    <url>/2021/08/05/Flask-Mail%E5%AE%9E%E7%8E%B0%E9%82%AE%E4%BB%B6%E5%8A%9F%E8%83%BD/</url>
    
    <content type="html"><![CDATA[<h1 id="使用Flask-Mail提供电子邮件支持"><a href="#使用Flask-Mail提供电子邮件支持" class="headerlink" title="使用Flask-Mail提供电子邮件支持"></a>使用Flask-Mail提供电子邮件支持</h1><p>虽然Python标准库中的<code>smtplib</code>包可用于在Flask应用中发送电子邮件，但包装了<code>smtplib</code>的<code>Flask-Mail</code>扩展能更好地与Flask集成。<code>Flask-Mail</code>使用<code>pip</code>安装：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">(venv)$</span><span class="bash"> pip install falsk-mail</span><br></code></pre></div></td></tr></table></figure><p><code>Flask-Mail</code>连接到简单邮件传输协议<code>（SMTP, simple mail transfer protocol）</code>服务器，把邮件交给这个服务器发送。如果不进行配置，则<code>Flask-Mail</code>连接<code>localhost</code>上的<code>25</code>端口，无须验证身份即可发送电子邮件。</p><p><code>Flask-Mail</code> SMTP服务器的配置:</p><table><thead><tr><th>配置</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>MAIL_SERVER</td><td>localhost</td><td>电子邮件服务器的主机名或IP地址</td></tr><tr><td>MAIL_PORT</td><td>25</td><td>电子邮件服务器的端口</td></tr><tr><td>MAIL_USE_TLS</td><td>FALSE</td><td>启用传输层安全（<code>TLS，transoprt layer security</code>）协议</td></tr><tr><td>MAIL_USE_SSL</td><td>False</td><td>启用安全套接层（SSL，secure sockets layer）协议</td></tr><tr><td>MAIL_USERNAME</td><td>None</td><td>邮件账户的用户名</td></tr><tr><td>MAIL_PASSWORD</td><td>None</td><td>邮件账户的密码</td></tr></tbody></table><p>在开发过程中，连接到外部SMTP服务器可能更方便。</p><p>配置Flask-Mail使用<code>GMAIL</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">app.config[<span class="hljs-string">&#x27;MAIL_SERVER&#x27;</span>] = <span class="hljs-string">&#x27;smtp.googlemail.com&#x27;</span><br>app.config[<span class="hljs-string">&#x27;MAIL_PORT&#x27;</span>] = <span class="hljs-number">587</span><br>app.config[<span class="hljs-string">&#x27;MAIL_USE_TLS&#x27;</span>] = <span class="hljs-literal">True</span><br>app.config[<span class="hljs-string">&#x27;MAIL_USERNAME&#x27;</span>] = os.environ.get(<span class="hljs-string">&#x27;MAIL_USERNAME&#x27;</span>)<br>app.config[<span class="hljs-string">&#x27;MAIL_PASSWORD&#x27;</span>] = os.environ.get(<span class="hljs-string">&#x27;MAIL_PASSWORD&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>初始化方法：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Mail<br>mail = Mail(app)<br></code></pre></div></td></tr></table></figure><h2 id="在python-shell中发送电子邮件"><a href="#在python-shell中发送电子邮件" class="headerlink" title="在python shell中发送电子邮件"></a>在python shell中发送电子邮件</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv)$falsk shell<br>&gt;&gt;&gt;<span class="hljs-keyword">from</span> flask_mail <span class="hljs-keyword">import</span> Message<br>&gt;&gt;&gt;<span class="hljs-keyword">from</span> run <span class="hljs-keyword">import</span> mail<br>&gt;&gt;&gt;msg = Message(<span class="hljs-string">&#x27;test mail&#x27;</span>, sender=<span class="hljs-string">&#x27;you@example.com&#x27;</span>, recipients=[<span class="hljs-string">&#x27;you@example.com&#x27;</span>])<br>&gt;&gt;&gt;msg.body = <span class="hljs-string">&#x27;This is the plain text body&#x27;</span><br>&gt;&gt;&gt;msg.html = <span class="hljs-string">&#x27;This is the &lt;b&gt;HTML&lt;/b&gt; body&#x27;</span><br>&gt;&gt;&gt;<span class="hljs-keyword">with</span> app.app_context():<br>...mail.send(msg)<br>...<br></code></pre></div></td></tr></table></figure><p>注意，<code>Flask-Mail</code>的<code>send()</code>函数使用<code>current_app</code>，因此要在激活的应用上下文中执行。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Flask</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>flask</tag>
      
      <tag>mail</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flask数据库</title>
    <link href="/2021/08/02/flask%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <url>/2021/08/02/flask%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    
    <content type="html"><![CDATA[<h1 id="关系型数据库"><a href="#关系型数据库" class="headerlink" title="关系型数据库"></a>关系型数据库</h1><p>关系型数据库把数据存储在<strong>表</strong>中，表为应用中不同的实体建模。例如，订单管理应用的数据库中可能有<code>customers</code>、<code>products</code>和<code>orders</code>等表。</p><p>表中的列数是固定的，行数是可变的。列定义表所表示的实体的数据属性。例如，customers表中可能有name、address、phone等列。表中的行定义部分或所有列对应的真实数据。</p><p>表中有个特殊的列，称为<strong>主键</strong>，其值为表中各行的唯一标识符。表中还可以有称为<strong>外键</strong>的列，引用同一个表或不同表中某一行的主键。行之间的这种联系称为关系，这正是关系型数据库模型的基础。</p><pre><code class=" mermaid">classDiagramclass rolesroles: idroles: nameclass usersusers: idusers: usernameusers: passwordusers: role_idroles &lt;|-- users</code></pre><p>数据库结构的这种图示法称为<strong>实体-关系图</strong>。其中，方框表示数据库表，里面列出表的属性（或列）。<code>roles</code>表存储所有可用的用户角色，每个角色都使用一个唯一的<code>id</code>值（即表的主键）进行标识。<code>users</code>表存储用户，每个用户也有唯一的<code>id</code>值。除了<code>id</code>主键之外，<code>roles</code>表中还有<code>name</code>列，<code>users</code>表中还有<code>username</code>和<code>password</code>列。</p><h2 id="Python数据库框架"><a href="#Python数据库框架" class="headerlink" title="Python数据库框架"></a>Python数据库框架</h2><p>Flask并不限制你使用何种类型的数据库包，因此你可以根据自己的喜好选择使用<code>MySQL</code>、<code>Postgres</code>、<code>SQLite</code>、<code>Redis</code>、<code>MongoDB</code>、<code>CouchDB</code>或<code>DynamoDB</code>。</p><p>如果这些都无法满足需求，还有一些数据库抽象层代码包供选择，例如<code>SQLAlchemy</code>和<code>MongoEngine</code>。你可以使用这些抽象包直接处理高等级的Python对象，而不用处理如表、文档或查询语言之类的数据库实体。</p><h2 id="使用Flask-SQLAlchemy管理数据库"><a href="#使用Flask-SQLAlchemy管理数据库" class="headerlink" title="使用Flask-SQLAlchemy管理数据库"></a>使用<code>Flask-SQLAlchemy</code>管理数据库</h2><p><code>Flask-SQLAlchemy</code>是一个Flask扩展，简化了在Flask应用中使用<code>SQLAlchemy</code>的操作。<code>SQLAlchemy</code>是一个强大的关系型数据库框架，支持多种数据库后台。<code>SQLAlchemy</code>提供了高层<code>ORM</code>，也提供了使用数据库原生<code>SQL</code>的低层功能。</p><p>安装：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">(venv) $ pip install flask-sqlalchemy<br></code></pre></div></td></tr></table></figure><p>在<code>Flask-SQLAlchemy</code>中，数据库使用URL指定。</p><table><thead><tr><th>数据库引擎</th><th>URL</th></tr></thead><tbody><tr><td><code>MySQL</code></td><td><code>mysql://username:password@hostname/databse</code></td></tr><tr><td><code>Postgres</code></td><td><code>postgresql://username:password@hostname/database</code></td></tr><tr><td><code>SQLite(linux, macos)</code></td><td><code>sqlite:////absolute/path/to/database</code></td></tr><tr><td><code>SQLite(windows)</code></td><td><code>sqlite:///c:/absolute/path/to/database</code></td></tr></tbody></table><p>在这些URL中，<code>hostname</code>表示数据库服务所在的主机，可以是本地主机<code>（localhost）</code>，也可以是远程服务器。数据库服务器上可以托管多个数据库，因此<code>database</code>表示要使用的数据库名。如果数据库需要验证身份，使用<code>username</code>和<code>password</code>提供数据库用户的凭据。</p><blockquote><p><code>SQLite</code>数据库没有服务器，因此不用指定<code>hostname</code>、<code>username</code>和<code>password</code>。URL中的<code>database</code>是磁盘中的文件名。</p></blockquote><p>应用使用的数据库URL必须保存到Flask配置对象的<code>SQLALCHEMY_DATABASEURI</code>键中。<code>Flask-SQLAlchemy</code>文档还建议把<code>SQLALCHEMY_TRACKMODIFICATIONS</code>键设为False，以便在不需要跟踪对象变化时降低内存消耗。其他配置选项的作用参阅<code>Flask-SQLAlchemy</code>的文档。</p><p>配置数据库：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 数据库</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> flask_sqlalchemy <span class="hljs-keyword">import</span> SQLAlchemy<br><br>basedir = os.path.abspath(os.path.dirname(__file__))<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>] = <span class="hljs-string">&#x27;sqlite:///&#x27;</span> + os.path.join(basedir, <span class="hljs-string">&#x27;data.sqlite&#x27;</span>)<br>app.config[<span class="hljs-string">&#x27;SQLALCHEMY_TRACK_MODIFICATIONS&#x27;</span>] = <span class="hljs-literal">False</span><br><br>db = SQLAlchemy(app)<br></code></pre></div></td></tr></table></figure><p><code>db</code>对象是<code>SQLAlchemy</code>类的实例，表示应用使用的数据库，通过它可获得<code>Flask-SQLAlchemy</code>提供的所有功能。</p><h2 id="定义模型"><a href="#定义模型" class="headerlink" title="定义模型"></a>定义模型</h2><p>模型这个术语表示应用使用的持久化实体。在<code>ORM</code>中，模型一般是一个Python类，类中的属性对应于数据库表中的列。</p><p><code>Flask-SQLAlchemy</code>创建的数据库实例为模型提供了一个基类以及一系列辅助类和辅助函数，可用于定义模型的结构。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Role</span>(<span class="hljs-params">db.Model</span>):</span><br>    __tablename__ = <span class="hljs-string">&#x27;roles&#x27;</span><br>    <span class="hljs-built_in">id</span> = db.Column(db.Integer, primary_key=<span class="hljs-literal">True</span>)<br>    name = db.Column(db.String(<span class="hljs-number">64</span>), unique=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;Role %r&gt;&#x27;</span> % self.name<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>(<span class="hljs-params">db.Model</span>):</span><br>    __tablename__ = <span class="hljs-string">&#x27;users&#x27;</span><br>    <span class="hljs-built_in">id</span> = db.Column(db.Integer, primary_key=<span class="hljs-literal">True</span>)<br>    username = db.Column(db.String(<span class="hljs-number">64</span>), unique=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;User %r&gt;&#x27;</span> % self.username<br></code></pre></div></td></tr></table></figure><p>类变量<code>tablename</code>定义在数据库中使用的表名。如果没有定义<code>tablename</code> , <code>Flask-SQLAlchemy</code>会使用一个默认名称，但默认的表名没有遵守流行的使用复数命名的约定，所以最好由我们自己来指定表名。其余的类变量都是该模型的属性，定义为<code>db.Column</code>类的实例。</p><p><code>db.Column</code>类构造函数的第一个参数是数据库列和模型属性的类型。</p><p>常用的列类型以及在模型中使用的Python类型。</p><table><thead><tr><th>类型名</th><th>Python类型</th><th>说明</th></tr></thead><tbody><tr><td><code>Integer</code></td><td><code>int</code></td><td>普通整数，通常是32位</td></tr><tr><td><code>SmallInteger</code></td><td><code>int</code></td><td>取值范围小的整数，通常是16位</td></tr><tr><td><code>BigInteger</code></td><td><code>int或long</code></td><td>不限制精度的整数</td></tr><tr><td><code>Float</code></td><td><code>float</code></td><td>浮点数</td></tr><tr><td><code>Numeric</code></td><td><code>decimal.Decimal</code></td><td>定点数</td></tr><tr><td><code>String</code></td><td><code>str</code></td><td>变长字符串</td></tr><tr><td>Text``</td><td><code>str</code></td><td>变长字符串，对较长或不限长度的字符串做了优化</td></tr><tr><td><code>Unicode</code></td><td><code>unicode</code></td><td>变长Unicode字符串</td></tr><tr><td><code>UnicodeText</code></td><td><code>unicode</code></td><td>变长Unicode字符串</td></tr><tr><td><code>Boolean</code></td><td><code>bool</code></td><td>布尔值</td></tr><tr><td><code>Date</code></td><td><code>datatime.date</code></td><td>日期</td></tr><tr><td><code>Time</code></td><td><code>datatime.time</code></td><td>时间</td></tr><tr><td><code>DateTime</code></td><td><code>datetime.datetime</code></td><td>时间和日期</td></tr><tr><td><code>Interval</code></td><td><code>datetime.timedelta</code></td><td>时间间隔</td></tr><tr><td><code>Enum</code></td><td><code>str</code></td><td>一组字符串</td></tr><tr><td><code>PickleType</code></td><td><code>任何Python对象</code></td><td>自动使用<code>Pcikle</code>序列化</td></tr><tr><td><code>LargeBinary</code></td><td><code>str</code></td><td>二进制blob</td></tr></tbody></table><p><code>db.Column</code>的其余参数指定属性的配置选项。</p><table><thead><tr><th>选项名</th><th>说明</th></tr></thead><tbody><tr><td>primary_key</td><td>如果设为True，列为表的主键</td></tr><tr><td>unique</td><td>如果设为True，列不允许出现重复的值</td></tr><tr><td>index</td><td>如果设为True，为列创建索引，提升查询效率</td></tr><tr><td>nullable</td><td>如果设置为True，列允许使用空值，如果设为False，列不允许有空值</td></tr><tr><td>default</td><td>为列定义默认值</td></tr></tbody></table><blockquote><p><code>Flask-SQLAlchemy</code>要求每个模型都定义主键，这一列经常命名为<code>id</code>。</p></blockquote><p>虽然没有强制要求，但这两个模型都定义了<code>repr()</code> 方法，返回一个具有可读性的字符串表示模型，供调试和测试时使用。</p><h2 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h2><p>关系型数据库使用关系把不同表中的行联系起来。关系图表示用户和角色之间的一种简单关系。这是角色到用户的<strong>一对多</strong>关系，因为一个角色可属于多个用户，而每个用户都只能有一个角色。</p><p>在数据库模型中定义关系：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Role</span>(<span class="hljs-params">db.Model</span>):</span><br>   <span class="hljs-comment"># ...</span><br>    users = db.relationship(<span class="hljs-string">&#x27;Users&#x27;</span>, backref=<span class="hljs-string">&#x27;role&#x27;</span>)<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>(<span class="hljs-params">db.Model</span>):</span><br><span class="hljs-comment"># ...</span><br>    role_id = db.Column(db.Integer, db.ForeignKey(<span class="hljs-string">&#x27;roles.id&#x27;</span>))<br></code></pre></div></td></tr></table></figure><p>关系使用<code>users</code>表中的外键连接两行。添加到<code>User</code>模型中的<code>role_id</code>列被定义为外键，就是这个外键建立起了关系。传给<code>db.ForeignKey()</code>的参数<code>’roles.id’</code>表明，这列的值是<code>roles</code>表中相应行的<code>id</code>值。</p><p><code>db.relationship()</code>中的<code>backref</code>参数向<code>User</code>模型中添加一个<code>role</code>属性，从而定义反向关系。通过<code>User</code>实例的这个属性可以获取对应的<code>Role</code>模型对象，而不用再通过<code>role_id</code>外键获取。</p><h3 id="定义关系中的常用配置选项"><a href="#定义关系中的常用配置选项" class="headerlink" title="定义关系中的常用配置选项"></a>定义关系中的常用配置选项</h3><table><thead><tr><th>选项名</th><th>说明</th></tr></thead><tbody><tr><td><code>backref</code></td><td>在关系的另一个模型中添加反向引用</td></tr><tr><td><code>primaryjoin</code></td><td>明确指定两个模型之间使用的联结条件，只在模棱两可的关系中需要指定</td></tr><tr><td><code>lazy</code></td><td>指定如何加载相关记录，可选值有select（首次访问时加载）、immediate(源对象加载后就加载)、joined（加载记录，使用联结）、subquery（立即加载，但使用子查询）、noload（永不加载）和dynamic（不加载记录，但提供加载记录的查询）</td></tr><tr><td><code>uselist</code></td><td>如果设置为FALSE，不使用列表，而使用标量值</td></tr><tr><td><code>order_by</code></td><td>指定关系中记录的排序方式</td></tr><tr><td><code>secondary</code></td><td>指定多对多关系中关联表的名称</td></tr><tr><td><code>secondaryjoin</code></td><td><code>SQLAlchemy</code>无法自行决定时，指定多对多关系中的二级联结条件</td></tr></tbody></table><h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><p>设置环境变量<code>set FLASK_APP=run.py</code>，进入<code>flask shell</code>。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">from run import db<br>db.create_all()<br></code></pre></div></td></tr></table></figure><p>现在查看应用目录，你会发现有个名为<code>data.sqlite</code>的文件，文件名与配置中指定的一样。如果数据库表已经存在于数据库中，那么<code>db.create all()</code>不会重新创建或者更新相应的表。如果修改模型后要把改动应用到现有的数据库中，这一行为会带来不便。更新现有数据库表的蛮力方式是先删除旧表再重新创建：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">db.drop_all()<br>db.create_all()<br></code></pre></div></td></tr></table></figure><p><img src="image-20210804124308055.png"></p><h3 id="插入行"><a href="#插入行" class="headerlink" title="插入行"></a>插入行</h3><p>下面这段代码创建一些角色和用户：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> run <span class="hljs-keyword">import</span> Role,User<br><span class="hljs-meta">&gt;&gt;&gt; </span>admin_role = Role(name=<span class="hljs-string">&#x27;Admin&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>mod_role = Role(name=<span class="hljs-string">&#x27;Moderator&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>user_role = Role(name=<span class="hljs-string">&#x27;User&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>user_john = User(username=<span class="hljs-string">&#x27;john&#x27;</span>, role=admin_role)<br><span class="hljs-meta">&gt;&gt;&gt; </span>user_susan = User(username=<span class="hljs-string">&#x27;susan&#x27;</span>, role=user_role)<br><span class="hljs-meta">&gt;&gt;&gt; </span>user_david = User(username=<span class="hljs-string">&#x27;david&#x27;</span>, role=user_role)<br></code></pre></div></td></tr></table></figure><p>模型的构造函数接受的参数是使用关键字参数指定的模型属性初始值。注意，role属性也可使用，虽然它不是真正的数据库列，但却是一对多关系的高级表示。新建对象时没有明确设定id属性，因为在多数数据库中主键由数据库自身管理。现在这些对象只存在于Python中，还未写入数据库。因此，id尚未赋值：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(admin_role.<span class="hljs-built_in">id</span>)<br><span class="hljs-literal">None</span><br></code></pre></div></td></tr></table></figure><p>对数据库的改动通过数据库会话管理，在<code>Flask-SQLAlchemy</code>中，会话由<code>db.session</code>表示。准备把对象写入数据库之前，要先将其添加到会话中：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.add(admin_role)<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.add(mod_role)<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.add(user_role)<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.add(user_john)<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.add(user_susan)<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.add(user_david)<br></code></pre></div></td></tr></table></figure><p>或者简写成：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.add_all([admin_role,mod_role,user_role,user_john,user_susan,user_david])<br></code></pre></div></td></tr></table></figure><p>为了把对象写入数据库，我们要调用<code>commit()</code>方法提交会话：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.commit()<br></code></pre></div></td></tr></table></figure><p>提交数据后再查看id属性，现在它们已经赋值了：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(admin_role.<span class="hljs-built_in">id</span>)<br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(user_john.<span class="hljs-built_in">id</span>)<br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(user_role.<span class="hljs-built_in">id</span>)<br><span class="hljs-number">3</span><br></code></pre></div></td></tr></table></figure><blockquote><p>数据库会话<code>db.session</code>和<code>Flask session</code>对象没有关系。数据库会话也称为事务。</p><p>数据库会话也可回滚。调用<code>db.session.rollback()</code>后，添加到数据库会话中的所有对象都将还原到它们在数据库中的状态。</p></blockquote><h3 id="修改行"><a href="#修改行" class="headerlink" title="修改行"></a>修改行</h3><p>在数据库会话上调用<code>add()</code>方法也能更新模型。我们继续在之前的shell会话中进行操作，下面这个例子把<code>&quot;Admin&quot;</code>角色重命名为<code>&quot;Administrator&quot;</code>：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>admin_role.name = <span class="hljs-string">&#x27;Administrator&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.add(admin_role)<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.commit()<br></code></pre></div></td></tr></table></figure><h3 id="删除行"><a href="#删除行" class="headerlink" title="删除行"></a>删除行</h3><p>数据库会话还有个<code>delete()</code>方法。下面这个例子把<code>&quot;Moderator&quot;</code>角色从数据库中删除：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.delete(mod_role)<br><span class="hljs-meta">&gt;&gt;&gt; </span>db.session.commit()<br></code></pre></div></td></tr></table></figure><p>注意，删除与插入和更新一样，提交数据库会话后才会执行。</p><h3 id="查询行"><a href="#查询行" class="headerlink" title="查询行"></a>查询行</h3><p><code>Flask-SQLAlchemy</code>为每个模型类都提供了<code>query</code>对象。最基本的模型查询是使用<code>all()</code>方法取回对应表中的所有记录：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>Role.query.<span class="hljs-built_in">all</span>()<br>[&lt;Role <span class="hljs-string">&#x27;Administrator&#x27;</span>&gt;, &lt;Role <span class="hljs-string">&#x27;Moderator&#x27;</span>&gt;, &lt;Role <span class="hljs-string">&#x27;User&#x27;</span>&gt;]<br><span class="hljs-meta">&gt;&gt;&gt; </span>User.query.<span class="hljs-built_in">all</span>()<br>[&lt;User <span class="hljs-string">&#x27;john&#x27;</span>&gt;, &lt;User <span class="hljs-string">&#x27;susan&#x27;</span>&gt;, &lt;User <span class="hljs-string">&#x27;david&#x27;</span>&gt;]<br></code></pre></div></td></tr></table></figure><p>使用<strong>过滤器</strong>可以配置<code>query</code>对象进行更精确的数据库查询。下面这个例子查找角色为”<code>User</code>“的所有用户：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>User.query.filter_by(role_id=<span class="hljs-string">&#x27;3&#x27;</span>).<span class="hljs-built_in">all</span>()<br>[&lt;User <span class="hljs-string">&#x27;susan&#x27;</span>&gt;, &lt;User <span class="hljs-string">&#x27;david&#x27;</span>&gt;]<br></code></pre></div></td></tr></table></figure><p>若想查看<code>SQLAlchemy</code>为查询生成的原生<code>SQL</code>查询语句，只需把<code>query</code>对象转换成字符串：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">str</span>(User.query.filter_by(role_id=<span class="hljs-string">&#x27;3&#x27;</span>))<br><span class="hljs-string">&#x27;SELECT users.id AS users_id, users.username AS users_username, users.role_id AS users_role_id \nFROM users \nWHERE users.role_id = ?&#x27;</span><br></code></pre></div></td></tr></table></figure><p>如果你退出了shell会话，前面这些例子中创建的对象就不会以Python对象的形式存在，但在数据库表中仍有对应的行。如果打开一个新的shell会话，要从数据库中读取行，重新创建Python对象。下面这个例子发起一个查询，加载名为”User”的用户角色：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>user_role = Role.query.filter_by(name=<span class="hljs-string">&#x27;User&#x27;</span>).first()<br><span class="hljs-meta">&gt;&gt;&gt; </span>user_role<br>&lt;Role <span class="hljs-string">&#x27;User&#x27;</span>&gt;<br></code></pre></div></td></tr></table></figure><p>这里发起查询的不是<code>all()</code>方法，而是<code>first()</code>方法。<code>all()</code>方法返回所有结果构成的列表，而first()方法只返回第一个结果，如果没有结果的话，则返回<code>None</code>。因此，如果知道查询最多返回一个结果，就可以用这个方法。</p><p><code>filter_by()</code>等过滤器在<code>query</code>对象上调用，返回一个更精确的<code>query</code>对象。多个过滤器可以一起调用，直到获得所需结果。</p><p>常用的过滤器：</p><table><thead><tr><th>过滤器</th><th>说明</th></tr></thead><tbody><tr><td>filter()</td><td>把过滤器添加到原查询上，返回一个新查询</td></tr><tr><td>filter_by()</td><td>把等值过滤器添加到原查询上，返回一个新查询</td></tr><tr><td>limit()</td><td>使用指定的值限制原查询返回的结果数量，返回一个新查询</td></tr><tr><td>offset()</td><td>偏移量查询返回的结果，返回一个新查询</td></tr><tr><td>order_by()</td><td>根据指定条件对原查询结果进行排序，返回一个新查询</td></tr><tr><td>group_by()</td><td>根据指定条件对原查询结果进行分组，返回一个新查询</td></tr></tbody></table><p>在查询上应用指定的过滤器后，调用<code>all()</code>方法将执行查询，以列表的形式返回结果。除了<code>all()</code>方法之外，还有其他方法能触发查询执行。</p><p>常用的<code>SQLAlchemy</code>查询执行方法：</p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>all()</td><td>以列表形式返回所有查询结果</td></tr><tr><td>first()</td><td>返回查询的第一个结果，如果没有结果，则返回None</td></tr><tr><td>first_or_404()</td><td>返回查询的第一个结果，如果没有结果，则请求终止，返回404错误码</td></tr><tr><td>get()</td><td>返回指定主键对应的行，如果没有对应的行，则返回None</td></tr><tr><td>get_or_404()</td><td>返回指定主键对应的行，如果没有找到指定的主键，则请求终止，返回404错误码</td></tr><tr><td>count()</td><td>返回查询结果的数量</td></tr><tr><td>pageinate()</td><td>返回一个Paginate对象，包含指定范围内的结果</td></tr></tbody></table><p>关系与查询的处理方式类似。下面这个例子分别从关系的两端查询角色和用户之间的一对多关系：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>users = user_role.users<br><span class="hljs-meta">&gt;&gt;&gt; </span>users<br>[&lt;User <span class="hljs-string">&#x27;susan&#x27;</span>&gt;, &lt;User <span class="hljs-string">&#x27;david&#x27;</span>&gt;]<br><span class="hljs-meta">&gt;&gt;&gt; </span>users[<span class="hljs-number">0</span>].role<br>&lt;Role <span class="hljs-string">&#x27;User&#x27;</span>&gt;<br></code></pre></div></td></tr></table></figure><p>这个例子中的<code>user_role.users</code>查询有个小问题。执行<code>user_role.users</code>表达式时，隐式的查询会调用<code>all()</code>方法，返回一个用户列表。此时，<code>query</code>对象是隐藏的，无法指定更精确的查询过滤器。就这个示例而言，返回一个按照字母顺序排列的用户列表可能更好。我们修改下关系的设置，加入<code>lazy=&#39;dynamic’</code>参数，从而禁止自动执行查询。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Role</span>(<span class="hljs-params">db.Model</span>):</span><br>    <span class="hljs-comment"># ...</span><br>    users = db.relationship(<span class="hljs-string">&#x27;User&#x27;</span>, backref=<span class="hljs-string">&#x27;role&#x27;</span>, lazy=<span class="hljs-string">&#x27;dynamic&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>这样配置关系之后，<code>user_role.users</code>将返回一个尚未执行的查询，因此可以在其上添加过滤器：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>user_role.users.order_by(User.username).<span class="hljs-built_in">all</span>()<br>[&lt;User <span class="hljs-string">&#x27;susan&#x27;</span>&gt;, &lt;User <span class="hljs-string">&#x27;david&#x27;</span>&gt;]<br><span class="hljs-meta">&gt;&gt;&gt; </span>user_role.users.count()<br><span class="hljs-number">2</span><br></code></pre></div></td></tr></table></figure><h2 id="在视图函数中操作数据库"><a href="#在视图函数中操作数据库" class="headerlink" title="在视图函数中操作数据库"></a>在视图函数中操作数据库</h2><p>在这个修改后的版本中，提交表单后，应用会使用<code>filter_by()</code>查询过滤器在数据库中查找提交的名字。变量<code>known</code>被写入用户会话中，因此重定向之后，可以把数据传给模板，用于显示自定义的欢迎消息。注意，为了让应用正常运行，必须按照前面介绍的方法，在<code>Python shell</code>中创建数据库表。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    form = LoginForm()<br>    <span class="hljs-keyword">if</span> form.validate_on_submit():<br>        user = User.query.filter_by(username=form.name.data).first()<br>        <span class="hljs-keyword">if</span> user <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            user = User(username=form.name.data)<br>            db.session.add(user)<br>            db.session.commit()<br>            session[<span class="hljs-string">&#x27;known&#x27;</span>] = <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">else</span>:<br>            session[<span class="hljs-string">&#x27;known&#x27;</span>] = <span class="hljs-literal">True</span><br>        session[<span class="hljs-string">&#x27;name&#x27;</span>] = form.name.data<br>        form.name.data = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, form=form, name=session.get(<span class="hljs-string">&#x27;name&#x27;</span>), known=session.get(<span class="hljs-string">&#x27;known&#x27;</span>, <span class="hljs-literal">False</span>),<br>                           current_time=datetime.utcnow())<br></code></pre></div></td></tr></table></figure><p>这个模板使用<code>known</code>参数在欢迎消息中加入了第二行，从而对已知用户和新用户显示不同的内容。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><br>    &#123;% for message in get_flashed_messages() %&#125;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;alert alert-warning&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;close&quot;</span>&gt;</span><span class="hljs-symbol">&amp;times;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>            &#123;&#123; message &#125;&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    &#123;% endfor %&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, &#123;% if name %&#125;&#123;&#123; name &#125;&#125;&#123;% else %&#125;Stranger&#123;% endif %&#125;!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    &#123;% if not known %&#125;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Pleased to meet you!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    &#123;% else %&#125;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Pleased to see you again!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    &#123;% endif %&#125;<br>    &#123;&#123; wtf.quick_form(form) &#125;&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h2 id="集成Python-shell"><a href="#集成Python-shell" class="headerlink" title="集成Python shell"></a>集成Python shell</h2><p>若想把对象添加到导入列表中，必须使用<code>shell_context_processor</code>装饰器创建并注册一个<code>shell</code>上下文处理器。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">@app.shell_context_processor</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_shell_context</span>():</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">dict</span>(db=db, User=User, Role=Role)<br></code></pre></div></td></tr></table></figure><p>这个<code>shell</code>上下文处理器函数返回一个字典，包含数据库实例和模型。除了默认导入的<code>app</code>之外，<code>flask shell</code>命令将自动把这些对象导入<code>shell</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>app<br>&lt;Flask <span class="hljs-string">&#x27;run&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>db<br>&lt;SQLAlchemy engine=sqlite:///D:\PycharmProjects\Flask_Projects\second_app\data.sqlite&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>User<br>&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">run</span>.<span class="hljs-title">User</span>&#x27;&gt;</span><br><span class="hljs-class">&gt;&gt;&gt; <span class="hljs-title">Role</span></span><br><span class="hljs-class">&lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">run</span>.<span class="hljs-title">Role</span>&#x27;&gt;</span><br></code></pre></div></td></tr></table></figure><h2 id="使用Flask-Migrate实现数据库迁移"><a href="#使用Flask-Migrate实现数据库迁移" class="headerlink" title="使用Flask-Migrate实现数据库迁移"></a>使用Flask-Migrate实现数据库迁移</h2><p>在开发应用的过程中，你会发现有时需要修改数据库模型，而且修改之后还要更新数据库。仅当数据库表不存在时，<code>Flask-SQLAlchemy</code>才会根据模型创建。因此，更新表的唯一方式就是先删除旧表，但是这样做会丢失数据库中的全部数据。</p><p>更新表更好的方法是使<strong>数据库迁移</strong>框架。源码版本控制工具可以跟踪源码文件的变化；类似地，数据库迁移框架能跟踪数据库<strong>模式</strong>的变化，然后以增量的方式把变化应用到数据库中。</p><p><code>SQLAlchemy</code>的开发人员编写了一个迁移框架，名为<code>Alembic</code>。除了直接使用<code>Alembic</code>之外，Flask应用还可使用<code>Flask-Migrate</code>扩展。这个扩展是对<code>Alembic</code>的轻量级包装，并与<code>flask</code>命令做了集成。</p><h3 id="创建迁移仓库"><a href="#创建迁移仓库" class="headerlink" title="创建迁移仓库"></a>创建迁移仓库</h3><p>首先，要在虚拟环境中安装<code>Flask-Migrate</code>：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">(venv) $ pip install flask-migrate<br></code></pre></div></td></tr></table></figure><p>初始化方法：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask_migrate <span class="hljs-keyword">import</span> Migrate<br><br><span class="hljs-comment"># ...</span><br><br>migrate = Migrate(app, db)<br></code></pre></div></td></tr></table></figure><p>了开放数据库迁移相关的命令，<code>Flask-Migrate</code>添加了flask_db命令和几个子命令。在新项目中可以使用init子命令添加数据库迁移支持：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">(vnev) $ flask db init<br>Creating directory D:\PycharmProjects\Flask_Projects\second_app\migrations ...  done<br>Creating directory D:\PycharmProjects\Flask_Projects\second_app\migrations\versions ...  done<br>Generating D:\PycharmProjects\Flask_Projects\second_app\migrations\alembic.ini ...  done<br>Generating D:\PycharmProjects\Flask_Projects\second_app\migrations\env.py ...  done<br>Generating D:\PycharmProjects\Flask_Projects\second_app\migrations\README ...  done<br>Generating D:\PycharmProjects\Flask_Projects\second_app\migrations\script.py.mako ...  done<br>Please edit configuration/connection/logging settings in &#x27;D:\\PycharmProjects\\Flask_Projects\\second_app\\migrations\\alembic.ini&#x27; before proceeding.<br></code></pre></div></td></tr></table></figure><p>这个命令会创建<code>migrations</code>目录，所有迁移脚本都存放在这里。</p><h3 id="创建迁移脚本"><a href="#创建迁移脚本" class="headerlink" title="创建迁移脚本"></a>创建迁移脚本</h3><p>在<code>Alembic</code>中，数据库迁移用<strong>迁移脚本</strong>表示。脚本中有两个函数，分别是<code>upgrade()</code>和<code>downgrade()</code>。<code>upgrade()</code>函数把迁移中的改动应用到数据库中，<code>downgrade()</code>函数则将改动删除。<code>Alembic</code>具有添加和删除改动的能力，意味着数据库可重设到修改历史的任意一点。我们可以使用<code>revision</code>命令手动创建<code>Alembic</code>迁移，也可使用<code>migrate</code>命令自动创建。手动创建的迁移只是一个骨架，<code>upgrade()</code>和<code>downgrade()</code>函数都是空的，开发者要使用<code>Alembic</code>提供的<code>Operations</code>对象指令实现具体操作。自动创建的迁移会根据模型定义和数据库当前状态之间的差异尝试生成<code>upgrade()</code>和<code>downgrade()</code>函数的内容。</p><blockquote><p>自动创建的迁移不一定总是正确的，有可能会漏掉一些细节。比如说我们重命名了一列，自动生成的迁移可能会把这当作删除了一列，然后又新增了一列。如果原封不动地使用自动生成的迁移，这一列中的数据就会丢失！鉴于此，自动生成迁移脚本后一定要进行检查，把不准确的部分手动改过来。</p></blockquote><p>使用Flask-Migrate管理数据库模式变化的步骤如下。</p><ol><li>对模型类做必要的修改。</li><li> 执行flask db migrate命令，自动创建一个迁移脚本。</li><li> 检查自动生成的脚本，根据对模型的实际改动进行调整。</li><li>把迁移脚本纳入版本控制。</li><li> 执行flask db upgrade命令，把迁移应用到数据库中。</li></ol><p><code>flask db migrate</code>子命令用于自动创建迁移脚本:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">flask db migrate -m <span class="hljs-string">&quot;initial migrations&quot;</span><br></code></pre></div></td></tr></table></figure><h3 id="更新数据库"><a href="#更新数据库" class="headerlink" title="更新数据库"></a>更新数据库</h3><p>检查并修正好迁移脚本之后，执行<code>flask db upgrade</code>命令，把迁移应用到数据库中：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv) $ flask db upgrade<br>INFO  [alembic.runtime.migration] Context impl SQLiteImpl.<br>INFO  [alembic.runtime.migration] Will assume non-transactional DDL.<br></code></pre></div></td></tr></table></figure><blockquote><p>如果你按照之前的说明操作过，那么已经使用<code>db.create all()</code>函数创建了数据库文件。此时，<code>flask db upgrade</code>命令将失败，因为它试图创建已经存在的数据库表。一种简单的处理方法是，把<code>data.sqlite</code>数据库文件删掉，然后执行<code>flask dbupgrade</code>命令，通过迁移框架重新创建数据库。另一种方法是不执行<code>flask dbupgrade</code>命令，而是使用<code>flask db stamp</code>命令把现有数据库标记为已更新。</p></blockquote><h3 id="添加几个迁移"><a href="#添加几个迁移" class="headerlink" title="添加几个迁移"></a>添加几个迁移</h3><p>在开发项目的过程中，时常要修改数据库模型。如果使用迁移框架管理数据库，必须在迁移脚本中定义所有改动，否则改动将不可复现。修改数据库的步骤与创建第一个迁移类似。</p><ol><li>对数据库模型做必要的修改。</li><li>执行flask db migrate命令，生成迁移脚本。</li><li>检查自动生成的脚本，改正不准确的地方。</li><li>执行flask db upgrade命令，把改动应用到数据库中。</li></ol><p>实现一个功能时，可能要多次修改数据库模型才能得到预期结果。如果前一个迁移还未提交到源码控制系统中，可以继续在那个迁移中修改，以免创建大量无意义的小迁移脚本。在前一个迁移脚本的基础上修改的步骤如下。</p><ol><li>执行flask db downgrade命令，还原前一个脚本对数据库的改动（注意，这可能导致部分数据丢失）。</li><li> 删除前一个迁移脚本，因为现在已经没什么用了。</li><li> 执行flask db migrate命令生成一个新的数据库迁移脚本。这个迁移脚本除了前面删除的那个脚本中的改动之外，还包括这一次对模型的改动。</li><li>根据前面的说明，检查并应用迁移脚本。</li></ol><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Flask</category>
      
    </categories>
    
    
    <tags>
      
      <tag>flask</tag>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Web表单</title>
    <link href="/2021/07/30/Web%E8%A1%A8%E5%8D%95/"/>
    <url>/2021/07/30/Web%E8%A1%A8%E5%8D%95/</url>
    
    <content type="html"><![CDATA[<p>使用HTML可以创建Web表单，供用户填写信息。表单数据由Web浏览器提交给服务器，这一过程通常使用POST请求。Flask请求对象包含客户端在请求中发送的全部信息，对包含表单数据的POST请求来说，用户填写的信息通过request.form访问。尽管Flask的请求对象提供的信息足以处理Web表单，但有些任务很单调，而且要重复操作。比如，生成表单的HTML代码和验证提交的表单数据。</p><p>Flask-WTF扩展可以把处理Web表单的过程变成一种愉悦的体验。这个扩展对独立的WTForms包进行了包装，方便集成到Flask应用中。Flask-WTF及其依赖可使用pip安装：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">(venv) $ pip install flask-wtf<br></code></pre></div></td></tr></table></figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>与其他多数扩展不同，<code>Flask-WTF</code>无须在应用层初始化，但是它要求应用配置一个密钥。密钥是一个由随机字符构成的唯一字符串，通过加密或签名以不同的方式提升应用的安全性。Flask使用这个密钥保护用户会话，以防被篡改。每个应用的密钥应该不同，而且不能让任何人知道。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-string">&#x27;hard to guess string&#x27;</span><br></code></pre></div></td></tr></table></figure><p>app.config字典可用于存储Flask、扩展和应用自身的配置变量。使用标准的字典句法就能把配置添加到app.config对象中。这个对象还提供了一些方法，可以从文件或环境中导入配置。</p><p>Flask-WTF之所以要求应用配置一个密钥，是为了防止表单遭到跨站请求伪造（CSRF, cross-site request forgery）攻击。恶意网站把请求发送到被攻击者已登录的其他网站时，就会引发CSRF攻击。Flask-WTF为所有表单生成安全令牌，存储在用户会话中。令牌是一种加密签名，根据密钥生成。</p><blockquote><p>为了增强安全性，密钥不应该直接写入源码，而要保存在环境变量中。</p></blockquote><h2 id="表单类"><a href="#表单类" class="headerlink" title="表单类"></a>表单类</h2><p>使用Flask-WTF时，在服务器端，每个Web表单都由一个继承自<code>FlaskForm</code>的类表示。这个类定义表单中的一组字段，每个字段都用对象表示。字段对象可附属一个或多个验证函数。验证函数用于验证用户提交的数据是否有效。</p><p>定义表单类：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 定义一个表单类</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginForm</span>(<span class="hljs-params">FlaskForm</span>):</span><br>    <span class="hljs-comment"># 定义一个文本框，提示信息为用户名，validators设置验证规则，参数是一个列表，可以添加多个验证函数，DataRequired不能为空验证函数</span><br>    name = StringField(<span class="hljs-string">&quot;用户名：&quot;</span>, validators=[DataRequired()])<br>    <span class="hljs-comment"># 定义一个提交按钮</span><br>    submit = SubmitField(<span class="hljs-string">&quot;提交&quot;</span>)<br></code></pre></div></td></tr></table></figure><p><code>LoginForm</code>表单中有一个名为<code>name</code>的文本字段和一个名为<code>submit</code>的提交按钮。StringField类表示属性为<code>type=&quot;text&quot;</code>的HTML <code>&lt;input&gt;</code>元素。SubmitField类表示属性为type=”submit”的HTML <code>&lt;input&gt;</code>元素。字段构造函数的第一个参数是把表单渲染成HTML时使用的标注（label）。</p><p>StringField构造函数中的可选参数validators指定一个由验证函数组成的列表，在接受用户提交的数据之前验证数据。验证函数DataRequired()确保提交的字段内容不为空。</p><blockquote><p>FlaskForm基类由Flask-WTF扩展定义，所以要从flask wtf中导入。然而，字段和验证函数却是直接从WTForms包中导入的。</p></blockquote><p>WTForms支持的HTML标准字段。</p><table><thead><tr><th>字段类型</th><th>说明</th></tr></thead><tbody><tr><td>BooleanField</td><td>复选框，值为TRUE和FALSE</td></tr><tr><td>DateField</td><td>文本字段，值为datetime.date格式</td></tr><tr><td>DateTimeField</td><td>文本字段，值为datetime.datetime格式</td></tr><tr><td>DecimalField</td><td>文本字段，值为decimal.Decimal</td></tr><tr><td>FileField</td><td>文件上传字段</td></tr><tr><td>HiddenField</td><td>隐藏的文本字段</td></tr><tr><td>MultipleFileField</td><td>多文件上传字段</td></tr><tr><td>Fieldlist</td><td>一组指定类型的字段</td></tr><tr><td>FloatField</td><td>文本字段，值为浮点数</td></tr><tr><td>FormField</td><td>把一个表单作为字段嵌入另一个表单</td></tr><tr><td>IntegerField</td><td>文本字段，值为整数</td></tr><tr><td>PasswordField</td><td>密码文本字段</td></tr><tr><td>RadiField</td><td>一组单选按钮</td></tr><tr><td>SelectField</td><td>下拉列表</td></tr><tr><td>SelectMultipleField</td><td>下拉列表，可选择多个值</td></tr><tr><td>SubmitField</td><td>表单提交按钮</td></tr><tr><td>StringField</td><td>文本字段</td></tr><tr><td>TextAreaField</td><td>多行文本字段</td></tr><tr><td>WTForms内建的验证函数。</td><td></td></tr></tbody></table><table><thead><tr><th>验证函数</th><th>说明</th></tr></thead><tbody><tr><td>DataRequired</td><td>确保转换类型后字段中有数据</td></tr><tr><td>Email</td><td>验证电子邮件地址</td></tr><tr><td>EqualTo</td><td>比较两个字段的值，常用于要求输入两次密码进行确认的情况</td></tr><tr><td>InputReqiured</td><td>确保转换类型前字段中有数据</td></tr><tr><td>IPAddress</td><td>验证IPv4网络地址</td></tr><tr><td>Length</td><td>验证输入字符串的长度</td></tr><tr><td>MacAddress</td><td>验证MAC地址</td></tr><tr><td>NumberRange</td><td>验证输入的值在数字范围之内</td></tr><tr><td>Optional</td><td>允许字段中没有输入，将跳过其他验证函数</td></tr><tr><td>Regexp</td><td>使用正则表达式验证输入值</td></tr><tr><td>URL</td><td>验证URL</td></tr><tr><td>UUID</td><td>验证UUID</td></tr><tr><td>AnyOf</td><td>确保输入值在一组可能的值中</td></tr><tr><td>NoneOf</td><td>确保输入值不在一组可能的值中</td></tr></tbody></table><h2 id="把表单渲染成HTML"><a href="#把表单渲染成HTML" class="headerlink" title="把表单渲染成HTML"></a>把表单渲染成HTML</h2><p>表单字段是可调用的，在模板中调用后会渲染成HTML。假设视图函数通过form参数把一个NameForm实例传入模板，在模板中可以生成一个简单的HTML表单，这里使用了boostrap提供的form模板，如下所示：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">&#123;% extends &#x27;bootstrap/base.html&#x27; %&#125;<br>&#123;% import &quot;bootstrap/wtf.html&quot; as wtf %&#125;<br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, &#123;% if name %&#125;&#123;&#123; name &#125;&#125;&#123;% else %&#125;Stranger&#123;% endif %&#125;!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    &#123;&#123; wtf.quick_form(form) &#125;&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h2 id="在视图函数中处理表单"><a href="#在视图函数中处理表单" class="headerlink" title="在视图函数中处理表单"></a>在视图函数中处理表单</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    name = <span class="hljs-literal">None</span><br>    form = LoginForm()<br>    <span class="hljs-keyword">if</span> form.validate_on_submit:<br>        name = form.name.data<br>        form.name.data = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, form=form, name=name, current_time=datetime.utcnow())<br></code></pre></div></td></tr></table></figure><p>app.route装饰器中多出的methods参数告诉Flask，在URL映射中把这个视图函数注册为GET和POST请求的处理程序。如果没指定methods参数，则只把视图函数注册为GET请求的处理程序。</p><p>用户提交表单后，服务器会收到一个包含数据的POST请求。<code>validate on submit()</code>会调用名字字段上依附的<code>DataRequired()</code>验证函数。如果名字不为空，就能通过验证，<code>validate on submit()</code>返回True。</p><p><img src="image-20210731132446805.png"></p><h2 id="重定向和用户会话"><a href="#重定向和用户会话" class="headerlink" title="重定向和用户会话"></a>重定向和用户会话</h2><p>使用重定向作为POST请求的响应，而不是使用常规响应。重定向是一种特殊的响应，响应内容包含的是URL，而不是HTML代码的字符串。浏览器收到这种响应时，会向重定向的URL发起GET请求，显示页面的内容。这个页面的加载可能要多花几毫秒，因为要先把第二个请求发给服务器。除此之外，用户不会察觉到有什么不同。现在，前一个请求是GET请求，所以刷新命令能像预期的那样正常运作了。这个技巧称为<code>Post /重定向/Get模式</code>。</p><p>但这种方法又会引起另一个问题。应用处理POST请求时，可以通过<code>form.name.data</code>获取用户输入的名字，然而一旦这个请求结束，数据也就不见了。因为这个POST请求使用重定向处理，所以应用需要保存输入的名字，这样重定向后的请求才能获得并使用这个名字，从而构建真正的响应。</p><p>应用可以把数据存储在用户会话中，以便在请求之间“记住”数据。用户会话是一种私有存储，每个连接到服务器的客户端都可访问。用户会话，它是请求上下文中的变量，名为<code>session</code>，像标准的Python字典一样操作。</p><blockquote><p>默认情况下，用户会话保存在客户端cookie中，使用前面设置的密钥加密签名。如果篡改了cookie的内容，签名就会失效，会话也将随之失效。</p></blockquote><p>实现重定向和用户会话。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    form = LoginForm()<br>    <span class="hljs-built_in">print</span>(form.validate_on_submit)<br>    <span class="hljs-keyword">if</span> form.validate_on_submit():<br>        <span class="hljs-comment"># name = form.name.data</span><br>        session[<span class="hljs-string">&#x27;name&#x27;</span>] = form.name.data<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>        <span class="hljs-built_in">print</span>(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, form=form, name=session.get(<span class="hljs-string">&#x27;name&#x27;</span>), current_time=datetime.utcnow())<br></code></pre></div></td></tr></table></figure><p>应用的前一个版本在局部变量name中存储用户在表单中输入的名字。这个变量现在保存在用户会话中，即<code>session[&#39;name&#39;]</code>，所以在两次请求之间能记住输入的值。</p><p>现在，包含有效表单数据的请求最后会使视图函数调用<code>redirect()</code>函数。这是<code>Flask</code>提供的辅助函数，用于生成<code>HTTP</code>重定向响应。<code>redirect()</code>函数的参数是重定向的URL，这里使用的重定向<code>URL</code>是应用的根<code>URL</code>，因此重定向响应本可以写得更简单一些，写成<code>redirect(&#39;/&#39;)</code>，不过这里却使用了Flask提供的URL生成函数<code>url_for()</code>。<code>url_for()</code>函数的第一个且唯一必须指定的参数是端点名，即路由的内部名称。默认情况下，路由的端点是相应视图函数的名称。在这个示例中，处理根URL的视图函数是<code>index()</code>，因此传给<code>url_for()</code>函数的名字是index。</p><p>最后一处改动位于<code>render_template()</code>函数中，现在我们使用<code>session.get(&#39;name&#39;)</code>直接从会话中读取name参数的值。与普通的字典一样，这里使用get()获取字典中键对应的值，可以避免未找到键时抛出异常。如果指定的键不存在，则<code>get()</code>方法返回默认值None。</p><h2 id="闪现消息"><a href="#闪现消息" class="headerlink" title="闪现消息"></a>闪现消息</h2><p>请求完成后，有时需要让用户知道状态发生了变化，可以是确认消息、警告或者错误提醒。一个典型例子是，用户提交有一项错误的登录表单后，服务器发回的响应重新渲染登录表单，并在表单上面显示一个消息，提示用户名或密码无效。Flask本身内置这个功能。<code>flash()</code>函数可实现这种效果。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> flash<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    form = LoginForm()<br>    <span class="hljs-keyword">if</span> form.validate_on_submit():<br>        <span class="hljs-comment"># name = form.name.data</span><br>        old_name = session.get(<span class="hljs-string">&#x27;name&#x27;</span>)<br>        <span class="hljs-keyword">if</span> old_name <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> old_name != form.name.data:<br>            flash(<span class="hljs-string">&#x27;密码不正确，请好好想想！&#x27;</span>)<br>        session[<span class="hljs-string">&#x27;name&#x27;</span>] = form.name.data<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>        <span class="hljs-built_in">print</span>(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, form=form, name=session.get(<span class="hljs-string">&#x27;name&#x27;</span>), current_time=datetime.utcnow())<br></code></pre></div></td></tr></table></figure><p>每次提交的名字都会和存储在用户会话中的名字进行比较，而会话中存储的名字是前一次在这个表单中提交的数据。如果两个名字不一样，就会调用<code>flash()</code>函数，在发给客户端的下一个响应中显示一个消息。</p><p>仅调用<code>flash()</code>函数并不能把消息显示出来，应用的模板必须渲染这些消息。最好在基模板中渲染闪现消息，因为这样所有页面都能显示需要显示的消息。Flask把<code>get_flashed_messages()</code>函数开放给模板，用于获取并渲染闪现消息。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"> &#123;% for message in get_flashed_messages() %&#125;<br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;alert alert-warning&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;close&quot;</span>&gt;</span><span class="hljs-symbol">&amp;times;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>        &#123;&#123; message &#125;&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>&#123;% endfor %&#125;<br></code></pre></div></td></tr></table></figure><p>这里使用了循环，因为在之前的请求循环中每次调用<code>flash()</code>函数时都会生成一个消息，所以可能有多个消息在排队等待显示。<code>get_flashed_messages()</code>函数获取的消息在下次调用时不会再次返回，因此闪现消息只显示一次，然后就消失了。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Flask</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>flask</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用Flask-Moment本地化日期和时间</title>
    <link href="/2021/07/30/%E4%BD%BF%E7%94%A8Flask-Moment%E6%9C%AC%E5%9C%B0%E5%8C%96%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4/"/>
    <url>/2021/07/30/%E4%BD%BF%E7%94%A8Flask-Moment%E6%9C%AC%E5%9C%B0%E5%8C%96%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4/</url>
    
    <content type="html"><![CDATA[<p>有一个使用JavaScript开发的优秀客户端开源库，名为Moment.js，它可以在浏览器中渲染日期和时间。Flask-Moment是一个Flask扩展，能简化把Moment.js集成到Jinja2模板中的过程。Flask-Moment使用pip安装：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">(venv)$</span><span class="bash"> pip install flask-moment</span><br></code></pre></div></td></tr></table></figure><p>初始化</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask_moment <span class="hljs-keyword">import</span> Moment<br><span class="hljs-comment"># ...</span><br><br>Moment(app)<br><br><span class="hljs-comment"># ...</span><br></code></pre></div></td></tr></table></figure><p>除了Moment.js, Flask-Moment还依赖jQuery.js。因此，要在HTML文档的某个地方引入这两个库，可以直接引入，这样可以选择使用哪个版本，也可以使用扩展提供的辅助函数，从内容分发网络（CDN, content delivery network）中引入通过测试的版本。Bootstrap已经引入了jQuery.js，因此只需引入Moment.js即可。</p><p>templates/index.html：引入Moment.js库</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">&#123;% block scripts %&#125;&#125;<br>    &#123;&#123; super() &#125;&#125;<br>    &#123;&#123; moment.include_moment()&#125;&#125;<br>&#123;% endblock %&#125;&#125;<br></code></pre></div></td></tr></table></figure><p>为了处理时间戳，Flask-Moment向模板开放了moment对象。把变量current time传入模板进行渲染。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, name=<span class="hljs-string">&quot;world&quot;</span>, current_time=datetime.utcnow())<br></code></pre></div></td></tr></table></figure><p>在模板中渲染：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>The local date and time is &#123;&#123; moment(current_time).format(&#x27;LLL&#x27;) &#125;&#125;.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>That was &#123;&#123; moment(current_time).fromNow(refresh=True) &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>实现效果：</p><p><img src="image-20210730113140244.png"></p><p>Flask-Moment实现了Moment.js的format()、fromNow()、fromTime()、calendar()、valueOf()和unix()等方法。请查阅Moment.js的文档（<a href="http://momentjs.com/docs/#/displaying/%EF%BC%89%EF%BC%8C%E5%AD%A6%E4%B9%A0%E8%BF%99%E4%B8%AA%E5%BA%93%E6%8F%90%E4%BE%9B%E7%9A%84%E5%85%A8%E9%83%A8%E6%A0%BC%E5%BC%8F%E5%8C%96%E9%80%89%E9%A1%B9%E3%80%82">http://momentjs.com/docs/#/displaying/），学习这个库提供的全部格式化选项。</a></p><p>Flask-Moment渲染的时间戳可实现多种语言的本地化。语言可在模板中选择，方法是在引入Moment.js之后，立即把两个字母的语言代码传给locale()函数。例如，配置Moment. js使用汉语的方式如下：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">&#123;% block scripts %&#125;&#125;<br>    &#123;&#123; super() &#125;&#125;<br>    &#123;&#123; moment.include_moment()&#125;&#125;<br>    &#123;&#123; moment.locale(&#x27;zh-cn&#x27;) &#125;&#125;<br>&#123;% endblock %&#125;&#125;<br></code></pre></div></td></tr></table></figure><p><img src="image-20210730113419711.png"></p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Flask</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>flask</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用Flask-Bootstrap集成Bootstrap</title>
    <link href="/2021/07/30/%E4%BD%BF%E7%94%A8Flask-Bootstrap%E9%9B%86%E6%88%90Bootstrap/"/>
    <url>/2021/07/30/%E4%BD%BF%E7%94%A8Flask-Bootstrap%E9%9B%86%E6%88%90Bootstrap/</url>
    
    <content type="html"><![CDATA[<p>Bootstrap是Twitter开发的一个开源Web框架，它提供的用户界面组件可用于创建整洁且具有吸引力的网页，而且兼容所有现代的桌面和移动平台Web浏览器。</p><h2 id="安装Flask-Bootstrap扩展"><a href="#安装Flask-Bootstrap扩展" class="headerlink" title="安装Flask-Bootstrap扩展"></a>安装Flask-Bootstrap扩展</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv)$pip install flask-bootstrap<br></code></pre></div></td></tr></table></figure><p>Flask扩展在创建应用实例时初始化。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask_bootstrap <span class="hljs-keyword">import</span> Bootstrap<br><span class="hljs-comment"># ...</span><br><br>app = Flask(__name__)<br>Bootstrap(app)<br><br><span class="hljs-comment"># ...</span><br></code></pre></div></td></tr></table></figure><h2 id="使用Bootstrap模板"><a href="#使用Bootstrap模板" class="headerlink" title="使用Bootstrap模板"></a>使用Bootstrap模板</h2><p>在<code>index.html</code>中使用:</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs HTML">&#123;% extends &#x27;bootstrap/base.html&#x27; %&#125;<br><br>&#123;% block title %&#125;主页&#123;% endblock %&#125;<br><br>&#123;% block navbar %&#125;<br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar navbar-inverse&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;navigation&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar-header&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar-toggle&quot;</span> <span class="hljs-attr">data-toggle</span>=<span class="hljs-string">&quot;collapse&quot;</span> <span class="hljs-attr">data-target</span>=<span class="hljs-string">&quot;.navbar-collapse&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sr-only&quot;</span>&gt;</span>Toggle navigation<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon-bar&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon-bar&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon-bar&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar-brand&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>主页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar-collapse collapse&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav navbar-nav&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><br>&#123;% endblock %&#125;<br></code></pre></div></td></tr></table></figure><p>Jinja2中的extends指令从Flask-Bootstrap中导入bootstrap/base.html，从而实现模板继承。Flask-Bootstrap的基模板提供了一个网页骨架，引入了Bootstrap的所有CSS和JavaScript文件。</p><p>上面这个index.html模板定义了3个区块，分别名为<code>title</code>、<code>navbar</code>和<code>content</code>。这些区块都是基模板提供的，可在衍生模板中重新定义。<code>title</code>区块的作用很明显，其中的内容会出现在渲染后的HTML文档头部，放在<code>&lt;title&gt;</code>标签中。<code>navbar</code>和<code>content</code>这两个区块分别表示页面中的导航栏和主体内容。在这个模板中，navbar区块使用Bootstrap组件定义了一个简单的导航栏。content区块中有个<code>&lt;div&gt;</code>容器，其中包含一个页头。之前版本中的欢迎消息，现在就放在这个页头里。</p><p><img src="image-20210730110812043.png"></p><h2 id="Bootstrap基模板中定义的模块"><a href="#Bootstrap基模板中定义的模块" class="headerlink" title="Bootstrap基模板中定义的模块"></a>Bootstrap基模板中定义的模块</h2><table><thead><tr><th align="left">区块名</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">doc</td><td align="left">整个HTML文档</td></tr><tr><td align="left">html_attribs</td><td align="left"><html>标签的属性</td></tr><tr><td align="left">html</td><td align="left"><html>标签中的内容</td></tr><tr><td align="left">head</td><td align="left"><head>标签中的内容</td></tr><tr><td align="left">title</td><td align="left">&lt;title&gt;标签中的内容</td></tr><tr><td align="left">metas</td><td align="left">一组<meta>标签</td></tr><tr><td align="left">styles</td><td align="left">CSS声明</td></tr><tr><td align="left">body_attribs</td><td align="left"><body>标签的属性</td></tr><tr><td align="left">body</td><td align="left"><body>标签中的内容</td></tr><tr><td align="left">navbar</td><td align="left">用户定义的导航栏</td></tr><tr><td align="left">content</td><td align="left">用户定义的页面内容</td></tr><tr><td align="left">scripts</td><td align="left">文档底部的JavaScript声明</td></tr></tbody></table><p>上面的很多区块都是Flask-Bootstrap自用的，如果直接覆盖可能会导致一些问题。例如，Bootstrap的CSS和JavaScript文件在styles和scripts区块中声明。如果应用需要向已经有内容的块中添加新内容，必须使用Jinja2提供的<code>super()</code>函数。例如，如果要在衍生模板中添加新的<code>JavaScript</code>文件，需要这么定义scripts区块：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs HTML">&#123;% block scripts %&#125;&#125;<br>    &#123;&#123; super() &#125;&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;my.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>&#123;% endblock %&#125;&#125;<br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style> ]]></content>
    
    
    <categories>
      
      <category>Flask</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>flask</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Scrapy中的Request和Response对象</title>
    <link href="/2021/07/27/Scrapy%E4%B8%AD%E7%9A%84Request%E5%92%8CResponse%E5%AF%B9%E8%B1%A1/"/>
    <url>/2021/07/27/Scrapy%E4%B8%AD%E7%9A%84Request%E5%92%8CResponse%E5%AF%B9%E8%B1%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="Request对象"><a href="#Request对象" class="headerlink" title="Request对象"></a><code>Request</code>对象</h1><p><code>Request</code>对象用来描述一个<code>HTTP</code>请求，下面是其构造器方法的参数列表：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Resquest(url, callback=<span class="hljs-literal">None</span>, method=<span class="hljs-string">&#x27;GET&#x27;</span>, headers=<span class="hljs-literal">None</span>, body=<span class="hljs-literal">None</span>,<br>                 cookies=<span class="hljs-literal">None</span>, meta=<span class="hljs-literal">None</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>, priority=<span class="hljs-number">0</span>,<br>                 dont_filter=<span class="hljs-literal">False</span>, errback=<span class="hljs-literal">None</span>, flags=<span class="hljs-literal">None</span>, cb_kwargs=<span class="hljs-literal">None</span>)<br></code></pre></div></td></tr></table></figure><ul><li><code>url</code>：必选参数，请求的地址。</li><li><code>callback</code>：页面解析函数，<code>Callable</code>类型，Request对象请求的页面下载完成后，由该参数指定的页面解析函数被调用。如果未传递该参数，默认调用<code>Spider</code>的<code>parse</code>方法。</li><li><code>method</code>：HTTP请求的方法，默认为<code>’GET&#39;</code>。</li><li><code>headers</code>：HTTP请求的头部字典，<code>dict</code>类型，例如<code>&#123;&#39;Accept&#39;: &#39;text/html&#39;, &#39;User-Agent&#39;:Mozilla/5.0&#39;&#125;</code>。如果其中某项的值为<code>None</code>，就表示不发送该项HTTP头部，例如<code>&#123;&#39;Cookie&#39;: None&#125;</code>，禁止发送<code>Cookie</code>。</li><li><code>body</code>：HTTP请求的正文，<code>bytes</code>或<code>str</code>类型。</li><li><code>cookies</code>：Cookie信息字典，<code>dict</code>类型，例如<code>&#123;&#39;currency&#39;: &#39;USD&#39;, &#39;country&#39;: &#39;UY&#39;&#125;</code></li><li><code>meta</code>：Request的元数据字典，<code>dict</code>类型，用于给框架中其他组件传递信息，比如中间件<code>ItemPipeline</code>。其他组件可以使用Request对象的<code>meta</code>属性访问该元数据字典<code>（request.meta）</code>，也用于给响应处理函数传递信息，详见Response的meta属性。</li><li><code>encoding</code>：<code>url</code>和<code>body</code>参数的编码默认为<code>’utf-8&#39;</code>。如果传入的<code>url</code>或<code>body</code>参数是<code>str</code>类型，就使用该参数进行编码。</li><li> <code>priority</code>：请求的优先级默认值为0，优先级高的请求优先下载。</li><li> <code>dont_filter</code>：默认情况下（<code>dont_filter=False</code>），对同一个<code>url</code>地址多次提交下载请求，后面的请求会被去重过滤器过滤（避免重复下载）。如果将该参数置为<code>True</code>，可以使请求避免被过滤，强制下载。例如，在多次爬取一个内容随时间而变化的页面时（每次使用相同的<code>url</code>），可以将该参数置为<code>True</code>。</li><li><code>errback</code>：请求出现异常或者出现HTTP错误时（如404页面不存在）的回调函数。</li></ul><h1 id="Response对象"><a href="#Response对象" class="headerlink" title="Response对象"></a>Response对象</h1><p>Response对象用来描述一个HTTP响应，Response只是一个基类，根据响应内容的不同有如下子类：</p><ul><li><code>TextResponse</code></li><li> <code>HtmlResponse</code></li><li> <code>XmlResponse</code></li></ul><p>当一个页面下载完成时，下载器依据HTTP响应头部中的<code>Content-Type</code>信息创建某个Response的子类对象。我们通常爬取的网页，其内容是HTML文本，创建的便是<code>HtmlResponse</code>对象，其中<code>HtmlResponse</code>和<code>XmlResponse</code>是<code>TextResponse</code>的子类。实际上，这3个子类只有细微的差别，这里以<code>HtmlResponse</code>为例进行讲解。</p><p>下面介绍<code>HtmlResponse</code>对象的属性及方法。</p><ul><li><p><code>url</code>：HTTP响应的<code>url</code>地址，<code>str</code>类型。</p></li><li><p><code>status</code>：HTTP响应的状态码，<code>int</code>类型，例如200, 404。</p></li><li><p><code>headers</code>：HTTP响应的头部，类字典类型，可以调用<code>get</code>或<code>getlist</code>方法对其进行访问。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">response.headers.get(<span class="hljs-string">&#x27;Content-Type&#x27;</span>)<br>response.headers.getlist(<span class="hljs-string">&#x27;Set-Cookie&#x27;</span>)<br></code></pre></div></td></tr></table></figure></li><li><p><code>body</code>：HTTP响应正文，<code>bytes</code>类型。</p></li><li><p> <code>text</code>：文本形式的HTTP响应正文，<code>str</code>类型，它是由<code>response.body</code>使用<code>response.encoding</code>解码得到的，即<code>response.text=response.body.decode(response.encoding)</code>。</p></li><li><p><code>encoding</code>：HTTP响应正文的编码，它的值可能是从HTTP响应头部或正文中解析出来的。</p></li><li><p><code>request</code>：产生该HTTP响应的<code>Request</code>对象。</p></li><li><p><code>meta</code>：即<code>response.request.meta</code>，在构造<code>Request</code>对象时，可将要传递给响应处理函数的信息通过<code>meta</code>参数传入；响应处理函数处理响应时，通过<code>response.meta</code>将信息取出。</p></li><li><p><code>selector</code>：Selector对象用于在<code>Response</code>中提取数据（选择器相关话题在后面章节详细讲解）。</p></li><li><p><code>xpath(query)</code>：使用<code>XPath</code>选择器在<code>Response</code>中提取数据，实际上它是<code>response.selector.xpath</code>方法的快捷方式。</p></li><li><p><code>css(query)</code>：使用<code>CSS选择器</code>在<code>Response</code>中提取数据，实际上它是<code>response.selector.css</code>方法的快捷方式（选择器相关话题在后面章节详细讲解）。</p></li><li><p><code>urljoin（url）</code>：用于构造绝对<code>url</code>。当传入的<code>url</code>参数是一个相对地址时，根据<code>response.url</code>计算出相应的绝对<code>url</code>。例如，<code>response.url</code>为<code>http://www.example.com/a</code>, <code>url</code>为<code>b/index.html</code>，调用<code>response.urljoin(url)</code>的结果为<code>http://www.example.com/a/b/index.html</code>。</p></li></ul><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fluid</tag>
      
      <tag>scrpay</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cookiecutter火速搭建项目</title>
    <link href="/2021/07/22/Cookiecutter%E7%81%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE/"/>
    <url>/2021/07/22/Cookiecutter%E7%81%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<h1 id="Cookiecutter安装和使用"><a href="#Cookiecutter安装和使用" class="headerlink" title="Cookiecutter安装和使用"></a><code>Cookiecutter</code>安装和使用</h1><p><code>Cookiecutter</code> 是一个通过项目模板创建项目的命令行工具。比如，通过<code>Python Package</code>模板来创建<code>Python package</code>项目。（通过<code>Python</code>代码调用<code>Cookiecutter</code>的<code>API</code>可以扩展为自动化创建服务和带有<code>Web UI</code>的服务程序）</p><p>安装：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">pip3 install cookiecutter<br></code></pre></div></td></tr></table></figure><p>使用：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">cookiecutter https://github.com/pydanny/cookiecutter-django.git<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">$ cookiecutter https://github.com/pydanny/cookiecutter-django.git<br>project_name [My Awesome Project]: zhanhu<br>project_slug [zhanhu]:<br>description [Behold My Awesome Project!]: a Q&amp;A website<br>author_name [Daniel Roy Greenfeld]: __holy__<br>domain_name [example.com]: holychan.io<br>email [__holy__@example.com]: espholychan@outlook.com<br>version [<span class="hljs-number">0.1</span><span class="hljs-number">.0</span>]:<br>Select open_source_license:<br><span class="hljs-number">1</span> - MIT<br><span class="hljs-number">2</span> - BSD<br><span class="hljs-number">3</span> - GPLv3<br><span class="hljs-number">4</span> - Apache Software License <span class="hljs-number">2.0</span><br><span class="hljs-number">5</span> - Not <span class="hljs-built_in">open</span> source<br>Choose <span class="hljs-keyword">from</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span> [<span class="hljs-number">1</span>]:<br>timezone [UTC]: Asia/Shanghai<br>windows [n]: y<br>use_pycharm [n]: y<br>use_docker [n]: n<br>Select postgresql_version:<br><span class="hljs-number">1</span> - <span class="hljs-number">13.2</span><br><span class="hljs-number">2</span> - <span class="hljs-number">12.6</span><br><span class="hljs-number">3</span> - <span class="hljs-number">11.11</span><br><span class="hljs-number">4</span> - <span class="hljs-number">10.16</span><br>Choose <span class="hljs-keyword">from</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span> [<span class="hljs-number">1</span>]:<br>Select js_task_runner:<br><span class="hljs-number">1</span> - <span class="hljs-literal">None</span><br><span class="hljs-number">2</span> - Gulp<br>Choose <span class="hljs-keyword">from</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span> [<span class="hljs-number">1</span>]:<br>Select cloud_provider:<br><span class="hljs-number">1</span> - AWS<br><span class="hljs-number">2</span> - GCP<br><span class="hljs-number">3</span> - <span class="hljs-literal">None</span><br>Choose <span class="hljs-keyword">from</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> [<span class="hljs-number">1</span>]:<br>Select mail_service:<br><span class="hljs-number">1</span> - Mailgun<br><span class="hljs-number">2</span> - Amazon SES<br><span class="hljs-number">3</span> - Mailjet<br><span class="hljs-number">4</span> - Mandrill<br><span class="hljs-number">5</span> - Postmark<br><span class="hljs-number">6</span> - Sendgrid<br><span class="hljs-number">7</span> - SendinBlue<br><span class="hljs-number">8</span> - SparkPost<br><span class="hljs-number">9</span> - Other SMTP<br>Choose <span class="hljs-keyword">from</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span> [<span class="hljs-number">1</span>]:<br>use_async [n]:<br>use_drf [n]:<br>custom_bootstrap_compilation [n]:<br>use_compressor [n]: y<br>use_celery [n]: y<br>use_mailhog [n]:<br>use_sentry [n]:<br>use_whitenoise [n]:<br>use_heroku [n]:<br>Select ci_tool:<br><span class="hljs-number">1</span> - <span class="hljs-literal">None</span><br><span class="hljs-number">2</span> - Travis<br><span class="hljs-number">3</span> - Gitlab<br><span class="hljs-number">4</span> - Github<br>Choose <span class="hljs-keyword">from</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span> [<span class="hljs-number">1</span>]:<br>keep_local_envs_in_vcs [y]: n<br>debug [n]: y<br> [SUCCESS]: Project initialized, keep up the good work!<br></code></pre></div></td></tr></table></figure><p>这样就生成好了项目模板。</p><h2 id="搭建项目"><a href="#搭建项目" class="headerlink" title="搭建项目"></a>搭建项目</h2><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">mysql&gt;</span><span class="bash"> create database zanhu charset utf8;</span><br><span class="hljs-meta">mysql&gt;</span><span class="bash"> create database zanhu_test charset utf8;</span><br></code></pre></div></td></tr></table></figure><h3 id="创建测试用户"><a href="#创建测试用户" class="headerlink" title="创建测试用户"></a>创建测试用户</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">mysql&gt; create user <span class="hljs-string">&#x27;zanhutest&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> identified by <span class="hljs-string">&#x27;test_mysql&#x27;</span><br>mysql&gt; grant <span class="hljs-built_in">all</span> on zanhu_test.* to <span class="hljs-string">&#x27;zanhutest&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br>mysql&gt; flush privileges;<br></code></pre></div></td></tr></table></figure><h2 id="配置远程开发环境"><a href="#配置远程开发环境" class="headerlink" title="配置远程开发环境"></a>配置远程开发环境</h2><p>准备一个云主机，或者搭建<code>linux</code>环境的虚拟机。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">yum install python-devel mysql-devel mysql-lib<br>yum install bzip2-devel<br></code></pre></div></td></tr></table></figure><p><code>pycharm</code>配置远程开发环境</p><p><code>tools</code>下面的<code>Depolyment</code>点击<code>configuration</code>。</p><p><img src="image-20210723163026345.png"></p><p><img src="image-20210723163806895.png"></p><p><img src="image-20210723164011342.png"></p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>cookiecutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>需求分析-功能设计-技术选型</title>
    <link href="/2021/07/21/%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-%E5%8A%9F%E8%83%BD%E8%AE%BE%E8%AE%A1-%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B/"/>
    <url>/2021/07/21/%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-%E5%8A%9F%E8%83%BD%E8%AE%BE%E8%AE%A1-%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="赞乎产品需求规格说明书"><a href="#赞乎产品需求规格说明书" class="headerlink" title="赞乎产品需求规格说明书"></a>赞乎产品需求规格说明书</h2><table><thead><tr><th align="center">文档编号</th><th align="center"><code>V 0.1.0</code></th></tr></thead><tbody><tr><td align="center">编写人</td><td align="center"><code>Jack</code></td></tr><tr><td align="center">模块名称</td><td align="center">赞乎所有模块</td></tr><tr><td align="center">部门</td><td align="center">编程部</td></tr><tr><td align="center">保密等级</td><td align="center"><code>L1</code></td></tr><tr><td align="center">日期</td><td align="center">2021年7月21日</td></tr></tbody></table><p><strong>版权说明</strong></p><blockquote><p>本文档属于XX软件有限公司所有的机密材料。在获得XX软件有限公司直接的书面允许之前，本文档中的任何部分均不得用各种方法或形式复制或公布于众。这些方法包括电子或机械的方法，如影印或各种信息存储或重复取用系统。同样，在获得XX软件有限公司直接的书面允许之前，本文章中的任何部分也不得向第三方披露。</p></blockquote><h3 id="第一章-修订页"><a href="#第一章-修订页" class="headerlink" title="第一章 修订页"></a>第一章 修订页</h3><table><thead><tr><th align="left">编号</th><th align="left">章节名称</th><th>修订内容简述</th><th>修订日期</th><th>修订前版本号</th><th>修订后版本号</th><th>修订人</th><th>批准人</th></tr></thead><tbody><tr><td align="left">001</td><td align="left"></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td align="left"></td><td align="left"></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><h3 id="第二章-项目概述"><a href="#第二章-项目概述" class="headerlink" title="第二章 项目概述"></a>第二章 项目概述</h3><h4 id="2-1-产品描述"><a href="#2-1-产品描述" class="headerlink" title="2.1 产品描述"></a>2.1 产品描述</h4><p>​    赞乎是一个类似于知乎的知识问答社区，连接各行各业的用户。用户分享着彼此的知识、经验和见解，为中文互联网源源不断地提供多种多样的信息。</p><h4 id="2-2-产品功能"><a href="#2-2-产品功能" class="headerlink" title="2.2 产品功能"></a>2.2 产品功能</h4><p>​    本产品为PC端，具有当今主流知识问答应用的功能，包括<strong>个人中心、动态、文章、问答、私信、消息通知、网站搜索</strong>，对外开放邮箱注册。</p><h3 id="第三章-业务需求"><a href="#第三章-业务需求" class="headerlink" title="第三章 业务需求"></a>第三章 业务需求</h3><h4 id="3-1-总体需求"><a href="#3-1-总体需求" class="headerlink" title="3.1 总体需求"></a>3.1 总体需求</h4><ul><li>本产品不包含后台管理系统</li><li>网站所有内容需要用户登陆后才能访问</li></ul><h4 id="3-2-用户个人中心"><a href="#3-2-用户个人中心" class="headerlink" title="3.2 用户个人中心"></a>3.2 用户个人中心</h4><h5 id="3-2-1-登录-注册-退出等"><a href="#3-2-1-登录-注册-退出等" class="headerlink" title="3.2.1 登录/注册/退出等"></a>3.2.1 登录/注册/退出等</h5><p>​    可以邮箱注册，使用第三方应用微信或<code>Github</code>注册登录，用户名登录，支持邮箱找回和重置密码。</p><h5 id="3-2-2-个人信息"><a href="#3-2-2-个人信息" class="headerlink" title="3.2.2 个人信息"></a>3.2.2 个人信息</h5><p>​    包括昵称、邮箱、头像、简介、职称、城市、个人链接、微博链接、知乎链接、<code>Github</code>链接、<code>LinkedIn</code>链接，用户可以更新。</p><h5 id="3-2-3-用户信息统计"><a href="#3-2-3-用户信息统计" class="headerlink" title="3.2.3 用户信息统计"></a>3.2.3 用户信息统计</h5><p>​    显示用户自网站注册日起，发表动态的数量，已发表文章的数量，参与评论的数量，提问的数量，回答问题的数量，用户的互动总数。</p><h4 id="3-3-首页动态功能"><a href="#3-3-首页动态功能" class="headerlink" title="3.3 首页动态功能"></a>3.3 首页动态功能</h4><h5 id="3-3-1-动态列表页"><a href="#3-3-1-动态列表页" class="headerlink" title="3.3.1 动态列表页"></a>3.3.1 动态列表页</h5><ul><li>最上方有“发表动态”按钮，每页显示20条动态</li><li>动态下有点赞和评论按钮</li><li>每条动态除内容外要显示用户头像、昵称、发表时间、赞和评论数量，用户互动后能自动更新数量</li><li>对于登录用户发表的动态，右上角显示删除按钮</li></ul><h5 id="3-3-2-发表动态"><a href="#3-3-2-发表动态" class="headerlink" title="3.3.2 发表动态"></a>3.3.2 发表动态</h5><p>​    发表动态字数不限，畅所欲言。</p><h5 id="3-3-3-删除动态"><a href="#3-3-3-删除动态" class="headerlink" title="3.3.3 删除动态"></a>3.3.3 删除动态</h5><p>​    用户可以删除自己发表的动态。</p><h5 id="3-3-4-用户点赞"><a href="#3-3-4-用户点赞" class="headerlink" title="3.3.4 用户点赞"></a>3.3.4 用户点赞</h5><p>​    可以给自己和其他人点赞，也可以取消赞。</p><h5 id="3-3-5-用户评论"><a href="#3-3-5-用户评论" class="headerlink" title="3.3.5 用户评论"></a>3.3.5 用户评论</h5><p>​    评论不能删除，除非状态被发表人删除。</p><h4 id="3-4-文章模块"><a href="#3-4-文章模块" class="headerlink" title="3.4 文章模块"></a>3.4 文章模块</h4><p>如下4个功能点中，第1、2、3各使用一页，页面上方有面包屑可以跳转；</p><h5 id="3-4-1-浏览文章页"><a href="#3-4-1-浏览文章页" class="headerlink" title="3.4.1 浏览文章页"></a>3.4.1 浏览文章页</h5><ul><li>每页显示10篇文章</li><li>每篇文章显示标题、图片、内容的前100个字、发表人、发表时间、文章标签已经阅读全文的按钮</li><li>文章页要显示“写文章”和“草稿箱”按钮，云标签</li></ul><h5 id="3-4-2-文章详情页"><a href="#3-4-2-文章详情页" class="headerlink" title="3.4.2 文章详情页"></a>3.4.2 文章详情页</h5><ul><li>每篇文章显示标题、图片、内容、发表人、发表时间</li><li>文章页要显示“写文章”和“编辑”按钮，云标签</li><li>文章下方有评论区</li></ul><h5 id="3-4-3-写文章"><a href="#3-4-3-写文章" class="headerlink" title="3.4.3 写文章"></a>3.4.3 写文章</h5><ul><li><p>用户<strong>必填</strong>字段为标题、内容、文章图片、标签，标签支持多个使用英文逗号隔开</p></li><li><p>编辑文章内容时可Markdown实时预览</p></li><li><p>用户可将文章发表或保存为草稿，或者取消</p></li></ul><h5 id="3-4-4-保存草稿"><a href="#3-4-4-保存草稿" class="headerlink" title="3.4.4 保存草稿"></a>3.4.4 保存草稿</h5><p>​    草稿箱与浏览文章页功能一样，不用之处在于用户只能看到自己保存的草稿。</p><h5 id="3-4-5-评论文章"><a href="#3-4-5-评论文章" class="headerlink" title="3.4.5 评论文章"></a>3.4.5 评论文章</h5><p>​    用户评论时必填昵称、邮箱地址、内容，选填<code>URL</code></p><h4 id="3-5-问答模块"><a href="#3-5-问答模块" class="headerlink" title="3.5 问答模块"></a>3.5 问答模块</h4><h5 id="3-5-1-问答页"><a href="#3-5-1-问答页" class="headerlink" title="3.5.1 问答页"></a>3.5.1 问答页</h5><p>​    页面上方有面包屑，下面是话题分类和提问按钮，下面是3个Tab栏目：待回答问题页、已回答问题页、所有问题页，每页显示20个问题；</p><p>​    每个问题需要显示：回答的数量、问题的投票数量、标题、内容的前100个字符、提问者、提问时间、问题标签</p><h5 id="3-5-2-问题详情页"><a href="#3-5-2-问题详情页" class="headerlink" title="3.5.2 问题详情页"></a>3.5.2 问题详情页</h5><p>​    页面上方有面包屑，显示问题的所有回答</p><p>​    问题需要显示：回答的数量、问题的投票数量、标题、内容的前100个字符、提问者、提问时间、问题标签；用户可以给问题投票，有提问按钮和回答按钮</p><p>​    回答需要显示：回答的投票数、回答用户的头像和昵称、答案内容、回答时间、如果回答被接受显示对勾；用户可以给回答投票</p><h5 id="3-5-3-用户提问"><a href="#3-5-3-用户提问" class="headerlink" title="3.5.3 用户提问"></a>3.5.3 用户提问</h5><ul><li>用户<strong>必填</strong>字段为标题、内容、标签，标签支持多个使用英文逗号隔开</li><li>编辑文章内容时可Markdown实时预览</li><li>用户可将问题发表或保存为草稿，或者取消</li><li>问题不能修改或删除</li></ul><h5 id="3-5-4-回答问题"><a href="#3-5-4-回答问题" class="headerlink" title="3.5.4 回答问题"></a>3.5.4 回答问题</h5><p>​    页面上方有面包屑，填写回答内容时可Markdown实时预览；回答不能修改或删除</p><h5 id="3-5-5-给问题或回答投票"><a href="#3-5-5-给问题或回答投票" class="headerlink" title="3.5.5 给问题或回答投票"></a>3.5.5 给问题或回答投票</h5><p>​    显示票数=赞同数 - 反对数，用户可以赞同或反对，随时取消赞同或反对</p><h5 id="3-5-6-提问者接受回答"><a href="#3-5-6-提问者接受回答" class="headerlink" title="3.5.6 提问者接受回答"></a>3.5.6 提问者接受回答</h5><p>​    只能接受一个回答，接受后不能取消</p><h4 id="3-6-私信功能"><a href="#3-6-私信功能" class="headerlink" title="3.6 私信功能"></a>3.6 私信功能</h4><ul><li>每页显示可私信的20个用户</li><li>对话框默认选中最近一次私信互动的用户</li><li>可与其他用户在线聊天</li><li>聊天内容显示头像、昵称、时间、内容，点击昵称可跳转至用户个人中心</li></ul><h4 id="3-7-消息通知"><a href="#3-7-消息通知" class="headerlink" title="3.7 消息通知"></a>3.7 消息通知</h4><p>​    当其它用户与我有如下互动时能接收到通知：</p><ol><li>赞了我的状态</li><li>评论了我的动态或文章</li><li>收藏了我的文章</li><li>回答了我的提问</li><li>接受了我的回答</li><li>回复了我的评论</li></ol><h5 id="3-7-1-通知下拉框"><a href="#3-7-1-通知下拉框" class="headerlink" title="3.7.1 通知下拉框"></a>3.7.1 通知下拉框</h5><p>​    显示最近收到的5条消息通知，包括昵称、互动类型、互动对象、互动时间；有”查看所有通知“和”全部标为已读“按钮</p><h5 id="3-7-2-未读通知列表"><a href="#3-7-2-未读通知列表" class="headerlink" title="3.7.2 未读通知列表"></a>3.7.2 未读通知列表</h5><p>​    显示所有的消息通知，有全部标为已读按钮；</p><p>​    每条消息通知包括用户头像、昵称、互动类型、互动对象、互动时间，有”标为已读“按钮；</p><h4 id="3-8-全站搜索"><a href="#3-8-全站搜索" class="headerlink" title="3.8 全站搜索"></a>3.8 全站搜索</h4><p>​    可以搜索文章、动态、问题、用户、标签；</p><p>​    文章搜索结果：显示文章图片、标题（可跳转）、内容的前100个字</p><p>​    动态搜索结果：与首页的显示的动态信息一致</p><p>​    问题搜索结果：与问答页显示的问题信息一致</p><p>​    用户搜索结果：显示用户头像（可跳转）、昵称（可发邮件）、职位、城市</p><p>​    标签搜索结果：显示被搜索到的标签</p><h3 id="第四章-附录"><a href="#第四章-附录" class="headerlink" title="第四章 附录"></a>第四章 附录</h3><h1 id="程序开发流程"><a href="#程序开发流程" class="headerlink" title="程序开发流程"></a>程序开发流程</h1><pre><code class=" mermaid">graph LRB[&quot;动态&quot;]C[&quot;文章&quot;]A[&quot;个人中心&quot;]D[&quot;问答&quot;]E[&quot;私信&quot;]F[&quot;消息通知&quot;]G[&quot;全站搜索&quot;]A--01--&gt;BB--02--&gt;CC--03--&gt;DD--04--&gt;EE--05--&gt;AA--06--&gt;FF--07--&gt;BB--08--&gt;CC--09--&gt;DD--10--&gt;EE--11--&gt;G</code></pre><h1 id="确定技术栈"><a href="#确定技术栈" class="headerlink" title="确定技术栈"></a>确定技术栈</h1><pre><code class=" mermaid">graph LRA[技术栈]---&gt;B[&quot;1 前端&quot;]A[技术栈]---&gt;C[&quot;2 后端&quot;]A[技术栈]---&gt;D[&quot;3 部署和运维&quot;]A[技术栈]---&gt;E[&quot;4 数据库&quot;]A[技术栈]---&gt;F[&quot;5 网站优化&quot;]B---&gt;HTML/CSSB---&gt;jQueryB---&gt;BootstrapB---&gt;DIL,jinjaB---&gt;WebsocketC---&gt;G[python 3.7 + django 2.1]C---&gt;CookiecuterC---&gt;H[Haystack+Elatisearch]C---&gt;常用python开发包E---&gt;MySQLE---&gt;RedisF---&gt;Celery</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>django</tag>
      
      <tag>需求分析</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django的一些最佳实践</title>
    <link href="/2021/07/21/Django%E7%9A%84%E4%B8%80%E4%BA%9B%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"/>
    <url>/2021/07/21/Django%E7%9A%84%E4%B8%80%E4%BA%9B%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</url>
    
    <content type="html"><![CDATA[<h1 id="Pipenv项目管理"><a href="#Pipenv项目管理" class="headerlink" title="Pipenv项目管理"></a><code>Pipenv</code>项目管理</h1><p>首先，安装<code>pipenv</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip3 install pipenv<br></code></pre></div></td></tr></table></figure><p>创建文件夹<code>mkdir myproject</code>。</p><p>进入文件下<code>cd myproject</code>，创建虚拟环境<code>pipenv --python 3.7</code>，虚拟环境的<code>python</code>版本必须在系统中安装。</p><p>需要在虚拟环境中安装包的话只需要在项目目录中使用<code>pipenv install 包名</code>即可。</p><p>比如这里安装<code>pipenv install dajngo</code>==2.2，这个过程有点慢，因为这里没有更改<code>pipenv</code>源。</p><p>在创建虚拟环境后，会在当前文件夹下生成一个名为<code>Pipfile</code>的文件。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">[[source]]<br>url = &quot;https://pypi.org/simple&quot;<br>verify_ssl = true<br>name = &quot;pypi&quot;<br><br>[packages]<br><br>[dev-packages]<br><br>[requires]<br>python_version = &quot;3.9&quot;<br></code></pre></div></td></tr></table></figure><p>在这里我们可以修改<code>[source]</code>中的<code>url</code>为其他源。<code>[dev-packages]</code>指开发环境中需要用到的包，<code>[packages]</code>指生产环境中需要用到的包。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">url = <span class="hljs-string">&quot;https://mirrors.aliyun.com/pypi/simple&quot;</span><br></code></pre></div></td></tr></table></figure><p>安装包后文件下面会生成<code>Pipfile.lock</code>文件，显示包安装的哈希值。</p><p>使用<code>pipenv graph</code>会显示包与包之间的依赖关系。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> pipenv graph</span><br>Django==2.2<br>  - pytz [required: Any, installed: 2021.1]<br>  - sqlparse [required: Any, installed: 0.4.1]<br></code></pre></div></td></tr></table></figure><p>每次使用<code>pipenv</code>安装包的时候会更新<code>Pipfile</code>和<code>Pipfile.lock</code>这两个文件。</p><p>可以使用<code>pipenv install requests --skip-lock</code>跳过<code>lock</code>文件的更新，在安装完所有的包后一次更新。</p><p>使用<code>pipenv</code>不需要每次都激活虚拟环境。</p><p>如果你需要激活虚拟环境使用<code>pipenv shell</code>即可，退出使用<code>exit</code>命令。</p><p>如果你想安装开发环境使用的包，比如测试用的包。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pipenv install --dev pytest --skip-lock<br></code></pre></div></td></tr></table></figure><p>这个包就会安装到生产环境。</p><p><code>pipenv --where</code>定位项目路径。</p><p><code>pipenv --venv</code>定位虚拟环境保持的路径。</p><p><code>pipenv --py</code>虚拟解释器的路径。</p><p><code>pipenv --update</code>更新所有的包。</p><p><code>pipenv --rm</code>删除虚拟环境。</p><p><code>pipenv --check</code>检查包的安全漏洞。</p><h1 id="自定义用户模型"><a href="#自定义用户模型" class="headerlink" title="自定义用户模型"></a>自定义用户模型</h1><p>继承<code>BaseUserManager</code>和<code>AbstractBaseUser</code>，指定<code>AUTH_USER_MODEL</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>(<span class="hljs-params">AbstractUser</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;自定义用户模型&quot;&quot;&quot;</span><br>    nickname = models.CharField(null=<span class="hljs-literal">True</span>, blank=<span class="hljs-literal">True</span>,max_length=<span class="hljs-number">255</span>, verbose_name=<span class="hljs-string">&quot;昵称&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>如果要求显示用户的昵称：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>    verbose_name = <span class="hljs-string">&#x27;用户&#x27;</span><br>    verbose_name_plural = verbose_name<br>username_filed = <span class="hljs-string">&#x27;nickname&#x27;</span><br>    require_fields = [<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br></code></pre></div></td></tr></table></figure><p>定义用户的权限：</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pytho">def has_perm(self, perm, obj=None):<br>&quot;&quot;&quot;定义用户具体的权限&quot;&quot;&quot;<br>pass<br></code></pre></div></td></tr></table></figure><p>自定义用户管理：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyUserManager</span>(<span class="hljs-params">BaseUserManager</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">creat_user</span>(<span class="hljs-params">self, username, password=<span class="hljs-literal">None</span></span>):</span><br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">return</span><br>   <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">creat_superuser</span>(<span class="hljs-params">self, username, password</span>):</span><br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">return</span> user<br></code></pre></div></td></tr></table></figure><p><code>objects = MyUserManager()</code>放到<code>User</code>类的上面。</p><h1 id="优先使用通用类视图（Class-based-Generic-Views）"><a href="#优先使用通用类视图（Class-based-Generic-Views）" class="headerlink" title="优先使用通用类视图（Class-based Generic Views）"></a>优先使用通用类视图（<code>Class-based Generic Views</code>）</h1><h2 id="函数视图（FBV）"><a href="#函数视图（FBV）" class="headerlink" title="函数视图（FBV）"></a>函数视图（<code>FBV</code>）</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 函数视图</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">my_view</span>(<span class="hljs-params">request</span>):</span><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;GET&#x27;</span>:<br>        <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;result&#x27;</span>)<br>    <span class="hljs-keyword">elif</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;result&#x27;</span>)<br>    <span class="hljs-keyword">elif</span> request.method == <span class="hljs-string">&#x27;DELETE&#x27;</span>:<br>        <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;result&#x27;</span>)<br></code></pre></div></td></tr></table></figure><h2 id="类视图（CBV）"><a href="#类视图（CBV）" class="headerlink" title="类视图（CBV）"></a>类视图（<code>CBV</code>）</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 类视图</span><br><span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> View<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyView</span>(<span class="hljs-params">View</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, request, *args, **kwargs</span>):</span><br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post</span>(<span class="hljs-params">self, request, *args, **kwargs</span>):</span><br>        <span class="hljs-keyword">pass</span><br></code></pre></div></td></tr></table></figure><p>所有基于类的视图都有<code>as_view</code>方法，用来作为类调用的入口。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">urlpatterns = [<br>    path(<span class="hljs-string">&#x27;myview&#x27;</span>, MyView.as_view(a=<span class="hljs-number">1</span>), name=<span class="hljs-string">&#x27;detail&#x27;</span>)<br>]<br></code></pre></div></td></tr></table></figure><h2 id="通用类视图（CBGV）"><a href="#通用类视图（CBGV）" class="headerlink" title="通用类视图（CBGV）"></a>通用类视图（<code>CBGV</code>）</h2><h1 id="在系统环境变量中保存敏感信息"><a href="#在系统环境变量中保存敏感信息" class="headerlink" title="在系统环境变量中保存敏感信息"></a>在系统环境变量中保存敏感信息</h1><p>项目中的敏感信息和项目分离。</p><p>进入项目目录，安装一个包</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">pipenv install django-environ --skip-lock<br></code></pre></div></td></tr></table></figure><p>在项目文件夹<code>.env</code>文件，定义了项目的绝大部分的项目配置。</p><h1 id="为不同环境分别配置settings-py文件"><a href="#为不同环境分别配置settings-py文件" class="headerlink" title="为不同环境分别配置settings.py文件"></a>为不同环境分别配置<code>settings.py</code>文件</h1><p>开发，测试，生产环境的配置文件分离。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>全面掌握Django ORM</title>
    <link href="/2021/07/17/%E5%85%A8%E9%9D%A2%E6%8E%8C%E6%8F%A1Django-ORM/"/>
    <url>/2021/07/17/%E5%85%A8%E9%9D%A2%E6%8E%8C%E6%8F%A1Django-ORM/</url>
    
    <content type="html"><![CDATA[<h1 id="ORM介绍"><a href="#ORM介绍" class="headerlink" title="ORM介绍"></a><code>ORM</code>介绍</h1><p><img src="5e64d5dc0001020119201080.jpg"></p><h1 id="字段类型和参数"><a href="#字段类型和参数" class="headerlink" title="字段类型和参数"></a>字段类型和参数</h1><h2 id="常用的字段"><a href="#常用的字段" class="headerlink" title="常用的字段"></a>常用的字段</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 自增长字段</span><br>Auto = models.AutoField()<br>BigAuto = models.BigAutoField()<br><br><span class="hljs-comment"># 二进制数据</span><br>Binary = models.BinaryField()<br><br><span class="hljs-comment"># 布尔型</span><br>Boolean = models.BooleanField()<br>NullBoolean = models.NullBooleanField()<br><br><span class="hljs-comment"># 整型</span><br>PositiveSmallInteger = models.PositiveSmallIntegerField(db_column=<span class="hljs-string">&quot;age&quot;</span>)  <span class="hljs-comment"># 5个字节</span><br>SmallInteger = models.SmallIntegerField(primary_key=<span class="hljs-literal">False</span>)  <span class="hljs-comment"># 6个字节</span><br>PositiveInteger = models.PositiveIntegerField()  <span class="hljs-comment"># 10个字节</span><br>Integer = models.IntegerField(verbose_name=<span class="hljs-string">&quot;11个字节大小&quot;</span>)  <span class="hljs-comment"># 11个字节</span><br>BigInteger = models.BigIntegerField(unique=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># 20个字节</span><br><br><span class="hljs-comment"># 字符串类型</span><br>Char = models.CharField(max_length=<span class="hljs-number">100</span>, null=<span class="hljs-literal">True</span>, blank=<span class="hljs-literal">True</span>, db_index=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># varchar</span><br>Text = models.TextField(help_text=<span class="hljs-string">&quot;这个是longtext&quot;</span>)  <span class="hljs-comment"># longtext</span><br><br><span class="hljs-comment"># 时间日期类型</span><br>Date = models.DateField(unique_for_date=<span class="hljs-literal">True</span>, auto_now=<span class="hljs-literal">True</span>)<br>DateTime = models.DateTimeField(editable=<span class="hljs-literal">False</span>, unique_for_month=<span class="hljs-literal">True</span>, auto_now_add=<span class="hljs-literal">True</span>)<br>Duration = models.DurationField()  <span class="hljs-comment"># int, Python timedelta实现</span><br><br><span class="hljs-comment"># 浮点型</span><br>Float = models.FloatField()<br>Decimal = models.DecimalField(max_digits=<span class="hljs-number">4</span>, decimal_places=<span class="hljs-number">2</span>)  <span class="hljs-comment"># 11.22, 16.34</span><br><br><span class="hljs-comment"># 其它字段</span><br>Email = models.EmailField()  <span class="hljs-comment"># 邮箱</span><br>Image = models.ImageField()<br>File = models.FileField()<br>FilePath = models.FilePathField()<br>URL = models.URLField()<br>UUID = models.UUIDField()<br>GenericIPAddress = models.GenericIPAddressField()<br></code></pre></div></td></tr></table></figure><h2 id="关系型字段"><a href="#关系型字段" class="headerlink" title="关系型字段"></a>关系型字段</h2><ul><li>一对一（<code>OneToOneField</code>）<ul><li><code>models.OneToOneField(Test)</code></li></ul></li><li>多对一（<code>ForeignKey</code>）<ul><li><code>foreign = models.ForeignKey(Other)</code></li></ul></li><li>多对多（<code>ManyToManyField</code>），默认或自定义中间表<ul><li><code>models.ManyToManyField(B)</code></li></ul></li></ul><h2 id="字段参数"><a href="#字段参数" class="headerlink" title="字段参数"></a>字段参数</h2><ol><li><p>所有字段都有的属性值</p><ul><li><p><code>editable</code>: 是否可以编辑, 默认为<code>False</code></p></li><li><p><code>help_text</code>: 在表单中显示帮助信息的参数</p></li><li><p><code>db_index</code>: 为当前字段建立索引, 默认为<code>False</code></p></li><li><p><code>null/blank</code>: 字段是否可以为空, <code>null</code>约束数据库层面, <code>blank</code>约束前端表单提交时是否为空</p></li><li><p><code>unique</code>: 唯一性约束, 默认为<code>False</code></p></li><li><p><code>verbose_name</code>: 设置字段别名（或备注）</p></li><li><p><code>primary_key</code>: 设置当前字段是否为主键, 默认为<code>False</code></p></li><li><p><code>db_column</code>: 设置当前字段的名称，在数据库中表的名称</p></li></ul></li><li><p>属于个别字段的参数</p><ul><li><code>max_length[CharField]</code>：最大长度</li><li><code>unique_for_date[DateField]</code>: 字段日期必须唯一</li><li><code>unique_for_month[DateField]</code>：月份唯一</li><li><code>auto_now[DateField]</code>: 修改记录时是否自动更新当前日期</li><li><code>auto_now_add[DateField]</code>: 添加记录时是否自动设置当前日志</li><li><code>max_digits[DecimalField]</code>: 总共有多少位</li><li><code>decimal_places[DecimalField]</code>: 小数点后数字的个数</li></ul></li><li><p>关系型字段的参数</p><ul><li><code>related_name</code>: 外键关联中的反向查询，由父表查询子表的信息</li><li><code>on_delete</code>: 当一个被外键关联的对象被删除时，<code>Django</code>将模仿<code>on_delete</code>参数定义的<code>SQL</code>约束执行相应操作<ul><li><code>CASCADE</code>: 模拟<code>SQL</code>语言中的<code>ON DELETE CASCADE</code>约束，将定义有外键的模型对象同时删除（该操作为当前<code>Django</code>版本的默认操作）</li><li><code>PROTECT</code>: 阻止上面的删除操作, 弹出<code>ProtectedError</code>异常</li><li><code>SET_NULL</code>: 将外键字段设为<code>null</code>, 只有当字段设置了<code>null=True</code>时, 方可使用该值</li><li><code>SET_DEFAULT</code>: 将外键字段设为默认值, 只有当字段设置了<code>default</code>参数时，方可使用</li><li><code>DO_NOTHING</code>: 什么也不做</li><li><code>SET()</code>: 设置为一个传递给<code>SET()</code>的值或者一个回调函数的返回值, 注意大小写</li></ul></li></ul></li></ol><h2 id="自关联"><a href="#自关联" class="headerlink" title="自关联"></a>自关联</h2><p>在同一个模型中一个字段关联另一个字段，模型内部的字段自关联。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 自关联的两种写法</span><br>pid = models.ForeignKey(<span class="hljs-string">&#x27;self&#x27;</span>, null=<span class="hljs-literal">True</span>, blank=<span class="hljs-literal">True</span>)<br>pid = models.ForeignKey(<span class="hljs-string">&#x27;$&#123;TableName&#125;&#x27;</span>, null=<span class="hljs-literal">True</span>, blank=<span class="hljs-literal">True</span>)<br></code></pre></div></td></tr></table></figure><h1 id="元数据Meta"><a href="#元数据Meta" class="headerlink" title="元数据Meta"></a>元数据Meta</h1><p><code>Meta</code>数据</p><ul><li><code>db_table</code>: 指定数据表的名称</li><li><code>ordering</code>: 指定按照哪些字段来排序, 类型为一元元组</li><li><code>verbose_name</code>: 为模型类设置一个直观可读的名称</li><li><code>abstract:</code> <code>=True</code>将该类设置为基类, 不生成数据表, 仅供其它类继承</li><li><code>permissions</code>: 为数据表设置额外的权限, 通过二元元组来实现<code>((&#39;定义好的权限&#39;, &#39;权限的说明&#39;), )</code></li><li><code>managed</code>: 表示是否按照<code>django</code>既定的规则来管理数据表, 默认是<code>True</code></li><li><code>unique_together</code>: 指定联合唯一键，可以使用一元元组或二元元组(即多个唯一约束)</li><li><code>app_label</code>: 定义模型类属于哪一个应用</li><li><code>db_tablespace</code>: 定义数据表空间的名字</li></ul><p>官网文档中定义的<code>Meta</code>元数据中一共有25个。</p><h2 id="模型开发示例"><a href="#模型开发示例" class="headerlink" title="模型开发示例"></a>模型开发示例</h2><p><img src="5d7dfd7a00016d1119201080.jpg"></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Teacher</span>(<span class="hljs-params">models.Model</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;讲师信息表&quot;&quot;&quot;</span><br>    nickname = models.CharField(max_length=<span class="hljs-number">30</span>, primary_key=<span class="hljs-literal">True</span>, db_index=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&quot;昵称&quot;</span>)<br>    introduction = models.TextField(default=<span class="hljs-string">&quot;这位同学很懒，什么都没说&quot;</span>, verbose_name=<span class="hljs-string">&quot;简介&quot;</span>)<br>    fans = models.PositiveIntegerField(default=<span class="hljs-string">&#x27;0&#x27;</span>, verbose_name=<span class="hljs-string">&quot;粉丝数&quot;</span>)<br>    created_at = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&quot;创建时间&quot;</span>)<br>    updated_at = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&quot;更新时间&quot;</span>)<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        verbose_name = <span class="hljs-string">&quot;讲师信息表&quot;</span><br>        verbose_name_plural = verbose_name<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Course</span>(<span class="hljs-params">models.Model</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;课程信息表&quot;&quot;&quot;</span><br>    title = models.CharField(max_length=<span class="hljs-number">100</span>, primary_key=<span class="hljs-literal">True</span>, db_index=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&quot;课程名&quot;</span>)<br>    teacher = models.ForeignKey(Teacher, on_delete=models.CASCADE, verbose_name=<span class="hljs-string">&#x27;课程讲师&#x27;</span>)<br>    <span class="hljs-built_in">type</span> = models.CharField(choices=((<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;实战课&#x27;</span>), (<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;免费课&#x27;</span>), (<span class="hljs-number">0</span>, <span class="hljs-string">&#x27;其他&#x27;</span>)), max_length=<span class="hljs-number">1</span>, default=<span class="hljs-number">0</span>, verbose_name=<span class="hljs-string">&#x27;课程类型&#x27;</span>)<br>    price = models.PositiveSmallIntegerField(verbose_name=<span class="hljs-string">&#x27;价格&#x27;</span>)<br>    volume = models.BigIntegerField(verbose_name=<span class="hljs-string">&#x27;销量&#x27;</span>)<br>    online = models.DateField(verbose_name=<span class="hljs-string">&#x27;上线时间&#x27;</span>)<br>    created_at = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;创建时间&#x27;</span>)<br>    updated_at = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;更新时间&#x27;</span>)<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        verbose_name = <span class="hljs-string">&#x27;课程信息表&#x27;</span><br>        verbose_name_plural = verbose_name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;self.get_type_display()&#125;</span>-<span class="hljs-subst">&#123;self.title&#125;</span>&#x27;</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span>(<span class="hljs-params">models.Model</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;学生信息表&quot;&quot;&quot;</span><br>    nickname = models.CharField(max_length=<span class="hljs-number">30</span>, primary_key=<span class="hljs-literal">True</span>, db_index=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&quot;昵称&quot;</span>)<br>    course = models.ManyToManyField(Course, verbose_name=<span class="hljs-string">&#x27;课程&#x27;</span>)<br>    age = models.PositiveIntegerField(verbose_name=<span class="hljs-string">&#x27;年龄&#x27;</span>)<br>    gender = models.CharField(choices=((<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;男&#x27;</span>), (<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;女&#x27;</span>), (<span class="hljs-number">0</span>, <span class="hljs-string">&#x27;保密&#x27;</span>)), max_length=<span class="hljs-number">1</span>, default=<span class="hljs-number">0</span>, verbose_name=<span class="hljs-string">&#x27;性别&#x27;</span>)<br>    study_time = models.PositiveIntegerField(verbose_name=<span class="hljs-string">&#x27;学习时长&#x27;</span>)<br>    created_at = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;创建时间&#x27;</span>)<br>    updated_at = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;更新时间&#x27;</span>)<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        verbose_name = <span class="hljs-string">&#x27;学生信息表&#x27;</span><br>        verbose_name_plural = verbose_name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.nickname<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TeacherAssistant</span>(<span class="hljs-params">models.Model</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;助教信息表&quot;&quot;&quot;</span><br>    nickname = models.CharField(max_length=<span class="hljs-number">30</span>, primary_key=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&quot;昵称&quot;</span>)<br>    teacher = models.OneToOneField(Teacher, on_delete=models.SET_NULL, verbose_name=<span class="hljs-string">&#x27;讲师&#x27;</span>, null=<span class="hljs-literal">True</span>)<br>    hobby = models.CharField(max_length=<span class="hljs-number">100</span>, null=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;爱好&#x27;</span>)<br>    created_at = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;创建时间&#x27;</span>)<br>    updated_at = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;更新时间&#x27;</span>)<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        verbose_name = <span class="hljs-string">&#x27;助教信息表&#x27;</span><br>        db_table = <span class="hljs-string">&#x27;courses_assistant&#x27;</span><br>        verbose_name_plural = verbose_name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.nickname<br></code></pre></div></td></tr></table></figure><p><img src="image-20210718092929934.png"></p><h1 id="Django数据表操作"><a href="#Django数据表操作" class="headerlink" title="Django数据表操作"></a><code>Django</code>数据表操作</h1><h2 id="更改数据表"><a href="#更改数据表" class="headerlink" title="更改数据表"></a>更改数据表</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># Django 更改数据表的方法:</span><br> python manage.py makemigrations <span class="hljs-comment">#生成迁移文件</span><br> python manage.py migrate <span class="hljs-comment">#生成(更新)数据库表</span><br></code></pre></div></td></tr></table></figure><p>删除某个模型类的完整操作:</p><ul><li>在已创建的<code>app</code>下, 首先删除<code>models.py</code>中需要删除的模型类</li><li>删除该模型类在迁移脚本<code>migrations</code>中的对应文件</li><li>删除该项目在<code>django_migrations</code>中的对应记录删除数据库中对应的数据表</li><li>最后删除数据库中的表</li></ul><h2 id="如何导入数据"><a href="#如何导入数据" class="headerlink" title="如何导入数据"></a>如何导入数据</h2><h3 id="django-shell"><a href="#django-shell" class="headerlink" title="django-shell"></a><code>django-shell</code></h3><p><code>python manage.py shell</code>调取<code>shell</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">(venv) D:\PycharmProjects\onlineshop\shop&gt;python manage.py shell<br>Python <span class="hljs-number">3.9</span><span class="hljs-number">.5</span> (tags/v3<span class="hljs-number">.9</span><span class="hljs-number">.5</span>:0a7dcbd, May  <span class="hljs-number">3</span> <span class="hljs-number">2021</span>, <span class="hljs-number">17</span>:<span class="hljs-number">27</span>:<span class="hljs-number">52</span>) [MSC v<span class="hljs-number">.1928</span> <span class="hljs-number">64</span> bit (AMD64)] on win32<br><span class="hljs-type">Type</span> <span class="hljs-string">&quot;help&quot;</span>, <span class="hljs-string">&quot;copyright&quot;</span>, <span class="hljs-string">&quot;credits&quot;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;license&quot;</span> <span class="hljs-keyword">for</span> more information.<br>(InteractiveConsole)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> course.models <span class="hljs-keyword">import</span> Teacher <br><span class="hljs-meta">&gt;&gt;&gt; </span>t = Teacher(nickname=<span class="hljs-string">&#x27;holy&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>t.save()<br><br></code></pre></div></td></tr></table></figure><p>相应的值保存到数据库中。</p><p><img src="image-20210718103714740.png"></p><h3 id="脚本导入"><a href="#脚本导入" class="headerlink" title="脚本导入"></a>脚本导入</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> django<br><span class="hljs-keyword">import</span> random<br><br>project_path = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))<br>sys.path.append(project_path)<br><span class="hljs-built_in">print</span>(project_path)<br><br>os.environ[<span class="hljs-string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>] = <span class="hljs-string">&#x27;shop.settings&#x27;</span><br>django.setup()<br><br><span class="hljs-keyword">from</span> course.models <span class="hljs-keyword">import</span> Teacher, Course, Student, TeacherAssistant<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">import_data</span>():</span><br>    <span class="hljs-string">&quot;&quot;&quot;使用django ORM导入数据&quot;&quot;&quot;</span><br><br>    <span class="hljs-comment"># 课程数据 bulk_create()</span><br><br>    Course.objects.bulk_create([Course(title=<span class="hljs-string">f&#x27;Python系列教程<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span>, teacher=Teacher.objects.get(nickname=<span class="hljs-string">&quot;Jack&quot;</span>),<br>                                       <span class="hljs-built_in">type</span>=random.choice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<br>                                       price=random.randint(<span class="hljs-number">200</span>, <span class="hljs-number">300</span>), volume=random.randint()) <span class="hljs-keyword">for</span> i<br>                                <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)])<br><br>    Course.objects.bulk_create([Course(title=<span class="hljs-string">f&#x27;Java系列教程<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span>, teacher=Teacher.objects.get(nickname=<span class="hljs-string">&quot;Allen&quot;</span>),<br>                                       <span class="hljs-built_in">type</span>=random.choice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<br>                                       price=random.randint(<span class="hljs-number">200</span>, <span class="hljs-number">300</span>), volume=random.randint()) <span class="hljs-keyword">for</span> i<br>                                <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)])<br>    Course.objects.bulk_create([Course(title=<span class="hljs-string">f&#x27;Golang系列教程<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span>, teacher=Teacher.objects.get(nickname=<span class="hljs-string">&quot;Henry&quot;</span>),<br>                                       <span class="hljs-built_in">type</span>=random.choice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<br>                                       price=random.randint(<span class="hljs-number">200</span>, <span class="hljs-number">300</span>), volume=random.randint()) <span class="hljs-keyword">for</span> i<br>                                <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)])<br><br>    <span class="hljs-comment"># 学生数据 update_or_create()</span><br>    Student.objects.update_or_create(nickname=<span class="hljs-string">&quot;A同学&quot;</span>, defaults=&#123;<span class="hljs-string">&quot;age&quot;</span>: random.randint(<span class="hljs-number">18</span>, <span class="hljs-number">58</span>),<br>                                                               <span class="hljs-string">&quot;gender&quot;</span>: random.choice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<br>                                                               <span class="hljs-string">&quot;study_time&quot;</span>: random.randint(<span class="hljs-number">9</span>, <span class="hljs-number">999</span>)&#125;)<br>    Student.objects.update_or_create(nickname=<span class="hljs-string">&quot;B同学&quot;</span>, defaults=&#123;<span class="hljs-string">&quot;age&quot;</span>: random.randint(<span class="hljs-number">18</span>, <span class="hljs-number">58</span>),<br>                                                               <span class="hljs-string">&quot;gender&quot;</span>: random.choice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<br>                                                               <span class="hljs-string">&quot;study_time&quot;</span>: random.randint(<span class="hljs-number">9</span>, <span class="hljs-number">999</span>)&#125;)<br>    Student.objects.update_or_create(nickname=<span class="hljs-string">&quot;C同学&quot;</span>, defaults=&#123;<span class="hljs-string">&quot;age&quot;</span>: random.randint(<span class="hljs-number">18</span>, <span class="hljs-number">58</span>),<br>                                                               <span class="hljs-string">&quot;gender&quot;</span>: random.choice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<br>                                                               <span class="hljs-string">&quot;study_time&quot;</span>: random.randint(<span class="hljs-number">9</span>, <span class="hljs-number">999</span>)&#125;)<br>    Student.objects.update_or_create(nickname=<span class="hljs-string">&quot;D同学&quot;</span>, defaults=&#123;<span class="hljs-string">&quot;age&quot;</span>: random.randint(<span class="hljs-number">18</span>, <span class="hljs-number">58</span>),<br>                                                               <span class="hljs-string">&quot;gender&quot;</span>: random.choice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<br>                                                               <span class="hljs-string">&quot;study_time&quot;</span>: random.randint(<span class="hljs-number">9</span>, <span class="hljs-number">999</span>)&#125;)<br>    <span class="hljs-comment"># 正向添加</span><br>    <span class="hljs-comment"># 销量大于等于1000的课程</span><br>    Student.objects.get(nickname=<span class="hljs-string">&quot;A同学&quot;</span>).course.add(*Course.objects.<span class="hljs-built_in">filter</span>(volume__gte=<span class="hljs-number">1000</span>))<br>    <span class="hljs-comment"># 销量大于5000的课程</span><br>    Student.objects.get(nickname=<span class="hljs-string">&quot;B同学&quot;</span>).course.add(*Course.objects.<span class="hljs-built_in">filter</span>(volume__gt=<span class="hljs-number">5000</span>))<br>    <span class="hljs-comment"># 反向添加</span><br>    Course.objects.get(title=<span class="hljs-string">&quot;Python系列教程1&quot;</span>).student_set.add(*Student.objects.<span class="hljs-built_in">filter</span>(study_time__gte=<span class="hljs-number">500</span>))<br>    Course.objects.get(title=<span class="hljs-string">&quot;Python系列教程2&quot;</span>).student_set.add(*Student.objects.<span class="hljs-built_in">filter</span>(study_time__lte=<span class="hljs-number">500</span>))<br><br>    <span class="hljs-comment"># 助教数据 get_or_create()</span><br>    TeacherAssistant.objects.get_or_create(nickname=<span class="hljs-string">&#x27;助教1&#x27;</span>,<br>                                           defaults=&#123;<span class="hljs-string">&quot;hobby&quot;</span>: <span class="hljs-string">&quot;学习英语&quot;</span>, <span class="hljs-string">&quot;teacher&quot;</span>: Teacher.objects.get(nickname=<span class="hljs-string">&#x27;Jack&#x27;</span>)&#125;)<br>    TeacherAssistant.objects.get_or_create(nickname=<span class="hljs-string">&#x27;助教2&#x27;</span>,<br>                                           defaults=&#123;<span class="hljs-string">&quot;hobby&quot;</span>: <span class="hljs-string">&quot;学习德语&quot;</span>, <span class="hljs-string">&quot;teacher&quot;</span>: Teacher.objects.get(nickname=<span class="hljs-string">&#x27;Allen&#x27;</span>)&#125;)<br>    TeacherAssistant.objects.get_or_create(nickname=<span class="hljs-string">&#x27;助教2&#x27;</span>,<br>                                           defaults=&#123;<span class="hljs-string">&quot;hobby&quot;</span>: <span class="hljs-string">&quot;学习汉语&quot;</span>, <span class="hljs-string">&quot;teacher&quot;</span>: Teacher.objects.get(nickname=<span class="hljs-string">&#x27;Henry&#x27;</span>)&#125;)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">try</span>:<br><br>        import_data()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;数据导入成功！&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;数据导入失败&quot;</span>, e)<br></code></pre></div></td></tr></table></figure><h2 id="Models-API"><a href="#Models-API" class="headerlink" title="# Models API"></a># <code>Models API</code></h2><h2 id="查询集QuerySet"><a href="#查询集QuerySet" class="headerlink" title="查询集QuerySet"></a>查询集<code>QuerySet</code></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render<br><span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> View<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> *<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">course_view</span>(<span class="hljs-params">request</span>):</span><br>    <span class="hljs-comment"># 1.查询、检索、过滤</span><br>    teachers = Teacher.objects.<span class="hljs-built_in">all</span>()<br>    <span class="hljs-built_in">print</span>(teachers)  <span class="hljs-comment"># 返回查询集</span><br>    <span class="hljs-comment"># &lt;QuerySet [&lt;Teacher: Teacher object (holy)&gt;, &lt;Teacher: Teacher object (Jack)&gt;, &lt;Teacher: Teacher object (Allen)&gt;]&gt;</span><br><br>    teacher1 = Teacher.objects.get(nickname=<span class="hljs-string">&#x27;Jack&#x27;</span>)  <span class="hljs-comment"># 返回一条结果</span><br>    <span class="hljs-built_in">print</span>(teacher1, <span class="hljs-built_in">type</span>(teacher1))<br>    <span class="hljs-comment"># Teacher object (Jack) &lt;class &#x27;course.models.Teacher&#x27;&gt;</span><br><br>    teacher2 = Teacher.objects.<span class="hljs-built_in">filter</span>(fans__gte=<span class="hljs-number">500</span>)  <span class="hljs-comment"># QuerySet 可以是多条结果</span><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> teacher2:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;讲师姓名<span class="hljs-subst">&#123;t.nickname&#125;</span>--粉丝数<span class="hljs-subst">&#123;t.fans&#125;</span>&#x27;</span>)<br>        <span class="hljs-comment"># 讲师姓名Jack--粉丝数666</span><br>        <span class="hljs-comment"># 讲师姓名Henry--粉丝数899</span><br><br>    <span class="hljs-comment"># 2. 字段字符匹配，大小写敏感</span><br>    teacher3 = Teacher.objects.<span class="hljs-built_in">filter</span>(fans__in=[<span class="hljs-number">666</span>, <span class="hljs-number">1200</span>])<br>    <span class="hljs-built_in">print</span>(teacher3)<br>    <span class="hljs-comment"># &lt;QuerySet [&lt;Teacher: Teacher object (Jack)&gt;]&gt;</span><br><br>    teacher4 = Teacher.objects.<span class="hljs-built_in">filter</span>(nickname__icontains=<span class="hljs-string">&#x27;A&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(teacher4)<br>    <span class="hljs-comment"># &lt;QuerySet [&lt;Teacher: Teacher object (Jack)&gt;, &lt;Teacher: Teacher object (Allen)&gt;]&gt;</span><br><br>    <span class="hljs-comment"># 3.结果切片、排序、链式查询</span><br>    <span class="hljs-built_in">print</span>(Teacher.objects.<span class="hljs-built_in">all</span>()[:<span class="hljs-number">1</span>])<br><br>    teacher5 = Teacher.objects.<span class="hljs-built_in">all</span>().order_by(<span class="hljs-string">&#x27;-fans&#x27;</span>)<br>    <span class="hljs-keyword">for</span> teacher <span class="hljs-keyword">in</span> teacher5:<br>        <span class="hljs-built_in">print</span>(teacher.nickname, teacher.fans)<br>        <span class="hljs-comment"># Henry 899</span><br>        <span class="hljs-comment"># Jack 666</span><br>        <span class="hljs-comment"># Allen 123</span><br>        <span class="hljs-comment"># holy 0</span><br>    <span class="hljs-built_in">print</span>(Teacher.objects.<span class="hljs-built_in">filter</span>(fans__gte=<span class="hljs-number">500</span>).order_by(<span class="hljs-string">&#x27;nickname&#x27;</span>))<br>    <span class="hljs-comment"># &lt;QuerySet [&lt;Teacher: Teacher object (Henry)&gt;, &lt;Teacher: Teacher object (Jack)&gt;]&gt;</span><br><br>    <span class="hljs-comment"># 4. 查看执行的原生SQL     str(xx.query)</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(Teacher.objects.<span class="hljs-built_in">all</span>().query))<br>    <span class="hljs-comment"># SELECT &quot;course_teacher&quot;.&quot;nickname&quot;, &quot;course_teacher&quot;.&quot;introduction&quot;,</span><br>    <span class="hljs-comment">#    &quot;course_teacher&quot;.&quot;fans&quot;, &quot;course_teacher&quot;.&quot;created_at&quot;, &quot;course_teacher&quot;.&quot;updated_at&quot; FROM &quot;course_teacher&quot;</span><br><br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;course.html&#x27;</span>)<br></code></pre></div></td></tr></table></figure><h2 id="返回新的QuerySet的API"><a href="#返回新的QuerySet的API" class="headerlink" title="返回新的QuerySet的API"></a>返回新的<code>QuerySet</code>的<code>API</code></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;返回QuerySet API&quot;&quot;&quot;</span><br><span class="hljs-comment"># 1.all(), filter(),order_by(),exclude(),reverse(),distinct()</span><br><span class="hljs-built_in">print</span>(Teacher.objects.<span class="hljs-built_in">all</span>().exclude(nickname=<span class="hljs-string">&#x27;Henry&#x27;</span>))<br><span class="hljs-comment"># &lt;QuerySet [&lt;Teacher: Teacher object (holy)&gt;, &lt;Teacher: Teacher object (Jack)&gt;, &lt;Teacher: Teacher obj</span><br><span class="hljs-comment"># ect (Allen)&gt;]&gt;</span><br><br><span class="hljs-comment"># 2.extra(), defer(), only() 实现字段名，排除一些字段，选择一些字段</span><br>teacher1 = Teacher.objects.<span class="hljs-built_in">all</span>().extra(select=&#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;nickname&#x27;</span>&#125;)<br><span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> teacher1:<br>    <span class="hljs-built_in">print</span>(t.name, t.fans)<br>    <span class="hljs-comment"># holy 0</span><br>    <span class="hljs-comment"># Jack 666</span><br>    <span class="hljs-comment"># Allen 123</span><br>    <span class="hljs-comment"># Henry 899</span><br><br>teacher2 = Teacher.objects.<span class="hljs-built_in">all</span>().only(<span class="hljs-string">&#x27;fans&#x27;</span>)<br><span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> teacher2:<br>    <span class="hljs-built_in">print</span>(t)<br>    <span class="hljs-comment"># Teacher object (holy)</span><br>    <span class="hljs-comment"># Teacher object (Jack)</span><br>    <span class="hljs-comment"># Teacher object (Allen)</span><br>    <span class="hljs-comment"># Teacher object (Henry)</span><br><br><span class="hljs-comment"># 3.value(), value_list() 获取字典或元组形式的查询集</span><br><span class="hljs-built_in">print</span>(Teacher.objects.values(<span class="hljs-string">&#x27;nickname&#x27;</span>, <span class="hljs-string">&#x27;fans&#x27;</span>))<br><span class="hljs-built_in">print</span>(Teacher.objects.values_list(<span class="hljs-string">&#x27;nickname&#x27;</span>, <span class="hljs-string">&#x27;fans&#x27;</span>))<br><span class="hljs-built_in">print</span>(Teacher.objects.values_list(<span class="hljs-string">&#x27;nickname&#x27;</span>, flat=<span class="hljs-literal">True</span>))<br><span class="hljs-comment"># &lt;QuerySet [&#123;&#x27;nickname&#x27;: &#x27;holy&#x27;, &#x27;fans&#x27;: 0&#125;, &#123;&#x27;nickname&#x27;: &#x27;Jack&#x27;, &#x27;fans&#x27;: 666&#125;, &#123;&#x27;nickname&#x27;: &#x27;Allen&#x27;,</span><br><span class="hljs-comment">#  &#x27;fans&#x27;: 123&#125;, &#123;&#x27;nickname&#x27;: &#x27;Henry&#x27;, &#x27;fans&#x27;: 899&#125;]&gt;</span><br><span class="hljs-comment"># &lt;QuerySet [(&#x27;holy&#x27;, 0), (&#x27;Jack&#x27;, 666), (&#x27;Allen&#x27;, 123), (&#x27;Henry&#x27;, 899)]&gt;</span><br><span class="hljs-comment"># &lt;QuerySet [&#x27;Allen&#x27;, &#x27;Henry&#x27;, &#x27;Jack&#x27;, &#x27;holy&#x27;]&gt;</span><br><br><span class="hljs-comment"># 4.dates(), datetimes() 获取时间日期查询集</span><br><span class="hljs-built_in">print</span>(Teacher.objects.dates(<span class="hljs-string">&#x27;created_at&#x27;</span>, <span class="hljs-string">&#x27;year&#x27;</span>, order=<span class="hljs-string">&#x27;DESC&#x27;</span>))<br><span class="hljs-comment"># &lt;QuerySet [datetime.date(2021, 1, 1)]&gt;</span><br><span class="hljs-built_in">print</span>(Teacher.objects.datetimes(<span class="hljs-string">&#x27;created_at&#x27;</span>, <span class="hljs-string">&#x27;year&#x27;</span>, order=<span class="hljs-string">&#x27;DESC&#x27;</span>))<br><span class="hljs-comment"># &lt;QuerySet [datetime.datetime(2021, 1, 1, 0, 0, tzinfo=&lt;UTC&gt;)]&gt;</span><br><br><span class="hljs-comment"># union(), intersection(), difference() 并集，交集，差集</span><br>p_240 = Teacher.objects.<span class="hljs-built_in">filter</span>(fans__gte=<span class="hljs-number">240</span>)<br>p_300 = Teacher.objects.<span class="hljs-built_in">filter</span>(fans__lte=<span class="hljs-number">300</span>)<br><span class="hljs-built_in">print</span>(p_240.union(p_300))<br><span class="hljs-built_in">print</span>(p_240.intersection(p_300))<br><span class="hljs-built_in">print</span>(p_240.difference(p_300))<br><span class="hljs-comment"># &lt;QuerySet [&lt;Teacher: Teacher object (Allen)&gt;, &lt;Teacher: Teacher object (Henry)&gt;, &lt;Teacher: Teacher o</span><br><span class="hljs-comment"># bject (Jack)&gt;, &lt;Teacher: Teacher object (holy)&gt;]&gt;</span><br><span class="hljs-comment"># &lt;QuerySet []&gt;</span><br><span class="hljs-comment"># &lt;QuerySet [&lt;Teacher: Teacher object (Henry)&gt;, &lt;Teacher: Teacher object (Jack)&gt;]&gt;</span><br><br><span class="hljs-comment"># 6.select_related() 一对、多对、查询优化、prefetch_related() 一对多，多对多查询优化；反向查询</span><br>students = Student.objects.<span class="hljs-built_in">filter</span>(age__lt=<span class="hljs-number">30</span>).prefetch_related(<span class="hljs-string">&#x27;course&#x27;</span>)<br><span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> students:<br>    <span class="hljs-built_in">print</span>(s.course.<span class="hljs-built_in">all</span>())<br><span class="hljs-built_in">print</span>(Teacher.objects.get(nickname=<span class="hljs-string">&#x27;Jack&#x27;</span>).course_set.<span class="hljs-built_in">all</span>())<br><br><span class="hljs-comment"># 7.annotate() 使用聚合计数，求和、平均数 raw() 执行原生的SQL</span><br><span class="hljs-built_in">print</span>(Course.objects.values(<span class="hljs-string">&#x27;teacher&#x27;</span>).annotate(vol=<span class="hljs-built_in">sum</span>(<span class="hljs-string">&#x27;volume&#x27;</span>)))<br><span class="hljs-built_in">print</span>(Course.objects.values(<span class="hljs-string">&#x27;teacher&#x27;</span>).annotate(pri=Avg(<span class="hljs-string">&#x27;price&#x27;</span>)))<br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    
    <tags>
      
      <tag>django</tag>
      
      <tag>orm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>modbus协议</title>
    <link href="/2021/07/12/modbus%E5%8D%8F%E8%AE%AE/"/>
    <url>/2021/07/12/modbus%E5%8D%8F%E8%AE%AE/</url>
    
    <content type="html"><![CDATA[<p><code>Modbus</code>作为开放式的工业通讯协议，在各种工业设备中应用极其广泛。</p><p><code>Modbus</code>有国际标准，也有国家标准，内容是完全一样的。在标准钟支持2种物理链路：一是基于<code>RS485（RS232）</code>的串行链路；二是基于以太网的<code>TCP/IP</code>链路。事实上，<code>Modbus</code>协议作为一种应用层协议对物理键子并没有特别的要求，光纤、无线等都是可以实现的。</p><p><code>Modbus RTU</code>和<code>Modbus TCP</code>两种标准协议方式，支持常用的功能码：</p><table><thead><tr><th align="center"><strong>功能码</strong></th><th align="center"><strong>名称</strong></th><th align="center"><strong>实现</strong></th><th align="left"><strong>描述</strong></th></tr></thead><tbody><tr><td align="center">0x01</td><td align="center">读线圈</td><td align="center">是</td><td align="left">对可读写型的状态量进行读取</td></tr><tr><td align="center">0x02</td><td align="center">读离散输入</td><td align="center">是</td><td align="left">对只读型的状态量进行读取</td></tr><tr><td align="center">0x03</td><td align="center">读保持寄存器</td><td align="center">是</td><td align="left">对可读写型的寄存器量进行读取</td></tr><tr><td align="center">0x04</td><td align="center">读输入寄存器</td><td align="center">是</td><td align="left">对只读型的寄存器量进行读取</td></tr><tr><td align="center">0x05</td><td align="center">写单个线圈</td><td align="center">是</td><td align="left">对单个的读写型的状态量进行写入</td></tr><tr><td align="center">0x06</td><td align="center">写单个寄存器</td><td align="center">是</td><td align="left">对单个的读写型的寄存器量进行写入</td></tr><tr><td align="center">0x0F</td><td align="center">写多个线圈</td><td align="center">是</td><td align="left">对多个的读写型的状态量进行写入</td></tr><tr><td align="center">0x10</td><td align="center">写多个寄存器</td><td align="center">是</td><td align="left">对多个的读写型的寄存器量进行写入</td></tr></tbody></table><p><code>Modbus</code>协议是一种主从（或者说客户端/服务器）模式协议，有主站（客户端）发起事务请求，从站（服务器）响应事务请求。一般我们想要访问（或者说被访问）的设备即为从站（服务器），而我们通常去访问别人的设备就是主站（客户端）。通常在<code>RTU</code>时被称为主站和从站，而在<code>TCP</code>方式时被称为服务器和客户端。这种称呼只是叫法不同，但在本质上是没有区别我的。</p><h2 id="1、标准流程"><a href="#1、标准流程" class="headerlink" title="1、标准流程"></a>1、标准流程</h2><p>启动<code>MODBUS</code> 事务处理的客户机创建 <code>MODBUS</code> 应用数据单元。当从客户机向服务器设备发送报文时，功能码向服务器指示将执行哪种操作。</p><p>从客户机向服务器设备发送的报文数据域包括附加信息，服务器使用这个信息执行功能码定义的操作。如果在一个正确接收的 <code>MODBUS ADU</code> 中，不出现与请求 <code>MODBUS</code> 功能有关的差错，那么服务器至客户机的响应数据域包括请求数据。</p><p><img src="564295-20170704210404112-181581650.png"></p><h3 id="正常事务处理流程"><a href="#正常事务处理流程" class="headerlink" title="正常事务处理流程"></a>正常事务处理流程</h3><p>如果出现与请求 <code>MODBUS</code> 功能有关的差错，那么域包括一个异常码，服务器应用能够使用这个域确定下一个执行的操作。当服务器对客户机响应时，它使用功能码域来指示正常（无差错）响应或者出现某种差错（称为异常响应）。对于一个正常响应来说，服务器仅对原始功能码响应。</p><p> <img src="564295-20170704210415394-91481268-1626106199739.png"></p><h2 id="2、操作设计"><a href="#2、操作设计" class="headerlink" title="2、操作设计"></a>2、操作设计</h2><p>根据对<code>Modbus</code>标准事务流程的理解，主站和从站的具体操作过程。</p><p><strong>主站操作流程：</strong></p><p>（1）、初始化主站，站标识符，定时器、</p><p>（2）、生成访问命令</p><p>生成命令<code>ADU</code>分两层实现：网络层和链路层。</p><p>（3）、定时发送访问命令，读命令定是轮询，写命令具有更高的优先级。在有写命令时暂停读命令，</p><p>（4）、解析接收到的数据，进行相应操作</p><p><strong>从站操作流程：</strong></p><p>（1）、协议栈初始化：从站地址设置，创建数据存储域，访问控制</p><p>（2）、从站接收消息并解析</p><p>解析消息后操作数据（读写对应对象的值）</p><p>生成响应</p><p>（3）、生成响应数据并回复</p><h2 id="3、命令格式"><a href="#3、命令格式" class="headerlink" title="3、命令格式"></a>3、命令格式</h2><p>不同的功能码具有不同的消息格式，简单说一下常用的8种功能码的信息格式。</p><h3 id="（1）功能码0x01：读线圈"><a href="#（1）功能码0x01：读线圈" class="headerlink" title="（1）功能码0x01：读线圈"></a>（1）功能码<code>0x01</code>：读线圈</h3><p>在一个远程设备中，使用该功能码读取线圈的1至2000个连续状态。请求 <code>PDU</code>详细说明了起始地址，即指定的第一个线圈地址和线圈编号。从零开始寻址线圈。因此寻址线圈 <code>1-16</code> 为 <code>0-15</code>。</p><p>根据数据域的每个比特将响应报文中的线圈分成为一个线圈。指示状态为 <code>1= ON</code> 和 <code>0= OFF</code>。第一个数据字节的 <code>LSB（最低有效位）</code>包括在询问中寻址的输出。其它线圈依次类推，一直到这个字节的高位端为止，并在后续字节中从低位到高位的顺序。</p><p>如果返回的输出数量不是八的倍数，将用零填充最后数据字节中的剩余比特（一直到字节的高位端）。字节数量域说明了数据的完整字节数。具体格式举例如下：</p><p> <img src="564295-20170704210448456-2056023284.png"></p><h3 id="（2）功能码0x02：读离散量输入"><a href="#（2）功能码0x02：读离散量输入" class="headerlink" title="（2）功能码0x02：读离散量输入"></a>（2）功能码<code>0x02</code>：读离散量输入</h3><p>在一个远程设备中，使用该功能码读取离散量输入的 1 至 2000 连续状态。请求 <code>PDU</code> 详细说明了起始地址，即指定的第一个输入地址和输入编号。从零开始寻址输入。因此寻址输入 <code>1-16</code> 为 <code>0-15</code>。</p><p>根据数据域的每个比特将响应报文中的离散量输入分成为一个输入。指示状态为<code>1=ON</code> 和<code>0=OFF</code>。第一个数据字节的 <code>LSB（最低有效位）</code>包括在询问中寻址的输入。其它输入依次类推，一直到这个字节的高位端为止，并在后续字节中从低位到高位的顺序。</p><p>如果返回的输入数量不是八的倍数，将用零填充最后数据字节中的剩余比特（一直到字节的高位端）。字节数量域说明了数据的完整字节数。具体格式举例如下：</p><p> <img src="564295-20170704210457003-261949831.png"></p><p>事实上，功能码<code>0x01</code>和<code>0x02</code>的数据格式是完全一样的，操作方式也是完全一样的，所不同只是操作的对象不同。</p><h3 id="（3）功能码0x03：读保持寄存器"><a href="#（3）功能码0x03：读保持寄存器" class="headerlink" title="（3）功能码0x03：读保持寄存器"></a>（3）功能码<code>0x03</code>：读保持寄存器</h3><p>在一个远程设备中，使用该功能码读取保持寄存器连续块的内容。请求 <code>PDU</code> 说明了起始寄存器地址和寄存器数量。从零开始寻址寄存器。因此，寻址寄存器 <code>1-16</code> 为 <code>0-15</code>。</p><p>将响应报文中的寄存器数据分成每个寄存器有两字节，在每个字节中直接地调整二进制内容。</p><p>对于每个寄存器，第一个字节包括高位比特，并且第二个字节包括低位比特。具体的格式举例如下：</p><p> <img src="564295-20170704210508550-798950645.png"></p><p>响应信息的长度与具体读取的数据量有关。</p><h3 id="（4）功能码0x04：读输入寄存器"><a href="#（4）功能码0x04：读输入寄存器" class="headerlink" title="（4）功能码0x04：读输入寄存器"></a>（4）功能码<code>0x04</code>：读输入寄存器</h3><p>在一个远程设备中，使用该功能码读取 1 至大约 125 的连续输入寄存器。请求 <code>PDU</code> 说明了起始地址和寄存器数量。从零开始寻址寄存器。因此，寻址输入寄存器 <code>1-16</code> 为 <code>0-15</code>。</p><p>将响应报文中的寄存器数据分成每个寄存器为两字节，在每个字节中直接地调整二进制内容。</p><p>对于每个寄存器，第一个字节包括高位比特，并且第二个字节包括低位比特。具体的格式举例如下：</p><p> <img src="564295-20170704210521878-873305173.png"></p><p>事实上，功能码<code>0x03</code>和<code>0x04</code>的数据格式是完全一样的，操作方式也是完全一样的，所不同只是操作的对象不同。响应信息的长度与具体读取的数据量有关。</p><h3 id="（5）功能码0x05：写单个线圈"><a href="#（5）功能码0x05：写单个线圈" class="headerlink" title="（5）功能码0x05：写单个线圈"></a>（5）功能码<code>0x05</code>：写单个线圈</h3><p>在一个远程设备上，使用该功能码写单个输出为 <code>ON</code> 或 <code>OFF</code>。</p><p>请求数据域中的常量说明请求的<code>ON/OFF</code>状态。十六进制值<code>0xFF00</code>请求输出为 <code>ON</code>。十六进制值<code>0x0000</code> 请求输出为<code>OFF</code>。其它所有值均是非法的，并且对输出不起作用。</p><p>请求 <code>PDU</code> 说明了强制的线圈地址。从零开始寻址线圈。因此，寻址线圈1为0。线圈值域的常量说明请求的 <code>ON/OFF</code> 状态。十六进制值 <code>0XFF00</code> 请求线圈为 <code>ON</code>。十六进制值 <code>0X0000</code> 请求线圈为<code>OFF</code>。其它所有值均为非法的，并且对线圈不起作用。</p><p>正常响应是请求的应答，在写入线圈状态之后返回这个正常响应。具体的格式举例如下：</p><p> <img src="564295-20170704210531862-774173145.png"></p><h3 id="（6）功能码0x06：写单个寄存器"><a href="#（6）功能码0x06：写单个寄存器" class="headerlink" title="（6）功能码0x06：写单个寄存器"></a>（6）功能码<code>0x06</code>：写单个寄存器</h3><p>在一个远程设备中，使用该功能码写单个保持寄存器。</p><p>请求 <code>PDU</code> 说明了被写入寄存器的地址。从零开始寻址寄存器。因此，寻址寄存器<code>1</code>为<code>0</code>。</p><p>正常响应是请求的应答，在写入寄存器内容之后返回这个正常响应。具体的格式举例如下：</p><p> <img src="564295-20170704210541128-1585003645.png"></p><h3 id="（7）功能码0x0F：写多个线圈"><a href="#（7）功能码0x0F：写多个线圈" class="headerlink" title="（7）功能码0x0F：写多个线圈"></a>（7）功能码<code>0x0F</code>：写多个线圈</h3><p>在一个远程设备中，使用该功能码强制线圈序列中的每个线圈为<code>ON</code>或<code>OFF</code>。请求<code>PDU</code>说明了强制的线圈参考。从零开始寻址线圈。因此，寻址线圈<code>1</code>为<code>0</code>。</p><p>请求数据域的内容说明了被请求的<code>ON/OFF</code>状态。域比特位置中的逻辑<code>“1”</code>请求相应输出为<code>ON</code>。域比特位置中的逻辑<code>“0”</code>请求相应输出为 <code>OFF</code>。</p><p>正常响应返回功能码、起始地址和强制的线圈数量。具体的格式举例如下：</p><p> <img src="564295-20170704210554487-1357285608.png"></p><h3 id="（8）功能码0x10：写多个寄存器"><a href="#（8）功能码0x10：写多个寄存器" class="headerlink" title="（8）功能码0x10：写多个寄存器"></a>（8）功能码<code>0x10</code>：写多个寄存器</h3><p>在一个远程设备中，使用该功能码写连续寄存器块(1至约120个寄存器)。</p><p>在请求数据域中说明了请求写入的值。每个寄存器将数据分成两字节。</p><p>正常响应返回功能码、起始地址和被写入寄存器的数量。具体的格式举例如下：</p><p> <img src="564295-20170704210606503-1586352399.png"></p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>工业物联网</category>
      
    </categories>
    
    
    <tags>
      
      <tag>modbus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Echatrs的使用</title>
    <link href="/2021/07/07/Echatrs%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2021/07/07/Echatrs%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h2><h3 id="获取-ECharts"><a href="#获取-ECharts" class="headerlink" title="获取 ECharts"></a>获取 ECharts</h3><p>你可以通过以下几种方式获取 <code>Apache EChartsTM</code>。</p><ul><li>从<code>Apache ECharts</code>官网下载界面 获取官方源码包后构建。</li><li>在<code>ECharts</code>的<code>GitHub</code>获取。</li><li>通过 <code>npm</code> 获取<code> echarts，npm install echarts --save</code>，详见“在 <code>webpack </code>中使用<code> echarts</code>”</li><li>通过 <code>jsDelivr </code>等<code>CDN</code>引入</li></ul><h3 id="引入-ECharts"><a href="#引入-ECharts" class="headerlink" title="引入 ECharts"></a>引入<code> ECharts</code></h3><p>通过标签方式直接引入构建好的 <code>echarts</code>文件</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/echarts/5.1.2/echarts.common.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="绘制一个简单的图表"><a href="#绘制一个简单的图表" class="headerlink" title="绘制一个简单的图表"></a>绘制一个简单的图表</h3><p>在绘图前我们需要为 <code>ECharts</code> 准备一个具备高宽的 <code>DOM</code> 容器。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;line&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 60%;height:400px;margin-left: 20%;margin-right:20%;margin-bottom: 20px&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>然后就可以通过 <code>echarts.init</code> 方法初始化一个 <code>echarts</code> 实例并通过 <code>setOption</code> 方法生成一个简单的柱状图，下面是完整代码。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Echarts<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--引入echarts.js--&gt;</span><br><span class="hljs-comment">&lt;!--    &lt;script type=&quot;text/javascript&quot; src=&quot;/static/echarts.js&quot;&gt;&lt;/script&gt;--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/echarts/5.1.2/echarts.common.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 为ECharts准备一个具备大小（宽高）的Dom --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;line&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 60%;height:400px;margin-left: 20%;margin-right:20%;margin-bottom: 20px&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span><br><span class="javascript">    <span class="hljs-comment">// 柱形图图</span></span><br><span class="javascript">    <span class="hljs-comment">// 基于准备好的dom，初始化echarts实例</span></span><br><span class="javascript">    <span class="hljs-keyword">var</span> BarChart = echarts.init(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;bar&#x27;</span>));</span><br><span class="javascript"></span><br><span class="javascript">    <span class="hljs-comment">// 指定图表的配置项和数据</span></span><br><span class="javascript">    <span class="hljs-keyword">var</span> bar_option = &#123;</span><br><span class="javascript">        <span class="hljs-attr">title</span>: &#123;</span><br><span class="javascript">            <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;ECharts 入门柱形图示例&#x27;</span></span><br><span class="javascript">        &#125;,</span><br><span class="javascript">        <span class="hljs-attr">tooltip</span>: &#123;&#125;,</span><br><span class="javascript">        <span class="hljs-attr">legend</span>: &#123;</span><br><span class="javascript">            <span class="hljs-attr">data</span>: [<span class="hljs-string">&#x27;销量&#x27;</span>]</span><br><span class="javascript">        &#125;,</span><br><span class="javascript">        <span class="hljs-attr">xAxis</span>: &#123;</span><br><span class="javascript">            <span class="hljs-attr">data</span>: [<span class="hljs-string">&quot;衬衫&quot;</span>, <span class="hljs-string">&quot;羊毛衫&quot;</span>, <span class="hljs-string">&quot;雪纺衫&quot;</span>, <span class="hljs-string">&quot;裤子&quot;</span>, <span class="hljs-string">&quot;高跟鞋&quot;</span>, <span class="hljs-string">&quot;袜子&quot;</span>]</span><br><span class="javascript">        &#125;,</span><br><span class="javascript">        <span class="hljs-attr">yAxis</span>: &#123;&#125;,</span><br><span class="javascript">        <span class="hljs-attr">series</span>: [&#123;</span><br><span class="javascript">            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;销量&#x27;</span>,</span><br><span class="javascript">            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;bar&#x27;</span>,</span><br><span class="javascript">            <span class="hljs-attr">data</span>: [<span class="hljs-number">5</span>, <span class="hljs-number">20</span>, <span class="hljs-number">36</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">20</span>]</span><br><span class="javascript">        &#125;]</span><br><span class="javascript">    &#125;;</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>这样你的第一个图表就诞生了！</p><script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.1.2/echarts.common.js"></script><div id="bar" style="width: 80%;height:400px;margin-left: 10%;margin-right:10%;margin-bottom: 20px"></div><h3 id="折线图"><a href="#折线图" class="headerlink" title="折线图"></a>折线图</h3><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// 折线图</span><br><span class="hljs-comment">// 基于准备好的dom，初始化echarts实例</span><br><span class="hljs-keyword">var</span> LineChart = echarts.init(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;line&#x27;</span>));<br><br><span class="hljs-comment">// 指定图表的配置项和数据</span><br><span class="hljs-keyword">var</span> line_option = &#123;<br>    <span class="hljs-attr">title</span>: &#123;<br>        <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;ECharts 入门折线图示例&#x27;</span>,<br>        <span class="hljs-attr">subtext</span>: <span class="hljs-string">&#x27;销量数据分析&#x27;</span><br>    &#125;,<br>    <span class="hljs-attr">tooltip</span>: &#123;&#125;,<br>    <span class="hljs-attr">legend</span>: &#123;<br>        <span class="hljs-attr">data</span>: [<span class="hljs-string">&#x27;袜子&#x27;</span>, <span class="hljs-string">&#x27;裤子&#x27;</span>, <span class="hljs-string">&#x27;衬衫&#x27;</span>, <span class="hljs-string">&#x27;平均销量&#x27;</span>]<br>    &#125;,<br>    <span class="hljs-attr">xAxis</span>: &#123;<br>        <span class="hljs-attr">data</span>: [<span class="hljs-string">&quot;星期一&quot;</span>, <span class="hljs-string">&quot;星期二&quot;</span>, <span class="hljs-string">&quot;星期三&quot;</span>, <span class="hljs-string">&quot;星期四&quot;</span>, <span class="hljs-string">&quot;星期五&quot;</span>, <span class="hljs-string">&quot;星期六&quot;</span>, <span class="hljs-string">&quot;星期日&quot;</span>]<br>    &#125;,<br>    <span class="hljs-attr">yAxis</span>: &#123;&#125;,<br>    <span class="hljs-attr">series</span>: [&#123;<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;袜子&#x27;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;line&#x27;</span>,<br>        <span class="hljs-attr">data</span>: [<span class="hljs-number">220</span>, <span class="hljs-number">136</span>, <span class="hljs-number">101</span>, <span class="hljs-number">120</span>, <span class="hljs-number">290</span>, <span class="hljs-number">124</span>, <span class="hljs-number">235</span>]<br>    &#125;,<br>        &#123;<br>            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;裤子&#x27;</span>,<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;line&#x27;</span>,<br>            <span class="hljs-attr">data</span>: [<span class="hljs-number">52</span>, <span class="hljs-number">928</span>, <span class="hljs-number">220</span>, <span class="hljs-number">136</span>, <span class="hljs-number">101</span>, <span class="hljs-number">120</span>, <span class="hljs-number">290</span>]<br>        &#125;,<br>        &#123;<br>            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;衬衫&#x27;</span>,<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;line&#x27;</span>,<br>            <span class="hljs-attr">data</span>: [<span class="hljs-number">512</span>, <span class="hljs-number">220</span>, <span class="hljs-number">136</span>, <span class="hljs-number">101</span>, <span class="hljs-number">120</span>, <span class="hljs-number">290</span>, <span class="hljs-number">1123</span>]<br>        &#125;,<br>        &#123;<br>            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;平均销量&#x27;</span>,<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;bar&#x27;</span>,<br>            <span class="hljs-attr">data</span>: [<span class="hljs-number">200</span>, <span class="hljs-number">220</span>, <span class="hljs-number">136</span>, <span class="hljs-number">300</span>, <span class="hljs-number">120</span>, <span class="hljs-number">250</span>, <span class="hljs-number">500</span>]<br>        &#125;]<br>&#125;;<br><br><span class="hljs-comment">// 使用刚指定的配置项和数据显示图表。</span><br>LineChart.setOption(line_option);<br></code></pre></div></td></tr></table></figure><div id="line" style="width: 80%;height:400px;margin-left: 10%;margin-right:10%;margin-bottom: 20px"></div><h3 id="饼图"><a href="#饼图" class="headerlink" title="饼图"></a>饼图</h3><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// 饼图</span><br>    <span class="hljs-comment">// 基于准备好的dom，初始化echarts实例</span><br>    <span class="hljs-keyword">var</span> PieChart = echarts.init(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;pie&#x27;</span>));<br><br>    <span class="hljs-comment">// 指定图表的配置项和数据</span><br>    <span class="hljs-keyword">var</span> pie_option = &#123;<br>        <span class="hljs-attr">title</span>: &#123;<br>            <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;ECharts 入门饼图示例1&#x27;</span><br>        &#125;,<br>        <span class="hljs-attr">tooltip</span>: &#123;&#125;,<br>        <span class="hljs-attr">legend</span>: &#123;<br>            <span class="hljs-attr">data</span>: [<span class="hljs-string">&#x27;直接访问&#x27;</span>, <span class="hljs-string">&#x27;邮件营销&#x27;</span>, <span class="hljs-string">&#x27;联盟广告&#x27;</span>, <span class="hljs-string">&#x27;视频广告&#x27;</span>, <span class="hljs-string">&#x27;搜索引擎&#x27;</span>]<br>        &#125;,<br>        <span class="hljs-attr">series</span>: [&#123;<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;pie&#x27;</span>,<br>            <span class="hljs-attr">radius</span>: <span class="hljs-string">&#x27;55%&#x27;</span>,<br>            <span class="hljs-attr">center</span>: [<span class="hljs-string">&#x27;50%&#x27;</span>, <span class="hljs-string">&#x27;50%&#x27;</span>],<br>            <span class="hljs-attr">data</span>: [<br>                &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;直接访问&#x27;</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">335</span>&#125;,<br>                &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;邮件营销&#x27;</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">720</span>&#125;,<br>                &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;联盟广告&#x27;</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">135</span>&#125;,<br>                &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;视频广告&#x27;</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">500</span>&#125;,<br>                &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;搜索引擎&#x27;</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">235</span>&#125;,<br>            ],<br>            <span class="hljs-attr">roseType</span>: <span class="hljs-string">&#x27;radius&#x27;</span><br>        &#125;]<br>    &#125;;<br><br>    <span class="hljs-comment">// 使用刚指定的配置项和数据显示图表。</span><br>    PieChart.setOption(pie_option);<br></code></pre></div></td></tr></table></figure><div id="pie" style="width: 95%;height:400px;margin-left: 2.5%;margin-right:2.5%;margin-bottom: 20px;"></div><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// 饼图</span><br><span class="hljs-comment">// 基于准备好的dom，初始化echarts实例</span><br><span class="hljs-keyword">var</span> Pie1Chart = echarts.init(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;pie1&#x27;</span>));<br><br><span class="hljs-comment">// 指定图表的配置项和数据</span><br><span class="hljs-keyword">var</span> pie1_option = &#123;<br>    <span class="hljs-attr">title</span>: &#123;<br>        <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;ECharts 入门饼图示例2&#x27;</span><br>    &#125;,<br>    <span class="hljs-attr">tooltip</span>: &#123;&#125;,<br>    <span class="hljs-attr">legend</span>: &#123;<br>        <span class="hljs-attr">data</span>: [<span class="hljs-string">&#x27;直接访问&#x27;</span>, <span class="hljs-string">&#x27;邮件营销&#x27;</span>, <span class="hljs-string">&#x27;联盟广告&#x27;</span>, <span class="hljs-string">&#x27;视频广告&#x27;</span>, <span class="hljs-string">&#x27;搜索引擎&#x27;</span>]<br>    &#125;,<br>    <span class="hljs-attr">series</span>: [&#123;<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;pie&#x27;</span>,<br>        <span class="hljs-attr">radius</span>: [<span class="hljs-string">&#x27;55%&#x27;</span>, <span class="hljs-string">&#x27;70%&#x27;</span>],<br>        <span class="hljs-attr">label</span>: &#123;<br>            <span class="hljs-attr">normal</span>: &#123;<br>                <span class="hljs-comment">// 取消原来的显示模式</span><br>                <span class="hljs-attr">show</span>: <span class="hljs-literal">false</span>,<br>                <span class="hljs-comment">// 在中间显示</span><br>                <span class="hljs-attr">position</span>: <span class="hljs-string">&#x27;center&#x27;</span><br>            &#125;<br>        &#125;,<br>        <span class="hljs-attr">emphasis</span>: &#123;<br>            <span class="hljs-attr">label</span>: &#123;<br>                <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span>,<br>                <span class="hljs-attr">fontSize</span>: <span class="hljs-string">&#x27;40&#x27;</span>,<br>                <span class="hljs-attr">fontWeight</span>: <span class="hljs-string">&#x27;bold&#x27;</span><br>            &#125;<br>        &#125;,<br>        <span class="hljs-comment">// center: [&#x27;50%&#x27;, &#x27;50%&#x27;],</span><br>        <span class="hljs-attr">data</span>: [<br>            &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;直接访问&#x27;</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">335</span>&#125;,<br>            &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;邮件营销&#x27;</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">720</span>&#125;,<br>            &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;联盟广告&#x27;</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">135</span>&#125;,<br>            &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;视频广告&#x27;</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">500</span>&#125;,<br>            &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;搜索引擎&#x27;</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">235</span>&#125;,<br>        ],<br>    &#125;]<br>&#125;;<br><br><span class="hljs-comment">// 使用刚指定的配置项和数据显示图表。</span><br>Pie1Chart.setOption(pie1_option);<br></code></pre></div></td></tr></table></figure><div id="pie1" style="width: 95%;height:400px;margin-left: 2.5%;margin-right:2.5%;margin-bottom: 20px;"></div><h3 id="词云图"><a href="#词云图" class="headerlink" title="词云图"></a>词云图</h3><script type="text/javascript" >    // 柱形图图    // 基于准备好的dom，初始化echarts实例    var BarChart = echarts.init(document.getElementById('bar'));    // 指定图表的配置项和数据    var bar_option = {        title: {            text: 'ECharts 入门柱形图示例'        },        tooltip: {},        legend: {            data: ['销量']        },        xAxis: {            data: ["衬衫", "羊毛衫", "雪纺衫", "裤子", "高跟鞋", "袜子"]        },        yAxis: {},        series: [{            name: '销量',            type: 'bar',            data: [5, 20, 36, 10, 10, 20]        }]    };        // 使用刚指定的配置项和数据显示图表。    BarChart.setOption(bar_option);        // 折线图    // 基于准备好的dom，初始化echarts实例    var LineChart = echarts.init(document.getElementById('line'));        // 指定图表的配置项和数据    var line_option = {        title: {            text: 'ECharts 入门折线图示例',            subtext: '销量数据分析'        },        tooltip: {},        legend: {            data: ['袜子', '裤子', '衬衫', '平均销量']        },        xAxis: {            data: ["星期一", "星期二", "星期三", "星期四", "星期五", "星期六", "星期日"]        },        yAxis: {},        series: [{            name: '袜子',            type: 'line',            data: [220, 136, 101, 120, 290, 124, 235]        },            {                name: '裤子',                type: 'line',                data: [52, 928, 220, 136, 101, 120, 290]            },            {                name: '衬衫',                type: 'line',                data: [512, 220, 136, 101, 120, 290, 1123]            },            {                name: '平均销量',                type: 'bar',                data: [200, 220, 136, 300, 120, 250, 500]            }]    };        // 使用刚指定的配置项和数据显示图表。    LineChart.setOption(line_option);    // 饼图    // 基于准备好的dom，初始化echarts实例    var PieChart = echarts.init(document.getElementById('pie'));        // 指定图表的配置项和数据    var pie_option = {        title: {            text: 'ECharts 入门饼图示例1'        },        tooltip: {},        legend: {            data: ['直接访问', '邮件营销', '联盟广告', '视频广告', '搜索引擎']        },        series: [{            type: 'pie',            radius: '55%',            center: ['50%', '50%'],            data: [                {name: '直接访问', value: 335},                {name: '邮件营销', value: 720},                {name: '联盟广告', value: 135},                {name: '视频广告', value: 500},                {name: '搜索引擎', value: 235},            ],            roseType: 'radius'        }]    };        // 使用刚指定的配置项和数据显示图表。    PieChart.setOption(pie_option);    // 饼图    // 基于准备好的dom，初始化echarts实例    var Pie1Chart = echarts.init(document.getElementById('pie1'));        // 指定图表的配置项和数据    var pie1_option = {        title: {            text: 'ECharts 入门饼图示例2'        },        tooltip: {},        legend: {            data: ['直接访问', '邮件营销', '联盟广告', '视频广告', '搜索引擎']        },        series: [{            type: 'pie',            radius: ['55%', '70%'],            label: {                normal: {                    // 取消原来的显示模式                    show: false,                    // 在中间显示                    position: 'center'                }            },            emphasis: {                label: {                    show: true,                    fontSize: '40',                    fontWeight: 'bold'                }            },            // center: ['50%', '50%'],            data: [                {name: '直接访问', value: 335},                {name: '邮件营销', value: 720},                {name: '联盟广告', value: 135},                {name: '视频广告', value: 500},                {name: '搜索引擎', value: 235},            ],        }]    };        // 使用刚指定的配置项和数据显示图表。    Pie1Chart.setOption(pie1_option);</script><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>echarts</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>如何实现多个虚拟机之间的通信？</title>
    <link href="/2021/07/02/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%A4%9A%E4%B8%AA%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B9%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1%EF%BC%9F/"/>
    <url>/2021/07/02/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%A4%9A%E4%B8%AA%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B9%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1%EF%BC%9F/</url>
    
    <content type="html"><![CDATA[<p>现在搭建一个测试环境，要求有一个服务端和一个客户端。服务端是<code>Linux</code>环境，客户端是<code>Windows</code>环境。已经在虚拟机中安装了两个虚拟机，一个是<code>Centos 7</code>环境，另一个是<code>Windows 7</code>环境。需要进行网络配置，实现两台虚拟机和本地主机之间的网络访问。</p><h2 id="网络规划"><a href="#网络规划" class="headerlink" title="网络规划"></a>网络规划</h2><p>先规划这三个主机的<code>IP</code>地址。</p><pre><code class=" mermaid">graph LRA[&quot;Windows7环境 虚拟机 192.168.1.2&quot;]C[&quot;Centos7环境 虚拟机 192.168.1.3&quot;]B[&quot;本地主机 192.168.1.4&quot;]A ---- BC ---- AB ---- C</code></pre><h2 id="相关配置"><a href="#相关配置" class="headerlink" title="相关配置"></a>相关配置</h2><ol><li>编辑-虚拟网络编辑器中将<code>VMnet1</code>类型仅主机模式勾选将主机虚拟适配器连接到此网络。</li></ol><p><img src="image-20210702171604889.png"></p><ol start="2"><li><code>Windows7</code>虚拟机和<code>Centos7</code>虚拟机的<code>网络适配器</code>都设置为自定义<code>VMnet1(仅主机模式)</code></li></ol><p><img src="image-20210702171952614.png"></p><ol start="3"><li>分别修改<code>Windows7</code>虚拟机和<code>Centos7</code>虚拟机的<code>IP</code>地址为<code>192.168.1.2</code>和<code>192.168.1.3</code>。</li></ol><p><img src="image-20210702172430729.png" alt="windows7 IP设置"></p><p><img src="image-20210702155511437.png" alt="Centos7 IP配置"></p><ol start="4"><li>本地<code>VMware Network Adapter VMnet1</code>网卡的<code>IP</code>配置为<code>192.168.1.4</code>。</li></ol><p><img src="image-20210702172704679.png" alt="VMware Network Adapter VMnet1 配置"></p><ol start="5"><li>测试通信状况。</li></ol><p><img src="image-20210702173022610.png" alt="Windows7虚拟机访问Centos虚拟机和本地主机"></p><p><img src="image-20210702173218709.png" alt="Centos主机访问本地主机"></p><p>以上就实现了，多个虚拟机和本地主机的通讯。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>vwware</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>虚拟机下Centos7网络配置</title>
    <link href="/2021/07/02/%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8BCentos7%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/"/>
    <url>/2021/07/02/%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8BCentos7%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<p>本次实验环境：<code>VWware</code>版本：16 pro，<code>Centos</code>版本：<code>Centos 7</code>。</p><h2 id="虚拟机下Centos配置联网"><a href="#虚拟机下Centos配置联网" class="headerlink" title="虚拟机下Centos配置联网"></a>虚拟机下<code>Centos</code>配置联网</h2><p>首先，确保主机可以联网。查看主机的<code>DNS</code>地址。</p><p><code>cmd</code>下输入<code>ipconfig</code>/all：</p><p><img src="image-20210702151438174.png"></p><p>记住此地址。</p><p>然后，修改<code>Centos</code>网络配置文件。</p><p>在<code>Centos</code>终端中，输入<code>vi /etc/sysconfig/network-scripts/ifcfg-ens33</code></p><p>配置文件内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">TYPE=Ethernet                 # 网卡类型：为以太网<br>PROXY_METHOD=none               # 代理方式：关闭状态<br>BROWSER_ONLY=no                # 只是浏览器：否<br>BOOTPROTO=dhcp                # 网卡的引导协议：DHCP<br>DEFROUTE=yes                 # 默认路由：是 <br>IPV4_FAILURE_FATAL=no             # 是不开启IPV4致命错误检测：否<br>IPV6INIT=yes                 # IPV6是否自动初始化: 是<br>IPV6_AUTOCONF=yes               # IPV6是否自动配置：是<br>IPV6_DEFROUTE=yes               # IPV6是否可以为默认路由：是<br>IPV6_FAILURE_FATAL=no             # 是不开启IPV6致命错误检测：否<br>IPV6_ADDR_GEN_MODE=stable-privacy       # IPV6地址生成模型：stable-privacy <br>NAME=ens33                  # 网卡物理设备名称<br>UUID=42773503-99ed-443f-a957-66dbc1258347   # 通用唯一识别码<br>DEVICE=ens33                 # 网卡设备名称<br>ONBOOT=no                   # 是否开机启动， 可用systemctl restart network重启网络<br></code></pre></div></td></tr></table></figure><p>修改<code>ONBOOT=yes</code>并添加<code>DNS1=127.0.0.1</code>，此<code>DNS</code>地址设置为本机的<code>DNS</code>地址。 </p><p><img src="image-20210702152401623.png"></p><p>输入<code>ESC</code>，<code>:wq!</code>退出。</p><p>最后，输入 <code>systemctl restart network</code> 重启网络，没有提示任何信息，则表示网络重启成功。</p><p><img src="image-20210702152300781.png"></p><p>测试<code>ping</code>百度<a href="https://www.baidu.com/"><code>www.baidu.com</code></a>可以访问。</p><p><img src="image-20210702152616087.png"></p><h2 id="主机名配置"><a href="#主机名配置" class="headerlink" title="主机名配置"></a>主机名配置</h2><p>为了更改或设置<code>CentOS 7</code>计算机主机名称，请使用<code>hostnamectl</code>命令，如下面的命令摘录所示。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> hostnamectl set-hostname your-new-hostname</span><br></code></pre></div></td></tr></table></figure><p>除<code>hostname</code>命令外，还可以使用<code>hostnamectl</code>命令显示<code>Linux</code>机器主机名。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> hostnamectl</span><br></code></pre></div></td></tr></table></figure><p>为了应用新的主机名，需要重启系统，请执行以下命令之一来重新启动<code>CentOS 7</code>机器。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> init 6</span><br><span class="hljs-meta">#</span><span class="bash"> systemctl reboot</span><br><span class="hljs-meta">#</span><span class="bash"> shutdown -r</span><br></code></pre></div></td></tr></table></figure><p>第二种设置<code>CentOS 7</code>机器主机名的方法是手动编辑<code>/ etc/hostname</code>文件并输入新的主机名。另外，为了应用新的机器名称，系统重新启动是必要的。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> vi /etc/hostname</span><br></code></pre></div></td></tr></table></figure><h2 id="修改IP地址"><a href="#修改IP地址" class="headerlink" title="修改IP地址"></a>修改<code>IP</code>地址</h2><p>在配置文件里修改为如下：</p><p><img src="image-20210702155511437.png"></p><p><code>IP</code>地址设置为<code>192.168.1.3</code>。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vmware</tag>
      
      <tag>linux</tag>
      
      <tag>centos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VMware虚拟机的三种网络模式</title>
    <link href="/2021/07/02/VMware%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E4%B8%89%E7%A7%8D%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F/"/>
    <url>/2021/07/02/VMware%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E4%B8%89%E7%A7%8D%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p><code>VMware虚拟机</code>有三种网络模式，分别是<code>Bridged(桥接模式)</code>、<code>NAT(网络地址转换模式)</code>、<code>Host-only(主机模式)</code>。</p><p><code>VMware workstation</code>安装好之后会多出两个网络连接，分别是<code>VMware Network Adapter VMnet1</code>和<code>VMware Network Adapter VMnet8</code>，在工具栏点击编辑-虚拟网络编辑器中可以查看虚拟机的网络配置。</p><p><img src="image-20210702095744388.png"></p><p><img src="image-20210702095903167.png"></p><p>还有一个是<code>VMnet0</code>，可以在<code>virtual network editor</code>中看到，点击以管理员权限更改设置，切换桥接模式才会显示<code>VMnet0</code>。这三个虚拟网络都是<code>VMware</code>安装好之后自动生成的，不需要手动修改。其中<code>VMnet0</code>用于<code>Bridged模式</code>，<code>VMnet1</code>用于<code>Host-only模式</code>，<code>Vmnet8</code>用于<code>NAT模式</code>。<code>VMnet8</code>和<code>VMnet1</code>提供<code>DHCP服务</code>，<code>VMnet0</code>默认则不提供。</p><p><img src="image-20210702100312824.png"></p><h2 id="1、Bridged（桥接模式）"><a href="#1、Bridged（桥接模式）" class="headerlink" title="1、Bridged（桥接模式）"></a>1、Bridged（桥接模式）</h2><p>在这种模式下，<code>VMWare</code>虚拟出来的操作系统就像是局域网中的一台独立的主机，它可以访问网内任何一台机器，你需要手工为虚拟系统配置<code>IP地址</code>、<code>子网掩码</code>，而且还要和<em>宿主机器处于同一网段</em>，这样虚拟系统才能和宿主机器进行通信，虚拟系统和宿主机器的关系，就像连接在同一个<code>Hub</code>上的两台电脑。从网络技术上理解相当于在宿主机前端加设了一个虚拟交换机，然后宿主机和所有虚拟机共享这个交换机。</p><p>如果你想利用<code>VMWare</code>在局域网内新建一个虚拟服务器，为局域网用户提供网络服务，就应该选择桥接模式。</p><h3 id="1-1、桥接模式的设置"><a href="#1-1、桥接模式的设置" class="headerlink" title="1.1、桥接模式的设置"></a>1.1、桥接模式的设置</h3><p>设置环境：虚拟软件<code>VMware workstation 16 pro</code>，虚拟机系统<code>windows 7</code>旗舰版，主机系统<code>windows 10</code>。</p><ol><li>检查本地网络连接中属性的<code>VMware Bridge Protocol（VMware桥接协议）</code>选项是否勾选，默认安装好虚拟机后自动勾选。</li></ol><p><img src="image-20210702104459670.png"></p><ol start="2"><li>将虚拟机网络适配器设置为<code>VMnet0</code>特定的虚拟网络，在虚拟网络编辑器中<code>VMnet</code>信息选择为<code>桥接模式</code>，并选中本地要桥接的网卡。</li></ol><p><img src="image-20210702104833834.png"></p><p><img src="image-20210702110219951.png"></p><ol start="3"><li>主机系统中打开<code>cmd</code>命令输入<code>ipconfig</code>查看本地网卡<code>IP</code>。</li></ol><p><img src="image-20210702105146467.png"></p><ol start="4"><li>在虚拟机系统中将<code>IP</code>地址修改为和主机同一网段，默认网关和主机一致，这里设置为<code>192.168.124.86</code>。</li></ol><p><img src="image-20210702105614668.png"></p><ol start="5"><li>在主机中<code>ping</code>虚拟机的<code>IP</code>，可以访问，同理从虚拟机<code>ping</code>主机<code>IP</code>也能连通。</li></ol><p><img src="image-20210702110628450.png"></p><p>如果配置好<code>DNS</code>的话，虚拟机也可以访问外网。</p><h2 id="2、NAT（网络地址转换模式）"><a href="#2、NAT（网络地址转换模式）" class="headerlink" title="2、NAT（网络地址转换模式）"></a>2、NAT（网络地址转换模式）</h2><p>使用<code>NAT模式</code>，就是让虚拟系统借助<code>NAT</code>的功能，通过宿主机所在的网络来访问公网。在这种模式下宿主机成为双网卡主机，同时参与现有的宿主局域网和新建的虚拟局域网，但由于加设了一个虚拟的<code>NAT</code>服务器，使得虚拟局域网内的虚拟机在对外访问时，使用的则是宿主机的<code>IP</code>地址，这样从外部网络来看，只能看到宿主机，完全看不到新建的虚拟局域网。</p><p>采用<code>NAT</code>模式最大的优势是虚拟系统接入互联网非常简单，你不需要进行任何其他的配置，只需要宿主机器能访问互联网即可。</p><h3 id="2-1、NAT模式的设置"><a href="#2-1、NAT模式的设置" class="headerlink" title="2.1、NAT模式的设置"></a>2.1、NAT模式的设置</h3><ol><li>检查主机的<code>VWware DHCP Service</code>和<code>VMwareNAT Service</code>两个服务是否启动，安装后默认是启动的。</li></ol><p>右键点击计算机-管理-服务和应用程序。</p><p><img src="image-20210702124226277.png" alt="image-20210702124226277"></p><ol start="2"><li><code>NAT</code>模式用到的就是<code>VMnet8</code>网卡，在虚拟机中网络适配器设置为特定虚拟网络<code>VMnet8模式</code>。</li></ol><p><img src="image-20210702124536928.png"></p><p>在虚拟网络编辑器设置如下：</p><p><img src="image-20210702124838755.png"></p><ol start="3"><li>将虚拟机的网卡设置为自动获得<code>IP</code>地址</li></ol><p><img src="image-20210702125122459.png"></p><p>这样虚拟机也能和主机一样正常的访问外部网络了。</p><h2 id="3、Host-only-主机模式"><a href="#3、Host-only-主机模式" class="headerlink" title="3、Host-only(主机模式)"></a>3、Host-only(主机模式)</h2><p>在某些特殊的网络调试环境中，要求将真实环境和虚拟环境隔离开，这时你就可采用host-only模式，在这种模式下宿主机上的所有虚拟机是可以相互通信的，但虚拟机和真实的网络是被隔离开的。</p><p>在这种模式下新建了一个由所有虚拟机与宿主机所构成的局域网，但该局域网与宿主机本身所处的现有局域网是相互独立的，如果不做额外路由设置，这两个局域网之间不会连通，因此新建的局域网可以认为是一个单独从属于当前宿主机的私有网络，其成员为当前宿主机和相关的所有虚拟机。</p><p>在<code>Host-Only</code>模式下，虚拟网络是一个全封闭的网络，它唯一能够访问的就是主机。其实<code>Host-Only</code>网络和NAT网络很相似，不同的地方就是 <code>Host-Only</code>网络没有NAT服务，所以虚拟网络不能连接到<code>Internet</code>。主机和虚拟机之间的通信是通过<code>VMware Network Adepter VMnet1</code>虚拟网卡来实现的。此时如果想要虚拟机上外网则需要主机联网并且网络共享。</p><h3 id="3-1、Host-only模式下的网络设置"><a href="#3-1、Host-only模式下的网络设置" class="headerlink" title="3.1、Host-only模式下的网络设置"></a>3.1、Host-only模式下的网络设置</h3><ol><li>虚拟机设置-网络适配器设置为<code>VMnet1(仅主机模式)</code></li></ol><p><img src="image-20210702141928625.png"></p><ol start="2"><li>虚拟机网络编辑器中，设置使用本地<code>DHCP</code>的子网<code>IP</code>地址。</li></ol><p><img src="image-20210702143412248.png"></p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vmware</tag>
      
      <tag>虚拟机</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VMwareTools灰显无法安装的问题</title>
    <link href="/2021/07/01/VMwareTools%E7%81%B0%E6%98%BE%E6%97%A0%E6%B3%95%E5%AE%89%E8%A3%85%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <url>/2021/07/01/VMwareTools%E7%81%B0%E6%98%BE%E6%97%A0%E6%B3%95%E5%AE%89%E8%A3%85%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>在<code>windows</code>平台下安装虚拟机后，<code>VMware Tools</code>灰显无法安装的问题。</p><p><img src="image-20210701161329116.png"></p><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>首先，关闭虚拟机。</p><p>选中当前虚拟机，右击设置。</p><p><img src="image-20210701161703905.png"></p><p>在<code>CD/DVD2(SATA)</code>光盘映像文件中选择安安装目录下的<code>windows.iso</code>文件。默认的安装路径一般为<code>C:\Program Files (x86)\VMware\VMware Workstation\windows.iso</code>。</p><p><img src="image-20210701161828628.png"></p><p>然后，开启虚拟机。打开计算机可以看到<code>DVD</code>驱动器加载就是<code>VMware Tools</code>安装镜像。</p><p><img src="image-20210701162319168.png"></p><p>点开后双击运行<code>setip64.exe</code>安装。</p><p><img src="image-20210701162500194.png"></p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vmware</tag>
      
      <tag>虚拟机</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>图像处理pillow库</title>
    <link href="/2021/06/30/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86pillow%E5%BA%93/"/>
    <url>/2021/06/30/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86pillow%E5%BA%93/</url>
    
    <content type="html"><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>Install Pillow with <strong>pip</strong>:</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">python3 -m pip install --upgrade pip<br>python3 -m pip install --upgrade Pillow<br></code></pre></div></td></tr></table></figure><h2 id="教程"><a href="#教程" class="headerlink" title="教程"></a>教程</h2><h3 id="使用图像类"><a href="#使用图像类" class="headerlink" title="使用图像类"></a>使用图像类</h3><p>导入图像类，使用<code>open()</code>函数打开图片。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><br>im = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;D:/images/my.jpg&quot;</span>)<br><span class="hljs-built_in">print</span>(im)<br><span class="hljs-comment"># &lt;PIL.PngImagePlugin.PngImageFile image mode=RGB size=3300x3300 at 0x199B5C860D0&gt;</span><br></code></pre></div></td></tr></table></figure><p><code>Image.open()</code>会返回一个<code>Image</code>对象。</p><ul><li><code>format</code> : 识别图像的源格式，如果该文件不是从文件中读取的，则被置为 None 值。</li><li><code>size</code> : 返回的一个元组，有两个元素，其值为象素意义上的宽和高。</li><li><code>mode</code> : <code>RGB（true color image）</code>，此外还有，<code>L（luminance）</code>，<code>CMTK（pre-press image）</code>。</li></ul><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(im.<span class="hljs-built_in">format</span>, im.size, im.mode)<br><span class="hljs-comment"># PNG (3300, 3300) RGB</span><br></code></pre></div></td></tr></table></figure><p>显示加载的图像，使用<code>image.show()</code>方法，回调用系统的默认工具打开图像，如果没有图像工具会提示报错。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">im.show()<br></code></pre></div></td></tr></table></figure><h3 id="读写图像"><a href="#读写图像" class="headerlink" title="读写图像"></a>读写图像</h3><p><code>Image</code>库支持几乎所有的图像格式，直接使用<code>open</code>函数打开文件即可，程序会自动探测文件的格式。</p><p>要保存图像到文件，使用<code>Image</code>类中的<code>save()</code>方法。</p><h4 id="转图像到JPG"><a href="#转图像到JPG" class="headerlink" title="转图像到JPG"></a>转图像到JPG</h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><br><span class="hljs-keyword">for</span> infile <span class="hljs-keyword">in</span> sys.argv[<span class="hljs-number">1</span>:]:<br>    f, e = os.path.splitext(infile)<br>    outfile = f + <span class="hljs-string">&quot;.jpg&quot;</span><br>    <span class="hljs-keyword">if</span> infile != outfile:<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">with</span> Image.<span class="hljs-built_in">open</span>(infile) <span class="hljs-keyword">as</span> im:<br>                im.save(outfile)<br>        <span class="hljs-keyword">except</span> OSError:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;cannot convert&quot;</span>, infile)<br></code></pre></div></td></tr></table></figure><p>上面的代码实现了把任意格式的图像文件转成<code>JPG</code>格式，并保存到文件所在的同一目录下。</p><h4 id="创建缩约图"><a href="#创建缩约图" class="headerlink" title="创建缩约图"></a>创建缩约图</h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os, sys<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><br>size = (<span class="hljs-number">128</span>, <span class="hljs-number">128</span>)<br><br><span class="hljs-keyword">for</span> infile <span class="hljs-keyword">in</span> sys.argv[<span class="hljs-number">1</span>:]:<br>    outfile = os.path.splitext(infile)[<span class="hljs-number">0</span>] + <span class="hljs-string">&quot;.thumbnail&quot;</span><br>    <span class="hljs-keyword">if</span> infile != outfile:<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">with</span> Image.<span class="hljs-built_in">open</span>(infile) <span class="hljs-keyword">as</span> im:<br>                im.thumbnail(size)<br>                im.save(outfile, <span class="hljs-string">&quot;JPEG&quot;</span>)<br>        <span class="hljs-keyword">except</span> OSError:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;cannot create thumbnail for&quot;</span>, infile)<br></code></pre></div></td></tr></table></figure><p>这里面的<code>size</code>元组定义了图像的大小。</p><h3 id="切割图像"><a href="#切割图像" class="headerlink" title="切割图像"></a>切割图像</h3><figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><br>im = Image.<span class="hljs-keyword">open</span>(&quot;D:/images/default.png&quot;)<br>im.<span class="hljs-keyword">show</span>()<br><span class="hljs-type">box</span> = (<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">400</span>, <span class="hljs-number">400</span>)<br>region = im.crop(<span class="hljs-type">box</span>)<br>region.<span class="hljs-keyword">show</span>()<br></code></pre></div></td></tr></table></figure><p>区域由 4 个坐标定义，坐标位于（左、上、右、下）。Python 成像库使用左上角有 （0， 0） 的坐标系统。另请注意，坐标是指像素之间的位置，因此上述示例中的区域正好为 <code>300x300</code> 像素。‎</p><h4 id="调整图像大小"><a href="#调整图像大小" class="headerlink" title="调整图像大小"></a>调整图像大小</h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-comment"># 载入图像</span><br>image = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;D:/images/default.png&quot;</span>)<br><span class="hljs-comment"># 调整大小</span><br>new_image = image.resize((<span class="hljs-number">400</span>, <span class="hljs-number">400</span>))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;原图像的大小:&quot;</span>, image.size)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;新图像的大小:&quot;</span>, new_image.size)<br><br><span class="hljs-comment"># 原图像的大小: (4096, 2305)</span><br><span class="hljs-comment"># 新图像的大小: (400, 400)</span><br></code></pre></div></td></tr></table></figure><p><code>image.resize</code>接收一个元组。</p><h2 id="图像滤波"><a href="#图像滤波" class="headerlink" title="图像滤波"></a>图像滤波</h2><p>导入图片和库文件。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image, ImageFilter<br>im = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;D:/images/my.jpg&quot;</span>)<br></code></pre></div></td></tr></table></figure><h4 id="BLUR：模糊滤波"><a href="#BLUR：模糊滤波" class="headerlink" title="BLUR：模糊滤波"></a>BLUR：模糊滤波</h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 模糊滤波</span><br>bluF = im.<span class="hljs-built_in">filter</span>(ImageFilter.BLUR)<br>bluF.show()<br></code></pre></div></td></tr></table></figure><h4 id="CONTOUR：轮廓滤波"><a href="#CONTOUR：轮廓滤波" class="headerlink" title="CONTOUR：轮廓滤波"></a>CONTOUR：轮廓滤波</h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 轮廓滤波</span><br>conF = im.<span class="hljs-built_in">filter</span>(ImageFilter.CONTOUR)<br>conF.show()<br></code></pre></div></td></tr></table></figure><p><img src="image-20210630172021291.png" alt="image-20210630172021291"></p><h4 id="DETAIL：细节滤波"><a href="#DETAIL：细节滤波" class="headerlink" title="DETAIL：细节滤波"></a>DETAIL：细节滤波</h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 细节滤波</span><br>detF = im.<span class="hljs-built_in">filter</span>(ImageFilter.DETAIL)<br>detF.show()<br></code></pre></div></td></tr></table></figure><h4 id="EDGE-ENHANCE：边界增强滤波"><a href="#EDGE-ENHANCE：边界增强滤波" class="headerlink" title="EDGE_ENHANCE：边界增强滤波"></a>EDGE_ENHANCE：边界增强滤波</h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 边界增强滤波</span><br>eeF = im.<span class="hljs-built_in">filter</span>(ImageFilter.EDGE_ENHANCE)<br>eeF.show()<br></code></pre></div></td></tr></table></figure><h4 id="EMBOSS：浮雕滤波"><a href="#EMBOSS：浮雕滤波" class="headerlink" title="EMBOSS：浮雕滤波"></a>EMBOSS：浮雕滤波</h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 浮雕滤波</span><br>embF = im.<span class="hljs-built_in">filter</span>(ImageFilter.EMBOSS)<br>embF.show()<br></code></pre></div></td></tr></table></figure><p><img src="image-20210630172930687.png" alt="image-20210630172930687"></p><h4 id="FIND-EDGES：寻找边界滤波（找寻图像的边界信息）"><a href="#FIND-EDGES：寻找边界滤波（找寻图像的边界信息）" class="headerlink" title="FIND_EDGES：寻找边界滤波（找寻图像的边界信息）"></a>FIND_EDGES：寻找边界滤波（找寻图像的边界信息）</h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 寻找边界滤波（找寻图像的边界信息）</span><br>fdeF = im.<span class="hljs-built_in">filter</span>(ImageFilter.FIND_EDGES)<br>fdeF.show()<br></code></pre></div></td></tr></table></figure><p><img src="image-20210630173055303.png" alt="image-20210630173055303"></p><h4 id="SMOOTH：平滑滤波"><a href="#SMOOTH：平滑滤波" class="headerlink" title="SMOOTH：平滑滤波"></a>SMOOTH：平滑滤波</h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 平滑滤波</span><br>smoF = im.<span class="hljs-built_in">filter</span>(ImageFilter.SMOOTH)<br>smoF.show()<br></code></pre></div></td></tr></table></figure><h4 id="SMOOTH-MORE：深度平滑滤波"><a href="#SMOOTH-MORE：深度平滑滤波" class="headerlink" title="SMOOTH_MORE：深度平滑滤波"></a>SMOOTH_MORE：深度平滑滤波</h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 深度平滑滤波</span><br>smomF = im.<span class="hljs-built_in">filter</span>(ImageFilter.SMOOTH_MORE)<br>smomF.show()<br></code></pre></div></td></tr></table></figure><h4 id="SHARPEN：锐化滤波"><a href="#SHARPEN：锐化滤波" class="headerlink" title="SHARPEN：锐化滤波"></a>SHARPEN：锐化滤波</h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 锐化滤波</span><br>shaF = im.<span class="hljs-built_in">filter</span>(ImageFilter.SHARPEN)<br>shaF.show()<br></code></pre></div></td></tr></table></figure><h4 id="GaussianBlur：高斯模糊"><a href="#GaussianBlur：高斯模糊" class="headerlink" title="GaussianBlur：高斯模糊"></a>GaussianBlur：高斯模糊</h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 高斯模糊</span><br>gbF = im.<span class="hljs-built_in">filter</span>(ImageFilter.GaussianBlur(radius=<span class="hljs-number">10</span>))<br>gbF.show()<br></code></pre></div></td></tr></table></figure><p><img src="image-20210630173451367.png" alt="image-20210630173451367"></p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Python库</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>pillow</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OS模块</title>
    <link href="/2021/06/28/OS%E6%A8%A1%E5%9D%97/"/>
    <url>/2021/06/28/OS%E6%A8%A1%E5%9D%97/</url>
    
    <content type="html"><![CDATA[<p><code>os</code> 模块提供了很多允许你的程序与操作系统直接交互的功能。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">得到当前工作目录，即当前Python脚本工作的目录路径: os.getcwd()<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.getcwd()<br><span class="hljs-string">&#x27;D:\\PythonProjs\\python模块\\os模块&#x27;</span><br><br>返回指定目录下的所有文件和目录名:os.listdir()，返回列表<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.listdir() <br>[<span class="hljs-string">&#x27;os中常用的值和路径介绍.py&#x27;</span>]<br><br>函数用来删除一个文件:os.remove()<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.remove(<span class="hljs-string">&quot;a.txt&quot;</span>) <span class="hljs-comment"># 没有提示</span><br><br>删除多个目录：os.removedirs（r“c：\python”）<br><br>检验给出的路径是否是一个文件：os.path.isfile()<br><br>检验给出的路径是否是一个目录：os.path.isdir()<br><br>判断是否是绝对路径：os.path.isabs()<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.isabs(<span class="hljs-string">&quot;/&quot;</span>) <br><span class="hljs-literal">True</span><br><br>检验给出的路径是否真地存:os.path.exists()<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.exists(<span class="hljs-string">&quot;/&quot;</span>) <br><span class="hljs-literal">True</span><br><br>返回一个路径的目录名和文件名:os.path.split()    <br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.split(<span class="hljs-string">&quot;D:/tfsServer.rar&quot;</span>) <br>(<span class="hljs-string">&#x27;D:/&#x27;</span>, <span class="hljs-string">&#x27;tfsServer.rar&#x27;</span>)<br><br>分离扩展名：os.path.splitext()<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.splitext(<span class="hljs-string">&#x27;D:/tfsServer.rar&#x27;</span>) <br>(<span class="hljs-string">&#x27;D:/tfsServer&#x27;</span>, <span class="hljs-string">&#x27;.rar&#x27;</span>)<br><br>获取路径名：os.path.dirname()<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.dirname(<span class="hljs-string">&#x27;D:/tfsServer.rar&#x27;</span>)  <br><span class="hljs-string">&#x27;D:/&#x27;</span><br><br>获得绝对路径: os.path.abspath()<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.abspath(<span class="hljs-string">&#x27;D:/tfsServer.rar&#x27;</span>) <br><span class="hljs-string">&#x27;D:\\tfsServer.rar&#x27;</span><br><br>获取文件名：os.path.basename()<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.basename(<span class="hljs-string">&#x27;D:/tfsServer.rar&#x27;</span>) <br><span class="hljs-string">&#x27;tfsServer.rar&#x27;</span><br><br>运行shell命令: os.system()<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.system(<span class="hljs-string">&quot;dir&quot;</span>) <br><br>读取操作系统环境变量HOME的值:os.getenv(<span class="hljs-string">&quot;HOME&quot;</span>) <br><span class="hljs-meta">&gt;&gt;&gt; </span>os.getenv(<span class="hljs-string">&quot;PATH&quot;</span>) <br><br>返回操作系统所有的环境变量： os.environ <br><span class="hljs-meta">&gt;&gt;&gt; </span>os.environ<br><br>设置系统环境变量，仅程序运行时有效：os.environ.setdefault(<span class="hljs-string">&#x27;HOME&#x27;</span>,<span class="hljs-string">&#x27;/home/alex&#x27;</span>)<br>给出当前平台使用的行终止符:os.linesep    Windows使用<span class="hljs-string">&#x27;\r\n&#x27;</span>，Linux <span class="hljs-keyword">and</span> MAC使用<span class="hljs-string">&#x27;\n&#x27;</span><br>指示你正在使用的平台：os.name       对于Windows，它是<span class="hljs-string">&#x27;nt&#x27;</span>，而对于Linux/Unix用户，它是<span class="hljs-string">&#x27;posix&#x27;</span><br>重命名：os.rename（old， new）<br>创建多级目录：os.makedirs（r“c：\python\test”）<br>创建单个目录：os.mkdir（“test”）<br>获取文件属性：os.stat（file）<br>修改文件权限与时间戳：os.chmod（file）<br>获取文件大小：os.path.getsize（filename）<br>结合目录名与文件名：os.path.join(<span class="hljs-built_in">dir</span>,filename)<br>改变工作目录到dirname: os.chdir(dirname)<br>获取当前终端的大小: os.get_terminal_size()<br>杀死进程: os.kill(<span class="hljs-number">10884</span>,signal.SIGKILL)<br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Python模块</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>os</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>闭包和装饰器</title>
    <link href="/2021/06/28/%E9%97%AD%E5%8C%85%E5%92%8C%E8%A3%85%E9%A5%B0%E5%99%A8/"/>
    <url>/2021/06/28/%E9%97%AD%E5%8C%85%E5%92%8C%E8%A3%85%E9%A5%B0%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h2><p>什么是闭包？</p><blockquote><p>参考[闭包是什么东西](<a href="https://book.apeland.cn/details/51/">路飞学城-学习文档 (apeland.cn)</a>)</p></blockquote><p>关于闭包，即函数定义和函数表达式位于另一个函数的函数体内(嵌套函数)。而且，这些内部函数可以访问它们所在的外部函数中声明的所有局部变量、参数。当其中一个这样的内部函数在包含它们的外部函数之外被调用时，就会形成闭包。也就是说，内部函数会在外部函数返回后被执行。而当这个内部函数执行时，它仍然必需访问其外部函数的局部变量、参数以及其他内部函数。这些局部变量、参数和函数声明（最初时）的值是外部函数返回时的值，但也会受到内部函数的影响。</p><p>也就<strong>函数内包含子函数，最后<code>return</code>子函数</strong>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 定义一个外币函数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">outer_func</span>():</span><br>    name = <span class="hljs-string">&quot;holy&quot;</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">inner_func</span>():</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;打印外层函数里的变量&quot;</span>, name)<br><br>    <span class="hljs-keyword">return</span> inner_func   <span class="hljs-comment"># 这里返回inner_func的内存地址，并不是执行</span><br><br>f = outer_func()<br>f() <span class="hljs-comment"># 执行inner_func</span><br></code></pre></div></td></tr></table></figure><p>闭包的意义：<strong>返回的函数对象，不仅仅是一个函数对象，在该函数外还包裹了一层作用域，这使得，该函数无论在何处调用，优先使用自己外层包裹的作用域</strong></p><h2 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h2><p>[老王的奇技淫巧](<a href="https://book.apeland.cn/details/52/">路飞学城-学习文档 (apeland.cn)</a>)</p><p>你是一家视频网站的后端开发工程师，你们网站有以下几个版块。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;---首页----&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">america</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----欧美专区----&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">japan</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----日韩专区----&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">henan</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----河南专区----&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>视频刚上线初期，为了吸引用户，你们采取了免费政策，所有视频免费观看，迅速吸引了一大批用户，免费一段时间后，每天巨大的带宽费用公司承受不了了，所以准备对比较受欢迎的几个版块收费，其中包括“欧美” 和 “河南”专区，你拿到这个需求后，想了想，想收费得先让其进行用户认证，认证通过后，再判定这个用户是否是VIP付费会员就可以了，是VIP就让看，不是VIP就不让看就行了呗。 你觉得这个需求很是简单，因为要对多个版块进行认证，那应该把认证功能提取出来单独写个模块，然后每个版块里调用 就可以了，与是你轻轻的就实现了下面的功能 。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">account = &#123;<br>    <span class="hljs-string">&quot;is_authenticated&quot;</span>:<span class="hljs-literal">False</span>,<span class="hljs-comment"># 用户登录了就把这个改成True</span><br>    <span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;alex&quot;</span>, <span class="hljs-comment"># 假装这是DB里存的用户信息</span><br>    <span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;abc123&quot;</span> <span class="hljs-comment"># 假装这是DB里存的用户信息</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span>():</span><br>    <span class="hljs-keyword">if</span> account[<span class="hljs-string">&quot;is_authenticated&quot;</span>] <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>:<br>        username = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;user:&quot;</span>)<br>        password = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;pasword:&quot;</span>)<br>        <span class="hljs-keyword">if</span> username == account[<span class="hljs-string">&quot;username&quot;</span>] <span class="hljs-keyword">and</span> password == account[<span class="hljs-string">&quot;password&quot;</span>]:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;welcome login....&quot;</span>)<br>            account[<span class="hljs-string">&quot;is_authenticated&quot;</span>] = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;wrong username or password!&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;用户已登录，验证通过...&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;---首页----&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">america</span>():</span><br>    login()  <span class="hljs-comment"># 执行前加上验证</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----欧美专区----&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">japan</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----日韩专区----&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">henan</span>():</span><br>    login()  <span class="hljs-comment"># 执行前加上验证</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----河南专区----&quot;</span>)<br>home()<br>america()<br>henan()<br></code></pre></div></td></tr></table></figure><p>此时你信心满满的把这个代码提交给你的TEAM LEADER审核，没成想，没过5分钟，代码就被打回来了， TEAM LEADER给你反馈是，我现在有很多模块需要加认证模块，你的代码虽然实现了功能，但是需要更改要加认证的各个模块的源代码，这直接违反了软件开发中的一个原则“开放-封闭”原则，简单来说，它规定已经实现的功能代码不应该被修改，但可以被扩展，即：</p><ul><li>封闭：已实现的功能代码块不应该被修改</li><li>开放：对现有功能的扩展开放</li></ul><p>这个原则你还是第一次听说，我擦，再次感受了自己这个野生程序员与正规军的差距，BUT ANYWAY,老大要求的这个怎么实现呢？如何在不改原有功能代码的情况下加上认证功能呢？你一时想不出思路，只好带着这个问题回家继续憋，媳妇不在家，去隔壁老王家串门了，你正好落的清静，一不小心就想到了解决方案，不改源代码可以呀。 你师从沙河金角大王时，记得他教过你，高阶函数，就是把一个函数当做一个参数传给另外一个函数，当时大王说，有一天，你会用到它的，没想到这时这个知识点突然从脑子 里蹦出来了，我只需要写个认证方法，每次调用 需要验证的功能 时，直接 把这个功能 的函数名当做一个参数 传给 我的验证模块不就行了么，哈哈，机智如我，如是你啪啪啪改写了之前的代码。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">account = &#123;<br>    <span class="hljs-string">&quot;is_authenticated&quot;</span>:<span class="hljs-literal">False</span>,<span class="hljs-comment"># 用户登录了就把这个改成True</span><br>    <span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;alex&quot;</span>, <span class="hljs-comment"># 假装这是DB里存的用户信息</span><br>    <span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;abc123&quot;</span> <span class="hljs-comment"># 假装这是DB里存的用户信息</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span>(<span class="hljs-params">func</span>):</span><br>    <span class="hljs-keyword">if</span> account[<span class="hljs-string">&quot;is_authenticated&quot;</span>] <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>:<br>        username = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;user:&quot;</span>)<br>        password = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;pasword:&quot;</span>)<br>        <span class="hljs-keyword">if</span> username == account[<span class="hljs-string">&quot;username&quot;</span>] <span class="hljs-keyword">and</span> password == account[<span class="hljs-string">&quot;password&quot;</span>]:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;welcome login....&quot;</span>)<br>            account[<span class="hljs-string">&quot;is_authenticated&quot;</span>] = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;wrong username or password!&quot;</span>)<br>    <span class="hljs-keyword">if</span> account[<span class="hljs-string">&quot;is_authenticated&quot;</span>] <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span>:  <span class="hljs-comment"># 主要改了这</span><br>        func() <span class="hljs-comment"># 认证成功了就执行传入进来的函数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;---首页----&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">america</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----欧美专区----&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">japan</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----日韩专区----&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">henan</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----河南专区----&quot;</span>)<br>home()<br>login(america) <span class="hljs-comment"># 需要验证就调用 login，把需要验证的功能 当做一个参数传给login</span><br>login(henan)<br></code></pre></div></td></tr></table></figure><p>你很开心，终于实现了老板的要求，不改变原功能代码的前提下，给功能加上了验证，此时，媳妇回来了，后面还跟着老王，你两家关系 非常 好，老王经常来串门，老王也是码农，你跟他分享了你写的代码，兴奋的等他看完 夸奖你NB,没成想，老王看后，并没有夸你，抱起你的儿子，笑笑说，你这个代码还是改改吧， 要不然会被开除的，WHAT? 会开除，明明实现了功能 呀， 老王讲，没错，你功能 是实现了，但是你又犯了一个大忌，什么大忌？ 你改变了调用方式呀， 想一想，现在没每个需要认证的模块，都必须调用你的login()方法，并把自己的函数名传给你，人家之前可不是这么调用 的， 试想，如果 有100个模块需要认证，那这100个模块都得更改调用方式，这么多模块肯定不止是一个人写的，让每个人再去修改调用方式 才能加上认证，你会被骂死的。。。。 你觉得老王说的对，但问题是，如何即不改变原功能代码，又不改变原有调用方式，还能加上认证呢？ 你苦思了一会，还是想不出，老王在逗你的儿子玩，你说，老王呀，快给我点思路 ，实在想不出来，老王背对着你问，</p><p>老王：学过匿名函数没有？</p><p>你：学过学过，就是lambda嘛</p><p>老王：那lambda与正常函数的区别是什么？</p><p>你：最直接的区别是，正常函数定义时需要写名字，但lambda不需要</p><p>老王：没错，那lambda定好后，为了多次调用 ，可否也给它命个名？</p><p>你：可以呀，可以写成plus = lambda x:x+1类似这样，以后再调用plus就可以了，但这样不就失去了lambda的意义了，明明人家叫匿名函数呀，你起了名字有什么用呢？</p><p>老王：我不是要跟你讨论它的意义 ，我想通过这个让你明白一个事实</p><p>老王边说着，边拿起你儿子的画板，在上面写了以下代码：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plus</span>(<span class="hljs-params">n</span>):</span><br>    <span class="hljs-keyword">return</span> n+<span class="hljs-number">1</span><br>plus2 = <span class="hljs-keyword">lambda</span> x:x+<span class="hljs-number">1</span><br></code></pre></div></td></tr></table></figure><p>老王： 上面这两种写法是不是代表 同样的意思？</p><p>你：是的</p><p>老王：我给lambda x:x+1 起了个名字叫plus2，是不是相当于def plus2(x) ?</p><p>你：我擦，你别说，还真是，但老王呀，你想说明什么呢？</p><p>老王： 没啥，只想告诉你，给函数赋值变量名就像def func_name　是一样的效果，如下面的plus(n)函数，你调用时可以用plus名，还可以再起个其它名字，如</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">calc = plus<br>calc(n)<br></code></pre></div></td></tr></table></figure><p>你明白我想传达什么意思了么？ 你：。。。。。。。。。。。这。。。。。。嗯 。。。。。不太。。。。明白 。。</p><p>老王：。。。。这。。。。。呵呵。。。。。。好吧。。。。，那我在给你点一下，你之前写的下面这段调用 认证的代码</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">home()<br>login(america) <span class="hljs-comment">#需要验证就调用 login，把需要验证的功能 当做一个参数传给login</span><br><span class="hljs-comment"># home()</span><br><span class="hljs-comment"># america()</span><br>login(henan)<br></code></pre></div></td></tr></table></figure><p>老王：你之所以改变了调用方式，是因为用户每次调用时需要执行login(henan)，类似的。其实稍一改就可以了呀</p><figure class="highlight isbl"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">home</span>()</span><br><span class="hljs-variable">america</span> = <span class="hljs-function"><span class="hljs-title">login</span>(<span class="hljs-variable">america</span>)</span><br><span class="hljs-variable">henan</span> = <span class="hljs-function"><span class="hljs-title">login</span>(<span class="hljs-variable">henan</span>)</span><br></code></pre></div></td></tr></table></figure><p>老王：这样以后其它人调用henan时，其实相当于调用了login(henan), 通过login里的验证后，就会自动调用henan功能。</p><p>你：我擦，还真是唉。。。，老王，还是你nb。。。不过，等等， 我这样写了好，那用户调用时，应该是下面这个样子</p><figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">home</span><span class="hljs-params">()</span></span><br>america = login(america) #你在这里相当于把america这个函数替换了<br>henan = login(henan)<br>#那用户调用时依然写<br><span class="hljs-function"><span class="hljs-title">america</span><span class="hljs-params">()</span></span><br></code></pre></div></td></tr></table></figure><p>但问题在于，还不等用户调用 ，你的america = login(america)就会先自己把america执行了呀。。。。，你应该等我用户调用 的时候 再执行才对呀，不信我试给你看。。。</p><p>老王：哈哈，你说的没错，这样搞会出现这个问题，但你想想有没有解决办法 呢？</p><p>你：我擦，你指的思路呀，大哥。。。我哪知道下一步怎么走。。。</p><p>老王：算了，估计你也想不出来。。。 学过嵌套函数没有？</p><p>你：yes,然后呢？</p><p>老王：想实现一开始你写的america = login(america)不触发你真正的america函数的执行，只需要在这个login里面再定义一层函数，第一次调用america = login(america)只调用到外层login，这个login虽然会执行，但不会触发认证了，因为认证的所有代码被封装在login里层的新定义 的函数里了，login只返回 里层函数的函数名，这样下次再执行america()时， 就会调用里层函数啦。。。</p><p>你：。。。。。。什么？ 什么个意思，我蒙逼了。。。</p><p>老王：还是给你看代码吧。。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><br>account = &#123;<br>    <span class="hljs-string">&quot;is_authenticated&quot;</span>:<span class="hljs-literal">False</span>,<span class="hljs-comment"># 用户登录了就把这个改成True</span><br>    <span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;alex&quot;</span>, <span class="hljs-comment"># 假装这是DB里存的用户信息</span><br>    <span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;abc123&quot;</span> <span class="hljs-comment"># 假装这是DB里存的用户信息</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span>(<span class="hljs-params">func</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">inner</span>():</span> <span class="hljs-comment"># 再定义一层函数</span><br>        <span class="hljs-keyword">if</span> account[<span class="hljs-string">&quot;is_authenticated&quot;</span>] <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>:<br>            username = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;user:&quot;</span>)<br>            password = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;pasword:&quot;</span>)<br>            <span class="hljs-keyword">if</span> username == account[<span class="hljs-string">&quot;username&quot;</span>] <span class="hljs-keyword">and</span> password == account[<span class="hljs-string">&quot;password&quot;</span>]:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;welcome login....&quot;</span>)<br>                account[<span class="hljs-string">&quot;is_authenticated&quot;</span>] = <span class="hljs-literal">True</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;wrong username or password!&quot;</span>)<br>        <span class="hljs-keyword">if</span> account[<span class="hljs-string">&quot;is_authenticated&quot;</span>] <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span>:<br>            func()<br>    <span class="hljs-keyword">return</span> inner  <span class="hljs-comment"># 注意这里只返回inner的内存地址，不执行</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;---首页----&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">america</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----欧美专区----&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">japan</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----日韩专区----&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">henan</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----河南专区----&quot;</span>)<br>home()<br>america = login(america) <span class="hljs-comment"># 这次执行login返回的是inner的内存地址 .inner at 0x101762840&gt;</span><br>henan = login(henan)  <span class="hljs-comment"># .inner at 0x102562840&gt;</span><br>america()  <span class="hljs-comment"># 相当于执行inner()</span><br>henan()<br><br></code></pre></div></td></tr></table></figure><p>此时你仔细着了老王写的代码　，感觉老王真不是一般人呀，连这种奇淫巧技都能想出来。。。，心中默默感谢上天赐你一个大牛邻居。</p><p>你: 老王呀，你这个姿势很nb呀，你独创的？ 此时你媳妇噗嗤的笑出声来，你也不知道 她笑个球。。。</p><p>老王：呵呵， 这不是我独创的呀当然 ，这是开发中一个常用的玩法，叫语法糖，官方名称“装饰器”，其实上面的写法，还可以更简单 可以把下面代码去掉</p><figure class="highlight ini"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">america</span> = login(america) <span class="hljs-comment"># 这次执行login返回的是inner的内存地址</span><br><span class="hljs-attr">henan</span> = login(henan)  <span class="hljs-comment"># .inner at 0x102562840&gt;</span><br></code></pre></div></td></tr></table></figure><p>只在你要装饰的函数上面加上下面代码</p><figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@login</span><br>def america():<br>    print(<span class="hljs-string">&quot;----欧美专区----&quot;</span>)<br>def japan():<br>    print(<span class="hljs-string">&quot;----日韩专区----&quot;</span>)<br><span class="hljs-variable">@login</span><br>def henan():<br>    print(<span class="hljs-string">&quot;----河南专区----&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>效果是一样的。</p><p>你开心的玩着老王教你的新姿势 ，玩着玩着就手贱给你的“河南专区”版块 加了个参数，然后，结果 出错了。。</p><p><img src="/image_el9ASyG.png" alt="img"></p><p>你：老王，老王，怎么传个参数就不行了呢？</p><p>老王：那必然呀，你调用henan时，其实是相当于调用的login，你的henan第一次调用时henan = login(henan)， login就返回了inner的内存地址，第2次用户自己调用henan(5),实际上相当于调用的是inner,但你的inner定义时并没有设置参数，但你给他传了个参数，所以自然就报错了呀</p><p>你：但是我的 版块需要传参数呀，你不让我传不行呀。。。</p><p>老王：没说不让你传，稍做改动便可。。</p><p><img src="/image_LkpLnXE.png" alt="img"></p><p>老王：你再试试就好了 。</p><p>你： 果然好使，大神就是大神呀。 。。 不过，如果有多个参数呢？</p><p>老王：。。。。老弟，你不要什么都让我教你吧，非固定参数你没学过么？ *args,**kwargs…</p><p>你：噢 。。。还能这么搞?,nb,我再试试。 你身陷这种新玩法中无法自拔，竟没注意到老王已经离开，你媳妇告诉你说为了不打扰你加班，今晚带孩子去跟她姐妹住 ，你觉得媳妇真体贴，最终，你终于搞定了所有需求，完全遵循开放-封闭原则，最终代码如下。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">account = &#123;<br>    <span class="hljs-string">&quot;is_authenticated&quot;</span>:<span class="hljs-literal">False</span>,<span class="hljs-comment"># 用户登录了就把这个改成True</span><br>    <span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;alex&quot;</span>, <span class="hljs-comment"># 假装这是DB里存的用户信息</span><br>    <span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;abc123&quot;</span> <span class="hljs-comment"># 假装这是DB里存的用户信息</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span>(<span class="hljs-params">func</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">inner</span>(<span class="hljs-params">*args,**kwargs</span>):</span> <span class="hljs-comment"># 再定义一层函数</span><br>        <span class="hljs-keyword">if</span> account[<span class="hljs-string">&quot;is_authenticated&quot;</span>] <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>:<br>            username = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;user:&quot;</span>)<br>            password = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;pasword:&quot;</span>)<br>            <span class="hljs-keyword">if</span> username == account[<span class="hljs-string">&quot;username&quot;</span>] <span class="hljs-keyword">and</span> password == account[<span class="hljs-string">&quot;password&quot;</span>]:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;welcome login....&quot;</span>)<br>                account[<span class="hljs-string">&quot;is_authenticated&quot;</span>] = <span class="hljs-literal">True</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;wrong username or password!&quot;</span>)<br>        <span class="hljs-keyword">if</span> account[<span class="hljs-string">&quot;is_authenticated&quot;</span>] <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span>:<br>            func(*args,**kwargs)<br>    <span class="hljs-keyword">return</span> inner  <span class="hljs-comment"># 注意这里只返回inner的内存地址，不执行</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;---首页----&quot;</span>)<br><span class="hljs-meta">@login</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">america</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----欧美专区----&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">japan</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----日韩专区----&quot;</span>)<br><span class="hljs-meta">@login</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">henan</span>(<span class="hljs-params">vip_level</span>):</span><br>    <span class="hljs-keyword">if</span> vip_level &lt; <span class="hljs-number">3</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----河南专区普通会员----&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;欢迎来到尊贵河南口音RMB玩家私密社区&quot;</span>.center(<span class="hljs-number">50</span>,<span class="hljs-string">&quot;-&quot;</span>))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;再充值500就可以获取演员微信号，幸福大门即将开启&quot;</span>.center(<span class="hljs-number">50</span>,<span class="hljs-string">&quot; &quot;</span>))<br><span class="hljs-comment"># home()</span><br><span class="hljs-comment"># america = login(america) # 这次执行login返回的是inner的内存地址 .inner at 0x101762840&gt;</span><br><span class="hljs-comment"># henan = login(henan)  # .inner at 0x102562840&gt;</span><br>america()  <span class="hljs-comment"># 相当于执行inner()</span><br>henan(<span class="hljs-number">5</span>)<br></code></pre></div></td></tr></table></figure><p>此时，你已累的不行了，洗洗就抓紧睡了，半夜，上厕所，隐隐听到隔壁老王家有微弱的女人的声音传来，你会心一笑，老王这家伙，不声不响找了女朋友也不带给我看看，改天一定要见下真人。。。。。你本想着给媳妇打个电话问问她到了闺蜜家没有，想着想着竟然睡着了。。。</p><p>翌日，你精神抖擞到了公司，把代码扔给leader, leader看完后，会心一笑，小伙子不错，这才是专业的写法嘛。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django入门-表单处理</title>
    <link href="/2021/06/25/Django%E5%85%A5%E9%97%A8-%E8%A1%A8%E5%8D%95%E5%A4%84%E7%90%86/"/>
    <url>/2021/06/25/Django%E5%85%A5%E9%97%A8-%E8%A1%A8%E5%8D%95%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p><code>Forms(表单)</code>用来处理我们的输入。这在任何<code>web</code>应用或者网站中都有很常见的任务。标准的做法通过<code>HTML</code>表单实现，用户输入一些数据，提交给服务器，然后服务器处理它。</p><p><code>Django Forms API</code> 使整个过程变的更加简单，从而实现了大量工作的自动化。而且，最终的结果比大多数程序员自己去实现的代码更加安全。所以，不管 <code>HTML</code> 的表单多么简单，总是使用<code>Form API</code>。</p><h2 id="手动实现一个表单"><a href="#手动实现一个表单" class="headerlink" title="手动实现一个表单"></a>手动实现一个表单</h2><p>首先，创建一个新的<code>URL</code>路由，命名为<code>new_topic</code>：</p><p><strong>boards/urls.py</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pyth">from django.urls import path, re_path<br>from . import views<br><br>urlpatterns = [<br>    path(&#x27;&#x27;, views.home, name=&#x27;home&#x27;),<br>    re_path(r&#x27;^boards/(?P&lt;pk&gt;\d+)/$&#x27;, views.board_topics, name=&#x27;board_topics&#x27;),<br>    re_path(r&#x27;^boards/(?P&lt;pk&gt;\d+)/new/$&#x27;, views.new_topic, name=&#x27;now_topics&#x27;),<br>]<br></code></pre></div></td></tr></table></figure><p>创建<code>new_topic</code>的视图函数：</p><p><strong>boards/views.py</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render, get_object_or_404<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Board<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home</span>(<span class="hljs-params">request</span>):</span><br>    boards = Board.objects.<span class="hljs-built_in">all</span>()<br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;home.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;boards&#x27;</span>: boards&#125;)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">board_topics</span>(<span class="hljs-params">request, pk</span>):</span><br>    board = Board.objects.get(pk=pk)<br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;topics.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;boards&#x27;</span>: board&#125;)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new_topic</span>(<span class="hljs-params">request, pk</span>):</span><br>    board = get_object_or_404(Board, pk=pk)<br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;new_topics.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;board&#x27;</span>: board&#125;)<br></code></pre></div></td></tr></table></figure><p>接下来命名一个名为<code>new_topic.html</code>的模板：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;% extends <span class="hljs-string">&#x27;base.html&#x27;</span> %&#125;<br><br>&#123;% block title %&#125;Start a new Topic&#123;% endblock %&#125;<br><br>&#123;% block breadcrumb %&#125;<br>&lt;li <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">breadcrumb</span>-<span class="hljs-title">item</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;&#123;% <span class="hljs-title">url</span> &#x27;<span class="hljs-title">home</span>&#x27; %&#125;&quot;&gt;<span class="hljs-title">Boards</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">breadcrumb</span>-<span class="hljs-title">item</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;&#123;% <span class="hljs-title">url</span> &#x27;<span class="hljs-title">board_topics</span>&#x27; <span class="hljs-title">board</span>.<span class="hljs-title">pk</span> %&#125;&quot;&gt;&#123;&#123; <span class="hljs-title">board</span>.<span class="hljs-title">name</span> &#125;&#125;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">breadcrumb</span>-<span class="hljs-title">item</span> <span class="hljs-title">active</span>&quot;&gt;<span class="hljs-title">New</span> <span class="hljs-title">topic</span>&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">&#123;% <span class="hljs-title">endblock</span> %&#125;</span><br><span class="hljs-class"></span><br><span class="hljs-class">&#123;% <span class="hljs-title">block</span> <span class="hljs-title">content</span> %&#125;</span><br><span class="hljs-class"></span><br><span class="hljs-class">&#123;% <span class="hljs-title">endblock</span> %&#125;</span><br></code></pre></div></td></tr></table></figure><p>接下来，创建表单：</p><p><strong>new_topic.html</strong></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">&#123;% extends &#x27;base.html&#x27; %&#125;<br><br>&#123;% block title %&#125;Start a new Topic&#123;% endblock %&#125;<br><br>&#123;% block breadcrumb %&#125;<br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb-item&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;% url &#x27;home&#x27; %&#125;&quot;</span>&gt;</span>Boards<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb-item&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;% url &#x27;board_topics&#x27; board.pk %&#125;&quot;</span>&gt;</span>&#123;&#123; board.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb-item active&quot;</span>&gt;</span>New topic<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>&#123;% endblock %&#125;<br><br>&#123;% block content %&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>        &#123;% csrf_token %&#125;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_subject&quot;</span>&gt;</span>Subject<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id_subject&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;subject&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;id_message&quot;</span>&gt;</span>Message<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;id_message&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;message&quot;</span> <span class="hljs-attr">rows</span>=<span class="hljs-string">&quot;5&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-success&quot;</span>&gt;</span>Post<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>&#123;% endblock %&#125;<br></code></pre></div></td></tr></table></figure><p><img src="image-20210625174259256.png" alt="image-20210625174259256"></p><p>在<code>&lt;form&gt;</code>标签中，我们定义了<code>method</code>属性。它会告诉浏览器我们想如何与浏览器通信。<code>HTTP</code>规范定义了几种<code>request methods</code>(请求方法)。大部分情况下，只需要使用<code>GET</code>和<code>POST</code>两种<code>requests</code>（请求）类型。</p><p><code>GET</code>是最常见的请求类型。它用于从服务器请求数据。每当你点击了一个链接或者直接在浏览器中输入了一个网址，你就创建了一个<code>GET</code>请求。</p><p><code>POST</code>用于当我们想更改服务器上的数据的时候，一般来说，每次我们发送数据给服务器都会导致资源状态的变化。</p><p><code>Django</code>使用<code>CSPF Token</code>(Cross-Site Request Forgery Token)<code>保护所有的</code>POST<code>请求。这是避免外部站点或者应用程序向我们的应用程序提交数据的安全措施。应用程序每次接受一个POST时，都先检查</code>CSPF Token`。如果这个request没有token，或者这个token是无效的，它会抛弃提交的数据。</p><p><code>CSPF Token</code>的模板标签：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;% csrf_token %&#125;<br></code></pre></div></td></tr></table></figure><p>它是与其他表单数据一起提交的隐藏字段。</p><p>另外，我们需要设置HTML输入<code>name</code>，<code>name</code>将被用来在服务器获取数据。</p><p>下面示范我们如何检索数据：</p><figure class="highlight py"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs py">subject = reqeust.POST[<span class="hljs-string">&#x27;subject&#x27;</span>]<br>message = reqeust.POST[<span class="hljs-string">&#x27;message&#x27;</span>]<br></code></pre></div></td></tr></table></figure><p>从HTML获取数据并且开始一个型的<code>topic</code>视图的简单实现如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pyth"><br></code></pre></div></td></tr></table></figure><p>这里发生了一些问题，先回头再深入学习下ORM模型。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django入门-复用模板</title>
    <link href="/2021/06/25/Django%E5%85%A5%E9%97%A8-%E5%A4%8D%E7%94%A8%E6%A8%A1%E6%9D%BF/"/>
    <url>/2021/06/25/Django%E5%85%A5%E9%97%A8-%E5%A4%8D%E7%94%A8%E6%A8%A1%E6%9D%BF/</url>
    
    <content type="html"><![CDATA[<p>在<code>templates</code>文件夹中创建一个名为<code>base.html</code>的文件：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">&#123;% load static %&#125;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>&#123;% block title %&#125;Django Boards&#123;% endblock %&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;% static &#x27;css/bootstrap.min.css&#x27; %&#125;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb my-4&quot;</span>&gt;</span><br>                &#123;% block breadcrumb %&#125;<br>                &#123;% endblock %&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span><br>            &#123;% block content %&#125;<br>            &#123;% endblock %&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>把这个作为母版页，我们每个创建的模板都<code>extend</code>（继承）这个特殊的模板。<code>&#123;% block %&#125;</code>标签用于在模板中间保留一个空间，一个”字”模板（继承这个母版页的模板）可以在这个空间中插入代码和HTML。</p><p>在<code>&#123;% block title %&#125;</code>中设置了一个默认值”<code>Django Boards</code>“，如果在其他模板中未设置<code>&#123;% block title %&#125;</code>的值就会使用这个默认值。</p><p>接下来重写下这两个模板：<code>home.html</code>和<code>topics.html</code>。</p><p><strong>home.html</strong></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">&#123;% extends &#x27;base.html&#x27; %&#125;<br>&#123;% block breadcrumb %&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb-item active&quot;</span>&gt;</span>Boards<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>&#123;% endblock %&#125;<br><br>&#123;% block content %&#125;<br><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;table&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">thead</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;thead-inverse&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Board<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Posts<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Topics<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Last Post<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span><br>        &#123;% for board in boards %&#125;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;%url &#x27;board_topics&#x27; board.pk%&#125;&quot;</span>&gt;</span>&#123;&#123; board.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-muted d-block&quot;</span>&gt;</span>&#123;&#123;board.description&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    &#123;% endfor %&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br>&#123;% endblock %&#125;<br></code></pre></div></td></tr></table></figure><p><strong>topics.html</strong></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">&#123;% extends &#x27;base.html&#x27; %&#125;<br>&#123;% block title %&#125;<br>    &#123;&#123; board.name &#125;&#125; - &#123;&#123; block.super &#125;&#125;<br>&#123;% endblock %&#125;<br>&#123;% block breadcrumb %&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb-item&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;% url &#x27;home&#x27; &amp;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb-item active&quot;</span>&gt;</span>&#123;&#123; boards.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>&#123;% endblock %&#125;<br><br>&#123;% block content %&#125;<br><br>&#123;% endblock %&#125;<br></code></pre></div></td></tr></table></figure><p>有了<code>base.html</code>模板，现在可以很方便的添加一个菜单快：</p><p><strong>templates/base.html</strong></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">&#123;% load static %&#125;<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>&#123;% block title %&#125;Django Boards&#123;% endblock %&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;% static &#x27;css/bootstrap.min.css&#x27; %&#125;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar navbar-expand navbar-dark bg-dark&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar-brand&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;% url &#x27;home&#x27; %&#125;&quot;</span>&gt;</span>Django Borads<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb my-4&quot;</span>&gt;</span><br>                &#123;% block breadcrumb %&#125;<br>                &#123;% endblock %&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span><br>            &#123;% block content %&#125;<br>            &#123;% endblock %&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>效果如下：</p><p><img src="image-20210625160119695.png" alt="image-20210625160119695"></p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>验证码的处理</title>
    <link href="/2021/06/25/%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9A%84%E5%A4%84%E7%90%86/"/>
    <url>/2021/06/25/%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9A%84%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="1-图片验证码"><a href="#1-图片验证码" class="headerlink" title="1.图片验证码"></a>1.图片验证码</h1><h2 id="1-1-验证码和作用"><a href="#1-1-验证码和作用" class="headerlink" title="1.1 验证码和作用"></a>1.1 验证码和作用</h2><p>验证码（<code>CAPTCHA</code>）是<code>“Completely Automated Public Turing test to tell Computers and Humans Apart”</code>（全自动区分计算机和人类的图灵测试）的缩写，是一种区分用户是计算机还是人的公共全自动程序。可以防止：恶意破解密码、刷票、论坛灌水，有效防止某个黑客对某一个特定注册用户用特定程序暴力破解方式进行不断的登陆尝试，实际上用验证码是现在很多网站通行的方式，我们利用比较简易的方式实现了这个功能。这个问题可以由计算机生成并评判，但是必须只有人类才能解答。由于计算机无法解答<code>CAPTCHA</code>的问题，所以回答出问题的用户就可以被认为是人类。</p><h2 id="1-2-图片验证码在爬虫中的使用场景"><a href="#1-2-图片验证码在爬虫中的使用场景" class="headerlink" title="1.2 图片验证码在爬虫中的使用场景"></a>1.2 图片验证码在爬虫中的使用场景</h2><ul><li>注册</li><li>登录</li><li>频繁发送请求时，服务器弹出验证码进行验证</li></ul><p>1.3 图片验证码的处理方案</p><ul><li>手动输入（input）这种方法仅限于登录一次就可以持续使用的情况</li><li>图像识别引擎解析，使用光学识别引擎处理图片中的数据，目前通常用于图片数据提取，缺少用于验证码处理</li><li><strong>打码平台，爬虫常用的验证码方案</strong></li></ul><h1 id="2-图片识别引擎"><a href="#2-图片识别引擎" class="headerlink" title="2.图片识别引擎"></a>2.图片识别引擎</h1><p><code>OCR（Optical Character Recognition）</code>是指使用<a href="https://baike.baidu.com/item/%E6%89%AB%E6%8F%8F%E4%BB%AA">扫描仪</a>或<a href="https://baike.baidu.com/item/%E6%95%B0%E7%A0%81%E7%9B%B8%E6%9C%BA">数码相机</a>对文本资料进行<a href="https://baike.baidu.com/item/%E6%89%AB%E6%8F%8F">扫描</a>成图像文件，然后对图像文件进行分析处理，自动识别获取文字信息及版面信息的软件。</p><h2 id="2-1什么是tesseract"><a href="#2-1什么是tesseract" class="headerlink" title="2.1什么是tesseract"></a>2.1什么是<code>tesseract</code></h2><ul><li><code>Tesseract</code>，一款由<code>HP</code>实验室开发由<code>Google</code>维护的开源<code>OCR</code>引擎，特点是开源、免费、支持多语言，多平台。</li><li>项目地址：<a href="https://github.com/tesseract-ocr/tesseract/">https://github.com/tesseract-ocr/tesseract/</a></li></ul><h3 id="2-2图片识别引擎环境的安装"><a href="#2-2图片识别引擎环境的安装" class="headerlink" title="2.2图片识别引擎环境的安装"></a>2.2图片识别引擎环境的安装</h3><ol><li><p>引擎的安装</p><ul><li>Mac环境直接执行命令</li></ul><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">brew install --with-training-tools tesseract<br></code></pre></div></td></tr></table></figure><ul><li>Linux环境下的安装</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs she">sudo apt-get install tesseract-ocr<br></code></pre></div></td></tr></table></figure><ul><li>Window环境下的安装通过<code>exe</code>安装包安装，下载地址在<code>Github</code>项目中的<code>wiki</code>中找到。</li></ul><p>安装包也可以在这个网址获取<a href="https://digi.bib.uni-mannheim.de/tesseract/">Index of /tesseract (uni-mannheim.de)</a>。</p></li><li><p>Python库的安装</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pytho"># PIL库安装<br>pip install pillow<br><br># pytesseract模块用于从图片解析数据<br>pip install pytesseract<br></code></pre></div></td></tr></table></figure><p>安装完成之后，需要在<code>lib\pytesseract</code>中添加安装的<code>tesseract</code>路径。也要把<code>tesseract</code>的安装路径放到系统环境变量中。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">tesseract_cmd = <span class="hljs-string">r&#x27;C:\Program Files\Tesseract-OCR\tesseract.exe&#x27;</span><br></code></pre></div></td></tr></table></figure><p>2.3 图片识别引擎的使用</p><ul><li>通过<code>pytesseract</code>模块的<code>image_to_string</code>方法能将打开的图片文件中的数据转成字符串数据，具体方法如下：</li></ul><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">import</span> pytesseract<br><br>im = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;1.png&quot;</span>)<br><br>result = pytesseract.image_to_string(im)<br><br><span class="hljs-built_in">print</span>(result)<br><br></code></pre></div></td></tr></table></figure><p><img src="1.png" alt="1.png"></p><p>输出结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pytho">This is some text, written in Arial, that will be read by<br>Tesseract. Here are some symbols: !|@#$%*&amp;&quot;()<br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>爬虫</tag>
      
      <tag>验证码</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>常见的反爬手段和解决思路</title>
    <link href="/2021/06/23/%E5%B8%B8%E8%A7%81%E7%9A%84%E5%8F%8D%E7%88%AC%E6%89%8B%E6%AE%B5%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF/"/>
    <url>/2021/06/23/%E5%B8%B8%E8%A7%81%E7%9A%84%E5%8F%8D%E7%88%AC%E6%89%8B%E6%AE%B5%E5%92%8C%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF/</url>
    
    <content type="html"><![CDATA[<h2 id="服务器反爬的原因"><a href="#服务器反爬的原因" class="headerlink" title="服务器反爬的原因"></a>服务器反爬的原因</h2><ul><li><p>爬虫占总<code>PV</code>（<code>PV</code>指页面的访问次数）的比例高，浪费资源。</p></li><li><p>公司可免费查询资源被批量抓走，丧失竞争力。</p></li><li><p>状告爬虫成功的机率小</p></li></ul><h2 id="服务器常反什么样的爬虫"><a href="#服务器常反什么样的爬虫" class="headerlink" title="服务器常反什么样的爬虫"></a>服务器常反什么样的爬虫</h2><ul><li><p>十分低级的应届生</p></li><li><p>十分低级的创业小公司</p></li><li><p>不小心写错了没人去停止的失控小爬虫</p></li><li><p>成型的商业对手</p></li><li><p>抽风的搜索引擎</p></li></ul><h2 id="反爬领域常见的一些概念"><a href="#反爬领域常见的一些概念" class="headerlink" title="反爬领域常见的一些概念"></a>反爬领域常见的一些概念</h2><ul><li><p>爬虫：使用任何技术手段，批量获取网站信息的一种方式，关键在于批量</p></li><li><p>反爬虫：使用任何技术手段，阻止别人批量获取自己网站信息的一种方式。关键也是批量。</p></li><li><p>误伤：在反爬虫的过程中，错误的将普通用户识别为爬虫。</p></li><li><p>拦截：成功地阻止爬虫访问。</p></li><li><p>资源：机器成本和人力成本的总和。</p></li></ul><h2 id="反爬的三个方向"><a href="#反爬的三个方向" class="headerlink" title="反爬的三个方向"></a>反爬的三个方向</h2><ul><li><p>基于身份识别进行反爬</p></li><li><p>基于爬虫行为进行反爬</p></li><li><p>基于数据加密进行反爬</p></li></ul><h2 id="常见基于身份识别进行反爬"><a href="#常见基于身份识别进行反爬" class="headerlink" title="常见基于身份识别进行反爬"></a>常见基于身份识别进行反爬</h2><h3 id="通过headers字段来反爬"><a href="#通过headers字段来反爬" class="headerlink" title="通过headers字段来反爬"></a>通过<code>headers</code>字段来反爬</h3><ol><li>通过<code>headers</code>字段中的<code>user-agent</code>进行反爬</li></ol><ul><li>反爬原理：默认的爬虫没有<code>user-agent</code></li><li>解决办法：请求之前添加<code>user-agent</code>即可；最好是使用<code>user-agent</code>池来解决</li></ul><ol start="2"><li>通过<code>refer</code>字段或其他字段来反爬</li></ol><ul><li>反爬原理：爬虫默认情况下是不会携带<code>refer</code>字段的，服务器通过判断请求发起的源头，以此判断请求是否合法</li><li>解决方法：添加<code>refer</code>字段</li></ul><ol start="3"><li>通过<code>cookie</code>来反爬</li></ol><ul><li>反爬原因：通过检查<code>cookie</code>来查看发起请求的用户是否具备相应权限</li><li>解决方案：进行模拟登录，成功获取<code>cookies</code>之后进行数据爬取</li></ul><h3 id="通过请求参数来反爬"><a href="#通过请求参数来反爬" class="headerlink" title="通过请求参数来反爬"></a>通过请求参数来反爬</h3><ol><li>通过<code>html</code>静态文件中获取请求数据（<code>GitHub</code>登录数据）</li></ol><ul><li>反爬原理：通过增加获取请求参数的难度进行反爬</li><li>解决方案：仔细分析抓包得到的每一个包，搞清楚请求之间的联系</li></ul><ol start="2"><li>通过发送请求获取请求数据</li></ol><ul><li>反爬原因：通过增加获取请求参数的难度进行反爬</li><li>解决方案：仔细分析抓包得到的每一个包，搞清楚请求之间的联系，搞清楚请求参数的来源</li></ul><ol start="3"><li>通过<code>js</code>生成请求参数</li></ol><ul><li>反爬原理：<code>js</code>生成请求参数</li><li>解决方法：分析<code>js</code>,观察加密的实现过程，通过<code>js2py</code>获取<code>js</code>的执行结果，或者使用<code>selenium</code>实现</li></ul><ol start="4"><li>通过验证码来反爬</li></ol><ul><li>反爬原理：对方服务器通过弹出验证码强制用户浏览行为</li><li>解决方法：打码平台或者是机器学习的方法识别验证码，其中打码平台廉价易用，更值得推荐</li></ul><h2 id="常见基于爬虫行为进行反爬"><a href="#常见基于爬虫行为进行反爬" class="headerlink" title="常见基于爬虫行为进行反爬"></a>常见基于爬虫行为进行反爬</h2><h3 id="基于请求频率或总请求数量"><a href="#基于请求频率或总请求数量" class="headerlink" title="基于请求频率或总请求数量"></a>基于请求频率或总请求数量</h3><ol><li>通过请求<code>Ip</code>/账号单位时间内总请求的数量进行反爬</li></ol><ul><li>反爬原理：正常浏览器请求网站速度不会太快，同一个<code>ip</code>或者账号大量请求了对方服务器有更大的可能性会被识别为爬虫。</li><li>解决方法：对应的通过购买高质量的<code>ip</code>的方式能够解决这个问题，或者购买多个账号。</li></ul><ol start="2"><li>通过同一<code>ip</code>或者账号请求之间的间隔进行反爬</li></ol><ul><li>反爬原理：正常人操作浏览器浏览网站请求之间的时间间隔是随机的，而爬虫前后两个请求之间时间间隔通常比较固定同时间隔时间比较短，因此可以用来做反爬。</li><li>解决方法：请求之间进行随机等待，模拟真实用户操作。在添加时间间隔之后，为了能够高速获取数据尽量使用代理池，如果是账号，则将账号请求之间设置随机休眠。</li></ul><ol start="3"><li>通过对请求<code>ip</code>或者账号每天请求次数设置阀值进行反pa。</li></ol><ul><li>反爬原理：正常的浏览行为，其一天的请求次数是有限的，通常超过某一个值，服务器就会拒绝响应。</li><li>解决方法：硬的，通过购买高质量的<code>ip</code>的方法，或者购买多个账号。同时设置请求间的随机休眠。</li></ul><h3 id="根据爬虫行为进行反爬，通常在爬虫步骤上分析"><a href="#根据爬虫行为进行反爬，通常在爬虫步骤上分析" class="headerlink" title="根据爬虫行为进行反爬，通常在爬虫步骤上分析"></a>根据爬虫行为进行反爬，通常在爬虫步骤上分析</h3><ol><li>通过<code>js</code>实现跳转来反爬</li></ol><ul><li>反爬原理：<code>js</code>实现页面跳转，无法在源码中获取下一页<code>url</code>。</li><li>解决方法：多次抓包获取条状<code>url</code>，分析规律。</li></ul><ol start="2"><li>通过陷阱获取爬虫<code>IP</code>，进行反爬</li></ol><ul><li>反爬原理：在爬虫获取链接的请求中，爬虫会根据正则表达式，<code>xpath</code>，<code>css</code>等方式进行后续链接的提取，此时服务器端可以设置一个陷阱<code>URL</code>，会被提取规则获取，但是正常用户无法获取，这样能有效区分爬虫和正常用户。</li><li>解决方法：完成爬虫的编写后，使用代理批量爬取测试/仔细分析响应内容结构，找出页面中存在的陷阱。</li></ul><ol start="3"><li>通过假数据反爬</li></ol><ul><li>反爬原理：向返回的响应中添加假数据和污染数据库，通常假数据不会被正常用户看到。</li><li>解决方法：长期运行，核对数据库同实际页面中数据对应情况，如果存在问题仔细分析响应内容。</li></ul><ol start="4"><li>阻塞任务队列</li></ol><ul><li>反爬原理：通过生成大量的垃圾URL，从而阻塞任务队列，降低爬虫的实际工作效率</li><li>解决方法：观察运行过程中请求响应状态仔细分析源码获取垃圾URL生成规则，对URL进行过滤</li></ul><ol start="5"><li>阻塞网络I/O</li></ol><ul><li>反爬原理：发送请求获取响应的过程实际上就是下载的过程，在任务队列中混入一个大文件的URL，当爬虫在进行请求时将会占用网络IO，如果是多线程会占用线程</li><li>解决方法：观察运行过程中请求响应状态/多线程对请求线程计时/发送请求线</li></ul><ol start="6"><li>运维平台审计</li></ol><ul><li>反爬原理：通过运维平台进行综合管理，通常采用复合型反爬虫策略，多种手段同时使用</li><li>解决方案：仔细观察分析，长期运行测试目标网站，检查数据采集速度，多方面处理</li></ul><h3 id="基于数据加密进行反爬"><a href="#基于数据加密进行反爬" class="headerlink" title="基于数据加密进行反爬"></a>基于数据加密进行反爬</h3><ol><li>对响应中含有的数据进行特殊化处理</li></ol><p>通常的特殊化处理主要就是<code>css</code>数据偏移/自定义字体/数据加密/数据图片/特殊编码格式等。</p><ul><li>通过自定义字体来反爬<ul><li>反爬思路：使用自有字体文件</li><li>解决思路：切换到手机版/解析字体文件进行翻译</li></ul></li></ul><p>比如猫眼电影 电脑版：</p><p><img src="1.png"></p><ul><li>通过<code>css</code>来反爬<ul><li>反爬思路：使用自有字体文件</li><li>解决思路：切换到手机版/解析字体文件进行翻译</li></ul></li></ul><p>比如去哪儿网 电脑版：</p><p><img src="image-20210625133143368.png" alt="image-20210625133143368"></p><ul><li><p>反爬思路：源数据不为正真数据，需要通过<code>css</code>位移才能产生真正数据</p></li><li><p>解决思路：计算<code>css</code>的偏移</p></li><li><p>通过<code>js</code>动态生成数据进行反爬</p><ul><li>反爬原理：通过<code>js</code>动态生成</li><li>解决思路：解析关键<code>js</code>，获得数据生成流程，模拟生成数据</li></ul></li><li><p>通过数据化图片进行反爬</p><ul><li>58同城短租</li><li>解决思路：通过使用图片解析引擎从图片中解析数据</li></ul></li><li><p>通过编码格式进行反爬</p><ul><li>反爬原理：不适用默认编码格式，在获取响应之后通常爬虫使用<code>utf-8</code>格式进行解码，此时解码结果将会是乱码或者报错</li><li>反爬原理：根据源码进行多格式解析</li></ul></li></ul><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>爬虫</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用selenium对斗鱼直播下手</title>
    <link href="/2021/06/23/%E4%BD%BF%E7%94%A8selenium%E5%AF%B9%E6%96%97%E9%B1%BC%E7%9B%B4%E6%92%AD%E4%B8%8B%E6%89%8B/"/>
    <url>/2021/06/23/%E4%BD%BF%E7%94%A8selenium%E5%AF%B9%E6%96%97%E9%B1%BC%E7%9B%B4%E6%92%AD%E4%B8%8B%E6%89%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>获取斗鱼直播页面中，全部直播房间的房间信息。包括房间号，房间名称，房间标题，观看人数和直播预览图。</p><p><img src="1.png"></p><h2 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Douyu</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-comment"># 实例化配置对象</span><br>        self.options = webdriver.ChromeOptions()<br>        self.options.add_argument(<span class="hljs-string">&#x27;--user-agent=Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36 Edg/91.0.864.54&#x27;</span>)<br>        self.url = <span class="hljs-string">&#x27;https://www.douyu.com/directory/all&#x27;</span><br>        self.driver = webdriver.Chrome(<span class="hljs-string">&#x27;D:/tools/chromedriver&#x27;</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_data</span>(<span class="hljs-params">self</span>):</span><br>        room_list = self.driver.find_elements_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;listAll&quot;]/section[2]/div[2]/ul/li/div&#x27;</span>)<br>        <span class="hljs-comment"># print(len(room_list)) #120</span><br>        <span class="hljs-comment"># 遍历房间列表，继续查找信息</span><br>        data_list = []<br>        <span class="hljs-keyword">for</span> room <span class="hljs-keyword">in</span> room_list:<br>            temp = &#123;&#125;<br>            temp[<span class="hljs-string">&#x27;title&#x27;</span>] = room.find_element_by_xpath(<span class="hljs-string">&#x27;./a/div[2]/div[1]/h3&#x27;</span>).text<br>            temp[<span class="hljs-string">&#x27;type&#x27;</span>] = room.find_element_by_xpath(<span class="hljs-string">&#x27;./a/div[2]/div[1]/span&#x27;</span>).text<br>            temp[<span class="hljs-string">&#x27;owner&#x27;</span>] = room.find_element_by_xpath(<span class="hljs-string">&#x27;./a/div[2]/div[2]/h2/div&#x27;</span>).text<br>            temp[<span class="hljs-string">&#x27;num&#x27;</span>] = room.find_element_by_xpath(<span class="hljs-string">&#x27;./a/div[2]/div[2]/span&#x27;</span>).text<br>            temp[<span class="hljs-string">&#x27;img_src&#x27;</span>] = room.find_element_by_xpath(<span class="hljs-string">&#x27;./a/div[1]/div[1]/img&#x27;</span>).get_attribute(<span class="hljs-string">&quot;src&quot;</span>)<br>            data_list.append(temp)<br>        <span class="hljs-keyword">return</span> data_list<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_data</span>(<span class="hljs-params">self, data_list</span>):</span><br>        <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> data_list:<br>            <span class="hljs-built_in">print</span>(data)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-comment"># url</span><br>        <span class="hljs-comment"># driver</span><br>        <span class="hljs-comment"># get</span><br>        self.driver.get(self.url)<br>        time.sleep(<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(self.driver.find_element_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;listAll&quot;]/section[2]/div[2]/div/ul/li[9]&#x27;</span>).get_attribute(<span class="hljs-string">&quot;aria-disabled&quot;</span>))<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            <span class="hljs-comment"># parse</span><br>            data_list = self.parse_data()<br>            <span class="hljs-comment"># save</span><br>            self.save_data(data_list)<br>            <span class="hljs-comment"># next</span><br>            <span class="hljs-keyword">if</span> self.driver.find_element_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;listAll&quot;]/section[2]/div[2]/div/ul/li[9]&#x27;</span>).get_attribute(<span class="hljs-string">&quot;aria-disabled&quot;</span>) == <span class="hljs-string">&quot;false&quot;</span>:<br>                <span class="hljs-comment"># 模拟人为下拉</span><br>                self.driver.execute_script(<span class="hljs-string">&#x27;scrollTo(0,10000)&#x27;</span>)<br>                self.driver.find_element_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;listAll&quot;]/section[2]/div[2]/div/ul/li[9]&#x27;</span>).click()<br>                time.sleep(<span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-comment"># close</span><br>                self.driver.quit()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    douyu = Douyu()<br>    douyu.run()<br></code></pre></div></td></tr></table></figure><p>结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;（长沙）唱歌跳舞主播求关注&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;周小米Angel&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;9.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/live-cover/roomCover/2021/03/10/7162561fddf51730b911ab668e13a7a3_big.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【PUBG SHOW】职业组&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;绝地求生赛事3&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;308.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/3939156_1606.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;女野王连胜冲天梯第一~~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;辜婉婉&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;44.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/4766727_1611.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;祝睡懵的小七5周年快乐！！！！！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;音乐&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;灵魂刀神&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;101.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;直播间等你暴击×5&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;睡懵的渣皇&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;212万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/live-cover/appCovers/2020/07/27/8922441_20200727190717_small.jpg/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;别进来，小心薅你羊毛9636267&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;羊羊baby呀&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;10.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/live-cover/appCovers/2021/06/05/9636267_20210605014050_small.jpg/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;下午娱乐，晚上峡谷+画画&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;即将拥有人鱼线的PDD&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;567.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/live-cover/roomCove_coverUpdate_2021-06-23_55b27af6c46d57fe008cc1a5fdc4264c.jpg/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;看过星辰没看过你 本厅由佐岸哥哥冠名&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Zy一温香软玉&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;17.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;6月23号下午3点开播&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;洪湖小肖&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;190.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;祝皇妹四周年快乐，今晚OT&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;跳跳&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;183万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;呆妹：有双倍亲密度加上限~袁袁子上线！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;呆妹儿小霸王&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;390.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;pigff【工资杯tyloo第一视角】&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;pigff&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;340.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;预告丨26日18点 KPL春季赛总决赛&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀官方赛事&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;310.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;Hi❤️欢迎听歌～&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;音乐&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;张梦涵丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;13.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;打开快乐大门 上午11点-5点&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;野鸡娘娘&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;12.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;淑怡：来了嗷&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;不2不叫周淑怡&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;291.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;初晨 虔诚 762 KOKO 拖米&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;DL丶拖米&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;267.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;白天坐牢军训，晚上盗贼之海!&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;DOTA2&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;yyfyyf&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;257万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;别翻了，就这坐下吧&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;星星雪糕&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;11.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;相遇能不能重写9681437&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;思唯因&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;2.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;美好的一天从连麦小姐姐开始！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;南波儿大魔王丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;245.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;长沙密室冲冲冲！！！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;智勋勋勋勋&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;236.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;17点LPL夏季赛JDGvsV5&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟赛事&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;236.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;杭州 00 天秤 好骗&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;鬼鬼不是鬼aoa&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;12.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【大明攒机】电脑配件 电源选择&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;数码科技&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;上海大明海&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;36.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;十指操作，初露锋芒&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;艺帝帝&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;235.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;Gemini: 6.6 北诗 小夜 不弃&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;MrGemini&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;232.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;孙悟空：峡谷有善口技者&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;孙悟空丨兰林汉&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;232万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;祝皇妹周年快乐&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;TD丶正直博&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;147.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;夜晚拥有星星 云朵拥有雨滴&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小花不敢吃鱼了&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;130.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;下午三点准时开播~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;芜湖大司马丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;231.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;这才叫麻将，暴躁杠开集锦！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;欢乐麻将&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;靓旭&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;224.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季5排冲冲冲！！！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;DYG丶久诚&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;218.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;业余唱歌爱好者&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;二次元&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;趣趣er&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;123.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;距离0.1km/感谢“改名，废话”宠冠！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Yw一如约而至&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;97.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新英雄云樱百分百胜率上国服！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;A老回&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;217.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【直播】CFML Q9 0:1 ES&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;CF手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;CF手游官方直播间&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;203.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;快乐云缨上线 冲国服教学&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;白白白白白3&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;203.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;我回来啦！！ 681888&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Skr丶大伟伟&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;97.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;如鹿归林 如舟靠岸 7009686&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;紫薇同学&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;94.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;涵涵：CFHD斗鱼赏金活动火热进行！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;CFHD&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;画饼李&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;202.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;HELLO我是张老板阿~冲鸭！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;张逗逗就是张老板阿&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;194.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【猛男】单人4排最激情单口相声细节教学&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;邦Sa&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;190.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;祝巨蟹哥朝圣哥生日快乐&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;歌神韦爵爷&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;90.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;小胖子宝儿&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;鲭宝儿&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;90.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;19点 CFPL Q9 vs ES&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;穿越火线&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;穿越火线运营团队&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;189.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;余小C：峡谷之巅冲前500！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;余小C真的很强&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;187.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;JJ斗地主 488743&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;JJ斗地主&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;JJ斗地主官方&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;185.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;颜值区倒数第一。&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小悦同学ovo&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;86万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;去成都约小姐姐吃饭&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;逐梦兄弟&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;79.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【头号玩家】最后一把上战神&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;追梦战神泼痞&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;184.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;2021CRL六月月度决赛 第2天&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;皇室战争&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;皇室战争官方直播间&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;183.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;2021BSC六月月度决赛 中国大陆赛区&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;荒野乱斗&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;荒野乱斗官方直播间&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;182.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【持续更新中】饭真香&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;徐大sao&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;77.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;9815091万合二台，《鲜肉老师》上线&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原创IP&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;万合出品&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;76.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;放逐三妹~欢乐下饭&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;放逐大帝灬&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;182.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;先来上一个王者的&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;少年不太冷2&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;177.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;天不生我王纪超，炮道万古如长夜&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;王纪超666&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;172.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;祝我秀哥生日快乐～&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;果冻cc007&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;71.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;祝巨蟹哥生日快乐~~~~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;梅夕不是梅西啊&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;70.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【橙子】最钢竞技单四全程高能视角盛宴&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;神秘嘉宾橙子&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;166.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;少囧の游戏教室&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;少囧丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;166.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【骚某某】场均50杀，世界第一&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;骚某某&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;166.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【特辑】追龙已成往事，王总终成大局！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原创IP&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;特辑电影院&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;69.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;本房间由“ bs 小夏 问路”冠&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小象一我喜欢你&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;69.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【挑战你的不开心】&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;imxiaoxin&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;165.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;每天躺鸡好难受啊&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;热门手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;蓝天白云的卡卡&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;165万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【菊花】无挂服顶级运营天花板&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;顶级菊宝a&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;164.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【正在解说光头琦玉】饭点陪聊&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原创IP&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小陶气说动漫&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;68.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【交友】招收女主持一交友一厅&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;爱约一只如初见&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;68.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;无敌战神在线被老6&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;轻语丶619&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;164.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;直播直播直播 5688727&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;eStarPro花海&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;164.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;单排冲击王者！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;不可一世杀手&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;163.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;本厅由“东月老板”冠名&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小象一念你如初&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;66.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【最新视频】大口吃肉，太过瘾了&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;苗大冬&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;64.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;冲第一个上国服榜云缨！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;陈比克rr&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;163.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;五国服顶级发育路，冲&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;BOA小强&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;163.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【直播】CFHD战神杯小组赛B组DAY3&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;CFHD&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;CFHD运营团队&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;162.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;白客、孔连顺主演《鲜肉老师》登陆斗鱼！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;趣生活&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;万合鲜肉老师&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;61.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【牛叔】N分钟带你看完大片&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原创IP&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;牛叔说电影&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;61.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【2021PCS4】18点东亚赛区&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;斗鱼绝地赛事&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;160.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;云缨乱送局&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;DYG丶小义&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;158.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;巅峰赛冲冲冲！！！~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;陈正正正Cat&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;156.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【谭sir】火遍全网的“二仙桥”&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;趣生活&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;谭乔V&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;60.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【正版】经典小品，下饭必备&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;趣生活&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;辽台好物种草&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;59.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;叶知秋：下午好&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;叶知秋Vanessa&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;156万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季五排冲王者啦..&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;骚易丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;155.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【直播】TI10东欧区预选赛&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;DOTA2&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;完美世界电竞频道&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;153.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;快乐的一天从这里开始 7327546&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;杨薰同学&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;59.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;超小厨的直播间&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;超小厨&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;59.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新人主播第一天直播第一天玩游戏&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;CFHD&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;性空z&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;148.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季冲冲冲！！ 1981932&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;音七Simple&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;146.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;《路人王带妹》&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;A扬丷&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;144.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;你来我相信你不会走&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;一渔1&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;59.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;迷人可爱又壮实&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;大艺术嘉carrie&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;58.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国服马超国服关羽国服露娜专场&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;DYG易瞳&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;142.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;今天也可以反着压~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;穿越火线&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;白鲨石头丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;140.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;上王者冲巅峰赛&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;国宝佳悦&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;139.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;心有猛虎 嗷呜嗷呜~！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小卷呐&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;57.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;繁星哥霸气冠名/招全职主持！！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小象一勿忘初心&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;55.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;❤摸摸喜酱头万事不用愁&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;喜衣机&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;138.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;我可能玩了假的马里奥&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;马里奥制造&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;超级小桀&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;137.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;速战速决！昨天1神话4史诗=7倍&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;DNF&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;DNF黑一阿旭&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;136.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;下午见呀下午见&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;早安酱ii&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;55.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;直-3倍上限＋双倍亲密度 ~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;电台新声&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;孙紫涵丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;55.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新一：大师以上，我必一飞冲天直接王者！！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Xinyi新一丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;135.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;❤呆萌懒妹嘎嘎乱杀❤&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;苏小懒38D&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;132.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新英雄云缨顶级理解全面剖析&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;有痕ysys&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;131.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【战神杰】满是经典&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;一起看&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;神秘水友丶战神杰&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;53.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;田园仙境有佳人，李子柒最新视频已更新&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;李子柒liziqi&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;53.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;石原：月底冲分！！！！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;火影忍者&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;爱吃鱼的石原&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;128.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;重温红色经典 汲取前行力量&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;正能量&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;政达光明&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;128.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【QQQ】前职业选手Q7，秀！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;气人主播QQQ&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;125.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;如鲸向海：由靓仔 萝莉 灵犀冠名！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小象一如鲸向海&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;53.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【每日更新】感谢大家，一起好好吃饭&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;兴森一家&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;53.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【认证号王牌1V4】新版本大揭幕！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Dy合群&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;124.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;滴滴滴！牛根儿发车啦！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;DNF&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;一阵雨不是一阵奶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;123.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【新版本体验】&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;脆油条丷&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;122.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;已更新，不定期吐槽美国&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;趣生活&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;我是郭杰瑞V&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;50.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;六月好一点&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;安小安安呀&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;50.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【新版本体验】&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;脆油条丷&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;122.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/1322998_1606.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;预告丨23日17点KPL总决赛练兵&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;斗鱼王者荣耀微博杯&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;122.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/live-cover/roomCove_coverUpdate_2021-06-23_c3c0f8f1612e84c87acb4c81584583ea.jpg/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国服赵云打野90胜率&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;声优赵猥琐&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;121.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/2205764_1611.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;双倍经验~ 记得打卡哟~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;伊伊不可爱&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;49.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【开心一刻】宋小宝经典小品轮播&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;趣生活&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;宋小宝小品&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;49.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/9817729_1612.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;马牛牛：十天上大师DAY2&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;47号Gamer&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;120.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/2461752_1606.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季三排冲王者&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;特特zzz&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;120.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/8813116_1612.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;少点看弹幕认真冲第一&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;impOUO&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;119.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【开心一刻】赵本山经典小品轮播&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;趣生活&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;赵本山经典小品&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;49.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/9817716_1612.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;不过四星不下播！！7189349&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;户外和平大使&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;49.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/7189349_1611.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;最强画质COD+派派+塔科夫！！！！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;斯祥丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;119万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/2311698_1606.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;单排不上王者不下播，输一把发红包！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;伽罗王丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;118.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国服第一妲己：轻松上分&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;国服老狐狸&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;116.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【最新已更】嗨吃小强，陪你下饭！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;吃饭啦光小强&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;48.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【正版】经典小品轮播电视台&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;趣生活&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;辽视欢乐集结号&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;46.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;粉丝牌跟车上战神,晚七点送CDK&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;COD手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;叫老公别叫老郭&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;116.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;微笑：峡谷冲大师！！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;微笑&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;116.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国服第一生化 有问必答 视觉体验&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;CFHD&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;可杰大魔王&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;114.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;打卡日/今天我也爱你&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;考拉一人间酒馆&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;46.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;赶集收土鸭蛋&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;叶子户外&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;44.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;燎原神枪第十八代传人 上王者&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小乐碎片&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;112.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;请问嘻嘻哈哈能上万一么？&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;炉石传说&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;衣锦夜行&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;112.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;训练赛一起快乐练枪&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Tianba丶顾居居&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;111.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;真人真比封面好看&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;凌晨儿Mini&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;44万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;录-孤立无援就自成宇宙吧~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;电台新声&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;阿睿ARrr&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;42.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;奶粉：班德尔城大师教学屠杀局！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;主播油条&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;111.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;双服第七峡谷冲第一&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;天灰灰qaq&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;110.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;彩排24号云顶2周年晚会，兄弟们别进！！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;lol云顶之弈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;卷子丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;110.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;淑洁:今天回武汉了&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;百变姑姑肖淑洁&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;41.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【江苏】月底冲业绩&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;韩小沫呀&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;41万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;继续阿凡达！~~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;永劫无间&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;女流66&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;110.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;云缨胎教系列冲国服 我看谁不学&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;林豆豆y&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;109.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;二台:思路清晰教你稳定吃鸡！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;仙凡哥哥丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;107.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【小片片】片荒的日子就找小片片！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原创IP&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小片片说大片&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;40.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;2点左右播～下午见&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小梦露mm&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;40.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;妖路整活，噜子上线！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;DOTA2&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Amore婉&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;106.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【赛事回看】Gambit专场&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;CS:GO&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;斗鱼CSGO赛事主频道&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;104.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;十点半,不见不散!!!&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;DOTA2&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;谢彬DD&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;104.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;斗鱼大事件&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;奇点一可口可乐&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;39.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【最新视频已更新】想看料理，就来看大姨！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;绵羊料理&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;39.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;石页:请大家不要窥屏BAN英雄！谢谢！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;石页的第一根矛s&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;103.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;黄金圣光战神不死流剑魔安排！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;lol云顶之弈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;阿涛皎月Carry&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;103.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;巅峰永无止境！！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;深圳DYG易峥&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;103.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;听说老婆女友最爱农国栋做的菜&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;主厨农国栋&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;39.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;距您0.03km/“服务”独家冠名&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;XK一万有瘾力&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;39.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;皮鸭助手已上线&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;老皮鸭OVO&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;103.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季五排&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;eStarPro无铭&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;103.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;学习嘴甜的第一天 双倍亲密度~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小苏菲&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;102.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;努力渡劫冲鸭 8733064&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;音乐&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;阿允唱情歌&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;38.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;好久不见呀 6291080&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;瑄璐&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;38.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;好好上分光速上王者&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;格局OoO&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;102.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【令北】办卡加时长挑战 第22天&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;正经人令北&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;102.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;另类玩法一双喷吃鸡&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;苟分怪&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;102万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;月光会把你带到我身边~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;胖冰不可爱&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;37.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【招主持】厅由小8 新兰哥 鞋带哥冠名&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小象一浮生未歇&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;37.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;小亮：最强单人四排！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;左小亮丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;101.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【直播】TI10东欧预选赛副舞台&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;DOTA2&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;完美世界电竞频道3&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;100.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新英雄云缨冲国服！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;羽辰鸽鸽丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;100.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;会修一年吗 一年能等吗&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;你的网友小董&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;37.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;“精神小伙”蛋黄派最新自制硬菜&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;记录生活的蛋黄派1&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;37.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;二台馒头：端游转手游的第13天&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;COD手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;皮皮鲨FPS&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;99.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【有车位】萌妹开心上大分！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;欣小菜&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;95.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;职业选手玩云樱&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;eStarPro橘子&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;94.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;祝皇妹周年快乐~~！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;招财猫呢&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;37.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;水库网鱼，明天赶集！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;长沙三湘独立团&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;37.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;赛季初5排上个王者&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小小xxl&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;94.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;峡谷7天必王者&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;KZH盲僧&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;94.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【72战神火力车】猛摇！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;追梦战神清风&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;94.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【敬汉卿】将作死进行到底&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;趣生活&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;敬汉卿250&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;37万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;美食作家王刚V的直播间&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;美食作家王刚V&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;36.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;科技美学的直播间&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;数码科技&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;科技美学中国&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;93.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;别乐我别乐我&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;17小北&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;89.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;jjp:桀目效果&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;APEX英雄&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Jiepai桀派&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;89万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;你会遇到很多星星但只心动一个月亮&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;蔡娜妹妹&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;36.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;言念君子 温其如玉&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;翼遥遥丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;36.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;四排战术全能王&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;天赐解说丷&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;88.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;s1首位百星 格斗大赛冠军。&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;航海王热血航线&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;酒九冬&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;87.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;郑州80it：618电脑活动开启&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;数码科技&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;80it电脑网&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;87万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;万般皆苦 唯有自渡&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;珂珂宝丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;36.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;哥哥对妹妹这样姐姐会生气吗&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;玉玉子想吃饱&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;35.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【湖北ju王】手机天花板系列&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;一玥阿&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;86.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;中路英雄海王 对线教学show&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOL手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;西瓜太浪xx&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;86万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季上王者冲&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;深圳DYG星宇&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;85.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;渝万七厅-金牌主持：谭洁&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;开黑&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;渝万丶派单七厅&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;35.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;八卦兽:dy仅存职业八卦~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;薛叫兽&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;35万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【2021PGL夏季赛训杯】&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;绝地求生赛事4&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;85万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;醒目：勇敢牛牛 不怕困难&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Cpt小醒目&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;84.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;YJJ 永劫无间&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;yjjimpaopao&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;84.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【姽婳】九亿少男的梦&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;一起看&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;一条小姽婳&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;35万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;俄罗斯少女&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;俄罗斯教父&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;34.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;巅峰赛上大分 9177171&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;DYG萧玦&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;84.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;空调直播间\u3000凉快！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;了不起的修仙模拟器&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;主播杨树&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;84.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;第一天五排主播队冲王者&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;音子tut&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;83.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【交友】斗鱼颜值交友一厅，气氛一厅&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;爱约一爱约之夏&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;34.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【柯南】专业解说柯南直播间&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原创IP&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;我是一只西瓜啊&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;34.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;无尽诺手版本1V5答案&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;旋转的老刘诺手&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;83.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;蛙神：今天不上50星不下播&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小小青蛙笑i&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;82.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;巅峰2526.守榜前十&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;区区一只箐笙&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;81.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;经典小品相声乐不停&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;趣生活&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;吉林卫视v&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;34.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;等一个奥特曼！！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Lulala拉拉&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;33.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季上王者 9177702&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;DYG丶Giao&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;81.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季玩具无牌车&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;eStarPro无心&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;81.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;渝乐耍大牌，每晚18:00与大屏同步直播&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;JJ斗地主&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;渝乐耍大牌&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;81.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;云栖丶开黑一厅&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;开黑&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;云栖丶开黑一厅代号哥&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;33.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;稳定努力主持+&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;XK一予你欢喜&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;33.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;小13：YYDS~~~~~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;欢乐麻将&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;头号玩家丶B&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;81.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;周三快乐！！！！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;自走棋&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小红豆阿&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;81.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;沙皇：请大家监督我训练hhh&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;COD手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;沙皇StaFenGraD&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;80.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;已更新，德国人在中国&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;趣生活&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;阿福ThomasV&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;33.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;理性男友：全麦单身~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Hi一理性男友&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;33.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;主播打野，有车位呐 ♥~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小龙女OuO&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;80.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;骆歆：你好吗？&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;骆歆冲冲冲&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;80.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;湫兮：五排冲王者&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;湫兮ovo&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;80.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;或许你喜欢胖嘟嘟（重庆）&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;还是来福儿&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;33万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【交友】招收优质交友女主持&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;爱约一缘来是你&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;32.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;朗基努斯大头！1张就进决赛&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;中年人拳师七号&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;80.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;⭐A测全服第七 箐英比赛中&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOL手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;阿超cccccccccc&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;79.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;异灵术：今日主旋律 上分&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;炉石传说&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;异灵术老师&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;79.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;主播距离你0.3km…&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;一林绝美的&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;32.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;郑州 御姐 一笑你就化了&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;我叫李菲儿&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;32.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季刘备连胜五排上王者！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;刘皇叔是个弟弟&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;78.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/live-cover/roomCove_coverUpdate_2021-06-23_2473c2cd370f5d55596004ffda261ca6.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季带粉开冲!&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;苏小沫不胖&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;77.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/live-cover/roomCove_coverUpdate_2021-06-23_36ed287169b28abd69f9d7caf9ddef11.jpg/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;表弟：第一帅盲僧刀妹&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;疯狗炼金&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;76万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/338281_1606.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;周一拉填榜拉~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;夏宝宝宝宝宝丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;32.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;纯天然无公害主播9390137&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;黎可妮&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;32.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/live-cover/roomCover/2021/05/08/9ebe5b42a56accdcff74ad383f2004aa_big.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;12点前上2800分上不去送2800！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;永劫无间&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;狐狸不太Sao&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;75.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/699689_1606.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国一司马懿，赛季第一天冲啊&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;环斐丶蓝羽&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;75.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/4749583_1606.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;今天玩下底特律变人~~~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;DOTA2&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;820邹倚天&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;75.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;交友最美颜值厅 招收冠名大哥 全职主持&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小象一神仙姐姐i&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;32.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/live-cover/appCovers/2021/05/22/9799138_20210522133515.jpg/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;凉凉主播也需要疼爱QAQ&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;未三岁i&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;32.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/live-cover/appCovers/2021/03/27/4400186_20210327185315_small.jpg/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;zard1991&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;DOTA2&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;zard1991&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;74万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/60937_1606.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季的上分秘诀&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;RW侠Djie&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;73.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【月光】专业看号规划/深渊&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原神&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;天书月光&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;72.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;每一天都是新的际遇&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;绒绒儿ovo&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;31.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【国语点唱】世界这么大感谢遇见你❤&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;二次元&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;睡不醒的妮儿&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;31.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;庆祝建党100周年 686877&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;正能量&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;鱼公益善&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;72.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国一akbp短剑8指相声山在线讲解&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;COD手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;山山鸭&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;72.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;全民PK赛梦幻西游手游，221869~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;梦幻手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小儿郎丶丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;71.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;YJ-浪漫之爱‘四四神/靓仔仔’冠&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;英爵一浪漫之约&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;31.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;蕉蕉不焦虑~~~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;撒个蕉&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;31.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;深夜伴侣-五指狙神&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;炎师傅&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;71.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;20冰雪稳定开放&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;传奇&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;20冰雪dy6512&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;70.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季暴力女野王带粉冲呀&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;乔公举&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;70万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;本房已开启一元粉丝牌！！！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;YAQ一夜色星河&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;31.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【交友】凯美阳：希望美阳天天开心&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;爱约一不期而遇&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;31.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;百段野王巅峰赛教学&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;潇潇暴龙兽&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;69.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;帮小咪助威投票领DNF道具咯&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;DNF&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;大红神o猫小咪&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;69.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【海岛争爸赛】三十九岁天才少年&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;浪浪直男吖&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;69.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【最新更新】武侠浪子的美食分享，过瘾&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;山药视频&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;30.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;I NEED YOU~新人主播第三天~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小七就是小七宝&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;30.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【年鹏】今天有事，跟教练们请天假，明天播&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;穿越火线&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;汉宫年鹏Enpi&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;69万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;愿山河无恙，人间皆安！加油，广东！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;数码科技&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;OC频道包大人&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;69万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;晚上好啊 我来了 37807&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;格斗游戏&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;战神_河池VR&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;69万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;朱一旦顶级团队C座802，职场大爆炸！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;趣生活&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;C座802&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;30.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;诶嘿9822129&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;二次元&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;安晓呀&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;30.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;战斗战斗战斗&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;滔搏369zz&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;68.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;《火线犀利说》：观看抽永久冠军之怒&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;穿越火线&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;穿越火线赛事&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;67.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季和七七一起双排上王者&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;深海ToT&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;67.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;迈克尔和哥哥林肯的越狱计划&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原创IP&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;3说电影&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;29.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;旅行老司机 爱上户外&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;老狼雄起a&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;29.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【18ym】保持良好的心态&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;CS:GO&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;18goYm&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;67.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;九寨沟看房团上线&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;剑网3&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;剑网3官方直播&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;67.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;峡谷超级艾琳 单排冲王者 嗷嗷乱杀&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;狸子3岁&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;66.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【最新更新】小哥，陪你下饭&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;YESHI小哥&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;29.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;本厅由最最最帅气的店长冠名~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小象一甜心蜜语&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;29.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;[冰子]来来龙盒碰瓷免单了，有深渊打造！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;DNF&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;DNF枪魂冰子&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;65.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;冯雨大王：欢乐时光已经开始很久了！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOL手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;驴酱的冯雨大王&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;65.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;魔法部长小罗：峡谷第一好抓&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;魔法部长小罗&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;65万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;「橙幕」「最人气港剧直播间」&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;一起看&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;橙幕Orange丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;29.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;正宗农村风味~馋~~~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;食味阿远&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;29.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季第一天上王者 8745735&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;沐沐Ccccc&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;65万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;法系边路九少&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;BOA全能哔&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;64.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;星耀三开打今天就能国1&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者模拟战&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;KSSC抓只好棋&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;64.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;本周北京出差啦 不定时播&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;音乐&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;甜小沐&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;29.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;如火如荼由偏爱哥，强哥冠名（招募主持）&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小象一如火如荼&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;29.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;eStarPro今屿的直播间&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;eStarPro今屿&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;64万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;拖米 初晨 虔诚 762 新赛季5排&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;TESKoko&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;62.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【备战PEL】 下午彩排.&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;潇男小朋友&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;61.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;[交友]招优质女主持，待遇绝对令你满意！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;YAQ一水晶之恋&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;29.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;费电主播 在线挨揍&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;怡可心呀&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;28.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;健康哥上线！！！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;DOTA2&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;ZippO宝哥&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;61.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;最近比赛多，疯狂练起来！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;QQ飞车&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;17丶Xtreme&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;60.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;打一天训练赛 准备比赛&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOL手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;心星丶RJ哥&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;60万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新团开播欢迎前来围观&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;恋爱少女团&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;28.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新主播第二天 7209616&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;奶糕酱o&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;28.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;208114不管你来不来我都在这等你哦&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;炉石传说&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;恩基爱萌萌哒的狗贼&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;59.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;3小时大师上宗师教学！@&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;lol云顶之弈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;NB丶条皮兄弟&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;59.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;轮播：音乐区第一长枪&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;永劫无间&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;衣服ovo&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;59.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;颜值区最软的小柿子双倍亲密度啦&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;妮妮别吃了&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;27.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;个胶几人呐&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;米米nnn&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;27.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;郑州创D：618电脑活动进行中&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;数码科技&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;创D电脑联盟&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;59万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;今天又是喂饭的一天&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;逝呆呆&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;58.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【擦擦】上分上分&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;APEX英雄&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;擦擦哥哥丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;58.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;东北乡村美食，民以食为天，吃货似神仙！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;百味大彭L&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;27.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;四川小漂亮&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;半只小月亮o&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;27.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;轰轰：大家一定不要感冒。&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;轰轰仔&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;58.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国一典韦带粉一局不输有车位&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小宗阿&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;57.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;热血传奇-创世冰雪--传奇&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;传奇&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;忘忧妹妹&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;57.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;主播害羞~ 请主动~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;奶优米呀&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;27.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【交友】招收全职优质女主持&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;爱约一超级巨星&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;27万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;无敌马超教学，专业带粉上分！！！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;子夜小呆呆&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;57.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季冲冲王者&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;O泡果奶1111&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;57.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;26岁天才少年 9442053&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;穿越火线&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;白鲨常旭DBQ&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;57.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;早起晨跑的杨颖&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;青榎&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;26.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;没故事 你要来写吗&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;十壹y&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;26.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;赛季第一天 带粉速冲王者&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;解说梦梦&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;57.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;小舅子升学宴，23号见&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;穿越火线&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;鲜肉赵山河&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;57.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【2021PSI】6月25日&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;和平精英官方赛事&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;56.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;很高兴认识你，这是一个靓女的直播间~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Thea柒清&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;26.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;又青：不渡劫不下播&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Carol又青&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;26.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【PEL国际主播公开赛 】&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;皮西蒙丷&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;55.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;大师认真冲分&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小康top&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;55.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;阿扎：无挂服顶尖大师局！相声队&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;阿扎y&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;54.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;✨周星驰✨星爷 华语 经典 电影 神乐&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;一起看&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;进击の神乐&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;26.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;遇到你是我的幸运 感谢阿拉哥 可甜哥宠冠&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Yw一治愈仙境&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;26.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;录像：通宵结局看鱼吧&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;欢乐斗地主&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;天地丶小旺&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;54.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【直播】菁英大奖杯-Day2&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOL手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;斗鱼英雄联盟手游赛事&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;54.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【下午档】职业女边六酱单排教学局&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;aGirl六六&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;54.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;贵阳彭于晏教你学做菜&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;拜托了小翔哥&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;26.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;嗨玩-约会圣地/温御聊吧&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;嗨玩一约会圣地&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;26.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【叶繁】传奇4加油，渡劫&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;CFHD&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;叶繁i&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;53.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;鱼玄机：今天自信加倍&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;鱼玄机丶甬娱&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;53.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;备战夏季超级杯 训练一天！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOL手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;阿紫Yazi&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;53.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【虫哥】魔性吐槽童年回忆&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原创IP&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;虫哥说电影&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;26.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;招主持/古典冠/恋爱指南针&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;YAQ一王者1st&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;26.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国服野。射微信区有位置，一把不输&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;雲小帆&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;53.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【机长】神作直播！刺激！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;恐怖游戏&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;机长YG&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;53.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【和平精英微博杯2】每晚18点&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;斗鱼和平官方赛事&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;53.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;❤️怡寳❤️ 国民女友陪看&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;一起看&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;活捉一只小怡寶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;26万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;永远为忠诚 专一 安全感心动&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;隔壁网友筱叶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;26万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;观影游园会-绝地求生&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;绝地求生赛事8&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;52.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;❤空调开好辣，快进来凉快一下吧❤&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;部落冲突&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;辉辉猪宝宝&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;52.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;25日13点 CFEL 越南&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;穿越火线&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;穿越火线赛事专用&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;52.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;第一颜值女神厅/最高待遇招收主持&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;爱约一只念初见&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;25.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;✨神乐✨华语 经典 电影 沈腾 周星驰&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;一起看&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;进击的神乐&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;25.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;观影游园会-和平精英&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;和平精英赛事3&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;52.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季五排嘎嘎上星&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;RW侠小夜&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;52万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;LDL夏季赛WZvsTT.Y&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;LDL官方直播间&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;52万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【周末】港式动作，最新片单&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原创IP&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;周末电影院2&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;25.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;武汉长江大桥实时直播&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;社会人文&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;丝绸之路手机台&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;25.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;有位置 国一那可露露玄策在线带粉丝飞&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;挽风ac&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;52万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/8008304_1611.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国服中路 进来学技术！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;阿锟ya&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;51.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/3422363_1611.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;Elisa 2021夏季邀请赛&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;CS:GO&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;斗鱼CSGO赛事频道2&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;51.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/live-cover/roomCove_coverUpdate_2021-06-03_72d1308bd5187e89e440f5b4d5fb52f7.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;三个野男人的同居生活&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;野居青年&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;25.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【刘老师】每天爆笑解说不断&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原创IP&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;刘老师说电影&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;25.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/8317926_1606.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;Yagao第一视角&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟赛事活动&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;51.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/673320_1611.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【技术控御姐】新赛季咯&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;顾小奈丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;51万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/8751050_1612.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【三明治】道理简单 继续努力&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;APEX英雄&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;一口三明治3Mz&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;50.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;风里雨里-大哥大姐直播间等你&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;追梦的韭菜&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;25万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/9479874_1612.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;我也喜欢被偏爱&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;下知子呀&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;24.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/live-cover/appCovers/2021/06/06/6691855_20210606190706_small.jpg/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;全英雄联盟最下饭的饭堂&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟小饭堂&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;50.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://rpic.douyucdn.cn/asrpic/210623/9295826_1612.png/webpdy1&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;小孩曾卓君：14罚站赛&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;格斗游戏&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;游天堂&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;50.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;云缨初体验&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;胡富强r&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;50.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;距离5.20km/上周榜1：点電小可爱&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;争锋一人间值得&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;24.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;野有蔓草，零露漙兮。&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;漙兮吖&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;24.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;pei彩排~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;林熙Lxxi&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;50.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;UNiboy第一视角&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;赛事专用直播间2&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;50.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;Geeker go金牌汽车主播帮你选车&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;汽车&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;九江008&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;50.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;鸣谢“不丢哥”对本厅的宠爱招主持男女都可&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;争锋一梦中城堡&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;24.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;越努力越幸运呀&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;mystery梦梒&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;24.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国服镜赛季初带粉连胜上王者&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Ye诺风&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;50.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;破釜沉舟 不进则退&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;17小鬼丷&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;49.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;双倍亲密度三倍经验值 6264482&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;天天象棋&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;九妹笑笑&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;48.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;贫民窟的希望女孩~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;阿珂珂珂呀&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;24.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;双倍亲密 打打卡 7052226&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;晚安小酸奶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;24.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;❤晏安❤做啥都不排队奥❤&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原神&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;晏安anan&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;48.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;象棋飞刀王！布局陷阱专家！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;天天象棋&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;帽子戏法Chess&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;47.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季教你们上分&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;你好我叫阳光啊&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;47.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【周末】恐怖上新，经典再现&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原创IP&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;周末电影院&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;24.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;等你翻越千万山海 披星戴月而来&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小苏打Da&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;24.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;咻咻咻~用快乐为你加速&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;文化&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;陈翔六点半&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;47.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;欢迎上车 工作使我快乐&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;蜜茶Aimee&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;47.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;一个很柔弱的妹妹~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;沐沐大人ok&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;47.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;叫上兄弟姐妹，还有狗子一起去挖笋&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;华农兄弟V&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;24.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;想你成为我的守护&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;帆妹儿超甜&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;24.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;景天：大师冲个第一&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;景天zxz&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;47万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;成都嘉年华副舞台 欣赏另一桌精彩&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;JJ斗地主&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;JJ比赛副房间&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;46.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;清一色17罗汉杠上开花&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;杨驴驴y&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;46.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;相遇皆是注定 8744383&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;千岛寒流q&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;24.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;Dorothy多萝西的直播间&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Dorothy多萝西&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;24万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;最新布局陷阱，中局飞刀，残棋组合攻杀&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;天天象棋&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;八卦象棋大师&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;46.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;峡谷冲冲今天上大师连胜！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;清风亚索QAQ&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;46.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;能带你买车的，只有我，实战派。&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;汽车&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;雪鹰哥麻辣车评&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;46万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;恭喜东游哥喜提国王&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;二次元&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;颐颐儿&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;24万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;清纯女大学生！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;阿梨small&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;OB黑铁四：诶 我又活过来了&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;斗鱼丶华仔&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;45.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新人主播球关注 8523981&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;梦幻西游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;皇宫扫地僧&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;45.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;《寒霜》打穿提瓦特，深渊补星。&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原神&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小染指o&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;45.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【唱歌】给我一首歌的时间吧&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;音乐&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小野绿子midori&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;所有的最好都不如刚刚好。&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;佳妮爱吃辣&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;专业调号规划海岛越战&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;航海王热血航线&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;MU丶欢欢&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;45.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;silentBT：醒醒吧&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;OMGsilentBT&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;45.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;百星国服野王 带粉丝飞&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;雨晨in&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;45.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;虚拟唱歌主播，走过路过不要错过噢~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;二次元&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;一颗小奶桃&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;可盐可甜小废物&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;你的王者女孩&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;中单绝活发条冲大师&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOL手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小师妹Luna&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;45.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;逗B苍 旋风哥中单盖伦无所畏惧&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;是逗b苍&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;45万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;披萨OB: IG羞/左手/水TES新上&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;披萨解说&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;44.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;手捏软柿子，嘴添硬茬子&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;王小贝Amy&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;双倍亲密度啾咪~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;梓狸ZIli&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;凤孔の至暗时刻&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;天涯明月刀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;燕徊硯&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;44.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国服李白 连胜第一天王者教学&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;电竞信白丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;44.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;今日甜妹瑶瑶教学&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;玉兔的美梦&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;44.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;由小哥/曦城/白白冠名/招全职兼职主持&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;争锋一你最珍贵&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;你心目中三国武将谁最厉害？&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;社会人文&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;易中天&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;王牌教百榜战神打游戏，坐井观天，指指点点&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;和平精英&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;战神菠歌&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;44.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;南迦巴瓦的天空&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;科普&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;在线天文&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;44.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;女野王连胜冲天梯第一~~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;辜婉婉&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;44.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;我在富士山下爱你&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;敏敏姐姐V&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;上海00后舞蹈主播&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;Abby杨帆&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【有车位】清纯少女李云龙&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;使命召唤&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;乔乔乔大王&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;44.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国际服，单排练心态&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOL手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;心星丶星空&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;44万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;隔壁老王来了.~~~！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;DOTA2&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;叁肆叁肆&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;43.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;距离0.1km/招收女主持 待遇从优&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;惠传一白月光&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;YJ-一程心路：首开公爵厅冠&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;英爵一程心路&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国服伽罗香香99胜率带粉有位置&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;斑斑QuQ&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;43.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国际服钻石全能中单~鳄鱼~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOL手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;心星丶木偶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;43.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;向快乐，冲冲冲……915 6996&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;我不是周黑鸭&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;43.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;每天只做一件事就是等你！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;是你的妙妙&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【66，酒鬼，58冠】回收各手主持❤&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;开黑&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;An丶一生有你i语薇&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;PUBG气人女主播&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;野生小师妹&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;43.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;我吹过你吹过的晚风。&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;绝地求生&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;一只很皮的大七&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;42.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;冲击峡谷之巅 绝活阿卡丽&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;一只阿卡丽灬小表哥&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;42.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【朱一旦】穷的只剩下钱了&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;趣生活&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;朱一旦的枯燥生活v&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;我想问问你还活着吗&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;林奈baby&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;23万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【小葵】58级萌新导师专业讲解&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原神&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;不小葵&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;42.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新赛季国服耀韩信冲分跟车随便赢&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;韩灯泡&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;42.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;青钢影天花板，峡谷之巅&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;南风青钢影&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;42.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;因为淋过雨所以总想为你撑伞7361260&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;一坨奶油吖&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;22.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;手游／端游／歌单／助眠／喜欢的歌只唱给你&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;开黑&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;慧江一卿本佳人&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;22.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;爱是弥天盖地的比雾还浓，虞姬小姐姐带粉哦&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;小七月Ay&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;42.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【重播】恭喜DYG获得S1冠军&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;COD手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;使命召唤大师赛&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;42.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;每日欢乐时光 1340947&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;魔兽怀旧服&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;痴汉万宝路&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;42万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;会唱歌的小姐姐 长相清冷 内心火热&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;鹿鹿酱in&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;22.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;河南搬砖人&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;芝士味的李李&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;22.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;带粉2拖3,赛季初上王者,双区双系统~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;狗飞丶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;41.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;【俞白维】竞技魂燃起来了&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;剑网3&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;俞白维&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;41.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;月底了XDM抬一手吧~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;COD手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;你的兔小美&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;41.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;天青色等烟雨而我~~·~~&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;喜喜诶&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;22.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;魔都黄金俱乐部，游戏开始！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;赵小南丶南神殿&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;22.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;失踪人口回归 今天打训练赛&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;LOL手游&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;心星丶青一&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;41万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;Fview Friday 每周聊聊科技新&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;数码科技&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;FView爱否科技&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;40.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;请保护好你的牙齿。。&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;魔兽怀旧服&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;黑欢喜&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;40.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;所爱隔山海 山海亦可平9622507&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;交友&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;驿动一四季予你&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;22.5万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;“电影之歌·保定站”电影频道融媒体直播&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;社会人文&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;1905电影网&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;22.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;你爱我我爱你蜜雪冰城甜蜜蜜&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;APEX英雄&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;战地记者阿龙&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;40.6万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国服第一梦琪玄策带粉包赢&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;逗哥不是胖子吖&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;40.4万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;昂赛季初冲刺&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;陈小凡TuT&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;40.3万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;无聊的开箱的直播间&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;趣生活&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;无聊的开箱&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;22.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;刘能赵四直播专场&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;原创IP&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;东北爱情大舞台&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;22.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;新发型！用智慧吃鸡，晚点双排！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;剑网3&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;As童话话话&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;40.2万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国服野王带粉有位置&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;听风贼帅&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;40万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;第一橘子 带粉上星&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;木木爱吃橘子&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;39.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;人上人都吃什么？饿了必看&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;美食&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;加油小军哥&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;22.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;老爸评测的直播间&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;趣生活&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;老爸评测&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;22.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;国服最强中路一只猪新赛季冲王者！&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;王者荣耀&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;伊之助xx&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;39.8万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;潘多拉X 科尔特大黄蜂妲己 源火麒麟&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;穿越火线&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;主播蹦嚓149435&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;39.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;快乐风男：亚索or永恩&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;英雄联盟&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;凉风亚索yasuo&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;39.7万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;安静的听歌~ 9739073&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;颜值&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;何乐乐gkd&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;22.1万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;2倍亲密度a&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;看不腻的Abby&#x27;</span>, <span class="hljs-string">&#x27;num&#x27;</span>: <span class="hljs-string">&#x27;21.9万&#x27;</span>, <span class="hljs-string">&#x27;img_src&#x27;</span>: <span class="hljs-string">&#x27;https://shark2.douyucdn.cn/front-publish/sdk-file-master/room_list_default@2x_a960c5b.png&#x27;</span>&#125;<br></code></pre></div></td></tr></table></figure><p>上面代码爬取四个页面后会报错。</p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>selenium</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mermaid语法</title>
    <link href="/2021/06/22/Mermaid%E8%AF%AD%E6%B3%95/"/>
    <url>/2021/06/22/Mermaid%E8%AF%AD%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul><li><p>什么是Mermaid？</p><p><code>Mermaid</code>是一种基于<code>Javascript</code>的绘图工具，使用类似于<code>Markdown</code>的语法，可以方便快捷使用代码创建简洁美观的图表。<br>项目地址：<a href="https://github.com/mermaid-js/mermaid">https://github.com/mermaid-js/mermaid</a></p></li><li><p>如何使用Mermaid？</p><p>使用特定的 <code>Mermaid</code> 渲染器；<br>使用集成了 <code>Mermaid</code> 渲染功能的 <code>Markdown</code> 编辑器，比如<code>Typora</code>。使用时，需要将代码块的语言选择为<code>Mermaid</code>。</p></li></ul><ul><li><p>Mermaid能绘制哪些图？</p><p>饼状图：使用 <code>pie</code> 关键字<br>流程图：使用 <code>graph</code> 关键字<br>序列图：使用 <code>sequenceDiagram</code> 关键字<br>甘特图：使用 <code>gantt</code> 关键字<br>类图：使用 <code>classDiagram</code> 关键字<br>状态图：使用 <code>stateDiagram</code> 关键字<br>用户旅程图：使用 <code>journey</code> 关键字</p></li></ul><p><code>%%</code> 注释。</p><h2 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h2><h3 id="方向"><a href="#方向" class="headerlink" title="方向"></a>方向</h3><ul><li>TB/TD - top bottom</li><li>BT - bottom top</li><li>RL - right left</li><li>LR - left right </li></ul><p>从上到下：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph TB<br>    起点 --&gt; 终点<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph TB    起点 --&gt; 终点</code></pre><p>从下到上：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">grpah BT<br>    起点 --&gt; 终点<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph BT    起点 --&gt; 终点</code></pre><p>从左到右：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">grpah LR<br>    起点 --&gt; 终点<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    起点 --&gt; 终点</code></pre><p>从右到左：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">grpah RL<br>    起点 --&gt; 终点<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph RL    起点 --&gt; 终点</code></pre><h3 id="节点"><a href="#节点" class="headerlink" title="节点"></a>节点</h3><p>默认节点是矩形。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">grpah LR<br>    id<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    id</code></pre><p>带文字节点：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">grpah LR<br>    id[带文字节点]<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    id[带文字节点]</code></pre><p>圆角节点：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">grpah LR<br>    id(圆角节点)<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    id(圆角节点)</code></pre><p>圆形节点：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">grpah LR<br>    id((圆形节点))<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    id((圆形节点))</code></pre><p>不对称节点：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    id&gt;不对称节点]<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    id&gt;不对称节点]</code></pre><p>菱形节点：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    id&#123;菱形节点&#125;<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    id&#123;菱形节点&#125;</code></pre><h3 id="连接线"><a href="#连接线" class="headerlink" title="连接线"></a>连接线</h3><p>实线、箭头、无文字：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    A--&gt;B<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    A--&gt;B</code></pre><p>实线，无箭头，无文字：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    A---B<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    A---B</code></pre><p>实线，无箭头，文字：<br>前面两个 <code>-</code>，后面三个 <code>-</code>。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    A-- 文字 ---B<br></code></pre></div></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    A--- |文字| B<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    A-- 文字 ---B</code></pre><p>实线，箭头，文字：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    A-- 文字 --&gt;B<br></code></pre></div></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    A--&gt; |文字| B<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    A-- 文字 --&gt;B</code></pre><p>虚线，箭头，无文字:</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    A-.-&gt;B<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    A-.-&gt;B</code></pre><p>虚线，无箭头，无文字:</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    A-.-B<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    A-.-B</code></pre><p>虚线，箭头，文字:</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    A-. text .-&gt;B<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    A-. text .-&gt;B</code></pre><p>大箭头，无文字：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    A==&gt;B<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    A==&gt;B</code></pre><p>大箭头，文字：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    A==text==&gt;B<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    A==text==&gt;B</code></pre><h3 id="特殊语法"><a href="#特殊语法" class="headerlink" title="特殊语法"></a>特殊语法</h3><ul><li>引号</li></ul><p>文字里用引号避免一些特殊字符的错误。比如矩形节点里有 <code>()</code> 时就无法渲染，所以加上引号。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    A[&quot;This is the (text) in the box&quot;]<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    A[&quot;This is the (text) in the box&quot;]</code></pre><ul><li>实体字符</li></ul><p>可以使用 <code>HTML</code> 中的实体字符。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    A[&quot;A double quote:#quot;&quot;]--&gt;B[]<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    A[&quot;A dec char:#9829&quot;]</code></pre><h3 id="子图"><a href="#子图" class="headerlink" title="子图"></a>子图</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph TB<br>  c1 --&gt; a2<br>  subgraph one<br>  a1 --&gt; a2<br>  end<br>  subgraph one<br>  b1 --&gt; b2<br>  end<br>  subgraph one<br>  c1 --&gt; c2<br>  end<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph TB  c1 --&gt; a2  subgraph one  a1 --&gt; a2  end  subgraph one  b1 --&gt; b2  end  subgraph one  c1 --&gt; c2  end</code></pre><h3 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h3><p><code>linkStyle</code> 后面的数字表示第几根线，从 <code>0</code> 开始。可以指定颜色和粗细。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph TB<br><span class="hljs-meta">  A--&gt;</span><span class="bash">B</span><br><span class="hljs-meta">  A--&gt;</span><span class="bash">c</span><br><span class="hljs-meta">  B--&gt;</span><span class="bash">D</span><br><span class="hljs-meta">  c--&gt;</span><span class="bash">D</span><br>  linkStyle 0 stroke:#0ff, stroke-width:2px;<br>  linkStyle 1 stroke:#f0f, stroke-width:3px;<br>  linkStyle 2 stroke:#ff9, stroke-width:4px;<br>  linkStyle 3 stroke:#ff5, stroke-width:5px;<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph TB  A--&gt;B  A--&gt;c  B--&gt;D  c--&gt;D  linkStyle 0 stroke:#0ff, stroke-width:2px;  linkStyle 1 stroke:#f0f, stroke-width:3px;  linkStyle 2 stroke:#ff9, stroke-width:4px;  linkStyle 3 stroke:#ff5, stroke-width:5px;</code></pre><p>可以设置节点背景，边框颜色，粗细，实线还是虚线</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>    id1(起点)--&gt;id2(终点)<br>    style id1 fill:#f9f,stroke:#333,stroke-width:4px<br>    style id2 fill:#ff3,stroke:#f77,stroke-width:2px,stroke-dasharray:5, 4<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR    id1(起点)--&gt;id2(终点)    style id1 fill:#f9f,stroke:#333,stroke-width:4px    style id2 fill:#ff3,stroke:#f77,stroke-width:2px,stroke-dasharray:5, 4</code></pre><h3 id="样式类"><a href="#样式类" class="headerlink" title="样式类"></a>样式类</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">graph LR<br>  A--B<br><span class="hljs-meta"></span><br><span class="hljs-meta">  %</span><span class="bash">% 定义样式类</span><br>  classDef classname fill:#f9f,stroke:#333,stroke-width:4px;<br><span class="hljs-meta"></span><br><span class="hljs-meta">  %</span><span class="bash">% 应用样式表，markdown里没效果</span><br>  class A className<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">graph LR  A---B  %% 定义样式类  classDef classname fill:#f9f,stroke:#333,stroke-width:4px;  %% 应用样式表，markdown里没效果  class A className</code></pre><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">classDef default fill:#f9f,stroke:#333,stroke-width:4px;<br></code></pre></div></td></tr></table></figure><p>定义一个名为 <code>default</code> 的类，节点没有指定特定样式类时，将都会应用这个样式类。</p><h2 id="序列图"><a href="#序列图" class="headerlink" title="序列图"></a>序列图</h2><h3 id="定义角色"><a href="#定义角色" class="headerlink" title="定义角色"></a>定义角色</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">participant 甲<br>participant 乙<br></code></pre></div></td></tr></table></figure><p>其中 <code>participant</code> 表示定义参与者， <code>甲</code> 和 <code>乙</code> 是就是角色名，可以是字符串，不含空格。可以使用<code>as</code>关键字给角色取个别名。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">participant 嬴政 as 秦始皇<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">sequenceDiagram  participant 甲  participant 乙  participant 嬴政 as 秦始皇</code></pre><p>注意：</p><ul><li>参与者按照出场先后顺序排列，如果要把某个角色排在前面，那么就一定要定义它。</li><li>预先定义的角色排列完毕之后。没有定义的统统按出场顺序跟在后面。</li><li>定义语句不一定要放在消息传递之前，在中间或者后面也是可以的。</li><li><code>Mermaid</code> 这里存在一个bug。角色名后面一定不能有空格。空格和角色名一起被视作另外一个角色</li></ul><h3 id="消息连线"><a href="#消息连线" class="headerlink" title="消息连线"></a>消息连线</h3><p>通过连线代表角色消息的过程。消息连线有<strong>虚线</strong>和<strong>实线</strong>两种基本类型。</p><ul><li>基本线型</li></ul><p>基本连线就两种，虚线和实线。用<code>-&gt;</code>表示实线，用<code>--&gt;</code>表示虚线。</p><ul><li>箭头连线</li></ul><p>在基本线型后面再加上一个<code>&gt;</code>，用<code>-&gt;&gt;</code>表示实线，用<code>--&gt;&gt;</code>表示虚线。</p><ul><li>终止符</li></ul><p>在基本线型中把<code>&gt;</code>修改为<code>x</code>代表终止消息。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">sequenceDiagram<br>  participant 嬴政 as 秦始皇<br>  participant 刘邦 as 汉高祖<br>  嬴政-&gt;刘邦:我大秦还在吗？（实线）<br>  刘邦--&gt;嬴政:还在，不过改名字了（虚线）<br>  嬴政-&gt;&gt;刘邦:为什么改名字了？（实线加个箭头）<br>  刘邦--&gt;&gt;嬴政:我觉得不好听？（虚线加个箭头）<br>  嬴政-x刘邦:我他么（箭头实线，加上叉）<br>  刘邦--x嬴政:拜拜了您嘞！（箭头虚线，加上叉）<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">sequenceDiagram  participant 嬴政 as 秦始皇  participant 刘邦 as 汉高祖  嬴政-&gt;刘邦:我大秦还在吗？（实线）  刘邦--&gt;嬴政:还在，不过改名字了（虚线）  嬴政-&gt;&gt;刘邦:为什么改名字了？（实线加个箭头）  刘邦--&gt;&gt;嬴政:我觉得不好听？（虚线加个箭头）  嬴政-x刘邦:我他么（箭头实线，加上叉）  刘邦--x嬴政:拜拜了您嘞！（箭头虚线，加上叉）</code></pre><h3 id="角色的任务期"><a href="#角色的任务期" class="headerlink" title="角色的任务期"></a>角色的任务期</h3><p>消息连线后面加上<code>+/-</code>，表示接收消息的角色这时候应该开始或者结束自身任务处理。</p><p>如果不是上面这种情况，是需要用 <code>activate</code> 和 <code>deactivate</code> 语句来启动和结束任务的。</p><p>开始处理用语句： <code>activate</code> 角色；处理完毕用语句： <code>deactivate</code> 角色。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">sequenceDiagram<br>  participant 甲<br>  participant 已<br>  甲--&gt;&gt;+已:你开始做任务1吧<br>  已--&gt;&gt;甲:收到，正在处理任务1<br>  甲-&gt;&gt;已:把任务2也处理下吧<br>  activate 已<br>  已-&gt;&gt;甲:我现在同时处理任务2<br>  已-x甲:任务2处理完成，结束任务2<br>  deactivate 已<br>  已-&gt;&gt;-甲:任务1处理完成，结束任务1<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">sequenceDiagram  participant 甲  participant 已  甲--&gt;&gt;+已:你开始做任务1吧  已--&gt;&gt;甲:收到，正在处理任务1  甲-&gt;&gt;已:把任务2也处理下吧  activate 已  已-&gt;&gt;甲:我现在同时处理任务2  已-x甲:任务2处理完成，结束任务2  deactivate 已  已-&gt;&gt;-甲:任务1处理完成，结束任务1</code></pre><h3 id="角色备注"><a href="#角色备注" class="headerlink" title="角色备注"></a>角色备注</h3><p>给角色贴上备注 <code>note</code> ，可以使其被更好地理解。备注的位置有角色的左边、右边或者上方，记住没有下方。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">Note left of|right of|over John,Alice: Text in note<br></code></pre></div></td></tr></table></figure><p>上面的语法很好理解， <code>Note</code> 是固定词汇，<code>left of|right of|over</code>是备注的位置，左、右或中，<code>John,Alice</code>是被贴备注的角色，最后面的是备注内容。注意其中<code>over</code>不带<code>of</code>；且可以同时为多个角色贴备注。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">sequenceDiagram<br>  participant 甲<br>  participant 已<br>  participant 丙<br>  Note over 甲,已:这是甲乙的备注<br>  Note over 甲:这是甲的备注<br>  Note over 已,丙:这是乙丙的备注<br>  Note over 已:这是乙的备注<br>  Note over 甲,丙:这是甲丙的备注<br>  Note over 丙:这是丙的备注<br>  Note left of 甲:这是甲备注左边Note left of 甲<br>  Note right of 丙:这是丙备注右边Note right of 丙<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">sequenceDiagram  participant 甲  participant 已  participant 丙  Note over 甲,已:这是甲乙的备注  Note over 甲:这是甲的备注  Note over 已,丙:这是乙丙的备注  Note over 已:这是乙的备注  Note over 甲,丙:这是甲丙的备注  Note over 丙:这是丙的备注  Note left of 甲:这是甲备注左边Note left of 甲  Note right of 丙:这是丙备注右边Note right of 丙</code></pre><h3 id="选择时序"><a href="#选择时序" class="headerlink" title="选择时序"></a>选择时序</h3><p>时序在处理的时候，肯定会遇上有条件执行的情况，它的语法如下</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">alt 可选语句说明<br>...<br>else<br>...<br>end<br></code></pre></div></td></tr></table></figure><p>其中的 <code>alt</code> 是 <code>alternative</code> 的缩写，即这有两组时序是二选一的，相当于<code>if-else</code>语句。</p><p>如果没有<code>else</code>，那么用另外一个关键词<code>opt</code>，他是<code>optional</code>的缩写。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">opt 条件说明<br>end<br></code></pre></div></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">sequenceDiagram<br>  participant A<br>  participant B<br><span class="hljs-meta">  A-&gt;</span><span class="bash">&gt;B: 你好吗？</span><br>  alt 如果B很好<br>    B--&gt;&gt;A: 我很好<br>  else 如果B不好<br>    B--&gt;&gt;A: 我不好<br>  end<br><span class="hljs-meta">  A-&gt;</span><span class="bash">&gt;B: 有空吗？打酱油去</span><br>  opt B没空，酱油还是得打<br>    B--&gt;&gt;A: 去吧<br>  end<br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">sequenceDiagram  participant A  participant B  A-&gt;&gt;B: 你好吗？  alt 如果B很好    B--&gt;&gt;A: 我很好  else 如果B不好    B--&gt;&gt;A: 我不好  end  A-&gt;&gt;B: 有空吗？打酱油去  opt B没空，酱油还是得打    B--&gt;&gt;A: 去吧  end</code></pre><h3 id="循环时序"><a href="#循环时序" class="headerlink" title="循环时序"></a>循环时序</h3><p>把几个语句用<code>loop end</code>语句圈起来，这就是时序循环。语法如下</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">loop 循环语句说明<br>...语句<br>end<br></code></pre></div></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">sequenceDiagram<br>  participant A<br>  participant B<br><span class="hljs-meta">  A-&gt;</span><span class="bash">&gt;B:有人吗？</span><br><span class="hljs-meta">  B-&gt;</span><span class="bash">&gt;A:没人</span><br>  loop 话痨<br>    B-&gt;&gt;A:不要应答<br>  end<br><span class="hljs-meta">  A--&gt;</span><span class="bash">&gt;B:三体看多了...</span><br></code></pre></div></td></tr></table></figure><pre><code class=" mermaid">sequenceDiagram  participant A  participant B  A-&gt;&gt;B:有人吗？  B-&gt;&gt;A:没人  loop 话痨    B-&gt;&gt;A:不要应答  end  A--&gt;&gt;B:三体看多了...</code></pre>]]></content>
    
    
    <categories>
      
      <category>博客教程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>markdown</tag>
      
      <tag>mermaid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Selenium的基本使用</title>
    <link href="/2021/06/19/Selenium%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
    <url>/2021/06/19/Selenium%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>在很多情况下，<code>Ajax</code>请求的接口通常会包含加密的参数，如<code>token</code>、<code>sign</code>等，如：<a href="https://dynamic2.scrape.cuiqingcai.com/">https://dynamic2.scrape.cuiqingcai.com/</a>，它的<code>Ajax</code>接口是包含一个<code>token</code>参数的，如图所示。</p><p><img src="Screenshot_5.webp"></p><p>由于接口的请求加上了<code>token</code>参数，如果不深入分析并找到<code>token</code>的构造逻辑，是难以直接模拟这些<code>Ajax</code>请求的。</p><p><code>Selenium</code>是一个自动化测试工具，利用它可以驱动浏览器执行特定的动作，如点击、下拉等操作，同时还可以获取浏览器当前呈现的页面源代码，做到可见即可爬。对于一些使用<code>JavaScript</code>动态渲染的页面来说，此种抓取方式非常有效。</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>确保已经正确安装好了<code>Chrome</code>浏览器并配置好了<code>ChromeDriver</code>。另外，还需要正确安装好<code>Python</code>的<code>Selenium</code>库。</p><h3 id="Selenium安装"><a href="#Selenium安装" class="headerlink" title="Selenium安装"></a>Selenium安装</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install selenium<br></code></pre></div></td></tr></table></figure><h3 id="chrome-driver安装"><a href="#chrome-driver安装" class="headerlink" title="chrome driver安装"></a>chrome driver安装</h3><p>查看安装的浏览器版本，在<code>chrome</code>搜索栏输入<code>chrome://version/</code>，会显示带当前浏览器的版本信息。</p><p><img src="Screenshot_1.webp"></p><p>在<a href="https://npm.taobao.org/mirrors/chromedriver/">https://npm.taobao.org/mirrors/chromedriver/</a>下载对应版本的<code>chrome driver</code>，一定要对应，否则不能使用。</p><p><img src="Screenshot_2.webp"></p><p>下载到本地后，将<code>chromedriver.exe</code>分别拷贝到<code>chrome.exe</code>和<code>python</code>安装路径下。</p><p><img src="Screenshot_3.webp"></p><p><img src="Screenshot_4.webp"></p><p>以上，安装就完成了！</p><h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><p>首先来看一下<code>Selenium</code>有一些怎样的功能。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><span class="hljs-keyword">from</span> selenium.webdriver.common.by <span class="hljs-keyword">import</span> By<br><span class="hljs-keyword">from</span> selenium.webdriver.common.keys <span class="hljs-keyword">import</span> Keys<br><span class="hljs-keyword">from</span> selenium.webdriver.support <span class="hljs-keyword">import</span> expected_conditions <span class="hljs-keyword">as</span> EC<br><span class="hljs-keyword">from</span> selenium.webdriver.support.wait <span class="hljs-keyword">import</span> WebDriverWait<br><br>browser = webdriver.Chrome()<br><span class="hljs-keyword">try</span>:<br>    browser.get(<span class="hljs-string">&#x27;https://www.baidu.com&#x27;</span>)<br>    <span class="hljs-built_in">input</span> = browser.find_element_by_id(<span class="hljs-string">&#x27;kw&#x27;</span>)<br>    <span class="hljs-built_in">input</span>.send_keys(<span class="hljs-string">&#x27;Python&#x27;</span>)<br>    <span class="hljs-built_in">input</span>.send_keys(Keys.ENTER)<br>    wait = WebDriverWait(browser, <span class="hljs-number">10</span>)<br>    wait.until(EC.presence_of_element_located((By.ID, <span class="hljs-string">&#x27;content_left&#x27;</span>)))<br>    <span class="hljs-built_in">print</span>(browser.current_url)<br>    <span class="hljs-built_in">print</span>(browser.get_cookies())<br>    <span class="hljs-built_in">print</span>(browser.page_source)<br><span class="hljs-keyword">finally</span>:<br>    browser.close()<br></code></pre></div></td></tr></table></figure><p>运行代码后会自动弹出一个<code>Chrome</code>浏览器，浏览器会跳转到百度，然后在搜索框中输入<code>Python</code>，接着跳转到搜索结果页，如图所示。</p><p><img src="Screenshot_6.webp"></p><p>此时在控制台的输出结果如下：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">href=&quot;http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_&quot; target=&quot;_blank&quot;&gt;你都用 &lt;em&gt;Python&lt;/em&gt; 来做什么? - 知乎&lt;/a&gt;&lt;/h3&gt;&lt;div class=&quot;c-row c-gap-top-small&quot;&gt;&lt;div class=&quot;general_image_pic c-span3&quot; style=&quot;position:relative;top:2px;&quot;&gt;&lt;a class=&quot;c-img c-img3 c-img-radius-large&quot; style=&quot;height:85px&quot; href=&quot;http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_&quot; target=&quot;_blank&quot;&gt;&lt;img class=&quot;c-img c-img3 c-img-radius-large&quot; src=&quot;https://dss1.bdstatic.com/6OF1bjeh1BF3odCf/it/u=958012630,1445793633&amp;amp;fm=218&amp;amp;app=92&amp;amp;f=JPEG?w=121&amp;amp;h=75&amp;amp;s=44A638725CB7469C82F4FFF40200D025&quot; style=&quot;height:85px;&quot;&gt;&lt;span class=&quot;c-img-border c-img-radius-large&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;&lt;div class=&quot;c-span9 c-span-last&quot;&gt;&lt;div class=&quot;c-abstract&quot;&gt;&lt;span class=&quot; newTimeFactor_before_abs c-color-gray2 m&quot;&gt;2019年10月17日&amp;nbsp;&lt;/span&gt;所有项目的代码和数据在Github:interesting-&lt;em&gt;python&lt;/em&gt; 如果你也想用&lt;em&gt;Python&lt;/em&gt;获取数据,进行有趣的 <br>数据分析,Alfred数据室应众多读者要求出品的《实战玩转&lt;em&gt;python&lt;/em&gt;爬虫》课程将会是你的好帮手...&lt;/div&gt;&lt;style&gt;.user-avatar &#123;<br>        display: flex;<br>        flex-direction: row;<br>        align-items: center;<br>        justify-content: flex-start;<br>&#125;&lt;/style&gt;&lt;div class=&quot;f13 c-gap-top-xsmall se_st_footer user-avatar&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_&quot; class=&quot;c-showurl c-color-gray&quot; style=&quot;text-decoration:none;position:relative;&quot;&gt;&lt;div class=&quot;c-img c-img-circle c-gap-right-xsmall&quot; style=&quot;display: inline-block;width: 16px;height: 16px;position: relative;top: 3px;vertical-align:top;&quot;&gt;&lt;span class=&quot;c-img-border c-img-source-border c-img-radius-large&quot;&gt;&lt;/span&gt;&lt;img src=&quot;https://ss0.baidu.com/6ONWsjip0QIZ8tyhnq/it/u=493147230,3096476255&amp;amp;fm=195&amp;amp;app=88&amp;amp;f=JPEG?w=200&amp;amp;h=200&quot;&gt;&lt;/div&gt;知乎&lt;/a&gt;&lt;div class=&quot;c-tools c-gap-left&quot; id=&quot;tools_9637258987948217910_8&quot; data-tools=&quot;&#123;&amp;quot;title&amp;quot;:&amp;quot;你都用 Python 来做什么? - 知乎&amp;quot;,&amp;quot;url&amp;quot;:&amp;quot;http://www.baidu.com/link?url=CYEq_OJxbiLcx5LothJSzfcQI9xeTzMYkPSFg2HYyceDRTQi8o6Fk8oLyRG5BTI8remsEFjvd4qN8vGLA-EBg_&amp;quot;&#125;&quot;&gt;&lt;i class=&quot;c-icon f13&quot;&gt;&lt;/i&gt;&lt;/div&gt;&lt;span class=&quot;c-icons-outer&quot;&gt;&lt;span class=&quot;c-icons-inner&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;style&gt;.snapshoot, .snapshoot:visited &#123;<br>        color: #9195A3!important;<br>    &#125;<br>    .snapshoot:active, .snapshoot:hover &#123;<br>        color: #626675!important;<br>    &#125;&lt;/style&gt;&lt;a data-click=&quot;&#123;&#x27;rsv_snapshot&#x27;:&#x27;1&#x27;&#125;&quot; href=&quot;http://cache.baiducontent.com/c?m=JgFgeas2iHrh6pppvD-MHkvHPj9DsOz-wd718JIlv_IJy7d0KdQ2HvVIYznaRWwGrKHLEtVbqjR4uoZg6X_h4g62yFf5FgBVDUBkRfcWrOG&amp;amp;p=8b2a9715d9c647f904aec5344f57&amp;amp;newp=8b2a9729c5df1bb508e291784f4a92695d0fc20e3ad0d001298ffe0cc4241a1a1a3aecbf2c261600d7c279650aab4a5feff336743d0034f1f689df08d2ecce7e439b3b6e6a&amp;amp;s=45c48cce2e2d7fbd&amp;amp;user=baidu&amp;amp;fm=sc&amp;amp;query=Python&amp;amp;qid=dc4c1a0300139b42&amp;amp;p1=8&quot; target=&quot;_blank&quot; class=&quot;m c-gap-left c-color-gray kuaizhao snapshoot&quot;&gt;百度快照&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br></code></pre></div></td></tr></table></figure><p>源代码过长，在此省略。可以看到，当前得到的<code>URL</code>、<code>Cookies</code>和源代码都是浏览器中的真实内容。所以说，如果用<code>Selenium</code>来驱动浏览器加载网页的话，就可以直接拿到<code>JavaScript</code>渲染的结果了，不用担心使用的是什么加密系统。</p><p>了解一下<code>Selenium</code>的用法。</p><h2 id="声明浏览器对象"><a href="#声明浏览器对象" class="headerlink" title="声明浏览器对象"></a>声明浏览器对象</h2><p><code>Selenium</code>支持非常多的浏览器，如<code>Chrome</code>、<code>Firefox</code>、<code>Edge</code>等，还有<code>Android</code>、<code>BlackBerry</code>等手机端的浏览器。</p><p>可以用如下方式进行初始化：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br>browser = webdriver.Chrome()<br>browser = webdriver.Firefox()<br>browser = webdriver.Edge()<br>browser = webdriver.Safari()<br><br><span class="hljs-comment"># 如果你没有把chromedriver添加到系统环境变量中，executable_path参数要附上chromedriver的绝对路径</span><br>browser = webdriver.Chrome(executable_path=<span class="hljs-string">&quot;D:/tools/chromedriver&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>这样就完成了浏览器对象的初始化并将其赋值为<code>browser</code>对象。接下来，要做的就是调用<code>browser</code>对象，让其执行各个动作以模拟浏览器操作。</p><h2 id="访问页面"><a href="#访问页面" class="headerlink" title="访问页面"></a>访问页面</h2><p>可以用<code>get</code>方法请求页面，只需要把参数传入连接<code>URL</code>即可。比如，这里用<code>get</code>方法访问淘宝，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br>browser = webdriver.Chrome()<br>browser.get(<span class="hljs-string">&#x27;https://www.taobao.com&#x27;</span>)<br><span class="hljs-built_in">print</span>(browser.page_source)<br>browser.close()<br></code></pre></div></td></tr></table></figure><p>运行后会弹出<code>Chrome</code>浏览器并且自动访问淘宝，然后控制台会输出淘宝页面的源代码，随后浏览器关闭。</p><h2 id="查找节点"><a href="#查找节点" class="headerlink" title="查找节点"></a>查找节点</h2><p><code>Selenium</code>可以驱动浏览器完成各种操作，比如填充表单、模拟点击等。举个例子，当想要完成向某个输入框输入文字的操作时，首先需要知道这个输入框在哪，而 <code>Selenium</code>提供了一系列查找节点的方法，可以用这些方法来获取想要的节点，以便执行下一步动作或者提取信息。</p><h3 id="单个节点"><a href="#单个节点" class="headerlink" title="单个节点"></a>单个节点</h3><p>想要从淘宝页面中提取搜索框这个节点，首先要观察它的源代码。</p><p>可以发现，它的<code>id</code>是<code>q</code>，<code>name</code>也是<code>q</code>，此外还有许多其他属性。此时就可以用多种方式获取它了。比如，<code>find_element_by_name</code>代表根据<code>name</code>值获取，<code>find_element_by_id</code>则是根据<code>id</code>获取，另外，还有根据<code>XPath</code>、<code>CSS</code>选择器等获取的方式。</p><p>这里使用<code>3</code>种方式获取输入框，分别是根据<code>id</code>、<code>CSS</code>选择器和<code>XPath</code>获取，它们返回的结果完全一致。运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;fbca625cd8bb4eb98ae76bb68a23bd4f&quot;</span>,element=<span class="hljs-string">&quot;de630823-02d3-409a-ba19-4e892a0fad15&quot;</span>)&gt; <br>&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;fbca625cd8bb4eb98ae76bb68a23bd4f&quot;</span>, element=<span class="hljs-string">&quot;de630823-02d3-409a-ba19-4e892a0fad15&quot;</span>)&gt; <br>[&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;fbca625cd8bb4eb98ae76bb68a23bd4f&quot;</span>, element=<span class="hljs-string">&quot;de630823-02d3-409a-ba19-4e892a0fad15&quot;</span>)&gt;]<br></code></pre></div></td></tr></table></figure><p>这3个节点的类型是一致的，都是<code>WebElement</code>。</p><p>这里列出所有获取单个节点的方法：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">find_element_by_id <br>find_element_by_name <br>find_element_by_xpath <br>find_element_by_link_text <br>find_element_by_partial_link_text <br>find_element_by_tag_name <br>find_element_by_class_name <br>find_element_by_css_selector<br></code></pre></div></td></tr></table></figure><h3 id="多个节点"><a href="#多个节点" class="headerlink" title="多个节点"></a>多个节点</h3><p>多如果在网页中只查找一个目标，那么完全可以用<code>find_element</code>方法。但如果有多个节点需要查找，再用<code>find_element</code>方法，就只能得到第1个节点了。如果要查找所有满足条件的节点，需要用<code>find_elements</code>这样的 方法。注意，在这个方法的名称中， 注<code>element</code>多了一个多<code>s</code>，注意区分。</p><p>举个例子，假如要查找淘宝左侧导航条的所有条目，就可以这样来实现：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br>browser = webdriver.Chrome()<br>browser.get(<span class="hljs-string">&#x27;https://www.taobao.com&#x27;</span>)<br>lis = browser.find_elements_by_css_selector(<span class="hljs-string">&#x27;.service-bd li&#x27;</span>)<br><span class="hljs-built_in">print</span>(lis)<br>browser.close()<br></code></pre></div></td></tr></table></figure><p>结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">[&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class="hljs-string">&quot;01e78303-6103-4f1a-96dc-0386a755a9f4&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class="hljs-string">&quot;7a4e764e-9a05-4dad-9188-636512591835&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class="hljs-string">&quot;16219266-ff57-4f42-95ab-4b8dbb4b811a&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class="hljs-string">&quot;4f23598b-3ca6-4b20-9192-3e06e98984df&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class="hljs-string">&quot;d837e630-e546-4f8b-babd-e3fdc539d2a6&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class="hljs-string">&quot;1da195c9-d959-4d47-b729-21d8eac2756f&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class="hljs-string">&quot;175c2217-dbe6-4d27-997f-58fbe46cbf1a&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class="hljs-string">&quot;4747359f-d93c-4a7a-976e-501087d96e5f&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class="hljs-string">&quot;2537bb34-3a26-4ccd-8f53-4ebbef5c70b2&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class="hljs-string">&quot;04210bc7-ebba-44ef-8757-d88dfd0d023f&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class="hljs-string">&quot;7bd1b6e4-31e5-4120-8017-afc59ca56f48&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class="hljs-string">&quot;930a7b6c-26ff-468c-896e-6204b0555747&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class="hljs-string">&quot;81305b6e-0893-46d2-b7a7-89a85c00132c&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class="hljs-string">&quot;763237aa-5925-426d-9a76-90b3567870eb&quot;</span>)&gt;, &lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;f9550f7bf1204e4d481803cf7a69c736&quot;</span>, element=<span class="hljs-string">&quot;60ca3595-3f74-4f1d-9224-7beb9e381a4b&quot;</span>)&gt;]<br></code></pre></div></td></tr></table></figure><p>得到的内容变成了列表类型，列表中的每个节点都是<code>WebElement</code>类型。</p><p>也就是说，如果用<code>find_element</code>方法，只能获取匹配的第一个节点，结果是<code>WebElement</code>类型。如果用<code>find_elements</code>方法，则结果是列表类型，列表中的每个节点是<code>WebElement</code>类型。</p><p>这里列出所有获取多个节点的方法：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">find_elements_by_id<br>find_elements_by_name<br>find_elements_by_xpath<br>find_elements_by_link_text<br>find_elements_by_partial_link_text<br>find_elements_by_tag_name<br>find_elements_by_class_name<br>find_elements_by_css_selector<br></code></pre></div></td></tr></table></figure><p>当然，也可以直接用<code>find_elements</code>方法来选择，这时可以这样写：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">lis = browser.find_elements(By.CSS_SELECTOR, <span class="hljs-string">&#x27;.service-bd li&#x27;</span>) <br></code></pre></div></td></tr></table></figure><p>结果是完全一致的。</p><h3 id="节点交互"><a href="#节点交互" class="headerlink" title="节点交互"></a>节点交互</h3><p><code>Selenium</code>可以驱动浏览器来执行一些操作，或者说可以让浏览器模拟执行一些动作。比较常见的用法有：输入文字时用<code>send_keys</code>方法，清空文字时用<code>clear</code>方法，点击按钮时用<code>click</code>方法。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><br>browser = webdriver.Chrome()<br>browser.get(<span class="hljs-string">&#x27;https://www.taobao.com&#x27;</span>)<br><span class="hljs-built_in">input</span> = browser.find_element_by_id(<span class="hljs-string">&#x27;q&#x27;</span>)<br><span class="hljs-built_in">input</span>.send_keys(<span class="hljs-string">&#x27;apple&#x27;</span>)<br>time.sleep(<span class="hljs-number">1</span>)<br><span class="hljs-built_in">input</span>.clear()<br><span class="hljs-built_in">input</span>.send_keys(<span class="hljs-string">&#x27;小米&#x27;</span>)<br>button = browser.find_element_by_class_name(<span class="hljs-string">&#x27;btn-search&#x27;</span>)<br>button.click()<br></code></pre></div></td></tr></table></figure><p>这里首先驱动浏览器打开淘宝，用<code>find_element_by_id</code>方法获取输入框，然后用<code>send_keys</code>方法输入<code>iPhone</code>文字，等待一秒后用<code>clear</code>方法清空输入框，接着再次调用<code>send_keys</code>方法输入<code>iPad</code>文字，之后再用<code>find_element_by_class_name</code>方法获取搜索按钮，最后调用<code>click</code>方法完成搜索动作。</p><h3 id="动作链"><a href="#动作链" class="headerlink" title="动作链"></a>动作链</h3><p>在上面的实例中，一些交互动作都是针对某个节点执行的。比如，对于输入框，调用它的输入文字和清空文字方法；对于按钮，调用它的点击方法。其实，还有另外一些操作，它们没有特定的执行对象，比如鼠标拖拽、键盘按键等，这些动作用另一种方式来执行，那就是动作链。</p><p>比如，现在要实现一个节点的拖拽操作，将某个节点从一处拖拽到另外一处，可以这样实现：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><span class="hljs-keyword">from</span> selenium.webdriver <span class="hljs-keyword">import</span> ActionChains<br><br>browser = webdriver.Chrome()<br>url = <span class="hljs-string">&#x27;http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable&#x27;</span><br><br>browser.get(url)<br>browser.switch_to.frame(<span class="hljs-string">&#x27;iframeResult&#x27;</span>)<br>source = browser.find_element_by_css_selector(<span class="hljs-string">&quot;#draggable&quot;</span>)<br>target = browser.find_element_by_css_selector(<span class="hljs-string">&quot;#droppable&quot;</span>)<br>actions = ActionChains(browser)<br>actions.drag_and_drop(source, target)<br>actions.perform()<br></code></pre></div></td></tr></table></figure><p>打开网页中的一个拖拽实例，依次选中要拖拽的节点和拖拽到的目标节点，接着声明<code>ActionChains</code>对象并将其赋值为<code>actions</code>变量，然后通过调用<code>actions</code>变量的<code>drag_and_drop</code>方法，再调用<code>perform</code>方法执行动作，此时就完成了拖拽操作，如图所示：</p><p><img src="Screenshot_7.webp"></p><p>拖拽前页面：</p><p><img src="Screenshot_8.webp"></p><h3 id="执行执JavaScript"><a href="#执行执JavaScript" class="headerlink" title="执行执JavaScript"></a>执行执<code>JavaScript</code></h3><p><code>SeleniumAPI</code>并没有提供实现某些操作的方法，比如，下拉进度条。但它可以直接模拟运行<code>JavaScript</code>，此时使用<code>execute_script</code>方法即可实现，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br>browser = webdriver.Chrome()<br>browser.get(<span class="hljs-string">&#x27;https://www.zhihu.com/explore&#x27;</span>)<br>browser.execute_script(<span class="hljs-string">&#x27;window.scrollTo(0, document.body.scrollHeight)&#x27;</span>)<br>browser.execute_script(<span class="hljs-string">&#x27;alert(&quot; To Bottom)&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>这里利用<code>execute_script</code>方法将进度条下拉到最底部，然后弹出<code>alert</code>提示框。</p><p>有了这个方法，基本上<code>API</code>没有提供的所有功能都可以用执行<code>JavaScript</code>的方式来实现了。</p><h2 id="获取节点信息"><a href="#获取节点信息" class="headerlink" title="获取节点信息"></a>获取节点信息</h2><p><code>Selenium</code>已经提供了选择节点的方法，并且返回的是<code>WebElement</code>类型，那么它也有相关的方法和属性来直接提取节点信息，如属性、文本等。这样的话，就可以不用通过解析源代码来提取信息了，非常方便。</p><h3 id="获取属性"><a href="#获取属性" class="headerlink" title="获取属性"></a>获取属性</h3><p>可以使用<code>get_attribute</code>方法来获取节点的属性，但是前提是得先选中这个节点，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br>browser = webdriver.Chrome()<br>url = <span class="hljs-string">&#x27;https://www.baidu.com/&#x27;</span><br>browser.get(url)<br>logo = browser.find_element_by_class_name(<span class="hljs-string">&#x27;index-logo-src&#x27;</span>)<br><span class="hljs-built_in">print</span>(logo)<br><span class="hljs-built_in">print</span>(logo.get_attribute(<span class="hljs-string">&#x27;src&#x27;</span>))<br></code></pre></div></td></tr></table></figure><p>运行之后，程序便会驱动浏览器打开该页面，然后获取<code>class</code>为<code>logo-image</code>的节点，最后打印出它的<code>src</code>属性。</p><p>返回结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;c90d6158ff9e3e6ba88d5f9b9358a358&quot;</span>, element=<span class="hljs-string">&quot;c99170cd-b0c1-44b6-a0a0-f4ccf1105e91&quot;</span>)&gt;<br>https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png<br></code></pre></div></td></tr></table></figure><p>通过<code>get_attribute</code>方法，只需要传入想要获取的属性名，就可以得到它的值了。</p><h3 id="获取文本值"><a href="#获取文本值" class="headerlink" title="获取文本值"></a>获取文本值</h3><p>每个<code>WebElement</code>节点都有<code>text</code>属性，直接调用这个属性就可以得到节点内部的文本信息，这相当于<code>pyquery</code>的<code>text</code>方法，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br>browser = webdriver.Chrome()<br>url = <span class="hljs-string">&#x27;https://holychan.ltd/archives/&#x27;</span><br>browser.get(url)<br>title = browser.find_element_by_class_name(<span class="hljs-string">&#x27;title-h2&#x27;</span>)<br><span class="hljs-built_in">print</span>(title)<br><span class="hljs-built_in">print</span>(title.text)<br></code></pre></div></td></tr></table></figure><p>结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;79f97c0aa935723e276438a5fff2610c&quot;</span>, element=<span class="hljs-string">&quot;b86ec344-cb00-4538-b9e9-8959a076bc75&quot;</span>)&gt;<br>文章归档<br></code></pre></div></td></tr></table></figure><h3 id="获取获ID、位置、标签名、大小"><a href="#获取获ID、位置、标签名、大小" class="headerlink" title="获取获ID、位置、标签名、大小"></a>获取获ID、位置、标签名、大小</h3><p><code>WebElement</code>节点还有一些其他属性，比如<code>id</code>属性可以获取节点<code>id</code>，<code>location</code>属性可以获取该节点在页面中的相对位置，<code>tag_name</code>属性可以获取标签名称，<code>size</code>属性可以获取节点的大小，也就是宽高，这些 属性有时候还是很有用的。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br>browser = webdriver.Chrome() <br>url = <span class="hljs-string">&#x27;https://dynamic2.scrape.cuiqingcai.com/&#x27;</span> <br>browser.get(url) <br><span class="hljs-built_in">input</span> = browser.find_element_by_class_name(<span class="hljs-string">&#x27;logo-title&#x27;</span>) <br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">input</span>.<span class="hljs-built_in">id</span>) <br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">input</span>.location) <br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">input</span>.tag_name) <br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">input</span>.size) <br></code></pre></div></td></tr></table></figure><p>这里首先获得<code>class</code>为<code>logo-title</code>这个节点，然后调用其<code>id</code>、<code>location</code>、<code>tag_name</code>、<code>size</code>属性来获取对应的属性值。</p><h2 id="切换Frame"><a href="#切换Frame" class="headerlink" title="切换Frame"></a>切换Frame</h2><p>网页中有一种节点叫作<code>iframe</code>，也就是子<code>Frame</code>，相当于页面的子页面，它的结构和外部网页的结构完全一致。<code>Selenium</code>打开页面后，默认是在父级<code>Frame</code>里面操作，而此时如果页面中还有子<code>Frame</code>，<code>Selenium</code>是不能获取到子<code>Frame</code>里面的节点的。这时就需要使用<code>switch_to.frame</code>方法来切换<code>Frame</code>。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><span class="hljs-keyword">from</span> selenium.common.exceptions <span class="hljs-keyword">import</span> NoSuchElementException<br>browser = webdriver.Chrome()<br>url = <span class="hljs-string">&#x27;http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable&#x27;</span><br>browser.get(url)<br>browser.switch_to(<span class="hljs-string">&#x27;iframeResult&#x27;</span>)<br><span class="hljs-keyword">try</span>:<br>    logo = browser.find_element_by_class_name(<span class="hljs-string">&#x27;logo&#x27;</span>)<br><span class="hljs-keyword">except</span> NoSuchElementException:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;No logo found&#x27;</span>)<br>browser.switch_to.parent_frame()<br>logo = browser.find_element_by_class_name(<span class="hljs-string">&#x27;logo&#x27;</span>)<br><span class="hljs-built_in">print</span>(logo)<br><span class="hljs-built_in">print</span>(logo.text)<br></code></pre></div></td></tr></table></figure><p>控制台输出：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">No logo found<br>&lt;selenium.webdriver.remote.webelement.WebElement (session=<span class="hljs-string">&quot;ce74c2d83e0aca64c9ef8c4540b2fe16&quot;</span>, element=<span class="hljs-string">&quot;1d2c3c25-bd01-4b9a-b11b-16b8534bf6c2&quot;</span>)&gt;<br>RUNOOB.COM<br></code></pre></div></td></tr></table></figure><p>首先通过<code>switch_to.frame</code>方法切换到子<code>Frame</code>里面，然后尝试获取子<code>Frame</code>里的<code>logo</code>节点（这是不能找到的），如果找不到的话，就会抛出<code>NoSuchElementException</code>异常，异常被捕捉之后，就会输出<code>No logo found</code>。接下来，我们需要重新切换回父级<code>Frame</code>，然后再次重新获取节点，发现此时可以成功获取了。</p><p>所以，当页面中包含子<code>Frame</code>时，如果想获取子<code>Frame</code>中的节点，需要先调用<code>switch_to.frame</code>方法切换到对应的<code>Frame</code>，然后再进行操作。</p><h2 id="延时等待"><a href="#延时等待" class="headerlink" title="延时等待"></a>延时等待</h2><p>在<code>Selenium</code>中，<code>get</code>方法会在网页框架加载结束后结束执行，此时如果获取<code>page_source</code>，可能并不是浏览器完全加载完成的页面，如果某些页面有额外的<code>Ajax</code>请求，在网页源代码中也不一定能成功获取 \到。所以，这里需要延时等待一定时间，确保节点已经加载出来。</p><p>这里等待的方式有两种：一种是隐式等待，一种是显式等待。</p><h3 id="隐式等待"><a href="#隐式等待" class="headerlink" title="隐式等待"></a>隐式等待</h3><p>当使用隐式等待执行测试的时候，如果<code>Selenium</code>没有在<code>DOM</code>中找到节点，将继续等待，超出设定时间后，则抛出找不到节点的异常。换句话说，隐式等待可以在我们查找节点而节点并没有立即出现的时候， 等待一段时间再查找<code>DOM</code>，默认的时间是<code>0</code>。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br>browser = webdriver.Chrome()<br>browser.implicitly_wait(<span class="hljs-number">10</span>)<br>browser.get(<span class="hljs-string">&#x27;https://dynamic2. scrape.cuiqingcai.com/&#x27;</span>) <br><span class="hljs-built_in">input</span> = browser.find_element_by_class_name(<span class="hljs-string">&#x27;logo-image&#x27;</span>) <br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">input</span>)<br></code></pre></div></td></tr></table></figure><h2 id="selenium提取数据"><a href="#selenium提取数据" class="headerlink" title="selenium提取数据"></a>selenium提取数据</h2><h3 id="driver对象的常用属性和方法"><a href="#driver对象的常用属性和方法" class="headerlink" title="driver对象的常用属性和方法"></a>driver对象的常用属性和方法</h3><ol><li><code>driver.page_source</code> 当前标签页游览器渲染后的网页源代码</li><li><code>driver.current_url</code> 当前标签页的url</li><li><code>drive.close</code> 关闭当前标签页，如果只有一个标签页则关闭整个浏览器</li><li><code>drice.quit</code> 关闭浏览器</li><li><code>drive.forward</code> 页面前进</li><li><code>drive.back</code> 页面后退</li><li><code>drive.save_screenshot(imgname)</code> 页面截图</li></ol><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br>driver = webdriver.Chrome(executable_path=<span class="hljs-string">&quot;D:/tools/chromedriver&quot;</span>)<br><br>driver.get(<span class="hljs-string">&quot;https://www.baidu.com&quot;</span>)<br><br><span class="hljs-comment"># # 在对话框输入python</span><br>driver.find_element_by_id(<span class="hljs-string">&quot;kw&quot;</span>).send_keys(<span class="hljs-string">&#x27;python&#x27;</span>)<br><br><span class="hljs-comment"># # 点击百度搜索</span><br>driver.find_element_by_id(<span class="hljs-string">&quot;su&quot;</span>).click()<br><br><span class="hljs-comment"># time.sleep(6)</span><br><span class="hljs-comment"># 保存搜索截图</span><br>driver.save_screenshot(<span class="hljs-string">&quot;baidu_python.png&quot;</span>)<br><br><br><span class="hljs-comment"># 显示源码</span><br><span class="hljs-built_in">print</span>(driver.page_source)<br><br><span class="hljs-comment"># 显示响应对应的url</span><br><span class="hljs-built_in">print</span>(driver.current_url)<br><span class="hljs-comment"># https://www.baidu.com/</span><br><br><span class="hljs-comment"># 显示标题</span><br><span class="hljs-built_in">print</span>(driver.title)<br><span class="hljs-comment"># 百度一下，你就知道</span><br><br>time.sleep(<span class="hljs-number">2</span>)<br>driver.get(<span class="hljs-string">&#x27;http://www.douban.com&#x27;</span>)<br>time.sleep(<span class="hljs-number">2</span>)<br>driver.back()<br>time.sleep(<span class="hljs-number">2</span>)<br>driver.foward()<br>time.sleep(<span class="hljs-number">2</span>)<br>driver.close()<br><br>driver.quit()<br></code></pre></div></td></tr></table></figure><h3 id="driver对象定位标签元素获取标签对象的方法"><a href="#driver对象定位标签元素获取标签对象的方法" class="headerlink" title="driver对象定位标签元素获取标签对象的方法"></a>driver对象定位标签元素获取标签对象的方法</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">driver.find_element(s)_by_id()     <span class="hljs-comment"># 返回一个元素</span><br>driver.find_element(s)_by_class_name()   <span class="hljs-comment"># 根据类名获取元素列表</span><br>driver.find_element(s)_by_name()       <span class="hljs-comment"># 根据标签的name属性返回包含标签对象元素的列表</span><br>driver.find_element(s)_by_xpath()      <span class="hljs-comment"># 返回一个包含元素的列表</span><br>driver.find_element(s)_by_link_text()      <span class="hljs-comment"># 根据链接文本获取元素列表</span><br>driver.find_element(s)_by_partial_link_text()  <span class="hljs-comment"># 根据链接包含的文本获取元素列表</span><br>driver.find_element(s)_by_tag_name()   <span class="hljs-comment"># 根据标签名获取元素列表</span><br>driver.find_element(s)_by_css_selector()   <span class="hljs-comment">#根据css选择器来获取元素</span><br></code></pre></div></td></tr></table></figure><p><code>find_element</code>和<code>find_elements</code>的区别在于，多了s就返回列表，没有s就返回匹配到的第一个标签对象。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br><br>driver = webdriver.Chrome(executable_path=<span class="hljs-string">&quot;D:/tools/chromedriver&quot;</span>)<br><br>url = <span class="hljs-string">&quot;https://www.baidu.com&quot;</span><br><br>driver.get(url)<br><br><span class="hljs-comment"># 通过xpath进行元素定位</span><br><span class="hljs-comment"># driver.find_element_by_xpath(&#x27;//*[@id=&quot;kw&quot;]&#x27;).send_keys(&quot;python&quot;)</span><br><br><span class="hljs-comment"># 通过css选择器进行元素定位</span><br><span class="hljs-comment"># driver.find_element_by_css_selector(&quot;#kw&quot;).send_keys(&quot;python&quot;)</span><br><br><span class="hljs-comment"># 通过name属性值进行元素定位</span><br>driver.find_element_by_name(<span class="hljs-string">&quot;wd&quot;</span>).send_keys(<span class="hljs-string">&quot;python&quot;</span>)<br><br><span class="hljs-comment"># 目标元素在当前HTML是唯一标签的时候或者是众多定位出来的标签中的第一个的时候</span><br>driver.find_element_by_tag_name(<span class="hljs-string">&quot;&quot;</span>)<br><br>driver.find_element_by_id(<span class="hljs-string">&quot;su&quot;</span>).click()<br><br>time.sleep(<span class="hljs-number">2</span>)<br><br>driver.quit()<br></code></pre></div></td></tr></table></figure><h3 id="标签对象提取文本内容和属性值"><a href="#标签对象提取文本内容和属性值" class="headerlink" title="标签对象提取文本内容和属性值"></a>标签对象提取文本内容和属性值</h3><ul><li><p>获取文本<code>element.text</code></p><ul><li>通过定位获取的标签对象的<code>text</code>属性，获取文本内容</li></ul></li><li><p>获取属性值`element.get_attribute(‘属性名’)</p><ul><li>通过定位获取标签对象的<code>get_attribute</code>函数，获取文本内容</li></ul></li></ul><p>代码实现：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br><br>driver = webdriver.Chrome(executable_path=<span class="hljs-string">&quot;D:/tools/chromedriver&quot;</span>)<br><br>driver.get(<span class="hljs-string">&quot;https://holychan.ltd/&quot;</span>)<br><br>title = driver.find_element_by_tag_name(<span class="hljs-string">&quot;h2&quot;</span>)<br><br><span class="hljs-built_in">print</span>(title.text)<br><span class="hljs-comment"># Holy的个人站点</span><br><br>email = driver.find_element_by_xpath(<span class="hljs-string">&quot;//*[@id=&#x27;footer&#x27;]/div[2]/div/div/ul[1]/li/a&quot;</span>)<br><br><span class="hljs-built_in">print</span>(email.get_attribute(<span class="hljs-string">&#x27;href&#x27;</span>))<br><span class="hljs-comment"># mailto:espholychan@outlook.com</span><br><br>driver.quit()<br></code></pre></div></td></tr></table></figure><h2 id="selenium的其他用法"><a href="#selenium的其他用法" class="headerlink" title="selenium的其他用法"></a>selenium的其他用法</h2><h3 id="标签页的切换"><a href="#标签页的切换" class="headerlink" title="标签页的切换"></a>标签页的切换</h3><p>当selenium打开多个标签页时，如何控制浏览器在不同的标签页中进行切换呢?</p><ul><li><p>获取所有标签页的窗口句柄</p></li><li><p>利用窗口句柄切换到句柄指向的标签页</p></li></ul><p>具体方法：</p><ol><li>获取当前所有标签页的句柄构成的列表</li></ol><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">current_windows = driver.window_handles<br></code></pre></div></td></tr></table></figure><ol start="2"><li>根据标签页的句柄列表索引下标进行切换</li></ol><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">driver.switch_to.window(current_windows[<span class="hljs-number">0</span>])<br></code></pre></div></td></tr></table></figure><p>案列：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br>url = <span class="hljs-string">&quot;https://sz.58.com/&quot;</span><br><br>driver = webdriver.Chrome(executable_path=<span class="hljs-string">&quot;D:/tools/chromedriver&quot;</span>)<br><br>driver.get(url)<br><br><span class="hljs-built_in">print</span>(driver.current_url)<br><span class="hljs-built_in">print</span>(driver.window_handles)<br><br><span class="hljs-comment"># 定位并点击租房按钮</span><br>driver.find_element_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;fcNav&quot;]/em/a[1]&#x27;</span>).click()<br><br><br><span class="hljs-built_in">print</span>(driver.current_url)<br><span class="hljs-built_in">print</span>(driver.window_handles)<br><br>time.sleep(<span class="hljs-number">3</span>)<br>current_windows = driver.window_handles<br><br>driver.switch_to.window(current_windows[<span class="hljs-number">0</span>])<br><br>time.sleep(<span class="hljs-number">3</span>)<br><br>driver.quit()<br></code></pre></div></td></tr></table></figure><h3 id="switch-to切换frame标签"><a href="#switch-to切换frame标签" class="headerlink" title="switch_to切换frame标签"></a>switch_to切换frame标签</h3><blockquote><p>iframe是html中常用的一种技术，即一个页面中嵌套着另外一个网页，selenium默认是访问不了frame中的内容的，对应的解决思路是 driver.switch_to.frame(frame_element)。</p></blockquote><p> 登录QQ邮箱：</p> <figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br>url = <span class="hljs-string">&quot;https://mail.qq.com/&quot;</span><br><br>driver = webdriver.Chrome(executable_path=<span class="hljs-string">&quot;D:/tools/chromedriver&quot;</span>)<br><br>driver.get(url)<br><br><span class="hljs-comment"># 切换当登陆的frame</span><br>driver.switch_to.frame(<span class="hljs-string">&#x27;login_frame&#x27;</span>)<br><br><span class="hljs-comment"># 输入账号</span><br>driver.find_element_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;u&quot;]&#x27;</span>).send_keys(<span class="hljs-string">&quot;admin&quot;</span>)<br><span class="hljs-comment"># 输入密码</span><br>driver.find_element_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;p&quot;]&#x27;</span>).send_keys(<span class="hljs-string">&quot;=pass&quot;</span>)<br><span class="hljs-comment"># 点击登录</span><br>driver.find_element_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;login_button&quot;]&#x27;</span>).click()<br><br>time.sleep(<span class="hljs-number">2</span>)<br><span class="hljs-comment"># 输入独立密码, 没设置独立密码的注释下面</span><br>driver.find_element_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;pp&quot;]&#x27;</span>).send_keys(<span class="hljs-string">&quot;pass&quot;</span>)<br><br><span class="hljs-comment"># 点击登录</span><br>driver.find_element_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;btlogin&quot;]&#x27;</span>).click()<br><br>time.sleep(<span class="hljs-number">6</span>)<br><br>driver.quit()<br></code></pre></div></td></tr></table></figure><h3 id="selenium对cookie的处理"><a href="#selenium对cookie的处理" class="headerlink" title="selenium对cookie的处理"></a>selenium对cookie的处理</h3><ol><li>获取cookie</li></ol><p><code>driver.get_cookies()</code>返回列表信息，其中包含的是完整的cookie信息，光有Name、Value还有domain等cookie其他维度的信息。所以如果想要把获取到cookie信息和requests模块配合使用的话，需要转换为name、value作为键值对的cookie字典。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 获取当前标签页的全部cookie信息</span><br>driver.get_cookies()<br><span class="hljs-comment"># 把cookies转化成字典</span><br>cookies_dict = &#123;cookie[<span class="hljs-string">&#x27;name&#x27;</span>]:cookie[<span class="hljs-string">&#x27;value&#x27;</span>] <span class="hljs-keyword">for</span> cookie <span class="hljs-keyword">in</span> driver.get_cookies()&#125;<br></code></pre></div></td></tr></table></figure><h3 id="selenium控制浏览器执行js代码"><a href="#selenium控制浏览器执行js代码" class="headerlink" title="selenium控制浏览器执行js代码"></a>selenium控制浏览器执行js代码</h3><p><code>selelnium</code> 可以让浏览器执行我们规定的<code>js代码</code>，运行下列代码查看运行效果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br>url = <span class="hljs-string">&quot;https://www.holychan.ltd/&quot;</span><br><br>driver = webdriver.Chrome(executable_path=<span class="hljs-string">&quot;D:/tools/chromedriver&quot;</span>)<br>driver.get(url)<br>time.sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># 定义一个js语句，滑动到页面底部</span><br>js = <span class="hljs-string">&quot;window.scrollTo(0, document.body.scrollHeight)&quot;</span><br><span class="hljs-comment"># 执行js的方法</span><br>driver.execute_script(js)<br><br>time.sleep(<span class="hljs-number">2</span>)<br>driver.quit()<br></code></pre></div></td></tr></table></figure><h3 id="页面等待"><a href="#页面等待" class="headerlink" title="页面等待"></a>页面等待</h3><p><strong>分类</strong></p><ol><li>强制等待（了解）</li></ol><ul><li>使用<code>time.sleep()</code></li><li>缺点：不智能，设置时间太短，元素还没有加载出来。设置时间太长，则会浪费时间。</li></ul><ol start="2"><li>隐式等待</li></ol><ul><li>隐式等待针对的是元素定位，隐式等待设置了一个等待时间，在一段时间内判断元素是否定位成功，如果完成了就进行下一步。</li><li>在设置的时间内没有定位成功，则会报超时加载</li></ul><p>示例代码：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br>url = <span class="hljs-string">&quot;https://www.baidu.com&quot;</span><br><br>driver = webdriver.Chrome(executable_path=<span class="hljs-string">&quot;D:/tools/chromedriver&quot;</span>)<br><br><span class="hljs-comment"># 设置位置之后的所有元素定位操作都有最大等待时间十秒，在10秒内会定期进行元素定位，超出设置时间后将会报错</span><br>driver.implicitly_wait(<span class="hljs-number">10</span>)<br><br>driver.get(url)<br><br>el = driver.find_element_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;lg&quot;]/img[10000]&#x27;</span>)<br><span class="hljs-built_in">print</span>(el)<br><br>driver.quit()<br></code></pre></div></td></tr></table></figure><ol start="3"><li>显式等待(了解)</li></ol><p>每经过多少秒就查看一次等待条件是否达成，如果达成就停止等待，继续执行后续代码。</p><ol start="4"><li>手动实现页面等待</li></ol><h3 id="开启无界面模式"><a href="#开启无界面模式" class="headerlink" title="开启无界面模式"></a>开启无界面模式</h3><p>开启无界面模式的方法：</p><ul><li>实列化配置对象<ul><li>options = webdriver.ChromeOptions()</li></ul></li><li>配置对象添加开启无界面浏览器的命令<ul><li>options.add_argument(“–headless”)</li></ul></li><li>配置对象添加禁用<code>GPU</code>命令<ul><li>options.add_argument(“–disable-gpu”)</li></ul></li><li>实例化带有配置对象的driver对象<ul><li>driver = webdriver.Chrome(options=options)</li></ul></li></ul><p>注意：<code>Chrome</code>浏览器版本必须在59+版本以上。</p><p>参考代码：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br><span class="hljs-comment"># 实例化配置对象</span><br>options = webdriver.ChromeOptions()<br><br><span class="hljs-comment"># 添加配置对象</span><br>options.add_argument(<span class="hljs-string">&#x27;--headless&#x27;</span>)<br>options.add_argument(<span class="hljs-string">&#x27;--disable-gpu&#x27;</span>)<br><br><span class="hljs-comment"># 创建浏览器对象，添加配置对象</span><br>driver = webdriver.Chrome(executable_path=<span class="hljs-string">&quot;D:/tools/chromedriver&quot;</span>, options=options)<br><br>driver.get(<span class="hljs-string">&#x27;https://www.baidu.com&#x27;</span>)<br><br>driver.save_screenshot(<span class="hljs-string">&quot;百度-无头模式.png&quot;</span>)<br><br>driver.quit()<br></code></pre></div></td></tr></table></figure><h3 id="使用代理IP"><a href="#使用代理IP" class="headerlink" title="使用代理IP"></a>使用代理IP</h3><p>使用代理IP的方法：</p><ul><li>实例化配置对象<ul><li>options = webdriver.ChromeOptions()</li></ul></li><li>配置对象添加使用代理IP命令<ul><li>options.add_argument(‘–proxy-server=<a href="http://202.20.16.82:8527&#39;">http://202.20.16.82:8527&#39;</a>)</li></ul></li><li>实例化带有配置对象的driver对象<ul><li>driver = webdriver.Chrome(‘./chromedriver, options=option)</li></ul></li></ul><p>参考代码：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br><span class="hljs-comment"># 实例化配置对象</span><br>options = webdriver.ChromeOptions()<br><br><span class="hljs-comment"># 添加配置对象</span><br><span class="hljs-comment"># 更换IP代理必须重新启动浏览器</span><br>options.add_argument(<span class="hljs-string">&#x27;--proxy-server=http://113.254.44.242:8382&#x27;</span>)<br><br><span class="hljs-comment"># 创建浏览器对象，添加配置对象</span><br>driver = webdriver.Chrome(executable_path=<span class="hljs-string">&quot;D:/tools/chromedriver&quot;</span>, options=options)<br><br>driver.get(<span class="hljs-string">&#x27;https://www.baidu.com&#x27;</span>)<br><br>driver.save_screenshot(<span class="hljs-string">&quot;百度-无头模式.png&quot;</span>)<br><br>driver.quit()<br></code></pre></div></td></tr></table></figure><h3 id="替换user-agent"><a href="#替换user-agent" class="headerlink" title="替换user-agent"></a>替换user-agent</h3><p>替换<code>user-agent</code>的方法：</p><ul><li>实列化配置对象<ul><li>options = webdriver.ChromeOptions()</li></ul></li><li>配置对象添加替换<code>UA</code>命令<ul><li>options.add_argument(‘–user-agent=Mozilla/5.0 python’)</li></ul></li><li>实例化带有配置对象的driver对象<ul><li>driver = webdriver.Chrome(‘./chromedriver, options=option)</li></ul></li></ul><p>参考代码：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br><span class="hljs-comment"># 实例化配置对象</span><br>options = webdriver.ChromeOptions()<br><br><span class="hljs-comment"># 添加配置对象</span><br>options.add_argument(<span class="hljs-string">&#x27;--user-agent=Mozilla/5.0 python&#x27;</span>)<br><br><span class="hljs-comment"># 创建浏览器对象，添加配置对象</span><br>driver = webdriver.Chrome(executable_path=<span class="hljs-string">&quot;D:/tools/chromedriver&quot;</span>, options=options)<br><br>driver.get(<span class="hljs-string">&#x27;https://www.baidu.com&#x27;</span>)<br><br>driver.save_screenshot(<span class="hljs-string">&quot;百度-无头模式.png&quot;</span>)<br><br>driver.quit()<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>selenium</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>scrapy框架</title>
    <link href="/2021/06/18/scrapy%E6%A1%86%E6%9E%B6%E8%AF%A6%E8%A7%A3/"/>
    <url>/2021/06/18/scrapy%E6%A1%86%E6%9E%B6%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>建议在虚拟环境中安装。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install scrapy<br></code></pre></div></td></tr></table></figure><h2 id="scrapy使用教程"><a href="#scrapy使用教程" class="headerlink" title="scrapy使用教程"></a>scrapy使用教程</h2><h3 id="创建一个scrapy项目"><a href="#创建一个scrapy项目" class="headerlink" title="创建一个scrapy项目"></a>创建一个scrapy项目</h3><p>在你开始使用 <code>scrapy</code> 前，你必须先创建一个<code>Scrpay project</code>。输入你要创建的项目目录名称，比如这里的<code>tutorial</code>然后运行:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy startproject tutorial<br></code></pre></div></td></tr></table></figure><p>这将会创建一个名字为 tutorial 的目录，包含以下内容：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">tutorial/<br>    scrapy.cfg            <span class="hljs-comment"># 部署的配置文件</span><br><br>    tutorial/             <span class="hljs-comment"># 项目的python模块</span><br>        __init__.py<br><br>        items.py          <span class="hljs-comment"># 项目item定义文件</span><br><br>        middlewares.py    <span class="hljs-comment"># 项目的中间件文件</span><br><br>        pipelines.py      <span class="hljs-comment"># 项目的管道文件</span><br><br>        settings.py       <span class="hljs-comment"># 项目的配置文件</span><br><br>        spiders/          <span class="hljs-comment"># 存放spider文件的目录</span><br>            __init__.py<br></code></pre></div></td></tr></table></figure><h3 id="开始第一个爬虫"><a href="#开始第一个爬虫" class="headerlink" title="开始第一个爬虫"></a>开始第一个爬虫</h3><p><code>Spiders</code>是一些类的集合，他们都是<code>Spider</code>的子类。</p><p>接下来在<code>tutorial/spiders</code>文件下新建一个<code>quotes_spider.py</code>文件，写下如下内容：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> scrapy<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuotesSpider</span>(<span class="hljs-params">scrapy.Spider</span>):</span><br>    name = <span class="hljs-string">&quot;quotes&quot;</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start_requests</span>(<span class="hljs-params">self</span>):</span><br>        urls = [<br>            <span class="hljs-string">&#x27;http://quotes.toscrape.com/page/1/&#x27;</span>,<br>            <span class="hljs-string">&#x27;http://quotes.toscrape.com/page/2/&#x27;</span>,<br>        ]<br><br>        <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> urls:<br>            <span class="hljs-keyword">yield</span> scrapy.Request(url=url, callback=self.parse)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span><br>        page = response.url.split(<span class="hljs-string">&quot;/&quot;</span>)[-<span class="hljs-number">2</span>]<br>        filename = <span class="hljs-string">f&#x27;qoutes-<span class="hljs-subst">&#123;page&#125;</span>.html&#x27;</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            f.write(response.body)<br>        self.log(<span class="hljs-string">f&#x27;Saved file <span class="hljs-subst">&#123;filename&#125;</span>&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>如你所见，我们的蜘蛛子类 <code>scrapy.Spider</code> 并定义了一些属性和方法：</p><ul><li><p><code>name</code> ：标识蜘蛛。它在一个项目中必须是唯一的，也就是说，不能为不同的蜘蛛设置相同的名称。</p></li><li><p><code>start_requests()</code> ：必须返回一个<code>ITable of requests</code>（您可以返回一个请求列表或编写一个生成器函数），蜘蛛将从中开始爬行。随后的请求将从这些初始请求中依次生成。</p></li><li><p><code>parse()</code> ：将调用的方法，用于处理为每个请求下载的响应。响应参数是的实例 <code>TextResponse</code> 它保存页面内容，并有进一步有用的方法来处理它。</p></li></ul><p>这个 <code>parse()</code> 方法通常解析响应，将抓取的数据提取为<code>dict</code>，并查找新的URL以跟踪和创建新的请求。</p><h3 id="运行爬虫"><a href="#运行爬虫" class="headerlink" title="运行爬虫"></a>运行爬虫</h3><p>在项目的顶级目录中运行，比如这里的 <code>tutorial/</code> ：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy crawl quotes<br></code></pre></div></td></tr></table></figure><p>你将看到以下输出：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-number">2021</span>-06-<span class="hljs-number">18</span> <span class="hljs-number">22</span>:<span class="hljs-number">30</span>:<span class="hljs-number">22</span> [scrapy.utils.log] INFO: Scrapy <span class="hljs-number">2.5</span><span class="hljs-number">.0</span> started (bot: tutorial)<br><span class="hljs-number">2021</span>-06-<span class="hljs-number">18</span> <span class="hljs-number">22</span>:<span class="hljs-number">30</span>:<span class="hljs-number">22</span> [scrapy.utils.log] INFO: Versions: lxml <span class="hljs-number">4.6</span><span class="hljs-number">.3</span><span class="hljs-number">.0</span>, libxml2 <span class="hljs-number">2.9</span><span class="hljs-number">.5</span>, cssselect <span class="hljs-number">1.1</span><span class="hljs-number">.0</span>, parsel <span class="hljs-number">1.6</span><span class="hljs-number">.0</span>, w3lib <span class="hljs-number">1.22</span><span class="hljs-number">.0</span>, Twisted <span class="hljs-number">21.2</span><span class="hljs-number">.0</span>, Python <span class="hljs-number">3.9</span><span class="hljs-number">.5</span> (tags/v3<span class="hljs-number">.9</span><span class="hljs-number">.5</span>:0a7dcbd, May  <span class="hljs-number">3</span> <span class="hljs-number">2021</span>, <span class="hljs-number">17</span>:<span class="hljs-number">27</span>:<span class="hljs-number">52</span>) [MSC v<span class="hljs-number">.1928</span> <span class="hljs-number">64</span> bit (AMD64)], pyOpenSSL <span class="hljs-number">20.0</span><span class="hljs-number">.1</span> (OpenSSL <span class="hljs-number">1.1</span><span class="hljs-number">.1</span>k  <span class="hljs-number">25</span> Mar <span class="hljs-number">2021</span>), cryptography <span class="hljs-number">3.4</span><span class="hljs-number">.7</span>, Platform Windows-<span class="hljs-number">10</span>-<span class="hljs-number">10.0</span><span class="hljs-number">.19041</span>-SP0<br><span class="hljs-number">2021</span>-06-<span class="hljs-number">18</span> <span class="hljs-number">22</span>:<span class="hljs-number">30</span>:<span class="hljs-number">22</span> [scrapy.utils.log] DEBUG: Using reactor: twisted.internet.selectreactor.SelectReactor<br><span class="hljs-number">2021</span>-06-<span class="hljs-number">18</span> <span class="hljs-number">22</span>:<span class="hljs-number">30</span>:<span class="hljs-number">22</span> [scrapy.crawler] INFO: Overridden settings:<br>&#123;<span class="hljs-string">&#x27;BOT_NAME&#x27;</span>: <span class="hljs-string">&#x27;tutorial&#x27;</span>,<br> <span class="hljs-string">&#x27;NEWSPIDER_MODULE&#x27;</span>: <span class="hljs-string">&#x27;tutorial.spiders&#x27;</span>,<br> <span class="hljs-string">&#x27;ROBOTSTXT_OBEY&#x27;</span>: <span class="hljs-literal">True</span>,<br> <span class="hljs-string">&#x27;SPIDER_MODULES&#x27;</span>: [<span class="hljs-string">&#x27;tutorial.spiders&#x27;</span>]&#125;<br>......<br></code></pre></div></td></tr></table></figure><p>检查当前目录中的文件。您应该注意到已经创建了两个新文件： <code>quotes-1.html</code> 和 <code>引用-2.HTML</code>。</p><h2 id="scrapy的工作流程"><a href="#scrapy的工作流程" class="headerlink" title="scrapy的工作流程"></a>scrapy的工作流程</h2><p>上面的流程在 <code>scrapy</code> 中分为下面几个部分：</p><ul><li>Scheduler: 用来接受引擎发过来的请求并加入队列中，并在引擎再次请求的时候提供给引擎。</li><li>Downloader: 下载器</li><li>ScrapyEngine: 用来处理整个系统的数据流处理、触发事务，是整个框架的核心。</li><li>ItemPipeline：项目管道</li><li>Sipders：定义爬取的逻辑</li></ul><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Python库</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>scrapy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Requests库</title>
    <link href="/2021/06/17/Requests%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2021/06/17/Requests%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Requests is an elegant and simple HTTP library for Python, built for human beings.</p></blockquote><p><code>Requests</code> 唯一的一个非转基因的 <code>Python HTTP</code> 库，人类可以安全享用。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><code>Requests</code>是一个第三方的库，建议在虚拟环境中安装。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install requests<br></code></pre></div></td></tr></table></figure><h2 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h2><h3 id="发送请求"><a href="#发送请求" class="headerlink" title="发送请求"></a>发送请求</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 安装requests模块</span><br><span class="hljs-comment"># pip install requests</span><br><br><span class="hljs-comment"># 导入requests</span><br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># 目标url</span><br>url = <span class="hljs-string">&quot;https://www.baidu.com&quot;</span><br><br><span class="hljs-comment"># 向目标url发送请求</span><br>response = requests.get(url)<br><br><span class="hljs-comment"># 打印响应内容</span><br><span class="hljs-built_in">print</span>(response.text)<br></code></pre></div></td></tr></table></figure><p><code>Requests</code> 会自动解码来自服务器的内容。大多数 unicode 字符集都能被无缝地解码。</p><p>请求发出后， <code>Requests</code> 会基于 <code>HTTP</code> 头部对响应的编码作出有根据的推测。当你访问 <code>response.text</code> 之时，<code>Requests</code> 会使用其推测的文本编码。你可以找出 <code>Requests</code> 使用了什么编码，并且能够使用 <code>response.encoding</code> 属性来改变它：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 设置响应编码方式</span><br>response.encoding = <span class="hljs-string">&#x27;ISO-8859-1&#x27;</span><br></code></pre></div></td></tr></table></figure><h3 id="二进制响应内容"><a href="#二进制响应内容" class="headerlink" title="二进制响应内容"></a>二进制响应内容</h3><p>你也能以字节的方式访问请求响应体，对于非文本请求：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 打印响应内容, 二进制格式</span><br><span class="hljs-built_in">print</span>(response.content)`<br></code></pre></div></td></tr></table></figure><h3 id="传递-URL-参数"><a href="#传递-URL-参数" class="headerlink" title="传递 URL 参数"></a>传递 URL 参数</h3><p>你也许经常想为 <code>URL</code> 的查询字符串(query string)传递某种数据。如果你是手工构建 <code>URL</code>，那么数据会以键/值对的形式置于 <code>URL</code> 中，跟在一个问号的后面。例如，<code> httpbin.org/get?key=val</code>。 <code>Requests</code> 允许你使用 <code>params</code> 关键字参数，以一个字符串字典来提供这些参数。举例来说，如果你想传递<code> key1=value1</code> 和 <code>key2=value2</code> 到 <code>httpbin.org/get</code> ，那么你可以使用如下代码：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>payload = &#123;<span class="hljs-string">&#x27;key1&#x27;</span>: <span class="hljs-string">&#x27;value1&#x27;</span>, <span class="hljs-string">&#x27;key2&#x27;</span>: <span class="hljs-string">&#x27;value2&#x27;</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.get(<span class="hljs-string">&quot;http://httpbin.org/get&quot;</span>, params=payload)<br></code></pre></div></td></tr></table></figure><p>通过打印输出该 <code>URL</code>，你能看到 <code>URL</code> 已被正确编码：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(r.url)<br>http://httpbin.org/get?key2=value2&amp;key1=value1<br></code></pre></div></td></tr></table></figure><p>注意字典里值为 <code>None</code> 的键都不会被添加到 <code>URL</code> 的查询字符串里。</p><p>你还可以将一个列表作为值传入：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>payload = &#123;<span class="hljs-string">&#x27;key1&#x27;</span>: <span class="hljs-string">&#x27;value1&#x27;</span>, <span class="hljs-string">&#x27;key2&#x27;</span>: [<span class="hljs-string">&#x27;value2&#x27;</span>, <span class="hljs-string">&#x27;value3&#x27;</span>]&#125;<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.get(<span class="hljs-string">&#x27;http://httpbin.org/get&#x27;</span>, params=payload)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(r.url)<br>http://httpbin.org/get?key1=value1&amp;key2=value2&amp;key2=value3<br></code></pre></div></td></tr></table></figure><h3 id="JSON-响应内容"><a href="#JSON-响应内容" class="headerlink" title="JSON 响应内容"></a>JSON 响应内容</h3><p><code>Requests</code> 中也有一个内置的 <code>JSON</code> 解码器，助你处理 <code>JSON</code> 数据：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.get(<span class="hljs-string">&#x27;https://api.github.com/events&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>r.json()<br>[&#123;<span class="hljs-string">u&#x27;repository&#x27;</span>: &#123;<span class="hljs-string">u&#x27;open_issues&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">u&#x27;url&#x27;</span>: <span class="hljs-string">&#x27;https://github.com/...</span><br><span class="hljs-string">&gt;&gt;&gt; r.status_code</span><br><span class="hljs-string">200</span><br></code></pre></div></td></tr></table></figure><p>如果 <code>JSON</code> 解码失败， <code>r.json()</code> 就会抛出一个异常。例如，响应内容是 <code>401 (Unauthorized)</code>，尝试访问 <code>r.json()</code> 将会抛出 <code>ValueError: No JSON object could be decoded </code>异常。</p><p>需要注意的是，成功调用 <code>r.json()</code> 并<strong>不</strong>意味着响应的成功。有的服务器会在失败的响应中包含一个 <code>JSON</code> 对象（比如<code>HTTP 500</code>的错误细节）。这种 <code>JSON</code> 会被解码返回。要检查请求是否成功，请使用 <code>r.raise_for_status()</code> 或者检查 <code>r.status_code</code> 是否和你的期望相同。</p><h3 id="原始响应内容"><a href="#原始响应内容" class="headerlink" title="原始响应内容"></a>原始响应内容</h3><p>在某些情况下，如果你想获取来自服务器的原始套接字响应，那么你可以访问 <code>r.raw</code>。 如果你确实想这么干，那请你确保在初始请求中设置了 <code>stream=True</code>。具体你可以这么做：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.get(<span class="hljs-string">&#x27;https://api.github.com/events&#x27;</span>, stream=<span class="hljs-literal">True</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>r.raw<br>&lt;urllib3.response.HTTPResponse <span class="hljs-built_in">object</span> at <span class="hljs-number">0x00000197FAA56AC0</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>r.raw.read(<span class="hljs-number">10</span>)<br><span class="hljs-string">b&#x27;\x1f\x8b\x08\x00\x00\x00\x00\x00\x00\x03&#x27;</span><br></code></pre></div></td></tr></table></figure><p>但一般情况下，你应该以下面的模式将文本流保存到文件：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> fd:<br>    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> r.iter_content(chunk_size):<br>        fd.write(chunk)<br></code></pre></div></td></tr></table></figure><p>使用 <code>Response.iter_content</code> 将会处理大量你直接使用 <code>Response.raw</code> 不得不处理的。 当流下载时，上面是优先推荐的获取内容方式。 </p><h3 id="定制请求头"><a href="#定制请求头" class="headerlink" title="定制请求头"></a>定制请求头</h3><p>如果你想为请求添加 <code>HTTP</code> 头部，只要简单地传递一个 <code>dict</code> 给 <code>headers</code> 参数就可以了。</p><p>例如，在前一个示例中我们没有指定 <code>content-type</code>:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>url = <span class="hljs-string">&#x27;https://api.github.com/some/endpoint&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>headers = &#123;<span class="hljs-string">&#x27;user-agent&#x27;</span>: <span class="hljs-string">&#x27;my-app/0.0.1&#x27;</span>&#125;<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.get(url, headers=headers)<br></code></pre></div></td></tr></table></figure><p>注意: 定制 <code>header</code> 的优先级低于某些特定的信息源，例如：</p><ul><li>如果在 <code>.netrc</code> 中设置了用户认证信息，使用 <code>headers=</code> 设置的授权就不会生效。而如果设置了<code> auth=</code> 参数，<code>.netrc</code> 的设置就无效了。</li><li>如果被重定向到别的主机，授权 <code>header</code> 就会被删除。</li><li>代理授权 <code>header</code> 会被 URL 中提供的代理身份覆盖掉。</li><li>在我们能判断内容长度的情况下，<code>header</code> 的 <code>Content-Length</code> 会被改写。</li></ul><p>更进一步讲，<code>Requests</code> 不会基于定制 <code>header</code> 的具体情况改变自己的行为。只不过在最后的请求中，所有的 <code>header</code> 信息都会被传递进去。</p><p>注意: 所有的 head<code>er 值必须是 </code>string、bytestring<code>或者</code>unicode<code>。尽管传递 </code>unicode header` 也是允许的，但不建议这样做。</p><h3 id="更加复杂的-POST-请求"><a href="#更加复杂的-POST-请求" class="headerlink" title="更加复杂的 POST 请求"></a>更加复杂的 POST 请求</h3><p>通常，你想要发送一些编码为表单形式的数据——非常像一个 <code>HTML</code> 表单。要实现这个，只需简单地传递一个字典给 <code>data</code> 参数。你的数据字典在发出请求时会自动编码为表单形式：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>payload = &#123;<span class="hljs-string">&#x27;key1&#x27;</span>: <span class="hljs-string">&#x27;value1&#x27;</span>, <span class="hljs-string">&#x27;key2&#x27;</span>: <span class="hljs-string">&#x27;value2&#x27;</span>&#125;<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.post(<span class="hljs-string">&quot;http://httpbin.org/post&quot;</span>, data=payload)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(r.text)<br>&#123;<br>  ...<br>  <span class="hljs-string">&quot;form&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;key2&quot;</span>: <span class="hljs-string">&quot;value2&quot;</span>,<br>    <span class="hljs-string">&quot;key1&quot;</span>: <span class="hljs-string">&quot;value1&quot;</span><br>  &#125;,<br>  ...<br>&#125;<br></code></pre></div></td></tr></table></figure><p>你还可以为 <code>data</code> 参数传入一个元组列表。在表单中多个元素使用同一 <code>key</code> 的时候，这种方式尤其有效：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>payload = ((<span class="hljs-string">&#x27;key1&#x27;</span>, <span class="hljs-string">&#x27;value1&#x27;</span>), (<span class="hljs-string">&#x27;key1&#x27;</span>, <span class="hljs-string">&#x27;value2&#x27;</span>))<br><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.post(<span class="hljs-string">&#x27;http://httpbin.org/post&#x27;</span>, data=payload)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(r.text)<br>&#123;<br>  ...<br>  <span class="hljs-string">&quot;form&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;key1&quot;</span>: [<br>      <span class="hljs-string">&quot;value1&quot;</span>,<br>      <span class="hljs-string">&quot;value2&quot;</span><br>    ]<br>  &#125;,<br>  ...<br></code></pre></div></td></tr></table></figure><p>很多时候你想要发送的数据并非编码为表单形式的。如果你传递一个 <code>string</code> 而不是一个 <code>dict</code> ，那么数据会被直接发布出去。</p><p>例如，<code>Github API v3</code> 接受编码为 <code>JSON</code> 的 <code>POST/PATCH</code> 数据：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> json<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>url = <span class="hljs-string">&#x27;https://api.github.com/some/endpoint&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>payload = &#123;<span class="hljs-string">&#x27;some&#x27;</span>: <span class="hljs-string">&#x27;data&#x27;</span>&#125;<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.post(url, data=json.dumps(payload))<br></code></pre></div></td></tr></table></figure><p>此处除了可以自行对 <code>dict</code> 进行编码，你还可以使用 <code>json</code> 参数直接传递，然后它就会被自动编码。这是 <code>2.4.2 </code>版的新加功能：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>url = <span class="hljs-string">&#x27;https://api.github.com/some/endpoint&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>payload = &#123;<span class="hljs-string">&#x27;some&#x27;</span>: <span class="hljs-string">&#x27;data&#x27;</span>&#125;<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.post(url, json=payload)<br></code></pre></div></td></tr></table></figure><h3 id="响应状态码"><a href="#响应状态码" class="headerlink" title="响应状态码"></a>响应状态码</h3><p>可以检测响应状态码：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.get(<span class="hljs-string">&#x27;http://httpbin.org/get&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>r.status_code<br><span class="hljs-number">200</span><br></code></pre></div></td></tr></table></figure><p>为方便引用，<code>Requests</code>还附带了一个内置的状态码查询对象：</p><figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus">&gt;&gt;&gt; r<span class="hljs-selector-class">.status_code</span> == requests<span class="hljs-selector-class">.codes</span><span class="hljs-selector-class">.ok</span><br>True<br></code></pre></div></td></tr></table></figure><p>如果发送了一个错误请求(一个 4XX 客户端错误，或者 5XX 服务器错误响应)，我们可以通过 <code>Response.raise_for_status()</code> 来抛出异常：</p><figure class="highlight python-repl"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python-repl"><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">bad_r = requests.get(<span class="hljs-string">&#x27;http://httpbin.org/status/404&#x27;</span>)</span><br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">bad_r.status_code</span><br>404<br><br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">bad_r.raise_for_status()</span><br>Traceback (most recent call last):<br>  File &quot;requests/models.py&quot;, line 832, in raise_for_status<br>    raise http_error<br>requests.exceptions.HTTPError: 404 Client Error<br></code></pre></div></td></tr></table></figure><p>如果响应对象 <code>r</code> 的 <code>status_code</code> 是 <code>200</code> ，当我们调用 <code>raise_for_status()</code> 时，得到的是：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>r.raise_for_status()<br><span class="hljs-literal">None</span><br></code></pre></div></td></tr></table></figure><h3 id="响应头"><a href="#响应头" class="headerlink" title="响应头"></a>响应头</h3><p>我们可以查看以一个 <code>Python</code> 字典形式展示的服务器响应头：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>r.headers<br>&#123;<br>    <span class="hljs-string">&#x27;content-encoding&#x27;</span>: <span class="hljs-string">&#x27;gzip&#x27;</span>,<br>    <span class="hljs-string">&#x27;transfer-encoding&#x27;</span>: <span class="hljs-string">&#x27;chunked&#x27;</span>,<br>    <span class="hljs-string">&#x27;connection&#x27;</span>: <span class="hljs-string">&#x27;close&#x27;</span>,<br>    <span class="hljs-string">&#x27;server&#x27;</span>: <span class="hljs-string">&#x27;nginx/1.0.4&#x27;</span>,<br>    <span class="hljs-string">&#x27;x-runtime&#x27;</span>: <span class="hljs-string">&#x27;148ms&#x27;</span>,<br>    <span class="hljs-string">&#x27;etag&#x27;</span>: <span class="hljs-string">&#x27;&quot;e1ca502697e5c9317743dc078f67693f&quot;&#x27;</span>,<br>    <span class="hljs-string">&#x27;content-type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>但是这个字典比较特殊：它是仅为 <code>HTTP</code> 头部而生的。根据 <code>RFC 2616</code>， <code>HTTP</code> 头部是大小写不敏感的。</p><p>因此，我们可以使用任意大写形式来访问这些响应头字段：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>r.headers[<span class="hljs-string">&#x27;Content-Type&#x27;</span>]<br><span class="hljs-string">&#x27;application/json&#x27;</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>r.headers.get(<span class="hljs-string">&#x27;content-type&#x27;</span>)<br><span class="hljs-string">&#x27;application/json&#x27;</span><br></code></pre></div></td></tr></table></figure><p>它还有一个特殊点，那就是服务器可以多次接受同一 <code>header</code>，每次都使用不同的值。</p><h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><p>如果某个响应中包含一些 <code>cookie</code>，你可以快速访问它们：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>url = <span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.get(url)<br><span class="hljs-meta">&gt;&gt;&gt; </span>r.cookies<br>&lt;RequestsCookieJar[Cookie(version=<span class="hljs-number">0</span>, name=<span class="hljs-string">&#x27;BDORZ&#x27;</span>, value=<span class="hljs-string">&#x27;27315&#x27;</span>, port=<span class="hljs-literal">None</span>, port_specified=<span class="hljs-literal">False</span>, domain=<span class="hljs-string">&#x27;.baidu.com&#x27;</span>, domain_specified=<span class="hljs-literal">True</span>, domain_initial_dot=<span class="hljs-literal">True</span>, path=<span class="hljs-string">&#x27;/&#x27;</span>, path_specified=<span class="hljs-literal">True</span>, secure=<span class="hljs-literal">False</span>, expires=<span class="hljs-number">1624028209</span>, discard=<span class="hljs-literal">False</span>, comment=<span class="hljs-literal">None</span>, comment_url=<span class="hljs-literal">None</span>, rest=&#123;&#125;, rfc2109=<span class="hljs-literal">False</span>)]&gt;<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>r.cookies.get_dict()<br>&#123;<span class="hljs-string">&#x27;BDORZ&#x27;</span>: <span class="hljs-string">&#x27;27315&#x27;</span>&#125;<br></code></pre></div></td></tr></table></figure><p>要想发送你的<code>cookies</code>到服务器，可以使用 <code>cookies</code> 参数：</p><figure class="highlight python-repl"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python-repl"><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">url = <span class="hljs-string">&#x27;http://httpbin.org/cookies&#x27;</span></span><br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">cookies = <span class="hljs-built_in">dict</span>(cookies_are=<span class="hljs-string">&#x27;working&#x27;</span>)</span><br><br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">r = requests.get(url, cookies=cookies)</span><br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">r.text</span><br>&#x27;&#123;&quot;cookies&quot;: &#123;&quot;cookies_are&quot;: &quot;working&quot;&#125;&#125;&#x27;<br></code></pre></div></td></tr></table></figure><p><code>Cookie</code> 的返回对象为 <code>RequestsCookieJar</code> ，它的行为和字典类似，但接口更为完整，适合跨域名跨路径使用。你还可以把 <code>Cookie Jar</code> 传到 <code>Requests</code> 中：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>jar = requests.cookies.RequestsCookieJar()<br><span class="hljs-meta">&gt;&gt;&gt; </span>jar.<span class="hljs-built_in">set</span>(<span class="hljs-string">&#x27;tasty_cookie&#x27;</span>, <span class="hljs-string">&#x27;yum&#x27;</span>, domain=<span class="hljs-string">&#x27;httpbin.org&#x27;</span>, path=<span class="hljs-string">&#x27;/cookies&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>jar.<span class="hljs-built_in">set</span>(<span class="hljs-string">&#x27;gross_cookie&#x27;</span>, <span class="hljs-string">&#x27;blech&#x27;</span>, domain=<span class="hljs-string">&#x27;httpbin.org&#x27;</span>, path=<span class="hljs-string">&#x27;/elsewhere&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>url = <span class="hljs-string">&#x27;http://httpbin.org/cookies&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.get(url, cookies=jar)<br><span class="hljs-meta">&gt;&gt;&gt; </span>r.text<br><span class="hljs-string">&#x27;&#123;&quot;cookies&quot;: &#123;&quot;tasty_cookie&quot;: &quot;yum&quot;&#125;&#125;&#x27;</span><br></code></pre></div></td></tr></table></figure><h3 id="重定向与请求历史"><a href="#重定向与请求历史" class="headerlink" title="重定向与请求历史"></a>重定向与请求历史</h3><p>默认情况下，除了 <code>HEAD, Requests</code> 会自动处理所有重定向。</p><p>可以使用响应对象的 <code>history</code> 方法来追踪重定向。</p><p><code>Response.history</code> 是一个 <code>Response</code> 对象的列表，为了完成请求而创建了这些对象。这个对象列表按照从最老到最近的请求进行排序。</p><p>例如，Github 将所有的 <code>HTTP</code> 请求重定向到 <code>HTTPS</code>：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.get(<span class="hljs-string">&#x27;http://github.com&#x27;</span>)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>r.url<br><span class="hljs-string">&#x27;https://github.com/&#x27;</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>r.status_code<br><span class="hljs-number">200</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>r.history<br>[&lt;Response [<span class="hljs-number">301</span>]&gt;]<br></code></pre></div></td></tr></table></figure><p>如果你使用的是<code>GET、OPTIONS、POST、PUT、PATCH</code> 或者 <code>DELETE</code>，那么你可以通过 <code>allow_redirects</code> 参数禁用重定向处理：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.get(<span class="hljs-string">&#x27;http://github.com&#x27;</span>, allow_redirects=<span class="hljs-literal">False</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>r.status_code<br><span class="hljs-number">301</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>r.history<br>[]<br></code></pre></div></td></tr></table></figure><p>如果你使用了 <code>HEAD</code>，你也可以启用重定向：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.head(<span class="hljs-string">&#x27;http://github.com&#x27;</span>, allow_redirects=<span class="hljs-literal">True</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>r.url<br><span class="hljs-string">&#x27;https://github.com/&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>r.history<br>[&lt;Response [<span class="hljs-number">301</span>]&gt;]<br></code></pre></div></td></tr></table></figure><h3 id="超时处理"><a href="#超时处理" class="headerlink" title="超时处理"></a>超时处理</h3><p>你可以告诉 <code>requests</code> 在经过以 <code>timeout</code> 参数设定的秒数时间之后停止等待响应。基本上所有的生产代码都应该使用这一参数。如果不使用，你的程序可能会永远失去响应：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>requests.get(<span class="hljs-string">&#x27;http://github.com&#x27;</span>, timeout=<span class="hljs-number">0.001</span>)<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>requests.exceptions.Timeout: HTTPConnectionPool(host=<span class="hljs-string">&#x27;github.com&#x27;</span>, port=<span class="hljs-number">80</span>): Request timed out. (timeout=<span class="hljs-number">0.001</span>)<br></code></pre></div></td></tr></table></figure><blockquote><p>注意<br> <code>timeout</code> 仅对连接过程有效，与响应体的下载无关。 <code>timeout</code> 并不是整个下载响应的时间限制，而是如果服务器在 <code>timeout</code> 秒内没有应答，将会引发一个异常（更精确地说，是在 <code>timeout</code> 秒内没有从基础套接字上接收到任何字节的数据时）。</p></blockquote><h3 id="错误与异常"><a href="#错误与异常" class="headerlink" title="错误与异常"></a>错误与异常</h3><p>遇到网络问题（如：DNS 查询失败、拒绝连接等）时， <code>Requests</code> 会抛出一个 <code>ConnectionError</code> 异常。</p><p>如果 <code>HTTP</code> 请求返回了不成功的状态码， <code>Response.raise_for_status()</code> 会抛出一个 <code>HTTPError</code> 异常。</p><p>若请求超时，则抛出一个 <code>Timeout</code> 异常。</p><p>若请求超过了设定的最大重定向次数，则会抛出一个 <code>TooManyRedirects</code> 异常。</p><p>所有<code>Requests</code>显式抛出的异常都继承自<code>requests.exceptions.RequestException</code> 。</p><h2 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h2><p>接下来介绍一些 <code>requests</code> 的高级用法。</p><h3 id="会话对象"><a href="#会话对象" class="headerlink" title="会话对象"></a>会话对象</h3><p>会话对象让你能够跨请求保持某些参数。它也会在同一个 <code>Session</code> 实例发出的所有请求之间保持 <code>cookie</code> ， 期间使用 <code>urllib3</code> 的 <code>connection pooling</code> 功能。所以如果你向同一主机发送多个请求，底层的 <code>TCP</code> 连接将会被重用，从而带来显著的性能提升。</p><p>会话对象具有主要的 <code>Requests API</code> 的所有方法。</p><p>我们来跨请求保持一些 <code>cookie</code>:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># 创建一个会话对象</span><br>s = requests.Session()<br><br>s.get(<span class="hljs-string">&#x27;http://httpbin.org/cookies/set/sessioncookie/123456789&#x27;</span>)<br><br>r = s.get(<span class="hljs-string">&quot;https://httpbin.org/cookies&quot;</span>)<br><br><span class="hljs-built_in">print</span>(r.text)<br><br><span class="hljs-comment"># &#123;</span><br><span class="hljs-comment">#   &quot;cookies&quot;: &#123;</span><br><span class="hljs-comment">#     &quot;sessioncookie&quot;: &quot;123456789&quot;</span><br><span class="hljs-comment">#   &#125;</span><br><span class="hljs-comment"># &#125;</span><br></code></pre></div></td></tr></table></figure><p>会话也可用来为请求方法提供缺省数据。这是通过为会话对象的属性提供数据来实现的：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">s = requests.Session()<br>s.auth = (<span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">&#x27;pass&#x27;</span>)<br>s.headers.update(&#123;<span class="hljs-string">&#x27;x-test&#x27;</span>: <span class="hljs-string">&#x27;true&#x27;</span>&#125;)<br><br><span class="hljs-comment"># both &#x27;x-test&#x27; and &#x27;x-test2&#x27; are sent</span><br>s.get(<span class="hljs-string">&#x27;http://httpbin.org/headers&#x27;</span>, headers=&#123;<span class="hljs-string">&#x27;x-test2&#x27;</span>: <span class="hljs-string">&#x27;true&#x27;</span>&#125;)<br></code></pre></div></td></tr></table></figure><p>任何你传递给请求方法的字典都会与已设置会话层数据合并。方法层的参数覆盖会话的参数。</p><p>不过需要注意，就算使用了会话，方法级别的参数也不会被跨请求保持。下面的例子只会和第一个请求发送 <code>cookie</code> ，而非第二个：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">s = requests.Session()<br><br>r = s.get(<span class="hljs-string">&#x27;http://httpbin.org/cookies&#x27;</span>, cookies=&#123;<span class="hljs-string">&#x27;from-my&#x27;</span>: <span class="hljs-string">&#x27;browser&#x27;</span>&#125;)<br><span class="hljs-built_in">print</span>(r.text)<br><span class="hljs-comment"># &#x27;&#123;&quot;cookies&quot;: &#123;&quot;from-my&quot;: &quot;browser&quot;&#125;&#125;&#x27;</span><br><br>r = s.get(<span class="hljs-string">&#x27;http://httpbin.org/cookies&#x27;</span>)<br><span class="hljs-built_in">print</span>(r.text)<br><span class="hljs-comment"># &#x27;&#123;&quot;cookies&quot;: &#123;&#125;&#125;&#x27;</span><br></code></pre></div></td></tr></table></figure><p>如果你要手动为会话添加 <code>cookie</code> ，就使用 <code>Cookie utility</code> 函数 来操纵 <code>Session.cookies</code>。</p><p>会话还可以用作前后文管理器：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">with</span> requests.Session() <span class="hljs-keyword">as</span> s:<br>    s.get(<span class="hljs-string">&#x27;http://httpbin.org/cookies/set/sessioncookie/123456789&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>这样就能确保 <code>with</code> 区块退出后会话能被关闭，即使发生了异常也一样。</p><p>从字典参数中移除一个值<br>有时你会想省略字典参数中一些会话层的键。要做到这一点，你只需简单地在方法层参数中将那个键的值设置为 <code>None</code> ，那个键就会被自动省略掉。</p><h3 id="请求与响应对象"><a href="#请求与响应对象" class="headerlink" title="请求与响应对象"></a>请求与响应对象</h3><p>任何时候进行了类似 <code>requests.get()</code> 的调用，你都在做两件主要的事情。其一，你在构建一个 <code>Request</code> 对象， 该对象将被发送到某个服务器请求或查询一些资源。其二，一旦 <code>requests</code> 得到一个从服务器返回的响应就会产生一个 <code>Response</code> 对象。该响应对象包含服务器返回的所有信息，也包含你原来创建的 <code>Request</code> 对象。如下是一个简单的请求，从 <code>Baidu</code> 的服务器得到一些非常重要的信息：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.get(<span class="hljs-string">&quot;https://www.baidu.com&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>如果想访问服务器返回给我们的响应头部信息，可以这样做：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>r.headers<br>&#123;<span class="hljs-string">&#x27;Cache-Control&#x27;</span>: <span class="hljs-string">&#x27;private, no-cache, no-store, proxy-revalidate, no-transform&#x27;</span>, <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>,<br>        <span class="hljs-string">&#x27;Content-Encoding&#x27;</span>: <span class="hljs-string">&#x27;gzip&#x27;</span>, <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span>, <span class="hljs-string">&#x27;Date&#x27;</span>: <span class="hljs-string">&#x27;Thu, 17 Jun 2021 15:52:48 GMT&#x27;</span>,<br>        <span class="hljs-string">&#x27;Last-Modified&#x27;</span>: <span class="hljs-string">&#x27;Mon, 23 Jan 2017 13:23:55 GMT&#x27;</span>, <span class="hljs-string">&#x27;Pragma&#x27;</span>: <span class="hljs-string">&#x27;no-cache&#x27;</span>, <span class="hljs-string">&#x27;Server&#x27;</span>: <span class="hljs-string">&#x27;bfe/1.0.8.18&#x27;</span>,<br>        <span class="hljs-string">&#x27;Set-Cookie&#x27;</span>: <span class="hljs-string">&#x27;BDORZ=27315; max-age=86400; domain=.baidu.com; path=/&#x27;</span>, <span class="hljs-string">&#x27;Transfer-Encoding&#x27;</span>: <span class="hljs-string">&#x27;chunked&#x27;</span>&#125;<br></code></pre></div></td></tr></table></figure><p>然而，如果想得到发送到服务器的请求的头部，我们可以简单地访问该请求，然后是该请求的头部：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>r.request.headers<br>&#123;<span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;python-requests/2.25.1&#x27;</span>, <span class="hljs-string">&#x27;Accept-Encoding&#x27;</span>: <span class="hljs-string">&#x27;gzip, deflate&#x27;</span>, <span class="hljs-string">&#x27;Accept&#x27;</span>: <span class="hljs-string">&#x27;*/*&#x27;</span>,<br>     <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="准备的请求-（Prepared-Request）"><a href="#准备的请求-（Prepared-Request）" class="headerlink" title="准备的请求 （Prepared Request）"></a>准备的请求 （Prepared Request）</h3><p>当你从 <code>API</code> 或者会话调用中收到一个 <code>Response</code> 对象时，<code>request</code> 属性其实是使用了 <code>PreparedRequest</code> 。有时在发送请求之前，你需要对 <code>body</code> 或者 <code>header</code> （或者别的什么东西）做一些额外处理，下面演示了一个简单的做法：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> requests <span class="hljs-keyword">import</span> Request, Session<br><br>s = Session()<br>req = Request(<span class="hljs-string">&#x27;GET&#x27;</span>, url,<br>    data=data,<br>    headers=header<br>)<br>prepped = req.prepare()<br><br><span class="hljs-comment"># do something with prepped.body</span><br><span class="hljs-comment"># do something with prepped.headers</span><br><br>resp = s.send(prepped,<br>    stream=stream,<br>    verify=verify,<br>    proxies=proxies,<br>    cert=cert,<br>    timeout=timeout<br>)<br><br><span class="hljs-built_in">print</span>(resp.status_code)<br></code></pre></div></td></tr></table></figure><p>由于你没有对 <code>Request</code> 对象做什么特殊事情，你立即准备和修改了 <code>PreparedRequest</code> 对象，然后把它和别的参数一起发送到 <code>requests.*</code> 或者 <code>Session.*</code>。</p><p>然而，上述代码会失去 <code>Requests Session</code> 对象的一些优势， 尤其 <code>Session</code> 级别的状态，例如 <code>cookie</code> 就不会被应用到你的请求上去。要获取一个带有状态的 <code>PreparedRequest</code>， 请用 <code>Session.prepare_request()</code> 取代 <code>Request.prepare()</code> 的调用，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> requests <span class="hljs-keyword">import</span> Request, Session<br><br>s = Session()<br>req = Request(<span class="hljs-string">&#x27;GET&#x27;</span>,  url,<br>    data=data<br>    headers=headers<br>)<br><br>prepped = s.prepare_request(req)<br><br><span class="hljs-comment"># do something with prepped.body</span><br><span class="hljs-comment"># do something with prepped.headers</span><br><br>resp = s.send(prepped,<br>    stream=stream,<br>    verify=verify,<br>    proxies=proxies,<br>    cert=cert,<br>    timeout=timeout<br>)<br><br><span class="hljs-built_in">print</span>(resp.status_code)<br></code></pre></div></td></tr></table></figure><h3 id="SSL-证书验证"><a href="#SSL-证书验证" class="headerlink" title="SSL 证书验证"></a>SSL 证书验证</h3><p><code>Requests</code> 可以为 <code>HTTPS</code> 请求验证 <code>SSL</code> 证书，就像 <code>web</code> 浏览器一样。 <code>SSL</code> 验证默认是开启的，如果证书验证失败，<code>Requests</code> 会抛出 <code>SSLError</code>:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>requests.get(<span class="hljs-string">&#x27;https://requestb.in&#x27;</span>)<br>requests.exceptions.SSLError: hostname <span class="hljs-string">&#x27;requestb.in&#x27;</span> doesn<span class="hljs-string">&#x27;t match either of &#x27;</span>*.herokuapp.com<span class="hljs-string">&#x27;, &#x27;</span>herokuapp.com<span class="hljs-string">&#x27;</span><br></code></pre></div></td></tr></table></figure><p>在该域名上我没有设置 SSL(现在已经设置了，返回的<code>&lt;Response [200]&gt;</code>)，所以失败了。但 Github 设置了 SSL:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>requests.get(<span class="hljs-string">&#x27;https://github.com&#x27;</span>, verify=<span class="hljs-literal">True</span>)<br>&lt;Response [<span class="hljs-number">200</span>]&gt;<br></code></pre></div></td></tr></table></figure><p>你可以为 <code>verify</code> 传入 <code>CA_BUNDLE</code> 文件的路径，或者包含可信任 <code>CA</code> 证书文件的文件夹路径：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>requests.get(<span class="hljs-string">&#x27;https://github.com&#x27;</span>, verify=<span class="hljs-string">&#x27;/path/to/certfile&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>或者将其保持在会话中：</p><figure class="highlight ini"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">s</span> = requests.Session()<br><span class="hljs-attr">s.verify</span> = <span class="hljs-string">&#x27;/path/to/certfile&#x27;</span><br></code></pre></div></td></tr></table></figure><p><strong>注解</strong></p><p>如果 <code>verify</code> 设为文件夹路径，文件夹必须通过 <code>OpenSSL</code> 提供的 <code>c_rehash</code> 工具处理。</p><p>你还可以通过 <code>REQUESTS_CA_BUNDLE</code> 环境变量定义可信任 <code>CA</code> 列表。</p><p>如果你将 <code>verify</code> 设置为 <code>False</code>，<code>Requests</code> 也能忽略对 <code>SSL</code> 证书的验证。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>requests.get(<span class="hljs-string">&#x27;https://kennethreitz.org&#x27;</span>, verify=<span class="hljs-literal">False</span>)<br>&lt;Response [<span class="hljs-number">200</span>]&gt;<br></code></pre></div></td></tr></table></figure><p>默认情况下， <code>verify</code> 是设置为 <code>True</code> 的。选项 <code>verify</code> 仅应用于主机证书。</p><blockquote><p>对于私有证书，你也可以传递一个 <code>CA_BUNDLE</code> 文件的路径给 <code>verify</code>。你也可以设置 <code># REQUEST_CA_BUNDLE </code>环境变量。</p></blockquote><h3 id="流式上传"><a href="#流式上传" class="headerlink" title="流式上传"></a>流式上传</h3><p><code>Requests</code>支持流式上传，这允许你发送大的数据流或文件而无需先把它们读入内存。要使用流式上传，仅需为你的请求体提供一个类文件对象即可：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;massive-body&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    requests.post(<span class="hljs-string">&#x27;http://some.url/streamed&#x27;</span>, data=f)<br></code></pre></div></td></tr></table></figure><p>强烈建议你用<code>二进制模式（binary mode）</code>打开文件。这是因为 <code>requests</code> 可能会为你提供 <code>header</code> 中的 <code>Content-Length</code>，在这种情况下该值会被设为文件的字节数。如果你用文本模式打开文件，就可能碰到错误。</p><h3 id="POST-多个分块编码的文件"><a href="#POST-多个分块编码的文件" class="headerlink" title="POST 多个分块编码的文件"></a>POST 多个分块编码的文件</h3><p>你可以在一个请求中发送多个文件。例如，假设你要上传多个图像文件到一个 <code>HTML</code> 表单，使用一个多文件 <code>field</code> 叫做 <code>&quot;images&quot;</code>:</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;images&quot;</span> <span class="hljs-attr">multiple</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">required</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br></code></pre></div></td></tr></table></figure><p>要实现，只要把文件设到一个元组的列表中，其中元组结构为 <code>(form_field_name, file_info)</code>:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>url = <span class="hljs-string">&#x27;http://httpbin.org/post&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>multiple_files = [<br>        (<span class="hljs-string">&#x27;images&#x27;</span>, (<span class="hljs-string">&#x27;foo.png&#x27;</span>, <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;foo.png&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>), <span class="hljs-string">&#x27;image/png&#x27;</span>)),<br>        (<span class="hljs-string">&#x27;images&#x27;</span>, (<span class="hljs-string">&#x27;bar.png&#x27;</span>, <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;bar.png&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>), <span class="hljs-string">&#x27;image/png&#x27;</span>))]<br><span class="hljs-meta">&gt;&gt;&gt; </span>r = requests.post(url, files=multiple_files)<br><span class="hljs-meta">&gt;&gt;&gt; </span>r.text<br>&#123;<br>  ...<br>  <span class="hljs-string">&#x27;files&#x27;</span>: &#123;<span class="hljs-string">&#x27;images&#x27;</span>: <span class="hljs-string">&#x27;data:image/png;base64,iVBORw ....&#x27;</span>&#125;<br>  <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;multipart/form-data; boundary=3131623adb2043caaeb5538cc7aa0b3a&#x27;</span>,<br>  ...<br>&#125;<br></code></pre></div></td></tr></table></figure><p>同样的，建议使用二进制打开文件。</p><h3 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h3><p>如果需要使用代理，你可以通过为任意请求方法提供 <code>proxies</code> 参数来配置单个请求:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>proxies = &#123;<br>  <span class="hljs-string">&quot;http&quot;</span>: <span class="hljs-string">&quot;http://10.10.1.10:3128&quot;</span>,<br>  <span class="hljs-string">&quot;https&quot;</span>: <span class="hljs-string">&quot;http://10.10.1.10:1080&quot;</span>,<br>&#125;<br><br>requests.get(<span class="hljs-string">&quot;http://example.org&quot;</span>, proxies=proxies)<br></code></pre></div></td></tr></table></figure><p>你也可以通过环境变量 <code>HTTP_PROXY</code> 和 <code>HTTPS_PROXY</code> 来配置代理。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">$ export HTTP_PROXY=<span class="hljs-string">&quot;http://10.10.1.10:3128&quot;</span><br>$ export HTTPS_PROXY=<span class="hljs-string">&quot;http://10.10.1.10:1080&quot;</span><br><br>$ python<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> requests<br><span class="hljs-meta">&gt;&gt;&gt; </span>requests.get(<span class="hljs-string">&quot;http://example.org&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>若你的代理需要使用<code>HTTP Basic Auth</code>，可以使用 <code>http://user:password@host/</code> 语法：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">proxies = &#123;<br>    <span class="hljs-string">&quot;http&quot;</span>: <span class="hljs-string">&quot;http://user:pass@10.10.1.10:3128/&quot;</span>,<br>&#125;<br></code></pre></div></td></tr></table></figure><p>要为某个特定的连接方式或者主机设置代理，使用 <code>scheme://hostname</code> 作为 <code>key</code>， 它会针对指定的主机和连接方式进行匹配。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">proxies = &#123;<span class="hljs-string">&#x27;http://10.20.1.128&#x27;</span>: <span class="hljs-string">&#x27;http://10.10.1.10:5323&#x27;</span>&#125;<br></code></pre></div></td></tr></table></figure><p>注意，代理 <code>URL</code> 必须包含连接方式。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Python库</category>
      
    </categories>
    
    
    <tags>
      
      <tag>http</tag>
      
      <tag>requests</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>爬虫去重策略</title>
    <link href="/2021/06/17/%E7%88%AC%E8%99%AB%E5%8E%BB%E9%87%8D%E7%AD%96%E7%95%A5/"/>
    <url>/2021/06/17/%E7%88%AC%E8%99%AB%E5%8E%BB%E9%87%8D%E7%AD%96%E7%95%A5/</url>
    
    <content type="html"><![CDATA[<ol><li><p>将访问过的URL保存到数据库</p></li><li><p>将访问过的URL保存到set中，只需要O(1)的代价就可以查询到URL，100000000*2byte*50个字符/1024/1024/1024 = 9G </p></li><li><p>URL经过md5等方法哈希保存到set中</p></li><li><p>用bitmap方法，将访问过的URL通过hash函数映射到某一位</p></li><li><p>bloomfilter方法对bitmap进行改进，多重hash函数降低冲突</p></li></ol><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>MD5</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>深度优先和广度优先算法</title>
    <link href="/2021/06/16/%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E5%92%8C%E5%B9%BF%E5%BA%A6%E4%BC%98%E5%85%88%E7%AE%97%E6%B3%95/"/>
    <url>/2021/06/16/%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E5%92%8C%E5%B9%BF%E5%BA%A6%E4%BC%98%E5%85%88%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>深度优先遍历(Depth First Search, 简称 DFS) 与广度优先遍历(Breath First Search)是图论中两种非常重要的算法，生产上广泛用于拓扑排序，寻路(走迷宫)，搜索引擎，爬虫等，也频繁出现在 leetcode，高频面试题中。</p><h2 id="深度优先遍历"><a href="#深度优先遍历" class="headerlink" title="深度优先遍历"></a>深度优先遍历</h2><p>主要思路是从图中一个未访问的顶点 V 开始，沿着一条路一直走到底，然后从这条路尽头的节点回退到上一个节点，再从另一条路开始走到底…，不断递归重复此过程，直到所有的顶点都遍历完成，它的特点是不撞南墙不回头，先走完一条路，再换一条路继续走。</p><p>树是图的一种特例(连通无环的图就是树)，接下来我们来看看树用深度优先遍历该怎么遍历。</p><p><img src="1.PNG"></p><p>我们从根节点 1 开始遍历，它相邻的节点有 2，3，4，先遍历节点 2，再遍历 2 的子节点 5，然后再遍历 5 的子节点 9。</p><p><img src="2.PNG"></p><p>上图中一条路已经走到底了(9是叶子节点，再无可遍历的节点)，此时就从 9 回退到上一个节点 5，看下节点 5 是否还有除 9 以外的节点，没有继续回退到 2，2 也没有除 5 以外的节点，回退到 1，1 有除 2 以外的节点 3，所以从节点 3 开始进行深度优先遍历，如下：</p><p><img src="3.PNG"></p><p>同理从 10 开始往上回溯到 6, 6 没有除 10 以外的子节点，再往上回溯，发现 3 有除 6 以外的子点 7，所以此时会遍历 7。同理从 10 开始往上回溯到 6, 6 没有除 10 以外的子节点，再往上回溯，发现 3 有除 6 以外的子点 7，所以此时会遍历 7。</p><p><img src="4.PNG"></p><p>从 7 往上回溯到 3， 1，发现 1 还有节点 4 未遍历，所以此时沿着 4， 8 进行遍历,这样就遍历完成了。</p><p>完整的节点的遍历顺序如下(节点上的的蓝色数字代表)：</p><p><img src="5.png"></p><p>相信大家看到以上的遍历不难发现这就是树的前序遍历,实际上不管是前序遍历，还是中序遍历，亦或是后序遍历，都属于深度优先遍历。</p><h2 id="广度优先遍历"><a href="#广度优先遍历" class="headerlink" title="广度优先遍历"></a>广度优先遍历</h2><p>广度优先遍历，指的是从图的一个未遍历的节点出发，先遍历这个节点的相邻节点，再依次遍历每个相邻节点的相邻节点。</p><p>上文所述树的广度优先遍历动图如下，每个节点的值即为它们的遍历顺序。所以广度优先遍历也叫层序遍历，先遍历第一层(节点 1)，再遍历第二层(节点 2，3，4)，第三层(5，6，7，8)，第四层(9，10)。</p><p><img src="1.gif"></p><p>深度优先遍历用的是栈，而广度优先遍历要用队列来实现，我们以下图二叉树为例来看看如何用队列来实现广度优先遍历。</p><p><img src="6.png"></p><p>动图如下：</p><p><img src="2.gif"></p><h2 id="算法实现"><a href="#算法实现" class="headerlink" title="算法实现"></a>算法实现</h2><h3 id="python实现深度优先"><a href="#python实现深度优先" class="headerlink" title="python实现深度优先"></a>python实现深度优先</h3><p>递归实现。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">depth_tree</span>(<span class="hljs-params">tree_node</span>):</span><br>    <span class="hljs-keyword">if</span> tree_node <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-built_in">print</span>(tree_node._data)<br>        <span class="hljs-keyword">if</span> tree_node._left <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> depth_tree(tree_node._left)<br>        <span class="hljs-keyword">if</span> tree_node._right <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> depth_tree(tree_node._right)<br></code></pre></div></td></tr></table></figure><h3 id="python实现广度优先"><a href="#python实现广度优先" class="headerlink" title="python实现广度优先"></a>python实现广度优先</h3><p>队列实现。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">level_queue</span>(<span class="hljs-params">root</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;利用队列实现广度优先遍历&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> root <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">return</span><br>    my_queue = []<br>    node = root<br>    my_queue.append(node)<br>    <span class="hljs-keyword">while</span> my_queue:<br>        node = my_queue.pop(<span class="hljs-number">0</span>)<br>        <span class="hljs-built_in">print</span>(node.elem)<br>        <span class="hljs-keyword">if</span> node.lchild <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            my_queue.append(node.lchild)<br>        <span class="hljs-keyword">if</span> node.rchild <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            my_queue.append(node.rchild)<br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>算法</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django入门-URL分发</title>
    <link href="/2021/06/16/Django%E5%85%A5%E9%97%A8-URL%E5%88%86%E5%8F%91/"/>
    <url>/2021/06/16/Django%E5%85%A5%E9%97%A8-URL%E5%88%86%E5%8F%91/</url>
    
    <content type="html"><![CDATA[<h2 id="URLs"><a href="#URLs" class="headerlink" title="URLs"></a>URLs</h2><p>我们要实现一个新的功能，就是列出某个板块下的所有主题列表。</p><p>首先，我们要了解一个函数<code>re_path()</code>，<code>re_path(route, view, kwargs=None, name=None)</code>返回一个元素，以便包含在<code>urlpatterns</code>中。<code>route</code> 参数应该是一个字符串或 <code>gettext_lazy() </code>，它包含一个与 <code>Python</code> 的 <code>re</code> 模块兼容的正则表达式。字符串通常使用原始字符串语法（<code>r&#39;&#39;</code>），因此它们可以包含像 <code>/d</code> 这样的序列，而不需要用另一个反斜杠来转义。当进行匹配时，从正则表达式中捕获的组会被传递到视图中 —— 如果组是命名的，则作为命名的参数，否则作为位置参数。值以字符串的形式传递，不进行任何类型转换。</p><p>在这里先修改<code>boards/urls</code>开始修改：</p><p><strong>boards/urls</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path, re_path<br><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views<br><br>urlpatterns = [<br>    path(<span class="hljs-string">&#x27;&#x27;</span>, views.home, name=<span class="hljs-string">&#x27;home&#x27;</span>),<br>    re_path(<span class="hljs-string">r&#x27;^boards/(?P&lt;pk&gt;\d+)/$&#x27;</span>, views.board_topics, name=<span class="hljs-string">&#x27;board_topics&#x27;</span>)<br>]<br></code></pre></div></td></tr></table></figure><p><code>URL 调度器（dispatcher）</code>和 <code>URLconf （URL configuration）</code>是 <code>Django</code>应用中的基础部分。</p><p>一个项目可以有很多 <code>urls.py</code> 分布在多个应用（app）中。<code>Django</code> 需要一个 <code>url.py</code>作为入口。这个特殊的 <code>urls.py</code> 叫做 <em>根路由配置（root URLconf）</em>。它被定义在 <code>settings.py</code> 中。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">ROOT_URLCONF = <span class="hljs-string">&#x27;myproject.urls&#x27;</span><br></code></pre></div></td></tr></table></figure><p>它已经自动配置好了，你不需要去改变它任何东西。</p><p>当 <code>Django</code> 接受一个<em>请求（request）</em>， 它就会在项目的 <code>URLconf</code> 中寻找匹配项。他从 <code>urlpatterns</code> 变量的第一条开始，然后在每个 <code>url</code> 中去匹配请求的 <code>URL</code>。</p><p>如果 <code>Django</code> 找到了一个匹配路径，他会把请求（request）发送给 <code>re_path</code> 的第二个参数 <code>视图函数（view function）</code>。 <code>urlpatterns</code> 中的顺序很重要，因为 <code>Django</code> 一旦找到匹配就会停止往后搜索。如果 <code>Django</code> 在 <code>URLconf</code> 中没有找到匹配项，他会通过 <code>Page Not Found</code> 的错误处理代码抛出一个 404 异常。</p><h2 id="基础URLs路由"><a href="#基础URLs路由" class="headerlink" title="基础URLs路由"></a>基础URLs路由</h2><p>基础URL创建起来很容易。就只是个匹配字符串的问题，比如说，我们想创建一个”about”页面，可以这样定义：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">urlpatterns = [<br>    path(<span class="hljs-string">&#x27;&#x27;</span>, views.home, name=<span class="hljs-string">&#x27;home&#x27;</span>),<br>    re_path(<span class="hljs-string">r&#x27;^about/$&#x27;</span>, views.about, name=<span class="hljs-string">&#x27;about&#x27;</span>)<br>]<br></code></pre></div></td></tr></table></figure><p>也可以创建更深层一点的URL结构：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">urlpatterns = [<br>    path(<span class="hljs-string">&#x27;&#x27;</span>, views.home, name=<span class="hljs-string">&#x27;home&#x27;</span>),<br>    re_path(<span class="hljs-string">r&#x27;^about/$&#x27;</span>, views.about, name=<span class="hljs-string">&#x27;about&#x27;</span>),<br>    re_path(<span class="hljs-string">r&#x27;^about/$&#x27;</span>, views.home, name=<span class="hljs-string">&#x27;about&#x27;</span>)<br>]<br></code></pre></div></td></tr></table></figure><p>对于上面的例子，视图函数如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">about</span>(<span class="hljs-params">request</span>):</span><br>    <span class="hljs-comment"># do something</span><br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;about.html&#x27;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">about_company</span>(<span class="hljs-params">request</span>):</span><br>    <span class="hljs-comment"># do something</span><br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;about_company.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;company_name&#x27;</span>: <span class="hljs-string">&#x27;Simple Complex&#x27;</span>&#125;)<br></code></pre></div></td></tr></table></figure><h2 id="高级URLs路由"><a href="#高级URLs路由" class="headerlink" title="高级URLs路由"></a>高级URLs路由</h2><p>更高级的URL路由使用方法是通过正则表达式来匹配某些类型的数据并创建动态URL。</p><p>列如，要创建一个个人资料的页面，可以这样做：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">urlpatterns = [<br>    path(<span class="hljs-string">&#x27;&#x27;</span>, views.home, name=<span class="hljs-string">&#x27;home&#x27;</span>),<br>    re_path(<span class="hljs-string">r&#x27;^(?P&lt;username&gt;[\w.@+-]+)/$&#x27;</span>, views.user_profile, name=<span class="hljs-string">&#x27;user_profile&#x27;</span>)<br>]<br></code></pre></div></td></tr></table></figure><p>它会匹配 <code>Django</code> 用户模型里面所有有效的用户名。</p><p>现在我们可以看到上面的例子是一个很宽松的 <code>URL</code>。这意味大量的 <code>URL patterns</code> 都会被它匹配，因为它定义在 <code>URL的根</code>，而不像<code> /profile//</code>这样。在这种情况下，如果我们想定义一个<code>/about/</code> 的URL，我们要把它定义在这个 <code>username URL pattern</code> 的前面∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">urlpatterns = [<br>    path(<span class="hljs-string">&#x27;&#x27;</span>, views.home, name=<span class="hljs-string">&#x27;home&#x27;</span>),<br>    re_path(<span class="hljs-string">r&#x27;^about/$&#x27;</span>, views.about, name=<span class="hljs-string">&#x27;about&#x27;</span>),<br>    re_path(<span class="hljs-string">r&#x27;^(?P&lt;username&gt;[\w.@+-]+)/$&#x27;</span>, views.user_profile, name=<span class="hljs-string">&#x27;user_profile&#x27;</span>)<br>]<br></code></pre></div></td></tr></table></figure><p>如果这个<code>&quot;about&quot; </code>页面定义在<code>usrename URL pattern</code> 后面，<code>Django</code> 将永远找不到它，因为<code>&quot;about&quot;</code>这个单词会先被<code>usrname</code>的正则表达式所匹配到，视图函数 <code>user_profile</code> 将会被执行而不是执行 <code>about</code> 。</p><p>此外，这有一些副作用。例如，从现在开始，我们要把<code>&quot;about&quot;</code> 视为禁止使用的<code>username</code>，因为如果有用户将<code>&quot;about&quot;</code>作为他们的<code>username</code>，他们将永远不能看到他们的个人资料页面，而看到的<code>abou</code>t页面。</p><p>开始的时候，我们使用<code>Board ID</code>去创建 <code>Topics列表</code>的动态页面。让我们再来看一下我在 <code>URLs</code> 开头的部分给出的例子∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">re_path(<span class="hljs-string">r&#x27;^boards/(?P&lt;pk&gt;\d+)/$&#x27;</span>, views.board_topics, name=<span class="hljs-string">&#x27;board_topics&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>正则表达式中的 <code>\d+</code>，会匹配一个任意大小的整数值。这个整数值用来从数据库中取到 <code>指定的 Board</code>。现在注意我们这样写这个正则表达式 <code>（? P&lt;pk&gt;d+）</code>，这是告诉 <code>Django</code> 将捕获到的值放入名为 <code>pk</code> 的关键字参数中。这时我们为它写的一个视图函数∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">board_topics</span>(<span class="hljs-params">request, pk</span>):</span><br>  <span class="hljs-comment"># dosomthing</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br></code></pre></div></td></tr></table></figure><p>因为我们使用了 <code>（?P&lt;pk&gt;d+）</code>正则表达式，在 <code>board_topics</code> 函数中，关键字参数必须命名为 <code>pk</code>。</p><p>如果你想在视图函数使用任意名字的参数，那么可以这样定义∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">url(<span class="hljs-string">r&#x27;^boards/(\d+)/$&#x27;</span>,views.board_topics,name=<span class="hljs-string">&#x27;board_topic s&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>然后在视图函数可以这样定义∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">board_topics</span>(<span class="hljs-params">request,board_id</span>):</span><br>  <span class="hljs-comment"># do something...</span><br></code></pre></div></td></tr></table></figure><p>或者这样:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">board_topics</span>(<span class="hljs-params">request,<span class="hljs-built_in">id</span></span>):</span><br></code></pre></div></td></tr></table></figure><p>名字不重要，但是使用命名参数是一个很好的办法，因为，当我们有个更大的URL去捕获多个ID和变量时，这会更加便于我们阅读。</p><h2 id="使用URLS-API"><a href="#使用URLS-API" class="headerlink" title="使用URLS API"></a>使用URLS API</h2><p>现在来写代码实现开头提到的主题列表页面。</p><p>首先，编辑<code>boars/urls.py</code>添加新的URL路由。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">urlpatterns = [<br>    path(<span class="hljs-string">&#x27;&#x27;</span>, views.home, name=<span class="hljs-string">&#x27;home&#x27;</span>),<br>    re_path(<span class="hljs-string">r&#x27;^boards/(?P&lt;pk&gt;\d+)/$&#x27;</span>, views.board_topics, name=<span class="hljs-string">&#x27;board_topics&#x27;</span>),<br>]<br></code></pre></div></td></tr></table></figure><p>再创建视图函数<code>board_topics</code>：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">board_topics</span>(<span class="hljs-params">request, pk</span>):</span><br>    board = Board.objects.get(pk=pk)<br>    <span class="hljs-keyword">return</span> render((request, <span class="hljs-string">&#x27;topics.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;board&#x27;</span>: board&#125;))<br></code></pre></div></td></tr></table></figure><p>在<code>templates</code>目录中，创建一个名为<code>topics.html</code>的模板：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">&#123;% load static %&#125;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>&#123;&#123;board.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;% static &#x27;css/bootstrap.min.css&#x27; %&#125;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb my-4&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb-item&quot;</span>&gt;</span>Boards<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb-item active&quot;</span>&gt;</span>&#123;&#123; boards.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>在浏览器中访问<code>http://127.0.0.1:8000/boards/1/</code>，显示下面结果：</p><p><img src="1.PNG"></p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django入门-Django Admin</title>
    <link href="/2021/06/16/Django%E5%85%A5%E9%97%A8-Django-Admin/"/>
    <url>/2021/06/16/Django%E5%85%A5%E9%97%A8-Django-Admin/</url>
    
    <content type="html"><![CDATA[<h2 id="Django-Admin-简介"><a href="#Django-Admin-简介" class="headerlink" title="Django Admin 简介"></a>Django Admin 简介</h2><p>当我们开始第一个新项目的时候，<code>Django</code>已经配置了<code>Django Admin</code>，这个应用程序列出的<code>INSTALLED_APPS</code>。</p><p>使用<code>Django Admin</code>的一个很好的列子就是在博客中，它可以用来被作者用来编写和发布文章。另一个列子是电子商务网站，工作人员可以创建，编辑，删除产品。</p><p>现在，我们来配置<code>Django Admin</code>来维护我们应用程序的板块。</p><p>首先，创建一个管理员账户：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&gt;&gt;&gt;python manage.py createsuperuser<br></code></pre></div></td></tr></table></figure><p>按说明设置管理员账户名，邮箱和密码：</p><figure class="highlight applescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs applescript">Username (leave blank <span class="hljs-keyword">to</span> use &#x27;q&#x27;): Admin<br>Email address: espholychan@outlook.com<br>Password:<br>Password (again):<br>The password <span class="hljs-keyword">is</span> too similar <span class="hljs-keyword">to</span> <span class="hljs-keyword">the</span> username.<br>This password <span class="hljs-keyword">is</span> too short. It must <span class="hljs-keyword">contain</span> <span class="hljs-keyword">at</span> least <span class="hljs-number">8</span> <span class="hljs-built_in">characters</span>.<br>This password <span class="hljs-keyword">is</span> too common.<br>Bypass password validation <span class="hljs-keyword">and</span> create user anyway? [y/N]: y<br>Superuser created successfully.<br></code></pre></div></td></tr></table></figure><p>在浏览器访问<code>http://127.0.0.1/admin</code>。</p><p><img src="1.PNG"></p><p>输入刚才设置的用户名和密码到管理界面：</p><p><img src="2.PNG"></p><p>它已经配置了一些功能。在这里，我们可以添加用户和组的权限管理，这些概念在后面将会探讨。</p><p>添加<code>Board</code>模型，在<code>boards</code>目录中的<code>admin.py</code>文件中添加以下代码：</p><p><strong>boards/admin.py</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Board<br><span class="hljs-comment"># Register your models here.</span><br><br>admin.site.register(Board)<br></code></pre></div></td></tr></table></figure><p>保存<code>admin.py</code>文件，然后刷新页面。</p><p><img src="3.PNG"></p><p>可以新增板块。</p><p><img src="4.PNG"></p><p>查看主页，新的板块已经添加。</p><p><img src="5.PNG"></p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django入门-静态文件设置</title>
    <link href="/2021/06/16/Django%E5%85%A5%E9%97%A8-%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E8%AE%BE%E7%BD%AE/"/>
    <url>/2021/06/16/Django%E5%85%A5%E9%97%A8-%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E8%AE%BE%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<p>静态文件设置静态文件是指 <code>CSS</code>，<code>JavaScript</code>，<code>字体</code>，<code>图片</code>或者是用<code>来组成用户界面的任何其他资源</code>。</p><p><code>Django</code> 本身是不负责处理这些文件的，但是为了让我们的开发过程更轻松，<code>Django</code> 提供了一些功能来帮助我们管理静态文件。这些功能可在 <code>INSTALLED_APPS</code> 的<code> django.contrib.staticfiles</code> 应用程序中找到。实际上，<code>Django</code>为了使得开发方便，也可以处理静态文件，而在生产环境下，静态文件一般直接由 <code>Nginx</code> 等反向代理服务器处理，而应用工服务器专心负责处理它擅长的业务逻辑。</p><p>市面上很多优秀前端组件框架，我们没有理由继续用简陋的HTML文档来渲染。我们可以轻松地将<code>Bootstrap 4</code>添加到我们的项目中。<code>Bootstrap</code>是—个用<code>HTML</code>，<code>CSS</code>和<code>JavaScript</code>开发的前端开源工具包。</p><p>在项目根目录中，除了 <code>boards</code>， <code>templates</code> 和<code>myproject</code>文件夹外，再创建一个名为<code>static</code>的新文件夹，并在<code>static</code>文件夹内创建另一个名为<code>css</code>的文件夹∶</p><p>转到<a href="getbootstrap.com">getbootstrap.com</a>并下载最新版本：</p><p><img src="1.png"></p><p>下载编译版本的<code>CSS</code>和<code>JS</code></p><p>在你的计算机中，解压 <code>bootstrap-5.0.1-dist</code> 文件，将文件 <code>css/bootstrap.min.css </code>复制到我们项目的<code>css</code>文件夹中∶</p><p>下一步是告诉<code>Django</code>在哪里可以找到静态文件。打开<code>settings.py</code>，拉到文件的底部，在<code>STATIC_URL</code>后面添加以下内容∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">STATIC_URL = <span class="hljs-string">&#x27;/static/&#x27;</span><br><br>STATICFILES_DIRS = [<br>    os.path.join(BASE_DIR, <span class="hljs-string">&quot;static&quot;</span>),<br>]<br></code></pre></div></td></tr></table></figure><p>还记得 <code>TEMPLATES</code>目录吗，和这个配置是一样的，现在我们必须在模板中加载静态文件（<code>Bootstrap CSS</code>文件）。</p><p><strong>templates/home.html</strong></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">&#123;% load static %&#125;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Boards<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;% static &#x27;css/bootstrap.min.css&#x27; %&#125;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Boards<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Board<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Posts<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Topics<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Last Post<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span><br>                &#123;% for board in boards %&#125;<br>                    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br>                            &#123;&#123;board.name&#125;&#125; <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #888;&quot;</span>&gt;</span>&#123;&#123;board.description&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>            &#123;% endfor %&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>首先，我们在模板的开头使用了 <code>Static Files App</code> 模板标签 <code>&#123;% load static%&#125;</code>。</p><p>模板标签 <code>&#123;% static %&#125;</code> 用于构成资源文件完整URL。在这种情况下， <code>&#123;% static 'css/bootstrap.min.css' %&#125;</code> 将返回<code>/static/css/bootstrap.min.css</code>，它相当于 <code>http://127.0.0.1:8000/static/css/bootstrap.min.css</code>。</p><p><code>&#123;% static %&#125;</code>模板标签使用 <code>settings.py</code> 文件中的 <code>STATIC_uRL</code> 配置来组成最终的URL，例如，如果您将静态文件托管在像<code>https∶//static.example.com/</code>这样的子域中，那么我们将设置 <code>STATIC_URL=https∶//static.example.com/</code> ，然后 <code>&#123;% static'css/bootstrap.min.css' %&#125;</code> 返回的是<code>https://static.example.com/css/bootstrap.min.css</code>。记得但凡是需要引用<code>CSS</code>， <code>JavaScript</code>或图片文件的地方就使用 <code>&#123;% static %&#125;</code>稍后，当我们开始部署项目到正式环境时，我们将讨论更多。现在都设置好了。</p><p>刷新页面 <code>http∶//127.0.0.1∶8000</code>，我们可以看到它可以正常运行∶</p><p>现在我们可以编辑模板，以利用<code>Bootstrap CSS</code>∶</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">&#123;% load static %&#125;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Boards<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;% static &#x27;css/bootstrap.min.css&#x27; %&#125;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb my-4&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumb-item active&quot;</span>&gt;</span>Boards<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span><br><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;table&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">thead</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;thead-inverse&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Board<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Posts<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Topics<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Last Post<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span><br>                    &#123;% for board in boards %&#125;<br>                        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br>                                &#123;&#123;board.name&#125;&#125; <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #888;&quot;</span>&gt;</span>&#123;&#123;board.description&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>                &#123;% endfor %&#125;<br>                <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>显示效果：</p><p><img src="2.PNG"></p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python多线程基本原理</title>
    <link href="/2021/06/15/python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/"/>
    <url>/2021/06/15/python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="多线程的含义"><a href="#多线程的含义" class="headerlink" title="多线程的含义"></a>多线程的含义</h2><p>说起多线程，就不得不先说什么是线程。然而想要弄明白什么是线程，又不得不先说什么是进程。</p><p>进程可以理解为是一个可以独立运行的程序单位，比如打开一个浏览器，这就开启了一个浏览器进程；打开一个文本编辑器，这就开启了一个文本编辑器进程。但一个进程中是可以同时处理很多事情的，比如在浏览器中，可以在多个选项卡中打开多个页面，有的页面在播放音乐，有的页面在播放视频，有的网页在播放动画，它们可以同时运行，互不干扰。为什么能同时做到同时运行这么多的任务呢？这里就需要引出线程的概念了，其实这一个个任务，实际上就对应着一个个线程的执行。</p><p>而进程呢？它就是<strong>线程的集合</strong>，进程就是由一个或多个线程构成的，线程是操作系统进行运算调度的最小单位，是进程中的一个最小运行单元。比如上面所说的浏览器进程，其中的播放音乐就是一个线程，播放视频也是一个线程，当然其中还有很多其他的线程在同时运行，这些线程的并发或并行执行最后使得整个浏览器可以同时运行这么多的任务。</p><p>了解了线程的概念，多线程就很容易理解了，多线程就是一个进程中同时执行多个线程，前面所说的浏览器的情景就是典型的多线程执行。</p><h2 id="并发和并行"><a href="#并发和并行" class="headerlink" title="并发和并行"></a>并发和并行</h2><p>并说到多进程和多线程，这里就需要再讲解两个概念，那就是并发和并行。知道，一个程序在计算机中运行，其底层是处理器通过运行一条条的指令来实现的。</p><p>并发，英文叫作<code>concurrency</code>。它是指同一时刻只能有一条指令执行，但是多个线程的对应的指令被快速轮换地执行。比如一个处理器，它先执行线程<code>A</code>的指令一段时间，再执行线程<code>B</code>的指令一段时间，再切回到线程<code>A</code>执行一段时间。</p><p>由于处理器执行指令的速度和切换的速度非常非常快，人完全感知不到计算机在这个过程中有多个线程切换上下文执行的操作，这就使得宏观上看起来多个线程在同时运行。但微观上只是这个处理器在连续不断地在多个线程之间切换和执行，每个线程的执行一定会占用这个处理器一个时间片段，同一时刻，其实只有一个线程在执行。</p><p>并行，英文叫作<code>parallel</code>。它是指同一时刻，有多条指令在多个处理器上同时执行，并行必须要依赖于多个处理器。不论是从宏观上还是微观上，多个线程都是在同一时刻一起执行的。</p><p>并行只能在多处理器系统中存在，如果的计算机处理器只有一个核，那就不可能实现并行。而并发在单处理器和多处理器系统中都是可以存在的，因为仅靠一个核，就可以实现并发。</p><p>举个例子，比如系统处理器需要同时运行多个线程。如果系统处理器只有一个核，那它只能通过并发的方式来运行这些线程。如果系统处理器有多个核，当一个核在执行一个线程时，另一个核可以执行另一个线程，这样这两个线程就实现了并行执行，当然其他的线程也可能和另外的线程处在同一个核上执行，它们之间就是并发执行。具体的执行方式，就取决于操作系统的调度了。</p><h2 id="多线程适用场景"><a href="#多线程适用场景" class="headerlink" title="多线程适用场景"></a>多线程适用场景</h2><p>多在一个程序进程中，有一些操作是比较耗时或者需要等待的，比如等待数据库的查询结果的返回，等待网页结果的响应。如果使用单线程，处理器必须要等到这些操作完成之后才能继续往下执行其他操作，而这个线程在等待的过程中，处理器明显是可以来执行其他的操作的。如果使用多线程，处理器就可以在某个线程等待的时候，去执行其他的线程，从而从整体上提高执行效率。</p><p>像上述场景，线程在执行过程中很多情况下是需要等待的。比如网络爬虫就是一个非常典型的例子，爬虫在向服务器发起请求之后，有一段时间必须要等待服务器的响应返回，这种任务就属于<code>IO</code>密集型任务。对于这种任务，如果启用多线程，处理器就可以在某个线程等待的过程中去处理其他的任务，从而提高整体的爬取效率。</p><p>但并不是所有的任务都是<code>IO</code>密集型任务，还有一种任务叫作计算密集型任务，也可以称之为<code>CPU</code>密集型任务。顾名思义，就是任务的运行一直需要处理器的参与。此时如果开启了多线程，一个处理器从一个计算密集型任务切换到切换到另一个计算密集型任务上去，处理器依然不会停下来，始终会忙于计算，这样并不会节省总体的时间，因为需要处理的任务的计算总量是不变的。如果线程数目过多，反而还会在线程切换的过程中多耗费一些时间，整体效率会变低。</p><p>所以，如果任务不全是计算密集型任务，可以使用多线程来提高程序整体的执行效率。尤其对于网络爬虫这种IO密集型任务来说，使用多线程会大大提高程序整体的爬取效率。</p><h2 id="Python实现多线程"><a href="#Python实现多线程" class="headerlink" title="Python实现多线程"></a>Python实现多线程</h2><p>实在<code>Python</code>中，实现多线程的模块叫作<code>threading</code>，是<code>Python</code>自带的模块。使用<code>threading</code>实现多线程的方法。</p><p>###Thread直接创建子线程</p><p>首先，可以使用<code>Thread</code>类来创建一个线程，创建时需要指定<code>target</code>参数为运行的方法名称，如果被调用的方法需要传入额外的参数，则可以通过<code>Thread</code>的<code>args</code>参数来指定。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">target</span>(<span class="hljs-params">second</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Threading <span class="hljs-subst">&#123;threading.currentThread().name&#125;</span> id runing&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Threading <span class="hljs-subst">&#123;threading.current_thread().name&#125;</span> sleep <span class="hljs-subst">&#123;second&#125;</span>s&#x27;</span>)<br>    time.sleep(second)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Threading <span class="hljs-subst">&#123;threading.currentThread().name&#125;</span> is ended&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Threading <span class="hljs-subst">&#123;threading.currentThread().name&#125;</span> id runing&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1</span>, <span class="hljs-number">5</span>]:<br>    thread = threading.Thread(target=target, args=[i])<br>    thread.start()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Threading <span class="hljs-subst">&#123;threading.currentThread().name&#125;</span> is ended&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Threading MainThread <span class="hljs-built_in">id</span> runing<br>Threading Thread-<span class="hljs-number">1</span> <span class="hljs-built_in">id</span> runing<br>Threading Thread-<span class="hljs-number">1</span> sleep 1s<br>Threading Thread-<span class="hljs-number">2</span> <span class="hljs-built_in">id</span> runingThreading MainThread <span class="hljs-keyword">is</span> ended<br><br>Threading Thread-<span class="hljs-number">2</span> sleep 5s<br>Threading Thread-<span class="hljs-number">1</span> <span class="hljs-keyword">is</span> ended<br>Threading Thread-<span class="hljs-number">2</span> <span class="hljs-keyword">is</span> ended<br></code></pre></div></td></tr></table></figure><p>在这里首先声明了一个方法，叫作<code>target</code>，它接收一个参数为<code>second</code>，通过方法的实现可以发现，这个方法其实就是执行了一个<code>time.sleep</code>休眠操作，<code>second</code>参数就是休眠秒数，其前后都<code>print</code>了一些内容，其中线程的名字通过<code>threading.current_thread().name</code>来获取出来，如果是主线程的话，其值就是<code>MainThread</code>，如果是子线程的话，其值就是<code>Thread-*</code>。</p><p>然后通过<code>Thead</code>类新建了两个线程，<code>target</code>参数就是刚才所定义的方法名，<code>args</code>以列表的形式传递。两次循环中，这里<code>i</code>分别就是<code>1</code>和<code>5</code>，这样两个线程就分别休眠<code>1</code>秒·和5秒，声明完成之后，调用<code>start</code>方法即可开始线程的运行。</p><p>观察结果可以发现，这里一共产生了三个线程，分别是主线程<code>MainThread</code>和两个子线程<code>Thread-1</code>、<code>Thread-2</code>。另外观察到，主线程首先运行结束，紧接着<code>Thread-1</code>、<code>Thread-2</code>才接连运行结束，分别间隔了<code>1</code>秒和<code>4</code>秒。这说明主线程并没有等待子线程运行完毕才结束运行，而是直接退出了，有点不符合常理。如果想要主线程等待子线程运行完毕之后才退出，可以让每个子线程对象都调用下<code>join</code>方法，实现如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">threads = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1</span>, <span class="hljs-number">5</span>]:<br>    thread = threading.Thread(target=target, args=[i])<br>    threads.append(thread)<br>    thread.start()<br><span class="hljs-keyword">for</span> thread <span class="hljs-keyword">in</span> threads:<br>    thread.join()<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Threading MainThread <span class="hljs-built_in">id</span> runing<br>Threading Thread-<span class="hljs-number">1</span> <span class="hljs-built_in">id</span> runing<br>Threading Thread-<span class="hljs-number">1</span> sleep 1s<br>Threading Thread-<span class="hljs-number">2</span> <span class="hljs-built_in">id</span> runing<br>Threading Thread-<span class="hljs-number">2</span> sleep 5s<br>Threading Thread-<span class="hljs-number">1</span> <span class="hljs-keyword">is</span> ended<br>Threading Thread-<span class="hljs-number">2</span> <span class="hljs-keyword">is</span> ended<br>Threading MainThread <span class="hljs-keyword">is</span> ended<br></code></pre></div></td></tr></table></figure><p>主线程必须等待子线程都运行结束，主线程才继续运行并结束。</p><h2 id="继承Thread类创建子线程"><a href="#继承Thread类创建子线程" class="headerlink" title="继承Thread类创建子线程"></a>继承Thread类创建子线程</h2><p>另外，也可以通过继承<code>Thread</code>类的方式创建一个线程，该线程需要执行的方法写在类的<code>run</code>方法里面即可。上面的例子的等价改写为：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> threading<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span>(<span class="hljs-params">threading.Thread</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, second</span>):</span><br>        threading.Thread.__init__(self)<br>        self.second = second<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Threading <span class="hljs-subst">&#123;threading.current_thread().name&#125;</span> is runing&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Threding <span class="hljs-subst">&#123;threading.current_thread().name&#125;</span> sleep <span class="hljs-subst">&#123;self.second&#125;</span>s&#x27;</span>)<br>        time.sleep(self.second)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Threading <span class="hljs-subst">&#123;threading.current_thread().name&#125;</span> is ended&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Threading <span class="hljs-subst">&#123;threading.current_thread().name&#125;</span> is running&#x27;</span>)<br>threads = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1</span>, <span class="hljs-number">5</span>]:<br>    thread = MyThread(i)<br>    threads.append(thread)<br>    thread.start()<br><span class="hljs-keyword">for</span> thread <span class="hljs-keyword">in</span> threads:<br>    thread.join()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Threading <span class="hljs-subst">&#123;threading.current_thread().name&#125;</span> is ended&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Threading MainThread <span class="hljs-built_in">id</span> runing<br>Threading Thread-<span class="hljs-number">1</span> <span class="hljs-built_in">id</span> runing<br>Threading Thread-<span class="hljs-number">1</span> sleep 1s<br>Threading Thread-<span class="hljs-number">2</span> <span class="hljs-built_in">id</span> runing<br>Threading Thread-<span class="hljs-number">2</span> sleep 5s<br>Threading Thread-<span class="hljs-number">1</span> <span class="hljs-keyword">is</span> ended<br>Threading Thread-<span class="hljs-number">2</span> <span class="hljs-keyword">is</span> ended<br>Threading MainThread <span class="hljs-keyword">is</span> ended<br></code></pre></div></td></tr></table></figure><p>可以看到，两种实现方式，其运行效果是相同的。</p><h2 id="守护进程"><a href="#守护进程" class="headerlink" title="守护进程"></a>守护进程</h2><p>在线程中有一个叫作守护线程的概念，如果一个线程被设置为守护线程，那么意味着这个线程是“不重要”的，这意味着，如果主线程结束了而该守护线程还没有运行完，那么它将会被强制结束。在<code>Python</code>中可以通过<code>setDaemon</code>方法来将某个线程设置为守护线程。</p><p>示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Threding MainThread <span class="hljs-keyword">is</span> running<br>Threading Thread-<span class="hljs-number">1</span> <span class="hljs-keyword">is</span> running<br>Threding Thread-<span class="hljs-number">1</span> sleep 2s<br>Threading Thread-<span class="hljs-number">2</span> <span class="hljs-keyword">is</span> running<br>Threding Thread-<span class="hljs-number">2</span> sleep 5s<br>Threading MainThread <span class="hljs-keyword">is</span> ended<br>Threading Thread-<span class="hljs-number">1</span> <span class="hljs-keyword">is</span> ended<br></code></pre></div></td></tr></table></figure><p>在这里通过 setDaemon方法将 t2 设置为了守护线程，这样主线程在运行完毕时，t2 线程会随着线程的结束而结束。</p><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Threding MainThread <span class="hljs-keyword">is</span> running<br>Threading Thread-<span class="hljs-number">1</span> <span class="hljs-keyword">is</span> running<br>Threding Thread-<span class="hljs-number">1</span> sleep 2s<br>Threading Thread-<span class="hljs-number">2</span> <span class="hljs-keyword">is</span> running<br>Threding Thread-<span class="hljs-number">2</span> sleep 5s<br>Threading MainThread <span class="hljs-keyword">is</span> ended<br>Threading Thread-<span class="hljs-number">1</span> <span class="hljs-keyword">is</span> ended<br></code></pre></div></td></tr></table></figure><p>可以看到，没有<code>Thread-2</code>打印退出的消息，<code>Thread-2</code>随着主线程的退出而退出了。</p><p>这里并没有调用<code>join</code>方法，如果让<code>t1</code>和<code>t2</code>都调用<code>join</code>方法，主线程就会仍然等待各个子线程执行完毕再退出，不论其是否是守护线程。</p><h2 id="互斥锁"><a href="#互斥锁" class="headerlink" title="互斥锁"></a>互斥锁</h2><p>互在一个进程中的多个线程是共享资源的，比如在一个进程中，有一个全局变量<code>count</code>用来计数，声明多个线程，每个线程运行时都给<code>count</code>加<code>1</code>，代码实现如下：</p><p>在这里，声明了<code>1000</code>个线程，每个线程都是现取到当前的全局变量<code>count</code>值，然后休眠一小段时间，然后对<code>count</code>赋予新的值。</p><p>按照常理来说，最终的<code>count</code>值应该为<code>1000</code>。但其实不然。运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Final count: <span class="hljs-number">15</span><br></code></pre></div></td></tr></table></figure><p>最后的结果居然只有<code>15</code>，而且多次运行或者换个环境运行结果是不同的.这是为什么呢？因为<code>count</code>这个值是共享的，每个线程都可以在执行<code>temp = count</code>这行代码时拿到当前<code>count</code>的值，但是这些线程中的一些线程可能是并发或者并行执行的，这就导致不同的线程拿到的可能是同一个<code>count</code>值，最后导致有些线程的<code>count</code>的加<code>1</code>操作并没有生效，导致最后的结果偏小。</p><p>所以，如果多个线程同时对某个数据进行读取或修改，就会出现不可预料的结果。为了避免这种情况，我们需要对多个线程进行同步，要实现同步，我们可以对需要操作的数据进行<strong>加锁保护</strong>，这里就需要用到<code>threading.Lock</code>了。</p><p>加锁保护是什么意思呢？就是说，某个线程在对数据进行操作前，需要先加锁，这样其他的线程发现被加锁了之后，就无法继续向下执行，会一直等待锁被释放，只有加锁的线程把锁释放了，其他的线程才能 继续加锁并对数据做修改，修改完了再释放锁。这样可以确保同一时间只有一个线程操作数据，多个线程不会再同时读取和修改同一个数据，这样最后的运行结果就是对的了。</p><p>将代码修改为如下内容：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> threading<br><br>count = <span class="hljs-number">0</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span>(<span class="hljs-params">threading.Thread</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        threading.Thread.__init__(self)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">global</span> count<br>        lock.acquire()  <span class="hljs-comment"># 加锁</span><br>        temp = count + <span class="hljs-number">1</span><br>        time.sleep(<span class="hljs-number">0.001</span>)<br>        count = temp<br>        lock.release() <span class="hljs-comment"># 解锁</span><br><br>threads = []<br>lock = threading.Lock() <span class="hljs-comment"># 创建一把锁</span><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>):<br>    thread = MyThread()<br>    thread.start()<br>    threads.append(thread)<br><br><span class="hljs-keyword">for</span> thread <span class="hljs-keyword">in</span> threads:<br>    thread.join()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Final count: <span class="hljs-subst">&#123;count&#125;</span>&#x27;</span>)<br><br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Final count: <span class="hljs-number">1000</span><br></code></pre></div></td></tr></table></figure><h2 id="Python多线程的问题"><a href="#Python多线程的问题" class="headerlink" title="Python多线程的问题"></a>Python多线程的问题</h2><p>由于<code>Python</code>中<code>GIL</code>的限制，导致不论是在单核还是多核条件下，在同一时刻只能运行一个线程，导致<code>Python</code>多线程无法发挥多核并行的优势。</p><p><code>GIL</code>全称为<code>GlobalInterpreter Lock</code>，中文翻译为全局解释器锁，其最初设计是出于数据安全而考虑的。</p><p>在<code>Python</code>多线程下，每个线程的执行方式如下：</p><ul><li>获取<code>GIL</code>执行对应线程的代码</li><li>释放<code>GIL</code>可见，某个线程想要执行，必须先拿到 GIL，我们可以把 GIL看作是通行证，并且在一个 Python进程中，GIL只有一个。拿不到通行证的线程，就不允许执行。这样就会导致，即使是多核条件下，一个 Python 进程下的多个线程，同一时刻也只能执行一个线程。 不过对于爬虫这种 IO 密集型任务来说，这个问题影响并不大。而对于计算密集型任务来说，由于 GIL的存在，多线程总体的运行效率相比可能反而比单线程更低</li></ul>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>多线程</tag>
      
      <tag>threading</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django入门-视图函数</title>
    <link href="/2021/06/11/Django%E5%85%A5%E9%97%A8-%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0/"/>
    <url>/2021/06/11/Django%E5%85%A5%E9%97%A8-%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="第一个视图函数"><a href="#第一个视图函数" class="headerlink" title="第一个视图函数"></a>第一个视图函数</h2><p>第一个视图函数目前我们已经有一个视图函数叫 <code>home</code> ，这个视图在我们的应用程序主页上显示为<code>&quot;Hello， World!&quot;</code> 。</p><p><strong>boards/views.py</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> HttpResponse<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home</span>(<span class="hljs-params">request</span>):</span><br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;hello World&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>首先要做的是导入Board模型并列出所有的板块。</p><p><strong>boards/views.py</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> HttpResponse<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Board<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home</span>(<span class="hljs-params">request</span>):</span><br>    boards = Board.objects.<span class="hljs-built_in">all</span>()<br>    boards_names = <span class="hljs-built_in">list</span>()<br><br>    <span class="hljs-keyword">for</span> board <span class="hljs-keyword">in</span> boards:<br>        boards_names.append(board.name)<br>    <br>    response_html = <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>.join(boards_names)<br>    <span class="hljs-keyword">return</span> HttpResponse(response_html)<br></code></pre></div></td></tr></table></figure><p>访问<a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a>如下：</p><p><img src="Screenshot_1.webp"></p><p>当然，真正的项目里面不会这样去渲染HTML，渲染的部分会交给<code>Django模板引擎</code>来实现。</p><h2 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h2><p>在<code>manage.py</code>所在的目录创建一个名为<code>templates</code>的新文件夹：</p><p>在<code>templates</code>文件夹中，创建一个名为<code>home.html</code>的<code>HTML</code>文件。</p><p><strong>templates/home.html</strong></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Boards<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Boards<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br>        &#123;% for board in boards %&#125;<br>            &#123;&#123;board.name&#125;&#125; <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        &#123;% endfor %&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>上面的例子中，混入了原始的<code>HTML</code>和一些特殊的标签<code>&#123;% for ... in ... %&#125;</code>和<code>&#123;&#123;variable&#125;&#125;</code>。它们是Django模板语法的一部分。上面的列子展示了如何使用<code>for</code>遍历列表对象。<code>&#123;&#123;board.name&#125;&#125;</code>会在HTMl模板中会被渲染成板块的名称，最后生成动态HTML文档。</p><p>在我们可以使用这个HTML页面之前，我们必须告诉Django在哪里可以找到我们应用程序的模板。</p><p>打开<code>myproject目录</code>下面的<code>settings.py</code>文件，搜索 <code>TEMPLATES</code> 变量，并设置 <code>DIRS</code> 的值为 <code>os.path.join（BASE_DIR，&#39;templates&#39;）</code>∶</p><p>本质上，刚添加的这一行所做的事情就是找到项目的完整路径并在后面附加<code>&quot;templates&quot;</code>。</p><p>我们可以使用<code>Python shell</code>进行调试∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">TEMPLATES = [<br>    &#123;<br>        <span class="hljs-string">&#x27;BACKEND&#x27;</span>: <span class="hljs-string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,<br>        <span class="hljs-string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class="hljs-string">&#x27;templates&#x27;</span>)],<br>        <span class="hljs-string">&#x27;APP_DIRS&#x27;</span>: <span class="hljs-literal">True</span>,<br>        <span class="hljs-string">&#x27;OPTIONS&#x27;</span>: &#123;<br>            <span class="hljs-string">&#x27;context_processors&#x27;</span>: [<br>                <span class="hljs-string">&#x27;django.template.context_processors.debug&#x27;</span>,<br>                <span class="hljs-string">&#x27;django.template.context_processors.request&#x27;</span>,<br>                <span class="hljs-string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,<br>                <span class="hljs-string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,<br>            ],<br>        &#125;,<br>    &#125;,<br>]<br></code></pre></div></td></tr></table></figure><p>打开<code>python shell</code>进行调试。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">python manage.py shell<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> django.conf <span class="hljs-keyword">import</span> settings<br><span class="hljs-meta">&gt;&gt;&gt; </span>settings.BASE_DIR <br>WindowsPath(<span class="hljs-string">&#x27;C:/Users/espho/PycharmProjects/PythonProjs/django/myproject/myproject&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> os<br><span class="hljs-meta">&gt;&gt;&gt; </span>os.path.join(settings.BASE_DIR, <span class="hljs-string">&#x27;templates&#x27;</span>) <br><span class="hljs-string">&#x27;C:\\Users\\espho\\PycharmProjects\\PythonProjs\\django\\myproject\\myproject\\templates&#x27;</span><br></code></pre></div></td></tr></table></figure><p>可以看到，它只是指向了我们在前面步骤中创建的<code>templates</code>文件夹。</p><p>现在我们可以更新视图：</p><p><strong>boards/views.py</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Board<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home</span>(<span class="hljs-params">request</span>):</span><br>    boards = Board.objects.<span class="hljs-built_in">all</span>()<br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;home.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;boards&#x27;</span>: boards&#125;)<br></code></pre></div></td></tr></table></figure><p>重新运行，访问<a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a>。</p><p><img src="Screenshot_2.webp"></p><p>可以修改HTML文件，使其更加美观。</p><p><strong>templates/home.html</strong></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Boards<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Boards<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Board<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Posts<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Topics<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Last Post<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span><br>                &#123;% for board in boards %&#125;<br>                    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br>                            &#123;&#123;board.name&#125;&#125; <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #888;&quot;</span>&gt;</span>&#123;&#123;board.description&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>            &#123;% endfor %&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>不用重启，刷新页面：</p><p><img src="Screenshot_3.webp"></p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>抓取网易云音乐热评</title>
    <link href="/2021/06/10/%E6%8A%93%E5%8F%96%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90%E7%83%AD%E8%AF%84/"/>
    <url>/2021/06/10/%E6%8A%93%E5%8F%96%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90%E7%83%AD%E8%AF%84/</url>
    
    <content type="html"><![CDATA[<p>查看页面源代码，发现源代码中并不含有热评。通过工具抓包查看请求，数据是通过后端数据库请求过来的。</p><p><img src="Screenshot_1.webp"></p><p>查看标头可以发现，这条获取热评的请求传递的参数是加密的。</p><p><img src="Screenshot_2.webp"></p><p>首先，我们要找到未加密的参数。</p><p>通过查看请求程序，可以看到当前网页调用了那些JS脚本执行过程，从下往上调用。</p><p><img src="Screenshot_3.webp"></p><p>查看最上面的JS脚本，这是产生请求的最后一个脚本，看看这个脚本里面有什么。</p><p><img src="Screenshot_4.webp"></p><p>点开后，咋一看没法理解，这是经过压缩后的JS脚本，没关系，点击左下方的<code>&#123;&#125;</code>优质打印，就是格式化该脚本。</p><p><img src="Screenshot_5.webp"></p><p>通过查看JS脚本，发现最后的请求就是通过<code>send</code>函数发送出去的，在这里设置断点。</p><p><img src="Screenshot_6.webp"></p><p>重新刷新页面，可以看到所有的变量，找到<code>request</code>中的<code>url</code>为<code>/weapi/cdns?csrf_token=</code>，不是我们想要的地址，继续刷新，</p><p><img src="Screenshot_7.webp"></p><p>直到出现<code>https://music.163.com/weapi/comment/resource/comments/get?csrf_token=</code>，这就是我们想要的<code>url</code>。</p><p><img src="Screenshot_8.webp"></p><p>从上图中可以看到，<code>params</code>参数是经过加密的，接着往上分析。</p><p><img src="Screenshot_9.webp"></p><p>查看这里，<code>d7e</code>参数，查看这里的<code>params</code>依旧是加密的。接着往回找，是谁调用的<code>b7g.bsO0x</code>函数。</p><p><img src="Screenshot_10.webp"></p><p>这里可以看到<code>params</code>参数依旧是加密的。</p><p><img src="Screenshot_11.webp"></p><p>找到这里就可以看到<code>params</code>参数没有加密，说明加密过程就在<code> t7m.be7X</code>函数中完成。</p><p><img src="Screenshot_12.webp"></p><p>在这一步中<code>i7b</code>就是未加密的信息，通过这段JS代码后，变成了加密的<code>e7d</code>。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">i7b:<br>  csrf_token: <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">cursor</span>: <span class="hljs-string">&quot;-1&quot;</span><br>  <span class="hljs-attr">offset</span>: <span class="hljs-string">&quot;0&quot;</span><br>  <span class="hljs-attr">orderType</span>: <span class="hljs-string">&quot;1&quot;</span><br>  <span class="hljs-attr">pageNo</span>: <span class="hljs-string">&quot;1&quot;</span><br>  <span class="hljs-attr">pageSize</span>: <span class="hljs-string">&quot;20&quot;</span><br>  <span class="hljs-attr">rid</span>: <span class="hljs-string">&quot;R_SO_4_1465401422&quot;</span><br>  <span class="hljs-attr">threadId</span>: <span class="hljs-string">&quot;R_SO_4_1465401422&quot;</span><br></code></pre></div></td></tr></table></figure><p>那么，接下来就需要对这段JS代码进行分析，找到加密的逻辑，然后我们自己来写一个相同的逻辑模拟这个请求。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> cJt0x = t7m.be7X; <br>t7m.be7X = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">X7Q, e7d</span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> i7b = &#123;&#125;<br>      , e7d = NEJ.X(&#123;&#125;, e7d)<br>      , mi1x = X7Q.indexOf(<span class="hljs-string">&quot;?&quot;</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.GEnc &amp;&amp; <span class="hljs-regexp">/(^|\.com)\/api/</span>.test(X7Q) &amp;&amp; !(e7d.headers &amp;&amp; e7d.headers[ew8o.BH9y] == ew8o.Jf1x) &amp;&amp; !e7d.noEnc) &#123;<br>        <span class="hljs-keyword">if</span> (mi1x != -<span class="hljs-number">1</span>) &#123;<br>            i7b = j7c.gQ9H(X7Q.substring(mi1x + <span class="hljs-number">1</span>));<br>            X7Q = X7Q.substring(<span class="hljs-number">0</span>, mi1x)<br>        &#125;<br>        <span class="hljs-keyword">if</span> (e7d.query) &#123;<br>            i7b = NEJ.X(i7b, j7c.fO9F(e7d.query) ? j7c.gQ9H(e7d.query) : e7d.query)<br>        &#125;<br>        <span class="hljs-keyword">if</span> (e7d.data) &#123;<br>            i7b = NEJ.X(i7b, j7c.fO9F(e7d.data) ? j7c.gQ9H(e7d.data) : e7d.data)<br>        &#125;<br>        i7b[<span class="hljs-string">&quot;csrf_token&quot;</span>] = t7m.gP9G(<span class="hljs-string">&quot;__csrf&quot;</span>);<br>        X7Q = X7Q.replace(<span class="hljs-string">&quot;api&quot;</span>, <span class="hljs-string">&quot;weapi&quot;</span>);<br>        e7d.method = <span class="hljs-string">&quot;post&quot;</span>;<br>        <span class="hljs-keyword">delete</span> e7d.query;<br>        <span class="hljs-keyword">var</span> bZo6i = <span class="hljs-built_in">window</span>.asrsea(<span class="hljs-built_in">JSON</span>.stringify(i7b), bmn9e([<span class="hljs-string">&quot;流泪&quot;</span>, <span class="hljs-string">&quot;强&quot;</span>]), bmn9e(WI6C.md), bmn9e([<span class="hljs-string">&quot;爱心&quot;</span>, <span class="hljs-string">&quot;女孩&quot;</span>, <span class="hljs-string">&quot;惊恐&quot;</span>, <span class="hljs-string">&quot;大笑&quot;</span>])); # bZo6i这个变量就是加密后的params和encSecKey。是经过<span class="hljs-built_in">window</span>.asrsea函数后加密的<br>        e7d.data = j7c.cr7k(&#123;<br>            <span class="hljs-attr">params</span>: bZo6i.encText,  # 这就是请求的params参数<br>            <span class="hljs-attr">encSecKey</span>: bZo6i.encSecKey  # 这就是请求的encSecKey参数<br>        &#125;)<br>    &#125;<br>    <span class="hljs-keyword">var</span> cdnHost = <span class="hljs-string">&quot;y.music.163.com&quot;</span>;<br>    <span class="hljs-keyword">var</span> apiHost = <span class="hljs-string">&quot;interface.music.163.com&quot;</span>;<br>    <span class="hljs-keyword">if</span> (location.host === cdnHost) &#123;<br>        X7Q = X7Q.replace(cdnHost, apiHost);<br>        <span class="hljs-keyword">if</span> (X7Q.match(<span class="hljs-regexp">/^\/(we)?api/</span>)) &#123;<br>            X7Q = <span class="hljs-string">&quot;//&quot;</span> + apiHost + X7Q<br>        &#125;<br>        e7d.cookie = <span class="hljs-literal">true</span><br>    &#125;<br>    cJt0x(X7Q, e7d)<br></code></pre></div></td></tr></table></figure><p>加密的函数就是<code>window.asrsea</code>，这个函数一共传入了四个参数，把他们找出来一个个分析。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.asrsea(<span class="hljs-built_in">JSON</span>.stringify(i7b), bmn9e([<span class="hljs-string">&quot;流泪&quot;</span>, <span class="hljs-string">&quot;强&quot;</span>]), bmn9e(WI6C.md), bmn9e([<span class="hljs-string">&quot;爱心&quot;</span>, <span class="hljs-string">&quot;女孩&quot;</span>, <span class="hljs-string">&quot;惊恐&quot;</span>, <span class="hljs-string">&quot;大笑&quot;</span>])<br></code></pre></div></td></tr></table></figure><p>通过上下文搜索，找到<code>window.asrsea = d</code>，来看这个<code>d</code>函数做i了那些加密工作。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">a</span>(<span class="hljs-params">a</span>) </span>&#123; # a= <span class="hljs-number">16</span><br>    <span class="hljs-keyword">var</span> d, e, b = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>, c = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">for</span> (d = <span class="hljs-number">0</span>; a &gt; d; d += <span class="hljs-number">1</span>) # 循环<span class="hljs-number">16</span>次<br>        e = <span class="hljs-built_in">Math</span>.random() * b.length, # 产生的随机数<br>        e = <span class="hljs-built_in">Math</span>.floor(e), # 取整<br>        c += b.charAt(e); # 取字符串中的xxx位<br>    <span class="hljs-keyword">return</span> c #　返回<span class="hljs-number">16</span>位随机的字符串<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">b</span>(<span class="hljs-params">a, b</span>) </span>&#123; # a是要加密的内容<br>    <span class="hljs-keyword">var</span> c = CryptoJS.enc.Utf8.parse(b) # b就是密钥<br>      , d = CryptoJS.enc.Utf8.parse(<span class="hljs-string">&quot;0102030405060708&quot;</span>)<br>      , e = CryptoJS.enc.Utf8.parse(a) # e是a传入的数据<br>      , f = CryptoJS.AES.encrypt(e, c, &#123; # c是加密的密钥<br>        <span class="hljs-attr">iv</span>: d, # 偏移量<br>        <span class="hljs-attr">mode</span>: CryptoJS.mode.CBC # CBC加密模式<br>    &#125;);<br>    <span class="hljs-keyword">return</span> f.toString()<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">c</span>(<span class="hljs-params">a, b, c</span>) </span>&#123; # c里面没有随机函数<br>    <span class="hljs-keyword">var</span> d, e;<br>    <span class="hljs-keyword">return</span> setMaxDigits(<span class="hljs-number">131</span>),<br>    d = <span class="hljs-keyword">new</span> RSAKeyPair(b,<span class="hljs-string">&quot;&quot;</span>,c),<br>    e = encryptedString(d, a)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">d</span>(<span class="hljs-params">d, e, f, g</span>) </span>&#123;  <br>    <span class="hljs-keyword">var</span> h = &#123;&#125;  # 定义h空对象<br>      , i = a(<span class="hljs-number">16</span>); # i就是<span class="hljs-number">16</span>位的随机值 把i设置成定值 <br>    <span class="hljs-keyword">return</span> h.encText = b(d, g), #  g是密钥<br>    h.encText = b(h.encText, i), # 返回的就是params, i是密钥<br>    h.encSecKey = c(i, e, f), # 得到的就是encSecKey, e和f是固定的值, i固定后，encSecKey一定是固定的<br>    h<br><br>    # 两次加密<br>    # 数据+<span class="hljs-function"><span class="hljs-params">g</span> =&gt;</span> 第一次加密结果 + <span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> params<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">e</span>(<span class="hljs-params">a, b, d, e</span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> f = &#123;&#125;;<br>    <span class="hljs-keyword">return</span> f.encText = c(a + e, b, d),<br>    f<br>&#125;<br><span class="hljs-built_in">window</span>.asrsea = d,<br><span class="hljs-built_in">window</span>.ecnonasr = e<br></code></pre></div></td></tr></table></figure><ul><li>第一个参数<code>JSON.stringify(i7b)</code>：这里的<code>i7b</code>就是未经加密的数据。</li><li>第二个的参数<code>bmn9e([&quot;流泪&quot;, &quot;强&quot;])</code>：执行了<code>bmn9e</code>函数，把这个复制到console中执行，可以发现是个固定值始终为<code>&quot;010001&quot;</code>。</li><li>第三个参数<code>bmn9e(WI6C.md)</code>：在控制台执行，可以发现也是固定值<code>&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&quot;</code></li><li>第三个参数<code>bmn9e([&quot;爱心&quot;, &quot;女孩&quot;, &quot;惊恐&quot;, &quot;大笑&quot;]</code>：可以发现也是固定值<code>&quot;0CoJUm6Qyw8W8jud&quot;</code>。</li></ul><p>那么这里<code>function d(d, e, f, g)</code>中的<code>d</code>、<code>e</code>、<code>f</code>、<code>g</code>就分别找到了。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 没有经过加密的真实参数</span><br>data = &#123;<br>  <span class="hljs-string">&quot;csrf_token&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-string">&quot;cursor&quot;</span>: <span class="hljs-string">&quot;-1&quot;</span>,<br>  <span class="hljs-string">&quot;offset&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,<br>  <span class="hljs-string">&quot;orderType&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,<br>  <span class="hljs-string">&quot;pageNo&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,<br>  <span class="hljs-string">&quot;pageSize&quot;</span>: <span class="hljs-string">&quot;20&quot;</span>,<br>  <span class="hljs-string">&quot;rid&quot;</span>: <span class="hljs-string">&quot;R_SO_4_1465401422&quot;</span>,<br>  <span class="hljs-string">&quot;threadId&quot;</span>: <span class="hljs-string">&quot;R_SO_4_1465401422&quot;</span><br>&#125;<br><br><span class="hljs-comment"># 处理加密过程</span><br>d = data<br>e = <span class="hljs-string">&quot;010001&quot;</span><br>f = <span class="hljs-string">&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&quot;</span><br>g = <span class="hljs-string">&quot;0CoJUm6Qyw8W8jud&quot;</span><br><br></code></pre></div></td></tr></table></figure><p>然后，把参数按照网易的规则进行加密处理，得到两个参数<code>params</code>和<code>encSecKry</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><br></code></pre></div></td></tr></table></figure><p>最后，请求到网易，拿到评论信息。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode<br><span class="hljs-comment"># 请求的url</span><br><br>url = <span class="hljs-string">&#x27;https://music.163.com/weapi/comment/resource/comments/get?csrf_token=&#x27;</span><br><br><span class="hljs-comment"># 请求方式post</span><br><br><span class="hljs-comment"># 没有经过加密的真实参数</span><br>data = &#123;<br>    <span class="hljs-string">&quot;csrf_token&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;cursor&quot;</span>: <span class="hljs-string">&quot;-1&quot;</span>,<br>    <span class="hljs-string">&quot;offset&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,<br>    <span class="hljs-string">&quot;orderType&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,<br>    <span class="hljs-string">&quot;pageNo&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,<br>    <span class="hljs-string">&quot;pageSize&quot;</span>: <span class="hljs-string">&quot;20&quot;</span>,<br>    <span class="hljs-string">&quot;rid&quot;</span>: <span class="hljs-string">&quot;R_SO_4_1465401422&quot;</span>,<br>    <span class="hljs-string">&quot;threadId&quot;</span>: <span class="hljs-string">&quot;R_SO_4_1465401422&quot;</span>,<br>&#125;<br><br><span class="hljs-comment"># 处理加密过程</span><br><br>d = data<br>e = <span class="hljs-string">&quot;010001&quot;</span><br>f = <span class="hljs-string">&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&quot;</span><br>g = <span class="hljs-string">&quot;0CoJUm6Qyw8W8jud&quot;</span><br>i = <span class="hljs-string">&quot;8vUt6QwGJDa5do4h&quot;</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_encSecKey</span>():</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;b5fd7a3aa4b1bbab923026c03b1ebfb46ec108dbf90d7b968ff3953d58b0b7ac87a331043a9676a359051a5002a3a65c0bdf0c2b5f1519ddf153c26daeb5fdf0f43d25ca56d75c874fa98eebfec7d858f327f342f06aa03bb1f3250d4d8f7c3ab0ff2f7dd168ff9ea1327df172943a819d6fd0986699118de2ba25c535d22e4d&quot;</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_params</span>(<span class="hljs-params">data</span>):</span><br>    first = enc_params(data, g)<br>    second = enc_params(first, i)<br>    <span class="hljs-keyword">return</span> second<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_16</span>(<span class="hljs-params">data</span>):</span><br>    pad = <span class="hljs-number">16</span> - <span class="hljs-built_in">len</span>(data) % <span class="hljs-number">16</span><br>    data += <span class="hljs-built_in">chr</span>(pad) * pad<br>    <span class="hljs-keyword">return</span> data<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">enc_params</span>(<span class="hljs-params">data, key</span>):</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;加密过程&#x27;&#x27;&#x27;</span><br>    data = to_16(data)<br>    iv = <span class="hljs-string">&quot;0102030405060708&quot;</span><br>    aes = AES.new(key=key.encode(<span class="hljs-string">&quot;utf-8&quot;</span>), IV=iv.encode(<span class="hljs-string">&quot;utf-8&quot;</span>),<br>                  mode=AES.MODE_CBC)  <span class="hljs-comment"># 新建一个加密对象</span><br>    bs = aes.encrypt(data.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))  <span class="hljs-comment"># 加密内容的长度必须是16的倍数</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(b64encode(bs), <span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    resp = requests.post(url=url, data=&#123;<br>        <span class="hljs-string">&quot;params&quot;</span>: get_params(json.dumps(data)),<br>        <span class="hljs-string">&quot;encSecKey&quot;</span>: get_encSecKey()<br>    &#125;)<br>    <span class="hljs-built_in">print</span>(resp.text)<br></code></pre></div></td></tr></table></figure><p>兄弟们，我拿到了，有些细节还不清楚，以后再深究。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django入门-模型设计</title>
    <link href="/2021/06/09/Django%E5%85%A5%E9%97%A8-%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1/"/>
    <url>/2021/06/09/Django%E5%85%A5%E9%97%A8-%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><p>这些模型基本上代表了应用程序的数据库设计。在本节中要做的是创建 <code>Django</code> 所表示的类，这些类就是在上一节中建模的类∶ <code>Board</code>，<code>Topic</code>和 <code>Post</code>。<code>User</code> 模型被命名为内置应用叫 <code>auth</code>，它以命名空间 <code>django.contrib.auth</code> 的形式出现在 <code>INSTALLED_APPS</code>配置中。</p><p>我们要做的工作都在 <code>boards/models.py 文</code>件中。以下是我们在<code>Django应用程序</code>中如何表示类图的代码∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models<br><span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User<br><br><span class="hljs-comment"># Create your models here.</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Board</span>(<span class="hljs-params">models.Model</span>):</span><br>    name = models.CharField(max_length=<span class="hljs-number">30</span>, unique=<span class="hljs-literal">True</span>)<br>    description = models.CharField(max_length=<span class="hljs-number">100</span>)<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Topic</span>(<span class="hljs-params">models.Model</span>):</span><br>    subject = models.CharField(max_length=<span class="hljs-number">255</span>)<br>    last_updated = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>)<br>    board = models.ForeignKey(Board, related_name=<span class="hljs-string">&#x27;topics&#x27;</span>, on_delete=models.CASCADE)<br>    starter = models.ForeignKey(User, related_name=<span class="hljs-string">&#x27;topics&#x27;</span>, on_delete=models.CASCADE)<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span>(<span class="hljs-params">models.Model</span>):</span><br>    message = models.TextField(max_length=<span class="hljs-number">4000</span>)<br>    topic = models.ForeignKey(Topic, related_name=<span class="hljs-string">&#x27;posts&#x27;</span>, on_delete=models.CASCADE)<br>    created_at = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>)<br>    updated_at = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>)<br>    create_by = models.ForeignKey(User, related_name=<span class="hljs-string">&#x27;posts&#x27;</span>, on_delete=models.CASCADE)<br>    updated_by = models.ForeignKey(User, null=<span class="hljs-literal">True</span>, related_name=<span class="hljs-string">&#x27;+&#x27;</span>, on_delete=models.CASCADE)<br></code></pre></div></td></tr></table></figure><p>所有模型都是<code>django.db.models.Model</code>类的子类。每个类将被转换为<strong>数据库表</strong>。每个字段由 <code>django.db.models.Field</code>子类（内置在<code>Django core</code>）的实例表示，它们并将被转换为数据库的列。</p><p><code>字段 CharField</code>，<code>DateTimeField</code>等等，都是 <code>django.db.models.Field</code> 的子类，包含在<code>Django</code>的核心里面-随时可以使用。</p><p>在这里，我们仅使用 <code>CharField``，TextField</code> ，<code>DateTimeField</code>，和<code>ForeignKey</code>字段来定义我们的模型。不过在<code>Django</code>提供了更广泛的选择来代表不同类型的数据，例如 <code>IntegerField</code>，<code>BooleanField</code>， <code>DecimalField</code>和其它一些字段。</p><p>我们会在需要的时候提及它们。</p><p>有些字段需要参数，例如<code>CharField</code>。我们应该始终设定一个<code>max_length</code> 。这些信息将用于创建数据库列。<code>Django</code>需要知道数据库列需要多大。该 <code>max_length</code> 参数也将被<code>Django Forms API</code>用来验证用户输入。</p><p>在 <code>Board</code> 模型定义中，更具体地说，在 <code>name</code> 字段中，我们设置了参数 <code>unique=True</code> ，顾名思义，它将强制数据库级别字段的唯一性。</p><p>在 <code>Post</code> 模型中， <code>created_at</code> 字段有一个可选参数， <code>auto_now_add</code> 设置为 <code>True</code> 。这将告诉Django创建 <code>Post</code> 对象时为当前日期和时间。</p><p>模型之间的关系使用 <code>Foreignkey</code> 字段。它将在模型之间创建一个连接，并在数据库级别创建适当的关系 （注∶ 外键关联）。该 <code>Foreignkey</code> 字段需要一个位置参数 <code>related_name</code> ，用于引用它关联的模型。（注∶ 例如 <code>created_by</code> 是外键字段，关联的<code>User</code>模型，表明这个帖子是谁创建的， <code>related name=posts</code> 表示在 <code>User</code> 那边可以使用 <code>user.posts</code> 来查看这个用户创建了哪些帖子）</p><p>例如，在 <code>Topic</code> 模型中， <code>board</code> 字段是 <code>Board</code> 模型的 <code>ForeignKey</code> 。它告诉<code>Django</code>，一个 <code>Topic</code> 实例只涉及一个<code>Board</code>实例。 <code>related_name</code> 参数将用于创建反向关系， <code>Board</code> 实例通过属性 <code>topics</code> 访问属于这个版块下的 <code>Topic</code> 列表。</p><p><code>Django</code>自动创建这种反向关系， <code>related_name</code> 是可选项。但是，如果我们不为它设置一个名称，<code>Django</code>会自动生成它∶<code>（class_name）_set</code> 。例如，在 <code>Board</code> 模型中，所有 <code>Topic</code> 列表将用 <code>topic_set</code> 属性表示。而这里我们将其重新命名为了 <code>topics</code> ，以使其感觉更自然。</p><p>在 <code>Post</code> 模型中，该 <code>updated_by</code> 字段设置 <code>related_name=&#39;+&#39;</code>。这指示 <code>Django</code>我们不需要这种反向关系，所以它会被忽略（注∶也就是说我们不需要关系用户修改过哪些帖子）。</p><p>下面您可以看到类图和Django模型的源代码之间的比较，绿线表示我们如何处理反向关系。</p><p><img src="Screenshot_1.webp"></p><h2 id="迁移模型"><a href="#迁移模型" class="headerlink" title="迁移模型"></a>迁移模型</h2><p>下一步是告诉<code>Django</code>创建数据库，以便我们可以开始使用它。打开终端，激活虚拟环境，转到<code> manage.py</code>文件所在的文件夹，然后运行以下命令∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">python manage. py makemigrations<br></code></pre></div></td></tr></table></figure><p>你会看到输出的内容是∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Migrations <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;boards&#x27;</span>:<br>  boards\migrations\0001_initial.py<br>    - Create model Board<br>    - Create model Topic<br>    - Create model Post<br></code></pre></div></td></tr></table></figure><p>此时， <code>Django</code> 在 <code>boards/migrations</code> 目录创建了一个名为 <code>0001_initial.py</code> 的文件。它代表了应用程序模型的当前状态。在下一步，<code>Django</code>将使用该文件创建表和列。</p><p>迁移文件将被翻译成SQL语句。如果您熟悉SQL，则可以运行以下命令来检验将是要被数据库执行的SQL指令</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">python manage.py sqlmigrate boards 0001<br></code></pre></div></td></tr></table></figure><p>如果你不熟悉SQL，也不要担心。所有的工作都将使用<code>Django ORM</code>来完成，它是一个与数据库进行通信的抽象层。下一步是将我们生成的迁移文件应用到数据库∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">python manage.py migrate<br></code></pre></div></td></tr></table></figure><p>输出结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Operations to perform:<br>  Apply <span class="hljs-built_in">all</span> migrations: admin, auth, boards, contenttypes, sessions<br>Running migrations:<br>  Applying contenttypes<span class="hljs-number">.0001</span>_initial... OK<br>  Applying auth<span class="hljs-number">.0001</span>_initial... OK<br>  Applying admin<span class="hljs-number">.0001</span>_initial... OK<br>  Applying admin<span class="hljs-number">.0002</span>_logentry_remove_auto_add... OK<br>  Applying admin<span class="hljs-number">.0003</span>_logentry_add_action_flag_choices... OK<br>  Applying contenttypes<span class="hljs-number">.0002</span>_remove_content_type_name... OK<br>  Applying auth<span class="hljs-number">.0002</span>_alter_permission_name_max_length... OK<br>  Applying auth<span class="hljs-number">.0003</span>_alter_user_email_max_length... OK<br>  Applying auth<span class="hljs-number">.0004</span>_alter_user_username_opts... OK<br>  Applying auth<span class="hljs-number">.0005</span>_alter_user_last_login_null... OK<br>  Applying auth<span class="hljs-number">.0006</span>_require_contenttypes_0002... OK<br>  Applying auth<span class="hljs-number">.0007</span>_alter_validators_add_error_messages... OK<br>  Applying auth<span class="hljs-number">.0008</span>_alter_user_username_max_length... OK<br>  Applying auth<span class="hljs-number">.0009</span>_alter_user_last_name_max_length... OK<br>  Applying auth<span class="hljs-number">.0010</span>_alter_group_name_max_length... OK<br>  Applying auth<span class="hljs-number">.0011</span>_update_proxy_permissions... OK<br>  Applying auth<span class="hljs-number">.0012</span>_alter_user_first_name_max_length... OK<br>  Applying boards<span class="hljs-number">.0001</span>_initial... OK<br>  Applying sessions<span class="hljs-number">.0001</span>_initial... OK<br></code></pre></div></td></tr></table></figure><p>好了数据库就迁移成功了。</p><h2 id="试验-Models-API"><a href="#试验-Models-API" class="headerlink" title="试验 Models API"></a>试验 Models API</h2><p>使用Python进行开发的一个重要优点是<code>交互式shell</code>。我一直在使用它。这是一种快速尝试和试验API的方法。</p><p>可以使用<code>manage.py</code>工具加载我们的项目来启动 <code>Python shell</code> ∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">python manage. py shell<br></code></pre></div></td></tr></table></figure><p>这与直接输入 <code>python</code> 指令来调用交互式控制台是非常相似的，除此之外，项目将被添加到 <code>sys.path</code> 并加载Django。这意味着我们可以在项目中导入我们的模型和其他资源并使用它。</p><p>让我们从导入<code>Board类</code>开始∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> boards.models <span class="hljs-keyword">import</span> Board<br></code></pre></div></td></tr></table></figure><p>要创建新的 <code>board</code> 对象，我们可以执行以下操作∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">board = Board(name=<span class="hljs-string">&#x27;Django&#x27;</span>,description=<span class="hljs-string">&#x27;This is a board abo ut Django.&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>为了将这个对象保存在数据库中，我们必须调用<code>save</code>方法∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">board.save()<br></code></pre></div></td></tr></table></figure><p><code>save</code> 方法用于创建和更新对象。这里Django创建了一个新对象，因为这时 <code>Board</code> 实例没有<code>id</code>。第一次保存后，Django会自动设置<code>ID</code>∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>board.<span class="hljs-built_in">id</span><br><span class="hljs-number">1</span><br></code></pre></div></td></tr></table></figure><p>您可以将其余的字段当做Python属性访问∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>board.name<br><span class="hljs-string">&#x27;Django&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>board.description<br><span class="hljs-string">&#x27;This is a board about django&#x27;</span><br></code></pre></div></td></tr></table></figure><p>要更新一个值，我们可以这样做∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">board.description =<span class="hljs-string">&#x27;Django discussion board&#x27;</span><br>board.save()<br><span class="hljs-meta">&gt;&gt;&gt; </span>board.description <br><span class="hljs-string">&#x27;this is new description&#x27;</span><br></code></pre></div></td></tr></table></figure><p>每个Django模型都带有一个特殊的属性；我们称之为<code>模型管理器（Model Manager）</code>。你可以通过属性 <code>objects</code> 来访问这个管理器，它主要用于数据库操作。例如，我们可以使用它来直接创建一个新的<code>Board</code>对象∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>board = Board.objects.create(name=<span class="hljs-string">&#x27;Python&#x27;</span>, description=<span class="hljs-string">&#x27;id 2 for django model&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>board.save()<br><span class="hljs-meta">&gt;&gt;&gt; </span>board.<span class="hljs-built_in">id</span><br><span class="hljs-number">2</span><br></code></pre></div></td></tr></table></figure><p>所以，现在我们有两个版块了。我们可以使用 <code>objects</code> 列出数据库中所有现有的版块</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>Board.objects.<span class="hljs-built_in">all</span>()<br>&lt;QuerySet [&lt;Board: Board <span class="hljs-built_in">object</span> (<span class="hljs-number">1</span>)&gt;, &lt;Board: Board <span class="hljs-built_in">object</span> (<span class="hljs-number">2</span>)&gt;]&gt;<br></code></pre></div></td></tr></table></figure><p>结果是一个<code>QuerySet</code>。稍后我们会进一步了解。基本上，它是从数据库中查询的对象列表。我们看到有两个对象，但显示的名称是 <code>Board object</code>。这是因为我们尚未实现 <code>Board</code> 的 <code>__str___</code> 方法。</p><p><code>_str__ </code>方法是对象的字符串表示形式。我们可以使用版块的名称来表示它。</p><p>首先，退出交互式控制台∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">exit()<br></code></pre></div></td></tr></table></figure><p>现在编辑<code>boards app</code>中的 <code>models.py</code> 文件:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Board</span>(<span class="hljs-params">models.Model</span>):</span><br>    name = models.CharField(max_length=<span class="hljs-number">30</span>, unique=<span class="hljs-literal">True</span>)<br>    description = models.CharField(max_length=<span class="hljs-number">100</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.name<br><br></code></pre></div></td></tr></table></figure><p>再进入交互台，查询：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">boards</span>.<span class="hljs-title">models</span>.<span class="hljs-title">Board</span>&#x27;&gt;</span><br><span class="hljs-class">&gt;&gt;&gt; <span class="hljs-title">Board</span>.<span class="hljs-title">objects</span>.<span class="hljs-title">all</span>()</span><br><span class="hljs-class">&lt;<span class="hljs-title">QuerySet</span> [&lt;<span class="hljs-title">Board</span>:</span> Django&gt;, &lt;Board: Python&gt;]&gt;<br></code></pre></div></td></tr></table></figure><p>这样是不是好多了呢。</p><p>我们可以将这个<code>QuerySet</code>看作一个列表。假设我们想遍历它并打印每个版块的描述∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">boards_list = Board.objects.<span class="hljs-built_in">all</span>() <br><span class="hljs-meta">&gt;&gt;&gt; </span>board_list = Board.objects.<span class="hljs-built_in">all</span>()<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> board <span class="hljs-keyword">in</span> board_list:<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(board.description)<br><span class="hljs-meta">... </span><br>this <span class="hljs-keyword">is</span> new description<br><span class="hljs-built_in">id</span> <span class="hljs-number">2</span> <span class="hljs-keyword">for</span> django model<br></code></pre></div></td></tr></table></figure><p>同样，我们可以使用模型的 <code>管理器（Manager）</code>来查询数据库并返回单个对象。为此，我们要使用 <code>get</code> 方法∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>django_board = Board.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;1&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>django_board<br>&lt;Board: Django&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>django_board.name<br><span class="hljs-string">&#x27;Django&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>django_board.description<br><span class="hljs-string">&#x27;this is new description&#x27;</span><br></code></pre></div></td></tr></table></figure><p>但我们必须小心这种操作。如果我们试图查找一个不存在的对象，例如，查找<code>id=3</code>的版块，它会引发一个异常∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>django_board = Board.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;3&#x27;</span>) <br>boards.models.Board.DoesNotExist: Board matching query does <span class="hljs-keyword">not</span> exist.<br></code></pre></div></td></tr></table></figure><p><code>get</code> 方法的参数可以是模型的任何字段，但最好使用可唯一标识对象的字段来查询。否则，查询可能会返回多个对象，这也会导致异常。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Board.objects.get(name=<span class="hljs-string">&#x27;Django&#x27;</span>)<br>&lt;Board: Django&gt;<br></code></pre></div></td></tr></table></figure><p>请注意，查询区分大小写，小写”django”不匹配∶</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Python">Board.objects.get (name=<span class="hljs-string">&#x27;django&#x27;</span>)<br>boards.models.DoesNotExist: Board matching query does <span class="hljs-keyword">not</span> exist.<br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django入门-系统设计</title>
    <link href="/2021/06/09/Django%E5%85%A5%E9%97%A8-%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    <url>/2021/06/09/Django%E5%85%A5%E9%97%A8-%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h2 id="论坛项目"><a href="#论坛项目" class="headerlink" title="论坛项目"></a>论坛项目</h2><p>在进入模型，视图等其它有趣的部分之前，先让我们花点时间，简要地讨论我们将要开发的这个项目。如果你已经有了Web 开发的经验并且觉得它太繁琐了，那么你可以浏览一下图片以了解我们将要构建的内容，然后直接跳转到本教程的模型部分。</p><h3 id="用列图"><a href="#用列图" class="headerlink" title="用列图"></a>用列图</h3><p>我们的项目是一个论坛系统，整个项目的构思是维护几个论坛版块（boards），每个版块像一个分类一样。在指定的版块里面，用户可以通过创建新主题（Topic）开始讨论，其他用户可以参与讨论回复。我们需要找到一种方法来区分普通用户和管理员用户，因为只有管理员可以创建版块。下图概述了主要的用例和每种类型的用户角色∶</p><p><img src="Screenshot_1.webp"></p><p>从用例图中，我们可以开始思考项目所需的实体类有哪些。这些实体就是我们要创建的模型，它与我们的Django应用程序处理的数据非常密切。</p><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p>从用例图中，我们可以开始思考项目所需的实体类有哪些。这些实体就是我们要创建的模型，它与我们的Django应用程序处理的数据非常密切。</p><p>为了能够实现上面描述的用例，我们需要至少实现下面几个模型∶ <code>Board</code>， <code>Topic</code>，<code>Post</code>和<code>User</code>。</p><p><img src="Screenshot_2.webp"></p><ul><li><code>Board</code>∶ 版块</li><li><code>Topic</code>∶主题</li><li><code>Post</code>∶帖子（译注∶ 其实就是主题的回复或评论）</li></ul><p>类与类之间的实线告诉我们，在一个主题<code>（Topic）</code>中，我们需要有一个字段（译注∶其实就是通过外键来关联）来确定它属于哪个版块<code>（Board）</code>。同样，帖子<code>（Post）</code>也需要一个字段来表示它属于哪个主题，这样我们就可以列出在特定主题内创建的帖子。最后，我们需要一个字段来表示主题是谁发起的，帖子是谁发的。用户和版块之间也有联系，谁创建的版块。但是这些信息与应用程序无关。</p><p>现在我们的类图有基本的表现形式，我们还要考虑这些模型将承载哪些信息。这很容易让事情变得复杂，所以试着先把重要的内容列出来，这些内容是我们启动项目需要的信息。后面我们再使用 <code>Django</code> 的迁移<code>（Migrations）</code>功能来改进模型，您将在下一节中详细了解这些内容。但就目前而言，这是模型最基本的内容∶</p><p><img src="Screenshot_3.webp"></p><p>这个类图强调的是模型之间的关系，这些线条和箭头最终会在稍后转换为字段。</p><p>对于 <code>Board</code> 模型，我们将从两个字段开始∶ <code>name</code> 和 <code>description</code>。<code>name</code> 字段必须是唯一的，为了避免有重复的名称。 <code>description</code> 用于说明这个版块是做什么用的。</p><p><code>Topic</code> 模型包括四个字段∶<code>subject</code> 表示主题内容，<code>last update</code> 用来定义话题的排序，<code>starter</code> 用来识别谁发起的话题，<code>board</code> 用于指定它属于哪个版块。</p><p><code>Post</code> 模型有一个 <code>message</code> 字段，用于存储回复的内容，<code>created at</code> 在排序时候用 （最先发表的帖子排最前面），<code>updated at</code> 告诉用户是否更新了内容，同时，还需要有对应的 <code>User</code> <code>模型的引用，Post</code> 由谁创建的和谁更新的。</p><p>最后是 <code>User</code> 模型。在类图中，我只提到了字段 <code>username</code>，<code>password</code>， <code>email</code>， <code>is superuser</code> 标志，因为这几乎是我们现在要使用的所有东西。</p><p>需要注意的是，我们不需要创建 <code>User</code> 模型，因为<code>Django</code>已经在<code>contrib</code>包中内置了<code>User</code>模型，我们将直接拿来用。</p><p>关于类图之间的对应关系（数字 1，0.* 等等），这里教你如何阅读∶</p><p>一个 <code>topic</code> 必须与一个（1）<code>Board</code>（这意味着它不能为空）相关联，但是 <code>Board</code> 下面可能与许多个或者0个 <code>topic</code> 关联 （0.*）。这意味着 <code>Board</code> 下面可能没有主题。（译注∶ 一对多关系）</p><p><img src="Screenshot_4.webp"></p><p>一个 <code>Topic</code> 至少有一个 <code>Post</code>（发起话题时，同时会发布一个帖子），并且它也可能有许多 <code>Post</code>（1.*）。一个<code>Post</code>必须与一个并且只有一个<code>Topic（1）</code>相关联。</p><p><img src="Screenshot_5.webp"></p><p>一个 <code>Topic</code>必须有一个且只有一个<code>User</code>相关联，<code>topic</code>的发起者是（1）。而一个用户可能有很多或者没有 <code>topic</code> （0.*）。</p><p><img src="Screenshot_6.webp"></p><p><code>Post</code> 必须有一个并且只有一个与之关联的用户，用户可以有许多或没有 <code>Post</code>（0.*）。<code>Post</code>和<code>User</code>之间的第二个关联是直接关联（参见该行最后的箭头），就是 <code>Post</code> 可以被用户修改（<code>updated_by</code>），<code>updated_by</code>有可能是空（<code>Post</code> 没有被修改）。</p><p>画这个类图的另一种方法是强调字段而不是模型之间的关系∶</p><p><img src="Screenshot_7.webp"></p><p>上面的表示方式与前面的表示方式是对等的，不过这种方式更接近我们将要使用 <code>Django Models API</code> 设计的内容。在这种表示方式中，我们可以更清楚地看到，在 <code>Post</code> 模型中，关联了 <code>Topic</code>，<code>created_by</code>（创建者）和 <code>updated by</code>（更新者）字段。另一个值得注意的事情是，在 <code>Topic</code> 模型中，有一个名为 <code>posts （</code>） 的操作（一个类方法）。我们将通过反向关系来实现这一目标，<code>Django</code> 将自动在数据库中执行查询以返回特定主题的所有帖子列表。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>spider的用法</title>
    <link href="/2021/06/08/spider%E7%9A%84%E7%94%A8%E6%B3%95/"/>
    <url>/2021/06/08/spider%E7%9A%84%E7%94%A8%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="Spider-的用法"><a href="#Spider-的用法" class="headerlink" title="Spider 的用法"></a>Spider 的用法</h2><p>在 <code>Scrapy</code> 中，要抓取网站的链接配置、抓取逻辑、解析逻辑等其实都是在 <code>Spider</code> 中配置的。</p><h3 id="Spider运行流程"><a href="#Spider运行流程" class="headerlink" title="Spider运行流程"></a>Spider运行流程</h3><p>在实现 <code>Scrapy</code> 爬虫项目时，最核心的类便是 <code>Spider</code> 类了，它定义了如何爬取某个网站的流程和解析方式。简单来讲， <code>Spider</code> 要做的事就是如下两件： </p><ul><li>定义爬取网站的动作； </li><li>分析爬取下来的网页。 </li></ul><p>对于 <code>Spider</code> 类来说，整个爬取循环如下所述。 </p><ul><li>以初始的 <code>URL</code> 初始化 <code>Request</code> ，并设置回调函数。 当</li><li>该 <code>Request</code> 成功请求并返回时，将生成 <code>Response</code> ，并作为参数传给该回调函数。 </li><li>在回调函数内分析返回的网页内容。返回结果可以有两种形式，一种是解析到的有效结果返回字典或 <code>Item</code> 对象。下一步可经过处理后（或直接）保存，另一种是解析到的下一个（如下一页）链接，可以 利用此链接构造 <code>Request</code> 并设置新的回调函数，返回 <code>Request</code> 。 </li><li>如果返回的是字典或 <code>Item</code> 对象，可通过 <code>Feed Exports</code> 等形式存入文件，如果设置了 <code>Pipeline</code> 的话，可以经由 <code>Pipeline</code> 处理（如过滤、修正等）并保存。 </li><li>如果返回的是 <code>Reqeust</code> ，那么 <code>Request</code> 执行成功得到 <code>Response</code> 之后会再次传递给 <code>Request</code> 中定义的回调函数，可以再次使用选择器来分析新得到的网页内容，并根据分析的数据生成 <code>Item</code> 。 通过以上几步循环往复进行，便完成了站点的爬取。</li></ul><h3 id="Spider类分析"><a href="#Spider类分析" class="headerlink" title="Spider类分析"></a>Spider类分析</h3><p><code>Spider</code> 继承自 <code>scrapy.spiders.Spider</code> ，这个类是最简单最基本的 <code>Spider</code> 类，每个其他的 <code>Spider</code> 必须继承自这个类，还有后面要说明的一些特殊 <code>Spider</code> 类也都是继承自它。 这个类里提供了 <code>start_requests</code> 方法的默认实现，读取并请求 <code>start_urls</code> 属性，并根据返回的结果调用 <code>parse</code> 方法解析结果。另外它还有一些基础属性，下面对其进行讲解。</p><ul><li><code>name</code> ：爬虫名称，是定义 <code>Spider</code> 名字的字符串。Spider 的名字定义了 Scrapy如何定位并初始化 Spider，所以其必须是唯一的。 不过我们可以生成多个相同的 Spider 实例，这没有任何限制。 name 是 Spider 最重要的属性，而且是必需的。如果该 Spider 爬取单个网站，一个常见的做法是以该网站的域名名称来命名 Spider。例如，如果 Spider 爬取 mywebsite.com，该 Spider 通常会被命名为 mywebsite。 </li><li>allowed_domains：允许爬取的域名，是可选配置，不在此范围的链接不会被跟进爬取。 </li><li><code>start_urls</code> ：起始 <code>URL</code> 列表，当我们没有实现 <code>start_requests</code> 方法时，默认会从这个列表开始抓取。 </li><li><code>custom_settings</code> ：这是一个字典，是专属于本 <code>Spider</code> 的配置，此设置会覆盖项目全局的设置，而且此设置必须在初始化前被更新，所以它必须定义成类变量。 </li><li><code>crawler</code> ：此属性是由 <code>from_crawler</code> 方法设置的，代表的是本 <code>Spider</code> 类对应的 <code>Crawler</code> 对象， <code>Crawler</code> 对象中包含了很多项目组件，利用它我们可以获取项目的一些配置信息，如最常见的就是获取项目的设置信息，即 <code>Settings</code> 。 </li><li><code>settings</code> ：是一个 <code>Settings</code> 对象，利用它我们可以直接获取项目的全局设置变量。 </li></ul><p>除了一些基础属性， <code>Spider</code> 还有一些常用的方法，在此介绍如下。 </p><ul><li><code>start_requests</code> ：此方法用于生成初始请求，它必须返回一个可迭代对象，此方法会默认使用 <code>start_urls</code> 里面的 <code>URL</code> 来构造 <code>Request</code> ，而且 <code>Request</code> 是 <code>GET</code> 请求方式。如果我们想在启动时以 <code>POST</code> 方式访问某个 站点，可以直接重写这个方法，发送 <code>POST</code> 请求时我们使用 <code>FormRequest</code> 即可。 </li><li><code>parse</code> ：当 <code>Response</code> 没有指定回调函数时，该方法会默认被调用，它负责处理 <code>Response</code> ，处理返回结果，并从中提取出想要的数据和下一步的请求，然后返回。该方法需要返回一个包含 <code>Request</code> 或 <code>Item</code> 的可迭代对象。 </li><li><code>closed</code> ：当 <code>Spider</code> 关闭时，该方法会被调用，在这里一般会定义释放资源的一些操作或其他收尾操作。</li></ul><h2 id="Selector-的用法"><a href="#Selector-的用法" class="headerlink" title="Selector 的用法"></a>Selector 的用法</h2><p><code>Scrapy</code> 还提供了自己的数据提取方法，即 <code>Selector（选择器）</code> 。 <code>Selector</code> 是基于 <code>lxml</code> 构建的，支持 <code>XPath选择器</code> 、 <code>CSS选择器</code> ，以及 <code>正则表达式</code> ，功能全面，解析速度和准确度非常高。</p><h3 id="直接使用"><a href="#直接使用" class="headerlink" title="直接使用"></a>直接使用</h3><p><code>Selector</code> 是一个可以独立使用的模块。我们可以直接利用 <code>Selector</code> 这个类来构建一个选择器对象，然后调用它的相关方法如 <code>xpath、css</code> 等来提取数据。 </p><p>例如，针对一段 HTML代码，我们可以用如下方式构建 <code>Selector</code> 对象来提取数据： </p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> scrapy <span class="hljs-keyword">import</span> Selector<br><br>body = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;html&gt;</span><br><span class="hljs-string">    &lt;head&gt;</span><br><span class="hljs-string">        &lt;title&gt;Hello World&lt;/title&gt;</span><br><span class="hljs-string">    &lt;/head&gt;</span><br><span class="hljs-string">    &lt;body&gt;</span><br><span class="hljs-string">    &lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>selectot = Selector(text=body)<br>title = selectot.xpath(<span class="hljs-string">&quot;//title/text()&quot;</span>).extract_first()<br><span class="hljs-built_in">print</span>(title)<br><br><span class="hljs-comment">#Hello World </span><br></code></pre></div></td></tr></table></figure><p>这里我们没有在 <code>Scrapy</code> 框架中运行，而是把 <code>Scrapy</code> 中的 <code>Selector</code> 单独拿出来使用了，构建的时候传入 <code>text</code> 参数，就生成了一个 <code>Selector</code> 选择器对象，然后就可以像前面我们所用的 <code>Scrapy</code> 中的解析方式一样，调用 <code>xpath、css</code> 等方法来提取了。 在这里我们查找的是源代码中的 <code>title</code> 中的文本，在 <code>XPath选择器</code> 最后加 <code>text</code> 方法就可以实现文本的提取了。</p><h3 id="Scrapy-Shell"><a href="#Scrapy-Shell" class="headerlink" title="Scrapy Shell"></a>Scrapy Shell</h3><p>由于 <code>Selector</code> 主要是与 <code>Scrapy</code> 结合使用，如 <code>Scrapy</code> 的回调函数中的参数 <code>response</code> 直接调用 <code>xpath()</code> 或者 <code>css()</code> 方法来提取数据，所以在这里我们借助 <code>Scrapy Shell</code> 来模拟 <code>Scrapy</code> 请求的过程，来讲解相关的提取方法。</p><p>我们用官方文档的一个样例页面来做演示：<a href="http://doc.scrapy.org/en/latest/_static/selectors-sample1.html">http://doc.scrapy.org/en/latest/_static/selectors-sample1.html</a>。 </p><p>开启 <code>Scrapy Shell</code>，在命令行中输入如下命令： </p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">scrapy shell http://doc.scrapy.org/en/latest/_static/selectors-sample1.html<br></code></pre></div></td></tr></table></figure><p>这样我们就进入了 <code>Scrapy Shell</code> 模式。这个过程其实是 <code>Scrapy</code> 发起了一次请求，请求的 <code>URL</code> 就是刚才命令行下输入的 <code>URL</code> ，然后把一些可操作的变量传递给我们，如 <code>request、response</code> 等。</p><p>输出结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">C:\Users\espho\PycharmProjects\PythonProjs\python模块\Scrapy框架&gt;scrapy shell http://doc.scrapy.org/en/latest/_static/selectors-sample1.html<br><span class="hljs-number">2021</span>-06-08 <span class="hljs-number">13</span>:<span class="hljs-number">47</span>:02 [scrapy.utils.log] INFO: Scrapy <span class="hljs-number">2.5</span><span class="hljs-number">.0</span> started (bot: scrapybot)<br><span class="hljs-number">2021</span>-06-08 <span class="hljs-number">13</span>:<span class="hljs-number">47</span>:02 [scrapy.utils.log] INFO: Versions: lxml <span class="hljs-number">4.6</span><span class="hljs-number">.3</span><span class="hljs-number">.0</span>, libxml2 <span class="hljs-number">2.9</span><span class="hljs-number">.5</span>, cssselect <span class="hljs-number">1.1</span><span class="hljs-number">.0</span>, parsel <span class="hljs-number">1.6</span><span class="hljs-number">.0</span>, w3lib <span class="hljs-number">1.22</span><span class="hljs-number">.0</span>, Twisted <span class="hljs-number">21.2</span><span class="hljs-number">.0</span>, Python <span class="hljs-number">3.8</span><span class="hljs-number">.7</span> (tags/v3<span class="hljs-number">.8</span><span class="hljs-number">.7</span>:6503f05, Dec <span class="hljs-number">21</span> <span class="hljs-number">2020</span>, <span class="hljs-number">17</span>:<span class="hljs-number">59</span>:<span class="hljs-number">51</span>) [MSC v<span class="hljs-number">.1928</span> <span class="hljs-number">64</span> bit (AMD64)], pyOpenSSL <span class="hljs-number">20.0</span><span class="hljs-number">.1</span> (OpenSSL <span class="hljs-number">1.1</span><span class="hljs-number">.1</span>k  <span class="hljs-number">25</span> Mar <span class="hljs-number">2021</span>), cryptography <span class="hljs-number">3.4</span><span class="hljs-number">.7</span>, Platform Windows-<span class="hljs-number">10</span>-<span class="hljs-number">10.0</span><span class="hljs-number">.19041</span>-SP0<br><span class="hljs-number">2021</span>-06-08 <span class="hljs-number">13</span>:<span class="hljs-number">47</span>:02 [scrapy.utils.log] DEBUG: Using reactor: twisted.internet.selectreactor.SelectReactor<br><span class="hljs-number">2021</span>-06-08 <span class="hljs-number">13</span>:<span class="hljs-number">47</span>:02 [scrapy.crawler] INFO: Overridden settings:<br>&#123;<span class="hljs-string">&#x27;DUPEFILTER_CLASS&#x27;</span>: <span class="hljs-string">&#x27;scrapy.dupefilters.BaseDupeFilter&#x27;</span>,<br> <span class="hljs-string">&#x27;LOGSTATS_INTERVAL&#x27;</span>: <span class="hljs-number">0</span>&#125;<br><span class="hljs-number">2021</span>-06-08 <span class="hljs-number">13</span>:<span class="hljs-number">47</span>:02 [scrapy.extensions.telnet] INFO: Telnet Password: b22034a15ef07be9<br><span class="hljs-number">2021</span>-06-08 <span class="hljs-number">13</span>:<span class="hljs-number">47</span>:02 [scrapy.middleware] INFO: Enabled extensions:<br>[<span class="hljs-string">&#x27;scrapy.extensions.corestats.CoreStats&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.extensions.telnet.TelnetConsole&#x27;</span>]<br><span class="hljs-number">2021</span>-06-08 <span class="hljs-number">13</span>:<span class="hljs-number">47</span>:02 [scrapy.middleware] INFO: Enabled downloader middlewares:<br>[<span class="hljs-string">&#x27;scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.useragent.UserAgentMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.retry.RetryMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.redirect.RedirectMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.cookies.CookiesMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.downloadermiddlewares.stats.DownloaderStats&#x27;</span>]<br><span class="hljs-number">2021</span>-06-08 <span class="hljs-number">13</span>:<span class="hljs-number">47</span>:02 [scrapy.middleware] INFO: Enabled spider middlewares:<br>[<span class="hljs-string">&#x27;scrapy.spidermiddlewares.httperror.HttpErrorMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.spidermiddlewares.offsite.OffsiteMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.spidermiddlewares.referer.RefererMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.spidermiddlewares.urllength.UrlLengthMiddleware&#x27;</span>,<br> <span class="hljs-string">&#x27;scrapy.spidermiddlewares.depth.DepthMiddleware&#x27;</span>]<br><span class="hljs-number">2021</span>-06-08 <span class="hljs-number">13</span>:<span class="hljs-number">47</span>:02 [scrapy.middleware] INFO: Enabled item pipelines:<br>[]<br><span class="hljs-number">2021</span>-06-08 <span class="hljs-number">13</span>:<span class="hljs-number">47</span>:02 [scrapy.extensions.telnet] INFO: Telnet console listening on <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6023</span><br><span class="hljs-number">2021</span>-06-08 <span class="hljs-number">13</span>:<span class="hljs-number">47</span>:02 [scrapy.core.engine] INFO: Spider opened<br><span class="hljs-number">2021</span>-06-08 <span class="hljs-number">13</span>:<span class="hljs-number">47</span>:03 [scrapy.downloadermiddlewares.redirect] DEBUG: Redirecting (<span class="hljs-number">302</span>) to &lt;GET https://doc.scrapy.org/en/latest/_static/selectors-sample1.html&gt; <span class="hljs-keyword">from</span> &lt;GET http://doc.scrapy.org/en/latest/_static/selectors-sample1.html&gt;<br><span class="hljs-number">2021</span>-06-08 <span class="hljs-number">13</span>:<span class="hljs-number">47</span>:04 [scrapy.core.engine] DEBUG: Crawled (<span class="hljs-number">200</span>) &lt;GET https://doc.scrapy.org/en/latest/_static/selectors-sample1.html&gt; (referer: <span class="hljs-literal">None</span>)<br><span class="hljs-number">2021</span>-06-08 <span class="hljs-number">13</span>:<span class="hljs-number">47</span>:06 [asyncio] DEBUG: Using proactor: IocpProactor<br>[s] Available Scrapy objects:<br>[s]   scrapy     scrapy module (contains scrapy.Request, scrapy.Selector, etc)<br>[s]   crawler    &lt;scrapy.crawler.Crawler <span class="hljs-built_in">object</span> at <span class="hljs-number">0x0000010ADFBBE220</span>&gt;<br>[s]   item       &#123;&#125;<br>[s]   request    &lt;GET http://doc.scrapy.org/en/latest/_static/selectors-sample1.html&gt;<br>[s]   response   &lt;<span class="hljs-number">200</span> https://doc.scrapy.org/en/latest/_static/selectors-sample1.html&gt;<br>[s]   settings   &lt;scrapy.settings.Settings <span class="hljs-built_in">object</span> at <span class="hljs-number">0x0000010ADFBBE2B0</span>&gt;<br>[s]   spider     &lt;DefaultSpider <span class="hljs-string">&#x27;default&#x27;</span> at <span class="hljs-number">0x10ae002fdc0</span>&gt;<br>[s] Useful shortcuts:<br>[s]   fetch(url[, redirect=<span class="hljs-literal">True</span>]) Fetch URL <span class="hljs-keyword">and</span> update local objects (by default, redirects are followed)<br>[s]   fetch(req)                  Fetch a scrapy.Request <span class="hljs-keyword">and</span> update local objects<br>[s]   shelp()           Shell <span class="hljs-built_in">help</span> (<span class="hljs-built_in">print</span> this <span class="hljs-built_in">help</span>)<br>[s]   view(response)    View response <span class="hljs-keyword">in</span> a browser<br><span class="hljs-number">2021</span>-06-08 <span class="hljs-number">13</span>:<span class="hljs-number">47</span>:06 [asyncio] DEBUG: Using proactor: IocpProactor<br>In [<span class="hljs-number">1</span>]: <br></code></pre></div></td></tr></table></figure><p>可以在命令行模式下输入命令调用对象的一些操作方法，回车之后实时显示结果。这与 <code>Python</code> 的命令行交互模式是类似的。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">2</span>]: response.url<br>Out[<span class="hljs-number">2</span>]: <span class="hljs-string">&#x27;https://doc.scrapy.org/en/latest/_static/selectors-sample1.html&#x27;</span><br>In [<span class="hljs-number">3</span>]: response.text<br>Out[<span class="hljs-number">3</span>]: <span class="hljs-string">&quot;&lt;html&gt;\n &lt;head&gt;\n  &lt;base href=&#x27;http://example.com/&#x27; /&gt;\n  &lt;title&gt;Example website&lt;/title&gt;\n &lt;/head&gt;\n &lt;body&gt;\n  &lt;div id=&#x27;images&#x27;&gt;\n   &lt;a href=&#x27;image1.html&#x27;&gt;Name: My image 1 &lt;br /&gt;&lt;img src=&#x27;image1_thumb.jpg&#x27; /&gt;&lt;/a&gt;\n   &lt;a href=&#x27;image2.html&#x27;&gt;Name: My image 2 &lt;br /&gt;&lt;img src=&#x27;image2_thumb.jpg&#x27; /&gt;&lt;/a&gt;\n   &lt;a href=&#x27;image3.html&#x27;&gt;Name: My image 3 &lt;br /&gt;&lt;img src=&#x27;image3_thumb.jpg&#x27; /&gt;&lt;/a&gt;\n   &lt;a href=&#x27;image4.html&#x27;&gt;Name: My image 4 &lt;br /&gt;&lt;img src=&#x27;image4_thumb.jpg&#x27; /&gt;&lt;/a&gt;\n   &lt;a href=&#x27;image5.html&#x27;&gt;Name: My image 5 &lt;br /&gt;&lt;img src=&#x27;image5_thumb.jpg&#x27; /&gt;&lt;/a&gt;\n  &lt;/div&gt;\n &lt;/body&gt;\n&lt;/html&gt;\n\n&quot;</span><br></code></pre></div></td></tr></table></figure><h3 id="XPath选择器"><a href="#XPath选择器" class="headerlink" title="XPath选择器"></a>XPath选择器</h3><p>进入 <code>Scrapy Shell</code> 之后，我们将主要操作 <code>response</code> 变量来进行解析。因为我们解析的是 <code>HTML</code> <code>代码，Selector</code> 将自动使用 <code>HTML</code>语法来分析。 <code>response</code> 有一个属性 <code>selector</code>，我们调用 <code>response.selector</code> 返回的内容就相当于用 <code>response</code> 的 <code>text</code> 构造了一个 <code>Selector</code> 对象。通过这个 <code>Selector</code> 对象我们可以调用解析方法如 <code>xpath、css</code> 等，通过向方法传入 <code>XPath</code>或 <code>CSS</code> 选择器参数就可以实现信息的提取。 我们用一个实例感受一下，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">4</span>]: response.selector<br>Out[<span class="hljs-number">4</span>]: &lt;Selector xpath=<span class="hljs-literal">None</span> data=<span class="hljs-string">&#x27;&lt;html&gt;\n &lt;head&gt;\n  &lt;base href=&quot;http://e...&#x27;</span>&gt;<br><br>In [<span class="hljs-number">6</span>]: result = response.selector.xpath(<span class="hljs-string">&quot;//a&quot;</span>)<br><br>In [<span class="hljs-number">7</span>]: result<br>Out[<span class="hljs-number">7</span>]: <br>[&lt;Selector xpath=<span class="hljs-string">&#x27;//a&#x27;</span> data=<span class="hljs-string">&#x27;&lt;a href=&quot;image1.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;//a&#x27;</span> data=<span class="hljs-string">&#x27;&lt;a href=&quot;image2.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;//a&#x27;</span> data=<span class="hljs-string">&#x27;&lt;a href=&quot;image3.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;//a&#x27;</span> data=<span class="hljs-string">&#x27;&lt;a href=&quot;image4.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;//a&#x27;</span> data=<span class="hljs-string">&#x27;&lt;a href=&quot;image5.html&quot;&gt;Name: My image ...&#x27;</span>&gt;]<br></code></pre></div></td></tr></table></figure><p>打印结果的形式是 <code>Selector</code> 组成的列表，其实它是 <code>SelectorList</code> 类型， <code>SelectorList</code> 和 <code>Selector</code> 都可以继续调用 <code>xpath</code> 和 <code>css</code> 等方法来进一步提取数据。 在上面的例子中，我们提取了 <code>a</code> 节点。接下来，我们尝试继续调用 <code>xpath</code> 方法来提取 <code>a</code> 节点内包含的 <code>img</code> 节点，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">8</span>]: result.xpath(<span class="hljs-string">&quot;./img&quot;</span>)<br>Out[<span class="hljs-number">8</span>]: <br>[&lt;Selector xpath=<span class="hljs-string">&#x27;./img&#x27;</span> data=<span class="hljs-string">&#x27;&lt;img src=&quot;image1_thumb.jpg&quot;&gt;&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;./img&#x27;</span> data=<span class="hljs-string">&#x27;&lt;img src=&quot;image2_thumb.jpg&quot;&gt;&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;./img&#x27;</span> data=<span class="hljs-string">&#x27;&lt;img src=&quot;image3_thumb.jpg&quot;&gt;&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;./img&#x27;</span> data=<span class="hljs-string">&#x27;&lt;img src=&quot;image4_thumb.jpg&quot;&gt;&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;./img&#x27;</span> data=<span class="hljs-string">&#x27;&lt;img src=&quot;image5_thumb.jpg&quot;&gt;&#x27;</span>&gt;]<br></code></pre></div></td></tr></table></figure><p>我们获得了 <code>a</code> 节点里面的所有 <code>img</code>节点，结果为 <code>5</code>。</p><p>选择器的最前方加 <code>.（点）</code>，这代表提取元素内部的数据，如果没有加点，则代表从根节点开始提取。此处我们用了 <code>./img</code>的提取方式，则代表从 <code>a</code> 节点里进行提取。如果此处我们用 <code>//img</code>，则还 是从 <code>html节点</code>里进行提取。 </p><p>我们刚才使用了 <code>response.selector.xpath</code>方法对数据进行了提取。<code>Scrapy</code>提供了两个实用的快捷方法，<code>response.xpath</code>和 <code>response.css</code>，它们二者的功能完全等同于 <code>response.selector.xpath</code>和 <code>response.selector.css</code>。方便起 见，后面我们统一直接调用 <code>response</code> 的 <code>xpath</code>和 <code>css</code> 方法进行选择。 现在我们得到的是 <code>SelectorList</code> 类型的变量，该变量是由 <code>Selector</code> 对象组成的列表。我们可以用索引单独取出其中某个 <code>Selector</code> 元素，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">9</span>]: result[<span class="hljs-number">0</span>]<br>Out[<span class="hljs-number">9</span>]: &lt;Selector xpath=<span class="hljs-string">&#x27;//a&#x27;</span> data=<span class="hljs-string">&#x27;&lt;a href=&quot;image1.html&quot;&gt;Name: My image ...&#x27;</span>&gt;<br></code></pre></div></td></tr></table></figure><p>可以像操作列表一样操作这个 <code>SelectorList</code> 。但是现在获取的内容是 <code>Selector</code> 或者 <code>SelectorList</code> 类型，并不是真正的文本内容。那么具体的内容怎么提取呢？ 比如我们现在想提取出 <code>a</code> 节点元素，就可以利用 <code>extract</code> 方法，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">10</span>]: result[<span class="hljs-number">0</span>].extract()<br>Out[<span class="hljs-number">10</span>]: <span class="hljs-string">&#x27;&lt;a href=&quot;image1.html&quot;&gt;Name: My image 1 &lt;br&gt;&lt;img src=&quot;image1_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span><br></code></pre></div></td></tr></table></figure><p>这里使用了 <code>extract</code> 方法，我们就可以把真实需要的内容获取下来。</p><p>还可以改写 <code>XPath</code> 表达式，来选取节点的内部文本和属性，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">11</span>]: response.xpath(<span class="hljs-string">&#x27;//a/text()&#x27;</span>).extract()<br>Out[<span class="hljs-number">11</span>]: <br>[<span class="hljs-string">&#x27;Name: My image 1 &#x27;</span>,<br> <span class="hljs-string">&#x27;Name: My image 2 &#x27;</span>,<br> <span class="hljs-string">&#x27;Name: My image 3 &#x27;</span>,<br> <span class="hljs-string">&#x27;Name: My image 4 &#x27;</span>,<br> <span class="hljs-string">&#x27;Name: My image 5 &#x27;</span>]<br><br>In [<span class="hljs-number">12</span>]: response.xpath(<span class="hljs-string">&#x27;//a/@href&#x27;</span>).extract()<br>Out[<span class="hljs-number">12</span>]: [<span class="hljs-string">&#x27;image1.html&#x27;</span>, <span class="hljs-string">&#x27;image2.html&#x27;</span>, <span class="hljs-string">&#x27;image3.html&#x27;</span>, <span class="hljs-string">&#x27;image4.html&#x27;</span>, <span class="hljs-string">&#x27;image5.html&#x27;</span>]<br></code></pre></div></td></tr></table></figure><p>只需要再加一层<code> /text()</code> 就可以获取节点的内部文本，或者加一层 <code>/@href</code>就可以获取节点的 <code>href属性</code>。其中，<code>@</code> 符号后面内容就是要获取的属性名称。</p><p>现在我们可以用一个规则把所有符合要求的节点都获取下来，返回的类型是列表类型。</p><p>但是这里有一个问题：如果符合要求的节点只有一个，那么返回的结果会是什么呢？我们再用一个实例来感受一下，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">13</span>]: response.xpath(<span class="hljs-string">&#x27;//a[@href=&quot;image1.html&quot;]/text()&#x27;</span>).extract()<br>Out[<span class="hljs-number">13</span>]: [<span class="hljs-string">&#x27;Name: My image 1 &#x27;</span>]<br></code></pre></div></td></tr></table></figure><p>用属性限制了匹配的范围，使 <code>XPath</code>只可以匹配到一个元素。然后用 <code>extract</code> 方法提取结果，其结果还是一个列表形式，其文本是列表的第一个元素。但很多情况下，我们其实想要的数据就是第一个元素内容，这里我们通过加一个索引来获取，如下所示： </p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&#x27;Name: My image 1 &#x27;</span> <br></code></pre></div></td></tr></table></figure><p>但是，这个写法很明显是有风险的。一旦 <code>XPath</code>有问题，那么 <code>extract</code> 后的结果可能是一个空列表。如果我们再用索引来获取，那不就可能会导致数组越界吗？ 所以，另外一个方法可以专门提取单个元素，它叫作 <code>extract_first</code>。我们可以改写上面的例子如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">14</span>]: response.xpath(<span class="hljs-string">&#x27;//a[@href=&quot;image1.html&quot;]/text()&#x27;</span>).extract_first()<br>Out[<span class="hljs-number">14</span>]: <span class="hljs-string">&#x27;Name: My image 1 &#x27;</span><br></code></pre></div></td></tr></table></figure><p>直接利用 <code>extract_first</code> 方法将匹配的第一个结果提取出来，同时我们也不用担心数组越界的问题。也可以给<code>extract_first()</code>传递一个默认值，找不到的话会使用默认值。</p><h3 id="CSS-选择器"><a href="#CSS-选择器" class="headerlink" title="CSS 选择器"></a>CSS 选择器</h3><p>接下来，我们看看 <code>CSS</code> 选择器的用法。<code>Scrapy</code>的选择器同时还对接了 <code>CSS</code> 选择器，使用 <code>response.css()</code> 方法可以使用 <code>CSS</code> 选择器来选择对应的元素。</p><p>例如在上文我们选取了所有的 <code>a</code> 节点，那么 <code>CSS</code> 选择器同样可以做到，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">15</span>]: response.css(<span class="hljs-string">&#x27;a&#x27;</span>)<br>Out[<span class="hljs-number">15</span>]: <br>[&lt;Selector xpath=<span class="hljs-string">&#x27;descendant-or-self::a&#x27;</span> data=<span class="hljs-string">&#x27;&lt;a href=&quot;image1.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;descendant-or-self::a&#x27;</span> data=<span class="hljs-string">&#x27;&lt;a href=&quot;image2.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;descendant-or-self::a&#x27;</span> data=<span class="hljs-string">&#x27;&lt;a href=&quot;image3.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;descendant-or-self::a&#x27;</span> data=<span class="hljs-string">&#x27;&lt;a href=&quot;image4.html&quot;&gt;Name: My image ...&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;descendant-or-self::a&#x27;</span> data=<span class="hljs-string">&#x27;&lt;a href=&quot;image5.html&quot;&gt;Name: My image ...&#x27;</span>&gt;]<br></code></pre></div></td></tr></table></figure><p>同样，调用 <code>extract</code> 方法就可以提取出节点，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">16</span>]: response.css(<span class="hljs-string">&#x27;a&#x27;</span>).extract()<br>Out[<span class="hljs-number">16</span>]: <br>[<span class="hljs-string">&#x27;&lt;a href=&quot;image1.html&quot;&gt;Name: My image 1 &lt;br&gt;&lt;img src=&quot;image1_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>,<br> <span class="hljs-string">&#x27;&lt;a href=&quot;image2.html&quot;&gt;Name: My image 2 &lt;br&gt;&lt;img src=&quot;image2_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>,<br> <span class="hljs-string">&#x27;&lt;a href=&quot;image3.html&quot;&gt;Name: My image 3 &lt;br&gt;&lt;img src=&quot;image3_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>,<br> <span class="hljs-string">&#x27;&lt;a href=&quot;image4.html&quot;&gt;Name: My image 4 &lt;br&gt;&lt;img src=&quot;image4_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>,<br> <span class="hljs-string">&#x27;&lt;a href=&quot;image5.html&quot;&gt;Name: My image 5 &lt;br&gt;&lt;img src=&quot;image5_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>]<br></code></pre></div></td></tr></table></figure><p>用法和 <code>XPath选择</code>是完全一样的。另外，我们也可以进行属性选择和嵌套选择，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">17</span>]: response.css(<span class="hljs-string">&#x27;a[href=&quot;image4.html&quot;]&#x27;</span>).extract()<br>Out[<span class="hljs-number">17</span>]: [<span class="hljs-string">&#x27;&lt;a href=&quot;image4.html&quot;&gt;Name: My image 4 &lt;br&gt;&lt;img src=&quot;image4_thumb.jpg&quot;&gt;&lt;/a&gt;&#x27;</span>]<br>In [<span class="hljs-number">18</span>]: response.css(<span class="hljs-string">&#x27;a[href=&quot;image4.html&quot;] img&#x27;</span>).extract()<br>Out[<span class="hljs-number">18</span>]: [<span class="hljs-string">&#x27;&lt;img src=&quot;image4_thumb.jpg&quot;&gt;&#x27;</span>]<br></code></pre></div></td></tr></table></figure><p>也可以使用 <code>extract_first()</code> 方法提取列表的第一个元素，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">19</span>]: response.css(<span class="hljs-string">&#x27;a[href=&quot;image4.html&quot;] img&#x27;</span>).extract_first()<br>Out[<span class="hljs-number">19</span>]: <span class="hljs-string">&#x27;&lt;img src=&quot;image4_thumb.jpg&quot;&gt;&#x27;</span><br></code></pre></div></td></tr></table></figure><p>接下来的两个用法不太一样。节点的内部文本和属性的获取是这样实现的，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">21</span>]: response.css(<span class="hljs-string">&#x27;a[href=&quot;image4.html&quot;]::text&#x27;</span>).extract_first()<br>Out[<span class="hljs-number">21</span>]: <span class="hljs-string">&#x27;Name: My image 4 &#x27;</span><br>In [<span class="hljs-number">22</span>]: response.css(<span class="hljs-string">&#x27;a[href=&quot;image4.html&quot;] img::attr(src)&#x27;</span>).extract_first()<br>Out[<span class="hljs-number">22</span>]: <span class="hljs-string">&#x27;image4_thumb.jpg&#x27;</span><br></code></pre></div></td></tr></table></figure><p>获取文本和属性需要用 <code>::text</code> 和 <code>::attr()</code> 的写法。而其他库如 <code>BeautifulSoup</code> 或 <code>PyQuery</code> 都有单独的方法。</p><p><code>CSS 选择器</code>和 <code>XPath选择器</code>一样可以嵌套选择。我们可以先用 <code>XPath选择器</code>选中所有 <code>a</code> 节点，再利用 <code>CSS 选择器</code>选中 <code>img节点</code>，再用 <code>XPath选择器</code>获取属性。我们用一个实例来感受一下，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">23</span>]: response.xpath(<span class="hljs-string">&#x27;//a&#x27;</span>).css(<span class="hljs-string">&#x27;img&#x27;</span>).xpath(<span class="hljs-string">&#x27;@src&#x27;</span>)<br>Out[<span class="hljs-number">23</span>]: <br>[&lt;Selector xpath=<span class="hljs-string">&#x27;@src&#x27;</span> data=<span class="hljs-string">&#x27;image1_thumb.jpg&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;@src&#x27;</span> data=<span class="hljs-string">&#x27;image2_thumb.jpg&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;@src&#x27;</span> data=<span class="hljs-string">&#x27;image3_thumb.jpg&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;@src&#x27;</span> data=<span class="hljs-string">&#x27;image4_thumb.jpg&#x27;</span>&gt;,<br> &lt;Selector xpath=<span class="hljs-string">&#x27;@src&#x27;</span> data=<span class="hljs-string">&#x27;image5_thumb.jpg&#x27;</span>&gt;]<br>In [<span class="hljs-number">24</span>]: response.xpath(<span class="hljs-string">&#x27;//a&#x27;</span>).css(<span class="hljs-string">&#x27;img&#x27;</span>).xpath(<span class="hljs-string">&#x27;@src&#x27;</span>).extract_first()<br>Out[<span class="hljs-number">24</span>]: <span class="hljs-string">&#x27;image1_thumb.jpg&#x27;</span><br></code></pre></div></td></tr></table></figure><p>可以随意使用 <code>xpath</code> 和 <code>css</code> 方法二者自由组合实现嵌套查询，二者是完全兼容的。</p><h3 id="正则匹配"><a href="#正则匹配" class="headerlink" title="正则匹配"></a>正则匹配</h3><p><code>Scrapy</code>的选择器还支持正则匹配。比如，在示例的 <code>a</code> 节点中的文本类似于 <code>Name:My image 1</code>，现在我们只想把 <code>Name:</code>后面的内容提取出来，这时就可以借助 <code>re</code> 方法，实现如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">27</span>]: response.xpath(<span class="hljs-string">&#x27;//a/text()&#x27;</span>).re(<span class="hljs-string">&#x27;\s(.*):\s(.*)&#x27;</span>)<br>Out[<span class="hljs-number">27</span>]: [<span class="hljs-string">&#x27;My image 1 &#x27;</span>, <span class="hljs-string">&#x27;My image 2 &#x27;</span>, <span class="hljs-string">&#x27;My image 3 &#x27;</span>, <span class="hljs-string">&#x27;My image 4 &#x27;</span>, <span class="hljs-string">&#x27;My image 5 &#x27;</span>]<br></code></pre></div></td></tr></table></figure><p>给 <code>re</code> 方法传入一个正则表达式，其中 <code>(.*)</code> 就是要匹配的内容，输出的结果就是正则表达式匹配的分组，结果会依次输出。 如果同时存在两个分组，那么结果依然会被按序输出，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">32</span>]: response.xpath(<span class="hljs-string">&#x27;//a/text()&#x27;</span>).re(<span class="hljs-string">&#x27;(.*?):\s(.*)&#x27;</span>)<br>Out[<span class="hljs-number">32</span>]: <br>[<span class="hljs-string">&#x27;Name&#x27;</span>,<br> <span class="hljs-string">&#x27;My image 1 &#x27;</span>,<br> <span class="hljs-string">&#x27;Name&#x27;</span>,<br> <span class="hljs-string">&#x27;My image 2 &#x27;</span>,<br> <span class="hljs-string">&#x27;Name&#x27;</span>,<br> <span class="hljs-string">&#x27;My image 3 &#x27;</span>,<br> <span class="hljs-string">&#x27;Name&#x27;</span>,<br> <span class="hljs-string">&#x27;My image 4 &#x27;</span>,<br> <span class="hljs-string">&#x27;Name&#x27;</span>,<br> <span class="hljs-string">&#x27;My image 5 &#x27;</span>]<br></code></pre></div></td></tr></table></figure><p>类似 <code>extract_first</code> 方法，<code>re_first</code> 方法可以选取列表的第一个元素，用法如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">35</span>]: response.xpath(<span class="hljs-string">&#x27;//a/text()&#x27;</span>).re_first(<span class="hljs-string">&#x27;(.*?):\s(.*)&#x27;</span>)<br>Out[<span class="hljs-number">35</span>]: <span class="hljs-string">&#x27;Name&#x27;</span><br></code></pre></div></td></tr></table></figure><p>不论正则匹配了几个分组，结果都会等于列表的第一个元素。 值得注意的是， <code>response</code> 对象不能直接调用 <code>re</code> 和 <code>re_first</code> 方法。如果想要对全文进行正则匹配，可以先调用 <code>xpath</code> 方法然后再进行正则匹配，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">In [<span class="hljs-number">36</span>]: response.xpath(<span class="hljs-string">&#x27;.&#x27;</span>).re(<span class="hljs-string">&#x27;Name:\s(.*)&lt;br&gt;&#x27;</span>)<br>Out[<span class="hljs-number">36</span>]: [<span class="hljs-string">&#x27;My image 1 &#x27;</span>, <span class="hljs-string">&#x27;My image 2 &#x27;</span>, <span class="hljs-string">&#x27;My image 3 &#x27;</span>, <span class="hljs-string">&#x27;My image 4 &#x27;</span>, <span class="hljs-string">&#x27;My image 5 &#x27;</span>]<br><br>In [<span class="hljs-number">37</span>]:  response.xpath(<span class="hljs-string">&#x27;.&#x27;</span>).re_first(<span class="hljs-string">&#x27;Name:\s(.*)&lt;br&gt;&#x27;</span>)<br>Out[<span class="hljs-number">37</span>]: <span class="hljs-string">&#x27;My image 1 </span><br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>scarpy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>django入门-环境搭建</title>
    <link href="/2021/06/07/django%E5%85%A5%E9%97%A8%E5%8F%8A%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <url>/2021/06/07/django%E5%85%A5%E9%97%A8%E5%8F%8A%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h2 id="为什么要使用Django"><a href="#为什么要使用Django" class="headerlink" title="为什么要使用Django?"></a>为什么要使用Django?</h2><p><code>Django</code>是一个用<code>python</code>编写的Web框架。Web框架是一种软件，基于web框架可以开发动态网站，各种应用程序以及服务。它提供了一系列工具和功能，可以解决许多与Web开发相关的常见问题，比如∶ 安全功能，数据库访问，会话，模板处理，URL路由，国际化，本地化，等等。</p><p>使用诸如 <code>Django</code> 之类的网络框架，使我们能够以标准化的方式快速开发安全可靠的Web应用程序，而无需重新发明轮子。</p><p>那么，Django有什么特别之处呢? 对于初学者来说，它是一个<code>Python Web</code>框架，这意味着你可以受益于各种各样的开源库包。如果当你想要解决一个特定的问题的时候，可能有人已经为它实现了一个库来供你使用。<code>Django</code>是用python编写的最流行的web框架之一。它绝对是最完整的，提供了各种各样的开箱即用的功能，比如用于开发和测试的独立Web服务器，缓存，中间件系统，<code>ORM</code>，模板引擎，表单处理，基于<code>Python单元测试</code>的工具接口。<code>Django</code>还自带内部电池，提供内置应用程序，比如一个认证系统，一个可用于 <code>cRuD （增删改查）</code>操作并且自动生成页面的后台管理界面，生成订阅文档<code>（RSS/Atom）</code>，站点地图等。甚至在<code>django</code>中内建了一个<code>地理信息系统（GIS）框架</code>。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>通过虚拟环境安装，先安装虚拟环境。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install virtualenv<br></code></pre></div></td></tr></table></figure><p>创建虚拟环境并激活，在虚拟环境下安装<code>django</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">mkdir myproject<br>cd myproject<br>virtualenv venv -p python3<br>.\venv\Scripts\activate.bat <span class="hljs-comment"># 激活虚拟环境，在命令行前出现venv得命令，代表虚拟环境激活</span><br>pip install django<br></code></pre></div></td></tr></table></figure><p>如果要退出虚拟环境，运行<code>deactive</code>就退出了虚拟环境。</p><h2 id="创建一个项目"><a href="#创建一个项目" class="headerlink" title="创建一个项目"></a>创建一个项目</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">django-admin startproject myproject<br></code></pre></div></td></tr></table></figure><p>执行上面的命令后，会在目录下生成基础文件夹结构。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">vnev/<br>myproject/<br>  - myproject/<br>    -- asgi.py<br>    -- settings.py<br>    -- urls.py<br>    -- wsgi.py<br>    -- __init__.py<br>  - manage.py<br></code></pre></div></td></tr></table></figure><p>最初项目由五个文件构成：</p><ul><li><code>manage.py </code>：使用 <code>django-admin</code> 命令行工具得快捷方式。用于运行与项目相关得管理命令。</li><li><code>__init__.py</code>：告诉python这个文件夹是一个python包</li><li><code>seetings.py</code>：这个文件包含了所有得项目配置。</li><li><code>urls.py</code>：这个文件负责映射项目中得路由和路径。</li><li><code>wsgi.py</code>：该文件是用于部署得简单网关接口。</li></ul><p><code>django</code>自带了一个简单得网络服务器。在开发过程中无需安装其他软件即可在本地运行项目，通过执行命令测试一些。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">python manage.py runserver<br><br><span class="hljs-comment"># Django version 3.2.4, using settings &#x27;myproject.settings&#x27;</span><br><span class="hljs-comment"># Starting development server at http://127.0.0.1:8000/</span><br><span class="hljs-comment"># Quit the server with CTRL-BREAK.</span><br></code></pre></div></td></tr></table></figure><p>访问<code>http://127.0.0.1:8000/</code>，你可以看到下面页面。</p><p><img src="Screenshot_1.webp"></p><p>使用<code>ctrl+c</code>来终止服务器。</p><h2 id="Django应用"><a href="#Django应用" class="headerlink" title="Django应用"></a>Django应用</h2><p>在<code>Django</code>得哲学中，有两个重要概念：</p><ul><li>app：是一个可以完成做某件事情得web应用程序。一个应用程序通常由一组models（数据库表），views（视图），templates（模板），tests（测试）组成。</li><li>project：是配置和应用程序得集合。一个项目可以由多个应用程序或一个应用程序组成。</li></ul><p>创建一个应用：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">django-admin startapp boards<br></code></pre></div></td></tr></table></figure><p>执行上面的命令后，会在<code>myproject/</code>目录下生成<code>boards</code>文件夹。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">vnev/<br>myproject/<br>  - boards/<br>      -- migrations/<br>      -- admin.py<br>      -- apps.py<br>      -- models.py<br>      -- tests.py<br>      -- views.py<br>      -- __init__.py<br>  - myproject/<br>      -- asgi.py<br>      -- settings.py<br>      -- urls.py<br>      -- wsgi.py<br>      -- __init__.py<br>  - manage.py<br></code></pre></div></td></tr></table></figure><p>文件作用介绍：</p><ul><li><code>migrations/</code>：在这个文件夹里，Django会存储一些文件跟踪models文件中创建得变更，用来保持数据库和models.py的同步。</li><li><code>admin.py</code>：这个文件为一个django内置的应用程序Django Admin的配置文件。</li><li><code>apps.py</code>：应用程序本身的配置文件。</li><li><code>models.py</code>：定义web应用程序数据实列的地方，models会由Django自动转为数据库表。</li><li><code>tests.py</code>：这个文件用来写当前应用程序的单元测试。</li><li><code>views.py</code>：处理web应用程序请求（request）/响应（response）周期的文件。</li></ul><p>现在创建了第一个应用程序，来配置下项目以便启用这个应用程序。</p><p>在<code>settings</code>文件中<code>INSTALLED_APPS</code>中添加这个应用：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">INSTALLED_APPS = [<br>    <span class="hljs-string">&#x27;django.contrib.admin&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.auth&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.contenttypes&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.sessions&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.messages&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.staticfiles&#x27;</span>,<br><br>    <span class="hljs-string">&#x27;boards&#x27;</span>,<br>]<br></code></pre></div></td></tr></table></figure><h2 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h2><p>现在来写第一个视图（view），打开boards应用程序中的views.py文件，并添加以下代码：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> HttpResponse<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">home</span>(<span class="hljs-params">request</span>):</span><br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;hello World&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>视图是接收<code>httprequest</code>对象并返回一个<code>httpresponse</code>对象的<code>python</code>函数。接收<code>request</code>作为参数并返回<code>response</code>作为结果。</p><p>这里定义了一个简单的视图，命名为<code>home</code>，它只是简单返回一个信息，一个字符串<code>hello world</code>。</p><p>接下来需要告诉<code>Django</code>什么时候会调用这个<code>view</code>。在<code>boards</code>文件夹下创建<code>urls.py</code>文件并添加以下内容中添加：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path<br><br><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views<br><br>urlpatterns = [<br>    path(<span class="hljs-string">&#x27;&#x27;</span>, views.home, name=<span class="hljs-string">&#x27;home&#x27;</span>),<br>]<br></code></pre></div></td></tr></table></figure><p>下一步是要在根 <code>URLconf</code> 文件中指定我们创建的 <code>boards.urls</code>模块。在 <code>myproject/urls.py</code> 文件的 <code>urlpatterns</code> 列表里插入一个<code> include()</code>， 如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin<br><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> include, path<br><br>urlpatterns = [<br>    path(<span class="hljs-string">&#x27;&#x27;</span>, include(<span class="hljs-string">&#x27;boards.urls&#x27;</span>)),<br>    path(<span class="hljs-string">&#x27;admin/&#x27;</span>, admin.site.urls),<br>]<br></code></pre></div></td></tr></table></figure><p>函数 <code>include()</code> 允许引用其它 <code>URLconfs</code>。每当 <code>Django</code> 遇到 <code>include()</code> 时，它会截断与此项匹配的 <code>URL</code> 的部分，并将剩余的字符串发送到 <code>URLconf</code> 以供进一步处理。</p><p>访问<code>http://127.0.0.1:8000/</code>，就会返回<code>hello world</code>。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XPath库解析</title>
    <link href="/2021/06/06/XPath%E5%BA%93%E8%A7%A3%E6%9E%90/"/>
    <url>/2021/06/06/XPath%E5%BA%93%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<p><code>XPath</code>，全称 <code>XML Path Language</code>，即 <code>XML</code> 路径语言，它是一门在<em>XML文档</em>中查找信息的语言。<code>XPath</code> 最初设计是用来搜寻<em>XML文档</em>的，<code>HTML</code>是<code>XML</code>的子集，它同样适用于<em>HTML文档</em>的搜索。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install lxml<br></code></pre></div></td></tr></table></figure><h2 id="XPath-术语"><a href="#XPath-术语" class="headerlink" title="XPath 术语"></a>XPath 术语</h2><h3 id="节点（Node）"><a href="#节点（Node）" class="headerlink" title="节点（Node）"></a>节点（Node）</h3><p>在 <code>XPath</code> 中，有七种类型的节点：<em>元素</em>、<em>属性</em>、<em>文本</em>、<em>命名空间</em>、<em>处理指令</em>、<em>注释</em>以及<em>文档节点（或称为根节点）</em>。</p><p>请看下面这个 <code>XML</code> 文档：</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">bookstore</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">book</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>Harry Potter<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>J K. Rowling<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2005<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>29.99<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bookstore</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>上面的<code>XML</code>文档中的节点例子：</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bookstore</span>&gt;</span> （文档节点）<br><span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>J K. Rowling<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span> （元素节点）<br>lang=&quot;en&quot; （属性节点） <br></code></pre></div></td></tr></table></figure><h4 id="基本值（或称原子值，Atomic-value）"><a href="#基本值（或称原子值，Atomic-value）" class="headerlink" title="基本值（或称原子值，Atomic value）"></a>基本值（或称原子值，Atomic value）</h4><p>基本值是无父或无子的节点。</p><p>基本值的例子：</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">J K. Rowling<br>&quot;en&quot;<br></code></pre></div></td></tr></table></figure><h4 id="项目（Item）"><a href="#项目（Item）" class="headerlink" title="项目（Item）"></a>项目（Item）</h4><p>项目是基本值或者节点。</p><h3 id="节点关系"><a href="#节点关系" class="headerlink" title="节点关系"></a>节点关系</h3><h4 id="父（Parent）"><a href="#父（Parent）" class="headerlink" title="父（Parent）"></a>父（Parent）</h4><p>每个元素以及属性都有一个父。</p><p>在下面的例子中，<code>book</code> 元素是 <code>title</code>、<code>author</code>、<code>year</code> 以及 <code>price</code> 元素的父：</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">book</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Harry Potter<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>J K. Rowling<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2005<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>29.99<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h4 id="子（Children）"><a href="#子（Children）" class="headerlink" title="子（Children）"></a>子（Children）</h4><p>元素节点可有零个、一个或多个子。</p><p>在下面的例子中，<code>title</code>、<code>author</code>、<code>year</code> 以及 <code>price</code> 元素都是 <code>book</code> 元素的子：</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">book</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Harry Potter<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>J K. Rowling<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2005<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>29.99<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h4 id="同胞（Sibling）"><a href="#同胞（Sibling）" class="headerlink" title="同胞（Sibling）"></a>同胞（Sibling）</h4><p>拥有相同的父的节点</p><p>在下面的例子中，<code>title</code>、<code>author</code>、<code>year</code> 以及 <code>price</code> 元素都是同胞：</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">book</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Harry Potter<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>J K. Rowling<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2005<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>29.99<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h4 id="先辈（Ancestor）"><a href="#先辈（Ancestor）" class="headerlink" title="先辈（Ancestor）"></a>先辈（Ancestor）</h4><p>某节点的父、父的父，等等。</p><p>在下面的例子中，<code>title</code> 元素的先辈是 <code>book</code> 元素和 <code>bookstore</code> 元素：</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bookstore</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">book</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Harry Potter<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>J K. Rowling<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2005<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>29.99<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bookstore</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h4 id="后代（Descendant）"><a href="#后代（Descendant）" class="headerlink" title="后代（Descendant）"></a>后代（Descendant）</h4><p>某个节点的子，子的子，等等。</p><p>在下面的例子中，<code>bookstore </code>的后代是 <code>book</code>、<code>title</code>、<code>author</code>、<code>year</code> 以及 <code>price</code> 元素：</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bookstore</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">book</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Harry Potter<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>J K. Rowling<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2005<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>29.99<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bookstore</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h2 id="XPath-语法"><a href="#XPath-语法" class="headerlink" title="XPath 语法"></a>XPath 语法</h2><p>目标实列：</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">bookstore</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">book</span> <span class="hljs-attr">category</span>=<span class="hljs-string">&quot;COOKING&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>Everyday Italian<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>Giada De Laurentiis<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2005<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>30.00<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">book</span> <span class="hljs-attr">category</span>=<span class="hljs-string">&quot;CHILDREN&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>Harry Potter<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>J K. Rowling<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2005<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>29.99<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">book</span> <span class="hljs-attr">category</span>=<span class="hljs-string">&quot;WEB&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>XQuery Kick Start<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>James McGovern<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>Per Bothner<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>Kurt Cagle<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>James Linn<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>Vaidyanathan Nagarajan<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2003<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>49.99<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">book</span> <span class="hljs-attr">category</span>=<span class="hljs-string">&quot;WEB&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>Learning XML<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>Erik T. Ray<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2003<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>39.95<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bookstore</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="选取节点"><a href="#选取节点" class="headerlink" title="选取节点"></a>选取节点</h3><p><code>XPath</code> 使用路径表达式在 <code>XML</code> 文档中选取节点。节点是通过沿着路径或者 <code>step</code> 来选取的。</p><p>下面列出了最有用的路径表达式：</p><table><thead><tr><th align="left">表达式</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">nodename</td><td align="left">选取此节点的所有子节点。</td></tr><tr><td align="left">/</td><td align="left">从根节点选取。</td></tr><tr><td align="left">//</td><td align="left">从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。</td></tr><tr><td align="left">.</td><td align="left">选取当前节点。</td></tr><tr><td align="left">..</td><td align="left">选取当前节点的父节点。</td></tr><tr><td align="left">@</td><td align="left">选取属性。</td></tr></tbody></table><p><strong>实例</strong></p><p>在下面的表格中，列出了一些路径表达式以及表达式的结果：</p><table><thead><tr><th align="left">路径表达式</th><th align="left">结果</th></tr></thead><tbody><tr><td align="left">bookstore</td><td align="left">选取 bookstore 元素的所有子节点。</td></tr><tr><td align="left">/bookstore</td><td align="left">选取根元素 bookstore。<br>注释：假如路径起始于正斜杠( / )，则此路径始终代表到某元素的绝对路径！</td></tr><tr><td align="left">bookstore/book</td><td align="left">选取属于 bookstore 的子元素的所有 book 元素。</td></tr><tr><td align="left">//book</td><td align="left">选取所有 book 子元素，而不管它们在文档中的位置。</td></tr><tr><td align="left">bookstore//book</td><td align="left">选择属于 bookstore 元素的后代的所有 book 元素，而不管它们位于 bookstore 之下的什么位置。</td></tr><tr><td align="left">//@lang</td><td align="left">选取名为 lang 的所有属性。</td></tr></tbody></table><h3 id="谓语（Predicates）"><a href="#谓语（Predicates）" class="headerlink" title="谓语（Predicates）"></a>谓语（Predicates）</h3><p>谓语用来查找某个特定的节点或者包含某个指定的值的节点。</p><p>谓语被嵌在方括号中。</p><p><strong>实例</strong><br>在下面的表格中，我们列出了带有谓语的一些路径表达式，以及表达式的结果：</p><table><thead><tr><th align="left">路径表达式</th><th align="left">结果</th></tr></thead><tbody><tr><td align="left">/bookstore/book[1]</td><td align="left">选取属于 bookstore 子元素的第一个 book 元素。</td></tr><tr><td align="left">/bookstore/book[last()]</td><td align="left">选取属于 bookstore 子元素的最后一个 book 元素。</td></tr><tr><td align="left">/bookstore/book[last()-1]</td><td align="left">选取属于 bookstore 子元素的倒数第二个 book 元素。</td></tr><tr><td align="left">/bookstore/book[position()&lt;3]</td><td align="left">选取最前面的两个属于 bookstore 元素的子元素的 book 元素。</td></tr><tr><td align="left">//title[@lang]</td><td align="left">选取所有拥有名为 lang 的属性的 title 元素。</td></tr><tr><td align="left">//title[@lang=’eng’]</td><td align="left">选取所有 title 元素，且这些元素拥有值为 eng 的 lang 属性。</td></tr><tr><td align="left">/bookstore/book[price&gt;35.00]</td><td align="left">选取 bookstore 元素的所有 book 元素，且其中的 price 元素的值须大于 35.00。</td></tr><tr><td align="left">/bookstore/book[price&gt;35.00]/title</td><td align="left">选取 bookstore 元素中的 book 元素的所有 title 元素，且其中的 price 元素的值须大于 35.00。</td></tr></tbody></table><h3 id="选取未知节点"><a href="#选取未知节点" class="headerlink" title="选取未知节点"></a>选取未知节点</h3><p><code>XPath</code> 通配符可用来选取未知的 <code>XML</code> 元素。</p><table><thead><tr><th align="left">通配符</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">*</td><td align="left">匹配任何元素节点。</td></tr><tr><td align="left">@*</td><td align="left">匹配任何属性节点。</td></tr><tr><td align="left">node()</td><td align="left">匹配任何类型的节点。</td></tr></tbody></table><p><strong>实例</strong></p><p>在下面的表格中，列出了一些路径表达式，以及这些表达式的结果：</p><table><thead><tr><th align="left">路径表达式</th><th align="left">结果</th></tr></thead><tbody><tr><td align="left">/bookstore/*</td><td align="left">选取 bookstore 元素的所有子元素。</td></tr><tr><td align="left">//*</td><td align="left">选取文档中的所有元素。</td></tr><tr><td align="left">//title[@*]</td><td align="left">选取所有带有属性的 title 元素。</td></tr></tbody></table><h3 id="选取若干路径"><a href="#选取若干路径" class="headerlink" title="选取若干路径"></a>选取若干路径</h3><p>通过在路径表达式中使用“|”运算符，您可以选取若干个路径。</p><p><strong>实例</strong><br>在下面的表格中，我们列出了一些路径表达式，以及这些表达式的结果：</p><table><thead><tr><th align="left">路径表达式</th><th align="left">结果</th></tr></thead><tbody><tr><td align="left">//book/title | //book/price</td><td align="left">选取 book 元素的所有 title 和 price 元素。</td></tr><tr><td align="left">//title | //price</td><td align="left">选取文档中的所有 title 和 price 元素。</td></tr><tr><td align="left">/bookstore/book/title | //price</td><td align="left">选取属于 bookstore 元素的 book 元素的所有 title 元素，以及文档中所有的 price 元素。</td></tr></tbody></table><h2 id="XPath-实例"><a href="#XPath-实例" class="headerlink" title="XPath 实例"></a>XPath 实例</h2><p>对<code>xml</code>文档的匹配。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># coding: utf-8</span><br><span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree<br><br>tree = etree.XML(xml,)<br>result = tree.xpath(<span class="hljs-string">&quot;/bookstore/book/title/text()&quot;</span>)<br><span class="hljs-comment"># [&#x27;Everyday Italian&#x27;, &#x27;Harry Potter&#x27;, &#x27;XQuery Kick Start&#x27;, &#x27;Learning XML&#x27;]</span><br><br>result = tree.xpath(<span class="hljs-string">&quot;//book[3]/author[2]/text()&quot;</span>)<br><span class="hljs-comment"># [&#x27;Per Bothner&#x27;]</span><br></code></pre></div></td></tr></table></figure><p>对<code>html</code>文档的匹配。</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-0&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;link1.html&quot;</span>&gt;</span>first item<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-1&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;link2.html&quot;</span>&gt;</span>second item<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-inactive&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;link3.html&quot;</span>&gt;</span>third item<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-1&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;link4.html&quot;</span>&gt;</span>fourth item<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-0&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;link5.html&quot;</span>&gt;</span>fifth item<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>引入<code>xlxml</code>模块， 从文件中导入<code>html</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree<br><br>tree = etree.parse(<span class="hljs-string">&#x27;./test.html&#x27;</span>, etree.HTMLParser())<br></code></pre></div></td></tr></table></figure><h3 id="通过字符串转换成html格式"><a href="#通过字符串转换成html格式" class="headerlink" title="通过字符串转换成html格式"></a>通过字符串转换成html格式</h3><p>利用<code>etree.HTML</code>解析字符串，将字符串解析从<code>html</code>格式的文件， 经过处理后，部分缺失的节点可以自动修复，并且还自动添加了 <code>body</code>、<code>html</code> 节点。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree<br><br>text = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">&lt;html&gt;</span><br><span class="hljs-string">    &lt;body&gt;</span><br><span class="hljs-string">        &lt;div&gt;</span><br><span class="hljs-string">            &lt;ul&gt;</span><br><span class="hljs-string">                &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link1.html&quot;&gt;first item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">                &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">                &lt;li class=&quot;item-inactive&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;third item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">                &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">                &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;/ul&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">    &lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>html = etree.HTML(text)<br>s = etree.tostring(html).decode()<br><span class="hljs-built_in">print</span>(s)<br><br><span class="hljs-comment"># &lt;html&gt;</span><br><span class="hljs-comment">#     &lt;body&gt;</span><br><span class="hljs-comment">#         &lt;div&gt;</span><br><span class="hljs-comment">#             &lt;ul&gt;</span><br><span class="hljs-comment">#                 &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link1.html&quot;&gt;first item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-comment">#                 &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-comment">#                 &lt;li class=&quot;item-inactive&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;third item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-comment">#                 &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-comment">#                 &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-comment">#             &lt;/ul&gt;</span><br><span class="hljs-comment">#         &lt;/div&gt;</span><br><span class="hljs-comment">#     &lt;/body&gt;</span><br><span class="hljs-comment"># &lt;/html&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="所有节点"><a href="#所有节点" class="headerlink" title="所有节点"></a>所有节点</h3><p>用以 <code>//</code> 开头的 <code>XPath</code> 规则来选取所有符合要求的字符串：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = html.xpath(<span class="hljs-string">&quot;//text()&quot;</span>)<br><span class="hljs-comment"># [&#x27;\n    &#x27;, &#x27;\n        &#x27;, &#x27;\n            &#x27;, &#x27;\n                &#x27;, &#x27;first item&#x27;, &#x27;\n                &#x27;, &#x27;second item&#x27;, &#x27;\n                &#x27;, &#x27;third item&#x27;, &#x27;\n</span><br><span class="hljs-comment">#       &#x27;, &#x27;fourth item&#x27;, &#x27;\n                &#x27;, &#x27;fifth item&#x27;, &#x27;\n            &#x27;, &#x27;\n        &#x27;, &#x27;\n    &#x27;, &#x27;\n&#x27;]</span><br></code></pre></div></td></tr></table></figure><h3 id="绝对路径查找"><a href="#绝对路径查找" class="headerlink" title="绝对路径查找"></a>绝对路径查找</h3><ul><li>获取某个标签的内容</li></ul><p>注意，获取<code>a</code>标签的所有内容，<code>a</code>后面就不用再加正斜杠，否则报错。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = html.xpath(<span class="hljs-string">&quot;/html/body/div/ul/li/a&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> result:<br>    <span class="hljs-built_in">print</span>(i.text)<br><br><span class="hljs-comment"># first item</span><br><span class="hljs-comment"># second item</span><br><span class="hljs-comment"># third item</span><br><span class="hljs-comment"># fourth item</span><br><span class="hljs-comment"># fifth item</span><br></code></pre></div></td></tr></table></figure><p>或者</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = html.xpath(<span class="hljs-string">&quot;/html/body/div/ul/li/a/text()&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> result:<br>    <span class="hljs-built_in">print</span>(i)<br><br>first item<br>second item<br>third item<br>fourth item<br>fifth item<br></code></pre></div></td></tr></table></figure><ul><li>打印指定路径下a标签的属性</li></ul><p>这里可以通过遍历拿到某个属性的值，查找标签的内容，通过<code>@属性名</code>获取。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = html.xpath(<span class="hljs-string">&quot;/html/body/div/ul/li/a/@href&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> result:<br>    <span class="hljs-built_in">print</span>(i)<br><br><span class="hljs-comment"># link1.html</span><br><span class="hljs-comment"># link2.html</span><br><span class="hljs-comment"># link3.html</span><br><span class="hljs-comment"># link4.html</span><br><span class="hljs-comment"># link5.html</span><br></code></pre></div></td></tr></table></figure><ul><li>获取指定标签对应属性值的内容</li></ul><p>使用<code>xpath</code>拿到得都是一个个的<code>ElementTree</code>对象，如果需要查找内容的话，还需要遍历拿到数据的列表。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = html.xpath(<span class="hljs-string">&#x27;/html/body/div/ul/li/a[@href=&quot;link3.html&quot;]/text()&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> result:<br>    <span class="hljs-built_in">print</span>(i)<br><br><span class="hljs-comment"># third item</span><br></code></pre></div></td></tr></table></figure><h2 id="相对路径查找（常用）"><a href="#相对路径查找（常用）" class="headerlink" title="相对路径查找（常用）"></a>相对路径查找（常用）</h2><ul><li>查找所有li标签下的a标签内容</li></ul><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = html.xpath(<span class="hljs-string">&#x27;//li/a/text()&#x27;</span>)<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-comment"># [&#x27;first item&#x27;, &#x27;second item&#x27;, &#x27;third item&#x27;, &#x27;fourth item&#x27;, &#x27;fifth item&#x27;]</span><br></code></pre></div></td></tr></table></figure><ul><li>查找一下l相对路径下li标签下的a标签下的href属性的值</li></ul><p>注意，<code>a</code>标签后面需要双<code>//</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = html.xpath(<span class="hljs-string">&#x27;//li/a/@href&#x27;</span>)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></div></td></tr></table></figure><ul><li>查找<code>a</code>标签下属性<code>href</code>值为<code>link5.html</code>的内容。</li></ul><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = html.xpath(<span class="hljs-string">&#x27;//li/a/@href&#x27;</span>)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></div></td></tr></table></figure><ul><li>查找<code>a</code>标签下属性<code>href</code>值为””的内容。</li></ul><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = html.xpath(<span class="hljs-string">&#x27;//li/a[@href=&quot;link5.html&quot;]/text()&#x27;</span>)<br><span class="hljs-built_in">print</span>(result)<br><br><span class="hljs-comment"># [&#x27;fifth item&#x27;]</span><br></code></pre></div></td></tr></table></figure><h2 id="子节点"><a href="#子节点" class="headerlink" title="子节点"></a>子节点</h2><p>通过 <code>/</code> 或 <code>//</code> 即可查找元素的子节点或子孙节点，选择 <code>li</code> 节点的所有直接 <code>a</code> 子节点<code>xpath</code>为：<code>//li/a</code>。</p><h2 id="父节点"><a href="#父节点" class="headerlink" title="父节点"></a>父节点</h2><p>知道子节点，查询父节点可以用 <code>..</code> 来实现。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = html.xpath(<span class="hljs-string">&#x27;//li/a[@href=&quot;link5.html&quot;]/../@class&#x27;</span>)<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-comment"># [&#x27;item-0&#x27;]</span><br></code></pre></div></td></tr></table></figure><h2 id="属性匹配"><a href="#属性匹配" class="headerlink" title="属性匹配"></a>属性匹配</h2><p>匹配时可以用<code>@</code>符号进行属性过滤，匹配<code>li</code>下属性<code>class</code>为<code>item-5</code>的内容。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = html.xpath(<span class="hljs-string">&#x27;//li/a[@href=&quot;link5.html&quot;]/../@class&#x27;</span>)<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-comment"># [&#x27;item-0&#x27;]</span><br></code></pre></div></td></tr></table></figure><h2 id="文本获取"><a href="#文本获取" class="headerlink" title="文本获取"></a>文本获取</h2><p>有两种方法：一是获取文本所在节点后直接获取文本，二是使用 <code>//</code>。第二种方法会获取到补全代码时换行产生的特殊字符，推荐使用第一种方法，可以保证获取的结果是整洁的。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># first</span><br>result = html.xpath(<span class="hljs-string">&#x27;//li[@class=&quot;item-0&quot;]/a/text()&#x27;</span>)<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-comment"># [&#x27;first item&#x27;, &#x27;fifth item&#x27;]</span><br><br><span class="hljs-comment"># second</span><br>result = html.xpath(<span class="hljs-string">&#x27;//li[@class=&quot;item-0&quot;]//text()&#x27;</span>)<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-comment"># [&#x27;first item&#x27;, &#x27;fifth item&#x27;]</span><br></code></pre></div></td></tr></table></figure><h2 id="属性获取"><a href="#属性获取" class="headerlink" title="属性获取"></a>属性获取</h2><p><code>@</code>符号相当于过滤器，可以直接获取节点的属性值。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = html.xpath(<span class="hljs-string">&#x27;//li/a/@href&#x27;</span>)<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-comment"># [&#x27;link1.html&#x27;, &#x27;link2.html&#x27;, &#x27;link3.html&#x27;, &#x27;link4.html&#x27;, &#x27;link5.html&#x27;]</span><br></code></pre></div></td></tr></table></figure><h2 id="属性多值匹配"><a href="#属性多值匹配" class="headerlink" title="属性多值匹配"></a>属性多值匹配</h2><p>某些节点的某个属性可能有多个值：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree<br><br>text = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;li class=&quot;zxc  asd  wer&quot;&gt;&lt;a href=&quot;https://s2.bdstatic.com/&quot;&gt;1 item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">&lt;li class=&quot;ddd  asd  eee&quot;&gt;&lt;a href=&quot;https://s3.bdstatic.com/&quot;&gt;2 item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>html = etree.HTML(text)<br>result = html.xpath(<span class="hljs-string">&#x27;//li[contains(@class, &quot;asd&quot;)]/a/text()&#x27;</span>)<br><span class="hljs-built_in">print</span>(result)<br><br><span class="hljs-comment"># [&#x27;1 item&#x27;, &#x27;2 item&#x27;]</span><br></code></pre></div></td></tr></table></figure><h2 id="多属性匹配"><a href="#多属性匹配" class="headerlink" title="多属性匹配"></a>多属性匹配</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree<br><br>text = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;li class=&quot;zxc  asd  wer&quot; name=&quot;222&quot;&gt;&lt;a href=&quot;https://s2.bdstatic.com/&quot;&gt;1 item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">&lt;li class=&quot;ddd  zxc  eee&quot; name=&quot;111&quot;&gt;&lt;a href=&quot;https://s3.bdstatic.com/&quot;&gt;2 item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>html = etree.HTML(text)<br>result = html.xpath(<span class="hljs-string">&#x27;//li[contains(@class, &quot;zxc&quot;) and @name=&quot;111&quot;]/a/text()&#x27;</span>)<br><span class="hljs-built_in">print</span>(result)<br><br><span class="hljs-comment"># 运行结果：[&#x27;2 item&#x27;]</span><br></code></pre></div></td></tr></table></figure><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>查找最后一个<code>li</code>标签里的<code>a</code>标签的<code>href</code>属性（<code>last()函数</code>）</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree<br><br>text = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;li class=&quot;zxc  asd  wer&quot;&gt;&lt;a href=&quot;https://s2.bdstatic.com/&quot;&gt;1 item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">&lt;li class=&quot;ddd  asd  eee&quot;&gt;&lt;a href=&quot;https://s3.bdstatic.com/&quot;&gt;2 item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>html = etree.HTML(text)<br>result = html.xpath(<span class="hljs-string">&#x27;//li[last()]/a/text()&#x27;</span>)<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-comment"># [&#x27;2 item&#x27;]</span><br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Python库</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>xpath</tag>
      
      <tag>lxml</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>优美图库抓取</title>
    <link href="/2021/06/06/%E4%BC%98%E7%BE%8E%E5%9B%BE%E5%BA%93%E6%8A%93%E5%8F%96/"/>
    <url>/2021/06/06/%E4%BC%98%E7%BE%8E%E5%9B%BE%E5%BA%93%E6%8A%93%E5%8F%96/</url>
    
    <content type="html"><![CDATA[<h2 id="抓取思路"><a href="#抓取思路" class="headerlink" title="抓取思路"></a>抓取思路</h2><p>1.拿到主页面的源代码，然后提取子页面的链接接地址，<code>href</code><br>2.通过<code>href</code>拿到子页面的内容，从子页面中找到图片的下载地址 <code>img -&gt; src</code><br>3.下载图片并保存</p><p>实现代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><br>url = <span class="hljs-string">&quot;https://www.umei.net/weimeitupian/hunshatupian/&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main_spider</span>(<span class="hljs-params">url</span>):</span><br>    resp = requests.get(url, verify=<span class="hljs-literal">False</span>)<br>    resp.encoding = <span class="hljs-string">&quot;utf-8&quot;</span><br>    <span class="hljs-comment"># print(resp.text)</span><br>    <span class="hljs-keyword">return</span> resp.text<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">content</span>):</span><br>    main_page = BeautifulSoup(content, <span class="hljs-string">&quot;html.parser&quot;</span>)<br>    a_list = main_page.find(<span class="hljs-string">&quot;div&quot;</span>, class_=<span class="hljs-string">&quot;TypeList&quot;</span>).find_all(<span class="hljs-string">&quot;a&quot;</span>)<br>    <span class="hljs-comment"># print(a_list)</span><br>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> a_list:<br>        href = <span class="hljs-string">&quot;https://www.umei.net&quot;</span> + a.get(<span class="hljs-string">&quot;href&quot;</span>)<br>        <span class="hljs-comment"># 接下来子页面源代码</span><br>        child_page_text = main_spider(href)<br>        <span class="hljs-comment"># 从子页面中获取图片的下载路径</span><br>        child_page = BeautifulSoup(child_page_text, <span class="hljs-string">&quot;html.parser&quot;</span>)<br>        image_name = child_page.find(<span class="hljs-string">&quot;h1&quot;</span>, class_=<span class="hljs-string">&quot;inline&quot;</span>).text<br>        image_href = child_page.find(<span class="hljs-string">&quot;div&quot;</span>, class_=<span class="hljs-string">&quot;ImageBody&quot;</span>).find(<span class="hljs-string">&quot;img&quot;</span>).get(<span class="hljs-string">&quot;src&quot;</span>)<br>        <span class="hljs-built_in">print</span>(image_name, image_href)<br>        <span class="hljs-comment"># 下载图片</span><br>        image_resp = requests.get(image_href).content<br>        <span class="hljs-keyword">if</span> os.path.exists(<span class="hljs-string">&quot;./images&quot;</span>) == <span class="hljs-literal">False</span>:<br>            os.mkdir(<span class="hljs-string">&quot;./images&quot;</span>)<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span> (<span class="hljs-string">&quot;./images/&quot;</span>+ image_name + <span class="hljs-string">&quot;.jpg&quot;</span>, mode=<span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>            f.write(image_resp) <span class="hljs-comment"># 图片保存到文件</span><br>        f.close()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&#123;&#125;.jpg保存成功&quot;</span>.<span class="hljs-built_in">format</span>(image_name))<br>        time.sleep(<span class="hljs-number">1</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    parse(main_spider(url))<br></code></pre></div></td></tr></table></figure><p>没有做进一步的爬取，只爬取了一个页面。</p><p>所有图片保存到文件夹<code>images</code>。</p><p><img src="Screenshot_1.webp"></p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>bs4</tag>
      
      <tag>requests</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Beautiful Soup4库</title>
    <link href="/2021/06/05/Beautiful-Soup%E5%BA%93/"/>
    <url>/2021/06/05/Beautiful-Soup%E5%BA%93/</url>
    
    <content type="html"><![CDATA[<p><code>Beautiful Soup</code> 是一个可以从<code>HTML</code>或<code>XML</code>文件中提取数据的<code>Python</code>库。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install beautifulsoup4<br></code></pre></div></td></tr></table></figure><p><code>Beautiful Soup</code>支持<code>Python</code>标准库中的<code>HTML解析器</code>,还支持一些第三方的解析器,其中一个是 <code>lxml</code> .根据操作系统不同,可以选择下列方法来安装<code>lxml</code>:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install lxml<br></code></pre></div></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>示例HTML；</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">html_doc = &quot;&quot;&quot;<br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>The Dormouse&#x27;s story<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>The Dormouse&#x27;s story<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;story&quot;</span>&gt;</span>Once upon a time there were three little sisters; and their names were<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://example.com/elsie&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sister&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;link1&quot;</span>&gt;</span>Elsie<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>,<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://example.com/lacie&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sister&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;link2&quot;</span>&gt;</span>Lacie<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> and<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://example.com/tillie&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sister&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;link3&quot;</span>&gt;</span>Tillie<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>;<br>and they lived at the bottom of a well.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;story&quot;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>&quot;&quot;&quot;<br></code></pre></div></td></tr></table></figure><p>使用<code>BeautifulSoup</code>解析这段代码,能够得到一个 <code>BeautifulSoup</code> 的对象,并能按照标准的缩进格式的结构输出:</p><p>output:</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>The Dormouse&#x27;s story<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>The Dormouse&#x27;s story<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;story&quot;</span>&gt;</span>Once upon a time there were three little sisters; and their names were<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sister&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://example.com/elsie&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;link1&quot;</span>&gt;</span>Elsie<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>,<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sister&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://example.com/lacie&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;link2&quot;</span>&gt;</span>Lacie<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> and<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sister&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://example.com/tillie&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;link3&quot;</span>&gt;</span>Tillie<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>;<br>and they lived at the bottom of a well.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;story&quot;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>几个简单的浏览结构化数据的方法:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">soup.title<br><span class="hljs-comment"># &lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;</span><br><br>soup.title.name<br><span class="hljs-comment"># u&#x27;title&#x27;</span><br><br>soup.title.string<br><span class="hljs-comment"># u&#x27;The Dormouse&#x27;s story&#x27;</span><br><br>soup.title.parent.name<br><span class="hljs-comment"># u&#x27;head&#x27;</span><br><br>soup.p<br><span class="hljs-comment"># &lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#x27;s story&lt;/b&gt;&lt;/p&gt;</span><br><br>soup.p[<span class="hljs-string">&#x27;class&#x27;</span>]<br><span class="hljs-comment"># u&#x27;title&#x27;</span><br><br>soup.a<br><span class="hljs-comment"># &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;</span><br><br>soup.find_all(<span class="hljs-string">&#x27;a&#x27;</span>)<br><span class="hljs-comment"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,</span><br><span class="hljs-comment">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;,</span><br><span class="hljs-comment">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;]</span><br><br>soup.find(<span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;link3&quot;</span>)<br><span class="hljs-comment"># &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;</span><br></code></pre></div></td></tr></table></figure><p>从文档中找到所有<a>标签的链接:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">for</span> link <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">&#x27;a&#x27;</span>):<br>    <span class="hljs-built_in">print</span>(link.get(<span class="hljs-string">&#x27;href&#x27;</span>))<br>    <span class="hljs-comment"># http://example.com/elsie</span><br>    <span class="hljs-comment"># http://example.com/lacie</span><br>    <span class="hljs-comment"># http://example.com/tillie</span><br></code></pre></div></td></tr></table></figure><p>从文档中获取所有文字内容:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(soup.get_text())<br><span class="hljs-comment"># The Dormouse&#x27;s story</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># The Dormouse&#x27;s story</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Once upon a time there were three little sisters; and their names were</span><br><span class="hljs-comment"># Elsie,</span><br><span class="hljs-comment"># Lacie and</span><br><span class="hljs-comment"># Tillie;</span><br><span class="hljs-comment"># and they lived at the bottom of a well.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ...</span><br></code></pre></div></td></tr></table></figure><h2 id="对象的种类"><a href="#对象的种类" class="headerlink" title="对象的种类"></a>对象的种类</h2><p><code>Beautiful Soup</code>将复杂<em>HTML文档</em>转换成一个复杂的树形结构,每个节点都是<em>Python对象</em>,所有对象可以归纳为4种: <code>Tag</code> , <code>NavigableString</code> , <code>BeautifulSoup</code> , <code>Comment</code> .</p><h3 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h3><p><code>Tag</code> 对象与<code>XML</code>或<code>HTML</code>原生文档中的<code>tag</code>相同:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">soup = BeautifulSoup(<span class="hljs-string">&#x27;&lt;b class=&quot;boldest&quot;&gt;hello world&lt;/b&gt;&#x27;</span>, features=<span class="hljs-string">&quot;lxml&quot;</span>)<br>tag = soup.b<br><br><span class="hljs-built_in">print</span>(tag)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(tag))<br><br><span class="hljs-comment"># &lt;b class=&quot;boldest&quot;&gt;hello world&lt;/b&gt;</span><br><span class="hljs-comment"># &lt;class &#x27;bs4.element.Tag&#x27;&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="Name"><a href="#Name" class="headerlink" title="Name"></a>Name</h3><p>每个<code>tag</code>都有自己的名字,通过 <code>.name</code> 来获取:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">tag.name<br><span class="hljs-comment"># u&#x27;b&#x27;</span><br></code></pre></div></td></tr></table></figure><p>如果改变了<code>tag</code>的<code>name</code>,那将影响所有通过当前<code>Beautiful Soup</code>对象生成的<code>HTML</code>文档:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">tag.name = <span class="hljs-string">&quot;blockquote&quot;</span><br>tag<br><span class="hljs-comment"># &lt;blockquote class=&quot;boldest&quot;&gt;Extremely bold&lt;/blockquote&gt;</span><br></code></pre></div></td></tr></table></figure><h3 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h3><p>一个<code>tag</code>可能有很多个属性<code>. tag &lt;b class=&quot;boldest&quot;&gt; </code>有一个 <code>“class”</code> 的属性,值为 <code>“boldest” . tag</code>的属性的操作方法与字典相同:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">tag[<span class="hljs-string">&#x27;class&#x27;</span>]<br><span class="hljs-comment"># u&#x27;boldest&#x27;</span><br></code></pre></div></td></tr></table></figure><p>也可以直接”点”取属性, 比如: <code>.attrs</code> :</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">tag.attrs<br><span class="hljs-comment"># &#123;u&#x27;class&#x27;: u&#x27;boldest&#x27;&#125;</span><br></code></pre></div></td></tr></table></figure><p><code>tag</code>的属性可以被添加,删除或修改. 再说一次, <code>tag</code>的属性操作方法与字典一样</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">tag[<span class="hljs-string">&#x27;class&#x27;</span>] = <span class="hljs-string">&#x27;verybold&#x27;</span><br>tag[<span class="hljs-string">&#x27;id&#x27;</span>] = <span class="hljs-number">1</span><br>tag<br><span class="hljs-comment"># &lt;blockquote class=&quot;verybold&quot; id=&quot;1&quot;&gt;Extremely bold&lt;/blockquote&gt;</span><br><br><span class="hljs-keyword">del</span> tag[<span class="hljs-string">&#x27;class&#x27;</span>]<br><span class="hljs-keyword">del</span> tag[<span class="hljs-string">&#x27;id&#x27;</span>]<br>tag<br><span class="hljs-comment"># &lt;blockquote&gt;Extremely bold&lt;/blockquote&gt;</span><br><br>tag[<span class="hljs-string">&#x27;class&#x27;</span>]<br><span class="hljs-comment"># KeyError: &#x27;class&#x27;</span><br><span class="hljs-built_in">print</span>(tag.get(<span class="hljs-string">&#x27;class&#x27;</span>))<br><span class="hljs-comment"># None</span><br></code></pre></div></td></tr></table></figure><h3 id="多值属性"><a href="#多值属性" class="headerlink" title="多值属性"></a>多值属性</h3><p>还有一些属性 <code>rel</code> , <code>rev</code> , <code>accept-charset</code> , <code>headers</code> , <code>accesskey</code> <code>.</code> 在<code>Beautiful Soup``中多值属性的返回类型是list</code>:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">css_soup = BeautifulSoup(<span class="hljs-string">&#x27;&lt;p class=&quot;body strikeout&quot;&gt;&lt;/p&gt;&#x27;</span>)<br>css_soup.p[<span class="hljs-string">&#x27;class&#x27;</span>]<br><span class="hljs-comment"># [&quot;body&quot;, &quot;strikeout&quot;]</span><br><br>css_soup = BeautifulSoup(<span class="hljs-string">&#x27;&lt;p class=&quot;body&quot;&gt;&lt;/p&gt;&#x27;</span>)<br>css_soup.p[<span class="hljs-string">&#x27;class&#x27;</span>]<br><span class="hljs-comment"># [&quot;body&quot;]</span><br></code></pre></div></td></tr></table></figure><p>如果某个属性看起来好像有多个值,但在任何版本的<code>HTML</code>定义中都没有被定义为多值属性,那么<code>Beautiful Soup</code>会将这个属性作为字符串返回。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">id_soup = BeautifulSoup(<span class="hljs-string">&#x27;&lt;p id=&quot;my id&quot;&gt;&lt;/p&gt;&#x27;</span>)<br>id_soup.p[<span class="hljs-string">&#x27;id&#x27;</span>]<br><span class="hljs-comment"># &#x27;my id&#x27;</span><br></code></pre></div></td></tr></table></figure><p>将<code>tag</code>转换成字符串时,多值属性会合并为一个值。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">rel_soup = BeautifulSoup(<span class="hljs-string">&#x27;&lt;p&gt;Back to the &lt;a rel=&quot;index&quot;&gt;homepage&lt;/a&gt;&lt;/p&gt;&#x27;</span>)<br>rel_soup.a[<span class="hljs-string">&#x27;rel&#x27;</span>]<br><span class="hljs-comment"># [&#x27;index&#x27;]</span><br>rel_soup.a[<span class="hljs-string">&#x27;rel&#x27;</span>] = [<span class="hljs-string">&#x27;index&#x27;</span>, <span class="hljs-string">&#x27;contents&#x27;</span>]<br><span class="hljs-built_in">print</span>(rel_soup.p)<br><span class="hljs-comment"># &lt;p&gt;Back to the &lt;a rel=&quot;index contents&quot;&gt;homepage&lt;/a&gt;&lt;/p&gt;</span><br></code></pre></div></td></tr></table></figure><p>如果转换的文档是<code>XML</code>格式,那么<code>tag</code>中不包含多值属性</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">xml_soup = BeautifulSoup(<span class="hljs-string">&#x27;&lt;p class=&quot;body strikeout&quot;&gt;&lt;/p&gt;&#x27;</span>, <span class="hljs-string">&#x27;xml&#x27;</span>)<br>xml_soup.p[<span class="hljs-string">&#x27;class&#x27;</span>]<br><span class="hljs-comment"># u&#x27;body strikeout&#x27;</span><br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Python库</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>bs4</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>re正则表达式操作</title>
    <link href="/2021/06/04/re%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%93%8D%E4%BD%9C/"/>
    <url>/2021/06/04/re%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<p><code>Regular Expression</code>，正则表达式，使用表达式的方式对字符串进行匹配的语法规则。</p><h2 id="正则表达式语法"><a href="#正则表达式语法" class="headerlink" title="正则表达式语法"></a>正则表达式语法</h2><p>一个<em>正则表达式</em>指定了一集与之匹配的字符串；模块内的函数可以让你检查某个字符串是否跟给定的正则表达式匹配。</p><p>要看正则写得对不对，可以去<a href="https://tool.oschina.net/regex/">测试网站</a>测试匹配结果。</p><p>首先了解<code>元字符</code>的概念：<em>具有固定含义的特殊符号</em>。</p><p>特殊字符有：</p><figure class="highlight livescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livescript"> .    <br> (点) 在默认模式，匹配**除了换行的任意字符**。<br><br> ^    <br> (插入符号) 匹配字符串的**开头**。<br><br> $    <br> 匹配**字符串尾或者在字符串尾的换行符的前一个字符**。在 *MULTILINE* 模式下也会匹配换行符之前的文本。<br><br> *    <br> 对它前面的正则式匹配**<span class="hljs-number">0</span>到任意次重复**，尽量多的匹配字符串。 ab* 会匹配 a，ab，或者 a 后面跟随任意个 b。<br><br> +    <br> 对它前面的正则式匹配**<span class="hljs-number">1</span>到任意次重复**。ab+ 会匹配 a 后面跟随<span class="hljs-number">1</span>个以上到任意个 b，它不会匹配 a。<br><br> ?    <br> 对它前面的正则式匹配**<span class="hljs-number">0</span>到<span class="hljs-number">1</span>次重复**。 ab? 会匹配 a 或者 ab。<br><br> *?, +?, ??    <br> <span class="hljs-string">\*,</span> +，和 ? 修饰符都是 **贪婪的**；它们在字符串进行尽可能多的匹配。如果正则式 &lt;.*&gt; 希望找到 &lt;a&gt; b &lt;c&gt;，它将会匹配整个字符串，而不仅是 &lt;a&gt;。在修饰符之后添加 ? 将使样式以 非贪婪 方式进行匹配； 尽量 **少** 的字符将会被匹配。使用正则式 &lt;.*?&gt; 将会仅仅匹配 &lt;a&gt;。<br><br> &#123;m&#125;    <br> 对其之前的正则式指定匹配 m 个重复；少于 m 的话就会导致匹配失败。比如， a&#123;<span class="hljs-number">6</span>&#125; 将匹配<span class="hljs-number">6</span>个 a , 但是不能是<span class="hljs-number">5</span>个。<br><br> &#123;m,n&#125;    <br> 对正则式进行 m 到 n 次匹配，在 m 和 n 之间取尽量多。 比如，a&#123;<span class="hljs-number">3</span>,<span class="hljs-number">5</span>&#125; 将匹配 <span class="hljs-number">3</span> 到<span class="hljs-number">5</span>个 a。忽略 m 意为指定下界为<span class="hljs-number">0</span>，忽略 n 指定上界为无限次。比如 a&#123;<span class="hljs-number">4</span>,&#125;b 将匹配 aaaab 或者<span class="hljs-number">1000</span>个 a 尾随一个 b，但不能匹配 aaab。逗号不能省略，否则无法辨别修饰符应该忽略哪个边界。<br><br> &#123;m,n&#125;?    <br> 前一个修饰符的非贪婪模式，只匹配尽量少的字符次数。比如，对于 aaaaaa， a&#123;<span class="hljs-number">3</span>,<span class="hljs-number">5</span>&#125; 匹配<span class="hljs-number">5</span>个 a ，而 a&#123;<span class="hljs-number">3</span>,<span class="hljs-number">5</span>&#125;? 只匹配<span class="hljs-number">3</span>个 a。<br><br> <span class="hljs-string">\</span>    <br> 转义特殊字符（允许你匹配 <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>, 或者此类其他），或者表示一个特殊序列；<br><br> []<br> 用于表示一个字符集合。在一个集合中：<br>    - 字符可以单独列出，比如 [amk] 匹配 <span class="hljs-string">&#x27;a&#x27;</span>， <span class="hljs-string">&#x27;m&#x27;</span>， 或者 <span class="hljs-string">&#x27;k&#x27;</span>。<br>    - 可以表示字符范围，通过用 <span class="hljs-string">&#x27;-&#x27;</span> 将两个字符连起来。比如 [a-z] 将匹配任何小写ASCII字符， [<span class="hljs-number">0</span>-<span class="hljs-number">5</span>][<span class="hljs-number">0</span>-<span class="hljs-number">9</span>] 将匹配从 <span class="hljs-number">00</span> 到 <span class="hljs-number">59</span> 的两位数字， [<span class="hljs-number">0</span>-<span class="hljs-number">9</span>A-Fa-f] 将匹配任何十六进制数位。<br>    - 不在集合范围内的字符可以通过 取反 来进行匹配。如果集合首字符是 <span class="hljs-string">&#x27;^&#x27;</span> ，所有 不 在集合内的字符将会被匹配，比如 [^<span class="hljs-number">5</span>] 将匹配所有字符，除了 <span class="hljs-string">&#x27;5&#x27;</span>， [^^] 将匹配所有字符，除了 <span class="hljs-string">&#x27;^&#x27;</span>. ^ 如果不在集合首位，就没有特殊含义。<br>    - 在集合内要匹配一个字符 <span class="hljs-string">&#x27;]&#x27;</span>，有两种方法，要么就在它之前加上反斜杠，要么就把它放到集合首位。比如， [()[<span class="hljs-string">\]&#123;&#125;]</span> 和 []()[&#123;&#125;] 都可以匹配括号。<br><br>|<br>A|B， A 和 B 可以是任意正则表达式，创建一个正则表达式，匹配 A 或者 B. 任意个正则表达式可以用 <span class="hljs-string">&#x27;|&#x27;</span> 连接。它也可以在组合（见下列）内使用。扫描目标字符串时， <span class="hljs-string">&#x27;|&#x27;</span> 分隔开的正则样式从左到右进行匹配。当一个样式完全匹配时，这个分支就被接受。意思就是，一旦 A 匹配成功， B 就不再进行匹配，即便它能产生一个更好的匹配。或者说，<span class="hljs-string">&#x27;|&#x27;</span> 操作符绝不贪婪。 如果要匹配 <span class="hljs-string">&#x27;|&#x27;</span> 字符，使用 <span class="hljs-string">\|，</span> 或者把它包含在字符集里，比如 [|].<br><br>(...)    <br>（组合），匹配括号内的任意正则表达式，并标识出组合的开始和结尾。匹配完成后，组合的内容可以被获取，并可以在之后用 <span class="hljs-string">\number</span> 转义序列进行再次匹配，之后进行详细说明。要匹配字符 <span class="hljs-string">&#x27;(&#x27;</span> 或者 <span class="hljs-string">&#x27;)&#x27;</span>, 用 <span class="hljs-string">\(</span> 或 <span class="hljs-string">\),</span> 或者把它们包含在字符集合里: [(], [)].<br><br><span class="hljs-string">\A</span><br>只匹配字符串开始。<br> <br><span class="hljs-string">\b</span><br>匹配空字符串，但只在单词开始或结尾的位置。一个单词被定义为一个单词字符的序列。注意，通常 <span class="hljs-string">\b</span> 定义为 <span class="hljs-string">\w</span> 和 <span class="hljs-string">\W</span> 字符之间，或者 <span class="hljs-string">\w</span> 和字符串开始/结尾的边界， 意思就是 r<span class="hljs-string">&#x27;\bfoo\b&#x27;</span> 匹配 <span class="hljs-string">&#x27;foo&#x27;</span>, <span class="hljs-string">&#x27;foo.&#x27;</span>, <span class="hljs-string">&#x27;(foo)&#x27;</span>, <span class="hljs-string">&#x27;bar foo baz&#x27;</span> 但不匹配 <span class="hljs-string">&#x27;foobar&#x27;</span> 或者 <span class="hljs-string">&#x27;foo3&#x27;</span>。<br><br><span class="hljs-string">\B</span><br>匹配空字符串，但 不 能在词的开头或者结尾。意思就是 r<span class="hljs-string">&#x27;py\B&#x27;</span> 匹配 <span class="hljs-string">&#x27;python&#x27;</span>, <span class="hljs-string">&#x27;py3&#x27;</span>, <span class="hljs-string">&#x27;py2&#x27;</span>, 但不匹配 <span class="hljs-string">&#x27;py&#x27;</span>, <span class="hljs-string">&#x27;py.&#x27;</span>, 或者 <span class="hljs-string">&#x27;py!&#x27;</span>. <span class="hljs-string">\B</span> 是 <span class="hljs-string">\b</span> 的取非，所以Unicode样式的词语是由Unicode字母，数字或下划线构成的，虽然可以用 ASCII 标志来改变。如果使用了 LOCALE 标志，则词的边界由当前语言区域设置。<br><br><span class="hljs-string">\d</span><br>对于 Unicode (str) 样式：<br>匹配任何Unicode十进制数（就是在Unicode字符目录[Nd]里的字符）。这包括了 [<span class="hljs-number">0</span>-<span class="hljs-number">9</span>] ，和很多其他的数字字符。如果设置了 ASCII 标志，就只匹配 [<span class="hljs-number">0</span>-<span class="hljs-number">9</span>] 。<br><br>对于<span class="hljs-number">8</span>位(bytes)样式：<br>匹配任何十进制数，就是 [<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]。<br><br><span class="hljs-string">\D</span><br>匹配任何非十进制数字的字符。就是 <span class="hljs-string">\d</span> 取非。 如果设置了 ASCII 标志，就相当于 [^<span class="hljs-number">0</span>-<span class="hljs-number">9</span>] 。<br><br><span class="hljs-string">\s</span><br>对于 Unicode (str) 样式：<br>匹配任何Unicode空白字符（包括 [ <span class="hljs-string">\t\n\r\f\v]</span> ，还有很多其他字符，比如不同语言排版规则约定的不换行空格）。如果 ASCII 被设置，就只匹配 [ <span class="hljs-string">\t\n\r\f\v]</span> 。<br><br>对于<span class="hljs-number">8</span>位(bytes)样式：<br>匹配ASCII中的空白字符，就是 [ <span class="hljs-string">\t\n\r\f\v]</span> 。<br><br><span class="hljs-string">\S</span><br>匹配任何非空白字符。就是 <span class="hljs-string">\s</span> 取非。如果设置了 ASCII 标志，就相当于 [^ <span class="hljs-string">\t\n\r\f\v]</span> 。<br><br><span class="hljs-string">\w</span><br>对于 Unicode (str) 样式：<br>匹配Unicode词语的字符，包含了可以构成词语的绝大部分字符，也包括数字和下划线。如果设置了 ASCII 标志，就只匹配 [a-zA-Z0-<span class="hljs-number">9_</span>] 。<br><br>对于<span class="hljs-number">8</span>位(bytes)样式：<br>匹配ASCII字符中的数字和字母和下划线，就是 [a-zA-Z0-<span class="hljs-number">9_</span>] 。如果设置了 LOCALE 标记，就匹配当前语言区域的数字和字母和下划线。<br><br><span class="hljs-string">\W</span><br>匹配非单词字符的字符。这与 <span class="hljs-string">\w</span> 正相反。如果使用了 ASCII 旗标，这就等价于 [^a-zA-Z0-<span class="hljs-number">9_</span>]。如果使用了 LOCALE 旗标，则会匹配当前区域中既非字母数字也非下划线的字符。<br><br><span class="hljs-string">\Z</span><br>只匹配字符串尾。<br></code></pre></div></td></tr></table></figure><h2 id="模块内容"><a href="#模块内容" class="headerlink" title="模块内容"></a>模块内容</h2><p>模块定义了几个函数，常量，和一个例外。</p><h3 id="re-compile"><a href="#re-compile" class="headerlink" title="re.compile"></a>re.compile</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">re.<span class="hljs-built_in">compile</span>(pattern, flags=<span class="hljs-number">0</span>)<br></code></pre></div></td></tr></table></figure><p><code>re.compile</code>将正则表达式的样式编译为一个 <code>正则表达式对象（正则对象</code>），可以用于匹配，通过这个对象的方法<code> match()</code>, <code>search()</code> 。</p><p>比如：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br>prog = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">&#x27;^a&#x27;</span>)<br>result = prog.match(<span class="hljs-string">&quot;abcd&quot;</span>)<br><span class="hljs-built_in">print</span>(result)<br><br>result = re.match(<span class="hljs-string">&#x27;^a&#x27;</span>, <span class="hljs-string">&quot;abcd&quot;</span>)<br><span class="hljs-built_in">print</span>(result)<br><br><span class="hljs-comment"># output</span><br><span class="hljs-comment"># &lt;re.Match object; span=(0, 1), match=&#x27;a&#x27;&gt;</span><br><span class="hljs-comment"># &lt;re.Match object; span=(0, 1), match=&#x27;a&#x27;&gt;</span><br></code></pre></div></td></tr></table></figure><p>使用 <code>re.compile()</code> 保存正则对象以便复用，可以让程序更加高效。</p><h3 id="re-match"><a href="#re-match" class="headerlink" title="re.match"></a>re.match</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">re.match(pattern, string, flags=<span class="hljs-number">0</span>)<br></code></pre></div></td></tr></table></figure><p>如果 <code>string</code> 开始的0或者多个字符匹配到了正则表达式样式，就返回一个相应的 <code>匹配对象</code> 。 如果没有匹配，就返回 <code>None</code> ；注意它跟零长度匹配是不同的。</p><h3 id="re-search"><a href="#re-search" class="headerlink" title="re.search"></a>re.search</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">re.search(pattern, string, flags=<span class="hljs-number">0</span>)<br></code></pre></div></td></tr></table></figure><p>扫描整个 <code>字符串</code> 找到匹配样式的第一个位置，并返回一个相应的 <code>匹配对象</code> 。如果没有匹配，就返回一个 <code>None</code> ；</p><h3 id="re-split"><a href="#re-split" class="headerlink" title="re.split"></a>re.split</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">re.split(pattern, string, maxsplit=<span class="hljs-number">0</span>, flags=<span class="hljs-number">0</span>)<br></code></pre></div></td></tr></table></figure><p>用 <code>pattern</code> 分开 <code>string</code> 。 如果在 <code>pattern</code> 中捕获到括号，那么所有的组里的文字也会包含在列表里。如果 <code>maxsplit</code> 非零， 最多进行 <code>maxsplit</code> 次分隔， 剩下的字符全部返回到列表的最后一个元素。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>re.split(<span class="hljs-string">r&#x27;\W+&#x27;</span>, <span class="hljs-string">&#x27;Words, words, words.&#x27;</span>)<br>[<span class="hljs-string">&#x27;Words&#x27;</span>, <span class="hljs-string">&#x27;words&#x27;</span>, <span class="hljs-string">&#x27;words&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>re.split(<span class="hljs-string">r&#x27;(\W+)&#x27;</span>, <span class="hljs-string">&#x27;Words, words, words.&#x27;</span>)<br>[<span class="hljs-string">&#x27;Words&#x27;</span>, <span class="hljs-string">&#x27;, &#x27;</span>, <span class="hljs-string">&#x27;words&#x27;</span>, <span class="hljs-string">&#x27;, &#x27;</span>, <span class="hljs-string">&#x27;words&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>re.split(<span class="hljs-string">r&#x27;\W+&#x27;</span>, <span class="hljs-string">&#x27;Words, words, words.&#x27;</span>, <span class="hljs-number">1</span>)<br>[<span class="hljs-string">&#x27;Words&#x27;</span>, <span class="hljs-string">&#x27;words, words.&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>re.split(<span class="hljs-string">&#x27;[a-f]+&#x27;</span>, <span class="hljs-string">&#x27;0a3B9&#x27;</span>, flags=re.IGNORECASE)<br>[<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;9&#x27;</span>]<br></code></pre></div></td></tr></table></figure><h3 id="re-findall"><a href="#re-findall" class="headerlink" title="re.findall"></a>re.findall</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">re.findall(pattern, string, flags=<span class="hljs-number">0</span>)<br></code></pre></div></td></tr></table></figure><p>对 <code>string</code> 返回一个不重复的 <code>pattern</code> 的匹配列表， <code>string</code> 从左到右进行扫描，匹配按找到的顺序返回。如果样式里存在一到多个组，就返回一个组合列表；就是一个元组的列表（如果样式里有超过一个组合的话）。空匹配也会包含在结果里。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br>partern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;\d+&quot;</span>)<br><br>res = partern.findall(<span class="hljs-string">&quot;我的电话号码是1760718283，你的电话是110吗？&quot;</span>)<br><span class="hljs-built_in">print</span>(res)<br><br><span class="hljs-comment"># [&#x27;1760718283&#x27;, &#x27;110&#x27;]</span><br></code></pre></div></td></tr></table></figure><h3 id="re-finditer"><a href="#re-finditer" class="headerlink" title="re.finditer"></a>re.finditer</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">re.finditer(pattern, string, flags=<span class="hljs-number">0</span>)<br></code></pre></div></td></tr></table></figure><p><code>pattern</code> 在 <code>string</code> 里所有的非重复匹配，返回为一个迭代器 <code>iterator</code> 保存了 匹配对象 。 string 从左到右扫描，匹配按顺序排列。空匹配也包含在结果里。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br>partern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;\d+&quot;</span>)<br><br>res = partern.finditer(<span class="hljs-string">&quot;我的电话号码是1760718283，你的电话是110吗？&quot;</span>)<br><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> res:<br>    <span class="hljs-built_in">print</span>(item.group())<br><br><span class="hljs-comment"># output</span><br><span class="hljs-comment"># 1760718283</span><br><span class="hljs-comment"># 110</span><br></code></pre></div></td></tr></table></figure><h2 id="匹配对象"><a href="#匹配对象" class="headerlink" title="匹配对象"></a>匹配对象</h2><p>匹配对象总是有一个布尔值 <code>True</code>。如果没有匹配的话 <code>match()</code> 和 <code>search()</code> 返回 <code>None</code> 所以你可以简单的用 <code>if</code> 语句来判断是否匹配</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">match = re.search(pattern, string)<br><span class="hljs-keyword">if</span> match:<br>    process(match)<br></code></pre></div></td></tr></table></figure><p>匹配对象支持以下方法和属性：</p><h3 id="Match-group"><a href="#Match-group" class="headerlink" title="Match.group"></a>Match.group</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Match.group([group1, ...])<br></code></pre></div></td></tr></table></figure><p>返回一个或者多个匹配的子组。如果只有一个参数，结果就是一个字符串，如果有多个参数，结果就是一个元组（每个参数对应一个项），如果没有参数，组1默认到0（整个匹配都被返回）。如果一个组N 参数值为 0，相应的返回值就是整个匹配字符串；如果它是一个范围 [1..99]，结果就是相应的括号组字符串。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br>match = re.match(<span class="hljs-string">r&quot;(\w+) (\w+)&quot;</span>, <span class="hljs-string">&quot;Hello World, heyhey!&quot;</span>)<br><span class="hljs-built_in">print</span>(match)    <span class="hljs-comment"># &lt;re.Match object; span=(0, 11), match=&#x27;Hello World&#x27;&gt;</span><br><br><span class="hljs-built_in">print</span>(match.group())   <span class="hljs-comment"># Hello World</span><br><span class="hljs-built_in">print</span>(match.group(<span class="hljs-number">0</span>))   <span class="hljs-comment"># Hello World</span><br><span class="hljs-built_in">print</span>(match.group(<span class="hljs-number">1</span>))   <span class="hljs-comment"># Hello</span><br><span class="hljs-built_in">print</span>(match.group(<span class="hljs-number">2</span>))   <span class="hljs-comment"># World</span><br></code></pre></div></td></tr></table></figure><p>如果正则表达式使用了 <code>(?P&lt;name&gt;…)</code> 语法， <code>groupN</code> 参数就也可能是命名组合的名字。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>m = re.match(<span class="hljs-string">r&quot;(?P&lt;first_name&gt;\w+) (?P&lt;last_name&gt;\w+)&quot;</span>, <span class="hljs-string">&quot;Malcolm Reynolds&quot;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>m.group(<span class="hljs-string">&#x27;first_name&#x27;</span>)<br><span class="hljs-string">&#x27;Malcolm&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>m.group(<span class="hljs-string">&#x27;last_name&#x27;</span>)<br><span class="hljs-string">&#x27;Reynolds&#x27;</span><br><br></code></pre></div></td></tr></table></figure><p>命名组合同样可以通过索引值引用。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>m.group(<span class="hljs-number">1</span>)<br><span class="hljs-string">&#x27;Malcolm&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>m.group(<span class="hljs-number">2</span>)<br><span class="hljs-string">&#x27;Reynolds&#x27;</span><br></code></pre></div></td></tr></table></figure><p>如果一个组匹配成功多次，就只返回最后一个匹配。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>m = re.match(<span class="hljs-string">r&quot;(..)+&quot;</span>, <span class="hljs-string">&quot;a1b2c3&quot;</span>)  <span class="hljs-comment"># Matches 3 times.</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>m.group(<span class="hljs-number">1</span>)                        <span class="hljs-comment"># Returns only the last match.</span><br><span class="hljs-string">&#x27;c3&#x27;</span><br></code></pre></div></td></tr></table></figure><h3 id="Match-groups"><a href="#Match-groups" class="headerlink" title="Match.groups"></a>Match.groups</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Match.groups(default=<span class="hljs-literal">None</span>)<br></code></pre></div></td></tr></table></figure><p>返回一个元组，包含所有匹配的子组，在样式中出现的从1到任意多的组合。 <code>default</code> 参数用于不参与匹配的情况，默认为 <code>None</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br>match = re.match(<span class="hljs-string">r&quot;(\w+) (\w+)&quot;</span>, <span class="hljs-string">&quot;Hello World, heyhey!&quot;</span>)<br><span class="hljs-built_in">print</span>(match)    <span class="hljs-comment"># &lt;re.Match object; span=(0, 11), match=&#x27;Hello World&#x27;&gt;</span><br><br><span class="hljs-built_in">print</span>(match.groups())   <span class="hljs-comment"># (&#x27;Hello&#x27;, &#x27;World&#x27;)</span><br></code></pre></div></td></tr></table></figure><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Python库</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>re</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>经典豆瓣TOP250爬取</title>
    <link href="/2021/06/04/%E7%BB%8F%E5%85%B8%E8%B1%86%E7%93%A3TOP250%E7%88%AC%E5%8F%96/"/>
    <url>/2021/06/04/%E7%BB%8F%E5%85%B8%E8%B1%86%E7%93%A3TOP250%E7%88%AC%E5%8F%96/</url>
    
    <content type="html"><![CDATA[<h2 id="经典案例"><a href="#经典案例" class="headerlink" title="经典案例"></a>经典案例</h2><p>每个学习爬虫的人都爬过的豆瓣电影TOP250，先看下<a href="https://movie.douban.com/top250">长什么样</a>。</p><p><img src="Screenshot_1.webp"></p><p>开爬。</p><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>查看源代码，所有的数据都在页面源代码中，直接用requests请求拿过来页面源代码，再通过re匹配即可。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> csv<br><span class="hljs-keyword">import</span> codecs<br><br><span class="hljs-comment"># 要抓取的目标网址，豆瓣电影TOP250</span><br>BASE_URL = <span class="hljs-string">&quot;https://movie.douban.com/top250&quot;</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">request</span>(<span class="hljs-params">url</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;获取页面源代码</span><br><span class="hljs-string">        url: 目标网址</span><br><span class="hljs-string">        return: 页面源码&quot;&quot;&quot;</span><br>    headers = &#123;<br>        <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.77 Safari/537.36 Edg/91.0.864.37&quot;</span><br>    &#125;<br>    response = requests.get(url=url, headers=headers)<br>    page_content = response.text<br>    <span class="hljs-keyword">return</span> page_content<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">page_content</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;解析页面&quot;&quot;&quot;</span><br>    partern = re.<span class="hljs-built_in">compile</span>(<br>        <span class="hljs-string">r&#x27;&lt;li&gt;.*?&lt;div class=&quot;item&quot;&gt;.*?&lt;img width=&quot;100&quot;.*?src=&quot;(?P&lt;image_url&gt;.*?)&quot;&#x27;</span><br>        <span class="hljs-string">r&#x27;.*?&lt;span class=&quot;title&quot;&gt;(?P&lt;name&gt;.*?)&#x27;</span><br>        <span class="hljs-string">r&#x27;&lt;/span&gt;.*?&lt;p class=&quot;&quot;&gt;.*?&lt;br&gt;(?P&lt;year&gt;.*?)&amp;nbsp.*?&lt;span class=&quot;rating_num&quot; property=&quot;v:average&quot;&gt;(?P&lt;score&gt;.*?)&lt;/span&gt;.*?&#x27;</span><br>        <span class="hljs-string">r&#x27;&lt;span&gt;(?P&lt;number&gt;.*?)人评价&lt;/span&gt;&#x27;</span>, re.S)<br><br>    parse_result = partern.finditer(page_content)<br>    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> parse_result:<br>        <span class="hljs-comment"># print(item.group(&quot;name&quot;))</span><br>        <span class="hljs-comment"># print(item.group(&quot;year&quot;).strip())</span><br>        <span class="hljs-comment"># print(item.group(&quot;score&quot;))</span><br>        <span class="hljs-comment"># print(item.group(&quot;number&quot;))</span><br>        <span class="hljs-comment"># print(item.group(&quot;image_url&quot;))</span><br>        dic = item.groupdict()<br>        dic[<span class="hljs-string">&#x27;year&#x27;</span>] = dic[<span class="hljs-string">&#x27;year&#x27;</span>].strip()<br>        csv_writer(<span class="hljs-string">&quot;data.csv&quot;</span>, dic.values())<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">csv_writer</span>(<span class="hljs-params">filename: <span class="hljs-built_in">str</span>, value: <span class="hljs-built_in">object</span></span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;csv写入函数&quot;&quot;&quot;</span><br>    f = codecs.<span class="hljs-built_in">open</span>(filename, mode=<span class="hljs-string">&quot;a&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    csvwriter = csv.writer(f)<br>    csvwriter.writerow(value)<br>    f.close()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        target_url = BASE_URL + <span class="hljs-string">&#x27;?start=&#123;&#125;&amp;filter=&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">str</span>(i * <span class="hljs-number">25</span>))<br>        <span class="hljs-comment"># print(target_url)</span><br>        page_content = request(target_url)<br>        parse(page_content)<br></code></pre></div></td></tr></table></figure><p>保存到data.csv</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csv">https://img2.doubanio.com/view/photo/s_ratio_poster/public/p480747492.jpg,肖申克的救赎,1994,9.7,2363296<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2561716440.jpg,霸王别姬,1993,9.6,1759688<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2372307693.jpg,阿甘正传,1994,9.5,1780693<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p511118051.jpg,这个杀手不太冷,1994,9.4,1953794<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p457760035.jpg,泰坦尼克号,1997,9.4,1741778<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2578474613.jpg,美丽人生,1997,9.6,1094798<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2557573348.jpg,千与千寻,2001,9.4,1857168<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p492406163.jpg,辛德勒的名单,1993,9.5,908938<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2616355133.jpg,盗梦空间,2010,9.3,1717903<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p524964039.jpg,忠犬八公的故事,2009,9.4,1180113<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2614988097.jpg,星际穿越,2014,9.3,1390653<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p479682972.jpg,楚门的世界,1998,9.3,1307123<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2574551676.jpg,海上钢琴师,1998,9.3,1395475<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p579729551.jpg,三傻大闹宝莱坞,2009,9.2,1568001<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1461851991.jpg,机器人总动员,2008,9.3,1103099<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1910824951.jpg,放牛班的春天,2004,9.3,1087370<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2564556863.jpg,无间道,2002,9.3,1058718<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2614500649.jpg,疯狂动物城,2016,9.2,1535791<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2455050536.jpg,大话西游之大圣娶亲,1995,9.2,1270103<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1363250216.jpg,熔炉,2011,9.3,770798<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p616779645.jpg,教父,1972,9.3,772761<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2614359276.jpg,当幸福来敲门,2006,9.1,1260649<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2540924496.jpg,龙猫,1988,9.2,1051778<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p501177648.jpg,怦然心动,2010,9.1,1492708<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1505392928.jpg,控方证人,1957,9.6,371278<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1454261925.jpg,触不可及,2011,9.3,828170<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p462657443.jpg,蝙蝠侠：黑暗骑士,2008,9.2,861486<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p452089833.jpg,末代皇帝,1987,9.3,665966<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2614500706.jpg,寻梦环游记,2017,9.1,1307556<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2524040532.jpg,活着,1994,9.3,669518<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2642829472.jpg,指环王3：王者无敌,2003,9.2,653616<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1963126880.jpg,乱世佳人,1939,9.3,567787<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2555295759.jpg,何以为家,2018,9.1,830389<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2614949805.jpg,哈利·波特与魔法石,2001,9.1,882053<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p485887754.jpg,飞屋环游记,2009,9.0,1098265<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2118532944.jpg,素媛,2013,9.3,544710<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2401676338.jpg,摔跤吧！爸爸,2016,9.0,1298769<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1784592701.jpg,少年派的奇幻漂流,2012,9.1,1148125<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2173577632.jpg,十二怒汉,1957,9.4,381454<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2174346180.jpg,哈尔的移动城堡,2004,9.1,819033<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2553104888.jpg,鬼子来了,2000,9.3,508031<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2561305376.jpg,我不是药神,2018,9.0,1726641<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2561721372.jpg,大话西游之月光宝盒,1995,9.0,1011850<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1446261379.jpg,天空之城,1986,9.1,689301<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2550757929.jpg,闻香识女人,1992,9.1,706224<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2189265085.jpg,罗马假日,1953,9.0,800710<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2640236255.jpg,指环王2：双塔奇兵,2002,9.1,609036<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p453924541.jpg,猫鼠游戏,2002,9.1,734119<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2653054340.jpg,天堂电影院,1988,9.2,525154<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2158166535.jpg,辩护人,2013,9.2,500175<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2640234840.jpg,指环王1：护戒使者,2001,9.1,693680<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2184505167.jpg,大闹天宫,1961(中国大陆) / 1964(中国大陆) / 1978(中国大陆) / 2004(中国大陆),9.4,340208<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p792376093.jpg,钢琴家,2002,9.2,457919<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2277799019.jpg,狮子王,1994,9.1,679213<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2194138787.jpg,教父2,1974,9.2,433973<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2575465690.jpg,死亡诗社,1989,9.1,571996<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910926158.jpg,搏击俱乐部,1999,9.0,704145<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p451926968.jpg,黑客帝国,1999,9.0,659879<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1512562287.jpg,让子弹飞,2010,8.9,1337990<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2549177902.jpg,绿皮书,2018,8.9,1284278<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1910899751.jpg,饮食男女,1994,9.1,485412<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1665997400.jpg,美丽心灵,2001,9.0,625114<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2554525534.jpg,海蒂和爷爷,2015,9.2,377506<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1808872109.jpg,窃听风暴,2006,9.2,462123<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p792443418.jpg,两杆大烟枪,1998,9.1,498097<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2192535722.jpg,本杰明·巴顿奇事,2008,8.9,811159<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2648230660.jpg,情书,1995,8.9,820384<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2498971355.jpg,看不见的客人,2016,8.8,998583<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p792238287.jpg,飞越疯人院,1975,9.1,473438<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1473670352.jpg,穿条纹睡衣的男孩,2008,9.1,425919<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2441988159.jpg,西西里的美丽传说,2000,8.9,801233<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1014542496.jpg,拯救大兵瑞恩,1998,9.0,530981<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2165511465.jpg,小鞋子,1997,9.2,333521<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p453788577.jpg,音乐之声,1965,9.1,491814<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2634997853.jpg,阿凡达,2009,8.8,1160560<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2559579779.jpg,海豚湾,2009,9.3,311697<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p480383375.jpg,致命魔术,2006,8.9,706971<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p477229647.jpg,美国往事,1984,9.2,340334<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1593414327.jpg,沉默的羔羊,1991,8.9,702654<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1832875827.jpg,禁闭岛,2010,8.8,779670<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2209066019.jpg,蝴蝶效应,2004,8.8,765655<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1910902213.jpg,低俗小说,1994,8.9,682056<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p480965695.jpg,心灵捕手,1997,8.9,577385<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2178872593.jpg,布达佩斯大饭店,2014,8.9,731182<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2219586434.jpg,七宗罪,1995,8.8,794001<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p465939041.jpg,春光乍泄,1997,8.9,515164<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p917846733.jpg,哈利·波特与死亡圣器(下),2011,8.9,639906<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2263408369.jpg,摩登时代,1936,9.3,237607<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p884763596.jpg,被嫌弃的松子的一生,2006,8.9,602295<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2579932167.jpg,喜剧之王,1999,8.8,788367<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2558364386.jpg,致命ID,2003,8.8,657787<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p657823840.jpg,杀人回忆,2003,8.9,557770<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1596085504.jpg,加勒比海盗,2003,8.8,715622<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p480956937.jpg,剪刀手爱德华,1990,8.7,898594<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2004174709.jpg,勇敢的心,1995,8.9,490782<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1546987967.jpg,狩猎,2012,9.1,306982<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2505525050.jpg,请以你的名字呼唤我,2017,8.9,557338<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p456825720.jpg,红辣椒,2006,9.0,349004<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2604889017.jpg,断背山,2005,8.8,600191<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1816276065.jpg,7号房的礼物,2013,8.9,446140<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2447590313.jpg,天使爱美丽,2001,8.7,848389<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1613191025.jpg,幽灵公主,1997,8.9,442085<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2564498893.jpg,小森林 夏秋篇,2014,9.0,349196<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2220184425.jpg,第六感,1999,8.9,451081<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2564685215.jpg,阳光灿烂的日子,1994,8.8,511391<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p792381411.jpg,重庆森林,1994,8.8,652297<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1305562621.jpg,超脱,2011,8.9,408428<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2219011938.jpg,功夫,2004,8.7,839875<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2357915564.jpg,唐伯虎点秋香,1993,8.7,864732<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2555762374.jpg,爱在黎明破晓前,1995,8.8,512829<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2544912792.jpg,人生果实,2017,9.5,139445<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2215147728.jpg,小森林 冬春篇,2015,9.0,313078<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2567845803.jpg,一一,2000,9.1,293722<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1706428744.jpg,蝙蝠侠：黑暗骑士崛起,2012,8.8,589732<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2620392435.jpg,菊次郎的夏天,1999,8.8,470519<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2635433927.jpg,入殓师,2008,8.9,483243<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2221768894.jpg,消失的爱人,2014,8.7,741730<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p661160053.jpg,无人知晓,2004,9.1,242934<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2414157745.jpg,倩女幽魂,1987,8.7,605138<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2614500883.jpg,超能陆战队,2014,8.7,826422<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p456692072.jpg,侧耳倾听,1995,8.9,379215<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910812549.jpg,哈利·波特与阿兹卡班的囚徒,2004,8.8,512727<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2190556408.jpg,完美的世界,1993,9.1,233065<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p617533616.jpg,借东西的小人阿莉埃蒂,2010,8.8,448723<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2223011274.jpg,甜蜜蜜,1996,8.9,427414<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1675053073.jpg,萤火之森,2011,8.9,423345<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2561542458.jpg,爱在日落黄昏时,2004,8.9,425918<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2210954024.jpg,驯龙高手,2010,8.7,628179<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p488255145.jpg,玛丽和马克思,2009,8.9,367547<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p854757687.jpg,幸福终点站,2004,8.8,449926<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p689520756.jpg,告白,2010,8.7,584313<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2515539487.jpg,天书奇谭,1983(中国大陆),9.2,191303<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p692813374.jpg,大鱼,2003,8.8,474379<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2609063925.jpg,射雕英雄传之东成西就,1993,8.7,533159<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1374786017.jpg,阳光姐妹淘,2011,8.8,509665<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1082651990.jpg,哈利·波特与密室,2002,8.7,537063<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2513247938.jpg,怪兽电力公司,2001,8.7,539086<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2016930906.jpg,恐怖直播,2013,8.7,533277<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p792776858.jpg,神偷奶爸,2010,8.6,797755<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2070153774.jpg,时空恋旅人,2013,8.8,484144<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1283675359.jpg,玩具总动员3,2010,8.9,415735<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2016401659.jpg,傲慢与偏见,2005,8.7,640438<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2169664351.jpg,教父3,1990,8.9,289948<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2360940399.jpg,釜山行,2016,8.6,959976<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2532803206.jpg,哪吒闹海,1979,9.1,207231<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2398141939.jpg,血战钢锯岭,2016,8.7,657406<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2406624993.jpg,一个叫欧维的男人决定去死,2015,8.9,342088<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1800813767.jpg,被解救的姜戈,2012,8.8,495236<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2215886505.jpg,七武士,1954,9.3,157351<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2249048907.jpg,喜宴,1993,8.9,280196<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1351050722.jpg,未麻的部屋,1997,9.0,239227<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2565332644.jpg,电锯惊魂,2004,8.7,425479<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p652417775.jpg,我是山姆,2001,9.0,259653<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2516578307.jpg,头号玩家,2018,8.6,1138578<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1917567652.jpg,风之谷,1984,8.9,307063<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p455677490.jpg,上帝之城,2002,9.0,255707<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2504997087.jpg,英雄本色,1986,8.7,426643<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p792223507.jpg,谍影重重3,2007,8.8,351487<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1867084027.jpg,疯狂原始人,2013,8.7,712391<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p470419493.jpg,卢旺达饭店,2004,8.9,257402<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2510081688.jpg,三块广告牌,2017,8.7,684406<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1903379979.jpg,新世界,2013,8.9,300798<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1910828286.jpg,花样年华,2000,8.7,475583<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2255040492.jpg,模仿游戏,2014,8.7,504705<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2597918718.jpg,纵横四海,1991,8.8,338906<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p443461818.jpg,黑客帝国3：矩阵革命,2003,8.8,353561<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2166160837.jpg,达拉斯买家俱乐部,2013,8.8,369844<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p456666151.jpg,岁月神偷,2010,8.7,502534<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2276780256.jpg,心迷宫,2014,8.7,409481<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2266293606.jpg,头脑特工队,2015,8.7,488191<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2395733377.jpg,你的名字。,2016,8.4,1134874<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p641688453.jpg,记忆碎片,2000,8.7,508006<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2603716224.jpg,忠犬八公物语,1987,9.2,157136<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2584519452.jpg,荒蛮故事,2014,8.8,353965<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2561439800.jpg,寄生虫,2019,8.8,1125278<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2603364117.jpg,海街日记,2015,8.8,347104<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p475600770.jpg,真爱至上,2003,8.6,600244<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2220776342.jpg,爆裂鼓手,2014,8.7,465097<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2434249040.jpg,贫民窟的百万富翁,2008,8.6,630016<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1982176012.jpg,东邪西毒,1994,8.6,488030<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1021883305.jpg,惊魂记,1960,9.0,209421<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2237136718.jpg,萤火虫之墓,1988,8.7,352414<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p735391084.jpg,哈利·波特与火焰杯,2005,8.6,463960<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2549648344.jpg,黑天鹅,2010,8.6,687717<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2530599636.jpg,小偷家族,2018,8.7,684571<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p767586451.jpg,绿里奇迹,1999,8.9,249136<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1735642656.jpg,无敌破坏王,2012,8.7,437272<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p709670262.jpg,你看起来好像很好吃,2010,8.9,279807<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1910895719.jpg,冰川时代,2002,8.6,515039<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2074715729.jpg,爱在午夜降临前,2013,8.8,291034<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p648370300.jpg,九品芝麻官,1994,8.6,499623<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2353324612.jpg,雨人,1988,8.7,342625<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p712241453.jpg,疯狂的石头,2006,8.5,663816<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p483604864.jpg,恋恋笔记本,2004,8.5,542020<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p462470694.jpg,恐怖游轮,2009,8.5,655305<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1612355875.jpg,雨中曲,1952,9.0,170988<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p456676352.jpg,魔女宅急便,1989,8.7,378741<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2507709428.jpg,奇迹男孩,2017,8.6,472600<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p453716305.jpg,色，戒,2007,8.5,579145<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2399597512.jpg,虎口脱险,1966,8.9,198517<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2421855655.jpg,海边的曼彻斯特,2016,8.6,399115<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2560717825.jpg,2001太空漫游,1968,8.8,243088<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p792257137.jpg,人工智能,2001,8.7,362744<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2170238828.jpg,城市之光,1931,9.3,110942<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2363208684.jpg,可可西里,2004,8.8,244594<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2457609817.jpg,二十二,2015,8.7,242128<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2259715855.jpg,房间,2015,8.8,321691<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1598883511.jpg,罗生门,1950,8.8,252804<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1910909085.jpg,终结者2：审判日,1991,8.7,287626<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1505312273.jpg,初恋这件小事,2010,8.4,845669<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2505928032.jpg,大佛普拉斯,2017,8.7,341343<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1481879628.jpg,遗愿清单,2007,8.7,331269<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2549558913.jpg,波西米亚狂想曲,2018,8.7,478280<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p848381236.jpg,牯岭街少年杀人事件,1991,8.9,215299<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p988260245.jpg,源代码,2011,8.5,681677<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2351134499.jpg,魂断蓝桥,1940,8.8,228810<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1421018669.jpg,新龙门客栈,1992,8.6,364204<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2570901292.jpg,青蛇,1993,8.6,423044<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2236181653.jpg,疯狂的麦克斯4：狂暴之路,2015,8.6,429756<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2575043939.jpg,无耻混蛋,2009,8.6,392522<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1244017073.jpg,血钻,2006,8.7,302450<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2375245718.jpg,步履不停,2008,8.8,221179<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1023654037.jpg,燃情岁月,1994,8.8,241510<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2559581324.jpg,海洋,2009,9.1,140256<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p456703618.jpg,东京教父,2003,9.0,150187<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p958008320.jpg,无间道2,2003,8.6,346646<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2187896734.jpg,彗星来的那一夜,2013,8.5,432217<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p667644866.jpg,谍影重重2,2004,8.7,294670<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2079334286.jpg,穿越时空的少女,2006,8.6,326398<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p792282381.jpg,战争之王,2005,8.7,292534<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2525770523.jpg,阿飞正传,1990,8.5,412037<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1973489335.jpg,地球上的星星,2007,8.9,173201<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2522331945.jpg,完美陌生人,2016,8.5,451049<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1597183981.jpg,谍影重重,2002,8.6,352151<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2571500223.jpg,香水,2006,8.5,464907<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2195672555.jpg,千钧一发,1997,8.8,217710<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p443461390.jpg,黑客帝国2：重装上阵,2003,8.6,312981<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1925331564.jpg,东京物语,1953,9.2,109758<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2627847859.jpg,崖上的波妞,2008,8.6,382805<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1075591188.jpg,我爱你,2011,9.1,135121<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p1140984198.jpg,朗读者,2008,8.6,397681<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2250287733.jpg,再次出发之纽约遇见你,2013,8.6,351101<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2393044761.jpg,驴得水,2016,8.3,765089<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2263822658.jpg,聚焦,2015,8.8,234727<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p1344888983.jpg,浪潮,2008,8.7,228081<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p513567548.jpg,猜火车,1996,8.5,363994<br>https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2510956726.jpg,小萝莉的猴神大叔,2015,8.4,412418<br>https://img2.doubanio.com/view/photo/s_ratio_poster/public/p2561545031.jpg,追随,1998,8.9,152188<br>https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1910900710.jpg,黑鹰坠落,2001,8.7,244341<br>https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2542848758.jpg,网络谜踪,2018,8.5,439379<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>re</tag>
      
      <tag>requests</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>基于docker安装redis</title>
    <link href="/2021/06/04/%E5%9F%BA%E4%BA%8Edocker%E5%AE%89%E8%A3%85redis/"/>
    <url>/2021/06/04/%E5%9F%BA%E4%BA%8Edocker%E5%AE%89%E8%A3%85redis/</url>
    
    <content type="html"><![CDATA[<h2 id="获取redis镜像"><a href="#获取redis镜像" class="headerlink" title="获取redis镜像"></a>获取redis镜像</h2><p>安装环境，腾讯云。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">docker pull redis<br></code></pre></div></td></tr></table></figure><p>不加版本号默认获取最新版本，也可以使用 <code>docker search redis</code> 查看镜像来源。</p><h2 id="查看本地镜像"><a href="#查看本地镜像" class="headerlink" title="查看本地镜像"></a>查看本地镜像</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">[root@VM-0-15-centos ~]# docker images<br>REPOSITORY                TAG       IMAGE ID       CREATED        SIZE<br>redis                     latest    fad0ee7e917a   2 days ago     105MB<br></code></pre></div></td></tr></table></figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>官网获取<a href="http://download.redis.io/redis-stable/redis.conf">redis</a>配置文件:</p><ul><li>修改默认的配置文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">bind</span> 127.0.0.1 -::1   <span class="hljs-comment">#注释这部分，去掉限制只能本地访问</span></span><br><br>protected-mode no   # 默认yes,开启保护模式，限制为本地访问<br><br>daemonize no    # 默认no，改为yes意为以守护进程方式启动，可后台运行，除非kill进程（可选），改为yes会使配置文件方式启动redis失败<br><br>dir ./root/redis/data #输入本地redis数据库存放文件夹（可选）<br><br>appendonly yes #redis持久化（可选）<br></code></pre></div></td></tr></table></figure><p>使用xftp登录服务器，在<code>/root/redis/data </code>创建好文件夹用于存放<code>redis</code>数据，这个文件夹位置可自己设定。然后将配置好的<code>redis.conf</code>文件复制入<code>/root/redis/</code>文件夹下。</p><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">docker run -p <span class="hljs-number">6379</span>:<span class="hljs-number">6379</span> --name redis -v /root/redis/redis.conf:/etc/redis/redis.conf  -v /root/redis/data:/data -d redis:latest redis-server /etc/redis/redis.conf --appendonly yes<br></code></pre></div></td></tr></table></figure><p>启动命令解释如下：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">-p 6379:6379:把容器内的6379端口映射到宿主机6379端口<br>-v /root/redis/redis.conf:/etc/redis/redis.conf：把宿主机配置好的redis.conf放到容器内的这个位置中<br>-v /root/redis/data:/data：把redis持久化的数据在宿主机内显示，做数据备份<br>redis-server /etc/redis/redis.conf：这个是关键配置，让redis不是无配置启动，而是按照这个redis.conf的配置启动<br>–appendonly yes：redis启动后数据持久化<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>asyncio异步I/O模块</title>
    <link href="/2021/06/03/asyncio%E5%BC%82%E6%AD%A5I-O%E6%A8%A1%E5%9D%97/"/>
    <url>/2021/06/03/asyncio%E5%BC%82%E6%AD%A5I-O%E6%A8%A1%E5%9D%97/</url>
    
    <content type="html"><![CDATA[<p><code>asyncio</code> 是用来编写并发代码的库，使用 <code>async/await</code> 语法。</p><p><code>asyncio</code> 被用作多个提供高性能 <code>Python</code> 异步框架的基础，包括网络和网站服务，数据库连接库，分布式任务队列等等。</p><p><code>asyncio</code> 往往是构建 <code>IO</code> 密集型和高层级 <code>结构化</code> 网络代码的最佳选择。</p><p><code>asyncio</code> 提供一组 <code>高层级 API</code> 用于:</p><ul><li>并发地运行 <code>Python</code> 协程 并对其执行过程实现完全控制;</li><li>执行网络IO和IPC;</li><li>控制子进程;</li><li>通过队列 实现分布式任务;</li><li>同步并发代码;</li></ul><p>此外，还有一些 <code>低层级 API</code> 以支持库和框架的开发者实现:</p><ul><li>创建和管理事件循环，以提供异步 API 用于<code>网络化</code>, 运行<code>子进程</code>，处理 <code>OS信号</code> 等等;</li><li>使用 <code>transports</code> 实现高效率协议;</li><li>通过 <code>async/await</code> 语法 <code>桥接</code> 基于回调的库和代码。</li></ul><h2 id="协程与任务"><a href="#协程与任务" class="headerlink" title="协程与任务"></a>协程与任务</h2><h3 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h3><p>协程 通过 <code>async/await</code> 语法进行声明，是编写 <code>asyncio</code> 应用的推荐方式。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"> <span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;hello&#x27;</span>)<br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;world&#x27;</span>)<br><br>asyncio.run(main())<br></code></pre></div></td></tr></table></figure><p>输出hello后停止1秒后输出world。</p><p>直接调用协程并不会执行，比如这里直接<code>main()</code>是运行不了的，吃屎的<code>main</code>不是函数而是一个协程对象。</p><p>运行协程，有三种机制：</p><ul><li><code>asyncio.run()</code>函数来运行最高层级的入口点“main”函数。</li><li>等待一个协程，下面的代码等待1秒后输出hello，再等待2秒后输出world。</li></ul><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">say_after</span>(<span class="hljs-params">delay, what</span>):</span><br>    <span class="hljs-keyword">await</span> asyncio.sleep(delay)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;%s at <span class="hljs-subst">&#123;time.strftime(<span class="hljs-string">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>%what)<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;startd at <span class="hljs-subst">&#123;time.strftime(<span class="hljs-string">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">await</span> say_after(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;hello&quot;</span>)<br>    <span class="hljs-keyword">await</span> say_after(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;world&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ended at <span class="hljs-subst">&#123;time.strftime(<span class="hljs-string">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>)<br><br>asyncio.run(main())<br></code></pre></div></td></tr></table></figure><p>输出结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">startd at <span class="hljs-number">15</span>:04:<span class="hljs-number">17</span><br>hello at <span class="hljs-number">15</span>:04:<span class="hljs-number">18</span><br>world at <span class="hljs-number">15</span>:04:<span class="hljs-number">20</span><br>ended at <span class="hljs-number">15</span>:04:<span class="hljs-number">20</span><br></code></pre></div></td></tr></table></figure><ul><li><code>asyncio.create_task()</code>函数用来并发运行作为 <code>asyncio</code> 任务的多个协程。</li></ul><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">say_after</span>(<span class="hljs-params">delay, what</span>):</span><br>    <span class="hljs-keyword">await</span> asyncio.sleep(delay)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;%s at <span class="hljs-subst">&#123;time.strftime(<span class="hljs-string">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>%what)<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    task1 = asyncio.create_task(say_after(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;hello&quot;</span>))<br>    task2 = asyncio.create_task(say_after(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;world&quot;</span>))<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;startd at <span class="hljs-subst">&#123;time.strftime(<span class="hljs-string">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">await</span> task1<br>    <span class="hljs-keyword">await</span> task2<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ended at <span class="hljs-subst">&#123;time.strftime(<span class="hljs-string">&#x27;%X&#x27;</span>)&#125;</span>&quot;</span>)<br><br>asyncio.run(main())<br></code></pre></div></td></tr></table></figure><p>输出结果，注意，输出显示代码段的运行时间比之前快了 1 秒:：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">startd at <span class="hljs-number">15</span>:<span class="hljs-number">17</span>:<span class="hljs-number">35</span><br>hello at <span class="hljs-number">15</span>:<span class="hljs-number">17</span>:<span class="hljs-number">36</span><br>world at <span class="hljs-number">15</span>:<span class="hljs-number">17</span>:<span class="hljs-number">37</span><br>ended at <span class="hljs-number">15</span>:<span class="hljs-number">17</span>:<span class="hljs-number">37</span><br></code></pre></div></td></tr></table></figure><h3 id="可等待对象"><a href="#可等待对象" class="headerlink" title="可等待对象"></a>可等待对象</h3><p>如果一个对象可以在 <code>await</code> 语句中使用，那么它就是 <code>可等待</code> 对象。</p><p><code>可等待</code> 对象有三种主要类型: <code>协程</code>, <code>任务</code> 和 <code>Future</code>。</p><h4 id="协程-1"><a href="#协程-1" class="headerlink" title="协程"></a>协程</h4><p><code>Python</code> 协程属于 <code>可等待</code> 对象，因此可以在其他协程中被等待:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">nested</span>():</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">42</span><br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    nested()     <span class="hljs-comment"># 不会直接执行</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-keyword">await</span> nested()) <span class="hljs-comment"># 打印42</span><br><br>asyncio.run(main())<br></code></pre></div></td></tr></table></figure><p>“协程” 可用来表示两个紧密关联的概念:</p><ul><li>协程函数: 定义形式为 <code>async def</code> 的函数;</li><li>协程对象: 调用 <code>协程函数</code> 所返回的对象。</li></ul><h4 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h4><p><em>任务</em> 被用来“并行的”调度协程</p><p>当一个协程通过 <code>asyncio.create_task()</code> 等函数被封装为一个 <em>任务</em>，该协程会被自动调度执行:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hello</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;hello World&#x27;</span>)<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    task = asyncio.create_task(hello())<br>    <span class="hljs-keyword">await</span> task<br><br>asyncio.run(main())<br><br>&gt;&gt;hello World<br></code></pre></div></td></tr></table></figure><h3 id="运行-asyncio-程序"><a href="#运行-asyncio-程序" class="headerlink" title="运行 asyncio 程序"></a>运行 asyncio 程序</h3><p><code>asyncio.run(coro, *, debug=False)</code></p><p>执行 <code>coroutine coro</code> 并返回结果。</p><p>此函数会运行传入的协程，负责管理 <code>asyncio</code> 事件循环，终结异步生成器，并关闭线程池。</p><p>当有其他 <code>asyncio</code> 事件循环在同一线程中运行时，此函数不能被调用。</p><p>如果 <code>debug</code> 为 <code>True</code>，事件循环将以调试模式运行。</p><p>此函数总是会创建一个新的事件循环并在结束时关闭之。它应当被用作 <code>asyncio</code> 程序的主入口点，理想情况下应当只被调用一次。</p><p>示例:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;hello&#x27;</span>)<br><br>asyncio.run(main())<br></code></pre></div></td></tr></table></figure><h3 id="创建任务"><a href="#创建任务" class="headerlink" title="创建任务"></a>创建任务</h3><p><code>asyncio.create_task(coro, *, name=None)</code></p><p>将 <code>coro</code> 协程 封装为一个 <code>Task</code> 并调度其执行。返回 <code>Task</code> 对象。</p><p><code>name</code> 不为 <code>None</code>，它将使用 <code>Task.set_name()</code> 来设为任务的名称。</p><p>该任务会在 <code>get_running_loop()</code> 返回的循环中执行，如果当前线程没有在运行的循环则会引发 <code>RuntimeError</code>。</p><p>此函数 在 <code>Python 3.7</code> 中被加入。在 <code>Python 3.7 </code>之前，可以改用低层级的 <code>asyncio.ensure_future()</code> 函数。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">coro</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;hello&quot;</span>)<br><br><span class="hljs-comment"># python3.7</span><br>task = asyncio.create_task(coro())<br>...<br><br><span class="hljs-comment"># python3.7以前</span><br>task = asyncio.ensure_future(coro())<br></code></pre></div></td></tr></table></figure><h3 id="休眠"><a href="#休眠" class="headerlink" title="休眠"></a>休眠</h3><p><code>coroutine asyncio.sleep(delay, result=None, *, loop=None)</code></p><p>阻塞 <code>delay</code> 指定的秒数。</p><p>如果指定了 <code>result</code>，则当协程完成时将其返回给调用者。</p><p><code>sleep()</code> 总是会挂起当前任务，以允许其他任务运行。</p><p>将 <code>delay</code> 设为 <code>0</code> 将提供一个经优化的路径以允许其他任务运行。 这可供长期间运行的函数使用以避免在函数调用的全过程中阻塞事件循环。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> datetime<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">display_date</span>():</span><br>    loop = asyncio.get_running_loop()<br>    end_time = loop.time() + <span class="hljs-number">5.0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-built_in">print</span>(datetime.datetime.now())<br>        <span class="hljs-keyword">if</span> (loop.time() + <span class="hljs-number">1.0</span>) &gt;= end_time:<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br><br>asyncio.run(display_date())<br></code></pre></div></td></tr></table></figure><p>输出结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-number">2021</span>-06-04 <span class="hljs-number">16</span>:05:<span class="hljs-number">16.005762</span><br><span class="hljs-number">2021</span>-06-04 <span class="hljs-number">16</span>:05:<span class="hljs-number">17.010811</span><br><span class="hljs-number">2021</span>-06-04 <span class="hljs-number">16</span>:05:<span class="hljs-number">18.022837</span><br><span class="hljs-number">2021</span>-06-04 <span class="hljs-number">16</span>:05:<span class="hljs-number">19.038106</span><br><span class="hljs-number">2021</span>-06-04 <span class="hljs-number">16</span>:05:<span class="hljs-number">20.038414</span><br></code></pre></div></td></tr></table></figure><h3 id="并发运行任务"><a href="#并发运行任务" class="headerlink" title="并发运行任务"></a>并发运行任务</h3><p><code>awaitable asyncio.gather(*aws, loop=None, return_exceptions=False)</code></p><p>并发 运行 <code>aws</code> 序列中的 可等待对象。</p><p>如果 <code>aws</code> 中的某个可等待对象为协程，它将自动被作为一个任务调度。</p><p>如果所有可等待对象都成功完成，结果将是一个由所有返回值聚合而成的列表。结果值的顺序与 <code>aws</code> 中可等待对象的顺序一致。</p><p>如果 <code>return_exceptions</code> 为 <code>False</code> (默认)，所引发的首个异常会立即传播给等待 <code>gather()</code> 的任务。<code>aws</code> 序列中的其他可等待对象 不会被取消 并将继续运行。</p><p>如果 <code>return_exceptions</code> 为 <code>True</code>，异常会和成功的结果一样处理，并聚合至结果列表。</p><p>如果 <code>gather()</code> 被取消，所有被提交 (尚未完成) 的可等待对象也会 被取消。</p><p>如果 <code>aws</code> 序列中的任一 <code>Task</code> 或 <code>Future</code> 对象 被取消，它将被当作引发了 <code>CancelledError</code> 一样处理 – 在此情况下 <code>gather()</code> 调用 <em>不会</em> 被取消。这是为了防止一个已提交的 <code>Task/Future</code> 被取消导致其他 <code>Tasks/Future</code> 也被取消。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">factorial</span>(<span class="hljs-params">name, number</span>):</span><br>    f = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, number + <span class="hljs-number">1</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;任务名 <span class="hljs-subst">&#123;name&#125;</span>: factorial(<span class="hljs-subst">&#123;number&#125;</span>), currently i = <span class="hljs-subst">&#123;i&#125;</span>...&#x27;</span>)<br>        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br>        f *= i<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;任务 <span class="hljs-subst">&#123;name&#125;</span>: factorial(<span class="hljs-subst">&#123;number&#125;</span>) = <span class="hljs-subst">&#123;f&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">return</span> f<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    L = <span class="hljs-keyword">await</span> asyncio.gather(<br>        factorial(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">2</span>),<br>        factorial(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-number">3</span>),<br>        factorial(<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-number">4</span>),<br>    )<br>    <span class="hljs-built_in">print</span>(L)<br><br>asyncio.run(main())<br><br><span class="hljs-comment"># output</span><br><span class="hljs-comment"># 任务名 A: factorial(2), currently i = 2...</span><br><span class="hljs-comment"># 任务名 B: factorial(3), currently i = 2...</span><br><span class="hljs-comment"># 任务名 C: factorial(4), currently i = 2...</span><br><span class="hljs-comment"># 任务 A: factorial(2) = 2</span><br><span class="hljs-comment"># 任务名 B: factorial(3), currently i = 3...</span><br><span class="hljs-comment"># 任务名 C: factorial(4), currently i = 3...</span><br><span class="hljs-comment"># 任务 B: factorial(3) = 6</span><br><span class="hljs-comment"># 任务名 C: factorial(4), currently i = 4...</span><br><span class="hljs-comment"># 任务 C: factorial(4) = 24</span><br><span class="hljs-comment"># [2, 6, 24]</span><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python库</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>asyncio</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pyppeteer的使用</title>
    <link href="/2021/06/02/Pyppeteer%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2021/06/02/Pyppeteer%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>Selenium功能虽热强大，但还是有些不方便。</p><h2 id="Pyppeteer介绍"><a href="#Pyppeteer介绍" class="headerlink" title="Pyppeteer介绍"></a>Pyppeteer介绍</h2><p><code>Puppeteer</code> 是 <code>Google</code> 基于 Node.js 开发的一个工具，有了它我们可以通过 <code>JavaScript</code> 来控制 <code>Chrome</code> 浏览器的一些操作，当然也可以用作网络爬虫上，其 API 极其完善，功能非常强大。</p><p><code>Pyppeteer</code> 是 <code>Puppeteer</code> 的 Python版本的实现，但它不是 <code>Google</code> 开发的，是一位来自于日本的工程师依据 <code>Puppeteer</code> 的一些功能开发出来的非官方版本。</p><p><code>Pyppeteer</code> 是依赖于 <code>Chromium</code>这个浏览器来运行的。那么有了 <code>Pyppeteer</code> 之后，我们就可以免去那些烦琐的环境配置等问题。如果第一次运行的时候，<code>Chromium</code>浏览器没有安装，那么程序会帮我们自动安装和配置，就免去了烦琐的环境配置等工作。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>运行环境python 3.7以上。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip3 install pyppeteer<br></code></pre></div></td></tr></table></figure><p>查看安装路径</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pyppeteer<br><br><span class="hljs-built_in">print</span>(pyppeteer.__chromium_revision__)  <span class="hljs-comment"># 查看版本号</span><br><span class="hljs-built_in">print</span>(pyppeteer.executablePath())   <span class="hljs-comment"># 查看chromium存放路径</span><br></code></pre></div></td></tr></table></figure><p>output:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-number">588429</span><br>C:\Users\espho\AppData\Local\pyppeteer\pyppeteer\local-chromium\<span class="hljs-number">588429</span>\chrome-win32\chrome.exe<br></code></pre></div></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p><code>Pyppeteer</code> 是一款非常高效的 web 自动化测试工具，由于 <code>Pyppeteer</code> 是基于 <code>asyncio</code> 构建的，它的所有属性和方法几乎都是 <code>coroutine (协程)</code> 对象，因此在构建异步程序的时候非常方便，天生就支持异步运行。</p><p>程序构建的基本思路是新建一个 <code>browser</code> 浏览器 和 一个 页面 <code>page</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> pyppeteer <span class="hljs-keyword">import</span> launch<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    browser = <span class="hljs-keyword">await</span> launch()<br>    page = <span class="hljs-keyword">await</span> browser.newPage()<br>    <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">&#x27;http://baidu.com&#x27;</span>)<br>    <span class="hljs-keyword">await</span> page.screenshot(&#123;<span class="hljs-string">&#x27;path&#x27;</span>: <span class="hljs-string">&#x27;example.png&#x27;</span>&#125;)  <span class="hljs-comment"># 截图</span><br>    <span class="hljs-keyword">await</span> browser.close()   <span class="hljs-comment"># 关闭</span><br><br>asyncio.get_event_loop().run_until_complete(main())<br></code></pre></div></td></tr></table></figure><p>运行上面这段代码会发现并没有浏览器弹出运行，这是因为 <code>Pyppeteer</code> <code>默认使用的是无头浏览器，如果想要浏览器显示，需要在launch</code> 函数中设置参数 <code>“headless = False”</code>，程序运行结束后在同一目录下会出现截取到的网页图片：</p><p><img src="example.webp"></p><p>有个问题就是图片显示不全，网站内容没有办法完全铺满。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># Pyppeteer 支持字典 和 关键字传参，Puppeteer 只支持字典传参。</span><br><span class="hljs-comment"># 这里使用字典传参</span><br>browser = <span class="hljs-keyword">await</span> launch(<br>    &#123;<br>        <span class="hljs-string">&#x27;headless&#x27;</span>: <span class="hljs-literal">False</span>, <br>        <span class="hljs-string">&#x27;dumpio&#x27;</span>: <span class="hljs-literal">True</span>, <br>        <span class="hljs-string">&#x27;autoClose&#x27;</span>: <span class="hljs-literal">False</span>, <br>        <span class="hljs-string">&#x27;args&#x27;</span>: [<br>            <span class="hljs-string">&#x27;--no-sandbox&#x27;</span>, <br>            <span class="hljs-string">&#x27;--window-size=1366,850&#x27;</span><br>        ]<br>    &#125;<br>)<br><span class="hljs-keyword">await</span> page.setViewport(&#123;<span class="hljs-string">&#x27;width&#x27;</span>: <span class="hljs-number">1366</span>, <span class="hljs-string">&#x27;height&#x27;</span>: <span class="hljs-number">768</span>&#125;)<br></code></pre></div></td></tr></table></figure><h3 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h3><p>报错 <code>OSError: Unable to remove Temporary User Data</code><br>启动浏览器时指定参数 <code>userDataDir</code> 存放缓存，保证硬盘够大且不是系统盘。</p><h3 id="移除Chrome正受到自动测试软件的控制"><a href="#移除Chrome正受到自动测试软件的控制" class="headerlink" title="移除Chrome正受到自动测试软件的控制"></a>移除Chrome正受到自动测试软件的控制</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> pyppeteer <span class="hljs-keyword">import</span> launch<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    browser = <span class="hljs-keyword">await</span> launch(headless=<span class="hljs-literal">False</span>, ignoreDefaultArgs=[<span class="hljs-string">&#x27;--enable-automation&#x27;</span>])<br>    <span class="hljs-built_in">input</span>()<br>    <span class="hljs-keyword">await</span> browser.close()<br><br>asyncio.get_event_loop().run_until_complete(main())<br></code></pre></div></td></tr></table></figure><h3 id="全屏"><a href="#全屏" class="headerlink" title="全屏"></a>全屏</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tkinter<br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> pyppeteer <span class="hljs-keyword">import</span> launch<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">screen_size</span>():</span><br>    tk = tkinter.Tk()<br>    width = tk.winfo_screenwidth()<br>    height = tk.winfo_screenheight()<br>    tk.quit()<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;width&#x27;</span>: width, <span class="hljs-string">&#x27;height&#x27;</span>: height&#125;<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    browser = <span class="hljs-keyword">await</span> launch(headless=<span class="hljs-literal">False</span>, args=[<span class="hljs-string">&#x27;--start-maximized&#x27;</span>])  <span class="hljs-comment"># 页面全屏</span><br>    page = <span class="hljs-keyword">await</span> browser.newPage()<br>    <span class="hljs-keyword">await</span> page.setViewport(screen_size())  <span class="hljs-comment"># 内容全屏</span><br>    <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">&#x27;https://www.baidu.com/&#x27;</span>)<br>    <span class="hljs-built_in">input</span>()<br>    <span class="hljs-keyword">await</span> browser.close()<br><br><br>asyncio.get_event_loop().run_until_complete(main())<br></code></pre></div></td></tr></table></figure><h3 id="页面内容"><a href="#页面内容" class="headerlink" title="页面内容"></a>页面内容</h3><p>Page.content()或Page.evalute()</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> pyppeteer <span class="hljs-keyword">import</span> launch<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    browser = <span class="hljs-keyword">await</span> launch(headless=<span class="hljs-literal">False</span>)<br>    page = <span class="hljs-keyword">await</span> browser.newPage()<br>    url = <span class="hljs-string">&#x27;https://www.holychan.ltd/&#x27;</span><br>    <span class="hljs-keyword">await</span> page.goto(url)<br>    <span class="hljs-comment"># content = await page.content()</span><br>    content = <span class="hljs-keyword">await</span> page.evaluate(<span class="hljs-string">&#x27;document.body.textContent&#x27;</span>, force_expr=<span class="hljs-literal">True</span>)<br>    <span class="hljs-built_in">print</span>(content)<br>    <span class="hljs-built_in">input</span>()<br>    <span class="hljs-keyword">await</span> browser.close()<br><br><br>asyncio.get_event_loop().run_until_complete(main())<br></code></pre></div></td></tr></table></figure><p>把整个页面的文字获取下来了。</p><h3 id="异步运行"><a href="#异步运行" class="headerlink" title="异步运行"></a>异步运行</h3><p><code>asyncio.wait() </code>或 <code>asyncio.gather()</code>，建议只用在一次性读取的页面，需要滚动的不建议使用。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> pyppeteer <span class="hljs-keyword">import</span> launch<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">crawl</span>(<span class="hljs-params">url</span>):</span><br>    browser = <span class="hljs-keyword">await</span>  launch(headless=<span class="hljs-literal">False</span>)<br>    page = <span class="hljs-keyword">await</span> browser.newPage()<br>    <span class="hljs-keyword">await</span> page.goto(url)<br>    title = <span class="hljs-keyword">await</span> page.title()<br>    <span class="hljs-built_in">print</span>(title)<br>    <span class="hljs-keyword">await</span> browser.close()<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    urls = [<br>        crawl(<span class="hljs-string">&#x27;https://www.baidu.com/&#x27;</span>),<br>        crawl(<span class="hljs-string">&#x27;https://www.bing.com/&#x27;</span>)<br>    ]<br>    <span class="hljs-keyword">await</span> asyncio.wait(urls)<br>    <span class="hljs-comment"># await asyncio.gather(*urls)</span><br><br>asyncio.get_event_loop().run_until_complete(main())<br><br><span class="hljs-comment">#微软 Bing 搜索 - 国内版</span><br><span class="hljs-comment">#百度一下，你就知道</span><br></code></pre></div></td></tr></table></figure><h3 id="反爬虫检测"><a href="#反爬虫检测" class="headerlink" title="反爬虫检测"></a>反爬虫检测</h3><p>访问 <a href="https://bot.sannysoft.com/">https://bot.sannysoft.com/</a>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> pyppeteer <span class="hljs-keyword">import</span> launch<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    browser = <span class="hljs-keyword">await</span> launch(<br>        &#123;<br>            <span class="hljs-string">&#x27;headless&#x27;</span>: <span class="hljs-literal">False</span>, <br>            <span class="hljs-string">&#x27;dumpio&#x27;</span>: <span class="hljs-literal">True</span>, <br>            <span class="hljs-string">&#x27;autoClose&#x27;</span>: <span class="hljs-literal">False</span>, <br>            <span class="hljs-string">&#x27;data_dir&#x27;</span>:<span class="hljs-string">&#x27;E:/.cache/&#x27;</span>,<br>            <span class="hljs-string">&#x27;args&#x27;</span>: [<br>                <span class="hljs-string">&#x27;--no-sandbox&#x27;</span>, <br>                <span class="hljs-string">&#x27;--window-size=1366,850&#x27;</span><br>            ]<br>            <br>        &#125;<br>    )<br>    page = <span class="hljs-keyword">await</span> browser.newPage()<br>    <span class="hljs-keyword">await</span> page.setViewport(&#123;<span class="hljs-string">&#x27;width&#x27;</span>: <span class="hljs-number">1366</span>, <span class="hljs-string">&#x27;height&#x27;</span>: <span class="hljs-number">768</span>&#125;)<br>    <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">&#x27;https://bot.sannysoft.com/&#x27;</span>)<br>    <span class="hljs-keyword">await</span> page.screenshot(&#123;<span class="hljs-string">&#x27;path&#x27;</span>: <span class="hljs-string">&#x27;test.png&#x27;</span>&#125;)<br>    <span class="hljs-keyword">await</span> browser.close()<br><br>asyncio.get_event_loop().run_until_complete(main())<br></code></pre></div></td></tr></table></figure><p><img src="example1.webp"></p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>pypprteer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>logging日志模块</title>
    <link href="/2021/06/02/logging%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/"/>
    <url>/2021/06/02/logging%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/</url>
    
    <content type="html"><![CDATA[<h2 id="基础教程"><a href="#基础教程" class="headerlink" title="基础教程"></a>基础教程</h2><h3 id="日志级别"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别</h3><table><thead><tr><th align="center">级别</th><th align="center">使用场景</th></tr></thead><tbody><tr><td align="center">DEBUG</td><td align="center">细节信息，仅当诊断问题时适用</td></tr><tr><td align="center">INFO</td><td align="center">程序按预期运行</td></tr><tr><td align="center">WARNING</td><td align="center">表明有已经或即将发生的意外</td></tr><tr><td align="center">ERROR</td><td align="center">由于严重的问题，程序的某些功能已经不能正常执行</td></tr><tr><td align="center">CRITICAL</td><td align="center">严重的错误，表明程序已经不能继续执行</td></tr></tbody></table><p>默认是WARNING级别，意味着只会追踪该级别以及以上的事件，除非修改日志配置。</p><p>simple example:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br>logging.warning(<span class="hljs-string">&#x27;警告信息&#x27;</span>)<br>logging.info(<span class="hljs-string">&#x27;正常信息&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>output:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">WARNING:root:警告信息<br></code></pre></div></td></tr></table></figure><p>INFO信息并没有出现，因为默认级别是WARNING级别。</p><h3 id="记录日志到文件"><a href="#记录日志到文件" class="headerlink" title="记录日志到文件"></a>记录日志到文件</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br>logging.basicConfig(filename=<span class="hljs-string">&#x27;example.log&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>, level=logging.DEBUG)<br>logging.debug(<span class="hljs-string">&#x27;这个消息会被记录到日志文件中&#x27;</span>)<br>logging.info(<span class="hljs-string">&#x27;这个也会被记录&#x27;</span>)<br>logging.warning(<span class="hljs-string">&#x27;这个也会被记录&#x27;</span>)<br>logging.error(<span class="hljs-string">&#x27;这个也被记录，error&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>日志信息会记录到<code>exampe.log</code>中，3.9版本以后增加了encoding参数，在之前的版本或者没有指定时，编码会使用open()使用的默认值。</p><p>对 basicConfig() 的调用应该在 debug() ， info() 等的前面。因为它被设计为一次性的配置，只有第一次调用会进行操作，随后的调用不会产生有效操作。</p><p>如果多次运行上述脚本，则连续运行的消息将追加到文件 example.log 。 如果你希望每次运行重新开始，而不是记住先前运行的消息，则可以通过将上例中的调用更改为来指定 filemode 参数:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">logging.basicConfig(filename=<span class="hljs-string">&#x27;example.log&#x27;</span>, filemode=<span class="hljs-string">&#x27;w&#x27;</span>, level=logging.DEBUG)<br></code></pre></div></td></tr></table></figure><h3 id="记录变量数据"><a href="#记录变量数据" class="headerlink" title="记录变量数据"></a>记录变量数据</h3><p>使用格式字符作为事件描述信息，附加传入变量数据作为参数。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br>logging.warning(<span class="hljs-string">&#x27;打印变量1：%s，打印变量2：%s&#x27;</span>, <span class="hljs-string">&#x27;100&#x27;</span>, <span class="hljs-string">&#x27;1000&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>output:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">WARNING:root:打印变量<span class="hljs-number">1</span>：<span class="hljs-number">100</span>，打印变量<span class="hljs-number">2</span>：<span class="hljs-number">1000</span><br></code></pre></div></td></tr></table></figure><h3 id="更改显示消息的格式"><a href="#更改显示消息的格式" class="headerlink" title="更改显示消息的格式"></a>更改显示消息的格式</h3><p>example:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br>logging.basicConfig(<span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(levelname)s:%(message)s&#x27;</span>, level=logging.DEBUG)<br>logging.debug(<span class="hljs-string">&quot;这是debug信息&quot;</span>)<br>logging.info(<span class="hljs-string">&quot;这是info信息&quot;</span>)<br>logging.warning(<span class="hljs-string">&quot;这是warning信息&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>output:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">DEBUG:这是debug信息<br>INFO:这是info信息      <br>WARNING:这是warning信息<br></code></pre></div></td></tr></table></figure><h3 id="在消息中显示日期-时间"><a href="#在消息中显示日期-时间" class="headerlink" title="在消息中显示日期/时间"></a>在消息中显示日期/时间</h3><p>显示事件的日期和时间，在格式字符串中使用<code>&#39;%(asctime)s&#39;</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br>logging.basicConfig(<span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(asctime)s %(message)s&#x27;</span>, level=logging.DEBUG)<br>logging.warning(<span class="hljs-string">&#x27;这是警告信息&#x27;</span>)<br>logging.info(<span class="hljs-string">&#x27;这是提示信息&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>output:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-number">2021</span>-06-02 <span class="hljs-number">10</span>:<span class="hljs-number">52</span>:<span class="hljs-number">34</span>,<span class="hljs-number">738</span> 这是警告信息<br><span class="hljs-number">2021</span>-06-02 <span class="hljs-number">10</span>:<span class="hljs-number">52</span>:<span class="hljs-number">34</span>,<span class="hljs-number">738</span> 这是提示信息<br></code></pre></div></td></tr></table></figure><p><code>datafmt</code>参数可以控制时间的格式。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br>logging.basicConfig(<span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(asctime)s %(message)s&#x27;</span>, level=logging.DEBUG, datefmt=<span class="hljs-string">&#x27;%Y-%m-%d %I:%M:%S %p&#x27;</span>)<br>logging.warning(<span class="hljs-string">&#x27;这是警告信息&#x27;</span>)<br>logging.info(<span class="hljs-string">&#x27;这是提示信息&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>output:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-number">2021</span>-06-02 <span class="hljs-number">10</span>:<span class="hljs-number">55</span>:<span class="hljs-number">55</span> AM 这是警告信息<br><span class="hljs-number">2021</span>-06-02 <span class="hljs-number">10</span>:<span class="hljs-number">55</span>:<span class="hljs-number">55</span> AM 这是提示信息<br></code></pre></div></td></tr></table></figure><p><code>datefmt</code> 参数的格式与 <code>time.strftime()</code> 支持的格式相同。</p><h2 id="进阶教程"><a href="#进阶教程" class="headerlink" title="进阶教程"></a>进阶教程</h2><p>日志库采用模块化的方法，提供了几类组件：记录器、处理器、过滤器和格式器。</p><ul><li>记录器暴露了应用程序代码直接使用的接口。</li><li>处理器将日志记录（由记录器创建）发送到适当的目标。</li><li>过滤器提供了更精细的附加功能，用于确定要输出的日志记录。</li><li>格式器指定最终输出中日志记录的样式。</li></ul><p>通过调用 <code>Logger</code> 类（以下称为 loggers ， 记录器）的实例来执行日志记录。 每个实例都有一个名称，它们在概念上以点（句点）作为分隔符排列在命名空间的层次结构中。 例如，名为 ‘scan’ 的记录器是记录器 ‘scan.text’ ，’scan.html’ 和 ‘scan.pdf’ 的父级。 记录器名称可以是你想要的任何名称，并指示记录消息源自的应用程序区域。</p><p>良好实践是在使用日志记录模块中使用模块记录器，命名如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">logger = logging.getLogger(__name__)<br></code></pre></div></td></tr></table></figure><p>记录器层次结构的根称为根记录器。 这是函数 <code>debug()</code> 、 <code>info()</code> 、 <code>warning()</code> 、 <code>error()</code> 和 <code>critical() </code>使用的记录器，它们就是调用了根记录器的同名方法。函数和方法具有相同的签名。根记录器的名称在输出中打印为 <code>&#39;root&#39;</code> 。</p><p>可以将消息记录到不同的地方。 软件包中的支持包含，用于将日志消息写入文件、 HTTP GET/POST 位置、通过 <code>SMTP</code> 发送电子邮件、通用套接字、队列或特定于操作系统的日志记录机制（如 <code>syslog</code> 或 Windows NT 事件日志）。 目标由 <code>handler</code> 类提供。 如果你有任何内置处理器类未满足的特殊要求，则可以创建自己的日志目标类。</p><p>默认情况下，没有为任何日志消息设置目标。 你可以使用 <code>basicConfig()</code> 指定目标（例如控制台或文件），如教程示例中所示。 如果你调用函数 debug() 、 info() 、 warning() 、 error() 和 critical() ，它们将检查是否有设置目标；如果没有设置，将在委托给根记录器进行实际的消息输出之前设置目标为控制台（ sys.stderr ）并设置显示消息的默认格式。</p><p>由 <code>basicConfig()</code> 设置的消息默认格式为：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">severity:logger name:message<br></code></pre></div></td></tr></table></figure><p>可以通过使用 <code>format</code> 参数将格式字符串传递给 <code>basicConfig()</code> 来更改此设置。</p><h3 id="记录流程"><a href="#记录流程" class="headerlink" title="记录流程"></a>记录流程</h3><p>记录器和处理器中的日志事件信息流程如下图所示。</p><p><img src=""></p><h3 id="记录器"><a href="#记录器" class="headerlink" title="记录器"></a>记录器</h3><p><code>Logger</code> 对象有三重任务。首先，它们向应用程序代码公开了几种方法，以便应用程序可以在运行时记录消息。其次，记录器对象根据严重性（默认过滤工具）或过滤器对象确定要处理的日志消息。第三，记录器对象将相关的日志消息传递给所有感兴趣的日志处理器。</p><p>这些是最常见的配置方法：</p><ul><li>Logger.setLevel() 指定记录器将处理的最低严重性日志消息，其中 debug 是最低内置严重性级别， critical 是最高内置严重性级别。 例如，如果严重性级别为 INFO ，则记录器将仅处理 INFO 、 WARNING 、 ERROR 和 CRITICAL 消息，并将忽略 DEBUG 消息。</li><li>Logger.addHandler() 和 Logger.removeHandler() 从记录器对象中添加和删除处理器对象。处理器在以下内容中有更详细的介绍 处理器 。</li><li>Logger.addFilter() 和 Logger.removeFilter() 可以添加或移除记录器对象中的过滤器。 过滤器对象 包含更多的过滤器细节。</li></ul><h3 id="处理器"><a href="#处理器" class="headerlink" title="处理器"></a>处理器</h3><p><code>Handler</code> 对象负责将适当的日志消息（基于日志消息的严重性）分派给处理器的指定目标。 <code>Logger</code> 对象可以使用 <code>addHandler()</code> 方法向自己添加零个或多个处理器对象。作为示例场景，应用程序可能希望将所有日志消息发送到日志文件，将错误或更高的所有日志消息发送到标准输出，以及将所有关键消息发送至一个邮件地址。 此方案需要三个单独的处理器，其中每个处理器负责将特定严重性的消息发送到特定位置。</p><p>常用的配置方法：</p><ul><li>setLevel() 方法，就像在记录器对象中一样，指定将被分派到适当目标的最低严重性。为什么有两个 setLevel() 方法？记录器中设置的级别确定将传递给其处理器的消息的严重性。每个处理器中设置的级别确定该处理器将发送哪些消息。</li><li>setFormatter() 选择一个该处理器使用的 Formatter 对象。</li><li>addFilter() 和 removeFilter() 分别在处理器上配置和取消配置过滤器对象。</li></ul><h3 id="格式器"><a href="#格式器" class="headerlink" title="格式器"></a>格式器</h3><p>格式化器对象配置日志消息的最终顺序、结构和内容。与 <code>logging.Handler</code> 类不同，应用程序代码可以实例化格式器类，但如果应用程序需要特殊行为，则可能会对格式化器进行子类化定制。构造函数有三个可选参数 —— <code>消息格式字符串</code>、<code>日期格式字符串</code>和<code>样式指示符</code>。</p><p><code>logging.Formatter.__init__(fmt=None, datefmt=None, style=&#39;%&#39;)</code></p><p>如果没有消息格式字符串，则默认使用原始消息。如果没有日期格式字符串，则默认日期格式为：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">%Y-%m-%d %H:%M:%S<br></code></pre></div></td></tr></table></figure><p>最后加上毫秒数。 <code>style</code> 是 <code>％</code>，<code>&#39;&#123;&#39;</code> 或 <code>&#39;$&#39;</code> 之一。 如果未指定，则将使用 <code>&#39;％&#39;</code>。</p><p>在 <code>3.2 </code>版更改: 添加 <code>style</code> 形参。</p><p>以下消息格式字符串将以人类可读的格式记录时间、消息的严重性以及消息的内容，按此顺序:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&#x27;%(asctime)s - %(levelname)s - %(message)s&#x27;</span><br></code></pre></div></td></tr></table></figure><p>格式器通过用户可配置的函数将记录的创建时间转换为元组。 默认情况下，使用 <code>time.localtime()</code>；要为特定格式器实例更改此项，请将实例的 <code>converter</code> 属性设置为与 <code>time.localtime()</code> 或 <code>time.gmtime()</code> 具有相同签名的函数。</p><h3 id="配置日志记录"><a href="#配置日志记录" class="headerlink" title="配置日志记录"></a>配置日志记录</h3><p>开发者可以通过三种方式配置日志记录：</p><ol><li>使用调用上面列出的配置方法的 <code>Python</code> 代码显式创建记录器、处理器和格式器。</li><li>创建日志配置文件并使用 <code>fileConfig()</code> 函数读取它。</li><li>创建配置信息字典并将其传递给 <code>dictConfig()</code> 函数。</li></ol><p>具体可参考官方文档。</p><style>    table    {        margin: auto;        font-size: 80%;    }</style>]]></content>
    
    
    <categories>
      
      <category>Python库</category>
      
    </categories>
    
    
    <tags>
      
      <tag>logging</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>南瑞103协议详解</title>
    <link href="/2021/06/01/%E5%8D%97%E7%91%9E103%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/"/>
    <url>/2021/06/01/%E5%8D%97%E7%91%9E103%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><code>IEC60870-5-103 </code>传输规约是1999年10月1日实施的电力行业标准（国内称为DL/T667－1999继电保护设备信息接口配套标准），规约要求采用此规约的监控和保护装置必须符合该标准的所有强制性定义。</p><p>深圳所<code>IEC-103</code>是该标准的一个子集，主要目的在于明确<code>应用层</code>功能，满足<code>IEC60870-5-103</code>的所有强制性定义，如果该子集与<code>IEC60870-5-103</code>相冲突，则以<br><code>IEC60870-5-103</code>为准。</p><h3 id="缩略语"><a href="#缩略语" class="headerlink" title="缩略语"></a>缩略语</h3><p>ASDU（Application Service Data Unit）应用服务数据单元<br>COT（Cause Of Transmission）传动原因<br>DCO（Double COmmand)双命令<br>H（Hex）十六进制<br>KOD（Kind Of Description）命令的描述类型<br>TOO（Type Of Order）命令类型</p><h2 id="IEC-103规约说明"><a href="#IEC-103规约说明" class="headerlink" title="IEC-103规约说明"></a>IEC-103规约说明</h2><p><code>IEC60870-5-103</code>规约描述了两种信息交换的方法，第一种方法是基于严格规定的应用服务数据单元和为传输 “标准化” 报文的应用过程， 第二种方法使用了通用分类服务， 以传输几乎所有可能的信息。<br><code>IEC-103( 深圳所 )</code>两种方法都采用。利用第一种方法来实现校时、信号复归、传输保护事件、告警、状态量和故障录波数据；利用第二种方法来实现定值（包括修改定值） 、测量值、软压板（控制字） （包括修改软压板（控制字））的传输。</p><p>下面是其详细列表 (括号中是涉及到的主要长帧报文)。</p><ol><li>保护动作事件 (ASDU2) </li><li>保护告警信息 (ASDU1) </li><li>保护状态信息 (ASDU1) </li><li>故障录波(ASDU23/ASDU24/ASDU25/ASDU26/ASDU27/ASDU28/ASDU29/ASDU30/ASDU31)</li><li>读取定值 (通用分类服务 ,ASDU10,ASDU21) </li><li>修改定值 (通用分类服务 ,ASDU10) </li><li>读取测量值 (通用分类服务 , ASDU10,ASDU21) </li><li>读取软压板（控制字） (通用分类服务 , ASDU10,ASDU21) </li><li>修改软压板（控制字） (通用分类服务 ,ASDU10) </li><li>校时 (ASDU6) </li><li>信号复归 (ASDU20)</li></ol><h2 id="IEC-103-规约结构"><a href="#IEC-103-规约结构" class="headerlink" title="IEC-103 规约结构"></a>IEC-103 规约结构</h2><p><code>IEC 60870-5-103 </code>规约基于三层参考模型（增强性能结构） ，这种模型用三层来表示：<code>物理层</code>、<code>链路层</code>、<code>应用层</code>。</p><p><img src="Screenshot_1.webp"></p><h2 id="IEC-103-物理层说明"><a href="#IEC-103-物理层说明" class="headerlink" title="IEC-103 物理层说明"></a>IEC-103 物理层说明</h2><p>支持光纤或者 <code>RS-485</code> 方式。</p><h2 id="IEC-103-链路层说明"><a href="#IEC-103-链路层说明" class="headerlink" title="IEC-103 链路层说明"></a>IEC-103 链路层说明</h2><h3 id="传输方式"><a href="#传输方式" class="headerlink" title="传输方式"></a>传输方式</h3><p>非平衡传输。控制系统组成主站，继电保护设备为子站，按照严格的<code>Polling</code>（轮询）方式进行通信。</p><h3 id="传输速率、校验方式和重复帧传输的超时时间"><a href="#传输速率、校验方式和重复帧传输的超时时间" class="headerlink" title="传输速率、校验方式和重复帧传输的超时时间"></a>传输速率、校验方式和重复帧传输的超时时间</h3><p>传输速率为 <code>9600Kbit/s</code> 或 <code>19.2Kbit/s</code>(可调)。<code>8</code>位数据位，<code>1</code>位停止位，校验方式为<code>偶校验</code>。</p><p>重复帧传输的超时时间间隔为<code>50ms</code>，控制系统中此值应当可以调节。</p><h3 id="帧格式"><a href="#帧格式" class="headerlink" title="帧格式"></a>帧格式</h3><p>两种：固定长帧格式和非固定长帧格式。</p><h4 id="固定长帧格式"><a href="#固定长帧格式" class="headerlink" title="固定长帧格式"></a>固定长帧格式</h4><p><img src="Screenshot_2.webp"></p><p>固定帧长帧格式用于控制系统向继电保护设备传输询问帧或命令帧（复位数据单元或复位帧计数位），或继电保护设备向控制系统传输确认帧或响应帧。</p><p>帧校验和是控制字、地址的算术和（不考虑溢出位即 <code>256</code> 模和）</p><p>子站和主站在接收报文时，校验启动字符、帧校验和、结束字符，检出任何一个差错，该数据帧无效。</p><h4 id="可变长帧格式"><a href="#可变长帧格式" class="headerlink" title="可变长帧格式"></a>可变长帧格式</h4><p><img src="Screenshot_3.webp"></p><p>可变帧长帧格式用于控制系统向继电保护设备传输数据，或由继电保护设备向控制系统传输数据之用。</p><p>长度<code>L</code>包括控制域、地址域、链路用户数据长度的总和， <code>L</code>最大值为 <code>255</code>,子站和主站在组织报文时， 要控制链路用户数据的长度， 注意使控制域、 地址域、 链路用户数据长度之和不要超出 <code>255</code>。如果超出，则要考虑分包传送。</p><p>帧校验和是控制、地址、链路用户数据的算术和，（不考虑溢出位即 256 模和）。</p><p>子站和主站在接收报文时， 应校验两个启动字符、 两个 <code>L</code>值应一致，接收字符数为 <code>L+6</code>,帧校验和、结束字符，若检出任何一个差错，则舍弃此帧数据。</p><h4 id="控制系统至保护设备报文控制域定义"><a href="#控制系统至保护设备报文控制域定义" class="headerlink" title="控制系统至保护设备报文控制域定义"></a>控制系统至保护设备报文控制域定义</h4><p>8位，一个字节。</p><p><img src="Screenshot_4.webp"></p><ul><li>备用位，始终为0。</li><li>启动报文位，始终为1，表示是由控制系统向继电保护设备传输，控制系统为启动站。</li><li><code>FCB（帧计数位）</code>，控制系统向同一个继电保护设备进行新一轮的<code>发送/确认</code>或<code>请求/响应</code>时，将 <code>FCB</code> 取反值。控制系统应为每一个继电保护设备保留一个帧计数位(<code>FCB</code>)的拷贝，若超时未从继电保护设备收到报文，或接收出现差错，则控制系统不改变帧计数位(<code>FCB</code>)的状态，重传原报文，重传次数大于等于 3 次，如果通信恢复，则继续正常通信过程，否则将复位该继电保护设备。继电保护设备在发送报文时，应该保留该发送报文的一个拷贝。在下一轮传输过程中如果控制系统的<strong>FCB有效且没有取反</strong>，则继电保护设备重新发送上一次发送报文的拷贝。在下一轮传输过程中如果控制系统的有效且 <code>FCB</code> 取反，则组织新报文发送，并保留此新报文的一个拷贝，并丢弃原来报文的拷贝。这样有效防止了报文丢失。<br>复位命令的帧计数位 (<code>FCB</code>)为 0,帧计数有效位 (<code>FCV</code>) 为 0。<br>广播校时报文不需要考虑报文丢失和重复重传，无需改变帧计数位 (<code>FCB</code>) 的状态，故在广播校时报文中帧计数有效位 (<code>FCV</code>) 为 0。</li><li><code>FCV</code>(帧计数有效位)，0表示帧计数位（FCB）的变化无效，1表示帧计数位（FCB）的变化有效。</li><li>功能码：</li></ul><table><thead><tr><th align="center">功能码序号</th><th align="center">帧类型</th><th align="center">功能</th><th align="center">FCV</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">发送/确认帧</td><td align="center">复位通信单元 (CU)</td><td align="center">0</td></tr><tr><td align="center">1－2</td><td align="center">——</td><td align="center">备用</td><td align="center">—</td></tr><tr><td align="center">3</td><td align="center">发送/确认帧</td><td align="center">传送数据 (总查询启动、命令报文、读写定值和软压板 （控制字），读取测量值 )</td><td align="center">1</td></tr><tr><td align="center">4</td><td align="center">发送/无回答帧</td><td align="center">传送数据（广播校时）</td><td align="center">0</td></tr><tr><td align="center">5－6</td><td align="center">——</td><td align="center">备用</td><td align="center">—</td></tr><tr><td align="center">7</td><td align="center">复位帧计数位 (FCB)</td><td align="center">传送数据</td><td align="center">0</td></tr><tr><td align="center">8</td><td align="center">——</td><td align="center">备用</td><td align="center">—</td></tr><tr><td align="center">9</td><td align="center">请求/响应帧</td><td align="center">召唤链路状态</td><td align="center">0</td></tr><tr><td align="center">10</td><td align="center">请求/响应帧</td><td align="center">召唤1级用户数据</td><td align="center">1</td></tr><tr><td align="center">11</td><td align="center">请求/响应帧</td><td align="center">召唤2级用户数据</td><td align="center">1</td></tr><tr><td align="center">12－13</td><td align="center">——</td><td align="center">备用</td><td align="center">—</td></tr><tr><td align="center">14－15</td><td align="center">——</td><td align="center">备用</td><td align="center">—</td></tr></tbody></table><style>  table {    margin: auto;    font-size: 70%;  }</style><h4 id="保护设备至控制系统报文控制域的定义"><a href="#保护设备至控制系统报文控制域的定义" class="headerlink" title="保护设备至控制系统报文控制域的定义"></a>保护设备至控制系统报文控制域的定义</h4><p>8位，一个字节。</p><p><img src="Screenshot_5.webp"></p><ul><li>备用位，始终为 0。</li><li>启动报文位，始终为 0：表示是由继电保护设备向控制系统传输。</li><li><code>ACD</code>( 要求访问位 )，继电保护设备有 <code>1</code> 级用户用户数据，将 <code>ACD</code> 置 <code>1</code> 通知控制系统召唤 <code>1</code> 级用户数据，如果继电保护设备没有 <code>1</code> 级用户数据，则将 <code>ACD</code> 置 <code>0</code>。</li><li><code>DFC</code>(数据流控制位 ) ，<code>DFC=0</code>表示继电保护设备可以接受数据。<code>DFC=1</code>表示继电保护设备的缓冲区已满，无法接受新数据。</li><li>本规约规定深圳所保护设备上送报文中 <code>DFC</code> 始终为 0，即可以接受新数据， 控制系统应能够处理 <code>DFC=1</code> 的报文。</li><li>功能码</li></ul><table><thead><tr><th align="center">功能码序号</th><th align="center">帧类型</th><th align="center">功能</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">确认帧</td><td align="center">确认</td></tr><tr><td align="center">1</td><td align="center">确认帧</td><td align="center">链路忙</td></tr><tr><td align="center">2－5</td><td align="center">——</td><td align="center">备用</td></tr><tr><td align="center">6－7</td><td align="center">——</td><td align="center">制造厂和用户协商定义</td></tr><tr><td align="center">8</td><td align="center">响应帧</td><td align="center">以数据响应请求帧</td></tr><tr><td align="center">9</td><td align="center">响应帧</td><td align="center">无所召唤的数据</td></tr><tr><td align="center">10</td><td align="center">——</td><td align="center">备用</td></tr><tr><td align="center">11</td><td align="center">响应帧</td><td align="center">以链路状态或访问请求回答请求帧</td></tr><tr><td align="center">12</td><td align="center"></td><td align="center">备用</td></tr><tr><td align="center">13</td><td align="center"></td><td align="center">制造厂和用户协商定义</td></tr><tr><td align="center">14</td><td align="center"></td><td align="center">链路服务未工作</td></tr><tr><td align="center">15</td><td align="center"></td><td align="center">链路服务未工作</td></tr></tbody></table><p>功能码 0 :<br>继电保护设备从控制系统接收到复位、 读写数据报文时， 在传递 1 级用户数据之前， 都要发送一个短帧来通知控制系统继电保护设备已经接收到复位或读写数据报文， 且如果有 1级用户数据则将 ACD 置 1 来通知控制系统召唤 1 级用户数据。</p><p>功能码 1：<br>如果控制系统向继电保护设备召唤 1 级用户 ,继电保护设备能够确定有需要发送的 1 级用户数据 ,但由于某种原因无法立即组织好 ,可以用此功能码来组织短帧<code>10 21 01 22 16</code>（假定地址为 1） 通知控制系统该继电保护设备链路忙，控制系统在接收到此报文后在下一个周期轮询到此继电保护设备时，继续召唤 1 级用户数据。</p><h2 id="IEC-103应用层说明"><a href="#IEC-103应用层说明" class="headerlink" title="IEC-103应用层说明"></a>IEC-103应用层说明</h2><h3 id="1级和2级用户"><a href="#1级和2级用户" class="headerlink" title="1级和2级用户"></a>1级和2级用户</h3><p>1级用户数据（优先级从高到低）：</p><ol><li>一次设备的工作状态和系统工作状态发生变化时形成的数据。</li><li>继电保护设备动作信号。</li><li>初始化过程中，继电保护设备发送的 <code>ASDU5</code> 报文。</li><li>控制系统发送总查询命令后，继电保护传送的状态量或动作信息，继电保护设备发送的总查询结束报文。</li><li>命令传输过程中，继电保护设备形成的肯定或否定认可报文。</li><li>在通用分类服务控制系统发送读或写命令后，继电保护设备发送的 <code>ASDU10</code> 报文。</li><li>继电保护设备在故障录波后形成扰动数据时所产生的如下内容：</li></ol><ul><li> 扰动数据表 <code>ASDU23</code> </li><li> 扰动数据传输准备就绪 <code>ASDU26</code> </li><li> 被记录的通道传输准备就绪 <code>ASDU27</code> </li><li> 带标志的状态变位传输准备就绪 <code>ASDU28</code> </li><li> 传送带标志的状态变位的状态 <code>ASDU29</code> </li><li> 传送扰动值 <code>ASDU30</code> </li><li> 带标志的状态变位传输结束 <code>ASDU31</code></li></ul><p>2 级用户数据：</p><p>二级用户数据主要用来传输测量值， <code>IEC－ 103(深圳所)</code>规定深圳所继电保护设备测量值采用通用分类服务传输， 故无 2 级用户数据， 当主站召唤 2 级用户数据时， 用无所请求报文数据回答。 但要求在非深圳所继电保护设备利用 <code>ASDU3</code> <code>、ASDU9</code> 上送测量值的情况下， 深圳所控制系统能够支持。</p><h3 id="应用层系统介绍"><a href="#应用层系统介绍" class="headerlink" title="应用层系统介绍"></a>应用层系统介绍</h3><p><code>IEC－103（深圳所）</code>是严格的 <code>Polling</code> 规约，按照非平衡方式传输，控制系统为主站，继电保护为子站。通信开始时，控制系统向继电保护设备发送服务命令使通信功能复位，然后是对保护进行广播校时，和总查询，总查询完毕后进入通常的召唤 2 级用户数据的过程。如果有突发事件，则子站首先通过<code>ACD</code>标志位置 1 通知主站本子站有 1 级用户数据， 主站然后根据<code>ACD</code>标志位为 1 来召唤 1 级用户数据。 对于控制系统主动发送的命令或通用分类服务读命令，子站首先响应一个短帧来确认收到此命令，并将<code>ACD</code>位置 1，通知主站有 1 级用户数据，主站然后根据<code>ACD</code>标志位为 1 来召唤 1 级用户数据， 如果此时子站尚未准备好 1 级用户数据， 则可发送链路忙报文并将<code>ACD</code>置 1 以通知主站子站忙，主站接收到此报文后应继续召唤 1 级用户数据，直到最后接收到 1 级用户数据或无所请求报文为止。</p><p>为了防止主站对某一个子站进行查询的时间过长，规定与某一个子站通信一次后应马上转入与下一个子站的通信过程， 主站应该记录与该子站的通信状态， 以便下一次轮询到此子站时能够继续正常通信。</p><p>  应用层功能实现：<br>  利用<code>ASDU1</code>传送告警、状态信息<br>  利用<code>ASDU2</code>来传送事件<br>  利用<code>ASDU6</code>来对保护装置校时<br>  利用<code>ASDU20</code>来对保护装置信号复归<br>  利用通用分类服务实现调取和修改定值、调取和修改测量值、调取测量值，其中定值支持调取多组定值。</p>]]></content>
    
    
    <categories>
      
      <category>自动化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>pscada</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>异步爬虫的原理和解析</title>
    <link href="/2021/05/31/%E5%BC%82%E6%AD%A5%E7%88%AC%E8%99%AB%E7%9A%84%E5%8E%9F%E7%90%86%E5%92%8C%E8%A7%A3%E6%9E%90/"/>
    <url>/2021/05/31/%E5%BC%82%E6%AD%A5%E7%88%AC%E8%99%AB%E7%9A%84%E5%8E%9F%E7%90%86%E5%92%8C%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="实列引入"><a href="#实列引入" class="headerlink" title="实列引入"></a>实列引入</h2><p>看这么一个示例网站：<a href="https://static4.scrape.cuiqingcai.com/">https://static4.scrape.cuiqingcai.com/</a>，如图所示。</p><p><img src="Screenshot_1.webp"></p><p>这个网站在内部实现返回响应的逻辑的时候特意加了 5 秒的延迟，也就是说如果我们用 <code>requests</code> 来爬取其中某个页面的话，至少需要 5 秒才能得到响应。</p><p>下面我们来用 <code>requests</code> 写一个遍历程序，直接遍历 <code>1~100</code> 部电影数据，代码实现如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">import</span> time<br><br>logging.basicConfig(level=logging.INFO, <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(asctime)s - %(levelname)s: %(message)s&#x27;</span>) <br><br>TOTAL_NUMBER = <span class="hljs-number">100</span> <br>BASE_URL = <span class="hljs-string">&#x27;https://static4.scrape.cuiqingcai.com/detail/&#123;id&#125;&#x27;</span><br><br>start_time = time.time() <br><br><span class="hljs-keyword">for</span> <span class="hljs-built_in">id</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, TOTAL_NUMBER + <span class="hljs-number">1</span>): <br>    url = BASE_URL.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">id</span>=<span class="hljs-built_in">id</span>) <br>    logging.info(<span class="hljs-string">&#x27;scraping %s&#x27;</span>, url) <br>    response = requests.get(url, verify=<span class="hljs-literal">False</span>) <br>    end_time = time.time() <br>    <br>logging.info(<span class="hljs-string">&#x27;total time %s seconds&#x27;</span>, end_time - start_time)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-number">2021</span>-05-<span class="hljs-number">31</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">33</span>,<span class="hljs-number">963</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class="hljs-number">1</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">31</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">41</span>,<span class="hljs-number">377</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class="hljs-number">2</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">31</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">47</span>,<span class="hljs-number">221</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class="hljs-number">3</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">31</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">52</span>,<span class="hljs-number">603</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class="hljs-number">4</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">31</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">59</span>,<span class="hljs-number">745</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class="hljs-number">5</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">31</span> <span class="hljs-number">17</span>:<span class="hljs-number">43</span>:06,<span class="hljs-number">403</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class="hljs-number">6</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">31</span> <span class="hljs-number">17</span>:<span class="hljs-number">43</span>:<span class="hljs-number">12</span>,<span class="hljs-number">190</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class="hljs-number">7</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">31</span> <span class="hljs-number">17</span>:<span class="hljs-number">43</span>:<span class="hljs-number">20</span>,<span class="hljs-number">517</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class="hljs-number">8</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">31</span> <span class="hljs-number">17</span>:<span class="hljs-number">43</span>:<span class="hljs-number">25</span>,<span class="hljs-number">804</span> - INFO: scraping https://static4.scrape.cuiqingcai.com/detail/<span class="hljs-number">9</span><br>...<br></code></pre></div></td></tr></table></figure><p>每个页面都至少要等待 5 秒才能加载出来，因此 100 个页面至少要花费 500 秒的时间，总的爬取时间最终为 513.6 秒，将近 9 分钟。</p><h2 id="基本了解"><a href="#基本了解" class="headerlink" title="基本了解"></a>基本了解</h2><h3 id="阻塞"><a href="#阻塞" class="headerlink" title="阻塞"></a>阻塞</h3><p>阻塞状态指程序未得到所需计算资源时被挂起的状态。程序在等待某个操作完成期间，自身无法继续处理其他的事情，则称该程序在该操作上是阻塞的。</p><p>常见的阻塞形式有：网络 <code>I/O</code> 阻塞、磁盘 <code>I/O</code> 阻塞、用户输入阻塞等。阻塞是无处不在的，包括 <code>CPU</code> 切换上下文时，所有的进程都无法真正处理事情，它们也会被阻塞。如果是多核 <code>CPU</code> 则正在执行上下文切换操作的核不可被利用。</p><h3 id="非阻塞"><a href="#非阻塞" class="headerlink" title="非阻塞"></a>非阻塞</h3><p>非程序在等待某操作过程中，自身不被阻塞，可以继续处理其他的事情，则称该程序在该操作上是非阻塞的。</p><p>非阻塞并不是在任何程序级别、任何情况下都可以存在的。仅当程序封装的级别可以囊括独立的子程序单元时，它才可能存在非阻塞状态。</p><p>非阻塞的存在是因为阻塞存在，正因为某个操作阻塞导致的耗时与效率低下，才要把它变成非阻塞的。</p><h3 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h3><p>不同程序单元为了完成某个任务，在执行过程中需靠某种通信方式以协调一致，我们称这些程序单元是同步执行的。</p><p>例如购物系统中更新商品库存，需要用“行锁”作为通信信号，让不同的更新请求强制排队顺序执行，那更新库存的操作是同步的。</p><p>简言之，同步意味着有序。</p><h3 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h3><p>为完成某个任务，不同程序单元之间过程中无需通信协调，也能完成任务的方式，不相关的程序单元之间可以是异步的。</p><p>例如，爬虫下载网页。调度程序调用下载程序后，即可调度其他任务，而无需与该下载任务保持通信以协调行为。不同网页的下载、保存等操作都是无关的，也无需相互通知协调。这些异步操作的完成时刻并不确定。</p><p>简言之，异步意味着无序。</p><h3 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h3><p>多进程就是利用 <code>CPU</code> 的多核优势，在同一时间并行地执行多个任务，可以大大提高执行效率。</p><h3 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h3><p>协程，英文叫作 <code>Coroutine</code>，又称微线程、纤程，协程是一种用户态的轻量级线程。</p><p>协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈。因此协程能保留上一次调用时的状态，即所有局部状态的一 个特定组合，每次过程重入时，就相当于进入上一次调用的状态。</p><p>协程本质上是个单进程，协程相对于多进程来说，无需线程上下文切换的开销，无需原子操作锁定及同步的开销，编程模型也非常简单。</p><p>可以使用协程来实现异步操作，比如在网络爬虫场景下，发出一个请求之后，需要等待一定的时间才能得到响应，但其实在这个等待过程中，程序可以干许多其他的事情，等到响应得到之后才切换回 来继续处理，这样可以充分利用 <code>CPU</code> 和其他资源，这就是协程的优势。</p><h2 id="协程用法"><a href="#协程用法" class="headerlink" title="协程用法"></a>协程用法</h2><p>从 Python 3.4 开始，Python中加入了协程的概念，但这个版本的协程还是以生成器对象为基础的，在 Python 3.5 则增加了 <code>async/await</code>，使得协程的实现更加方便。 Python中使用协程最常用的库莫过于 <code>asyncio</code>，所以本文会以 <code>asyncio</code> 为基础来介绍协程的使用。</p><p>首先需要了解下面几个概念。</p><ul><li><code>event_loop</code>：事件循环，相当于一个无限循环，我们可以把一些函数注册到这个事件循环上，当满足条件发生的时候，就会调用对应的处理方法。</li><li><code>coroutine</code>：中文翻译叫协程，在 <code>Python中</code>常指代为协程对象类型，可以将协程对象注册到时间循环中，它会被事件循环调用。可以使用 <code>async</code> 关键字来定义一个方法，这个方法在调用时不会立即 被执行，而是返回一个协程对象。</li><li><code>task</code>：任务，它是对协程对象的进一步封装，包含了任务的各个状态。</li><li><code>future</code>：代表将来执行或没有执行的任务的结果，实际上和 <code>task</code> 没有本质区别。 </li></ul><p>另外还需要了解 <code>async/await</code> 关键字，它是从 <code>Python 3.5</code> 才出现的，专门用于定义协程。其中，<code>async</code> 定义一个协程，<code>await</code> 用来挂起阻塞方法的执行。</p><h3 id="定义协程"><a href="#定义协程" class="headerlink" title="定义协程"></a>定义协程</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio  <span class="hljs-comment"># 引入asyncio包</span><br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute</span>(<span class="hljs-params">x</span>):</span>   <span class="hljs-comment"># 使用async定义一个exexute方法</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Number:&#x27;</span>, x)<br><br>coroutine = execute(<span class="hljs-number">1</span>)  <span class="hljs-comment"># 直接调用这个方法，没有直接执行，返回协程对象</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;返回的协程对象：&#x27;</span>, coroutine)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;After calling execute&#x27;</span>)<br>loop = asyncio.get_event_loop()     <span class="hljs-comment"># 创建事件循环loop</span><br>loop.run_until_complete(coroutine)  <span class="hljs-comment"># 调用loop对象的run_until_complete方法将协程注册到事件循环中</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;After calling loop&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">返回的协程对象： &lt;coroutine <span class="hljs-built_in">object</span> execute at <span class="hljs-number">0x0000015A83EAE740</span>&gt;<br>After calling execute<br>Number: <span class="hljs-number">1</span><br>After calling loop<br></code></pre></div></td></tr></table></figure><p><code>async</code>定义的方法无法直接执行，会变成一个协程对象，必须注册到事件循环中才可以执行。</p><p>协程对象可以进一步的被封装成<code>task</code>对象，如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute</span>(<span class="hljs-params">x</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Number&#x27;</span>, x)<br>    <span class="hljs-keyword">return</span> x<br><br>coroutine = execute(<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;协程对象:&#x27;</span>, coroutine)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;After calling execute&#x27;</span>)<br>loop = asyncio.get_event_loop()<br>task = loop.create_task(coroutine)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Task对象&#x27;</span>, task)<br>loop.run_until_complete(task)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Task对象:&#x27;</span>, task)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;After calling loop&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">协程对象: &lt;coroutine <span class="hljs-built_in">object</span> execute at <span class="hljs-number">0x00000180F83EE6C0</span>&gt;<br>After calling execute<br>Task对象 &lt;Task pending name=<span class="hljs-string">&#x27;Task-1&#x27;</span> coro=&lt;execute() running at secondeCourse.py:<span class="hljs-number">3</span>&gt;&gt;<br>Number <span class="hljs-number">1</span><br>Task对象: &lt;Task finished name=<span class="hljs-string">&#x27;Task-1&#x27;</span> coro=&lt;execute() done, defined at secondeCourse.py:<span class="hljs-number">3</span>&gt; result=<span class="hljs-number">1</span>&gt;<br>After calling loop<br></code></pre></div></td></tr></table></figure><p>可以看到定义了loop对象之后，调用它的create_task方法将coroutine对象转化成task对象，随后打印发现它是pending状态。接着将task对象添加到事件循环中执行，之后再打印输出一下task对象，它的状态就变成了finished，同时可以看到result变成了1，就是定义的execute方法返回的结果。</p><p>还有另外的方法可以定义task对象，直接通过ayncio的ensure_future方法，返回结果也是task对象。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute</span>(<span class="hljs-params">x</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Number&#x27;</span>, x)<br>    <span class="hljs-keyword">return</span> x<br><br>coroutine = execute(<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;协程对象:&#x27;</span>, coroutine)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;After calling execute&#x27;</span>)<br>task = asyncio.ensure_future(coroutine)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Task对象&#x27;</span>, task)<br>loop = asyncio.get_event_loop()<br>loop.run_until_complete(task)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Task对象:&#x27;</span>, task)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;After calling loop&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">协程对象: &lt;coroutine <span class="hljs-built_in">object</span> execute at <span class="hljs-number">0x00000180F83EE6C0</span>&gt;<br>After calling execute<br>Task对象 &lt;Task pending name=<span class="hljs-string">&#x27;Task-1&#x27;</span> coro=&lt;execute() running at secondeCourse.py:<span class="hljs-number">3</span>&gt;&gt;<br>Number <span class="hljs-number">1</span><br>Task对象: &lt;Task finished name=<span class="hljs-string">&#x27;Task-1&#x27;</span> coro=&lt;execute() done, defined at secondeCourse.py:<span class="hljs-number">3</span>&gt; result=<span class="hljs-number">1</span>&gt;<br>After calling loop<br></code></pre></div></td></tr></table></figure><p>其运行效果都是一样的。</p><h3 id="绑定回调"><a href="#绑定回调" class="headerlink" title="绑定回调"></a>绑定回调</h3><p>可以为某个task绑定回调函数。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">request</span>():</span><br>    url = <span class="hljs-string">&#x27;https://www.baidu.com&#x27;</span><br>    status = requests.get(url)<br>    <span class="hljs-keyword">return</span> status<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">callback</span>(<span class="hljs-params">task</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;task状态：&#x27;</span>, task.result())<br><br>coroutine = request()<br>task = asyncio.ensure_future(coroutine)     <span class="hljs-comment"># 创建task对象</span><br>task.add_done_callback(callback)    <span class="hljs-comment"># 添加task回调函数</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Task对象：&#x27;</span>, task)<br><br>loop = asyncio.get_event_loop()<br>loop.run_until_complete(task)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Taskd对象：&quot;</span>, task)<br></code></pre></div></td></tr></table></figure><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Task对象： &lt;Task pending name=<span class="hljs-string">&#x27;Task-1&#x27;</span> coro=&lt;request() running at task_callback.py:<span class="hljs-number">9</span>]&gt;<br>task状态： &lt;Response [<span class="hljs-number">200</span>]&gt;<br>Taskd对象： &lt;Task finished name=<span class="hljs-string">&#x27;Task-1&#x27;</span> coro=&lt;request() done, defined at task_callback.py:<span class="hljs-number">4</span>&gt; result=&lt;Response [<span class="hljs-number">200</span>]&gt;&gt;<br></code></pre></div></td></tr></table></figure><p>调用add_done_task方法，将callback方法传递给封装好的task对象，当task对象执行完毕后就可以调用callback方法，同时task对象还会作为参数传递给callback方法，调用task对象的result方法就可以获取返回结果。</p><h3 id="多任务协程"><a href="#多任务协程" class="headerlink" title="多任务协程"></a>多任务协程</h3><p>如果要执行过次请求，可以顶一个task列表，然后使用asyncio的wait方法。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">request</span>():</span><br>    url = <span class="hljs-string">&#x27;https://www.baidu.com&#x27;</span><br>    status = requests.get(url)<br>    <span class="hljs-keyword">return</span> status<br><br>tasks = [asyncio.ensure_future(request()) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>)]    <span class="hljs-comment"># 创建包含5个task的列表</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Tasks:\n&#x27;</span>, tasks)<br><br>loop = asyncio.get_event_loop()<br>loop.run_until_complete(asyncio.wait(tasks))<br><br><span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> tasks:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Task results:\n&#x27;</span>, task.result())<br></code></pre></div></td></tr></table></figure><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Tasks:<br> [&lt;Task pending name=<span class="hljs-string">&#x27;Task-1&#x27;</span> coro=&lt;request() running at 多任务协程.py:<span class="hljs-number">4</span>&gt;&gt;, &lt;Task pending name=<span class="hljs-string">&#x27;Task-2&#x27;</span> coro=&lt;request() running at 多任务协程.py:<span class="hljs-number">4</span>&gt;&gt;, &lt;Task pending name=<span class="hljs-string">&#x27;Task-3&#x27;</span> coro=&lt;request() running at 多任务协程.py:<span class="hljs-number">4</span>&gt;&gt;, &lt;Task pending name=<span class="hljs-string">&#x27;Task-4&#x27;</span> coro=&lt;request() running at 多任务协程.py:<span class="hljs-number">4</span>&gt;&gt;, &lt;Task pending name=<span class="hljs-string">&#x27;Task-5&#x27;</span> coro=&lt;request() running at 多任务协程.py:<span class="hljs-number">4</span>&gt;&gt;]<br>Task results:<br> &lt;Response [<span class="hljs-number">200</span>]&gt;<br>Task results:<br> &lt;Response [<span class="hljs-number">200</span>]&gt;<br>Task results:<br> &lt;Response [<span class="hljs-number">200</span>]&gt;<br>Task results:<br> &lt;Response [<span class="hljs-number">200</span>]&gt;<br>Task results:<br> &lt;Response [<span class="hljs-number">200</span>]&gt;<br></code></pre></div></td></tr></table></figure><p>可以看到五个任务被顺次执行了，并得到了运行结果。</p><h2 id="使用aiohttp"><a href="#使用aiohttp" class="headerlink" title="使用aiohttp"></a>使用aiohttp</h2><p>aiohttp是一个支持异步请求的库，利用它和asyncio配合可以实现异步请求操作。</p><p>安装：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install aiohttp<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> aiohttp<br><span class="hljs-keyword">import</span> time<br><br>start = time.time()<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">url</span>):</span><br>    session = aiohttp.ClientSession()   <span class="hljs-comment"># 创建异步会话</span><br>    response = <span class="hljs-keyword">await</span> session.get(url)   <span class="hljs-comment"># 异步会话请求返回的响应体</span><br>    <span class="hljs-keyword">await</span> response.text()<br>    <span class="hljs-keyword">await</span> session.close()<br>    <span class="hljs-keyword">return</span> response<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">request</span>():</span><br>    url = <span class="hljs-string">&#x27;https://holychan.ltd&#x27;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;等待获取网站信息&#x27;</span>)<br>    response = <span class="hljs-keyword">await</span> get(url)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;获取来自&#x27;</span>, url, <span class="hljs-string">&#x27;的响应&#x27;</span>, response)<br><br><br>tasks = [asyncio.ensure_future(request()) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]<br>loop = asyncio.get_event_loop()<br>loop.run_until_complete(asyncio.wait(tasks))<br><br>end = time.time()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;总共耗时：&#x27;</span>, end - start)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">等待获取网站信息<br>等待获取网站信息<br>等待获取网站信息<br>等待获取网站信息<br>等待获取网站信息<br>等待获取网站信息<br>等待获取网站信息<br>等待获取网站信息<br>等待获取网站信息<br>等待获取网站信息<br>获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class="hljs-number">200</span> OK]&gt;<br>&lt;CIMultiDictProxy(<span class="hljs-string">&#x27;Server&#x27;</span>: <span class="hljs-string">&#x27;nginx/1.14.1&#x27;</span>, <span class="hljs-string">&#x27;Date&#x27;</span>: <span class="hljs-string">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span>, <span class="hljs-string">&#x27;Content-Length&#x27;</span>: <span class="hljs-string">&#x27;44552&#x27;</span>, <span class="hljs-string">&#x27;Last-Modified&#x27;</span>: <span class="hljs-string">&#x27;Tue, </span><br><span class="hljs-string">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>, <span class="hljs-string">&#x27;Etag&#x27;</span>: <span class="hljs-string">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class="hljs-string">&#x27;Accept-Ranges&#x27;</span>: <span class="hljs-string">&#x27;bytes&#x27;</span>)&gt;<br><br>获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class="hljs-number">200</span> OK]&gt;<br>&lt;CIMultiDictProxy(<span class="hljs-string">&#x27;Server&#x27;</span>: <span class="hljs-string">&#x27;nginx/1.14.1&#x27;</span>, <span class="hljs-string">&#x27;Date&#x27;</span>: <span class="hljs-string">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span>, <span class="hljs-string">&#x27;Content-Length&#x27;</span>: <span class="hljs-string">&#x27;44552&#x27;</span>, <span class="hljs-string">&#x27;Last-Modified&#x27;</span>: <span class="hljs-string">&#x27;Tue, </span><br><span class="hljs-string">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>, <span class="hljs-string">&#x27;Etag&#x27;</span>: <span class="hljs-string">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class="hljs-string">&#x27;Accept-Ranges&#x27;</span>: <span class="hljs-string">&#x27;bytes&#x27;</span>)&gt;<br><br>获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class="hljs-number">200</span> OK]&gt;<br>&lt;CIMultiDictProxy(<span class="hljs-string">&#x27;Server&#x27;</span>: <span class="hljs-string">&#x27;nginx/1.14.1&#x27;</span>, <span class="hljs-string">&#x27;Date&#x27;</span>: <span class="hljs-string">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span>, <span class="hljs-string">&#x27;Content-Length&#x27;</span>: <span class="hljs-string">&#x27;44552&#x27;</span>, <span class="hljs-string">&#x27;Last-Modified&#x27;</span>: <span class="hljs-string">&#x27;Tue, </span><br><span class="hljs-string">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>, <span class="hljs-string">&#x27;Etag&#x27;</span>: <span class="hljs-string">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class="hljs-string">&#x27;Accept-Ranges&#x27;</span>: <span class="hljs-string">&#x27;bytes&#x27;</span>)&gt;<br><br>获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class="hljs-number">200</span> OK]&gt;<br>&lt;CIMultiDictProxy(<span class="hljs-string">&#x27;Server&#x27;</span>: <span class="hljs-string">&#x27;nginx/1.14.1&#x27;</span>, <span class="hljs-string">&#x27;Date&#x27;</span>: <span class="hljs-string">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span>, <span class="hljs-string">&#x27;Content-Length&#x27;</span>: <span class="hljs-string">&#x27;44552&#x27;</span>, <span class="hljs-string">&#x27;Last-Modified&#x27;</span>: <span class="hljs-string">&#x27;Tue, </span><br><span class="hljs-string">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>, <span class="hljs-string">&#x27;Etag&#x27;</span>: <span class="hljs-string">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class="hljs-string">&#x27;Accept-Ranges&#x27;</span>: <span class="hljs-string">&#x27;bytes&#x27;</span>)&gt;<br><br>获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class="hljs-number">200</span> OK]&gt;<br>&lt;CIMultiDictProxy(<span class="hljs-string">&#x27;Server&#x27;</span>: <span class="hljs-string">&#x27;nginx/1.14.1&#x27;</span>, <span class="hljs-string">&#x27;Date&#x27;</span>: <span class="hljs-string">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span>, <span class="hljs-string">&#x27;Content-Length&#x27;</span>: <span class="hljs-string">&#x27;44552&#x27;</span>, <span class="hljs-string">&#x27;Last-Modified&#x27;</span>: <span class="hljs-string">&#x27;Tue, </span><br><span class="hljs-string">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>, <span class="hljs-string">&#x27;Etag&#x27;</span>: <span class="hljs-string">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class="hljs-string">&#x27;Accept-Ranges&#x27;</span>: <span class="hljs-string">&#x27;bytes&#x27;</span>)&gt;<br><br>获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class="hljs-number">200</span> OK]&gt;<br>&lt;CIMultiDictProxy(<span class="hljs-string">&#x27;Server&#x27;</span>: <span class="hljs-string">&#x27;nginx/1.14.1&#x27;</span>, <span class="hljs-string">&#x27;Date&#x27;</span>: <span class="hljs-string">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span>, <span class="hljs-string">&#x27;Content-Length&#x27;</span>: <span class="hljs-string">&#x27;44552&#x27;</span>, <span class="hljs-string">&#x27;Last-Modified&#x27;</span>: <span class="hljs-string">&#x27;Tue, </span><br><span class="hljs-string">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>, <span class="hljs-string">&#x27;Etag&#x27;</span>: <span class="hljs-string">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class="hljs-string">&#x27;Accept-Ranges&#x27;</span>: <span class="hljs-string">&#x27;bytes&#x27;</span>)&gt;<br><br>获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class="hljs-number">200</span> OK]&gt;<br>&lt;CIMultiDictProxy(<span class="hljs-string">&#x27;Server&#x27;</span>: <span class="hljs-string">&#x27;nginx/1.14.1&#x27;</span>, <span class="hljs-string">&#x27;Date&#x27;</span>: <span class="hljs-string">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span>, <span class="hljs-string">&#x27;Content-Length&#x27;</span>: <span class="hljs-string">&#x27;44552&#x27;</span>, <span class="hljs-string">&#x27;Last-Modified&#x27;</span>: <span class="hljs-string">&#x27;Tue, </span><br><span class="hljs-string">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>, <span class="hljs-string">&#x27;Etag&#x27;</span>: <span class="hljs-string">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class="hljs-string">&#x27;Accept-Ranges&#x27;</span>: <span class="hljs-string">&#x27;bytes&#x27;</span>)&gt;<br><br>获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class="hljs-number">200</span> OK]&gt;<br>&lt;CIMultiDictProxy(<span class="hljs-string">&#x27;Server&#x27;</span>: <span class="hljs-string">&#x27;nginx/1.14.1&#x27;</span>, <span class="hljs-string">&#x27;Date&#x27;</span>: <span class="hljs-string">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span>, <span class="hljs-string">&#x27;Content-Length&#x27;</span>: <span class="hljs-string">&#x27;44552&#x27;</span>, <span class="hljs-string">&#x27;Last-Modified&#x27;</span>: <span class="hljs-string">&#x27;Tue, </span><br><span class="hljs-string">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>, <span class="hljs-string">&#x27;Etag&#x27;</span>: <span class="hljs-string">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class="hljs-string">&#x27;Accept-Ranges&#x27;</span>: <span class="hljs-string">&#x27;bytes&#x27;</span>)&gt;<br><br>获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class="hljs-number">200</span> OK]&gt;<br>&lt;CIMultiDictProxy(<span class="hljs-string">&#x27;Server&#x27;</span>: <span class="hljs-string">&#x27;nginx/1.14.1&#x27;</span>, <span class="hljs-string">&#x27;Date&#x27;</span>: <span class="hljs-string">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span>, <span class="hljs-string">&#x27;Content-Length&#x27;</span>: <span class="hljs-string">&#x27;44552&#x27;</span>, <span class="hljs-string">&#x27;Last-Modified&#x27;</span>: <span class="hljs-string">&#x27;Tue, </span><br><span class="hljs-string">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>, <span class="hljs-string">&#x27;Etag&#x27;</span>: <span class="hljs-string">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class="hljs-string">&#x27;Accept-Ranges&#x27;</span>: <span class="hljs-string">&#x27;bytes&#x27;</span>)&gt;<br><br>获取来自 https://holychan.ltd 的响应 &lt;ClientResponse(https://holychan.ltd) [<span class="hljs-number">200</span> OK]&gt;<br>&lt;CIMultiDictProxy(<span class="hljs-string">&#x27;Server&#x27;</span>: <span class="hljs-string">&#x27;nginx/1.14.1&#x27;</span>, <span class="hljs-string">&#x27;Date&#x27;</span>: <span class="hljs-string">&#x27;Tue, 01 Jun 2021 17:45:48 GMT&#x27;</span>, <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span>, <span class="hljs-string">&#x27;Content-Length&#x27;</span>: <span class="hljs-string">&#x27;44552&#x27;</span>, <span class="hljs-string">&#x27;Last-Modified&#x27;</span>: <span class="hljs-string">&#x27;Tue, </span><br><span class="hljs-string">01 Jun 2021 10:06:04 GMT&#x27;</span>, <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>, <span class="hljs-string">&#x27;Etag&#x27;</span>: <span class="hljs-string">&#x27;&quot;60b6068c-ae08&quot;&#x27;</span>, <span class="hljs-string">&#x27;Accept-Ranges&#x27;</span>: <span class="hljs-string">&#x27;bytes&#x27;</span>)&gt;<br><br>总共耗时： <span class="hljs-number">1.3632490634918213</span><br></code></pre></div></td></tr></table></figure><p>代码里面我们使用了<code>await</code>，后面跟了 get 方法，在执行这 10 个协程的时候，如果遇到了<code>awai</code>t，那么就会将当前协程挂起，转而去执行其他的协程，直到其他的协程也挂起或执行完毕，再进行下一个协程的执行。</p><p>开始运行时，时间循环会运行第一个<code>task</code>，针对第一个 <code>task</code> 来说，当执行到第一个 <code>await</code> 跟着的 get 方法时，它被挂起，但这个 get 方法第一步的执行是非阻塞的，挂起之后立马被唤醒，所以立即又进入执行， 创建了 ClientSession对象，接着遇到了第二个 await，调用了 <code>session.get</code> 请求方法，然后就被挂起了，由于请求需要耗时很久，所以一直没有被唤醒。</p><p>当第一个 task 被挂起了，那接下来该怎么办呢？事件循环会寻找当前未被挂起的协程继续执行，于是就转而执行第二个 task 了，也是一样的流程操作，直到执行了第十个 task 的 <code>session.get</code> 方法之后，全部的 task 都被挂起了。所有 task 都已经处于挂起状态，怎么办？只好等待了。几个请求几乎同时都有了响应，然后几个 task 也被唤醒接着执行，输出请求结果。</p><p>以百度为例，来测试下并发数量为 1、3、5、10、…、500 的情况下的耗时情况，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> aiohttp<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span>(<span class="hljs-params">number</span>):</span><br>    start = time.time()<br>    <br>    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">url</span>):</span><br>        session = aiohttp.ClientSession()<br>        response =<span class="hljs-keyword">await</span> session.get(url)<br>        <span class="hljs-keyword">await</span> response.text()<br>        <span class="hljs-keyword">await</span> session.close()<br>        <span class="hljs-keyword">return</span> response<br><br>    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">request</span>():</span><br>        url = <span class="hljs-string">&quot;https://www.baidu.com&quot;</span><br>        <span class="hljs-keyword">await</span> get(url)<br>        <br>    tasks = [asyncio.ensure_future(request()) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(number)]<br>    loop = asyncio.get_event_loop()<br>    loop.run_until_complete(asyncio.wait(tasks))<br><br>    end = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Number:&#x27;</span>, number, <span class="hljs-string">&#x27;Cost time:&#x27;</span>, end - start)<br><br><span class="hljs-keyword">for</span> number <span class="hljs-keyword">in</span> [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>, <span class="hljs-number">500</span>]:<br>    test(number)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Number: <span class="hljs-number">1</span> Cost time: <span class="hljs-number">0.36544227600097656</span><br>Number: <span class="hljs-number">3</span> Cost time: <span class="hljs-number">0.24126696586608887</span><br>Number: <span class="hljs-number">5</span> Cost time: <span class="hljs-number">0.248154878616333</span><br>Number: <span class="hljs-number">7</span> Cost time: <span class="hljs-number">0.2729628086090088</span><br>Number: <span class="hljs-number">9</span> Cost time: <span class="hljs-number">0.46077466011047363</span><br>Number: <span class="hljs-number">10</span> Cost time: <span class="hljs-number">0.2601125240325928</span><br>Number: <span class="hljs-number">50</span> Cost time: <span class="hljs-number">0.5060205459594727</span><br>Number: <span class="hljs-number">100</span> Cost time: <span class="hljs-number">0.4680452346801758</span><br>Number: <span class="hljs-number">500</span> Cost time: <span class="hljs-number">2.809006929397583</span><br></code></pre></div></td></tr></table></figure><p>可以看到，即使增加了并发数量，但在服务器能承受高并发的前提下，其爬取速度几乎不太受影响。</p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>asyncio</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>FastAPI教程-路径参数</title>
    <link href="/2021/05/30/FastAPI%E6%95%99%E7%A8%8B-%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0/"/>
    <url>/2021/05/30/FastAPI%E6%95%99%E7%A8%8B-%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<p>可以使用与 <code>Python</code> 格式化字符串相同的语法来声明路径”参数”或”变量”：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_item</span>(<span class="hljs-params">item_id</span>):</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id&#125;<br></code></pre></div></td></tr></table></figure><p>路径参数 <code>item_id</code> 的值将作为参数 <code>item_id</code> 传递给你的函数。</p><p>所以，运行示例并访问 <a href="http://127.0.0.1:8000/items/foo">http://127.0.0.1:8000/items/foo</a>，将会看到如下响应：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<span class="hljs-string">&quot;item_id&quot;</span>:<span class="hljs-string">&quot;foo&quot;</span>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="有类型的路径参数"><a href="#有类型的路径参数" class="headerlink" title="有类型的路径参数"></a>有类型的路径参数</h2><p>可以使用标准的 <code>Python</code> 类型标注为函数中的路径参数声明类型。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">int</span></span>):</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id&#125;<br></code></pre></div></td></tr></table></figure><p>在这个例子中，<code>item_id</code> 被声明为 <code>int</code> 类型。</p><p>这将为你的函数提供编辑器支持，包括错误检查、代码补全等等。</p><h2 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h2><p>如果运行示例并打开浏览器访问<a href="http://127.0.0.1:8000/items/3">http://127.0.0.1:8000/items/3</a>，将得到如下响应：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<span class="hljs-string">&quot;item_id&quot;</span>:<span class="hljs-number">3</span>&#125;<br></code></pre></div></td></tr></table></figure><p>注意函数接收（并返回）的值为 3，是一个 Python int 值，而不是字符串 “3”。</p><p>所以，<code>FastAPI</code> 通过上面的类型声明提供了对请求的自动”解析”。</p><h2 id="数据校验"><a href="#数据校验" class="headerlink" title="数据校验"></a>数据校验</h2><p>但如果你通过浏览器访问<a href="http://127.0.0.1:8000/items/foo">http://127.0.0.1:8000/items/foo</a>，你会看到一个清晰可读的 HTTP 错误：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<br>    <span class="hljs-string">&quot;detail&quot;</span>: [<br>        &#123;<br>            <span class="hljs-string">&quot;loc&quot;</span>: [<br>                <span class="hljs-string">&quot;path&quot;</span>,<br>                <span class="hljs-string">&quot;item_id&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;value is not a valid integer&quot;</span>,<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;type_error.integer&quot;</span><br>        &#125;<br>    ]<br>&#125;<br></code></pre></div></td></tr></table></figure><p>因为路径参数 <code>item_id</code> 传入的值为 <code>&quot;foo&quot;</code>，它不是一个 <code>int</code>。</p><p>如果你提供的是 <code>float</code> 而非整数也会出现同样的错误，比如：<a href="http://127.0.0.1:8000/items/1.2">http://127.0.0.1:8000/items/1.2</a></p><p>所以，通过同样的 Python 类型声明，FastAPI 提供了数据校验功能。</p><p>注意上面的错误同样清楚地指出了校验未通过的具体原因。</p><p>在开发和调试与你的 API 进行交互的代码时，这非常有用。</p><h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h2><p>打开浏览器访问<a href="http://127.0.0.1:8000/docs">http://127.0.0.1:8000/docs</a>，你将看到自动生成的交互式 <code>API</code> 文档：</p><p><img src="Screenshot_1.webp"></p><h2 id="路径操作的顺序"><a href="#路径操作的顺序" class="headerlink" title="路径操作的顺序"></a>路径操作的顺序</h2><p>在创建路径操作时，你会发现有些情况下路径是固定的。</p><p>比如 <code>/users/me</code>，我们假设它用来获取关于当前用户的数据.</p><p>然后，你还可以使用路径 <code>/users/&#123;user_id&#125;</code> 来通过用户 <code>ID</code> 获取关于特定用户的数据。</p><p>由于路径操作是按顺序依次运行的，你需要确保路径 <code>/users/me</code> 声明在路径 <code>/users/&#123;user_id&#125;</code>之前：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br>app = FastAPI()<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/users/me&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_user_me</span>():</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;user_id&quot;</span>: <span class="hljs-string">&quot;the current user&quot;</span>&#125;<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/users/&#123;user_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_user</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">str</span></span>):</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;user_id&quot;</span>: user_id&#125;<br></code></pre></div></td></tr></table></figure><p>否则，<code>/users/&#123;user_id&#125;</code> 的路径还将与 <code>/users/me</code> 相匹配，”认为”自己正在接收一个值为 <code>&quot;me&quot;</code> 的 <code>user_id</code> 参数。</p><h2 id="预设值"><a href="#预设值" class="headerlink" title="预设值"></a>预设值</h2><p>如果你有一个接收路径参数的路径操作，但你希望预先设定可能的有效参数值，则可以使用标准的 <code>Python Enum</code> 类型。</p><h3 id="创建一个-Enum-类"><a href="#创建一个-Enum-类" class="headerlink" title="创建一个 Enum 类"></a>创建一个 Enum 类</h3><p>导入 <code>Enum</code> 并创建一个继承自 <code>str</code> 和 <code>Enum</code> 的子类。</p><p>通过从 <code>str</code> 继承，<code>API</code>文档将能够知道这些值必须为 <code>string</code> 类型并且能够正确地展示出来。</p><p>然后创建具有固定值的类属性，这些固定值将是可用的有效值：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ModelName</span>(<span class="hljs-params"><span class="hljs-built_in">str</span>, Enum</span>):</span><br>    holy = <span class="hljs-string">&quot;holy&quot;</span><br>    jack = <span class="hljs-string">&quot;jack&quot;</span><br>    tony = <span class="hljs-string">&quot;tony&quot;</span><br><br>app = FastAPI()<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/model/&#123;model_name&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_model</span>(<span class="hljs-params">model_name: ModelName</span>):</span><br>    <span class="hljs-keyword">if</span> model_name == ModelName.holy:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;model_name&quot;</span>: model_name, <span class="hljs-string">&quot;messagge&quot;</span>: <span class="hljs-string">&quot;好好学习！&quot;</span>&#125;<br>    <span class="hljs-keyword">if</span> model_name == ModelName.jack:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;model_name&quot;</span>: model_name, <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;我对钱没有兴趣！&quot;</span>&#125;<br>    <br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;model_name&quot;</span>: model_name, <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;欢乐时光就要来临了！&quot;</span>&#125;<br></code></pre></div></td></tr></table></figure><p>输出结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<span class="hljs-string">&quot;model_name&quot;</span>:<span class="hljs-string">&quot;jack&quot;</span>,<span class="hljs-string">&quot;message&quot;</span>:<span class="hljs-string">&quot;我对钱没有兴趣！&quot;</span>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="获取枚举值"><a href="#获取枚举值" class="headerlink" title="获取枚举值"></a>获取枚举值</h3><p>可以使用 <code>model_name.value</code> 或通常来说 <code>your_enum_member.value</code> 来获取实际的值（在这个例子中为 str）。</p><p>你也可以通过 ModelName.tony.value 来获取值 “tony”。</p><h3 id="返回枚举成员"><a href="#返回枚举成员" class="headerlink" title="返回枚举成员"></a>返回枚举成员</h3><p>你以从路径操作中返回枚举成员，即使嵌套在 <code>JSON</code> 结构中（例如一个 <code>dict</code> 中）。</p><h2 id="包含路径的路径参数"><a href="#包含路径的路径参数" class="headerlink" title="包含路径的路径参数"></a>包含路径的路径参数</h2><h3 id="路径转换器"><a href="#路径转换器" class="headerlink" title="路径转换器"></a>路径转换器</h3><p>可以使用直接来自 <code>Starlette</code> 的选项来声明一个包含路径的路径参数：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">/files/&#123;file_path:path&#125;<br></code></pre></div></td></tr></table></figure><p>在这种情况下，参数的名称为 <code>file_path</code>，结尾部分的 :<code>path</code> 说明该参数应匹配任意的路径。</p><p>因此，可以这样使用它：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/files/&#123;file_path:path&#125;&quot;</span></span>)</span><br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_file</span>(<span class="hljs-params">file_path: <span class="hljs-built_in">str</span></span>):</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;file_path&quot;</span>: file_path&#125;<br></code></pre></div></td></tr></table></figure><p>访问<code>http://127.0.0.1:8000/files/linux/holy</code>输出结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<span class="hljs-string">&quot;file_path&quot;</span>:<span class="hljs-string">&quot;/root/holy&quot;</span>&#125;<br></code></pre></div></td></tr></table></figure><p>可能会需要参数包含 /home/johndoe/myfile.txt，以斜杠（/）开头。</p><p>在这种情况下，URL 将会是 /files//home/johndoe/myfile.txt，在files 和 home 之间有一个双斜杠（//）。</p>]]></content>
    
    
    <categories>
      
      <category>FastAPI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>fastapi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>FastAPI教程-入门介绍</title>
    <link href="/2021/05/30/FastAPI%E6%95%99%E7%A8%8B-%E7%94%A8%E6%88%B7%E6%8C%87%E5%8D%97/"/>
    <url>/2021/05/30/FastAPI%E6%95%99%E7%A8%8B-%E7%94%A8%E6%88%B7%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<h2 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h2><p>最简单的 <code>FastAPI</code> 文件可能像下面这样：</p><p>最简单的 FastAPI 文件可能像下面这样：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">root</span>():</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hello World&quot;</span>&#125;<br></code></pre></div></td></tr></table></figure><p>将其复制到 <code>main.py</code> 文件中。</p><p>运行实时服务器：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">uvicorn main:app --reload<br></code></pre></div></td></tr></table></figure><p>uvicorn main:app 命令含义如下:</p><ul><li>main：main.py 文件（一个 Python「模块」）。</li><li>app：在 main.py 文件中通过 app = FastAPI() 创建的对象。</li><li>--reload：让服务器在更新代码后重新启动。仅在开发时使用该选项。</li></ul><h2 id="分步概括"><a href="#分步概括" class="headerlink" title="分步概括"></a>分步概括</h2><h3 id="步骤1：导入FastAPI"><a href="#步骤1：导入FastAPI" class="headerlink" title="步骤1：导入FastAPI"></a>步骤1：导入FastAPI</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br></code></pre></div></td></tr></table></figure><p><code>FastAPI</code> 是一个为 <code>API</code> 提供了所有功能的 <code>Python</code> 类。</p><p>FastAPI 是直接从 Starlette 继承的类。<br>你可以通过 FastAPI 使用所有的 Starlette 的功能。</p><h3 id="步骤-2：创建一个-FastAPI「实例」"><a href="#步骤-2：创建一个-FastAPI「实例」" class="headerlink" title="步骤 2：创建一个 FastAPI「实例」"></a>步骤 2：创建一个 FastAPI「实例」</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">app = FastAPI()<br></code></pre></div></td></tr></table></figure><p>这里的变量 <code>app</code> 会是 <code>FastAPI</code> 类的一个「实例」。</p><p>这个实例将是创建你所有 <code>API</code> 的主要交互对象。</p><p>这个 <code>app</code> 同样在如下命令中被 <code>uvicorn</code> 所引用：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">uvicorn main:app --reload<br></code></pre></div></td></tr></table></figure><p>如果你像下面这样创建应用：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>my_awesome_api = FastAPI()<br><br><span class="hljs-meta">@my_awesome_api.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">root</span>():</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hello World&quot;</span>&#125;<br></code></pre></div></td></tr></table></figure><p>将代码放入 <code>main.py</code> 文件中，然后你可以像下面这样运行 <code>uvicorn</code>：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">uvicorn main:my_awesome_api --reload<br></code></pre></div></td></tr></table></figure><h3 id="步骤-3：创建一个路径操作"><a href="#步骤-3：创建一个路径操作" class="headerlink" title="步骤 3：创建一个路径操作"></a>步骤 3：创建一个路径操作</h3><h4 id="路径"><a href="#路径" class="headerlink" title="路径"></a>路径</h4><p>这里的「路径」指的是 <code>URL</code> 中从第一个 <code>/</code> 起的后半部分。</p><p>所以，在一个这样的 <code>URL</code> 中：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">https://example.com/items/foo<br></code></pre></div></td></tr></table></figure><p>…路径会是：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">/items/foo<br></code></pre></div></td></tr></table></figure><p>「路径」也通常被称为「端点」或「路由」。</p><p>开发 <code>API</code> 时，「路径」是用来分离「关注点」和「资源」的主要手段。</p><h4 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h4><p>这里的「操作」指的是一种 <code>HTTP「方法」</code>。</p><p>下列之一：</p><ul><li>POST</li><li>GET</li><li>PUT</li><li>DELETE</li></ul><p>…以及更少见的几种：</p><ul><li>OPTIONS</li><li>HEAD</li><li>PATCH</li><li>TRACE</li></ul><p>在 <code>HTTP</code> 协议中，你可以使用以上的其中一种（或多种）「方法」与每个路径进行通信。</p><p>在开发 <code>API</code> 时，通常使用特定的 <code>HTTP</code> 方法去执行特定的行为。</p><p>通常使用：</p><ul><li>POST：创建数据。</li><li>GET：读取数据。</li><li>PUT：更新数据。</li><li>DELETE：删除数据。</li></ul><p>因此，在 <code>OpenAPI</code> 中，每一个 <code>HTTP</code> 方法都被称为<code>「操作」</code>。</p><h4 id="定义一个路径操作装饰器"><a href="#定义一个路径操作装饰器" class="headerlink" title="定义一个路径操作装饰器"></a>定义一个路径操作装饰器</h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">root</span>():</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hello World&quot;</span>&#125;<br></code></pre></div></td></tr></table></figure><p><code>@app.get(&quot;/&quot;)</code>告诉 <code>FastAPI</code> 在它下方的函数负责处理如下访问请求：</p><ul><li>请求路径为 <code>/</code></li><li>使用 <code>get</code> 操作</li></ul><p><code>@something</code>语法在 <code>Python</code> 中被称为「装饰器」。</p><p>装饰器接收位于其下方的函数并且用它完成一些工作。</p><p>在上面的例子中，这个装饰器告诉 <code>FastAPI</code> 位于其下方的函数对应着路径 <code>/</code> 加上 <code>get</code> 操作。</p><p>它是一个「路径操作装饰器」。</p><h3 id="步骤-4：定义路径操作函数"><a href="#步骤-4：定义路径操作函数" class="headerlink" title="步骤 4：定义路径操作函数"></a>步骤 4：定义路径操作函数</h3><p>这是「路径操作函数」：</p><ul><li>路径：是 <code>/</code>。</li><li>操作：是 <code>get</code>。</li><li>函数：是位于「装饰器」下方的函数（位于<code>@app.get(&quot;/&quot;)</code>下方）。</li></ul><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br>app = FastAPI()<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">root</span>():</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hello World&quot;</span>&#125;<br></code></pre></div></td></tr></table></figure><p>这是一个 <code>Python</code> 函数。</p><p>每当 <code>FastAPI</code> 接收一个使用 <code>GET</code> 方法访问 <code>URL「/」</code>的请求时这个函数会被调用。</p><p>在这个例子中，它是一个 <code>async</code> 函数。当然也可以定义为常规函数。</p><h3 id="步骤-5：返回内容"><a href="#步骤-5：返回内容" class="headerlink" title="步骤 5：返回内容"></a>步骤 5：返回内容</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hello World&quot;</span>&#125;<br></code></pre></div></td></tr></table></figure><p>你可以返回一个 <code>dict</code>、<code>list</code>，像 <code>str</code>、<code>int</code> 一样的单个值，等等。</p><p>你还可以返回 <code>Pydantic</code> 模型（稍后你将了解更多）。</p><p>还有许多其他将会自动转换为 <code>JSON</code> 的对象和模型（包括 <code>ORM</code> 对象等）。</p>]]></content>
    
    
    <categories>
      
      <category>FastAPI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>fastapi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>FastAPI安装和使用</title>
    <link href="/2021/05/30/FastAPI%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
    <url>/2021/05/30/FastAPI%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><code>FastAPI</code> 是一个用于构建 API 的现代、快速（高性能）的 web 框架，使用 Python 3.6+ 并基于标准的 Python 类型提示。</p><p>关键特性:</p><ul><li><p>快速：可与 NodeJS 和 Go 比肩的极高性能（归功于 Starlette 和 Pydantic）。最快的 Python web 框架之一。</p></li><li><p>高效编码：提高功能开发速度约 200％ 至 300％。*</p></li><li><p>更少 bug：减少约 40％ 的人为（开发者）导致错误。*</p></li><li><p>智能：极佳的编辑器支持。处处皆可自动补全，减少调试时间。</p></li><li><p>简单：设计的易于使用和学习，阅读文档的时间更短。</p></li><li><p>简短：使代码重复最小化。通过不同的参数声明实现丰富功能。bug 更少。</p></li><li><p>健壮：生产可用级别的代码。还有自动生成的交互式文档。</p></li><li><p>标准化：基于（并完全兼容）API 的相关开放标准：OpenAPI (以前被称为 Swagger) 和 JSON Schema。</p></li></ul><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><p><code>Python 3.6</code>及更高版本</p><p><code>FastAPI</code>站在以下巨人的肩膀之上：</p><ul><li><code>Starlette</code> 负责 <code>web</code> 部分。</li><li><code>Pydantic</code> 负责数据部分。</li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install fastapi<br></code></pre></div></td></tr></table></figure><p>你还会需要一个 <code>ASGI</code> 服务器，生产环境可以使用 <code>Uvicorn</code> 或者 <code>Hypercorn</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install uvicorn[standard]<br></code></pre></div></td></tr></table></figure><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><p>创建一个<code>main.py</code>文件并写入以下内容:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span><br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_root</span>():</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;Hello&quot;</span>: <span class="hljs-string">&quot;World&quot;</span>&#125;<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">int</span>, q: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span></span>):</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id, <span class="hljs-string">&quot;q&quot;</span>: q&#125;<br></code></pre></div></td></tr></table></figure><p>如果你的代码里会出现 async / await，请使用 async def：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span><br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_root</span>():</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;Hello&quot;</span>: <span class="hljs-string">&quot;World&quot;</span>&#125;<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">int</span>, q: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span></span>):</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id, <span class="hljs-string">&quot;q&quot;</span>: q&#125;<br></code></pre></div></td></tr></table></figure><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>通过以下命令运行服务器：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">uvicorn main:app --reload<br></code></pre></div></td></tr></table></figure><h2 id="检查"><a href="#检查" class="headerlink" title="检查"></a>检查</h2><p>使用浏览器访问<a href="http://127.0.0.1:8000/items/5?q=somequery">http://127.0.0.1:8000/items/5?q=somequery</a>。</p><p>你将会看到如下<code>JSON</code>响应：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-number">5</span>, <span class="hljs-string">&quot;q&quot;</span>: <span class="hljs-string">&quot;somequery&quot;</span>&#125;<br></code></pre></div></td></tr></table></figure><p>你已经创建了一个具有以下功能的 <code>API</code>：</p><ul><li>通过 <em>路径</em> <code>/</code> 和 <code>/items/&#123;item_id&#125;</code> 接受 <code>HTTP</code> 请求。</li><li>以上 <em>路径</em> 都接受 <code>GET</code> 操作（也被称为 <code>HTTP</code> 方法）。</li><li><code>/items/&#123;item_id&#125;</code> <em>路径</em> 有一个路径参数 <code>item_id</code> 并且应该为 <code>int</code> 类型。</li><li><code>/items/&#123;item_id&#125;</code> <em>路径</em> 有一个可选的 <code>str</code> 类型的 查询参数 <code>q</code>。</li></ul><h2 id="交互式-API-文档"><a href="#交互式-API-文档" class="headerlink" title="交互式 API 文档"></a>交互式 API 文档</h2><p>访问<a href="http://127.0.0.1:8000/docs">http://127.0.0.1:8000/docs</a>，你会看到自动生成的交互式 <code>API</code> 文档（由 Swagger UI生成）：</p><p><img src="Screenshot_1.webp"></p><h2 id="示例升级"><a href="#示例升级" class="headerlink" title="示例升级"></a>示例升级</h2><p>现在修改<code>main.py</code>文件来从 <code>PUT</code> 请求中接收请求体。</p><p>我们借助 <code>Pydantic</code> 来使用标准的 <code>Python</code> 类型声明请求体。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span><br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br><br><br>app = FastAPI()<br><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Item</span>(<span class="hljs-params">BaseModel</span>):</span><br><br>    name: <span class="hljs-built_in">str</span><br><br>    price: <span class="hljs-built_in">float</span><br><br>    is_offer: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">bool</span>] = <span class="hljs-literal">None</span><br><br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_root</span>():</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;Hello&quot;</span>: <span class="hljs-string">&quot;World&quot;</span>&#125;<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">int</span>, q: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span></span>):</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id, <span class="hljs-string">&quot;q&quot;</span>: q&#125;<br><br><br><br><span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">int</span>, item: Item</span>):</span><br><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;item_name&quot;</span>: item.name, <span class="hljs-string">&quot;item_id&quot;</span>: item_id&#125;<br></code></pre></div></td></tr></table></figure><h2 id="交互式-API-文档升级"><a href="#交互式-API-文档升级" class="headerlink" title="交互式 API 文档升级"></a>交互式 API 文档升级</h2><p>访问<a href="http://127.0.0.1:8000/docs">http://127.0.0.1:8000/docs</a>。</p><ul><li><p>交互式 API 文档将会自动更新，并加入新的请求体：</p></li><li><p>点击「Try it out」按钮，之后你可以填写参数并直接调用 API：</p></li><li><p>然后点击「Execute」按钮，用户界面将会和 API 进行通信，发送参数，获取结果并在屏幕上展示：</p></li></ul><p><img src="Screenshot_2.webp"></p>]]></content>
    
    
    <categories>
      
      <category>FastAPI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>fastapi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flask快速上手</title>
    <link href="/2021/05/30/Flask%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/"/>
    <url>/2021/05/30/Flask%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="一个最小的应用"><a href="#一个最小的应用" class="headerlink" title="一个最小的应用"></a>一个最小的应用</h2><p>一个最小的<code>Flask</code>应用如下:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hello_world</span>():</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello, World!&#x27;</span><br></code></pre></div></td></tr></table></figure><p>那么，这些代码是什么意思呢？</p><ol><li><p>首先我们导入了<code>Flask</code>类。 该类的实例将会成为我们的<code>WSGI</code>应用。</p></li><li><p>接着我们创建一个该类的实例。第一个参数是应用模块或者包的名称。如果你使用一个单一模块（就像本例），那么应当使用<code>__name__</code>，因为名称会根据这个模块是按应用方式使用还是作为一个模块导入而发生变化（可能是 ‘<code>__main__</code>’ ， 也可能是实际导入的名称）。这个参数是必需的，这样<code>Flask</code>才能知道在哪里可以找到模板和静态文件等东西。更多内容详见<code>Flask</code>文档。</p></li><li><p>使用<code>route()</code>装饰器来告诉<code>Flask</code>触发函数的<code>URL</code>。</p></li><li><p>函数名称被用于生成相关联的<code>URL</code> 。函数最后返回需要在用户浏览器中显示的信息。</p></li></ol><p>可以使用<code>flask</code>命令或者<code>python</code>的<code>-m</code>开关来运行这个应用。在运行应用之前，需要在终端里导出<code>FLASK_APP</code>环境变量:</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">export</span> FLASK_APP=hello.py</span><br><span class="hljs-meta">$</span><span class="bash"> flask run</span><br> * Running on http://127.0.0.1:5000/<br></code></pre></div></td></tr></table></figure><p>如果是在<code>Windows</code>下，那么导出环境变量的语法取决于使用的是哪种命令行解释器。 在<code>Command Prompt</code>下:</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">C:\path\to\app&gt;set FLASK_APP=hello.py<br></code></pre></div></td></tr></table></figure><p>还可以使用<code>python -m flask</code>:</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">export</span> FLASK_APP=hello.py</span><br><span class="hljs-meta">$</span><span class="bash"> python -m flask run</span><br> * Running on http://127.0.0.1:5000/<br></code></pre></div></td></tr></table></figure><p>这样就启动了一个非常简单的内建的服务器。这个服务器用于测试应该是足够了，但是用于生产可能是不够的。</p><h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p>现代<code>web</code>应用都使用有意义的<code>URL</code>，这样有助于用户记忆，网页会更得到用户的青睐， 提高回头率。</p><p>使用<code>route()</code>装饰器来把函数绑定到<code>URL</code>:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Index Page&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/hello&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hello</span>():</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello, World&#x27;</span><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Flask</category>
      
    </categories>
    
    
    <tags>
      
      <tag>flask</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flask安装</title>
    <link href="/2021/05/30/Flask%E5%AE%89%E8%A3%85/"/>
    <url>/2021/05/30/Flask%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="Python版本"><a href="#Python版本" class="headerlink" title="Python版本"></a>Python版本</h2><p>推荐使用最新版本的<code>Python3</code> 。 <code>Flask</code>支持<code>Python 3.5</code>及更高版本的<code>Python 3</code> 、<code>Python 2.7</code>和<code>PyPy</code>。</p><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><p>当安装<code>Flask</code>时，以下配套软件会被自动安装。</p><ul><li><p><code>Werkzeug</code>用于实现<code>WSGI</code>，应用和服务之间的标准<code>Python</code>接口。</p></li><li><p><code>Jinja</code>用于渲染页面的模板语言。</p></li><li><p><code>MarkupSafe</code>与<code>Jinja</code>共用，在渲染页面时用于避免不可信的输入，防止注入攻击。</p></li><li><p><code>ItsDangerous</code>保证数据完整性的安全标志数据，用于保护<code>Flask</code>的<code>session cookie</code>.</p></li><li><p><code>Click</code>是一个命令行应用的框架。用于提供<code>flask</code>命令，并允许添加自定义管理命令。</p></li></ul><h2 id="可选依赖"><a href="#可选依赖" class="headerlink" title="可选依赖"></a>可选依赖</h2><p>以下配套软件不会被自动安装。如果安装了，那么<code>Flask</code>会检测到这些软件。</p><ul><li><p><code>Blinker</code>为信号提供支持。</p></li><li><p><code>SimpleJSON</code>是一个快速的<code>JSON</code>实现，兼容<code>Python’s json</code>模块。如果安装了这个软件，那么会优先使用这个软件来进行<code>JSON</code>操作。</p></li><li><p><code>python-dotenv</code>当运行<code>flask</code>命令时为通过<code>dotenv</code>设置环境变量 提供支持。</p></li><li><p><code>Watchdog</code>为开发服务器提供快速高效的重载。</p></li></ul><h2 id="虚拟环境"><a href="#虚拟环境" class="headerlink" title="虚拟环境"></a>虚拟环境</h2><p>建议在开发环境和生产环境下都使用虚拟环境来管理项目的依赖。</p><p>为什么要使用虚拟环境？随着你的Python项目越来越多，你会发现不同的项目会需要不同的版本的Python库。同一个Python库的不同版本可能不兼容。</p><p>虚拟环境可以为每一个项目安装独立的Python库，这样就可以隔离不同项目之间的Python库，也可以隔离项目与操作系统之间的Python库。</p><p>Python3内置了用于创建虚拟环境的<code>venv</code>模块。如果你使用的是较新的Python版本，那么可以按照下面的步骤创建虚拟环境。</p><h2 id="创建一个虚拟环境"><a href="#创建一个虚拟环境" class="headerlink" title="创建一个虚拟环境"></a>创建一个虚拟环境</h2><p>创建一个项目文件夹，然后创建一个虚拟环境。创建完成后项目文件夹中会有一个<code>venv</code>文件夹：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">mkdir myproject<br>cd myproject<br>python3 -m venv venv<br></code></pre></div></td></tr></table></figure><p>在<code>Windows</code>下：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">py -3 -m venv venv<br></code></pre></div></td></tr></table></figure><p>在老版本的<code>Python</code>中要使用下面的命令创建虚拟环境：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">python2 -m virtualenv venv<br></code></pre></div></td></tr></table></figure><p>在<code>Windows</code>下：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">\Python27\Scripts\virtualenv.exe venv<br></code></pre></div></td></tr></table></figure><h3 id="激活python环境"><a href="#激活python环境" class="headerlink" title="激活python环境"></a>激活python环境</h3><p>在开始工作前，先要激活相应的虚拟环境：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">. venv/bin/activate<br></code></pre></div></td></tr></table></figure><p>在<code>Windows</code>下：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">venv\Scripts\activate<br></code></pre></div></td></tr></table></figure><p>激活后，你的终端提示符会显示虚拟环境的名称。</p><p>如果你使用的VS code，要在cmd命令行下激活虚拟环境，如果是power shell则不可以。</p><h2 id="安装Flask"><a href="#安装Flask" class="headerlink" title="安装Flask"></a>安装Flask</h2><p>在已激活的虚拟环境中可以使用如下命令安装<code>Flask</code>：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install Flask<br></code></pre></div></td></tr></table></figure><p><code>Flask</code>现在已经安装完毕。</p>]]></content>
    
    
    <categories>
      
      <category>Flask</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>flask</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>scrapy的基本使用</title>
    <link href="/2021/05/29/scrapy%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
    <url>/2021/05/29/scrapy%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="抓取目标"><a href="#抓取目标" class="headerlink" title="抓取目标"></a>抓取目标</h2><p>要完成的任务如下。</p><ul><li>创建一个<code>Scrapy</code>项目。</li><li>创建一个<code>Spider</code>来抓取站点和处理数据。</li><li>通过命令行将抓取的内容导出。</li><li>将抓取的内容保存到<code>MongoDB</code>数据库。</li></ul><p>抓取的目标站点为<a href="http://quotes.toscrape.com/"></a>。</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>安装好<code>scrapy</code>框架、<code>MongoDB</code>和<code>PyMongo</code>库。</p><h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>创建一个<code>Scrapy</code>项目，项目文件可以直接用<code>Scrapy</code>命令生成，命令如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy startproject tutorial<br></code></pre></div></td></tr></table></figure><p>这个命令将会创建一个名为<code>tutorial</code>的文件夹，文件夹结构如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy.cfg    <span class="hljs-comment"># Scrapy 部署时的配置文件 </span><br>tutorial    <span class="hljs-comment"># 项目的模块，引入的时候需要从这里引入 </span><br>  __init__.py <br>  items.py    <span class="hljs-comment"># Items 的定义，定义爬取的数据结构 </span><br>  middlewares.py     <span class="hljs-comment"># Middlewares 的定义，定义爬取时的中间件 </span><br>  pipelines.py    <span class="hljs-comment"># Pipelines 的定义，定义数据管道 </span><br>  settings.py     <span class="hljs-comment"># 配置文件 </span><br>  spiders     <span class="hljs-comment"># 放置 Spiders 的文件夹 </span><br>    __init__.py<br></code></pre></div></td></tr></table></figure><h2 id="创建Spider"><a href="#创建Spider" class="headerlink" title="创建Spider"></a>创建Spider</h2><p><code>Spider</code>是自己定义的类，<code>Scrapy</code>用它从网页里抓取内容，并解析抓取的结果。不过这个类必须继承<code>Scrapy</code>提供的<code>Spider</code>类<code>scrapy.Spider</code>，还要定义<code>Spider</code>的名称和起始请求，以及怎样处理爬取后的结果的方法。</p><p>也可以使用命令行创建一个<code>Spider</code>。比如要生成<code>Quotes</code>这个<code>Spider</code>，可以执行如下命令：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>scrapy genspider quotes quotes.toscrape.com     <br>Created spider <span class="hljs-string">&#x27;quotes&#x27;</span> using template <span class="hljs-string">&#x27;basic&#x27;</span> <span class="hljs-keyword">in</span> module:<br>  tutorial.spiders.quotes<br></code></pre></div></td></tr></table></figure><p>进入刚才创建的<code>tutorial</code>文件夹，然后执行<code>genspider</code>命令。第一个参数是<code>Spider</code>的名称，第二个参数是<code>网站域名</code>。执行完毕之后，<code>spiders</code>文件夹中多了一个<code>quotes.py</code>，它就是刚刚创建的<code>Spider</code>，内容如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> scrapy<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuotesSpider</span>(<span class="hljs-params">scrapy.Spider</span>):</span><br>    name = <span class="hljs-string">&#x27;quotes&#x27;</span><br>    allowed_domains = [<span class="hljs-string">&#x27;quotes.toscrape.com&#x27;</span>]<br>    start_urls = [<span class="hljs-string">&#x27;http://quotes.toscrape.com/&#x27;</span>]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span><br>        <span class="hljs-keyword">pass</span><br></code></pre></div></td></tr></table></figure><p>这里有三个属性——<code>name</code>、<code>allowed_domains</code>和<code>start_urls</code>，还有一个方法<code>parse</code>。</p><ul><li><code>name</code>：它是每个项目唯一的名字，用来区分不同的<code>Spider</code>。</li><li><code>allowed_domains</code>：它是允许爬取的域名，如果初始或后续的请求链接不是这个域名下的，则请求链接会被过滤掉。</li><li><code>start_urls</code>：它包含了<code>Spider</code>在启动时爬取的<code>url</code>列表，初始请求是由它来定义的。</li><li><code>parse</code>：它是<code>Spider</code>的一个方法。默认情况下，被调用时<code>start_urls</code>里面的链接构成的请求完成下载执行后，返回的响应就会作为唯一的参数传递给这个函数。该方法负责解析返回的响应、提取数据或者进一 步生成要处理的请求。</li></ul><h2 id="创建Item"><a href="#创建Item" class="headerlink" title="创建Item"></a>创建Item</h2><p><code>Item</code>是保存爬虫数据的容器，它的使用方法和字典类似，不过相比字典，<code>Item</code>多了额外的保护机制，可以避免拼写错误或者定义字段错误。</p><p>创建<code>Item</code>需要继承<code>scrapy.Item</code>类，并且定义类型为<code>scrapy.Field</code>的字段。观察目标网站，可以获取到的内容有<code>text</code>、<code>author</code>、<code>tags</code>。</p><p>定义<code>Item</code>，此时将<code>items.py</code>修改如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> scrapy<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuoteItem</span>(<span class="hljs-params">scrapy.Item</span>):</span><br>    <span class="hljs-comment"># define the fields for your item here like:</span><br>    <span class="hljs-comment"># name = scrapy.Field()</span><br>    text = scrapy.Field()<br>    author = scrapy.Field()<br>    tags = scrapy.Field()<br></code></pre></div></td></tr></table></figure><p>这里定义了三个字段，将类的名称修改为<code>QuoteItem</code>，接下来爬取时会使用到这个<code>Item</code>。</p><h2 id="解析Response"><a href="#解析Response" class="headerlink" title="解析Response"></a>解析Response</h2><p><code>parse</code>方法的参数<code>response</code>是<code>start_urls</code>里面的链接爬取后的结果。所以在<code>parse</code>方法中，可以直接对<code>response</code>变量包含的内容进行解析，比如浏览请求结果的网页源代码，或者进一步分析源代码内容，或者找出结果中的链接而得到下一个请求。</p><p>首先看看网页结构，如图所示。每一页都有多个<code>class</code>为<code>quote</code>的区块，每个区块内都包含<code>text</code>、<code>author</code>、<code>tags</code>。那么先找出所有的<code>quote</code>，然后提取每一个<code>quote</code>中的内容。</p><p><img src="Screenshot_1.webp" alt="Screenshot_1"></p><p>提取的方式可以是<code>CSS</code>选择器或<code>XPath</code>选择器。在这里使用<code>CSS</code>选择器进行选择，<code>parse</code>方法的改写如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuotesSpider</span>(<span class="hljs-params">scrapy.Spider</span>):</span><br>    name = <span class="hljs-string">&#x27;quotes&#x27;</span><br>    allowed_domains = [<span class="hljs-string">&#x27;http://quotes.toscrape.com/&#x27;</span>]<br>    start_urls = [<span class="hljs-string">&#x27;http://http://quotes.toscrape.com//&#x27;</span>]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span><br>        quotes = response.css(<span class="hljs-string">&#x27;.quote&#x27;</span>)<br>        <span class="hljs-keyword">for</span> quote <span class="hljs-keyword">in</span> quotes:<br>            text = quote.css(<span class="hljs-string">&#x27;.text::text&#x27;</span>).extract_first()<br>            author = quote.css(<span class="hljs-string">&#x27;.author::text&#x27;</span>).extract_first()<br>            tags = quote.css(<span class="hljs-string">&#x27;.tags .tag::text&#x27;</span>).extract()<br></code></pre></div></td></tr></table></figure><p>对于<code>text</code>，获取结果的第一个元素即可，所以使用<code>extract_first</code>方法，对于<code>tags</code>，要获取所有结果组成的列表，所以使用<code>extract</code>方法。</p><h2 id="使用Item"><a href="#使用Item" class="headerlink" title="使用Item"></a>使用Item</h2><p>上文定义了<code>Item</code>，接下来就要使用它了。<code>Item</code>可以理解为一个字典，不过在声明的时候需要实例化。然后依次用刚才解析的结果赋值<code>Item</code>的每一个字段，最后将<code>Item</code>返回即可。</p><p><code>QuotesSpider</code>的改写如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span><br>    quotes = response.css(<span class="hljs-string">&#x27;.quote&#x27;</span>)<br>    <span class="hljs-keyword">for</span> quote <span class="hljs-keyword">in</span> quotes:<br>        item = QuoteItem()<br>        item[<span class="hljs-string">&#x27;text&#x27;</span>] = quote.css(<span class="hljs-string">&#x27;.text::text&#x27;</span>).extract_first()<br>        item[<span class="hljs-string">&#x27;author&#x27;</span>] = quote.css(<span class="hljs-string">&#x27;.author::text&#x27;</span>).extract_first()<br>        item[<span class="hljs-string">&#x27;tags&#x27;</span>] = quote.css(<span class="hljs-string">&#x27;.tags .tag::text&#x27;</span>).extract()<br>        <span class="hljs-keyword">yield</span> item<br></code></pre></div></td></tr></table></figure><p>如此一来，首页的所有内容被解析出来，并被赋值成了一个个<code>QuoteItem</code>。</p><h2 id="后续Request"><a href="#后续Request" class="headerlink" title="后续Request"></a>后续Request</h2><p>接下来就需要从当前页面中找到信息来生成下一个请求，然后在下一个请求的页面里面找到信息再构造下一个请求。这样循环往复迭代，从而实现整站的爬取。</p><p>将刚才的页面拉到最底部，如图所示。</p><p><img src="Screenshot_2.webp"></p><p>有一个<code>Next</code>按钮，查看一下源代码，可以发现它的链接是<code>/page/2/</code>，实际上全链接就是：<code>http://quotes.toscrape.com/page/2</code>，通过这个链接我们就可以构造下一个请求。</p><p>构造请求时需要用到<code>scrapy.Request</code>。这里传递两个参数——<code>url</code>和<code>callback</code>，这两个参数的说明如下。</p><ul><li><code>url</code>：它是请求链接。</li><li><code>callback</code>：它是回调函数。当指定了该回调函数的请求完成之后，获取到响应，引擎会将该响应作为参数传递给这个回调函数。回调函数进行解析或生成下一个请求，回调函数如上文的<code>parse()</code>所示。</li></ul><p>由于<code>parse</code>就是解析<code>text</code>、<code>author</code>、<code>tags</code>的方法，而下一页的结构和刚才已经解析的页面结构是一样的，所以可以再次使用<code>parse</code>方法来做页面解析。</p><p>接下来要做的就是利用选择器得到下一页链接并生成请求，在<code>parse</code>方法后追加如下的代码：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-built_in">next</span> = response.css(<span class="hljs-string">&#x27;.pager .next a::attr(href)&#x27;</span>).extract_first()<br>url = response.urljoin(<span class="hljs-built_in">next</span>)<br><span class="hljs-keyword">yield</span> scrapy.Request(url=url, callback=self.parse, dont_filter=<span class="hljs-literal">True</span>)<br></code></pre></div></td></tr></table></figure><p>第一句代码首先通过<code>CSS</code>选择器获取下一个页面的链接，即要获取<code>a</code>超链接中的<code>href</code>属性。这里用到了<code>::attr(href)</code>操作。然后再调用<code>extract_first</code>方法获取内容。</p><p>第二句代码调用了<code>urljoin</code>方法，<code>urljoin()</code>方法可以将相对<code>URL</code>构造成一个绝对的<code>URL</code>。例如，获取到的下一页地址是<code>/page/2</code>，<code>urljoin</code>方法处理后得到的结果就是：<code>http://quotes.toscrape.com/page/2/</code>。</p><p>第三句代码通过<code>url</code>和<code>callback</code>变量构造了一个新的请求，回调函数<code>callback</code>依然使用<code>parse</code>方法。这个请求完成后，响应会重新经过<code>parse</code>方法处理，得到第二页的解析结果，然后生成第二页的下一页，也就是第三页的请求。这样爬虫就进入了一个循环，直到最后一页。<code>dont_filter</code>设置为<code>Ture</code>不进行域名过滤，这样就能继续爬取。</p><p>通过几行代码，就轻松实现了一个抓取循环，将每个页面的结果抓取下来了。现在，改写之后的整个<code>Spider</code>类如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> scrapy<br><span class="hljs-keyword">from</span> tutorial.items <span class="hljs-keyword">import</span> QuoteItem<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuotesSpider</span>(<span class="hljs-params">scrapy.Spider</span>):</span><br>    name = <span class="hljs-string">&#x27;quotes&#x27;</span><br>    allowed_domains = [<span class="hljs-string">&#x27;quotes.toscrape.com/&#x27;</span>]<br>    start_urls = [<span class="hljs-string">&#x27;http://quotes.toscrape.com/&#x27;</span>]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span><br>        quotes = response.css(<span class="hljs-string">&#x27;.quote&#x27;</span>)<br>        <span class="hljs-keyword">for</span> quote <span class="hljs-keyword">in</span> quotes:<br>            item = QuoteItem()<br>            item[<span class="hljs-string">&#x27;text&#x27;</span>] = quote.css(<span class="hljs-string">&#x27;.text::text&#x27;</span>).extract_first()<br>            item[<span class="hljs-string">&#x27;author&#x27;</span>] = quote.css(<span class="hljs-string">&#x27;.author::text&#x27;</span>).extract_first()<br>            item[<span class="hljs-string">&#x27;tags&#x27;</span>] = quote.css(<span class="hljs-string">&#x27;.tags .tag::text&#x27;</span>).extract()<br>            <span class="hljs-keyword">yield</span> item<br><br>        <span class="hljs-built_in">next</span> = response.css(<span class="hljs-string">&#x27;.pager .next a::attr(href)&#x27;</span>).extract_first()<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">next</span> !== <span class="hljs-string">&quot;&quot;</span>:<br>          url = response.urljoin(<span class="hljs-built_in">next</span>)<br>          <span class="hljs-keyword">yield</span> scrapy.Request(url=url, callback=self.parse, dont_filter=<span class="hljs-literal">True</span>)<br></code></pre></div></td></tr></table></figure><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>进入目录，运行如下命令：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy crawl quotes<br></code></pre></div></td></tr></table></figure><p>爬虫一边解析，一边翻页，直至将所有内容抓取完毕，然后终止。</p><p>最后，<code>Scrapy</code>输出了整个抓取过程的统计信息，如请求的字节数、请求次数、响应次数、完成原因等。</p><h2 id="保存到文件"><a href="#保存到文件" class="headerlink" title="保存到文件"></a>保存到文件</h2><p><code>Scrapy</code>提供的<code>Feed Exports</code>可以轻松将抓取结果输出。例如，想将上面的结果保存成<code>JSON</code>文件，可以执行如下命令：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy crawl quotes -o quotes.json<br></code></pre></div></td></tr></table></figure><p>命令运行后，项目内多了一个<code>quotes.json</code>文件，文件包含了刚才抓取的所有内容，内容是<code>JSON</code>格式。</p><p><img src="Screenshot_3.webp"></p><p>另外还可以每一个<code>Item</code>输出一行<code>JSON</code>，输出后缀为<code>jl</code>，为<code>jsonline</code>的缩写，命令如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy crawl quotes -o quotes.jl<br></code></pre></div></td></tr></table></figure><p>或</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy crawl quotes -o quotes.jsonlines<br></code></pre></div></td></tr></table></figure><p>输出格式还支持很多种，例如<code>csv</code>、<code>xml</code>、<code>pickle</code>、<code>marshal</code>等，还支持<code>ftp</code>、<code>s3</code> 等远程输出，另外还可以通过自定义<code>ItemExporter</code>来实现其他的输出。</p><p>例如，下面命令对应的输出分别为<code>csv</code>、<code>xml</code>、<code>pickle</code>、<code>marshal</code>格式以及<code>ftp</code>远程输出：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy crawl quotes -o quotes.csv<br>scrapy crawl quotes -o quotes.xml<br>scrapy crawl quotes -o quotes.pickle<br>scrapy crawl quotes -o quotes.marshal<br>scrapy crawl quotes -o ftp://user:<span class="hljs-keyword">pass</span>@ftp.example.com/path/to/quotes.csv <br></code></pre></div></td></tr></table></figure><p>其中，<code>ftp</code>输出需要正确配置用户名、密码、地址、输出路径，否则会报错。通过<code>Scrapy</code>提供的<code>Feed Exports</code>，可以轻松地输出抓取结果到文件。对于一些小型项目来说，这应该足够了。不过如果想要更复杂的输出，如输出到数据库等，可以使用<code>ItemPileline</code>来完成。</p><h2 id="使用ItemPileline"><a href="#使用ItemPileline" class="headerlink" title="使用ItemPileline"></a>使用ItemPileline</h2><p>如果想进行更复杂的操作，如将结果保存到<code>MongoDB</code>数据库，或者筛选某些有用的<code>Item</code>，则可以定义<code>ItemPipeline</code>来实现。</p><p><code>ItemPipeline</code>为项目管道。当<code>Item</code>生成后，它会自动被送到<code>ItemPipeline</code>进行处理，常用<code>ItemPipeline</code>来做如下操作。</p><ul><li>清洗<code>HTML</code>数据；</li><li>验证爬取数据，检查爬取字段；</li><li>查重并丢弃重复内容；</li><li>将爬取结果储存到数据库。</li></ul><p>要实现<code>ItemPipeline</code>很简单，只需要定义一个类并实现<code>process_item</code>方法即可。启用<code>ItemPipeline</code>后，<code>ItemPipeline</code>会自动调用这个方法。<code>process_item</code>方法必须返回包含数据的字典或<code>Item</code>对象，或者抛出<code>DropItem</code>异常。</p><p><code>process_item</code>方法有两个参数。一个参数是<code>item</code>，每次<code>Spider</code>生成的<code>Item</code>都会作为参数传递过来。另一个参数是<code>spider</code>，就是<code>Spider</code>的实例。</p><p>接下来，实现一个<code>ItemPipeline</code>，筛掉<code>text</code>长度大于<code>50</code>的<code>Item</code>，并将结果保存到<code>MongoDB</code>。</p><p>修改项目里的<code>pipelines</code>.py文件，之前用命令行自动生成的文件内容可以删掉，增加一个<code>TextPipeline</code>类，内容如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> scrapy.exceptions <span class="hljs-keyword">import</span> DropItem<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextPipeline</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.limit = <span class="hljs-number">50</span><br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_item</span>(<span class="hljs-params">self, item, spider</span>):</span><br>        <span class="hljs-keyword">if</span> item[<span class="hljs-string">&#x27;text&#x27;</span>]:<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(item[<span class="hljs-string">&#x27;text&#x27;</span>]) &gt; self.limit:<br>                item[<span class="hljs-string">&#x27;text&#x27;</span>] =item[<span class="hljs-string">&#x27;text&#x27;</span>][<span class="hljs-number">0</span>:self.limit].rstrip() + <span class="hljs-string">&#x27;...&#x27;</span><br>                <span class="hljs-keyword">return</span> item<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> DropItem<br></code></pre></div></td></tr></table></figure><p>这段代码在构造方法里定义了限制长度为50，实现了<code>process_item</code>方法，其参数是<code>item</code>和<code>spider</code>。首先该方法判断<code>item</code>的<code>text</code>属性是否存在，如果不存在，则抛出<code>DropItem</code>异常；如果存在，再判断长度是否大于50，如果大于，那就截断然后拼接省略号，再将<code>item</code>返回即可。</p><p>将处理后的<code>item</code>存入<code>MongoDB</code>，定义另外一个<code>Pipeline</code>。同样在<code>pipelines.py</code>中，实现另一个类<code>MongoPipeline</code>，内容如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymongo<br><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">from_crawler</span>(<span class="hljs-params">cls, crawler</span>):</span><br>        <span class="hljs-keyword">return</span> cls(mongo_uri=crawler.settings.get(<span class="hljs-string">&#x27;MONGO_URI&#x27;</span>), mongo_db=crawler.settings.get(<span class="hljs-string">&#x27;MONGO_DB&#x27;</span>))<br>        <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">open_spider</span>(<span class="hljs-params">self, spider</span>):</span><br>        self.client = pymongo.MongoClient(self.mongo_uri)<br>        self.db = self.client[self.mongo_db]<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_item</span>(<span class="hljs-params">self, item, spider</span>):</span> <br>        name = item.__class__.__name__ <br>        self.db[name].insert(<span class="hljs-built_in">dict</span>(item)) <br>        <span class="hljs-keyword">return</span> item <br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">close_spider</span>(<span class="hljs-params">self, spider</span>):</span> <br>        self.client.close()<br></code></pre></div></td></tr></table></figure><p><code>MongoPipeline</code>类实现了<code>API</code>定义的另外几个方法。</p><ul><li><code>from_crawler</code>：这是一个类方法，用<code>@classmethod</code>标识，是一种依赖注入的方式，方法的参数就是<code>crawler</code>，通过<code>crawler</code>这个参数我们可以拿到全局配置的每个配置信息，在全局配置<code>settings.py</code>中可以定义<code>MONGO_URI</code>和<code>MONGO_DB</code>来指定<code>MongoDB</code>连接需要的地址和数据库名称，拿到配置信息之后返回类对象即可。所以这个方法的定义主要是用来获取<code>settings.py</code>中的配置的。</li><li><code>open_spider</code>：当<code>Spider</code>被开启时，这个方法被调用。在这里主要进行了一些初始化操作。</li><li><code>close_spider</code>：当<code>Spider</code>被关闭时，这个方法会调用，在这里将数据库连接关闭。</li></ul><p>最主要的<code>process_item</code>方法则执行了数据插入操作。</p><p>定义好<code>TextPipeline</code>和<code>MongoPipeline</code>这两个类后，需要在<code>settings.py</code>中使用它们。<code>MongoDB</code>的连接信息还需要定义。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">ITEM_PIPELINES = &#123;<br>    <span class="hljs-string">&#x27;tutorial.pipelines.TextPipeline&#x27;</span>: <span class="hljs-number">300</span>,<br>    <span class="hljs-string">&#x27;tutorial.pipelines.MongoPipeline&#x27;</span>: <span class="hljs-number">400</span>,<br>&#125;<br>MONGO_URI=<span class="hljs-string">&#x27;localhost&#x27;</span><br>MONGO_DB=<span class="hljs-string">&#x27;tutorial&#x27;</span><br></code></pre></div></td></tr></table></figure><p>赋值<code>ITEM_PIPELINES</code>字典，键名是<code>Pipeline</code>的类名称，键值是调用优先级，是一个数字，数字越小则对应的<code>Pipeline</code>越先被调用。<br>再重新执行爬取，命令如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy crawl quotes<br></code></pre></div></td></tr></table></figure><p>爬取结束后，<code>MongoDB</code>中创建了一个<code>tutorial</code>的数据库、<code>QuoteItem</code>的表。</p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>scrapy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>scrapy框架介绍</title>
    <link href="/2021/05/29/scrapy%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D/"/>
    <url>/2021/05/29/scrapy%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<h2 id="Scrapy介绍"><a href="#Scrapy介绍" class="headerlink" title="Scrapy介绍"></a>Scrapy介绍</h2><p><code>Scrapy</code>是一个基于<code>Twisted</code>的异步处理框架，是纯<code>Python</code>实现的爬虫框架，其架构清晰，模块之间的耦合程度低，可扩展性极强，可以灵活完成各种需求。只需要定制开发几个模块就可以轻松实现一个爬虫。</p><p><code>Scrapy</code>框架主要实现下面的流程：</p><pre><code class=" mermaid">graph RL    A[内容提取]--url---&gt;B[url队列]    B--url---&gt;C[发送请求]    C--respone---&gt;A    D[提取URL]---&gt;A    E[提取数据]---&gt;A    A--数据---&gt;F[数据队列]    F---&gt;G[保存数据]</code></pre><p>来看下<code>Scrapy</code>框架的架构，如图所示：</p><p><img src="Screenshot_1.webp"></p><p>它可以分为如下的几个部分。</p><ul><li><code>Engine（引擎）</code>：用来处理整个系统的数据流处理、触发事务，是整个框架的核心。</li><li><code>Item（项目）</code>：定义了爬取结果的数据结构，爬取的数据会被赋值成该对象。</li><li><code>Scheduler（调度器）</code>：用来接受引擎发过来的请求并加入队列中，并在引擎再次请求的时候提供给引擎。</li><li><code>Downloader（下载器）</code>：用于下载网页内容，并将网页内容返回给蜘蛛。</li><li><code>Spiders（蜘蛛）</code>：其内定义了爬取的逻辑和网页的解析规则，它主要负责解析响应并生成提取结果和新的请求。</li><li><code>ItemPipeline（项目管道）</code>：负责处理由蜘蛛从网页中抽取的项目，它的主要任务是清洗、验证和存储数据。</li><li><code>Downloader Middlewares（下载器中间件）</code>：位于引擎和下载器之间的钩子框架，主要是处理引擎与下载器之间的请求及响应。</li><li><code>Spider Middlewares（蜘蛛中间件）</code>：位于引擎和蜘蛛之间的钩子框架，主要工作是处理蜘蛛输入的响应和输出的结果及新的请求。</li></ul><h2 id="数据流"><a href="#数据流" class="headerlink" title="数据流"></a>数据流</h2><p>了解了架构，就是要了解它是怎么进行数据爬取和处理的，所以接下来介绍<code>Scrapy</code>的数据流机制。</p><p><code>Scrapy</code>中的数据流由引擎控制，其过程如下：</p><ul><li><code>Engine</code>首先打开一个网站，找到处理该网站的<code>Spider</code>并向该<code>Spider</code>请求第一个要爬虫的<code>URL</code>。</li><li><code>Engine</code>从<code>Spider</code>中获取到第一个要爬取的<code>URL</code>并通过<code>Scheduler</code>以<code>Request</code>的形式调度。</li><li><code>Engine</code>向<code>Scheduler</code>请求下一个要爬取的<code>URL</code>。</li><li><code>Scheduler</code>返回下一个要爬取的<code>URL</code>给<code>Engine</code>，<code>Engine</code>将<code>URL</code>通过<code>Downloader Middlewares</code>转发给<code>Downloader</code>下载。</li><li>一旦页面下载完毕， <code>Downloader</code>生成一个该页面的<code>Response</code>，并将其通过<code>Downloader Middlewares</code>发送给<code>Engine</code>。</li><li><code>Engine</code>从下载器中接收到<code>Response</code>并通过<code>Spider Middlewares</code>发送给<code>Spider</code>处理。</li><li><code>Spider</code>处理<code>Response</code>并返回爬取到的<code>Item</code>及新的<code>Request</code>给<code>Engine</code>。</li><li><code>Engine</code>将<code>Spider</code>返回的<code>Item</code>给<code>ItemPipeline</code>，将新的<code>Request</code>给<code>Scheduler</code>。</li><li>重复第二步到最后一步，直到<code>Scheduler</code>中没有更多的<code>Request</code>，<code>Engine</code>关闭该网站，爬取结束。</li></ul><p>通过多个组件的相互协作、不同组件完成工作的不同、组件对异步处理的支持，<code>Scrapy</code>最大限度地利用了网络带宽，大大提高了 数据爬取和处理的效率。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>使用官方文档推荐的方式安装就可以了：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install scrapy<br></code></pre></div></td></tr></table></figure><h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p>安装完成后，就可以使用<code>Scrapy</code>预先配置好的很多可用的组件和编写爬虫时所用的脚手架。</p><p>创建项目的命令如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy startproject demo<br></code></pre></div></td></tr></table></figure><p>执行完成之后，在当前运行目录下便会出现一个文件夹，叫作<code>demo</code>，这就是一个<code>Scrapy</code>项目框架，可以基于这个项目框架来编写爬虫。</p><p>项目文件结构如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">scrapy.cfg <br>project/ <br>  __init__.py<br>  items.py <br>  pipelines.py <br>  settings.py <br>  middlewares.py <br>  spiders/<br>    __init__.py<br>    spider1.py<br>    spider2.py<br>    ...<br></code></pre></div></td></tr></table></figure><p>在此要将各个文件的功能描述如下：</p><ul><li><code>scrapy.cfg</code>：它是<code>Scrapy</code>项目的配置文件，其内定义了项目的配置文件路径、部署相关信息等内容。</li><li><code>items.py</code>：它定义<code>Item</code>数据结构，所有的<code>Item</code>的定义都可以放这里。</li><li><code>pipelines.py</code>：它定义<code>ItemPipeline</code>的实现，所有的<code>ItemPipeline</code>的实现都可以放这里。</li><li><code>settings.py</code>：它定义项目的全局配置。</li><li><code>middlewares.py</code>：它定义<code>Spider Middlewares</code>和<code>Downloader Middlewares</code>的实现。</li><li><code>spiders</code>：其内包含一个个<code>Spider</code>的实现，每个<code>Spider</code>都有一个文件。</li></ul>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>scrapy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python的内置类型</title>
    <link href="/2021/05/28/python%E7%9A%84%E5%86%85%E7%BD%AE%E7%B1%BB%E5%9E%8B/"/>
    <url>/2021/05/28/python%E7%9A%84%E5%86%85%E7%BD%AE%E7%B1%BB%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="字符串与字节"><a href="#字符串与字节" class="headerlink" title="字符串与字节"></a>字符串与字节</h2><p><code>Python3</code>中只有一种能够保存文本信息的数据类型，就是<code>str</code>(<code>string</code>，字符串)。它是不可变的序列，保存的<code>Unicode</code>码位(<code>code point</code>)。</p><p>字符串可以保存的数据类型有非常明确的限制，就是<code>Unicode</code>文本。</p><p><code>bytes</code>以及可变的<code>bytearray</code>与<code>str</code>不同，只能用字节作为序列值，即<code>0&lt;=x&lt;256</code>范围内的整数。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">bytes</span>([<span class="hljs-number">102</span>,<span class="hljs-number">111</span>,<span class="hljs-number">111</span>])<br><span class="hljs-string">b&#x27;foo&#x27;</span><br></code></pre></div></td></tr></table></figure><p>对于<code>bytes</code>和<code>bytearray</code>，在转换为另一种序列类型（例如<code>list</code>或<code>tuple</code>）时可以显示出其本来面目：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(<span class="hljs-string">b&#x27;foo bar&#x27;</span>)<br>[<span class="hljs-number">102</span>, <span class="hljs-number">111</span>, <span class="hljs-number">111</span>, <span class="hljs-number">32</span>, <span class="hljs-number">98</span>, <span class="hljs-number">97</span>, <span class="hljs-number">114</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">tuple</span>(<span class="hljs-string">b&#x27;foo bar&#x27;</span>)<br>(<span class="hljs-number">102</span>, <span class="hljs-number">111</span>, <span class="hljs-number">111</span>, <span class="hljs-number">32</span>, <span class="hljs-number">98</span>, <span class="hljs-number">97</span>, <span class="hljs-number">114</span>)<br></code></pre></div></td></tr></table></figure><p>从<code>Python3.0</code>开始，所有没有前缀的字符串都是<code>Unicode</code>。因此，所有用单引号（’）、双引号（”）或成组的3个引号（单引号或双引号）包围且没有前缀的值都表示<code>str</code>数据类型：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">type</span>(<span class="hljs-string">&quot;some string&quot;</span>)<br>&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">str</span>&#x27;&gt;</span><br></code></pre></div></td></tr></table></figure><p>字节也被单引号、双引号或三引号包围，但必须有一个<code>b</code>或<code>B</code>前缀：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">type</span>(<span class="hljs-string">b&quot;some bytes&quot;</span>)<br>&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">bytes</span>&#x27;&gt;</span><br></code></pre></div></td></tr></table></figure><p><code>Python</code>字符串是不可变的。字节序列也是如此。<code>bytearray</code>是<code>bytes</code>的可变版本，不存在这样的问题。字节数组可以通过元素赋值来进行原处修改（无需创建新对象），其大小也可以像列表一样动态地变化（利用<code>append</code>、<code>pop</code>、<code>inseer</code>等方法）。</p><h3 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h3><p>用<code>str.join()</code>方法。它接受可迭代的字符串作为参数，返回合并后的字符串。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;,&#x27;</span>.join([<span class="hljs-string">&#x27;some&#x27;</span>,<span class="hljs-string">&#x27;one&#x27;</span>,<span class="hljs-string">&#x27;like&#x27;</span>,<span class="hljs-string">&#x27;you&#x27;</span>,<span class="hljs-string">&#x27;forever&#x27;</span>])<br><span class="hljs-string">&#x27;some,one,like,you,forever&#x27;</span><br></code></pre></div></td></tr></table></figure><p>因为<code>join()</code>方法速度更快（对于大型列表来说更是如此），并不意味着在所有需要拼接两个字符串的情况下都应该使用这一方法。虽然这是一种广为认可的做法，但并不会提高代码的可读性。可读性是很重要的！在某些情况下，<code>join()</code>的性能可能还不如利用加法的普通拼接。</p><h2 id="集合类型"><a href="#集合类型" class="headerlink" title="集合类型"></a>集合类型</h2><h3 id="列表和元组"><a href="#列表和元组" class="headerlink" title="列表和元组"></a>列表和元组</h3><p>列表是动态的，其大小可以改变；而元组是不可变的，一旦创建就不能修改。</p><p><code>tuple是</code>不可变的（immutable），因此也是可哈希的（hashable）</p><p>从细节上来看，<code>Python</code>中的列表是由对其他对象的引用组成的的连续数组。指向这个数组的指针及其长度被保存在一个列表头结构中。这意味着，每次添加或删除一个元素时，由引用组成的数组需要改变大小（重新分配）。幸运的是，<code>Python</code>在创建这些数组时采用了指数过分配（exponential over-allocation），所以并不是每次操作都需要改变数组大小。这也是添加或取出元素的平摊复杂度较低的原因。不幸的是，在普通链表中“代价很小”的其他一些操作在<code>Python</code>中的计算复杂度却相对较高：</p><ul><li>利用<code>list.insert</code>方法在任意位置插入一个元素——复杂度为<code>O(n)</code>。</li><li>利用<code>list.delete</code>或<code>del</code>删除一个元素——复杂度为<code>O(n)</code>。</li></ul><p><img src="Screenshot_1.webp"></p><h4 id="列表推导"><a href="#列表推导" class="headerlink" title="列表推导"></a>列表推导</h4><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>evens = []<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">if</span> i%<span class="hljs-number">2</span> == <span class="hljs-number">0</span>:<br><span class="hljs-meta">... </span>            evens.append(i)<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>evens<br>[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>]<br></code></pre></div></td></tr></table></figure><p>这种写法可能适用于<code>C</code>语言，但在<code>Python</code>中的实际运行速度很慢，原因如下。</p><ul><li>解释器在每次循环中都需要判断序列中的哪一部分需要修改。</li><li>需要用一个计数器来跟踪需要处理的元素。</li><li>由于<code>append()</code>是一个列表方法，所以每次遍历时还需要额外执行一个查询函数。</li></ul><p>列表推导正是解决这个问题的正确方法。它使用编排好的功能对上述语法的一部分做了自动化处理：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">if</span> i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>]<br>[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>]<br></code></pre></div></td></tr></table></figure><p>这种写法除了更加高效之外，也更加简短，涉及的语法元素也更少。在大型程序中，这意味着更少的错误，代码也更容易阅读和理解。</p><h4 id="其他习语"><a href="#其他习语" class="headerlink" title="其他习语"></a>其他习语</h4><p><code>Python</code>习语的另一个典型例子是使用<code>enumerate</code>（枚举）。在循环中使用序列时，这个内置函数可以很方便地获取其索引。以下面这段代码为例：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> element <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;one&#x27;</span>,<span class="hljs-string">&#x27;two&#x27;</span>,<span class="hljs-string">&#x27;three&#x27;</span>]:<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(i, element)<br><span class="hljs-meta">... </span>    i += <span class="hljs-number">1</span><br>...<br><span class="hljs-number">0</span> one<br><span class="hljs-number">1</span> two<br><span class="hljs-number">2</span> three<br></code></pre></div></td></tr></table></figure><p>它可以替换为下面这段更短的代码：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> i, element <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>([<span class="hljs-string">&#x27;one&#x27;</span>,<span class="hljs-string">&#x27;two&#x27;</span>,<span class="hljs-string">&#x27;three&#x27;</span>]):<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(i, element)<br>...<br><span class="hljs-number">0</span> one<br><span class="hljs-number">1</span> two<br><span class="hljs-number">2</span> three<br></code></pre></div></td></tr></table></figure><h4 id="序列解包（sequence-unpacking）"><a href="#序列解包（sequence-unpacking）" class="headerlink" title="序列解包（sequence unpacking）"></a>序列解包（sequence unpacking）</h4><p>这种方法并不限于列表和元组，而是适用于任意序列类型（甚至包括字符串和字节序列）。只要赋值运算符左边的变量数目与序列中的元素数目相等，你都可以用这种方法将元素序列解包到另一组变量中：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>first, second, third = <span class="hljs-string">&quot;holy&quot;</span>, <span class="hljs-string">&quot;chan&quot;</span>, <span class="hljs-number">100</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>first<br><span class="hljs-string">&#x27;holy&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>second<br><span class="hljs-string">&#x27;chan&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>third<br><span class="hljs-number">100</span><br></code></pre></div></td></tr></table></figure><p>解包还可以利用带星号的表达式获取单个变量中的多个元素，只要它的解释没有歧义即可。还可以对嵌套序列进行解包。特别是在遍历由序列构成的复杂数据结构时，这种方法非常实用。下面是一些更复杂的解包示例</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># 带星号的表达式可以获取序列的剩余部分</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>first, second, *rest = <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>first<br><span class="hljs-number">0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>second<br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>rest<br>[<span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># 带星号的表达式可以获取序列的中间部分</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>first, *inner, last = <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>first<br><span class="hljs-number">0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>inner<br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>last<br><span class="hljs-number">3</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># 嵌套解包</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>(a,b), (c,d) = (<span class="hljs-number">1</span>,<span class="hljs-number">2</span>), (<span class="hljs-number">3</span>,<span class="hljs-number">4</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>a, b, c, d<br>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<br></code></pre></div></td></tr></table></figure><h3 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h3><p>字典是<code>Python</code>中最通用的数据结构之一。<code>dict</code>可以将一组唯一键映射到对应的值，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<br>  <span class="hljs-number">1</span>: <span class="hljs-string">&#x27;one&#x27;</span>,<br>  <span class="hljs-number">2</span>: <span class="hljs-string">&#x27;two&#x27;</span>,<br>  <span class="hljs-number">3</span>: <span class="hljs-string">&#x27;three&#x27;</span>,<br>&#125;<br></code></pre></div></td></tr></table></figure><p>可以用和前面列表推导类似的推导来创建一个新的字典。这里有一个非常简单的例子如下所示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>squares = &#123;number: number ** <span class="hljs-number">2</span> <span class="hljs-keyword">for</span> number <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>squares<br>&#123;<span class="hljs-number">0</span>: <span class="hljs-number">0</span>, <span class="hljs-number">1</span>: <span class="hljs-number">1</span>, <span class="hljs-number">2</span>: <span class="hljs-number">4</span>, <span class="hljs-number">3</span>: <span class="hljs-number">9</span>, <span class="hljs-number">4</span>: <span class="hljs-number">16</span>, <span class="hljs-number">5</span>: <span class="hljs-number">25</span>, <span class="hljs-number">6</span>: <span class="hljs-number">36</span>, <span class="hljs-number">7</span>: <span class="hljs-number">49</span>, <span class="hljs-number">8</span>: <span class="hljs-number">64</span>, <span class="hljs-number">9</span>: <span class="hljs-number">81</span>&#125;<br></code></pre></div></td></tr></table></figure><p>在许多情况下，字典推导要更加高效、更加简短、更加整洁。对于更复杂的代码而言，需要用到许多<code>if</code>语句或函数调用来创建一个字典，这时最好使用简单的<code>for</code>循环，尤其是它还提高了可读性。</p><p>对于<code>python3</code>，字典的<code>keys()</code>、<code>values()</code>和<code>items()</code>3个方法的返回值类型不再是列表。此外，与之对应的<code>iterkeys()</code>、<code>itervalues()</code>和<code>iteritems()</code>本来返回的是迭代器，而<code>Python3</code>中并没有这3个方法。现在<code>keys()</code>、<code>values()</code>和<code>items()</code>返回的是视图对象（<code>viewobjects</code>）。</p><ul><li>keys()：返回dict_keys对象，可以查看字典的所有键。</li><li>values()：返回dict_values对象，可以查看字典的所有值。</li><li>items()：返回dict_items对象，可以查看字典所有的(key, value)二元元组。</li></ul><p>视图对象可以动态查看字典的内容，因此每次字典发生变化时，视图都会相应改变，见下面这个例子：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>words = &#123;<span class="hljs-string">&#x27;foo1&#x27;</span>:<span class="hljs-string">&#x27;bar&#x27;</span>, <span class="hljs-string">&#x27;fizz&#x27;</span>:<span class="hljs-string">&#x27;bazz&#x27;</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>items = words.items()<br><span class="hljs-meta">&gt;&gt;&gt; </span>words[<span class="hljs-string">&#x27;spam&#x27;</span>] = <span class="hljs-string">&#x27;eggs&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>items<br>dict_items([(<span class="hljs-string">&#x27;foo1&#x27;</span>, <span class="hljs-string">&#x27;bar&#x27;</span>), (<span class="hljs-string">&#x27;fizz&#x27;</span>, <span class="hljs-string">&#x27;bazz&#x27;</span>), (<span class="hljs-string">&#x27;spam&#x27;</span>, <span class="hljs-string">&#x27;eggs&#x27;</span>)])<br></code></pre></div></td></tr></table></figure><p>视图对象既有旧的<code>keys()</code>、<code>values()</code>和<code>items()</code>方法返回的列表的特性，也有旧的<code>iterkeys()</code>、<code>itervalues()</code>和<code>iteritems()</code>方法返回的迭代器的特性。视图无需冗余地将所有值都保存在内存里（像列表那样），但你仍然可以获取其长度（使用<code>len</code>），也可以测试元素是否包含其中（使用<code>in</code>子句）。当然，视图是可迭代的。最后一件重要的事情是，在<code>keys()</code>和<code>values()</code>方法返回的视图中，键和值的顺序是完全对应的。</p><h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><p>集合是一种鲁棒性很好的数据结构，当元素顺序的重要性不如元素的唯一性和测试元素是否包含在集合中的效率时，大部分情况下这种数据结构是很有用的。它与数学上的集合概念非常类似。<code>Python</code>的内置集合类型有两种。</p><ul><li>set()：一种可变的、无序的、有限的集合，其元素是唯一的、不可变的（可哈希的）对象。</li><li>frozenset()：一种不可变的、可哈希的、无序的集合，其元素是唯一的、不可变的（可哈希的）对象。</li></ul><p>由于<code>frozenset()</code>具有不变性，它可以用作字典的键，也可以作为其他<code>set()</code>和<code>frozenset()</code>的元素。在一个<code>set()</code>或<code>frozenset()</code>中不能包含另一个普通的可变<code>set()</code>，因为这会引发<code>TypeError</code>：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">set</span>([<span class="hljs-built_in">set</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]),<span class="hljs-built_in">set</span>([<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])])<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>TypeError: unhashable <span class="hljs-built_in">type</span>: <span class="hljs-string">&#x27;set&#x27;</span><br></code></pre></div></td></tr></table></figure><p>下面这种集合初始化的方法是完全正确的：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">set</span>([<span class="hljs-built_in">frozenset</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]),<span class="hljs-built_in">frozenset</span>([<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])])<br>&#123;<span class="hljs-built_in">frozenset</span>(&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;), <span class="hljs-built_in">frozenset</span>(&#123;<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;)&#125;<br></code></pre></div></td></tr></table></figure><p>创建可变集合方法有以下3种，如下所示。</p><ul><li>调用set()，选择性地接受可迭代对象作为初始化参数，例如set([0, 1, 2])。</li><li>使用集合推导，例如{element for element in range(3)}。</li><li>使用集合字面值，例如{1, 2, 3}。</li></ul><p>使用集合的字面值和推导要格外小心，因为它们在形式上与字典的字面值和推导非常相似。此外，空的集合对象是没有字面值的。空的花括号{}表示的是空的字典字面值。</p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>go语言的下载和安装</title>
    <link href="/2021/05/26/go%E8%AF%AD%E8%A8%80%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85/"/>
    <url>/2021/05/26/go%E8%AF%AD%E8%A8%80%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h2 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h2><p>访问<a href="https://studygolang.com/dl">https://studygolang.com/dl</a>下载对应系统的安装包，这里以<code>windows</code>平台为例。</p><p><img src="Screenshot_1.webp"></p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>安装下载后的安装文件。</p><p><img src="Screenshot_2.webp"></p><p>使用推荐的默认设置就可以了。</p><h2 id="增加环境变量"><a href="#增加环境变量" class="headerlink" title="增加环境变量"></a>增加环境变量</h2><p>在系统环境变量<code>PATH</code>中添加<code>go</code>的安装路径，比如<code>C:\Program Files\Go\bin</code>。</p><p>添加完成后调出<code>cmd</code>输入<code>go version</code>有下面的显示说明安装成功了。</p><figure class="highlight cmd"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cmd"><span class="hljs-function">C:\<span class="hljs-title">Users</span>\<span class="hljs-title">espho</span>&gt;<span class="hljs-title">go</span> <span class="hljs-title">version</span></span><br><span class="hljs-function"><span class="hljs-title">go</span> <span class="hljs-title">version</span> <span class="hljs-title">go1</span>.16.4 <span class="hljs-title">windows</span>/<span class="hljs-title">amd64</span></span><br></code></pre></div></td></tr></table></figure><h2 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a>设置代理</h2><p>设置为国内代理，方便下载<code>go</code>模块：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">阿里云<br>https://mirrors.aliyun.com/goproxy/<br>七牛云<br>https://goproxy.cn<br></code></pre></div></td></tr></table></figure><p>设置方式：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">go env -w GO111MODULE=on<br>go env -w GOPROXY=https://mirrors.aliyun.com/goproxy/<br></code></pre></div></td></tr></table></figure><p>运行<code>go env</code>查看设置是否成功。</p>]]></content>
    
    
    <categories>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>基于docker部署code-server</title>
    <link href="/2021/05/25/%E5%9F%BA%E4%BA%8Edocker%E9%83%A8%E7%BD%B2code-server/"/>
    <url>/2021/05/25/%E5%9F%BA%E4%BA%8Edocker%E9%83%A8%E7%BD%B2code-server/</url>
    
    <content type="html"><![CDATA[<h2 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> docker pull codercom/code-server</span><br><span class="hljs-meta">#</span><span class="bash"> docker images</span><br>REPOSITORY             TAG       IMAGE ID       CREATED       SIZE<br>codercom/code-server   latest    f3ac734fcec8   12 days ago   802MB<br></code></pre></div></td></tr></table></figure><h2 id="创建挂载目录"><a href="#创建挂载目录" class="headerlink" title="创建挂载目录"></a>创建挂载目录</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> CODE=/home/docker/code</span><br><span class="hljs-meta">#</span><span class="bash"> mkdir <span class="hljs-variable">$CODE</span> &amp;&amp; <span class="hljs-built_in">cd</span> <span class="hljs-variable">$CODE</span></span><br></code></pre></div></td></tr></table></figure><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>启动一个容器：<code>-u</code>表示使用<code>root</code>用户运行</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> docker run -d -u root -p 8088:8080 --name code-server -v <span class="hljs-variable">$CODE</span>:/home/code codercom/code-server</span><br><span class="hljs-meta">#</span><span class="bash"> docker ps</span><br>CONTAINER ID   IMAGE       COMMAND          CREATED    \ STATUS         PORTS             NAMES<br>f10030d88e1d  codercom/code-server &quot;/usr/bin/entrypoint鈥 3 minutes ago Up 3 minutes   0.0.0.0:8088-&gt;8080/tcp, :::8088-&gt;8080/tcp code-server<br></code></pre></div></td></tr></table></figure><p>拉出配置文件</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> docker cp code-server:/root/.config/code-server/config.yaml <span class="hljs-variable">$CODE</span>/</span><br><span class="hljs-meta">#</span><span class="bash"> cat <span class="hljs-variable">$CODE</span>/config.yaml</span><br>bind-addr: 127.0.0.1:8080<br>auth: password<br>password: 59bd4df2841fbc77d67f674f<br>cert: false<br></code></pre></div></td></tr></table></figure><p>修改你的密码：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">docker run -d -u root \<br>  -p 8088:8080 \<br>  --name code-server \<br>  -v $CODE/config.yaml:/root/.config/code-server/config.yaml \<br>  -v $CODE:/home/code \<br>  codercom/code-server<br></code></pre></div></td></tr></table></figure><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> docker stop code-server &amp;&amp; docker rm code-server</span><br><span class="hljs-meta">#</span><span class="bash"> docker run -d -u root \</span><br><span class="bash">  -p 8088:8080 \</span><br><span class="bash">  --name code-server \</span><br><span class="bash">  -v <span class="hljs-variable">$CODE</span>/config.yaml:/root/.config/code-server/config.yaml \</span><br><span class="bash">  -v <span class="hljs-variable">$CODE</span>:/home/code \</span><br><span class="bash">  codercom/code-server</span><br></code></pre></div></td></tr></table></figure><h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><p>访问<code>http://holychan.ltd:8088/</code>，输入密码登录。</p><p><img src="!%5B%5D(Screenshot_1.webp)"></p>]]></content>
    
    
    <categories>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>vscode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>腾讯云主机CPU占用100%</title>
    <link href="/2021/05/25/%E8%85%BE%E8%AE%AF%E4%BA%91%E4%B8%BB%E6%9C%BACPU%E5%8D%A0%E7%94%A8%E7%99%BE%E5%88%86%E7%99%BE/"/>
    <url>/2021/05/25/%E8%85%BE%E8%AE%AF%E4%BA%91%E4%B8%BB%E6%9C%BACPU%E5%8D%A0%E7%94%A8%E7%99%BE%E5%88%86%E7%99%BE/</url>
    
    <content type="html"><![CDATA[<h2 id="异常情况"><a href="#异常情况" class="headerlink" title="异常情况"></a>异常情况</h2><p>使用<code>ssh</code>登录发现连接很缓慢，排除网络问题。登陆后使用<code>top</code>查看进程，发现<code>git</code>用户的两个进程占用了<code>95%</code>的<code>CPU</code>。</p><p><img src="Screenshot_1.webp"></p><p>网上查了下，<code>kswapd0</code>被植入挖矿病毒，立马<code>kill</code>这个进程，CPU的负荷马上降了下来。</p><h2 id="查看进程端口"><a href="#查看进程端口" class="headerlink" title="查看进程端口"></a>查看进程端口</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">netstat -anltp|grep kswapd0<br></code></pre></div></td></tr></table></figure><h2 id="查看程序路径"><a href="#查看程序路径" class="headerlink" title="查看程序路径"></a>查看程序路径</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">ls -l /proc/3882/exe<br></code></pre></div></td></tr></table></figure><h2 id="定时器查看"><a href="#定时器查看" class="headerlink" title="定时器查看"></a>定时器查看</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">crontab -l -u git<br></code></pre></div></td></tr></table></figure><p>查看到定时任务，这个就是病毒的执行路径。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">[root@VM-0-15-centos ~]# crontab -l -u git<br>1 1 */2 * * /var/tmp/.X18263/.rsync/a/upd&gt;/dev/null 2&gt;&amp;1<br>5 8 * * 0 /var/tmp/.X18263/.rsync/b/sync&gt;/dev/null 2&gt;&amp;1 <br>@reboot /var/tmp/.X18263/.rsync/b/sync&gt;/dev/null 2&gt;&amp;1  <br>0 0 */3 * * /var/tmp/.X18263/.rsync/c/aptitude&gt;/dev/null 2&gt;&amp;1<br></code></pre></div></td></tr></table></figure><h2 id="临时目录查看"><a href="#临时目录查看" class="headerlink" title="临时目录查看"></a>临时目录查看</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">[root@VM-0-15-centos tmp]# cd /temp<br>[root@VM-0-15-centos tmp]# ll -sa | grep git<br>0 -rw-rw-r--   1 git  git     0 May 24 21:41 .out<br>4 -rw-rw-r--   1 git  git     9 May 24 07:28 up.txt<br>4 drwxrwxr-x   2 git  git  4096 May 24 21:25 .X25-unix<br>4 drwxrwxr-x   2 git  git  4096 May 24 21:50 .X3-u111<br></code></pre></div></td></tr></table></figure><h2 id="处理办法"><a href="#处理办法" class="headerlink" title="处理办法"></a>处理办法</h2><ol><li><p>直接杀掉进程</p></li><li><p>删除所有的crontab计划任务</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sheel">crontab -e -u git<br></code></pre></div></td></tr></table></figure><ol start="3"><li>删除用户和文件（前提是正规业务没有用到此用户）</li></ol><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">userdel -r git<br></code></pre></div></td></tr></table></figure><ol start="4"><li>删除/tmp目录下test用户的文件</li></ol><h2 id="Xmrig挖矿木马之暴力分析"><a href="#Xmrig挖矿木马之暴力分析" class="headerlink" title="Xmrig挖矿木马之暴力分析"></a>Xmrig挖矿木马之暴力分析</h2><p>可以参考大神的分析<a href="https://www.jianshu.com/p/3dd5ad1cd51b">https://www.jianshu.com/p/3dd5ad1cd51b</a>。</p><p>密码一定要复杂！！！</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>git</tag>
      
      <tag>病毒</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ajax爬取案例实战</title>
    <link href="/2021/05/24/Ajax%E7%88%AC%E5%8F%96%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98/"/>
    <url>/2021/05/24/Ajax%E7%88%AC%E5%8F%96%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul><li>安装好<code>Python 3</code>（最低为 3.6 版本），并能成功运行<code>Python 3</code>程序。</li><li>了解<code>PythonHTTP</code>请求库<code>requests</code>的基本用法。</li><li>了解<code>Ajax</code>的基础知识和分析<code>Ajax</code>的基本方法。</li></ul><h2 id="爬取目标"><a href="#爬取目标" class="headerlink" title="爬取目标"></a>爬取目标</h2><p>其链接为：<a href="https://dynamic1.scrape.cuiqingcai.com/">https://dynamic1.scrape.cuiqingcai.com/</a>，页面如图所示。</p><p><img src="Screenshot_1.webp"></p><p>需要完成的目标有：</p><ul><li>分析页面数据的加载逻辑。</li><li>用<code>requests</code>实现<code>Ajax</code>数据的爬取。</li><li>将每部电影的数据保存成一个<code>JSON</code>数据文件。</li></ul><h2 id="爬取列表页"><a href="#爬取列表页" class="headerlink" title="爬取列表页"></a>爬取列表页</h2><p>打开浏览器开发者工具，切换到<code>Network</code>面板，勾选上<code>「Preserve Log」</code>并切换到<code>「XHR」</code>选项卡，如图所示。</p><p><img src="Screenshot_2.webp"></p><p>点开第<code>2</code>个结果，观察到其<code>Ajax</code>接口请求的<code>URL</code>地址为：<code>https://dynamic1.scrape.cuiqingcai.com/api/movie/?limit=10&amp;offset=10</code>，这里有两个参数，一个是<code>limit</code>，其值为<code>10</code>，一个是<code>offset</code>，它的值也是<code>10</code>。</p><p>切换到<code>Preview</code>选项卡，结果如图所示。</p><p><img src="Screenshot_3.webp"></p><p>可以看到结果是一些<code>JSON</code>数据，它有一个<code>results</code>字段，这是一个列表，列表的每一个元素都是一个字典。观察一下字典的内容，可以看到对应的电影数据的字段了，如<code>name</code>、<code>alias</code>、<code>cover</code>、 <code>categories</code>，对比下浏览器中的真实数据，各个内容是完全一致的，而且这个数据已经非常结构化了，完全就是我们想要爬取的数据。</p><p>导入一些所需的库并定义一些配置，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> logging<br><br>logging.basicConfig(level=logging.INFO,<br>                    <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(asctime)s-%(levelname)s:%(message)s&#x27;</span>)<br><br>INDEX_URL = <span class="hljs-string">&#x27;https://dynamic1.scrape.cuiqingcai.com/api/movie/?limit=&#123;limit&#125;&amp;offset=&#123;offset&#125;&#x27;</span><br></code></pre></div></td></tr></table></figure><p>引入了<code>requests</code>和<code>logging</code>库，并定义了<code>logging</code>的基本配置，接着定义<code>INDEX_URL</code>，这里把<code>limit</code>和<code>offset</code>预留出来变成占位符，可以动态传入参数构造成一个完整的列表页<code>URL</code>。</p><p>下面来实现一下列表页的爬取，先定义一个通用的爬取方法，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">scrape_api</span>(<span class="hljs-params">url</span>):</span><br>    logging.info(<span class="hljs-string">&#x27;scraping %s...&#x27;</span>, url)<br>    <span class="hljs-keyword">try</span>:<br>        response = requests.get(url, verify=<span class="hljs-literal">False</span>)<br>        <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>            <span class="hljs-keyword">return</span> response.json()<br>        logging.error(<span class="hljs-string">&#x27;get invalid status code %s while scraping %s&#x27;</span>,<br>                      response.status_code, url)<br>    <span class="hljs-keyword">except</span> requests.RequestException:<br>        logging.error(<span class="hljs-string">&#x27;error occurred while scraping %s&#x27;</span>, url, exc_info=<span class="hljs-literal">True</span>)<br></code></pre></div></td></tr></table></figure><p>定义一个<code>scrape_api</code>方法，和之前不同的是，这个方法专门用来处理<code>JSON</code>接口，最后的<code>response</code>调用的是<code>json</code>方法，它可以解析响应的内容并将其转化成<code>JSON</code>字符串。</p><p>在这个基础之上，定义一个爬取列表页的方法，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">LIMIT = <span class="hljs-number">10</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">scrape_index</span>(<span class="hljs-params">page</span>):</span><br>    url = INDEX_URL.<span class="hljs-built_in">format</span>(limit=LIMIT, offset=LIMIT*(page-<span class="hljs-number">1</span>))<br>    <span class="hljs-keyword">return</span> scrape_api(url)<br></code></pre></div></td></tr></table></figure><p>定义了一个<code>scrape_index</code>方法，用来接收参数<code>page</code>，<code>page</code>代表列表页的页码。</p><p>先构造了一个<code>URL</code>，通过字符串的<code>format</code>方法，传入<code>limit</code>和<code>offset</code>的值。这里的<code>limit</code>直接使用了全局变量<code>LIMIT</code>的值，<code>offset</code>则是动态计算的，计算方法是页码数减1再乘以<code>limit</code>，比如第1页的<code>offset</code>值就是<code>0</code>，第2页的<code>offset</code>值就是<code>10</code>，以此类推。构造好<code>URL</code>之后，直接调用<code>scrape_api</code>方法并返回结果即可。</p><p>这样就完成了列表页的爬取，每次请求都会得到一页<code>10</code>部的电影数据。</p><p>由于这时爬取到的数据已经是<code>JSON</code>类型了，所以不用像之前一样去解析<code>HTML</code>代码来提取数据，爬到的数据就是想要的结构化数据，因此解析这一步这里就可以直接省略。</p><h2 id="爬取详情页"><a href="#爬取详情页" class="headerlink" title="爬取详情页"></a>爬取详情页</h2><p>这时候已经可以拿到每一页的电影数据了，但是实际上这些数据还缺少一些想要的信息，如剧情简介等，所以需要进一步进入到详情页来获取这些内容。</p><p>这时候点击任意一部电影，如《教父》，进入到其详情页面，这时候可以发现页面的<code>URL</code>已经变成了<a href="https://dynamic1.scrape.cuiqingcai.com/detail/40"></a>，页面也成功展示了详情页的信息</p><p>先定义一个详情页的爬取逻辑吧，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">DETAIL_URL = <span class="hljs-string">&#x27;https://dynamic1.scrape.cuiqingcai.com/api/movie/&#123;id&#125;&#x27;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">scrape_detail</span>(<span class="hljs-params"><span class="hljs-built_in">id</span></span>):</span><br>    url = DETAIL_URL.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">id</span>=<span class="hljs-built_in">id</span>)<br>    <span class="hljs-keyword">return</span> scrape_api(url)<br></code></pre></div></td></tr></table></figure><p>定义了一个<code>scrape_detail</code>方法，它接收参数<code>id</code>。这里的实现也非常简单，先根据定义好的<code>DETAIL_UR</code>L加上<code>id</code>，构造一个真实的详情页<code>Ajax</code>请求的<code>URL</code>，然后直接调用<code>scrape_api</code>方法传入这个<code>URL</code>即可。接着，定义一个总的调用方法，将以上的方法串联调用起来，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, TOTAL_PAGE+<span class="hljs-number">1</span>):<br>        index_data = scrape_index(page)<br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> index_data.get(<span class="hljs-string">&#x27;results&#x27;</span>):<br>            <span class="hljs-built_in">id</span> = item.get(<span class="hljs-string">&#x27;id&#x27;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">id</span>)<br>            detail_data = scrape_detail(<span class="hljs-built_in">id</span>)<br>            logging.info(<span class="hljs-string">&#x27;detail data %s&#x27;</span>, detail_data)<br></code></pre></div></td></tr></table></figure><p>定义了一个<code>main</code>方法，首先遍历获取页码<code>page</code>，然后把<code>page</code>当成参数传递给<code>scrape_index</code>方法，得到列表页的数据。接着我遍历所有列表页的结果，获取每部电影的<code>id</code>，然后把<code>id</code>当作参数传递给<code>scrape_detail</code>方法，来爬取每部电影的详情数据，赋值为<code>detail_data</code>，输出即可。</p><h2 id="保存数据"><a href="#保存数据" class="headerlink" title="保存数据"></a>保存数据</h2><p>定义一个数据保存的方法，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> os <span class="hljs-keyword">import</span> makedirs<br><span class="hljs-keyword">from</span> os.path <span class="hljs-keyword">import</span> exists<br><br>RESULT_DIR = <span class="hljs-string">&#x27;results&#x27;</span><br><br>exists(RESULT_DIR) <span class="hljs-keyword">or</span> makedirs(RESULT_DIR)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_data</span>(<span class="hljs-params">data</span>):</span><br>    name = data.get(<span class="hljs-string">&#x27;name&#x27;</span>)<br>    data_path = <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;RESULT_DIR&#125;</span>/<span class="hljs-subst">&#123;name&#125;</span>.json&#x27;</span><br>    json.dump(data, <span class="hljs-built_in">open</span>(data_path, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>), ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>)<br></code></pre></div></td></tr></table></figure><p>首先定义了数据保存的文件夹<code>RESULTS_DIR</code>，注意，先要判断这个文件夹是否存在，如果不存在则需要创建。</p><p>接着，定义了保存数据的方法<code>save_data</code>，首先获取数据的<code>name</code>字段，即电影的名称，把电影名称作为<code>JSON</code>文件的名称，接着构造<code>JSON</code>文件的路径，然后用<code>json</code>的<code>dump</code>方法将数据保存成文本格式。<code>dump</code>的方法设置了两个参数，一个是<code>ensure_ascii</code>，将其设置为<code>False</code>，它可以保证中文字符在文件中能以正常的中文文本呈现，而不是<code>unicode</code>字符；另一个是<code>indent</code>，它的数值为2，这代表生成的<code>JSON</code>数据结果有两个空格缩进，让它的格式显得更加美观。</p><p>最后，<code>main</code>方法再调用下<code>save_data</code>方法即可，实现如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, TOTAL_PAGE+<span class="hljs-number">1</span>):<br>        index_data = scrape_index(page)<br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> index_data.get(<span class="hljs-string">&#x27;results&#x27;</span>):<br>            <span class="hljs-built_in">id</span> = item.get(<span class="hljs-string">&#x27;id&#x27;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">id</span>)<br>            detail_data = scrape_detail(<span class="hljs-built_in">id</span>)<br>            logging.info(<span class="hljs-string">&#x27;detail data %s&#x27;</span>, detail_data)<br>            save_data(detail_data)<br></code></pre></div></td></tr></table></figure><p>本地<code>results</code>文件夹下出现了各个电影的<code>JSON</code>文件，如图所示。</p><p><img src="Screenshot_4.webp"></p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ajax</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ajax的原理和解析</title>
    <link href="/2021/05/24/Ajax%E7%9A%84%E5%8E%9F%E7%90%86%E5%92%8C%E8%A7%A3%E6%9E%90/"/>
    <url>/2021/05/24/Ajax%E7%9A%84%E5%8E%9F%E7%90%86%E5%92%8C%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="什么是Ajax？"><a href="#什么是Ajax？" class="headerlink" title="什么是Ajax？"></a>什么是Ajax？</h2><p><code>Ajax</code>，全称为<code>Asynchronous JavaScriptand XML</code>，即异步的<code>JavaScript</code>和<code>XML</code>。它不是一门编程语言，而是利用<code>JavaScript</code>在保证页面不被刷新、页面链接不改变的情况下与服务器交换数据并更新部分网页的技术。</p><p>传统的网页，如果你想更新其内容，那么必须要刷新整个页面。有了<code>Ajax</code>，便可以在页面不被全部刷新的情况下更新其内容。在这个过程中，页面实际上在后台与服务器进行了数据交互，获取到数据之后，再 利用<code>JavaScript</code>改变网页，这样网页内容就会更新了。</p><p>到<code>W3School</code>上体验几个<code>Demo</code>来感受一下：<a href="http://www.w3school.com.cn/ajax/ajax_xmlhttprequest_send.asp">http://www.w3school.com.cn/ajax/ajax_xmlhttprequest_send.asp</a>。</p><h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h2><p>初步了解了<code>Ajax</code>之后，来详细了解它的基本原理。发送<code>Ajax</code>请求到网页更新的过程可以简单分为以下3步：</p><ul><li>发送请求</li><li>解析内容</li><li>渲染网页</li></ul><h3 id="发送请求"><a href="#发送请求" class="headerlink" title="发送请求"></a>发送请求</h3><p><code>JavaScript</code>可以实现页面的各种交互功能，<code>Ajax</code>也不例外，它是由<code>JavaScript</code>实现的，实际上执行了如下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> xmlhttp;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.XMLHttpRequest)<br>  &#123;<span class="hljs-comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span><br>  xmlhttp=<span class="hljs-keyword">new</span> XMLHttpRequest();<br>  &#125;<br><span class="hljs-keyword">else</span><br>  &#123;<span class="hljs-comment">// code for IE6, IE5</span><br>  xmlhttp=<span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">&quot;Microsoft.XMLHTTP&quot;</span>);<br>  &#125;<br>xmlhttp.onreadystatechange=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">  </span>&#123;<br>  <span class="hljs-keyword">if</span> (xmlhttp.readyState==<span class="hljs-number">4</span> &amp;&amp; xmlhttp.status==<span class="hljs-number">200</span>)<br>    &#123;<br>    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;myDiv&quot;</span>).innerHTML=xmlhttp.responseText;<br>    &#125;<br>  &#125;<br>xmlhttp.open(<span class="hljs-string">&quot;GET&quot;</span>,<span class="hljs-string">&quot;/ajax/demo_get.asp&quot;</span>,<span class="hljs-literal">true</span>);<br>xmlhttp.send();<br></code></pre></div></td></tr></table></figure><p>这是<code>JavaScript</code>对<code>Ajax</code>最底层的实现，这个过程实际上是新建了<code>XMLHttpRequest</code>对象，然后调用<code>onreadystatechange</code>属性设置监听，最后调用<code>open()</code>和<code>send()</code>方法向某个链接（也就是服务器）发送请求。</p><p>用<code>Python</code>实现请求发送之后，可以得到响应结果，但这里请求的发送由<code>JavaScript</code>来完成。由于设置了监听，所以当服务器返回响应时，<code>onreadystatechange</code>对应的方法便会被触发，在这个方法里面 解析响应内容即可。</p><h3 id="解析内容"><a href="#解析内容" class="headerlink" title="解析内容"></a>解析内容</h3><p>解得到响应之后，<code>onreadystatechange</code>属性对应的方法会被触发，此时利用<code>xmlhttp</code>的<code>responseText</code>属性便可取到响应内容。这类似于<code>Python</code>中利用<code>requests</code>向服务器发起请求，然后得到响应的过程。</p><p>返回的内容可能是<code>HTML</code>，也可能是<code>JSON</code>，接下来只需要在方法中用<code>JavaScript</code>进一步处理即可。比如，如果返回的内容是<code>JSON</code>的话，可以对它进行解析和转化。</p><h3 id="渲染网页"><a href="#渲染网页" class="headerlink" title="渲染网页"></a>渲染网页</h3><p><code>JavaScript</code>有改变网页内容的能力，解析完响应内容之后，就可以调用<code>JavaScript</code>针对解析完的内容对网页进行下一步处理。比如，通过<code>document.getElementById().innerHTML</code>这样的操作，对某个元素内的源代码进行更改，这样网页显示的内容就改变了，这种对<code>Document</code>网页文档进行如更改、删除等操作也被称作**<code>DOM</code>操作**。</p><p>上例中，<code>document.getElementById(&quot;myDiv&quot;).innerHTML=xmlhttp.responseText</code>这个操作便将<code>ID</code>为<code>myDiv</code>的节点内部的<code>HTML</code>代码更改为服务器返回的内容，这样<code>myDiv</code>元素内部便会呈现出服务器返回的新数据，网页的部分内容看上去就更新了。</p><p>可以看到，<strong>发送请求</strong>、<strong>解析内容</strong>和<strong>渲染网页</strong>这3个步骤其实都是由<code>JavaScript</code>完成的。</p><h2 id="Ajax分析"><a href="#Ajax分析" class="headerlink" title="Ajax分析"></a>Ajax分析</h2><p>用浏览器打开微博链接<a href="https://weibo.com/u/5902654742">https://weibo.com/u/5902654742</a>，随后在页面中点击鼠标右键，从弹出的快捷菜单中选择“检查”选项，此时便会弹出开发者工具，如图所示：</p><p><img src="Screenshot_1.webp"></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><br></code></pre></div></td></tr></table></figure><p><code>Ajax</code>有其特殊的请求类型，它叫作<code>xhr</code>。在图中我们可以发现一个以<code>getIndex</code>开头的请求，其<code>Type</code>为<code>xhr</code>，这就是一个<code>Ajax</code>请求。用鼠标点击这个请求，可以查看这个请求的详细信息。</p><p><img src="Screenshot_2.webp"></p><p>在右侧可以观察到<code>Request Headers</code>、<code>URL</code>和<code>Response Headers</code>等信息。<code>Request Headers</code>中有一个信息为<code>X-Requested-With:XMLHttpRequest</code>，这就标记了此请求是<code>Ajax</code>请求，如图所示：</p><p><img src="Screenshot_3.webp"></p><p><img src="Screenshot_4.webp"></p><p>点击<code>Preview</code>，即可看到响应的内容，它是<code>JSON</code>格式的。这里<code>Chrome</code>为我们自动做了解析，点击箭头即可展开和收起相应内容。</p><p>可以观察到，返回结果是我的个人信息，包括昵称、简介、头像等，这也是用来渲染个人主页所使用的数据。<code>JavaScript</code>接收到这些数据之后，再执行相应的渲染方法，整个页面就渲染出来了。</p><p><img src="Screenshot_5.webp"></p><p>切换到<code>Response</code>选项卡，从中观察到真实的返回数据，如图所示：</p><p><img src="Screenshot_6.webp"></p><p>所以说，我们看到的微博页面的真实数据并不是最原始的页面返回的，而是在执行 JavaScript 后再次向后台发送 Ajax请求，浏览器拿到数据后进一步渲染出来的。</p><h2 id="过滤请求"><a href="#过滤请求" class="headerlink" title="过滤请求"></a>过滤请求</h2><p>利用<code>Chrome</code>开发者工具的筛选功能筛选出所有的<code>Ajax</code>请求。在请求的上方有一层筛选栏，直接点击<code>XHR</code>，此时在下方显示的所有请求便都是<code>Ajax</code>请求了，如图所示：</p><p><img src="Screenshot_7.webp"></p><p>接下来，不断滑动页面，可以看到页面底部有一条条新的微博被刷出，而开发者工具下方也不断地出现<code>Ajax</code>请求，这样我们就可以捕获到所有的<code>Ajax</code>请求了。 随意点开一个条目，都可以清楚地看到其<code>Request URL、Request Headers、Response Headers、Response Body</code>等内容，此时想要模拟请求和提取就非常简单了。</p><p><img src="Screenshot_8.webp"></p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ajax</tag>
      
      <tag>javascript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>request、pyquest和pymongodb案例实战</title>
    <link href="/2021/05/23/request%E3%80%81pyquest%E5%92%8Cpymongodb%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98/"/>
    <url>/2021/05/23/request%E3%80%81pyquest%E5%92%8Cpymongodb%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>在本节课开始之前，我们需要做好如下的准备工作：</p><ul><li>安装好<code>Python3</code>（最低为 3.6 版本），并能成功运行<code>Python3</code>程序。</li><li>了解<code>Python</code>多进程的基本原理。</li><li>了解<code>PythonHTTP</code>请求库<code>requests</code>的基本用法。</li><li>了解正则表达式的用法和<code>Python</code>中正则表达式库<code>re</code>的基本用法。</li><li>了解<code>PythonHTML</code>解析库<code>pyquery</code>的基本用法。</li><li>了解<code>MongoDB</code>并安装和启动<code>MongoDB</code>服务。</li><li>了解<code>Python</code>的<code>MongoDB</code>操作库<code>PyMongo</code>的基本用法。</li></ul><h2 id="爬虫目标"><a href="#爬虫目标" class="headerlink" title="爬虫目标"></a>爬虫目标</h2><p>一个基本的静态网站作为案例进行爬取，需要爬取的链接为：<a href="https://static1.scrape.cuiqingcai.com/">https://static1.scrape.cuiqingcai.com/</a>，这个网站里面包含了一些电影信息。</p><p>要完成的目标是：</p><ul><li>用<code>requests</code>爬取这个站点每一页的电影列表，顺着列表再爬取每个电影的详情页。</li><li>用<code>pyquery</code>和正则表达式提取每部电影的名称、封面、类别、上映时间、评分、剧情简介等内容。</li><li>把以上爬取的内容存入<code>MongoDB</code>数据库。</li><li>使用多进程实现爬取的加速。</li></ul><h3 id="爬取列表页"><a href="#爬取列表页" class="headerlink" title="爬取列表页"></a>爬取列表页</h3><p>爬取的第一步肯定要从列表页入手，首先观察一下列表页的结构和翻页规则。在浏览器中访问<a href="https://static1.scrape.cuiqingcai.com/"></a>，然后打开浏览器开发者工具，观察每一个电影信息区块对应的<code>HTML</code>，以及进入到详情页的<code>URL</code>是怎样的，如图所示：</p><p><img src="Screenshot_1.webp"></p><p>每部电影对应的区块都是一个<code>div</code>节点，它的<code>class</code>属性都有<code>el-card</code>这个值。每个列表页有10个这样的<code>div</code>节点，也就对应着10部电影的信息。</p><p>再分析下从列表页是怎么进入到详情页的，选中电影的名称，看下结果：</p><p><img src="Screenshot_2.webp"></p><p>这个名称实际上是一个<code>h2</code>节点，其内部的文字就是电影的标题。<code>h2</code>节点的外面包含了一个<code>a</code>节点，这个<code>a</code>节点带有<code>href</code>属性，这就是一个超链接，其中<code>href</code>的值为<code>/detail/1</code>，这是一个相对网站的根<code>URL</code><a href="https://static1.scrape.cuiqingcai.com/">https://static1.scrape.cuiqingcai.com/</a>路径，加上网站的根<code>URL</code>就构成了<a href="https://static1.scrape.cuiqingcai.com/detail/1">https://static1.scrape.cuiqingcai.com/detail/1</a>，也就是这部电影详情页的<code>URL</code>。这样只需要提取这个<code>href</code>属性就能构造出详情页的<code>URL</code>并接着爬取了。</p><p>接下来分析下翻页的逻辑，拉到页面的最下方，可以看到分页页码，如图所示：</p><p><img src="Screenshot_3.webp"></p><p>页面显示一共有<code>100</code>条数据，10页的内容，因此页码最多是10。接着我们点击第2页，如图所示：</p><p><img src="Screenshot_4.webp"></p><p>可以看到网页的<code>URL</code>变成了<code>https://static1.scrape.cuiqingcai.com/page/2</code>，相比根<code>URL</code>多了<code>/page/2</code>这部分内容。网页的结构还是和原来一模一样，所以我们可以和第1页一样处理。</p><p>接着查看第3页、第4页等内容，可以发现有这么一个规律，每一页的<code>URL</code>最后分别变成了<code>/page/3</code>、<code>/page/4</code>。所以，<code>/page</code>后面跟的就是列表页的页码，当然第1页也是一样，在根<code>URL</code>后面加上<code>/page/1</code>也是能访问的，只不过网站做了一下处理，默认的页码是1，所以显示第1页的内容。</p><p>分析到这里，逻辑基本就清晰了。</p><p>如果要完成列表页的爬取，可以这么实现：</p><ul><li>遍历页码构造<code>10</code>页的索引页<code>URL</code>。</li><li>从每个索引页分析提取出每个电影的详情页<code>URL</code>。</li></ul><p>先定义一些基础的变量，并引入一些必要的库，写法如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> pymongo<br><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urljoin<br><br>logging.basicConfig(level=logging.INFO, <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(asctime)s - %(levelname)s: %(message)s&#x27;</span>)<br><br>BASE_URL = <span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com&#x27;</span><br>TOTAL_PAGE = <span class="hljs-number">10</span><br></code></pre></div></td></tr></table></figure><p>引入<code>requests</code>用来爬取页面，<code>logging</code>用来输出信息，<code>re</code>用来实现正则表达式解析，<code>pyquery</code>用来直接解析网页，<code>pymongo</code>用来实现<code>MongoDB</code>存储，<code>urljoin</code>用来做<code>URL</code>的拼接。</p><p>接着定义日志输出级别和输出格式，完成之后再定义<code>BASE_URL</code>为当前站点的根<code>URL</code>，<code>TOTAL_PAGE</code>为需要爬取的总页码数量。</p><p>定义好了之后，来实现一个页面爬取的方法，实现如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">scrape_page</span>(<span class="hljs-params">url</span>):</span><br>    logging.info(<span class="hljs-string">&#x27;scraping %s...&#x27;</span>, url)<br>    <span class="hljs-keyword">try</span>:<br>        response = requests.get(url, verify=<span class="hljs-literal">False</span>)<br>        <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>            <span class="hljs-keyword">return</span> response.text<br>        logging.error(<span class="hljs-string">&#x27;get invalid status code %s while scraping %s&#x27;</span>, response.status_code, url)<br>    <span class="hljs-keyword">except</span> requests.RequestException:<br>        logging.error(<span class="hljs-string">&#x27;error occurred while scraping %s&#x27;</span>, url, exc_info=<span class="hljs-literal">True</span>)<br></code></pre></div></td></tr></table></figure><p>考虑到不仅要爬取列表页，还要爬取详情页，在这里定义一个较通用的爬取页面的方法，叫作<code>scrape_page</code>，它接收一个<code>url</code>参数，返回页面的<code>html</code>代码。</p><p>首先判断状态码是不是<code>200</code>，如果是，则直接返回页面的<code>HTML</code>代码，如果不是，则会输出错误日志信息。另外，这里实现了<code>requests</code>的异常处理，如果出现了爬取异常，则会输出对应的错误日志信息。这时将<code>logging</code>的<code>error</code>方法的<code>exc_info</code>参数设置为<code>True</code>则可以打印出<code>Traceback</code>错误堆栈信息。 </p><p>有了<code>scrape_page</code>方法之后，给这个方法传入一个<code>url</code>，正常情况下它就可以返回页面的<code>HTML</code>代码。</p><p>在这个基础上，来定义列表页的爬取方法吧，实现如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">scrape_index</span>(<span class="hljs-params">page</span>):</span><br>    index_url = <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;BASE_URL&#125;</span>/page/<span class="hljs-subst">&#123;page&#125;</span>&#x27;</span><br>    <span class="hljs-keyword">return</span> scrape_page(index_url)<br></code></pre></div></td></tr></table></figure><p>方法名称叫作<code>scrape_index</code>，这个方法会接收一个<code>page</code>参数，即列表页的页码，在方法里面实现列表页的<code>URL</code>拼接，然后调用<code>scrape_page</code>方法爬取即可得到列表页的<code>HTML</code>代码了。</p><p>获取了<code>HTML</code>代码后，下一步就是解析列表页，并得到每部电影的详情页的<code>URL</code>了，实现如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_index</span>(<span class="hljs-params">html</span>):</span><br>    doc = pq(html)<br>    links = doc(<span class="hljs-string">&#x27;.el-card .name&#x27;</span>)<br>    <span class="hljs-keyword">for</span> link <span class="hljs-keyword">in</span> links.items():<br>        href = link.attr(<span class="hljs-string">&#x27;href&#x27;</span>)<br>        detail_url = urljoin(BASE_URL, href)<br>        logging.info(<span class="hljs-string">&#x27;get detail info %s&#x27;</span>, detail_url)<br>        <span class="hljs-keyword">yield</span> detail_url<br></code></pre></div></td></tr></table></figure><p>这里我们定义了<code>parse_index</code>方法，它接收一个<code>html</code>参数，即列表页的<code>HTML</code>代码。接着用<code>pyquery</code>新建一个<code>PyQuery</code>对象，完成之后再用<code>.el-card .name</code>选择器选出来每个电影名称对应的超链接节点。遍历这些节点，通过调用<code>attr</code>方法并传入<code>href</code>获得详情页的<code>URL</code>路径，得到的<code>href</code>就是上文所说的类似<code>/detail/1</code>这样的结果。这并不是一个完整的<code>URL</code>，所以需要借助<code>urljoin</code>方法把<code>BASE_URL</code>和<code>href</code>拼接起来，获得详情页的完整<code>URL</code>，得到的结果就是类似<code>https://static1.scrape.cuiqingcai.com/detail/1</code>这样完整的<code>URL</code>了，最后<code>yield</code>返回即可。</p><p>通过调用<code>parse_index</code>方法传入列表页的<code>HTML</code>代码就可以获得该列表页所有电影的详情页<code>URL</code>了，接下来把上面的方法串联调用一下，实现如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, TOTAL_PAGE+<span class="hljs-number">1</span>):<br>        index_html = scrape_index(page)<br>        detail_urls = parse_index((index_html))<br>        logging.info(<span class="hljs-string">&#x27;detail urls %s&#x27;</span>, <span class="hljs-built_in">list</span>(detail_urls))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></div></td></tr></table></figure><p>定义了<code>main</code>方法来完成上面所有方法的调用，首先使用<code>range</code>方法遍历一下页码，得到的<code>page</code>是<code>1~10</code>，接着把<code>page</code>变量传给<code>scrape_index</code>方法，得到列表页的<code>HTML</code>，赋值为<code>index_html</code>变量。接下来再将<code>index_html</code>变量传给<code>parse_index</code>方法，得到列表页所有电影的详情页<code>URL</code>，赋值为<code>detail_urls</code>，结果是一个生成器，调用<code>list</code>方法就可以将其输出出来。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-number">2021</span>-05-<span class="hljs-number">23</span> <span class="hljs-number">23</span>:<span class="hljs-number">23</span>:04,059 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class="hljs-number">1</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">23</span> <span class="hljs-number">23</span>:<span class="hljs-number">23</span>:04,060 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class="hljs-number">2</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">23</span> <span class="hljs-number">23</span>:<span class="hljs-number">23</span>:04,061 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class="hljs-number">3</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">23</span> <span class="hljs-number">23</span>:<span class="hljs-number">23</span>:04,062 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class="hljs-number">4</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">23</span> <span class="hljs-number">23</span>:<span class="hljs-number">23</span>:04,063 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class="hljs-number">5</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">23</span> <span class="hljs-number">23</span>:<span class="hljs-number">23</span>:04,064 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class="hljs-number">6</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">23</span> <span class="hljs-number">23</span>:<span class="hljs-number">23</span>:04,065 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class="hljs-number">7</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">23</span> <span class="hljs-number">23</span>:<span class="hljs-number">23</span>:04,067 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class="hljs-number">8</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">23</span> <span class="hljs-number">23</span>:<span class="hljs-number">23</span>:04,070 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class="hljs-number">9</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">23</span> <span class="hljs-number">23</span>:<span class="hljs-number">23</span>:04,072 - INFO: get detail info https://static1.scrape.cuiqingcai.com/detail/<span class="hljs-number">10</span><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">23</span> <span class="hljs-number">23</span>:<span class="hljs-number">23</span>:04,074 - INFO: detail urls [<span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/detail/1&#x27;</span>, <span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/detail/2&#x27;</span>, <span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/detail/3&#x27;</span>, <span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/detail/4&#x27;</span>, <span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/detail/5&#x27;</span>, <span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/detail/6&#x27;</span>, <span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/detail/7&#x27;</span>, <span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/detail/8&#x27;</span>, <span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/detail/9&#x27;</span>, <span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/detail/10&#x27;</span>]<br><span class="hljs-number">2021</span>-05-<span class="hljs-number">23</span> <span class="hljs-number">23</span>:<span class="hljs-number">23</span>:04,076 - INFO: scraping https://static1.scrape.cuiqingcai.com/page/<span class="hljs-number">2.</span>..<br>....<br></code></pre></div></td></tr></table></figure><p>由于输出内容比较多，这里只贴了一部分。可以看到，在这个过程中程序首先爬取了第<code>1</code>页列表页，然后得到了对应详情页的每个<code>URL</code>，接着再接着爬第2页、第3页，一直到第10页，依次输出了每一页的详情页<code>URL</code>。这样，就成功获取到所有电影详情页<code>URL</code>。</p><h3 id="爬取详情页"><a href="#爬取详情页" class="headerlink" title="爬取详情页"></a>爬取详情页</h3><p>首先观察一下详情页的<code>HTML</code>代码，如图所示：</p><p><img src="Screenshot_5.webp"></p><p>经过分析，要提取的内容和对应的节点信息如下：</p><ul><li>封面：是一个<code>img</code>节点，其<code>class</code>属性为<code>cover</code>。</li><li>名称：是一个<code>h2</code>节点，其内容便是名称。</li><li>类别：是<code>span</code>节点，其内容便是类别</li><li>内容，其外侧是<code>button</code>节点，再外侧则是<code>class</code>为<code>categories</code>的<code>div</code>节点。</li><li>上映时间：是<code>span</code>节点，其内容包含了上映时间，其外侧是包含了<code>class</code>为<code>info</code>的<code>div</code>节点。但注意这个<code>div</code>前面还有一个<code>class</code>为<code>info</code>的<code>div</code>节点，可以使用其内容来区分，也可以使用<code>nth-child</code>或<code>nth- of-type</code>这样的选择器来区分。另外提取结果中还多了「上映」二字，可以用正则表达式把日期提取出来。</li><li>评分：是一个<code>p</code>节点，其内容便是评分，<code>p</code>节点的<code>class</code>属性为<code>score</code>。</li><li>剧情简介：是一个<code>p</code>节点，其内容便是</li><li>剧情简介，其外侧是<code>class</code>为<code>drama</code>的<code>div</code>节点。</li></ul><p>刚才已经成功获取了详情页的<code>URL</code>，接下来要定义一个详情页的爬取方法，实现如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">scrape_detail</span>(<span class="hljs-params">url</span>):</span> <br>    <span class="hljs-keyword">return</span> scrape_page(url)<br></code></pre></div></td></tr></table></figure><p>定义了一个<code>scrape_detail</code>方法，它接收一个<code>url</code>参数，并通过调用<code>scrape_page</code>方法获得网页源代码。由于刚才已经实现了<code>scrape_page</code>方法，所以在这里不用再写一遍页面爬取的逻辑，直接调用即可，这就做到了代码复用。</p><p>单独定义一个<code>scrape_detail</code>方法在逻辑上会显得更清晰，而且以后如果想要对<code>scrape_detail</code>方法进行改动，比如添加日志输出或是增加预处理，都可以在 <code>scrape_detail</code>里面实现，而不用改动<code>scrape_page</code>方法，灵活性会更好。</p><p>详情页的爬取方法已经实现了，接着就是详情页的解析了，实现如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_detail</span>(<span class="hljs-params">html</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;详情页的解析&quot;&quot;&quot;</span><br>    doc = pq(html)<br>    cover = doc(<span class="hljs-string">&#x27;img.cover&#x27;</span>).attr(<span class="hljs-string">&#x27;src&#x27;</span>)<br>    name = doc(<span class="hljs-string">&#x27;a &gt; h2&#x27;</span>).text()<br>    categories = [item.text() <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> doc(<span class="hljs-string">&#x27;.categories button span&#x27;</span>).items()]<br>    published_at = doc(<span class="hljs-string">&#x27;.info:contains(上映)&#x27;</span>).text()<br>    published_at = re.search(<span class="hljs-string">&#x27;(\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;)&#x27;</span>, published_at).group(<span class="hljs-number">1</span>) \<br>        <span class="hljs-keyword">if</span> published_at <span class="hljs-keyword">and</span> re.search(<span class="hljs-string">&#x27;\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;&#x27;</span>, published_at) <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span><br>    drama = doc(<span class="hljs-string">&#x27;.drama p&#x27;</span>).text()<br>    score = doc(<span class="hljs-string">&#x27;p.score&#x27;</span>).text()<br>    score = <span class="hljs-built_in">float</span>(score) <span class="hljs-keyword">if</span> score <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">return</span>&#123;<br>        <span class="hljs-string">&#x27;cover&#x27;</span>: cover,<br>        <span class="hljs-string">&#x27;name&#x27;</span>: name,<br>        <span class="hljs-string">&#x27;categories&#x27;</span>: categories,<br>        <span class="hljs-string">&#x27;published_at&#x27;</span>: published_at,<br>        <span class="hljs-string">&#x27;drama&#x27;</span>: drama,<br>        <span class="hljs-string">&#x27;score&#x27;</span>: score<br>    &#125;<br></code></pre></div></td></tr></table></figure><p>定义了<code>parse_detail</code>方法用于解析详情页，它接收一个<code>html</code>参数，解析其中的内容，并以字典的形式返回结果。每个字段的解析情况如下所述：</p><ul><li><code>cove</code>r：封面，直接选取<code>class</code>为<code>cover</code>的<code>img</code>节点，并调用<code>attr</code>方法获取<code>src</code>属性的内容即可。</li><li><code>name</code>：名称，直接选取<code>a</code>节点的直接子节点<code>h2</code>节点，并调用<code>text</code>方法提取其文本内容即可得到名称。</li><li><code>categories</code>：类别，由于类别是多个，所以这里首先用<code>.categories button span</code>选取了<code>class</code>为<code>categories</code>的节点内部的<code>span</code>节点，其结果是多个，所以这里进行了遍历，取出了每个<code>span</code>节点的文本内容，得到的便是列表形式的类别。</li><li><code>published_at</code>：上映时间，由于<code>pyquery</code>支持使用<code>:contains</code>直接指定包含的文本内容并进行提取，且每个上映时间信息都包含了「上映」二字，所以这里就直接使用<code>:contains(上映)</code>提取了<code>class</code>为<code>info</code>的<code>div</code>节点。提取之后，得到的结果类似「1993-07-26 上映」这样，并不想要「上映」这两个字，所以又调用了正则表达式把日期单独提取出来了。当然这里也可以直接使用<code>strip</code>或<code>replace</code>方法把多余的文字去掉。</li><li><code>drama</code>：直接提取<code>class</code>为<code>drama</code>的节点内部的<code>p</code>节点的文本即可。</li><li><code>score</code>：直接提取<code>class</code>为<code>score</code>的<code>p</code>节点的文本即可，由于提取结果是字符串，所以我们需要把它转成浮点数，即``float`类型。</li></ul><p>上述字段提取完毕之后，构造一个字典返回。这样，成功完成了详情页的提取和分析了。</p><p>将main方法稍微改写一下，增加这两个方法的调用，改写如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, TOTAL_PAGE+<span class="hljs-number">1</span>):<br>        index_html = scrape_index(page)<br>        detail_urls = parse_index((index_html))<br>        <span class="hljs-keyword">for</span> detail_url <span class="hljs-keyword">in</span> detail_urls:<br>            detail_html = scrape_detail(detail_url)<br>            data = parse_detail(detail_html)<br>            logging.info(<span class="hljs-string">&#x27;get detail data %s&#x27;</span>, data)<br></code></pre></div></td></tr></table></figure><p>首先遍历了<code>detail_urls</code>，获取了每个详情页的<code>URL</code>，然后依次调用了<code>scrape_detail</code>和<code>parse_detail</code>方法，最后得到了每个详情页的提取结果，赋值为<code>data</code>并输出。</p><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-number">2021</span>-05-<span class="hljs-number">24</span> <span class="hljs-number">12</span>:<span class="hljs-number">46</span>:<span class="hljs-number">31</span>,<span class="hljs-number">432</span> - INFO: get detail data &#123;<span class="hljs-string">&#x27;cover&#x27;</span>: <span class="hljs-string">&#x27;https://p0.meituan.net/movie/b0d986a8bf89278afbb19f6abaef70f31206570.jpg@464w_644h_1e_1c&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&quot;辛德勒的名单 - Schindler&#x27;s List&quot;</span>, <span class="hljs-string">&#x27;categories&#x27;</span>: [<span class="hljs-string">&#x27;剧情&#x27;</span>, <span class="hljs-string">&#x27;历史&#x27;</span>, <span class="hljs-string">&#x27;战争&#x27;</span>], <span class="hljs-string">&#x27;published_at&#x27;</span>: <span class="hljs-string">&#x27;1993-11-30&#x27;</span>, <span class="hljs-string">&#x27;drama&#x27;</span>: <span class="hljs-string">&#x27;1939年，波兰在纳粹德国的统治下，党卫军对犹太人进行了隔离统治。德国商人奥斯卡·辛德勒（连姆·尼森 饰）来到德军统治下的克拉科夫，开设了一间搪瓷厂，生产军需用品。凭着出众的社交能力和大量的金钱，辛德勒和德军建立了良好 的关系，他的工厂雇用犹太人工作，大发战争财。1943年，克拉科夫的犹太人遭到了惨绝人寰的大屠杀，辛德勒目睹这一切，受到了极大的震撼，他贿赂军官，让自己的工厂成为集中营的附属劳役营，在那些疯狂屠杀的日子里，他的工厂也成为了犹太人的避难所。1944年，德国战败前夕，屠杀犹太人的行动越发疯狂，辛德勒向德军军官开出了1200人的名单，倾家荡产买下了这些犹太人的生命。在那些暗无天日的岁月里，拯救一个人，就是拯救全世界。&#x27;</span>, <span class="hljs-string">&#x27;score&#x27;</span>: <span class="hljs-number">9.5</span>&#125;<br></code></pre></div></td></tr></table></figure><p>可以看到，已经成功提取出每部电影的基本信息，包括封面、名称、类别，等等。</p><h2 id="保存到MongoDB"><a href="#保存到MongoDB" class="headerlink" title="保存到MongoDB"></a>保存到MongoDB</h2><p>请确保现在有一个可以正常连接和使用的<code>MongoDB</code>数据库。 将数据导入<code>MongoDB</code>需要用到<code>PyMongo</code>这个库，这个在最开始已经引入过了。那么接下来我们定义一下 <code>MongoDB</code>的连接配置，实现如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">MONGO_CONNECTION_STRING = <span class="hljs-string">&#x27;mongodb://localhost:27017&#x27;</span><br>MONGO_DB_NAME = <span class="hljs-string">&#x27;movies&#x27;</span><br>MONGO_COLLECTIONS_NAME = <span class="hljs-string">&#x27;movies&#x27;</span><br><br>client = pymongo.MongoClient(MONGO_CONNECTION_STRING)<br>db = client[<span class="hljs-string">&#x27;movies&#x27;</span>]<br>collection = db[<span class="hljs-string">&#x27;movies&#x27;</span>]<br></code></pre></div></td></tr></table></figure><p>在这里声明了几个变量，介绍如下：</p><ul><li><code>MONGO_CONNECTION_STRING</code>：<code>MongoDB</code>的连接字符串，里面定义了<code>MongoDB</code>的基本连接信息，如<code>host</code>、<code>port</code>，还可以定义用户名密码等内容。</li><li><code>MONGO_DB_NAME</code>：<code>MongoDB</code>数据库的名称。</li><li><code>MONGO_COLLECTION_NAME</code>：<code>MongoDB</code>的集合名称。</li></ul><p>这里用<code>MongoClient</code>声明了一个连接对象，然后依次声明了存储的数据库和集合。接下来，再实现一个将数据保存到<code>MongoDB</code>的方法，实现如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_data</span>(<span class="hljs-params">data</span>):</span><br>    collection.update_one(&#123;<br>        <span class="hljs-string">&#x27;name&#x27;</span>: data.get(<span class="hljs-string">&#x27;name&#x27;</span>)<br>    &#125;,&#123;<br>        <span class="hljs-string">&#x27;$set&#x27;</span>: data<br>    &#125;, upsert=<span class="hljs-literal">True</span>)<br></code></pre></div></td></tr></table></figure><p>声明了一个<code>save_data</code>方法，它接收一个<code>data</code>参数，也就是我们刚才提取的电影详情信息。在方法里面，调用了<code>update_one</code>方法，第1个参数是<strong>查询条件</strong>，即根据<code>name</code>进行查询；第2个参数是<code>data</code>对象本身，也就是所有的数据，这里用<code>$set</code>操作符表示更新操作；第3个参数很关键，这里实际上是<code>upsert</code>参数，如果把这个设置为 <code>True</code>，则可以做到存在即更新，不存在即插入的功能，更新会根据第一个参数设置的<code>name</code>字段，所以这样可以防止数据库中出现同名的电影数据。</p><blockquote><p>注：实际上电影可能有同名，但该场景下的爬取数据没有同名情况，当然这里更重要的是实现<code>MongoDB</code>的去重操作。</p></blockquote><p>接下来将<code>main</code>方法稍微改写一下就好了，改写如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, TOTAL_PAGE+<span class="hljs-number">1</span>):<br>        index_html = scrape_index(page)<br>        detail_urls = parse_index((index_html))<br>        <span class="hljs-keyword">for</span> detail_url <span class="hljs-keyword">in</span> detail_urls:<br>            detail_html = scrape_detail(detail_url)<br>            data = parse_detail(detail_html)<br>            logging.info(<span class="hljs-string">&#x27;get detail data %s\n&#x27;</span>, data)<br>            logging.info(<span class="hljs-string">&#x27;saving data to mongodb&#x27;</span>)<br>            save_data(data)<br>            logging.info(<span class="hljs-string">&#x27;data saved successfully\n&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>重新运行，输出结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">......<br><span class="hljs-number">2021</span>-05-<span class="hljs-number">24</span> <span class="hljs-number">13</span>:<span class="hljs-number">16</span>:<span class="hljs-number">46</span>,<span class="hljs-number">882</span> - INFO: get detail data &#123;<span class="hljs-string">&#x27;cover&#x27;</span>: <span class="hljs-string">&#x27;https://p0.meituan.net/movie/58782fa5439c25d764713f711ebecd1e201941.jpg@464w_644h_1e_1c&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;魂断蓝桥 - Waterloo Bridge&#x27;</span>, <span class="hljs-string">&#x27;categories&#x27;</span>: [<span class="hljs-string">&#x27;剧情&#x27;</span>, <span class="hljs-string">&#x27;爱情&#x27;</span>, <span class="hljs-string">&#x27;战争&#x27;</span>], <span class="hljs-string">&#x27;published_at&#x27;</span>: <span class="hljs-string">&#x27;1940-05-17&#x27;</span>, <span class="hljs-string">&#x27;drama&#x27;</span>: <span class="hljs-string">&#x27;第一次世界大战期间，回国度假的陆军中 </span><br><span class="hljs-string">尉罗伊（罗伯特·泰勒 饰）在滑铁卢桥上邂逅了舞蹈演员玛拉（费雯·丽 饰），两人彼此倾心，爱情迅速升温。就在两人决定结婚之时，罗伊应招回营地，两人被迫分离。由</span><br><span class="hljs-string">于错过剧团演出，玛拉被开除，只能和好友相依为命。不久玛拉得知罗伊阵亡的消息，几欲崩溃，备受打击。失去爱情的玛拉感到一切都失去了意义，为了生存，她和好友不</span><br><span class="hljs-string">得不沦为妓女。然而命运弄人，就在此时玛拉竟然再次遇到了罗伊。虽然为罗伊的生还兴奋不已，玛拉却因自己的失身陷入痛苦之中。感到一切难以挽回的玛拉潸然离开，独</span><br><span class="hljs-string">自来到两人最初相遇的地点——滑铁卢桥上…&#x27;</span>, <span class="hljs-string">&#x27;score&#x27;</span>: <span class="hljs-number">9.5</span>&#125;<br><br><span class="hljs-number">2021</span>-05-<span class="hljs-number">24</span> <span class="hljs-number">13</span>:<span class="hljs-number">16</span>:<span class="hljs-number">46</span>,<span class="hljs-number">885</span> - INFO: saving data to mongodb<br><span class="hljs-number">2021</span>-05-<span class="hljs-number">24</span> <span class="hljs-number">13</span>:<span class="hljs-number">16</span>:<span class="hljs-number">46</span>,<span class="hljs-number">889</span> - INFO: data saved successfully<br></code></pre></div></td></tr></table></figure><p>运行完毕之后我们可以使用<code>MongoDB</code>客户端工具可视化查看已经爬取到的数据，结果如下：</p><p><img src="Screenshot_6.webp"></p><h2 id="多进程加速"><a href="#多进程加速" class="headerlink" title="多进程加速"></a>多进程加速</h2><p>由于整个的爬取是单进程的，而且只能逐条爬取，速度稍微有点慢，有没有方法来对整个爬取过程进行加速呢？</p><p>在前面学习了多进程的基本原理和使用方法，下面就来实践一下多进程的爬取。</p><p>由于一共有<code>10</code>页详情页，并且这<code>10</code>页内容是互不干扰的，所以可以一页开一个进程来爬取。由于这<code>10</code>个列表页页码正好可以提前构造成一个列表，所以可以选用多进程里面的进程池<code>Pool</code>来实现这个过程。</p><p>这里需要改写下<code>main</code>方法的调用，实现如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>(<span class="hljs-params">page</span>):</span><br>    <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, TOTAL_PAGE+<span class="hljs-number">1</span>):<br>        index_html = scrape_index(page)<br>        detail_urls = parse_index((index_html))<br>        <span class="hljs-keyword">for</span> detail_url <span class="hljs-keyword">in</span> detail_urls:<br>            detail_html = scrape_detail(detail_url)<br>            data = parse_detail(detail_html)<br>            logging.info(<span class="hljs-string">&#x27;get detail data %s\n&#x27;</span>, data)<br>            logging.info(<span class="hljs-string">&#x27;saving data to mongodb&#x27;</span>)<br>            save_data(data)<br>            logging.info(<span class="hljs-string">&#x27;data saved successfully\n&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    pool = multiprocessing.Pool()<br>    pages = <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, TOTAL_PAGE + <span class="hljs-number">1</span>)<br>    pool.<span class="hljs-built_in">map</span>(main, pages)<br>    pool.close()<br>    pool.join()<br></code></pre></div></td></tr></table></figure><p>这里首先给<code>main</code>方法添加一个参数<code>page</code>，用以表示列表页的页码。接着声明了一个进程池，并声明<code>pages</code>为所有需要遍历的页码，即<code>1~10</code>。最后调用<code>map</code>方法，第1个参数就是需要被调用的方法，第2个参数就是<code>pages</code>，即需要遍历的页码。</p><p>这样<code>pages</code>就会被依次遍历。把<code>1~10</code>这10个页码分别传递给<code>main</code>方法，并把每次的调用变成一个进程，加入到进程池中执行，进程池会根据当前运行环境来决定运行多少进程。</p><p>运行输出结果和之前类似，但是可以明显看到加了多进程执行之后，爬取速度快了非常多。可以清空一下之前的<code>MongoDB</code>数据，可以发现数据依然可以被正常保存到<code>MongoDB</code>数据库中。</p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>request</tag>
      
      <tag>pyquest</tag>
      
      <tag>pymongodb</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MongoDB数据库的使用</title>
    <link href="/2021/05/23/MongoDB%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2021/05/23/MongoDB%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>开始之前，请确保你已经安装好了<code>MongoDB</code>并启动了其服务，同时安装好了<code>Python</code>的<code>PyMongo</code>库。</p><p>安装好之后，我们需要把<code>MongoDB</code>服务启动起来。启动完成之后，它会默认在本地<code>localhost</code>的<code>27017</code>端口上运行。</p><p>接下来我们需要安装<code>PyMongo</code>这个库，它是<code>Python</code>用来操作<code>MongoDB</code>的第三方库，直接用<code>pip3</code>安装即可：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip3 install pymongo<br></code></pre></div></td></tr></table></figure><h2 id="连接MongoDB"><a href="#连接MongoDB" class="headerlink" title="连接MongoDB"></a>连接MongoDB</h2><p>连接<code>MongoDB</code>时，需要使用<code>PyMongo</code>库里面的<code>MongoClient</code>。一般来说，向其传入<code>MongoDB</code>的<code>IP</code>及端口即可，其中第一个参数为地址<code>host</code>，第二个参数为端口 <code>port</code>（如果不给它传递参数，则默认是<code>27017</code>）：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymongo<br><br>client = pymongo.MongoClient(host=<span class="hljs-string">&#x27;localhost&#x27;</span>, port=<span class="hljs-number">27017</span>)<br></code></pre></div></td></tr></table></figure><p>另外，<code>MongoClient</code>的第一个参数<code>host</code>还可以直接传入<code>MongoDB</code>的连接字符串，它以<code>mongodb</code>开头，例如：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">client = MongoClient(<span class="hljs-string">&#x27;mongodb://localhost:27017/&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>这样也可以达到同样的连接效果。</p><h3 id="指定数据库"><a href="#指定数据库" class="headerlink" title="指定数据库"></a>指定数据库</h3><p><code>MongoDB</code>中可以建立多个数据库，接下来指定操作其中一个数据库。这里以<code>test</code>数据库作为下一步需要在程序中指定使用的例子：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">db = client.test<br></code></pre></div></td></tr></table></figure><p>这里调用<code>client</code>的<code>test</code>属性即可返回<code>test</code>数据库。当然，也可以这样指定：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">db = client[<span class="hljs-string">&#x27;test&#x27;</span>]<br></code></pre></div></td></tr></table></figure><p>这两种方式是等价的。</p><h3 id="指定集合"><a href="#指定集合" class="headerlink" title="指定集合"></a>指定集合</h3><p><code>MongoDB</code>的每个数据库又包含许多集合<code>（collection）</code>，它们类似于关系型数据库中的表。</p><p>下一步需要指定要操作的集合，这里指定一个名称为<code>students</code>的集合。与指定数据库类似，指定集合也有两种方式：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">collection = db.students<br></code></pre></div></td></tr></table></figure><p>或是</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">collection = db[<span class="hljs-string">&#x27;students&#x27;</span>]<br></code></pre></div></td></tr></table></figure><p>这样便声明了一个<code>Collection</code>对象。</p><h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><p>接下来，便可以插入数据了。对<code>students</code>这个集合新建一条学生数据，这条数据以字典形式表示：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">student = &#123;<br>    <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;20170101&#x27;</span>,<br>    <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Jordan&#x27;</span>,<br>    <span class="hljs-string">&#x27;age&#x27;</span>:<span class="hljs-string">&#x27;20&#x27;</span>,<br>    <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>新建的这条数据里指定了学生的学号、姓名、年龄和性别。直接调用<code>collection</code>的<code>insert</code>方法即可插入数据，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = collection.insert(student)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></div></td></tr></table></figure><p>在<code>MongoDB</code>中，每条数据其实都有一个<code>_id</code>属性来唯一标识。如果没有显式指明该属性，<code>MongoDB</code>会自动产生一个<code>ObjectId</code>类型的<code>_id</code>属性。<code>insert()</code>方法会在执行后返回<code>_id</code>值。</p><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">60aa06aca3aff156a9093404<br></code></pre></div></td></tr></table></figure><p>当然，我们也可以同时插入多条数据，只需要以列表形式传递即可，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">student1 = &#123;<br>    <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;20170102&#x27;</span>,<br>    <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Jack&#x27;</span>,<br>    <span class="hljs-string">&#x27;age&#x27;</span>:<span class="hljs-string">&#x27;23&#x27;</span>,<br>    <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span><br>&#125;<br><br>student2 = &#123;<br>    <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;201701013&#x27;</span>,<br>    <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Holy&#x27;</span>,<br>    <span class="hljs-string">&#x27;age&#x27;</span>:<span class="hljs-string">&#x27;25&#x27;</span>,<br>    <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span><br>&#125;<br>result = collection.insert([student1, student2])<br><span class="hljs-built_in">print</span>(result)<br></code></pre></div></td></tr></table></figure><p>返回结果是对应的<code>_id</code>的集合：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">[ObjectId(<span class="hljs-string">&#x27;60aa07d11755f43c2a5becf3&#x27;</span>), ObjectId(<span class="hljs-string">&#x27;60aa07d11755f43c2a5becf4&#x27;</span>)]<br></code></pre></div></td></tr></table></figure><p>在<code>PyMongo</code>中，官方已经不推荐使用<code>insert</code>方法了。但是如果你要继续使用也没有什么问题。目前，官方推荐使用<code>insert_one</code>和<code>insert_many</code>方法来分别插入单条记录和多条记录，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">student = &#123;<br>    <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;20170101&#x27;</span>,<br>    <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Jordan&#x27;</span>,<br>    <span class="hljs-string">&#x27;age&#x27;</span>:<span class="hljs-string">&#x27;20&#x27;</span>,<br>    <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span><br>&#125;<br><br>result = collection.insert_one(student)<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-built_in">print</span>(result.inserted_id)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;pymongo.results.InsertOneResult <span class="hljs-built_in">object</span> at <span class="hljs-number">0x00000267F7E9CD80</span>&gt;<br>60aa0884c1479c83fc0e07a6<br></code></pre></div></td></tr></table></figure><p>与<code>insert</code>方法不同，返回的是<code>InsertOneResult</code>对象，可以调用其<code>inserted_id</code>属性获取<code>_id</code>。 对于<code>insert_many</code>方法，可以将数据以列表形式传递，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">student1 = &#123;<br>    <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;20170102&#x27;</span>,<br>    <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Jack&#x27;</span>,<br>    <span class="hljs-string">&#x27;age&#x27;</span>:<span class="hljs-string">&#x27;23&#x27;</span>,<br>    <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span><br>&#125;<br><br>student2 = &#123;<br>    <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;201701013&#x27;</span>,<br>    <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Holy&#x27;</span>,<br>    <span class="hljs-string">&#x27;age&#x27;</span>:<span class="hljs-string">&#x27;25&#x27;</span>,<br>    <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span><br>&#125;<br>result = collection.insert_many([student1,student2])<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-built_in">print</span>(result.inserted_ids)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;pymongo.results.InsertManyResult <span class="hljs-built_in">object</span> at <span class="hljs-number">0x0000021A0BA7A780</span>&gt;<br>[ObjectId(<span class="hljs-string">&#x27;60aa0908ba9556afc2c8ebec&#x27;</span>), ObjectId(<span class="hljs-string">&#x27;60aa0908ba9556afc2c8ebed&#x27;</span>)]<br></code></pre></div></td></tr></table></figure><p>该方法返回的类型是<code>InsertManyResult</code>，调用<code>inserted_ids</code>属性可以获取插入数据的<code>_id</code>列表。</p><h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><p>插入数据后，可以利用<code>find_one</code>或<code>find</code>方法进行查询，其中<code>find_one</code>查询得到的是单个结果，<code>find</code>则返回一个生成器对象。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = collection.find_one(&#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Holy&#x27;</span>&#125;)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></div></td></tr></table></figure><p>这里我们查询<code>name</code>为<code>Holy</code>的数据，它的返回结果是字典类型，运行结果如下：</p><p>查询结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: ObjectId(<span class="hljs-string">&#x27;60aa07d11755f43c2a5becf4&#x27;</span>), <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;201701013&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Holy&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-string">&#x27;25&#x27;</span>, <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span>&#125;<br></code></pre></div></td></tr></table></figure><p>可以发现，它多了<code>_id</code>属性，这就是<code>MongoDB</code>在插入过程中自动添加的。此外，也可以根据<code>ObjectId</code>来查询，此时需要调用<code>bson</code>库里面的<code>objectid</code>：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> bson.objectid <span class="hljs-keyword">import</span> ObjectId<br><br>result = collection.find_one(&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: ObjectId(<span class="hljs-string">&#x27;60aa07d11755f43c2a5becf4&#x27;</span>)&#125;)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></div></td></tr></table></figure><p>查询结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: ObjectId(<span class="hljs-string">&#x27;60aa07d11755f43c2a5becf4&#x27;</span>), <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;201701013&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Holy&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-string">&#x27;25&#x27;</span>, <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span>&#125;<br></code></pre></div></td></tr></table></figure><p>对于多条数据的查询，可以使用<code>find</code>方法。例如，这里查找性别为<code>male</code>的数据，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">results = collection.find(&#123;<span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-number">20</span>&#125;)<br><span class="hljs-built_in">print</span>(results)<br><span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> results:<br>    <span class="hljs-built_in">print</span>(result)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: ObjectId(<span class="hljs-string">&#x27;60aa065e109b00a7eee5447b&#x27;</span>), <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;20170101&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Jordan&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-string">&#x27;20&#x27;</span>, <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: ObjectId(<span class="hljs-string">&#x27;60aa0686802c3967b97d7791&#x27;</span>), <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;20170101&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Jordan&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-string">&#x27;20&#x27;</span>, <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: ObjectId(<span class="hljs-string">&#x27;60aa06aca3aff156a9093404&#x27;</span>), <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;20170101&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Jordan&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-string">&#x27;20&#x27;</span>, <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: ObjectId(<span class="hljs-string">&#x27;60aa076374369a6a0801fb4a&#x27;</span>), <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;20170102&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-string">&#x27;23&#x27;</span>, <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: ObjectId(<span class="hljs-string">&#x27;60aa077162e23647877e4213&#x27;</span>), <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;20170102&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-string">&#x27;23&#x27;</span>, <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: ObjectId(<span class="hljs-string">&#x27;60aa07d11755f43c2a5becf3&#x27;</span>), <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;20170102&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-string">&#x27;23&#x27;</span>, <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: ObjectId(<span class="hljs-string">&#x27;60aa07d11755f43c2a5becf4&#x27;</span>), <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;201701013&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Holy&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-string">&#x27;25&#x27;</span>, <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: ObjectId(<span class="hljs-string">&#x27;60aa0884c1479c83fc0e07a6&#x27;</span>), <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;20170101&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Jordan&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-string">&#x27;20&#x27;</span>, <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: ObjectId(<span class="hljs-string">&#x27;60aa08f67cd6ac92cb505552&#x27;</span>), <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;20170102&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-string">&#x27;23&#x27;</span>, <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: ObjectId(<span class="hljs-string">&#x27;60aa08f67cd6ac92cb505553&#x27;</span>), <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;201701013&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Holy&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-string">&#x27;25&#x27;</span>, <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: ObjectId(<span class="hljs-string">&#x27;60aa0908ba9556afc2c8ebec&#x27;</span>), <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;20170102&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-string">&#x27;23&#x27;</span>, <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: ObjectId(<span class="hljs-string">&#x27;60aa0908ba9556afc2c8ebed&#x27;</span>), <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;201701013&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Holy&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-string">&#x27;25&#x27;</span>, <span class="hljs-string">&#x27;gender&#x27;</span>: <span class="hljs-string">&#x27;male&#x27;</span>&#125;<br></code></pre></div></td></tr></table></figure><p>返回结果是<code>Cursor</code>类型，它相当于一个生成器，需要遍历获取的所有结果，其中每个结果都是字典类型。</p><p>如果要查询年龄大于<code>20</code>的数据，则写法如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">results = collection.find(&#123;<span class="hljs-string">&#x27;age&#x27;</span>: &#123;<span class="hljs-string">&#x27;$gt&#x27;</span>: <span class="hljs-number">20</span>&#125;&#125;)<br></code></pre></div></td></tr></table></figure><p>查询的条件键值已经不是单纯的数字了，而是一个字典，其键名为比较符号<code>$gt</code>，意思是<strong>大于</strong>，键值为<code>20</code>。</p><p>比较符号归纳如下：</p><table><thead><tr><th align="center">符号</th><th align="center">含义</th><th align="center">示例</th></tr></thead><tbody><tr><td align="center">$lt</td><td align="center">小于</td><td align="center">{‘age’:{‘$lt’:20}}</td></tr><tr><td align="center">$gt</td><td align="center">大于</td><td align="center">{‘age’:{‘$gt’:20}}</td></tr><tr><td align="center">$lte</td><td align="center">小于或等于</td><td align="center">{‘age’:{‘$lte’:20}}</td></tr><tr><td align="center">$gte</td><td align="center">大于或等于</td><td align="center">{‘age’:{‘$gte’:20}}</td></tr><tr><td align="center">$ne</td><td align="center">不等于</td><td align="center">{‘age’:{‘$ne’:20}}</td></tr><tr><td align="center">$in</td><td align="center">在范围内</td><td align="center">{‘age’:{‘$in’:[20,23]}}</td></tr><tr><td align="center">$nin</td><td align="center">不在范围内</td><td align="center">{‘age’:{‘$nin’:[20, 23]}}</td></tr></tbody></table><style>    table    {        margin: auto;        font-size: 80%;    }</style><p>另外，还可以进行正则匹配查询。例如，查询名字以<code>H</code>开头的学生数据，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">results = collection.find(&#123;<span class="hljs-string">&#x27;name&#x27;</span>: &#123;<span class="hljs-string">&#x27;$regex&#x27;</span>: <span class="hljs-string">&#x27;^H.*&#x27;</span>&#125;&#125;)<br></code></pre></div></td></tr></table></figure><p>这里使用<code>$regex</code>来指定正则匹配，<code>^M.*</code>代表以<code>M</code>开头的正则表达式。</p><p>一些功能符号归类为下表：</p><table><thead><tr><th align="center">符号</th><th align="center">含义</th><th align="center">示例</th></tr></thead><tbody><tr><td align="center">$regrx</td><td align="center">匹配正则表达式</td><td align="center">{‘name’:{‘$regex’:’^M.*’}}</td></tr><tr><td align="center">$exists</td><td align="center">属性是否存在</td><td align="center">{‘name’:{‘$exists’:True}}</td></tr><tr><td align="center">$type</td><td align="center">类型判断</td><td align="center">{‘age’:{‘$type’:’int’}}</td></tr><tr><td align="center">$mod</td><td align="center">数字模操作</td><td align="center">{‘age’:{‘$mod’:[5,0]}}</td></tr><tr><td align="center">$text</td><td align="center">文本查询</td><td align="center">{‘$text’:{‘$search’:’Holy’}}</td></tr><tr><td align="center">$where</td><td align="center">高级条件查询</td><td align="center">{‘$where’:’obj.fans_count==obj.follows_count’}</td></tr></tbody></table><h3 id="计数"><a href="#计数" class="headerlink" title="计数"></a>计数</h3><p>要统计查询结果有多少条数据，可以调用<code>count</code>方法。以统计所有数据条数为例：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">count = collection.find().count()<br><span class="hljs-built_in">print</span>(count)<br></code></pre></div></td></tr></table></figure><p>我们还可以统计符合某个条件的数据：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">count = collection.find(&#123;<span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-number">20</span>&#125;).count() <br><span class="hljs-built_in">print</span>(count)<br></code></pre></div></td></tr></table></figure><p>运行结果是一个数值，即符合条件的数据条数。</p><h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><p>排序时，可以直接调用<code>sort</code>方法，并在其中传入排序的字段及升降序标志。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">results = collection.find().sort(<span class="hljs-string">&#x27;name&#x27;</span>, pymongo.ASCENDING)<br><span class="hljs-built_in">print</span>([result[<span class="hljs-string">&#x27;name&#x27;</span>] <span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> results])<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">[<span class="hljs-string">&#x27;Holy&#x27;</span>, <span class="hljs-string">&#x27;Holy&#x27;</span>, <span class="hljs-string">&#x27;Holy&#x27;</span>, <span class="hljs-string">&#x27;Holy&#x27;</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;Jordan&#x27;</span>, <span class="hljs-string">&#x27;Jordan&#x27;</span>, <span class="hljs-string">&#x27;Jordan&#x27;</span>, <span class="hljs-string">&#x27;Jordan&#x27;</span>]<br></code></pre></div></td></tr></table></figure><p>调用<code>pymongo.ASCENDING</code>指定升序。如果要降序排列，可以传入<code>pymongo.DESCENDING</code>。</p><h3 id="偏移"><a href="#偏移" class="headerlink" title="偏移"></a>偏移</h3><p>只需要取某几个元素，可以利用<code>skip</code>方法偏移几个位置，比如偏移2，就代表忽略前两个元素，得到第3个及以后的元素：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">results = collection.find().sort(<span class="hljs-string">&#x27;name&#x27;</span>, pymongo.ASCENDING).skip(<span class="hljs-number">3</span>)<br><span class="hljs-built_in">print</span>([result[<span class="hljs-string">&#x27;name&#x27;</span>] <span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> results])<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">[<span class="hljs-string">&#x27;Holy&#x27;</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-string">&#x27;Jordan&#x27;</span>, <span class="hljs-string">&#x27;Jordan&#x27;</span>, <span class="hljs-string">&#x27;Jordan&#x27;</span>, <span class="hljs-string">&#x27;Jordan&#x27;</span>]<br></code></pre></div></td></tr></table></figure><p>还可以用<code>limit</code>方法指定要取的结果个数，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">results = collection.find().sort(<span class="hljs-string">&#x27;name&#x27;</span>, pymongo.ASCENDING).limit(<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>([result[<span class="hljs-string">&#x27;name&#x27;</span>] <span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> results])<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">[<span class="hljs-string">&#x27;Holy&#x27;</span>]<br></code></pre></div></td></tr></table></figure><p>值得注意的是，在数据量非常庞大的时候，比如在查询千万、亿级别的数据库时，最好不要使用大的偏移量，因为这样很可能导致内存溢出。</p><h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><p>数据更新，可以使用<code>update</code>方法，指定更新的条件和更新后的数据即可。例如：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">condition = &#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Holy&#x27;</span>&#125;<br>student = collection.find_one(condition)<br>student[<span class="hljs-string">&#x27;age&#x27;</span>] = <span class="hljs-number">30</span><br>result = collection.update(condition, student)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></div></td></tr></table></figure><p>更新<code>name</code>为<code>Holy</code>的数据的年龄：首先指定查询条件，然后将数据查询出来，修改年龄后调用<code>update</code>方法将原条件和修改后的数据传入。</p><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<span class="hljs-string">&#x27;n&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;nModified&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;ok&#x27;</span>: <span class="hljs-number">1.0</span>, <span class="hljs-string">&#x27;updatedExisting&#x27;</span>: <span class="hljs-literal">True</span>&#125;<br></code></pre></div></td></tr></table></figure><p>返回结果是字典形式，<code>ok</code>代表执行成功，<code>nModified</code>代表影响的数据条数。</p><p>也可以使用<code>$set</code>操作符对数据进行更新，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = collection.update(condition, &#123;<span class="hljs-string">&#x27;$set&#x27;</span>: student&#125;)<br></code></pre></div></td></tr></table></figure><p>这样可以只更新<code>student</code>字典内存在的字段。如果原先还有其他字段，则不会更新，也不会删除。而如果不用<code>$set</code>的话，则会把之前的数据全部用<code>student</code>字典替换；如果原本存在其他字段，则会被删除。</p><p><code>update</code>方法其实也是官方不推荐使用的方法。这里也分为<code>update_one</code>方法和<code>update_many</code>方法，用法更加严格，它们的第2个参数需要使用<code>$</code>类型操作符作为字典的键名，示例如下:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">condition = &#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Kevin&#x27;</span>&#125; <br>student = collection.find_one(condition)<br>student[<span class="hljs-string">&#x27;age&#x27;</span>] = <span class="hljs-number">26</span><br>result = collection.update_one(condition, &#123;<span class="hljs-string">&#x27;$set&#x27;</span>: student&#125;)<br><span class="hljs-built_in">print</span>(result) <span class="hljs-built_in">print</span>(result.matched_count, result.modified_count)<br></code></pre></div></td></tr></table></figure><p>上面的例子中调用了<code>update_one</code>方法，使得第2个参数不能再直接传入修改后的字典，而是需要使用<code>&#123;&#39;$set&#39;:student&#125;</code>这样的形式，其返回结果是<code>UpdateResult</code>类型。然后分别调用<code>matched_count</code>和<code>modified_count</code>属性，可以获得匹配的数据条数和影响的数据条数。</p><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;pymongo.results.UpdateResult <span class="hljs-built_in">object</span> at <span class="hljs-number">0x10d17b678</span>&gt;<br><span class="hljs-number">1</span> <span class="hljs-number">0</span><br></code></pre></div></td></tr></table></figure><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p>删除操作比较简单，直接调用<code>remove</code>方法指定删除的条件即可，此时符合条件的所有数据均会被删除。</p><p>示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = collection.remove(&#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Kevin&#x27;</span>&#125;)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<span class="hljs-string">&#x27;ok&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;n&#x27;</span>: <span class="hljs-number">1</span>&#125;<br></code></pre></div></td></tr></table></figure><p>另外，这里依然存在两个新的推荐方法 ——<code>delete_one</code>和<code>delete_many</code>，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = collection.delete_one(&#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Kevin&#x27;</span>&#125;)<br><span class="hljs-built_in">print</span>(result) <br><span class="hljs-built_in">print</span>(result.deleted_count)<br>result = collection.delete_many(&#123;<span class="hljs-string">&#x27;age&#x27;</span>: &#123;<span class="hljs-string">&#x27;$lt&#x27;</span>: <span class="hljs-number">25</span>&#125;&#125;)<br><span class="hljs-built_in">print</span>(result.deleted_count)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;pymongo.results.DeleteResult <span class="hljs-built_in">object</span> at <span class="hljs-number">0x10e6ba4c8</span>&gt; <br><span class="hljs-number">14</span><br></code></pre></div></td></tr></table></figure><p><code>delete_one</code>删除第一条符合条件的数据，<code>delete_many</code>即删除所有符合条件的数据。它们的返回结果都是<code>DeleteResult</code>类型，可以调用<code>deleted_count</code>属性获取删除的数据条数。</p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>mongodb</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pyquery的使用</title>
    <link href="/2021/05/23/Pyquery%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2021/05/23/Pyquery%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p><code>pyquery</code>是<code>Python</code>的第三方库，安装命令如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip3 install pyquery<br></code></pre></div></td></tr></table></figure><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>解析<code>HTML</code>文本的时候，首先需要将其初始化为一个<code>pyquery</code>对象。它的初始化方式有多种，比如直接<strong>传入字符串</strong>、<strong>传入<code>URL</code><strong>、</strong>传入文件名</strong>，等等。</p><h3 id="字符串初始化"><a href="#字符串初始化" class="headerlink" title="字符串初始化"></a>字符串初始化</h3><p>可以直接把<code>HTML</code>的内容当作参数来初始化<code>pyquery</code>对象。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">html = <span class="hljs-string">&#x27;&#x27;&#x27; </span><br><span class="hljs-string">&lt;div&gt;</span><br><span class="hljs-string">    &lt;ul&gt; </span><br><span class="hljs-string">        &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span><br><span class="hljs-string">        &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt; </span><br><span class="hljs-string">        &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt; </span><br><span class="hljs-string">        &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt; </span><br><span class="hljs-string">        &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">    &lt;/ul&gt; </span><br><span class="hljs-string">&lt;/div&gt; </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span> <br><br><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq <br><br>doc = pq(html) <br><br><span class="hljs-built_in">print</span>(doc(<span class="hljs-string">&#x27;li&#x27;</span>))<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;li <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;<span class="hljs-title">first</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link2</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">second</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt; </span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt; </span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link4</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fourth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt; </span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link5</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fifth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>引入<code>pyquery</code>这个对象，取别名为<code>pq</code>，然后声明了一个长<code>HTML</code>字符串，并将其当作参数传递给<code>pyquery</code>类，这样就成功完成了初始化。</p><p>接下来，将初始化的对象传入<code>CSS</code>选择器。在这个实例中，传入<code>li</code>节点，这样就可以选择所有的<code>li</code>节点。</p><h3 id="URL初始化"><a href="#URL初始化" class="headerlink" title="URL初始化"></a>URL初始化</h3><p>初始化的参数不仅可以以字符串的形式传递，还可以传入网页的<code>URL</code>，只需要指定参数为<code>url</code>即可：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq <br><br>doc = pq(url=<span class="hljs-string">&#x27;https://www.holychan.ltd&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(doc(<span class="hljs-string">&#x27;title&#x27;</span>))<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;title&gt;Holy的个人站点&lt;/title&gt;<br></code></pre></div></td></tr></table></figure><p><code>pyquery</code>对象会首先请求这个<code>URL</code>，然后用得到的<code>HTML</code>内容完成初始化。这就相当于将网页的源代码以字符串的形式传递给<code>pyquery</code>类来初始化。</p><p>它与下面的功能是相同的：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br><span class="hljs-keyword">import</span> requests<br><br>doc = pq(requests.get(<span class="hljs-string">&#x27;https://www.holychan.ltd&#x27;</span>).text)<br><span class="hljs-built_in">print</span>(doc(<span class="hljs-string">&#x27;title&#x27;</span>))<br></code></pre></div></td></tr></table></figure><h3 id="文件初始化"><a href="#文件初始化" class="headerlink" title="文件初始化"></a>文件初始化</h3><p>除了传递一个<code>URL</code>，还可以传递本地的文件名，参数指定为<code>filename</code>即可：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br><br>doc = pq(filename=<span class="hljs-string">&#x27;demo.html&#x27;</span>)<br><span class="hljs-built_in">print</span>(doc(<span class="hljs-string">&#x27;li&#x27;</span>))<br></code></pre></div></td></tr></table></figure><p>这里需要有一个本地<code>HTML</code>文件<code>demo.html</code>，其内容是待解析的<code>HTML</code>字符串。这样它会先读取本地的文件内容，然后将文件内容以字符串的形式传递给 <code>pyquery</code>类来初始化。</p><p>以上3种方式均可初始化，当然最常用的初始化方式还是以字符串形式传递。</p><h2 id="基本CSS选择器"><a href="#基本CSS选择器" class="headerlink" title="基本CSS选择器"></a>基本CSS选择器</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">html = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;div id=&quot;container&quot;&gt;</span><br><span class="hljs-string">    &lt;ul class=&quot;list&quot;&gt;</span><br><span class="hljs-string">        &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span><br><span class="hljs-string">        &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">    &lt;/ul&gt;</span><br><span class="hljs-string">&lt;/div&gt; </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span> <br><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq <br>doc = pq(html)<br><span class="hljs-built_in">print</span>(doc(<span class="hljs-string">&#x27;#container .list li&#x27;</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(doc(<span class="hljs-string">&#x27;#container .list li&#x27;</span>)))<br></code></pre></div></td></tr></table></figure><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;li <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;<span class="hljs-title">first</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link2</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">second</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link4</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fourth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link5</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fifth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class"></span><br><span class="hljs-class">&lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">pyquery</span>.<span class="hljs-title">pyquery</span>.<span class="hljs-title">PyQuery</span>&#x27;&gt;</span><br></code></pre></div></td></tr></table></figure><p>初始化<code>pyquery</code>对象之后，传入<code>CSS</code>选择器<code>#container .list li</code>，它的意思是先选取<code>id</code>为<code>container</code>的节点，然后再选取其内部<code>class</code>为<code>list</code>的所有<code>li</code>节点，最后打印输出。成功获取到了符合条件的节点。将它的类型打印输出后发现，它的类型依然是<code>pyquery</code>类型。</p><p>直接遍历这些节点，然后调用<code>text</code>方法，就可以获取节点的文本内容，代码示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> doc(<span class="hljs-string">&#x27;#container .list li&#x27;</span>).items():<br>    <span class="hljs-built_in">print</span>(item.text())<br></code></pre></div></td></tr></table></figure><p>结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">first item<br>second item<br>third item<br>fourth item<br>fifth item<br></code></pre></div></td></tr></table></figure><h2 id="查找节点"><a href="#查找节点" class="headerlink" title="查找节点"></a>查找节点</h2><h3 id="子节点"><a href="#子节点" class="headerlink" title="子节点"></a>子节点</h3><p>查找子节点需要用到<code>find</code>方法，传入的参数是<code>CSS</code>选择器：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">html = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;div id=&quot;container&quot;&gt;</span><br><span class="hljs-string">    &lt;ul class=&quot;list&quot;&gt;</span><br><span class="hljs-string">        &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span><br><span class="hljs-string">        &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">    &lt;/ul&gt;</span><br><span class="hljs-string">&lt;/div&gt; </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span> <br><br><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br><br>doc = pq(html)<br><br>items = doc(<span class="hljs-string">&#x27;.list&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(items))<br><span class="hljs-built_in">print</span>(items)<br>lis = items.find(<span class="hljs-string">&#x27;li&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(lis))<br><span class="hljs-built_in">print</span>(lis)<br></code></pre></div></td></tr></table></figure><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">pyquery</span>.<span class="hljs-title">pyquery</span>.<span class="hljs-title">PyQuery</span>&#x27;&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">ul</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">list</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;<span class="hljs-title">first</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link2</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">second</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link4</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fourth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link5</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fifth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">ul</span>&gt;</span><br><span class="hljs-class"></span><br><span class="hljs-class">&lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">pyquery</span>.<span class="hljs-title">pyquery</span>.<span class="hljs-title">PyQuery</span>&#x27;&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;<span class="hljs-title">first</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link2</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">second</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link4</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fourth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link5</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fifth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>通过<code>.list</code>参数选取<code>class</code>为<code>list</code>的节点，然后调用<code>find</code>方法，传入<code>CSS</code>选择器，选取其内部的<code>li</code>节点，最后打印输出。可以发现，<code>find</code>方法会将符合条件的所有节点选择出来，结果的类型是<code>pyquery</code>类型。</p><p><code>find</code>的查找范围是节点的所有子孙节点，而如果我们只想查找子节点，那可以用<code>children</code>方法：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">lis = items.children()<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(lis))<br><span class="hljs-built_in">print</span>(lis)<br></code></pre></div></td></tr></table></figure><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">pyquery</span>.<span class="hljs-title">pyquery</span>.<span class="hljs-title">PyQuery</span>&#x27;&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;<span class="hljs-title">first</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link2</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">second</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link4</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fourth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link5</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fifth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>如果要筛选所有子节点中符合条件的节点，比如想筛选出子节点中<code>class</code>为<code>active</code>的节点，可以向<code>children</code>方法传入<code>CSS</code>选择器<code>.active</code>，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">lis = items.children(<span class="hljs-string">&#x27;.active&#x27;</span>)<br><span class="hljs-built_in">print</span>(lis)<br></code></pre></div></td></tr></table></figure><p>结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;li <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link4</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fourth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>输出的结果做了筛选，留下了<code>class</code>为<code>active</code>的节点。</p><h3 id="父节点"><a href="#父节点" class="headerlink" title="父节点"></a>父节点</h3><p>可以用<code>parent</code>方法获取某个节点的父节点：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">html = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;div class=&quot;wrap&quot;&gt;</span><br><span class="hljs-string">    &lt;div id=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;ul class=&quot;list&quot;&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;/ul&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br>doc = pq(html)<br>items = doc(<span class="hljs-string">&#x27;.list&#x27;</span>)<br>container = items.parent()<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(container))<br><span class="hljs-built_in">print</span>(container)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">pyquery</span>.<span class="hljs-title">pyquery</span>.<span class="hljs-title">PyQuery</span>&#x27;&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">container</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">ul</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">list</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;<span class="hljs-title">first</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link2</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">second</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link4</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fourth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link5</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fifth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">ul</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>用<code>.list</code>选取<code>class</code>为<code>list</code>的节点，然后调用<code>parent</code>方法得到其父节点，其类型依然是<code>pyquery</code>类型。这里的父节点是该节点的直接父节点，也就是说，它不会再去查找父节点的父节点，即祖先节点。</p><p>如果你想获取某个祖先节点，该怎么办呢？可以用<code>parents</code>方法：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">html = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;div class=&quot;wrap&quot;&gt;</span><br><span class="hljs-string">    &lt;div id=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;ul class=&quot;list&quot;&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;/ul&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br>doc = pq(html)<br>items = doc(<span class="hljs-string">&#x27;.list&#x27;</span>)<br>container = items.parents()<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(container))<br><span class="hljs-built_in">print</span>(container)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">pyquery</span>.<span class="hljs-title">pyquery</span>.<span class="hljs-title">PyQuery</span>&#x27;&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">wrap</span>&quot;&gt;</span><br><span class="hljs-class">    &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">container</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">ul</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">list</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;<span class="hljs-title">first</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link2</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">second</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link4</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fourth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link5</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fifth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">ul</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">&lt;/<span class="hljs-title">div</span>&gt;&lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">container</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">ul</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">list</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;<span class="hljs-title">first</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link2</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">second</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link4</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fourth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link5</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fifth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">ul</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>输出结果有两个：一个是<code>class</code>为<code>wrap</code>的节点，一个是<code>id</code>为<code>container</code>的节点。也就是说，使用<code>parents</code>方法会返回所有的祖先节点。</p><p>要筛选某个祖先节点的话，可以向<code>parents</code>方法传入<code>CSS</code>选择器，这样就会返回祖先节点中符合<code>CSS</code>选择器的节点：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">parent = items.parents(<span class="hljs-string">&#x27;.wrap&#x27;</span>)<br><span class="hljs-built_in">print</span>(parent)<br></code></pre></div></td></tr></table></figure><p>结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">wrap</span>&quot;&gt;</span><br><span class="hljs-class">    &lt;<span class="hljs-title">div</span> <span class="hljs-title">id</span>=&quot;<span class="hljs-title">container</span>&quot;&gt;</span><br><span class="hljs-class">        &lt;<span class="hljs-title">ul</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">list</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;<span class="hljs-title">first</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link2</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">second</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link4</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fourth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link5</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fifth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">ul</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">&lt;/<span class="hljs-title">div</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>输出结果少了一个节点，只保留了<code>class</code>为<code>wrap</code>的节点。</p><h3 id="兄弟节点"><a href="#兄弟节点" class="headerlink" title="兄弟节点"></a>兄弟节点</h3><p>要获取兄弟节点，可以使用<code>siblings</code>方法。这里还是以上面的<code>HTML</code>代码为例：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">html = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;div class=&quot;wrap&quot;&gt;</span><br><span class="hljs-string">    &lt;div id=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;ul class=&quot;list&quot;&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;/ul&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br><br>doc = pq(html)<br><br>li = doc(<span class="hljs-string">&#x27;.list .item-0.active&#x27;</span>)<br><span class="hljs-built_in">print</span>(li.siblings())<br></code></pre></div></td></tr></table></figure><p>结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;li <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">item</span>-1&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link2</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">second</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;<span class="hljs-title">first</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link4</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fourth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link5</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fifth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>先选择<code>class</code>为<code>list</code>的节点，内部<code>class</code>为<code>item-0</code>和<code>active</code>的节点，也就是第3个<code>li</code>节点。很明显，它的兄弟节点有4个，那就是第<code>1</code>、<code>2</code>、<code>4</code>、<code>5 </code>个<code>li</code>节点。结果显示的正是4个兄弟节点。</p><p>筛选某个兄弟节点，可以用<code>siblings</code>方法传入<code>CSS</code>选择器，这样就会从所有兄弟节点中挑选出符合条件的节点了：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br>doc = pq(html)<br>li = doc(<span class="hljs-string">&#x27;.list .item-0.active&#x27;</span>)<br><span class="hljs-built_in">print</span>(li.siblings(<span class="hljs-string">&#x27;.active&#x27;</span>)) <br></code></pre></div></td></tr></table></figure><p>筛选<code>class</code>为<code>active</code>的节点，从刚才的结果中可以观察到，<code>class</code>为<code>active</code>兄弟节点的是第4个<code>li</code>节点，所以结果应该是1个。运行结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;li <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">item</span>-1 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link4</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fourth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h2 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h2><p><code>pyquery</code>的选择结果既可能是多个节点，也可能是单个节点，类型都是<code>pyquery</code>类型，并没有返回列表。对于单个节点来说，可以直接打印输出，也可以直接转成字符串：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br><br>doc = pq(html)<br><br>li = doc(<span class="hljs-string">&#x27;.item-0.active&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(li))<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;li <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class"></span><br><span class="hljs-class">&lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>对于有多个节点的结果，我们就需要用遍历来获取了。例如，如果要把每一个<code>li</code>节点进行遍历，需要调用<code>items</code>方法：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br><br>doc = pq(html)<br>lis = doc(<span class="hljs-string">&#x27;li&#x27;</span>).items()<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(lis))<br><span class="hljs-keyword">for</span> li <span class="hljs-keyword">in</span> lis:<br>    <span class="hljs-built_in">print</span>(li, <span class="hljs-built_in">type</span>(li))<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">generator</span>&#x27;&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;<span class="hljs-title">first</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">             &lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">pyquery</span>.<span class="hljs-title">pyquery</span>.<span class="hljs-title">PyQuery</span>&#x27;&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link2</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">second</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">             &lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">pyquery</span>.<span class="hljs-title">pyquery</span>.<span class="hljs-title">PyQuery</span>&#x27;&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">             &lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">pyquery</span>.<span class="hljs-title">pyquery</span>.<span class="hljs-title">PyQuery</span>&#x27;&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-1 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link4</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fourth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">             &lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">pyquery</span>.<span class="hljs-title">pyquery</span>.<span class="hljs-title">PyQuery</span>&#x27;&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link5</span>.<span class="hljs-title">html</span>&quot;&gt;<span class="hljs-title">fifth</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">         &lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">pyquery</span>.<span class="hljs-title">pyquery</span>.<span class="hljs-title">PyQuery</span>&#x27;&gt;</span><br></code></pre></div></td></tr></table></figure><p>调用<code>items</code>方法后，会得到一个生成器，遍历一下，就可以逐个得到<code>li</code>节点对象了，它的类型也是<code>pyquery</code>类型。每个<code>li</code>节点还可以调用前面所说的方法进行选择，比如继续查询子节点，寻找某个祖先节点等。</p><h2 id="获取信息"><a href="#获取信息" class="headerlink" title="获取信息"></a>获取信息</h2><p>提取到节点之后，最终目的是提取节点包含的信息。比较重要的信息有两类，一是获取属性，二是获取文本。</p><h3 id="获取属性"><a href="#获取属性" class="headerlink" title="获取属性"></a>获取属性</h3><p>提取到某个<code>pyquery</code>类型的节点后，就可以调用<code>attr</code>方法来获取属性：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">html = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;div class=&quot;wrap&quot;&gt;</span><br><span class="hljs-string">    &lt;div id=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;ul class=&quot;list&quot;&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;/ul&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br><br>doc = pq(html)<br><br>a = doc(<span class="hljs-string">&#x27;.item-0.active a&#x27;</span>)<br><span class="hljs-built_in">print</span>(a, <span class="hljs-built_in">type</span>(a))<br><span class="hljs-built_in">print</span>(a.attr(<span class="hljs-string">&#x27;href&#x27;</span>))<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;a href=<span class="hljs-string">&quot;link3.html&quot;</span>&gt;&lt;span <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt; &lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">pyquery</span>.<span class="hljs-title">pyquery</span>.<span class="hljs-title">PyQuery</span>&#x27;&gt;</span><br><span class="hljs-class"><span class="hljs-title">link3</span>.<span class="hljs-title">html</span></span><br></code></pre></div></td></tr></table></figure><p>首先选中<code>class</code>为<code>item-0</code>和<code>active</code>的<code>li</code>节点内的<code>a</code>节点，它的类型是<code>pyquery</code>类型。然后调用<code>attr</code>方法。在这个方法中传入属性的名称，就可以得到属性值了。此外，也可以通过调用<code>attr</code>属性来获取属性值，用法如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(a.attr.href)<br></code></pre></div></td></tr></table></figure><p>结果：<code>link3.html</code>，这两种方法的结果完全一样。</p><h3 id="获取文本"><a href="#获取文本" class="headerlink" title="获取文本"></a>获取文本</h3><p>获取节点之后的另一个主要操作就是获取其内部文本了，此时可以调用<code>text</code>方法来实现：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">html = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;div class=&quot;wrap&quot;&gt;</span><br><span class="hljs-string">    &lt;div id=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;ul class=&quot;list&quot;&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;/ul&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br><br>doc = pq(html)<br><br>a = doc(<span class="hljs-string">&#x27;.item-0.active a&#x27;</span>)<br><span class="hljs-built_in">print</span>(a)<br><span class="hljs-built_in">print</span>(a.text())<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;a href=<span class="hljs-string">&quot;link3.html&quot;</span>&gt;&lt;span <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;</span><br><span class="hljs-class"><span class="hljs-title">third</span> <span class="hljs-title">item</span></span><br></code></pre></div></td></tr></table></figure><p>首先选中一个<code>a</code>节点，然后调用<code>text</code>方法，就可以获取其内部的文本信息了。<code>text</code>会忽略节点内部包含的所有<code>HTML</code>，只返回纯文字内容。</p><p>如果想要获取这个节点内部的<code>HTML</code>文本，就要用<code>html</code>方法：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">html = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;div class=&quot;wrap&quot;&gt;</span><br><span class="hljs-string">    &lt;div id=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;ul class=&quot;list&quot;&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;/ul&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br><br>doc = pq(html)<br><br>li = doc(<span class="hljs-string">&#x27;.item-0.active&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br><span class="hljs-built_in">print</span>(li.html())<br>``<br>这里我们选中第<span class="hljs-number">3</span>个`li`节点，然后调用`html`方法，它返回的结果应该是`li`节点内的所有`HTML`文本。运行结果如下：<br><br>```python<br>&lt;li <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>如果我们选中的结果是多个节点，<code>text</code>或<code>html</code>方法会返回什么内容？我们用实例来看一下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">html = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;div class=&quot;wrap&quot;&gt;</span><br><span class="hljs-string">    &lt;div id=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;ul class=&quot;list&quot;&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;/ul&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br><br>doc = pq(html)<br><br>li = doc(<span class="hljs-string">&#x27;li&#x27;</span>)<br><span class="hljs-built_in">print</span>(li.html())<br><span class="hljs-built_in">print</span>(li.text())<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(li.text()))<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">first item<br>first item second item third item fourth item fifth item<br>&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">str</span>&#x27;&gt;</span><br></code></pre></div></td></tr></table></figure><p><code>html</code>方法返回的是第1个<code>li</code>节点的内部<code>HTML</code>文本，而<code>text</code>则返回了所有的<code>li</code>节点内部的纯文本，中间用一个空格分割开，即返回结果是一个字符串。</p><h2 id="节点操作"><a href="#节点操作" class="headerlink" title="节点操作"></a>节点操作</h2><p><code>pyquery</code>提供了一系列方法来对节点进行动态修改，比如为某个节点添加一个<code>class</code>，移除某个节点等，这些操作有时会为提取信息带来极大的便利。<br>由于节点操作的方法太多，下面举几个典型的例子来说明它的用法。</p><h3 id="addClass和removeClass"><a href="#addClass和removeClass" class="headerlink" title="addClass和removeClass"></a>addClass和removeClass</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">html = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;div class=&quot;wrap&quot;&gt;</span><br><span class="hljs-string">    &lt;div id=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;ul class=&quot;list&quot;&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;/ul&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br><br>doc = pq(html)<br><br>li = doc(<span class="hljs-string">&#x27;.item-0.active&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br>li.remove_class(<span class="hljs-string">&#x27;active&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br>li.add_class(<span class="hljs-string">&#x27;active&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br></code></pre></div></td></tr></table></figure><p>首先选中第3个<code>li</code>节点，然后调用<code>removeClass</code>方法，将<code>li</code>节点的<code>active</code>这<code>class</code>移除，第2步调用<code>addClass</code>方法，将<code>class</code>添加回来。每执行一次操作，就打印输出当前<code>li</code>节点的内容。</p><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;li <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class"></span><br><span class="hljs-class">&lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class"></span><br><span class="hljs-class">&lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>一共输出了3次。第2次输出时，<code>li</code>节点的<code>active</code>这个<code>class</code>被移除了，第3次<code>class</code>又添加回来了。<code>addClass</code>和<code>removeClass</code>方法可以动态改变节点的<code>class</code>属性。</p><h3 id="attr、text、html"><a href="#attr、text、html" class="headerlink" title="attr、text、html"></a>attr、text、html</h3><p>除了操作<code>class</code>这个属性外，也可以用<code>attr</code>方法对属性进行操作。此外，还可以用<code>text</code>和<code>html</code>方法来改变节点内部的内容。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">html = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;div class=&quot;wrap&quot;&gt;</span><br><span class="hljs-string">    &lt;div id=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;ul class=&quot;list&quot;&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;/ul&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br><br>doc = pq(html)<br><br>li = doc(<span class="hljs-string">&#x27;.item-0.active&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br>li.attr(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;link&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br>li.text(<span class="hljs-string">&#x27;changed item&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br>li.html(<span class="hljs-string">&#x27;&lt;span&gt;changed item&lt;/span&gt;&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br></code></pre></div></td></tr></table></figure><p>首先选中<code>li</code>节点，然后调用<code>attr</code>方法来修改属性。该方法的第1个参数为属性名，第2个参数为属性值。最后调用<code>text</code>和<code>html</code>方法来改变节点内部的内容。3次操作后，分别打印输出当前的<code>li</code>节点。 运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;li <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class"></span><br><span class="hljs-class">&lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">link</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">link3</span>.<span class="hljs-title">html</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">bold</span>&quot;&gt;<span class="hljs-title">third</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class"></span><br><span class="hljs-class">&lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">link</span>&quot;&gt;<span class="hljs-title">changed</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">li</span>&gt;</span><br><span class="hljs-class"></span><br><span class="hljs-class">&lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">item</span>-0 <span class="hljs-title">active</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">link</span>&quot;&gt;&lt;<span class="hljs-title">span</span>&gt;<span class="hljs-title">changed</span> <span class="hljs-title">item</span>&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">li</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>调用<code>attr</code>方法后，<code>li</code>节点多了一个原本不存在的属性<code>name</code>，其值为<code>link</code>。接着调用<code>text</code>方法传入文本，<code>li</code>节点内部的文本全被改为传入的字符串文本。最后，调用<code>html</code>方法传入<code>HTML</code>文本，<code>li</code>节点内部又变为传入的<code>HTML</code>文本了。</p><p>使用<code>attr</code>方法时如果只传入第1个参数的属性名，则是获取这个属性值；如果传入第2个参数，可以用来修改属性值。使用<code>text</code>和<code>html</code>方法时如果不传参数，则是获取节点内纯文本和<code>HTML</code>文本，如果传入参数，则进行赋值。</p><h3 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h3><p><code>remove</code>方法就是移除，它有时会为信息的提取带来非常大的便利。下面有一段 HTML文本：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">html = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;div class=&quot;wrap&quot;&gt;</span><br><span class="hljs-string">    hello, world</span><br><span class="hljs-string">    &lt;p&gt;This is a paragraph.&lt;/p&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br><br>doc = pq(html)<br>wrap = doc(<span class="hljs-string">&#x27;.wrap&#x27;</span>)<br><span class="hljs-built_in">print</span>(wrap.text())<br></code></pre></div></td></tr></table></figure><p>想提取<code>“Hello, World”</code>这个字符串，该怎样操作呢？</p><p>这里先直接尝试提取<code>class</code>为<code>wrap</code>的节点的内容，看看是不是我们想要的。</p><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Hello, World This <span class="hljs-keyword">is</span> a paragraph.<br></code></pre></div></td></tr></table></figure><p>这个结果还包含了内部的<code>p</code>节点的内容，也就是说<code>text</code>把所有的纯文本全提取出来了。</p><p>如果想去掉<code>p</code>节点内部的文本，可以选择再把<code>p</code>节点内的文本提取一遍，然后从整个结果中移除这个子串，但这个做法明显比较烦琐。</p><p>这时<code>remove</code>方法就可以派上用场了，可以接着这么做：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">wrap.find(<span class="hljs-string">&#x27;p&#x27;</span>).remove()<br><span class="hljs-built_in">print</span>(wrap.text())<br></code></pre></div></td></tr></table></figure><p>首先选中<code>p</code>节点，然后调用<code>remove</code>方法将其移除，这时<code>wrap</code>内部就只剩下<code>“Hello, World”</code>这句话了，最后利用<code>text</code>方法提取即可。</p><p>其实还有很多其他节点操作的方法，比如<code>append</code>、<code>empty</code>和<code>prepend</code>等方法，详细的用法可以参考官方文档：<a href="http://pyquery.readthedocs.io/en/latest/api.html">http://pyquery.readthedocs.io/en/latest/api.html</a>。</p><h2 id="伪类选择器"><a href="#伪类选择器" class="headerlink" title="伪类选择器"></a>伪类选择器</h2><p><code>CSS</code>选择器之所以强大，还有一个很重要的原因，那就是它支持多种多样的伪类选择器，例如选择第一个节点、最后一个节点、奇偶数节点、包含某一文本的节点等。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">html = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;div class=&quot;wrap&quot;&gt;</span><br><span class="hljs-string">    &lt;div id=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;ul class=&quot;list&quot;&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;first item&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0 active&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;&lt;span class=&quot;bold&quot;&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-1 active&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span><br><span class="hljs-string">        &lt;/ul&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">from</span> pyquery <span class="hljs-keyword">import</span> PyQuery <span class="hljs-keyword">as</span> pq<br>doc = pq(html)<br>li = doc(<span class="hljs-string">&#x27;li:first-child&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br>li = doc(<span class="hljs-string">&#x27;li:last-child&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br>li = doc(<span class="hljs-string">&#x27;li:nth-child(2)&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br>li = doc(<span class="hljs-string">&#x27;li:gt(2)&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br>li = doc(<span class="hljs-string">&#x27;li:nth-child(2n)&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br>li = doc(<span class="hljs-string">&#x27;li:contains(second)&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br></code></pre></div></td></tr></table></figure><p>在这个例子中使用了<code>CSS3</code>的伪类选择器，依次选择了第1个<code>li</code>节点、最后一个<code>li</code>节点、第2个<code>li</code>节点、第3个<code>li</code>之后的<code>li</code>节点、偶数位置的<code>li</code>节点、包含<code>second</code>文本的<code>li</code>节点。</p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>pyquery</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>正则表达式</title>
    <link href="/2021/05/21/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    <url>/2021/05/21/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h1><p>正则表达式是处理字符串的强大工具，它有自己特定的语法结构。能实现字符串的检索、替换、匹配验证，对于爬虫来说，从<code>HTML</code>里提取想要的信息就非常方便。</p><h2 id="实例引入"><a href="#实例引入" class="headerlink" title="实例引入"></a>实例引入</h2><p>下面用几个实例来看一下正则表达式的用法。</p><p>打开开源中国提供的正则表达式测试工具<a href="http://tool.oschina.net/regex/">http://tool.oschina.net/regex/</a>，输入待匹配的文本，然后选择常用的正则表达式，就可以得出相应的匹配结果了。</p><p>例如，输入下面这段待匹配的文本：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Hello, my phone number <span class="hljs-keyword">is</span> 010-<span class="hljs-number">86432100</span> <span class="hljs-keyword">and</span> email <span class="hljs-keyword">is</span> espholychan@outlook.com, <span class="hljs-keyword">and</span> my website <span class="hljs-keyword">is</span> https://holychan.ltd.<br></code></pre></div></td></tr></table></figure><p>这段字符串中包含了一个电话号码和一个电子邮件，接下来就尝试用正则表达式提取出来，如图所示。</p><p><img src="Screenshot_1.webp"></p><p>在网页右侧选择<strong>“匹配 Email地址”</strong>，就可以看到下方出现了文本中的<code>E-mail</code>。如果选择<strong>“匹配网址URL”</strong>，就可以看到下方出现了文本中的<code>URL</code>。</p><p>这里使用了正则表达式的匹配功能，也就是用一定规则将特定的文本提取出来。</p><p>比方说，电子邮件是有其特定的组成格式的：<code>一段字符串</code> <code>+</code> <code>@</code> <code>符号</code> <code>+</code> <code>某个域名</code>。而<code>URL</code>的组成格式则是<code>协议类型``+``冒号``+``双斜线``+``域名和路径</code>。</p><p>可以用下面的正则表达式匹配<code>URL</code>：</p><figure class="highlight re"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs re"><span class="hljs-literal">[<span class="hljs-identifier">a</span>-<span class="hljs-identifier">zA</span>-<span class="hljs-identifier">z</span>]</span>+:<span class="hljs-comment">//[^\s]*</span><br></code></pre></div></td></tr></table></figure><p>用这个正则表达式去匹配一个字符串，如果这个字符串中包含类似<code>URL</code>的文本，那就会被提取出来。</p><p>下表中列出了常用的匹配规则：</p><table><thead><tr><th align="center">模式</th><th align="left">描述</th></tr></thead><tbody><tr><td align="center">\w</td><td align="left">匹配字母、数字及下划线</td></tr><tr><td align="center">\W</td><td align="left">匹配不是字母、数字及下划线的字符</td></tr><tr><td align="center">\s</td><td align="left">匹配任意空白字符，等价于 [\t\n\r\f]</td></tr><tr><td align="center">\S</td><td align="left">匹配任意非空字符</td></tr><tr><td align="center">\d</td><td align="left">匹配任意数字，等价于 [0~9]</td></tr><tr><td align="center">\D</td><td align="left">匹配任意非数字的字符</td></tr><tr><td align="center">\A</td><td align="left">匹配字符串开头</td></tr><tr><td align="center">\Z</td><td align="left">匹配字符串结尾，如果存在换行，只匹配到换行前的结束字符串</td></tr><tr><td align="center">\z</td><td align="left">匹配字符串结尾，如果存在换行，同时还会匹配换行符</td></tr><tr><td align="center">\G</td><td align="left">匹配最后匹配完成的位置</td></tr><tr><td align="center">\n</td><td align="left">匹配一个换行符</td></tr><tr><td align="center">\t</td><td align="left">匹配一个制表符</td></tr><tr><td align="center">^</td><td align="left">匹配一行字符串的开头</td></tr><tr><td align="center">$</td><td align="left">匹配一行字符串的结尾</td></tr><tr><td align="center">.</td><td align="left">匹配任意字符，除了换行符，当 re.DOTALL 标记被指定时，则可以匹配包括换行符的任意字符</td></tr><tr><td align="center">[…]</td><td align="left">用来表示一组字符，单独列出，比如 [amk] 匹配 a、m 或 k</td></tr><tr><td align="center">[^…]</td><td align="left">不在 [] 中的字符，比如 匹配除了 a、b、c 之外的字符</td></tr><tr><td align="center">*</td><td align="left">匹配 0 个或多个表达式</td></tr><tr><td align="center">+</td><td align="left">匹配 1 个或多个表达式</td></tr><tr><td align="center">?</td><td align="left">匹配 0 个或 1 个前面的正则表达式定义的片段，非贪婪方式</td></tr><tr><td align="center">{n}</td><td align="left">精确匹配 n 个前面的表达式</td></tr><tr><td align="center">{n, m}</td><td align="left">匹配 n 到 m 次由前面正则表达式定义的片段，贪婪方式</td></tr><tr><td align="center">a|b</td><td align="left">匹配 a 或 b</td></tr><tr><td align="center">()</td><td align="left">匹配括号内的表达式，也表示一个组</td></tr></tbody></table><style>    table    {        margin: auto;        font-size: 80%;    }</style><p><code>Python</code>的<code>re库</code>提供了整个正则表达式的实现，利用这个库，可以在<code>Python</code>中使用正则表达式。</p><h2 id="match"><a href="#match" class="headerlink" title="match"></a>match</h2><p>首先介绍一个常用的匹配方法——<code>match</code>，向它传入要匹配的字符串，以及正则表达式，就可以检测这个正则表达式是否匹配字符串。<code>match</code>方法会尝试从字符串的起始位置匹配正则表达式，如果匹配，就返回匹配成功的结果；如果不匹配，就返回<code>None</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br>content = <span class="hljs-string">&#x27;Hello 123 4567 World_This is a Regex Demo&#x27;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(content))<br>result = re.match(<span class="hljs-string">&#x27;^Hello\s\d\d\d\s\d&#123;4&#125;\s\w&#123;10&#125;&#x27;</span>, content)<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-built_in">print</span>(result.group())<br><span class="hljs-built_in">print</span>(result.span())<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-number">41</span><br>&lt;re.Match <span class="hljs-built_in">object</span>; span=(<span class="hljs-number">0</span>, <span class="hljs-number">25</span>), match=<span class="hljs-string">&#x27;Hello 123 4567 World_This&#x27;</span>&gt;<br>Hello <span class="hljs-number">123</span> <span class="hljs-number">4567</span> World_This<br>(<span class="hljs-number">0</span>, <span class="hljs-number">25</span>)<br></code></pre></div></td></tr></table></figure><p>这里首先声明了一个字符串，其中包含英文字母、空白字符、数字等。接下来，我们写一个正则表达式：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">^Hello\s\d\d\d\s\d&#123;<span class="hljs-number">4</span>&#125;\s\w&#123;<span class="hljs-number">10</span>&#125;<br></code></pre></div></td></tr></table></figure><p>用它来匹配这个长字符串。开头的<code>^</code>·匹配字符串的开头，也就是以<code>Hello</code>开头；<code>\s</code>匹配空白字符，用来匹配目标字符串的空格；<code>\d</code>匹配数字，3个<code>\d</code>匹配<code>123</code>；再写1个<code>\s</code>匹配空格；后面的<code>4567</code>，依然能用4个<code>\d</code>来匹配，但是这么写比较烦琐，所以后面可以跟<code>&#123;4&#125;</code>代表匹配前面的规则4次，也就是匹配4个数字；后面再紧接1个空白字符，最后<code>\w&#123;10&#125;</code>匹配10个字母及下划线。</p><p>在<code>match</code>方法中，第一个参数传入正则表达式，第二个参数传入要匹配的字符串。打印输出结果，可以看到结果是<code>SRE_Match</code>对象，这证明成功匹配。该对象有两个方法：<code>group</code>方法可以输出匹配的内容，结果是<code>Hello 123 4567 World_This</code>，这恰好是正则表达式规则所匹配的内容；<code>span</code>方法可以输出匹配的范围，结果是<code>(0, 25)</code>，这就是匹配到的结果字符串在原字符串中的位置范围。</p><p>在<code>match</code>方法中，第一个参数传入正则表达式，第二个参数传入要匹配的字符串。打印输出结果，可以看到结果是<code>SRE_Match</code>对象，这证明成功匹配。该对象有两个方法：<code>group</code>方法可以输出匹配的内容，结果是<code>Hello 123 4567 World_This</code>，这恰好是正则表达式规则所匹配的内容；<code>span</code>方法可以输出匹配的范围，结果是<code>(0, 25)</code>，这就是匹配到的结果字符串在原字符串中的位置范围。</p><h2 id="匹配目标"><a href="#匹配目标" class="headerlink" title="匹配目标"></a>匹配目标</h2><p>用<code>match</code>方法得到了匹配到的字符串内容，想从字符串中提取一部分内容，该怎么办呢？</p><p>要从一段文本中提取出邮件或电话号码等内容。可以使用<code>()</code>括号将想提取的子字符串括起来。<code>()</code>实际上标记了一个子表达式的开始和结束位置，被标记的每个子表达式会依次对应每一个分组，调用<code>group</code>方法传入分组的索引即可获取提取的结果。</p><p>示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br>content = <span class="hljs-string">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span><br>result = re.match(<span class="hljs-string">&#x27;^Hello\s(\d+)\sWorld&#x27;</span>, content)<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-built_in">print</span>(result.group())<br><span class="hljs-built_in">print</span>(result.group(<span class="hljs-number">1</span>))<br><span class="hljs-built_in">print</span>(result.span())<br></code></pre></div></td></tr></table></figure><p>这里把字符串中的<code>1234567</code>提取出来，此时可以将数字部分的正则表达式用<code>()</code>括起来，然后调用了<code>group(1)</code>获取匹配结果。</p><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;re.Match <span class="hljs-built_in">object</span>; span=(<span class="hljs-number">0</span>, <span class="hljs-number">19</span>), match=<span class="hljs-string">&#x27;Hello 1234567 World&#x27;</span>&gt;<br>Hello <span class="hljs-number">1234567</span> World<br><span class="hljs-number">1234567</span><br>(<span class="hljs-number">0</span>,<span class="hljs-number">25</span>)<br></code></pre></div></td></tr></table></figure><p>可以看到，成功得到了<code>1234567</code>。这里用的是<code>group(1)</code>，它与<code>group()</code>有所不同，后者会输出完整的匹配结果，而前者会输出第一个被<code>()</code>包围的匹配结果。假如正则表达式后面还有<code>()</code>包括的内容，那么可以依次用<code>group(2)</code>、<code>group(3)</code>等来获取。</p><h2 id="通用匹配"><a href="#通用匹配" class="headerlink" title="通用匹配"></a>通用匹配</h2><p>刚才写的正则表达比较复杂，出现空白字符写<code>\s</code>匹配，出现数字用<code>\d</code>匹配，这样的工作量非常大。</p><p>可以用一个万能匹配来减少这些工作，那就是<code>.*</code>。其中<code>.</code>可以匹配任意字符（除换行符），<code>*</code>代表匹配前面的字符无限次，组合在一起可以匹配任意字符。</p><p>改写一下正则表达式：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br>content = <span class="hljs-string">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span><br>result = re.match(<span class="hljs-string">&#x27;^Hello.*Demo$&#x27;</span>, content)<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-built_in">print</span>(result.group())<br><span class="hljs-built_in">print</span>(result.span())<br></code></pre></div></td></tr></table></figure><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;re.Match <span class="hljs-built_in">object</span>; span=(<span class="hljs-number">0</span>, <span class="hljs-number">40</span>), match=<span class="hljs-string">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span>&gt;<br>Hello <span class="hljs-number">1234567</span> World_This <span class="hljs-keyword">is</span> a Regex Demo<br>(<span class="hljs-number">0</span>,<span class="hljs-number">40</span>)<br></code></pre></div></td></tr></table></figure><h2 id="贪婪与非贪婪"><a href="#贪婪与非贪婪" class="headerlink" title="贪婪与非贪婪"></a>贪婪与非贪婪</h2><p>使用通用匹配<code>.*</code>时，有时候匹配到的并不是我们想要的结果。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br>content = <span class="hljs-string">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span><br>result = re.match(<span class="hljs-string">&#x27;^He.*(\d+).*Demo$&#x27;</span>, content)<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-built_in">print</span>(result.group(<span class="hljs-number">1</span>))<br></code></pre></div></td></tr></table></figure><p>想获取中间的数字，所以中间依然写的是<code>(\d+)</code>。由于数字两侧的内容比较杂乱，所以略写成<code>.*</code>。最后，组成<code>^He.*(\d+).*Demo$</code>，看样子并没有什么问题。</p><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;re.Match <span class="hljs-built_in">object</span>; span=(<span class="hljs-number">0</span>, <span class="hljs-number">40</span>), match=<span class="hljs-string">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span>&gt;<br><span class="hljs-number">7</span><br></code></pre></div></td></tr></table></figure><p>奇怪的事情发生了，只得到了<code>7</code>这个数字，这是怎么回事呢？</p><p>这里就涉及一个<strong>贪婪匹配</strong>与<strong>非贪婪匹配</strong>的问题了。在贪婪匹配下，<code>.*</code>会匹配尽可能多的字符。正则表达式中<code>.*</code>后面是<code>\d+</code>，也就是至少一个数字，并没有指定具体多少个数字，因此，<code>.*</code>就尽可能匹配多的字符，这里就把<code>123456</code>匹配了，给<code>\d+</code>留下一个可满足条件的数字<code>7</code>，最后得到的内容就只有数字<code>7</code>了。</p><p>这里需要使用非贪婪匹配，非贪婪匹配的写法是<code>.*?</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br>content = <span class="hljs-string">&#x27;Hello 1234567 World_This is a Regex Demo&#x27;</span><br>result = re.match(<span class="hljs-string">&#x27;^He.*?(\d+).*Demo$&#x27;</span>, content)<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-built_in">print</span>(result.group(<span class="hljs-number">1</span>))<br></code></pre></div></td></tr></table></figure><p>将第一个<code>.*</code>改成了<code>.*?</code>，转变为非贪婪匹配。运行结果如下：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">&lt;re.Match object; span=(0, 40), match=&#x27;Hello 1234567 World_This is a Regex Demo&#x27;&gt;<br>1234567<br></code></pre></div></td></tr></table></figure><p>成功获取<code>1234567</code>，贪婪匹配是尽可能匹配多的字符，非贪婪匹配就是尽可能匹配少的字符。当<code>.*?</code>匹配到<code>Hello</code>后面的空白字符时，再往后的字符就是数字了，而<code>\d+</code>恰好可以匹配，<code>.*?</code>就不再进行匹配，交给<code>\d+</code>去匹配后面的数字。这样<code>.*?</code>匹配了尽可能少的字符，<code>\d+</code>的结果就是<code>1234567</code>。</p><p>在做匹配的时候，字符串中间尽量使用非贪婪匹配，也就是用<code>.*?</code>来代替<code>.*</code>，以免出现匹配结果缺失的情况。</p><p>需要注意的是，如果匹配的结果在字符串结尾，<code>.*?</code>就有可能匹配不到任何内容了，因为它会匹配尽可能少的字符。例如：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re <br><br>content = <span class="hljs-string">&#x27;http://weibo.com/comment/kEraCN&#x27;</span> <br>result1 = re.match(<span class="hljs-string">&#x27;http.*?comment/(.*?)&#x27;</span>, content) <br>result2 = re.match(<span class="hljs-string">&#x27;http.*?comment/(.*)&#x27;</span>, content) <br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;result1&#x27;</span>, result1.group(<span class="hljs-number">1</span>)) <br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;result2&#x27;</span>, result2.group(<span class="hljs-number">1</span>))<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result1 <br>result2 kEraCN<br></code></pre></div></td></tr></table></figure><h2 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h2><p>正则表达式可以包含一些可选标志修饰符来控制匹配的模式。修饰符被指定为一个可选的标志。</p><p>用实例来看一下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br>content =  <span class="hljs-string">&#x27;&#x27;&#x27;Hello 1234567 World_This is </span><br><span class="hljs-string">a Regex Demo </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>result = re.match(<span class="hljs-string">&#x27;^He.*?(\d+).*?Demo$&#x27;</span>, content) <br><span class="hljs-built_in">print</span>(result.group(<span class="hljs-number">1</span>))<br></code></pre></div></td></tr></table></figure><p>字符串中加了换行符，正则表达式还是一样的，用来匹配其中的数字。看一下运行结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;c:/Users/espho/PycharmProjects/PythonProjs/python模块/re库/修饰符.py&quot;</span>, line <span class="hljs-number">7</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    <span class="hljs-built_in">print</span>(result.group(<span class="hljs-number">1</span>))<br>AttributeError: <span class="hljs-string">&#x27;NoneType&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;group&#x27;</span><br></code></pre></div></td></tr></table></figure><p>运行直接报错，也就是说正则表达式没有匹配到这个字符串，返回结果为<code>None</code>，又调用了<code>group</code>方法导致<code>AttributeError</code>。为什么加了一个换行符，就匹配不到了呢？这是因为我们匹配的是除换行符之外的任意字符，当遇到换行符时，<code>.*?</code>就不能匹配了，导致匹配失败。</p><p>这里只需加一个修饰符<code>re.S</code>，即可修正这个错误：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">result = re.match(<span class="hljs-string">&#x27;^He.*?(\d+).*?Demo$&#x27;</span>, content, re.S) <br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-number">1234567</span><br></code></pre></div></td></tr></table></figure><p>这个<code>re.S</code>在网页匹配中经常用到。因为<code>HTML</code>节点经常会有换行，加上它，就可以匹配节点与节点之间的换行了。</p><p>还有一些修饰符，在必要的情况下也可以使用，如表所示：</p><table><thead><tr><th align="center">修饰符</th><th align="left">描述</th></tr></thead><tbody><tr><td align="center">re.I</td><td align="left">使匹配对大小写不敏感</td></tr><tr><td align="center">re.L</td><td align="left">做本地化识别（locale-aware）匹配</td></tr><tr><td align="center">re.M</td><td align="left">多行匹配，影响 ^ 和 $</td></tr><tr><td align="center">re.S</td><td align="left">使匹配包括换行在内的所有字符</td></tr><tr><td align="center">re.U</td><td align="left">根据 Unicode 字符集解析字符。这个标志影响 \w、\W、\b 和 \B</td></tr><tr><td align="center">re.X</td><td align="left">该标志通过给予你更灵活的格式以便你将正则表达式写得更易于理解</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>re</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker的安装</title>
    <link href="/2021/05/20/docker%E7%9A%84%E5%AE%89%E8%A3%85/"/>
    <url>/2021/05/20/docker%E7%9A%84%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h2 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h2><p>安装环境是Centos环境，要求版本是<code> CentOS 7 or 8</code>以上。</p><h2 id="卸载旧版本的docker"><a href="#卸载旧版本的docker" class="headerlink" title="卸载旧版本的docker"></a>卸载旧版本的docker</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">sudo yum remove docker \<br>                 docker-client \<br>                 docker-client-latest \<br>                 docker-common \<br>                 docker-latest \<br>                 docker-latest-logrotate \<br>                 docker-logrotate \<br>                 docker-engine<br></code></pre></div></td></tr></table></figure><h2 id="使用yum仓库安装"><a href="#使用yum仓库安装" class="headerlink" title="使用yum仓库安装"></a>使用yum仓库安装</h2><p>安装方式有很多种，可以参考官方文档。</p><h3 id="设置仓库源"><a href="#设置仓库源" class="headerlink" title="设置仓库源"></a>设置仓库源</h3><p>下载<code>yum-utils</code>工具包和稳固的安装源。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">sudo yum install -y yum-utils<br><br>sudo yum-config-manager \<br>    --add-repo \<br>    https://download.docker.com/linux/centos/docker-ce.repo<br></code></pre></div></td></tr></table></figure><h3 id="安装docker引擎"><a href="#安装docker引擎" class="headerlink" title="安装docker引擎"></a>安装docker引擎</h3><ul><li>1.安装最新版本</li></ul><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">sudo yum install docker-ce docker-ce-cli containerd.io<br></code></pre></div></td></tr></table></figure><ul><li>2.安装特定版本</li></ul><p>列出可安装的版本。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">yum <span class="hljs-built_in">list</span> docker-ce --showduplicates | sort -r<br></code></pre></div></td></tr></table></figure><p>选择安装版本。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">sudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io<br></code></pre></div></td></tr></table></figure><h3 id="启动docker"><a href="#启动docker" class="headerlink" title="启动docker"></a>启动docker</h3><p>运行下列命令启动<code>docker</code>。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">sudo systemctl start docker<br></code></pre></div></td></tr></table></figure><p>测试<code>docker</code>安装正确。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">sudo docker run hello-world<br></code></pre></div></td></tr></table></figure><h2 id="卸载docker"><a href="#卸载docker" class="headerlink" title="卸载docker"></a>卸载docker</h2><p>卸载docker和下载的容器及包：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">sudo yum remove docker-ce docker-ce-cli containerd.io<br><br></code></pre></div></td></tr></table></figure><p>镜像等配置文件不会自动移除，需要手动删除。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">sudo rm -rf /var/lib/docker<br>sudo rm -rf /var/lib/containerd<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>基于NextCloud搭建个人网盘</title>
    <link href="/2021/05/20/%E5%9F%BA%E4%BA%8Ecentos%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%9B%98/"/>
    <url>/2021/05/20/%E5%9F%BA%E4%BA%8Ecentos%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%9B%98/</url>
    
    <content type="html"><![CDATA[<h2 id="Nextcloud"><a href="#Nextcloud" class="headerlink" title="Nextcloud"></a>Nextcloud</h2><p><code>Nextcloud</code>是一款开源免费的私有云存储网盘项目，可以让你快速便捷地搭建一套属于自己或团队的云同步网盘，从而实现跨平台跨设备文件同步、共享、版本控制、团队协作等功能。它的客户端覆盖了<code>Windows</code>、<code>Mac</code>、<code>Android</code>、<code>iOS</code>、<code>Linux</code>等各种平台，也提供了网页端以及<code>WebDAV</code>接口，所以你几乎可以在各种设备上方便地访问你的云盘。</p><h2 id="安装-Nextcloud"><a href="#安装-Nextcloud" class="headerlink" title="安装 Nextcloud"></a>安装 Nextcloud</h2><h3 id="安装Mysql"><a href="#安装Mysql" class="headerlink" title="安装Mysql"></a>安装Mysql</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">docker pull mysql # 拉取镜像<br><br>docker images # 查看名称/镜像id<br><br>docker run -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=******** -d c0cdc95609f1 #c0cdc95609f1（镜像id）<br></code></pre></div></td></tr></table></figure><p>运行<code>mysql</code>并且设置访问端口：<code>3306</code>，容器名称：<code>mysql</code> ,管理员密码：<code>********</code></p><p>进入容器<code>bash</code>。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">docker exec -it 容器名称/容器id bash<br></code></pre></div></td></tr></table></figure><p>登陆<code>mysql</code></p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">mysql -uroot -p<br></code></pre></div></td></tr></table></figure><p>接着输入管理员密码：<code>admin</code>,回车。<br>创建一个数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">CREATE DATABASE nextcloud;<br></code></pre></div></td></tr></table></figure><p>创建一个用户</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">CREATE USER &#x27;nextcloud&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;admin&#x27;;<br></code></pre></div></td></tr></table></figure><p>创建一个用户名称为：<code>nextcloud；‘%’</code>：代表不限<code>ip</code>登陆，远程登陆; 密码为：<code>admin</code>。</p><p>授权。</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">GRANT ALL PRIVILEGES ON nextcloud.* TO nextcloud@&#x27;%&#x27;  WITH GRANT OPTION;<br></code></pre></div></td></tr></table></figure><p>给这个用户<code>nextcloud</code>授予 这个数据库<code>nextcloud.*</code>所有的权限，远程登陆，密码为<code>admin</code>；</p><h3 id="基于Docker部署Nextcloud服务端"><a href="#基于Docker部署Nextcloud服务端" class="headerlink" title="基于Docker部署Nextcloud服务端"></a>基于Docker部署Nextcloud服务端</h3><p>选择以<code>Docker</code>的方式来部署<code>nextcloud</code>是因为<code>Docker</code>可以跨平台上运行，可以确保执行环境的一致性，有利于应用的迁移和管理。</p><p>服务端部署的基本流程是：<strong>安装<code>Docker</code>并启动</strong> –&gt; <strong>运行<code>Nextcloud</code>容器</strong> –&gt; <strong>访问<code>Web</code>端初始化</strong>。</p><p>安装的话不做过多说明，参考官方文档或本博客其他博文。</p><p>下载<code>Nextcloud</code>镜像</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">docker pull nextcloud<br></code></pre></div></td></tr></table></figure><p>运行<code>Nextcloud</code></p><p>参数说明：</p><ul><li>-d #容器后台运行</li><li>–name nextcloud #容器名</li><li>-v /data/nextcloud:/var/www/html #将宿主机的目录/data/nextcloud挂载到容器的/var/www/html</li><li>-p 8000:80 #将宿主机的端口（此处以8000为例）映射到容器的80端口”</li></ul><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">docker run -d \<br>--name nextcloud \<br>-p 8000:80 \<br>-v /data/nextcloud:/var/www/html \<br>nextcloud<br></code></pre></div></td></tr></table></figure><p>查看运行的容器。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">docker ps -a<br></code></pre></div></td></tr></table></figure><p>停止运行的容器。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">docker stop id<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>博客教程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>nextCloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>requests库的基本使用</title>
    <link href="/2021/05/18/requests%E5%BA%93%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
    <url>/2021/05/18/requests%E5%BA%93%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><code>requests</code>是一个第三方库，使用<code>pip</code>下载安装。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip3 install requests<br></code></pre></div></td></tr></table></figure><h2 id="实例引入"><a href="#实例引入" class="headerlink" title="实例引入"></a>实例引入</h2><p>用<code>Python</code>写爬虫的第一步就是模拟发起一个请求，把网页的源代码获取下来。</p><p>在浏览器中输入一个<code>URL</code>并回车，实际上就是让浏览器帮我们发起一个<code>GET</code>类型的<code>HTTP</code>请求，浏览器得到源代码后，把它渲染出来就可以看到网页内容了。</p><p>那如果想用<code>requests</code>来获取源代码，应该怎么办呢？很简单，<code>requests</code>这个库提供了一个<code>get</code>方法，调用这个方法，并传入对应的<code>URL</code>就能得到网页的源代码。</p><p>比如这里有一个示例网站:<a href="https://static1.scrape.cuiqingcai.com/">https://static1.scrape.cuiqingcai.com/</a>，其内容如下：</p><p><img src="Screenshot_2.webp" alt="示列网站"></p><p>这个网站展示了一些电影数据，如果想要把这个网页里面的数据爬下来，比如获取各个电影的名称、上映时间等信息，然后把它存下来的话，该怎么做呢？</p><p>第一步当然就是获取它的网页源代码了。</p><p>可以用<code>requests</code>这个库轻松地完成这个过程，代码的写法是这样的：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>r = requests.get(url=<span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class="hljs-literal">False</span>)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></div></td></tr></table></figure><p>输出结果如下：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>  <br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width,initial-scale=1&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;icon&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/static/img/favicon.ico&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Scrape | Movie<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/static/css/app.css&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span>&gt;</span><br>  <br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/static/css/index.css&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">data-v-74e8b908</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;el-row&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;header&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">data-v-74e8b908</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container el-col el-col-18 el-col-offset-3&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">data-v-74e8b908</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;el-row&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">data-v-74e8b908</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;logo el-col el-col-4&quot;</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">data-v-74e8b908</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;router-link-exact-active router-link-active&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">data-v-74e8b908</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/logo.png&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;logo-image&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">data-v-74e8b908</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;logo-title&quot;</span>&gt;</span>Scrape<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <br>...<br><br>         <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;number&quot;</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/page/7&quot;</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <br>            <br>            <br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;number&quot;</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/page/8&quot;</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <br>            <br>            <br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;number&quot;</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/page/9&quot;</span>&gt;</span>9<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <br>            <br>            <br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;number&quot;</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/page/10&quot;</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <br>            <br>          <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>          <br>          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/page/2&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;next&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-next&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;el-icon el-icon-arrow-right&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>          <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br>Process finished with exit code 0<br><br></code></pre></div></td></tr></table></figure><p>由于网页内容比较多，这里省略了大部分内容。</p><p>不过看运行结果，我们已经成功获取网页的<code>HTML</code>源代码，里面包含了电影的标题、类型、上映时间，等等。</p><p>把网页源代码获取下来之后，下一步我们把想要的数据提取出来，数据的爬取就完成了。</p><h2 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h2><p><code>HTTP</code>中最常见的请求之一就是<code>GET</code>请求。</p><h3 id="GET请求"><a href="#GET请求" class="headerlink" title="GET请求"></a><code>GET</code>请求</h3><p>换一个示例网站，其<code>URL</code>为<a href="http://httpbin.org/get">http://httpbin.org/get</a>，如果客户端发起的是<code>GET</code>请求的话，该网站会判断并返回相应的请求信息，包括 <code>Headers</code>、<code>IP</code>等。 我们还是用相同的方法来发起一个<code>GET请求</code>，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>r = requests.get(url=<span class="hljs-string">&#x27;http://httpbin.org/get&#x27;</span>, verify=<span class="hljs-literal">False</span>)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></div></td></tr></table></figure><p>返回结果：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">&#123;<br>  &quot;args&quot;: &#123;&#125;, <br>  &quot;headers&quot;: &#123;<br>    &quot;Accept&quot;: &quot;*/*&quot;,<br>    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,<br>    &quot;Host&quot;: &quot;httpbin.org&quot;,<br>    &quot;User-Agent&quot;: &quot;python-requests/2.25.1&quot;,<br>    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-60a3a8ad-070f8b95711f7821709e24ed&quot;<br>  &#125;,<br>  &quot;origin&quot;: &quot;202.62.113.207&quot;,<br>  &quot;url&quot;: &quot;http://httpbin.org/get&quot;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>可以发现，成功发起了<code>GET</code>请求，也通过这个网站的返回结果得到了请求所携带的信息，包括<code>Headers</code>、<code>URL</code>、<code>IP</code>，等等。</p><p>对于<code>GET</code>请求，我们知道<code>URL</code>后面是可以跟上一些参数的，如果我们现在想添加两个参数，其中<code>name</code>是<code>germey</code>，<code>age</code>是<code>25</code>，<code>URL</code>就可以写成如下内容：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">http://httpbin.org/get?name=germey&amp;age=<span class="hljs-number">25</span><br></code></pre></div></td></tr></table></figure><p>要构造这个请求链接，是不是要直接写成这样呢？</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">r = requests.get(<span class="hljs-string">&#x27;http://httpbin.org/get?name=germey&amp;age=25&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>这样也可以，但如果这些参数还需要手动拼接，未免有点不人性化。</p><p>一般情况下，这种信息我们利用<code>params</code>这个参数就可以直接传递了，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>data = &#123;<br>    <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;holy&#x27;</span>,<br>    <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-number">25</span><br>&#125;<br><br>r = requests.get(url=<span class="hljs-string">&#x27;http://httpbin.org/get&#x27;</span>, params=data, verify=<span class="hljs-literal">False</span>)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></div></td></tr></table></figure><p>返回结果：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">&#123;<br>  &quot;args&quot;: &#123;<br>    &quot;age&quot;: &quot;25&quot;,<br>    &quot;name&quot;: &quot;holy&quot;<br>  &#125;,<br>  &quot;headers&quot;: &#123;<br>    &quot;Accept&quot;: &quot;*/*&quot;,<br>    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,<br>    &quot;Host&quot;: &quot;httpbin.org&quot;,<br>    &quot;User-Agent&quot;: &quot;python-requests/2.25.1&quot;,<br>    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-60a3ab05-51321f5c7eeb7b0573bb5510&quot;<br>  &#125;,<br>  &quot;origin&quot;: &quot;202.62.113.207&quot;,<br>  &quot;url&quot;: &quot;http://httpbin.org/get?name=holy&amp;age=25&quot;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>把<code>URL</code>参数通过字典的形式传给<code>get</code>方法的<code>params</code>参数，通过返回信息可以判断，请求的链接自动被构造成了：<em><a href="http://httpbin.org/get?age=22&amp;name=germey">http://httpbin.org/get?age=22&amp;name=germey</a></em>。</p><p>网页的返回类型实际上是<code>str</code>类型，但是它很特殊，是<code>JSON</code>格式的。所以，如果想直接解析返回结果，得到一个<code>JSON</code>格式的数据的话，可以直接调用<code>json</code>方法。</p><p>示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>data = &#123;<br>    <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;holy&#x27;</span>,<br>    <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-number">25</span><br>&#125;<br><br>r = requests.get(url=<span class="hljs-string">&#x27;http://httpbin.org/get&#x27;</span>, params=data, verify=<span class="hljs-literal">False</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(r.text))<br><span class="hljs-built_in">print</span>(r.json())<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(r.json()))<br></code></pre></div></td></tr></table></figure><p>结果如下：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">&lt;class &#x27;str&#x27;&gt;<br>&#123;&#x27;args&#x27;: &#123;&#x27;age&#x27;: &#x27;25&#x27;, &#x27;name&#x27;: &#x27;holy&#x27;&#125;, &#x27;headers&#x27;: &#123;&#x27;Accept&#x27;: &#x27;*/*&#x27;, &#x27;Accept-Encoding&#x27;: &#x27;gzip, deflate&#x27;, &#x27;Host&#x27;: &#x27;httpbin.org&#x27;, &#x27;User-Agent&#x27;: &#x27;python-requests/2.25.1&#x27;, &#x27;X-Amzn-Trace-Id&#x27;: &#x27;Root=1-60a3ac52-425e713a2907d0302f298070&#x27;&#125;, &#x27;origin&#x27;: &#x27;202.62.113.207&#x27;, &#x27;url&#x27;: &#x27;http://httpbin.org/get?name=holy&amp;age=25&#x27;&#125;<br>&lt;class &#x27;dict&#x27;&gt;<br></code></pre></div></td></tr></table></figure><p>调用<code>json</code>方法，就可以将返回结果是<code>JSON</code>格式的字符串转化为字典。 但需要注意的是，如果返回结果不是<code>JSON</code>格式，便会出现解析错误，抛出<code>json.decoder.JSONDecodeError</code>异常。</p><h3 id="抓取网页"><a href="#抓取网页" class="headerlink" title="抓取网页"></a>抓取网页</h3><p>上面的请求链接返回的是<code>JSON</code>形式的字符串，那么如果请求普通的网页，则肯定能获得相应的内容。下面以本课时最初的实例页面为例，我们再加上一点提取信息的逻辑，将代码完善成如下的样子：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><br>r = requests.get(<span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class="hljs-literal">False</span>)<br>pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">&#x27;&lt;h2.*?&gt;(.*?)&lt;/h2&gt;&#x27;</span>, re.S)<br>titles = re.findall(pattern, r.text)<br><span class="hljs-built_in">print</span>(titles)<br></code></pre></div></td></tr></table></figure><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">[<span class="hljs-string">&#x27;霸王别姬 - Farewell My Concubine&#x27;</span>, <span class="hljs-string">&#x27;这个杀手不太冷 - Léon&#x27;</span>, <span class="hljs-string">&#x27;肖申克的救赎 - The Shawshank Redemption&#x27;</span>, <span class="hljs-string">&#x27;泰坦尼克号 - Titanic&#x27;</span>, <span class="hljs-string">&#x27;罗马假日 - Roman Holiday&#x27;</span>, <span class="hljs-string">&#x27;唐伯虎点秋香 - Flirting Scholar&#x27;</span>, <span class="hljs-string">&#x27;乱世佳人 - Gone with the Wind&#x27;</span>, <span class="hljs-string">&#x27;喜剧之王 - The King of Comedy&#x27;</span>, <span class="hljs-string">&#x27; 楚门的世界 - The Truman Show&#x27;</span>, <span class="hljs-string">&#x27;狮子王 - The Lion King&#x27;</span>]<br></code></pre></div></td></tr></table></figure><h3 id="抓取二进制数据"><a href="#抓取二进制数据" class="headerlink" title="抓取二进制数据"></a>抓取二进制数据</h3><p>抓取的是网站的一个页面，实际上它返回的是一个<code>HTML</code>文档。如果想抓取图片、音频、视频等文件，应该怎么办呢？</p><p>图片、音频、视频这些文件本质上都是由<strong>二进制码</strong>组成的，由于有特定的保存格式和对应的解析方式，我们才可以看到这些形形色色的多媒体。所以，想要抓取它们，就要拿到它们的二进制数据。</p><p>下面以 GitHub 的站点图标为例来看一下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>r = requests.get(<span class="hljs-string">&#x27;https://github.com/favicon.ico&#x27;</span>)<br><span class="hljs-built_in">print</span>(r.text)<br><span class="hljs-built_in">print</span>(r.content)<br></code></pre></div></td></tr></table></figure><p>这里抓取的内容是站点图标，也就是在浏览器每一个标签上显示的小图标。</p><p>前者出现了乱码，后者结果前带有一个<code>b</code>，这代表是<code>bytes</code>类型的数据。</p><p>由于图片是二进制数据，所以前者在打印时转化为<code>str</code>类型，也就是图片直接转化为字符串，这当然会出现乱码。</p><p>上面返回的结果我们并不能看懂，它实际上是图片的二进制数据，没关系，将刚才提取到的信息保存下来就好了，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests <br><br>r = requests.get(<span class="hljs-string">&#x27;https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png&#x27;</span>, verify=<span class="hljs-literal">False</span>) <br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;baidu.png&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f: <br>    f.write(r.content)<br></code></pre></div></td></tr></table></figure><p>这里用了<code>open</code>方法，它的第一个参数是文件名称，第二个参数代表以二进制的形式打开，可以向文件里写入二进制数据。</p><p>运行结束之后，可以发现在文件夹中出现了名为<code>baidu.png</code>的图标。</p><h3 id="添加添headers"><a href="#添加添headers" class="headerlink" title="添加添headers"></a>添加添headers</h3><p>在发起一个<code>HTTP</code>请求的时候，会有一个请求头<code>Request Headers</code>，那么这个怎么来设置呢？</p><p>很简单，使用<code>headers</code>参数就可以完成了。</p><p>在刚才的实例中，是没有设置<code>Request Headers</code>信息的，如果不设置，某些网站会发现这不是一个正常的浏览器发起的请求，网站可能会返回异常的结果，导致网页抓取失败。</p><p>要添加<code>Headers</code>信息，比如添加一个<code>User-Agent</code>字段，可以这么写：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>headers = &#123; <br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36&#x27;</span><br>&#125;<br><br>r = requests.get(<span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, headers=headers, verify=<span class="hljs-literal">False</span>) <br><br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></div></td></tr></table></figure><p>当然，我们可以在<code>headers</code>这个参数中任意添加其他的字段信息。</p><h3 id="POST请求"><a href="#POST请求" class="headerlink" title="POST请求"></a>POST请求</h3><p>使用<code>requests</code>实现<code>post</code>请求，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>data = &#123;<span class="hljs-string">&#x27;name&#x27;</span>:<span class="hljs-string">&#x27;germey&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>:<span class="hljs-string">&#x27;25&#x27;</span>&#125;<br>r = requests.post(<span class="hljs-string">&quot;http://httpbin.org/post&quot;</span>, data=data)<br><br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></div></td></tr></table></figure><p>这里还是请求<a href="http://httpbin.org/post">http://httpbin.org/post</a>，该网站可以判断如果请求是<code>POST</code>方式，就把相关请求信息返回。</p><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<br>  <span class="hljs-string">&quot;args&quot;</span>: &#123;&#125;,<br>  <span class="hljs-string">&quot;data&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-string">&quot;files&quot;</span>: &#123;&#125;,<br>  <span class="hljs-string">&quot;form&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-string">&quot;25&quot;</span>,<br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;germey&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;headers&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;*/*&quot;</span>,<br>    <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>,<br>    <span class="hljs-string">&quot;Content-Length&quot;</span>: <span class="hljs-string">&quot;18&quot;</span>,<br>    <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>,<br>    <span class="hljs-string">&quot;Host&quot;</span>: <span class="hljs-string">&quot;httpbin.org&quot;</span>,<br>    <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;python-requests/2.25.1&quot;</span>,<br>    <span class="hljs-string">&quot;X-Amzn-Trace-Id&quot;</span>: <span class="hljs-string">&quot;Root=1-60a402c2-68a523624a9ca353207a3a5e&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;json&quot;</span>: null,<br>  <span class="hljs-string">&quot;origin&quot;</span>: <span class="hljs-string">&quot;202.62.113.207&quot;</span>,<br>  <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;http://httpbin.org/post&quot;</span><br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h3><p>发送请求后，得到的就是响应，即<code>Response</code>。</p><p>在上面的实例中，使用<code>text</code>和<code>content</code>获取了响应的内容。此外，还有很多属性和方法可以用来获取其他信息，比如<code>状态码</code>、<code>响应头</code>、<code>Cookies</code>等。示例如下:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>r = requests.get(<span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class="hljs-literal">False</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(r.status_code), r.status_code)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(r.headers), r.headers)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(r.cookies), r.cookies)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(r.url), r.url)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(r.history), r.history)<br></code></pre></div></td></tr></table></figure><p>这里分别打印输出<code>status_code</code>属性得到状态码，输出<code>headers</code>属性得到响应头，输出<code>cookies</code>属性得到<code>Cookies</code>，输出<code>url</code>属性得到<code>URL</code>，输出<code>history</code>属性得到请求历史。</p><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">int</span>&#x27;&gt; 200</span><br><span class="hljs-class">&lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">requests</span>.<span class="hljs-title">structures</span>.<span class="hljs-title">CaseInsensitiveDict</span>&#x27;&gt; &#123;&#x27;<span class="hljs-title">Date</span>&#x27;:</span> <span class="hljs-string">&#x27;Wed, 19 May 2021 12:52:03 GMT&#x27;</span>, <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html; charset=utf-8&#x27;</span>, <span class="hljs-string">&#x27;Content-Length&#x27;</span>: <span class="hljs-string">&#x27;41538&#x27;</span>, <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>, <span class="hljs-string">&#x27;X-Frame-Options&#x27;</span>: <span class="hljs-string">&#x27;DENY&#x27;</span>, <span class="hljs-string">&#x27;X-Content-Type-Options&#x27;</span>: <span class="hljs-string">&#x27;nosniff&#x27;</span>, <span class="hljs-string">&#x27;Expires&#x27;</span>: <span class="hljs-string">&#x27;Wed, 19 May 2021 13:01:46 GMT&#x27;</span>, <span class="hljs-string">&#x27;Cache-Control&#x27;</span>: <span class="hljs-string">&#x27;max-age=600&#x27;</span>, <span class="hljs-string">&#x27;Strict-Transport-Security&#x27;</span>: <span class="hljs-string">&#x27;max-age=15724800; includeSubDomains&#x27;</span>&#125;<br>&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">requests</span>.<span class="hljs-title">cookies</span>.<span class="hljs-title">RequestsCookieJar</span>&#x27;&gt; &lt;<span class="hljs-title">RequestsCookieJar</span>[]&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">class</span> &#x27;<span class="hljs-title">str</span>&#x27;&gt; <span class="hljs-title">https</span>:</span>//static1.scrape.cuiqingcai.com/<br>&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">list</span>&#x27;&gt; []</span><br></code></pre></div></td></tr></table></figure><p><code>headers</code>和<code>cookies</code>这两个属性得到的结果分别是<code>CaseInsensitiveDict</code>和<code>RequestsCookieJar</code>类型。</p><p>状态码是用来表示响应状态的，比如返回<code>200</code>代表我们得到的响应是没问题的，上面的例子正好输出的结果也是<code>200</code>，所以可以通过判断<code>Response</code>的状态码来确认是否爬取成功。</p><p><code>requests</code>还提供了一个内置的状态码查询对象<code>requests.codes</code>，用法示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>r = requests.get(<span class="hljs-string">&#x27;https://static1.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class="hljs-literal">False</span>)<br>exit() <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> r.status_code == requests.codes.ok <span class="hljs-keyword">else</span> <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Request successfully&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>这里通过比较返回码和内置的成功的返回码，来保证请求得到了正常响应，输出成功请求的消息，否则程序终止，这里我们用<code>requests.codes.ok</code>得到的是成功的状态码<code>200</code>。</p><p>这样的话，我们就不用再在程序里面写状态码对应的数字了，用字符串表示状态码会显得更加直观。</p><p>下面列出了返回码和相应的查询条件：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># 信息性状态码</span><br><span class="hljs-number">100</span>: (<span class="hljs-string">&#x27;continue&#x27;</span>,),<br><span class="hljs-number">101</span>: (<span class="hljs-string">&#x27;switching_protocols&#x27;</span>,),<br><span class="hljs-number">102</span>: (<span class="hljs-string">&#x27;processing&#x27;</span>,),<br><span class="hljs-number">103</span>: (<span class="hljs-string">&#x27;checkpoint&#x27;</span>,),<br><span class="hljs-number">122</span>: (<span class="hljs-string">&#x27;uri_too_long&#x27;</span>, <span class="hljs-string">&#x27;request_uri_too_long&#x27;</span>),<br><br><span class="hljs-comment"># 成功状态码</span><br><span class="hljs-number">200</span>: (<span class="hljs-string">&#x27;ok&#x27;</span>, <span class="hljs-string">&#x27;okay&#x27;</span>, <span class="hljs-string">&#x27;all_ok&#x27;</span>, <span class="hljs-string">&#x27;all_okay&#x27;</span>, <span class="hljs-string">&#x27;all_good&#x27;</span>, <span class="hljs-string">&#x27;\\o/&#x27;</span>, <span class="hljs-string">&#x27;✓&#x27;</span>),<br><span class="hljs-number">201</span>: (<span class="hljs-string">&#x27;created&#x27;</span>,),<br><span class="hljs-number">202</span>: (<span class="hljs-string">&#x27;accepted&#x27;</span>,),<br><span class="hljs-number">203</span>: (<span class="hljs-string">&#x27;non_authoritative_info&#x27;</span>, <span class="hljs-string">&#x27;non_authoritative_information&#x27;</span>),<br><span class="hljs-number">204</span>: (<span class="hljs-string">&#x27;no_content&#x27;</span>,),<br><span class="hljs-number">205</span>: (<span class="hljs-string">&#x27;reset_content&#x27;</span>, <span class="hljs-string">&#x27;reset&#x27;</span>),<br><span class="hljs-number">206</span>: (<span class="hljs-string">&#x27;partial_content&#x27;</span>, <span class="hljs-string">&#x27;partial&#x27;</span>),<br><span class="hljs-number">207</span>: (<span class="hljs-string">&#x27;multi_status&#x27;</span>, <span class="hljs-string">&#x27;multiple_status&#x27;</span>, <span class="hljs-string">&#x27;multi_stati&#x27;</span>, <span class="hljs-string">&#x27;multiple_stati&#x27;</span>),<br><span class="hljs-number">208</span>: (<span class="hljs-string">&#x27;already_reported&#x27;</span>,),<br><span class="hljs-number">226</span>: (<span class="hljs-string">&#x27;im_used&#x27;</span>,),<br><br><span class="hljs-comment"># 重定向状态码</span><br><span class="hljs-number">300</span>: (<span class="hljs-string">&#x27;multiple_choices&#x27;</span>,),<br><span class="hljs-number">301</span>: (<span class="hljs-string">&#x27;moved_permanently&#x27;</span>, <span class="hljs-string">&#x27;moved&#x27;</span>, <span class="hljs-string">&#x27;\\o-&#x27;</span>),<br><span class="hljs-number">302</span>: (<span class="hljs-string">&#x27;found&#x27;</span>,),<br><span class="hljs-number">303</span>: (<span class="hljs-string">&#x27;see_other&#x27;</span>, <span class="hljs-string">&#x27;other&#x27;</span>),<br><span class="hljs-number">304</span>: (<span class="hljs-string">&#x27;not_modified&#x27;</span>,),<br><span class="hljs-number">305</span>: (<span class="hljs-string">&#x27;use_proxy&#x27;</span>,),<br><span class="hljs-number">306</span>: (<span class="hljs-string">&#x27;switch_proxy&#x27;</span>,),<br><span class="hljs-number">307</span>: (<span class="hljs-string">&#x27;temporary_redirect&#x27;</span>, <span class="hljs-string">&#x27;temporary_moved&#x27;</span>, <span class="hljs-string">&#x27;temporary&#x27;</span>),<br><span class="hljs-number">308</span>: (<span class="hljs-string">&#x27;permanent_redirect&#x27;</span>, <span class="hljs-string">&#x27;resume_incomplete&#x27;</span>, <span class="hljs-string">&#x27;resume&#x27;</span>,), <span class="hljs-comment"># These 2 to be removed in 3.0 </span><br><br><span class="hljs-comment"># 客户端错误状态码 </span><br><span class="hljs-number">400</span>: (<span class="hljs-string">&#x27;bad_request&#x27;</span>, <span class="hljs-string">&#x27;bad&#x27;</span>), <br><span class="hljs-number">401</span>: (<span class="hljs-string">&#x27;unauthorized&#x27;</span>,), <br><span class="hljs-number">402</span>: (<span class="hljs-string">&#x27;payment_required&#x27;</span>, <span class="hljs-string">&#x27;payment&#x27;</span>), <br><span class="hljs-number">403</span>: (<span class="hljs-string">&#x27;forbidden&#x27;</span>,), <br><span class="hljs-number">404</span>: (<span class="hljs-string">&#x27;not_found&#x27;</span>, <span class="hljs-string">&#x27;-o-&#x27;</span>), <br><span class="hljs-number">405</span>: (<span class="hljs-string">&#x27;method_not_allowed&#x27;</span>, <span class="hljs-string">&#x27;not_allowed&#x27;</span>), <br><span class="hljs-number">406</span>: (<span class="hljs-string">&#x27;not_acceptable&#x27;</span>,), <br><span class="hljs-number">407</span>: (<span class="hljs-string">&#x27;proxy_authentication_required&#x27;</span>, <span class="hljs-string">&#x27;proxy_auth&#x27;</span>, <span class="hljs-string">&#x27;proxy_authentication&#x27;</span>),<br><span class="hljs-number">408</span>: (<span class="hljs-string">&#x27;request_timeout&#x27;</span>, <span class="hljs-string">&#x27;timeout&#x27;</span>), <br><span class="hljs-number">409</span>: (<span class="hljs-string">&#x27;conflict&#x27;</span>,),<br><span class="hljs-number">410</span>: (<span class="hljs-string">&#x27;gone&#x27;</span>,),<br><span class="hljs-number">411</span>: (<span class="hljs-string">&#x27;length_required&#x27;</span>,),<br><span class="hljs-number">412</span>: (<span class="hljs-string">&#x27;precondition_failed&#x27;</span>, <span class="hljs-string">&#x27;precondition&#x27;</span>),<br><span class="hljs-number">413</span>: (<span class="hljs-string">&#x27;request_entity_too_large&#x27;</span>,),<br><span class="hljs-number">414</span>: (<span class="hljs-string">&#x27;request_uri_too_large&#x27;</span>,),<br><span class="hljs-number">415</span>: (<span class="hljs-string">&#x27;unsupported_media_type&#x27;</span>, <span class="hljs-string">&#x27;unsupported_media&#x27;</span>, <span class="hljs-string">&#x27;media_type&#x27;</span>),<br><span class="hljs-number">416</span>: (<span class="hljs-string">&#x27;requested_range_not_satisfiable&#x27;</span>, <span class="hljs-string">&#x27;requested_range&#x27;</span>, <span class="hljs-string">&#x27;range_not_satisfiable&#x27;</span>),<br><span class="hljs-number">417</span>: (<span class="hljs-string">&#x27;expectation_failed&#x27;</span>,),<br><span class="hljs-number">418</span>: (<span class="hljs-string">&#x27;im_a_teapot&#x27;</span>, <span class="hljs-string">&#x27;teapot&#x27;</span>, <span class="hljs-string">&#x27;i_am_a_teapot&#x27;</span>),<br><span class="hljs-number">421</span>: (<span class="hljs-string">&#x27;misdirected_request&#x27;</span>,),<br><span class="hljs-number">422</span>: (<span class="hljs-string">&#x27;unprocessable_entity&#x27;</span>, <span class="hljs-string">&#x27;unprocessable&#x27;</span>),<br><span class="hljs-number">423</span>: (<span class="hljs-string">&#x27;locked&#x27;</span>,),<br><span class="hljs-number">424</span>: (<span class="hljs-string">&#x27;failed_dependency&#x27;</span>, <span class="hljs-string">&#x27;dependency&#x27;</span>),<br><span class="hljs-number">425</span>: (<span class="hljs-string">&#x27;unordered_collection&#x27;</span>, <span class="hljs-string">&#x27;unordered&#x27;</span>),<br><span class="hljs-number">426</span>: (<span class="hljs-string">&#x27;upgrade_required&#x27;</span>, <span class="hljs-string">&#x27;upgrade&#x27;</span>),<br><span class="hljs-number">428</span>: (<span class="hljs-string">&#x27;precondition_required&#x27;</span>, <span class="hljs-string">&#x27;precondition&#x27;</span>),<br><span class="hljs-number">429</span>: (<span class="hljs-string">&#x27;too_many_requests&#x27;</span>, <span class="hljs-string">&#x27;too_many&#x27;</span>),<br><span class="hljs-number">431</span>: (<span class="hljs-string">&#x27;header_fields_too_large&#x27;</span>, <span class="hljs-string">&#x27;fields_too_large&#x27;</span>),<br><span class="hljs-number">444</span>: (<span class="hljs-string">&#x27;no_response&#x27;</span>, <span class="hljs-string">&#x27;none&#x27;</span>),<br><span class="hljs-number">449</span>: (<span class="hljs-string">&#x27;retry_with&#x27;</span>, <span class="hljs-string">&#x27;retry&#x27;</span>),<br><span class="hljs-number">450</span>: (<span class="hljs-string">&#x27;blocked_by_windows_parental_controls&#x27;</span>, <span class="hljs-string">&#x27;parental_controls&#x27;</span>),<br><span class="hljs-number">451</span>: (<span class="hljs-string">&#x27;unavailable_for_legal_reasons&#x27;</span>, <span class="hljs-string">&#x27;legal_reasons&#x27;</span>),<br><span class="hljs-number">499</span>: (<span class="hljs-string">&#x27;client_closed_request&#x27;</span>,), <br><br><span class="hljs-comment"># 服务端错误状态码</span><br><span class="hljs-number">500</span>: (<span class="hljs-string">&#x27;internal_server_error&#x27;</span>, <span class="hljs-string">&#x27;server_error&#x27;</span>, <span class="hljs-string">&#x27;/o\\&#x27;</span>, <span class="hljs-string">&#x27;✗&#x27;</span>),<br><span class="hljs-number">501</span>: (<span class="hljs-string">&#x27;not_implemented&#x27;</span>,),<br><span class="hljs-number">502</span>: (<span class="hljs-string">&#x27;bad_gateway&#x27;</span>,),<br><span class="hljs-number">503</span>: (<span class="hljs-string">&#x27;service_unavailable&#x27;</span>, <span class="hljs-string">&#x27;unavailable&#x27;</span>),<br><span class="hljs-number">504</span>: (<span class="hljs-string">&#x27;gateway_timeout&#x27;</span>,),<br><span class="hljs-number">505</span>: (<span class="hljs-string">&#x27;http_version_not_supported&#x27;</span>, <span class="hljs-string">&#x27;http_version&#x27;</span>),<br><span class="hljs-number">506</span>: (<span class="hljs-string">&#x27;variant_also_negotiates&#x27;</span>,),<br><span class="hljs-number">507</span>: (<span class="hljs-string">&#x27;insufficient_storage&#x27;</span>,),<br><span class="hljs-number">509</span>: (<span class="hljs-string">&#x27;bandwidth_limit_exceeded&#x27;</span>, <span class="hljs-string">&#x27;bandwidth&#x27;</span>),<br><span class="hljs-number">510</span>: (<span class="hljs-string">&#x27;not_extended&#x27;</span>,),<br><span class="hljs-number">511</span>: (<span class="hljs-string">&#x27;network_authentication_required&#x27;</span>, <span class="hljs-string">&#x27;network_auth&#x27;</span>, <span class="hljs-string">&#x27;network_authentication&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>比如，如果想判断结果是不是<code>404</code>状态，可以用<code>requests.codes.not_found</code>来比对。</p><h2 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h2><p>刚才，了解<code>requests</code>的基本用法，如基本的<code>GET、POST</code>请求以及<code>Response</code>对象。当然<code>requests</code>能做到的不仅这些，它几乎可以完成<code>HTTP</code>的所有操作。</p><p>下面来了解下<code>requests</code>的一些高级用法，如文件上传、<code>Cookies</code>设置、代理设置等。</p><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p><code>requests</code>可以模拟提交一些数据。假如有的网站需要上传文件，也可以用它来实现，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>files = &#123;<span class="hljs-string">&#x27;file&#x27;</span>:<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;baidu.png&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>)&#125;<br>r = requests.post(<span class="hljs-string">&#x27;http://httpbin.org/post&#x27;</span>, files=files)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></div></td></tr></table></figure><p>要注意的是，<code>baidu.png</code>需要和当前脚本在同一目录下。如果有其他文件，当然也可以使用其他文件来上传，更改下代码即可。运行结果如下：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">&#123;<br>  &quot;args&quot;: &#123;&#125;, <br>  &quot;data&quot;: &quot;&quot;, <br>  &quot;files&quot;: &#123;<br>    &quot;file&quot;: &quot;data:application/octet-stream;base64,iVBORw0KGgoAAAANSU......&quot;<br>  &#125;,<br>  &quot;form&quot;: &#123;&#125;,<br>  &quot;headers&quot;: &#123;<br>    &quot;Accept&quot;: &quot;*/*&quot;,<br>    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,<br>    &quot;Content-Length&quot;: &quot;15589&quot;,<br>    &quot;Content-Type&quot;: &quot;multipart/form-data; boundary=7e0556b094615781fff3b0ed4316dccd&quot;,<br>    &quot;Host&quot;: &quot;httpbin.org&quot;,<br>    &quot;User-Agent&quot;: &quot;python-requests/2.25.1&quot;,<br>    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-60a72501-36f606570785cb9d4356df71&quot;<br>  &#125;,<br>  &quot;json&quot;: null,<br>  &quot;origin&quot;: &quot;202.62.112.143&quot;,<br>  &quot;url&quot;: &quot;http://httpbin.org/post&quot;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>以上省略部分内容，这个网站会返回响应，里面包含<code>files</code>这个字段，而<code>form</code>字段是空的，这证明文件上传部分会单独有一个<code>files</code>字段来标识。</p><h3 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h3><p>获取<code>Cookies</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>r = requests.get(<span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span>)<br><span class="hljs-built_in">print</span>(r.cookies)<br><span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> r.cookies.items():<br>    <span class="hljs-built_in">print</span>(key + <span class="hljs-string">&#x27;=&#x27;</span> + value)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">&lt;RequestsCookieJar[&lt;Cookie BDORZ=27315 for .baidu.com/&gt;]&gt;<br>BDORZ=27315<br></code></pre></div></td></tr></table></figure><p>调用<code>cookies</code>属性即可成功得到<code>Cookies</code>，可以发现它是<code>RequestCookieJar</code>类型。然后用<code>items</code> 方法将其转化为元组组成的列表，遍历输出每一个<code>Cookie</code>的名称和值，实现<code>Cookie</code>的遍历解析。</p><p>可以直接用<code>Cookie</code>来维持登录状态，下面我们以<code>GitHub</code>为例来说明一下，首先我们登录<code>GitHub</code>，然后将<code>Headers</code>中的<code>Cookie</code>内容复制下来，如图所示：</p><p><img src="Screenshot_1.webp"></p><p>可以替换成你自己的<code>Cookie</code>，将其设置到<code>Headers</code>里面，然后发送请求。</p><h3 id="Session维持"><a href="#Session维持" class="headerlink" title="Session维持"></a>Session维持</h3><p>在<code>requests</code>中，如果直接利用<code>get</code>或<code>post</code>等方法的确可以做到模拟网页的请求，但是这实际上是相当于不同的<code>Session</code>，相当于你用两个浏览器打开了不同的页面。</p><p>设想这样一个场景，第一个请求利用<code>post</code>方法登录了某个网站，第二次想获取成功登录后的自己的个人信息，又用了一次<code>get</code>方法去请求个人信息页面。实际上，这相当于打开了两个浏览器，是两个完全不相关的<code>Session</code>，能成功获取个人信息吗？当然不能。</p><p>解决这个问题的主要方法就是维持同一个<code>Session</code>，相当于打开一个新的浏览器选项卡而不是新开一个浏览器。但我又不想每次设置<code>Cookies</code>，那该怎么办呢？这时候就有了新的利器——**<code>Session</code>对象**。 利用它，可以方便地维护一个<code>Session</code>，而且不用担心<code>Cookies</code>的问题，它会帮我们自动处理好。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>requests.get(<span class="hljs-string">&#x27;http://httpbin.org/cookies/set/number/123456789&#x27;</span>, verify=<span class="hljs-literal">False</span>)<br>r = requests.get(<span class="hljs-string">&#x27;http://httpbin.org/cookies&#x27;</span>, verify=<span class="hljs-literal">False</span>)<br><br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<br>  <span class="hljs-string">&quot;cookies&quot;</span>: &#123;&#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>这并不行。再用 Session试试看：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>s = requests.Session()<br>s.get(<span class="hljs-string">&#x27;http://httpbin.org/cookies/set/number/123456789&#x27;</span>)<br>r = s.get(<span class="hljs-string">&#x27;http://httpbin.org/cookies&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<br>  <span class="hljs-string">&quot;cookies&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;number&quot;</span>: <span class="hljs-string">&quot;123456789&quot;</span><br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>利用<code>Session</code>，可以做到模拟同一个<code>Session</code>而不用担心<code>Cookies</code>的问题。它通常用于模拟登录成功之后再进行下一步的操作。</p><h3 id="SSL证书验证"><a href="#SSL证书验证" class="headerlink" title="SSL证书验证"></a>SSL证书验证</h3><p>现在很多网站都要求使用<code>HTTPS</code>协议，但是有些网站可能并没有设置好<code>HTTPS</code>证书，或者网站的<code>HTTPS</code>证书不被<code>CA</code>机构认可，这时候，这些网站可能就会出现<code>SSL</code>证书错误的提示。</p><p>比如示例网站：<a href="https://static2.scrape.cuiqingcai.com/">https://static2.scrape.cuiqingcai.com/</a>。 用浏览器打开这个<code>URL</code>，则会提示<strong>「您的连接不是私密连接」</strong>这样的错误，如图所示：</p><p><img src="Screenshot_3.webp" alt="示例网站"></p><p>那如果我们一定要爬取这个网站怎么办呢？我们可以使用<code>verify</code>参数控制是否验证证书，如果将其设置为<code>False</code>，在请求时就不会再验证证书是否有效。如果不加<code>verify</code>参数的话，默认值是<code>True</code>，会自动验证。</p><p>改写代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>response = requests.get(<span class="hljs-string">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class="hljs-literal">False</span>) <br><span class="hljs-built_in">print</span>(response.status_code) <br></code></pre></div></td></tr></table></figure><p>这样就会打印出请求成功的状态码：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">/usr/local/lib/python3<span class="hljs-number">.7</span>/site-packages/urllib3/connectionpool.py:<span class="hljs-number">857</span>: InsecureRequestWarning: Unverified HTTPS request <span class="hljs-keyword">is</span> being made. Adding certificate verification <span class="hljs-keyword">is</span> strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html<br>InsecureRequestWarning) <span class="hljs-number">200</span> <br></code></pre></div></td></tr></table></figure><p>不过发现报了一个警告，它建议我们给它指定证书。可以通过设置忽略警告的方式来屏蔽这个警告：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests <span class="hljs-keyword">from</span> requests.packages <br><span class="hljs-keyword">import</span> urllib3 <br><br>urllib3.disable_warnings() <br>response = requests.get(<span class="hljs-string">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class="hljs-literal">False</span>) <br><span class="hljs-built_in">print</span>(response.status_code)<br></code></pre></div></td></tr></table></figure><p>或者通过捕获警告到日志的方式忽略警告：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging <br><span class="hljs-keyword">import</span> requests <br><br>logging.captureWarnings(<span class="hljs-literal">True</span>) <br>response = requests.get(<span class="hljs-string">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, verify=<span class="hljs-literal">False</span>) <br><span class="hljs-built_in">print</span>(response.status_code)<br></code></pre></div></td></tr></table></figure><p>当然，也可以指定一个本地证书用作客户端证书，这可以是单个文件（包含密钥和证书）或一个包含两个文件路径的元组： </p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests response = requests.get(<span class="hljs-string">&#x27;https://static2.scrape.cuiqingcai.com/&#x27;</span>, cert=(<span class="hljs-string">&#x27;/path/server.crt&#x27;</span>, <span class="hljs-string">&#x27;/path/server.key&#x27;</span>)) <br><span class="hljs-built_in">print</span>(response.status_code)<br></code></pre></div></td></tr></table></figure><p>上面的代码是演示实例，要有<code>crt</code>和<code>key</code>文件，并且指定它们的路径。另外注意，本地私有证书的<code>key</code>必须是解密状态，加密状态的<code>key</code>是不支持的。</p><h3 id="超时时间"><a href="#超时时间" class="headerlink" title="超时时间"></a>超时时间</h3><p>在本机网络状况不好或者服务器网络响应延迟甚至无响应时，可能会等待很久才能收到响应，甚至到最后收不到响应而报错。为了防止服务器不能及时响应，应该设置一个超时时间，即超过了这个时间还没有得到响应，那就报错。这需要用到<code>timeout</code>参数。这个时间的计算是发出请求到服务器返回响应的时间。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests <br>r = requests.get(<span class="hljs-string">&#x27;https://httpbin.org/get&#x27;</span>, timeout=<span class="hljs-number">1</span>) <br><span class="hljs-built_in">print</span>(r.status_code)<br></code></pre></div></td></tr></table></figure><p>通过这样的方式将超时时间设置为<code>1</code>秒，如果<code>1</code>秒内没有响应，那就抛出异常。</p><p>实际上，请求分为两个阶段，即连接<code>（connect）</code>和读取<code>（read）</code>。 上面设置的<code>timeout</code>将用作连接和读取这二者的<code>timeout</code>总和。</p><p>如果要分别指定，就可以传入一个元组：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">r = requests.get(<span class="hljs-string">&#x27;https://httpbin.org/get&#x27;</span>, timeout=(<span class="hljs-number">5</span>, <span class="hljs-number">30</span>))<br></code></pre></div></td></tr></table></figure><p>如果想永久等待，可以直接将<code>timeout</code>设置为<code>None</code>，或者不设置直接留空，因为默认是<code>None</code>。这样的话，如果服务器还在运行，但是响应特别慢，那就慢慢等吧，它永远不会返回超时错误的。其用法如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">r = requests.get(<span class="hljs-string">&#x27;https://httpbin.org/get&#x27;</span>, timeout=<span class="hljs-literal">None</span>) <br></code></pre></div></td></tr></table></figure><p>或直接不加参数：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">r = requests.get(<span class="hljs-string">&#x27;https://httpbin.org/get&#x27;</span>)<br></code></pre></div></td></tr></table></figure><h3 id="身份认证"><a href="#身份认证" class="headerlink" title="身份认证"></a>身份认证</h3><p>在访问某些设置了身份认证的网站时，例如：<a href="https://static3.scrape.cuiqingcai.com/">https://static3.scrape.cuiqingcai.com/</a>，我们可能会遇到这样的认证窗口，如图所示：</p><p><img src="Screenshot_4.webp" alt="认证"></p><p>如果遇到了这种情况，那就是这个网站启用了基本身份认证，英文叫作<code>HTTP Basic Access Authentication</code>，它是一种用来允许网页浏览器或其他客户端程序在请求时提供<strong>用户名</strong>和<strong>口令形式</strong>的身份凭证的一种登录验证方式。 如果遇到了这种情况，怎么用<code>reqeusts</code>来爬取呢，当然也有办法。</p><p>可以使用<code>requests</code>自带的身份认证功能，通过<code>auth</code>参数即可设置，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> requests.auth <span class="hljs-keyword">import</span> HTTPBasicAuth<br><br>r = requests.get(<span class="hljs-string">&#x27;https://static3.scrape.cuiqingcai.com/&#x27;</span>, auth=HTTPBasicAuth(<span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;admin&#x27;</span>), verify=<span class="hljs-literal">False</span>)<br><span class="hljs-built_in">print</span>(r.status_code)<br></code></pre></div></td></tr></table></figure><p>成功的话，返回状态码<code>200</code>。</p><p>如果参数都传一个<code>HTTPBasicAuth</code>类，就显得有点烦琐了，所以<code>requests</code>提供了一个更简单的写法，可以直接传一个元组，它会默认使用<code>HTTPBasicAuth</code>这个类来认证。</p><p>上面的代码可以直接简写如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>r = requests.get(<span class="hljs-string">&#x27;https://static3.scrape.cuiqingcai.com/&#x27;</span>, auth=(<span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;admin&#x27;</span>))<br><span class="hljs-built_in">print</span>(r.status_code)<br></code></pre></div></td></tr></table></figure><p>此外，<code>requests</code>还提供了其他认证方式，如<code>OAuth</code>认证，不过此时需要安装<code>oauth</code>包，安装命令如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip3 install requests_oauthlib<br></code></pre></div></td></tr></table></figure><p>使用<code>OAuth1</code>认证的方法如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests <span class="hljs-keyword">from</span> requests_oauthlib <br><span class="hljs-keyword">import</span> OAuth1 <br>url = <span class="hljs-string">&#x27;https://api.twitter.com/1.1/account/verify_credentials.json&#x27;</span> <br>auth = OAuth1(<span class="hljs-string">&#x27;YOUR_APP_KEY&#x27;</span>, <span class="hljs-string">&#x27;YOUR_APP_SECRET&#x27;</span>, <span class="hljs-string">&#x27;USER_OAUTH_TOKEN&#x27;</span>, <span class="hljs-string">&#x27;USER_OAUTH_TOKEN_SECRET&#x27;</span>)<br>requests.get(url, auth=auth) <br></code></pre></div></td></tr></table></figure><p>更多详细的功能就可以参考<code>requests_oauthlib</code>的官方文档：<a href="https://requests-oauthlib.readthedocs.org/">https://requests-oauthlib.readthedocs.org/</a>，不再赘述。</p><h3 id="代理设置"><a href="#代理设置" class="headerlink" title="代理设置"></a>代理设置</h3><p>某些网站在测试的时候请求几次，能正常获取内容。但是对于大规模且频繁的请求，网站可能会弹出验证码，或者跳转到登录认证页面，更甚者可能会直接封禁客户端的<code>IP</code>，导致一定时间段内无法访问。</p><p>为了防止这种情况发生，我们需要设置代理来解决这个问题，这就需要用到<code>proxies</code>参数。可以用这样的方式设置：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>proxies = &#123; <br>  <span class="hljs-string">&#x27;http&#x27;</span>: <span class="hljs-string">&#x27;http://10.10.10.10:1080&#x27;</span>, <br>  <span class="hljs-string">&#x27;https&#x27;</span>: <span class="hljs-string">&#x27;http://10.10.10.10:1080&#x27;</span>, <br>&#125;<br>requests.get(<span class="hljs-string">&#x27;https://httpbin.org/get&#x27;</span>, proxies=proxies) <br></code></pre></div></td></tr></table></figure><p>当然，直接运行这个实例或许行不通，因为这个代理可能是无效的，可以直接搜索寻找有效的代理并替换试验一下。</p><p>若代理需要使用上文所述的身份认证，可以使用类似<code>ttp://user:password@host:port</code>这样的语法来设置代理，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>proxies = &#123;<span class="hljs-string">&#x27;https&#x27;</span>: <span class="hljs-string">&#x27;http://user:password@10.10.10.10:1080/&#x27;</span>,&#125; <br>requests.get(<span class="hljs-string">&#x27;https://httpbin.org/get&#x27;</span>, proxies=proxies)<br></code></pre></div></td></tr></table></figure><p>除了基本的<code>HTTP</code>代理外，<code>requests</code>还支持<code>SOCKS</code>协议的代理。</p><p>首先，需要安装<code>socks</code>这个库：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip3 install <span class="hljs-string">&quot;requests[socks]&quot;</span><br></code></pre></div></td></tr></table></figure><p>然后就可以使用<code>SOCKS</code>协议代理了，示例如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>proxies = &#123; <br>  <span class="hljs-string">&#x27;http&#x27;</span>: <span class="hljs-string">&#x27;socks5://user:password@host:port&#x27;</span>, <br>  <span class="hljs-string">&#x27;https&#x27;</span>: <span class="hljs-string">&#x27;socks5://user:password@host:port&#x27;</span> <br>&#125;<br>requests.get(<span class="hljs-string">&#x27;https://httpbin.org/get&#x27;</span>, proxies=proxies)<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>爬虫</tag>
      
      <tag>requests</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginx配置详解</title>
    <link href="/2021/05/18/Nginx%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/"/>
    <url>/2021/05/18/Nginx%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><code>Nginx</code>是<code>lgor Sysoev</code>为俄罗斯访问量第二的<code>rambler.ru</code>站点设计开发的。从<code>2004</code>年发布至今，凭借开源的力量，已经接近成熟与完善。</p><p><code>Nginx</code>功能丰富，可作为<code>HTTP服务器</code>，也可作为反向代理服务器，邮件服务器。支持<code>FastCGI</code>、<code>SSL</code>、<code>Virtual Host</code>、<code>URL Rewrite</code>、<code>Gzip</code>等功能。并且支持很多第三方的模块扩展。</p><p><code>Nginx</code>的稳定性、功能集、示例配置文件和低系统资源的消耗让他后来居上，在全球活跃的网站中有<code>12.18%</code>的使用比率，大约为<code>2220</code>万个网站。</p><h2 id="Nginx常用功能"><a href="#Nginx常用功能" class="headerlink" title="Nginx常用功能"></a>Nginx常用功能</h2><h3 id="1、Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理"><a href="#1、Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理" class="headerlink" title="1、Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理"></a>1、Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理</h3><p>正向代理和反向代理：</p><p><img src="1.jpg" alt="正向代理和反向代理"></p><p><code>Nginx</code>在做反向代理时，提供性能稳定，并且能够提供配置灵活的转发功能。<code>Nginx</code>可以根据不同的正则匹配，采取不同的转发策略，比如图片文件结尾的文件服务器，动态页面<code>web</code>服务器，只要你正则写的没问题，又有相对应的服务器解决方案，你就可以随心所欲的玩。并且<code>Nginx</code>对返回结果进行错误页跳转，异常判断等。如果被分发的服务器存在异常，他可以将请求重新转发给另外一台服务器，然后自动去除异常服务器。</p><h3 id="2、负载均衡"><a href="#2、负载均衡" class="headerlink" title="2、负载均衡"></a>2、负载均衡</h3><p><code>Nginx</code>提供的负载均衡策略有2种：<code>内置策略</code>和<code>扩展策略</code>。内置策略为轮询，加权轮询，<code>Ip hash</code>。扩展策略，就天马行空，只有你想不到的没有他做不到的啦，你可以参照所有的负载均衡算法，给他一一找出来做下实现。</p><p>上3个图，理解这三种负载均衡算法的实现</p><p><img src="2.jpg" alt="负载均衡"></p><p>Ip hash算法，对客户端请求的ip进行hash操作，然后根据hash结果将同一个客户端ip的请求分发给同一台服务器进行处理，可以解决session不共享的问题。</p><p><img src="3.jpg" alt="负载均衡"></p><h3 id="3、web缓存"><a href="#3、web缓存" class="headerlink" title="3、web缓存"></a>3、web缓存</h3><p><code>Nginx</code>可以对不同的文件做不同的缓存处理，配置灵活，并且支持<code>FastCGI_Cache</code>，主要用于对<code>FastCGI</code>的动态程序进行缓存。配合着第三方的<code>ngx_cache_purge</code>，对制定的<code>URL</code>缓存内容可以的进行增删管理。</p><h3 id="4、Nginx相关地址"><a href="#4、Nginx相关地址" class="headerlink" title="4、Nginx相关地址"></a>4、Nginx相关地址</h3><p>源码：<a href="https://trac.nginx.org/nginx/browser">https://trac.nginx.org/nginx/browser</a></p><p>官网：<a href="http://www.nginx.org/">http://www.nginx.org/</a></p><h2 id="Nginx配置文件结构"><a href="#Nginx配置文件结构" class="headerlink" title="Nginx配置文件结构"></a>Nginx配置文件结构</h2><p>如果你下载好啦，你的安装文件，不妨打开<code>conf</code>文件夹的<code>nginx.conf</code>文件，<code>Nginx</code>服务器的基础配置，默认的配置也存放在此。</p><p>在<code>nginx.conf</code>的注释符号为：<code>#</code></p><p>默认的<code>nginx</code>配置文件<code>nginx.conf</code>内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">user  nobody;</span><br>worker_processes  1;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">error_log  logs/error.log;</span><br><span class="hljs-meta">#</span><span class="bash">error_log  logs/error.log  notice;</span><br><span class="hljs-meta">#</span><span class="bash">error_log  logs/error.log  info;</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">pid        logs/nginx.pid;</span><br><br><br>events &#123;<br>    worker_connections  1024;<br>&#125;<br><br><br>http &#123;<br>    include       mime.types;<br>    default_type  application/octet-stream;<br><br>    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;<br>    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;<br>    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;<br><br>    #access_log  logs/access.log  main;<br><br>    sendfile        on;<br>    #tcp_nopush     on;<br><br>    #keepalive_timeout  0;<br>    keepalive_timeout  65;<br><br>    #gzip  on;<br><br>    server &#123;<br>        listen       80;<br>        server_name  localhost;<br><br>        #charset koi8-r;<br><br>        #access_log  logs/host.access.log  main;<br><br>        location / &#123;<br>            root   html;<br>            index  index.html index.htm;<br>        &#125;<br><br>        #error_page  404              /404.html;<br><br>        # redirect server error pages to the static page /50x.html<br>        #<br>        error_page   500 502 503 504  /50x.html;<br>        location = /50x.html &#123;<br>            root   html;<br>        &#125;<br><br>        # proxy the PHP scripts to Apache listening on 127.0.0.1:80<br>        #<br>        #location ~ \.php$ &#123;<br>        #    proxy_pass   http://127.0.0.1;<br>        #&#125;<br><br>        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000<br>        #<br>        #location ~ \.php$ &#123;<br>        #    root           html;<br>        #    fastcgi_pass   127.0.0.1:9000;<br>        #    fastcgi_index  index.php;<br>        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;<br>        #    include        fastcgi_params;<br>        #&#125;<br><br>        # deny access to .htaccess files, if Apache&#x27;s document root<br>        # concurs with nginx&#x27;s one<br>        #<br>        #location ~ /\.ht &#123;<br>        #    deny  all;<br>        #&#125;<br>    &#125;<br><br><br>    # another virtual host using mix of IP-, name-, and port-based configuration<br>    #<br>    #server &#123;<br>    #    listen       8000;<br>    #    listen       somename:8080;<br>    #    server_name  somename  alias  another.alias;<br><br>    #    location / &#123;<br>    #        root   html;<br>    #        index  index.html index.htm;<br>    #    &#125;<br>    #&#125;<br><br><br>    # HTTPS server<br>    #<br>    #server &#123;<br>    #    listen       443 ssl;<br>    #    server_name  localhost;<br><br>    #    ssl_certificate      cert.pem;<br>    #    ssl_certificate_key  cert.key;<br><br>    #    ssl_session_cache    shared:SSL:1m;<br>    #    ssl_session_timeout  5m;<br><br>    #    ssl_ciphers  HIGH:!aNULL:!MD5;<br>    #    ssl_prefer_server_ciphers  on;<br><br>    #    location / &#123;<br>    #        root   html;<br>    #        index  index.html index.htm;<br>    #    &#125;<br>    #&#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="nginx-文件结构"><a href="#nginx-文件结构" class="headerlink" title="nginx 文件结构"></a>nginx 文件结构</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">...              #全局块<br><br>events &#123;         #events块<br>   ...<br>&#125;<br><br>http      #http块<br>&#123;<br>    ...   #http全局块<br>    server        #server块<br>    &#123; <br>        ...       #server全局块<br>        location [PATTERN]   #location块<br>        &#123;<br>            ...<br>        &#125;<br>        location [PATTERN] <br>        &#123;<br>            ...<br>        &#125;<br>    &#125;<br>    server<br>    &#123;<br>      ...<br>    &#125;<br>    ...     #http全局块<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>1、<strong>全局块</strong>：配置影响<code>nginx</code>全局的指令。一般有运行<code>nginx</code>服务器的用户组，<code>nginx</code>进程<code>pid</code>存放路径，日志存放路径，配置文件引入，允许生成<code>worker process数</code>等。</li><li>2、<strong>events块</strong>：配置影响<code>nginx</code>服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。</li><li>3、<strong>http块</strong>：可以嵌套多个<code>server</code>，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，<code>mime-type</code>定义，日志自定义，是否使用<code>sendfile</code>传输文件，连接超时时间，单连接请求数等。</li><li>4、<strong>server块</strong>：配置虚拟主机的相关参数，一个<code>http</code>中可以有多个<code>server</code>。</li><li>5、<strong>location块</strong>：配置请求的路由，以及各种页面的处理情况。</li></ul><p>下面给大家上一个配置文件，作为理解。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">########## 每个指令必须有分号结束。#################</span></span><br><span class="hljs-meta">#</span><span class="bash">user administrator administrators;  <span class="hljs-comment">#配置用户或者组，默认为nobody nobody。</span></span><br><span class="hljs-meta">#</span><span class="bash">worker_processes 2;  <span class="hljs-comment">#允许生成的进程数，默认为1</span></span><br><span class="hljs-meta">#</span><span class="bash">pid /nginx/pid/nginx.pid;   <span class="hljs-comment">#指定nginx进程运行文件存放地址</span></span><br>error_log log/error.log debug;  #制定日志路径，级别。这个设置可以放入全局块，http块，server块，级别以此为：debug|info|notice|warn|error|crit|alert|emerg<br>events &#123;<br>    accept_mutex on;   #设置网路连接序列化，防止惊群现象发生，默认为on<br>    multi_accept on;  #设置一个进程是否同时接受多个网络连接，默认为off<br>    #use epoll;      #事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport<br>    worker_connections  1024;    #最大连接数，默认为512<br>&#125;<br>http &#123;<br>    include       mime.types;   #文件扩展名与文件类型映射表<br>    default_type  application/octet-stream; #默认文件类型，默认为text/plain<br>    #access_log off; #取消服务日志    <br>    log_format myFormat &#x27;$remote_addr–$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for&#x27;; #自定义格式<br>    access_log log/access.log myFormat;  #combined为日志格式的默认值<br>    sendfile on;   #允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。<br>    sendfile_max_chunk 100k;  #每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。<br>    keepalive_timeout 65;  #连接超时时间，默认为75s，可以在http，server，location块。<br><br>    upstream mysvr &#123;   <br>      server 127.0.0.1:7878;<br>      server 192.168.10.121:3333 backup;  #热备<br>    &#125;<br>    error_page 404 https://www.baidu.com; #错误页<br>    server &#123;<br>        keepalive_requests 120; #单连接请求上限次数。<br>        listen       4545;   #监听端口<br>        server_name  127.0.0.1;   #监听地址       <br>        location  ~*^.+$ &#123;       #请求的url过滤，正则匹配，~为区分大小写，~*为不区分大小写。<br>           #root path;  #根目录<br>           #index vv.txt;  #设置默认页<br>           proxy_pass  http://mysvr;  #请求转向mysvr 定义的服务器列表<br>           deny 127.0.0.1;  #拒绝的ip<br>           allow 172.18.5.54; #允许的ip           <br>        &#125; <br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>上面是nginx的基本配置，需要注意的有以下几点：</p><ul><li>1、几个常见配置项</li></ul><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">1.$remote_addr 与 $http_x_forwarded_for 用以记录客户端的ip地址；<br>2.$remote_user ：用来记录客户端用户名称；<br>3.$time_local ： 用来记录访问时间与时区；<br>4.$request ： 用来记录请求的url与http协议；<br>5.$status ： 用来记录请求状态；成功是200；<br>6.$body_bytes_s ent ：记录发送给客户端文件主体内容大小；<br>7.$http_referer ：用来记录从那个页面链接访问过来的；<br>8.$http_user_agent ：记录客户端浏览器的相关信息；<br></code></pre></div></td></tr></table></figure><ul><li><p>2、惊群现象：一个网路连接到来，多个睡眠的进程被同时叫醒，但只有一个进程能获得链接，这样会影响系统性能。</p></li><li><p>3、每个指令必须有分号结束。</p></li></ul><blockquote><p>原文地址：<a href="https://www.runoob.com/w3cnote/nginx-setup-intro.html">https://www.runoob.com/w3cnote/nginx-setup-intro.html</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Nginx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nginx</tag>
      
      <tag>负载均衡</tag>
      
      <tag>http</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python多进程基本原理</title>
    <link href="/2021/05/17/python%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/"/>
    <url>/2021/05/17/python%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="多进程的含义"><a href="#多进程的含义" class="headerlink" title="多进程的含义"></a>多进程的含义</h2><p>多进程（<code>Process</code>）是具有一定独立功能的程序关于某个数据集合上的一次运行活动，是系统进行资源分配和调度的一个独立单位。</p><p>顾名思义，多进程就是启用多个进程同时运行。由于进程是线程的集合，而且进程是由一个或多个线程构成的，所以多进程的运 行意味着有大于或等于进程数量的线程在运行。</p><h2 id="Python多进程的优势"><a href="#Python多进程的优势" class="headerlink" title="Python多进程的优势"></a>Python多进程的优势</h2><p>由于进程中<code>GIL</code>的存在，<code>Python</code>中的多线程并不能很好地发挥多核优势，一个进程中的多个线程，在同一时刻只能有一个线程运行。</p><p>对于多进程来说，每个进程都有属于自己的<code>GIL</code>，所以，在多核处理器下，多进程的运行是不会受<code>GIL</code>的影响的。因此，多进程能更好地发挥多核的优势。</p><p>当然，对于爬虫这种<code>IO</code>密集型任务来说，多线程和多进程影响差别并不大。对于计算密集型任务来说，<code>Python</code>的多进程相比多线程，其多核运行效率会有成倍的提升。</p><p>总的来说，<code>Python</code>的多进程整体来看是比多线程更有优势的。所以，在条件允许的情况下，能用多进程就尽量用多进程。</p><p>不过值得注意的是，由于进程是系统进行资源分配和调度的一个独立单位，所以各个进程之间的数据是无法共享的，如多个进程无法共享一个全局变量，进程之间的数据共享需要有单独的机制来实现到。</p><h2 id="多进程的实现"><a href="#多进程的实现" class="headerlink" title="多进程的实现"></a>多进程的实现</h2><p>在<code>Python</code>中也有内置的库来实现多进程，它就是<code>multiprocessing</code>。</p><p><code>multiprocessing</code>提供了一系列的组件，如<code>Process（进程</code>、<code>Queue（队列）</code>、<code>Semaphore（信号量）</code>、<code>Pipe（管道）</code>、<code>Lock（锁）</code>、<code>Pool（进程池）</code>等，接下来让我们来了解下它们的使用方法。</p><h3 id="直接使用Process类"><a href="#直接使用Process类" class="headerlink" title="直接使用Process类"></a>直接使用Process类</h3><p>在<code>multiprocessing</code>中，每一个进程都用一个<code>Process</code>类来表示。它的<code>API</code>调用如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Process([group [, target [, name [, args [, kwargs]]]]])<br></code></pre></div></td></tr></table></figure><ul><li><code>target</code>表示调用对象，你可以传入方法的名字。</li><li><code>args</code>表示被调用对象的位置参数元组，比如<code>target</code>是函数<code>func</code>，他有两个参数<code>m</code>，<code>n</code>，那么<code>args</code>就传入<code>[m, n]</code>即可。</li><li><code>kwargs</code>表示调用对象的字典。</li><li><code>name</code>是别名，相当于给这个进程取一个名字。</li><li><code>group</code>分组。</li></ul><p>先用一个实例来感受一下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> multiprocessing<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span>(<span class="hljs-params">index</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;process: <span class="hljs-subst">&#123;index&#125;</span>&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        p = multiprocessing.Process(target=process, args=(i,))<br>        p.start()<br></code></pre></div></td></tr></table></figure><p>这是一个实现多进程最基础的方式：通过创建<code>Process</code>来新建一个子进程，其中<code>target</code>参数传入方法名，<code>args</code>是方法的参数，是以 元组的形式传入，其和被调用的方法<code>process</code>的参数是一一对应的。</p><blockquote><p>注意：这里<code>args </code>必须要是一个元组，如果只有一个参数，那也要在元组第一个元素后面加一个逗号，如果没有逗号则和单个元素本身没有区别，无法构成元组，导致参数传递出现问题。</p></blockquote><p>创建完进程之后，我们通过调用<code>start</code>方法即可启动进程了。运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">process: <span class="hljs-number">0</span><br>process: <span class="hljs-number">1</span><br>process: <span class="hljs-number">2</span><br>process: <span class="hljs-number">3</span><br>process: <span class="hljs-number">4</span><br></code></pre></div></td></tr></table></figure><p>运行了<code>5</code>个子进程，每个进程都调用了<code>process</code>方法。<code>process</code>方法的<code>index</code>参数通过<code>Process</code>的<code>args</code>传入，分别是<code>0~4</code>这<code>5</code>个序号，最后打印出来，<code>5</code>个子进程运行结束。</p><p>由于进程是<code>Python</code>中最小的资源分配单元，因此这些进程和线程不同，各个进程之间的数据是不会共享的，每启动一个进程，都会独立分配资源。</p><p>在当前<code>CPU</code>核数足够的情况下，这些不同的进程会分配给不同的<code>CPU</code>核来运行，实现真正的并行执行。</p><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">CPU number: <span class="hljs-number">4</span><br>Child process name: Process-<span class="hljs-number">2</span> <span class="hljs-built_in">id</span>: <span class="hljs-number">12112</span><br>Child process name: Process-<span class="hljs-number">3</span> <span class="hljs-built_in">id</span>: <span class="hljs-number">14708</span><br>Child process name: Process-<span class="hljs-number">1</span> <span class="hljs-built_in">id</span>: <span class="hljs-number">11208</span><br>Child process name: Process-<span class="hljs-number">5</span> <span class="hljs-built_in">id</span>: <span class="hljs-number">9968</span><br>Child process name: Process-<span class="hljs-number">4</span> <span class="hljs-built_in">id</span>: <span class="hljs-number">11784</span><br>Process ended<br>process: <span class="hljs-number">0</span><br>process: <span class="hljs-number">1</span><br>process: <span class="hljs-number">2</span><br>process: <span class="hljs-number">3</span><br>process: <span class="hljs-number">4</span><br></code></pre></div></td></tr></table></figure><p>通过<code>cpu_count</code>成功获取了<code>CPU</code>核心的数量：<code>4</code>个，不同的机器结果可能不同。通过 <code>active_children</code>获取到了当前正在活跃运行的进程列表。然后遍历每个进程，并将它们的<em>名称</em>和<em>进程号</em>打印出来了，这里进程号直接使用<code>pid</code>属性即可获取，进程名称直接通过<code>name</code>属性即可获取。</p><h2 id="继承继Process类"><a href="#继承继Process类" class="headerlink" title="继承继Process类"></a>继承继Process类</h2><p>在上面的例子中，创建进程是直接使用<code>Process</code>这个类来创建的，这是一种创建进程的方式。不过，创建进程的方式不止这一 种，同样，也可以像线程<code>Thread</code>一样来通过继承的方式创建一个进程类，进程的基本操作我们在子类的<code>run</code>方法中实现即可。</p><p>通过一个实例来看一下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyProcess</span>(<span class="hljs-params">Process</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, loop</span>):</span><br>        Process.__init__(self)<br>        self.loop = loop<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">for</span> count <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.loop):<br>            time.sleep(<span class="hljs-number">1</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Pid: <span class="hljs-subst">&#123;self.pid&#125;</span> LoopCount: <span class="hljs-subst">&#123;count&#125;</span>&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,<span class="hljs-number">5</span>):<br>        p = MyProcess(i)<br>        p.start()<br></code></pre></div></td></tr></table></figure><p>声明了一个构造方法，这个方法接收一个<code>loop</code>参数，代表循环次数，并将其设置为全局变量。在<code>run</code>方法中，又使用这个<code>loop</code>变量循环了<code>loop</code>次并打印了当前的进程号和循环次数。</p><p>在调用时，用<code>range</code>方法得到了<code>2、3、4</code>三个数字，并把它们分别初始化了<code>MyProcess</code>进程，然后调用<code>start</code>方法将进程启动起来。</p><blockquote><p>注意：这里进程的执行逻辑需要在<code>run</code>方法中实现，启动进程需要调用<code>start</code>方法，调用之后<code>run</code>方法便会执行。</p></blockquote><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Pid: <span class="hljs-number">13728</span> LoopCount: <span class="hljs-number">0</span><br>Pid: <span class="hljs-number">13560</span> LoopCount: <span class="hljs-number">0</span><br>Pid: <span class="hljs-number">9908</span> LoopCount: <span class="hljs-number">0</span> <br>Pid: <span class="hljs-number">9908</span> LoopCount: <span class="hljs-number">1</span><br>Pid: <span class="hljs-number">13560</span> LoopCount: <span class="hljs-number">1</span><br>Pid: <span class="hljs-number">13728</span> LoopCount: <span class="hljs-number">1</span><br>Pid: <span class="hljs-number">13728</span> LoopCount: <span class="hljs-number">2</span><br>Pid: <span class="hljs-number">9908</span> LoopCount: <span class="hljs-number">2</span><br>Pid: <span class="hljs-number">13728</span> LoopCount: <span class="hljs-number">3</span><br></code></pre></div></td></tr></table></figure><p>三个进程分别打印出了<code>2、3、4</code>条结果，即进程<code>13560</code>打印了<code>2</code>次结果，进程<code>9908</code> 打印了<code>3</code>次结果，进程<code>13728</code>打印了<code>4</code>次结果。</p><blockquote><p>注意，这里的进程<code>pid</code>代表进程号，不同机器、不同时刻运行结果可能不同。 </p></blockquote><p>通过上面的方式，非常方便地实现了一个进程的定义。为了复用方便，可以把一些方法写在每个进程类里封装好，在使用时直接初始化一个进程类运行即可。</p><h2 id="守护进程"><a href="#守护进程" class="headerlink" title="守护进程"></a>守护进程</h2><p>在多进程中，同样存在守护进程的概念，如果一个进程被设置为守护进程，当父进程结束后，子进程会自动被终止，我们可以通过设置<code>daemon</code>属性来控制是否为守护进程。</p><p>还是原来的例子，增加了<code>deamon</code>属性的设置：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyProcess</span>(<span class="hljs-params">Process</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, loop</span>):</span><br>        Process.__init__(self)<br>        self.loop = loop<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">for</span> count <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.loop):<br>            time.sleep(<span class="hljs-number">1</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Pid: <span class="hljs-subst">&#123;self.pid&#125;</span> LoopCount: <span class="hljs-subst">&#123;count&#125;</span>&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,<span class="hljs-number">5</span>):<br>        p = MyProcess(i)<br>        p.daemon = <span class="hljs-literal">True</span><br>        p.start()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Main process is ended.&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Main process <span class="hljs-keyword">is</span> ended.<br></code></pre></div></td></tr></table></figure><p>结果很简单，因为主进程没有做任何事情，直接输出一句话结束，所以在这时也直接终止了子进程的运行。</p><p>这样可以有效防止无控制地生成子进程。这样的写法可以让我们在主进程运行结束后无需额外担心子进程是否关闭，避免了独立子进程的运行。</p><h2 id="进程等待"><a href="#进程等待" class="headerlink" title="进程等待"></a>进程等待</h2><p>上面的运行效果其实不太符合我们预期：主进程运行结束时，子进程（守护进程）也都退出了，子进程什么都没来得及执行。</p><p>能不能让所有子进程都执行完了然后再结束呢？当然是可以的，只需要加入<code>join</code>方法即可，可以将代码改写如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">process = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,<span class="hljs-number">5</span>):<br>    p = MyProcess(i)<br>    process.append(p)<br>    p.daemon = <span class="hljs-literal">True</span><br>    p.start()<br><span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> process:<br>    p.join()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Main process is ended.&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Pid: <span class="hljs-number">13220</span> LoopCount: <span class="hljs-number">0</span><br>Pid: <span class="hljs-number">10488</span> LoopCount: <span class="hljs-number">0</span><br>Pid: <span class="hljs-number">4652</span> LoopCount: <span class="hljs-number">0</span><br>Pid: <span class="hljs-number">13220</span> LoopCount: <span class="hljs-number">1</span><br>Pid: <span class="hljs-number">10488</span> LoopCount: <span class="hljs-number">1</span><br>Pid: <span class="hljs-number">4652</span> LoopCount: <span class="hljs-number">1</span><br>Pid: <span class="hljs-number">10488</span> LoopCount: <span class="hljs-number">2</span><br>Pid: <span class="hljs-number">4652</span> LoopCount: <span class="hljs-number">2</span><br>Pid: <span class="hljs-number">4652</span> LoopCount: <span class="hljs-number">3</span><br>Main process <span class="hljs-keyword">is</span> ended.<br></code></pre></div></td></tr></table></figure><p>在调用<code>start</code>和<code>join</code>方法后，父进程就可以等待所有子进程都执行完毕后，再打印出结束的结果。</p><p>默认情况下，<code>join</code>是无限期的。也就是说，如果有子进程没有运行完毕，主进程会一直等待。这种情况下，如果子进程出现问题陷入了死循环，主进程也会无限等待下去。怎么解决这个问题呢？可以给<code>join</code>方法传递一个超时参数，代表最长等待秒数。如果子进程没有在这个指定秒数之内完成，会被强制返回，主进程不再会等待。也就是说这个参数设置了主进程等待该子进程的最长时间。</p><p>例如这里传入<code>1</code>，代表最长等待<code>1</code>秒，代码改写如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">process = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,<span class="hljs-number">5</span>):<br>    p = MyProcess(i)<br>    process.append(p)<br>    p.daemon = <span class="hljs-literal">True</span><br>    p.start()<br><span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> process:<br>    p.join(<span class="hljs-number">1</span>)<br></code></pre></div></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Pid: <span class="hljs-number">11936</span> LoopCount: <span class="hljs-number">0</span><br>Pid: <span class="hljs-number">968</span> LoopCount: <span class="hljs-number">0</span><br>Pid: <span class="hljs-number">11572</span> LoopCount: <span class="hljs-number">0</span><br>Pid: <span class="hljs-number">11936</span> LoopCount: <span class="hljs-number">1</span><br>Pid: <span class="hljs-number">968</span> LoopCount: <span class="hljs-number">1</span><br>Pid: <span class="hljs-number">11572</span> LoopCount: <span class="hljs-number">1</span><br>Main process <span class="hljs-keyword">is</span> ended.<br></code></pre></div></td></tr></table></figure><p>可以看到，有的子进程本来要运行<code>3</code>秒，结果运行<code>1</code>秒就被强制返回了，由于是守护进程，该子进程被终止了。</p><h2 id="终止进程"><a href="#终止进程" class="headerlink" title="终止进程"></a>终止进程</h2><p>终止进程不止有守护进程这一种做法，我们也可以通过<code>terminate</code>方法来终止某个子进程，另外我们还可以通过<code>is_alive</code>方法判断进程是否还在运行。</p><p>下面看一个实例：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> multiprocessing<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process</span>():</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Starting&#x27;</span>)<br>    time.sleep(<span class="hljs-number">5</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Finished&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    p = multiprocessing.Process(target=process)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Before:&#x27;</span>, p, p.is_alive())<br>    <br>    p.start()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;During:&#x27;</span>, p, p.is_alive())<br><br>    p.terminate()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Terminate:&#x27;</span>, p, p.is_alive())<br><br>    p.join()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Joined:&#x27;</span>, p, p.is_alive())<br></code></pre></div></td></tr></table></figure><p>用<code>Process</code>创建了一个进程，接着调用<code>start</code>方法启动这个进程，然后调用<code>terminate</code>方法将进程终止，最后调用<code>join</code>方法。</p><p>另外，在进程运行不同的阶段，通过<code>is_alive</code>方法判断当前进程是否还在运行。</p><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Before: &lt;Process(Process-<span class="hljs-number">1</span>, initial)&gt; <span class="hljs-literal">False</span><br>During: &lt;Process(Process-<span class="hljs-number">1</span>, started)&gt; <span class="hljs-literal">True</span><br>Terminate: &lt;Process(Process-<span class="hljs-number">1</span>, started)&gt; <span class="hljs-literal">True</span>       <br>Joined: &lt;Process(Process-<span class="hljs-number">1</span>, stopped[SIGTERM])&gt; <span class="hljs-literal">False</span><br></code></pre></div></td></tr></table></figure><p>这里有一个值得注意的地方，在调用<code>terminate</code>方法之后，我们用<code>is_alive</code>方法获取进程的状态发现依然还是运行状态。在调用<code>join</code>方法之后，<code>is_alive</code>方法获取进程的运行状态才变为终止状态。</p><p>所以，在调用<code>terminate</code>方法之后，记得要调用一下<code>join</code>方法，这里调用<code>join</code>方法可以为进程提供时间来更新对象状态，用来反映出最终的进程终止效果。</p><h2 id="进程互斥锁"><a href="#进程互斥锁" class="headerlink" title="进程互斥锁"></a>进程互斥锁</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process, Lock<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyProcess</span>(<span class="hljs-params">Process</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, loop, lock</span>):</span><br>        Process.__init__(self)<br>        self.loop = loop<br>        self.lock = lock<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">for</span> count <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.loop):<br>            time.sleep(<span class="hljs-number">0.1</span>)<br>            self.lock.acquire()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Pid: <span class="hljs-subst">&#123;self.pid&#125;</span> LoopCount: <span class="hljs-subst">&#123;count&#125;</span>&#x27;</span>)<br>            self.lock.release()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    lock = Lock()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>, <span class="hljs-number">15</span>):<br>        p = MyProcess(i, lock)<br>        p.start()<br></code></pre></div></td></tr></table></figure><p>在访问一些临界区资源时，使用<code>Lock</code>可以有效避免进程同时占用资源而导致的一些问题。</p><h2 id="信号量"><a href="#信号量" class="headerlink" title="信号量"></a>信号量</h2><p>｀multiprocessing<code>库中的</code>Semaphore`来实现信号量，实现多个进程共享资源，同时限制可访问的进程数量。</p><h2 id="道管"><a href="#道管" class="headerlink" title="道管"></a>道管</h2><p>管道（<code>Pipe</code>）用来实现进程之间的通讯，管道可以是单向的，即<code>half-duplex</code>：一个进程负责发消息，另一个进程负责收消息；也可以是双向的<code>duplex</code>，即互相收发消息。 默认声明<code>Pipe</code>对象是双向管道，如果要创建单向管道，可以在初始化的时候传入<code>deplex</code>参数为<code>False</code>。</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process, Pipe<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Consumer</span>(<span class="hljs-params">Process</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, pipe</span>):</span><br>        Process.__init__(self)<br>        self.pipe = pipe<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span><br>        self.pipe.send(<span class="hljs-string">&#x27;Cosumer Worlds&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Consumer Received: <span class="hljs-subst">&#123;self.pipe.recv()&#125;</span>&#x27;</span>)<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Producer</span>(<span class="hljs-params">Process</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, pipe</span>):</span><br>        Process.__init__(self)<br>        self.pipe = pipe<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Producer Received: <span class="hljs-subst">&#123;self.pipe.recv()&#125;</span>&#x27;</span>)<br>        self.pipe.send(<span class="hljs-string">&#x27;Producer Words&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    pipe = Pipe()<br>    p = Producer(pipe[<span class="hljs-number">0</span>])<br>    c = Consumer(pipe[<span class="hljs-number">1</span>])<br>    p.daemon = c.daemon = <span class="hljs-literal">True</span><br>    p.start()<br>    c.start()<br>    p.join()<br>    c.join()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Main Process Ended&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>声明了一个默认为双向的管道，然后将管道的两端分别传给两个进程。两个进程互相收发。观察一下结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Producer Received: Cosumer Worlds<br>Consumer Received: Producer Words<br>Main Process Ended<br></code></pre></div></td></tr></table></figure><p><strong>管道</strong><code>Pipe</code>就像进程之间搭建的桥梁，利用它可以很方便地实现进程间通信。</p><h2 id="进程池"><a href="#进程池" class="headerlink" title="进程池"></a>进程池</h2><blockquote><p>假如现在我们遇到这么一个问题，我有<code>10000</code>个任务，每个任务需要启动一个进程来执行，并且一个进程运行完毕之后要紧接着 启动下一个进程，同时我还需要控制进程的并发数量，不能并发太高，不然<code>CPU</code>处理不过来（如果同时运行的进程能维持在一个 最高恒定值当然利用率是最高的）。</p></blockquote><p>那么我们该如何来实现这个需求呢？</p><p>用<code>Process</code>和<code>Semaphore</code>可以实现，但是实现起来比较烦琐。这种需求在平时又是非常常见的。此时，我们就可以派上进程池了，即<code>multiprocessing</code>中的<code>Pool</code>。 <code>Pool</code>可以提供指定数量的进程，供用户调用，当有新的请求提交到<code>pool</code>中时，如果池还没有满，就会创建一个新的进程用来执行该请求；但如果池中的进程数已经达到规定最大值，那么该请求就会等待，直到池中有进程结束，才会创建新的进程来执行它。</p><p>用一个实例来实现一下，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Pool<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">function</span>(<span class="hljs-params">index</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Start process: <span class="hljs-subst">&#123;index&#125;</span>&#x27;</span>)<br>    time.sleep(<span class="hljs-number">3</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;End process <span class="hljs-subst">&#123;index&#125;</span>&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    pool = Pool(processes=<span class="hljs-number">3</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        pool.apply_async(function, args=(i,))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Main Process started&#x27;</span>)<br>    pool.close()<br>    pool.join()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Main process ended&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>声明了一个大小为<code>3</code>的进程池，通过<code>processes</code>参数来指定，如果不指定，那么会自动根据处理器内核来分配进程数。接着我们使用<code>apply_async</code>方法将进程添加进去，<code>args</code>可以用来传递参数。</p><p>运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Main Process started<br>Start process: <span class="hljs-number">0</span><br>Start process: <span class="hljs-number">1</span><br>Start process: <span class="hljs-number">2</span><br>End process <span class="hljs-number">0</span><br>Start process: <span class="hljs-number">3</span><br>End process <span class="hljs-number">1</span><br>End process <span class="hljs-number">2</span><br>End process <span class="hljs-number">3</span><br>Main process ended<br></code></pre></div></td></tr></table></figure><p>进程池大小为<code>3</code>，可以看到有<code>3</code>个进程同时执行，第4个进程在等待，在有进程运行完毕之后，第4个进程马上跟着运行，出现了如上的运行效果。</p><p>最后，我们要记得调用<code>close</code>方法来关闭进程池，使其不再接受新的任务，然后调用<code>join</code>方法让主进程等待子进程的退出，等子进程运行完毕之后，主进程接着运行并结束。</p><p>上面的写法多少有些烦琐，使用你进程池的<code>map</code>方法，可以将上述写法简化很多。</p><p><code>map</code>方法是怎么用的呢？第一个参数就是要启动的进程对应的执行方法，第<code>2</code>个参数是一个可迭代对象，其中的每个元素会被传递给这个执行方法。</p><p>举个例子：现在有一个<code>list</code>，里面包含了很多<code>URL</code>，定义了一个方法用来抓取每个<code>URL</code>内容并解析，那么可以直接在<code>map</code>的第一个参数传入方法名，第<code>2</code>个参数传入<code>URL</code>数组。</p><p>用一个实例来感受一下：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Pool<br><span class="hljs-keyword">import</span> urllib.request<br><span class="hljs-keyword">import</span> urllib.error<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">scrape</span>(<span class="hljs-params">url</span>):</span><br>    <span class="hljs-keyword">try</span>:<br>        urllib.request.urlopen(url)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;URL <span class="hljs-subst">&#123;url&#125;</span> scraped&#x27;</span>)<br>    <span class="hljs-keyword">except</span> (urllib.error.HTTPError, urllib.error.URLError):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;URL <span class="hljs-subst">&#123;url&#125;</span> not scraped&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    pool = Pool(processes=<span class="hljs-number">3</span>)<br>    urls = [<br>        <span class="hljs-string">&#x27;https://www.baidu.com&#x27;</span>,<br>        <span class="hljs-string">&#x27;https://www.meituan.com&#x27;</span>,<br>        <span class="hljs-string">&#x27;https://blog.csdn.net&#x27;</span>,<br>        <span class="hljs-string">&#x27;https://xxxyxxx.net&#x27;</span>,<br>    ]<br>    pool.<span class="hljs-built_in">map</span>(scrape, urls)<br>    pool.close()<br></code></pre></div></td></tr></table></figure><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">URL https://www.baidu.com scraped<br>URL https://xxxyxxx.net <span class="hljs-keyword">not</span> scraped<br>URL https://blog.csdn.net scraped<br>URL https://www.meituan.com scraped<br></code></pre></div></td></tr></table></figure><p>这样，就可以实现<code>3</code>个进程并行运行。不同的进程相互独立地输出了对应的爬取结果。</p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>multiprocessing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Session和Cookies</title>
    <link href="/2021/05/12/Session%E5%92%8CCookies/"/>
    <url>/2021/05/12/Session%E5%92%8CCookies/</url>
    
    <content type="html"><![CDATA[<h2 id="静态网页和动态网页"><a href="#静态网页和动态网页" class="headerlink" title="静态网页和动态网页"></a>静态网页和动态网页</h2><p>示例代码：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>This is a Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span> <br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;wrapper&quot;</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>Hello World<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text&quot;</span>&gt;</span>Hello, this is a paragraph.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>这是最基本的HTML代码，保存为一个<code>.html</code>文件，然后把它放在某台具有固定公网<code>IP</code>的主机上，主机上装上<code>Apache</code>或<code>Nginx</code>等服务器，这样这台主机就可以作为服务器了，其他人便可以通过访问服务器看到这个页面，这就搭建了一个最简单的网站。</p><p>这种网页的内容是HTML代码编写的，文字、图片等内容均通过写好的HTML代码来指定，这种页面叫作静态网页。它加载速度快，编写简单，但是存在很大的缺陷，如可维护性差，不能根据<code>URL</code>灵活多变地显示内容等。例如，想要给这个网页的<code>URL</code>传入一个<code>name</code>参数，让其在网页中显示出来，是无法做到的。</p><p>因此，动态网页应运而生，它可以动态解析<code>URL</code>中参数的变化，关联数据库并动态呈现不同的页面内容，非常灵活多变。现在遇到的大多数网站都是动态网站，它们不再是一个简单的<code>HTML</code>，而是可能由<code>JSP</code>、<code>PHP</code>、<code>Python</code>等语言编写的，其功能比静态网页强大和丰富太多了。</p><p>此外，动态网站还可以实现用户登录和注册的功能。按照一般的逻辑来说，输入用户名和密码登录之后，肯定是拿到了一种类似凭证的东西，有了它，才能保持登录状态，才能访问登录之后才能看到的页面。</p><p>那么，这种神秘的凭证到底是什么呢？其实它就是 Session和Cookies 共同产生的结果。</p><h2 id="无状态HTTP"><a href="#无状态HTTP" class="headerlink" title="无状态HTTP"></a>无状态HTTP</h2><p>在了解<code>Session</code>和<code>Cookies</code>之前，还需要了解<code>HTTP</code>的一个特点，叫作无状态。</p><p><code>HTTP</code>的无状态是指<code>HTTP</code>协议对事务处理是没有记忆能力的，也就是说服务器不知道客户端是什么状态。</p><p>当向服务器发送请求后，服务器解析此请求，然后返回对应的响应，服务器负责完成这个过程，而且这个过程是完全独立的，服务器不会记录前后状态的变化，也就是缺少状态记录。</p><p>这意味着如果后续需要处理前面的信息，则必须重传，这也导致需要额外传递一些前面的重复请求，才能获取后续响应，这种效果显然不是想要的。为了保持前后状态，肯定不能将前面的请求全 部重传一次，这太浪费资源了，对于这种需要用户登录的页面来说，更是棘手。</p><p>这时两个用于保持<code>HTTP</code>连接状态的技术就出现了，它们分别是<code>Session</code>和<code>Cookies</code>。<code>Session</code>在服务端，也就是网站的服务器，用来保存用户的<code>Session信息</code>；<code>Cookies</code>在客户端，也可以理解为<strong>浏览器端</strong>，有了<code>Cookies</code>，浏览器在下次访问网页时会自动附带上它发送给服务器，服务器通过识别<code>Cookies</code>并鉴定出是哪个用户，然后再判断用户是否是登录状态，进而返回对应的响应。</p><p>可以理解为<code>Cookies</code>里面保存了登录的凭证，有了它，只需要在下次请求携带<code>Cookies</code>发送请求而不必重新输入用户名、密码等信息重新登录了。</p><p>因此在爬虫中，有时候处理需要登录才能访问的页面时，一般会直接将登录成功后获取的<code>Cookies</code>放在请求头里面直接请求，而不必重新模拟登录。</p><h2 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h2><p><code>Cookies</code>指某些网站为了辨别用户身份、进行<code>Session</code>跟踪而存储在用户本地终端上的数据。</p><h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p><code>Session</code>，中文称之为<strong>会话</strong>，其本身的含义是指有始有终的一系列动作/消息。比如，打电话时，从拿起电话拨号到挂断电话这中间的一系列过程可以称为一个 <code>Session</code>。</p><p>而在<code>Web</code>中，<code>Session对象</code>用来存储特定用户<code>Session</code>所需的属性及配置信息。这样，当用户在应用程序的<code>Web</code>页之间跳转时，存储在<code>Session</code>对象中的变量将不会丢失，而是在整个用户<code>Session</code>中一直存在下去。当用户请求来自应用程序的<code>Web</code>页时，如果该用户还没有<code>Session</code>，则<code>Web</code>服务器将自动创建一个 <code>Session</code>对象。当<code>Session</code>过期或被放弃后，服务器将终止该<code>Session</code>。</p><h2 id="Session维持"><a href="#Session维持" class="headerlink" title="Session维持"></a>Session维持</h2><p>那么，怎样利用<code>Cookies</code>保持状态呢？当客户端第一次请求服务器时，服务器会返回一个响应头中带有<code>Set-Cookie</code>字段的响应给客户端，用来标记是哪一个用户，客户端浏览器会把<code>Cookies</code>保存起来。当浏览器下一次再请求该网站时，浏览器会把此<code>Cookies</code>放到请求头一起提交给服务器，<code>Cookies</code>携带了<code>SessionID</code> 信息，服务器检查该<code>Cookies</code>即可找到对应的<code>Session</code>是什么，然后再判断<code>Session</code>来以此来辨认用户状态。</p><p>在成功登录某个网站时，服务器会告诉客户端设置哪些<code>Cookies</code>信息，在后续访问页面时客户端会把<code>Cookies</code>发送给服务器，服务器再找到对应的<code>Session</code>加以判断。如果<code>Session</code>中的某些设置登录状态的变量是有效的，那就证明用户处于登录状态，此时返回登录之后才可以查看的网页内容，浏览器再进行解析便可以看到了。</p><p>反之，如果传给服务器的<code>Cookies</code>是无效的，或者<code>Session</code>已经过期了，将不能继续访问页面，此时可能会收到错误的响应或者跳转到登录页面重新登录。 所以，<code>Cookies</code>和<code>Session</code>需要配合，一个处于客户端，一个处于服务端，二者共同协作，就实现了登录<code>Session</code>控制。</p><h2 id="Cookies属性结构"><a href="#Cookies属性结构" class="headerlink" title="Cookies属性结构"></a>Cookies属性结构</h2><p><code>Cookie</code>有如下几个属性。</p><ul><li><code>Name</code>，即该<code>Cookie</code>的名称。</li><li><code>Cookie</code>一旦创建，名称便不可更改。</li><li><code>Value</code>，即该<code>Cookie</code>的值。如果值为<code>Unicode</code>字符，需要为字符编码。如果值为二进制数据，则需要使用<code>BASE64</code>编码。</li><li><code>MaxAge</code>，即该<code>Cookie</code>失效的时间，单位秒，也常和<code>Expires</code>一起使用，通过它可以计算出其有效时间。</li><li><code>MaxAge</code> 如果为正数，则该<code>Cookie</code>在<code>MaxAge</code>秒之后失效。如果为负数，则关闭浏览器时<code>Cookie</code>即失效，浏览器也不会以任何形式保存该<code>Cookie</code>。</li><li><code>Path</code>，即该<code>Cookie</code>的使用路径。如果设置为<code>/path/</code>，则只有路径为<code>/path/</code>的页面可以访问该<code>Cookie</code>。如果设置为<code>/</code>，则本域名下的所有页面都可以访问该<code>Cookie</code>。</li><li><code>Domain</code>，即可以访问该<code>Cookie</code>的域名。例如如果设置为<code>.zhihu.com</code>，则所有以<code>zhihu.com</code>，结尾的域名都可以访问该<code>Cookie</code>。</li><li><code>Size</code>字段，即此<code>Cookie</code>的大小。</li><li><code>Http</code>字段，即<code>Cookie</code>的<code>httponly</code>属性。若此属性为<code>true</code>，则只有在<code>HTTP Headers</code>中会带有此<code>Cookie</code>的信息，而不能通过<code>document.cookie</code>来访问此<code>Cookie</code>。</li><li><code>Secure</code>，即该<code>Cookie</code>是否仅被使用安全协议传输。安全协议。安全协议有<code>HTTPS、SSL</code>等，在网络上传输数据之前先将数据加密。默认为<code>false</code>。</li></ul><h2 id="会话会Cookie和持久和Cookie"><a href="#会话会Cookie和持久和Cookie" class="headerlink" title="会话会Cookie和持久和Cookie"></a>会话会<code>Cookie</code>和持久和<code>Cookie</code></h2><p>从表面意思来说，会话<code>Cookie</code>就是把<code>Cookie</code>放在浏览器内存里，浏览器在关闭之后该<code>Cookie</code>即失效；持久<code>Cookie</code>则会保存到客户端的硬盘中，下次还可以继续使用，用于长久保持用户登录状态。</p><p>严格来说，没有会话<code>Cookie</code>和持久<code>Cookie</code>之分，只是由<code>Cookie</code>的<code>MaxAge</code>或<code>Expires</code>字段决定了过期的时间。 因此，一些持久化登录的网站其实就是把<code>Cookie</code>的有效时间和<code>Session</code>有效期设置得比较长，下次再访问页面时仍然携带之前的<code>Cookie</code>，就可以直接保持登录状态。</p><h2 id="常见误区"><a href="#常见误区" class="headerlink" title="常见误区"></a>常见误区</h2><p>在谈论<code>Session</code>机制的时候，常常听到这样一种误解 ——“只要关闭浏览器，<code>Session</code>就消失了”。可以想象一下会员卡的例子，除非顾客主动对店家提出销卡，否则店家绝对不会轻易删除顾客的资料。对<code>Session</code>来说，也是一样，除非程序通知服务器删除一个<code>Session</code>，否则服务器会一直保留。比如，程序一般都是在做注销操作时才去删除<code>Session</code>。</p><p>但是当关闭浏览器时，浏览器不会主动在关闭之前通知服务器它将要关闭，所以服务器根本不会有机会知道浏览器已经关闭。之所以会有这种错觉，是因为大部分网站都使用会话<code>Cookie</code>来保存<code>Session ID</code>信息，而关闭浏览器后<code>Cookies</code>就消失了，再次连接服务器时，也就无法找到原来的<code>Session</code>了。如果服务器设置的<code>Cookies</code>保存到硬盘上，或者使用某种手段改写浏览器发出的<code>HTTP</code>请求头，把原来的<code>Cookies</code>发送给服务器，则再次打开浏览器，仍然能够找到原来的<code>Session ID</code>，依旧还是可以保持登录状态的。</p><p>而且恰恰是由于关闭浏览器不会导致<code>Session</code>被删除，这就需要服务器为<code>Session</code>设置一个失效时间，当距离客户端上一次使用<code>Session</code>的时间超过这个失效时间时，服务器就可以认为客户端已经停止了活动，才会把<code>Session</code>删除以节省存储空间。</p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>http</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>爬虫的基本原理</title>
    <link href="/2021/05/12/%E7%88%AC%E8%99%AB%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/"/>
    <url>/2021/05/12/%E7%88%AC%E8%99%AB%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p>我们可以把互联网比作一张大网，而爬虫（即网络爬虫）便是在网上爬行的蜘蛛。如果把网的节点比作一个个网页，爬虫爬到这就相当于访问了该页面，获取了其信息。可以把节点间的连线比作网页与网页之间的链接关系，这样蜘蛛通过一个节点后，可以顺着节点连线继续爬行到达下一个节点，即通过一个网页继续获取后续的网页，这样整个网的节点便可以被蜘蛛全部爬行到，网站的数据就可以被抓取下来了。</p><h2 id="爬虫概述"><a href="#爬虫概述" class="headerlink" title="爬虫概述"></a>爬虫概述</h2><p>简单来说，爬虫就是获取网页并提取和保存信息的自动化程序，概要介绍一下。</p><h3 id="获取网页"><a href="#获取网页" class="headerlink" title="获取网页"></a>获取网页</h3><p>获爬虫首先要做的工作就是获取网页，这里就是获取网页的源代码。</p><p>源代码里包含了网页的部分有用信息，所以只要把源代码获取下来，就可以从中提取想要的信息了。</p><p>前面讲了请求和响应的概念，向网站的服务器发送一个请求，返回的响应体便是网页源代码。所以，最关键的部分就是构造一个 请求并发送给服务器，然后接收到响应并将其解析出来，那么这个流程怎样实现呢？</p><p><code>Python</code>提供了许多库来帮助我们实现这个操作，如<code>urllib</code>、<code>requests</code>等。可以用这些库来帮助我们实现<code>HTTP</code>请求操作，请求和响应都可以用类库提供的数据结构来表示，得到响应之后只需要解析数据结构中的<code>Body</code>部分，即得到网页的源代码，这样我们可以用程序来实现获取网页的过程了。 </p><h3 id="提取信息"><a href="#提取信息" class="headerlink" title="提取信息"></a>提取信息</h3><p>提获取网页源代码后，接下来就是分析网页源代码，从中提取我们想要的数据。首先，最通用的方法便是采用<code>正则表达式</code>提取，这是一个万能的方法，但是在构造正则表达式时比较复杂且容易出错。</p><p>另外，由于网页的结构有一定的规则，所以还有一些根据网页节点属性、CSS选择器或<code>XPath</code>来提取网页信息的库，如<code>Beautiful Soup</code>、<code>pyquery</code>、<code>lxml</code>等。使用这些库，我们可以高效快速地从中提取网页信息，如节点的属性、文本值等。</p><p>提取信息是爬虫非常重要的部分，它可以使杂乱的数据变得条理清晰，以便我们后续处理和分析数据。</p><h3 id="保存数据"><a href="#保存数据" class="headerlink" title="保存数据"></a>保存数据</h3><p>提取信息后，我们一般会将提取到的数据保存到某处以便后续使用。这里保存形式有多种多样，如可以简单保存为<code>TXT文本</code>或<code>JSON文本</code>，也可以保存到数据库，如<code>MySQL</code>和<code>MongoDB</code>等，还可保存至远程服务器，如借助<code>SFTP</code>进行操作等。</p><h3 id="自动化程序"><a href="#自动化程序" class="headerlink" title="自动化程序"></a>自动化程序</h3><p>自动化程序，意思是说爬虫可以代替人来完成这些操作。首先，我们手工当然可以提取这些信息，但是当量特别大或者想快速获取大量数据的话，肯定还是要借助程序。爬虫就是代替我们来完成这份爬取工作的自动化程序，它可以在抓取过程中进行各 种异常处理、错误重试等操作，确保爬取持续高效地运行。</p><h3 id="能抓怎样的数据"><a href="#能抓怎样的数据" class="headerlink" title="能抓怎样的数据"></a>能抓怎样的数据</h3><p>能在网页中我们能看到各种各样的信息，最常见的便是常规网页，它们对应着 HTML代码，而最常抓取的便是<code>HTML源代码</code>。</p><p>另外，可能有些网页返回的不是<code>HTML代码</code>，而是一个<code>JSON字符串</code>（其中<code>API</code>接口大多采用这样的形式），这种格式的数据方便传输和解析，它们同样可以抓取，而且数据提取更加方便。</p><p>此外，我们还可以看到各种二进制数据，如图片、视频和音频等。利用爬虫，我们可以将这些二进制数据抓取下来，然后保存成对应的文件名。</p><p>另外，还可以看到各种扩展名的文件，如<code>CSS</code>、<code>JavaScript</code>和配置文件等，这些其实也是最普通的文件，只要在浏览器里面可以访问到，就可以将其抓取下来。</p><p>上述内容其实都对应各自的<code>URL</code>，是基于<code>HTTP</code>或<code>HTTPS</code>协议的，只要是这种数据，爬虫都可以抓取。</p><h3 id="JavaScript渲染页面"><a href="#JavaScript渲染页面" class="headerlink" title="JavaScript渲染页面"></a>JavaScript渲染页面</h3><p>有时候，在用<code>urllib</code>或<code>requests</code>抓取网页时，得到的源代码实际和浏览器中看到的不一样。</p><p>这是一个非常常见的问题。现在网页越来越多地采用<code>Ajax</code>、<code>前端模块化工具</code>来构建，整个网页可能都是由<code>JavaScript</code>渲染出来的，也就是说原始的<code>HTML代码</code>就是一个空壳，例如：</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>This is a Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span> <br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> <br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;app.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span> <br></code></pre></div></td></tr></table></figure><p><code>body</code>节点里面只有一个<code>id</code>为<code>container</code>的节点，但是需要注意在<code>body</code>节点后引入了<code>app.js</code>，它便负责整个网站的渲染。</p><p>在浏览器中打开这个页面时，首先会加载这个<code>HTML</code>内容，接着浏览器会发现其中引入了一个<code>app.js</code>文件，然后便会接着去请求这个文件，获取到该文件后，便会执行其中的<code>JavaScript</code>代码，而<code>JavaScript</code>则会改变<code>HTML</code>中的节点，向其添加内容，最后得到完整的页面。</p><p>但是在用<code>urllib</code>或<code>requests</code>等库请求当前页面时，我们得到的只是这个<code>HTML代码</code>，它不会帮助我们去继续加载这个<code>JavaScript</code>文件，这样也就看不到浏览器中的内容。</p><p>这也解释了为什么有时我们得到的源代码和浏览器中看到的不一样。</p><p>因此，使用基本<code>HTTP</code>请求库得到的源代码可能跟浏览器中的页面源代码不太一样。对于这样的情况，可以分析其后台<code>Ajax</code>接口，也可使用<code>Selenium</code>、<code>Splash</code>这样的库来实现模拟<code>JavaScript</code>渲染。</p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>http</tag>
      
      <tag>爬虫</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>web网页基础</title>
    <link href="/2021/05/11/web%E7%BD%91%E9%A1%B5%E5%9F%BA%E7%A1%80/"/>
    <url>/2021/05/11/web%E7%BD%91%E9%A1%B5%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="网页的组成"><a href="#网页的组成" class="headerlink" title="网页的组成"></a>网页的组成</h1><p>首先，我们来了解网页的基本组成，网页可以分为三大部分：<code>HTML</code>、<code>CSS</code>和<code>JavaScript</code>。 如果把网页比作一个人的话，<code>HTML</code>相当于骨架，<code>JavaScript</code>相当于肌肉，<code>CSS</code>相当于皮肤，三者结合起来才能形成一个完整的网页。下面我们来分别介绍一下这三部分的功能。</p><h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><p><code>HTML</code>是用来描述网页的一种语言，其全称叫作<code>Hyper Text Markup Language</code>，即超文本标记语言。</p><p>我们浏览的网页包括文字、按钮、图片和视频等各种复杂的元素，其基础架构就是<code>HTML</code>。不同类型的元素通过不同类型的标签来表示，如图片用<code>img</code>标签表示，视频用<code>video</code>标签表示，段落用<code>p</code>标签表示，它们之间的布局又常通过布局标签<code>div</code>嵌套组合而成，各种标签通过不同的排列和嵌套就可以形成网页的框架。 </p><p>在<code>Chrome</code>浏览器中打开百度，右击并选择 “检查”项（或按<code>F12键</code>），打开开发者模式，这时在<code>Elements</code>选项卡中即可看到网页的源代码，如图所示。</p><p><img src="Screenshot_1.png" alt="HTML结构"></p><p>这就是<code>HTML</code>，整个网页就是由各种标签嵌套组合而成的。这些标签定义的节点元素相互嵌套和组合形成了复杂的层次关系，就形成了网页的架构。</p><h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><p>虽然<code>HTML</code>定义了网页的结构，但是只有<code>HTML</code>页面的布局并不美观，可能只是简单的节点元素的排列，为了让网页看起来更好看一些，这里就需要借助<code>CSS</code>了。</p><p><code>CSS</code>，全称叫作<code>Cascading Style Sheets</code>，即<code>层叠样式表</code>。“层叠”是指当在HTML中引用了数个样式文件，并且样式发生冲突时，浏览器能依据层叠顺序处理。“样式”指网页中文字大小、颜色、元素间距、排列等 格式。</p><p><code>CSS</code>是目前唯一的网页页面排版样式标准，有了它的帮助，页面才会变得更为美观。例如：</p><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-id">#head_wrapper</span><span class="hljs-selector-class">.s-ps-islite</span> <span class="hljs-selector-class">.s-p-top</span> &#123; <br>    <span class="hljs-attribute">position</span>: absolute; <br>    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">40px</span>; <br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>; <br>    <span class="hljs-attribute">height</span>: <span class="hljs-number">181px</span>; <br>    &#125;<br></code></pre></div></td></tr></table></figure><p>这就是一个<code>CSS</code>样式。大括号前面是一个<code>CSS选择器</code>。此选择器的作用是首先选中<code>id</code>为<code>head_wrapper</code>且<code>class</code> 为<code>s-ps-islite</code>的节点，然后再选中其内部的<code>class</code>为<code>s-p-top</code>的节点。大括号内部写的就是一条条样式规则，例如<code>position</code>指定了这个元素的布局方式为<strong>绝对布局</strong>，<code>bottom</code>指定元素的下边距为<strong>40像素</strong>，<code>width</code>指定了宽度为<strong>100%<strong>占满父元素，<code>height</code>则指定了元素的</strong>高度</strong>。也就是说，我们将位置、宽度、高度等样式配置统一写成这样的形式，然后用大括号括起来，接着在开头再加上<code>CSS</code>选择器，这就代表这个样式对<code>CSS</code>选择器选中的元素生效，元素就会根据此样式来展示了。</p><p>在网页中，一般会统一定义整个网页的样式规则，并写入<code>CSS</code>文件中（其后缀为css）。在HTML中，只需要用<code>link</code>标签即可引入写好的<code>CSS</code>文件，这样整个页面就会变得美观、优雅。</p><h2 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h2><p><code>JavaScript</code>，简称<code>JS</code>，是一种脚本语言。HTML和CSS配合使用，提供给用户的只是一种静态信息，缺乏交互性。我们在网页里可能会看到一些交互和动画效果，如下载进度条、提示框、轮播图等，这通常就是<code>JavaScript</code>的功劳。它的出现使得用户与信息之间不只是一种浏览与显示的关系，而是实现了一种<strong>实时、动态、交互</strong>的页面功能。</p><p><code>JavaScript</code>通常也是以单独的文件形式加载的，后缀为<code>js</code>，在 HTML中通过<code>script标签</code>即可引入，例如:</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;jquery-2.1.0.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>综上所述，HTML定义了网页的内容和结构，CSS描述了网页的布局，<code>JavaScript</code>定义了网页的行为。</p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javascript</tag>
      
      <tag>html</tag>
      
      <tag>css</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在Hexo博客中嵌入外链视频</title>
    <link href="/2021/05/11/%E5%9C%A8Hexo%E5%8D%9A%E5%AE%A2%E4%B8%AD%E5%B5%8C%E5%85%A5%E5%A4%96%E9%93%BE%E8%A7%86%E9%A2%91/"/>
    <url>/2021/05/11/%E5%9C%A8Hexo%E5%8D%9A%E5%AE%A2%E4%B8%AD%E5%B5%8C%E5%85%A5%E5%A4%96%E9%93%BE%E8%A7%86%E9%A2%91/</url>
    
    <content type="html"><![CDATA[<h1 id="嵌入的视频"><a href="#嵌入的视频" class="headerlink" title="嵌入的视频"></a>嵌入的视频</h1><p>Hexo支持Youtube视频的嵌入，可以参考其实现方式。</p><p>首先，在<code>node_modules/hexo/lib/plugins/tag/index.js</code>中添加以下代码。</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// 添加哔哩哔哩</span><br>tag.register(<span class="hljs-string">&#x27;bilibili&#x27;</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./bilibili&#x27;</span>));<br></code></pre></div></td></tr></table></figure><p>然后在<code>node_modules/hexo/lib/plugins/tag/</code>目录下新建<code>bilibili.js</code>文件，打开并添加如下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-meta">&#x27;use strict&#x27;</span>;<br><br><span class="hljs-keyword">const</span> &#123; htmlTag &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;hexo-util&#x27;</span>);<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">* bilibili tag</span><br><span class="hljs-comment">*</span><br><span class="hljs-comment">* Syntax:</span><br><span class="hljs-comment">*   &#123;% bilibili id %&#125;</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bilibiliTag</span>(<span class="hljs-params">args, content</span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> id = args[<span class="hljs-number">0</span>];<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;div style=&quot;position: relative; width: 100%; height: 0; padding-bottom: 75%;&quot;&gt;&lt;iframe src=&quot;//player.bilibili.com/player.html?<span class="hljs-subst">$&#123;id&#125;</span>&quot; scrolling=&quot;no&quot; border=&quot;0&quot; frameborder=&quot;no&quot; framespacing=&quot;0&quot; allowfullscreen=&quot;true&quot; style=&quot;position: absolute; width: 100%; height: 100%; left: 0; top: 0;&quot;&gt; &lt;/iframe&gt;&lt;/div&gt;`</span>;<br>&#125;<br><br><span class="hljs-built_in">module</span>.exports = bilibiliTag;<br><br></code></pre></div></td></tr></table></figure><p>重新启动下<code>Hexo Server</code>,在<code>md</code>页面中添加下列：</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">&#123;% bilibili aid=<span class="hljs-number">586894170</span>&amp;bvid=BV1uz4y1m72t&amp;cid=<span class="hljs-number">305401685</span>&amp;page=<span class="hljs-number">1</span> %&#125;<br></code></pre></div></td></tr></table></figure><p>重新刷新页面，就可以看到视频正常加载了。</p><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;"><iframe src="//player.bilibili.com/player.html?aid=586894170&bvid=BV1uz4y1m72t&cid=305401685&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; left: 0; top: 0;"> </iframe></div>]]></content>
    
    
    <categories>
      
      <category>博客教程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>腾讯云配置ssl证书</title>
    <link href="/2021/05/10/%E8%85%BE%E8%AE%AF%E4%BA%91%E9%85%8D%E7%BD%AEssl%E8%AF%81%E4%B9%A6/"/>
    <url>/2021/05/10/%E8%85%BE%E8%AE%AF%E4%BA%91%E9%85%8D%E7%BD%AEssl%E8%AF%81%E4%B9%A6/</url>
    
    <content type="html"><![CDATA[<h2 id="什么是SSL证书？"><a href="#什么是SSL证书？" class="headerlink" title="什么是SSL证书？"></a>什么是SSL证书？</h2><p>SSL证书是用于在Web服务器与浏览器以及客户端之间建立加密链接的加密技术，通过配置和应用SSL证书来启用HTTPS协议，来保证互联网数据传输的安全，全球每天有数以亿计的网站都是通过HTTPS来确保数据安全，保护用户隐私。</p><h2 id="申请腾讯云SSL证书"><a href="#申请腾讯云SSL证书" class="headerlink" title="申请腾讯云SSL证书"></a>申请腾讯云SSL证书</h2><p>百毒搜索腾讯SSL证书，找到免费使用SSL一年的产品，一系列骚操作后得到证书。</p><h2 id="nginx配置修改"><a href="#nginx配置修改" class="headerlink" title="nginx配置修改"></a>nginx配置修改</h2><p>下载SSL证书，上传到服务器<code>/etc/pki/nginx/</code>目录下。</p><p>修改<code>/etc/</code>配置文件，注意SSL证书的路径和实际上传的路径和名称一致。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">    # server &#123;<br>    #     listen       80 default_server;<br>    #     listen       [::]:80 default_server;<br>    #     server_name  www.holychan.ltd;<br>    #     root         /home/hexo;<br><br>    #     # Load configuration files for the default server block.<br>    #     include /etc/nginx/default.d/*.conf;<br><br>    #     location / &#123;<br>    #     &#125;<br><br>    #     error_page 404 /404.html;<br>    #         location = /40x.html &#123;<br>    #     &#125;<br><br>    #     error_page 500 502 503 504 /50x.html;<br>    #         location = /50x.html &#123;<br>    #     &#125;<br>    # &#125;<br>    # 以上的配置注释，使用下面的配置<br><br>    # Settings for a TLS enabled server.<br><br>    server &#123;<br>        listen       443 ssl http2 default_server;<br>        listen       [::]:443 ssl http2 default_server;<br>        server_name  www.holychan.ltd;<br>        root         /home/hexo;    # 根目录<br><br>        ssl_certificate &quot;/etc/pki/nginx/1_holychan.ltd_bundle.crt&quot;;    # ssl证书路径<br>        ssl_certificate_key &quot;/etc/pki/nginx/2_holychan.ltd.key&quot;; # ssl证书密钥<br>        ssl_session_cache shared:SSL:1m;<br>        ssl_session_timeout  10m;<br>        ssl_ciphers PROFILE=SYSTEM;<br>        ssl_prefer_server_ciphers on;<br><br>        # Load configuration files for the default server block.<br>        include /etc/nginx/default.d/*.conf;<br><br>        location / &#123;<br>        &#125;<br><br>        error_page 404 /404.html;<br>            location = /40x.html &#123;<br>        &#125;<br><br>        error_page 500 502 503 504 /50x.html;<br>            location = /50x.html &#123;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>博客教程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nginx</tag>
      
      <tag>https</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo在腾讯云的部署</title>
    <link href="/2021/05/10/Hexo%E5%9C%A8%E8%85%BE%E8%AE%AF%E4%BA%91%E7%9A%84%E9%83%A8%E7%BD%B2/"/>
    <url>/2021/05/10/Hexo%E5%9C%A8%E8%85%BE%E8%AE%AF%E4%BA%91%E7%9A%84%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><code>Hexo</code>在<code>GitHub pages</code>上的访问太慢了，迁移到腾讯云服务器上。</p><h2 id="部署环境"><a href="#部署环境" class="headerlink" title="部署环境"></a>部署环境</h2><p>腾讯云服务器（Centos 64位）。</p><h2 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h2><h3 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">yum install git<br></code></pre></div></td></tr></table></figure><p>创建git用户并修改权限</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">adduser git<br>passwd git<br>chmod 740 /etc/sudoers<br>vim /etc/sudoers<br></code></pre></div></td></tr></table></figure><p>找到一下内容</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Allow root to run any commands anywhere</span></span><br>root    ALL=(ALL)       ALL<br></code></pre></div></td></tr></table></figure><p>在该语句下添加</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git ALL=(ALL) ALL<br></code></pre></div></td></tr></table></figure><p>退出（esc + :wq）并修改权限</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">chmod 400 /etc/sudoers<br></code></pre></div></td></tr></table></figure><p>本地使用gitbash创建密钥</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">ssh-keygen -t rsa //因为我在GitHub上部署博客时已经创建过密钥，这里可以直接跳过生成，用以前的密钥<br></code></pre></div></td></tr></table></figure><p>在腾讯云中创建<code>ssh</code>，并将本地的<code>id_rsa.pub</code>中的文件内容全部复制到<code>authorized_keys</code>中。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">su git<br>mkdir ~/.ssh<br>vim ~/.ssh/authorized_keys<br></code></pre></div></td></tr></table></figure><p>修改权限</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">cd ~<br>chmod 600 .ssh/authorized_keys<br>chmod 700 .ssh<br></code></pre></div></td></tr></table></figure><p>本地测试</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">ssh -v git@SERVER //@后是你自己的服务器公网IP，如果不出现failed字样，说明成功<br></code></pre></div></td></tr></table></figure><p>云服务器中创建网站目录并设置权限</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">su root<br>mkdir /home/hexo<br>chown git:git -R /home/hexo<br></code></pre></div></td></tr></table></figure><h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">yum install -y nginx    // 安装<br>systemctl start nginx.service     // 启动服务<br></code></pre></div></td></tr></table></figure><p>以上执行完之后，在浏览器中输入你的公网IP如果可以进入CentOs界面，说明Nginx安装成功。</p><h3 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">nginx -t  // 命令查看位置，一般为 /etc/nginx/nginx.conf。<br>vim /etc/nginx/nginx.conf //修改配置文件，在server_name后添加自己的域名（要备案），root后添加/home/hexo<br></code></pre></div></td></tr></table></figure><p>重启服务</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">systemctl restart nginx.service<br></code></pre></div></td></tr></table></figure><h2 id="建立git仓库并修改权限"><a href="#建立git仓库并修改权限" class="headerlink" title="建立git仓库并修改权限"></a>建立git仓库并修改权限</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">su root<br>cd /home/git<br>git init --bare blog.git<br>chown git:git -R blog.git<br></code></pre></div></td></tr></table></figure><p>同步网站根目录</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">vim blog.git/hooks/post-receive<br></code></pre></div></td></tr></table></figure><p>填入如下内容</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/sh</span><br>git --work-tree=/home/hexo --git-dir=/home/git/blog.git checkout -f<br></code></pre></div></td></tr></table></figure><p>修改权限</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">chmod +x /home/git/blog.git/hooks/post-receive<br></code></pre></div></td></tr></table></figure><p>在本地Hexo目录下修改_config.yml文件中的deploy后的repo改为：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git@SERVER:/home/git/blog.git   //@后为你的服务器公网IP<br></code></pre></div></td></tr></table></figure><p>以上全部完成后，执行hexo的部署命令即可完成在腾讯云服务器上的博客部署。</p>]]></content>
    
    
    <categories>
      
      <category>博客教程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTTP基本原理</title>
    <link href="/2021/05/09/HTTP%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/"/>
    <url>/2021/05/09/HTTP%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="URI和URL"><a href="#URI和URL" class="headerlink" title="URI和URL"></a>URI和URL</h2><p><code>URI （Uniform Resource Identifier）</code> 即<strong>统一资源标志符</strong>。<br><code>URL （Uniform Resource Locator</code> 即<strong>统一资源定位符</strong>。</p><p>例如：<br><code>https://github.com/favicon.ico</code>既是一个URL，也是一个URI。用URL/URI来唯一指定了它的访问方式，这其中包括了访问协议Https，访问路径（即根目录）和资源名称<code>favicon.ico</code>。</p><p>URL是URI的一个子集，也就是每个URL都是URI，但不是每个URI都是URL。</p><p>URI还包括一个子类叫做URN（Universal Resource Name）即统一资源名称。但是在目前的互联网，URN的使用非常少，几乎所有的 URI都是URL，所以一般的网页链接我们可以称之为 URL，也可以称之为 URI。</p><h2 id="超文本"><a href="#超文本" class="headerlink" title="超文本"></a>超文本</h2><p><code>Hypertext</code>，我们在浏览器里看到的网页就是超文本解析而成的，其网页源代码是一系列 HTML代码，里面包含了一系列标签，比如<code>img</code>显示图片，<code>p</code>指定显示段落等。浏览器解析这些标签后，便形成了我们平常看到的网页，而网页的源代码<code>HTML</code>就可以称作超文本。</p><h2 id="HTTP和HTTPS"><a href="#HTTP和HTTPS" class="headerlink" title="HTTP和HTTPS"></a>HTTP和HTTPS</h2><p><code>HTTP</code>的全称是Hyper Text Transfer Protocol，中文名叫作<strong>超文本传输协议</strong>，HTTP协议是用于从网络传输超文本数据到本地浏览器的传送协议，它能保证高效而准确地传送超文本文档。HTTP由万维网协会（World Wide Web Consortium）和Internet工作小组IETF（Internet EngineeringTask Force）共同合作制定的规范，目前广泛使用的是<code>HTTP 1.1</code>版本。</p><p><code>HTTPS</code>的全称是<code>Hyper Text Transfer Protocol over Secure Socket Layer</code>，是以安全为目标HTTP通道，简单讲是HTTP的安全版，即HTTP下加入<code>SSL</code>层，简称为<code>HTTPS</code>。</p><p><code>HTTPS</code>的安全基础是<code>SSL</code>，因此通过它传输的内容都是经过<code>SSL</code>加密的，它的主要作用可以分为两种：</p><ul><li>建立一个信息安全通道，来保证数据传输的安全。</li><li>确认网站的真实性，凡是使用了HTTPS的网站，都可以通过点击浏览器地址栏的锁头标志来查看网站认证之后的真实信息，也可以通过<code>CA</code>机构颁发的安全签章来查询。</li></ul><p>现在越来越多的网站和 App 都已经向 HTTPS 方向发展。例如：</p><ul><li>苹果公司强制所有 iOS App 在 2017 年 1 月 1 日 前全部改为使用 HTTPS 加密，否则 App 就无法在应用商店上架。</li><li>谷歌从 2017 年 1 月推出的 Chrome 56 开始，对未进行 HTTPS 加密的网址链接亮出风险提示，即在地址栏的显著位置提醒用户 “此网页不安全”。</li><li>腾讯微信小程序的官方需求文档要求后台使用 HTTPS 请求进行网络通信，不满足条件的域名和协议无法请求。</li></ul><p>因此，HTTPS 已经已经是大势所趋。</p><h2 id="HTTP请求过程"><a href="#HTTP请求过程" class="headerlink" title="HTTP请求过程"></a>HTTP请求过程</h2><p>我们在浏览器中输入一个URL，回车之后便可以在浏览器中观察到页面内容。实际上，这个过程是浏览器向网站所在的服务器发送了一个请求，网站服务器接收到这个请求后进行处理和解析，然后返回对应的<strong>响应</strong>，接着传回给浏览器。响应里包含了页面的源代码等内容，浏览器再对其进行解析，便将网页呈现了出来，传输模型如图所示：</p><p><img src="1.png" alt="传输模型"></p><p>此处客户端即代表我们自己的 PC 或手机浏览器，服务器即要访问的网站所在的服务器。</p><p>为了更直观地说明这个过程，这里用浏览器的开发者模式下的<code>Network监听组件</code>来做演示，它可以显示访问当前请求网页时发生的所有网络请求和响应。打开浏览器（Chrome或Edge都可以），右击并选择 “检查”项，即可打开浏览器的开发者工具。这里访问百度<code>http://www.baidu.com/</code>，输入该 URL后回车，观察这个过程中发生了怎样的网络请求。可以看到，在<code>Network</code>页面下方 出现了一个个的条目，其中一个条目就代表一次发送请求和接收响应的过程，如图所示:</p><p><img src="Screenshot_2.png" alt="Network监听"></p><p>我们先观察第一个网络请求，即<code>www.baidu.com</code>，其中各列的含义如下。</p><ul><li>第一列 <code>Name：请求的名称</code>，一般会将 URL的最后一部分内容当作名称。</li><li>第二列 <code>Status：响应的状态码</code>，这里显示为 <code>200</code>，代表响应是正常的。通过状态码，我们可以判断发送了请求之后是否得到了正常的响应。 </li><li>第三列 <code>Type：请求的文档类型</code>。这里为<code>document</code>，代表我们这次请求的是一个 HTML文档，内容就是一些 HTML代码。</li><li>第四列 <code>Initiator：请求源</code>。用来标记请求是由哪个对象或进程发起的。</li><li>第五列 <code>Size：从服务器下载的文件和请求的资源大小</code>。如果是从缓存中取得的资源，则该列会显示 fromcache。</li><li>第六列 <code>Time：发起请求到获取响应所用的总时间</code>。</li><li>第七列 <code>Waterfall：网络请求的可视化瀑布流</code>。 我们点击这个条目即可看到其更详细的信息，如图所示。</li></ul><p><img src="Screenshot_3.png" alt="详细信息"></p><p>首先是<code>General</code>部分，<code>Request URL</code>为请求的URL，<code>Request Method</code>为请求的方法，<code>Status Code</code>为响应状态码，<code>Remote Address</code>为远程服务器的地址和端口，<code>Referrer Policy</code>为 Referrer判别策略。 </p><p>再继续往下，可以看到，有<code>Response Headers</code>和<code>Request Headers</code>，这分别代表<code>响应头</code>和<code>请求头</code>。请求头里带有许多请求信息，例如<code>浏览器标识、Cookies、Host</code>等信息，这是请求的一部分，服务器会根据请求头内的信息判断请求是否合法，进而作出对应的响应。图中看到的<code>Response Headers</code>就是响应的一部分，例如其中包含了服务器的类型、文档类型、日期等信息，浏览器接受到响应后，会解析响应内容，进而呈现网页内容。</p><h2 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h2><p><strong>请求</strong>，由客户端向服务端发出，可以分为4部分内容：<code>请求方法（Request Method</code>、<code>请求的网址（Request URL）</code>、<code>请求头（Request Headers）</code>、<code>请求体（Request Body）</code>。</p><h3 id="请求方法"><a href="#请求方法" class="headerlink" title="请求方法"></a>请求方法</h3><p>常见的请求方法有两种：<code>GET</code>和<code>POST</code>。 在浏览器中直接输入URL并回车，这便发起了一个<code>GET请求</code>，请求的参数会直接包含到URL里。例如，在百度中搜索Python，这就是一个GET请求，链接为<code>https://www.baidu.com/s?wd=Python</code>，其中URL中包 含了请求的参数信息，这里参数<code>wd</code>表示要搜寻的关键字。<code>POST请求</code>大多在表单提交时发起。比如，对于一个登录表单，输入用户名和密码后，点击“登录”按钮，这通常会发起一个<code>POST请求</code>，其数据通常 以表单的形式传输，而不会体现在URL中。</p><p><code>GET</code>和<code>POST</code>请求方法有如下区别。</p><ul><li><code>GET请求</code>中的参数包含在URL里面，数据可以在URL中看到，而<code>POST请求</code>的URL不会包含这些数据，数据都是通过表单形式传输的，会包含在请求体中。</li><li><code>GET请求</code>提交的数据最多只有<em>1024字节</em>，而<code>POST请求</code>没有限制。 一般来说，登录时，需要提交用户名和密码，其中包含了敏感信息，使用<code>GET方式</code>请求的话，密码就会暴露在URL里面，造成密码泄露，所以这里最好以<code>POST方式</code>发送。上传文件时，由于文件内容比较大，也会选用<code>POST方式</code>。 我们平常遇到的绝大部分请求都是<code>GET</code>或<code>POST</code>请求，另外还有一些请求方法，如<code>HEAD</code>、<code>PUT</code>、<code>DELETE</code>、<code>OPTIONS</code>、<code>CONNECT</code>、<code>TRACE</code>等，我们简单将其总结为下表。</li></ul><table><thead><tr><th align="left">方法</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">GET</td><td align="left">请求页面，并返回页面内容</td></tr><tr><td align="left">HEAD</td><td align="left">类似于GET请求，只不过返回的响应中没有具体的内容，用于获取报头</td></tr><tr><td align="left">POST</td><td align="left">大多用于表单提交或上传文件，数据包含在请求体中</td></tr><tr><td align="left">PUT</td><td align="left">从客户端向服务器传送的数据取代指定文档中的内容</td></tr><tr><td align="left">DELETE</td><td align="left">请求服务器删除指定的页面</td></tr><tr><td align="left">CONNECT</td><td align="left">把服务器当作跳板，让服务器代替客户端访问其他网页</td></tr><tr><td align="left">OPTIONS</td><td align="left">允许客户端查看服务器的性能</td></tr><tr><td align="left">TRACE</td><td align="left">回显服务器收到的请求，主要用于测试或诊断</td></tr></tbody></table><style>    table    {        margin: auto;        font-size: 50%;    }</style><p>请求的网址，即统一资源定位符 URL，它可以唯一确定我们想请求的资源。</p><h3 id="请求头"><a href="#请求头" class="headerlink" title="请求头"></a>请求头</h3><p>请求头，用来说明服务器要使用的附加信息，比较重要的信息有<code>Cookie</code>、<code>Referer</code>、<code>User-Agent</code>等。下面简要说明一些常用的头信息。</p><ul><li><code>Accept</code>：请求报头域，用于指定客户端可接受哪些类型的信息。</li><li><code>Accept-Language</code>：指定客户端可接受的语言类型。</li><li><code>Accept-Encoding</code>：指定客户端可接受的内容编码。</li><li><code>Host</code>：用于指定请求资源的主机<code>IP</code>和端口号，其内容为请求URL的原始服务器或网关的位置。从 HTTP 1.1 版本开始，请求必须包含此内容。</li><li><code>Cookie</code>：也常用复数形式<code>Cookies</code>，这是网站为了辨别用户进行会话跟踪而存储在用户本地的数据。它的主要功能是维持当前访问会话。例如，我们输入用户名和密码成功登录某个网站后，服务器会用会 话保存登录状态信息，后面我们每次刷新或请求该站点的其他页面时，会发现都是登录状态，这就是<code>Cookies</code>的功劳。<code>Cookies</code>里有信息标识了我们所对应的服务器的会话，每次浏览器在请求该站点的页 面时，都会在请求头中加上<code>Cookies</code>并将其发送给服务器，服务器通过<code>Cookies</code>识别出是我们自己，并且查出当前状态是登录状态，所以返回结果就是登录之后才能看到的网页内容。</li><li><code>Referer</code>：此内容用来标识这个请求是从哪个页面发过来的，服务器可以拿到这一信息并做相应的处理，如做来源统计、防盗链处理等。</li><li><code>User-Agent</code>：简称<code>UA</code>，它是一个特殊的字符串头，可以使服务器识别客户使用的操作系统及版本、浏览器及版本等信息。在做爬虫时加上此信息，可以伪装为浏览器；如果不加，很可能会被识别出为爬虫。</li><li><code>Content-Type</code>：也叫互联网媒体类型<code>（Internet Media Type）</code>或者<code>MIME类型</code>，在<code>HTTP</code>协议消息头中，它用来表示具体请求中的媒体类型信息。例如，<code>text/html</code>代表<code>HTML</code>格式，<code>image/gif</code>代表<code>GIF</code>图片，<code>application/json</code>代表<code>JSON</code>类型，更多对应关系可以查看此对照表：<code>http://tool.oschina.net/commons</code>。</li></ul><p>因此，请求头是请求的重要组成部分，在写爬虫时，大部分情况下都需要设定请求头。</p><h3 id="请求体"><a href="#请求体" class="headerlink" title="请求体"></a>请求体</h3><p>请请求体一般承载的内容是<code>POST</code>请求中的表单数据，而对于<code>GET</code>请求，请求体则为空。</p><p>登录之前，我们填写了用户名和密码信息，提交时这些内容就会以表单数据的形式提交给服务器，此时需要注意<code>Request Headers</code>中指定<code>Content-Type</code>为<code>application/x-www-form-urlencoded</code>。只有设置<code>Content-Type</code>为<code>application/x-www-form-urlencoded</code>，才会以表单数据的形式提交。另外，我们也可以将<code>Content-Type</code>设置为<code>application/json</code>来提交<code>JSON</code>数据，或者设置为<code>multipart/form-data</code>来上传文件。 </p><p>表格中列出了<code>Content-Type</code>和<code>POST</code>提交数据方式的关系。</p><table><thead><tr><th align="left">Content-Type</th><th align="left">提交数据的方式</th></tr></thead><tbody><tr><td align="left">application/x-www-form-urlencodeed</td><td align="left">表单数据</td></tr><tr><td align="left">multipart/form-data</td><td align="left">表单文件上传</td></tr><tr><td align="left">application/json</td><td align="left">序列化JSON数据</td></tr><tr><td align="left">text/xml</td><td align="left">XML数据</td></tr></tbody></table><p>在爬虫中，如果要构造<code>POST</code>请求，需要使用正确的<code>Content-Type</code>，并了解各种请求库的各个参数设置时使用的是哪种<code>Content-Type</code>，不然可能会导致<code>POST</code>提交后无法正常响应。</p><h2 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h2><p>响应，由服务端返回给客户端，可以分为三部分：<code>响应状态码（Response Status Code）</code>、<code>响应头（Response Headers）</code>和<code>响应体（Response Body）</code>。</p><h3 id="响应状态码"><a href="#响应状态码" class="headerlink" title="响应状态码"></a>响应状态码</h3><p>响应状态码表示服务器的响应状态，如<code>200</code>代表服务器正常响应，<code>404</code>代表页面未找到，<code>500</code>代表服务器内部发生错误。在爬虫中，我们可以根据状态码来判断服务器响应状态，如状态码为<code>200</code>，则证明成功返 回数据，再进行进一步的处理，否则直接忽略。下表列出了常见的错误代码及错误原因。</p><table><thead><tr><th align="left">状态码</th><th align="center">说明</th><th align="left">详情</th></tr></thead><tbody><tr><td align="left">100</td><td align="center">继续</td><td align="left">请求者应当继续提出请求，服务器已收到请求的一部分，正在等待其余部分</td></tr><tr><td align="left">101</td><td align="center">切换协议</td><td align="left">请求者已要求服务器切换协议，服务器已确认并确认切换</td></tr><tr><td align="left">200</td><td align="center">成功</td><td align="left">服务器已成功处理了请求</td></tr><tr><td align="left">201</td><td align="center">已创建</td><td align="left">请求成功并且服务器创建了新的资源</td></tr><tr><td align="left">202</td><td align="center">已接受</td><td align="left">服务器已接受请求，但尚未处理</td></tr><tr><td align="left">203</td><td align="center">非授权信息</td><td align="left">服务器已经成功处理请求，但返回的信息可能来自另一个源</td></tr><tr><td align="left">204</td><td align="center">无内容</td><td align="left">服务器成功处理了请求，但没有返回任何内容</td></tr><tr><td align="left">205</td><td align="center">重置内容</td><td align="left">服务器成功处理了请求，但内容被重置</td></tr><tr><td align="left">206</td><td align="center">部分内容</td><td align="left">服务器成功处理了部分请求</td></tr><tr><td align="left">300</td><td align="center">多种选择</td><td align="left">针对请求，服务器可执行多种操作</td></tr><tr><td align="left">301</td><td align="center">永久移动</td><td align="left">请求的网页已永久移动到新位置，即永久重定向</td></tr><tr><td align="left">302</td><td align="center">临时移动</td><td align="left">请求的网页暂时跳转到其他页面，即暂时重定向</td></tr><tr><td align="left">303</td><td align="center">查看其他位置</td><td align="left">如果原来的请求是POST，重定向目标文档应当通过GET方式访问资源</td></tr><tr><td align="left">304</td><td align="center">未修改</td><td align="left">此次请求返回的网页未修改，继续使用上次的资源</td></tr><tr><td align="left">305</td><td align="center">使用代理</td><td align="left">请求者应该使用代理访问该网页</td></tr><tr><td align="left">307</td><td align="center">临时重定向</td><td align="left">请求的资源临时从其他位置响应</td></tr><tr><td align="left">400</td><td align="center">错误请求</td><td align="left">服务器无法解析该请求</td></tr><tr><td align="left">401</td><td align="center">未授权</td><td align="left">请求没有进行身份验证或验证未通过</td></tr><tr><td align="left">403</td><td align="center">禁止访问</td><td align="left">服务器拒绝此请求</td></tr><tr><td align="left">404</td><td align="center">未找到</td><td align="left">服务器找不到请求的网页</td></tr><tr><td align="left">405</td><td align="center">方法禁用</td><td align="left">服务器禁用了请求中指定的方法</td></tr><tr><td align="left">406</td><td align="center">不接受</td><td align="left">无法使用请求的内容响应请求的网页</td></tr><tr><td align="left">407</td><td align="center">需要代理授权</td><td align="left">请求者需要使用代理授权</td></tr><tr><td align="left">408</td><td align="center">请求超时</td><td align="left">服务器请求超时</td></tr><tr><td align="left">409</td><td align="center">冲突</td><td align="left">服务器在完成请求时发生冲突</td></tr><tr><td align="left">410</td><td align="center">已删除</td><td align="left">请求的资源已永久删除</td></tr><tr><td align="left">411</td><td align="center">需要有效长度</td><td align="left">服务器不接受不含有效内容长度标头字段的请求</td></tr><tr><td align="left">412</td><td align="center">未满足前提条件</td><td align="left">服务器未满足请求者在请求中设置的其中一个前提条件</td></tr><tr><td align="left">413</td><td align="center">请求实体过大</td><td align="left">请求实体过大，超出服务器的处理能力</td></tr><tr><td align="left">415</td><td align="center">请求URL过长</td><td align="left">请求的网址过长，服务器无法处理</td></tr><tr><td align="left">416</td><td align="center">请求范围不符</td><td align="left">页面无法提供请求页面支持</td></tr><tr><td align="left">417</td><td align="center">未满足期望值</td><td align="left">服务器为满足期望请求标头字段的要求</td></tr><tr><td align="left">500</td><td align="center">服务器内部错误</td><td align="left">服务器遇到错误，无法完成请求</td></tr><tr><td align="left">501</td><td align="center">未实现</td><td align="left">服务器不具备完成请求的功能</td></tr><tr><td align="left">502</td><td align="center">错误网关</td><td align="left">服务器作为网关或代理，从上游服务器收到无效响应</td></tr><tr><td align="left">503</td><td align="center">服务不可用</td><td align="left">服务器目前无法使用</td></tr><tr><td align="left">504</td><td align="center">网关超时</td><td align="left">服务器作为网关或代理，但是没有及时从上游服务器收到响应</td></tr><tr><td align="left">505</td><td align="center">HTTP版本不支持</td><td align="left">服务器不支持请求中所用的HTTP协议版本</td></tr></tbody></table><p>响应头包含了服务器对请求的应答信息，如<code>Content-Type</code>、<code>Server</code>、<code>Set-Cookie</code>等。下面简要说明一些常用的响应头信息。 </p><ul><li><code>Date</code>：标识响应产生的时间。</li><li><code>Last-Modified</code>：指定资源的最后修改时间。</li><li><code>Content-Encoding</code>：指定响应内容的编码。</li><li><code>Server</code>：包含服务器的信息，比如名称、版本号等。</li><li><code>Content-Type</code>：文档类型，指定返回的数据类型是什么，如<code>text/html</code>代表返回<code>HTML</code>文档，<code>application/x-javascript</code>则代表返回<code>JavaScript</code>文件，<code>image/jpeg</code>则代表返回图片。</li><li><code>Set-Cookie</code>：设置<code>Cookies</code>。响应头中的<code>Set-Cookie</code>告诉浏览器需要将此内容放在<code>Cookies</code>中，下次请求携带<code>Cookies</code>请求。</li><li><code>Expires</code>：指定响应的过期时间，可以使代理服务器或浏览器将加载的内容更新到缓存中。如果再次访问时，就可以直接从缓存中加载，降低服务器负载，缩短加载时间。</li></ul><h3 id="响应体"><a href="#响应体" class="headerlink" title="响应体"></a>响应体</h3><p>最重要的当属响应体的内容了。响应的正文数据都在响应体中，比如请求网页时，它的响应体就是网页的<code>HTML</code>代码；请求一张图片时，它的响应体就是图片的二进制数据。我们做爬虫请求网页后，要解析的内容就是响应体，如图所示。</p><p><img src="Screenshot_1.png" alt="响应体"></p><p>在浏览器开发者工具中点击<code>Response</code>，就可以看到网页的源代码，也就是响应体的内容，它是解析的目标。在做爬虫时，我们主要通过响应体得到网页的源代码、<code>JSON</code>数据等，然后从中做相应内容的提取。</p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>http</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git常用命令</title>
    <link href="/2021/05/08/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/2021/05/08/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h1 id="Git常用命令"><a href="#Git常用命令" class="headerlink" title="Git常用命令"></a>Git常用命令</h1><h2 id="仓库"><a href="#仓库" class="headerlink" title="仓库"></a>仓库</h2><p>在当前目录新建一个Git代码库</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git init<br></code></pre></div></td></tr></table></figure><p>新建一个目录，将其初始化为Git代码库</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git init [project-name]<br></code></pre></div></td></tr></table></figure><p>下载一个项目和它的整个代码历史</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git clone [url]<br></code></pre></div></td></tr></table></figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>显示当前的Git配置</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git config --list<br></code></pre></div></td></tr></table></figure><p>编辑Git配置文件</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git config -e [--global]<br></code></pre></div></td></tr></table></figure><p>设置提交代码时的用户信息</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git config [--global] user.name &quot;[name]&quot;<br>git config [--global] user.email &quot;[email address]&quot;<br></code></pre></div></td></tr></table></figure><h2 id="增加-删除文件"><a href="#增加-删除文件" class="headerlink" title="增加/删除文件"></a>增加/删除文件</h2><p>添加指定文件到暂存区</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git add [file1] [file2] ...<br></code></pre></div></td></tr></table></figure><p>添加指定目录到暂存区，包括子目录</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git add [dir]<br></code></pre></div></td></tr></table></figure><p>添加当前目录的所有文件到暂存区</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git add .<br></code></pre></div></td></tr></table></figure><h2 id="添加每个变化前，都会要求确认"><a href="#添加每个变化前，都会要求确认" class="headerlink" title="添加每个变化前，都会要求确认"></a>添加每个变化前，都会要求确认</h2><p>对于同一个文件的多处变化，可以实现分次提交</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git add -p<br>````<br><br>删除工作区文件，并且将这次删除放入暂存区<br><br>```shell<br>git rm [file1] [file2] ...<br></code></pre></div></td></tr></table></figure><p>停止追踪指定文件，但该文件会保留在工作区</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git rm --cached [file]<br></code></pre></div></td></tr></table></figure><p>改名文件，并且将这个改名放入暂存区</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git mv [file-original] [file-renamed]<br></code></pre></div></td></tr></table></figure><h2 id="代码提交"><a href="#代码提交" class="headerlink" title="代码提交"></a>代码提交</h2><p>提交暂存区到仓库区</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git commit -m [message]<br></code></pre></div></td></tr></table></figure><p>提交暂存区的指定文件到仓库区</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git commit [file1] [file2] ... -m [message]<br></code></pre></div></td></tr></table></figure><p>提交工作区自上次commit之后的变化，直接到仓库区</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git commit -a<br></code></pre></div></td></tr></table></figure><p>提交时显示所有diff信息</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git commit -v<br></code></pre></div></td></tr></table></figure><p>使用一次新的commit，替代上一次提交,如果代码没有任何新变化，则用来改写上一次commit的提交信息</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git commit --amend -m [message]<br></code></pre></div></td></tr></table></figure><p>重做上一次commit，并包括指定文件的新变化</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git commit --amend [file1] [file2] ...<br></code></pre></div></td></tr></table></figure><h2 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h2><p>列出所有本地分支</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git branch<br></code></pre></div></td></tr></table></figure><p>列出所有远程分支</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git branch -r<br></code></pre></div></td></tr></table></figure><p>列出所有本地分支和远程分支</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git branch -a<br></code></pre></div></td></tr></table></figure><p>新建一个分支，但依然停留在当前分支</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git branch [branch-name]<br></code></pre></div></td></tr></table></figure><p>新建一个分支，并切换到该分支</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git checkout -b [branch]<br></code></pre></div></td></tr></table></figure><p>新建一个分支，指向指定commit</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git branch [branch] [commit]<br></code></pre></div></td></tr></table></figure><p>新建一个分支，与指定的远程分支建立追踪关系</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git branch --track [branch] [remote-branch]<br></code></pre></div></td></tr></table></figure><p>切换到指定分支，并更新工作区</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git checkout [branch-name]<br></code></pre></div></td></tr></table></figure><p>切换到上一个分支</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git checkout -<br></code></pre></div></td></tr></table></figure><p>建立追踪关系，在现有分支与指定的远程分支之间</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git branch --set-upstream [branch] [remote-branch]<br></code></pre></div></td></tr></table></figure><p>合并指定分支到当前分支</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git merge [branch]<br></code></pre></div></td></tr></table></figure><p>选择一个commit，合并进当前分支</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git cherry-pick [commit]<br></code></pre></div></td></tr></table></figure><p>删除分支</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git branch -d [branch-name]<br></code></pre></div></td></tr></table></figure><p>删除远程分支</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git push origin --delete [branch-name]<br>git branch -dr [remote/branch]<br></code></pre></div></td></tr></table></figure><h2 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h2><p>列出所有tag</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git tag<br></code></pre></div></td></tr></table></figure><p>新建一个tag在当前commit</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git tag [tag]<br></code></pre></div></td></tr></table></figure><p>新建一个tag在指定commit</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git tag [tag] [commit]<br></code></pre></div></td></tr></table></figure><p>删除本地tag</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git tag -d [tag]<br></code></pre></div></td></tr></table></figure><p>删除远程tag</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git push origin :refs/tags/[tagName]<br></code></pre></div></td></tr></table></figure><p>查看tag信息</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git show [tag]<br></code></pre></div></td></tr></table></figure><p>提交指定tag</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git push [remote] [tag]<br></code></pre></div></td></tr></table></figure><p>提交所有tag</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git push [remote] --tags<br></code></pre></div></td></tr></table></figure><p>新建一个分支，指向某个tag</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git checkout -b [branch] [tag]<br></code></pre></div></td></tr></table></figure><h2 id="查看信息"><a href="#查看信息" class="headerlink" title="查看信息"></a>查看信息</h2><p>显示有变更的文件</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git status<br></code></pre></div></td></tr></table></figure><p>显示当前分支的版本历史</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git log<br></code></pre></div></td></tr></table></figure><p>显示commit历史，以及每次commit发生变更的文件</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git log --stat<br></code></pre></div></td></tr></table></figure><p>搜索提交历史，根据关键词</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git log -S [keyword]<br></code></pre></div></td></tr></table></figure><p>显示某个commit之后的所有变动，每个commit占据一行</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git log [tag] HEAD --pretty=format:%s<br></code></pre></div></td></tr></table></figure><p>显示某个commit之后的所有变动，其”提交说明”必须符合搜索条件</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git log [tag] HEAD --grep feature<br></code></pre></div></td></tr></table></figure><p>显示某个文件的版本历史，包括文件改名</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git log --follow [file]<br>git whatchanged [file]<br></code></pre></div></td></tr></table></figure><p>显示指定文件相关的每一次diff</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git log -p [file]<br></code></pre></div></td></tr></table></figure><p>显示过去5次提交</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git log -5 --pretty --oneline<br></code></pre></div></td></tr></table></figure><p>显示所有提交过的用户，按提交次数排序</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git shortlog -sn<br></code></pre></div></td></tr></table></figure><p>显示指定文件是什么人在什么时间修改过</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git blame [file]<br></code></pre></div></td></tr></table></figure><p>显示暂存区和工作区的差异</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git diff<br></code></pre></div></td></tr></table></figure><p>显示暂存区和上一个commit的差异</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git diff --cached [file]<br></code></pre></div></td></tr></table></figure><p>显示工作区与当前分支最新commit之间的差异</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git diff HEAD<br></code></pre></div></td></tr></table></figure><p>显示两次提交之间的差异</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git diff [first-branch]...[second-branch]<br></code></pre></div></td></tr></table></figure><p>显示今天你写了多少行代码</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git diff --shortstat &quot;@&#123;0 day ago&#125;&quot;<br></code></pre></div></td></tr></table></figure><p>显示某次提交的元数据和内容变化</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git show [commit]<br></code></pre></div></td></tr></table></figure><p>显示某次提交发生变化的文件</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git show --name-only [commit]<br></code></pre></div></td></tr></table></figure><p>显示某次提交时，某个文件的内容</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git show [commit]:[filename]<br></code></pre></div></td></tr></table></figure><p>显示当前分支的最近几次提交</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git reflog<br></code></pre></div></td></tr></table></figure><h2 id="远程同步"><a href="#远程同步" class="headerlink" title="远程同步"></a>远程同步</h2><p>下载远程仓库的所有变动</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git fetch [remote]<br></code></pre></div></td></tr></table></figure><p>显示所有远程仓库</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git remote -v<br></code></pre></div></td></tr></table></figure><p>显示某个远程仓库的信息</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git remote show [remote]<br></code></pre></div></td></tr></table></figure><p>增加一个新的远程仓库，并命名</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git remote add [shortname] [url]<br></code></pre></div></td></tr></table></figure><p>取回远程仓库的变化，并与本地分支合并</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git pull [remote] [branch]<br></code></pre></div></td></tr></table></figure><p>上传本地指定分支到远程仓库</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git push [remote] [branch]<br></code></pre></div></td></tr></table></figure><p>强行推送当前分支到远程仓库，即使有冲突</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git push [remote] --force<br></code></pre></div></td></tr></table></figure><p>推送所有分支到远程仓库</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git push [remote] --all<br></code></pre></div></td></tr></table></figure><h2 id="撤销"><a href="#撤销" class="headerlink" title="撤销"></a>撤销</h2><p>恢复暂存区的指定文件到工作区</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git checkout [file]<br></code></pre></div></td></tr></table></figure><p>恢复某个commit的指定文件到暂存区和工作区</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git checkout [commit] [file]<br></code></pre></div></td></tr></table></figure><p>恢复暂存区的所有文件到工作区</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git checkout .<br></code></pre></div></td></tr></table></figure><p>重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git reset [file]<br></code></pre></div></td></tr></table></figure><p>重置暂存区与工作区，与上一次commit保持一致</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git reset --hard<br></code></pre></div></td></tr></table></figure><p>重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git reset [commit]<br></code></pre></div></td></tr></table></figure><p>重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git reset --hard [commit]<br></code></pre></div></td></tr></table></figure><p>重置当前HEAD为指定commit，但保持暂存区和工作区不变</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git reset --keep [commit]<br></code></pre></div></td></tr></table></figure><p>新建一个commit，用来撤销指定commit，后者的所有变化都将被前者抵消，并且应用到当前分支</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git revert [commit]<br></code></pre></div></td></tr></table></figure><p>暂时将未提交的变化移除，稍后再移入</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git stash<br>git stash pop<br></code></pre></div></td></tr></table></figure><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>生成一个可供发布的压缩包</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">git archive<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo搭建个人博客</title>
    <link href="/2021/05/08/Hexo%E5%88%9B%E5%BB%BA%E5%8D%9A%E5%AE%A2/"/>
    <url>/2021/05/08/Hexo%E5%88%9B%E5%BB%BA%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="Hexo"><a href="#Hexo" class="headerlink" title="Hexo"></a>Hexo</h1><p><a href="https://hexo.io/zh-cn/">Hexo</a>是一个快速、简洁且高效的博客框架。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="git安装"><a href="#git安装" class="headerlink" title="git安装"></a>git安装</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">Windows：下载并安装 git.<br>Mac：使用 Homebrew, MacPorts 或者下载 安装程序。<br>Linux (Ubuntu, Debian)：sudo apt-get install git-core<br>Linux (Fedora, Red Hat, CentOS)：sudo yum install git-core<br></code></pre></div></td></tr></table></figure><h3 id="安装-Node-js"><a href="#安装-Node-js" class="headerlink" title="安装 Node.js"></a>安装 Node.js</h3><p>Node.js 为大多数平台提供了官方的 安装程序。对于中国大陆地区用户，可以前往 淘宝 Node.js 镜像 下载。</p><p>其它的安装方法：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">Windows：通过 nvs（推荐）或者nvm 安装。<br>Mac：使用 Homebrew 或 MacPorts 安装。<br>Linux（DEB/RPM-based）：从 NodeSource 安装。<br>其它：使用相应的软件包管理器进行安装，可以参考由 Node.js 提供的 指导<br></code></pre></div></td></tr></table></figure><h3 id="安装-Hexo"><a href="#安装-Hexo" class="headerlink" title="安装 Hexo"></a>安装 Hexo</h3><p>所有必备的应用程序安装完成后，即可使用 npm 安装 Hexo。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install -g hexo-cli<br></code></pre></div></td></tr></table></figure><p>安装完成后，<code>win</code>+<code>R</code>输入<code>cmd</code>调出命令行，输入<code>hexo</code>提示如下，说明安装正确。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">C:\Users\espho&gt;hexo<br>Usage: hexo &lt;command&gt;<br><br>Commands:<br>help     Get help on a command.<br>init     Create a new Hexo folder.<br>version  Display version information.<br><br>Global Options:<br>--config  Specify config file instead of using _config.yml<br>--cwd     Specify the CWD<br>--debug   Display all verbose messages in the terminal<br>--draft   Display draft posts<br>--safe    Disable all plugins and scripts<br>--silent  Hide output on console<br><br>For more help, you can use &#x27;hexo help [command]&#x27; for the detailed information<br>or you can check the docs: http://hexo.io/docs/<br></code></pre></div></td></tr></table></figure><h2 id="建站"><a href="#建站" class="headerlink" title="建站"></a>建站</h2><p>安装 Hexo 完成后，请执行下列命令，Hexo 将会在指定文件夹中新建所需要的文件。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">hexo init &lt;folder&gt;<br>cd &lt;folder&gt;<br>npm install<br></code></pre></div></td></tr></table></figure><p>新建完成后，指定文件夹的目录如下：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">.<br>├── _config.yml<br>├── package.json<br>├── scaffolds<br>├── source<br>|   ├── _drafts<br>|   └── _posts<br>└── themes<br></code></pre></div></td></tr></table></figure><h3 id="config-yml"><a href="#config-yml" class="headerlink" title="_config.yml"></a>_config.yml</h3><p>网站的 配置 信息，您可以在此配置大部分的参数。</p><h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>应用程序的信息。EJS, Stylus 和 Markdown renderer 已默认安装，您可以自由移除。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">package.json<br>&#123;<br>  &quot;name&quot;: &quot;hexo-site&quot;,<br>  &quot;version&quot;: &quot;0.0.0&quot;,<br>  &quot;private&quot;: true,<br>  &quot;hexo&quot;: &#123;<br>    &quot;version&quot;: &quot;&quot;<br>  &#125;,<br>  &quot;dependencies&quot;: &#123;<br>    &quot;hexo&quot;: &quot;^3.8.0&quot;,<br>    &quot;hexo-generator-archive&quot;: &quot;^0.1.5&quot;,<br>    &quot;hexo-generator-category&quot;: &quot;^0.1.3&quot;,<br>    &quot;hexo-generator-index&quot;: &quot;^0.2.1&quot;,<br>    &quot;hexo-generator-tag&quot;: &quot;^0.2.0&quot;,<br>    &quot;hexo-renderer-ejs&quot;: &quot;^0.3.1&quot;,<br>    &quot;hexo-renderer-stylus&quot;: &quot;^0.3.3&quot;,<br>    &quot;hexo-renderer-marked&quot;: &quot;^0.3.2&quot;,<br>    &quot;hexo-server&quot;: &quot;^0.3.3&quot;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="scaffolds"><a href="#scaffolds" class="headerlink" title="scaffolds"></a>scaffolds</h3><p><code>模版</code>文件夹。当您新建文章时，Hexo 会根据 scaffold 来建立文件。</p><p>Hexo的模板是指在新建的文章文件中默认填充的内容。例如，如果您修改scaffold/post.md中的Front-matter内容，那么每次新建一篇文章时都会包含这个修改。</p><h3 id="source"><a href="#source" class="headerlink" title="source"></a>source</h3><p>资源文件夹是存放用户资源的地方。除 <code>_posts</code>文件夹之外，开头命名为 <code>_ (下划线)</code>的文件<code>/文件夹</code>和<code>隐藏的文件</code>将会被忽略。Markdown 和 HTML 文件会被解析并放到 <code>public</code>文件夹，而其他文件会被拷贝过去。</p><h3 id="themes"><a href="#themes" class="headerlink" title="themes"></a>themes</h3><p><code>主题</code>文件夹。Hexo 会根据主题来生成静态页面。</p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>相关配置可直接访问<a href="https://hexo.io/zh-cn/docs/configuration">官方文档</a>查看，我们先从使用别人的主题开始，<a href="https://hexo.io/themes/">官方</a>提供了335个主题下载使用，你也可以根据规范制定自己的主题。</p><h2 id="主题"><a href="#主题" class="headerlink" title="主题"></a>主题</h2><p>创建<code>Hexo</code>主题非常容易，您只要在<code>themes</code>文件夹内，新增一个任意名称的文件夹，并修改<code>_config.yml</code>内的<code>theme</code>设定，即可切换主题。一个主题可能会有以下的结构：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">.<br>├── _config.yml<br>├── languages<br>├── layout<br>├── scripts<br>└── source<br></code></pre></div></td></tr></table></figure><h3 id="config-yml-1"><a href="#config-yml-1" class="headerlink" title="_config.yml"></a>_config.yml</h3><p>主题的配置文件。和 Hexo 配置文件不同，主题配置文件修改时会自动更新，无需重启<code>Hexo Server</code>。</p><h2 id="获取主题"><a href="#获取主题" class="headerlink" title="获取主题"></a>获取主题</h2><p>选择相应的主题，从<code>github</code>上获取到<code>themes</code>目录下。</p><p>修改主目录下<code>_config.yml</code>中的配置文件，将<code>theme</code>修改为获取主题的<code>文件夹名</code>。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">theme: Kratos-Rebirth<br></code></pre></div></td></tr></table></figure><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>在主目录下调用<code>cmd</code>命令<code>hexo server</code>运行服务，访问<code>http://localhost:4000</code>进入博客。</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">espho@Holy-Surface MINGW64 /e/blog<br><span class="hljs-meta">$</span><span class="bash"> hexo server</span><br>INFO  Validating config<br>INFO  Start processing<br>INFO  Hexo is running at http://localhost:4000 . Press Ctrl+C to stop.<br>INFO  感谢使用 Kratos-Rebirth 主题，您的版本是 v1.6.2<br>INFO  如有任何疑问，您可以查阅文档，或是去 https://github.com/Candinya/Kratos-Rebirth/issues 提出对应的 issue 。<br>INFO  预祝您使用愉快。<br></code></pre></div></td></tr></table></figure><h2 id="添加文章"><a href="#添加文章" class="headerlink" title="添加文章"></a>添加文章</h2>]]></content>
    
    
    <categories>
      
      <category>博客教程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
